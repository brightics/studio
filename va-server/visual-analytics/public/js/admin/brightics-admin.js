/*   Brightics VA Build 181114 */
(function(){"use strict";this.Brightics.Admin.Permission={init:function(e,t){var i={};for(var a in e)if(e[a].resource_type===t){var n=i[e[a].resource_type];void 0===n&&(n=[],i[e[a].resource_type]=n),n.push(e[a].permission_id)}for(var r in i)$("body").attr("perm",i[r].join(" "));this.setButton()},setButton:function(){var e=$("body").attr("perm").split(" "),t=[];for(var i in e){var a=e[i].split("_");t.push(a[2].toLowerCase())}t.indexOf("create")>-1?($("button[crud=C]").show(),$("input[type=button][crud=C]").show()):($("button[crud=C]").addClass("display-none"),$("input[type=button][crud=C]").addClass("display-none")),t.indexOf("update")>-1?($("button[crud=U]").show(),$("input[type=button][crud=U]").show()):($("button[crud=U]").addClass("display-none"),$("input[type=button][crud=U]").addClass("display-none")),t.indexOf("delete")>-1?($("button[crud=D]").show(),$("input[type=button][crud=D]").show()):($("button[crud=D]").addClass("display-none"),$("input[type=button][crud=D]").addClass("display-none"))}}}).call(this),function(){"use strict";var e=this.Brightics,t=function(){return Promise.resolve($.ajax({type:"GET",url:"api/va/v2/rsa/publickey"})).then(({publicN:e,publicE:t})=>{const i=new RSAKey;return i.setPublic(e,t),i})};e.Admin.Send={getAllUsers:function(t){$("body").trigger("startProgress");$.ajax({url:"api/admin/v2/users",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){t(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getUsersByPatten:function(t,i){$("body").trigger("startProgress");var a={url:"api/admin/v2/users?pattern="+encodeURIComponent(i),type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){t(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},addUser:function(t,i,a,n){$("body").trigger("startProgress"),$.ajax({type:"GET",url:"api/va/v2/rsa/publickey"}).done(function(r){var o=new RSAKey;o.setPublic(r.publicN,r.publicE);var d={password:o.encrypt(a),name:i,email:t};$.ajax({url:"api/admin/v2/users/"+t,type:"POST",data:JSON.stringify(d),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&n(t)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})},updateUser:function(t,i,a,n){$("body").trigger("startProgress");var r={name:i,email:a};$.ajax({url:"api/admin/v2/users/"+encodeURIComponent(t)+"/update",type:"POST",data:JSON.stringify(r),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&n(t)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},deleteUser:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/users/"+t+"/delete",type:"POST",contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&i(t)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getAllNotices:function(t){$("body").trigger("startProgress");$.ajax({url:"api/admin/v2/notices",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){t(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},addNotice:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/notices/"+t.id,type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8"}).done(function(e){i()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},updateNotice:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/notices/"+encodeURIComponent(t.id)+"/update",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8"}).done(function(e){i()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},deleteNotice:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/notices/"+t+"/delete",type:"POST",contentType:"application/json; charset=utf-8"}).done(function(e){i()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},deleteNotices:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/notices/delete",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8"}).done(function(e){i()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getAllRole:function(t){$("body").trigger("startProgress");$.ajax({url:"api/admin/v2/authorization/roles",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){t(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getRoleByPatten:function(t,i){$("body").trigger("startProgress");var a="";t.userId&&(a+="userId="+t.userId),a&&(a+="&"),t.roleLabel&&(a+="roleLabel="+t.roleLabel);var n={url:"api/admin/v2/authorization/roles?"+a,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(n).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getUserByRole:function(t,i){$("body").trigger("startProgress");var a={url:"\tapi/admin/v2/authorization/roles/"+t+"/users",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getPermissionByRole:function(t,i){$("body").trigger("startProgress");var a={url:"api/admin/v2/authorization/roles/"+t+"/permissions",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},editRole:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/authorization/roles/"+encodeURIComponent(t.roleId)+"/update",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8"}).done(function(e){i()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getPermissionResourceTypeByUserId:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/authorization/"+t+"/resourcetype",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getAllAgents:function(t,i){$("body").trigger("startProgress");var a="api/admin/v2/agents",n="?";if(i){for(var r in i)n+=r+"="+i[r]+"&";a+=n}var o={url:a,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(o).done(function(e){t(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},addAgent:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/agents/"+i.agentId,type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){t()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},updateAgent:function(t,i){$("body").trigger("startProgress");var a={url:"api/admin/v2/agents/"+encodeURIComponent(i.agentId)+"/update",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(){t()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},ckeckAgentId:function(e,t){$("body").trigger("startProgress");var i={url:"api/admin/v2/agents/exist/"+e,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(i).done(function(e){t(e)}).fail(function(e){}).always(function(){$("body").trigger("endProgress")})},getAgentUser:function(t,i){$("body").trigger("startProgress");var a={url:"api/admin/v2/agents/users/user/"+t,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openErrorDialog(t.responseJSON)}).always(function(){$("body").trigger("endProgress")})},deleteAgent:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/agents/"+t+"/delete",type:"POST",contentType:"application/json; charset=utf-8"}).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},deleteAgents:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/agents/delete",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8"}).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},startAgent:function(t,i){$("body").trigger("startProgress");var a={url:"api/admin/v2/agents/"+t+"/start",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){i()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t,i),i()})},stopAgent:function(t,i){$("body").trigger("startProgress");var a={url:"api/admin/v2/agents/"+t+"/stop",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){i()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t,i),i()})},getAgentUsers:function(t){$("body").trigger("startProgress");var i={url:"api/admin/v2/agents/users",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(i).done(function(e){t(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getAgentUsersByAgentId:function(t,i){$("body").trigger("startProgress");var a={url:"api/admin/v2/agents/users/agent/"+t,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},addAgentUser:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/agents/"+i.agentId+"/user",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){t()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},deleteAgentUser:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/agents/users/"+t+"/delete",type:"POST",contentType:"application/json; charset=utf-8"}).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},checkAgentHealth:function(t,i){$("body").trigger("startProgress");var a={url:"api/admin/v2/agents/"+t+"/status",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getAllPublish:function(t,i){$("body").trigger("startProgress");var a="publishreports",n="?";if(i){for(var r in i)n+=r+"="+i[r]+"&";a+=n}var o={url:a,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(o).done(function(e){$.ajax({url:"api/va/v2/schedules",type:"GET",async:!1,contentType:"application/json; charset=utf-8"}).done(function(i){t(e,i)})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getIp:function(t){$("body").trigger("startProgress");$.ajax({url:"publishreports/ip",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){t(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},getProject:function(t,i,a){$.ajax({url:"api/va/v2/ws/projects",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(n){var r=!1,o=!1;for(var d in n)n[d].id==t&&(r=!0);if(r){var s={url:"api/va/v2/ws/projects/"+t+"/files",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(s).done(function(t){for(var n in t)t[n].id==i&&(o=!0);o?a():e.VA.Core.Utils.WidgetUtils.openErrorDialog("Not exist Model")}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}else e.VA.Core.Utils.WidgetUtils.openErrorDialog("Not exist Model")}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})},getModel:function(t,i){$("body").trigger("startProgress");var a={url:"api/va/v2/ws/projects/"+t+"/files",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){i(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})},getProjects:function(e,t){$("body").trigger("startProgress");$.ajax({url:"api/va/v2/ws/projects",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(t){e(t)}).fail(function(e){t(e)}).always(function(){$("body").trigger("endProgress")})},getModels:function(e,t,i){$("body").trigger("startProgress");var a={url:"api/va/v2/ws/projects/"+e+"/files",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(a).done(function(e){t(e)}).fail(function(e){i(e)}).always(function(){$("body").trigger("endProgress")})},getAllDatasources:function(t){$("body").trigger("startProgress");$.ajax({url:"api/admin/v2/datasources",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){t(e)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},addDatasource:function(i,a){$("body").trigger("startProgress"),t().then(t=>{$.ajax({url:"api/admin/v2/datasources/"+i.datasourceName,type:"POST",data:JSON.stringify(Object.assign({},i,{password:t.encrypt(i.password)})),contentType:"application/json; charset=utf-8"}).done(function(e){a(i.datasourceName)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})})},deleteDatasource:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/datasources/"+t+"/delete",type:"POST",contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&i(t)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},deleteDatasources:function(t,i){$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/datasources/delete",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&i()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},updateDatasource:function(i,a){$("body").trigger("startProgress");var n="api/admin/v2/datasources/"+i.datasourceName+"/update";t().then(t=>{var r={url:n,type:"POST",data:JSON.stringify(Object.assign({},i,{password:t.encrypt(i.password)})),contentType:"application/json; charset=utf-8"};$.ajax(r).done(function(e){a(i.datasourceName)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})})}}}.call(this),function(){"use strict";this.Brightics.Admin.UserValidation={chkEmailForm:function(e,t){var i=!0;if(""==e)return $(t).hide(),!1;return/^[0-9a-zA-Z]([\-.\w]*[0-9a-zA-Z\-_+])*@([0-9a-zA-Z][\-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9}$/.test(e)?$(t).hide():($(t).css("color","red"),$(t).text("Current user id is invalid."),$(t).show(),i=!1),i},chkDuplicateEmail:function(e){var t=!0;return/^[0-9a-zA-Z]([\-.\w]*[0-9a-zA-Z\-_+])*@([0-9a-zA-Z][\-\w]*[0-9a-zA-Z]\.)+[a-zA-Z]{2,9}$/.test(e)&&e.length&&$.ajax({type:"GET",url:"api/admin/v2/users/"+e}).done(function(e){e.length?($("#idMsg").css("color","red"),$("#idMsg").text("This user id already exist."),$("#idMsg").show(),t=!1):($("#idMsg").css("color","green"),$("#idMsg").text("This user id is available."),$("#idMsg").show(),t=!0)}),t},chkPasswordForm:function(e,t,i,a){var n=a||"Current";if(""==e)return $(i).hide(),!1;var r=(t=t).search(/[0-9]/g),o=t.search(/[a-z]/gi),d=t.search(/[`~!@@#$%^&*|₩₩₩'₩";:₩\/?]/gi);if(t===e||-1!=t.indexOf(e))return $(i).css("color","red"),$(i).text(n+" password is invalid(id=password)"),$(i).show(),!1;if($(i).hide(),t.length<10||t.length>20)return $(i).css("color","red"),$(i).text(n+" length of password should be 10 to 20."),$(i).show(),!1;if($(i).hide(),-1!=t.search(/₩s/))return $(i).css("color","red"),$(i).text(n+" password is invalid(space)."),$(i).show(),!1;if($(i).hide(),r<0&&o<0||o<0&&d<0||d<0&&r<0)return $(i).css("color","red"),$(i).text(n+" password is invalid(num+eng or spe)."),$(i).show(),!1;$(i).hide();for(var s=0,c=0,l=0,u=0;u<t.length;u++){var p=t.charAt(u),h=t.charAt(u+1);p==h&&(s+=1);var m=t.charAt(u+2);p.charCodeAt(0)-h.charCodeAt(0)==1&&h.charCodeAt(0)-m.charCodeAt(0)==1&&(c+=1),p.charCodeAt(0)-h.charCodeAt(0)==-1&&h.charCodeAt(0)-m.charCodeAt(0)==-1&&(l+=1)}return s>1?($(i).css("color","red"),$(i).text(n+" password is invalid(do not same char)"),$(i).show(),!1):($(i).hide(),c>1||l>1?($(i).css("color","red"),$(i).text(n+" password is invalid(do not series)"),$(i).show(),!1):($(i).hide(),!0))},chkPasswordConfirmForm:function(e,t,i){var a=!0;return e!=t?($(i).css("color","red"),$(i).text("New password not match with Confirm password. "),$(i).show(),a=!1):$(i).hide(),a},chkSamePassword:function(e,t,i){var a=!0;return e==t?($(i).css("color","red"),$(i).text("New Password should not be same as current password."),$(i).show(),a=!1):$(i).hide(),a},chkName:function(e,t){var i=!0;return""===e?($(t).css("color","red"),$(t).text("Name is required"),$(t).show(),i=!1):(i=!0,$(t).hide()),i},chkPolicyAgree:function(e,t){var i=!0;return e?(i=!0,$(t).hide()):($(t).css("color","red"),$(t).text("Privacy Policy Agree is required"),$(t).show(),i=!1),i}}}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(e,t){this.parentId=e,this.options=t,this.datafields=[{name:"agentId",type:"string"},{name:"agentName",type:"string"},{name:"agentDescription",type:"string"},{name:"serverIp",type:"string"},{name:"serverPort",type:"number"},{name:"cores",type:"number"},{name:"memoryPerNodes",type:"number"},{name:"status",type:"string"}],this.datatype="array",this.agentDefaultUser=["admin","guest"],this.searchData={agentId:"",activeStart:!0,activeStop:!0},this.retrieveParent(),this.createControls(),this.registerEventListener()}i.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-agent"),this.createListArea(),t.InputValidator.appendValidationCondition($("article.brtc-admin-agent-add .brtc-admin-input.add-agent-id"))},i.prototype.createListArea=function(){this.$listArea=$("article.brtc-admin-agent-list"),this.createDataArea(this.$listArea.find(".brtc-admin-data-area"))},i.prototype.createDataArea=function(e){this.createSumArea(e),this.createDataControlArea(e)},i.prototype.createSumArea=function(t){var i=this,a=$('<div class="tb_view_st">   <span>Total<strong class="brtc-admin-total-count"></strong></span>   <div class="brtc-admin-dropdown-count"></div></div>');t.append(a);a.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),a.find(".brtc-admin-dropdown-count").on("select",function(t){var n=t.args,r=a.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index);null!=r&&(i.$agentGrid.jqxGrid({pagesize:r.value}),e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$agentGrid))})},i.prototype.createDataControlArea=function(t){var i=this,a=$('<div class="tb_choibox btn_box ctr01 choinone brtc-admin-choice">   <div class="ipstc brtc-admin-selected">       <input type="checkbox" id="cc1" value=""/>       <label for="cc1"><b>1</b> Row(s) selected.</label>   </div>   <div class="brtc-float-left active">       <button class="brtc-admin-button button add" value="add" CRUD="C">Add</button>       <button class="brtc-admin-button delete" style="cursor:default" value="delete" CRUD="D">Delete</button>   </div>   <div class="brtc-float-right-refresh">       <button class="brtc-admin-button reload" style="height: 21px !important; padding-left: 0px !important;padding-right: 0px !important;" value="reload"><span class="fa fa-refresh"></span></button>   </div></div><div class="tb_choinone"></div><div class="tb_headview"></div>');t.append(a),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){i.$agentGrid.jqxGrid("clearselection")}),a.find(".add").on("click",function(){i.changePerspective(this)}),a.find(".delete").on("click",function(){var t=i.$agentGrid.jqxGrid("getselectedrowindexes");if(t.length>0){var a=[];for(var n in t){var r=i.$agentGrid.jqxGrid("getrowdata",t[n]);a.push("["+r.agentName+"]")}i.createDeleteAgentConfirmDialog(function(t){if(t.OK){var a=i.$agentGrid.jqxGrid("getselectedrowindexes"),n=0,r=[];for(var o in a){var d=i.$agentGrid.jqxGrid("getrowdata",a[o]);r.push("["+d.agentName+"]"),e.Admin.Send.deleteAgent(d.agentId,function(t){++n===a.length&&(0==$(".brtc-admin-dialogs-main").length&&i.checkDialog({title:"Success",message:"( "+n+" ) Agent(s) has been deleted."}),i.changePerspective(),i.resetSearchData(),i.refreshAgentData()),e.Admin.Send.getAllAgents(function(i){var a=i.filter(function(e){return e.agentId==t.agentId});for(var n in a)e.Admin.Send.deleteAgentUser(a[n].userId,function(){})})})}}},a)}}),a.find(".modify").on("click",function(){var e=i.$agentGrid.jqxGrid("getselectedrowindexes");this.rowData=i.$agentGrid.jqxGrid("getrowdata",e[0]),i.changePerspective(this)}),this.createDataGrid($(".tb_headview"))},i.prototype.createDataGrid=function(i){var a=this;this.$agentGrid=$('<div class="brtc-admin-body-grid-notice"></div>'),i.append(this.$agentGrid),this.$agentGrid.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:521,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columnsresize:!1,selectionmode:"checkbox",autoheight:!0,columns:[{text:"ID",datafield:"agentId",width:"140px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"brtc-grid-cell-bold",cellsrenderer:t.WidgetUtils.cellRendererLeft},{text:"Name",datafield:"agentName",width:"110px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft},{text:"Desc",datafield:"agentDescription",width:"auto",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft},{text:"IP",datafield:"serverIp",width:"100px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Port",datafield:"serverPort",width:"70px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Cores",datafield:"cores",width:"70px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Memory Per Nodes",datafield:"memoryPerNodes",width:"70px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Active",datafield:"status",width:"180px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"pointer",cellsrenderer:function(e,t,i){return'<div class="brtc-float-left agent-health active" index="'+e+'">    <button class="brtc-admin-button toggle start" health="STOP" value="start" status="'+i+'">Start</button>    <button class="brtc-admin-button toggle stop" health="STOP" value="stop"  status="'+i+'">Stop</button></div>'}}]}),this.$agentGrid.on("pagechanged",function(t){a.bindButtonEvent(),e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.$agentGrid.on("rowselect",function(e){a.refreshDataControlButton()}),this.$agentGrid.on("rowunselect",function(e){a.refreshDataControlButton()}),this.$agentGrid.on("cellclick",function(e){if("_checkboxcolumn"==e.args.datafield)a.refreshDataControlButton();else if("status"!=e.args.datafield)this.value="detail",this.rowData=$(this).jqxGrid("getrowdata",e.args.rowindex),a.changePerspective(this);else if("status"===e.args.datafield){var t=$(e.args.originalEvent.target);if(t.hasClass("start"))"STOP"==t.attr("status")&&(i=a.$agentGrid.jqxGrid("getrowdata",t.closest(".brtc-float-left").attr("index")),a.selectedAgentId=i.agentId,a.createChangeStatusConfirmDialog(a.selectedAgentId,"START"));else if("RUN"==t.attr("status")){var i=a.$agentGrid.jqxGrid("getrowdata",t.closest(".brtc-float-left").attr("index"));a.selectedAgentId=i.agentId,a.createChangeStatusConfirmDialog(a.selectedAgentId,"STOP")}}}),this.refreshAgentData()},i.prototype.bindButtonEvent=function(){var e=this;$(".brtc-admin-button.toggle.start").off("click"),$(".brtc-admin-button.toggle.stop").off("click"),$(".brtc-admin-button.toggle.start").click(function(){if("STOP"==$(this).attr("status")){var t=e.$agentGrid.jqxGrid("getrowdata",$(this).closest(".brtc-float-left").attr("index"));e.selectedAgentId=t.agentId,e.createChangeStatusConfirmDialog(e.selectedAgentId,"START")}}),$(".brtc-admin-button.toggle.stop").click(function(){if("RUN"==$(this).attr("status")){var t=e.$agentGrid.jqxGrid("getrowdata",$(this).closest(".brtc-float-left").attr("index"));e.selectedAgentId=t.agentId,e.createChangeStatusConfirmDialog(e.selectedAgentId,"STOP")}})},i.prototype.addFilter=function(){var e=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=all]"),t=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=start]"),i=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=stop]"),a=$(".brtc-admin-agent-search-id"),n=new $.jqx.filter,r=new $.jqx.filter;r.operator="or";var o=new $.jqx.filter;o.operator="or";var d=a.val(),s=n.createfilter("stringfilter",d,"contains");if(n.addfilter(1,s),r.addfilter(1,s),o.addfilter(1,s),this.$agentGrid.jqxGrid("addfilter","agentId",n),this.$agentGrid.jqxGrid("addfilter","agentName",r),this.$agentGrid.jqxGrid("addfilter","agentDescription",o),!e.is(":checked")){var c=new $.jqx.filter,l="";t.is(":checked")?l="RUN":i.is(":checked")&&(l="STOP");var u=c.createfilter("stringfilter",l,"equal");c.addfilter(1,u),this.$agentGrid.jqxGrid("addfilter","status",c)}this.$agentGrid.jqxGrid("applyfilters"),this.setRowCount()},i.prototype.createDeleteAgentConfirmDialog=function(e,i){var a={title:"",contentText:void 0===i?"Are you sure you want to delete?":"Are you sure you want to delete "+i.length+" selected agents?",close:e,isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},i.prototype.createChangeStatusConfirmDialog=function(i,a){var n=this,r={title:"STOP"==a?" Stopping":" Starting",sender:{STOP:e.Admin.Send.stopAgent,START:e.Admin.Send.startAgent},contentText:"STOP"==a?" STOP":" START",delay:"STOP"==a?5e3:3e3},o=this.selectedAgentId.length>30?this.selectedAgentId.substr(0,27)+"...":this.selectedAgentId,d={title:"Change Active Status",contentText:"Now "+r.contentText+" ["+o+"] Are you sure?",close:function(e){e.OK&&(n.statusProgress=t.WidgetUtils.createProgressDialog($("body"),{title:r.title+" "+n.selectedAgentId+"..."}),setTimeout(function(){r.sender[a](n.selectedAgentId,function(){n.statusProgress.jqxWindow("destroy"),n.refreshAgentData()})},r.delay))},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,d)},i.prototype.createDeleteAgentUserConfirmDialog=function(i){var a=this,n={title:"",contentText:"Are you sure you want to delete?",close:function(t){if(t.OK){for(var n in i)e.Admin.Send.deleteAgentUser(i[n],function(){});$(".sum_row").removeClass("active"),a.checkDialog({title:"Success",message:"Agent User(s) has been deleted.",close:a.renderUser.bind(a)})}},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,n)},i.prototype.changePerspective=function(e){e?"add"===e.value?($("article").hide(),$("article.brtc-admin-agent-add input").val(""),$("article.brtc-admin-agent-add").show(),$(".brtc-admin-input").prop("disabled",!1),$("article.brtc-admin-agent-add .brtc-admin-input.add-agent-id").focus()):"modify"===e.value?(this.$userList&&this.$userList.empty(),$("article").hide(),$("article.brtc-admin-agent-detail").find("h2").text("Edit Agent"),$("article.brtc-admin-agent-detail").show(),this.renderDetail(e.rowData),this.renderUser(e.rowData.agentId),$(".brtc-admin-agent-detail .sum_row input[type=checkbox]").prop("checked",!1),$(".brtc-admin-agent-detail .sum_row").removeClass("active"),$(".detail-user.delete").hide(),$(".detail-user.modify").hide(),$(".detail-user.cancel").show(),$(".detail-user.save").show(),$(".detail-user.list").hide(),$(".brtc-admin-input").prop("disabled",!1),$(".brtc-admin-input[name!=agentId]").removeAttr("title"),$(".brtc-admin-input[name=agentId]").prop("disabled",!0),$(".srch_ip").show(),$(".srch_tp").css("border-bottom",""),$(".sum_row").show(),$(".search-user-header strong").text("Add User"),$(".brtc-admin-button.agent-user.add.button").show(),$("article.brtc-admin-agent-detail .brtc-admin-input.detail-agent-name").focus(),$(".brtc-admin-agent-detail .sum_list.user-list").css("height","calc(100% - 100px)")):"detail"===e.value&&($("article").hide(),$("article.brtc-admin-agent-detail").find("h2").text("Agent Detail"),$("article.brtc-admin-agent-detail").show(),this.renderDetail(e.rowData),this.renderUser(e.rowData.agentId,!1),$(".detail-user.delete").show(),$(".detail-user.modify").show(),$(".detail-user.cancel").hide(),$(".detail-user.save").hide(),$(".detail-user.list").show(),$(".brtc-admin-input").prop("disabled",!0),$(".srch_ip").hide(),$(".srch_tp").css("border-bottom","solid 1px #dfdfdf"),$(".sum_row").hide(),$(".search-user-header strong").text("User List"),$(".brtc-admin-agent-detail .sum_list.user-list").css("height","calc(100% - 50px)")):($("article").hide(),$("article.brtc-admin-agent-list").show())},i.prototype.renderDetail=function(e){this.agentInfo=e;$(".brtc-admin-agent-detail").find("input");for(var t in e)$(".brtc-admin-agent-detail").find("input[name="+t+"]").val(e[t]),$(".brtc-admin-agent-detail").find("input[name="+t+"]").prop("title",e[t])},i.prototype.addUser=function(e,t){var i=this,a=this.$userList.find("li");if(-1==$.inArray(e,this.agentDefaultUser)){for(var n=0;n<a.length;n++)if($(a[n]).attr("userId")==e)return;var r=this.allUsersInfo.filter(function(t){return t.id==e});if(r=r[0]){var o=r.name+" / "+r.id,d=$('<li>   <div class="ipstc">       <input type="checkbox" value="" />       <label><span></span></label>   </div></li>');d.attr("userId",r.id),d.attr("title",o),d.find("input").attr("id",r.id),d.find("label").attr("for",r.id),d.find("span").text(o),!1===t&&(d.find("input").remove(),d.find("span").css("cursor","default")),d.find("input").change(function(){var e=$(".sum_list .ipstc input:checkbox:checked").length;i.selectUser(e)}),i.$userList.append(d)}}},i.prototype.renderUser=function(t,i){var a=this;e.Admin.Send.getAllUsers(function(n){a.allUsersInfo=n;e.Admin.Send.getAgentUsers(function(e){for(var t in a.allAgentUsers=e,a.agentUser=a.allAgentUsers.filter(function(e){return e.agentId==a.agentInfo.agentId}),a.$userList=$(".brtc-admin-agent-detail .user-list ul"),a.$userList.empty(),a.agentUser)a.addUser(a.agentUser[t].userId,i)},t)})},i.prototype.addAgentUser=function(t){var i=this;e.Admin.Send.addAgentUser(function(){i.renderUser(i.agentInfo.agentId),$(".user-popup").hide()},{agentId:this.agentInfo.agentId,userId:t})},i.prototype.selectUser=function(e){e>0?($(".active_view_p .ipstc b:first").html(e),$(".active_view_p input[type=checkbox]:first").prop("checked",!0),$($(".sum_row > a")[0]).hide(),$(".sum_row > a").slice(1).removeClass("disable"),$(".sum_row").addClass("active")):($($(".sum_row > a")[0]).show(),$(".sum_row").removeClass("active"),$(".tb_choibox > a").slice(1).addClass("disable"))},i.prototype.refreshDataControlButton=function(){var e=this.$agentGrid.jqxGrid("getselectedrowindexes"),t=$(".brtc-admin-choice");e.length>1?(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").css("cursor","pointer"),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0)):0===e.length?(t.removeClass("active"),t.find(".brtc-admin-button.add").show(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!0}),t.find(".brtc-admin-selected").hide(),t.find(".brtc-admin-selected").find("b:first").hide()):(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").css("cursor","pointer"),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0))},i.prototype.refreshAgentData=function(t){var i=this;e.Admin.Send.getAllAgents(function(t){var a={localdata:t,datafields:i.datafields,datatype:i.datafields};e.VA.Core.Utils.WidgetUtils.updateGridSource(i.$agentGrid,a),i.agentList=t,i.$listArea.find(".brtc-admin-total-count").text(t.length),i.refreshDataControlButton(),i.$agentGrid.jqxGrid("clearselection")},t)},i.prototype.setDetailNoticeInfo=function(e){var t=this.$mainControl.find(".brtc-admin-input.detail-notice-title");$(t).val(e.title);var i=this.$mainControl.find(".brtc-admin-input.detail-notice-content");$(i).val(e.content),this.selectedItem=e},i.prototype.checkDialog=function(e){var i={title:e.title,contentText:e.message};e.close&&(i.close=e.close),t.WidgetUtils.createAdminConfirmDialog(this.$parent,i)},i.prototype.validationDialog=function(e,i){var a={title:e,contentText:i.message,close:function(){$(i.target).focus()}};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},i.prototype.validation=function(t){var i=$("article."+t+" input[name=agentId]"),a=$("article."+t+" input[name=agentName]"),n=$("article."+t+" input[name=serverIp]"),r=$("article."+t+" input[name=serverPort]"),o=$("article."+t+" input[name=cores]"),d=$("article."+t+" input[name=memoryPerNodes]");return""==i.val().trim()?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter id.",function(){i.focus()}),!1):/[\u3131-\u314e|\u314f-\u3163|\uac00-\ud7a3]/g.test(i.val().trim())?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check id format.",function(){i.focus()}),!1):""==a.val().trim()?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter name.",function(){a.focus()}),!1):""==n.val().trim()?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter ip.",function(){n.focus()}),!1):/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/.test(n.val().trim())||/^([a-zA-Z0-9][a-zA-Z0-9\-_]*[a-zA-Z0-9])$/.test(n.val().trim())?""==r.val().trim()?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter port.",function(){r.focus()}),!1):Number(r.val().trim())>65535?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Port number should be under 65535.",function(){r.focus()}),!1):isNaN(r.val().trim())?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Port number should be number type.",function(){r.focus()}),!1):isNaN(o.val().trim())?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Cores should be number type.",function(){o.focus()}),!1):isNaN(d.val().trim())?(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Allow only number type.",function(){d.focus()}),!1):{target:void 0,message:""}:(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check ip format.",function(){n.focus()}),!1)},i.prototype.registerEventListener=function(){var t=this,i=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=all]"),a=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=start]"),n=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=stop]");i.click(function(){$(this).is(":checked")?(a.prop("checked",!0),n.prop("checked",!0)):(a.prop("checked",!1),n.prop("checked",!1))}),a.click(function(){$(this).is(":checked")?n.is(":checked")&&i.prop("checked",!0):i.prop("checked",!1)}),n.click(function(){$(this).is(":checked")?a.is(":checked")&&i.prop("checked",!0):i.prop("checked",!1)}),$(".brtc-admin-agent-search-id").keydown(function(e){13==e.keyCode&&t.searchAgent()}),$(".brtc-admin-agent-search-button-clear").click(function(){$(".brtc-admin-agent-search").find("input[type=text]").val(""),a.prop("checked",!0),n.prop("checked",!0),i.prop("checked",!0),t.resetSearchData(),t.refreshAgentData(t.searchData)}),$(".brtc-admin-agent-search-button-search").click(function(){t.searchAgent()}),$(".reload").click(function(){t.filteringAgentData()}),$(".button.cancel").click(function(){t.changePerspective()}),$(".brtc-admin-agent-add-button.save").click(function(){if(t.validation("brtc-admin-agent-add")){e.Admin.Send.ckeckAgentId($(".brtc-admin-agent-add input[name=agentId]").val(),function(i){for(var a={agentDescription:"",agentId:"",agentName:"",cores:"",deploySerialNumber:"",lastStartTime:"",lastStartUser:"",memoryPerNodes:"",serverIp:"",serverPort:"",status:""},n=$(".brtc-admin-agent-add input"),r=0;r<n.length;r++){var o=$(n[r]).attr("name"),d=$(n[r]).val();a[o]=d}e.Admin.Send.addAgent(function(){t.checkDialog({title:"Success",message:"Agent has been created."}),t.changePerspective(),t.resetSearchData(),t.refreshAgentData(),$(".brtc-admin-agent-search-id").val("")},a)})}});var r=function(e){var t=e.keyCode;return(t>=48&&t<=57||t>=96&&t<=105||8==t||9==t||127==t||37==t||39==t||46==t)&&void 0},o=function(e){return 32!=e.keyCode&&void 0},d=$(".brtc-admin-input.add-agent-ip"),s=$(".brtc-admin-input.add-agent-id"),c=$(".brtc-admin-input.add-agent-port"),l=$(".brtc-admin-input.add-agent-cores"),u=$(".brtc-admin-input.add-agent-memorypernodes");d.keydown(o),s.keyup(function(e){if(8!=e.keyCode&&9!=e.keyCode&&37!=e.keyCode&&39!=e.keyCode&&46!=e.keyCode){var t=$(this).val();$(this).val(t.replace(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/g,""))}}),c.keydown(r),l.keydown(r),u.keydown(r);var p=$(".brtc-admin-input.detail-agent-ip"),h=$(".brtc-admin-input.detail-agent-port"),m=$(".brtc-admin-input.detail-agent-cores"),f=$(".brtc-admin-input.detail-agent-memorypernodes");p.keydown(o),h.keydown(r),m.keydown(r),f.keydown(r),$(".active_view_p input[type=checkbox]:first").change(function(){$('.sum_list .ipstc input[type="checkbox"]').prop("checked",!1),t.selectUser(0)}),$(".brtc-admin-button.detail-user.list.bottom").click(function(){t.changePerspective()}),$(".brtc-admin-button.agent-user.add").click(function(){t.showAddUserDialog()}),$(".brtc-admin-button.agent-user.delete").click(function(){$(".sum_list .ipstc input:checkbox:checked").closest("li").remove(),t.selectUser(0)}),$(".brtc-admin-button.detail-user.delete.bottom").click(function(){t.createDeleteAgentConfirmDialog(function(i){i.OK&&($(".brtc-admin-input[name=agentId]").val(),e.Admin.Send.deleteAgent($(".brtc-admin-input[name=agentId]").val(),function(i){t.checkDialog({title:"Success",message:"Agent has been deleted."}),t.changePerspective(),t.resetSearchData(),t.refreshAgentData(),e.Admin.Send.getAllAgents(function(t){var a=t.filter(function(e){return e.agentId==i.agentId});for(var n in a)e.Admin.Send.deleteAgentUser(a[n].userId,function(){})})}))})}),$(".brtc-admin-button.detail-user.modify.bottom").click(function(){this.rowData=t.agentList.filter(function(e){return e.agentId==$(".detail-agent-id").val()})[0],t.changePerspective(this)}),$(".brtc-admin-button.detail-user.save.bottom").click(function(){if(t.validation("brtc-admin-agent-detail")){for(var i={agentDescription:"",agentId:"",agentName:"",cores:"",deploySerialNumber:"",lastStartTime:"",lastStartUser:"",memoryPerNodes:"",serverIp:"",serverPort:"",status:""},a=$(".brtc-admin-agent-detail input"),n=0;n<a.length;n++){var r=$(a[n]).attr("name"),o=$(a[n]).val();"agentDesc"==r&&(r="agentDescription"),i[r]=o}for(var n in t.agentList)if(t.agentList[n].agentId===i.agentId){i.agentType=t.agentList[n].agentType;break}e.Admin.Send.getAgentUsersByAgentId($(".brtc-admin-input[name=agentId]").val(),function(a){for(var n=0;n<a.length;n++)-1==$.inArray(a[n].userId,t.agentDefaultUser)&&e.Admin.Send.deleteAgentUser(a[n].userId,function(){});e.Admin.Send.updateAgent(function(i){var a=function(){0==$(".brtc-admin-dialogs-main").length&&t.checkDialog({title:"Success",message:"Agent has been updated."}),t.changePerspective(),t.resetSearchData(),t.refreshAgentData()},n=$(".sum_list.user-list li");if(n.length>0)for(var r=0;r<n.length;r++)e.Admin.Send.addAgentUser(a,{agentId:$(".brtc-admin-input[name=agentId]").val(),userId:$($(".sum_list.user-list li")[r]).attr("userid")});else a()},i)})}});$(".search-user-input").keydown(function(e){var t;13==e.keyCode&&($(this).trigger("focusout"),(t=$(this).val())&&""!=t?($(".user-popup").find("li").hide(),$(".user-popup").find("li[user-id^="+t+"]").show()):$(".user-popup").find("li").show(),$(".user-popup").show())}),$(".search-user-button").click(function(){t.showAddUserDialog()}),$(".delete-agentuser-button").on("click",function(){for(var e=t.$userList.find("input"),i=[],a=0;a<e.length;a++)$(e[a]).is(":checked")&&i.push($(e[a]).attr("id"));i.length>0&&t.createDeleteAgentUserConfirmDialog(i)})},i.prototype.searchAgent=function(){var t=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=start]"),i=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=stop]");""===$(".brtc-admin-agent-search-id").val()&&t.is(":checked")&&i.is(":checked")?this.$agentGrid.jqxGrid("clearfilters"):this.addFilter(),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(this.$agentGrid),this.setRowCount()},i.prototype.setRowCount=function(){var t=this.$agentGrid.jqxGrid("getrows");$(".brtc-admin-total-count").text(t.length),e.VA.Core.Utils.WidgetUtils.updatePageButton(this.$agentGrid)},i.prototype.showAddUserDialog=function(){var t=this;this.authorizedUserList=[],this.$addUserDialog=$('<div class="brtc-admin-auth-add-user-dialog">   <div><strong>Add user</strong></div>   <div class="pop_view design_checkbox brtc-admin-auth-add-user"></div></div>'),this.$parent.append(this.$addUserDialog),this.$addUserContainer=this.$addUserDialog.find(".brtc-admin-auth-add-user"),this.$addUserDialog.append(this.$addUserContainer);this.$addUserDialog.jqxWindow({theme:e.VA.Env.Theme,showCollapseButton:!0,height:540,width:800,isModal:!0,resizable:!1,initContent:function(){t.createAddUserArea.call(t,t.$addUserContainer),t.createAddUserButtonArea.call(t,t.$addUserContainer)}}),this.$addUserDialog.on("close",function(){this.$addUserDialog.jqxWindow("destroy"),this.$addUserDialog.remove()}.bind(t))},i.prototype.createAddUserArea=function(i){var a=this,n=$('<div class="b_cont_0102">    <div class="srch_tp" style="width: 100% !important;">        <div class="srch_ip">            <input type="text" class="brtc-admin-auth-search-user" valid-type="type4" maxlength="80" placeholder="Search User">            <button class="brtc-admin-button search-area search" value="search" >Search</button>        </div>    </div>    <div class="b_cont_0101">        <strong>Total <b class="brtc-admin-total-add-user-count">54</b></strong>        <ul class="brtc-admin-auth-search-user-list">           <li> No data to display </li>        </ul>        <strong>Selected User<b class="brtc-admin-total-add-target-user-count"></b></strong>        <ul class="brtc-admin-auth-search-user-authorized-list">        </ul>    </div></div>');i.append(n),n.find(".brtc-admin-button.search").jqxButton({theme:e.VA.Env.Theme});var r=function(e){a.refreshUserByPatten.call(a,e)},o=function(){var t=n.find(".brtc-admin-auth-search-user").val()||"";t.trim()?e.Admin.Send.getUsersByPatten(r,t):e.Admin.Send.getAllUsers(r)};n.find(".brtc-admin-button.search").click(o),n.find(".brtc-admin-auth-search-user").on("keydown",function(e){13===e.keyCode&&o()}),o(),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(n.find(".brtc-admin-auth-search-user")),t.InputValidator.appendValidationCondition(n.find(".brtc-admin-auth-search-user"))},i.prototype.refreshUserByPatten=function(e){var t,i,a=this,n=this.$addUserContainer.find(".brtc-admin-auth-search-user-list");n.empty(),0===e.length&&n.append('<li class="empty"> No data to display </li>');for(var r=0;r<e.length;r++)t=e[r],(i=$("<li></li>")).attr("user-id",t.id),i.text(t.name+" / "+t.email),i.attr("title",t.name+" / "+t.email),n.append(i);n.find("li").click(function(e){var t=$(this).text(),i=$(this).attr("user-id");i&&a.attachUserToAuth(t,i)}),this.$addUserDialog.find(".brtc-admin-total-add-user-count").text(e.length)},i.prototype.checkAgentInUse=function(t,i,a){e.Admin.Send.getAgentUser(t,a)},i.prototype.attachUserToAuth=function(t,i){for(var a=this,n=this.$addUserContainer.find(".brtc-admin-auth-search-user-authorized-list"),r=this.$userList.find("li"),o=0;o<r.length;o++)if($(r[o]).attr("userId")==i)return void e.VA.Core.Utils.WidgetUtils.openWarningDialog("This user is already added to this agent.",function(){});var d=this.authorizedUserList.indexOf(i);if(d>=0)e.VA.Core.Utils.WidgetUtils.openErrorDialog("This user is already selected.",function(){});else{var s=$('<li><div></div><a class="del"></a></li>');s.attr("user-id",i),s.attr("title",t),s.find("div:first").text(t),n.append(s),s.find("a").click(function(e){$(this).closest("li").remove(),a.authorizedUserList.splice(d,1),a.setUserToAuthCount()}),this.authorizedUserList.push(i),this.setUserToAuthCount()}},i.prototype.setUserToAuthCount=function(){var e=this.$addUserContainer.find(".brtc-admin-auth-search-user-authorized-list").find("li").length;this.$addUserDialog.find(".brtc-admin-total-add-target-user-count").text(" ("+e+")")},i.prototype.createAddUserButtonArea=function(e){var t=this,i=$('<div class="btn_box">    <div class="flt_rt">        <a class="brtc-admin-auth-add-user-cancel">Cancel</a>        <a class="bgcolr brtc-admin-auth-add-user-save">Add</a>    </div></div>');e.append(i),i.find(".brtc-admin-auth-add-user-save").click(function(){for(var e=[],i=t.$addUserContainer.find(".brtc-admin-auth-search-user-authorized-list").find("li"),a=0;a<i.length;a++)e.push({id:$(i[a]).attr("user-id"),label:$(i[a]).text()});t.addToUserList(e),t.$addUserDialog.jqxWindow("close")}),i.find(".brtc-admin-auth-add-user-cancel").click(function(){t.$addUserDialog.jqxWindow("close")})},i.prototype.addToUserList=function(e){for(var t in e)this.addUser(e[t].id)},i.prototype.resetSearchData=function(){this.searchData={agentId:"",activeStart:!0,activeStop:!0}},i.prototype.filteringAgentData=function(t){var i=this;e.Admin.Send.getAllAgents(function(t){var a={localdata:t,datafields:i.datafields,datatype:i.datatype};e.VA.Core.Utils.WidgetUtils.updateGridSource(i.$agentGrid,a),i.agentList=t,i.refreshDataControlButton(),i.$agentGrid.jqxGrid("clearselection");var n=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=all]"),r=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=start]"),o=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=stop]");$(".brtc-admin-agent-search-id").val(""),n.prop("checked",!0),r.prop("checked",!0),o.prop("checked",!0),i.setRowCount()},this.searchData)},e.Admin.AgentManagement=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(e,t){this.parentId=e,this.options=t,this.retrieveParent(),this.createControls()}i.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-auth"),this.$pageList=[],this.createRolePage(),this.createEditRolePage(),this.createRoleInformationPage()},i.prototype.createRolePage=function(){this.$mainRoleContainer=$('<div class="contents design_checkbox brtc-admin-auth-role-main"></div>'),this.$parent.append(this.$mainRoleContainer),this.createRoleSearchArea(),this.createRoleContentsArea(),this.$pageList.push(this.$mainRoleContainer)},i.prototype.showRolePage=function(){var t=this;e.Admin.Send.getPermissionResourceTypeByUserId(t.options.userId,function(e){var i=!1;for(var a in e)if("authorization"===e[a].resource_type){i=!0;break}if(i){var n;t.$mainRoleContainer.show();var r=t.$mainRoleContainer.find(".brtc-admin-auth-role-search-role-label").val(),o=t.$mainRoleContainer.find(".brtc-admin-auth-role-search-user-id").val();""===r.trim()&&""===o.trim()||(n={roleLabel:r,userId:o}),t.refreshRoleData(n)}else window.location.href=window.location.origin+"/ng1123/user"})},i.prototype.createRoleSearchArea=function(){var t=this,i=$('<article>    <h2>Role</h2>    <div>        <table class="tb_st01">            <colgroup>                <col style="width:70px;">                <col style="width:300px;">                <col style="width:70px;">            </colgroup>            <tbody>            <tr>                <th>Role</th>                <td>                    <input class="brtc-admin-auth-role-search-role-label" style="width:98%" type="text" valid-type="type1" maxlength="80" placeholder="Enter role"/>                </td>                <th>User</th>                <td>                    <input class="brtc-admin-auth-role-search-user-id"  style="width:64.5%" type="text" valid-type="type4" maxlength="80" placeholder="Enter user ID"/>                    <div class="brtc-search-button-box role">                       <div class="brtc-float-right">                           <button class="brtc-admin-button search-area clear" value="clear">Clear</button>                           <button class="brtc-admin-button search-area search" value="search">Search</button>                       </div>                   </div>                </td>            </tr>            </tbody>        </table>    <div class="cont_box stmt30 brtc-role-data-area">    </div>    </div></article>');this.$mainRoleContainer.append(i),i.find(".brtc-admin-button.clear").jqxButton({theme:e.VA.Env.Theme}),i.find(".brtc-admin-button.clear").click(function(){i.find(".brtc-admin-auth-role-search-role-label").val(""),i.find(".brtc-admin-auth-role-search-user-id").val(""),t.refreshRoleData()}),i.find(".brtc-admin-button.search").jqxButton({theme:e.VA.Env.Theme}),i.find(".brtc-admin-auth-role-search-role-label").keydown(function(e){if(13==e.keyCode){var a;$(this).trigger("focusout");var n=i.find(".brtc-admin-auth-role-search-role-label").val(),r=i.find(".brtc-admin-auth-role-search-user-id").val();""===n.trim()&&""===r.trim()||(a={roleLabel:n,userId:r}),t.refreshRoleData(a)}}),i.find(".brtc-admin-auth-role-search-user-id").keydown(function(e){if(13==e.keyCode){var a;$(this).trigger("focusout");var n=i.find(".brtc-admin-auth-role-search-role-label").val(),r=i.find(".brtc-admin-auth-role-search-user-id").val();""===n.trim()&&""===r.trim()||(a={roleLabel:n,userId:r}),t.refreshRoleData(a)}}),i.find(".brtc-admin-button.search").click(function(){var e,a=i.find(".brtc-admin-auth-role-search-role-label").val(),n=i.find(".brtc-admin-auth-role-search-user-id").val();""===a.trim()&&""===n.trim()||(e={roleLabel:a,userId:n}),t.refreshRoleData(e)}),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(i.find(".brtc-admin-auth-role-search-role-label")),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(i.find(".brtc-admin-auth-role-search-user-id"))},i.prototype.createRoleContentsArea=function(){var e=this.$parent.find(".brtc-role-data-area");this.createSumArea(e),this.createDataControlArea(e)},i.prototype.createSumArea=function(t){var i=this,a=$('<div class="tb_view_st">   <span>Total<strong class="brtc-admin-total-role-count"></strong></span>   <div class="brtc-admin-dropdown-count"></div></div>');t.append(a);a.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),a.find(".brtc-admin-dropdown-count").on("select",function(t){var n=t.args;null!=a.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index)&&e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$roleGrid)})},i.prototype.createDataControlArea=function(e){var t=this,i=$('<div class="tb_choibox btn_box ctr01 choinone brtc-admin-choice"></div><div class="tb_headview"></div>');e.append(i),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){t.$roleGrid.jqxGrid("clearselection")}),this.createDataGrid($(".tb_headview"))},i.prototype.createDataGrid=function(i){var a=this;this.$roleGrid=$('<div class="brtc-admin-body-grid-role"></div>'),i.append(this.$roleGrid),this.$roleGrid.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:560,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,columnsresize:!1,autoheight:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columns:[{text:"Role",datafield:"role_label",width:"30%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"brtc-grid-cell-bold",cellsrenderer:a.roleCellRenderer},{text:"Category",datafield:"role_category",width:"20%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Description",datafield:"description",width:"auto",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft}]}),this.$roleGrid.on("pagechanged",function(t){e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.$roleGrid.on("rowclick",function(e){a.value="detail",a.showRoleInformationPage(a.$roleGrid.jqxGrid("getrowdata",e.args.rowindex))}),this.refreshRoleData()},i.prototype.roleCellRenderer=function(e,t,i){var a=$('<div class="brtc-admin-body-grid-role-cell"></div>');return a.text(i),$("<div>").append(a.clone()).html()},i.prototype.refreshRoleData=function(t){var i=this,a=function(t){var a=-1;for(var n in t)"role_10103"===t[n].role_id&&(a=n);var r=$.extend(!0,[],t);a>-1&&r.splice(a,1);var o={localdata:r,datafields:[{name:"role_label",type:"string"},{name:"role_category",type:"string"},{name:"description",type:"string"},{name:"role_id",type:"string"}],datatype:"array"};e.VA.Core.Utils.WidgetUtils.updateGridSource(i.$roleGrid,o),i.$mainRoleContainer.find(".brtc-admin-total-role-count").text(r.length)};t?e.Admin.Send.getRoleByPatten(t,a):e.Admin.Send.getAllRole(a)},i.prototype.createDeleteConfirmDialog=function(){var i=this,a={title:"",contentText:"Are you sure you want to delete?",close:function(t){if(t.OK){var a=i.$roleGrid.jqxGrid("getselectedrowindexes"),n=[];for(var r in a){var o=i.$roleGrid.jqxGrid("getrowdata",a[r]);n.push(o.role_id)}e.Admin.Send.deleteRole({roleIdList:n},function(){i.checkDialog("Success","( "+a.length+" ) Role(s) has been deleted."),i.refreshRoleData()})}},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},i.prototype.createRoleInformationPage=function(){this.$detailRoleContainer=$('<div class="contents design_checkbox brtc-admin-auth-role-detail"></div>'),this.$parent.append(this.$detailRoleContainer);var e=$('    <article>        <h2 class="brtc-admin-detail-role-contents-area-title">Role Information</h2>        <div class="brtc-admin-detail-role-contents-area">        </div>    </article>');this.$detailRoleContainer.append(e),this.createCommonInfoArea(e.find(".brtc-admin-detail-role-contents-area")),this.createUserInfoArea(e.find(".brtc-admin-detail-role-contents-area")),this.createPermissionInfoArea(e.find(".brtc-admin-detail-role-contents-area")),this.createDetailRoleButtonArea(e.find(".brtc-admin-detail-role-contents-area")),this.$pageList.push(this.$detailRoleContainer),this.$detailRoleContainer.hide()},i.prototype.showRoleInformationPage=function(e){this.setRoleInfo(),this.roleData=e,this.selectedRoleId=e.role_id,this.hideAllPage(),this.$detailRoleContainer.show(),this.setEditRoleCommonInfo(this.$detailRoleContainer,e),this.getPermissionListByRoleId(this.$detailRoleContainer.find(".brtc-admin-body-grid-permission")),this.getUserListByRoleid(this.$detailRoleContainer.find(".brtc-admin-body-grid-user-list"))},i.prototype.createDetailRoleButtonArea=function(e){var t=this,i=$('<div class="brtc-button-box">   <div class="brtc-float-left">       <button class="brtc-admin-button detail-user list" style="cursor: pointer" value="list">List</button>   </div>    <div class="brtc-float-right">       <button class="brtc-admin-button detail-user modify" style="cursor: pointer" value="modify" CRUD="U">Edit</button>    </div></div>');e.append(i),i.find(".list").click(function(){t.hideAllPage(),t.showRolePage()}),i.find(".modify").click(function(){t.hideAllPage(),t.showEditRolePage(t.roleData)})},i.prototype.createUserInfoArea=function(e){var t=$('<div class="brtc-admin-user-list-container">   <div class="brtc-admin-auth-add-role-user-list"></div></div>');e.find(".brtc-admin-auth-add-role-user-area").append(t),this.createUserListArea(t.find(".brtc-admin-auth-add-role-user-list"))},i.prototype.createUserListArea=function(i){var a=$('<div class="brtc-admin-body-grid-user-list"></div>');i.append(a),a.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:"100%",columnsheight:34,rowsheight:32,pageable:!1,filterable:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columns:[{text:"User",datafield:"label",width:"100%",align:"center",cellsrenderer:t.WidgetUtils.cellRendererLeft}]})},i.prototype.createEditRolePage=function(){this.$editRoleContainer=$('<div class="contents design_checkbox brtc-admin-auth-role-edit"></div>'),this.$parent.append(this.$editRoleContainer);var e=$('    <article>        <h2 class="brtc-admin-add-role-contents-area-title">Role Information</h2>        <div class="brtc-admin-add-role-contents-area">        </div>    </article>');this.$editRoleContainer.append(e),this.createCommonInfoArea(e.find(".brtc-admin-add-role-contents-area")),this.createEditUserInfoArea(e.find(".brtc-admin-add-role-contents-area")),this.createPermissionInfoArea(e.find(".brtc-admin-add-role-contents-area")),this.createButtonArea(e.find(".brtc-admin-add-role-contents-area")),this.$pageList.push(this.$editRoleContainer),this.$editRoleContainer.hide()},i.prototype.showEditRolePage=function(e){this.addRolePageType="edit",this.$editRoleContainer.find(".brtc-admin-add-role-contents-area-title").text("Edit Role"),this.editTargetRoleId=e.role_id,this.$editRoleContainer.show(),this.setEditRoleCommonInfo(this.$editRoleContainer,e),this.getPermissionListByRoleId(this.$editRoleContainer.find(".brtc-admin-body-grid-permission")),this.getUserListByRoleid(this.$editRoleContainer.find(".brtc-admin-body-grid-add-user")),this.$userGrid.jqxGrid("getrows").length>0&&this.$userGrid.jqxGrid("clearselection")},i.prototype.setEditRoleCommonInfo=function(e,t){e.find("#newRoleLabel").val(t.role_label),e.find("#newRoleCategory").val(t.role_category),e.find("#newRoleDescription").val(t.description)},i.prototype.setRoleInfo=function(){},i.prototype.getUserListByRoleid=function(t){var i=this;e.Admin.Send.getUserByRole(this.selectedRoleId,function(e){i.refreshUserList(e,t)})},i.prototype.createCommonInfoArea=function(e){var t=$('<table class="tb_st03 linetru">    <colgroup>        <col style="width:132px;">        <col style="width:318px;">        <col style="width:90px;">        <col style="width:330px;">    </colgroup>    <tbody>    <tr>        <th colspan="4">Common Role Information</th>    </tr>    <tr>        <th>Label</th>        <td class="permission" colspan="3">            <input type="text" id="newRoleLabel" disabled="disabled">        </td>    </tr>    <tr>        <th>Role Category</th>        <td class="permission"colspan="3">            <input type="text" id="newRoleCategory" disabled="disabled">        </td>    </tr>    <tr>        <th>Description</th>        <td class="permission"colspan="3">            <textarea id="newRoleDescription" disabled="disabled"></textarea>        </td>    </tr>    <tr>        <td colspan="2" class="brtc-admin-auth-add-role-user-area">            <strong>User List</strong>        </td>        <td colspan="2" class="brtc-admin-auth-add-role-permission-area">            <strong>Permission List</strong>        </td>    </tr>    </tbody></table>');e.append(t)},i.prototype.createEditUserInfoArea=function(e){var t=$('<div class="brtc-admin-user-list-container">            <div class="brtc-admin-user-control-area">            </div>            <div class="brtc-admin-auth-add-role-user-list"></div></div>');e.find(".brtc-admin-auth-add-role-user-area").append(t),this.createEditUserControlArea(t.find(".brtc-admin-user-control-area")),this.createEditUserListArea(t.find(".brtc-admin-auth-add-role-user-list"))},i.prototype.createEditUserControlArea=function(t){var i=this,a=$('<div class="tb_choibox btn_box ctr01 choinone brtc-admin-choice role">   <div class="ipstc brtc-admin-selected">       <input type="checkbox" id="cc1" value=""/>       <label for="cc1"><b>1</b> Row(s) selected.</label>   </div>   <div class="brtc-float-left active">       <button class="brtc-admin-button add" value="add" CRUD="C">Add</button>       <button class="brtc-admin-button delete" value="delete" CRUD="D">Delete</button>   </div></div>');t.append(a),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){i.$userGrid.jqxGrid("clearselection")}),a.find(".add").jqxButton({theme:e.VA.Env.Theme}),a.find(".add").on("click",function(){var e=i.$editRoleContainer.find(".brtc-admin-body-grid-add-user").jqxGrid("getrows");i.showAddUserDialog(e)}),a.find(".delete").jqxButton({theme:e.VA.Env.Theme,disabled:!0}),a.find(".delete").on("click",function(){for(var e=i.$userGrid.jqxGrid("getselectedrowindexes"),t=[],a=0;a<e.length;a++)t.push(i.$userGrid.jqxGrid("getrowid",e[a]));t.sort(function(e,t){return e-t});for(var n=e.length-1;n>=0;n--)i.$userGrid.jqxGrid("deleterow",t[n]);i.$userGrid.jqxGrid("clearselection")})},i.prototype.refreshDataControlButton=function(){var e=this.$userGrid.jqxGrid("getselectedrowindexes"),t=this.$mainControl.find(".brtc-admin-choice");if(e.length>1){var i=!1;for(var a in e){if(void 0!==(n=this.$userGrid.jqxGrid("getrowdata",e[a]))&&"Administrator"===n.name){i=!0;break}}t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),i?t.find(".brtc-admin-button.delete").hide():t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0)}else if(0===e.length)t.removeClass("active"),t.find(".brtc-admin-button.add").show(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!0}),t.find(".brtc-admin-selected").hide(),t.find(".brtc-admin-selected").find("b:first").hide();else{var n;t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0),void 0!==(n=this.$userGrid.jqxGrid("getrowdata",e[0]))&&"Administrator"===n.name&&t.find(".brtc-admin-button.delete").hide()}},i.prototype.createEditUserListArea=function(i){var a=this,n=$('<div class="brtc-admin-body-grid-add-user"></div>');this.$userGrid=n,i.append(n),n.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:"100%",columnsheight:34,rowsheight:32,pageable:!1,filterable:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,selectionmode:"checkbox",columns:[{text:"User",datafield:"label",width:"92%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft}]}),n.on("rowselect",function(e){a.refreshDataControlButton()}),n.on("rowunselect",function(e){a.refreshDataControlButton()})},i.prototype.refreshUserList=function(e,t){for(var i=0;i<e.length;i++)e[i].label=e[i].label||e[i].name+" / "+e[i].email,e[i].id=e[i].id||e[i].user_id;var a={localdata:e,datafields:[{name:"label",type:"string"},{name:"id",type:"string"},{name:"email",type:"string"},{name:"name",type:"string"}],datatype:"array"},n=new $.jqx.dataAdapter(a);t.jqxGrid("source",n)},i.prototype.addToUserList=function(e){for(var t,i=this.$userGrid.jqxGrid("getrows"),a=[],n=0;n<i.length;n++)a.push(i[n].id);for(var r=0;r<e.length;r++)t=e[r],a.indexOf(t.id)<0&&this.$userGrid.jqxGrid("addrow",null,e[r])},i.prototype.createPermissionInfoArea=function(e){var t=$('<div class="brtc-admin-permission-list-container"></div>');e.find(".brtc-admin-auth-add-role-permission-area").append(t),this.createPermissionListArea(t)},i.prototype.createPermissionListArea=function(i){this.$addPermissionList=$('<div class="brtc-admin-body-grid-permission"></div>'),i.append(this.$addPermissionList),this.$addPermissionList.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:"100%",columnsheight:34,rowsheight:32,pageable:!1,filterable:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columns:[{text:"Permission",datafield:"description",width:"60%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft},{text:"Type",datafield:"resource_type",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft}]})},i.prototype.getPermissionListByRoleId=function(t){e.Admin.Send.getPermissionByRole(this.selectedRoleId,function(e){var i={localdata:e,datafields:[{name:"description",type:"string"},{name:"resource_type",type:"string"}],datatype:"array"},a=new $.jqx.dataAdapter(i);t.jqxGrid("source",a),t.jqxGrid("clearselection")})},i.prototype.createButtonArea=function(e){var t=this,i=$('<div class="btn_box">    <div class="flt_rt">        <a class="brtc-admin-auth-add-role-cancel">Cancel</a>        <a class="bgcolr brtc-admin-auth-add-role-save">Save</a>    </div></div>');e.append(i),i.find(".brtc-admin-auth-add-role-save").click(t.createAddOrEditConfirmDialog.bind(t)),i.find(".brtc-admin-auth-add-role-cancel").click(function(){t.hideAllPage(),t.showRolePage()})},i.prototype.createAddOrEditConfirmDialog=function(){var i,a,n,r,o,d=this,s=[],c=[];if(r=this.$editRoleContainer.find("#newRoleLabel").val(),n=this.$editRoleContainer.find("#newRoleCategory").val(),o=this.$editRoleContainer.find("#newRoleDescription").val(),""!==r.trim()){this.$editRoleContainer.find("#newRoleLabel").css("border-color","#ffffff");var l=function(t){if(t.OK){for(var l in a=d.$addPermissionList.jqxGrid("getselectedrowindexes")){var u=d.$addPermissionList.jqxGrid("getrowdata",a[l]);void 0!==u&&c.push(u.permission_id)}i=d.$editRoleContainer.find(".brtc-admin-body-grid-add-user").jqxGrid("getrows");for(var p=0;p<i.length;p++)s.push(i[p].id);var h;h={roleId:d.editTargetRoleId,roleCategory:n,roleLabel:r,roleDescription:o,permissionIdList:c,userIdList:s},e.Admin.Send.editRole(h,function(){d.checkDialog("Success","Role [ "+r+" ] has been updated."),d.hideAllPage(),d.showRolePage()})}},u={};u="edit"===d.addRolePageType?{title:"",contentText:"Are you sure you want to update?",close:l,isCancel:!0}:{title:"",contentText:"Are you sure you want to add?",close:l,isCancel:!0},t.WidgetUtils.createAdminConfirmDialog(this.$parent,u)}else this.$editRoleContainer.find("#newRoleLabel").css("border-color","#ea3539")},i.prototype.showAddUserDialog=function(){var t=this;this.authorizedUserList=[],this.$addUserDialog=$('<div class="brtc-admin-auth-add-user-dialog">   <div><strong>Add user</strong></div>   <div class="pop_view design_checkbox brtc-admin-auth-add-user"></div></div>'),this.$parent.append(this.$addUserDialog),this.$addUserContainer=this.$addUserDialog.find(".brtc-admin-auth-add-user"),this.$addUserDialog.append(this.$addUserContainer);this.$addUserDialog.jqxWindow({theme:e.VA.Env.Theme,showCollapseButton:!0,height:540,width:800,isModal:!0,resizable:!1,initContent:function(){t.createAddUserArea.call(t,t.$addUserContainer),t.createAddUserButtonArea.call(t,t.$addUserContainer)}}),this.$addUserDialog.on("close",function(){this.$addUserDialog.jqxWindow("destroy"),this.$addUserDialog.remove()}.bind(t))},i.prototype.createAddUserArea=function(t){var i=this,a=$('<div class="b_cont_0102">    <div class="srch_tp" style="width:100% !important;">        <div class="srch_ip">            <input type="text" class="brtc-admin-auth-search-user" valid-type="type4" maxlength="80" placeholder="Enter user">                       <button class="brtc-admin-button search-area search" value="search" >Search</button>        </div>    </div>    <div class="b_cont_0101">        <strong>Total <b class="brtc-admin-total-add-user-count">54</b></strong>        <ul class="brtc-admin-auth-search-user-list">           <li> No Data To display </li>        </ul>        <strong>Target List<b class="brtc-admin-total-add-target-user-count"></b></strong>        <ul class="brtc-admin-auth-search-user-authorized-list">        </ul>    </div></div>');t.append(a);var n=function(e){i.refreshUserByPatten.call(i,e)},r=function(){var t=a.find(".brtc-admin-auth-search-user").val()||"";t.trim()?e.Admin.Send.getUsersByPatten(n,t):e.Admin.Send.getAllUsers(n)};this.$filterInput=a.find(".brtc-admin-auth-search-user"),this.$filterInput.keydown(function(e){13==e.keyCode&&r()}),a.find(".brtc-admin-button.search").jqxButton({theme:e.VA.Env.Theme}),a.find(".brtc-admin-button.search").click(function(){r()}),r(),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(a.find(".brtc-admin-auth-search-user"))},i.prototype.refreshUserByPatten=function(e){var t,i,a=this,n=this.$addUserContainer.find(".brtc-admin-auth-search-user-list");n.empty(),0===e.length&&n.append("<li> No Data To display </li>");for(var r=0;r<e.length;r++)t=e[r],(i=$("<li></li>")).attr("user-id",t.id),i.text(t.name+" / "+t.email),i.attr("title",t.name+" / "+t.email),n.append(i);n.find("li").click(function(e){var t=$(this).text(),i=$(this).attr("user-id");i&&a.attachUserToAuth(t,i)}),this.$addUserDialog.find(".brtc-admin-total-add-user-count").text(e.length)},i.prototype.attachUserToAuth=function(t,i){var a=this,n=this.$addUserContainer.find(".brtc-admin-auth-search-user-authorized-list"),r=this.$userGrid.jqxGrid("getrows"),o=$.map(r,function(e){return e.id});if($.inArray(i,o)>=0)e.VA.Core.Utils.WidgetUtils.openWarningDialog("This user is already added to this role.",function(){});else{var d=this.authorizedUserList.indexOf(i);if(d>=0)e.VA.Core.Utils.WidgetUtils.openErrorDialog("This user is already selected.",function(){});else{var s=$('<li><div></div><a class="del"></a></li>');s.attr("user-id",i),s.attr("title",t),s.find("div:first").text(t),n.append(s),s.find("a").click(function(e){$(this).closest("li").remove(),a.authorizedUserList.splice(d,1),a.setUserToAuthCount()}),this.authorizedUserList.push(i),this.setUserToAuthCount()}}},i.prototype.setUserToAuthCount=function(){var e=this.$addUserContainer.find(".brtc-admin-auth-search-user-authorized-list").find("li").length;this.$addUserDialog.find(".brtc-admin-total-add-target-user-count").text(" ("+e+")")},i.prototype.createAddUserButtonArea=function(e){var t=this,i=$('<div class="btn_box">    <div class="flt_rt">        <a class="brtc-admin-auth-add-user-cancel">Cancel</a>        <a class="bgcolr brtc-admin-auth-add-user-save">Add</a>    </div></div>');e.append(i),i.find(".brtc-admin-auth-add-user-save").click(function(){for(var e=[],i=t.$addUserContainer.find(".brtc-admin-auth-search-user-authorized-list").find("li"),a=0;a<i.length;a++)e.push({id:$(i[a]).attr("user-id"),label:$(i[a]).text()});t.addToUserList(e),t.$addUserDialog.jqxWindow("close")}),i.find(".brtc-admin-auth-add-user-cancel").click(function(){t.$addUserDialog.jqxWindow("close")})},i.prototype.hideAllPage=function(){for(var e=0;e<this.$pageList.length;e++)this.$pageList[e].hide()},i.prototype.checkDialog=function(e,i){var a={title:e,contentText:i};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},e.Admin.AuthorizationManagement=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(t,i){this.parentId=t,this.options=i,e.VA.Env.Session.datasourceId=i.datasourceId,this.retrieveParent(),this.createControls()}i.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-datasource"),this.createDatasourceListArea(),this.createDetailDatasourcePerspective(),this.createAddDatasourcePerspective(),this.createModifyDatasourcePerspective(),this.changePerspective()},i.prototype.createDatasourceListArea=function(){this.$datasourceListArea=$('<article>   <h2>Datasource</h2>   <div class="brtc-admin-header-form">   </div>   <div class="cont_box stmt30 brtc-admin-data-area"></div></article>'),this.$mainControl.append(this.$datasourceListArea),this.createHeaderForm(this.$datasourceListArea.find(".brtc-admin-header-form")),this.createDataArea(this.$datasourceListArea.find(".brtc-admin-data-area"))},i.prototype.createSumArea=function(t){var i=this,a=$('<div class="tb_view_st">   <span>Total<strong class="brtc-admin-total-count"></strong></span>   <div class="brtc-admin-dropdown-count"></div></div>');t.append(a);a.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),a.find(".brtc-admin-dropdown-count").on("select",function(t){var n=t.args,r=a.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index);null!=r&&(i.$datasourceGrid.jqxGrid({pagesize:r.value}),e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$datasourceGrid))})},i.prototype.createDataGrid=function(i){var a=this;this.$datasourceGrid=$('<div class="brtc-admin-body-grid-datasources"></div>'),i.append(this.$datasourceGrid),this.$datasourceGrid.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:560,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columnsresize:!1,selectionmode:"checkbox",autoheight:!0,columns:[{text:"Datasource Name",datafield:"datasourceName",width:"150px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"brtc-grid-cell-bold",cellsrenderer:t.WidgetUtils.cellRendererLeft},{text:"Datasource Type",datafield:"datasourceType",width:"120px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Deploy",datafield:"deploy",width:"150px",align:"center",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"IP",datafield:"ip",width:"140px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Port",datafield:"port",width:"80px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"DB Type",datafield:"dbType",width:"140px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"DB Name",datafield:"dbName",width:"140px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"User Name",datafield:"userName",width:"130px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"password",datafield:"password",width:"140px",align:"center",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer}]}),this.$datasourceGrid.on("rowselect",function(e){a.refreshDataControlButton()}),this.$datasourceGrid.on("cellclick",function(e){0!==e.args.columnindex&&(this.value="detail",a.changePerspective(this),a.setDetailDatasourceInfo(a.$datasourceGrid.jqxGrid("getrowdata",e.args.rowindex)))}),this.$datasourceGrid.on("rowunselect",function(e){a.refreshDataControlButton()}),this.$datasourceGrid.on("pagechanged",function(t){e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.refreshDatasourceData()},i.prototype.createDataControlArea=function(t){var i=this,a=$('<div class="tb_choibox btn_box ctr01 choinone brtc-admin-choice">   <div class="ipstc brtc-admin-selected">       <input type="checkbox" id="cc1" value=""/>       <label for="cc1"><b>1</b> Row(s) selected.</label>   </div>   <div class="brtc-float-left active">       <button class="brtc-admin-button add" value="add" CRUD="C">Add</button>       <button class="brtc-admin-button delete" value="delete" CRUD="D">Delete</button>   </div>   <div class="brtc-float-right-refresh">       <button class="brtc-admin-button reload" value="reload"><span class="fa fa-refresh"></span></button>   </div></div><div class="tb_choinone"></div><div class="tb_headview"></div>');t.append(a),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){i.$datasourceGrid.jqxGrid("clearselection")}),a.find(".add").jqxButton({theme:e.VA.Env.Theme}),a.find(".add").on("click",function(){i.changePerspective(this)}),a.find(".delete").jqxButton({theme:e.VA.Env.Theme}),a.find(".delete").on("click",function(){var e=i.$datasourceGrid.jqxGrid("getselectedrowindexes"),t=[];if(e.length>0){for(var a in e){var n=i.$datasourceGrid.jqxGrid("getrowdata",e[a]);t.push("["+n.datasourceName+"]")}i.createDeleteConfirmDialog(t)}}),a.find(".reload").jqxButton({theme:e.VA.Env.Theme}),a.find(".reload").on("click",function(){i.refreshDatasourceData()}),this.createDataGrid($(".tb_headview"))},i.prototype.createDataArea=function(e){this.createSumArea(e),this.createDataControlArea(e)},i.prototype.searchDatasource=function(){""===$(".brtc-admin-filter-input").val()?this.$datasourceGrid.jqxGrid("clearfilters"):this.addFilter(),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(this.$datasourceGrid),this.setRowCount()},i.prototype.createHeaderForm=function(t){var i=this,a=$('<table class="brtc-admin-search-table">   <colgroup>      <col style="width:100px;"><col>   </colgroup>   <tbody>       <tr>           <th class="brtc-admin-datasource-label">Datasource</th>           <td>               <input type="text" class="brtc-admin-filter-input" style="width: 606px;margin-top: 2px;" maxlength="200" placeholder="Enter datasource name"/>               <div class="brtc-search-button-box">                   <div class="brtc-float-right">                       <button class="brtc-admin-button search-area clear" style="width:39px;" value="clear">Clear</button>                       <button class="brtc-admin-button search-area search" value="search">Search</button>                   </div>               </div>           </td>       </tr>   </tbody></table>');t.append(a),this.$filterInput=a.find(".brtc-admin-filter-input"),a.find(".brtc-admin-button.clear").jqxButton({theme:e.VA.Env.Theme}),this.$filterInput.keydown(function(e){13==e.keyCode&&i.searchDatasource()}),a.find(".brtc-admin-button.clear").click(function(){i.$filterInput.val(""),i.$datasourceGrid.jqxGrid("clearfilters"),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(i.$datasourceGrid),i.setRowCount()}),a.find(".brtc-admin-button.search").jqxButton({theme:e.VA.Env.Theme}),a.find(".brtc-admin-button.search").click(function(){i.searchDatasource()}),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(this.$filterInput)},i.prototype.createDeleteConfirmDialog=function(i){var a=this,n={title:"",contentText:void 0===i?"Are you sure you want to delete?":"Are you sure you want to delete "+i.length+" selected datasources?",close:function(t){if(t.OK)if(a.selectedDetailDatasource){var i=function(){a.checkDialog("Success","Datasource has been deleted."),a.changePerspective(),a.refreshDatasourceData()};e.Admin.Send.deleteDatasource(a.selectedDetailDatasource.datasourceName,i)}else{var n=a.$datasourceGrid.jqxGrid("getselectedrowindexes"),r=0,o=[];for(var d in n){var s=a.$datasourceGrid.jqxGrid("getrowdata",n[d]);o.push("["+s.datasourceName+"]"),i=function(){++r===n.length&&(a.checkDialog("Success","("+o.length+") Datasource(s) has been deleted."),a.changePerspective(),a.refreshDatasourceData())},e.Admin.Send.deleteDatasource(s.datasourceName,i)}}},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,n)},i.prototype.addFilter=function(){this.$filterInput.trigger("focusout");var e=new $.jqx.filter,t=this.$filterInput.val(),i=e.createfilter("stringfilter",t,"contains");e.addfilter(1,i),this.$datasourceGrid.jqxGrid("addfilter","datasourceName",e),this.$datasourceGrid.jqxGrid("applyfilters"),this.setRowCount()},i.prototype.setRowCount=function(){var t=this.$datasourceGrid.jqxGrid("getrows");this.$mainControl.find(".brtc-admin-total-count").text(t.length),e.VA.Core.Utils.WidgetUtils.updatePageButton(this.$datasourceGrid)},i.prototype.changePerspective=function(e){e?"add"===e.value?(this.$addDatasourceArea.show(),this.$detailDatasourceArea.hide(),this.$modifyDatasourceArea.hide(),this.$datasourceListArea.hide()):"modify"===e.value?(this.$addDatasourceArea.hide(),this.$detailDatasourceArea.hide(),this.$modifyDatasourceArea.show(),this.$datasourceListArea.hide()):"detail"===e.value&&(this.$addDatasourceArea.hide(),this.$detailDatasourceArea.show(),this.$modifyDatasourceArea.hide(),this.$datasourceListArea.hide()):(this.$addDatasourceArea.hide(),this.$detailDatasourceArea.hide(),this.$modifyDatasourceArea.hide(),this.$datasourceListArea.show())},i.prototype.refreshDataControlButton=function(){var e=this.$datasourceGrid.jqxGrid("getselectedrowindexes"),t=this.$mainControl.find(".brtc-admin-choice");e.length>1?(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0)):0===e.length?(t.removeClass("active"),t.find(".brtc-admin-button.add").show(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!0}),t.find(".brtc-admin-selected").hide(),t.find(".brtc-admin-selected").find("b:first").hide()):(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0))},i.prototype.refreshDatasourceData=function(){var t=this;e.Admin.Send.getAllDatasources(function(i){t.$filterInput.val("");var a={localdata:i,datafields:[{name:"datasourceName",type:"string"},{name:"datasourceType",type:"string"},{name:"deploy",type:"string"},{name:"ip",type:"string"},{name:"port",type:"number"},{name:"dbType",type:"string"},{name:"dbName",type:"string"},{name:"userName",type:"string"},{name:"password",type:"string"}],datatype:"array"};e.VA.Core.Utils.WidgetUtils.updateGridSource(t.$datasourceGrid,a),t.$mainControl.find(".brtc-admin-total-count").text(i.length),t.refreshDataControlButton(),t.$datasourceGrid.jqxGrid("getselectedrowindexes").length>0&&t.$datasourceGrid.jqxGrid("clearselection"),t.selectedDetailDatasource=void 0})},i.prototype.createDetailDatasourcePerspective=function(){this.$detailDatasourceArea=$('<article class="brtc-admin-detail-datasource">   <h2>Datasource Information Detail</h2>   <div class="brtc-admin-detail-datasource-area"></div></article>'),this.$mainControl.append(this.$detailDatasourceArea),this.createDetailDatasourceFormGroup()},i.prototype.createDetailDatasourceFormGroup=function(){var i=this,a=this.$detailDatasourceArea.find(".brtc-admin-detail-datasource-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">   <div class="brtc-float-left">       <button class="brtc-admin-button detail-datasource list" value="list">List</button>   </div>    <div class="brtc-float-right">       <button class="brtc-admin-button detail-datasource delete" value="delete" CRUD="D">Delete</button>       <button class="brtc-admin-button detail-datasource modify" value="modify" CRUD="U">Edit</button>    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <input type="text" name="name" class="brtc-admin-input detail-datasource-name" disabled required maxlength="40"></td>'),d=t.WidgetUtils.createTableRow("Datasource Name",o,!0);r.append(d);var s=$('<td colspan="3">   <div class="brtc-admin-dropdown detail-datasource-type"></div></td>'),c=t.WidgetUtils.createTableRow("Datasource Type",s,!0);r.append(c),s.find(".brtc-admin-dropdown.detail-datasource-type").jqxDropDownList({theme:e.VA.Env.Theme,source:["RDB"],disabled:!0});var l=$('<td colspan="3">   <input type="text" name="ip" class="brtc-admin-input detail-datasource-ip" disabled maxlength="80" ></td>'),u=t.WidgetUtils.createTableRow("IP",l,!0);r.append(u);var p=$('<td colspan="3">   <input type="text" name="port" class="brtc-admin-input detail-datasource-port" disabled maxlength="80" ></td>'),h=t.WidgetUtils.createTableRow("Port",p,!0);r.append(h);var m=$('<td colspan="3">   <div class="brtc-admin-dropdown detail-datasource-dbtype"></div></td>'),f=t.WidgetUtils.createTableRow("DB Type",m,!0);r.append(f);var b=m.find(".brtc-admin-dropdown.detail-datasource-dbtype");b.jqxDropDownList({theme:e.VA.Env.Theme,disabled:!0});$.ajax({url:"api/admin/v2/datasources/dbtype",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){b.jqxDropDownList({source:e})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)});var g=$('<td colspan="3">   <input type="text" name="dbname" class="brtc-admin-input detail-datasource-dbname" disabled maxlength="80" ></td>'),v=t.WidgetUtils.createTableRow("DB Name",g,!0);r.append(v);var y=$('<td colspan="3">   <input type="text" name="username" class="brtc-admin-input detail-datasource-username" disabled maxlength="80" ></td>'),x=t.WidgetUtils.createTableRow("User Name",y,!0);r.append(x);var w=$('<td colspan="3">   <input type="password" name="password" class="brtc-admin-input detail-datasource-password" disabled maxlength="80" ></td>'),D=t.WidgetUtils.createTableRow("Password",w,!0);r.append(D),n.find(".brtc-admin-input.detail-datasource-name").jqxInput({theme:e.VA.Env.Theme,disabled:!0});var A=a.find(".brtc-admin-button.detail-datasource.list");A.jqxButton({theme:e.VA.Env.Theme}),A.on("click",function(){i.changePerspective(),i.selectedDetailDatasource=void 0});var C=a.find(".brtc-admin-button.detail-datasource.delete");C.jqxButton({theme:e.VA.Env.Theme}),C.on("click",function(){i.createDeleteConfirmDialog()});var U=a.find(".brtc-admin-button.detail-datasource.modify");U.jqxButton({theme:e.VA.Env.Theme}),U.on("click",function(){i.changePerspective(this),i.setModifyDatasourceInfo(i.selectedDetailDatasource)})},i.prototype.setDetailDatasourceInfo=function(e){var t=this.$mainControl.find(".brtc-admin-input.detail-datasource-name");$(t).val(e.datasourceName),$(t).prop("title",e.datasourceName);var i=this.$mainControl.find(".brtc-admin-dropdown.detail-datasource-type");$(i).val(e.datasourceType),$(i).prop("title",e.datasourceType);var a=this.$mainControl.find(".brtc-admin-input.detail-datasource-ip");$(a).val(e.ip),$(a).prop("title",e.ip);var n=this.$mainControl.find(".brtc-admin-input.detail-datasource-port");$(n).val(e.port),$(n).prop("title",e.port);var r=this.$mainControl.find(".brtc-admin-dropdown.detail-datasource-dbtype");$(r).val(e.dbType),$(r).prop("title",e.dbType);var o=this.$mainControl.find(".brtc-admin-input.detail-datasource-dbname");$(o).val(e.dbName),$(o).prop("title",e.dbName);var d=this.$mainControl.find(".brtc-admin-input.detail-datasource-username");$(d).val(e.userName),$(d).prop("title",e.userName);var s=this.$mainControl.find(".brtc-admin-input.detail-datasource-password");$(s).val(e.password),this.selectedDetailDatasource=e},i.prototype.createAddDatasourcePerspective=function(){this.$addDatasourceArea=$('<article class="brtc-admin-add-datasource">   <h2>Add Datasource</h2>   <div class="brtc-admin-add-datasource-area"></div></article>'),this.$mainControl.append(this.$addDatasourceArea),this.createAddDatasourceFormGroup()},i.prototype.createAddDatasourceFormGroup=function(){var i=this,a=this.$addDatasourceArea.find(".brtc-admin-add-datasource-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">    <div class="brtc-float-right">       <button class="brtc-admin-button add-datasource cancel" value="cancel">Cancel</button>       <button class="brtc-admin-button add-datasource save" value="save">Save</button>    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <input type="text" name="name" class="brtc-admin-input add-datasource-name"  valid-type="type4" maxlength="68" placeholder="Enter datasource name" required></td>'),d=t.WidgetUtils.createTableRow("Datasource Name",o,!0);r.append(d),t.InputValidator.appendValidationCondition(o.find(".add-datasource-name"));var s=$('<td colspan="3">   <div class="brtc-admin-dropdown add-datasource-type"></div></td>'),c=t.WidgetUtils.createTableRow("Datasource Type",s,!0);r.append(c),s.find(".brtc-admin-dropdown.add-datasource-type").jqxDropDownList({theme:e.VA.Env.Theme,source:["RDB"],dropDownHeight:120,placeHolder:"Datasource Type"});var l=$('<td colspan="3">   <input type="text" name="ip" class="brtc-admin-input add-datasource-ip" placeholder="Enter server ip" valid-type="type6" maxlength="80" ></td>'),u=t.WidgetUtils.createTableRow("IP",l,!0);r.append(u),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(l.find(".add-datasource-ip"));var p=$('<td colspan="3">   <input type="text" name="port" class="brtc-admin-input add-datasource-port" placeholder="Enter server port" valid-type="type6" maxlength="80" ></td>'),h=t.WidgetUtils.createTableRow("Port",p,!0);r.append(h),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(p.find(".add-datasource-port"));var m=$('<td colspan="3">   <div class="brtc-admin-dropdown add-datasource-dbtype"></div></td>'),f=t.WidgetUtils.createTableRow("DB Type",m,!0);r.append(f);var b=m.find(".brtc-admin-dropdown.add-datasource-dbtype");b.jqxDropDownList({theme:e.VA.Env.Theme,dropDownHeight:120,placeHolder:"DB Type"}),b.on("open",function(){$.ajax({url:"api/admin/v2/datasources/dbtype",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){b.jqxDropDownList({source:e})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})});var g=$('<td colspan="3">   <input type="text" name="dbname" class="brtc-admin-input add-datasource-dbname" placeholder="Enter db name" valid-type="type6" maxlength="80" ></td>'),v=t.WidgetUtils.createTableRow("DB Name",g,!0);r.append(v),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(g.find(".add-datasource-dbname"));var y=$('<td colspan="3">   <input type="text" name="username" class="brtc-admin-input add-datasource-username" placeholder="Enter user name" valid-type="type6" maxlength="80" ></td>'),x=t.WidgetUtils.createTableRow("User Name",y,!0);r.append(x),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(y.find(".add-datasource-username"));var w=$('<td colspan="3">   <input type="password" name="password" class="brtc-admin-input add-datasource-password" placeholder="Enter password" valid-type="type6" maxlength="80" ></td>'),D=t.WidgetUtils.createTableRow("Password",w,!0);r.append(D);var A=o.find(".brtc-admin-input.add-datasource-name"),C=s.find(".brtc-admin-dropdown.add-datasource-type"),U=l.find(".brtc-admin-input.add-datasource-ip"),j=p.find(".brtc-admin-input.add-datasource-port"),T=m.find(".brtc-admin-dropdown.add-datasource-dbtype"),I=g.find(".brtc-admin-input.add-datasource-dbname"),k=y.find(".brtc-admin-input.add-datasource-username"),S=w.find(".brtc-admin-input.add-datasource-password");this.addDatasourceCancelButton=a.find(".brtc-admin-button.add-datasource.cancel"),this.addDatasourceCancelButton.jqxButton({theme:e.VA.Env.Theme}),this.addDatasourceCancelButton.on("click",function(){$(A).val(""),$(C).jqxDropDownList("clearSelection"),$(U).val(""),$(j).val(""),$(T).jqxDropDownList("clearSelection"),$(I).val(""),$(k).val(""),$(S).val(""),i.changePerspective()}),this.addDatasourceSaveButton=a.find(".brtc-admin-button.add-datasource.save"),this.addDatasourceSaveButton.jqxButton({theme:e.VA.Env.Theme}),this.addDatasourceSaveButton.on("click",function(t){var a=/[\u3131-\u314e|\u314f-\u3163|\uac00-\ud7a3]/g,r=$(A).val();if(""===r)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter datasource name."),void n.find(".brtc-admin-input.add-datasource-name").focus();if(a.test(r.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check datasource name format.",function(){r.focus()}),!1;var o=$(C).val();if(""===o)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter datasource type."),void n.find(".brtc-admin-input.add-datasource-type").focus();var d=$(U).val();if(""===d)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter server ip."),void n.find(".brtc-admin-input.add-datasource-ip").focus();if(!/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/.test($(U).val().trim())&&!/^[a-zA-Z0-9-_.]+$/.test($(U).val().trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check ip format.",function(){$(U).focus()}),!1;var s=$(j).val();if(""===s)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter server port."),void n.find(".brtc-admin-input.add-datasource-port").focus();if(Number($(j).val().trim())>65535)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Port number should be under 65535.",function(){$(j).focus()}),!1;if(isNaN($(j).val().trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Port number should be number type.",function(){$(j).focus()}),!1;var c=$(T).val();if(""===c)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter db type."),void n.find(".brtc-admin-input.add-datasource-dbtype").focus();var l=$(I).val();if(""===l)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter db name."),void n.find(".brtc-admin-input.add-datasource-dbname").focus();if(a.test(l.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check db name format.",function(){l.focus()}),!1;var u=$(k).val();if(""===u)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter user name."),void n.find(".brtc-admin-input.add-datasource-username").focus();if(a.test(u.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check user name format.",function(){u.focus()}),!1;var p=$(S).val();if(""===p)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter password."),void n.find(".brtc-admin-input.add-datasource-password").focus();if(a.test(p.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check password format.",function(){p.focus()}),!1;var h={datasourceName:r,datasourceType:o,ip:d,port:s,userName:u,password:p,dbType:c,dbName:l};$.ajax({type:"GET",url:"api/admin/v2/datasources/"+r}).done(function(t){t.datasourceName?e.VA.Core.Utils.WidgetUtils.openErrorDialog("This datasource name already exists.",function(){$(A).focus()}):(e.Admin.Send.addDatasource(h,i.refreshAddData.bind(i)),$(A).val(""),$(C).jqxDropDownList("clearSelection"),$(U).val(""),$(j).val(""),$(T).jqxDropDownList("clearSelection"),$(I).val(""),$(k).val(""),$(S).val(""))})})},i.prototype.refreshAddData=function(e){this.checkDialog("Success","Datasource has been created."),this.changePerspective(),this.refreshDatasourceData()},i.prototype.setModifyDatasourceInfo=function(e){var t=this.$modifyDatasourceArea.find(".brtc-admin-input.modify-datasource-name");$(t).val(e.datasourceName),$(t).prop("title",e.datasourceName);var i=this.$modifyDatasourceArea.find(".brtc-admin-dropdown.modify-datasource-type");$(i).val(e.datasourceType);var a=this.$mainControl.find(".brtc-admin-input.modify-datasource-ip");$(a).val(e.ip);var n=this.$mainControl.find(".brtc-admin-input.modify-datasource-port");$(n).val(e.port);var r=this.$mainControl.find(".brtc-admin-dropdown.modify-datasource-dbtype");$(r).val(e.dbType);var o=this.$mainControl.find(".brtc-admin-input.modify-datasource-dbname");$(o).val(e.dbName);var d=this.$mainControl.find(".brtc-admin-input.modify-datasource-username");$(d).val(e.userName);var s=this.$mainControl.find(".brtc-admin-input.modify-datasource-password");$(s).val(e.password)},i.prototype.createModifyDatasourcePerspective=function(){this.$modifyDatasourceArea=$('<article class="brtc-admin-modify-datasource">   <h2>Edit Datasource Information</h2>   <div class="brtc-admin-modify-datasource-area"></div></article>'),this.$mainControl.append(this.$modifyDatasourceArea),this.createModifyDatasourceFormGroup()},i.prototype.createModifyDatasourceFormGroup=function(){var i=this,a=this.$modifyDatasourceArea.find(".brtc-admin-modify-datasource-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">    <div class="brtc-float-right">       <button class="brtc-admin-button modify-datasource cancel" value="cancel">Cancel</button>       <button class="brtc-admin-button modify-datasource save" value="update">Save</button>    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <input type="text" name="name" class="brtc-admin-input modify-datasource-name" disabled required></td>'),d=t.WidgetUtils.createTableRow("Datasource Name",o,!0);r.append(d);var s=$('<td colspan="3">   <div class="brtc-admin-dropdown modify-datasource-type"></div></td>'),c=t.WidgetUtils.createTableRow("Datasource Type",s,!0);r.append(c),s.find(".brtc-admin-dropdown.modify-datasource-type").jqxDropDownList({theme:e.VA.Env.Theme,source:["RDB"],dropDownHeight:120,placeHolder:"Datasource Type"});var l=$('<td colspan="3">   <input type="text" name="ip" class="brtc-admin-input modify-datasource-ip" placeholder="Enter server ip" valid-type="type6" maxlength="80" ></td>'),u=t.WidgetUtils.createTableRow("IP",l,!0);r.append(u),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(l.find(".modify-datasource-ip"));var p=$('<td colspan="3">   <input type="text" name="port" class="brtc-admin-input modify-datasource-port" placeholder="Enter server port" valid-type="type6" maxlength="80" ></td>'),h=t.WidgetUtils.createTableRow("Port",p,!0);r.append(h),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(p.find(".modify-datasource-port"));var m=$('<td colspan="3">   <div class="brtc-admin-dropdown modify-datasource-dbtype"></div></td>'),f=t.WidgetUtils.createTableRow("DB Type",m,!0);r.append(f);var b=m.find(".brtc-admin-dropdown.modify-datasource-dbtype");b.jqxDropDownList({theme:e.VA.Env.Theme,dropDownHeight:120,placeHolder:"db Type"});$.ajax({url:"api/admin/v2/datasources/dbtype",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){b.jqxDropDownList({source:e})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}),b.on("open",function(){$.ajax({url:"api/admin/v2/datasources/dbtype",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){b.jqxDropDownList({source:e})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})});var g=$('<td colspan="3">   <input type="text" name="dbname" class="brtc-admin-input modify-datasource-dbname" placeholder="Enter db name" valid-type="type6" maxlength="80" ></td>'),v=t.WidgetUtils.createTableRow("DB Name",g,!0);r.append(v),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(g.find(".modify-datasource-dbname"));var y=$('<td colspan="3">   <input type="text" name="username" class="brtc-admin-input modify-datasource-username" placeholder="Enter user name" valid-type="type6" maxlength="80" ></td>'),x=t.WidgetUtils.createTableRow("User Name",y,!0);r.append(x),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(y.find(".modify-datasource-username"));var w=$('<td colspan="3">   <input type="password" name="password" class="brtc-admin-input modify-datasource-password" placeholder="Enter password" valid-type="type6" maxlength="80" ></td>'),D=t.WidgetUtils.createTableRow("Password",w,!0);r.append(D),this.$datasourceNameInput=o.find(".brtc-admin-input.modify-datasource-name"),this.$datasourceTypeInput=s.find(".brtc-admin-dropdown.modify-datasource-type"),this.$ipInput=l.find(".brtc-admin-input.modify-datasource-ip"),this.$portInput=p.find(".brtc-admin-input.modify-datasource-port"),this.$dbTypeInput=m.find(".brtc-admin-dropdown.modify-datasource-dbtype"),this.$dbNameInput=g.find(".brtc-admin-input.modify-datasource-dbname"),this.$userNameInput=y.find(".brtc-admin-input.modify-datasource-username"),this.$passwordInput=w.find(".brtc-admin-input.modify-datasource-password"),this.modifyDatasourceCancelButton=a.find(".brtc-admin-button.modify-datasource.cancel"),this.modifyDatasourceCancelButton.jqxButton({theme:e.VA.Env.Theme}),this.modifyDatasourceCancelButton.on("click",function(){i.changePerspective()}),this.modifyDatasourceSaveButton=a.find(".brtc-admin-button.modify-datasource.save"),this.modifyDatasourceSaveButton.jqxButton({theme:e.VA.Env.Theme}),this.modifyDatasourceSaveButton.on("click",function(t){var a=/[\u3131-\u314e|\u314f-\u3163|\uac00-\ud7a3]/g,r=$(i.$datasourceNameInput).val(),o=$(i.$datasourceTypeInput).val();if(""===o)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter datasource type."),void n.find(".brtc-admin-input.modify-datasource-type").focus();var d=$(i.$ipInput).val();if(""===d)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter server ip."),void n.find(".brtc-admin-input.modify-datasource-ip").focus();if(!/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/.test(d.trim())&&!/^[a-zA-Z0-9-_.]+$/.test(d.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check ip format.",function(){$(i.$ipInput).focus()}),!1;var s=$(i.$portInput).val();if(""===s)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter server port."),void n.find(".brtc-admin-input.modify-datasource-port").focus();if(Number(s.trim())>65535)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Port number should be under 65535.",function(){$(i.$portInput).focus()}),!1;if(isNaN(s.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Port number should be number type.",function(){$(i.$portInput).focus()}),!1;var c=$(i.$dbTypeInput).val();if(""===c)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter db type."),void n.find(".brtc-admin-input.modify-datasource-dbtype").focus();var l=$(i.$dbNameInput).val();if(""===l)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter db name."),void n.find(".brtc-admin-input.modify-datasource-dbname").focus();if(a.test(l.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check dbname format.",function(){l.focus()}),!1;var u=$(i.$userNameInput).val();if(""===u)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter user name."),void n.find(".brtc-admin-input.modify-datasource-username").focus();if(a.test(u.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check user name format.",function(){u.focus()}),!1;var p=$(i.$passwordInput).val();if(""===p)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter password."),void n.find(".brtc-admin-input.modify-datasource-password").focus();if(a.test(p.trim()))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check password format.",function(){p.focus()}),!1;var h={datasourceName:r,datasourceType:o,ip:d,port:s,userName:u,password:p,dbType:c,dbName:l};e.Admin.Send.updateDatasource(h,i.refreshUpdateData.bind(i)),$(i.$datasourceNameInput).val(""),$(i.$datasourceTypeInput).jqxDropDownList("clearSelection"),$(i.$ipInput).val(""),$(i.$portInput).val(""),$(i.$dbTypeInput).jqxDropDownList("clearSelection"),$(i.$dbNameInput).val(""),$(i.$userNameInput).val(""),$(i.$passwordInput).val("")})},i.prototype.refreshUpdateData=function(e){this.checkDialog("Success","Datasource has been updated."),this.changePerspective(),this.refreshDatasourceData()},i.prototype.checkDialog=function(e,i){var a={title:e,contentText:i};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},e.Admin.DatasourceManagement=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils,i={datasourceName:"ALL",datasourceType:"ALL"};function a(t,i){this.parentId=t,this.options=i,this.fileList={},this.modelFileContents,this.modelDBContents,this.reportContents,this.isChangeContent=!1,e.VA.Env.Session.userId=i.userId,this.retrieveParent(),this.createControls(),this.changePerspective(),this.registerEventListener()}a.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},a.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-deploy"),this.createDeployListArea(),this.createDetailDeployPerspective(),this.createModifyDeployPerspective()},a.prototype.createDeployListArea=function(){this.$deployListArea=$('<article>   <h2>Model Deploy</h2>   <div class="brtc-admin-header-form">   </div>   <div class="cont_box stmt30 brtc-admin-data-area"></div></article>'),this.$mainControl.append(this.$deployListArea),this.createHeaderForm(this.$deployListArea.find(".brtc-admin-header-form")),this.createDataArea(this.$deployListArea.find(".brtc-admin-data-area"))},a.prototype.createDataArea=function(e){this.createSumArea(e),this.createDataControlArea(e)},a.prototype.createSumArea=function(t){var i=this,a=$('<div class="tb_view_st">   <span>Total<strong class="brtc-admin-total-count"></strong></span>   <div class="brtc-admin-dropdown-count"></div></div>');t.append(a);a.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),a.find(".brtc-admin-dropdown-count").on("select",function(t){var n=t.args,r=a.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index);null!=r&&(i.$deployGrid.jqxGrid({pagesize:r.value}),e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$deployGrid))})},a.prototype.createDataControlArea=function(t){var i=this,a=$('<div class="tb_choibox btn_box ctr01 choinone brtc-admin-choice">   <div class="ipstc brtc-admin-selected">       <input type="checkbox" id="cc1" value=""/>       <label for="cc1"><b>1</b> Row(s) selected.</label>   </div>   <div class="brtc-float-left active">       <button class="brtc-admin-button delete" value="delete" CRUD="D">Delete</button>       <button class="brtc-admin-button download" value="download">Download</button>   </div></div><div class="tb_choinone"></div><div class="tb_headview"></div>');t.append(a),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){i.$deployGrid.jqxGrid("clearselection")}),a.find(".delete").jqxButton({theme:e.VA.Env.Theme}),a.find(".delete").on("click",function(){var e=i.$deployGrid.jqxGrid("getselectedrowindexes");if(e.length>0){var t=[];for(var a in e){var n=i.$deployGrid.jqxGrid("getrowdata",e[a]);t.push("["+n.title+"]")}i.createDeleteDeployConfirmDialog(function(e){e.OK&&(i.$deployGrid.jqxGrid("getselectedrowindexes").length>1?i.createDeleteConfirmDialog(!1):i.createDeleteConfirmDialog(!0))},t)}}),a.find(".download").jqxButton({theme:e.VA.Env.Theme}),a.find(".download").on("click",function(){var e=i.$deployGrid.jqxGrid("getselectedrowindexes"),t=i.$deployGrid.jqxGrid("getrowdata",e[0]);i.createDownloadDeploy(t)}),this.createDataGrid($(".tb_headview"))},a.prototype.createDeleteDeployConfirmDialog=function(e,i){var a={title:"",contentText:void 0===i?"Are you sure you want to delete?":"Are you sure you want to delete "+i.length+" selected deploys?",close:e,isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},a.prototype.createDataGrid=function(i){var a=this,n=e.VA.Env.Session.userId;this.$deployGrid=$('<div class="brtc-admin-body-grid-deploy"></div>'),i.append(this.$deployGrid),this.$deployGrid.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:600,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columnsresize:!1,autoheight:!0,selectionmode:"checkbox",columns:[{text:"ID",datafield:"deployId",width:"220px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft,cellclassname:"brtc-grid-cell-bold"},{text:"Version",datafield:"version",width:"80px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Name",datafield:"title",width:"auto",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft,cellclassname:"brtc-grid-cell-bold"},{text:"Server",datafield:"targetServer",width:"100px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer,cellclassname:"brtc-grid-cell-bold"},{text:"Variable Y/N",datafield:"gvYn",width:"100px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer,cellclassname:"brtc-grid-cell-bold"},{text:"Active",datafield:"isactive",width:"200px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"pointer",cellsrenderer:function(e,t,i){return'<div class="brtc-float-left model active" style="height:100%; padding-left: 20px; float: none;" index="'+e+'">    <button class="brtc-admin-button toggle active" style="margin-left:0 !important; height: 20px" value="Y" status="'+i+'">Y</button>    <button class="brtc-admin-button toggle inactive" style="margin-left:0 !important; height: 20px" value="N"  status="'+i+'">N</button></div>'}}]}),this.$deployGrid.on("pagechanged",function(t){e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.$deployGrid.on("rowselect",function(e){a.refreshDataControlButton()}),this.$deployGrid.on("rowunselect",function(e){a.refreshDataControlButton()}),this.$deployGrid.on("cellclick",function(e){if(0!==e.args.columnindex)if("isactive"!=e.args.datafield)this.value="detail",a.changePerspective(this),a.setDetailDeployInfo(a.$deployGrid.jqxGrid("getrowdata",e.args.rowindex));else if("isactive"===e.args.datafield){var t,i=$(e.args.originalEvent.target);i.hasClass("active")?"N"==i.attr("status")&&(t=a.$deployGrid.jqxGrid("getrowdata",i.closest(".brtc-float-left").attr("index")),a.changeModelActiveStatusDialog(t,"Y")):"Y"==i.attr("status")&&(t=a.$deployGrid.jqxGrid("getrowdata",i.closest(".brtc-float-left").attr("index")),a.changeModelActiveStatusDialog(t,"N"))}}),this.checkAuthByUserId(n)},a.prototype.createDeleteConfirmDialog=function(t){var i,a=this;if(t)if(a.selectedDetailDeploy){var n={registerUserId:(i=a.selectedDetailDeploy).registerUserId,version:i.version};$.ajax({url:"api/admin/v2/deploys/"+i.targetServer+"/"+i.deployId,type:"POST",data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(function(){a.checkDialog("Success","Model [ "+i.title+" ] has been deleted."),a.refreshDeployData(),a.changePerspective()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}else{var r=a.$deployGrid.jqxGrid("getselectedrowindexes"),o=0;for(var d in r){var s=(c=a.$deployGrid.jqxGrid("getrowdata",r[d])).targetServer;n={registerUserId:c.registerUserId,version:c.version};$.ajax({url:"api/admin/v2/deploys/"+s+"/"+c.deployId,type:"POST",data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&o++,o===r.length&&(a.checkDialog("Success","( "+o+" ) Model(s) has been deleted."),a.refreshDeployData())}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}}else{o=0,r=a.$deployGrid.jqxGrid("getselectedrowindexes");for(var d in r){var c;s=(c=a.$deployGrid.jqxGrid("getrowdata",r[d])).targetServer,n={registerUserId:c.registerUserId,version:c.version};$.ajax({url:"api/admin/v2/deploys/"+s+"/"+c.deployId,type:"POST",data:JSON.stringify(n),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&o++,o===r.length&&(a.checkDialog("Success","( "+o+" ) Model(s) has been deleted."),a.refreshDeployData())}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}}},a.prototype.getUserBrowserName=function(){return window.chrome&&window.chrome.webstore?"Chrome":document.documentMode?"Internet Explorer":!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0?"Opera":"undefined"!=typeof InstallTrigger?"Firefox":Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString()?"Safari":void 0},a.prototype.createDownloadDeploy=function(t){var i={url:"api/admin/v2/deploys/"+t.targetServer+"/"+t.deployId+"/"+t.registerUserId+"/"+t.version,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(i).done(function(i){if(null!=i.contents){var a={type:"files",version:"3.5",data:[{type:"file",data:{contents:JSON.parse(i.contents)}}]};a.data[0].data.label=i.modelName,a.data[0].data.description=i.description;var n=t.title+".json";if("Internet Explorer"===e.VA.Core.Utils.CommonUtils.getUserBrowserName()){var r=new Blob([a],{type:"text/json;charset=utf-8"});window.navigator.msSaveOrOpenBlob(r,n)}else{var o="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a)),d=$('<a class="brtc-va-export-file" href="data:'+o+'" download="'+n+'"></a>');$("body").append(d),d[0].click(),d.remove()}}}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})},a.prototype.createHeaderForm=function(t){var a=this,n=$('<table class="brtc-admin-search-table">   <colgroup>      <col style="width:100px;">      <col style="width:350px;">      <col style="width:100px;">      <col style="width:350px;">   </colgroup>   <tbody>       <tr>           <th>Name</th>           <td>               <input type="text" class="brtc-admin-filter-input deploy" placeholder="Enter name"/>           </td>           <th>Active</th>           <td class="brtc-admin-agent-search-active">               <div class="ipstc lbtxt">                   <input type="checkbox" id="k0" value="all" checked="">                   <label for="k0">All</label>               </div>               <div class="ipstc lbtxt">                   <input type="checkbox" id="k1" value="active" checked="">                   <label for="k1">Y</label>               </div>               <div class="ipstc lbtxt">                   <input type="checkbox" id="k2" value="inactive" checked="">                   <label for="k2">N</label>               </div>           </td>       </tr>       <tr>           <th>Server</th>           <td colspan="4" style="height: 39px">               <div class="brtc-admin-deploy-search" style="height: 25px; width: 98%; float: left;margin-top: 5px;"/>       </tr>       <tr style="height: 42px">           <td colspan="4">               <div class="brtc-button-box" style="margin-top: 0px !important;">                   <div class="brtc-search-button-box">                       <div class="brtc-float-right">                           <button class="brtc-admin-button search-area clear" style="min-width: 65px !important;height: 15px;" value="clear">Clear</button>                           <button class="brtc-admin-button search-area search" style="min-width: 65px !important;height: 15px;" value="search">Search</button>                       </div>                   </div>               </div>           </td>       </tr>   </tbody></table>');t.append(n),this.$filterInput=n.find(".brtc-admin-filter-input");var r={datatype:"json",datafields:[{name:"datasourceName"},{name:"datasourceType"}],url:"api/va/v2/ws/deploy/target",async:!0},o=new $.jqx.dataAdapter(r,{beforeLoadComplete:function(e){return e.unshift(i),e}});o.dataBind(r);var d=n.find(".brtc-admin-deploy-search");d.jqxDropDownList({theme:e.VA.Env.Theme,width:"100%",placeHolder:"ALL",selectedIndex:0,source:o,displayMember:"datasourceName"}),this.setSearchData(),n.find(".brtc-admin-filter-input.deploy").keydown(function(e){13==e.keyCode&&a.filteringDeployData()})},a.prototype.filteringDeployData=function(){var t=this.$deployListArea.find(".brtc-admin-filter-input"),i=this.$deployListArea.find(".brtc-admin-agent-search-active [value=all]"),a=(this.$deployListArea.find(".brtc-admin-agent-search-active [value=active]"),this.$deployListArea.find(".brtc-admin-agent-search-active [value=inactive]"),this.$deployListArea.find(".brtc-admin-deploy-search"));""===t.val()&&i.is(":checked")&&"ALL"===a.jqxDropDownList("val")?this.$deployGrid.jqxGrid("clearfilters"):this.addFilter(),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(this.$deployGrid),this.setRowCount()},a.prototype.addFilter=function(){this.$deployGrid.jqxGrid("clearfilters");var e=this.$deployListArea.find(".brtc-admin-filter-input"),t=this.$deployListArea.find(".brtc-admin-agent-search-active [value=all]"),i=this.$deployListArea.find(".brtc-admin-agent-search-active [value=active]"),a=this.$deployListArea.find(".brtc-admin-agent-search-active [value=inactive]"),n=this.$deployListArea.find(".brtc-admin-deploy-search"),r=new $.jqx.filter,o=e.val(),d=r.createfilter("stringfilter",o,"contains");if(r.addfilter(1,d),this.$deployGrid.jqxGrid("addfilter","title",r),!t.is(":checked")){var s=new $.jqx.filter,c="";i.is(":checked")?c="Y":a.is(":checked")&&(c="N");var l=s.createfilter("stringfilter",c,"equal");s.addfilter(1,l),this.$deployGrid.jqxGrid("addfilter","isactive",s)}if("ALL"!=n.jqxDropDownList("val")){var u=new $.jqx.filter,p=n.jqxDropDownList("val"),h=u.createfilter("stringfilter",p,"equal");u.addfilter(1,h),this.$deployGrid.jqxGrid("addfilter","targetServer",u)}this.$deployGrid.jqxGrid("applyfilters"),this.setRowCount()},a.prototype.setSearchData=function(){var e=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=all]"),t=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=active]"),i=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=inactive]"),a=$(".brtc-admin-deploy-search"),n=$(".brtc-admin-filter-input");this.searchData={name:n.val().trim(),targetServer:a.val(),activeAll:e.is(":checked"),activeY:t.is(":checked"),activeN:i.is(":checked")}},a.prototype.refreshDataControlButton=function(){var e=this.$deployGrid.jqxGrid("getselectedrowindexes"),t=this.$mainControl.find(".brtc-admin-choice");e.length>1?(t.addClass("active"),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-button.download").hide(),t.find(".brtc-admin-button.download").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0)):0===e.length?(t.removeClass("active"),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!0}),t.find(".brtc-admin-button.download").show(),t.find(".brtc-admin-button.download").jqxButton({disabled:!0}),t.find(".brtc-admin-selected").hide(),t.find(".brtc-admin-selected").find("b:first").hide()):(t.addClass("active"),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-button.download").show(),t.find(".brtc-admin-button.download").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0))},a.prototype.setDetailDeployInfo=function(e){var t=this.$mainControl.find(".brtc-admin-input.detail-deploy-id");$(t).val(e.deployId),$(t).prop("title",e.deployId);var i=this.$mainControl.find(".brtc-admin-input.detail-target-version");$(i).val(e.version),$(i).prop("title",e.version);var a=this.$mainControl.find(".brtc-admin-input.detail-project-name");$(a).val(e.projectName),$(a).prop("title",e.projectName);var n=this.$mainControl.find(".brtc-admin-input.detail-model-name");$(n).val(e.modelName),$(n).prop("title",e.modelName);var r=this.$mainControl.find(".brtc-admin-input.detail-variable-yn");$(r).val(e.gvYn),$(r).prop("title",e.gvYn);var o=this.$mainControl.find(".brtc-admin-input.detail-deploy-name");$(o).val(e.title),$(o).prop("title",e.title);var d=this.$mainControl.find(".brtc-admin-input.detail-target-desc");$(d).html(e.description);var s=this.$mainControl.find(".brtc-admin-input.detail-target-registerUser");$(s).val(e.registerUserId),$(s).prop("title",e.registerUserId);var c=this.$mainControl.find(".brtc-admin-input.detail-target-deployTime");$(c).val(e.deployTime),$(c).prop("title",e.deployTime),this.selectedDetailDeploy=e},a.prototype.checkAuthByUserId=function(t){var i=this;$.ajax({url:"api/admin/v2/deploys/auth",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){i.refreshDeployData()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})},a.prototype.refreshDeployData=function(){var t=this,i=[],a=e.VA.Env.Session.userId;$("body").trigger("startProgress"),$.ajax({url:"api/admin/v2/deploys",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(n){for(var r in n){var o=n[r];for(var d in o)o[d].targetServer=r;i=i.concat(o)}var s=[];if(t.searchData.activeAll||t.searchData.activeY||t.searchData.activeN)for(var d in i)if(!(t.searchData.name&&-1==i[d].title.toLowerCase().indexOf(t.searchData.name.toLowerCase())||"ALL"!=t.searchData.targetServer&&-1==i[d].targetServer.indexOf(t.searchData.targetServer))){if(1!=t.searchData.activeAll){if(!0===t.searchData.activeY&&"N"===i[d].isactive)continue;if(!0===t.searchData.activeN&&"Y"===i[d].isactive)continue}t.searchData.registerUserId&&t.searchData.registerUserId!=a||s.push(i[d])}s.sort(function(e,t){return e.deployTime<t.deployTime?1:e.deployTime>t.deployTime?-1:0}),t.data=s;var c={localdata:t.data,datafields:[{name:"targetServer",type:"string"},{name:"deployId",type:"string"},{name:"registerUserId",type:"string"},{name:"version",type:"string"},{name:"projectName",type:"string"},{name:"modelName",type:"string"},{name:"title",type:"string"},{name:"description",type:"string"},{name:"contents",type:"string"},{name:"runnableContents",type:"string"},{name:"isactive",type:"string"},{name:"sourceServer",type:"string"},{name:"deployTime",type:"string"},{name:"updateUserId",type:"string"},{name:"updateTime",type:"string"},{name:"gvYn",type:"string"}],datatype:"array"};e.VA.Core.Utils.WidgetUtils.updateGridSource(t.$deployGrid,c),t.setRowCount(),t.refreshDataControlButton(),t.filteringDeployData(),t.setRowCount()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},a.prototype.setRowCount=function(){var t=this.$deployGrid.jqxGrid("getrows");$(".brtc-admin-total-count").text(t.length),e.VA.Core.Utils.WidgetUtils.updatePageButton(this.$deployGrid)},a.prototype.updateModelDesc=function(t){var i=this,a=e.VA.Env.Session.userId,n=t.targetServer,r={deployId:t.deployId,registerUserId:t.registerUserId,version:t.version,title:t.title,description:t.description,isactive:t.isactive,updateUserId:a};$.ajax({type:"POST",url:"api/va/v2/ws/deploy/"+n,contentType:"application/json; charset=utf-8",data:JSON.stringify(r)}).done(function(e){i.checkDialog("Success","Model [ "+t.title+" ] has been updated."),i.changePerspective(),i.filteringDeployData(),i.modifyNoteControl.clear()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})},a.prototype.changeModelActiveStatusDialog=function(i,a){var n=this,r={title:"Change Active Status",contentText:"Now Changing ["+i.title+"] Are you sure?",close:function(t){if(t.OK){var r=e.VA.Env.Session.userId,o=i.targetServer,d={deployId:i.deployId,registerUserId:i.registerUserId,version:i.version,title:i.title,description:i.description,isactive:a,updateUserId:r};$("body").trigger("startProgress"),$.ajax({type:"POST",url:"api/va/v2/ws/deploy/"+o,contentType:"application/json; charset=utf-8",data:JSON.stringify(d)}).done(function(e){n.refreshDeployData()}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})}},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,r)},a.prototype.createAdminConfirmDialog=function(i,a){var n,r,o={OK:!1,Cancel:!0},d=$('<div class="brtc-admin-dialogs-main">   <div class="brtc-admin-dialogs-header nonbottomborder">'+a.title+'</div>   <div class="brtc-admin-dialogs-body">       <div class="brtc-admin-dialogs-contents">       </div>       <div class="brtc-button-box stmt20 brtc-admin-dialogs-buttonbar">           <div class="brtc-float-right">               <button class="brtc-admin-button dialog-ok" value="ok">OK</button>           </div>       </div>   </div></div>');i.append(d),n=d.find(".dialog-ok"),a.isCancel&&(r=$('<button class="brtc-admin-button dialog-cancel" value="cancel">Cancel</button>'),d.find(".brtc-admin-dialogs-buttonbar").find(".brtc-float-right").prepend(r));var s={theme:e.VA.Env.Theme,width:"400px",height:"180px",isModal:!0,resizable:!1,cancelButton:r,initContent:function(){t.WidgetUtils.createAdminDialogContentsArea(d.find(".brtc-admin-dialogs-contents"),a),n.jqxButton({theme:e.VA.Env.Theme}),n.click(function(){o={OK:!0,Cancel:!1},d.jqxWindow("close")}),a.isCancel&&r.jqxButton({theme:e.VA.Env.Theme})}};return d.jqxWindow(s),d.jqxWindow("focus"),d.on("close",function(e){d.jqxWindow("destroy"),d.remove(),"function"==typeof a.close&&a.close(o)}),d},a.prototype.changePerspective=function(e){e?"delete"===e.value?(this.$detailDeployArea.hide(),this.$modifyDeployArea.hide(),this.$deployListArea.hide()):"modify"===e.value?(this.$detailDeployArea.hide(),this.$modifyDeployArea.show(),this.$deployListArea.hide()):"detail"===e.value?(this.$detailDeployArea.show(),this.$deployListArea.hide(),this.$modifyDeployArea.hide()):"return"===e.value&&(this.$detailDeployArea.hide(),this.$deployListArea.show(),this.$modifyDeployArea.hide()):(this.$detailDeployArea.hide(),this.$deployListArea.show(),this.$modifyDeployArea.hide())},a.prototype.registerEventListener=function(){var e=this;$(".brtc-admin-filter-input").keydown(function(e){13==e.keyCode&&$(this).trigger("focusout")});var t=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=all]"),i=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=active]"),a=$(".brtc-admin-agent-search-active").find("input[type=checkbox][value=inactive]");t.click(function(){$(this).is(":checked")?(i.prop("checked",!0),a.prop("checked",!0)):(i.prop("checked",!1),a.prop("checked",!1))}),i.click(function(){$(this).is(":checked")?a.is(":checked")&&t.prop("checked",!0):t.prop("checked",!1)}),a.click(function(){$(this).is(":checked")?i.is(":checked")&&t.prop("checked",!0):t.prop("checked",!1)}),$(".brtc-admin-button.clear").click(function(){$(".brtc-admin-filter-input").val(""),t.prop("checked",!0),i.prop("checked",!0),a.prop("checked",!0),$(".brtc-admin-deploy-search").jqxDropDownList("selectIndex",0),e.setSearchData(),e.refreshDeployData()}),$(".brtc-admin-button.search").click(function(){e.filteringDeployData()})},a.prototype.createDetailDeployPerspective=function(){this.$detailDeployArea=$('<article class="brtc-admin-detail-deploy">   <h2>Deploy Information</h2>   <div class="brtc-admin-detail-deploy-area"></div></article>'),this.$mainControl.append(this.$detailDeployArea),this.createDetailDeployFormGroup()},a.prototype.createDetailDeployFormGroup=function(i){var a=this,n=this.$detailDeployArea.find(".brtc-admin-detail-deploy-area"),r=$('<table class="tb_st03 linetrg" style="table-layout:fixed;">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">   <div class="brtc-float-left">       <button class="brtc-admin-button detail-target list" value="list">List</button>   </div>    <div class="brtc-float-right">       <button class="brtc-admin-button detail-target delete" value="delete" CRUD="D">Delete</button>       <button class="brtc-admin-button detail-target modify" value="modify" CRUD="U">Edit</button>    </div></div>');n.append(r);var o=r.find("tbody"),d=$('<td colspan="3">   <input type="text" name="deployId" class="brtc-admin-input detail-deploy-id" disabled></td>'),s=t.WidgetUtils.createTableRow("Deploy ID",d);o.append(s);var c=$('<td colspan="3">   <input type="text" name="version" class="brtc-admin-input detail-target-version" disabled></td>'),l=t.WidgetUtils.createTableRow("Version",c);o.append(l);var u=$('<td colspan="3" style="padding-top: 10px;">   <input type="text" name="projectName" class="brtc-admin-input detail-project-name" disabled></td>'),p=t.WidgetUtils.createTableRow("Project Name",u);o.append(p);var h=$('<td colspan="3">   <input type="text" name="modelName" class="brtc-admin-input detail-model-name" disabled></td>'),m=t.WidgetUtils.createTableRow("Model Name",h);o.append(m);var f=$('<td colspan="3" style="padding-top: 10px;">   <input type="text" name="variableyn" class="brtc-admin-input detail-variable-yn" disabled></td>'),b=t.WidgetUtils.createTableRow("Variable Flag",f);o.append(b);var g=$('<td colspan="3">   <input type="text" name="deployName" class="brtc-admin-input detail-deploy-name" disabled></td>'),v=t.WidgetUtils.createTableRow("Deploy Name",g);o.append(v);var y=$('<td colspan="3">   <div name="desc" class="brtc-admin-input detail-target-desc note-editor" style="height: 256px; overflow: auto;"></td>'),x=t.WidgetUtils.createTableRow("Description",y);o.append(x);var w=$('<td colspan="3">   <input type="text" name="registerUser" class="brtc-admin-input detail-target-registerUser" disabled maxlength="40"></td>'),D=t.WidgetUtils.createTableRow("Register User ID",w);o.append(D);var A=$('<td colspan="3">   <input type="text" name="deployTime" class="brtc-admin-input detail-target-deployTime" disabled maxlength="40"></td>'),C=t.WidgetUtils.createTableRow("Deploy Time",A);o.append(C);var U=n.find(".brtc-admin-button.detail-target.list");U.jqxButton({theme:e.VA.Env.Theme}),U.on("click",function(){a.changePerspective(),a.selectedDetailDeploy=void 0});var j=n.find(".brtc-admin-button.detail-target.modify");j.jqxButton({theme:e.VA.Env.Theme}),j.on("click",function(){a.changePerspective(this),a.setModifyDeployInfo(a.selectedDetailDeploy)});var T=n.find(".brtc-admin-button.detail-target.delete");T.jqxButton({theme:e.VA.Env.Theme}),T.on("click",function(){a.createDeleteDeployConfirmDialog(function(e){e.OK&&a.createDeleteConfirmDialog(!0)})})},a.prototype.setModifyDeployInfo=function(e){var t=this.$modifyDeployArea.find(".brtc-admin-input.modify-deploy-id");$(t).val(e.deployId),$(t).prop("title",e.deployId);var i=this.$modifyDeployArea.find(".brtc-admin-input.modify-target-version");$(i).val(e.version),$(i).prop("title",e.version);var a=this.$modifyDeployArea.find(".brtc-admin-input.modify-project-name");$(a).val(e.projectName),$(a).prop("title",e.projectName);var n=this.$modifyDeployArea.find(".brtc-admin-input.modify-model-name");$(n).val(e.modelName),$(n).prop("title",e.modelName);var r=this.$modifyDeployArea.find(".brtc-admin-input.modify-variable-yn");$(r).val(e.gvYn),$(r).prop("title",e.gvYn);var o=this.$modifyDeployArea.find(".brtc-admin-input.modify-deploy-name");$(o).val(e.title),this.modifyNoteControl.setValue(e.description);var d=this.$modifyDeployArea.find(".brtc-admin-input.modify-target-registerUser");$(d).val(e.registerUserId),$(d).prop("title",e.registerUserId);var s=this.$modifyDeployArea.find(".brtc-admin-input.modify-target-deployTime");$(s).val(e.deployTime),$(s).prop("title",e.deployTime)},a.prototype.createModifyDeployPerspective=function(){this.$modifyDeployArea=$('<article class="brtc-admin-modify-deploy">   <h2>Edit Deploy Information</h2>   <div class="brtc-admin-modify-deploy-area"></div></article>'),this.$mainControl.append(this.$modifyDeployArea),this.createModifyDeployFormGroup()},a.prototype.createModifyDeployFormGroup=function(i){var a=this,n=this.$modifyDeployArea.find(".brtc-admin-modify-deploy-area"),r=$('<table class="tb_st03 linetrg" style="table-layout: fixed;">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">    <div class="brtc-float-right">       <button class="brtc-admin-button modify-deploy cancel" value="cancel">Cancel</button>       <button class="brtc-admin-button modify-deploy save" value="update">Save</button>    </div></div>');n.append(r);var o=r.find("tbody"),d=$('<td colspan="3">   <input type="text" name="version" class="brtc-admin-input modify-deploy-id" disabled></td>'),s=t.WidgetUtils.createTableRow("Deploy ID",d);o.append(s);var c=$('<td colspan="3">   <input type="text" name="version" class="brtc-admin-input modify-target-version" disabled></td>'),l=t.WidgetUtils.createTableRow("Version",c);o.append(l);var u=$('<td colspan="3" style="padding-top: 10px;">   <input type="text" name="projectName" class="brtc-admin-input modify-project-name" disabled></td>'),p=t.WidgetUtils.createTableRow("Project Name",u);o.append(p);var h=$('<td colspan="3">   <input type="text" name="modelName" class="brtc-admin-input modify-model-name" disabled></td>'),m=t.WidgetUtils.createTableRow("Model Name",h);o.append(m);var f=$('<td colspan="3" style="padding-top: 10px;">   <input type="text" name="variableyn" class="brtc-admin-input modify-variable-yn" disabled></td>'),b=t.WidgetUtils.createTableRow("Variable Flag",f);o.append(b);var g=$('<td colspan="3">   <input type="text" name="deployName" class="brtc-admin-input modify-deploy-name" maxlength="80"></td>'),v=t.WidgetUtils.createTableRow("Deploy Name",g);o.append(v);var y=$('<td colspan="3">   <div class="brtc-va-dialogs-editresourcedialog-description-container modify" ></div></td>'),x=t.WidgetUtils.createTableRow("Description",y);o.append(x),this.modifyNoteControl=this.createDescriptionControl(y.find(".brtc-va-dialogs-editresourcedialog-description-container.modify"),"",$(".brtc-admin-button.modify-deploy.save"));var w=$('<td colspan="3">   <input type="text" name="desc" class="brtc-admin-input modify-target-registerUser" disabled maxlength="40"></td>'),D=t.WidgetUtils.createTableRow("Register User ID",w);o.append(D);var A=$('<td colspan="3">   <input type="text" name="desc" class="brtc-admin-input modify-target-deployTime" disabled maxlength="40"></td>'),C=t.WidgetUtils.createTableRow("Deploy Time",A);o.append(C),this.modifyDeploySaveButton=r.find(".brtc-admin-button.modify-deploy.save"),this.modifyDeploySaveButton.jqxButton({theme:e.VA.Env.Theme}),this.modifyDeploySaveButton.on("click",function(t){var i=a.modifyNoteControl.getValue();a.selectedDetailDeploy.description=i,a.selectedDetailDeploy.title=g.find(".modify-deploy-name").val(),$("<div>").append(a.modifyNoteControl.getValue()).text().length>2e3?e.VA.Core.Utils.WidgetUtils.openErrorDialog("Description should be less than or equal to 2000 characters."):a.updateModelDesc(a.selectedDetailDeploy)}),this.modifyDeployCancelButton=r.find(".brtc-admin-button.modify-deploy.cancel"),this.modifyDeployCancelButton.jqxButton({theme:e.VA.Env.Theme}),this.modifyDeployCancelButton.on("click",function(){a.changePerspective(),a.modifyNoteControl.clear()})},a.prototype.createDescriptionControl=function(t,i,a){var n={height:200,description:i,okButton:a,maxLength:2e3,toolbar:this.options.toolbar};return $(".note-statusbar").hide(),e.VA.Core.Widget.Factory.noteControl(t,n)},a.prototype.checkDialog=function(e,i,a){var n={title:e,close:a,contentText:i};t.WidgetUtils.createAdminConfirmDialog(this.$parent,n)},e.Admin.DeployManagement=a}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;var i=24;function a(t,i){this.parentId=t,this.options=i,e.VA.Env.Session.userId=i.userId,this.retrieveParent(),this.createControls()}a.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},a.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-job-monitoring"),this.createWorksheetPanel()},a.prototype.createWorksheetPanel=function(){this.$contentsArea=$('<article>   <h2>Job Monitoring</h2>   <div class="brtc-float-right-refresh">       <button class="brtc-admin-button reload" style="height: 21px !important; padding-left: 0px !important;padding-right: 0px !important;" value="reload"><span class="fa fa-refresh"></span></button>   </div>   <div class="brtc-monitoring-set"><p></p></div></article>'),this.$infoMsg=$('<article>   <h2>Job Monitoring</h2>   <div class="brtc-float-right-refresh">       <button class="brtc-admin-button reload" style="height: 21px !important; padding-left: 0px !important;padding-right: 0px !important;" value="reload"><span class="fa fa-refresh"></span></button>   </div>   <div class="brtc-monitoring-info-msg">There is no active job.</div></article>'),this.$mainControl.append(this.$contentsArea),this.$mainControl.append(this.$infoMsg),this.$infoMsg.hide(),this.schemaChecked=!1,this.checkSchema(),this.registerEventListener()},a.prototype.checkSchema=function(){var e=this;this.schemaChecked?e.createChart():$.ajax(e._checkTableSchema()).done(function(t){0==t?(e.$contentsArea.hide(),e.$infoMsg.show()):(e.schemaChecked=!0,e.createChart())})},a.prototype.registerEventListener=function(){var e=this;$(".reload").click(function(){e.checkSchema()})},a.prototype.createChart=function(){var e=this;$.ajax(e._getRunningUserList()).done(function(t){e.userIds=t,0==t.length?(e.$contentsArea.hide(),e.$infoMsg.show()):(e.$contentsArea.show(),e.$infoMsg.hide());for(var i in e.chartMap={},e.$mainControl.find(".brtc-monitoring-chart-set").remove(),e.$contentsArea.find(".brtc-monitoring-search-agent").remove(),t){var a=t[i];e.chartMap[a]=e.addChartSet(a)}e.$contentsArea.find(".brtc-monitoring-set>p").text("Active User ("+t.length+")"),e.bindChartData()})},a.prototype.addChartSet=function(e){var t=e.replace("<br>","&#013;"),a=$('<div class="brtc-monitoring-chart-set">   <div class="brtc-monitoring-appname" title='+t+">"+e+'</div>   <div class="brtc-monitoring-chart"></div></div>'),n={grid:{bottom:"28px",top:"20px",left:"50px",right:"20px"},chart:{animationDuration:0,type:"line",border:"1px #000000"},xAxis:[{selected:[{name:"date"}],axisLabel:{show:!1},axisTick:{show:!1},title:{show:!0,left:"88%",textStyle:{fontSize:"11px"},text:"Time (Last 5 minutes)"}}],yAxis:[{selected:[{name:"run",aggregation:"none"}],axisLabel:{textStyle:{fontSize:"7px"}},axisTick:{show:!1},title:{show:!0,left:"1",textStyle:{fontSize:"11px"},text:"# of CPU Cores"},min:0,max:i}],title:{text:"CPU Core usage of the active workers"},tooltip:{triggerOn:"click"},toolbar:{type:"custom",show:!1}};n.source=this.getDataSrc([[]]),this.$mainControl.find(".brtc-monitoring-set").append(a);try{a.find(".brtc-monitoring-chart").bcharts(n)}catch(e){console.error(e)}return a},a.prototype._checkTableSchema=function(){return{url:"api/admin/v2/monitor/check?type=job",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}},a.prototype._getRunningUserList=function(){return{url:"api/admin/v2/monitor/job/user?time=5",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}},a.prototype._getDataOption=function(e){return{url:"api/admin/v2/monitor/job/status?time=5",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}},a.prototype.getDataSrc=function(e){return{localData:[{dataType:"rawdata",columns:[{name:"userId",type:"string",internalType:"String"},{name:"date",type:"date"},{name:"coreNum",type:"number",internalType:"Double"},{name:"run",type:"number",internalType:"Double"}],data:e}]}};var n,r,o=function(e){return moment(e).format("YYYY-MM-DD HH:mm:ss")},d=-1,s=function(e,t){var i,a,s,c;return e.length>0&&(i=e[0][1],a=e[e.length-1][1]),i&&!n.isBefore(i)||e.unshift([t,o(n),d,0]),a&&!r.isAfter(a)||e.push([t,o(r),d,0]),c=[],e.slice().map(function(e,i,a){if(0==i)s=e[1];else for(;;){var n=moment(s).add("2","seconds");if(s=n,n.isSame(e[1])||n.isAfter(e[1])){c.push(e);break}c.push([t,o(n),d,0])}}),e=c};a.prototype.bindChartData=function(){var e=this;$.ajax(this._getDataOption()).done(function(t){var a={};for(var c in t.map(function(e){var t=e.userId;"(default)"==t?(r=function(e,t){var i=o(e),a=i.length,n=i.substr(a-2,a);if(n%t==0)return moment(i);var r=parseInt(n/t)*t;return r=(r+"").length<2?"0"+r:r,moment(i.substr(0,a-2)+r)}(e.date,"2"),n=moment(r).subtract("5","minutes")):(a[t]?a[t].push([t,o(e.date),e.coreNum,e.run]):a[t]=[[t,o(e.date),e.coreNum,e.run]],-1==d&&(d=e.coreNum))}),e.chartMap){var l=$(e.chartMap[c].find(".brtc-monitoring-chart")),u=l.bcharts("getOptions"),p=[];(p=null==a[c]?s([],c):s(a[c],c))[0][2]!=i?(i=p[0][2],l.bcharts("setOptions",$.extend(!0,{},u,{source:e.getDataSrc(p)},{yAxis:[{min:0,max:i}]}))):l.bcharts("setOptions",$.extend(!0,u,{source:e.getDataSrc(p)}))}setTimeout(e.bindChartData.bind(e),2e3)})},e.Admin.JobMonitorManagement=a}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(t,i){this.parentId=t,this.options=i,e.VA.Env.Session.userId=i.userId,this.retrieveParent(),this.createControls()}i.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-notice"),this.createNoticeListArea(),this.createDetailNoticePerspective(),this.createAddNoticePerspective(),this.createModifyNoticePerspective(),this.changePerspective()},i.prototype.createNoticeListArea=function(){this.$noticeListArea=$('<article>   <h2>Notice</h2>   <div class="brtc-admin-header-form">   </div>   <div class="cont_box stmt30 brtc-admin-data-area"></div></article>'),this.$mainControl.append(this.$noticeListArea),this.createHeaderForm(this.$noticeListArea.find(".brtc-admin-header-form")),this.createDataArea(this.$noticeListArea.find(".brtc-admin-data-area"))},i.prototype.createHeaderForm=function(i){var a=this,n=$('<table class="brtc-admin-search-table">   <colgroup>      <col style="width:100px;"><col>   </colgroup>   <tbody>       <tr>           <th class="brtc-admin-notice-label">Title</th>           <td>               <input type="text" class="brtc-admin-filter-input" style="width: 606px; margin-top: 2px; height: 25px !important;" maxlength="200" placeholder="Enter title"/>               <div class="brtc-search-button-box">                   <div class="brtc-float-right">                       <button class="brtc-admin-button search-area clear" value="clear">Clear</button>                       <button class="brtc-admin-button search-area search" value="search">Search</button>                   </div>               </div>           </td>       </tr>   </tbody></table>');i.append(n),this.$filterInput=n.find(".brtc-admin-filter-input"),t.InputValidator.appendValidationCondition(this.$filterInput),this.$filterInput.jqxInput({theme:e.VA.Env.Theme}),this.$filterInput.keydown(function(t){13==t.keyCode&&(""===a.$filterInput.val()?a.$noticeGrid.jqxGrid("clearfilters"):a.addFilter(),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(a.$noticeGrid),a.setRowCount())}),n.find(".brtc-admin-button.clear").jqxButton({theme:e.VA.Env.Theme}),n.find(".brtc-admin-button.clear").click(function(){a.$filterInput.val(""),a.$noticeGrid.jqxGrid("clearfilters"),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(a.$noticeGrid),a.setRowCount()}),n.find(".brtc-admin-button.search").jqxButton({theme:e.VA.Env.Theme}),n.find(".brtc-admin-button.search").click(function(){""===a.$filterInput.val()?a.$noticeGrid.jqxGrid("clearfilters"):a.addFilter(),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(a.$noticeGrid),a.setRowCount()}),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(this.$filterInput)},i.prototype.setRowCount=function(){var t=this.$noticeGrid.jqxGrid("getrows");this.$mainControl.find(".brtc-admin-total-count").text(t.length),e.VA.Core.Utils.WidgetUtils.updatePageButton(this.$noticeGrid)},i.prototype.createDataArea=function(e){this.createSumArea(e),this.createDataControlArea(e)},i.prototype.createSumArea=function(t){var i=this,a=$('<div class="tb_view_st">   <span>Total<strong class="brtc-admin-total-count"></strong></span>   <div class="brtc-admin-dropdown-count"></div></div>');t.append(a);a.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),a.find(".brtc-admin-dropdown-count").on("select",function(t){var n=t.args,r=a.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index);null!=r&&(i.$noticeGrid.jqxGrid({pagesize:r.value}),e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$noticeGrid))})},i.prototype.createDataControlArea=function(t){var i=this,a=$('<div class="tb_choibox btn_box ctr01 choinone brtc-admin-choice">   <div class="ipstc brtc-admin-selected">       <input type="checkbox" id="cc1" value=""/>       <label for="cc1"><b>1</b> Row(s) selected.</label>   </div>   <div class="brtc-float-left active">       <button class="brtc-admin-button add" value="add" CRUD="C">Add</button>       <button class="brtc-admin-button delete" value="delete" CRUD="D">Delete</button>   </div>   <div class="brtc-float-right-refresh">       <button class="brtc-admin-button reload" value="reload"><span class="fa fa-refresh"></span></button>   </div></div><div class="tb_choinone"></div><div class="tb_headview"></div>');t.append(a),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){i.$noticeGrid.jqxGrid("clearselection")}),a.find(".add").jqxButton({theme:e.VA.Env.Theme}),a.find(".add").on("click",function(){i.changePerspective(this)}),a.find(".delete").jqxButton({theme:e.VA.Env.Theme}),a.find(".delete").on("click",function(){var e=i.$noticeGrid.jqxGrid("getselectedrowindexes"),t=[];if(e.length>0){for(var a in e){var n=i.$noticeGrid.jqxGrid("getrowdata",e[a]);t.push("["+n.title+"]")}i.createDeleteConfirmDialog(t)}}),a.find(".reload").jqxButton({theme:e.VA.Env.Theme}),a.find(".reload").on("click",function(){i.refreshNoticeData()}),this.createDataGrid($(".tb_headview"))},i.prototype.createDataGrid=function(i){var a=this;this.$noticeGrid=$('<div class="brtc-admin-body-grid-notice"></div>'),i.append(this.$noticeGrid),this.$noticeGrid.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:600,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columnsresize:!1,selectionmode:"checkbox",autoheight:!0,columns:[{text:"ID",datafield:"id",width:"15%",hidden:!0},{text:"Title",datafield:"title",width:"30%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft,cellclassname:"brtc-grid-cell-bold"},{text:"Create Time",datafield:"create_time",width:"30%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsalign:"center",cellsformat:"yyyy-MM-dd HH:mm:ss"},{text:"Creator",datafield:"creator",width:"auto",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Content",datafield:"content",width:"auto",align:"center",cellsrenderer:t.WidgetUtils.cellRenderer,hidden:!0}]}),this.$noticeGrid.on("rowselect",function(e){a.refreshDataControlButton()}),this.$noticeGrid.on("cellclick",function(e){0!==e.args.columnindex&&(this.value="detail",a.changePerspective(this),a.setDetailNoticeInfo(a.$noticeGrid.jqxGrid("getrowdata",e.args.rowindex)))}),this.$noticeGrid.on("rowunselect",function(e){a.refreshDataControlButton()}),this.$noticeGrid.on("pagechanged",function(t){e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.refreshNoticeData()},i.prototype.addFilter=function(){this.$filterInput.trigger("focusout");var e=new $.jqx.filter,t=this.$filterInput.val(),i=e.createfilter("stringfilter",t,"contains");e.addfilter(1,i),this.$noticeGrid.jqxGrid("addfilter","title",e),this.$noticeGrid.jqxGrid("applyfilters"),this.setRowCount()},i.prototype.createDeleteConfirmDialog=function(i){var a=this,n={title:"",contentText:void 0===i?"Are you sure you want to delete?":"Are you sure you want to delete "+i.length+" selected notices?",close:function(t){if(t.OK)if(a.selectedDetailNotice){var i=function(){a.checkDialog("Success","Notice has been deleted."),a.changePerspective(),a.refreshNoticeData()};e.Admin.Send.deleteNotice(a.selectedDetailNotice.id,i)}else{var n=a.$noticeGrid.jqxGrid("getselectedrowindexes"),r=0,o=[];for(var d in n){var s=a.$noticeGrid.jqxGrid("getrowdata",n[d]);o.push("["+s.title+"]"),i=function(){++r===n.length&&(a.checkDialog("Success","("+o.length+") Notice(s) has been deleted."),a.changePerspective(),a.refreshNoticeData())},e.Admin.Send.deleteNotice(s.id,i)}}},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,n)},i.prototype.changePerspective=function(e){e?"add"===e.value?(this.$addNoticeArea.show(),this.$detailNoticeArea.hide(),this.$modifyNoticeArea.hide(),this.$noticeListArea.hide()):"modify"===e.value?(this.$addNoticeArea.hide(),this.$detailNoticeArea.hide(),this.$modifyNoticeArea.show(),this.$noticeListArea.hide()):"detail"===e.value&&(this.$addNoticeArea.hide(),this.$detailNoticeArea.show(),this.$modifyNoticeArea.hide(),this.$noticeListArea.hide()):(this.$addNoticeArea.hide(),this.$detailNoticeArea.hide(),this.$modifyNoticeArea.hide(),this.$noticeListArea.show())},i.prototype.refreshDataControlButton=function(){var e=this.$noticeGrid.jqxGrid("getselectedrowindexes"),t=this.$mainControl.find(".brtc-admin-choice");e.length>1?(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0)):0===e.length?(t.removeClass("active"),t.find(".brtc-admin-button.add").show(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!0}),t.find(".brtc-admin-selected").hide(),t.find(".brtc-admin-selected").find("b:first").hide()):(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0))},i.prototype.refreshNoticeData=function(){var t=this;e.Admin.Send.getAllNotices(function(i){t.$filterInput.val("");var a={localdata:i,datafields:[{name:"id",type:"string"},{name:"title",type:"string"},{name:"create_time",type:"date"},{name:"creator",type:"string"},{name:"content",type:"string"}],datatype:"array"};e.VA.Core.Utils.WidgetUtils.updateGridSource(t.$noticeGrid,a),t.$mainControl.find(".brtc-admin-total-count").text(i.length),t.refreshDataControlButton(),t.$noticeGrid.jqxGrid("getselectedrowindexes").length>0&&t.$noticeGrid.jqxGrid("clearselection"),t.selectedDetailNotice=void 0,t.selectedModifyNotice=void 0,t.setRowCount()})},i.prototype.createDetailNoticePerspective=function(){this.$detailNoticeArea=$('<article class="brtc-admin-detail-notice">   <h2>Notice Detail</h2>   <div class="brtc-admin-detail-notice-area"></div></article>'),this.$mainControl.append(this.$detailNoticeArea),this.createDetailNoticeFormGroup()},i.prototype.createDetailNoticeFormGroup=function(){var i=this,a=this.$detailNoticeArea.find(".brtc-admin-detail-notice-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">   <div class="brtc-float-left">       <button class="brtc-admin-button detail-notice list" value="list">List</button>   </div>    <div class="brtc-float-right">       <button class="brtc-admin-button detail-notice delete" value="delete" CRUD="D">Delete</button>       <button class="brtc-admin-button detail-notice modify" value="modify" CRUD="U">Edit</button>    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td class="detail-notice-title-td" colspan="3">   <input type="text" name="title" class="brtc-admin-input detail-notice-title" placeholder="Enter title."required/></td>'),d=t.WidgetUtils.createTableRow("Title",o,!1);r.append(d);var s=$('<td colspan="3" class="detail-notice-content-td" style="padding-bottom: 20px;">   <div class="brtc-admin-input detail-notice-content note-editor" placeholder="Enter notice content." required/></td>'),c=t.WidgetUtils.createTableRow("Content",s,!1);r.append(c);var l=n.find(".brtc-admin-input.detail-notice-title");l.jqxInput({theme:e.VA.Env.Theme,disabled:!0}),l.on("change",function(){i.checkDuplicateFlag=!1});var u=a.find(".brtc-admin-button.detail-notice.list");u.jqxButton({theme:e.VA.Env.Theme}),u.on("click",function(){i.changePerspective(),i.selectedDetailNotice=void 0});var p=a.find(".brtc-admin-button.detail-notice.delete");p.jqxButton({theme:e.VA.Env.Theme}),p.on("click",function(){i.createDeleteConfirmDialog()});var h=a.find(".brtc-admin-button.detail-notice.modify");h.jqxButton({theme:e.VA.Env.Theme}),h.on("click",function(){i.changePerspective(this),i.setModifyNoticeInfo(i.selectedDetailNotice)})},i.prototype.setModifyNoticeInfo=function(e){var t=this.$modifyNoticeArea.find(".brtc-admin-input.modify-notice-title");$(t).val(e.title),this.modifyNoteControl.setValue(e.content),this.selectedDetailNotice=e},i.prototype.setDetailNoticeInfo=function(e){var t=this.$mainControl.find(".brtc-admin-input.detail-notice-title");$(t).val(e.title),$(t).prop("title",e.title);var i=this.$mainControl.find(".brtc-admin-input.detail-notice-content");$(i).html(e.content),this.selectedDetailNotice=e},i.prototype.createAddNoticePerspective=function(){this.$addNoticeArea=$('<article class="brtc-admin-add-notice">   <h2>Add Notice</h2>   <div class="brtc-admin-add-notice-area"></div></article>'),this.$mainControl.append(this.$addNoticeArea),this.createAddNoticeFormGroup()},i.prototype.createAddNoticeFormGroup=function(){var i=this,a=this.$addNoticeArea.find(".brtc-admin-add-notice-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">    <div class="brtc-float-right">       <input type="button" class="brtc-admin-button add-notice cancel" value="Cancel">       <input type="button" class="brtc-admin-button add-notice save" value="Save">    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <input type="text" name="title" class="brtc-admin-input add-notice-title" maxlength="200" placeholder="Enter title." maxlength="80" required/></td>'),d=t.WidgetUtils.createTableRow("Title",o,!0);r.append(d),t.InputValidator.appendValidationCondition(o.find(".add-notice-title")),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(o.find(".add-notice-title"));var s=$('<td colspan="3" style="width: 770px; !important">   <div class="brtc-va-dialogs-editresourcedialog-description-container add" style="width: 770px; !important"></div></td>'),c=t.WidgetUtils.createTableRow("Content",s,!0);r.append(c),this.addNoteControl=this.createDescriptionControl(s.find(".brtc-va-dialogs-editresourcedialog-description-container.add"),"",$(".brtc-admin-button.add-notice.save"));var l=o.find(".brtc-admin-input.add-notice-title");l.jqxInput({theme:e.VA.Env.Theme}),l.on("change",function(){i.checkDuplicateFlag=!1}),this.addNoticeCancelButton=a.find(".brtc-admin-button.add-notice.cancel"),this.addNoticeCancelButton.jqxButton({width:67,height:27,theme:e.VA.Env.Theme}),this.addNoticeCancelButton.on("click",function(){$(l).val(""),i.addNoteControl.clear(),i.changePerspective()}),this.addNoticeSaveButton=a.find(".brtc-admin-button.add-notice.save"),this.addNoticeSaveButton.jqxButton({width:67,height:27,theme:e.VA.Env.Theme}),this.addNoticeSaveButton.on("click",function(t){var a=$(l).val(),n=i.addNoteControl.getValue();if(""!==a)if(i.addNoteControl.isEmpty())e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter content.",function(){i.addNoteControl.focus()});else if($("<div>").append(i.addNoteControl.getValue()).text().length>2e3)e.VA.Core.Utils.WidgetUtils.openErrorDialog("Description should be less than or equal to 2000 characters.");else{var r={id:e.VA.Core.Utils.IDGenerator.notice.id(),title:a,content:n,creator:e.VA.Env.Session.userId};e.Admin.Send.addNotice(r,function(){i.checkDialog("Success","Notice has been created."),i.changePerspective(),i.refreshNoticeData(),$(l).val(""),i.addNoteControl.clear()})}else e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter title.",function(){i.$mainControl.find(".brtc-admin-input.add-notice-title").focus()})})},i.prototype.createDescriptionControl=function(t,i,a){var n={height:500,description:i,okButton:a,maxLength:2e3,toolbar:this.options.toolbar};return $(".note-statusbar").hide(),e.VA.Core.Widget.Factory.noteControl(t,n)},i.prototype.createModifyNoticePerspective=function(){this.$modifyNoticeArea=$('<article class="brtc-admin-modify-notice">   <h2>Edit Notice</h2>   <div class="brtc-admin-modify-notice-area"></div></article>'),this.$mainControl.append(this.$modifyNoticeArea),this.createModifyNoticeFormGroup()},i.prototype.createModifyNoticeFormGroup=function(){var i=this,a=this.$modifyNoticeArea.find(".brtc-admin-modify-notice-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">    <div class="brtc-float-right">       <input type="button" class="brtc-admin-button modify-notice cancel" value="Cancel">       <input type="button" class="brtc-admin-button modify-notice save" value="Save">    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <input type="text" name="title" class="brtc-admin-input modify-notice-title" maxlength="200" placeholder="Enter title." maxlength="80" required/></td>'),d=t.WidgetUtils.createTableRow("Title",o,!0);r.append(d),t.InputValidator.appendValidationCondition(o.find(".modify-notice-title")),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(o.find(".modify-notice-title"));var s=$('<td colspan="3" style="width: 770px; !important">   <div class="brtc-va-dialogs-editresourcedialog-description-container modify" style="width: 770px; !important;"/></td>');s.find(".brtc-va-dialogs-editresourcedialog-description-container.modify .note-statusbar").hide();var c=t.WidgetUtils.createTableRow("Content",s,!0);r.append(c),this.modifyNoteControl=this.createDescriptionControl(s.find(".brtc-va-dialogs-editresourcedialog-description-container.modify"),"",$(".brtc-admin-button.modify-notice.save")),this.modifyNoticeCancelButton=a.find(".brtc-admin-button.modify-notice.cancel"),this.modifyNoticeCancelButton.jqxButton({width:67,height:27,theme:e.VA.Env.Theme}),this.modifyNoticeCancelButton.on("click",function(){i.changePerspective(),i.modifyNoteControl.clear()}),this.modifyNoticeSaveButton=a.find(".brtc-admin-button.modify-notice.save"),this.modifyNoticeSaveButton.jqxButton({width:67,height:27,theme:e.VA.Env.Theme}),this.modifyNoticeSaveButton.on("click",function(){var t=a.find(".brtc-admin-input.modify-notice-title"),n=$(t).val(),r=i.modifyNoteControl.getValue(),o={id:i.selectedDetailNotice.id,title:n,content:r,updater:e.VA.Env.Session.userId};if($("<div>").append(i.modifyNoteControl.getValue()).text().length>2e3)e.VA.Core.Utils.WidgetUtils.openErrorDialog("Description should be less than or equal to 2000 characters.");else if(""!==n)if(i.modifyNoteControl.isEmpty())e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter content.",function(){i.modifyNoteControl.focus()});else{e.Admin.Send.updateNotice(o,function(){i.checkDialog("Success","Notice has been updated."),i.changePerspective(),i.refreshNoticeData(),i.modifyNoteControl.clear()})}else e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter title.",function(){i.$mainControl.find(".brtc-admin-input.modify-notice-title").focus()})})},i.prototype.checkDialog=function(e,i){var a={title:e,contentText:i};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},e.Admin.NoticeManagement=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(e,t){this.parentId=e,this.options=t,this.datafields=[{name:"publish_id",type:"string"},{name:"publishing_title",type:"string"},{name:"publishing_date",type:"date"},{name:"publisher",type:"string"},{name:"schedule",type:"string"},{name:"embed_code",type:"string"},{name:"link",type:"string"},{name:"project_id",type:"string"},{name:"model_id",type:"string"}],this.datatype="array",this.searchData={scheduleActive:!0,scheduleError:!0,scheduleInactive:!0,publishingTitle:""},this.retrieveParent(),this.createControls(),this.registerEventListener()}i.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-publish"),this.createListArea()},i.prototype.createListArea=function(){this.$listArea=$("article.brtc-admin-publish-list"),this.createDataArea(this.$listArea.find(".brtc-admin-data-area"))},i.prototype.createDataArea=function(e){this.createSumArea(e),this.createDataControlArea(e)},i.prototype.createSumArea=function(t){var i=this,a=$('<div class="tb_view_st">   <span>Total<strong class="brtc-admin-total-count"></strong></span>   <div class="brtc-admin-dropdown-count"></div></div>');t.append(a);a.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),a.find(".brtc-admin-dropdown-count").on("select",function(t){var n=t.args,r=a.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index);null!=r&&(i.$publishGrid.jqxGrid({pagesize:r.value}),e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$publishGrid))})},i.prototype.createDataControlArea=function(e){var t=this,i=$('<div class="tb_headview"></div>');e.append(i),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){t.$publishGrid.jqxGrid("clearselection")}),this.createDataGrid($(".tb_headview"))},i.prototype.createDataGrid=function(i){var a=this;this.$publishGrid=$('<div class="brtc-admin-body-grid-publish"></div>'),i.append(this.$publishGrid),this.$publishGrid.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:521,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columnsresize:!1,selectionmode:"none",autoheight:!0,columns:[{text:"Title",datafield:"publishing_title",width:"20%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"brtc-grid-cell-bold",cellsrenderer:t.WidgetUtils.cellRendererLeft},{text:"Publishing Date",datafield:"publishing_date",width:"20%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsalign:"center",cellsformat:"yyyy-MM-dd HH:mm:ss"},{text:"Publisher",datafield:"publisher",width:"20%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Schedule",datafield:"schedule",width:"auto",align:"center",renderer:a.scheduleHeaderRenderer,cellsrenderer:a.scheduleRenderer},{text:"Embed Code",datafield:"embed_code",width:"100px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:function(e,t,i){return'<div class="brtc-float-left" index="'+e+'">    <button class="brtc-admin-button toggle embed-code">Copy</button></div>'}},{text:"Link",datafield:"link",width:"100px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"pointer",cellsrenderer:function(e,t,i){return'<div class="brtc-float-left" index="'+e+'">    <button class="brtc-admin-button toggle link">Copy</button></div>'}}]}),this.$publishGrid.on("pagechanged",function(t){e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.$publishGrid.on("cellclick",function(e){var t=a.options.subPath?"/"+a.options.subPath:"";if("embed_code"===e.args.datafield){var i=a.$publishGrid.jqxGrid("getrowdata",e.args.rowindex),n='<iframe style="width:900px; height:600px;" src="'+location.origin+t+"/publish/"+i.publish_id+"?title="+i.publishing_title+'"></iframe>';if(!!window.chrome&&!!window.chrome.webstore)(r=document.createElement("textarea")).innerText=n,document.body.appendChild(r),r.select(),document.execCommand("copy"),r.remove();!!document.documentMode&&window.clipboardData.setData("Text",n),a.checkDialog({title:"",message:"Embed code is copied to clipboard."})}else if("link"===e.args.datafield){var r;i=a.$publishGrid.jqxGrid("getrowdata",e.args.rowindex),n=location.origin+t+"/publish/"+i.publish_id+"?title="+i.publishing_title;if(!!window.chrome&&!!window.chrome.webstore)(r=document.createElement("textarea")).innerText=n,document.body.appendChild(r),r.select(),document.execCommand("copy"),r.remove();!!document.documentMode&&window.clipboardData.setData("Text",n),a.checkDialog({title:"",message:"Link is copied to clipboard."})}}),e.Admin.Send.getAllPublish(this.publishCallback.bind(this))},i.prototype.refreshPublishData=function(){e.Admin.Send.getAllPublish(this.publishCallback.bind(this))},i.prototype.checkDialog=function(e){var i={title:e.title,contentText:e.message};e.close&&(i.close=e.close),t.WidgetUtils.createAdminConfirmDialog(this.$parent,i)},i.prototype.registerEventListener=function(){var e=this,t=$(".brtc-admin-publish-search-schedule").find("input[type=checkbox][value=all]"),i=$(".brtc-admin-publish-search-schedule").find("input[type=checkbox][value=active]"),a=$(".brtc-admin-publish-search-schedule").find("input[type=checkbox][value=error]"),n=$(".brtc-admin-publish-search-schedule").find("input[type=checkbox][value=inactive]");t.click(function(){$(this).is(":checked")?(i.prop("checked",!0),a.prop("checked",!0),n.prop("checked",!0)):(i.prop("checked",!1),a.prop("checked",!1),n.prop("checked",!1))}),i.click(function(){$(this).is(":checked")?a.is(":checked")&&n.is(":checked")&&t.prop("checked",!0):t.prop("checked",!1)}),a.click(function(){$(this).is(":checked")?i.is(":checked")&&n.is(":checked")&&t.prop("checked",!0):t.prop("checked",!1)}),n.click(function(){$(this).is(":checked")?i.is(":checked")&&a.is(":checked")&&t.prop("checked",!0):t.prop("checked",!1)}),$(".brtc-admin-publish-search-publishing-title").keydown(function(t){13==t.keyCode&&($(this).trigger("focusout"),e.filteringPublishData())}),$(".brtc-admin-publish-search-button-clear").click(function(){$(".brtc-admin-publish-search").find("input[type=text]").val(""),t.prop("checked",!0),i.prop("checked",!0),a.prop("checked",!0),n.prop("checked",!0),e.resetSearchData(),e.filteringPublishData()}),$(".brtc-admin-publish-search-button-search").click(function(){e.filteringPublishData()}),$(".reload").click(function(){e.filteringPublishData()})},i.prototype.resetSearchData=function(){this.searchData={scheduleActive:!0,scheduleError:!0,scheduleInactive:!0,publishingTitle:""}},i.prototype.setSearchData=function(){var e=$(".brtc-admin-publish-search-schedule").find("input[type=checkbox][value=active]"),t=$(".brtc-admin-publish-search-schedule").find("input[type=checkbox][value=error]"),i=$(".brtc-admin-publish-search-schedule").find("input[type=checkbox][value=inactive]"),a=$(".brtc-admin-publish-search-publishing-title");this.searchData={scheduleActive:e.is(":checked"),scheduleError:t.is(":checked"),scheduleInactive:i.is(":checked"),publishingTitle:a.val().trim()}},i.prototype.filteringPublishData=function(){this.setSearchData();var e=new $.jqx.filter,t=this.searchData.publishingTitle,i=e.createfilter("stringfilter",t,"contains");e.addfilter(1,i),this.$publishGrid.jqxGrid("addfilter","publishing_title",e),this.$publishGrid.jqxGrid("applyfilters"),this.setRowCount()},i.prototype.setRowCount=function(){var t=this.$publishGrid.jqxGrid("getrows");$(".brtc-admin-total-count").text(t.length),e.VA.Core.Utils.WidgetUtils.updatePageButton(this.$publishGrid)},i.prototype.publishCallback=function(t,i){var a=this;e.Admin.Send.getIp(function(n){this.ip=n;var r={localdata:function(e,t){for(var i in e){var a,n=0,r=0,o=0,d=JSON.parse(e[i].publishing_contents).contents.functions;for(var s in d)if(d[s].param.scheduleId&&""!=d[s].param.scheduleId){var c=d[s].param.scheduleId;for(var l in t){var u=t[l];c===u.scheduleId&&("error"===u.scheduleStatus.toLowerCase()?n++:"y"===u.isActive.toLowerCase()?r++:o++)}}a=n+"/"+r+"/"+o,e[i].schedule=a}return e}(t,i),datafields:this.datafields,datatype:this.datatype};e.VA.Core.Utils.WidgetUtils.updateGridSource(a.$publishGrid,r),this.publishList=t,this.$listArea.find(".brtc-admin-total-count").text(t.length)}.bind(this))},i.prototype.scheduleHeaderRenderer=function(e){return'<div style="margin-left: 50px; margin-top: 11px; font-family: Arial, Dotum, Tahoma, sans-serif; font-size: 12px; text-align: center; float: left;" title="Schedule">'+e+'</div><div class="brtc-admin-publish-icon-info" style="margin-top: 6px;" title="error/ active/ inactive"></div>'},i.prototype.scheduleRenderer=function(e,t,i){var a=i.split("/");return'<div style="float: left; margin-left: 65px; height:32px; line-height:32px; color:red;">'+a[0]+'</div><div style="float: left; margin-left: 5px; margin-right: 5px; height:32px; line-height:32px;"> / </div><div style="float: left; height:32px; line-height:32px; color:green;">'+a[1]+'</div><div style="float: left; margin-left: 5px; margin-right: 5px; height:32px; line-height:32px;"> / </div><div style="float: left; height:32px; line-height:32px; color:grey;">'+a[2]+"</div>"},i.prototype.checkDialog=function(e){var i={title:e.title,contentText:e.message};e.close&&(i.close=e.close),t.WidgetUtils.createAdminConfirmDialog(this.$parent,i)},e.Admin.PublishManagement=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(t,i){this.parentId=t,this.options=i,e.VA.Env.Session.userId=i.userId,this.retrieveParent(),this.createControls()}i.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,this.openScheduleReport(this.options.scheduleId,this.options.taskId)},i.prototype.openScheduleReport=function(t,i){var a=this,n={url:"api/admin/v2/schedules/"+t+"/tasks/"+i,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(n).done(function(t){if(null!==t.result.reportContents){var i=JSON.parse(t.result.reportContents);for(var n in i);var r={contents:{report:i[n]}};a.reportManager=new e.VA.Core.ReportManager(r),a.createReportToolItem(),a.reportManager.render()}}).fail(function(e){})},i.prototype.createReportToolItem=function(){var e=this.$parent;this.$reportWindow=$('   <div class="brtc-va-editors-modeleditor-report-window">       <div class="brtc-va-editors-modeleditor-report-window-head">           <span class="brtc-va-editors-modeleditor-report-window-head-title">Report</span>       </div>       <div class="brtc-va-editors-modeleditor-report-window-body">          <div class="brtc-va-editors-modeleditor-report-element-container"></div>       </div>   </div>'),e.append(this.$reportWindow),this.reportManager.initReportViewer(this.$reportWindow)},i.prototype.checkDialog=function(e,i){var a={title:e,contentText:i};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},e.Admin.ReportManagement=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(t,i){this.parentId=t,this.options=i,e.VA.Env.Session.userId=i.userId,this.retrieveParent(),this.createControls()}i.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-res-monitoring"),this.createWorksheetPanel()},i.prototype.createWorksheetPanel=function(){this.$contentsArea=$('<article>   <h2>Resource Monitoring</h2>   <div class="brtc-admin-header-form">   </div>   <div class="brtc-monitoring-set master"><p></p></div>   <hr>   <div class="brtc-monitoring-set worker"><p></p></div></article>'),this.$infoMsg=$('<article>   <h2>Resource Monitoring</h2>   <div class="brtc-monitoring-info-msg">There is no active agent.</div></article>'),this.$mainControl.append(this.$contentsArea),this.$mainControl.append(this.$infoMsg),this.$infoMsg.hide(),this.checkSchema()},i.prototype.checkSchema=function(){var e=this;$.ajax(e._checkTableSchema()).done(function(t){0==t?(e.$contentsArea.hide(),e.$infoMsg.show()):(e.createChart(this.$contentsArea),e.pidsOfDemon=-1)})},i.prototype.createChart=function(){var e=this;$.ajax(this._getDemonPids()).done(function(t){_.isEqual(t,e.pidsOfDemon)?e.bindChartData():(e.pidsOfDemon=t,$.ajax(e._getDemonInfo()).done(function(t){0==t.length?(e.$contentsArea.hide(),e.$infoMsg.show()):(e.$contentsArea.show(),e.$infoMsg.hide());var i=[];e.chartMap={},e.$mainControl.find(".brtc-monitoring-chart-set").remove(),e.$contentsArea.find(".brtc-monitoring-search-agent").remove();var a=0,n=0;for(var r in t){var o,d=t[r].type,s=t[r].appNm,c=100*t[r].coreNum,l=t[r].pid;"AGENT"==d?(o=s,a++):(o=s+"<br>("+t[r].host+")",n++),e.chartMap[l]=e.addChartSet(o,d,c),i[s]?i[s].value.push(l):i[s]={label:s,value:[l]}}e.$contentsArea.find(".brtc-monitoring-set.master>p").text("Master ("+a+")"),e.$contentsArea.find(".brtc-monitoring-set.worker>p").text("Workers ("+n+")"),e.createHeaderForm(e.$contentsArea.find(".brtc-admin-header-form"),i),e.bindChartData()})),setTimeout(e.createChart.bind(e),2e3)})},i.prototype.createHeaderForm=function(t,i){var a=this,n=$('<div class="brtc-monitoring-search-agent">   <div class="brtc-monitoring-search appid"></div></div>');t.append(n);var r=["ALL"];for(var o in i)r.push(i[o]);var d=n.find(".brtc-monitoring-search.appid"),s={theme:e.VA.Env.Theme,enableBrowserBoundsDetection:!0,animationType:"none",selectedIndex:0,width:"300px",source:r,openDelay:0};s&&(s.source&&s.source.length>7?(s.autoDropDownHeight=!1,s.dropDownHeight=120):s.autoDropDownHeight=!0),d.jqxDropDownList(s),d.on("select",function(e){var t=0,i=0,n=e.args;if(n){var r=n.item,o=r.value,d=r.value;if("ALL"==o)for(var s in a.chartMap)a.chartMap[s].show(),a.chartMap[s].parent().hasClass("master")?t++:i++;else for(var s in a.chartMap)$.inArray(Number(s),d)>-1?(a.chartMap[s].show(),a.chartMap[s].parent().hasClass("master")?t++:i++):a.chartMap[s].hide();a.$contentsArea.find(".brtc-monitoring-set.master>p").text("Master ("+t+")"),a.$contentsArea.find(".brtc-monitoring-set.worker>p").text("Workers ("+i+")"),a.bindChartData()}})},i.prototype.addChartSet=function(e,t,i){var a=e.replace("<br>","&#013;"),n=$('<div class="brtc-monitoring-chart-set">   <div class="brtc-monitoring-appname" title='+a+">"+e+'</div>   <div class="brtc-monitoring-chart cpu"></div>   <div class="brtc-monitoring-chart mem"></div></div>'),r={grid:{bottom:"28px",top:"20px",left:"60px",right:"20px"},chart:{animationDuration:0,type:"line",border:"1px #000000"},xAxis:[{selected:[{name:"date"}],axisLabel:{show:!1},axisTick:{show:!1},title:{show:!0,left:"80%",textStyle:{fontSize:"11px"},text:"Time (Last 5 minutes)"}}],yAxis:[{selected:[{name:"cpu",aggregation:"none"}],axisLabel:{textStyle:{fontSize:"7px"}},axisTick:{show:!1},title:{show:!0,left:"1",textStyle:{fontSize:"11px"}},max:i,min:0}],tooltip:{triggerOn:"click"},toolbar:{type:"custom",show:!1}};r.source=this.getDataSrc([[]]),"AGENT"==t?this.$mainControl.find(".brtc-monitoring-set.master").append(n):this.$mainControl.find(".brtc-monitoring-set.worker").append(n);try{n.find(".brtc-monitoring-chart.cpu").bcharts(r),n.find(".brtc-monitoring-chart.mem").bcharts(r)}catch(e){console.error(e)}return n},i.prototype._checkTableSchema=function(){return{url:"api/admin/v2/monitor/check?type=res",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}},i.prototype._getDemonPids=function(){return{url:"api/admin/v2/monitor/resource/pids",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}},i.prototype._getDemonInfo=function(){return{url:"api/admin/v2/monitor/resource/info",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}},i.prototype._getDataOption=function(){return{url:"api/admin/v2/monitor/resource/status?time=5",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}},i.prototype.getDataSrc=function(e){return{localData:[{dataType:"rawdata",columns:[{name:"host",type:"string",internalType:"String"},{name:"pid",type:"number",internalType:"Double"},{name:"date",type:"date"},{name:"cpu",type:"number",internalType:"Double"},{name:"mem",type:"number",internalType:"Double"}],data:e}]}};var a=function(e){return moment(e).format("YYYY-MM-DD HH:mm:ss")};i.prototype.bindChartData=function(){var e=this;$.ajax(this._getDataOption()).done(function(t){var i={};for(var n in t.map(function(e){n=e.pid,i[n]?i[n].push([e.host,e.pid,a(e.date),e.cpu,e.heapMem]):i[n]=[[e.host,e.pid,a(e.date),e.cpu,e.heapMem]]}),e.chartMap)["cpu","mem"].map(function(t){var a=$(e.chartMap[n].find(".brtc-monitoring-chart."+t));if(a.is(":visible")){var r=a.bcharts("getOptions");a.bcharts("setOptions",$.extend(!0,{},r,{source:e.getDataSrc(i[n])},{yAxis:[{selected:[{name:t,aggregation:"none"}],max:"mem"==t?100:r.yAxis[0].max,title:{text:"mem"==t?"Memory %":"CPU %"}}],title:{text:"mem"==t?"Memory Utilization":"CPU Utilization (100% = 1Core)"}}))}})})},e.Admin.ResourceMonitorManagement=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(e,t){this.parentId=e,this.options=t,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls()}i.prototype.retrieveParent=function(){this.$parent=e.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){var t=this;this.$mainControl=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-header">       <div class="brtc-va-dialogs-header-title" style="font-size: 20px !important;">Schedule History</div>   </div>   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">       </div>   </div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$mainControl.jqxWindow({theme:e.VA.Env.Theme,width:920,height:700,minWidth:900,minHeight:700,maxWidth:1024,maxHeight:700,isModal:!0,resizable:!0,initContent:function(){t.createDialogButtonBar(t.$mainControl.find(".brtc-va-dialogs-buttonbar")),t.createDialogContentsArea(t.$mainControl.find(".brtc-va-dialogs-contents"))}}),this.$mainControl.on("close",function(e){t.$mainControl.jqxWindow("destroy"),t.$mainControl.remove(),"function"==typeof t.options.close&&t.options.close(t.dialogResult)})},i.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-admin-dialogs-schedule-history-header">   <div class="brtc-admin-dialogs-schedule" style="display:flex;">       <div class="brtc-admin-dialogs-label">Schedule Name</div>       <input type="text" class="brtc-admin-dialogs-scheduename-input">   </div>   <div class="tb_view_st">       <span>Total<strong class="brtc-admin-total-count-history"></strong></span>       <div class="brtc-admin-dropdown-count"></div>   </div></div><div class="brtc-admin-dialogs-schedule-history-body">   <div class="brtc-admin-dialogs-schedule-history-grid"></div>   <div class="brtc-admin-dialogs-schedule-history-grid-context">       <ul>           <li action="copy columns" style="color: #6c7290; background-color: transparent;">Copy jobid to clipboard</li>       </ul>   </div></div>'),t.find(".brtc-admin-dialogs-scheduename-input").jqxInput({theme:e.VA.Env.Theme,disabled:!0,value:this.options.scheduleName}),t.find(".brtc-admin-dialogs-scheduename-input").prop("title",this.options.scheduleName),this.createHistorySumArea(t),this.createScheduleHistoryDataArea(t),this.refreshScheduleHistoryData()},i.prototype.createDialogButtonBar=function(t){var i=this;this.$closeButton=$('<input type="button" class="brtc-admin-dialogs-buttonbar-close" value="Done" />'),t.append(this.$closeButton),this.$closeButton.jqxButton({theme:e.VA.Env.Theme}),this.$closeButton.on("click",function(){i.dialogResult.OK=!0,i.dialogResult.Cancel=!1,i.$mainControl.jqxWindow("close")})},i.prototype.createHistorySumArea=function(t){var i=this;t.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),t.find(".brtc-admin-dropdown-count").on("select",function(a){var n=a.args,r=t.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index);null!=r&&(i.$scheduleHistoryData.jqxGrid({pagesize:r.value}),e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$scheduleHistoryData))})},i.prototype.refreshScheduleHistoryData=function(t){var i=this,a=e.VA.Core.Utils.WidgetUtils.createProgressDialog($("body"),{title:"Loading..."}),n={url:"api/admin/v2/schedules/"+this.options.scheduleId+"/histories",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(n).done(function(t){i.historyData=t;var a={localdata:t,datatype:"array",datafields:[{name:"scheduleId",type:"string"},{name:"scheduleName",type:"string"},{name:"eventTime",type:"date"},{name:"eventUser",type:"string"},{name:"scheduleType",type:"string"},{name:"scheduleStatus",type:"string"},{name:"cronExpression",type:"string"},{name:"isActive",type:"string"},{name:"jobId",type:"string"},{name:"dependencyId",type:"string"}]};e.VA.Core.Utils.WidgetUtils.updateGridSource(i.$scheduleHistoryData,a),i.$mainControl.find(".brtc-admin-total-count-history").text(t.length)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){a.jqxWindow("close")})},i.prototype.createScheduleHistoryDataArea=function(i){var a=this;this.$scheduleHistoryData=i.find(".brtc-admin-dialogs-schedule-history-grid").jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:"calc(100% - 60px)",altrows:!1,filterable:!1,sortable:!0,columnsresize:!1,showfiltercolumnbackground:!1,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,showfiltermenuitems:!0,autoshowfiltericon:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,selectionmode:"none",columns:[{text:"Schedule Id",datafield:"scheduleId",width:"130px",hidden:!0},{text:"Schedule Name",datafield:"scheduleName",width:"130px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer,cellclassname:"brtc-grid-cell-bold pointer"},{text:"Event Time",datafield:"eventTime",width:"150px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsalign:"center",cellclassname:"pointer",cellsformat:"yyyy-MM-dd HH:mm:ss"},{text:"Event User",datafield:"eventUser",width:"auto",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"pointer",cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Type",datafield:"scheduleType",width:"100",align:"center",hidden:!0,cellclassname:"pointer",cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Status",datafield:"scheduleStatus",width:"100",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"pointer",cellsrenderer:a.historyCellsrenderer},{text:"Cron Expression",datafield:"cronExpression",width:"150px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"pointer",cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Is Active",datafield:"isActive",width:"100px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"pointer",cellsrenderer:t.WidgetUtils.cellRenderer},{text:"JOB ID",datafield:"jobId",width:"200px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Dependency Schedule",datafield:"dependencyId",width:"150px",align:"center",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer}]}),this.$scheduleHistoryData.on("pagechanged",function(t){e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.$scheduleHistoryData.on("cellclick",function(t){if(t.args.rightclick){if("jobId"===t.args.datafield&&null!=t.args.row.bounddata.jobId){a.$scheduleHistoryData.jqxGrid("selectrow",t.args.rowindex);var i=$(window).scrollTop(),n=$(window).scrollLeft();a.$contextMenu.jqxMenu("open",parseInt(t.args.originalEvent.clientX)+5+n,parseInt(t.args.originalEvent.clientY)+5+i),a.selectedJobId=t.args.row.bounddata.jobId}}else if("scheduleStatus"==t.args.datafield&&"ERROR"===t.args.row.bounddata.scheduleStatus){var r=a.historyData[t.args.rowindex].errorMessage;if(r)e.VA.Core.Utils.WidgetUtils.openErrorDialog(r);else if(t.args.row.bounddata.jobId){var o={url:"api/admin/v2/schedules/"+t.args.row.bounddata.scheduleId+"/jobs/"+t.args.row.bounddata.jobId,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(o).done(function(t){e.VA.Core.Utils.WidgetUtils.openErrorDialog(t.message)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}else e.VA.Core.Utils.WidgetUtils.openErrorDialog("Error message does not exist.")}}),this.$contextMenu=i.find(".brtc-admin-dialogs-schedule-history-grid-context"),this.$contextMenu.jqxMenu({theme:e.VA.Env.Theme,autoOpenPopup:!1,mode:"popup",width:170,popupZIndex:18010}),this.$contextMenu.on("itemclick",function(e){if("copy columns"==$(e.args).attr("action")){if(!!window.chrome&&!!window.chrome.webstore){var t=document.createElement("textarea");t.innerText=a.selectedJobId,document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove()}!!document.documentMode&&window.clipboardData.setData("Text",a.selectedJobId)}})},i.prototype.historyCellsrenderer=function(e,t,i){if("scheduleStatus"===t)return"SUCCESS"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status success">'+i+"</button></div>":"PROCESS"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status process">'+i+"</button></div>":"ERROR"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status-history error">'+i+"</button></div>":"START"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status start">'+i+"</button></div>":"STOP"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status stop">'+i+"</button></div>":"READY"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status ready">'+i+"</button></div>":'<div class="brtc-float-left status"><button class="brtc-admin-button status default">'+i+"</button></div>";var a=$('<div class="brtc-admin-body-grid-cell"></div>');return a.attr("title",i),a.text(i),$("<div>").append(a.clone()).html()},e.Admin.ScheduleHistoryDialog=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils,i=brtc_require("ResourceManager"),a=brtc_require("Dao");function n(t,i){this.parentId=t,this.options=i,this.fileList={},this.projectList={},this.modelFileContents,this.modelDBContents,this.reportContents,this.isChangeContent=!1,e.VA.Env.Session.userId=i.userId,this.retrieveParent(),this.createControls(),this.changePerspective()}n.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},n.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-schedule"),this.createScheduleListArea(),this.createDetailSchedulePerspective(),this.createAddSchedulePerspective(),this.createModifySchedulePerspective()},n.prototype.createDeleteConfirmDialog=function(i,a){var n=this,r=n.$scheduleGrid.jqxGrid("getselectedrowindexes");for(var o in r){var d=n.$scheduleGrid.jqxGrid("getrowdata",r[o]);for(var s in n.data)if(d.scheduleId===n.data[s].dependencyId){var c={type:"error",title:"Error",contentText:"This schedule ["+d.scheduleName+"] is being used as a dependency in schedule ["+n.data[s].scheduleName+"]",isCancel:!0,okLabel:"Force Delete",cancelLabel:"Close",close:function(e){e.OK&&n.createForceDeleteConfirmDialog(d)}};return void t.WidgetUtils.createAdminConfirmDialog(n.$parent,c)}}var l={title:"",contentText:void 0===a?"Are you sure you want to delete?":"Are you sure you want to delete "+a.length+" selected schedules?",close:function(a){if(a.OK)if(i)$.ajax({url:"api/admin/v2/schedules/"+n.selectedItem.scheduleId+"/delete",type:"POST",data:JSON.stringify(n.selectedItem),contentType:"application/json; charset=utf-8"}).done(function(){n.checkDialog("Success","Schedule has been deleted."),n.changePerspective(),n.refreshScheduleData()}).fail(function(i){if(0==i.responseJSON.errors[0].message.indexOf("Cannot delete scheduler. The schedule is being used as a dependency in")){var a={type:"error",title:"Error",contentText:i.responseJSON.errors[0].message,isCancel:!0,okLabel:"Force Delete",cancelLabel:"Close",close:function(e){e.OK&&n.createForceDeleteConfirmDialog(n.selectedItem)}};t.WidgetUtils.createAdminConfirmDialog(n.$parent,a)}else e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(i)});else{var r=n.$scheduleGrid.jqxGrid("getselectedrowindexes"),o=0,d=[];for(var s in r){var c=n.$scheduleGrid.jqxGrid("getrowdata",r[s]);d.push("["+c.scheduleName+"]"),$.ajax({url:"api/admin/v2/schedules/"+c.scheduleId+"/delete",type:"POST",data:JSON.stringify(c),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&o++,o===r.length&&(n.checkDialog("Success","("+d.length+") Schedule(s) has been deleted."),n.refreshScheduleData())}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}}},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,l)},n.prototype.createAbortConfirmDialog=function(i){var a=this,n={title:"Abort Confirmation",contentText:"These items will be permanently aborted and cannot be recovered. Are you sure?",close:function(n){n.OK&&$.ajax({url:"api/admin/v2/schedules/"+i.scheduleId+"/abort",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&(a.checkDialog("Success","Schedule [ "+i.scheduleName+" ] has been aborted."),a.refreshScheduleData())}).fail(function(n){if("This job Id does not exist."===n.responseJSON.errors[0].message){var r={type:"error",title:"Error",contentText:n.responseJSON.errors[0].message,isCancel:!0,okLabel:"Change to READY",cancelLabel:"Close",close:function(e){e.OK&&a.createForceReadyConfirmDialog(i)}};t.WidgetUtils.createAdminConfirmDialog(a.$parent,r)}else e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(n)})},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,n)},n.prototype.createForceReadyConfirmDialog=function(i){var a=this,n={title:"Force Change Confirmation",contentText:"This schedule will be changed to 'READY' status. Are you sure?",close:function(t){t.OK&&$.ajax({url:"api/admin/v2/schedules/"+i.scheduleId+"/forceready",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&(a.checkDialog("Success","Schedule [ "+i.scheduleName+" ] status has been changed to READY status."),a.refreshScheduleData())}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,n)},n.prototype.createForceDeleteConfirmDialog=function(i){var a=this,n={title:"Force Delete Confirmation",contentText:"Schedule ["+i.scheduleName+"] will be deleted regardless of dependency and cannot be recovered. Are you sure?",close:function(t){t.OK&&$.ajax({url:"api/admin/v2/schedules/"+i.scheduleId+"/forcedelete",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&(a.checkDialog("Success","Schedule [ "+i.scheduleName+" ] has been deleted."),a.changePerspective(),a.refreshScheduleData())}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,n)},n.prototype.createScheduleListArea=function(){this.$scheduleListArea=$('<article>   <h2>Schedule</h2>   <div class="brtc-admin-header-form">   </div>   <div class="cont_box stmt30 brtc-admin-data-area"></div></article>'),this.$mainControl.append(this.$scheduleListArea),this.createHeaderForm(this.$scheduleListArea.find(".brtc-admin-header-form")),this.createDataArea(this.$scheduleListArea.find(".brtc-admin-data-area"))},n.prototype.createHeaderForm=function(t){var i=this,a=$('<table class="brtc-admin-search-table">   <colgroup>      <col style="width:100px;">      <col style="width:300px;">   </colgroup>   <tbody>       <tr>           <th class="brtc-admin-schedule-label">Schedule</th>           <td>               <input type="text" class="brtc-admin-filter-input" style="width: 98%;margin-top: 2px; height: 25px !important;" valid-type="type2" maxlength="80" placeholder="Enter schedule"/>           </td>           <th class="brtc-admin-schedule-label">Status</th>           <td>               <div class="brtc-admin-dropdown scheduleStatus"/>               <div class="brtc-search-button-box" style="margin-top: 0px !important;">                   <div class="brtc-float-right">                       <button class="brtc-admin-button search-area clear" value="clear">Clear</button>                       <button class="brtc-admin-button search-area search" value="search">Search</button>                   </div>               </div>           </td>       </tr>   </tbody></table>');t.append(a);var n=a.find(".brtc-admin-filter-input");n.jqxInput({theme:e.VA.Env.Theme}),n.keydown(function(t){13==t.keyCode&&($(this).trigger("focusout"),""===n.val()&&""===r.val()?(i.$scheduleGrid.jqxGrid("clearfilters"),i.setRowCount()):i.addFilter(),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(i.$scheduleGrid))});var r=a.find(".brtc-admin-dropdown.scheduleStatus");r.jqxDropDownList({theme:e.VA.Env.Theme,width:"280px",source:["ALL","CREATE","MODIFY","READY","START","PROCESS","SUCCESS","ERROR","ABORT","STOP"],selectedIndex:0}),a.find(".brtc-admin-button.clear").jqxButton({theme:e.VA.Env.Theme}),a.find(".brtc-admin-button.clear").click(function(){n.val(""),r.jqxDropDownList("selectIndex",0),i.$scheduleGrid.jqxGrid("clearfilters"),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(i.$scheduleGrid),i.setRowCount()}),a.find(".brtc-admin-button.search").jqxButton({theme:e.VA.Env.Theme}),a.find(".brtc-admin-button.search").click(function(){""===n.val()&&"ALL"===r.val()?(i.$scheduleGrid.jqxGrid("clearfilters"),i.setRowCount()):(i.$scheduleGrid.jqxGrid("clearfilters"),i.addFilter()),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(i.$scheduleGrid)}),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(n)},n.prototype.createDataArea=function(e){this.createSumArea(e),this.createDataControlArea(e)},n.prototype.createSumArea=function(t){var i=this,a=$('<div class="tb_view_st">   <span>Total<strong class="brtc-admin-total-count"></strong></span>   <div class="brtc-admin-dropdown-count"></div></div>');t.append(a);a.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),a.find(".brtc-admin-dropdown-count").on("select",function(t){var n=t.args,r=a.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index);null!=r&&(i.$scheduleGrid.jqxGrid({pagesize:r.value}),e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$scheduleGrid))})},n.prototype.createDataControlArea=function(t){var i=this,a=$('<div class="tb_choibox btn_box ctr01 choinone brtc-admin-choice">   <div class="ipstc brtc-admin-selected">       <input type="checkbox" id="cc1" value=""/>       <label for="cc1"><b>1</b> Row(s) selected.</label>   </div>   <div class="brtc-float-left active">       <button class="brtc-admin-button add" value="add" CRUD="C">Add</button>       <button class="brtc-admin-button delete" value="delete" CRUD="D">Delete</button>   </div>   <div class="brtc-float-right" style="padding-right: 10px;">       <button class="brtc-admin-button history" value="history">History</button>       <button class="brtc-admin-button reload" value="reload"><span class="fa fa-refresh"></span></button>   </div></div><div class="tb_choinone"></div><div class="tb_headview"></div>');t.append(a),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){i.$scheduleGrid.jqxGrid("clearselection")}),a.find(".add").jqxButton({theme:e.VA.Env.Theme}),a.find(".add").on("click",function(){i.changePerspective(this);var t=i.$addScheduleArea.find(".brtc-admin-dropdown.schedule-owner");$(t).val(e.VA.Env.Session.userId)}),a.find(".delete").jqxButton({theme:e.VA.Env.Theme}),a.find(".delete").on("click",function(){var e=i.$scheduleGrid.jqxGrid("getselectedrowindexes"),t=[];if(e.length>0){for(var a in e){var n=i.$scheduleGrid.jqxGrid("getrowdata",e[a]);t.push("["+n.scheduleName+"]")}i.createDeleteConfirmDialog(!1,t)}}),a.find(".history").jqxButton({theme:e.VA.Env.Theme}),a.find(".history").on("click",function(){var a=i.$scheduleGrid.jqxGrid("getselectedrowindexes"),n=i.$scheduleGrid.jqxGrid("getrowdata",a[0]);i.selectedItem=n,new e.Admin.ScheduleHistoryDialog(t,{scheduleId:n.scheduleId,scheduleName:n.scheduleName,close:function(){}})}),a.find(".reload").jqxButton({theme:e.VA.Env.Theme}),a.find(".reload").on("click",function(){i.refreshScheduleData()}),this.createDataGrid($(".tb_headview"))},n.prototype.setRowCount=function(){var t=this.$scheduleGrid.jqxGrid("getrows");this.$mainControl.find(".brtc-admin-total-count").text(t.length),e.VA.Core.Utils.WidgetUtils.updatePageButton(this.$scheduleGrid)},n.prototype.createDataGrid=function(i){var a=this;this.$scheduleGrid=$('<div class="brtc-admin-body-grid-schedule"></div>'),i.append(this.$scheduleGrid),this.$scheduleGrid.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:600,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columnsresize:!1,autoheight:!0,selectionmode:"checkbox",columns:[{text:"Schedule Name",datafield:"scheduleName",width:"auto",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRendererLeft,cellclassname:"brtc-grid-cell-bold"},{text:"Cron Expression",datafield:"cronExpression",width:"150px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Schedule Owner",datafield:"scheduleOwner",width:"auto",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Schedule Type",datafield:"scheduleType",width:"auto",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Start Time",datafield:"scheduleStartTime",width:"140px",align:"center",cellsalign:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsformat:"yyyy-MM-dd HH:mm:ss"},{text:"End Time",datafield:"scheduleEndTime",width:"140px",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsalign:"center",cellsformat:"yyyy-MM-dd HH:mm:ss"},{text:"Next Time",datafield:"scheduleNextTime",width:"140px",align:"center",cellsalign:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsformat:"yyyy-MM-dd HH:mm:ss"},{text:"Status",datafield:"scheduleStatus",width:"100",align:"center",cellclassname:"pointer",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:a.cellsrenderer},{text:"Is Active",datafield:"isActive",width:"auto",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Model Name",datafield:"fileId",width:"auto",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Project Name",datafield:"projectId",width:"auto",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Schedule Id",datafield:"scheduleId",width:"auto",hidden:!0},{text:"Contents",datafield:"executeContents",width:"auto",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Task ID",datafield:"taskId",width:"auto",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"Dependency Schedule",datafield:"dependencyId",width:"auto",hidden:!0,cellsrenderer:t.WidgetUtils.cellRenderer}]}),this.$scheduleGrid.on("rowselect",function(e){a.refreshDataControlButton()}),this.$scheduleGrid.on("rowunselect",function(e){a.refreshDataControlButton()}),this.$scheduleGrid.on("cellclick",function(e){0!==e.args.columnindex&&("scheduleStatus"!=e.args.datafield?(this.value="detail",a.changePerspective(this),a.setDetailScheduleInfo(a.$scheduleGrid.jqxGrid("getrowdata",e.args.rowindex))):("PROCESS"===e.args.row.bounddata.scheduleStatus&&a.createAbortConfirmDialog(e.args.row.bounddata),"START"===e.args.row.bounddata.scheduleStatus&&a.createForceReadyConfirmDialog(e.args.row.bounddata)))}),this.$scheduleGrid.on("pagechanged",function(t){e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.refreshScheduleData()},n.prototype.cellsrenderer=function(e,t,i){if("scheduleStatus"===t)return"SUCCESS"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status success">'+i+"</button></div>":"PROCESS"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status process">'+i+"</button></div>":"ERROR"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status error">'+i+"</button></div>":"START"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status start">'+i+"</button></div>":"STOP"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status stop">'+i+"</button></div>":"READY"===i?'<div class="brtc-float-left status"><button class="brtc-admin-button status ready">'+i+"</button></div>":'<div class="brtc-float-left status"><button class="brtc-admin-button status default">'+i+"</button></div>";var a=$('<div class="brtc-admin-body-grid-cell"></div>');return a.attr("title",i),a.text(i),$("<div>").append(a.clone()).html()},n.prototype.changePerspective=function(e){e?"add"===e.value?(this.$addScheduleArea.show(),this.$addScheduleArea.find(".brtc-admin-dropdown.projectname").jqxDropDownList("clear"),this.$addScheduleArea.find(".brtc-admin-dropdown.modelname").jqxDropDownList("clear"),this.$modifyScheduleArea.hide(),this.$detailScheduleArea.hide(),this.$scheduleListArea.hide()):"modify"===e.value?(this.$addScheduleArea.hide(),this.$modifyScheduleArea.show(),this.$detailScheduleArea.hide(),this.$scheduleListArea.hide()):"detail"===e.value?(this.$addScheduleArea.hide(),this.$modifyScheduleArea.hide(),this.$detailScheduleArea.show(),this.$scheduleListArea.hide()):"return"===e.value&&(this.$addScheduleArea.hide(),this.$modifyScheduleArea.hide(),this.$detailScheduleArea.hide(),this.$scheduleListArea.show()):(this.$addScheduleArea.hide(),this.$modifyScheduleArea.hide(),this.$detailScheduleArea.hide(),this.$scheduleListArea.show(),this.resetData())},n.prototype.refreshDataControlButton=function(){var e=this.$scheduleGrid.jqxGrid("getselectedrowindexes"),t=this.$mainControl.find(".brtc-admin-choice");e.length>1?(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-button.history").hide(),t.find(".brtc-admin-button.history").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0)):0===e.length?(t.removeClass("active"),t.find(".brtc-admin-button.add").show(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!0}),t.find(".brtc-admin-button.history").show(),t.find(".brtc-admin-button.history").jqxButton({disabled:!0}),t.find(".brtc-admin-selected").hide(),t.find(".brtc-admin-selected").find("b:first").hide()):(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-button.history").show(),t.find(".brtc-admin-button.history").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0))},n.prototype.refreshScheduleData=function(){var t=this;$("body").trigger("startProgress");$.ajax({url:"api/admin/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(i){$(".brtc-admin-dropdown.scheduleStatus").val("ALL"),$(".brtc-admin-filter-input").val(""),t.data=i;var a={localdata:i,datafields:[{name:"scheduleId",type:"string"},{name:"scheduleName",type:"string"},{name:"cronExpression",type:"string"},{name:"scheduleOwner",type:"string"},{name:"scheduleType",type:"string"},{name:"scheduleStartTime",type:"date"},{name:"scheduleEndTime",type:"date"},{name:"scheduleNextTime",type:"date"},{name:"scheduleStatus",type:"string"},{name:"executeContents",type:"string"},{name:"reportContents",type:"string"},{name:"isActive",type:"string"},{name:"fileId",type:"string"},{name:"projectId",type:"string"},{name:"taskId",type:"string"},{name:"dependencyId",type:"string"}],datatype:"array",sortcolumn:"scheduleName",sortdirection:"asc"};e.VA.Core.Utils.WidgetUtils.updateGridSource(t.$scheduleGrid,a),t.$mainControl.find(".brtc-admin-total-count").text(i.length),t.refreshDataControlButton(),t.$scheduleGrid.jqxGrid("clearselection"),t.setRowCount();for(var n=t.$parent.find(".brtc-admin-dropdown.dependencyId"),r=0;r<n.length;r++)$(n[r]).jqxDropDownList({source:i})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})},n.prototype.createDetailSchedulePerspective=function(){this.$detailScheduleArea=$('<article class="brtc-admin-detail-schedule">   <h2>Schedule Information</h2>   <div class="brtc-admin-detail-schedule-area"></div></article>'),this.$mainControl.append(this.$detailScheduleArea),this.createDetailScheduleFormGroup()},n.prototype.createDetailScheduleFormGroup=function(){var i=this,a=this.$detailScheduleArea.find(".brtc-admin-detail-schedule-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">   <div class="brtc-float-left">       <button class="brtc-admin-button detail-schedule list" value="list">List</button>   </div>    <div class="brtc-float-right">       <button class="brtc-admin-button detail-schedule delete" value="delete" CRUD="D">Delete</button>       <button class="brtc-admin-button detail-schedule modify" value="modify" CRUD="U">Edit</button>    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <input type="text" name="schedulname" class="brtc-admin-input schedule-name" placeholder="Enter schedule name." required/></td>'),d=t.WidgetUtils.createTableRow("Schedule Name",o);r.append(d);var s=$('<td colspan="3">   <input type="text" name="cron" class="brtc-admin-input cron-expression" placeholder="Enter cron expression." required/>   <div class="brtc-admin-schedule-cron-help"></div>   <div class="brtc-admin-schedule-cron-checkbox">IMMEDIATE</div></td>');s.find(".brtc-admin-schedule-cron-help").on("click",function(){window.open("cron-expression","Brightics Cron Expression Help")});var c=t.WidgetUtils.createTableRow("Cron Expression",s);r.append(c),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(s.find(".brtc-admin-input cron-expression"));var l=$('<td colspan="3">   <div class="brtc-admin-dropdown schedule-owner"></div></td>'),u=t.WidgetUtils.createTableRow("Schedule Owner",l);r.append(u),s.find(".brtc-admin-schedule-cron-checkbox").jqxCheckBox({theme:e.VA.Env.Theme,disabled:!0});var p=$('<td colspan="3">   <div class="brtc-admin-dropdown isactive"></div></td>'),h=t.WidgetUtils.createTableRow("Is Active",p);r.append(h);var m=$('<td colspan="3">   <div class ="brtc-admin-radio-local">Local</div>   <div class ="brtc-admin-radio-db">DB</div></td>'),f=t.WidgetUtils.createTableRow("Input Type",m);r.append(f);var b=$('<td colspan="3">   <div class="brtc-admin-local-file-area">       <div>           <button class="brtc-admin-button local" value="open-runnable-model">Open Runnable Model</button>           <input type="file" id="brtc-admin-upload-filename" name="fileToUpload" accept=".json"/>       </div>       <div class="brtc-selected-file-content">       </div>   </div>   <div class="brtc-admin-db-contents-area">       <div class="brtc-admin-db-select-area">           <div class="brtc-admin-dropdown projectname"/>           <div class="brtc-admin-dropdown modelname"/>           <div class="brtc-admin-dropdown modelversion"/>           <button class="brtc-admin-button content" value="add-model">Add Model</button>       </div>       <div class="brtc-selected-db-content">       </div>   </div></td>'),g=t.WidgetUtils.createTableRow("",b);r.append(g);var v=$('<td colspan="3">   <div class="brtc-admin-dropdown dependencyId"></div></td>'),y=t.WidgetUtils.createTableRow("Dependency Schedule",v);r.append(y),n.find(".brtc-admin-input.schedule-name").jqxInput({theme:e.VA.Env.Theme,disabled:!0}),n.find(".brtc-admin-input.cron-expression").jqxInput({theme:e.VA.Env.Theme,disabled:!0});var x=n.find(".brtc-admin-dropdown.schedule-owner");x.jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"id",valueMember:"id",placeHolder:"user id",disabled:!0});var w={url:"api/admin/v2/users",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(w).done(function(e){$.each(e,function(i,a){e[i].label=t.WidgetUtils.convertHTMLSpecialChar(a.label)}),x.jqxDropDownList({source:e})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}),n.find(".brtc-admin-dropdown.isactive").jqxDropDownList({theme:e.VA.Env.Theme,source:["Y","N"],selectedIndex:0,disabled:!0}),n.find(".brtc-admin-radio-local").jqxRadioButton({theme:e.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:"detail",checked:!0,disabled:!0}),n.find(".brtc-admin-radio-db").jqxRadioButton({theme:e.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:"detail",disabled:!0}),n.find(".brtc-admin-button.local").jqxButton({theme:e.VA.Env.Theme,height:"27px",disabled:!0}),n.find(".brtc-admin-dropdown.projectname").jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"label",valueMember:"id",placeHolder:"Project",disabled:!0}),n.find(".brtc-admin-dropdown.modelname").jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"label",valueMember:"id",placeHolder:"Model",disabled:!0});var D=n.find(".brtc-admin-dropdown.dependencyId");D.jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"scheduleName",valueMember:"scheduleId",placeHolder:"Schedule",disabled:!0}),n.find(".brtc-admin-dropdown.modelversion").jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"version_text",valueMember:"version_id",placeHolder:"Version",disabled:!0});w={url:"api/admin/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(w).done(function(e){$.each(e,function(i,a){e[i].scheduleId=t.WidgetUtils.convertHTMLSpecialChar(a.scheduleId)}),D.jqxDropDownList({source:e})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}),n.find(".brtc-admin-button.content").jqxButton({theme:e.VA.Env.Theme,disabled:!0});var A=a.find(".brtc-admin-button.detail-schedule.list");A.jqxButton({theme:e.VA.Env.Theme}),A.on("click",function(){i.changePerspective()});var C=a.find(".brtc-admin-button.detail-schedule.delete");C.jqxButton({theme:e.VA.Env.Theme}),C.on("click",function(){Object.keys(i.selectedItem).length>0&&i.createDeleteConfirmDialog(!0)});var U=a.find(".brtc-admin-button.detail-schedule.modify");U.jqxButton({theme:e.VA.Env.Theme}),U.on("click",function(){i.changePerspective(this),i.setModifyScheduleInfo(i.selectedItem)})},n.prototype.getFileVersionId=function(e){var t,i=e.models;for(var a in i)t=i[a].versionId;return t},n.prototype.getVersionInfo=function(e){return{name:e.modelVersion,id:e.modelVersionId}},n.prototype.setDetailScheduleInfo=function(t){var i=this;this.selectedItem=t;var a=this.$detailScheduleArea.find(".brtc-admin-input.schedule-name");$(a).val(t.scheduleName),$(a).prop("title",t.scheduleName);var n=this.$detailScheduleArea.find(".brtc-admin-input.cron-expression");$(n).val(t.cronExpression),$(n).prop("title",t.cronExpression);var r=this.$detailScheduleArea.find(".brtc-admin-schedule-cron-checkbox");"IMMEDIATE"===t.cronExpression?(n.jqxInput({disabled:!0}),r.jqxCheckBox({checked:!0})):r.jqxCheckBox({checked:!1});var o=this.$detailScheduleArea.find(".brtc-admin-dropdown.schedule-owner");$(o).val(t.scheduleOwner),$(o).prop("title",t.scheduleOwner);var d=this.$detailScheduleArea.find(".brtc-admin-dropdown.isactive");$(d).val(t.isActive),$(d).prop("title",t.isActive);var s=this.$detailScheduleArea.find(".brtc-admin-dropdown.dependencyId");if(""!==t.dependencyId&&s.jqxDropDownList("getItemByValue",t.dependencyId)){$(s).val(t.dependencyId);var c=$(s).jqxDropDownList("getSelectedItem").label;$(s).prop("title",c)}else s.jqxDropDownList("clearSelection");if(null===t.projectId)this.$detailScheduleArea.find(".brtc-admin-radio-local").jqxRadioButton({checked:!0}),this.handleLocalFileSelected(this.$detailScheduleArea,t.fileId,JSON.parse(t.executeContents)),$(".brtc-admin-local-file-area").css("display","block"),$(".brtc-admin-db-contents-area").css("display","none");else{this.$detailScheduleArea.find(".brtc-admin-radio-db").jqxRadioButton({checked:!0});var l={url:"api/admin/v2/schedules/"+t.scheduleId,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(l).done(function(e){var t={project:{name:e[0].projectId,id:e[0].projectId},file:{name:e[0].fileId,id:JSON.parse(e[0].executeContents).main},version:{name:e[0].modelVersion,id:e[0].modelVersionId},reportContents:JSON.parse(e[0].reportContents),DBContents:JSON.parse(e[0].executeContents)};i.handleDBContentsSelected(i.$detailScheduleArea,t)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}),$(".brtc-admin-local-file-area").css("display","none"),$(".brtc-admin-db-contents-area").css("display","block")}},n.prototype.createAddSchedulePerspective=function(){this.$addScheduleArea=$('<article class="brtc-admin-add-schedule">   <h2>Add Schedule</h2>   <div class="brtc-admin-add-schedule-area"></div></article>'),this.$mainControl.append(this.$addScheduleArea),this.createScheduleFormGroup(this.$addScheduleArea.find(".brtc-admin-add-schedule-area"),"add")},n.prototype.createModifySchedulePerspective=function(){this.$modifyScheduleArea=$('<article class="brtc-admin-modify-schedule">   <h2>Modify Schedule</h2>   <div class="brtc-admin-modify-schedule-area"></div></article>'),this.$mainControl.append(this.$modifyScheduleArea),this.createScheduleFormGroup(this.$modifyScheduleArea.find(".brtc-admin-modify-schedule-area"),"modify")},n.prototype.createScheduleFormGroup=function(i,n){var r=this,o=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">    <div class="brtc-float-right">       <button class="brtc-admin-button schedule cancel" value="cancel">Cancel</button>       <button class="brtc-admin-button schedule save" value="save">Save</button>    </div></div>');i.append(o);var d=o.find("tbody"),s=$('<td colspan="3">   <input type="text" name="schedulname" class="brtc-admin-input schedule-name" valid-type="type2" maxlength="80" placeholder="Enter schedule name." required/></td>'),c=t.WidgetUtils.createTableRow("Schedule Name",s,!0);d.append(c),t.InputValidator.appendValidationCondition(s.find(".brtc-admin-input.schedule-name")),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(s.find(".brtc-admin-input.schedule-name"));var l=$('<td colspan="3">   <input type="text" name="cron" class="brtc-admin-input cron-expression" valid-type="cronType" maxlength="80" placeholder="Enter cron expression." required/>   <div class="brtc-admin-schedule-cron-help"></div>   <div class="brtc-admin-schedule-cron-checkbox">IMMEDIATE</div></td>');l.find(".brtc-admin-schedule-cron-help").on("click",function(){window.open("cron-expression","Brightics Cron Expression Help")});var u=t.WidgetUtils.createTableRow("Cron Expression",l,!0);d.append(u);var p=$('<td colspan="3">   <div class="brtc-admin-dropdown schedule-owner"></div></td>'),h=t.WidgetUtils.createTableRow("Schedule Owner",p);d.append(h);var m=l.find(".brtc-admin-schedule-cron-checkbox");m.jqxCheckBox({theme:e.VA.Env.Theme}),m.on("change",function(e){1==e.args.checked?U.jqxInput({disabled:!0,value:"IMMEDIATE"}):U.jqxInput({disabled:!1,value:""})});var f=$('<td colspan="3">   <div class="brtc-admin-dropdown isactive"></div></td>'),b=t.WidgetUtils.createTableRow("Is Active",f);d.append(b);var g=$('<td colspan="3">   <div class ="brtc-admin-radio-local">Local</div>   <div class ="brtc-admin-radio-db">DB</div></td>'),v=t.WidgetUtils.createTableRow("Input Type",g,!0);d.append(v);var y=$('<td colspan="3">   <div class="brtc-admin-local-file-area">       <div>           <button class="brtc-admin-button local" value="open-runnable-model">Open Runnable Model</button>           <input type="file" id="brtc-admin-upload-filename" name="fileToUpload" accept=".json"/>       </div>       <div class="brtc-selected-file-content">       </div>   </div>   <div class="brtc-admin-db-contents-area">       <div class="brtc-admin-db-select-area">           <div class="brtc-admin-dropdown projectname"/>           <div class="brtc-admin-dropdown modelname"/>           <div class="brtc-admin-dropdown modelversion"/>           <button class="brtc-admin-button content" value="add-model">Add Model</button>       </div>       <div class="brtc-selected-db-content">       </div>   </div></td>'),x=t.WidgetUtils.createTableRow("",y);d.append(x);var w=$('<td colspan="3">   <div class="brtc-admin-dropdown dependencyId"></div></td>'),D=t.WidgetUtils.createTableRow("Dependency Schedule",w);d.append(D);var A=o.find(".brtc-admin-dropdown.dependencyId");A.jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"scheduleName",valueMember:"scheduleId"}),"add"==n?A.on("open",function(i){$.ajax({url:"api/admin/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){$.each(e,function(i,a){e[i].scheduleId=t.WidgetUtils.convertHTMLSpecialChar(a.scheduleId)}),A.jqxDropDownList({source:e}),A.jqxDropDownList("insertAt","",0)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}):A.on("open",function(i){$.ajax({url:"api/admin/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){var i=[];$.each(e,function(e,a){a.scheduleId!==r.selectedItem.scheduleId&&(i.push(a),i[i.length-1].scheduleId=t.WidgetUtils.convertHTMLSpecialChar(a.scheduleId))}),A.jqxDropDownList({source:i}),A.jqxDropDownList("insertAt","",0)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})});var C=o.find(".brtc-admin-input.schedule-name");C.jqxInput({theme:e.VA.Env.Theme,disabled:"modify"===n}),C.on("change",function(){r.checkDuplicateFlag=!1});var U=o.find(".brtc-admin-input.cron-expression");U.jqxInput({theme:e.VA.Env.Theme}),t.InputValidator.appendValidationCondition(U),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(U);var j=o.find(".brtc-admin-dropdown.schedule-owner");j.jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"id",valueMember:"id",placeHolder:"user id"});$.ajax({url:"api/admin/v2/users",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){$.each(e,function(i,a){e[i].label=t.WidgetUtils.convertHTMLSpecialChar(a.label)}),j.jqxDropDownList({source:e})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}),$(".brtc-admin-local-file-area").css("display","block"),$(".brtc-admin-db-contents-area").css("display","none");var T=o.find(".brtc-admin-dropdown.isactive");T.jqxDropDownList({theme:e.VA.Env.Theme,source:["Y","N"],dropDownHeight:55,selectedIndex:0});var I=o.find(".brtc-admin-radio-local");I.jqxRadioButton({theme:e.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:n,checked:!0});var k=o.find(".brtc-admin-radio-db");k.jqxRadioButton({theme:e.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:n}),I.on("checked",function(){$(".brtc-admin-local-file-area").css("display","block"),$(".brtc-admin-db-contents-area").css("display","none"),r.mode="local"}),k.on("checked",function(){$(".brtc-admin-local-file-area").css("display","none"),$(".brtc-admin-db-contents-area").css("display","block"),r.mode="db"});var S=o.find(".brtc-admin-button.local");S.jqxButton({theme:e.VA.Env.Theme,height:"27px"});var q=o.find("#brtc-admin-upload-filename");S.jqxButton({theme:e.VA.Env.Theme}),S.on("click",function(){q.val(""),q.click()}),q.on("change",function(t){var i,a=$(this)[0].files[0];if(a){var n=$(this)[0].files[0].name;window.FileReader||(n=$(this).val().split("/").pop().split("\\").pop());try{var d=new FileReader;d.onloadend=function(t){t.target.readyState==FileReader.DONE?(i=JSON.parse(t.target.result)).models?"data"===i.models[i.main].type||"control"===i.models[i.main].type?(r.handleLocalFileSelected(o,n,i),r.isChangeContent=!0):e.VA.Core.Utils.WidgetUtils.openErrorDialog("The selected file can not be registered in schedule. Only data flow and control flow can be included."):e.VA.Core.Utils.WidgetUtils.openErrorDialog("The selected file can not be registered in schedule. Only a runnable file can be included."):r.refresh()},d.readAsText(a)}catch(e){r.refresh()}}});var E=o.find(".brtc-selected-file-content");E.mouseover(function(){$(this).find(".brtc-admin-remove-icon").css({display:"flex"})}),E.mouseout(function(){$(this).find(".brtc-admin-remove-icon").css({display:"none"})});var G=o.find(".brtc-admin-dropdown.projectname");G.jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"label",valueMember:"id",placeHolder:"Project"}),G.on("open",function(i){r.projectList={};$.ajax({url:"api/va/v2/ws/projects",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(e){$.each(e,function(i,a){r.projectList[a.id]=$.extend(!0,{},a),e[i].label=t.WidgetUtils.convertHTMLSpecialChar(a.label)}),G.jqxDropDownList({source:e})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})});var P=o.find(".brtc-admin-dropdown.modelname");P.jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"label",valueMember:"id",placeHolder:"Model"}),P.on("open",function(i){var a=G.jqxDropDownList("val");if(""!==a){r.fileList[a]={};var n={url:"api/va/v2/ws/projects/"+a+"/files",type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(n).done(function(e){var i=[];$.each(e,function(n,o){"data"!=o.type&&"control"!==o.type||(r.fileList[a][o.id]=$.extend(!0,{},o),e[n].label=t.WidgetUtils.convertHTMLSpecialChar(o.label),i.push(e[n]))}),P.jqxDropDownList({source:i})}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}else P.jqxDropDownList("clear")});var R=o.find(".brtc-admin-dropdown.modelversion");R.jqxDropDownList({theme:e.VA.Env.Theme,displayMember:"version_text",valueMember:"version_id",placeHolder:"Version"}),R.on("open",function(t){var i=G.jqxDropDownList("val"),n=P.val();""!==n?a.VersionDao.getVersions(i,n).then(function(e){e.sort(function(e,t){return t.compareToByVersion(e)}),R.jqxDropDownList({source:_.map(e,function(e){return{version_text:e.getVersion(),label:e.getVersion(),version_id:e.getVersionId()}})})}).catch(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}):R.jqxDropDownList("clear")});var W=o.find(".brtc-admin-button.content");W.jqxButton({theme:e.VA.Env.Theme}),W.on("click",function(){if(null!==$(G).jqxDropDownList("getSelectedItem")&&null!==$(P).jqxDropDownList("getSelectedItem")&&null!==$(R).jqxDropDownList("getSelectedItem")){var t=$(G).jqxDropDownList("getSelectedItem").value,i=$(P).jqxDropDownList("getSelectedItem").value,a=r.projectList[t].label,n=r.fileList[t][i].label,d=$(R).jqxDropDownList("getSelectedItem").value,s={project:{name:a,id:t},file:{name:n,id:i},version:{name:$(R).jqxDropDownList("getSelectedItem").label,id:d}};r.isChangeContent=!0,r.handleDBContentsSelected(o,s)}else e.VA.Core.Utils.WidgetUtils.openCheckDialog("Project, Model and Version must not be empty.")});var V=o.find(".brtc-selected-db-content");V.mouseover(function(e){$(this).find(".brtc-admin-remove-icon").css({display:"flex"})}),V.mouseout(function(e){$(this).find(".brtc-admin-remove-icon").css({display:"none"})}),this.addScheduleCancelButton=o.find(".brtc-admin-button.schedule.cancel"),this.addScheduleCancelButton.jqxButton({theme:e.VA.Env.Theme}),this.addScheduleCancelButton.on("click",function(){r.changePerspective()}),this.addScheduleSaveButton=o.find(".brtc-admin-button.schedule.save"),this.addScheduleSaveButton.jqxButton({theme:e.VA.Env.Theme}),this.addScheduleSaveButton.on("click",function(t){var i=$(C).val();if(""===i)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter schedule name."),void o.find(".brtc-admin-management-input.schedulename").focus();var a=$(U).val(),d=$(j).val(),s=$(T).val(),c=$(A).val();if(""===a)return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter cron expression."),void o.find(".brtc-admin-management-input.cronexpression").focus();if(!l.find(".brtc-admin-schedule-cron-checkbox").jqxCheckBox("checked")&&!new RegExp("^\\s*($|#|\\w+\\s*=|(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[01]?\\d|2[0-3])(?:(?:-|/|\\,)(?:[01]?\\d|2[0-3]))?(?:,(?:[01]?\\d|2[0-3])(?:(?:-|/|\\,)(?:[01]?\\d|2[0-3]))?)*)\\s+(\\?|\\*|(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?(?:,(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?)*)\\s+(\\?|\\*|(?:[1-9]|1[012])(?:(?:-|/|\\,)(?:[1-9]|1[012]))?(?:L|W)?(?:,(?:[1-9]|1[012])(?:(?:-|/|\\,)(?:[1-9]|1[012]))?(?:L|W)?)*|\\?|\\*|(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?(?:,(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?)*)\\s+(\\?|\\*|(?:[1-7])(?:(?:-|/|\\,|#)(?:[1-7]))?(?:L)?(?:,(?:[1-7])(?:(?:-|/|\\,|#)(?:[1-7]))?(?:L)?)*|\\?|\\*|(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?(?:,(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?)*)(|\\s)+(\\?|\\*|(?:|\\d{4})(?:(?:-|/|\\,)(?:|\\d{4}))?(?:,(?:|\\d{4})(?:(?:-|/|\\,)(?:|\\d{4}))?)*))$").test(a))return e.VA.Core.Utils.WidgetUtils.openErrorDialog("Syntax error in cron expression."),void o.find(".brtc-admin-management-input.cronexpression").focus();if("local"!==r.mode||void 0!==r.modelFileContents)if("db"!==r.mode||void 0!==r.modelDBContents){var u=function(t){if(t.OK){var o;if("local"===r.mode)o=$.extend(!0,{},r.modelFileContents);else{$(G).jqxDropDownList("source")&&$.each($(G).jqxDropDownList("source"),function(e,t){if(t.label===r.projectId)return t.id,!1}),o=r.modelDBContents,r.isChangeContent=!1}var l=o.models[o.main];_.forIn(t.args,function(e,t){l.variables[t]&&(l.variables[t].value=e)}),delete o.reports;var u,p={},h="api/admin/v2/schedules";"modify"===n?(h="api/admin/v2/schedules/"+r.selectedItem.scheduleId+"/update",p={scheduleId:r.selectedItem.scheduleId,scheduleName:i,cronExpression:a,scheduleOwner:d||e.VA.Env.Session.userId,scheduleType:"JSON",scheduleStatus:r.selectedItem.scheduleStatus,executeContents:JSON.stringify(o),fileId:r.fileId,projectId:r.projectId,isActive:s,modifyUser:e.VA.Env.Session.userId,dependencyId:c},u="Schedule has been updated."):(p={scheduleId:e.VA.Core.Utils.IDGenerator.schedule.id(),scheduleName:i,cronExpression:a,scheduleOwner:d||e.VA.Env.Session.userId,scheduleType:"JSON",executeContents:JSON.stringify(o),fileId:r.fileId,projectId:r.projectId,isActive:s,modifyUser:e.VA.Env.Session.userId,dependencyId:c},u="Schedule has been created."),$("body").trigger("startProgress"),$.ajax({url:h,type:"POST",data:JSON.stringify(p),contentType:"application/json; charset=utf-8"}).done(function(e){e.success&&(r.checkDialog("Success",u),r.changePerspective(),r.refreshScheduleData(),r.checkDuplicateFlag=!1,r.modelFileContents=void 0,r.modelDBContents=void 0,r.fileId=void 0,r.projectId=void 0)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)}).always(function(){$("body").trigger("endProgress")})}};if("local"===r.mode)u({OK:!0});else{var p=r.modelDBContents.models[r.modelDBContents.main].type,h=r.modelDBContents.models[r.modelDBContents.main].variables;h&&Object.keys(h).length>0?"control"===p?new e.VA.Core.Dialogs.RunControlDialog(r.$parent,{close:u,analyticsModel:r.modelDBContents.models[r.modelDBContents.main]}):"realtime"===p?new e.VA.Core.Dialogs.RunRealTimeDialog(r.$parent,{close:u,analyticsModel:r.modelDBContents.models[r.modelDBContents.main]}):"data"===p?new e.VA.Core.Dialogs.RunDataDialog(r.$parent,{close:u,analyticsModel:r.modelDBContents.models[r.modelDBContents.main]}):u({OK:!0}):u({OK:!0})}}else e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please choose a model.");else e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please choose a model.")})},n.prototype.checkChangeItem=function(t){var i=!0;return t.scheduleOwner!==this.selectedItem.scheduleOwner&&(i=!1),t.cronExpression!==this.selectedItem.cronExpression&&(i=!1),t.isActive!==this.selectedItem.isActive&&(i=!1),"local"===this.mode?t.fileId!==this.selectedItem.fileId&&(i=!1):"db"===this.mode&&(t.projectId!==this.selectedItem.projectId&&(i=!1),t.fileId!==this.selectedItem.fileId&&(i=!1)),!!i&&(e.VA.Core.Utils.WidgetUtils.openCheckDialog("There is no updated model."),!0)},n.prototype.handleDBContentsSelected=function(a,n){var r=this,o=a.find(".brtc-selected-db-content");o.empty(),o.append($('<span class="brtc-icon brtc-admin-upload file"></span><span class="brtc-icon brtc-admin-upload file-name"></span><span class="brtc-admin-remove-icon"></span>')),o.find(".brtc-admin-remove-icon").click(function(e){o.empty(),r.modelDBContents=void 0,r.projectId=void 0,r.fileId=void 0,r.versionId=void 0,r.versionLabel=void 0}),r.projectId=n.project.name,r.fileId=n.file.name,r.versionId=n.version.id,r.versionLabel=n.version.name,r.modelDBContents=n.DBContents?n.DBContents:void 0,r.reportContents=n.reportContents;var d="";d=void 0===r.versionId?"Selected Model ("+n.file.name+") in project ("+n.project.name+").":"Selected Version ("+r.versionLabel+") Model ("+n.file.name+") in project ("+n.project.name+").",o.find(".file-name").html(t.WidgetUtils.convertHTMLSpecialChar(d)),o.find(".file-name").attr("title",d),_.isUndefined(r.modelDBContents)&&i.fetchProject(n.project.id).then(function(e){return i.initProject(e)}).then(function(){return i.fetchVersion(n.project.id,n.file.id,n.version.id)}).then(function(t){e.VA.Core.Utils.RunnableFactory.createForFlow(t.getContents(),void 0,void 0,{}).then(function(e){r.modelDBContents=e})})},n.prototype.addFileVersion=function(e,t){e.versionId=t},n.prototype.handleLocalFileSelected=function(e,i,a,n){var r=this,o=e.find(".brtc-selected-file-content");o.empty(),o.append($('<span class="brtc-icon brtc-admin-upload file"></span><span class="brtc-icon brtc-admin-upload file-name" title="'+t.WidgetUtils.convertHTMLSpecialChar(i)+'">'+t.WidgetUtils.convertHTMLSpecialChar(i)+'</span><span class="brtc-admin-remove-icon"></span>')),o.find(".brtc-admin-remove-icon").click(function(e){o.empty(),r.modelFileContents=void 0,r.projectId=void 0,r.fileId=void 0}),Promise.resolve().then(function(){if(a.version&&"3.5"===a.version)return a;a.args||(a.args={});var e={data:JSON.stringify(a),contentType:"application/json; charset=utf-8",url:"/api/va/v2/convert/execute",type:"POST"};return Promise.resolve($.ajax(e))}).then(function(e){r.projectId=void 0,r.fileId=i,r.modelFileContents=e,r.reportContents=n})},n.prototype.refresh=function(e){this.$mainControl.find(".preview").find(".contents").empty(),this.$mainControl.find(".filename").empty()},n.prototype.setModifyScheduleInfo=function(t){var i=this;this.selectedItem=t;var a=this.$modifyScheduleArea.find(".brtc-admin-input.schedule-name");$(a).val(t.scheduleName),$(a).prop("title",t.scheduleName);var n=this.$modifyScheduleArea.find(".brtc-admin-input.cron-expression");$(n).val(t.cronExpression);var r=this.$modifyScheduleArea.find(".brtc-admin-schedule-cron-checkbox");"IMMEDIATE"===t.cronExpression&&(n.jqxInput({disabled:!0}),r.jqxCheckBox({checked:!0}),$(n).prop("title",t.cronExpression));var o=this.$modifyScheduleArea.find(".brtc-admin-dropdown.schedule-owner");$(o).val(t.scheduleOwner);var d=this.$modifyScheduleArea.find(".brtc-admin-dropdown.isactive");$(d).val(t.isActive);var s=this.$modifyScheduleArea.find(".brtc-admin-dropdown.dependencyId");if($(s).val(t.dependencyId),null===t.projectId)this.$modifyScheduleArea.find(".brtc-admin-radio-local").jqxRadioButton({checked:!0}),this.handleLocalFileSelected(this.$modifyScheduleArea,t.fileId,JSON.parse(t.executeContents),JSON.parse(t.reportContents));else{this.$modifyScheduleArea.find(".brtc-admin-radio-db").jqxRadioButton({checked:!0});var c={url:"api/admin/v2/schedules/"+t.scheduleId,type:"GET",contentType:"application/json; charset=utf-8"};$.ajax(c).done(function(e){var t={project:{name:e[0].projectId,id:e[0].projectId},file:{name:e[0].fileId,id:JSON.parse(e[0].executeContents).main},version:{name:e[0].modelVersion,id:e[0].modelVersionId},reportContents:JSON.parse(e[0].reportContents),DBContents:JSON.parse(e[0].executeContents)};i.handleDBContentsSelected(i.$modifyScheduleArea,t)}).fail(function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t)})}},n.prototype.addFilter=function(){this.$scheduleGrid.jqxGrid("clearfilters");var e=this.$scheduleListArea.find(".brtc-admin-filter-input"),t=this.$scheduleListArea.find(".brtc-admin-dropdown.scheduleStatus"),i=new $.jqx.filter,a=e.jqxInput("val"),n=i.createfilter("stringfilter",a,"contains");if(i.addfilter(1,n),this.$scheduleGrid.jqxGrid("addfilter","scheduleName",i),"ALL"!=t.jqxDropDownList("val")){var r=new $.jqx.filter,o=t.jqxDropDownList("val"),d=r.createfilter("stringfilter",o,"equal");r.addfilter(1,d),this.$scheduleGrid.jqxGrid("addfilter","scheduleStatus",r)}this.$scheduleGrid.jqxGrid("applyfilters"),this.setRowCount()},n.prototype.resetData=function(){this.$addScheduleArea.find(".brtc-admin-input.schedule-name").val(""),this.$addScheduleArea.find(".brtc-admin-input.cron-expression").val(""),this.$addScheduleArea.find(".brtc-admin-schedule-cron-checkbox").jqxCheckBox({checked:!1}),this.$addScheduleArea.find(".brtc-admin-dropdown.isactive").jqxDropDownList({selectedIndex:0}),this.$modifyScheduleArea.find(".brtc-admin-input.schedule-name").val(""),this.$modifyScheduleArea.find(".brtc-admin-input.cron-expression").val(""),this.$modifyScheduleArea.find(".brtc-admin-schedule-cron-checkbox").jqxCheckBox({checked:!1}),this.$modifyScheduleArea.find(".brtc-admin-dropdown.isactive").jqxDropDownList({selectedIndex:0}),this.$addScheduleArea.find(".brtc-admin-radio-local").jqxRadioButton({checked:!0}),this.$modifyScheduleArea.find(".brtc-admin-radio-local").jqxRadioButton({checked:!0}),this.$addScheduleArea.find(".brtc-selected-file-content").empty(),this.$addScheduleArea.find(".brtc-selected-db-content").empty(),this.$modifyScheduleArea.find(".brtc-selected-file-content").empty(),this.$modifyScheduleArea.find(".brtc-selected-db-content").empty(),this.$addScheduleArea.find(".brtc-admin-dropdown.projectname").jqxDropDownList("clearSelection"),this.$addScheduleArea.find(".brtc-admin-dropdown.modelname").jqxDropDownList("clearSelection"),this.$addScheduleArea.find(".brtc-admin-dropdown.modelversion").jqxDropDownList("clearSelection"),this.$modifyScheduleArea.find(".brtc-admin-dropdown.projectname").jqxDropDownList("clearSelection"),this.$modifyScheduleArea.find(".brtc-admin-dropdown.modelname").jqxDropDownList("clearSelection"),this.$modifyScheduleArea.find(".brtc-admin-dropdown.modelversion").jqxDropDownList("clearSelection"),this.$addScheduleArea.find(".brtc-admin-dropdown.dependencyId").jqxDropDownList("clearSelection"),this.$modifyScheduleArea.find(".brtc-admin-dropdown.dependencyId").jqxDropDownList("clearSelection"),this.modelFileContents=void 0,this.projectId=void 0,this.fileId=void 0,this.modelDBContents=void 0,this.versionId=void 0,this.versionLabel=void 0},n.prototype.checkDialog=function(e,i){var a={title:e,contentText:i};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},e.Admin.ScheduleManagement=n}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;function i(t,i){this.parentId=t,this.options=i,e.VA.Env.Session.userId=i.userId,this.checkEmail=!1,this.checkDuplicateEmail=!1,this.checkPwd=!1,this.checkConfirmPwd=!1,this.checkName=!1,this.modifyCheckName=!1,this.retrieveParent(),this.createControls()}i.prototype.retrieveParent=function(){this.$parent=t.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){$(document).bind("contextmenu",function(e){return!1}),this.$mainControl=this.$parent,t.WidgetUtils.selectNavigationMenu("brtc-admin-user"),this.createUserListArea(),this.createDetailUserPerspective(),this.createAddUserPerspective(),this.createModifyUserPerspective(),this.changePerspective()},i.prototype.createUserListArea=function(){this.$userListArea=$('<article>   <h2>User</h2>   <div class="brtc-admin-header-form">   </div>   <div class="cont_box stmt30 brtc-admin-data-area"></div></article>'),this.$mainControl.append(this.$userListArea),this.createHeaderForm(this.$userListArea.find(".brtc-admin-header-form")),this.createDataArea(this.$userListArea.find(".brtc-admin-data-area"))},i.prototype.createSumArea=function(t){var i=this,a=$('<div class="tb_view_st">   <span>Total<strong class="brtc-admin-total-count"></strong></span>   <div class="brtc-admin-dropdown-count"></div></div>');t.append(a);a.find(".brtc-admin-dropdown-count").jqxDropDownList({source:[{text:"15 Rows",value:15},{text:"20 Rows",value:20},{text:"30 Rows",value:30}],selectedIndex:0,checkboxes:!1,width:80,height:25,dropDownHeight:84,openDelay:0,closeDelay:0,displayMember:"text",valueMember:"value"}),a.find(".brtc-admin-dropdown-count").on("select",function(t){var n=t.args,r=a.find(".brtc-admin-dropdown-count").jqxDropDownList("getItem",n.index);null!=r&&(i.$userGrid.jqxGrid({pagesize:r.value}),e.VA.Core.Utils.WidgetUtils.updatePageButton(i.$userGrid))})},i.prototype.createDataGrid=function(i){var a=this;this.$userGrid=$('<div class="brtc-admin-body-grid-users"></div>'),i.append(this.$userGrid),this.$userGrid.jqxGrid({theme:e.VA.Env.Theme,width:"100%",height:560,columnsheight:34,rowsheight:32,pageable:!0,pagermode:"simple",pagesize:15,pagerbuttonscount:3,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,showsortcolumnbackground:!1,showsortmenuitems:!1,columnsresize:!1,selectionmode:"checkbox",autoheight:!0,columns:[{text:"User ID",datafield:"id",width:"30%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellclassname:"brtc-grid-cell-bold",cellsrenderer:t.WidgetUtils.cellRendererLeft},{text:"Name",datafield:"name",width:"20%",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer},{text:"E-mail",datafield:"email",width:"auto",align:"center",rendered:t.WidgetUtils.tooltiprenderer,cellsrenderer:t.WidgetUtils.cellRenderer}]}),this.$userGrid.on("rowselect",function(e){a.refreshDataControlButton()}),this.$userGrid.on("cellclick",function(e){0!==e.args.columnindex&&(this.value="detail",a.changePerspective(this),a.setDetailUserInfo(a.$userGrid.jqxGrid("getrowdata",e.args.rowindex)))}),this.$userGrid.on("rowunselect",function(e){a.refreshDataControlButton()}),this.$userGrid.on("pagechanged",function(t){e.VA.Core.Utils.WidgetUtils.updatePageButton($(this))}),this.refreshUserData()},i.prototype.createDataControlArea=function(t){var i=this,a=$('<div class="tb_choibox btn_box ctr01 choinone brtc-admin-choice">   <div class="ipstc brtc-admin-selected">       <input type="checkbox" id="cc1" value=""/>       <label for="cc1"><b>1</b> Row(s) selected.</label>   </div>   <div class="brtc-float-left active">       <button class="brtc-admin-button add" value="add" CRUD="C">Add</button>       <button class="brtc-admin-button delete" value="delete" CRUD="D">Delete</button>   </div>   <div class="brtc-float-right-refresh">       <button class="brtc-admin-button reload" value="reload"><span class="fa fa-refresh"></span></button>   </div></div><div class="tb_choinone"></div><div class="tb_headview"></div>');t.append(a),$(".brtc-admin-selected input[type=checkbox]:first").change(function(){i.$userGrid.jqxGrid("clearselection")}),a.find(".add").jqxButton({theme:e.VA.Env.Theme}),a.find(".add").on("click",function(){i.changePerspective(this)}),a.find(".delete").jqxButton({theme:e.VA.Env.Theme}),a.find(".delete").on("click",function(){var e=i.$userGrid.jqxGrid("getselectedrowindexes"),t=[];if(e.length>0){for(var a in e){var n=i.$userGrid.jqxGrid("getrowdata",e[a]);t.push("["+n.id+"]")}i.createDeleteConfirmDialog(t)}}),a.find(".reload").jqxButton({theme:e.VA.Env.Theme}),a.find(".reload").on("click",function(){i.refreshUserData()}),this.createDataGrid($(".tb_headview"))},i.prototype.createDataArea=function(e){this.createSumArea(e),this.createDataControlArea(e)},i.prototype.searchUser=function(){""===$(".brtc-admin-filter-input").val()?this.$userGrid.jqxGrid("clearfilters"):this.addFilter(),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(this.$userGrid),this.setRowCount()},i.prototype.createHeaderForm=function(t){var i=this,a=$('<table class="brtc-admin-search-table">   <colgroup>      <col style="width:100px;"><col>   </colgroup>   <tbody>       <tr>           <th class="brtc-admin-user-label">User</th>           <td>               <input type="text" class="brtc-admin-filter-input" style="width: 606px;margin-top: 2px;" maxlength="200" placeholder="Enter name or ID"/>               <div class="brtc-search-button-box">                   <div class="brtc-float-right">                       <button class="brtc-admin-button search-area clear" style="width:39px;" value="clear">Clear</button>                       <button class="brtc-admin-button search-area search" value="search">Search</button>                   </div>               </div>           </td>       </tr>   </tbody></table>');t.append(a),this.$filterInput=a.find(".brtc-admin-filter-input"),a.find(".brtc-admin-button.clear").jqxButton({theme:e.VA.Env.Theme}),this.$filterInput.keydown(function(e){13==e.keyCode&&i.searchUser()}),a.find(".brtc-admin-button.clear").click(function(){i.$filterInput.val(""),i.$userGrid.jqxGrid("clearfilters"),e.VA.Core.Utils.WidgetUtils.clearSelectionOnGrid(i.$userGrid),i.setRowCount()}),a.find(".brtc-admin-button.search").jqxButton({theme:e.VA.Env.Theme}),a.find(".brtc-admin-button.search").click(function(){i.searchUser()}),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(this.$filterInput)},i.prototype.createDeleteConfirmDialog=function(i){var a=this,n={title:"",contentText:void 0===i?"Are you sure you want to delete?":"Are you sure you want to delete "+i.length+" selected users?",close:function(t){if(t.OK)if(a.selectedDetailUser){var i=function(){a.checkDialog("Success","User has been deleted."),a.changePerspective(),a.refreshUserData()};e.Admin.Send.deleteUser(a.selectedDetailUser.id,i)}else{var n=a.$userGrid.jqxGrid("getselectedrowindexes"),r=0,o=[];for(var d in n){var s=a.$userGrid.jqxGrid("getrowdata",n[d]);o.push("["+s.id+"]"),i=function(){++r===n.length&&(a.checkDialog("Success","("+o.length+") User(s) has been deleted."),a.changePerspective(),a.refreshUserData())},e.Admin.Send.deleteUser(s.id,i)}}},isCancel:!0};t.WidgetUtils.createAdminConfirmDialog(this.$parent,n)},i.prototype.addFilter=function(){this.$filterInput.trigger("focusout");var e=new $.jqx.filter,t=new $.jqx.filter;t.operator="or";var i=this.$filterInput.val(),a=e.createfilter("stringfilter",i,"contains");e.addfilter(1,a),t.addfilter(1,a),this.$userGrid.jqxGrid("addfilter","id",e),this.$userGrid.jqxGrid("addfilter","name",t),this.$userGrid.jqxGrid("applyfilters"),this.setRowCount()},i.prototype.setRowCount=function(){var t=this.$userGrid.jqxGrid("getrows");this.$mainControl.find(".brtc-admin-total-count").text(t.length),e.VA.Core.Utils.WidgetUtils.updatePageButton(this.$userGrid)},i.prototype.changePerspective=function(e){e?"add"===e.value?(this.$addUserArea.show(),this.$detailUserArea.hide(),this.$modifyUserArea.hide(),this.$userListArea.hide()):"modify"===e.value?(this.$addUserArea.hide(),this.$detailUserArea.hide(),this.$modifyUserArea.show(),this.$userListArea.hide()):"detail"===e.value&&(this.$addUserArea.hide(),this.$detailUserArea.show(),this.$modifyUserArea.hide(),this.$userListArea.hide()):(this.$addUserArea.hide(),this.$detailUserArea.hide(),this.$modifyUserArea.hide(),this.$userListArea.show())},i.prototype.refreshDataControlButton=function(){var e=this.$userGrid.jqxGrid("getselectedrowindexes"),t=this.$mainControl.find(".brtc-admin-choice");e.length>1?(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0)):0===e.length?(t.removeClass("active"),t.find(".brtc-admin-button.add").show(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!0}),t.find(".brtc-admin-selected").hide(),t.find(".brtc-admin-selected").find("b:first").hide()):(t.addClass("active"),t.find(".brtc-admin-button.add").hide(),t.find(".brtc-admin-button.add").jqxButton({disabled:!1}),t.find(".brtc-admin-button.delete").show(),t.find(".brtc-admin-button.delete").jqxButton({disabled:!1}),t.find(".brtc-admin-selected").show(),t.find(".brtc-admin-selected").find("b:first").show(),t.find(".brtc-admin-selected").find("b:first").html(e.length),t.find(".brtc-admin-selected").find("input[type=checkbox]:first").prop("checked",!0))},i.prototype.refreshUserData=function(){var t=this;e.Admin.Send.getAllUsers(function(i){t.$filterInput.val("");var a={localdata:i,datafields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"email",type:"string"}],datatype:"array"};e.VA.Core.Utils.WidgetUtils.updateGridSource(t.$userGrid,a),t.$mainControl.find(".brtc-admin-total-count").text(i.length),t.refreshDataControlButton(),t.$userGrid.jqxGrid("getselectedrowindexes").length>0&&t.$userGrid.jqxGrid("clearselection"),t.selectedDetailUser=void 0})},i.prototype.createDetailUserPerspective=function(){this.$detailUserArea=$('<article class="brtc-admin-detail-user">   <h2>User Information Detail</h2>   <div class="brtc-admin-detail-notice-area"></div></article>'),this.$mainControl.append(this.$detailUserArea),this.createDetailUserFormGroup()},i.prototype.createDetailUserFormGroup=function(){var i=this,a=this.$detailUserArea.find(".brtc-admin-detail-notice-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">   <div class="brtc-float-left">       <button class="brtc-admin-button detail-user list" value="list">List</button>   </div>    <div class="brtc-float-right">       <button class="brtc-admin-button detail-user delete" value="delete" CRUD="D">Delete</button>       <button class="brtc-admin-button detail-user modify" value="modify" CRUD="U">Edit</button>    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <input type="text" name="id" class="brtc-admin-input detail-user-id" disabled placeholder="user@samsung.com" required maxlength="40"></td>'),d=t.WidgetUtils.createTableRow("User ID",o);r.append(d);var s=$('<td colspan="3">   <input type="text" name="name" class="brtc-admin-input detail-user-name" placeholder="Enter user name" disabled maxlength="40"></td>'),c=t.WidgetUtils.createTableRow("User Name",s);r.append(c),n.find(".brtc-admin-input.detail-user-id").jqxInput({theme:e.VA.Env.Theme,disabled:!0});var l=a.find(".brtc-admin-button.detail-user.list");l.jqxButton({theme:e.VA.Env.Theme}),l.on("click",function(){i.changePerspective(),i.selectedDetailUser=void 0});var u=a.find(".brtc-admin-button.detail-user.delete");u.jqxButton({theme:e.VA.Env.Theme}),u.on("click",function(){i.createDeleteConfirmDialog()});var p=a.find(".brtc-admin-button.detail-user.modify");p.jqxButton({theme:e.VA.Env.Theme}),p.on("click",function(){i.changePerspective(this),i.setModifyUserInfo(i.selectedDetailUser)})},i.prototype.setDetailUserInfo=function(e){var t=this.$mainControl.find(".brtc-admin-input.detail-user-id");$(t).val(e.id),$(t).prop("title",e.id);var i=this.$mainControl.find(".brtc-admin-input.detail-user-name");$(i).val(e.name),$(i).prop("title",e.name),this.selectedDetailUser=e},i.prototype.createAddUserPerspective=function(){this.$addUserArea=$('<article class="brtc-admin-add-user">   <h2>Add User</h2>   <div class="brtc-admin-add-user-area"></div></article>'),this.$mainControl.append(this.$addUserArea),this.createAddUserFormGroup()},i.prototype.createAddUserFormGroup=function(){var i=this,a=this.$addUserArea.find(".brtc-admin-add-user-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">    <div class="brtc-float-right">       <button class="brtc-admin-button add-user cancel" value="cancel">Cancel</button>       <button class="brtc-admin-button add-user save" value="save">Save</button>    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <div class="brtc-admin-div-user"><input type="text" name="id" class="brtc-admin-input add-user-userid"  valid-type="type4" maxlength="68" placeholder="Enter user ID" required></div>   <div class="brtc-admin-div-email"><input type="text" name="id" class="brtc-admin-input add-user-mail"  disabled value="@samsung.com"></div>   <div id="idMsg" style="clear:both" class="brtc-admin-input-error add-user-userid-error"></div></td>'),d=t.WidgetUtils.createTableRow("User ID",o,!0);r.append(d),t.InputValidator.appendValidationCondition(o.find(".add-user-userid"));var s=$('<td colspan="3">   <input type="password" name="password" class="brtc-admin-input add-user-password" maxlength="80" placeholder="********" required>   <div id="pwdMsg" class="brtc-admin-input-error add-user-password-error"></div></td>'),c=t.WidgetUtils.createTableRow("Password",s,!0);r.append(c);var l=$('<td colspan="3">    <input type="password" name="password" class="brtc-admin-input add-user-cfpassword"  maxlength="80" placeholder="********" required>   <div id="pwdConfirmMsg" class="brtc-admin-input-error add-user-cfpassword-error"></div></td>'),u=t.WidgetUtils.createTableRow("Confirm Password",l,!0);r.append(u);var p=$('<td colspan="3">   <input type="text" name="name" class="brtc-admin-input add-user-name" placeholder="Enter user name" valid-type="type6" maxlength="80" >   <div id="nameMsg" class="brtc-admin-input-error add-user-name-error"></div></td>'),h=t.WidgetUtils.createTableRow("User Name",p,!0);r.append(h),t.InputValidator.appendValidationCondition(p.find(".add-user-name")),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(p.find(".add-user-name")),this.$userIdInput=o.find(".brtc-admin-input.add-user-userid"),this.$userMailInput=o.find(".brtc-admin-input.add-user-mail"),this.$passwdInput=s.find(".brtc-admin-input.add-user-password"),this.$confirmPasswdInput=l.find(".brtc-admin-input.add-user-cfpassword"),this.$userNameInput=p.find(".brtc-admin-input.add-user-name"),this.checkEmailForm(),this.checkInputPassword(),this.checkConfirmPassword(),this.checkInputName(),this.addUserCancelButton=a.find(".brtc-admin-button.add-user.cancel"),this.addUserCancelButton.jqxButton({theme:e.VA.Env.Theme}),this.addUserCancelButton.on("click",function(){$(i.$userIdInput).val(""),$(i.$passwdInput).val(""),$(i.$confirmPasswdInput).val(""),$(i.$userNameInput).val(""),$("#idMsg").hide(),$("#pwdMsg").hide(),$("#pwdConfirmMsg").hide(),$("#nameMsg").hide(),i.changePerspective()}),this.addUserSaveButton=a.find(".brtc-admin-button.add-user.save"),this.addUserSaveButton.jqxButton({theme:e.VA.Env.Theme}),this.addUserSaveButton.on("click",function(t){var a=$(i.$userIdInput).val()+$(i.$userMailInput).val(),n=$(i.$passwdInput).val(),r=$(i.$userNameInput).val(),o=$(i.$userIdInput).val()+$(i.$userMailInput).val();i.checkEmail=e.Admin.UserValidation.chkEmailForm(o,"#idMsg"),i.checkPwd=e.Admin.UserValidation.chkPasswordForm(o,$(i.$passwdInput).val(),"#pwdMsg"),i.checkConfirmPwd=e.Admin.UserValidation.chkPasswordConfirmForm($(i.$passwdInput).val(),$(i.$confirmPasswdInput).val(),"#pwdConfirmMsg"),i.checkName=e.Admin.UserValidation.chkName($(i.$userNameInput).val(),"#nameMsg"),$.ajax({type:"GET",url:"api/admin/v2/users/"+o}).done(function(o){o.length?e.VA.Core.Utils.WidgetUtils.openErrorDialog("This user id already exists.",function(){$(i.$userIdInput).focus()}):i.checkEmail&&i.checkPwd&&i.checkConfirmPwd&&i.checkName?(e.Admin.Send.addUser(a,r,n,i.refreshAddData.bind(i)),$(i.$userIdInput).val(""),$(i.$passwdInput).val(""),$(i.$confirmPasswdInput).val(""),$(i.$userNameInput).val(""),$("#nameMsg").hide(),$("#idMsg").hide()):(""===$(i.$userIdInput).val()?e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter user id.",function(){$(i.$userIdInput).focus()}):i.checkPwd?i.checkConfirmPwd?i.checkName||e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter user name.",function(){$(i.$userNameInput).focus()}):e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter confirm password.",function(){$(i.$confirmPasswdInput).focus()}):e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter password.",function(){$(i.checkPwd).focus()}),t.preventDefault())})})},i.prototype.checkEmailForm=function(){var t=this;this.$userIdInput.on("change",function(){var i=$(t.$userIdInput).val()+$(t.$userMailInput).val();t.checkEmail=e.Admin.UserValidation.chkEmailForm(i,"#idMsg"),t.checkDuplicateEmail=e.Admin.UserValidation.chkDuplicateEmail(i,"#idMsg")})},i.prototype.checkInputPassword=function(){var t=this;this.$passwdInput.on("change",function(){var i=$(t.$userIdInput).val()+$(t.$userMailInput).val(),a=e.Admin.UserValidation.chkPasswordForm(i,$(t.$passwdInput).val(),"#pwdMsg");t.checkConfirmPwd=e.Admin.UserValidation.chkPasswordConfirmForm($(t.$passwdInput).val(),$(t.$confirmPasswdInput).val(),"#pwdConfirmMsg"),!0===a&&!0===t.checkConfirmPwd?t.checkPwd=!0:t.checkPwd=!1,t.checkPwd=t.checkConfirmPwd})},i.prototype.checkConfirmPassword=function(){var t=this;this.$confirmPasswdInput.on("change",function(){var i=$(t.$userIdInput).val()+$(t.$userMailInput).val(),a=e.Admin.UserValidation.chkPasswordForm(i,$(t.$passwdInput).val(),"#pwdMsg");t.checkConfirmPwd=e.Admin.UserValidation.chkPasswordConfirmForm($(t.$passwdInput).val(),$(t.$confirmPasswdInput).val(),"#pwdConfirmMsg"),!0===a&&!0===t.checkConfirmPwd?t.checkPwd=!0:t.checkPwd=!1,t.checkPwd=t.checkConfirmPwd})},i.prototype.checkInputName=function(){var t=this;this.$userNameInput.on("change",function(){t.checkName=e.Admin.UserValidation.chkName($(t.$userNameInput).val(),"#nameMsg")})},i.prototype.refreshAddData=function(e){this.checkDialog("Success","User has been created."),this.changePerspective(),this.refreshUserData()},i.prototype.setModifyUserInfo=function(e){var t=this.$modifyUserArea.find(".brtc-admin-input.modify-user-userid");$(t).val(e.id),$(t).prop("title",e.id);var i=this.$modifyUserArea.find(".brtc-admin-input.modify-user-name");$(i).val(e.name)},i.prototype.createModifyUserPerspective=function(){this.$modifyUserArea=$('<article class="brtc-admin-modify-user">   <h2>Edit User Information</h2>   <div class="brtc-admin-modify-user-area"></div></article>'),this.$mainControl.append(this.$modifyUserArea),this.createModifyUserFormGroup()},i.prototype.createModifyUserFormGroup=function(){var i=this,a=this.$modifyUserArea.find(".brtc-admin-modify-user-area"),n=$('<table class="tb_st03 linetrg">   <colgroup><col style="width:180px;"><col style="width:350px;"><col style="width:300px;"><col style="width:100px;"></colgroup>   <tbody>   </tbody></table><div class="brtc-button-box">    <div class="brtc-float-right">       <button class="brtc-admin-button modify-user cancel" value="cancel">Cancel</button>       <button class="brtc-admin-button modify-user save" value="update">Save</button>    </div></div>');a.append(n);var r=n.find("tbody"),o=$('<td colspan="3">   <input type="text" name="id" class="brtc-admin-input modify-user-userid" disabled placeholder="user@samsung.com" required></td>'),d=t.WidgetUtils.createTableRow("User ID",o,!0);r.append(d);var s=$('<td colspan="3">   <input type="text" name="name" class="brtc-admin-input modify-user-name" placeholder="Enter user name" valid-type="type6" maxlength="80">   <div id="modifyNameMsg" class="brtc-admin-input-error modify-user-name-error"></div></td>'),c=t.WidgetUtils.createTableRow("User Name",s,!0);r.append(c),t.InputValidator.appendValidationCondition(s.find(".modify-user-name")),e.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(s.find(".modify-user-name")),this.modifyUserCancelButton=a.find(".brtc-admin-button.modify-user.cancel"),this.modifyUserCancelButton.jqxButton({theme:e.VA.Env.Theme}),this.modifyUserCancelButton.on("click",function(){i.changePerspective(),$("#modifyNameMsg").text("")});var l=a.find(".brtc-admin-input.modify-user-userid"),u=a.find(".brtc-admin-input.modify-user-name");this.modifyUserSaveButton=a.find(".brtc-admin-button.modify-user.save"),this.modifyUserSaveButton.jqxButton({theme:e.VA.Env.Theme}),this.modifyUserSaveButton.on("click",function(t){var a=$(l).val(),n=$(u).val();i.modifyCheckName=e.Admin.UserValidation.chkName($(u).val(),"#modifyNameMsg"),i.modifyCheckName?(e.Admin.Send.updateUser(a,n,a,i.refreshUpdateData.bind(i)),$(l).val(""),$(u).val(""),$("#modifyNameMsg").hide()):(e.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter user name.",function(){$(u).focus()}),t.preventDefault())});i=this;u.on("change",function(){i.modifyCheckName=e.Admin.UserValidation.chkName($(u).val(),"#modifyNameMsg")})},i.prototype.refreshUpdateData=function(e){this.checkDialog("Success","User has been updated."),this.changePerspective(),this.refreshUserData()},i.prototype.checkDialog=function(e,i){var a={title:e,contentText:i};t.WidgetUtils.createAdminConfirmDialog(this.$parent,a)},e.Admin.UserManagement=i}.call(this),function(){"use strict";var e=this.Brightics,t=e.VA.Core.Utils;t.WidgetUtils=$.extend(!0,t.WidgetUtils,{createLoadingProgressListenerToBody:function(){$("body").bind("startProgress",this.startProgress),$("body").bind("endProgress",this.endProgress)},startProgress:function(e){e=e||"Progressing...";var t=$('<div class="brtc-admin-progress-container">   <div class="brtc-admin-progress-body">       <div class="brtc-admin-progress-contents">           <div class="brtc-admin-progress-loading"></div>       </div>   </div></div>');t.width($(window).width()).height($(window).height()),$("body").append(t),t.find(".brtc-admin-progress-close").click(function(e){t.remove()})},endProgress:function(){$("body").children(".brtc-admin-progress-container").remove()},selectNavigationMenu:function(e){$("body").find("nav").find("a").removeClass("active"),$("body").find("nav").find("a."+e).addClass("active")},createTableRow:function(e,t,i){var a=$("<tr>   <th>"+e+(i?"<span>*</span>":"")+"</th></tr>");return a.append(t),a},tooltiprenderer:function(e){$(e).attr("title",$(e).text())},cellRendererLeft:function(e,t,i){var a=$('<div class="brtc-admin-body-grid-cell" style="text-align:left"><pre class="brtc-admin-style-pre"></pre></div>');return a.attr("title",i),a.find("pre").text(i),$("<div>").append(a.clone()).html()},cellRendererRight:function(e,t,i){var a=$('<div class="brtc-admin-body-grid-cell" style="text-align:right"><pre class="brtc-admin-style-pre"></pre></div>');return a.attr("title",i),a.find("pre").text(i),$("<div>").append(a.clone()).html()},cellRenderer:function(e,t,i){var a=$('<div class="brtc-admin-body-grid-cell" style="text-align:center"><pre class="brtc-admin-style-pre"></pre></div>');return a.attr("title",i),a.find("pre").text(i),$("<div>").append(a.clone()).html()},createProgressDialog:function(t,i){var a={OK:!1,Cancel:!0},n=$('<div class="brtc-admin-dialogs-main">   <div class="brtc-admin-dialogs-header nonbottomborder">'+i.title+'</div>   <div class="brtc-admin-dialogs-body">       <div class="brtc-admin-dialogs-contents admin">           <div class="brtc-admin-progress-loading"></div>       </div>   </div></div>');t.append(n);var r={theme:e.VA.Env.Theme,width:"400px",height:"200px",isModal:!0,resizable:!1,showCloseButton:!1,initContent:function(){},keyboardCloseKey:""};return n.jqxWindow(r),n.jqxWindow("focus"),n.on("close",function(e){n.jqxWindow("destroy"),n.remove(),"function"==typeof i.close&&i.close(a)}),n},createAdminConfirmDialog:function(i,a){var n,r,o,d={OK:!1,Cancel:!0},s=$('<div class="brtc-admin-dialogs-main">   <div class="brtc-admin-dialogs-header nonbottomborder" style="border-bottom: none">'+a.title+'</div>   <div class="brtc-admin-dialogs-body">       <div class="brtc-admin-dialogs-contents">       </div>       <div class="brtc-button-box stmt20 brtc-admin-dialogs-buttonbar">           <div class="brtc-float-left" />           <div class="brtc-float-right">               <input type="button" class="brtc-admin-button dialog-ok" value="OK" />           </div>       </div>   </div></div>');i.append(s),n=s.find(".dialog-ok"),a.okLabel&&n.val(a.okLabel),a.isCancel&&(r=$('<input type="button" class="brtc-admin-button dialog-cancel" value="Cancel" />'),s.find(".brtc-admin-dialogs-buttonbar").find(".brtc-float-right").prepend(r),a.cancelLabel&&r.val(a.cancelLabel)),a.detailText&&(o=$('<input type="button" class="brtc-admin-button dialog-detail" value="Detail" />'),s.find(".brtc-admin-dialogs-buttonbar").find(".brtc-float-left").append(o));var c={theme:e.VA.Env.Theme,width:"410px",height:"180px",isModal:!0,resizable:!1,cancelButton:r,initContent:function(){t.WidgetUtils.createAdminDialogContentsArea(s.find(".brtc-admin-dialogs-contents"),a),n.jqxButton({theme:e.VA.Env.Theme}),n.click(function(){d={OK:!0,Cancel:!1},s.jqxWindow("close")}),a.isCancel&&r.jqxButton({theme:e.VA.Env.Theme}),a.detailText&&(o.jqxButton({theme:e.VA.Env.Theme}),o.click(function(){window.open("/detail-popup","Detail Information",["width=800","height=600","menubar=no","status=no","toolbar=no","location=no"].join(",")).document.write(a.detailText)}))}};return s.jqxWindow(c),s.jqxWindow("focus"),s.on("close",function(e){s.jqxWindow("destroy"),s.remove(),"function"==typeof a.close&&a.close(d)}),s},openBadRequestErrorDialog:function(e,t){400==e.status&&this.openErrorDialog(e.responseJSON,t)},openErrorDialog:function(e,t){var i,a;"string"==typeof e?i=this.codeToMessage(e):e.errors&&Array.isArray(e.errors)&&((i=e.errors[0].message)||(i="Sorry! An unexpected error occurred. Please contact administrator."),0==i.indexOf("SparkException:")||0==i.indexOf("NoClassDefFoundError:")?i="Sorry! An unexpected error occurred. Please contact administrator.":0==i.indexOf("Exception:")?i=i.substring(10,msg.length).trim():0==i.indexOf("AnalysisException:")?i=i.substring(18,msg.length).trim():0==i.indexOf("InvalidInputException:")&&(i="Input path does not exist."),i.indexOf("Not allowed condition")>-1&&(i="Can not update. Check schedule status."),e.errors[0].detailMessage&&(a=e.errors[0].detailMessage)),this.createAdminConfirmDialog($("body"),{type:"error",isCancel:!1,title:"",contentText:i,detailText:a,close:t})},openConfirmDialog:function(e,t){this.createAdminConfirmDialog($("body"),{type:"info",isCancel:!0,title:"",contentText:e,close:t})},openWarningDialog:function(e,t){this.createAdminConfirmDialog($("body"),{type:"warn",isCancel:!1,title:"",contentText:e,close:t})},openCheckDialog:function(e,t){var i=this.codeToMessage(e);this.createAdminConfirmDialog($("body"),{type:"info",isCancel:!1,title:"Check",contentText:i,close:t})},createAdminDialogContentsArea:function(e,t){var i=$('<div class="brtc-admin-dialogs-body-content">    <span class="brtc-admin-dialogs-body-content-icon"></span>    <div class="brtc-admin-dialogs-body-content-content-text" style="margin-top: 5px;"></div></div>');e.append(i),i.find(".brtc-admin-dialogs-body-content-icon").attr("alert",t.type),i.find(".brtc-admin-dialogs-body-content-content-text").text(t.contentText),i.find(".brtc-admin-dialogs-body-content-content-text").innerHeight()>30&&i.find(".brtc-admin-dialogs-body-content-content-text").css("line-height","15px")},setTrimInputControlOnFocusout:function(t){t.focusout(function(i){var a=t.val(),n=e.VA.Core.Utils.InputValidator.isValid;(n.startWithSpace(a)||n.endWithSpace(a))&&(t.val(a.trim()),e.VA.Core.Widget.Factory.createFadeOutMessage(t,{message:"This input value is trimmed.",position:"bottom"}))})},clearSelectionOnGrid:function(e){e.jqxGrid("clearselection")}})}.call(this);