/*   Brightics VA Build 221110 */
(function(){"use strict";var t=this,e=t.Brightics,o=t.Brightics.VA.Core.Functions.Library;t.Brightics.VA.Implementation.Visual={Clazz:"visual",Label:e.locale.common.report,Editors:{Diagram:{EditorPage:{},Commands:{},Figures:{ContentUnit:{},Droppable:{}}},Sheet:{}},Validator:{},Dialogs:{},Tools:{Adapter:{},Manager:{}},Utils:{},Views:{OptionViewer:{},Units:{}},Wizards:{Pages:{}}},e.VA.Implementation.Visual.DATASOURCE_TYPE={STAGING:"loadFromStaging",ALLUXIO:"loadFromAlluxio",LOCAL:"loadFromLocal",HDFS:"loadFromHdfs",SCHEDULE:"loadFormSchedule"},e.VA.Implementation.Visual.CONST={DEFAULT_REPORT_SIZE:{"page-type":"a4-vertical",width:795,height:1125}},e.VA.Implementation.Visual.BIGDATA_FUNC={area:"bigDataArea","area-stacked":"bigDataAreaStacked","area-stacked-100":"bigDataStacked100",bar:"bigDataBar","bar-stacked":"bigDataBarStacked","bar-stacked-100":"bigDataBarStacked100",biplot:"bigDataBiplot",boxplot:"bigDataBoxplot",column:"bigDataColumn","column-stacked":"bigDataColumnStacked","column-stacked-100":"bigDataColumnStacked100",heatmap:"bigDataHeatMap",line:"bigDataLine",network:"bigDataNetwork",pie:"bigDataPie",radar:"bigDataRadar",roccurve:"bigDataRocCurve",scatter:"bigDataScatter",scattermap:"bigDataScatterMap",table:"bigDataTable",treemap:"bigDataTreeMap"},e.VA.Implementation.Visual.CONTENT_TYPE={CHART:"chart",TEXT:"text",PAGE:"page"},t.Brightics.VA.Implementation.Visual.Functions=o.extendFunctions(["load","refine","loadFromStaging","loadFromAlluxio","loadFromLocal","loadFromRdb","loadFromHdfs"]),t.Brightics.VA.Implementation.Visual.defaultModel={type:t.Brightics.VA.Implementation.Visual.Clazz,functions:[],links:[],report:{pages:[],display:{}},newDataSource:function(o,i,n){var a,r=this,s=e.VA.Core.Utils.IDGenerator.dataSource.id(),l=e.VA.Core.Utils.IDGenerator.table.id();if("false"===t.useSpark&&o==e.VA.Implementation.Visual.DATASOURCE_TYPE.ALLUXIO)a={"persist-mode":"auto",func:"brightics.function.io$load13889",name:"brightics.function.io$load",param:{partial_path:[""]},display:{label:"Load",charts:[{chart:{type:"table"}}]},meta:{table:{type:"table"}},context:"python",version:"3.6",outputs:{table:l},fid:s},n&&(a.param.partial_path=[n]);else{var c=e.VA.Core.Utils.WidgetUtils.getFunctionLibrary(this.type,o);if((a=$.extend(!0,{},c.defaultFnUnit)).fid=s,"Subflow"===a[FUNCTION_NAME])for(var p in a[OUT_DATA]=[l],a.param.functions)a.param.functions[p].fid=e.VA.Core.Utils.IDGenerator.func.id(),a.param.functions[p][OUT_DATA]=[l],a.param.functions[p].param["df-names"]=[l];n&&(a.param.functions[0].param["fs-paths"]=[n])}return a.parent=function(){return r},i&&(a.display.label=i),a},newPage:function(){return{id:e.VA.Core.Utils.IDGenerator.reportPage.id(),contents:{}}},newContent:function(t){var o=t.type,i=t.size,n=t.position,a=t.options,r=t.dataSourceId;return{id:e.VA.Core.Utils.IDGenerator.reportContent.id(),type:o,size:{width:i?i.width:720,height:i?i.height:250},position:{top:n?n.top:30,left:n?n.left:30,"z-index":n?n["z-index"]:100},options:a,dataSourceId:r}},addDataSource:function(t,e){void 0!==e&&e>-1?this.functions.splice(e,0,t):this.functions.push(t)},addPage:function(t,e){var o=this.report.pages,i=o.length;e=void 0!==e&&"number"==typeof e?i<e?i:e:i,o.splice(e,0,t)},addContent:function(t,e){var o=this.report.pages,i=o.length;if(i)e=void 0!==e&&"number"==typeof e?i-1<e?i-1:e:i-1;else{var n=this.newPage();this.addPage(n),e=0}o[e].contents[t.id]=t},addContentToSpecificPage:function(t,e){var o=this.report.pages;if(e)for(var i in o)if(o[i].id===e&&o[i].contents){o[i].contents[t.id]=t;break}},getDataSource:function(t){var e;if(t){var o=this.functions;for(var i in o)if(o[i].fid===t){e=o[i];break}}return e},getDataSourceIndex:function(t){var e,o=this.functions;for(var i in o)if(o[i].fid===t){e=i;break}return Number(e)},getDataSources:function(){return this.functions},getDataSourceUsingParam:function(t){var o,i=this.functions;if(t)if(t.modelId&&t.tableId)for(var n in i){let a=i[n];if(a.func===e.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING&&a.param.modelId===t.modelId&&a.param.tableId===t.tableId){o=a;break}}else if(t["fs-paths"])for(var n in i){let r=i[n];if(r.func!==e.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING&&"Subflow"===r[FUNCTION_NAME])for(var a in r.param.functions)if(r.param.functions[a].param["fs-paths"][0]===t["fs-paths"]){o=r;break}if(o)break}return o},getFunction:function(t){var e,o=this.functions;for(var i in o)if(o[i].fid===t){e=o[i];break}return e},getPage:function(t){var e,o=this.report.pages;for(var i in o)if(o[i].id===t){e=o[i];break}return e},getPageIndex:function(t){var e,o=this.report.pages;for(var i in o)if(o[i].id===t){e=i;break}return Number(e)},getPages:function(){return this.report.pages},getPageIdOfContent:function(t){var e,o=this.report.pages;for(var i in o)if(o[i].contents[t]){e=o[i].id;break}return e},getContent:function(t){var e,o=this.report.pages;for(var i in o)if(o[i].contents[t]){e=o[i].contents[t];break}return e},getContents:function(t){return void 0!==t&&"number"==typeof t?this.report.pages[t].contents:this.report.pages},getContentsUsingDataSource:function(t){var e=[],o=this.report.pages;for(var i in o)for(var n in o[i].contents)o[i].contents[n].dataSourceId===t&&e.push(o[i].contents[n]);return e},removeDataSource:function(t){var e=-1;for(var o in this.functions){if(this.functions[o].fid===t){e=o;break}}if(e>-1){var i=this.functions[e];return this.functions.splice(e,1),i}},removePage:function(t){for(var e,o=this.report.pages,i=0;i<o.length;i++)if(o[i].id===t){e=o[i],o.splice(i,1);break}return e},removeContent:function(t){var e,o=this.report.pages;for(var i in o)if(o[i].contents[t]){e=o[i].contents[t],delete o[i].contents[t];break}return e},renameDataSource:function(t,e){var o=this.functions;for(var i in o)if(o[i].fid===t){o[i].display.label=e;break}},changeSchedule:function(t,e){var o=this.functions;for(var i in o)if(o[i].fid===t){o[i].param.scheduleId=e||"";break}},changeFunc:function(t,e){var o=this.functions;for(var i in o)if(o[i].fid===t){o[i].func=e;break}}}}).call(this),function(){"use strict";var t=this.Brightics;function e(t){this.validator={},this.options=t||{}}e.prototype.validate=function(t){return[]},e.prototype.createValidator=function(t){},t.VA.Implementation.Visual.Validator=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Tools.Manager.SideBarManager.call(this,e)}e.prototype=Object.create(t.VA.Core.Tools.Manager.SideBarManager.prototype),e.prototype.constructor=e,e.prototype.configureLayout=function(){this.layout={dataBox:{id:"dataBox",label:t.locale.visual.dataBox,position:"left",width:261,manager:this,visible:!0},objectAndProperties:{id:"objectAndProperties",label:t.locale.visual.object,position:"right",width:338,manager:this,visible:!0}}},e.prototype.createSideBarArea=function(){t.VA.Core.Tools.Manager.SideBarManager.prototype.createSideBarArea.call(this),this.$parent.find(".brtc-va-studio-sidebar-area").addClass("padding-none")},e.prototype.createControls=function(){this.sideBar.dataBox=new t.VA.Core.Tools.SideBar.DataBoxSideBar(this.$parent.find(".brtc-va-studio-sidebar[name=dataBox]"),this.layout.dataBox),this.sideBar.objectAndProperties=new t.VA.Core.Tools.SideBar.ObjectAndPropertiesSideBar(this.$parent.find(".brtc-va-studio-sidebar[name=objectAndProperties]"),this.layout.objectAndProperties)},e.prototype.onActivated=function(){this.sideBar.dataBox.onActivated()},t.VA.Implementation.Visual.Tools.Manager.SideBarManager=e}.call(this),function(){"use strict";var t=this.Brightics;this.Brightics.VA.Implementation.Visual.Utils.ModelUtils={addChartContentToSelectedVisualModel:function(e){var o=Studio.getResourceManager(),i=e.dataSourceLabel,n=e.selectedModels,a=e.projectId,r=e.modelId,s=e.tableId,l=e.chartOptions;l.tag=e.dataSourceTag;var c=e.columns,p=e.changeLabel;for(var d in n){var h=n[d],u=h.getContents(),m={modelId:r,tableId:s},g=u.getDataSourceUsingParam(m);g?(p&&(g.display.label=i),g.display.charts.push(l)):((g=u.newDataSource(t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING)).display.label=i,g.display.charts=[l],g.display.columns=c,g.param.modelId=r,g.param.tableId=s,u.addDataSource(g)),o.updateFile(a,h)}},getSampleVO:function(){return{id:"m5hkx9gxbcemd8zj",project_id:"pdd84xa5bns9xsfz",label:"v1",contents:{mid:"m5hkx9gxbcemd8zj",type:"visual",title:"v1",functions:[{fid:"dsuht483gqzmbuze",func:"loadFromStaging",name:"Empty",outData:["tchuy2ythyet6muq"],param:{modelId:"mmrxqaz5t7zzjv8s",tableId:"tvzky2cus83cwzen"},display:{label:"Datatat-Load-Out"},persist:!0}],links:[],report:{pages:[{id:"rpqafeq65byyhnn3",contents:{rcpkr8v9eku7cjw4:{id:"rcpkr8v9eku7cjw4",type:"chart",size:{width:"100%",height:"25%"},position:{top:"0%",left:"0%"},options:{chart:{type:"line",width:"100%",height:"100%",style:{markers:{markerSize:"",markerType:""},thickness:{lineThickness:2},colorPickerEnable:!1,fillOpacity:1}},toolbar:{visible:!0,height:24},xAxis:{selected:[{name:"SepalLength",aggregation:"none",label:"SepalLength"}],visible:!0,rotation:0,minimum:null,maximum:null},yAxis:{selected:[{name:"SepalWidth",aggregation:"none",label:"SepalWidth"}],gridLineWidth:0,visible:!0},stripLines:{},legend:{visible:!0},colorBy:{selected:[]},lineBy:{selected:[]},valueBy:{selected:[]},sizeBy:{selected:[]},shapeBy:{selected:[]},fromCol:{selected:[]},toCol:{selected:[]},conditionCol:{selected:[]},nodeLabelCol:{selected:[]},edgeLabelCol:{selected:[]},parentCol:{selected:[]},childCol:{selected:[]},valueCol:{selected:[]},clusterCol:{selected:[]},clusterGroupCol:{selected:[]},heightCol:{selected:[]},typeCol:{selected:[{name:"mcc_type"}],typeMapping:{lotTime:{type:"L",label:"Lot"},processTime:{type:"P",label:"Process"},loadTime:{type:"O",label:"Load"},unloadTime:{type:"U",label:"Unload"},valueColumns:[{type:"C",column:"Unit"},{type:"W",column:"Wafer"}]}},columnFormatters:{}},dataSourceId:"dsuht483gqzmbuze"}}}]}},description:"",model_image:null,creator:"ty_tree.kim@samsung.com",create_time:"2017-02-11T07:32:25.629Z",updater:"ty_tree.kim@samsung.com",update_time:"2017-02-11T07:32:25.629Z",type:null,tag:null,event_key:"170211_163225_629705"}},getMobileTestSample:function(){return[{id:"mnsurbkqpnq6e4qk",project_id:"pt4rn27rtat4w8yb",label:"TEST",contents:{mid:"mnsurbkqpnq6e4qk",type:"visual",title:"TEST",functions:[{func:"loadFromStaging",name:"Empty",param:{modelId:"mr9ehbgjkn8jajja",tableId:"tb7fvr82fccta97r"},display:{label:"1. 반가워, Brightics! (with iris)-Statistic Summary-In"},persist:!0,fid:"dsczs5nz756msym6"},{func:"loadFromAlluxio",name:"Subflow",outData:["tmmjcw4t335tz4nv"],param:{functions:[{fid:"ffcfn6b42swamkvj",func:"load",name:"InOutData",outData:["tmmjcw4t335tz4nv"],param:{"io-mode":"read","fs-type":"alluxiocsv","df-names":["tmmjcw4t335tz4nv"],"fs-paths":["/brtc/repo/shared/array_test"]},persist:!0}],links:[]},display:{label:"/brtc/repo/shared/array_test"},persist:!0,fid:"dsb33anhwk9gd8mz"}],links:[],report:{pages:[{id:"rpja8cbfb2kcp3px",contents:{rcgd6f6sekkwrxum:{id:"rcgd6f6sekkwrxum",type:"chart",size:{width:720,height:250},position:{top:30,left:30},options:{chart:{type:"column",width:"100%",height:"100%"}},dataSourceId:"dsczs5nz756msym6"}}}]}},description:"",model_image:null,creator:"ty_tree.kim@samsung.com",create_time:"2017-03-30T01:33:39.778Z",updater:"ty_tree.kim@samsung.com",update_time:"2017-04-10T04:45:06.440Z",type:null,tag:null,event_key:"170410_134506_440660"},{id:"mnsurbkqpnq6e4q2",project_id:"pt4rn27rtat4w8yb",label:"TEST",contents:{mid:"mnsurbkqpnq6e4q2",type:"visual",title:"TEST",functions:[{func:"loadFromStaging",name:"Empty",param:{modelId:"mr9ehbgjkn8jajja",tableId:"tb7fvr82fccta97r"},display:{label:"2. 반가워, Brightics! (with iris)-Statistic Summary-In"},persist:!0,fid:"dsczs5nz756msym6"},{func:"loadFromAlluxio",name:"Subflow",outData:["tmmjcw4t335tz4nv"],param:{functions:[{fid:"ffcfn6b42swamkvj",func:"load",name:"InOutData",outData:["tmmjcw4t335tz4nv"],param:{"io-mode":"read","fs-type":"alluxiocsv","df-names":["tmmjcw4t335tz4nv"],"fs-paths":["/brtc/repo/shared/array_test"]},persist:!0}],links:[]},display:{label:"/brtc/repo/shared/array_test"},persist:!0,fid:"dsb33anhwk9gd8mz"}],links:[],report:{pages:[{id:"rpja8cbfb2kcp3px",contents:{rcgd6f6sekkwrxum:{id:"rcgd6f6sekkwrxum",type:"chart",size:{width:720,height:250},position:{top:30,left:30},options:{chart:{type:"column",width:"100%",height:"100%"}},dataSourceId:"dsczs5nz756msym6"}}}]}},description:"",model_image:null,creator:"ty_tree.kim@samsung.com",create_time:"2017-03-30T01:33:39.778Z",updater:"ty_tree.kim@samsung.com",update_time:"2017-04-10T04:45:06.440Z",type:null,tag:null,event_key:"170410_134506_440660"}]}}}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Implementation.Visual.Utils.RunnableFactory={_create:function(e,o){return{main:"",models:{},version:t.VA.Env.CoreVersion}},createForUnit:function(e,o,i,n,a){var r=this._create(o,i);delete r.args;var s=$.extend(!0,{},e,{display:null});t.VA.Core.Utils.ModelUtils.deleteDisplay(s),t.VA.Core.Utils.ModelUtils.deleteEmptyArray(s);var l=e.parent().mid;return r.main=l,r.models[l]={mid:l,type:"data",functions:[s]},r},createForFlow:function(t,e,o,i,n){var a=this._create(e,o);delete a.args;var r=t.mid;return a.main=r,a}}}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Dialogs.Dialog.call(this,e,o)}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=908,this.dialogOptions.height=295},e.prototype.createDialogContentsArea=function(t){var e=$('<div class="brtc-va-dialogs-datasource-schedule-grid brtc-style-dialogs-grid-transparent-border"></div>');t.append(e),this.createGrid(t.find(".brtc-va-dialogs-datasource-schedule-grid"))},e.prototype.createGrid=function(t){this.setOptions(),this.renderGrid(t)},e.prototype.renderGrid=function(t){this.isEmpty()?this.createEmptyControl("There is no item linked schedule"):(this.createHeader(t),this.createBody(t))},e.prototype.setOptions=function(t,e){this.headerOptions={totalCount:"",col1:"col1",col2:"col2"}},e.prototype.isEmpty=function(){return!1},e.prototype.createHeader=function(t){var e=$('<div class="brtc-va-dialogs-schedule-grid-header"></div>');if(this.headerOptions.totalCount){var o=$('<div class="brtc-va-dialogs-schedule-grid-header-count">   <div class="brtc-va-dialogs-schedule-grid-header-count-label">Total Data Source</div>   <div class="brtc-va-dialogs-schedule-grid-header-count-value">'+this.headerOptions.totalCount+"</div></div>");e.append(o)}if(this.headerOptions.col1){var i=$('<div class="brtc-va-dialogs-schedule-grid-header-col1">   <div class="schedule-label"></div></div>');i.find(".schedule-label").text(this.headerOptions.col1),e.append(i)}if(this.headerOptions.col2){var n=$('<div class="brtc-va-dialogs-schedule-grid-header-col2">   <div class="schedule-label"></div>   <div class="brtc-va-dialogs-schedule-icon-help" title="Schedule Name (Cron Expression , Owner)"></div></div>');n.find(".schedule-label").text(this.headerOptions.col2),e.append(n)}t.append(e)},e.prototype.createBody=function(t){},e.prototype.craeteMainRow=function(t){var e=$('<div class="brtc-va-dialogs-schedule-grid-row-main">   <div class="brtc-va-dialogs-schedule-grid-row-main-col1 col1"></div>   <div class="brtc-va-dialogs-schedule-grid-row-main-col2 col2"></div></div>');return t.append(e),e},e.prototype.craeteSubRow=function(t){var e=$('<div class="brtc-va-dialogs-schedule-grid-row-sub">   <div class="brtc-va-dialogs-schedule-grid-row-sub-col1 col1"></div>   <div class="brtc-va-dialogs-schedule-grid-row-sub-col2 col2"></div></div>');return t.append(e),e},e.prototype.makeLinkScheduleAndTable=function(t,e){var o={};for(var i in t){var n=JSON.parse(t[i].executeContents).models;for(var a in n)if("data"==n[a].type){var r=n[a].functions;for(var s in r){var l=r[s];for(var c in l[OUT_DATA]){var p=l[OUT_DATA][c];e.indexOf(p)>-1&&(o[p]||(o[p]=[]),o[p].push(t[i]))}}}}return o},e.prototype.makeScheduleList=function(t){var e=[{label:"None Schedule",value:""}];for(var o in this.linkTable[t]){var i=this.linkTable[t][o].scheduleId,n=this.linkTable[t][o].scheduleName,a=this.linkTable[t][o].cronExpression,r=this.linkTable[t][o].scheduleOwner;e.push({label:n+" ("+a+", "+r+")",value:i})}return e},e.prototype.getSchedule=function(e,o){$.ajax({url:"api/va/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}).done(function(t){e(t,o)}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e)})},t.VA.Implementation.Visual.Dialogs.ScheduleDialog=e}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");function o(e,o,i){this.editorInput=i,t.VA.Dialogs.Dialog.call(this,e,o)}o.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),o.prototype.constructor=o,o.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=1200,this.dialogOptions.height=640,this.dialogOptions.closeOnEscape=!1},o.prototype.createNewButton=function(e){var o=this;e.append($('<input type="button" class="brtc-va-dialogs-publish-management-new" value="'+t.locale.common.new+'">')),this.$newButton=e.find(".brtc-va-dialogs-publish-management-new").jqxButton({theme:t.VA.Env.Theme}),this.$newButton.click(function(){new t.VA.Implementation.Visual.Dialogs.NewPublishReportDialog(e,{close:function(e){if(e.OK){var i={label:e.label,publishReportId:e.id,url:e.url};t.VA.Core.Utils.CommonUtils.progress(o.preparePublish(o.getContentUnits(),o.getDataSources(),o.editorInput.data.id,e.id),{msg:"Preparing publish..."}).then(function(){return o.publishReport(i)}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),console.error(e)})}},title:t.locale.common.newPublishing})})},o.prototype.updatePublishReport=function(e){var o=this,i=$.extend(!0,{},e.publishContents);for(var n in i.data.contents.report.pages)for(var a in i.data.contents.report.pages[n].contents)delete i.data.contents.report.pages[n].contents[a].options.source;for(var r in i.data.contents.functions){var s=i.data.contents.functions[r];s.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.ALLUXIO?s.param.publishId=e.publishReportId:s.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING&&(s.param.scheduleId||(s.param.publishId=e.publishReportId))}i.data.contents.preference=localStorage;var l={url:"publishreports/"+e.publishReportId+"/update",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0,data:JSON.stringify({publishId:e.publishReportId,publishingTitle:e.label,publisher:t.VA.Env.Session.userId,projectId:e.publishContents.data.project_id,modelId:e.publishContents.data.id,publishContents:i,url:e.url})};$.ajax(l).done(function(){o.showPublishInfo()})},o.prototype.publishReport=function(e){var o=this,i=$.extend(!0,{},this.editorInput);for(var n in i.data.contents.report.pages)for(var a in i.data.contents.report.pages[n].contents)delete i.data.contents.report.pages[n].contents[a].options.source;for(var r in i.data.contents.functions){var s=i.data.contents.functions[r];s.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.ALLUXIO?s.param.publishId=e.publishReportId:s.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING&&(s.param.scheduleId||(s.param.publishId=e.publishReportId))}i.data.contents.preference=localStorage;var l={url:"publishreports",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0,data:JSON.stringify({publishId:e.publishReportId,publishingTitle:e.label,publisher:t.VA.Env.Session.userId,projectId:this.editorInput.data.project_id,modelId:this.editorInput.data.id,publishContents:i,url:e.url})};$.ajax(l).done(function(){o.showPublishInfo()})},o.prototype.createModifyButton=function(e){var o=this;e.append($('<input type="button" class="brtc-va-dialogs-publish-management-modify" value="'+t.locale.common.modify+'">')),this.$modifyButton=e.find(".brtc-va-dialogs-publish-management-modify").jqxButton({disabled:!0,theme:t.VA.Env.Theme}),this.$modifyButton.click(function(){var t=o.$publishGrid.jqxGrid("getselectedrowindexes"),i=o.$publishGrid.jqxGrid("getrowdata",t[0]);o.updateContents(e,i.publish_id)})},o.prototype.createDeleteButton=function(e){var o=this;e.append($('<input type="button" class="brtc-va-dialogs-publish-management-delete" value="'+t.locale.common.delete+'">')),this.$deleteButton=e.find(".brtc-va-dialogs-publish-management-delete").jqxButton({disabled:!0,theme:t.VA.Env.Theme}),this.$deleteButton.click(function(){var i={contentText:"Are you sure you want to delete these items?",close:function(t){if(t.OK){var e=o.$publishGrid.jqxGrid("getselectedrowindexes");for(var i in e){var n=o.$publishGrid.jqxGrid("getrowdata",e[i]),a={url:"publishreports/"+n.publish_id+"/delete",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),blocking:!0};$.ajax(a).done(function(){o.showPublishInfo()})}}},isCancel:!0};t.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(e,i)})},o.prototype.scheduleHeaderRenderer=function(t){return'<div style="margin-left: 30px; opacity:0.8; font-family: Arial; font-size: 16px; font-weight: bold; text-align: center; color: rgba(0, 0, 0, 0.8); float: left;" title="Error / Active / Inactive">'+t+'</div><div class="brtc-va-dialogs-schedule-icon-help" style="margin-top: 16px;" title="Error / Active / Inactive"></div>'},o.prototype.createPublishGrid=function(e){var o=this;e.append($('<div class="brtc-va-dialogs-publish-management-grid"></div>')),this.$publishGrid=e.find(".brtc-va-dialogs-publish-management-grid").jqxGrid({theme:t.VA.Env.Theme,width:"100%",height:"calc(100% - 38px)",altrows:!1,filterable:!1,sortable:!1,columnsresize:!1,selectionmode:"checkbox",showfiltercolumnbackground:!1,rowsheight:53,enabletooltips:!0,columns:[{text:"ID",datafield:"publish_id",align:"center",cellclassname:"brtc-grid-cell-bold",hidden:!0},{text:"Publishing Title",datafield:"publishing_title",renderer:o.gridV2Renderer,align:"center",cellclassname:"brtc-grid-cell-bold",width:"auto",cellsrenderer:o.titleRenderer.bind(this)},{text:"Publishing Date",datafield:"publishing_date",renderer:o.gridV2Renderer,align:"center",width:"20%",cellsalign:"center",cellclassname:"brtc-grid-cell-bold",cellsformat:"yyyy-MM-dd HH:mm:ss"},{text:"Publisher",datafield:"publisher",renderer:o.gridV2Renderer,align:"center",cellsalign:"center",cellclassname:"brtc-grid-cell-bold",width:"25%"},{text:"Embed Code",datafield:"embed_code",renderer:o.gridV2Renderer,align:"center",cellclassname:"brtc-grid-cell-bold",width:"12%",cellsrenderer:o.buttonRenderer,sortable:!1,menu:!1},{text:"Link",datafield:"link",renderer:o.gridV2Renderer,align:"center",cellclassname:"brtc-grid-cell-bold",width:"12%",cellsrenderer:o.buttonRenderer,sortable:!1,menu:!1}]}),this.$publishGrid.on("cellclick",function(e){if(e.preventDefault(),$(e.args.originalEvent.target).hasClass("brtc-va-publish-button")){var i=o.$publishGrid.jqxGrid("getrowdata",e.args.rowindex),n="",a="",r="";t.VA.Env.Session.subPath&&(r="/"+t.VA.Env.Session.subPath);var s=i.url?i.url:i.publish_id;"embed_code"===e.args.datafield?(n='<iframe style="width:900px; height:600px;" src="'+location.origin+r+"/publish/"+s+"?title="+i.publishing_title+'"></iframe>',a="Embed Code",o.copy(n,a)):"link"===e.args.datafield&&(n=location.origin+r+"/publish/"+s+"?title="+i.publishing_title,a="Link",o.copy(n,a))}}),this.showPublishInfo(e),this.setGridStyleV2(this.$publishGrid);var i=function(){var t=o.$publishGrid.jqxGrid("getselectedrowindexes");t.length>0?(1===t.length?o.$modifyButton.jqxButton({disabled:!1}):o.$modifyButton.jqxButton({disabled:!0}),o.$deleteButton.jqxButton({disabled:!1}),o.$deleteButton.css("cursor","pointer")):(o.$modifyButton.jqxButton({disabled:!0}),o.$deleteButton.jqxButton({disabled:!0}),o.$deleteButton.css("cursor","default"))};this.$publishGrid.on("rowselect",i.bind(o)),this.$publishGrid.on("rowunselect",i.bind(o))},o.prototype.updateContents=function(e,o){var i=this;new t.VA.Implementation.Visual.Dialogs.UpdateContentsDialog(e,{publish_id:o,title:t.locale.common.updateContents,close:function(e){if(e.OK){var o={modelId:e.modelId,projectId:e.projectId,publishReportId:e.publish_id},n=[],a=Studio.getResourceManager().getFile(o.projectId,o.modelId);for(var r in a.getContents().functions)if(a.getContents().functions[r].func===t.VA.Implementation.Visual.DATASOURCE_TYPE.ALLUXIO){var s=new Promise(function(e,i){var n=a.getContents().functions[r],s=a.data.id,l=n[OUT_DATA],c="/"+t.VA.Env.Session.userId+"/"+s+"/"+l,p="/"+o.publishReportId+"/"+s+"/"+l;t.VA.RepositoryQueryTemplate.copy(c,p,{blocking:!0}).done(function(){e()}).fail(function(t){i(t)})});n.push(s)}else if(a.getContents().functions[r].func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING&&!a.getContents().functions[r].param.scheduleId){s=new Promise(function(e,i){var n=a.getContents().functions[r],s=n.param.modelId,l=n.param.tableId,c="/"+t.VA.Env.Session.userId+"/"+s+"/"+l,p="/"+o.publishReportId+"/"+s+"/"+l;t.VA.RepositoryQueryTemplate.copy(c,p,{blocking:!0}).done(function(){e()}).fail(function(t){i(t)})});n.push(s)}o.publishContents=a,Promise.all(n).then(function(){i.updatePublishReport(o)},function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e)})}}})},o.prototype.copy=function(e,o){var i=navigator.userAgent.toLowerCase();if(-1!=i.indexOf("chrome"))try{var n=document.createElement("textarea");n.innerText=e,document.body.appendChild(n),n.focus(),document.execCommand("selectAll"),document.execCommand("copy"),n.style.display="none",t.VA.Core.Utils.WidgetUtils.openInformationDialog(o+" Copied to clipboard.",function(){n.remove()})}catch(e){t.VA.Core.Utils.WidgetUtils.openInformationDialog("Cannot copy to clipboard - System Error")}else if(-1!=i.indexOf("msie")||-1!=i.indexOf("trident"))try{window.clipboardData.setData("Text",e),t.VA.Core.Utils.WidgetUtils.openInformationDialog(o+" Copied to clipboard.")}catch(e){t.VA.Core.Utils.WidgetUtils.openInformationDialog("Cannot copy to clipboard - System Error")}},o.prototype.showPublishInfo=function(e){var o=this;$.ajax({url:"publishreports",type:"GET",contentType:"application/json; charset=utf-8",blocking:!1}).done(function(t){o.getIp(function(e){o.ip=e,o.getSchedule(t)})}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e)})},o.prototype.getSchedule=function(e){this.data=e;var o={localdata:e,datafields:[{name:"publish_id",type:"string"},{name:"publishing_title",type:"string"},{name:"publishing_date",type:"date"},{name:"publisher",type:"string"},{name:"embed_code",type:"string"},{name:"link",type:"string"},{name:"project_id",type:"string"},{name:"model_id",type:"string"},{name:"url",type:"string"}],datatype:"json"},i=new $.jqx.dataAdapter(o,{beforeLoadComplete:function(e){for(var o in e)e[o].publishing_title=t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e[o].publishing_title)}});this.$publishGrid.jqxGrid("source",i),this.$publishGrid.jqxGrid("clearselection"),this.$headerAera.find(".brtc-admin-total-count").text(this.data.length)},o.prototype.getIp=function(e){$.ajax({url:"publishreports/ip",type:"GET",contentType:"application/json; charset=utf-8",blocking:!1}).done(function(t){e(t)}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e)})},o.prototype.scheduleRenderer=function(t,e,o){var i=o.split("/");return'<div style="float: left; margin-left: 45px; height:53px; line-height:53px; color:red;">'+i[0]+'</div><div style="float: left; margin-left: 5px; margin-right: 5px; height:53px; line-height:53px;"> / </div><div style="float: left; height:53px; line-height:53px; color:green;">'+i[1]+'</div><div style="float: left; margin-left: 5px; margin-right: 5px; height:53px; line-height:53px;"> / </div><div style="float: left; height:53px; line-height:53px; color:grey;">'+i[2]+"</div>"},o.prototype.buttonRenderer=function(t,e,o){return"embed_code"===e?'<div class="brtc-float-left" index="'+t+'"><div class="brtc-va-publish-button code">Copy</div></div>':'<div class="brtc-float-left" index="'+t+'"><div class="brtc-va-publish-button link">Copy</div></div>'},o.prototype.titleRenderer=function(t,e,o){var i=this.$publishGrid.jqxGrid("getrowdata",t),n='<div class="brtc-style-flex-center">   <div class="brtc-va-publish-title" style="float: left" index="'+t+'" title="'+o+'">'+o+"</div>";if(this.checkNew(i.publishing_date)){var a=this.addNewIcon(n);return a+="</div>"}return n+="</div>"},o.prototype.checkNew=function(e){return t.VA.Core.Utils.CommonUtils.getTimeDifferenceFromNow(e)<24},o.prototype.addNewIcon=function(t){return t+='   <div class="brtc-va-publish-title-new"></div>'},o.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-dialogs-publish-management-header"></div><div class="brtc-va-dialogs-publish-management-body"></div>'),this.$headerAera=t.find(".brtc-va-dialogs-publish-management-header"),this.$bodyAera=t.find(".brtc-va-dialogs-publish-management-body"),this.createSumArea(this.$headerAera),this.createDeleteButton(this.$headerAera),this.createModifyButton(this.$headerAera),this.createNewButton(this.$headerAera),this.createPublishGrid(this.$bodyAera)},o.prototype.createSumArea=function(t){var e=$('<div class="brtc-va-dialogs-publish-management-header-sum">   <span>Total<strong class="brtc-admin-total-count"></strong></span></div>');t.append(e)},o.prototype.setGridStyleV2=function(t){t.addClass("GridStyleV2"),t.css({height:"calc(100% - 35px) !important","margin-top":"15px !important","margin-bottom":"20px !important"}),this.$mainControl.find("input[type=button]").width(100)},o.prototype.gridV2Renderer=function(t){return'<div style="opacity:0.8; font-family: Arial; font-size: 16px; font-weight: bold; text-align: center; color: rgba(0, 0, 0, 0.8);">'+t+"</div>"},o.prototype.createDialogButtonBar=function(e){t.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this,e),this.$okButton.val(t.locale.common.done),this.$cancelButton.css({display:"none"})},o.prototype.handleOkClicked=function(){t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)},o.prototype.getContentUnits=function(){return this.editorInput.getContents().report.pages.reduce(function(t,e){return t.concat(Object.values(e.contents))},[])},o.prototype.getDataSources=function(){return this.editorInput.getContents().functions.slice()},o.prototype.preparePublish=function(o,i,n,a){var r=this,s=o.filter(function(t){var e=l(t,i);return"chart"===t.type&&!e.param.scheduleId});function l(t,e){return e.find(function(e){return e.fid===t.dataSourceId})}function c(e){return e.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING}function p(e){var o=h(l(e,i));return t.VA.Core.Utils.FullRenderingUtils.isBigData({modelId:n,tableId:o,user:t.VA.Env.Session.userId,isPublish:!1})}function d(t){return c(t)?t.param.modelId:n}function h(t){var o=e.getOutTable(t)?e.getOutTable(t)[0]:"";return c(t)&&(o=t.param.tableId),o}function u(e){return e.reduce(function(e,o){var i=o[0],n=o[1];return e.then(function(){return function(e,o){return new Promise(function(i,n){t.VA.RepositoryQueryTemplate.copy(e,o,{blocking:!0}).done(function(){i()}).fail(function(t){n(t)})})}(i,n)})},Promise.resolve())}return u(i.filter(c).map(function(e){var o=d(e),i=h(e);return[["",t.VA.Env.Session.userId,o,i].join("/"),["",t.VA.Env.Session.userId,n,i].join("/")]})).then(function(){return t=s,e=p,Promise.all(t.map(function(t,o){return Promise.resolve().then(function(){return e(t,o)}).then(function(e){return e?t:void 0})})).then(function(t){return t.filter(function(t){return void 0!==t})});var t,e}).then(function(e){var o=e.map(function(e){return[e,function(e,o){var i=e.options,n=t.VA.Core.Utils.FullRenderingUtils.getFnUnit(i);t.VA.Core.Utils.ModelUtils.extendParent(r.editorInput.getContents(),n);var a=h(o);return n[IN_DATA][0]=a,n[OUT_DATA][0]=a+n.fid,n}(e,l(e,i))]}).filter(function(t){return"dummy"!==t[1].func}),a={mid:n,links:[],innerModels:{},type:"data",title:"Preparing publish...",functions:o.map(function(t){return t[1]})};return[o,a]}).then(function(e){var o,i=e[0],a=e[1];return 0===i.length?i:(o={model:t.VA.Core.Utils.ModelUtils.extendModel(a),modelLauncher:Studio.getJobExecutor(),launchOptions:{user:t.VA.Env.Session.userId,mid:n,hideDialog:!0}},new Promise(function(e,i){var n=o||{},a=n.model,r=n.modelLauncher,s=n.launchOptions,l={success:function(t){e(t)},fail:function(t){i(t)},catch:function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),i(e)}};r.launchModel(a,{},s,l)})).then(function(){return!0}).then(function(){return i})}).then(function(e){return e.map(function(e){var o=e[0],a=e[1],r=d(l(o,i)),s=a[OUT_DATA][0],c=t.VA.Core.Utils.FullRenderingUtils.getBigDataTargetTid(o,a[IN_DATA][0]);return[n,r,s,c]}).concat(i.map(function(t){var e=d(t),o=h(t);return[e,e,o,o]})).map(function(e){return[["",t.VA.Env.Session.userId,e[0],e[2]].join("/"),["",a,e[1],e[3]].join("/")]})}).then(u)},t.VA.Implementation.Visual.Dialogs.PublishReportDialog=o}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Implementation.Visual.Dialogs.ScheduleDialog.call(this,e,o)}e.prototype=Object.create(t.VA.Implementation.Visual.Dialogs.ScheduleDialog.prototype),e.prototype.constructor=e,e.prototype.setOptions=function(t,e){this.linkTable={},this.headerOptions={col1:"Data Name",col2:"Schedule"}},e.prototype.createBody=function(t){this.getSchedule(function(e){var o=$('<div class="brtc-va-dialogs-schedule-grid-row-wrapper border-bottom"></div>');t.append(o);var i=this.craeteMainRow(o),n=i.find(".col1"),a=i.find(".col2"),r=$('<div class="brtc-va-dialogs-schedule-icon-data"></div>'),s=$('<div class="schedule-label"></div>');s.text(this.options.name),s.attr("title",this.options.name),n.append(r).append(s);var l=$('<div class="combo"></div>');a.append(l),this.linkTable=this.makeLinkScheduleAndTable(e,[this.options.param.tableId]),l.jqxComboBox({source:this.makeScheduleList(this.options.param.tableId),theme:"office",width:"398px",dropDownWidth:"408px",height:"28px",openDelay:0,closeDelay:0,displayMember:"label",selectedIndex:0,valueMember:"value"}),l.jqxComboBox("getItemByValue",this.options.param.scheduleId)?l.jqxComboBox("selectItem",this.options.param.scheduleId||""):l.find("input").val("can not find schedule").addClass("error"),l.on("close",function(){"can not find schedule"!=$(this).find("input").val()&&$(this).find("input").removeClass("error")}),l.find("input").attr("readonly","readonly")}.bind(this),[this.options.param.tableId])},e.prototype.handleOkClicked=function(){"can not find schedule"===this.$mainControl.find(".combo input").val()?this.dialogResult.scheduleId=void 0:this.dialogResult.scheduleId=this.$mainControl.find(".combo").val(),t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)},t.VA.Implementation.Visual.Dialogs.DataSourceScheduleDialog=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Implementation.Visual.Dialogs.ScheduleDialog.call(this,e,o)}e.prototype=Object.create(t.VA.Implementation.Visual.Dialogs.ScheduleDialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Implementation.Visual.Dialogs.ScheduleDialog.prototype._initOptions.call(this),this.dialogOptions.width=908,this.dialogOptions.height=472},e.prototype.setOptions=function(t,e){var o=this.options.visualModel.getContents().getDataSources(),i=this.options.visualModel.getProjectId(),n=Studio.getResourceManager().getFiles(i),a={};for(var r in o){var s=o[r].param.tableId;for(var l in n)n[l].getContents().getFnUnitByOutTable(s)&&(a[n[l].getFileId()]||(a[n[l].getFileId()]={},a[n[l].getFileId()].contents=n[l],a[n[l].getFileId()].dataSource=[]),a[n[l].getFileId()].dataSource.push(o[r]))}for(var c in this.options.DFModels=a,this.linkTable={},this.tables=[],this.options.DFModels)for(var l in this.options.DFModels[c].dataSource)this.tables.push(this.options.DFModels[c].dataSource[l].param.tableId);this.headerOptions={totalCount:this.tables.length,col1:"Model",col2:"Schedule"}},e.prototype.isEmpty=function(){return!(Object.keys(this.options.DFModels).length>0)},e.prototype.createBody=function(t){this.getSchedule(function(e){this.linkTable=this.makeLinkScheduleAndTable(e,this.tables);var o=$('<div class="brtc-va-dialogs-schedule-grid-wrapper"></div>');t.append(o);var i=0;for(var n in this.options.DFModels){var a=[],r=$('<div class="brtc-va-dialogs-schedule-grid-row-wrapper"></div>');o.append(r);var s=this.options.DFModels[n],l=this.craeteMainRow(r);r.attr("index",i),l.attr("mid",n).attr("index",i),i++;var c=l.find(".col1"),p=$('<div class="brtc-va-dialogs-schedule-icon-plus-square" showDataSource="false"></div>'),d=$('<div class="schedule-label"></div>');for(var h in d.text(s.contents.getLabel()),c.append(p).append(d),p.click(function(){var t=$(this).closest(".brtc-va-dialogs-schedule-grid-row-main").attr("mid");"false"===$(this).attr("showDataSource")?($(this).attr("showDataSource","true"),$(".brtc-va-dialogs-schedule-grid-row-sub[mid="+t+"]").show()):($(this).attr("showDataSource","false"),$(".brtc-va-dialogs-schedule-grid-row-sub[mid="+t+"]").hide())}),s.dataSource){var u=this.craeteSubRow(r);u.attr("mid",n).attr("tableId",s.dataSource[h].param.tableId);let t=u.find(".col1"),e=u.find(".col2");var m=s.dataSource[h].param.tableId,g=s.contents.getContents().getFnUnitByOutTable(m),f=$('<div class="schedule-label function-name"></div>');f.text(g.display.label),f.attr("title",g.display.label);var v=$('<div class="brtc-va-dialogs-schedule-icon-table"></div>'),b=$('<div class="schedule-label datasource-name"></div>');b.text(s.dataSource[h].display.label),b.attr("title",s.dataSource[h].display.label),t.append(f).append(v).append(b);var y=$('<div class="combo"></div>');y.attr("dataSourceId",s.dataSource[h].fid),e.append(y);var C=this.makeScheduleList(m);for(var S in C){var I=!1;for(const t of a)if(C[S].value===t.value){I=!0;break}I||a.push(C[S])}y.jqxComboBox({source:C,theme:"office",width:"398px",dropDownWidth:"408px",height:"28px",openDelay:0,closeDelay:0,displayMember:"label",selectedIndex:0,valueMember:"value"}),y.jqxComboBox("getItemByValue",s.dataSource[h].param.scheduleId)?y.jqxComboBox("selectItem",s.dataSource[h].param.scheduleId||""):y.find("input").val("can not find schedule").addClass("error"),y.on("close",function(){"can not find schedule"!=$(this).find("input").val()&&$(this).find("input").removeClass("error")}),y.find("input").attr("readonly","readonly")}var V=l.find(".col2"),A=$('<div class="combo"></div>');A.attr("mid",n),V.append(A),A.jqxComboBox({source:a,theme:"office",width:"398px",dropDownWidth:"408px",height:"28px",openDelay:0,closeDelay:0,displayMember:"label",valueMember:"value",placeHolder:"- Select Schedule -"}),A.on("change",function(t){var e=$(this).attr("mid"),o=t.args.item.value;$(this).closest(".brtc-va-dialogs-schedule-grid-row-main").find(".brtc-va-dialogs-schedule-icon-plus-square").attr("showDataSource","true"),$(".brtc-va-dialogs-schedule-grid-row-sub[mid="+e+"]").show();for(var i=$(this).closest(".brtc-va-dialogs-schedule-grid-row-wrapper").find(".brtc-va-dialogs-schedule-grid-row-sub[mid="+e+"] .combo"),n=0;n<i.length;n++){var a=$(i[n]).jqxComboBox("getItems");for(var r in a)if(a[r].value===o){$(i[n]).jqxComboBox("selectItem",o);break}}})}o.find(".brtc-va-dialogs-schedule-grid-row-wrapper[index="+(i-1)+"]").addClass("border-bottom"),o.perfectScrollbar()}.bind(this),this.tables)},e.prototype.handleOkClicked=function(){for(var e=[],o=this.$mainControl.find(".brtc-va-dialogs-schedule-grid-row-sub .combo"),i=0;i<o.length;i++){var n=$(o[i]).find("input").val(),a=$(o[i]).val(),r=$(o[i]).attr("dataSourceId");"can not find schedule"!=n&&e.push({dataSourceId:r,scheduleId:a})}this.dialogResult.connectInfo=e,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)},t.VA.Implementation.Visual.Dialogs.ModelScheduleDialog=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Dialogs.Dialog.call(this,e,o)}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=550,this.dialogOptions.height=250,this.id=t.VA.Core.Utils.IDGenerator.report.id(14),this.useDefatulUrl=!0},e.prototype.createTitleArea=function(){var e=$('<div class="brtc-new-publish-title-wrapper"><div class="brtc-va-dialogs-add2lib-library-label">'+t.locale.common.publishingTitle+'</div><input type="text" class="brtc-va-dialogs-add2lib-library-name-input" valid-type="type1" maxlength="80"/></div>');this.$wrapper.append(e),this.$nameInput=this.$mainControl.find(".brtc-va-dialogs-add2lib-library-name-input").jqxInput({theme:t.VA.Env.Theme,placeHolder:t.locale.placeHolder.enterName,width:"calc(100% - 100px)",height:"25px"})},e.prototype.createUrlArea=function(){var e=this,o=$('<div class="brtc-new-publish-url-wrapper brtc-style-display-flex brtc-style-flex-direction-row"><div class="brtc-va-dialogs-add2lib-library-label">URL</div><div class="brtc-va-dialogs-add2lib-library-prefix brtc-style-margin-bottom-20 brtc-style-line-height-30">/publish/</div><input type="text" class="brtc-va-dialogs-add2lib-library-url-default-input" valid-type="type1" maxlength="80"/><input type="url" class="brtc-va-dialogs-add2lib-library-url-custom-input brtc-style-padding-left-10" valid-type="type1" maxlength="80"/><div class="brtc-va-dialogs-add2lib-library-checkbox brtc-style-height-30px"></div><div class="brtc-va-dialogs-add2lib-library-checkbox-label brtc-style-line-height-27 brtc-style-height-30px brtc-style-padding-top-3">Default</div></div>');this.$wrapper.append(o),this.$urlDefaultInput=this.$mainControl.find(".brtc-va-dialogs-add2lib-library-url-default-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0,width:"calc(100% - 200px)",height:"25px"}),this.$urlDefaultInput.val(e.id),this.$urlCustomInput=this.$mainControl.find(".brtc-va-dialogs-add2lib-library-url-custom-input").jqxInput({theme:t.VA.Env.Theme,placeHolder:"Enter URL",width:"calc(100% - 200px)",height:"25px"}),this.$urlCustomInput.on("keyup",function(t){console.log(t)}),this.$urlCustomInput.hide(),this.$defaultCheckBox=this.$mainControl.find(".brtc-va-dialogs-add2lib-library-checkbox"),this.$defaultCheckBox.jqxCheckBox({theme:t.VA.Env.Theme,width:"30px",height:"25px",checked:!0}),this.$defaultCheckBox.on("change",function(t){console.log(t.args.checked),1==t.args.checked?(e.useDefatulUrl=!0,e.$urlCustomInput.hide(),e.$urlDefaultInput.show()):(e.useDefatulUrl=!1,e.$urlCustomInput.show(),e.$urlDefaultInput.hide())})},e.prototype.createDialogContentsArea=function(e){this.$wrapper=$('<div class="brtc-new-publish-wrapper brtc-style-display-flex brtc-style-flex-direction-column"></div>'),e.append(this.$wrapper),this.createTitleArea(),this.createUrlArea(),t.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(e.find(".brtc-va-dialogs-add2lib-library-name-input")),this.setFocus()},e.prototype.setFocus=function(){this.$nameInput.focus()},e.prototype.checkDuplicatedUrl=function(){var e=this,o={url:"publishreports/check/"+this.dialogResult.url,type:"GET",contentType:"application/json; charset=utf-8",blocking:!1};$.ajax(o).done(function(o){if(o.isDuplicate){var i="'"+e.dialogResult.url+"' is already exist.";t.VA.Core.Utils.WidgetUtils.openErrorDialog(i)}else t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(e)}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e)})},e.prototype.handleOkClicked=function(){return this.$nameInput.val()?this.useDefatulUrl||this.$urlCustomInput.val()?(this.dialogResult.label=this.$nameInput.val(),this.dialogResult.id=this.id,this.dialogResult.url=this.useDefatulUrl?"":this.$urlCustomInput.val(),void(this.useDefatulUrl?t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this):this.checkDuplicatedUrl())):(t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter URL."),void this.$urlCustomInput.focus()):(t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter publishing title."),void this.$nameInput.focus())},t.VA.Implementation.Visual.Dialogs.NewPublishReportDialog=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Dialogs.Dialog.call(this,e,o)}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=1080,this.dialogOptions.height=900,this.dialogOptions.resizable=!0,this.dialogOptions.maxWidth=1080,this.dialogOptions.maxHeight=900},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-select-visualmodel-contents brtc-style-select-visual-model-dialog"),t.append('<div class="brtc-va-dialogs-select-visualmodel-contents-datasource-input-area  select-visual-model-dialog brtc-style-dialogs-contents-input-area"></div>'),t.append('<div class="brtc-va-dialogs-select-visualmodel-contents-datasource-tag-input-area  select-visual-model-dialog brtc-style-dialogs-contents-input-area"></div>'),t.append('<div class="brtc-va-dialogs-select-visualmodel-contents-viewer select-visual-model-dialog brtc-style-dialogs-contents-area"></div>'),this.createVisualModelList(t.find(".brtc-va-dialogs-select-visualmodel-contents-viewer")),this.createDataSourceAliasInput(t.find(".brtc-va-dialogs-select-visualmodel-contents-datasource-input-area")),this.createDataSourceTagInput(t.find(".brtc-va-dialogs-select-visualmodel-contents-datasource-tag-input-area"))},e.prototype.createVisualModelList=function(e){var o=this.options.projectId,i=this.options.projectLabel,n=this.options.visualModels;this.visualModelListViewer=new t.VA.Implementation.Visual.Views.VisualModelListViewer(e,{projectId:o,projectLabel:i,visualModels:n})},e.prototype.createDataSourceAliasInput=function(e){e.append('<span class="brtc-va-dialogs-select-visualmodel-contents-datasource-label ">Data Source Label: </span>'),this.$nameInput=$('<input type="text"  class="brtc-va-dialogs-select-visualmodel-contents-datasource-input" maxlength="80"/>'),e.append(this.$nameInput),this.$nameInput.jqxInput({placeHolder:"Enter a data source label.",theme:t.VA.Env.Theme,width:"calc(100% - 145px)",height:"25px"}),this.$nameInput.val(this.options.defaultDataSourceLabel)},e.prototype.createDataSourceTagInput=function(e){e.append('<span class="brtc-va-dialogs-select-visualmodel-contents-datasource-tag ">Tag: </span>'),this.$tagInput=$('<input type="text"  style="margin-left: 100px;" class="brtc-va-dialogs-select-visualmodel-contents-datasource-input" maxlength="80"/>'),e.append(this.$tagInput),this.$tagInput.jqxInput({placeHolder:"Enter a tag.",theme:t.VA.Env.Theme,width:"calc(100% - 145px)",height:"25px"})},e.prototype.handleOkClicked=function(){var e=this,o=this.visualModelListViewer.getSelectedModels();if(o.length)if(this.$nameInput.val().trim()){this.dialogResult.selectedModels=o,this.dialogResult.dataSourceLabel=this.$nameInput.val(),this.dialogResult.dataSourceTag=this.$tagInput.val(),this.dialogResult.changeLabel=!1;var i={};for(var n in o){var a=o[n].getContents(),r={modelId:this.options.modelId,tableId:this.options.tableId},s=a.getDataSourceUsingParam(r);s&&s.display.label!==this.dialogResult.dataSourceLabel&&(i[a.mid]={title:a.title,dataSourceLabel:s.display.label})}if(Object.keys(i).length){t.VA.Core.Utils.WidgetUtils.openConfirmDialog("This data source already exists in the report(s) you selected. Do you want to change the data source label into the text you entered?",function(o){o.OK&&(e.dialogResult.changeLabel=!0,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(e))})}else t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter a data source label.");else t.VA.Core.Utils.WidgetUtils.openErrorDialog("At least one must be selected.")},t.VA.Implementation.Visual.Dialogs.SelectVisualModelDialog=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Dialogs.Dialog.call(this,e,o)}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=550,this.dialogOptions.height=600,this.projectId,this.modelId},e.prototype.createDialogContentsArea=function(t){var e=this;this.$wrapper=$('<div class="brtc-update-contents-wrapper brtc-style-height-full brtc-style-display-flex brtc-style-flex-direction-column"></div>'),t.append(this.$wrapper);var o={url:"publish/"+this.options.publish_id,type:"POST",contentType:"application/json; charset=utf-8",async:!1};$.ajax(o).done(function(t){e.projectId=t.reportContent.project_id,e.modelId=t.reportContent.id,e.description=t.reportContent.description,e.createProjectControl(),e.createModelControl(),e.createDescriptionControl()})},e.prototype.getModels=function(t){return Studio.getResourceManager().getFiles(t)},e.prototype.createProjectControl=function(){var e=this,o=$('<div class="brtc-update-contents-current-wrapper brtc-style-display-flex"><div class="brtc-va-dialogs-add2lib-library-label">'+t.locale.common.project+'</div><div class="brtc-va-dialogs-add2lib-library-selector brtc-style-col-12"></div></div>'),i=o.find(".brtc-va-dialogs-add2lib-library-selector");this.$wrapper.append(o),this.projectSelector=new t.VA.Core.Tools.ProjectSelector(i,{projectId:this.projectId,onChange:function(t){e.projectId=t;var o=e.getModels(t),i=[];_.map(o,function(t){i.push({text:t.getLabel(),value:t.getFileId()})}),e.modelSelector&&e.modelSelector.setSource(i)}})},e.prototype.createModelControl=function(){var e=this,o=$('<div class="brtc-update-contents-current-wrapper brtc-style-display-flex"><div class="brtc-va-dialogs-add2lib-library-label">'+t.locale.common.report+'</div><div class="brtc-va-dialogs-add2lib-library-selector brtc-style-col-12"></div></div>'),i=o.find(".brtc-va-dialogs-add2lib-library-selector");this.$wrapper.append(o),this.modelSelector=new t.VA.Core.Tools.ModelSelector(i,{projectId:this.projectId,modelId:this.modelId,type:"visual",onChange:function(t){e.modelId=t;var o=Studio.getResourceManager().getFile(e.projectId,e.modelId);e.description=o.getDescription(),e.renderDescriptions()}})},e.prototype.createDescriptionControl=function(){var e=$('<div class="brtc-update-contents-current-wrapper brtc-style-display-flex brtc-style-flex-1"><div class="brtc-va-dialogs-add2lib-library-label">'+t.locale.common.description+'</div><div class="brtc-va-dialogs-add2lib-library-description brtc-style-col-12"></div></div>');this.$descriptionControlArea=e.find(".brtc-va-dialogs-add2lib-library-description"),this.$wrapper.append(e),this.renderDescriptions()},e.prototype.renderDescriptions=function(){this.$descriptionControlArea&&this.$descriptionControlArea.html(this.description)},e.prototype.handleOkClicked=function(){this.projectId&&this.modelId?(this.dialogResult.publish_id=this.options.publish_id,this.dialogResult.projectId=this.projectId,this.dialogResult.modelId=this.modelId,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)):t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please choose project/report.")},t.VA.Implementation.Visual.Dialogs.UpdateContentsDialog=e}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.init(),this.retrieveParent(),this.createControls()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.createLayout=function(){this.$mainControl=$('<div class="brtc-va-controls-options-viewer brtc-style-option-viewer brtc-style-s-sidebar-background text" viewer-type="text"></div>'),this.$parent.append(this.$mainControl),this.createPropertiesLayout(),this.createArrangeLayout()},e.prototype.createPropertiesLayout=function(){this.$properties=$('<div class="brtc-va-controls-options-viewer-unit properties"><span class="brtc-style-option-category brtc-style-s-option-category">'+t.locale.common.properties+'</span><div class="brtc-va-controls-options-viewer-content"></div></div>'),this.$mainControl.append(this.$properties)},e.prototype.createBackgroundLayout=function(){this.$transparent=$('<div class="brtc-va-controls-options-viewer-unit background"><span class="brtc-style-option-category brtc-style-s-option-category">'+t.locale.common.background+'</span><div class="brtc-va-controls-options-viewer-content transparent"></div><div class="brtc-va-controls-options-viewer-content-label">Transparent</div></div>'),this.$mainControl.append(this.$transparent)},e.prototype.createArrangeLayout=function(){this.$arrange=$('<div class="brtc-va-controls-options-viewer-unit arrange"><span class="brtc-style-option-category brtc-style-s-option-category">'+t.locale.common.arrange+'</span><div class="brtc-va-controls-options-viewer-content"></div></div>'),this.$mainControl.append(this.$arrange)},e.prototype.init=function(){},e.prototype.createControls=function(){},e.prototype.showOption=function(t){this.contentUnit=t,this.$mainControl.show()},e.prototype.hideOption=function(){this.$mainControl.hide()},e.prototype.destroy=function(){},e.prototype.getEditor=function(){return this.options.optionPanelManager.getEditor()},e.prototype.createArrangeControl=function(){var t=this;this.$arrangeControl=$('<div class="brtc-va-controls-options-viewer-arrange"><div class="brtc-va-controls-options-viewer-arrange-wrapper"><div class="brtc-va-controls-options-viewer-arrange-front front arrange-button"><div class="button"></div></div><div class="brtc-va-controls-options-viewer-arrange-plus plus arrange-button"><div class="button"></div></div><div class="brtc-va-controls-options-viewer-arrange-minus minus arrange-button"><div class="button"></div></div><div class="brtc-va-controls-options-viewer-arrange-backend backend arrange-button"><div class="button"></div></div></div></div>'),this.$arrange.find(".brtc-va-controls-options-viewer-content").append(this.$arrangeControl);var e=this.$arrangeControl.find(".front"),o=this.$arrangeControl.find(".backend"),i=this.$arrangeControl.find(".plus"),n=this.$arrangeControl.find(".minus");e.attr("title","Bring to Front"),o.attr("title","Send to Back"),i.attr("title","Bring Forward"),n.attr("title","Send Backward"),e.click(function(){t.handleArrange("front")}),o.click(function(){t.handleArrange("backend")}),i.click(function(){t.handleArrange("plus")}),n.click(function(){t.handleArrange("minus")})},e.prototype.handleArrange=function(t){var e=this.contentUnit.getZIndex(),o=this.contentUnit.getPaper();"front"===t?e=o.getMaxZIndex()+1:"backend"===t?e=o.getMinZIndex()-1:"plus"===t?e+=1:"minus"===t&&(e-=1);var i=$.extend(!0,{},this.contentUnit.content.style),n=$.extend(!0,i,{"z-index":e});this.options.optionPanelManager.handleStyleChanged(this.contentUnit.content,n)},t.VA.Implementation.Visual.Views.BaseOptionViewer=e}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("crel");function o(e,o){t.VA.Implementation.Visual.Views.BaseOptionViewer.call(this,e,o)}o.prototype=Object.create(t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype),o.prototype.constructor=o,o.prototype.init=function(){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.init.call(this),this.chartOptionControlMap={}},o.prototype.createControls=function(){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.createControls.call(this),this.createLayout(),this.createArrangeControl(),this.$mainControl.find(".brtc-va-controls-options-panel").perfectScrollbar()},o.prototype.showOption=function(e){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.showOption.call(this,e),this.refresh()},o.prototype.refresh=function(){if(this.contentUnit){var o,i=this,n=this.contentUnit.options.content.id,a={chartOption:$.extend(!0,{},this.contentUnit.getChartOption()),chartTypeList:(o=Object.keys(t.Chart.Registry).slice(),o.splice(o.indexOf("biplot"),1),o),chartTypeSelectable:!0,callBack:{onChartOptionChanged:function(){i.contentUnit.onChartOptionChanged.apply(i.contentUnit,arguments)},onChartTypeChanged:function(){i.contentUnit.onChartTypeChanged.apply(i.contentUnit,arguments)},onDataSourceChanged:function(){i.contentUnit.onDataSourceChanged.apply(i.contentUnit,arguments)}},dataSource:{selectable:!0,getDataSourceList:function(){return i.getDataSourceList()},getDataSourceColumnList:function(t){return i.getDataSourceColumnList(t)}}};if(void 0===this.chartOptionControlMap[n]){var r=$(e("div",{class:"brtc-bcharts-option__wrapper"}));this.$properties.append(r),this.chartOptionControlMap[n]=r.bchartsOption(a)}else this.chartOptionControlMap[n].show(),this.chartOptionControlMap[n].bchartsOption("show"),this.chartOptionControlMap[n].bchartsOption("setChartOptions",a.chartOption);this.$mainControl.find(".brtc-va-controls-options-panel").perfectScrollbar("update")}},o.prototype.hideOption=function(){for(var e in t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.hideOption.call(this),this.chartOptionControlMap)this.chartOptionControlMap[e].hide(),this.chartOptionControlMap[e].bchartsOption("hide")},o.prototype.getDataSourceList=function(){var t=[];for(var e in this.getEditor().options.editorInput.getContents().getDataSources()){var o=this.getEditor().options.editorInput.getContents().getDataSources()[e];t.push({value:o.fid,label:o.display.label||""})}return t},o.prototype.getDataSourceColumnList=function(t){var e=[];for(var o in this.getEditor().options.editorInput.getContents().getDataSources()){var i=this.getEditor().options.editorInput.getContents().getDataSources()[o];if(i.fid==t)for(var n in i.display.columns)e.push(i.display.columns[n])}return e},o.prototype.destroy=function(){var t=this.contentUnit?this.contentUnit.options.content.id:"";this.chartOptionControlMap[t]&&this.chartOptionControlMap[t].bchartsOption("destroy"),this.$mainControl.remove()},t.VA.Implementation.Visual.Views.OptionViewer.chart=o}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.init(),this.retrieveParent(),this.createControls()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-datasourceexplorer brtc-style-tab-contents">   <div class="brtc-va-views-datasourceexplorer-area brtc-style-tab-contents-area">       <div class="brtc-va-views-databoxcontrol-area"></div>       <div class="brtc-va-views-datasourcepanel-area"></div>   </div></div>'),this.$parent.append(this.$mainControl),this._createDataBoxControl(this.$mainControl.find(".brtc-va-views-databoxcontrol-area")),this._createDataSourcePanel(this.$mainControl.find(".brtc-va-views-datasourcepanel-area"))},e.prototype._createDataBoxControl=function(e){var o=this;this.$dataBoxControl=$('<div class="brtc-va-views-databoxcontrol">   <div class="brtc-va-views-databoxcontrol-body">       <div class="brtc-va-views-databoxcontrol-new-data-button brtc-style-views-databoxcontrol-button">           <div class="brtc-va-views-databoxcontrol-new-data-button-image brtc-style-views-databoxcontrol-button-image">               <div class="brtc-va-views-databoxcontrol-new-data-button-image-element brtc-styele-views-databoxcontrol-image-element"></div>           </div>           <div class="brtc-va-views-databoxcontrol-new-data-button-text">'+t.locale.common.newData+'</div>       </div>       <div class="brtc-va-views-databoxcontrol-connect-schedule-button brtc-style-views-databoxcontrol-button">           <div class="brtc-va-views-databoxcontrol-connect-schedule-button-image brtc-style-views-databoxcontrol-button-image">               <div class="brtc-va-views-databoxcontrol-connect-schedule-button-image-element brtc-styele-views-databoxcontrol-image-element"></div>           </div>           <div class="brtc-va-views-databoxcontrol-connect-schedule-button-text">CONNECT SCHEDULE</div>       </div>   </div></div>'),e.append(this.$dataBoxControl),this.$dataBoxControl.find(".brtc-va-views-databoxcontrol-new-data-button").click(function(t){o._handleNewDataButtonClick(t)}),this.$dataBoxControl.find(".brtc-va-views-databoxcontrol-connect-schedule-button").click(function(t){o._handleConnectScheduleButtonClick(t)})},e.prototype._handleNewDataButtonClick=function(e){var o=this;new t.VA.Implementation.Visual.Wizards.DataAdditionWizard(o.$mainControl,{mode:"open",visualModel:o.options.editor.options.editorInput.getContents(),close:function(e){if(e.fileName){var i=o.options.editor.getModel(),n=e.fileAlias||e.fileName,a=e.fileName,r=i.newDataSource(e.type,n,a),s=new t.VA.Implementation.Visual.Editors.Diagram.Commands.NewDataSourceCommand(o,{dataSource:r});o.options.editor.getCommandManager().execute(s);var l={success:function(t){o.getActivePanel().addDataSource(r),o.getActivePanel().renderColumns(r.fid)},fail:function(t){o.getActivePanel().addDataSource(r),o.getActivePanel().renderColumns(r.fid)},abort:function(t){o.getActivePanel().addDataSource(r),o.getActivePanel().renderColumns(r.fid)}};Studio.getJobExecutor().launchUnit(r,{},{persist:!0},l)}}})},e.prototype._handleConnectScheduleButtonClick=function(e){var o=this,i=this.options.editor.getEditorInput();new t.VA.Implementation.Visual.Dialogs.ModelScheduleDialog(this.$mainControl,{resourceManager:Studio.getResourceManager(),visualModel:i,close:function(e){if(e.OK){var i=new t.VA.Core.CompoundCommand(this);for(var n in e.connectInfo){var a=e.connectInfo[n].dataSourceId,r=e.connectInfo[n].scheduleId,s=new t.VA.Implementation.Visual.Editors.Diagram.Commands.ChangeScheduleCommand(this,{dataSourceId:a,scheduleId:r}),l=new t.VA.Implementation.Visual.Editors.Diagram.Commands.ChangeFuncCommand(this,{dataSourceId:a,func:"loadFromStaging"});i.add(s),i.add(l)}o.options.editor.getCommandManager().execute(i)}},title:"Connect Schedule"})},e.prototype.init=function(){this.dataSourcePanel={}},e.prototype.destroy=function(t){if(t){var e=t.id;this.dataSourcePanel[e]&&(this.dataSourcePanel[e].destroy(),this.dataSourcePanel[e]=null)}else for(var o in this.dataSourcePanel)this.dataSourcePanel[o].destroy(),this.dataSourcePanel[o]=null},e.prototype.editorChanged=function(t){if(t){var e=t.options.editorInput;this.activeEditor&&this.dataSourcePanel[this.activeEditor.options.editorInput.id]&&this.dataSourcePanel[this.activeEditor.options.editorInput.id].hide(),this.activeEditor=t,this.dataSourcePanel[e.id]?this.dataSourcePanel[e.id].show():this._createDataSourcePanel(this.$mainControl.find(".brtc-va-views-datasourcepanel-area"))}else this.activeEditor=null},e.prototype._createDataSourcePanel=function(e){var o=this.options.editor.options.editorInput;this.dataSourcePanel[o.id]=new t.VA.Implementation.Visual.Views.Units.DataSourcePanel(e,{width:"100%",height:"100%",editor:this.options.editor,editorInput:o})},e.prototype.getActivePanel=function(){return this.dataSourcePanel[this.options.editor.getEditorInput().id]},t.VA.Implementation.Visual.Views.DataSourceExplorer=e}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls(),this.resourceManager=Studio.getResourceManager()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-optionpanel brtc-style-tab-contents">   <div class="brtc-va-views-optionpanel-area brtc-style-tab-contents-area brtc-style-s-sidebar-background"></div></div>'),this.$parent.append(this.$mainControl),this.createViewer(this.$mainControl.find(".brtc-va-views-optionpanel-area")),this._createOptionPanel(),this.selectionChanged([])},e.prototype.createViewer=function(e){var o=this;this.$objectControl=$('<div>   <div class="brtc-va-controls-options-viewer brtc-style-option-viewer brtc-style-s-option-viewer" viewer-type="object" /></div>'),e.append(this.$objectControl);var i=$('<div class="brtc-va-editor-toolitem brtc-style-editor-toolitem brtc-style-editor-toolitem-large brtc-style-s-editor-toolitem brtc-style-s-background-image-none brtc-style-display-flex" tool-type="multi-selector">   <div class="brtc-va-editor-toolitem brtc-style-editor-toolitem brtc-style-s-editor-toolitem brtc-style-margin-0 brtc-style-s-background-image-none" title="Add scatter" item-type="add-chart">       <div class="brtc-va-editor-toolitem-chart-type" chart-type="scatter"></div>   </div>   <div class="brtc-va-editor-toolitem-selector-parent brtc-style-col-12 brtc-style-display-flex brtc-style-align-items-center brtc-style-justify-content-center brtc-style-text-align-end brtc-style-cursor-pointer">      <span class="brtc-style-s-font-size-11 brtc-style-s-font-faminly-arial">scatter</span>      <span class="brtc-style-cursor-pointer brtc-style-editor-toolitem-selector brtc-style-s-editor-toolitem-selector"></span>   </div></div>');this.$objectControl.find(".brtc-va-controls-options-viewer[viewer-type=object]").append(i),i.find(".brtc-va-editor-toolitem-chart-type").click(function(){if(o.options.editor.diagramEditorPage.selectedPageId){var t=o.options.editor.diagramEditorPage.controls[o.options.editor.diagramEditorPage.selectedPageId],e=t.createNewChartContentCommand($(this).attr("chart-type"),{});e&&t.executeCommand(e)}});var n=Object.keys(t.Chart.Registry).slice();n.splice(n.indexOf("biplot"),1),i.find(".brtc-va-editor-toolitem-selector-parent").click(function(){new t.Chart.Adonis.Component.Dialogs.ChartTypeSelectorDialog(i,{value:i.find(".brtc-va-editor-toolitem-chart-type").attr("chart-type"),windowPosition:"bottom",chartTypeList:n.sort(),close:function(t){if(o.setToolItemSelection(t),o.options.editor.diagramEditorPage.selectedPageId){var e=o.options.editor.diagramEditorPage.controls[o.options.editor.diagramEditorPage.selectedPageId];e.executeCommand(e.createNewChartContentCommand(t,{}))}}})});var a=$('<div class="brtc-va-editor-toolitem brtc-style-editor-toolitem brtc-style-editor-toolitem-large brtc-style-s-editor-toolitem brtc-style-s-background-image-none" title="Add Text" item-type="add-text">    <div class="brtc-va-editor-toolitem-text-type" chart-type="text"></div>    <span class="brtc-style-s-font-size-11 brtc-style-s-font-faminly-arial">text</span></div>');this.$objectControl.find(".brtc-va-controls-options-viewer[viewer-type=object]").append(a),a.find(".brtc-va-editor-toolitem-text-type").click(function(){if(o.options.editor.diagramEditorPage.selectedPageId){var t=o.options.editor.diagramEditorPage.controls[o.options.editor.diagramEditorPage.selectedPageId],e=t.createNewTextContentCommand();e&&t.executeCommand(e)}}),this.setToolItemSelection("scatter")},e.prototype._createOptionPanel=function(){for(var e in this.optionViewer={},t.VA.Implementation.Visual.CONTENT_TYPE){var o=t.VA.Implementation.Visual.CONTENT_TYPE[e];this.optionViewer[o]=new t.VA.Implementation.Visual.Views.OptionViewer[o](this.$mainControl.find(".brtc-va-views-optionpanel-area"),{optionPanelManager:this}),this.optionViewer[o].hideOption()}},e.prototype.selectionChanged=function(e){if("none"!=this.$objectControl.find(".brtc-style-popup").css("display")&&this.$objectControl.find(".brtc-style-popup").hide(),!Array.isArray(e)||1!=e.length){for(var o in t.VA.Implementation.Visual.CONTENT_TYPE){let e=t.VA.Implementation.Visual.CONTENT_TYPE[o];this.optionViewer[e]&&this.optionViewer[e].hideOption()}return this.optionViewer.page?this.optionViewer.page.showOption():this.optionViewer.page=new t.VA.Implementation.Visual.Views.OptionViewer.page(this.$mainControl.find(".brtc-va-views-optionpanel-area"),{optionPanelManager:this}),this.setToolItemSelection("scatter"),void(this.selection=null)}if(e[0]instanceof t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit){for(const e of Object.values(t.VA.Implementation.Visual.CONTENT_TYPE))this.optionViewer[e]&&this.optionViewer[e].hideOption();this.optionViewer[e[0].options.content.type]||(this.optionViewer[e[0].options.content.type]=new t.VA.Implementation.Visual.Views.OptionViewer[e[0].options.content.type](this.$mainControl.find(".brtc-va-views-optionpanel-area"),{optionPanelManager:this})),this.optionViewer[e[0].options.content.type].showOption(e[0]);let o=e[0].options.content.type;"chart"==e[0].options.content.type&&(o=e[0].options.content.options.chart.type),this.setToolItemSelection(o),this.selection=e[0]}},e.prototype.setToolItemSelection=function(e){"text"!=e&&this.$objectControl.find(".brtc-va-editor-toolitem[tool-type=multi-selector] > .brtc-va-editor-toolitem[item-type=add-chart] div").attr("chart-type",e),"text"!=e&&this.$objectControl.find(".brtc-va-editor-toolitem[tool-type=multi-selector] > .brtc-va-editor-toolitem-selector-parent span:first-child").text(t.Chart.Registry[e].Label),"text"!=e&&this.$objectControl.find(".brtc-va-editor-toolitem[tool-type=multi-selector] > .brtc-va-editor-toolitem-selector-parent span:first-child").attr("title",t.Chart.Registry[e].Label)},e.prototype.destroy=function(){for(var e in t.VA.Implementation.Visual.CONTENT_TYPE){var o=t.VA.Implementation.Visual.CONTENT_TYPE[e];this.optionViewer&&this.optionViewer[o]&&(this.optionViewer[o].destroy(),this.optionViewer[o]=null)}},e.prototype.getEditor=function(){return this.options.editor},e.prototype.handleStyleChanged=function(e,o){if(this.isStyleChanged(e,o)){var i=new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentStyleCommand(this,{content:e,changedStyle:o});this.options.editor.getCommandManager().execute(i)}},e.prototype.isStyleChanged=function(t,e){return!_.isEqual(t.style,e)},t.VA.Implementation.Visual.Views.OptionPanelManager=e}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls(),this.init()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-pageexplorer brtc-style-tab-contents">   <div class="brtc-va-views-pageexplorer-area brtc-style-tab-contents-area"></div></div>'),this.$parent.append(this.$mainControl),this.pageListViewer=new t.VA.Implementation.Visual.Views.PageListViewer(this.$mainControl.find(".brtc-va-views-pageexplorer-area"),{pageExplorer:this})},e.prototype.init=function(){var t=this;this.commandListener=function(e){t.handleCommand(e)},this.resourceManager=Studio.getResourceManager()},e.prototype.destroy=function(){},e.prototype.editorChanged=function(t){if(t){this.activeEditor&&(this.activeEditor.removeCommandListener(this.commandListener),this.activeEditor.removeGoHistoryListener(this.commandListener)),this.activeEditor=t,this.activeEditor.addCommandListener(this.commandListener),this.activeEditor.addGoHistoryListener(this.commandListener);var e=t.options.editorInput;this.pageListViewer.setSource(e.getContents().getPages())}else this.activeEditor=null},e.prototype.handleCommand=function(e){if(e instanceof t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand)for(var o in e.options.commands)this.handleCommand(e.options.commands[o]);else e instanceof t.VA.Core.CompoundCommand?this.handleCompoundCommand(e):e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.NewPageCommand?this.handleNewPageCommand(e):e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RemovePageCommand&&this.handleRemovePageCommand(e)},e.prototype.handleCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type)for(e in t.commandList)this.handleCommand(t.commandList[e]);else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--)this.handleCommand(t.commandList[e])},e.prototype.handleNewPageCommand=function(t){"REDO"===t.event.type||"EXECUTE"==t.event.type||t.event.type,this.pageListViewer.setSource(t.options.analyticsModel.getPages())},e.prototype.handleRemovePageCommand=function(t){"REDO"===t.event.type||"EXECUTE"==t.event.type||t.event.type,this.pageListViewer.setSource(t.options.analyticsModel.getPages())},t.VA.Implementation.Visual.Views.PageExplorer=e}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-controls-page-viewer brtc-style-list-viewer page">   <button class="brtc-va-controls-page-viewer-addpage brtc-style-addpage-button"><i class="fa fa-plus" aria-hidden="true"></i> Add Page</button>   <div    class="brtc-va-controls-page-viewer-list-container brtc-style-list-container page"></div>   <div    class="brtc-va-controls-page-viewer-context-menu"></div></div>'),this.$parent.append(this.$mainControl),this.createAddPageButton(this.$mainControl.find(".brtc-va-controls-page-viewer-addpage")),this.createListBoxControl(this.$mainControl.find(".brtc-va-controls-page-viewer-list-container")),this.createContextMenu(this.$mainControl.find(".brtc-va-controls-page-viewer-context-menu"));var t=this;$(window).click(function(e){$(e.target).hasClass("brtc-va-controls-page-viewer-more")||$(e.target).parents(".brtc-va-controls-page-viewer-context-menu").length||$(e.target).parents(".brtc-va-dialogs-main").length||(t.$selectedItem=void 0,t.$mainControl.find(".brtc-va-controls-page-viewer-list-item").removeClass("brtc-style-list-item-selected"))}.bind(this))},e.prototype.destroy=function(){},e.prototype.createSearchControl=function(e){var o=this;this.$searchControl=e.jqxInput({placeHolder:"Search Item",theme:t.VA.Env.Theme}),this.$searchControl.keyup(function(t){o.applyFilter()}),this.$searchControl.on("search",function(t){o.applyFilter()})},e.prototype.applyFilter=function(){$(window).trigger("resize")},e.prototype.createRefreshButton=function(e){this.$refreshButton=e.jqxButton({theme:t.VA.Env.Theme}),this.$refreshButton.click(function(t){})},e.prototype.createAddPageButton=function(e){var o=this;this.$uploadButton=e.jqxButton({theme:t.VA.Env.Theme}),this.$uploadButton.click(function(t){o.addNewPage("append")})},e.prototype.createMoreButton=function(t){var e=this;t.click(function(t){e.openContextMenu($(t.currentTarget))})},e.prototype.openContextMenu=function(t){var e=t.offset().left+t.width()-2,o=t.offset().top+t.height()+10;this.$ctxMenu.jqxMenu("open",e,o)},e.prototype.createListBoxControl=function(t){this.$listBox=t,this.$listBox.perfectScrollbar()},e.prototype.setSource=function(t){this.render(t)},e.prototype.render=function(t){var e=this.$listBox;for(var o in e.empty(),t){var i=Number(o)+1,n=this.createItemElement(t[o].id,i+" Page");e.append(n)}this.$listBox.perfectScrollbar("update")},e.prototype.createContextMenu=function(e){var o=this;e.append('<ul>   <li action="prepend">Prepend Page</li>   <li action="append">Append Page</li>   <li action="insert">Insert After Selected</li>   <li action="delete">Delete</li></ul>'),this.$ctxMenu=e.jqxMenu({theme:t.VA.Env.Theme,width:"150px",height:"20px",autoOpenPopup:!1,popupZIndex:5e4,mode:"popup",animationHideDuration:0,animationShowDuration:0}),this.$ctxMenu.on("itemclick",function(e){var i=$(e.args),n=o.$selectedItem;"prepend"===i.attr("action")?o.addNewPage("prepend"):"append"===i.attr("action")?o.addNewPage("append"):"insert"===i.attr("action")?o.addNewPage("insert"):"delete"===i.attr("action")&&(n?o.openDeleteDialog():t.VA.Core.Utils.WidgetUtils.openInformationDialog("There is no selected page."))})},e.prototype.addNewPage=function(e){var o,i=this.options.pageExplorer.activeEditor,n=i.options.editorInput.getContents();switch(e=e||"append"){case"append":o=void 0;break;case"prepend":o=0;break;case"insert":if(this.$selectedItem){var a=this.$selectedItem.data("id"),r=n.getPageIndex(a);o=Number(r)+1}else o=void 0;break;default:o=void 0}var s=n.newPage(),l=new t.VA.Implementation.Visual.Editors.Diagram.Commands.NewPageCommand(this,{page:s,pageIndex:o});i.getCommandManager().execute(l)},e.prototype.openDeleteDialog=function(){var e=this,o=this.options.pageExplorer.editorInput,i=o.contents,n=this.$selectedItem.data("id"),a='Are you sure you want to delete "'+(i.getPageIndex(n)+1)+'" page?';t.VA.Core.Utils.WidgetUtils.openConfirmDialog(a,function(t){if(t.OK){var a=Studio.getResourceManager();i.removePage(n),a.updateFile(o),e.$selectedItem.remove(),e.$selectedItem=void 0}})},e.prototype.removePage=function(t){$("#page-item-"+t).remove(),this.$listBox.perfectScrollbar("update")},e.prototype.addPage=function(t,e){var o=this.$listBox,i=Number(e)+1,n=this.createItemElement(t.id,i+" Page");e?0==e?o.prepend(n):o.find("div:nth-child("+e+")").after(n):o.append(n),this.$listBox.perfectScrollbar("update")},e.prototype.createItemElement=function(t,e){var o=this,i=$('<div id="page-item-'+t+'" data-id="'+t+'" class="brtc-va-controls-page-viewer-list-item brtc-style-list-item">'+e+"</div>");return i.click(function(t){$(this).parent().find(".brtc-va-controls-page-viewer-list-item").removeClass("brtc-style-list-item-selected"),$(this).addClass("brtc-style-list-item-selected"),o.$selectedItem=$(this),o.options.pageExplorer.activeEditor.showPage($(this).data("id")),t.stopPropagation()}),i},t.VA.Implementation.Visual.Views.PageListViewer=e}.call(this),function(){"use strict";var t=this.Brightics;const e=[{label:"A4 Portrait",value:"a4-vertical"},{label:"A4 Landscape",value:"a4-horizontal"},{label:"Custom",value:"custom"}],o={"a4-vertical":{width:795,height:1125},"a4-horizontal":{width:1125,height:795}};function i(e,o){t.VA.Implementation.Visual.Views.BaseOptionViewer.call(this,e,o)}i.prototype=Object.create(t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype),i.prototype.constructor=i,i.prototype.init=function(){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.init.call(this)},i.prototype.createControls=function(){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.createControls.call(this),this.$mainControl=$('<div class="brtc-va-controls-options-viewer brtc-style-option-viewer brtc-style-s-sidebar-background chart" viewer-type="page">   <span class="brtc-style-option-category brtc-style-s-option-category">'+t.locale.common.properties+'</span>   <div class="brtc-va-controls-options-panel"></div></div>'),this.$parent.append(this.$mainControl),this.createBackgroundControl(this.$mainControl.find(".brtc-va-controls-options-panel")),this.createPageSizeContainer(this.$mainControl.find(".brtc-va-controls-options-panel")),this.$mainControl.find(".brtc-va-controls-options-panel").perfectScrollbar()},i.prototype.createBackgroundControl=function(e){var o=this.getEditor().getModel().report,i=this.getEditor().getDiagramEditorPage();e.append($('<div class="brtc-style-margin-bottom-5">'+t.locale.visual.pageBackground+"</div>")),this.optionControl=t.Chart.Adonis.Component.Widgets.Factory.createColorPickerWidget(e,{value:o.display.backgroundColor||"#ffffff",onChanged:function(t){if((o.display.backgroundColor||"#ffffff")!==t){var e=i.createSetPageDisplayOptionsCommand({backgroundColor:t});i.executeCommand(e)}}})},i.prototype.createPageSizeContainer=function(e){e.append($('<div class="brtc-style-margin-bottom-5">'+t.locale.visual.pageSize+"</div>"));var o=$('<div class="brtc-va-controls-options-viewer-page-size-container"></div>');e.append(o),this._createPageSizeControl(o),this._createCustomPageSizeControl(e),"custom"===this.getEditor().getModel().report.display["page-type"]?this._showCustomPageSizeContainer():this._hideCustomPageSizeContainer()},i.prototype._createPageSizeControl=function(o){var i=this,n=this.getEditor().getModel().report.display,a=0;if(n["page-type"])for(var r=0;r<e.length;r++)if(e[r].value===n["page-type"]){a=r;break}this._$pageTypeList=$('<div class="brtc-va-controls-options-viewer-page-size-type-list brtc-style-border-box"></div>'),o.append(this._$pageTypeList),this._$pageTypeList.jqxDropDownList({theme:t.VA.Env.Theme,width:"100%",source:e,displayMember:"label",valueMember:"value",selectedIndex:a,dropDownHeight:75}),this._$pageTypeList.on("select",function(t){var e=t.args;e&&("custom"===e.item.value?(i._showCustomPageSizeContainer(),i._changePageSize()):(i._hideCustomPageSizeContainer(),i._changePageSize()))})},i.prototype._createCustomPageSizeControl=function(e){var o=this,i={};this._$customPageSizeWrapper=$('<div class="brtc-va-controls-options-viewer-custom-page-size-wrapper brtc-style-margin-vertical-5">   <div class="brtc-va-controls-options-viewer-custom-page-size-wrapper-tooltip" style="display: flex;margin-top: 5px;margin-bottom: 10px;color: rgba(194, 6, 17, .65);">Custom page does not support exporting-PDF.</div>   <div class="brtc-va-controls-options-viewer-custom-page-size-width-control-wrapper">       <div class="brtc-style-flex-center">           <div class="brtc-style-col-3 brtc-style-flex-center">Width :</div>           <div class="brtc-va-controls-options-viewer-custom-page-size-width-control"></div>           <div class="brtc-style-col-2 brtc-style-flex-center">PX</div>       </div>   </div>   <div class="brtc-va-controls-options-viewer-custom-page-size-height-control-wrapper">       <div class="brtc-style-flex-center brtc-style-margin-top-5">           <div class="brtc-style-col-3 brtc-style-flex-center">Height :</div>           <div class="brtc-va-controls-options-viewer-custom-page-size-height-control"></div>           <div class="brtc-style-col-2 brtc-style-flex-center">PX</div>       </div>   </div></div>'),e.append(this._$customPageSizeWrapper),this._customWidth=t.VA.Core.Widget.Factory.numericInputControl(this._$customPageSizeWrapper.find(".brtc-va-controls-options-viewer-custom-page-size-width-control"),i);var n=this._$customPageSizeWrapper.find(".brtc-va-controls-options-viewer-custom-page-size-width-control-wrapper");this._customWidth.onChange(function(t){Number.parseInt(t)<500?o._showInvalidSizeMessage(n,"Width must be greater than 500px or equal."):Number.parseInt(t)>1e4?o._showInvalidSizeMessage(n,"Width must be less than 10000px or equal."):(o._removeInvalidSizeMessage(n),o._getPageSize.width!==Number.parseInt(t)&&o._changePageSize())});var a=this._$customPageSizeWrapper.find(".brtc-va-controls-options-viewer-custom-page-size-height-control-wrapper");this._customHeight=t.VA.Core.Widget.Factory.numericInputControl(this._$customPageSizeWrapper.find(".brtc-va-controls-options-viewer-custom-page-size-height-control"),i),this._customHeight.onChange(function(t){Number.parseInt(t)<500?o._showInvalidSizeMessage(a,"Height must be greater than 500px or equal."):Number.parseInt(t)>1e4?o._showInvalidSizeMessage(a,"Height must be less than 10000px or equal."):(o._removeInvalidSizeMessage(a),o._getPageSize.height!==Number.parseInt(t)&&o._changePageSize())})},i.prototype._showInvalidSizeMessage=function(t,e){t.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").length>0&&t.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove(),t.append('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">'+e+"</div>")},i.prototype._removeInvalidSizeMessage=function(t){t?t.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove():this.$mainControl.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove()},i.prototype._showCustomPageSizeContainer=function(){this._removeInvalidSizeMessage();var t=this._getPageSize();this._customWidth.setValue(t.width),this._customHeight.setValue(t.height),this._$customPageSizeWrapper.show()},i.prototype._hideCustomPageSizeContainer=function(){this._$customPageSizeWrapper.hide()},i.prototype._getPageSize=function(){var e=this.getEditor().getModel().report.display;return"custom"===e["page-type"]?{width:this._changePixelToNumber(e.width),height:this._changePixelToNumber(e.height)}:e["page-type"]?o[e["page-type"]]:t.VA.Implementation.Visual.CONST.DEFAULT_REPORT_SIZE},i.prototype._changePixelToNumber=function(t){return Number.parseInt((""+t).replace("px",""))},i.prototype._changePageSize=function(){var e,i,n=this.getEditor().getDiagramEditorPage(),a=this.getEditor().getModel(),r=this._$pageTypeList.jqxDropDownList("getSelectedItem").value;"custom"===r?(e=this._customWidth.getValue(),i=this._customHeight.getValue()):(e=o[r].width,i=o[r].height);var s={display:{"page-type":r,width:e,height:i}},l=new t.VA.Core.Editors.Diagram.Commands.ChangePageSizeCommand(a,s);n.executeCommand(l)},i.prototype.createFontStyleControl=function(e){t.Chart.Adonis.Component.Widgets.Factory.createFontStyleWidget(e,{value:["Arial",11,"#AF2A2A",["bold","italic","underline"]],onChanged:[function(t){},function(t){},function(t){},function(t){}]})},i.prototype.showOption=function(e){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.showOption.call(this,e);var o=this.getEditor().getModel().report.display.backgroundColor||"#ffffff";this.optionControl.render(o,!1)},i.prototype.hideOption=function(){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.hideOption.call(this)},i.prototype.destroy=function(){this.optionControl&&this.optionControl.destroy(),this.$mainControl.remove()},t.VA.Implementation.Visual.Views.OptionViewer.page=i}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Implementation.Visual.Views.BaseOptionViewer.call(this,e,o)}e.prototype=Object.create(t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.createControls.call(this),this.createLayout(),this.createArrangeControl(),this.$mainControl.perfectScrollbar()},e.prototype.createLayout=function(){this.$mainControl=$('<div class="brtc-va-controls-options-viewer brtc-style-option-viewer brtc-style-s-sidebar-background text" viewer-type="text"></div>'),this.$parent.append(this.$mainControl),this.createPropertiesLayout(),this.createBackgroundLayout(),this.createArrangeLayout()},e.prototype.showOption=function(e){t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.showOption.call(this,e);var o=e.$content.find(".note-toolbar.panel-heading").detach();this.$properties.append(o),o.css("display","block"),this.createBackgroundControl()},e.prototype.createBackgroundControl=function(){this.createTransparentControl()},e.prototype.createTransparentControl=function(){var e=this,o=this.getContentStyle();this.$transparent.find(".brtc-va-controls-options-viewer-content").jqxCheckBox({theme:t.VA.Env.Theme,checked:!(!o||!o.background||"transparent"!==o.background),height:25}),this.$transparent.find(".brtc-va-controls-options-viewer-content").on("change",function(t){var o=t.args.checked;e.handleBackground(o?"transparent":"white")})},e.prototype.hideOption=function(){if(t.VA.Implementation.Visual.Views.BaseOptionViewer.prototype.hideOption.call(this),this.contentUnit){var e=this.$mainControl.find(".note-toolbar.panel-heading").detach();e.css("display","none"),this.contentUnit.$content.find(".note-editor.note-frame.panel.panel-default").prepend(e)}},e.prototype.destroy=function(){},e.prototype.handleBackground=function(t){var e=$.extend(!0,{},this.contentUnit.content.style),o=$.extend(!0,e,{background:t});this.options.optionPanelManager.handleStyleChanged(this.contentUnit.content,o)},e.prototype.getContentStyle=function(){return this.contentUnit.content.style},t.VA.Implementation.Visual.Views.OptionViewer.text=e}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.options.multiple=!0,this.$selectedItems=[],this.retrieveParent(),this.createControls()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-controls-visualmodellist-viewer brtc-style-list-viewer visualmodel">   <div class="brtc-va-controls-visualmodellist-viewer-list-profile brtc-style-list-profile"></div>   <div class="brtc-va-controls-visualmodellist-viewer-list-container brtc-style-list-container"></div></div>'),this.$parent.append(this.$mainControl),this.createListProfileControl(this.$mainControl.find(".brtc-va-controls-visualmodellist-viewer-list-profile")),this.createListBoxControl(this.$mainControl.find(".brtc-va-controls-visualmodellist-viewer-list-container"))},e.prototype.destroy=function(){},e.prototype.createListProfileControl=function(t){this.$listProfile=t;var e=this.$listProfile;if(this.options.visualModels&&this.options.visualModels.length){var o={id:this.options.projectId,label:this.options.projectLabel},i=$('<div class="brtc-va-workspace-model-list-header">   <div class="brtc-va-workspace-model-list-title"></div>   <div class="brtc-va-workspace-model-list-selected">       <div class="brtc-va-workspace-model-list-selected-label">Selected</div>       <div class="brtc-va-workspace-model-list-selected-value">0</div>   </div>   <div class="brtc-va-workspace-model-list-slash">/</div>   <div class="brtc-va-workspace-model-list-count">       <div class="brtc-va-workspace-model-list-count-label">Total</div>       <div class="brtc-va-workspace-model-list-count-value">'+this.options.visualModels.length+"</div>   </div></div>");i.find(".brtc-va-workspace-model-list-title").text(o.label).attr("title",o.label),e.append(i)}},e.prototype.createListBoxControl=function(t){this.$listBox=t,this.options.visualModels&&this.setSource(this.options.visualModels)},e.prototype.setSource=function(t){this.source=t,this.render()},e.prototype.render=function(){var t=this,e=this.$listBox;e.empty();var o=t.source;for(var i in o){var n=o[i],a=$('<div class="brtc-va-workspace-model-list-cell">   <div class="brtc-va-workspace-model-list-item" id="'+n.getFileId()+'" model-type="'+n.getType()+'">       <div class="brtc-va-workspace-model-list-item-title">           <div class="brtc-va-workspace-model-list-item-icon"></div>           <div class="brtc-va-workspace-model-list-item-type">Report</div>       </div>           <div class="brtc-va-workspace-model-list-item-label"></div>       <div class="brtc-va-workspace-model-list-item-description">'+n.getDescription()+"       </div>   </div></div>");a.find(".brtc-va-workspace-model-list-item-label").attr("title",n.getLabel()).text(n.getLabel()),a.data("model",o[i]),a.click(function(e){if(t.options.multiple){if($(this).hasClass("brtc-style-list-item-selected")){for(var o in t.$selectedItems)if($(this).data("model").id===t.$selectedItems[o].data("model").id){t.$selectedItems.splice(o,1);break}}else t.$selectedItems.push($(this));$(this).toggleClass("brtc-style-list-item-selected")}else if($(this).hasClass("brtc-style-list-item-selected")){for(var o in t.$selectedItems)if($(this).data("model").id===t.$selectedItems[o].data("model").id){t.$selectedItems.splice(o,1);break}$(this).removeClass("brtc-style-list-item-selected")}else $(this).parent().find(".brtc-va-controls-page-visualmodellist-list-item").removeClass("brtc-style-list-item-selected"),$(this).addClass("brtc-style-list-item-selected"),t.$selectedItems=[$(this)];t.$listProfile.find(".brtc-va-workspace-model-list-selected-value").text(t.$selectedItems.length),e.stopPropagation()}),e.append(a)}e.perfectScrollbar()},e.prototype.getSelectedModels=function(){var t=[];for(var e in this.$selectedItems)t.push(this.$selectedItems[e].data("model"));return t},t.VA.Implementation.Visual.Views.VisualModelListViewer=e}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.init(),this.retrieveParent(),this.createControls(),this.bindEventListeners()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.init=function(){this.dataSourceControls={}},e.prototype.bindEventListeners=function(){this.options.editor.addCommandListener(this.handleCommand.bind(this)),this.options.editor.addGoHistoryListener(this.handleCommand.bind(this))},e.prototype.createControls=function(){this.$mainControl=$('<div class="bcharts-ds-panel"></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$mainControl.perfectScrollbar(),this.createDataSourceControls();var t=this.$mainControl.find(".jqx-tabs");t.length>0&&t.jqxTabs("render")},e.prototype.createDataSourceControls=function(){var e=this.options.editor.options.editorInput.getContents().getDataSources();if(e.length>0){var o=t.VA.Core.Utils.WidgetUtils.createProgressDialog($("body"),{title:"Loading..."}),i=1,n=this,a=function(){i++<e.length||(o.dialog("close"),n.options.editor.getDiagramEditorPage().render())};for(var r in e){var s=e[r];this.addDataSource(s).renderColumns(a)}}this.$mainControl.perfectScrollbar("update")},e.prototype.updateDataSourceControls=function(){var e=this.options.editor.options.editorInput.getContents().getDataSources();if(e.length>0&&Object.keys(this.dataSourceControls).length!==e.length){var o=t.VA.Core.Utils.WidgetUtils.createProgressDialog($("body"),{title:"Preparing workspace...."}),i=1,n=this,a=function(){i++<e.length||(o.dialog("close"),setTimeout(function(){n.options.editor.getDiagramEditorPage().render()},500))};for(var r in e){var s=e[r];if(this.dataSourceControls[s.fid])a();else this.addDataSource(s).renderColumns(a)}}for(var l in e){var c=e[l].display.charts,p=this.dataSourceControls[e[l].fid];c&&c.length!==p.options.charts.length&&(p.setOptions({charts:c}),p.fillChartTab()),p.setName(e[l].display.label),p.fillName(),p.renderColumns(),p.renderScheduleIcon()}this.$mainControl.perfectScrollbar("update")},e.prototype.destroy=function(){for(var t in this.dataSourceControls)this.dataSourceControls[t].destroy();this.$mainControl.remove(),this.options.editor.removeCommandListener(this.commandListener),this.options.editor.removeGoHistoryListener(this.commandListener)},e.prototype.show=function(){this.$mainControl.show(),this.updateDataSourceControls();var t=this.$mainControl.find(".jqx-tabs");t.length>0&&t.jqxTabs("render")},e.prototype.hide=function(){this.$mainControl.hide()},e.prototype.handleCommand=function(e){if(e instanceof t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand)for(var o in e.options.commands)this.handleCommand(e.options.commands[o]);else e instanceof t.VA.Core.CompoundCommand?this.handleCompoundCommand(e):e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.NewDataSourceCommand?this.handleNewDataSourceCommand(e):e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveDataSourceCommand?this.handleRemoveDataSourceCommand(e):e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RenameDataSourceCommand?this.handleRenameDataSourceCommand(e):e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveDataSourceChartsCommand?this.handleRemoveDataSourceChartsCommand(e):e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.ChangeScheduleCommand&&this.handleChangeScheduleCommand(e)},e.prototype.handleCompoundCommand=function(t){var e;if("EXECUTE"==t.event.type||"REDO"===t.event.type)for(e in t.commandList)this.handleCommand(t.commandList[e]);else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--)this.handleCommand(t.commandList[e])},e.prototype.handleNewDataSourceCommand=function(t){"REDO"===t.event.type?(this.addDataSource(t.options.dataSource),this.renderColumns(t.options.dataSource.fid)):"UNDO"===t.event.type&&this.removeDataSource(t.options.dataSource.fid)},e.prototype.handleRemoveDataSourceCommand=function(t){if("EXECUTE"==t.event.type||"REDO"===t.event.type)this.removeDataSource(t.options.dataSourceId);else if("UNDO"===t.event.type){this.addDataSource(t.old.dataSource),this.renderColumns(t.old.dataSource.fid);var e=this.$mainControl.find(".bcharts-ds").length;e>1&&Number(t.old.dataSourceIndex)+1!==Number(e)&&this.$mainControl.find(".bcharts-ds").eq(e-1).detach().insertBefore(this.$mainControl.find(".bcharts-ds").eq(t.old.dataSourceIndex))}},e.prototype.handleRenameDataSourceCommand=function(t){"EXECUTE"==t.event.type||"REDO"===t.event.type?this.renameDataSource(t.options.dataSourceId,t.options.label):"UNDO"===t.event.type&&this.renameDataSource(t.options.dataSourceId,t.old.label)},e.prototype.handleRemoveDataSourceChartsCommand=function(t){"EXECUTE"==t.event.type||"REDO"===t.event.type?this.dataSourceControls[t.options.dataSourceId].removeChart(t.options.chartIndex):"UNDO"===t.event.type&&this.dataSourceControls[t.options.dataSourceId].addChart(t.old.chart,t.options.chartIndex)},e.prototype.handleChangeScheduleCommand=function(t){this.dataSourceControls[t.options.dataSourceId].renderScheduleIcon()},e.prototype.renameDataSource=function(t,e){this.dataSourceControls[t].setName(e),this.dataSourceControls[t].fillName()},e.prototype.addDataSource=function(e){return this.dataSourceControls[e.fid]=new t.VA.Implementation.Visual.Views.Units.DataSourceUnit(this.$mainControl,{dataSource:e}),this.dataSourceControls[e.fid]},e.prototype.removeDataSource=function(t){this.dataSourceControls[t].destroy(),delete this.dataSourceControls[t]},e.prototype.renderColumns=function(t){this.dataSourceControls[t].renderColumns()},t.VA.Implementation.Visual.Views.Units.DataSourcePanel=e}.call(this),function(){"use strict";var t=this.Brightics,e="false"!==this.useSpark;function o(e,o){this.dataSource=o.dataSource,t.Chart.Adonis.Component.DataSource.call(this,e,this._buildDataSource(o.dataSource))}o.prototype=Object.create(t.Chart.Adonis.Component.DataSource.prototype),o.prototype.constructor=o,o.prototype._buildDataSource=function(e){var o=this,i={id:e.fid,name:e.display.label,param:e.param,charts:$.extend(!0,[],e.display.charts),columns:$.extend(!0,[],e.display.columns||[]),chartTab:{show:!0},columnDraggable:!0};return i.drawer={show:!0,menu:{edit:{show:!0,title:t.locale.common.edit,click:function(t,e,i){o.openEditDataSourceAliasDialog(i.id,i.name)}},connect:{show:"Empty"===o.dataSource.name,title:"Connect Schedule",click:function(t,e,i){o.openSetScheduleDialog(i.id,i.name,i.param)}},delete:{show:!0,title:t.locale.common.delete,click:function(t,e,i){o.openDeleteDialog(i.id,i.name)}}}},i},o.prototype._createDrawerMenu=function(e){var o=$("<ul></ul>");for(var i in this.options.drawer.menu)if(this.options.drawer.menu[i].show){var n=$("<li></li>");n.attr("action",i),n.text(this.options.drawer.menu[i].title),o.append(n)}this.$drawerMenu=$('<div class="bcharts-ds-panel-drawer-menu"></div>').append(o),e.append(this.$drawerMenu),this.$drawerMenu.jqxMenu({theme:t.VA.Env.Theme,autoOpenPopup:!1,mode:"popup",width:140,animationHideDuration:0,animationShowDuration:0}),this._bindItemClickEventToDrawer(),this._bindCloseHandler()},o.prototype._bindCloseHandler=function(t){var e=this;this.drawerMenuCloseHandler=function(){e.$drawerMenu.jqxMenu("close")},this.$drawerMenu.on("closed",function(){e.$mainControl.parents(".bcharts-ds-panel").off("scroll",e.drawerMenuCloseHandler),$(window).off("resize",e.drawerMenuCloseHandler)}),this.$headerControl.find(".bcharts-ds-drawer").click(function(){e.$mainControl.parents(".bcharts-ds-panel").on("scroll",e.drawerMenuCloseHandler),$(window).on("resize",e.drawerMenuCloseHandler)})},o.prototype.render=function(){this.fillName(),this.fillContents(),this.renderScheduleIcon()},o.prototype._createTabs=function(t){this._createChartTab(t),this._createColumnsTab(t)},o.prototype._bindDraggableEventToDataSourceHeader=function(){},o.prototype._createChartTab=function(t){if(this.options.chartTab&&this.options.chartTab.show){var e=$('<li>   <div class="bcharts-ds-contents-tab-chart">Chart</div>   <div class="bcharts-ds-contents-charts-count">0</div></li>');t.find(".bcharts-ds-contents-tabs").append(e),t.append($('<div style="min-height: 100px"></div>'))}},o.prototype._updateChartCount=function(){this.$contentsControl.find(".bcharts-ds-contents-charts-count").text(this.options.charts.length),this.$contentsControl.find(".bcharts-ds-charts").perfectScrollbar("update"),this.$mainControl.parents(".bcharts-ds-panel").perfectScrollbar("update")},o.prototype.fillChartTab=function(){if(this.options.chartTab&&this.options.chartTab.show){var t=$('<div>   <div class="bcharts-ds-charts-container">       <div class="bcharts-ds-charts"></div>   </div></div>');for(var e in this.$contentsControl.jqxTabs("setContentAt",0,t.html()),t=this.$contentsControl.find(".bcharts-ds-charts-container"),this.options.charts)this._createChart(t.find(".bcharts-ds-charts"),this.options.charts[e]);this.$contentsControl.find(".bcharts-ds-charts").perfectScrollbar(),this._updateChartCount()}},o.prototype._createChart=function(e,o,i){var n=o.chart.type,a=t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t.Chart.Registry[n].Label),r=o.tag?o.tag:"",s=$('<div class="bcharts-ds-chart-wrapper">   <div title="'+a+'" class="bcharts-ds-chart-events-helper bcharts-ds-draggable">       <div class="bcharts-ds-chart-area">           <div class="bcharts-ds-chart-area-label">               <div class="bcharts-ds-chart-icon" type="'+n+'"></div>               <div class="bcharts-ds-chart-type-label">'+a+'</div>           </div>           <div class="bcharts-ds-chart-area-tag">               <div class="bcharts-ds-chart-tag-label">'+r+'</div>           </div>       </div>   </div>   <div class="bcharts-ds-chart-button-area"></div></div>');this._bindChartSelectionEvent(s.find(".bcharts-ds-chart-events-helper")),this._createChartControlButtons(s.find(".bcharts-ds-chart-button-area"));var l=e.find(".bcharts-ds-chart-wrapper").length;void 0!==i&&l>0&&l>i?e.find(".bcharts-ds-chart-wrapper").eq(i).before(s):e.append(s)},o.prototype._addChartOption=function(t,e){this.options.charts.splice(e,0,t)},o.prototype._removeChartOption=function(t){this.options.charts.splice(t,1)},o.prototype.addChart=function(t,e){this._addChartOption(t,e),this._createChart(this.$contentsControl.find(".bcharts-ds-charts"),t,e),this._updateChartCount(this.options.charts.length)},o.prototype.removeChart=function(t){this._removeChartOption(t),this._updateChartCount(),this.$contentsControl.find(".bcharts-ds-charts").find(".bcharts-ds-chart-wrapper").eq(t).remove()},o.prototype._createChartControlButtons=function(t){this._createChartRemoveButton(t)},o.prototype._createChartRemoveButton=function(t){var e=this,o=$('<div title="Remove Chart" class="bcharts-ds-chart-button-remove"></div>');t.append(o),o.click(function(t){e._handleChartRemoveButtonClick(t)})},o.prototype._handleChartRemoveButtonClick=function(e){var o=this,i=$(e.target).parents(".bcharts-ds-chart-wrapper").prevAll(".bcharts-ds-chart-wrapper").length;t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Are you sure you want to delete this Chart?",function(e){if(e.OK){var n=new t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveDataSourceChartsCommand(o,{dataSourceId:o.options.id,chartIndex:i});o.executeCommand(n)}})},o.prototype._bindChartSelectionEvent=function(t){var e=this;t.click(function(t){var o=e.getActiveEditor().getDiagramEditorPage().getSelectedPage();if(o){var i=$(this).parents(".bcharts-ds-chart-wrapper").prevAll(".bcharts-ds-chart-wrapper").length,n=e.options.charts[i].chart.type,a=o.createNewChartContentCommand(n,{dataSourceId:e.dataSource.fid,chartOption:$.extend(!0,{},e.options.charts[i])});e.executeCommand(a)}})},o.prototype._bindChartDraggableEvent=function(t){var e=this;t.draggable({appendTo:"body",helper:function(t){var o=$(this).clone(),i=$(this).width(),n=$(this).height();o.css({"z-index":5100,width:i,height:n,overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"});var a=$(this).find("canvas"),r=o.find("canvas");if(a.length)for(var s=0;s<a.length;s++){r[s].getContext("2d").drawImage(a[s],0,0,a[s].width,a[s].height)}o.attr("drag-type","chartTemplate");var l=$(this).parents(".bcharts-ds-chart-wrapper").prevAll(".bcharts-ds-chart-wrapper").length,c=$.extend(!0,{},e.options);return o.data("datasource",c),o.data("chartTemplate",c.charts[l]),o}})},o.prototype._createUtilToolsArea=function(){var t=this.$contentsControl.find(".bcharts-ds-columns-container"),e=$('<div class="bcharts-ds-columns-util-tools-area"></div>');t.prepend(e),this._createRefreshArea(e),this._createFilterControl(e)},o.prototype._createRefreshArea=function(t){var e=this,o=this.options.updateTime,i=this._convertTimeFormat(o),n=$('<div class="bcharts-ds-refresh-area">   <div class="bcharts-ds-refresh-button-area">       <div class="bcharts-ds-refresh-button"></div>   </div>   <div class="bcharts-ds-update-time-area">       <div class="bcharts-ds-update-time-label">Last updated at </div>       <div class="bcharts-ds-update-time-data">'+i+"</div>   </div></div>");t.append(n),n.find(".bcharts-ds-refresh-button").click(function(t){e._handleRefreshButtonClick(t)})},o.prototype._handleRefreshButtonClick=function(t){var e=this,o=this._buildRunnableDataSource(this.dataSource),i={success:function(t){e.renderColumns()}},n=this.dataSource.param.modelId;Studio.getJobExecutor().launchUnit(o,{},{mid:n},i)},o.prototype._getTableIdFromDataSource=function(t){return t.param.tableId?t.param.tableId:t.param.functions?t.param.functions[0][OUT_DATA][0]:t[OUT_DATA]?t[OUT_DATA][0]:t.outputs?t.outputs.table:void 0},o.prototype.renderColumns=function(e){var o=this,i=this.getActiveEditor().options.editorInput.getContents(),n="Empty"===o.dataSource.name?o.dataSource.param.modelId:i.mid,a=this._getTableIdFromDataSource(o.dataSource);t.VA.Core.DataQueryTemplate.getSchemaAsync(n,a,function(t){var i=$.extend(!0,[],t);o.dataSource.display.columns=i,o.setOptions({columns:i}),o.fillColumnsTab(i),o.$contentsControl.find(".bcharts-ds-update-time .bcharts-ds-update-time-data").text(o._convertTimeFormat()),e&&"function"==typeof e&&e()},function(){var t=[];o.dataSource.display.columns=t,o.setOptions({columns:t}),o.fillColumnsTab(t),o.$contentsControl.find(".bcharts-ds-update-time .bcharts-ds-update-time-data").text(o._convertTimeFormat()),e&&"function"==typeof e&&e()})},o.prototype._buildRunnableDataSource=function(t){var o;return"Empty"===t.name?(o=e?{func:"queryExecutor",name:"SQLExecutor",inData:[t.param.tableId],outData:[t.param.tableId],param:{mode:"full","full-query":"SELECT * FROM  #{DF(0)}","alias-names":["#{DF(0)}"]},fid:t.fid,"persist-mode":"false",persist:!1,display:{label:t.display.label}}:{func:"queryExecutorPython",name:"brightics.function.transform$sql_execute",context:"python",version:"3.6",inputs:{tables:[t.param.tableId]},outputs:{out_table:t.param.tableId},meta:{tables:{type:"table",range:{min:1,max:10}},out_table:{type:"table"}},param:{query:"SELECT * FROM  #{DF(0)}"},fid:t.fid,"persist-mode":"false",persist:!1,display:{label:t.display.label}}).parent=function(){return t.parent()}:o=t,o},o.prototype._convertTimeFormat=function(t){var e=t?new Date(t):new Date,o=e.getFullYear()%100,i=e.getMonth()+1,n=e.getDate(),a=e.getHours(),r=e.getMinutes(),s=e.getSeconds();return i<10&&(i="0"+i),n<10&&(n="0"+n),a<10&&(a="0"+a),r<10&&(r="0"+r),s<10&&(s="0"+s),o+"/"+i+"/"+n+" "+a+":"+r+":"+s},o.prototype.fillContents=function(){this.fillChartTab(),this.fillColumnsTab(this.options.columns)},o.prototype.getActiveEditor=function(){return Studio.getEditorContainer().getActiveModelEditor()},o.prototype.executeCommand=function(t){this.getActiveEditor().getCommandManager().execute(t)},o.prototype.openEditDataSourceAliasDialog=function(e,o){var i=this;new t.VA.Core.Dialogs.EditDataSourceAliasDialog(this.$mainControl,{name:o,title:t.locale.common.datasourceEdit,close:function(o){if(o.OK){var n=o.newName,a=new t.VA.Implementation.Visual.Editors.Diagram.Commands.RenameDataSourceCommand(this,{dataSourceId:e,label:n});i.executeCommand(a)}}})},o.prototype.openSetScheduleDialog=function(e,o,i){var n=this;new t.VA.Implementation.Visual.Dialogs.DataSourceScheduleDialog(this.$mainControl,{dataSourceId:e,name:o,param:i,close:function(o){if(o.OK&&void 0!==o.scheduleId){var i=new t.VA.Core.CompoundCommand(this),a=new t.VA.Implementation.Visual.Editors.Diagram.Commands.ChangeScheduleCommand(n,{dataSourceId:e,scheduleId:o.scheduleId}),r=new t.VA.Implementation.Visual.Editors.Diagram.Commands.ChangeFuncCommand(n,{dataSourceId:e,func:"loadFromStaging"});i.add(a),i.add(r),n.executeCommand(i)}},title:"Connect Schedule"})},o.prototype.openDeleteDialog=function(e,o){var i=this,n='Are you sure you want to delete "'+o+'"?';t.VA.Core.Utils.WidgetUtils.openConfirmDialog(n,function(o){if(o.OK){var n=new t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveDataSourceCommand(i,{dataSourceId:e});i.executeCommand(n)}})},o.prototype.renderScheduleIcon=function(){"Empty"===this.dataSource.name&&this.$mainControl.find(".bcharts-ds-header .bcharts-ds-icon").css("visibility",this.dataSource.param.scheduleId?"visible":"hidden")},t.VA.Implementation.Visual.Views.Units.DataSourceUnit=o}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){this.options=o,this.options.class="dataadditionloadingpage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options)}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.doFinish()},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(t){var e=this.options.loadingText||"Preparing...";t.append($('<div class="brtc-va-loading-page-contents-area">   <div class="brtc-va-loading-page-text-area">       <div class="brtc-va-loading-page-text-wrapper">           <span>'+e+'</span>       </div>    </div>    <div class="brtc-va-loading-page-spinner-area">        <div class="brtc-va-loading-page-spinner-wrapper">            <div class="brtc-va-loading-page-spin-icon">               <div class="brtc-va-progress-loading"></div>           </div>        </div>   </div></div>'))},e.prototype.doFinish=function(){},t.VA.Implementation.Visual.Wizards.Pages.DataAdditionLoadingPage=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){this.options=o,this.options.class="selectdatatypepage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options)}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.$btnPrevious.jqxButton({disabled:!0}),this.$contentsControl.find(".selected").length<1?this.options.wizard.$btnNext.jqxButton({disabled:!0}):this.options.wizard.$btnNext.jqxButton({disabled:!1})},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(e){t.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this,e);var o=this;e.append($('<div class="brtc-va-label">Select data position:</div><div class="selector" value="loadFromAlluxio">   <span class="brtc-va-icon file"></span>   <span class="brtc-va-label">Data Explorer</span></div><div class="selector disabled" value="loadFromLocal">   <span class="brtc-va-icon file"></span>   <span class="brtc-va-label">Local</span></div><div class="selector disabled" value="loadFromRdb">   <span class="brtc-va-icon grid"></span>   <span class="brtc-va-label">Relational Database</span></div><div class="selector disabled" value="loadFromHdfs">   <span class="brtc-va-icon file"></span>   <span class="brtc-va-label">Hadoop File System</span></div><div class="selector disabled" value="loadFromStaging">   <span class="brtc-va-icon file"></span>   <span class="brtc-va-label">Data Flow</span></div>')),e.find(".selector").on("click",function(){$(this).hasClass("disabled")?t.VA.Core.Utils.WidgetUtils.openInformationDialog("We are preparing this service for you."):o.refreshSelection(this)}),e.perfectScrollbar()},e.prototype.refreshSelection=function(t){this.options.wizard.result.dataFrom=$(t).attr("value"),"loadFromAlluxio"==this.options.wizard.result.dataFrom?this.options.wizard.$btnNext.jqxButton({disabled:!1}):this.options.wizard.$btnNext.jqxButton({disabled:!0}),this.$contentsControl.find(".selector").removeClass("selected"),$(t).hasClass("disabled")||$(t).addClass("selected")},t.VA.Implementation.Visual.Wizards.Pages.SelectDataTypePage=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){this.options=o,this.options.class="selectexplorerdatapage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options),this.$mainControl.parents(".brtc-va-wizard-main").addClass("selectexplorerdatapage")}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.$btnPrevious.jqxButton({disabled:!0}),this.options.wizard.$btnNext.jqxButton({disabled:!0}),this.options.wizard.result.fileName?this.options.wizard.$btnFinish.jqxButton({disabled:!1}):this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.result.fileName=this.options.wizard.result.fileName||""},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(e){e.addClass("brtc-va-dialogs-repository-browser-contents"),e.append('<div class="brtc-va-controls-datasource-alias-area">   <div class="brtc-va-controls-datasource-alias-label">'+t.locale.common.dataLabel+': </div>   <div class="brtc-va-controls-datasource-alias-input-area">       <input type="text" class="brtc-va-controls-datasource-alias-input" maxlength="80"/>   </div></div><div class="brtc-va-dialogs-repository-browser-tree"></div><div class="brtc-va-dialogs-repository-browser-file-layout">   <div class="brtc-va-dialogs-repository-browser-file-label">'+t.locale.common.selectedFilePath+': </div>   <div class="brtc-va-dialogs-repository-browser-file-input"><textarea readonly></textarea></div></div><div class="brtc-va-dialogs-repository-browser-setting-option">   <div class="brtc-va-dialogs-repository-browser-radio" value="static" checked="true">Set a static file path for users repository.</div>   <div class="brtc-va-dialogs-repository-browser-radio" value="dynamic">Set a dynamic file path for users repository.</div></div>'),this.createDataSourceAliasArea(e.find(".brtc-va-controls-datasource-alias-area")),this.createRepositoryViewerArea(e.find(".brtc-va-dialogs-repository-browser-tree")),this.createSettingOptionControl(e.find(".brtc-va-dialogs-repository-browser-setting-option")),this.createFilePathControl(e.find(".brtc-va-dialogs-repository-browser-file-input > textarea"))},e.prototype.createSettingOptionControl=function(e){var o=this,i=e.find(".brtc-va-dialogs-repository-browser-radio");this.$settingOptionGroup=e,i.jqxRadioButton({theme:t.VA.Env.Theme,groupName:"repository-browser-setting-option"}),i.on("checked",function(){var t=o.repositoryViewer.getSelectedPath()||o.options.filePath;o._setFilePath(t)}),this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").hide()},e.prototype.createFilePathControl=function(e){this.fileName=CodeMirror.fromTextArea(e[0],{mode:"text",theme:"default",indentWithTabs:!1,smartIndent:!1,lineNumbers:!1,matchBrackets:!0,scrollbarStyle:"null",autofocus:!1,readOnly:!0}),this.fileName.on("beforeChange",function(t,e){var o=e.text.join("").replace(/\n/g,"");return e.update&&e.update(e.from,e.to,[o]),!0}),this.fileName.setSize("100%","100%"),this.options.filePath&&this._setFilePath(this.options.filePath);this.setCodeMirrorReadOnly(e.closest(".brtc-va-dialogs-repository-browser-file-input"),!0),t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.fileName,{"valid-type":"fileNameType","valid-message-position":"bottom"})},e.prototype.setCodeMirrorReadOnly=function(t,e){t.find(".CodeMirror").addClass("brtc-style-border-grey"),t.find(".CodeMirror-code").addClass("brtc-style-cursor-default-important"),t.find(".CodeMirror-lines").addClass("brtc-style-cursor-default-important"),t.find(".CodeMirror-cursors").remove()},e.prototype.createRepositoryViewerArea=function(e){var o=this;this.repositoryViewer=new t.VA.Core.Controls.RepositoryViewer(e),this.repositoryViewer.$mainControl.find(".brtc-va-controls-repository-viewer-more").remove(),this.repositoryViewer.$mainControl.find(".brtc-va-controls-repository-viewer-upload").remove(),this.repositoryViewer.$mainControl.find(".brtc-va-controls-repository-viewer-refresh").remove(),this.repositoryViewer.$mainControl.find(".brtc-va-controls-repository-viewer-context-menu").remove(),this.repositoryViewer.$mainControl.find(".brtc-va-controls-repository-viewer-tree").on("mousewheel",function(t){t.stopPropagation()}),this.repositoryViewer.$tree.on("click",function(){var t=o.repositoryViewer.getSelectedPath()||o.options.filePath;o._setFilePath(t),o.options.wizard.$btnFinish.jqxButton({disabled:o.options.wizard.$btnFinish.jqxButton("disabled")||"folder"===(o.repositoryViewer.getSelectedFileType()||"folder")})})},e.prototype._setFilePath=function(e){if(e){var o=e.match(/^\/brtc\/repo\/shared\/[^\/]*/),i=e.match(/^\/brtc\/repo\/users\/[^\/]+\/[^\/]*/);if(this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").hide(),o)this.fileName.setValue(e),this.fileName.markText({line:0,ch:0},{line:0,ch:18+e.length+1},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"});else if(i){this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").show();var n=e;n=this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=dynamic]").val()?n.replace(/\/users\/\S*\//g,"/users/${sys.user}/"):n.replace(/\/users\/\$\{sys\.user\}\//g,"/users/"+t.VA.Env.Session.userId+"/"),this.fileName.setValue(n),this.fileName.markText({line:0,ch:0},{line:0,ch:n.length+1},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"})}else n=e+"/",n=this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=dynamic]").val()?n.replace(/\/users\/\S*\//g,"/users/${sys.user}/"):n.replace(/\/users\/\$\{sys\.user\}\//g,"/users/"+t.VA.Env.Session.userId+"/"),this.fileName.setValue(n),this.fileName.markText({line:0,ch:0},{line:0,ch:n.length+1},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"});this.options.wizard.result.fileName=this.fileName.getValue(),this.options.wizard.result.fileName?this.options.wizard.$btnFinish.jqxButton({disabled:!1}):this.options.wizard.$btnFinish.jqxButton({disabled:!0})}},e.prototype.createDataSourceAliasArea=function(e){this.$aliasInput=e.find(".brtc-va-controls-datasource-alias-input"),this.$aliasInput.jqxInput({theme:t.VA.Env.Theme,height:"25px",placeHolder:t.locale.common.dataSourceInputPlaceHolder})},e.prototype.doFinish=function(){var e=this.options.wizard.options.visualModel,o=this.options.wizard.result.fileName;"/"===o[o.length-1]&&(o=o.substr(0,o.length-1));var i=e.getDataSourceUsingParam({"fs-paths":o}),n=this.$aliasInput.val().trim()||this.options.wizard.result.fileName;i?t.VA.Core.Utils.WidgetUtils.openInformationDialog("This data already exists in data sources."):n?(this.options.wizard.dialogResult.type=this.options.wizard.result.dataFrom||"loadFromAlluxio",this.options.wizard.dialogResult.fileName=this.options.wizard.result.fileName,this.options.wizard.dialogResult.fileAlias=n,this.options.wizard.$mainControl.on("dialogclose",this.options.wizard.$mainControl.dialog("close"))):t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter a data source label.")},e.prototype.destroy=function(){this.repositoryViewer.destroy()},t.VA.Implementation.Visual.Wizards.Pages.SelectExplorerDataPage=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){this.parentId=e,this.options=o,this.options.title=t.locale.common.newData,this.options.class="dataadditionwizard",this.dialogResult={OK:!1,Cancel:!0},t.VA.Core.Wizards.Wizard.call(this,e,this.options)}e.prototype=Object.create(t.VA.Core.Wizards.Wizard.prototype),e.prototype.constructor=e,e.prototype.createContentsArea=function(e){this.selectExplorerDataPage=new t.VA.Implementation.Visual.Wizards.Pages.SelectExplorerDataPage(e,{wizard:this,showPreviousButton:!0,showNextButton:!0,showFinishButton:!0}),this.addPage(this.selectExplorerDataPage)},e.prototype.getNextPage=function(t){if(t===this.selectExplorerDataPage)return null},e.prototype.getPreviousPage=function(t){if(t===this.selectExplorerDataPage)return null},e.prototype.handleFinish=function(){this.selectExplorerDataPage.doFinish()},e.prototype.setFocus=function(){this.$mainControl.find(".brtc-va-controls-repository-viewer-search").focus()},e.prototype.close=function(){this.selectExplorerDataPage.destroy(),t.VA.Core.Wizards.Wizard.prototype.close.call(this)},t.VA.Implementation.Visual.Wizards.DataAdditionWizard=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Editor.call(this,e,o),this.registerCommandCallback(),this.registerResourceChangedListener()}e.prototype=Object.create(t.VA.Core.Editors.Editor.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-visualeditor brtc-va-editor brtc-style-editor">   <div class="brtc-style-editor-toolbar-area brtc-style-s-editor-toolbar-area" />   <div class="brtc-va-editors-side-tab-bar brtc-va-editors-left-tab-bar" />   <div class="brtc-va-editors-side-tab-bar brtc-va-editors-right-tab-bar" />   <div class="brtc-style-editor-diagram-area" />   <div class="brtc-va-editors-visualeditor-notification-container" />   <div class="brtc-va-editors-visualeditor-notification">       <div class="brtc-va-editors-visualeditor-notification-content" />   </div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),t.VA.Core.Utils.WidgetUtils.putEditorRef(this.$mainControl,this),this.createToolbar(),this.createDiagramEditorPage(),this.createEditorLayoutManager(),this.createNotification()},e.prototype.createNotification=function(){var e=this.$mainControl.children(".brtc-va-editors-visualeditor-notification-container");this.$notification=this.$mainControl.children(".brtc-va-editors-visualeditor-notification"),this.$notification.jqxNotification({theme:t.VA.Env.Theme,appendContainer:e,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:3e3,template:"info"})},e.prototype.notification=function(t,e){this.$mainControl.children(".brtc-va-editors-visualeditor-notification-container").html(""),this.$notification.find(".brtc-va-editors-visualeditor-notification-content").html(e),this.$notification.jqxNotification({template:t}),this.$notification.jqxNotification("open")},e.prototype.registerResourceChangedListener=function(){this.onResourceChanged=function(t,e){e.resource.id==this.options.editorInput.id&&(this.options.editorInput=$.extend(!0,this.options.editorInput,e.resource))},Studio.getInstance().addResourceChangedListener(this.onResourceChanged.bind(this))},e.prototype.destroy=function(){this.diagramEditorPage&&this.diagramEditorPage.destroy(),Studio.getInstance().removeResourceChangedListener(this.onResourceChanged)},e.prototype.createPageToolbar=function(t){this.$pageToolbar=$('<div class="brtc-va-editors-visualeditor-toolbar brtc-style-editors-toolbar brtc-style-position-center"></div>'),t.append(this.$pageToolbar)},e.prototype.onActivated=function(){this.diagramEditorPage.onActivated(),this.sideBarManager.onActivated()},e.prototype.createDiagramEditorPage=function(){this.diagramEditorPage=new t.VA.Implementation.Visual.Editors.Diagram.EditorPage(this.$mainControl.find(".brtc-style-editor-diagram-area"),{width:"100%",height:"100%",editor:this})},e.prototype.getPageContainer=function(){return this.diagramEditorPage},e.prototype.getModel=function(){return this.options.editorInput.getContents()},e.prototype.getPage=function(t){return this.diagramEditorPage.controls[t]},e.prototype.getPages=function(){return this.diagramEditorPage.controls},e.prototype.getVisualEditorContent=function(t){for(var e in this.diagramEditorPage.controls){var o=this.diagramEditorPage.controls[e];for(var i in o.contentList){var n=this.diagramEditorPage.controls[e].contentList[i];if(n.contentId===t)return n}}},e.prototype.getContentOutlineStatus=function(){return void 0===this.contentOutlineStatus&&(this.contentOutlineStatus=!0),this.contentOutlineStatus},e.prototype.showContentOutline=function(){this.contentOutlineStatus=!0,this.diagramEditorPage.changeContentOutline(!0)},e.prototype.hideContentOutline=function(){this.contentOutlineStatus=!1,this.diagramEditorPage.changeContentOutline(!1)},e.prototype.getDiagramEditorPage=function(){return this.diagramEditorPage},e.prototype.createEditorLayoutManager=function(){this.editorLayoutManager=new t.VA.Core.Tools.Manager.EditorLayoutManager(this.$mainControl.find(".brtc-style-editor-visualeditorpage"))},e.prototype.getMainArea=function(){return this.$mainControl},e.prototype.getHeaderArea=function(){return this.$mainControl.find(".brtc-va-editors-visualeditor-header")},e.prototype.getLeftTabBarArea=function(){return this.$mainControl.find(".brtc-va-editors-left-tab-bar")},e.prototype.getRightTabBarArea=function(){return this.$mainControl.find(".brtc-va-editors-right-tab-bar")},e.prototype.getSelectedObjects=function(){return this.diagramEditorPage.getSelectedObjects()},e.prototype.pasteObjects=function(t){return this.diagramEditorPage.pasteObjects(t)},e.prototype.removeObjects=function(t){return this.diagramEditorPage.removeObjects(t)},e.prototype.handleSelectionChanged=function(t){this.toolbar.handleOnSelectionChanged(t)},e.prototype.handleOnCopy=function(){this.toolbar.handleOnCopy()},t.VA.Implementation.Visual.Editor=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.ModelLayoutManager.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Editors.ModelLayoutManager.prototype),e.prototype.constructor=e,e.prototype.getSplitter=function(){return this.editor.getMainArea().find(".brtc-style-editor-visualeditorpage")},e.prototype.handleExpandStatusChanged=function(){},t.VA.Implementation.Visual.ModelLayoutManager=e}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls(),this.initPages()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-style-editor-visualeditorpage brtc-style-editor-editorpage">   <div class="brtc-style-editor-visualeditorpage-paper-area" layout="normal-view">       <div class="brtc-va-editor-visualeditorpage-toolbar-area brtc-style-editor-toolbar-area brtc-style-s-editor-toolbar-area" />       <div class="brtc-style-editor-visualeditorpage-paper-container" />   </div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.createToolbar(this.$mainControl.find(".brtc-va-editor-visualeditorpage-toolbar-area")),this.getPageContainer().perfectScrollbar()},e.prototype.destroy=function(){for(var t in this.controls)this.controls[t].destroy()},e.prototype.createToolbar=function(e){var o=$('<div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem brtc-style-s-background-image-none" item-type="page-selector">   <span class="brtc-va-editors-visualeditor-currentpage">1</span>   <span>/</span>   <span class="brtc-va-editors-visualeditor-totalpages">2</span>   <span>page</span>   <span><i class="fa fa-sort-desc" aria-hidden="true"></i></span></div><div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem brtc-style-s-background-image-none brtc-style-margin-0" item-type="add-page">   <div class="brtc-style-s-background-image-icon-paper"></div>   <div class="brtc-style-editor-toolitem-label">'+t.locale.common.addPage+'</div></div><div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem brtc-style-s-background-image-none brtc-style-margin-0" item-type="delete-page">   <div class="brtc-style-s-background-image-icon-paper-x"></div>   <div class="brtc-style-editor-toolitem-label">'+t.locale.common.deletePage+"</div></div>");e.append(o),this.createPageThumbnailToolItem(e),this.createAddPageToolItem(e),this.createDeletePageToolItem(e)},e.prototype.createPageThumbnailToolItem=function(e){var o=this,i=function(){n.find(".brtc-style-figure-thumbnailwrapper").off("click"),$(".brtc-va-editor-visualeditorpage-thumbnail .closebtn").click(),$(window).off("mousedown",i)},n=$('<div class="brtc-va-editor-visualeditorpage-thumbnail brtc-style-popup brtc-style-height-800px">   <span class="icon tooltip"></span>   <span class="btn close closebtn"></span>   <div class="brtc-va-editor-visualeditorpage-thumbnail-area brtc-style-popup-content" layout="normal-view"></div></div>');e.append(n),e.find(".brtc-style-editor-toolitem[item-type=page-selector]").on("click",function(){event.stopPropagation(),n.find(".brtc-style-figure-thumbnailwrapper").off("click"),n.find(".brtc-style-figure-thumbnailwrapper").on("click",function(){o.setSelection([$(this).attr("page-id")]),o.render()}),n.toggle(),n.find(".brtc-style-popup-content").sortable({containment:"parent",tolerance:"pointer",stop:function(t,e){var i=n.find(".brtc-style-popup-content").sortable("toArray"),a=o.createSortPageCommand(i);a&&o.executeCommand(a)},handle:".brtc-style-btn-drag"}),$(window).on("mousedown",i)});var a=this.$mainControl.find(".brtc-style-editor-toolitem[item-type=page-selector]"),r=a.position().left+a.width()/2-n.width()/2;n.css("left",r+"px"),n.find(".btn").jqxButton({theme:t.VA.Env.Theme,height:31}),n.find(".closebtn").click(function(){n.hide(),$(window).off("mousedown",i)}),n.on("mousedown",function(t){t.stopPropagation()}),n.hide()},e.prototype.createAddPageToolItem=function(e){var o=this;e.find(".brtc-style-editor-toolitem[item-type=add-page]").click(function(){if(10!=o.options.editor.getModel().getPages().length){var e=new t.VA.Implementation.Visual.Editors.Diagram.Commands.NewPageCommand(o.diagramEditorPage,{page:o.options.editor.getModel().newPage()});o.executeCommand(e)}else t.VA.Core.Utils.WidgetUtils.openInformationDialog("Maximum number of pages is 10.")})},e.prototype.createDeletePageToolItem=function(e){var o=this;e.find(".brtc-style-editor-toolitem[item-type=delete-page]").click(function(){if(1!==o.options.editor.getModel().getPages().length){t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Do you want to delete page?",function(t){if(t.OK){var i=e.find(".brtc-style-figure-thumbnailwrapper.ui-selected");if(i.length>0){var n=$(i).attr("page-id");o.executeCommand(o.createRemovePageCommand(n))}}})}else t.VA.Core.Utils.WidgetUtils.openInformationDialog("At least one page must exist on report.")})},e.prototype.changeContentOutline=function(t){this.$mainControl.find(".brtc-style-content-wrapper").toggleClass("disable-outline",!t)},e.prototype.changeScale=function(t){this.options.scale=t;var e=this.getPageContainer();.8==this.options.scale?this.$mainControl.attr("zoom-type","normal"):.6==this.options.scale?this.$mainControl.attr("zoom-type","small"):this.$mainControl.attr("zoom-type","large"),e.perfectScrollbar("update"),e.animate({scrollTop:0},500)},e.prototype.initPages=function(){var t=this.options.editor.getModel().getPages();this.controls={},this.thumbnails={},this.getPageContainer().empty();for(var e=0;e<t.length;e++)this.addPage(t[e]),this._createThumbnail(t[e].id);this.initEventListeners(),this.updatePageIndexes(),this.setSelection([this.options.editor.getModel().getPages()[0].id])},e.prototype.initEventListeners=function(){this.registerResizeEventListener(),this.registerCommandEventListener(),this.registerContentEventListener(),this.registerSelectableEventListener()},e.prototype.registerResizeEventListener=function(){$(window).on("resize",this.onResize.bind(this))},e.prototype.registerSelectableEventListener=function(){var t=this;this.getPageContainer().selectable({filter:".brtc-style-content-wrapper",stop:function(e,o){for(var i=[],n=t.controls[t.selectedPageId],a=n.$mainControl.find(".ui-selected"),r=0;r<a.length;r++)i.push($(a[r]).attr("content-id"));0===i.length?n.setSelection():n.setSelection(i),Studio.getActiveEditor().handleSelectionChanged(i)},cancel:".bcharts-pagination, .bcharts-container, .note-editing-area",tolerance:"fit"})},e.prototype.registerContentEventListener=function(){var t=this;this.getPageContainer().bind("loadComplete",function(e,o){t._createThumbnail(o.pageId,1500)})},e.prototype._createThumbnail=function(t,e){if(this.controls[t]){var o=this;this.thumbnailJob=this.thumbnailJob||{},this.thumbnailJob[t]&&clearTimeout(this.thumbnailJob[t]),this.thumbnailJob[t]=setTimeout(function(){for(var e=o.controls[t].$mainControl,i=e.clone(),n=e.find("canvas"),a=i.find("canvas"),r=0;r<n.length;r++){var s=n[r],l=a[r];l.getContext("2d").drawImage(s,0,0,l.width,l.height)}o.thumbnails[t]&&o.thumbnails[t].setThumbnail(i),o.thumbnailJob[t]=null},e||300)}},e.prototype.onResize=function(){this.getPageContainer().perfectScrollbar("update")},e.prototype.registerCommandEventListener=function(){this.options.editor.addCommandListener(this.onCommand.bind(this))},e.prototype.addPage=function(e){var o=this.getThumbnailArea(),i=this.getPageContainer(),n=this.getPageIndex(e.id);this.controls[e.id]=new t.VA.Implementation.Visual.Editors.Diagram.Figures.PaperUnit(i,{page:e,pageIndex:n,"background-color":this.options.editor.getModel().report.display.backgroundColor,editor:this.options.editor}),this.thumbnails[e.id]=new t.VA.Implementation.Visual.Editors.Diagram.PaperThumbnailUnit(o,{page:e,pageIndex:n,editor:this.options.editor}),o.perfectScrollbar("update")},e.prototype.updatePageIndexes=function(){this.getTotalPageControl().text(Object.keys(this.controls).length);var t=this.options.editor.getModel().getPages();for(var e in t){var o=t[e].id;this.thumbnails[o].updatePageIndex(this.getPageIndex(o))}this.getCurrentPageControl().text(this.getPageIndex(this.selectedPageId)+1)},e.prototype.getPageIndex=function(t){return this.options.editor.getModel().getPageIndex(t)},e.prototype.removePage=function(t){var e=this.getThumbnailArea(),o=this.thumbnails[t].options.pageIndex,i=this.options.editor.getModel().getPages();this.thumbnails[t].destroy(),delete this.thumbnails[t],this.controls[t].destroy(),delete this.controls[t];var n=i[o]?i[o].id:i[o-1]?i[o-1].id:i[0]?i[0].id:"";this.setSelection([n]),this.render(),e.perfectScrollbar("update")},e.prototype.setSelection=function(t){var e=this.getThumbnailArea(),o=t[0];for(var i in this.controls)this.controls[i].hide();e.find(".brtc-style-figure-thumbnailwrapper.ui-selectee").removeClass("ui-selected"),e.find('.brtc-style-figure-thumbnailwrapper[page-id="'+o+'"].ui-selectee').addClass("ui-selected"),this.getCurrentPageControl().text(0),o&&this.controls[o]&&(this.selectedPageId=o,this.controls[o].show(),this.getCurrentPageControl().text(this.options.editor.getModel().getPageIndex(o)+1)),$(window).trigger("resize")},e.prototype.render=function(t){t?this.controls[t].render():this.controls[this.selectedPageId].render()},e.prototype.reloadData=function(t){t?this.controls[t].reloadData():this.controls[this.selectedPageId].reloadData()},e.prototype.executeCommand=function(e){var o=this.options.editor.getCommandManager();return(e.constructor!==t.VA.Core.CompoundCommand||0!==e.commandList.length)&&o.execute(e)},e.prototype.createSetPageDisplayOptionsCommand=function(e){return new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetPageDisplayOptionsCommand(this,{report:this.options.editor.getModel().report,display:e})},e.prototype.createRemovePageCommand=function(e){return new t.VA.Implementation.Visual.Editors.Diagram.Commands.RemovePageCommand(this,{pageId:e})},e.prototype.createSortPageCommand=function(e){var o=[];for(var i in this.options.editor.getModel().getPages())o.push(this.options.editor.getModel().getPages()[i].id);return JSON.stringify(o)!=JSON.stringify(e)?new t.VA.Implementation.Visual.Editors.Diagram.Commands.SortPageCommand(this,{pageIds:e}):void 0},e.prototype.onCommand=function(e){e instanceof t.VA.Core.CompoundCommand&&this.onCompoundCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.NewPageCommand&&this.onNewPageCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RemovePageCommand&&this.onRemovePageCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SortPageCommand&&this.onSortPageCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetPageDisplayOptionsCommand&&this.onSetPageDisplayOptionsCommand(e)},e.prototype.onCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this)for(e in t.commandList)this.onCommand(t.commandList[e]);else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--)this.onCommand(t.commandList[e])},e.prototype.onActivated=function(){this.setSelection([this.selectedPageId]),this.render()},e.prototype.onSetPageDisplayOptionsCommand=function(t){for(var e=this,o=this.options.editor.getModel().getPages(),i=0;i<o.length;i++)this._createThumbnail(o[i].id);setTimeout(function(){e.getPageContainer().perfectScrollbar("update")},1e3)},e.prototype.onNewPageCommand=function(t){"REDO"==t.event.type||"EXECUTE"==t.event.type?(this.addPage(t.options.page),this.setSelection([t.options.page.id]),this._createThumbnail(t.options.page.id)):"UNDO"==t.event.type&&this.removePage([t.options.page.id]),this.updatePageIndexes()},e.prototype.onRemovePageCommand=function(t){"REDO"==t.event.type||"EXECUTE"==t.event.type?this.removePage([t.options.pageId]):"UNDO"==t.event.type&&(this.addPage(t.old.page),this.setSelection([t.old.page.id])),this.updatePageIndexes()},e.prototype.onSortPageCommand=function(t){this.updatePageIndexes()},e.prototype.getPageContainer=function(){return this.$mainControl.find(".brtc-style-editor-visualeditorpage-paper-container")},e.prototype.getThumbnailArea=function(){return this.$mainControl.find(".brtc-va-editor-visualeditorpage-thumbnail-area")},e.prototype.getTotalPageControl=function(){return this.$mainControl.find(".brtc-va-editors-visualeditor-totalpages")},e.prototype.getCurrentPageControl=function(){return this.$mainControl.find(".brtc-va-editors-visualeditor-currentpage")},e.prototype.getSelectedPage=function(){return this.controls[this.selectedPageId]},e.prototype.getSelectedObjects=function(){var t=[],e=this.getSelectedPage(),o=e.getSelectedContentIds();return _.forEach(o,function(o){t.push(e.getContent(o))}),t},e.prototype.pasteObjects=function(e){var o=new t.VA.Core.CompoundCommand(this),i=this.getSelectedPage();_.forEach(e,function(t){o.add(i.createPasteContentCommand(t))}),i.executeCommand(o)},e.prototype.removeObjects=function(e){var o=new t.VA.Core.CompoundCommand(this),i=this.getSelectedPage();_.forEach(e,function(t){o.add(i.createRemoveContentCommand(t.id))}),i.executeCommand(o)},t.VA.Implementation.Visual.Editors.Diagram.EditorPage=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o),this.options.scheduleLinks=o.scheduleLinks||[]}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var t=this.options.dataSourceId,e=this.options.func,o=this.options.analyticsModel.getDataSource(t);this.old.func=o.func,this.options.analyticsModel.changeFunc(t,e)},e.prototype.undo=function(){this.options.analyticsModel.changeFunc(this.options.dataSourceId,this.old.func)},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.ChangeFuncCommand"},t.VA.Implementation.Visual.Editors.Diagram.Commands.ChangeFuncCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.CompoundCommand.call(this,e,o)}e.prototype=Object.create(t.VA.Core.CompoundCommand.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.commandList=[];var e=this.event.source.report;this.add(new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetPageDisplayOptionsCommand(this.event.source,{report:e,display:this.options.display}));for(var o,i,n=this._getPageSize(this.options.display),a=this._getPageSize(this.event.source.report.display),r=this.event.source.report.pages,s=0;s<r.length;s++)for(var l in o=r[s].contents)i=o[l],this.add(new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentFigureCommand(this,{content:i,figure:this._getContentFigure(n,a,i)}));t.VA.Core.CompoundCommand.prototype.execute.call(this)},e.prototype._getContentFigure=function(t,e,o){var i=1*(o.size.width+"").replace("px",""),n=1*(o.size.height+"").replace("px",""),a=o.position.left,r=o.position.top,s=t.width/e.width,l=t.height/e.height,c={size:{width:Number.parseInt(i*s),height:Number.parseInt(n*l)},position:{left:Number.parseInt(a*s),top:Number.parseInt(r*l)}};if(c.size.width<100){let e=100-c.size.width;c.size.width=100,c.position.left-e<1?c.position.left=1:c.position.left+100>t.width&&(c.position.left=t.width-c.size.width-14)}if(c.size.height<100){let e=100-c.size.height;c.size.height=100,c.position.top-e<1?c.position.top=1:c.position.top+100>t.height&&(c.position.top=t.height-c.size.height-14)}return c.size.width+="px",c.size.height+="px",c},e.prototype._getPageSize=function(t){var e;return"a4-vertical"===t["page-type"]?e={width:795,height:1125}:"a4-horizontal"===t["page-type"]?e={width:1125,height:795}:"custom"===t["page-type"]&&(e={width:t.width,height:t.height}),e},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.changepagesizecommand"},e.prototype.getLabel=function(){return"Change a Page Size"},t.VA.Core.Editors.Diagram.Commands.ChangePageSizeCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var t=this.options.dataSourceId,e=this.options.scheduleId,o=this.options.analyticsModel.getDataSource(t);this.old.scheduleId=o.param.scheduleId||"",this.options.analyticsModel.changeSchedule(t,e)},e.prototype.undo=function(){this.options.analyticsModel.changeSchedule(this.options.dataSourceId,this.old.scheduleId)},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.ChangeScheduleCommand"},t.VA.Implementation.Visual.Editors.Diagram.Commands.ChangeScheduleCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.options.analyticsModel.addContentToSpecificPage(this.options.content,this.options.pageId)},e.prototype.undo=function(){this.options.analyticsModel.removeContent(this.options.content.id)},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.newcontentcommand"},e.prototype.getLabel=function(){return"Create a Page"},t.VA.Implementation.Visual.Editors.Diagram.Commands.NewContentCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o),this.old={}}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.options.analyticsModel.addDataSource(this.options.dataSource)},e.prototype.undo=function(){this.options.analyticsModel.removeDataSource(this.options.dataSource.fid)},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.newdatasourcecommand"},e.prototype.getLabel=function(){return"Add a Function"},t.VA.Implementation.Visual.Editors.Diagram.Commands.NewDataSourceCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.options.pageIndex=this.options.pageIndex?Number(this.options.pageIndex):void 0,this.options.analyticsModel.addPage(this.options.page,this.options.pageIndex)},e.prototype.undo=function(){this.options.analyticsModel.removePage(this.options.page.id)},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.newpagecommand"},e.prototype.getLabel=function(){return"Create a Page"},t.VA.Implementation.Visual.Editors.Diagram.Commands.NewPageCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.old.pageId=this.options.analyticsModel.getPageIdOfContent(this.options.contentId),this.old.pageIndex=this.options.analyticsModel.getPageIndex(this.old.pageId),this.old.content=this.options.analyticsModel.removeContent(this.options.contentId)},e.prototype.undo=function(){this.options.analyticsModel.addContentToSpecificPage(this.old.content,this.old.pageId)},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.removecontentcommand"},e.prototype.getLabel=function(){return"Remove a Page"},t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveContentCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o),this.old={}}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){var t=this.options.analyticsModel.getDataSource(this.options.dataSourceId);this.old.chart=$.extend(!0,{},t.display.charts[this.options.chartIndex]),t.display.charts.splice(this.options.chartIndex,1)},e.prototype.undo=function(){this.options.analyticsModel.getDataSource(this.options.dataSourceId).display.charts.splice(this.options.chartIndex,0,this.old.chart)},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.removedatasourcechartscommand"},e.prototype.getLabel=function(){return"Remove a chart in data source."},t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveDataSourceChartsCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o),this.old={}}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.old.dataSourceIndex=this.options.analyticsModel.getDataSourceIndex(this.options.dataSourceId),this.old.dataSource=this.options.analyticsModel.removeDataSource(this.options.dataSourceId)},e.prototype.undo=function(){this.options.analyticsModel.addDataSource(this.old.dataSource,this.old.dataSourceIndex)},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.removedatasourcecommand"},e.prototype.getLabel=function(){return"Remove a Function"},t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveDataSourceCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.old.pageIndex=this.options.analyticsModel.getPageIndex(this.options.pageId),this.old.page=this.options.analyticsModel.removePage(this.options.pageId)},e.prototype.undo=function(){this.options.analyticsModel.addPage(this.old.page,this.old.pageIndex)},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.removepagecommand"},e.prototype.getLabel=function(){return"Remove a Page"},t.VA.Implementation.Visual.Editors.Diagram.Commands.RemovePageCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o),this.options.label=o.label||"Rename data source"}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var t=this.options.analyticsModel.getDataSource(this.options.dataSourceId);this.old.label=t.display.label,this.options.analyticsModel.renameDataSource(this.options.dataSourceId,this.options.label)},e.prototype.undo=function(){this.options.analyticsModel.renameDataSource(this.options.dataSourceId,this.old.label)},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.renamedatasourcecommand"},t.VA.Implementation.Visual.Editors.Diagram.Commands.RenameDataSourceCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.old.chartType=this.options.content.options.chart.type,this.options.content.options.chart.type=this.options.chartType},e.prototype.undo=function(){this.options.content.options.chart.type=this.old.chartType},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.setcontentcharttypecommand"},e.prototype.getLabel=function(){return"Update Content Chart Type"},t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentChartTypeCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.old.dataSourceId=this.options.content.dataSourceId,this.options.content.dataSourceId=this.options.dataSourceId},e.prototype.undo=function(){this.options.content.dataSourceId=this.old.dataSourceId},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.setcontentdatasourcecommand"},e.prototype.getLabel=function(){return"Update a Content"},t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentDataSourceCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.old.figure={size:this.options.content.size,position:this.options.content.position},this.options.content.size=this.options.figure.size,this.options.content.position=this.options.figure.position},e.prototype.undo=function(){this.options.content.size=this.old.figure.size,this.options.content.position=this.old.figure.position},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.setcontentfigurecommand"},e.prototype.getLabel=function(){return"Change a Content Figure"},t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentFigureCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){for(var t in this.old.chartOption={},this.options.changedOption)this.options.chartOptions[t]?this.old.chartOption[t]=JSON.parse(JSON.stringify(this.options.chartOptions[t])):this.old.chartOption[t]=null,this.options.content.options[t]=JSON.parse(JSON.stringify(this.options.changedOption[t]))},e.prototype.undo=function(){for(var t in this.old.chartOption)this.old.chartOption[t]?this.options.content.options[t]=JSON.parse(JSON.stringify(this.old.chartOption[t])):this.options.content.options[t]=null},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.setcontentoptioncommand"},e.prototype.getLabel=function(){return"Update a Content"},t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentOptionCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){var t=this.options.content,e=t.id,o=this.options.analyticsModel.getContent(e);this.old.style=t.style||{},o.style=this.options.changedStyle},e.prototype.undo=function(){var t=this.options.content.id;this.options.analyticsModel.getContent(t).style=this.old.style},e.prototype.redo=function(){this.execute()},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.setcontentstylecommand"},e.prototype.getLabel=function(){return"Update a Content Style"},t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentStyleCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){this.options.old=$.extend(!0,{},this.options.report.display),$.extend(!0,this.options.report.display,this.options.display)},e.prototype.undo=function(){this.options.report.display=this.options.old},e.prototype.redo=function(){this.execute()},e.prototype.sort=function(t){},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.setpagedisplayoptionscommand"},e.prototype.getLabel=function(){return"Change page options"},t.VA.Implementation.Visual.Editors.Diagram.Commands.SetPageDisplayOptionsCommand=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Command.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0},e.prototype.canRedo=function(){return!0},e.prototype.execute=function(){for(var t in this.old.pageIds=[],this.options.analyticsModel.getPages())this.old.pageIds.push(this.options.analyticsModel.getPages()[t].id);this.sort(this.options.pageIds)},e.prototype.undo=function(){this.sort(this.old.pageIds)},e.prototype.redo=function(){this.execute()},e.prototype.sort=function(t){this.options.analyticsModel.getPages().sort(function(e,o){return t.indexOf(e.id)-t.indexOf(o.id)})},e.prototype.getId=function(){return"brightics.va.implementation.visual.editors.diagram.commands.sortpagecommand"},e.prototype.getLabel=function(){return"Change page index"},t.VA.Implementation.Visual.Editors.Diagram.Commands.SortPageCommand=e}.call(this),function(){"use strict";var t=this.Brightics;const e={large:1,normal:.8,small:.6};function o(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.init(),this.createControls(),this.bindEvents()}o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},o.prototype.init=function(){var e=this;this.editor=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$parent),this.model=this.editor.getModel(),this.content=this.options.content,this.commandListener=function(t){e.onCommand(t)},this.editor.addCommandListener(this.commandListener)},o.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-visual-content-wrapper brtc-style-content-wrapper">   <div class="brtc-va-visual-content-toolitem-area brtc-style-content-toolitem-area" type="'+this.options.content.type+'">       <div class="brtc-va-content-move-button brtc-style-content-move-button" title="Move Content" />   </div>   <div class="brtc-va-visual-content brtc-style-content" type="'+this.options.content.type+'"></div></div>'),this.$mainControl.attr("content-id",this.options.content.id),this.$mainControl.attr("type",this.options.content.type),this.$parent.append(this.$mainControl),this.editor.getContentOutlineStatus()||this.$mainControl.addClass("disable-outline"),this.setContentPosition(this.options.content.position),this.setContentSize(this.options.content.size),this.$content=this.$mainControl.find(".brtc-va-visual-content"),this.createToolbar(this.$mainControl.find(".brtc-va-visual-content-toolitem-area"));var t=this;this.$mainControl.on("mousedown",function(e){e.ctrlKey?t.$mainControl.hasClass("ui-selected")?t.$mainControl.removeClass("ui-selected"):t.$mainControl.addClass("ui-selected"):(t.$parent.find(".ui-selected").removeClass("ui-selected"),t.$mainControl.addClass("ui-selected")),t.$parent.closest(".ui-selectable").data("ui-selectable")&&t.$parent.closest(".ui-selectable").data("ui-selectable")._mouseStop(e)})},o.prototype._fireSelectionChanged=function(t){this.options.paper.setSelection([this.content.id],t)},o.prototype.createToolbar=function(t){this.createRemoveContentToolItem(t)},o.prototype.createRemoveContentToolItem=function(e){var o=this,i=$('<div class="brtc-va-content-remove-button brtc-style-content-remove-button" title="'+t.locale.common.removeContent+'" />');e.append(i),i.click(function(){var t=o.createRemoveContentCommand(o.options.content.id);o.executeCommand(t)})},o.prototype.setContentPosition=function(t){this.$mainControl.css("left",t.left),this.$mainControl.css("top",t.top),t["z-index"]&&this.$mainControl.css("z-index",t["z-index"])},o.prototype.setContentSize=function(t){this.$mainControl.css("width",t.width),this.$mainControl.css("height",t.height)},o.prototype.setContentBackground=function(t){this.$unitControl&&t&&(this.$unitControl.find(".panel").css("background",t),this.$unitControl.find(".note-editable").css("background",t))},o.prototype.setContentArrange=function(t){t&&this.$mainControl.css("z-index",t)},o.prototype.bindEvents=function(){this.bindDraggableEvent(),this.bindResizableEvent()},o.prototype.bindDraggableEvent=function(){var t,o,i=this,n=[],a={x:0,y:0};function r(t,o,n,a){var r,s,l=i.$mainControl.closest(".brtc-style-editor-visualeditorpage").attr("zoom-type"),c=e[l]||1;if(null!=t){var p=$(t);o=p.position(),n=p.outerWidth(),a=p.outerHeight(),r=o.top/c,s=o.left/c}else r=o.top,s=o.left;return[{type:"h",left:s,top:r,right:s+n},{type:"h",left:s,top:r+a,right:s+n},{type:"v",left:s,top:r,bottom:r+a},{type:"v",left:s+n,top:r,bottom:r+a},{type:"h",left:s,top:r+a/2,right:s+n},{type:"v",left:s+n/2,top:r,bottom:r+a}]}this.$mainControl.draggable({handle:".brtc-va-visual-content-toolitem-area",cancel:".brtc-va-visual-content",start:function(s,l){i.blur(),a.x=s.clientX,a.y=s.clientY,t=i.$mainControl.closest(".brtc-style-editor-visualeditorpage").attr("zoom-type"),o=e[t]||1,(n=$.map(i.$parent.find(".brtc-va-visual-content-wrapper").not(this),r)).push({type:"h",left:0,top:i.$parent.height()/2,right:i.$parent.width()}),n.push({type:"v",left:i.$parent.width()/2,top:0,bottom:i.$parent.height()}),i.$mainControl.closest(".brtc-style-editor-visualeditorpage-paper-container").perfectScrollbar("destroy")},drag:function(t,e){if(i.$parent.find(".brtc-va-figure-guide-v, .brtc-va-figure-guide-h").hide(),e.position.top=function(t){if(t<1)return 1;return t>i.$parent.outerHeight()-i.$mainControl.outerHeight()-1?i.$parent.outerHeight()-i.$mainControl.outerHeight()-1:t}((t.clientY-a.y+e.originalPosition.top)/o),e.position.left=function(t){if(t<1)return 1;return t>i.$parent.outerWidth()-i.$mainControl.outerWidth()-1?i.$parent.outerWidth()-i.$mainControl.outerWidth()-1:t}((t.clientX-a.x+e.originalPosition.left)/o),!t.altKey){var s,l,c,p,d={top:{dist:6},left:{dist:6}},h=$(this),u={top:e.position.top,left:e.position.left},m=h.outerWidth(),g=h.outerHeight(),f=r(null,u,m,g);$.each(n,function(t,e){$.each(f,function(t,o){if(e.type==o.type){var i="h"==e.type?"top":"left",n=Math.abs(o[i]-e[i]);n<d[i].dist&&(d[i].dist=n,d[i].offset=o[i]-u[i],d[i].guide=e)}})}),d.top.dist<=5?(s=d.top.guide.top,c=e.position.left<d.top.guide.left?e.position.left:d.top.guide.left,p=e.position.left+e.helper.width()>d.top.guide.right?e.position.left+e.helper.width():d.top.guide.right,e.position.top=d.top.guide.top-d.top.offset,i.$parent.find(".brtc-va-figure-guide-h").css("top",s).css("left",c-10).css("width",p-c+20).show()):i.$parent.find(".brtc-va-figure-guide-h").hide(),d.left.dist<=5?(c=d.left.guide.left,s=e.position.top<d.left.guide.top?e.position.top:d.left.guide.top,l=e.position.top+e.helper.height()>d.left.guide.bottom?e.position.top+e.helper.height():d.left.guide.bottom,e.position.left=d.left.guide.left-d.left.offset,i.$parent.find(".brtc-va-figure-guide-v").css("left",c).css("top",s-10).css("height",l-s+20).show()):i.$parent.find(".brtc-va-figure-guide-v").hide()}},stop:function(t,e){i.$parent.find(".brtc-va-figure-guide-v, .brtc-va-figure-guide-h").hide();var o={left:e.position.left,top:e.position.top,width:this.style.width,height:this.style.height};if(i.$mainControl.closest(".brtc-style-editor-visualeditorpage-paper-container").perfectScrollbar(),o.top!=i.options.content.position.top||o.left!=i.options.content.position.left){i.setContentSize(o),i.setContentPosition(o);var n=i.createSetContentFigureCommand(o);i.executeCommand(n)}}})},o.prototype.bindResizableEvent=function(){var o=this,i=[],n={x:0,y:0};function a(t,i,n,a){var r,s,l=o.$mainControl.closest(".brtc-style-editor-visualeditorpage").attr("zoom-type"),c=e[l]||1;if(null!=t){var p=$(t);i=p.position(),n=p.outerWidth(),a=p.outerHeight(),r=i.top/c,s=i.left/c}return[{type:"h",left:s,top:r,right:s+n},{type:"h",left:s,top:r+a,right:s+n},{type:"v",left:s,top:r,bottom:r+a},{type:"v",left:s+n,top:r,bottom:r+a},{type:"h",left:s,top:r+a/2,right:s+n},{type:"v",left:s+n/2,top:r,bottom:r+a}]}this.$mainControl.resizable({autoHide:!0,containment:"parent",cancel:".cancel-resize",minHeight:this.options.content.type===t.VA.Implementation.Visual.CONTENT_TYPE.TEXT?50:100,minWidth:100,start:function(t,e){o.blur(),n.x=t.clientX,n.y=t.clientY,(i=$.map(o.$parent.find(".brtc-va-visual-content-wrapper").not(this),a)).push({type:"h",left:30,top:30+o.$parent.height()/2,right:30+o.$parent.width()}),i.push({type:"v",left:30+o.$parent.width()/2,top:30,bottom:30+o.$parent.height()}),o.$mainControl.closest(".brtc-style-editor-visualeditorpage-paper-container").perfectScrollbar("destroy")},resize:function(t,e){if(o.$parent.find(".brtc-va-figure-guide-v, .brtc-va-figure-guide-h").hide(),!t.altKey){var n={top:{dist:6},left:{dist:6}},a=$(this),r={top:e.position.top,left:e.position.left},s=a.outerWidth()-a.width(),l=function(t,e,o){return[{type:"h",top:t.top+o},{type:"v",left:t.left+e}]}(r,a.outerWidth(),a.outerHeight());if($.each(i,function(t,e){$.each(l,function(t,o){if(e.type==o.type){var i="h"==e.type?"top":"left",a=Math.abs(o[i]-e[i]);a<n[i].dist&&(n[i].dist=a,n[i].offset=o[i]-e[i],n[i].guide=e)}})}),n.top.dist<=5){var c=e.position.left<n.top.guide.left?e.position.left:n.top.guide.left,p=e.position.left+e.helper.width()>n.top.guide.right?e.position.left+e.helper.width():n.top.guide.right;o.$parent.find(".brtc-va-figure-guide-h").css("top",n.top.guide.top).css("left",c-10).css("width",p-c+20).show(),e.size.height=n.top.guide.top-r.top-s,$(this).height(n.top.guide.top-r.top-s)}else o.$parent.find(".brtc-va-figure-guide-h").hide();if(n.left.dist<=5){var d=e.position.top<n.left.guide.top?e.position.top:n.left.guide.top,h=e.position.top+e.helper.height()>n.left.guide.bottom?e.position.top+e.helper.height():n.left.guide.bottom;o.$parent.find(".brtc-va-figure-guide-v").css("left",n.left.guide.left).css("top",d-10).css("height",h-d+20).show(),e.size.width=n.left.guide.left-r.left-s,$(this).width(n.left.guide.left-r.left-s)}else o.$parent.find(".brtc-va-figure-guide-v").hide()}},stop:function(t,e){o.$parent.find(".brtc-va-figure-guide-v, .brtc-va-figure-guide-h").hide();var i={width:e.size.width,height:e.size.height,left:e.position.left,top:e.position.top};if(i.width!=o.options.content.size.width||i.height!=o.options.content.size.height){o.setContentSize(i);var n=o.createSetContentFigureCommand(i);o.executeCommand(n),$(window).trigger("resize"),o.$mainControl.closest(".brtc-style-editor-visualeditorpage-paper-container").perfectScrollbar()}}})},o.prototype.createSetContentFigureCommand=function(e){return delete this.options.content.options.data,delete this.options.content.options.column,new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentFigureCommand(this,{content:this.options.content,figure:{size:{width:e.width,height:e.height},position:{left:e.left,top:e.top}}})},o.prototype.createRemoveContentCommand=function(e){return new t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveContentCommand(this,{contentId:e})},o.prototype.focus=function(){},o.prototype.blur=function(){},o.prototype.destroy=function(){this.editor.removeCommandListener(this.commandListener),this.$content.off("mousedown"),this.$mainControl.remove()},o.prototype.show=function(){},o.prototype.hide=function(){},o.prototype.triggerChangedContentStatus=function(t){this.$parent.trigger("contentStatusChanged",[this.options.content.id,t])},o.prototype.onCommand=function(e){e instanceof t.VA.Core.CompoundCommand&&this.onCompoundCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentOptionCommand&&this.onSetContentOptionsCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentFigureCommand&&this.onSetContentFigureCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentStyleCommand&&this.onSetContentStyleCommand(e)},o.prototype.onCompoundCommand=function(t){if("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this)for(var e in t.commandList)this.onCommand(t.commandList[e]);else if("UNDO"==t.event.type)for(var o=t.commandList.length-1;o>-1;o--)this.onCommand(t.commandList[o])},o.prototype.onSetContentOptionsCommand=function(t){t.options.content.id===this.options.content.id&&("REDO"!=t.event.type&&"UNDO"!=t.event.type||this.show(),this.triggerChangedContentStatus("rendered"))},o.prototype.onSetContentFigureCommand=function(t){t.options.content.id===this.options.content.id&&("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this?(this.setContentPosition(t.options.figure.position),this.setContentSize(t.options.figure.size)):"UNDO"==t.event.type&&(this.setContentPosition(t.old.figure.position),this.setContentSize(t.old.figure.size)),this.triggerChangedContentStatus("rendered"))},o.prototype.onSetContentStyleCommand=function(t){t.options.content.id===this.options.content.id&&("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this?(this.setContentBackground(t.options.changedStyle.background),this.setContentArrange(t.options.changedStyle["z-index"])):"UNDO"==t.event.type&&(this.setContentBackground(t.old.style.background),this.setContentArrange(t.old.style["z-index"])),this.triggerChangedContentStatus("rendered"))},o.prototype.executeCommand=function(e){var o=this.editor.getCommandManager();return(e.constructor!==t.VA.Core.CompoundCommand||0!==e.commandList.length)&&o.execute(e)},o.prototype.getZIndex=function(){return Number.parseInt(this.$mainControl.css("z-index"))},o.prototype.getId=function(){return this.options.content.id},o.prototype.getPaper=function(){return this.options.paper},o.prototype.adjustArrange=function(){this.options.content.style&&this.options.content.style["z-index"]&&this.setContentArrange(this.options.content.style["z-index"])},o.prototype.adjustBackground=function(){this.options.content.style&&this.options.content.style.background&&this.setContentBackground(this.options.content.style.background)},t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit=o}.call(this),function(){"use strict";var t=this.Brightics;const e={columns:[],data:[]};function o(e,o){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.call(this,e,o)}o.prototype=Object.create(t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype),o.prototype.constructor=o,o.prototype.init=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.init.call(this),Studio&&Studio.getJobExecutor()?this.modelLauncher=Studio.getJobExecutor():this.modelLauncher=t.VA.Implementation.Visual.VisualModelLauncher.instance(),this.pageOptions={pageNum:1,pageSize:1e3,totalCount:0}},o.prototype.createControls=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.createControls.call(this),this.createChartControl(),this.refreshPaginationStatus(),this.adjustBackground(),this.adjustArrange()},o.prototype.createToolbar=function(t){this.createRefreshToolItem(t),this.createRemoveContentToolItem(t)},o.prototype.createRefreshToolItem=function(t){var e=this,o=$('<div class="brtc-va-content-refresh-button brtc-style-content-refresh-button" title="Refresh Content" />');t.append(o),o.click(function(){e.resetDataSource(!0),e._fireSelectionChanged()})},o.prototype.createChartControl=function(){var e=this,o=$.extend(!0,{},this.content.options),i=this.getDataSource();$.extend(!0,o,{plotOptions:{map:{geoData:{url:function(t){return"api/va/v2/map/"+t}}}}}),o.source={dataType:"local",localData:[{id:{value:i?i.fid:"",label:i&&i.display?i.display.label:""},dataType:"rawdata",columns:[],data:[]}]},o.toolbar={type:"custom",show:!1},this.chart=this.$mainControl.find(".brtc-va-visual-content").bcharts(o),this.pagination=new t.Chart.Component.Pagination(this.$mainControl.find(".brtc-va-visual-content"),{pageNum:1,pageSize:1e3,changed:function(t){e.pageOptions.pageNum=t.pageNum,e.pageOptions.pageSize=t.pageSize,e.chart&&e.chart.bcharts("render",!0)}}),this.$mainControl.closest(".ps-container").on("scroll",function(){e.pagination.$contextMenu.jqxMenu("close")}),this._updatePagination(0)},o.prototype._updatePagination=function(t){if(this.pagination){this.pagination.setTotalCount(this.pageOptions.totalCount);var e=(this.pageOptions.pageNum-1)*this.pageOptions.pageSize+1,o=e+t-1;this.pagination.setPageRows(e,o)}},o.prototype.bindEvents=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.bindEvents.call(this),this.bindDroppableEvent()},o.prototype.bindDroppableEvent=function(){var e=this;this.$mainControl.droppable({greedy:!0,accept:".bcharts-ds-draggable",activate:function(o,i){var n,a=i.helper,r=t.VA.Core.Utils.WidgetUtils.getData(a,"datasource");e.processing||"table"==e.getChartOption().chart.type||(e.droppable=new t.VA.Implementation.Visual.Editors.Diagram.Figures.ChartDroppable(e.$mainControl,{width:"100%",height:"100%",contentUnit:e,chartOption:e.getChartOption(),onChartOptionChanged:function(o){n=$.extend(!0,{},n,o),clearTimeout(this._executeCommand),this._executeCommand=setTimeout(function(){var o=new t.VA.Core.CompoundCommand(this,{});e.options.content.dataSourceId&&e.options.content.dataSourceId===r.id||o.add(e.createSetContentDataSourceCommand(r.id,this)),o.add(e.createSetContentOptionCommand(n,this)),e.executeCommand(o),e._fireSelectionChanged(!0)},500)}}))},deactivate:function(){e.droppable&&(e.droppable.dispose(),e.droppable=null)}})},o.prototype.show=function(t){t&&(this.rendered=!1),this.rendered||(this.resetDataSource(!0),this.rendered=!0)},o.prototype.hide=function(){},o.prototype.refreshChart=function(){var t=this;this.chart&&(clearTimeout(this._redrawLayoutJob),this._redrawLayoutJob=setTimeout(function(){t.chart&&t.chart.bcharts("render",!0)},500),this.refreshPaginationStatus())},o.prototype.refreshPaginationStatus=function(){"table"==this.getChartOption().chart.type?(this.pageOptions={pageNum:1,pageSize:1e3,totalCount:0},this.pagination.$mainControl.show(),this.$mainControl.find(".brtc-va-visual-content").attr("type","table")):(this.pagination.$mainControl.hide(),this.$mainControl.find(".brtc-va-visual-content").attr("type","chart"))},o.prototype.getDataSource=function(){return this.model.getDataSource(this.content.dataSourceId)},o.prototype.resetDataSource=function(t){var o=this,i=this.getDataSource(),n={source:{dataType:"lazy",localData:[e],lazyData:[{id:{value:i?i.fid:"",label:i&&i.display?i.display.label:""},columns:function(){return o._querySchema()},data:function(t){o._queryData(t)}}]}};t||delete n.source.lazyData[0].data,this.setChartOption(n)},o.prototype.getChartOption=function(){if(this.chart)return this.chart.bcharts("getOptions")},o.prototype.setChartOption=function(t){this.chart&&this.chart.bcharts("setOptions",t),this.refreshPaginationStatus()},o.prototype._querySchema=function(){var e=this.getDataSource(),o=[];if(!e)return o;var i=e.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING?e.param.modelId:this.model.mid,n=this._getTableIdFromDataSource(e);return o=(o=t.VA.Core.DataQueryTemplate.getSchema(i,n))||$.extend(!0,[],e.display.columns)||[]},o.prototype._getTableIdFromDataSource=function(t){return(t=t||this.getDataSource()).param.tableId?t.param.tableId:t.param.functions?t.param.functions[0][OUT_DATA][0]:t[OUT_DATA]?t[OUT_DATA][0]:t.outputs?t.outputs.table:void 0},o.prototype._queryData=function(o){var i=this,n=this.getDataSource();if(!n)return o.done(e),void i.triggerChangedContentStatus("rendered");var a={user:t.VA.Env.Session.userId,mid:n.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING?n.param.modelId:i.model.mid,tid:this._getTableIdFromDataSource(),hideDialog:!0,publish:this.options.publish,offset:"table"==o.options.chart.type?(this.pageOptions.pageNum-1)*this.pageOptions.pageSize:0,limit:"table"==o.options.chart.type?this.pageOptions.pageSize:5e4};i.processing=!0,o.aborted=function(){this.jid&&i.modelLauncher.terminate(this.jid)},n.param.scheduleId?a.user=n.param.scheduleId:n.param.publishId&&(a.user=n.param.publishId),"table"==o.options.chart.type?i._queryTableData(o,a):i._queryChartData(o,a)},o.prototype._done=function(t,o,i){var n=i||e;"table"==t&&(n.offset=(this.pageOptions.pageNum-1)*this.pageOptions.pageSize),o.done(n),this.processing=!1,this.triggerChangedContentStatus("rendered"),"table"==t&&(this.pageOptions.totalCount=n.count,this._updatePagination(n.data.length),this.pagination.setColumnCount(n.columns.length),this.pagination.setPageNumber(this.pageOptions.pageNum),this.pagination.setPageSize(this.pageOptions.pageSize))},o.prototype._fail=function(e,o,i){if(i&&i.message)o.fail(i.message);else if(i&&i.responseJSON&&i.responseJSON.errors[0]){var n=i.responseJSON.errors[0].code,a=i.responseJSON.errors[0].parameter;let e=t.VA.Core.Utils.MessageUtils.getMessage(n,a);o.fail(e)}else if(i&&i.errorInfo.length>0){let t=i.errorInfo.map(function(t){return t.message});o.fail(t)}else o.fail("Sorry! An unexpected error occurred. Please contact administrator.");this.processing=!1,this.triggerChangedContentStatus("rendered"),"table"==e&&(this.pageOptions.totalCount=0),"table"==e&&this._updatePagination(0)},o.prototype._queryTableData=function(e,o){var i=this;t.VA.Core.DataQueryTemplate.queryTable(o.mid,o.tid,function(t,o){i._done("table",e,t)},function(t,o,n){i._fail("table",e,n)},!1,{offset:o.offset,limit:o.limit,user:o.user,publish:o.publish})},o.prototype._queryChartData=function(e,o){var i=this;t.VA.Core.DataQueryTemplate.queryTable(o.mid,o.tid,function(t,o){i._done("chart",e,t)},function(t,o,n){i._fail("chart",e,n)},!1,{offset:o.offset,limit:o.limit,user:o.user,publish:o.publish})},o.prototype.createSetContentOptionCommand=function(e,o){return new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentOptionCommand(o||this,{content:this.content,chartOptions:this.getChartOption(),changedOption:$.extend(!0,{},e)})},o.prototype.createSetContentDataSourceCommand=function(e,o){return new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentDataSourceCommand(o||this,{content:this.content,dataSourceId:e})},o.prototype.onCommand=function(e){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.onCommand.call(this,e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentDataSourceCommand&&this.onSetContentDataSourceCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveDataSourceCommand&&this.onRemoveDataSourceCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RenameDataSourceCommand&&this.onRenameDataSourceCommand(e)},o.prototype.setContentSize=function(e){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.setContentSize.call(this,e),this.chart&&this.chart.bcharts("render")},o.prototype.onSetContentOptionsCommand=function(t){t.options.content.id===this.content.id&&("REDO"==t.event.type||"EXECUTE"==t.event.type?(this.setChartOption(t.options.changedOption),"REDO"==t.event.type&&this._fireSelectionChanged(t.event.source!==this)):(this.setChartOption(t.old.chartOption),this._fireSelectionChanged(t.event.source!==this)))},o.prototype.onRenameDataSourceCommand=function(t){t.options.dataSourceId===this.content.dataSourceId&&(this.resetDataSource(!1),this.options.paper.selectedContentIds==this.options.content.id&&this._fireSelectionChanged(t.event.source!==this))},o.prototype.onSetContentDataSourceCommand=function(t){t.options.content.id===this.content.id&&(this.resetDataSource(!0),"REDO"!=t.event.type&&"UNDO"!=t.event.type||this._fireSelectionChanged(t.event.source!==this))},o.prototype.onSetContentChartTypeCommand=function(t){t.options.content.id===this.content.id&&("REDO"==t.event.type||"EXECUTE"==t.event.type?(this.setChartOption(t.options.changedOption),"REDO"==t.event.type&&this._fireSelectionChanged(t.event.source!==this)):(this.setChartOption(t.old.chartOption),this._fireSelectionChanged(t.event.source!==this)),this.refreshPaginationStatus())},o.prototype.onRemoveDataSourceCommand=function(t){t.options.dataSourceId===this.content.dataSourceId&&(this.resetDataSource(!0),this._fireSelectionChanged())},o.prototype._createBigDataChartFnUnit=function(){var e=this,o=t.VA.Core.Utils.FullRenderingUtils.getFnUnit(this.getChartOption()),i=this.getDataSource();t.VA.Core.Utils.ModelUtils.extendParent(this.editor.getModel(),o);var n=this._getTableIdFromDataSource();return o[IN_DATA].push(n),o[OUT_DATA].push(n+o.fid),o.getModelId=function(){return i.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING?i.param.modelId:e.model.mid},o},o.prototype.destroy=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.destroy.call(this),this.chart&&this.chart.bcharts("destroy"),this.pagination&&this.pagination.destroy()},o.prototype.onChartOptionChanged=function(t,e){var o=Object.keys(t)[0];if(JSON.stringify(this.getChartOption()[o])!==JSON.stringify(t[o])||!0===e){var i=this.createSetContentOptionCommand(t);this.executeCommand(i)}},o.prototype.onChartTypeChanged=function(t){if(JSON.stringify(this.getChartOption().chart.type)!==JSON.stringify(t.chart.type)){var e=this.createSetContentOptionCommand(t);this.executeCommand(e)}},o.prototype.onDataSourceChanged=function(t){if(JSON.stringify(this.content.dataSourceId)!==JSON.stringify(t.value)){var e=this.createSetContentDataSourceCommand(t.value);this.executeCommand(e)}},t.VA.Implementation.Visual.Editors.Diagram.Figures.ContentUnit.chart=o}.call(this),function(){"use strict";var t=this.Brightics,e=new t.VA.Log("ChartContentUnit");const o={columns:[],data:[]};function i(e,o){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.call(this,e,o)}i.prototype=Object.create(t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype),i.prototype.constructor=i,i.prototype.init=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.init.call(this),Studio&&Studio.getJobExecutor()?this.modelLauncher=Studio.getJobExecutor():this.modelLauncher=t.VA.Implementation.Visual.VisualModelLauncher.instance(),this.pageOptions={pageNum:1,pageSize:1e3,totalCount:0}},i.prototype.createControls=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.createControls.call(this),this.createChartControl(),this.refreshPaginationStatus(),this.adjustBackground(),this.adjustArrange()},i.prototype.createToolbar=function(t){this.createRefreshToolItem(t),this.createRemoveContentToolItem(t)},i.prototype.createRefreshToolItem=function(t){var e=this,o=$('<div class="brtc-va-content-refresh-button brtc-style-content-refresh-button" title="Refresh Content" />');t.append(o),o.click(function(){e.resetDataSource(!0),e._fireSelectionChanged()})},i.prototype.createChartControl=function(){var e=this,o=$.extend(!0,{},this.content.options),i=this.getDataSource();$.extend(!0,o,{plotOptions:{map:{geoData:{url:function(t){return"api/va/v2/map/"+t}}}}}),o.source={dataType:"local",localData:[{id:{value:i?i.fid:"",label:i&&i.display?i.display.label:""},dataType:"rawdata",columns:[],data:[]}]},o.toolbar={type:"custom",show:!1},this.chart=this.$mainControl.find(".brtc-va-visual-content").bcharts(o),this.pagination=new t.Chart.Component.Pagination(this.$mainControl.find(".brtc-va-visual-content"),{pageNum:1,pageSize:1e3,changed:function(t){e.pageOptions.pageNum=t.pageNum,e.pageOptions.pageSize=t.pageSize,e.chart&&e.chart.bcharts("render",!0)}}),this.$mainControl.closest(".ps-container").on("scroll",function(){e.pagination.$contextMenu.jqxMenu("close")}),this._updatePagination(0)},i.prototype._updatePagination=function(t){if(this.pagination){this.pagination.setTotalCount(this.pageOptions.totalCount);var e=(this.pageOptions.pageNum-1)*this.pageOptions.pageSize+1,o=e+t-1;this.pagination.setPageRows(e,o)}},i.prototype.bindEvents=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.bindEvents.call(this),this.bindDroppableEvent()},i.prototype.bindDroppableEvent=function(){var e=this;this.$mainControl.droppable({greedy:!0,accept:".bcharts-ds-draggable",activate:function(o,i){var n,a=i.helper,r=t.VA.Core.Utils.WidgetUtils.getData(a,"datasource");e.processing||"table"==e.getChartOption().chart.type||(e.droppable=new t.VA.Implementation.Visual.Editors.Diagram.Figures.ChartDroppable(e.$mainControl,{width:"100%",height:"100%",contentUnit:e,chartOption:e.getChartOption(),onChartOptionChanged:function(o){n=$.extend(!0,{},n,o),clearTimeout(this._executeCommand),this._executeCommand=setTimeout(function(){var o=new t.VA.Core.CompoundCommand(this,{});e.options.content.dataSourceId&&e.options.content.dataSourceId===r.id||o.add(e.createSetContentDataSourceCommand(r.id,this)),o.add(e.createSetContentOptionCommand(n,this)),e.executeCommand(o),e._fireSelectionChanged(!0)},500)}}))},deactivate:function(){e.droppable&&(e.droppable.dispose(),e.droppable=null)}})},i.prototype.show=function(t){t&&(this.rendered=!1),this.rendered||(this.resetDataSource(!0),this.rendered=!0)},i.prototype.hide=function(){},i.prototype.refreshChart=function(){var t=this;this.chart&&(clearTimeout(this._redrawLayoutJob),this._redrawLayoutJob=setTimeout(function(){t.chart&&t.chart.bcharts("render",!0)},500),this.refreshPaginationStatus())},i.prototype.refreshPaginationStatus=function(){"table"==this.getChartOption().chart.type?(this.pageOptions={pageNum:1,pageSize:1e3,totalCount:0},this.pagination.$mainControl.show(),this.$mainControl.find(".brtc-va-visual-content").attr("type","table")):(this.pagination.$mainControl.hide(),this.$mainControl.find(".brtc-va-visual-content").attr("type","chart"))},i.prototype.getDataSource=function(){return this.model.getDataSource(this.content.dataSourceId)},i.prototype.resetDataSource=function(t){var e=this,i=this.getDataSource(),n={source:{dataType:"lazy",localData:[o],lazyData:[{id:{value:i?i.fid:"",label:i&&i.display?i.display.label:""},columns:function(){return e._querySchema()},data:function(t){e._queryData(t)}}]}};t||delete n.source.lazyData[0].data,this.setChartOption(n)},i.prototype.getChartOption=function(){if(this.chart)return this.chart.bcharts("getOptions")},i.prototype.setChartOption=function(t){this.chart&&this.chart.bcharts("setOptions",t),this.refreshPaginationStatus()},i.prototype._querySchema=function(){var e=this.getDataSource(),o=[];if(!e)return o;var i=e.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING?e.param.modelId:this.model.mid,n=this._getTableIdFromDataSource(e);return o=(o=t.VA.Core.DataQueryTemplate.getSchema(i,n))||$.extend(!0,[],e.display.columns)||[]},i.prototype._getTableIdFromDataSource=function(t){return(t=t||this.getDataSource()).param.tableId?t.param.tableId:t.param.functions?t.param.functions[0][OUT_DATA][0]:t[OUT_DATA]?t[OUT_DATA][0]:t.outputs?t.outputs.table:void 0},i.prototype._queryData=function(e){var i=this,n=this.getDataSource();if(!n)return e.done(o),void i.triggerChangedContentStatus("rendered");var a=this._createBigDataChartFnUnit(),r={fnUnit:a,user:t.VA.Env.Session.userId,mid:a.getModelId(),tid:"table"==e.options.chart.type?a[IN_DATA]:a[OUT_DATA][0],hideDialog:!0,publish:this.options.publish,offset:"table"==e.options.chart.type?(this.pageOptions.pageNum-1)*this.pageOptions.pageSize:0,limit:"table"==e.options.chart.type?this.pageOptions.pageSize:1e3};i.processing=!0,e.aborted=function(){this.jid&&i.modelLauncher.terminate(this.jid)},n.param.scheduleId?r.user=n.param.scheduleId:n.param.publishId&&(r.user=n.param.publishId),"table"==e.options.chart.type?i._queryTableData(e,r):i._queryChartData(e,r)},i.prototype._done=function(t,e,i){var n=i||o;"table"==t&&(n.offset=(this.pageOptions.pageNum-1)*this.pageOptions.pageSize),e.done(n),this.processing=!1,this.triggerChangedContentStatus("rendered"),"table"==t&&(this.pageOptions.totalCount=n.count,this._updatePagination(n.data.length),this.pagination.setColumnCount(n.columns.length),this.pagination.setPageNumber(this.pageOptions.pageNum),this.pagination.setPageSize(this.pageOptions.pageSize))},i.prototype._fail=function(e,o,i){if(i&&i.message)o.fail(i.message);else if(i&&i.responseJSON&&i.responseJSON.errors[0]){var n=i.responseJSON.errors[0].code,a=i.responseJSON.errors[0].parameter;let e=t.VA.Core.Utils.MessageUtils.getMessage(n,a);o.fail(e)}else if(i&&i.errorInfo.length>0){let t=i.errorInfo.map(function(t){return t.message});o.fail(t)}else o.fail("Sorry! An unexpected error occurred. Please contact administrator.");this.processing=!1,this.triggerChangedContentStatus("rendered"),"table"==e&&(this.pageOptions.totalCount=0),"table"==e&&this._updatePagination(0)},i.prototype._queryTableData=function(e,o){var i=this;t.VA.Core.DataQueryTemplate.queryTable(o.mid,o.tid,function(t,o){i._done("table",e,t)},function(t,o,n){i._fail("table",e,n)},!1,{offset:o.offset,limit:o.limit,user:o.user,publish:o.publish})},i.prototype._queryChartData=function(o,i){var n=this;t.VA.Core.Utils.FullRenderingUtils.getRenderedData(i.fnUnit,n.modelLauncher,{mid:i.mid,user:i.user,publish:i.publish,hideDialog:i.hideDialog,contentUnit:this},function(t){try{n._done("chart",o,t)}catch(t){n._fail("chart",o,t.message),e.error(t.stack,{category:"Chart"})}},function(t,e,i){n._fail("chart",o,i)},function(t){o.jid=t})},i.prototype.createSetContentOptionCommand=function(e,o){return new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentOptionCommand(o||this,{content:this.content,chartOptions:this.getChartOption(),changedOption:$.extend(!0,{},e)})},i.prototype.createSetContentDataSourceCommand=function(e,o){return new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentDataSourceCommand(o||this,{content:this.content,dataSourceId:e})},i.prototype.onCommand=function(e){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.onCommand.call(this,e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentDataSourceCommand&&this.onSetContentDataSourceCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveDataSourceCommand&&this.onRemoveDataSourceCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RenameDataSourceCommand&&this.onRenameDataSourceCommand(e)},i.prototype.setContentSize=function(e){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.setContentSize.call(this,e),this.chart&&this.chart.bcharts("render")},i.prototype.onSetContentOptionsCommand=function(t){t.options.content.id===this.content.id&&("REDO"==t.event.type||"EXECUTE"==t.event.type?(this.setChartOption(t.options.changedOption),"REDO"==t.event.type&&this._fireSelectionChanged(t.event.source!==this)):(this.setChartOption(t.old.chartOption),this._fireSelectionChanged(t.event.source!==this)))},i.prototype.onRenameDataSourceCommand=function(t){t.options.dataSourceId===this.content.dataSourceId&&(this.resetDataSource(!1),this.options.paper.selectedContentIds==this.options.content.id&&this._fireSelectionChanged(t.event.source!==this))},i.prototype.onSetContentDataSourceCommand=function(t){t.options.content.id===this.content.id&&(this.resetDataSource(!0),"REDO"!=t.event.type&&"UNDO"!=t.event.type||this._fireSelectionChanged(t.event.source!==this))},i.prototype.onSetContentChartTypeCommand=function(t){t.options.content.id===this.content.id&&("REDO"==t.event.type||"EXECUTE"==t.event.type?(this.setChartOption(t.options.changedOption),"REDO"==t.event.type&&this._fireSelectionChanged(t.event.source!==this)):(this.setChartOption(t.old.chartOption),this._fireSelectionChanged(t.event.source!==this)),this.refreshPaginationStatus())},i.prototype.onRemoveDataSourceCommand=function(t){t.options.dataSourceId===this.content.dataSourceId&&(this.resetDataSource(!0),this._fireSelectionChanged())},i.prototype._createBigDataChartFnUnit=function(){var e=this,o=t.VA.Core.Utils.FullRenderingUtils.getFnUnit(this.getChartOption()),i=this.getDataSource();t.VA.Core.Utils.ModelUtils.extendParent(this.editor.getModel(),o);var n=this._getTableIdFromDataSource();return o[IN_DATA].push(n),o[OUT_DATA].push(n+o.fid),o.getModelId=function(){return i.func===t.VA.Implementation.Visual.DATASOURCE_TYPE.STAGING?i.param.modelId:e.model.mid},o},i.prototype.destroy=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.destroy.call(this),this.chart&&this.chart.bcharts("destroy"),this.pagination&&this.pagination.destroy()},i.prototype.onChartOptionChanged=function(t,e){var o=Object.keys(t)[0];if(JSON.stringify(this.getChartOption()[o])!==JSON.stringify(t[o])||!0===e){var i=this.createSetContentOptionCommand(t);this.executeCommand(i)}},i.prototype.onChartTypeChanged=function(t){if(JSON.stringify(this.getChartOption().chart.type)!==JSON.stringify(t.chart.type)){var e=this.createSetContentOptionCommand(t);this.executeCommand(e)}},i.prototype.onDataSourceChanged=function(t){if(JSON.stringify(this.content.dataSourceId)!==JSON.stringify(t.value)){var e=this.createSetContentDataSourceCommand(t.value);this.executeCommand(e)}},t.VA.Implementation.Visual.Editors.Diagram.Figures.ContentUnit.chart=i}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.init(),this.retrieveParent(),this.createControls()}e.prototype.init=function(){},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.createControls=function(){var e=this;if(this.$mainControl=$('<div class="brtc-va-visual-droppable">   <div class="brtc-va-visual-droppable-contents"></div></div>'),"map"!==e.options.chartOption.chart.type){this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$contents=this.$mainControl.find(".brtc-va-visual-droppable-contents");var o=t.Chart.Registry[this.options.chartOption.chart.type].DefaultOptions;this.chartOption=new t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable[this.options.chartOption.chart.type](this.$mainControl,$.extend(!0,{},{chartOption:o,dataSource:{},setting:{},contentsFactory:{createContents:function(o){for(var i=0;i<o.length;i++)o[i].forEach(function(o){var i={selected:$.extend(!0,[],o.ref.selected),multiple:o.multiple||!1,aggregation:o.aggregation||!1,label:o.label,columns:[],onChanged:function(t){var i;delete o.ref.axisType,o.ref.selected=t,"function"==typeof o.getColumnChangedOption?i=o.getColumnChangedOption(t):((i={})[o.key]=[],i[o.key][0]=o.ref),e.options.onChartOptionChanged(i)}};o.mandatory&&t.Chart.Adonis.Component.Widgets.Factory.createColumnSelectorDroppableWidget(e.$contents,i)})}}},this.options))}this.$mainControl.find(".ui-droppable").on("drop",function(t,e){t.stopPropagation()})},e.prototype.dispose=function(){this.$mainControl.remove()},t.VA.Implementation.Visual.Editors.Diagram.Figures.ChartDroppable=e}.call(this),function(){"use strict";var t=this.Brightics;const e=93,o=131;function i(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls()}i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},i.prototype.createControls=function(){var i=this;this.$mainControl=$('<div class="brtc-style-figure-paperthumbnail" id="'+this.options.page.id+'">   <div>       <div class="brtc-style-margin-bottom-5"><span class="page-index">'+(this.options.pageIndex+1)+'</span>&nbsp;page</div>       <div class="brtc-style-figure-thumbnailwrapper brtc-style-flex-center ui-selectee selectee" page-id="'+this.options.page.id+'">       </div>   </div>   <div class="brtc-style-flex-column">       <div class="brtc-style-btn-close" />       <div class="brtc-style-btn-drag"><span></span></div>   </div></div>');var n=this.$parent.find(".brtc-style-figure-paperthumbnail").eq(this.options.pageIndex);1==n.length?this.$mainControl.insertBefore(n):this.$parent.append(this.$mainControl),this.$mainControl.find(".brtc-style-figure-thumbnailwrapper").css({width:e+"px",height:o+"px"}),this.$mainControl.find(".brtc-style-btn-close").click(function(){var e=i.options.editor.getDiagramEditorPage();if(1!==i.options.editor.getModel().getPages().length){t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Do you want to delete page?",function(t){if(t.OK){var o=e.createRemovePageCommand(i.options.page.id);e.executeCommand(o)}})}else t.VA.Core.Utils.WidgetUtils.openInformationDialog("At least one page must exist on report.")})},i.prototype.updatePageIndex=function(t){this.options.pageIndex=t,this.$mainControl.find(".page-index").text(this.options.pageIndex+1),this.$parent.children().eq(t).insertBefore(this.$mainControl)},i.prototype.setThumbnail=function(t){t.addClass("brtc-style-figure-thumbnail"),t=this._configureThumbnailSize(t),this.$mainControl.find(".brtc-va-visual-page").remove(),this.$mainControl.find(".brtc-style-figure-thumbnailwrapper").prepend(t)},i.prototype._configureThumbnailSize=function(t){t.css("width","auto"),t.css("margin","0px");var i=this.options.editor.getModel().report.display;t.removeClass("brtc-style-min-full");var n=Math.min(e/i.width,o/i.height);return t.css({"-webkit-transform":"scale("+n+")","-moz-transform":"scale("+n+")","-ms-transform":"scale("+n+")","-o-transform":"scale("+n+")",transform:"scale("+n+")",display:"block"}),t},i.prototype.destroy=function(){this.$mainControl.remove()},t.VA.Implementation.Visual.Editors.Diagram.PaperThumbnailUnit=i}.call(this),function(){"use strict";var t=this.Brightics;var e=new t.VA.Log("PaperUnit");function o(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.init(),this.createControls(),this.createContents()}o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},o.prototype.init=function(){this.editor=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$parent),this.contentLoading={},this.contentList={};var e=this;this.commandListener=function(t){e.onCommand(t)},this.editor.addCommandListener(this.commandListener),this.contentTop=30,this.contentLeft=30},o.prototype.destroy=function(){for(var t in this.setSelection(),this.contentList)this.contentList[t].destroy();this.contentList={},this.contentLoading={},this.editor.removeCommandListener(this.commandListener),this.$mainControl.remove()},o.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-visual-page-wrapper brtc-style-transform-origin-left brtc-style-inline-flex-center brtc-style-min-full">   <div class="brtc-va-visual-page brtc-style-page" page-type="a4-vertical" tabindex="1">       <div class="brtc-va-figure-guide-h brtc-style-figure-guide brtc-style-s-figure-guide-h"></div>       <div class="brtc-va-figure-guide-v brtc-style-figure-guide brtc-style-s-figure-guide-v"></div>   </div></div>'),this.$parent.append(this.$mainControl),this.$page=this.$mainControl.children(".brtc-va-visual-page"),this.$page.attr("page-id",this.options.page.id),this.$page.css({"background-color":this.options["background-color"]});var e=this.editor.getModel();e.report.display["page-type"]?this._setPageSize(e.report.display):this._setPageSize(t.VA.Implementation.Visual.CONST.DEFAULT_REPORT_SIZE)},o.prototype.render=function(t){if(t)this.contentList[t].show();else for(var e in this.contentList)this.contentList[e].show(!0)},o.prototype.refresh=function(){for(var t in this.contentList)this.contentList[t].show()},o.prototype.reloadData=function(){for(var t in this.contentList)this.contentList[t].show(!0)},o.prototype.createContents=function(){for(var t in this.bindEvents(),this.options.page.contents)this.addContent(this.options.page.contents[t])},o.prototype.bindEvents=function(){this.bindCreatedContentEvent()},o.prototype.executeCommand=function(e){var o=this.editor.getCommandManager();return(e.constructor!==t.VA.Core.CompoundCommand||0!==e.commandList.length)&&o.execute(e)},o.prototype.bindCreatedContentEvent=function(){var t=this;this.$page.on("contentStatusChanged",function(e,o,i){t.contentLoading[o]=i,t.fireLoadComplete()})},o.prototype.onCommand=function(e){e instanceof t.VA.Core.CompoundCommand&&this.onCompoundCommand(e),"REDO"!=e.event.type&&"UNDO"!=e.event.type||this.setSelection(),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.NewContentCommand&&this.onNewContentCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveContentCommand&&this.onRemoveContentCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentFigureCommand&&this.onSetContentFigureCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentDataSourceCommand&&this.onSetContentDataSourceCommand(e),e instanceof t.VA.Implementation.Visual.Editors.Diagram.Commands.SetPageDisplayOptionsCommand&&this.onSetPageDisplayOptionsCommand(e)},o.prototype.onCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this)for(e in t.commandList)this.onCommand(t.commandList[e]);else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--)this.onCommand(t.commandList[e])},o.prototype.onSetPageDisplayOptionsCommand=function(t){"REDO"==t.event.type||"EXECUTE"==t.event.type?(this._setBackGroundColor(t.options.display),this._setPageSize(t.options.display)):(this._setBackGroundColor(t.options.old),this._setPageSize(t.options.old)),"REDO"!=t.event.type&&"UNDO"!=t.event.type||this.fireSelectionChanged()},o.prototype._setBackGroundColor=function(t){t.backgroundColor&&this.$page.css({"background-color":t.backgroundColor})},o.prototype._setPageSize=function(t){if(t["page-type"]){if(this.$page.attr("page-type",t["page-type"]),this.$page.css("width",t.width+"px"),this.$page.css("height",t.height+"px"),"custom"===t["page-type"]){var e=parseInt(t.width)+200;this.$page.parent().css("width",e+"px")}else this.$page.parent().css("width","100%");this._setInitContentSize()}},o.prototype._setInitContentSize=function(){this.initContentWidth=520<=this.$page.width()-60?520:this.$page.width()-60,this.initContentHeight=250<=this.$page.height()-60?250:this.$page.height()-60},o.prototype.onNewContentCommand=function(t){t.options.pageId===this.options.page.id&&("REDO"==t.event.type||"EXECUTE"==t.event.type?(this.addContent(t.options.content),this.render(t.options.content.id),this.$parent.selectable("refresh"),this.setSelection([t.options.content.id])):"UNDO"==t.event.type&&this.removeContent(t.options.content.id))},o.prototype.onRemoveContentCommand=function(t){t.old.pageId===this.options.page.id&&("REDO"==t.event.type||"EXECUTE"==t.event.type?this.removeContent(t.options.contentId):"UNDO"==t.event.type&&(this.addContent(t.old.content),this.render(t.old.content.id),this.$parent.selectable("refresh"),this.setSelection([t.old.content.id])))},o.prototype.onSetContentFigureCommand=function(t){"REDO"!=t.event.type&&"UNDO"!=t.event.type||this.contentList[t.options.content.id]&&this.setSelection([t.options.content.id])},o.prototype.onSetContentDataSourceCommand=function(t){this.contentList[t.options.content.id]},o.prototype.getNewContentPosition=function(){return this.contentLeft=this.contentLeft+30+this.initContentWidth+7>this.$page.width()-30?23:this.contentLeft+30,this.contentTop=this.contentTop+30+this.initContentHeight+7>this.$page.height()-30?23:this.contentTop+30,{left:this.contentLeft,top:this.contentTop,"z-index":100+Object.keys(this.options.page.contents).length}},o.prototype.createNewTextContentCommand=function(){if(!(Object.keys(this.options.page.contents).length>=50)){var e=this.editor.getModel().newContent({type:t.VA.Implementation.Visual.CONTENT_TYPE.TEXT,options:{html:""},position:this.getNewContentPosition(),size:{width:this.initContentWidth,height:this.initContentHeight}});return new t.VA.Implementation.Visual.Editors.Diagram.Commands.NewContentCommand(this,{content:e,pageId:this.options.page.id})}t.VA.Core.Utils.WidgetUtils.openInformationDialog("Maximum number of contents to create is 50.")},o.prototype.createNewChartContentCommand=function(e,o){var i=o.chartOption||{chart:{type:e}};if(i.chart.type=e,!(Object.keys(this.options.page.contents).length>=50)){var n=this.editor.getModel().newContent({type:t.VA.Implementation.Visual.CONTENT_TYPE.CHART,options:i,position:this.getNewContentPosition(),size:{width:this.initContentWidth,height:this.initContentHeight},dataSourceId:o.dataSourceId});return new t.VA.Implementation.Visual.Editors.Diagram.Commands.NewContentCommand(this,{content:n,pageId:this.options.page.id})}t.VA.Core.Utils.WidgetUtils.openInformationDialog("Maximum number of contents to create is 50.")},o.prototype.createPasteContentCommand=function(e){var o=_.cloneDeep(e);return o.id=t.VA.Core.Utils.IDGenerator.reportContent.id(),o.position=this.getNewContentPosition(),new t.VA.Implementation.Visual.Editors.Diagram.Commands.NewContentCommand(this,{content:o,pageId:this.options.page.id})},o.prototype.removeContent=function(t){delete this.contentLoading[t],this.contentList[t].destroy(),delete this.contentList[t],this.setSelection(),this.fireLoadComplete()},o.prototype.addContent=function(o){this.contentLoading[o.id]="init";try{this.contentList[o.id]=new t.VA.Implementation.Visual.Editors.Diagram.Figures.ContentUnit[o.type](this.$page,{content:o,publish:this.options.publish,paper:this})}catch(t){e.error(t.stack,{category:"Chart"})}this.contentLoading[o.id]="rendered",this.fireLoadComplete()},o.prototype.setSelection=function(t,e){var o=t||[];if("none"!=this.$page.css("display")){this.$page.find(".ui-selectee").addClass("cancel-resize");for(var i=this.$page.find(".brtc-style-content-wrapper.ui-selectee"),n=0;n<i.length;n++){var a=!1;for(var r in o)if($(i[n]).attr("content-id")===o[r]){a=!0;break}1===o.length?a||($(i[n]).removeClass("ui-selected"),this.contentList[$(i[n]).attr("content-id")].blur()):this.contentList[$(i[n]).attr("content-id")].blur()}if(1===o.length){this.contentList[o[0]].focus();var s=o[0];this.$page.find('.brtc-style-content-wrapper[content-id="'+s+'"].ui-selectee').addClass("ui-selected"),this.$page.find(".ui-selected").removeClass("cancel-resize")}0===o.length&&this.$page.find(".ui-selectee").removeClass("ui-selected"),JSON.stringify(this.selectedContentIds)===JSON.stringify(o)&&t&&!e||this.fireSelectionChanged(o),this.selectedContentIds=o}},o.prototype.getSelectedContentIds=function(){return this.selectedContentIds},o.prototype.fireLoadComplete=function(){var t=!0;for(var e in this.contentLoading)if("rendered"!==this.contentLoading[e]){t=!1;break}t&&this.$parent.trigger("loadComplete",[{pageId:this.options.page.id}])},o.prototype.fireSelectionChanged=function(t){var e=[];for(var o in t)for(var i in this.contentList)if(t[o]===i){e.push(this.contentList[i]);break}this.$parent.closest(".brtc-va-editor").trigger("editorSelectionChanged",[e])},o.prototype.show=function(){this.$mainControl.show(),this.setSelection()},o.prototype.hide=function(){for(var t in this.contentList)this.contentList[t].hide();this.$mainControl.hide()},o.prototype.getMaxZIndex=function(){var t=1;for(var e in this.contentList){var o=this.contentList[e],i=Number.parseInt(o.$mainControl.css("z-index"));t<i&&(t=i)}return t},o.prototype.getMinZIndex=function(){var t=Number.MAX_SAFE_INTEGER;for(var e in this.contentList){var o=this.contentList[e],i=Number.parseInt(o.$mainControl.css("z-index"));t>i&&(t=i)}return t},o.prototype.getArrangeFrontIndex=function(){return this.getMaxZIndex()+1},o.prototype.setArrangeBackendIndex=function(t){for(var e in this.contentList)var o=this.contentList[e].getZIndex();return o+1},o.prototype.setArrangePlusIndex=function(t){var e=this.contentList[t],o=e.getZIndex();return e.setZIndex(o+1),o+1},o.prototype.setArrangeMinusIndex=function(t){var e=this.contentList[t],o=e.getZIndex();return e.setZIndex(o-1),o-1},o.prototype.getContent=function(t){return this.contentList[t].options.content},o.prototype.createRemoveContentCommand=function(e){return new t.VA.Implementation.Visual.Editors.Diagram.Commands.RemoveContentCommand(this,{contentId:e})},t.VA.Implementation.Visual.Editors.Diagram.Figures.PaperUnit=o}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.call(this,e,o)}e.prototype=Object.create(t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.createControls.call(this);var e=this;this.$unitControl=$('<div class="brtc-va-text-content-unit brtc-style-content" type="text"></div>'),this.$content.append(this.$unitControl);var o={height:"100%",placeholder:"Write Text",callbacks:{onInit:function(){},onPaste:function(o){(o.currentTarget.innerText+((o.originalEvent||o).clipboardData||window.clipboardData).getData("Text")).replace(/(<([^>]+)>)/gi,"").replace(/( )/,"").length>=2e3&&(o.preventDefault(),o.stopPropagation(),t.VA.Core.Utils.WidgetUtils.getEditorRef(e.$mainControl).notification("info","The character input is limited within 2000."))},onKeydown:function(o){var i=o.keyCode;if(-1!=$.inArray(i,[8,37,38,39,40,46])||o.altKey||o.ctrlKey)return!0;$(o.currentTarget).text().replace(/(<([^>]+)>)/gi,"").replace(/( )/,"").length>=2e3&&(t.VA.Core.Utils.WidgetUtils.getEditorRef(e.$mainControl).notification("info","The character input is limited within 2000."),o.preventDefault(),o.stopPropagation())},onChange:function(t,o){e.rendering||(e.isChanged=t!==e.options.content.options.html)},onBlur:function(){e.$mainControl.hasClass("ui-selected")||e.blur()}},toolbar:[["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["height",["height"]],["table",["table"]],["color",["color"]],["para",["ul","ol","paragraph"]]]};this.noteControl=t.VA.Core.Widget.Factory.noteControl(this.$unitControl,o),this.$unitControl.find(".note-dropzone").remove(),this.$unitControl.find(".note-statusbar").remove(),this.$unitControl.find(".modal").remove(),this.$unitControl.find(".note-para").find(".dropdown-menu").addClass("right"),this.$unitControl.find(".note-height").find(".dropdown-menu").addClass("right"),this.$unitControl.find(".dropdown-menu").css({"box-sizing":"border-box"}),this.options.content.options.html&&(this.rendering=!0,this.noteControl.$mainControl.summernote("code",this.options.content.options.html),this.rendering=!1),this.options.publish&&this.$mainControl.addClass("publish"),this.adjustBackground(),this.adjustArrange(),this.$unitControl.find(".note-editable.panel-body").on("mousewheel",function(t){($(t.currentTarget).parents(".ui-selected").length||$(t.currentTarget).parents(".publish").length)&&$(t.currentTarget).get(0).scrollHeight>$(t.currentTarget).get(0).clientHeight&&t.stopPropagation()})},e.prototype.show=function(){this.options.content&&this.options.content.options&&(this.rendering=!0,this.noteControl.$mainControl.summernote("code",this.options.content.options.html||""),this.rendering=!1)},e.prototype.focus=function(){t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.focus.call(this),this.noteControl.$mainControl.summernote("enable"),this.noteControl.$mainControl.summernote("focus")},e.prototype.blur=function(){if(t.VA.Implementation.Visual.Editors.Diagram.Figures.BaseContentUnit.prototype.blur.call(this),this.isChanged){var e=this.noteControl.getCode(),o=new t.VA.Implementation.Visual.Editors.Diagram.Commands.SetContentOptionCommand(this,{content:this.options.content,chartOptions:this.options.content.options,changedOption:{html:e}});this.isChanged=!1,this.editor.getCommandManager().execute(o)}this.noteControl.$mainControl.summernote("disable"),this.triggerChangedContentStatus("rendered")},t.VA.Implementation.Visual.Editors.Diagram.Figures.ContentUnit.text=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.area.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.area.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.area=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption["area-stacked-100"].call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption["area-stacked-100"].prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable["area-stacked-100"]=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption["area-stacked"].call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption["area-stacked"].prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable["area-stacked"]=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.bar.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.bar.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.bar=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption["bar-stacked-100"].call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption["bar-stacked-100"].prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable["bar-stacked-100"]=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption["bar-stacked"].call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption["bar-stacked"].prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable["bar-stacked"]=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.biplot.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.biplot.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.biplot=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.boxplot.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.boxplot.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.boxplot=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.histogram.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.bubble.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.bubble=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.card.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.card.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.card=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.column.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.column.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.column=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption["column-stacked-100"].call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption["column-stacked-100"].prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable["column-stacked-100"]=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption["column-stacked"].call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption["column-stacked"].prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable["column-stacked"]=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.decisionTree.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.decisionTree.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.decisionTree=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.histogram.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.dendrogram.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.dendrogram=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.donut.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.donut.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.donut=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.heatmap.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.heatmap.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.heatmap=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption["heatmap-matrix"].call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption["heatmap-matrix"].prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable["heatmap-matrix"]=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.histogram.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.histogram.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.histogram=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption["image-grid"].call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption["image-grid"].prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable["image-grid"]=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.line.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.line.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.line=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.map.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.map.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents([])},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.map=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.network.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.network.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.network=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.pie.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.pie.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.pie=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.roccurve.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.roccurve.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.roccurve=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.scatter.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.scatter.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.scatter=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.table.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.table.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.table=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.Chart.Adonis.Component.ChartOption.treemap.call(this,e,o)}e.prototype=Object.create(t.Chart.Adonis.Component.ChartOption.treemap.prototype),e.prototype.constructor=e,e.prototype._createContents=function(){this.options.contentsFactory.createContents(this.options.setting.columnSelector)},t.VA.Implementation.Visual.Editors.Diagram.Figures.Droppable.treemap=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.prototype),e.prototype.constructor=e,e.prototype.registerItems=function(){var e=t.VA.Implementation.Visual.Toolbar.ItemsTemplate;for(var o in e)this.addItem(e[o])},e.prototype.handleOnSelectionChanged=function(t){_.forEach(this.items,function(e){e.handleOnSelectionChanged(t)})},e.prototype.handleOnCopy=function(){this.getItem("paste").handleOnCopy()},t.VA.Implementation.Visual.Toolbar=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.Item.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:t.locale.common.contentOutline,"item-type":"content-outline"},action:{click:this.handleOnClick}})},e.prototype.handleOnClick=function(t){var e=Studio.getEditorContainer().getActiveModelEditor();this.$mainControl.toggleClass("status-selected"),!this.$mainControl.hasClass("status-selected")?e.showContentOutline():e.hideContentOutline()},t.VA.Implementation.Visual.Toolbar.ContentOutlineItem=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.Item.call(this,e,o),this.setDisable()}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:t.locale.common.copy,"item-type":"copy"},action:{click:this.handleOnClick}})},e.prototype.handleOnClick=function(t){var e=Studio.getEditorContainer().getActiveModelEditor(),o=Studio.getClipboardManager(),i={};i[e.getEditorInput().getFileId()]=e.getSelectedObjects(),o.addVisualObjects(i),e.notification("success","copy")},e.prototype.handleOnSelectionChanged=function(t){_.isEmpty(t)?this.setDisable():this.setEnable()},t.VA.Implementation.Visual.Toolbar.CopyItem=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.Item.call(this,e,o),this.setDisable()}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:t.locale.common.cut,"item-type":"cut"},action:{click:this.handleOnClick}})},e.prototype.handleOnClick=function(t){var e=Studio.getEditorContainer().getActiveModelEditor(),o=Studio.getClipboardManager(),i=e.getEditorInput().getFileId(),n={},a=e.getSelectedObjects();n[i]=a,o.addVisualObjects(n),e.removeObjects(a),e.handleSelectionChanged(),e.notification("success","cut")},e.prototype.handleOnSelectionChanged=function(t){_.isEmpty(t)?this.setDisable():this.setEnable()},t.VA.Implementation.Visual.Toolbar.CutItem=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.Item.call(this,e,o),this.setDisable()}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:t.locale.common.delete,"item-type":"delete"},action:{click:this.handleOnClick}})},e.prototype.handleOnClick=function(t){var e=Studio.getEditorContainer().getActiveModelEditor(),o=e.getSelectedObjects();e.removeObjects(o),e.handleSelectionChanged()},e.prototype.handleOnSelectionChanged=function(t){_.isEmpty(t)?this.setDisable():this.setEnable()},t.VA.Implementation.Visual.Toolbar.DeleteItem=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.Item.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:t.locale.common.exportPDF,"item-type":"export-pdf"},action:{click:this.handleOnClick}})},e.prototype.handleOnClick=function(e){var o=t.VA.Core.Utils.CommonUtils.getUserBrowserName(),i=Studio.getEditorContainer().getActiveModelEditor(),n={user:t.VA.Env.Session.userId,pid:i.options.editorInput.getProjectId(),mid:i.options.editorInput.getFileId()},a=$.map(n,function(t,e){return e+"="+t}).join("&");"Chrome"===o&&"custom"!==i.getModel().report.display["page-type"]?window.open("/pdf?"+a,"PDF"):"Chrome"===o?t.VA.Core.Utils.WidgetUtils.openInformationDialog("Do not support in custom page size"):o?t.VA.Core.Utils.WidgetUtils.openInformationDialog("Do not support in "+o):t.VA.Core.Utils.WidgetUtils.openInformationDialog("Do not support in your browser")},t.VA.Implementation.Visual.Toolbar.ExportPDFItem=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.Item.call(this,e,o),this.setDisable()}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:t.locale.common.paste,"item-type":"paste"},action:{click:this.handleOnClick}})},e.prototype.handleOnClick=function(t){var e=Studio.getEditorContainer().getActiveModelEditor(),o=e.getEditorInput().getFileId(),i=Studio.getClipboardManager().getVisualObjects(o);e.pasteObjects(i)},e.prototype.handleOnCopy=function(){this.setEnable()},t.VA.Implementation.Visual.Toolbar.PasteItem=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.Item.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:t.locale.common.publish,"item-type":"publish"},action:{click:this.handleOnClick}})},e.prototype.handleOnClick=function(e){var o=Studio.getEditorContainer().getActiveModelEditor();new t.VA.Implementation.Visual.Dialogs.PublishReportDialog(o.$mainControl,{title:t.locale.common.publish,appendTo:o.$parent},o.options.editorInput)},t.VA.Implementation.Visual.Toolbar.PublishItem=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){t.VA.Core.Editors.Toolbar.Item.call(this,e,o)}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:t.locale.common.refresh,"item-type":"refresh"},action:{click:this.handleOnClick}})},e.prototype.handleOnClick=function(t){Studio.getEditorContainer().getActiveModelEditor().diagramEditorPage.reloadData()},t.VA.Implementation.Visual.Toolbar.RefreshItem=e}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Implementation.Visual.Toolbar.ItemsTemplate=[{class:t.VA.Core.Editors.Toolbar.RedoItem},{class:t.VA.Core.Editors.Toolbar.UndoItem},{class:t.VA.Core.Editors.Toolbar.Separator},{class:t.VA.Core.Editors.Toolbar.ZoomItem},{class:t.VA.Core.Editors.Toolbar.Separator},{class:t.VA.Implementation.Visual.Toolbar.ContentOutlineItem},{class:t.VA.Core.Editors.Toolbar.Separator},{class:t.VA.Implementation.Visual.Toolbar.PublishItem},{class:t.VA.Implementation.Visual.Toolbar.RefreshItem},{class:t.VA.Implementation.Visual.Toolbar.ExportPDFItem},{class:t.VA.Core.Editors.Toolbar.Separator},{class:t.VA.Implementation.Visual.Toolbar.CopyItem},{class:t.VA.Implementation.Visual.Toolbar.CutItem},{class:t.VA.Implementation.Visual.Toolbar.PasteItem},{class:t.VA.Core.Editors.Toolbar.Separator},{class:t.VA.Implementation.Visual.Toolbar.DeleteItem}]}.call(this),function(){"use strict";var t=this.Brightics;function e(t){for(var e in this.cache={},this.labelMap={},this.subflowMap={},this.launchOptions=t,this.launchOptions.originalModels){var o=this.launchOptions.originalModels[e];this.labelMap[o.mid]=o.title,this._scanFunctions(o.mid,o)}}e.prototype._scanFunctions=function(t,e,o){for(var i in e.functions){var n=e.functions[i],a=t+"_"+n.fid;if(this.labelMap[a]=n.display.label,"Subflow"==n[FUNCTION_NAME]&&n.param.functions.length>0){var r={fid:n.fid,first:n.param.functions[0].fid,last:n.param.functions[n.param.functions.length-1].fid};for(var s in n.param.functions){var l=n.param.functions[s];this.subflowMap[t+"_"+l.fid]=r}}else n.param.functions&&this._scanFunctions(t,n.param,n.fid)}},e.prototype.createUnitEvent=function(t,e,o,i){var n,a=[];return(n=this._createUnitStartEvent(t,e,o,i))&&a.push(n),(n=this._createUnitEndEvent(t,e,o,i))&&a.push(n),a},e.prototype._createUnitStartEvent=function(t,e,o,i){if(this.cache[t]&&!(o.fid.indexOf("internal_function")>-1)){var n,a=o.fid,r=this.subflowMap[e+"_"+o.fid];if(n=r?a=r.fid:a+"@"+i,"WAIT"!==o.status&&!this.cache[t][n]){let r={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:a,status:"PROCESSING",label:this.labelMap[e+"_"+a],begin:o.begin,message:o.message,sequence:i};return o.fid.indexOf("read_alluxio_pagination")>-1?r.label="(read)":o.fid.indexOf("write_alluxio_pagination")>-1&&(r.label="(write)"),this.cache[t][n]={event:r},r}if(this.cache[t][n]&&(this.cache[t][n].event.begin!=o.begin||"SUCCESS"==this.cache[t][n].event.status)){let r={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:a,status:"PROCESSING",label:this.labelMap[e+"_"+a],begin:o.begin,message:o.message,sequence:i};return o.fid.indexOf("read_alluxio_pagination")>-1?r.label="(read)":o.fid.indexOf("write_alluxio_pagination")>-1&&(r.label="(write)"),this.cache[t][n]={event:r},r}if(this.cache[t][n]&&(this.cache[t][n].event.begin!=o.begin||"PROCESSING"==this.cache[t][n].event.status)){let r={eventType:"UPDATE-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:a,status:"PROCESSING",label:this.labelMap[e+"_"+a],begin:o.begin,message:o.message,sequence:i};return o.fid.indexOf("read_alluxio_pagination")>-1?r.label="(read)":o.fid.indexOf("write_alluxio_pagination")>-1&&(r.label="(write)"),this.cache[t][n]={event:r},r}if(this.cache[t][n]&&(this.cache[t][n].event.begin!=o.begin||"SUCCESS"==this.cache[t][n].event.status)){let r={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:a,status:"PROCESSING",label:this.labelMap[e+"_"+a],begin:o.begin,sequence:i};return o.fid.indexOf("read_alluxio_pagination")>-1?r.label="(read)":o.fid.indexOf("write_alluxio_pagination")>-1&&(r.label="(write)"),this.cache[t][n]={event:r},r}if(this.cache[t][n]&&(this.cache[t][n].event.begin!=o.begin||"SUCCESS"==this.cache[t][n].event.status)){var s={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:a,status:"PROCESSING",label:this.labelMap[e+"_"+a],begin:o.begin,sequence:i};return o.fid.indexOf("read_alluxio_pagination")>-1?s.label="(read)":o.fid.indexOf("write_alluxio_pagination")>-1&&(s.label="(write)"),this.cache[t][n]={event:s},s}}},e.prototype._createUnitEndEvent=function(t,e,o,i){var n,a=o.fid,r=this.subflowMap[e+"_"+o.fid];if(n=r?a=r.fid:a+"@"+i,this.cache[t]&&this.cache[t][n]&&"PROCESSING"==this.cache[t][n].event.status&&this.cache[t][n].event.status!=o.status)return this.cache[t][n].event.status=o.status,{eventType:"END-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:a,status:o.status,label:this.labelMap[e+"_"+a],begin:o.begin,end:o.end,message:o.message,sequence:i}},e.prototype.createProcessEvent=function(t,e,o,i,n,a){var r,s=[];return(r=this._createProcessStartEvent(t,e,o,a))&&s.push(r),(r=this._createProcessEndEvent(t,e,o,i,n))&&s.push(r),s},e.prototype._createProcessStartEvent=function(t,e,o,i){if(!(e.indexOf("internal_process")>-1||this.cache[t]&&"0"==i)){var n={eventType:"BEGIN-PROCESS",launchOptions:this.launchOptions,pid:t,mid:e,label:this.labelMap[e],status:"PROCESSING",begin:o};return this.cache[t]={mid:n.mid,status:n.status},n}},e.prototype._createProcessEndEvent=function(t,e,o,i,n){if(this.cache[t]&&"PROCESSING"==this.cache[t].status&&this.cache[t].status!=n)return{eventType:"END-PROCESS",launchOptions:this.launchOptions,pid:t,mid:e,label:this.labelMap[e],status:n,begin:o,end:i}},t.VA.Implementation.Visual.EventDetector=e}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.JobDelegator.call(this,e),this.runnable=null,this._abort=!1}e.prototype=Object.create(t.VA.Core.JobDelegator.prototype),e.prototype.constructor=e,e.prototype._start=function(t,e){var o="api/va/v2/analytics/jobs/execute";e.publish&&(o="publish/jobs/execute");var i={url:o,type:"POST",blocking:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(Object.assign(e.publish?{user:e.user}:{},t))};return Promise.resolve($.ajax(i)).then(function(t){return JSON.parse(t)})},e.prototype._stop=function(t){var e={url:"api/va/v2/analytics/jobs/"+this.runnable.jid+"/delete",type:"POST",blocking:!1,contentType:"application/json; charset=utf-8"};if(t){var o={type:t};e.data=JSON.stringify(o)}return $.ajax(e)},e.prototype._check=function(t,e){var o="api/va/v2/analytics/jobs/"+t;e.publish&&(o="publish/jobs/"+t);var i={url:o,blocking:!1,type:"GET"};return $.ajax(i)},e.prototype._scheduleCheckStatus=function(t,e){var o=this,i=function(){o._check(t,e).done(function(t){o._abort?o._fireAbort({jobId:o.runnable.jid,end:Date.now(),status:"ABORT",message:"Job aborted by user"}):"FAIL"===t.status?o._fireFail(t):"SUCCESS"===t.status?o._fireSuccess(t):"WAIT"===t.status?(o._firePending(t),setTimeout(i,3e3)):(o._fireStatus(t),setTimeout(i,3e3))}).fail(o._fireCatch.bind(o))};setTimeout(i,2e3)},e.prototype.start=function(t,e){var o=this;return this.runnable=t,this._start(t,e).then(function(t){return o._scheduleCheckStatus(t.result,e),t},o._fireCatch.bind(o))},e.prototype.stop=function(t){this._stop(t),this._abort=!0},t.VA.Implementation.Visual.Job=e}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.ModelLauncher.call(this)}e.prototype=Object.create(t.VA.Core.ModelLauncher.prototype),e.prototype.constructor=e,e.prototype.launchUnit=function(e,o,i,n){var a={mode:"unit",clazz:t.VA.Implementation.Visual.Clazz,expectedUnitCount:1,originalModels:[{mid:i.mid||e.parent().mid,title:e.parent().title,type:t.VA.Implementation.Visual.Clazz,functions:[$.extend(!0,{},e)],getFnUnitById:function(){}}],runnable:this._createUnitRunnable(e,o,i)};this._launch(a,i,n)},e.prototype._createUnitRunnable=function(e,o,i){var n=this._generateJobId(e.fid),a=i.user||t.VA.Env.Session.userId,r=t.VA.Core.Utils.RunnableFactory._create(n,a),s=$.extend(!0,{},e);t.VA.Core.Utils.ModelUtils.carvePersist(s,i.persist||!1),t.VA.Core.Utils.ModelUtils.deleteDisplay(s),t.VA.Core.Utils.ModelUtils.deleteEmptyArray(s);var l=i.mid||e.parent().mid;if(r.main=l,r.models[l]={mid:l,type:"data",functions:[s],links:[],entries:[s.fid]},r.version=t.VA.Env.CoreVersion,"SQLExecutor"===s.name){var c={title:"SQL Query Executor",mid:l,type:"script",functions:[{func:"sql",name:"SQL",param:{script:"select\n\t*\nfrom\n\t#{DF0000}",limit:"1000",alias:{"#{DF0000}":"/"+a+"/"+l+"/"+s.outData}},fid:s.fid,label:s.display.label}],entries:[s.fid],links:[]};r.models[l]=c}return r},e.prototype.launchModel=function(e,o,i,n){var a=e.mid,r=this._generateJobId(a),s=t.VA.Env.Session.userId,l={mode:"workflow",clazz:t.VA.Implementation.Visual.Clazz,originalModels:[e],runnable:t.VA.Core.Utils.RunnableFactory.createForFlow(e,r,s,o,i)},c=l.runnable.models;for(var p in l.runnable.models){c[p].type="data";for(var d=c[p].functions,h=d.length-1;h>=0;h--)"Empty"===d[h][FUNCTION_NAME]&&d.splice(h,1);for(var u=0;u<d.length-1;u++)c[p].links.push({sourceFid:d[u].fid,targetFid:d[u+1].fid});c[p].entries=[c[p].entries[0]],l.expectedUnitCount=d.length}this._launch(l,i,n)},e.prototype._launch=function(e,o,i){var n=this,a=new t.VA.Implementation.Visual.EventDetector(e),r=function(t){for(var e in t.processes){var i=t.processes[e],r=i.pid||"pid_undefined",s=i.mid,l=a.createProcessEvent(r,s,i.begin,i.end,i.status);for(var c in i.functions){var p=i.functions[c];"PROCESSING"==p.status&&(n.processingUnit=p),l=l.concat(a.createUnitEvent(r,s,p,c))}for(var d in l)l[d].originalResponse=t;o.hideDialog||n._fireEvents(l)}},s=function(t){var i={eventType:"END-JOB",jid:t.jobId,message:t.message,status:t.status,launchOptions:e,originalResponse:t};o.hideDialog||n._fireEvents([i]),delete n.jobScheduler[t.jobId]},l={status:[function(t){r(t)}],success:[function(t){r(t),s(t)}],abort:[function(t){s(t)}],fail:[function(t){r(t),s(t)}],pending:[function(t){!function(t){var i={eventType:"PENDING-JOB",jid:t.jobId,message:n._getPendingMessage(t),status:t.status,launchOptions:e,originalResponse:t};o&&o.hideDialog||n._fireEvents([i])}(t)}],catch:[function(t){s({jobId:e.runnable.jid,status:"FAIL",exception:t})}]};this._extendListeners(l,i);var c=new t.VA.Implementation.Visual.Job(l);c.start(e.runnable,o).then(function(t){n.jobScheduler[t.result]=c;var i={eventType:"BEGIN-JOB",jid:t.result,status:"WAIT",launchOptions:e};o&&o.hideDialog||n._fireEvents([i])})},t.VA.Implementation.Visual.VisualModelLauncher=e;var o=null;t.VA.Implementation.Visual.VisualModelLauncher.instance=function(){return null==o&&(o=new t.VA.Implementation.Visual.VisualModelLauncher),o}}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils;function o(e,o){o.setContents(t.VA.Core.Utils.ModelUtils.extendModel(o.getContents())),this.parentId=e,this.options={width:"100%",height:"100%",clazz:"visual",editorInput:o},t.VA.Implementation.Visual.Editor.call(this,this.parentId,this.options)}o.prototype=Object.create(t.VA.Implementation.Visual.Editor.prototype),o.prototype.constructor=o,o.prototype.retrieveParent=function(){this.$parent=e.WidgetUtils.retrieveWidget(this.parentId)},o.prototype.createCommandManager=function(){this.commandManager=new t.VA.Core.CommandManager(this.options.editorInput.getContents())},o.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-visualeditor brtc-va-editor brtc-style-editor">   <div class="brtc-style-editor-toolbar-area brtc-style-s-editor-toolbar-area" />   <div class="brtc-style-editor-diagram-area brtc-style-editor-diagram-area-publish" /></div>'),this.$mainControl.css({width:"100%",height:"100%"}),this.$parent.append(this.$mainControl),t.VA.Core.Utils.WidgetUtils.putEditorRef(this.$mainControl,this),this.createDiagramEditorPage(this.$mainControl.find(".brtc-style-editor-diagram-area")),this.removeToolbar(this.$mainControl)},o.prototype.removeToolbar=function(t){t.find(".brtc-style-editor-toolitem[item-type=add-page]").css({display:"none"}),t.find(".brtc-style-editor-toolitem[item-type=delete-page]").css({display:"none"}),t.find(".brtc-va-content-remove-button").css({display:"none"})},t.VA.Implementation.Visual.PublishReportManagement=o}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.initOptions(e),this.retrieveParent(),this.createControls(),this.initPages(),this.initContent()}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.initOptions=function(e){var o=this,i={url:"publish/"+(e=$.extend(!0,{},e)).publishId,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),async:!1};$.ajax(i).done(function(i){t.VA.Env.Session.userId=i.userId;var n=i.reportContent;for(var a in n.contents.functions)n.contents.functions[a]=$.extend(!0,{display:{label:""}},n.contents.functions[a]);if(e.contents=t.VA.Core.Utils.ModelUtils.extendModel(n.contents),!t.VA.Core.Utils.CommonUtils.isPC()){var r=$.extend(!0,[],e.contents.report.pages);e.contents.report.pages=o.makeMobilePage(r)}e.contents.preference&&new window.Brightics.VA.Preference(e.contents.preference),o.options={width:"100%",height:"100%",clazz:"visual",editorInput:e.contents,publishId:e.publishId}})},e.prototype.getToolItem=function(){},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-visualeditor brtc-va-editor brtc-style-editor">       <div class="brtc-style-editor-visualeditorpage-paper-container" style="display: flex; flex-flow: wrap" /></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),t.VA.Core.Utils.WidgetUtils.putEditorRef(this.$mainControl,this),this.commandManager=new t.VA.Core.CommandManager(this.options.editorInput.getContents()),this.getPageContainer().perfectScrollbar()},e.prototype.initPages=function(){var e=this.options.editorInput.getPages();this.controls={};var o=this.getPageContainer();o.empty();for(var i=0;i<e.length;i++){var n=this.options.editorInput.getPageIndex(e[i].id);this.controls[e[i].id]=new t.VA.Implementation.Visual.Editors.Diagram.Figures.PaperUnit(o,{page:e[i],pageIndex:n,"background-color":this.options.editorInput.report.display.backgroundColor,publish:!0,publishId:this.options.publishId}),this.setPageView()}},e.prototype.setPageView=function(){var t=this.$mainControl.find(".brtc-va-visual-page");t.css("display","block"),t.css("position","relative"),this.$mainControl.find(".brtc-va-visual-content-toolitem-area").css({display:"none"})},e.prototype.initContent=function(){for(var e=this.options.editorInput.getPages(),o=0;o<e.length;o++)this.controls[e[o].id].render();this.controls[e[0].id].$mainControl.focus(),t.VA.Core.Utils.CommonUtils.isPC()||(this.$mainControl.find(".brtc-style-editor-visualeditorpage-paper-container").css("display","block"),this.$mainControl.find(".brtc-va-visual-page").css("margin","auto")),this.$mainControl.find(".brtc-style-editor-visualeditorpage-paper-container").scrollTop(0)},e.prototype.registerSelectableEventListener=function(){this.setSelection([this.options.editorInput.getPages()[0].id])},e.prototype.registerContentEventListener=function(){var t=this;this.getPageContainer().bind("loadComplete",function(e,o){var i=t.controls[o.pageId].$mainControl,n=i.clone(),a=i.find("canvas"),r=n.find("canvas");setTimeout(function(){for(var t=0;t<a.length;t++){var e=a[t],o=r[t];o.getContext("2d").drawImage(e,0,0,o.width,o.height)}},1e3)})},e.prototype.getPageContainer=function(){return this.$mainControl.find(".brtc-style-editor-visualeditorpage-paper-container")},e.prototype.getCommandManager=function(){return this.commandManager},e.prototype.addCommandListener=function(t){this.commandManager.registerCallback(t)},e.prototype.getModel=function(){return this.options.editorInput},e.prototype.makeMobilePage=function(t){var e=[],o=[];for(var i in t){var n=t[i].contents,a=[];for(var r in n)a.push({key:r,obj:n[r]});a.sort(function(t,e){return t.obj.position.top<e.obj.position.top?-1:t.obj.position.top>e.obj.position.top?1:0}),o=o.concat(a)}for(var s={},l=0;l<o.length;l++){var c=l%4;if(0===c){var p={id:"mobile-"+l,contents:{}};e.push(p),s=p}var d=o[l];d.obj.position.top=20+260*c,d.obj.position.left=40,d.obj.size.height="240px",d.obj.size.width="90%",s.contents[d.key]={},s.contents[d.key]=d.obj}return e},e.prototype.getContentOutlineStatus=function(){return!1},t.VA.Implementation.Visual.PublishReportView=e}.call(this),function(){"use strict";var t=this.Brightics.VA.Implementation.Visual,e=t.Clazz,o=this.Brightics.VA.Core.Interface;o.Clazz[e]=e,o.Label[e]=t.Label,o.Editor[e]=t.Editor,o.Toolbar[e]=t.Toolbar,o.DefaultModel[e]=t.defaultModel,o.Validator[e]=t.Validator,o.SideBarManager[e]=t.Tools.Manager.SideBarManager,o.Launcher[e]=t.VisualModelLauncher,o.Functions[e]=t.Functions,o.ProjectContextMenuList[e]=["duplicate","export","version"],o.ModelLayoutManager[e]=t.ModelLayoutManager,o.RunnableFactory[e]=t.Utils.RunnableFactory}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.retrieveParent(),this.initOptions(e)}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId)},e.prototype.initOptions=function(e){var o=this;this._showProgress();var i={url:"api/va/v2/ws/projects/"+e.pid+"/files/"+e.mid,type:"GET",contentType:"application/json; charset=utf-8",blocking:!0};$.ajax(i).done(function(e){o._hideProgress();var i=new t.VA.Core.Tools.ModelMigrator.Executor,n=e[0];if(n){i.migrate(n.contents);var a=t.VA.Core.Utils.ModelUtils.extendModel(n.contents);o.options={width:"100%",height:"100%",clazz:"visual",editorInput:a},o.createControls(),o.initPages(),o.initContent()}else alert("Could not found model.")}).fail(function(t){})},e.prototype.getToolItem=function(){},e.prototype.createControls=function(){var e=this;this.$mainControl=$('<div class="brtc-va-editors-visualeditor brtc-va-editor brtc-style-editor">   <button type="button" class="brtc-va-editor-visualeditor-export-pdf-button" title="Download PDF" value="Download PDF">Print PDF</button>       <div class="brtc-style-editor-visualeditorpage-export-pdf-paper-container" /></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$mainControl.find(".brtc-va-editor-visualeditor-export-pdf-button").jqxButton({theme:t.VA.Env.Theme,height:31}),t.VA.Core.Utils.WidgetUtils.putEditorRef(this.$mainControl,this),this.commandManager=new t.VA.Core.CommandManager(this.options.editorInput.contents),this.$mainControl.find(".brtc-va-editor-visualeditor-export-pdf-button").click(function(){var t=e.$mainControl.find(".brtc-va-editors-visualeditor-page-wrapper-splitter");for(let e=0;e<t.length;e++)$(t[e]).addClass("hide-splitter");window.print();for(let e=0;e<t.length;e++)$(t[e]).removeClass("hide-splitter")}),this.$mainControl.perfectScrollbar()},e.prototype.initPages=function(){var e=this.options.editorInput.getPages();this.controls={};var o=this.getPageContainer();o.empty();for(var i=0;i<e.length;i++){var n=this.options.editorInput.getPageIndex(e[i].id),a=$('<div class="brtc-va-editors-visualeditor-page-wrapper-splitter"></div>'),r=$('<div class="brtc-va-editors-visualeditor-page-wrapper"></div>');o.append(a),o.append(r),this.controls[e[i].id]=new t.VA.Implementation.Visual.Editors.Diagram.Figures.PaperUnit(r,{page:e[i],pageIndex:n,"background-color":this.options.editorInput.report.display.backgroundColor});var s=$(".brtc-va-visual-page")[i];"a4-horizontal"==s.getAttribute("page-type")?(s.style.height="793px",s.style.width="1122px",$("head").append('<style type="text/css"> @page{size:landscape;} .brtc-va-editors-visualeditor-page-wrapper,.brtc-va-visual-page-wrapper{height:793px} </style>')):"a4-vertical"==s.getAttribute("page-type")?(s.style.height="1122px",s.style.width="793px",$("head").append('<style type="text/css"> @page{size:A4;} .brtc-va-editors-visualeditor-page-wrapper,.brtc-va-visual-page-wrapper{height:1122px} </style>')):$(".brtc-va-editor-visualeditor-export-pdf-button").hide(),this.setPageView()}},e.prototype.setPageView=function(){var t=this.$mainControl.find(".brtc-va-visual-page");t.css("display","block"),t.css("position","relative"),this.$mainControl.find(".brtc-va-visual-content-toolitem-area").css({display:"none"})},e.prototype.initContent=function(){for(var t=this.options.editorInput.getPages(),e=0;e<t.length;e++)this.controls[t[e].id].render();this.controls[t[0].id].$mainControl.focus()},e.prototype.registerSelectableEventListener=function(){this.setSelection([this.options.editorInput.getPages()[0].id])},e.prototype.registerContentEventListener=function(){var t=this;this.getPageContainer().bind("loadComplete",function(e,o){var i=t.controls[o.pageId].$mainControl,n=i.clone(),a=i.find("canvas"),r=n.find("canvas");setTimeout(function(){for(var t=0;t<a.length;t++){var e=a[t],o=r[t];o.getContext("2d").drawImage(e,0,0,o.width,o.height)}},1e3)})},e.prototype.getPageContainer=function(){return this.$mainControl.find(".brtc-style-editor-visualeditorpage-export-pdf-paper-container")},e.prototype.getCommandManager=function(){return this.commandManager},e.prototype.addCommandListener=function(t){this.commandManager.registerCallback(t)},e.prototype.getModel=function(){return this.options.editorInput},e.prototype._hideProgress=function(){this.$parent.find(".brtc-va-progress").hide()},e.prototype._showProgress=function(){this.$parent.find(".brtc-va-progress").show()},e.prototype.getContentOutlineStatus=function(){return!1},t.VA.Implementation.Visual.ExportPDFView=e}.call(this);