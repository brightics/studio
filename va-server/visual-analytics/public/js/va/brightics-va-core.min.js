/*   Brightics VA Build 191105 */
/*   Brightics VA Build 191105 */
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 30);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return inherits; });
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 31
 */

/**
 * @param {Class} a sub class
 * @param {Class} b super class
 */
var inherits = function (subClass, superClass) {
    subClass.prototype = Object.create(superClass.prototype);
    subClass.prototype.constructor = subClass;
};




/***/ }),
/* 1 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return EventEmitter; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_event_emitter__ = __webpack_require__(32);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_event_emitter___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_event_emitter__);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 23
 */



'use strict';

function EventEmitter(listeners) {
    // a
}

__WEBPACK_IMPORTED_MODULE_0_event_emitter___default()(EventEmitter.prototype);




/***/ }),
/* 2 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return get; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return post; });
/* unused harmony export ajaxGetSync */
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return postSync; });
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 30
 */

/**
 * @param {Object} options 옵션
 * @return {Promise<Object>}
 */
var ajax2Promise = function (options) {
    return Promise.resolve($.ajax(options));
};

/**
 * 해당 URL로 GET 요청
 * @param {String} url 요청 url
 * @return {Promise<Object>}
 */
var get = function (url) {
    var options = {
        type: 'GET',
        url: url
    };
    return ajax2Promise(options);
};

/**
 * 해당 URL로 POST 요청
 * @param {String} url 요청url
 * @return {Promise<Object>}
 */
var post = function (url, data) {
    var options = {
        type: 'POST',
        data: JSON.stringify(data),
        contentType: 'application/json; charset=utf-8',
        url: url
    };
    return ajax2Promise(options);
};

var getSync = function (url) {
    var options = {
        type: 'GET',
        url: url,
        async: false
    };
    return ajax2Promise(options);
};

var postSync = function (url, data) {
    var options = {
        type: 'POST',
        data: JSON.stringify(data),
        contentType: 'application/json; charset=utf-8',
        url: url,
        async: false
    };
    return ajax2Promise(options);
};




/***/ }),
/* 3 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });

const CORE_VERSION = '3.6';
/* harmony export (immutable) */ __webpack_exports__["CORE_VERSION"] = CORE_VERSION;



/***/ }),
/* 4 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Base; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__src_event_emitter_event_emitter__ = __webpack_require__(1);
/**
 * hyunseok.oh@samsung.com
 * 2017. 01. 22
 */



function Base($el, options) {
    __WEBPACK_IMPORTED_MODULE_0__src_event_emitter_event_emitter__["a" /* EventEmitter */].call(this);
    this.$el = $el;
    this.options = options;
}

Base.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_0__src_event_emitter_event_emitter__["a" /* EventEmitter */].prototype);
Base.prototype.constructor = Base;

// 뭐 넣을지 몰라서 일단 아무거나 넣어봤음
Base.prototype.getParent = function () {
    return this.$el;
};

Base.prototype.getOptions = function () {
    return this.options;
};

Base.prototype.render = function () {
    throw new Error('not implemented');
};

Base.prototype.destroy = function () {
};




/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _undefined = __webpack_require__(44)(); // Support ES3 engines

module.exports = function (val) {
 return (val !== _undefined) && (val !== null);
};


/***/ }),
/* 6 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return File; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__adjust_vo__ = __webpack_require__(17);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__resource__ = __webpack_require__(7);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__src_utils_inherits__ = __webpack_require__(0);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 31
 */





function File(file) {
    this.data = file || {};
    if (this.data.update_time) {
        this.data.update_time = new Date(moment(this.data.update_time).format());
    }
    if (this.data.create_time) {
        this.data.create_time = new Date(moment(this.data.create_time).format());
    }
    if (this.data.contents) {
        Object(__WEBPACK_IMPORTED_MODULE_0__adjust_vo__["a" /* adjustFile */])(this.data);
        Object(__WEBPACK_IMPORTED_MODULE_0__adjust_vo__["c" /* migrate */])(this.data.contents);
    } else {
        this.data.contents = {};
    }
}

Object(__WEBPACK_IMPORTED_MODULE_2__src_utils_inherits__["a" /* inherits */])(File, __WEBPACK_IMPORTED_MODULE_1__resource__["a" /* Resource */]);

File.prototype.getFileId = function () {
    return this.data.id;
};

File.prototype.setFileId = function (id) {
    this.data.id = id;
    this.data.contents.mid = id;
    return this;
};

File.prototype.getDescription = function () {
    return this.data.description;
};

File.prototype.setDescription = function (description) {
    this.data.description = description;
    return this;
};

File.prototype.getType = function () {
    return this.data.type;
};

File.prototype.setType = function (type) {
    this.data.type = type;
    return this;
};

File.prototype.getEventKey = function () {
    return this.data.event_key;
};

File.prototype.setEventKey = function (event_key) {
    this.data.event_key = event_key;
    return this;
};

File.prototype.getLabel = function () {
    return this.data.label;
};

File.prototype.setLabel = function (label) {
    this.data.label = label;
    this.data.contents.title = label;
    return this;
};

File.prototype.getProjectId = function () {
    return this.data.project_id;
};

File.prototype.setProjectId = function (projectId) {
    this.data.project_id = projectId;
    return this;
};

File.prototype.getUpdateTime = function () {
    return new Date(this.data.update_time);
};

File.prototype.setUpdateTime = function (time) {
    this.data.update_time = time;
    return this;
};

File.prototype.getCreateTime = function () {
    return new Date(this.data.create_time);
};

File.prototype.setCreateTime = function (time) {
    this.data.create_time = time;
    return this;
};

File.prototype.getUpdater = function () {
    return this.data.updater;
};

File.prototype.setUpdater = function (updater) {
    this.data.updater = updater;
    return this;
};

File.prototype.getCreator = function () {
    return this.data.creator;
};

File.prototype.setCreator = function (creator) {
    this.data.creator = creator;
    return this;
};

File.prototype.getFromVersion = function () {
    return this.data.from_version;
};

File.prototype.setFromVersion = function (fromVersion) {
    this.data.from_version = fromVersion;
    return this;
};

File.prototype.getModelImage = function () {
    return this.data.model_image;
};

File.prototype.setModelImage = function (image) {
    this.data.model_image = image;
    return this;
};

File.prototype.setContents = function (contents) {
    this.data.contents = contents;
    this.data.contents.title = this.data.label;
    Object(__WEBPACK_IMPORTED_MODULE_0__adjust_vo__["a" /* adjustFile */])(this.data);
    Object(__WEBPACK_IMPORTED_MODULE_0__adjust_vo__["c" /* migrate */])(this.data.contents);
    return this;
};

File.prototype.getContents = function (contents) {
    return this.data.contents;
};

File.prototype.toJSON = function () {
    return this.data;
};

File.prototype.getHashCode = function () {
    return this.getFileId();
};

File.prototype.equals = function (that) {
    return this.getFileId() == that.getFileId() &&
        this.getEventKey() == that.getEventKey() &&
        Number(this.getUpdateTime()) == Number(that.getUpdateTime());
};

File.prototype.getResourceName = function () {
    return 'file';
};

File.prototype.getInnerModels = function () {
    return this.data.contents.innerModels;
};

File.prototype.getInnerModel = function (mid) {
    if (this.data.contents.innerModels) {
        return this.data.contents.innerModels[mid];
    }
    return undefined;
};

File.prototype.getParam = function () {
    return this.data.contents.param;
};

File.prototype.setParam = function (paramKey, paramValue) {
    this.data.contents.param[paramKey] = paramValue;
};





/***/ }),
/* 7 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Resource; });
/* -----------------------------------------------------
 *  resource.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-08
 * ----------------------------------------------------*/

function Resource() {

}

Resource.prototype.equals = function (that) {
    throw new Error('not implemented');
};

Resource.prototype.getHashCode = function () {
    throw new Error('not implemented');
};

Resource.prototype.toJSON = function () {
    throw new Error('not implemented');
};

Resource.prototype.getResourceName = function () {
    throw new Error('not implemented');
};




/***/ }),
/* 8 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return HashMap; });
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 31
 */


/* global _ */

function HashMap() {
    this.map = {};
    this.chk = {};
}

HashMap.prototype.set = function (key, value) {
    this.map[key] = value;
    this.chk[key] = true;
};

HashMap.prototype.get = function (key) {
    return this.map[key];
};

HashMap.prototype.remove = function (key) {
    var ret = this.map[key];
    this.chk[key] = false;
    delete this.map[key];
    return ret;
};

HashMap.prototype.has = function (key) {
    return this.chk[key];
};

HashMap.prototype.toArray = function () {
    return _.toArray(this.map);
};

HashMap.prototype.toJSON = function () {
    return this.map;
};




/***/ }),
/* 9 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return serial; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return parallel; });
/* -----------------------------------------------------
 *  promise-utils.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-14.
 * ----------------------------------------------------*/

/* global _ */
var serial = function (fnArray) {
    return _.reduce(fnArray, function (prv, cur) {
        return prv.then(function (param) {
            return cur(param);
        });
    }, Promise.resolve());
};


var parallel = function (fnArray) {
    // fn = 프로미스를 리턴하는 함수
    return Promise.all(_.map(fnArray, function (fn) {
        return fn();
    }));
};




/***/ }),
/* 10 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__project__ = __webpack_require__(19);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__file__ = __webpack_require__(6);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__version__ = __webpack_require__(21);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__model_prop_key__ = __webpack_require__(66);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return __WEBPACK_IMPORTED_MODULE_0__project__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return __WEBPACK_IMPORTED_MODULE_1__file__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "d", function() { return __WEBPACK_IMPORTED_MODULE_2__version__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return __WEBPACK_IMPORTED_MODULE_3__model_prop_key__["a"]; });








/***/ }),
/* 11 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ListWrapper; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_base__ = __webpack_require__(4);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 22
 */






function ListWrapper($el, options) {
    __WEBPACK_IMPORTED_MODULE_0__base_base__["a" /* Base */].call(this, $el, options);
}

ListWrapper.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_0__base_base__["a" /* Base */].prototype);
ListWrapper.prototype.constructor = ListWrapper;

ListWrapper.prototype.update = function (data) {
    throw new Error('not implemented');
};




/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


// ES3 safe
var _undefined = void 0;

module.exports = function (value) { return value !== _undefined && value !== null; };


/***/ }),
/* 13 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return JqxListWrapper; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__listwrapper__ = __webpack_require__(11);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 22
 */

/* global _, moment */



'use strict';

const CLASS_GRID_CELL = 'brtc-va-base-list-grid-cell';
// var CLASS_BUTTON = 'brtc-va-base-list-button';
// var CLASS_BUTTON_WRAPPER = 'brtc-va-base-list-button-wrapper';
const CLASS_COLUMN_HEADER = 'brtc-va-base-list-column-header';
const EVENT_CELL_CLICK = 'cell-click';
const EVENT_ROW_SELECT = 'row-select';
const EVENT_ROW_UNSELECT = 'row-unselect';
const KEY_ATTRIBUTE = '__key__';


function JqxListWrapper($el, options) {
    __WEBPACK_IMPORTED_MODULE_0__listwrapper__["a" /* ListWrapper */].call(this, $el, options);
    // selectable
    // sortable
    // columnResizable
    // width
    // height
    // columns
    // data
    // rowsHeight
    this.listeners = {};
    this.jqxOptions = this._brtcOptions2jqxOptions(this.options);
    this.keyIndex = 0;
    // this.render();
}

JqxListWrapper.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_0__listwrapper__["a" /* ListWrapper */].prototype);
JqxListWrapper.prototype.constructor = JqxListWrapper;

JqxListWrapper.prototype.update = function (data) {
    this.source.localdata = data;
    this.$content.jqxGrid('updatebounddata');
    if (this.options.selectable) this.$content.jqxGrid('clearselection');
};

JqxListWrapper.prototype.render = function () {
    this.$template = $([
        '<div class="brtc-va-base-list">',
        '  <div class="brtc-va-base-list-wrapper">',
        '    <div class="brtc-va-base-list-content">',
        '    </div>',
        '  </div>',
        '</div>'
    ].join('\n'));
    this.$wrapper = this.$template.find('.brtc-va-base-list-wrapper');
    this.$wrapper.perfectScrollbar();
    this.$content = this.$template.find('.brtc-va-base-list-content');
    this._registerAllListeners(this.listeners);
    this.$content.jqxGrid(this.jqxOptions);
    // this.$el.empty();
    this.$el.empty();
    this.$el.append(this.$template);
    this._initEventListeners();
    return this;
};

JqxListWrapper.prototype.destroy = function () {
    this.$content.jqxGrid('destroy');
};

JqxListWrapper.prototype._brtcOptions2jqxOptions = function (options) {
    var resultOptions = {};

    resultOptions.theme = 'office';
    resultOptions.sortable = options.sortable || false;
    resultOptions.selectionmode = options.selectable ? 'checkbox' : 'none';
    resultOptions.columnsresize = false;
    resultOptions.filterable = false;
    resultOptions.altrows = false;
    resultOptions.showfiltercolumnbackground = false;
    resultOptions.rowsheight = options.rowsHeight || 53;
    resultOptions.columnsheight = options.rowsHeight || 53;
    resultOptions.enabletooltips = true;
    resultOptions.width = options.width || 'auto';
    resultOptions.height = options.height || 'auto';
    this.source = this._getSource(options.columns);
    resultOptions.source = new $.jqx.dataAdapter(this.source);
    if (options.data && options.data.length) {
        resultOptions.source.localdata = options.data;
    }

    resultOptions.columns = this._getJqxGridColumnsOption(options.columns);
    return resultOptions;
};

JqxListWrapper.prototype._getSource = function (columns) {
    var source = {localdata: [], datatype: 'array'};
    source.datafileds = _.map(columns, function (column) {
        return {
            name: column.key,
            type: column.type || 'string'
        };
    });
    return source;
};

JqxListWrapper.prototype._getJqxGridColumnsOption = function (columns) {
    var defaultOptions = {
        cellclassname: CLASS_GRID_CELL,
        renderer: this._getDefaultHeaderRenderer()
    };

    var ret = _.map(columns,
        function (column) {
            if (column.key) {
                var ret = {
                    text: column.name,
                    datafield: column.key,
                    width: column.width || 'auto',
                    align: column.headerAlign || 'center',
                    cellsalign: column.dataAlign || 'center',
                    cellsrenderer: column.dataRenderer ?
                        this._getGenerativeRenderer(column.dataAlign, column.dataRenderer) :
                        this._getDefaultDataRenderer(column.type, column.dataAlign)
                };
                return _.extend({}, defaultOptions, ret);
            }
        }.bind(this));

    return ret;
};

JqxListWrapper.prototype._getDefaultHeaderRenderer = function () {
    return function (value) {
        return '<div class="' + CLASS_COLUMN_HEADER + '">' + _.escape(value) + '</div>';
    };
};

JqxListWrapper.prototype._getDefaultDataRenderer = function (type, align) {
    var classList = [this._getAlignClass(align)].join(' ');
    return function (row, datafield, value) {
        return this._wrap('<div>' + _.escape(this._format(value, type)) + '</div>', classList);
    }.bind(this);
};

JqxListWrapper.prototype._getAlignClass = function (_align) {
    var align = _align || 'center';
    var alignClassMap = {
        left: 'brtc-va-base-list-grid-cell-flex-left',
        center: 'brtc-va-base-list-grid-cell-flex-center',
        right: 'brtc-va-base-list-grid-cell-flex-right'
    };
    return alignClassMap[align];
};

JqxListWrapper.prototype._getGenerativeRenderer = function (align, render) {
    var classList = [this._getAlignClass(align)].join(' ');
    return function (row, datafield, value) {
        var $elem = render(row, value);
        return this._wrap(this._getHtmlWithEventHandler($elem, row), classList);
    }.bind(this);
};

JqxListWrapper.prototype._getHtmlWithEventHandler = function ($elem, rowIndex) {
    var data = this.source.localdata[rowIndex];
    var index = rowIndex;
    var registerEventHandler = function (elem) {
        var eventHandlers = $._data(elem, 'events');
        _.forOwn(eventHandlers, function (handlers, eventName) {
            var key = this._genHandlerKey();
            var fns = function (evt) {
                _.forEach(handlers, function (fn) {
                    fn.handler(evt);
                });
            };
            this.listeners[eventName] = this.listeners[eventName] || {};
            this.listeners[eventName][key] = {
                fn: fns,
                data: data,
                index: index
            };
            elem.setAttribute(eventName + KEY_ATTRIBUTE, key);
        }.bind(this));
    }.bind(this);

    var go = function (node) {
        var children = node.children;
        registerEventHandler(node);
        _.forEach(children, function (child) {
            registerEventHandler(child);
            go(child);
        });
    };
    go($elem[0]);
    return $elem[0].outerHTML;
};

JqxListWrapper.prototype._wrap = function (inner, classList) {
    return [
        '<div class="' + classList + '">',
        inner,
        '</div>'
    ].join('');
};

JqxListWrapper.prototype._format = function (_value, _type) {
    var type = _type || 'string';
    var value = _value || '';
    if (type == 'date' && value) {
        return moment(value).format('YYYY-MM-DD HH:mm:ss');
    }
    return value;
};

JqxListWrapper.prototype._genHandlerKey = function () {
    return parseInt(++this.keyIndex);
};

JqxListWrapper.prototype._initEventListeners = function (allListeners) {
    this.$content.on('cellclick', function (evt) {
        if (evt.args.originalEvent && evt.args.originalEvent.cancel) return false;
        if (evt.args.datafield == '_checkboxcolumn') return false;
        this.emit(EVENT_CELL_CLICK, {
            data: this.source.localdata[evt.args.rowindex],
            index: evt.args.rowindex
        });
        return true;
    }.bind(this));
    this.$content.on('rowselect', function (evt) {
        if (evt.args.originalEvent && evt.args.originalEvent.cancel) return false;
        this.emit(EVENT_ROW_SELECT, {
            data: this.source.localdata[evt.args.rowindex],
            index: evt.args.rowindex
        });
        return true;
    }.bind(this));
    this.$content.on('rowunselect', function (evt) {
        if (evt.args.originalEvent && evt.args.originalEvent.cancel) return false;
        this.emit(EVENT_ROW_UNSELECT, {
            data: this.source.localdata[evt.args.rowindex],
            index: evt.args.rowindex
        });
        return true;
    }.bind(this));
};

JqxListWrapper.prototype._registerAllListeners = function (allListeners) {
    var $content = this.$content;
    // var eventNames = _.keys(allListeners);
    // 밖으로 빼야할듯.. + 일단 임시로 이벤트 몇개만
    var eventNames = [
        'mousedown',
        'click',
        'change',
        'dblclick',
        'keydown',
        'keyup'
    ];

    _.forEach(eventNames, function (eventName) {
        $content.on(eventName, function (evt) {
            evt.preventDefault();
            evt.stopPropagation();
            var attrName = eventName + KEY_ATTRIBUTE;
            var originalEvent = evt.originalEvent || evt.args.originalEvent;
            var attrValue = originalEvent.target.getAttribute(attrName);
            if (allListeners[eventName] && allListeners[eventName][attrValue]) {
                evt.cancel = true;
                evt.data = allListeners[eventName][attrValue].data;
                evt.index = allListeners[eventName][attrValue].index;
                allListeners[eventName][attrValue].fn(evt);
            }
            return false;
        });
    });
};

JqxListWrapper.prototype.getSelectedRows = function () {
    var selectedRowIndexes = this.$content.jqxGrid('getselectedrowindexes');
    return _.map(selectedRowIndexes, function (index) {
        return this.source.localdata[index];
    }.bind(this));
};




/***/ }),
/* 14 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return DropdownWrapper; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__base_base__ = __webpack_require__(4);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 24
 */




function DropdownWrapper($el, options) {
    __WEBPACK_IMPORTED_MODULE_0__base_base__["a" /* Base */].call(this, $el, options);
}

DropdownWrapper.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_0__base_base__["a" /* Base */].prototype);
DropdownWrapper.prototype.constructor = DropdownWrapper;

DropdownWrapper.prototype.setItems = function (items) {
    throw new Error('not implemented');
};

DropdownWrapper.prototype.getItems = function () {
    throw new Error('not implemented');
};

DropdownWrapper.prototype.getSelectedItem = function () {
    throw new Error('not implemented');
};

DropdownWrapper.prototype.isSelected = function () {
    throw new Error('not implemented');
};

DropdownWrapper.prototype.isOpened = function () {
    throw new Error('not implemented');
};

DropdownWrapper.prototype.open = function () {
    throw new Error('not implemented');
};

DropdownWrapper.prototype.close = function () {
    throw new Error('not implemented');
};

DropdownWrapper.prototype.enable = function () {
    throw new Error('not implemented');
};

DropdownWrapper.prototype.disable = function () {
    throw new Error('not implemented');
};




/***/ }),
/* 15 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return JqxDropdownWrapper; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__dropdownwrapper__ = __webpack_require__(14);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 24
 */

/* global _ */



function JqxDropdownWrapper($el, options) {
    __WEBPACK_IMPORTED_MODULE_0__dropdownwrapper__["a" /* DropdownWrapper */].call(this, $el, options);
    // width
    // height
    // renderer
    // itemHeight
    // placeHolder
    // minHeight
    // maxHeight

    // @event
    // open
    // close
    // select
    this.jqxOptions = this._brtcOptions2jqxOptions(options);
    this._initEventListener();
}

JqxDropdownWrapper.prototype = Object.create(__WEBPACK_IMPORTED_MODULE_0__dropdownwrapper__["a" /* DropdownWrapper */].prototype);
JqxDropdownWrapper.prototype.constructor = JqxDropdownWrapper;

JqxDropdownWrapper.prototype._initEventListener = function () {
    this.$el.on('open', function (evt) {
        this.emit('open', evt);
    }.bind(this));

    this.$el.on('close', function (evt) {
        this.emit('close', evt);
    }.bind(this));

    this.$el.on('select', function (evt) {
        this.emit('select', evt);
    }.bind(this));
};

JqxDropdownWrapper.prototype._getAutoDropDownHeight = function (options) {
    if (options.itemHeight * options.source.length > options.dropDownHeight) {
        return false;
    }
    return true;
};

JqxDropdownWrapper.prototype._brtcOptions2jqxOptions = function (options) {
    var resultOptions = {};

    resultOptions.theme = 'office';
    resultOptions.width = options.width || '100%';
    resultOptions.itemHeight = options.itemHeight || 30;
    resultOptions.height = resultOptions.itemHeight;
    resultOptions.dropDownHeight = options.height || 300;
    this.renderer = this._getRenderer(options.renderer);
    resultOptions.placeHolder = typeof options.placeHolder !== 'undefined' ?
        options.placeHolder : 'choose';
    this.data = options.data || [];
    resultOptions.source = this._getRenderedData(this.data);
    resultOptions.autoDropDownHeight = this._getAutoDropDownHeight(resultOptions);
    return resultOptions;
};

JqxDropdownWrapper.prototype._getRenderer = function (renderer) {
    return renderer || function (val) {
        return val;
    };
};

JqxDropdownWrapper.prototype._getRenderedData = function (data) {
    return _.map(data, this.renderer);
};

JqxDropdownWrapper.prototype.render = function () {
    this.$el.jqxDropDownList(this.jqxOptions);
    return this;
};

JqxDropdownWrapper.prototype.setItems = function (items) {
    this.data = items;
    this.jqxOptions.source = this._getRenderedData(this.data);
    this.jqxOptions.autoDropDownHeight = this._getAutoDropDownHeight(this.jqxOptions);
    this.$el.jqxDropDownList({ source: this.jqxOptions.source });
    return this;
};

JqxDropdownWrapper.prototype.getItems = function () {
    return this.data;
};

JqxDropdownWrapper.prototype.getSelectedItem = function () {
    if (!this.isSelected()) {
        throw new Error('not selected');
    }
    return this.data[this.$el.jqxDropDownList('selectedIndex')];
};

JqxDropdownWrapper.prototype.isSelected = function () {
    return this.$el.jqxDropDownList('selectedIndex') > -1;
};

JqxDropdownWrapper.prototype.isOpened = function () {
    return this.$el.jqxDropDownList('isOpened');
};

JqxDropdownWrapper.prototype.open = function () {
    this.$el.jqxDropDownList('open');
    return this;
};

JqxDropdownWrapper.prototype.close = function () {
    this.$el.jqxDropDownList('close');
    return this;
};

JqxDropdownWrapper.prototype.enable = function () {
    this.$el.jqxDropDownList({ disabled: false });
    return this;
};

JqxDropdownWrapper.prototype.disable = function () {
    this.$el.jqxDropDownList({ disabled: true });
    return this;
};

JqxDropdownWrapper.prototype.focus = function () {
    this.$el.jqxDropDownList('focus');
    return this;
};




/***/ }),
/* 16 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return FileDao; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__vomodels_file__ = __webpack_require__(6);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_object_hash__ = __webpack_require__(53);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_object_hash___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_object_hash__);




/* global _ */

const { map, compact, first, flow } = _;

const toFileVo = (json) => {
    try {
        var file = new __WEBPACK_IMPORTED_MODULE_1__vomodels_file__["a" /* File */](json);
        return file;
    } catch (e) {
        console.warn('Some files are ignored.');
        return undefined;
    }
};

const toFileVoEach = (jsonArray) => compact(map(jsonArray, toFileVo));
const getFirstFile = flow(first, toFileVo);

/**
 * 프로젝트 리스트 가져옴
 * @return {Promise<Array<File>>}
 */
function getFiles(projectId) {
    const url = `api/va/v2/ws/projects/${projectId}/files`;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url).then(toFileVoEach);
}

function getFile(projectId, fileId) {
    const url = `api/va/v2/ws/projects/${projectId}/files/${fileId}`;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url).then((file) => file.length ? getFirstFile(file) : null);
}

function addFile(projectId, file) {
    const url = `api/va/v2/ws/projects/${projectId}/files`;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, file.toJSON());
}

function updateFile(projectId, file) {
    const url = `api/va/v2/ws/projects/${projectId}/files/${file.getFileId()}/update`;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, file.toJSON()).then(getFirstFile);
}

function updateFileSync(projectId, file) {
    const url = `api/va/v2/ws/projects/${projectId}/files/${file.getFileId()}/update`;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["c" /* ajaxPostSync */])(url, file.toJSON()).then(getFirstFile);
}

function deleteFile(projectId, fileId) {
    const url = `api/va/v2/ws/projects/${projectId}/files/${fileId}/delete`;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url);
}

function saveFileSync(projectId, file, modelDiff) {
    const url = `api/va/v2/ws/projects/${projectId}/files/${file.getFileId()}/save`;

    const normalize = (x) => JSON.parse(JSON.stringify(x));
    const contents = normalize(file.getContents());
    const opt = Object.assign(_.omit(file.toJSON(), 'contents'), {
        modelDiff,
        hash: __WEBPACK_IMPORTED_MODULE_2_object_hash___default()(contents, {
            respectFunctionProperties: false,
            respectFunctionNames: false,
            respectType: false,
        }),
    });

    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["c" /* ajaxPostSync */])(url, opt).then(first);
}

const FileDao = {
    getFiles: getFiles,
    getFile: getFile,
    addFile: addFile,
    updateFile: updateFile,
    updateFileSync: updateFileSync,
    deleteFile: deleteFile,
    saveFileSync: saveFileSync,
};




/***/ }),
/* 17 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return adjustFile; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return adjustVersion; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return migrate; });
/* -----------------------------------------------------
 *  adjust-vo.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-07
 * ----------------------------------------------------*/

/* global Brightics */

var adjustFile = function (file) {
    file.contents = Brightics.VA.Core.Utils.ModelUtils.extendModel(file.contents);
    var supportModelList = Object.keys(Brightics.VA.Core.Interface.Clazz);
    if (typeof file !== 'undefined') {
        if (supportModelList.indexOf(file.contents.type) < 0) return;
    }
    file.contents.title = file.label;
    file.contents.mid = file.id;
    file.contents.adjustLinks();
};

var adjustVersion = function (version) {
    version.contents = Brightics.VA.Core.Utils.ModelUtils.extendModel(version.contents);
    var supportModelList = Object.keys(Brightics.VA.Core.Interface.Clazz);
    if (typeof file !== 'undefined') {
        if (supportModelList.indexOf(version.contents.type) < 0) return;
    }
    version.contents.title = version.label;
    version.contents.mid = version.file_id;
    version.contents.version_id = version.version_id;
    version.contents.adjustLinks();
};

var migrator = 0;
var migrate = function (model) {
    migrator = migrator || new Brightics.VA.Core.Tools.ModelMigrator.Executor();
    try {
        migrator.migrate(model);
    } catch (e) {
        console.error(e);
        throw new Error('Migration failed.');
    }
};




/***/ }),
/* 18 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ProjectDao; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__vomodels_project__ = __webpack_require__(19);



/* global _ */

var transform = function (json) {
    return new __WEBPACK_IMPORTED_MODULE_1__vomodels_project__["a" /* Project */](json);
};

var transformEach = function (jsonArray) {
    return _.map(jsonArray, transform);
};

/**
 * 프로젝트 리스트 가져옴
 * @return {Promise<Array<Project>>}
 */
var getProjects = function () {
    var url = 'api/va/v2/ws/projects';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url).then(transformEach);
};

var getProject = function (projectId) {
    var url = 'api/va/v2/ws/projects/' + projectId;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url).then(function (projects) {
        return transform(projects[0]);
    });
};

var addProject = function (project) {
    var url = 'api/va/v2/ws/projects';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, project.toJSON()).then(transform);
};

var updateProject = function (project) {
    // var url = 'api/va/v2/ws/projects/' + project.getProjectId() + '/update';
    var url = 'api/va/v2/ws/projects/' + project.getProjectId() + '/update';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, project.toJSON()).then(transform);
};

var deleteProject = function (projectId) {
    var url = 'api/va/v2/ws/projects/' + projectId + '/delete';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url);
};

var ProjectDao = {
    getProjects: getProjects,
    getProject: getProject,
    addProject: addProject,
    updateProject: updateProject,
    deleteProject: deleteProject
};




/***/ }),
/* 19 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Project; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__resource__ = __webpack_require__(7);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__src_utils_inherits__ = __webpack_require__(0);
/* -----------------------------------------------------
 *  project.js
 *  Created by hyunseok.oh@samsung.com on 2018-01-31.
 * ----------------------------------------------------*/




function Project(prj) {
    this.data = prj || {};
}

Object(__WEBPACK_IMPORTED_MODULE_1__src_utils_inherits__["a" /* inherits */])(Project, __WEBPACK_IMPORTED_MODULE_0__resource__["a" /* Resource */]);

Project.prototype.getProjectId = function () {
    return this.data.id;
};

Project.prototype.setProjectId = function (id) {
    this.data.id = id;
    return this;
};

Project.prototype.getLabel = function () {
    return this.data.label;
};

Project.prototype.setLabel = function (label) {
    this.data.label = label;
    return this;
};

Project.prototype.getUpdateTime = function () {
    return new Date(moment(this.data.update_time).format());
};

Project.prototype.setUpdateTime = function (time) {
    this.data.update_time = time;
    return this;
};

Project.prototype.getCreateTime = function () {
    return new Date(moment(this.data.create_time).format());
};

Project.prototype.setCreateTime = function (time) {
    this.data.create_time = time;
    return this;
};

Project.prototype.getCreator = function () {
    return this.data.creator;
};

Project.prototype.setCreator = function (creator) {
    this.data.creator = creator;
    return this;
};

Project.prototype.getUpdater = function () {
    return this.data.updater;
};

Project.prototype.setUpdater = function (updater) {
    this.data.updater = updater;
    return this;
};

Project.prototype.getDescription = function () {
    return this.data.description;
};

Project.prototype.setDescription = function (description) {
    this.data.description = description;
    return this;
};

Project.prototype.getModelCount = function () {
    return parseInt(this.data.model_count);
};

Project.prototype.setModelCount = function (count) {
    this.data.model_count = count;
    return this;
};

Project.prototype.getReportCount = function () {
    return parseInt(this.data.report_count);
};

Project.prototype.setReportCount = function (count) {
    this.data.report_count = count;
    return this;
};

Project.prototype.getTag = function () {
    return this.data.tag;
};

Project.prototype.setTag = function (tag) {
    this.data.tag = tag;
    return this;
};

Project.prototype.getType = function () {
    return this.data.type;
};

Project.prototype.setType = function (type) {
    this.data.type = type;
    return this;
};

Project.prototype.toJSON = function () {
    return this.data;
};

Project.prototype.equals = function (that) {
    return this.getProjectId() == that.getProjectId() &&
        Number(this.getUpdateTime()) == Number(that.getUpdateTime());
};

Project.prototype.getHashCode = function () {
    return this.getProjectId();
};

Project.prototype.getResourceName = function () {
    return 'project';
};




/***/ }),
/* 20 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return VersionDao; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__vomodels_file__ = __webpack_require__(6);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__vomodels_version__ = __webpack_require__(21);




/* global _ */

var toVersionVo = function (json) {
    var version = new __WEBPACK_IMPORTED_MODULE_2__vomodels_version__["a" /* Version */](json);
    return version;
};

var toFileVo = function (json) {
    var file = new __WEBPACK_IMPORTED_MODULE_1__vomodels_file__["a" /* File */](json);
    return file;
};

var toVersionVoEach = function (jsonArray) {
    return _.map(jsonArray, toVersionVo);
};

// var extendModel = function (version) {
//     version.contents = Brightics.VA.Core.Utils.ModelUtils.extendModel(version.contents);
//     var supportModelList = Object.keys(Brightics.VA.Core.Interface.Clazz);
//     if (typeof file !== 'undefined') {
//         if (supportModelList.indexOf(version.contents.type) < 0) return;
//     }
//     version.contents.title = version.label;
//     version.contents.mid = version.file_id;
//     version.contents.adjustLinks();
// };

/**
 * 프로젝트 리스트 가져옴
 * @return {Promise<Array<File>>}
 */
var getVersions = function (projectId, fileId) {
    var url = 'api/va/v2/ws/projects/' + projectId + '/files/' + fileId + '/versions';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url).then(toVersionVoEach);
};

var getVersion = function (projectId, fileId, versionId) {
    var url = 'api/va/v2/ws/projects/' + projectId + '/files/' + fileId + '/versions/' + versionId;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url).then(toVersionVo);
};

var addVersion = function (projectId, fileId, version) {
    var url = 'api/va/v2/ws/projects/' + projectId + '/files/' + fileId + '/versions';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, version.toJSON(true)).then(toVersionVo);
};

var updateVersion = function (projectId, fileId, version) {
    var url = 'api/va/v2/ws/projects/' + projectId + '/files/' +
        fileId + '/versions/' + version.getVersionId() + '/update';
        // fileId + '/versions/' + version.getVersionId() + '/update';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, version);
};

// var deleteVersion = function (projectId, fileId, versionId) {
//     var url = 'api/va/v2/ws/projects/' + projectId + '/files/' +
//         fileId + '/versions/' + versionId + '/delete';
//     return ajaxPost(url);
// };

var loadVersion = function (projectId, fileId, versionId) {
    var url = 'api/va/v2/ws/projects/' + projectId + '/files/' +
        fileId + '/versions/' + versionId + '/load';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url).then(function (fileJSONs) {
        if (fileJSONs.length) {
            return toFileVo(fileJSONs[0]);
        }
        return undefined;
    });
};

var getVersionsForced = function (projectId, fileId, cb, fail) {
    var url = 'api/va/v2/ws/projects/' + projectId + '/files/' + fileId + '/versions';
    var opt = {
        type: 'GET',
        blocking: true,
        async: false,
        url: url,
        contentType: 'application/json; charset=utf-8'
    };
    return $.ajax(opt)
        .done(function (data) {
            if (cb && typeof cb === 'function') {
                return cb(toVersionVoEach(data));
            }
        })
        .fail(function (error) {
            if (fail && typeof fail === 'function') {
                return fail(error);
            }
        });
};

var getVersionForced = function (projectId, fileId, versionId, cb, fail) {
    var url = 'api/va/v2/ws/projects/' + projectId + '/files/' + fileId + '/versions/' + versionId;
    var opt = {
        type: 'GET',
        blocking: true,
        async: false,
        url: url,
        contentType: 'application/json; charset=utf-8'
    };
    return $.ajax(opt)
        .done(function (data) {
            if (cb && typeof cb === 'function') {
                return cb(toVersionVo(data));
            }
        })
        .fail(function (error) {
            if (fail && typeof fail === 'function') {
                return fail(error);
            }
        });
};

var VersionDao = {
    getVersions: getVersions,
    getVersion: getVersion,
    addVersion: addVersion,
    updateVersion: updateVersion,
    loadVersion: loadVersion,
    getVersionsForced: getVersionsForced,
    getVersionForced: getVersionForced
    // deleteVersion: deleteVersion
};




/***/ }),
/* 21 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Version; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__resource__ = __webpack_require__(7);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__src_utils_inherits__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__adjust_vo__ = __webpack_require__(17);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 31
 */





/* global _ */

function Version(version) {
    this.data = version || {};
    if (this.data.contents) {
        Object(__WEBPACK_IMPORTED_MODULE_2__adjust_vo__["b" /* adjustVersion */])(this.data);
        Object(__WEBPACK_IMPORTED_MODULE_2__adjust_vo__["c" /* migrate */])(this.data.contents);
    } else {
        this.data.contents = {};
    }
}

Object(__WEBPACK_IMPORTED_MODULE_1__src_utils_inherits__["a" /* inherits */])(Version, __WEBPACK_IMPORTED_MODULE_0__resource__["a" /* Resource */]);

Version.prototype.getVersionId = function () {
    return this.data.version_id;
};

Version.prototype.setVersionId = function (versionId) {
    this.data.version_id = versionId;
    this.data.contents.version_id = versionId;
    return this;
};

Version.prototype.getLabel = function () {
    return this.data.label;
};

Version.prototype.setLabel = function (label) {
    this.data.label = label;
    this.data.contents.title = label;
    return this;
};

Version.prototype.getDescription = function () {
    return this.data.description;
};

Version.prototype.setDescription = function (description) {
    this.data.description = description;
    return this;
};

Version.prototype.getFileId = function () {
    return this.data.file_id;
};

Version.prototype.setFileId = function (fileId) {
    this.data.file_id = fileId;
    this.data.contents.mid = fileId;
    return this;
};

Version.prototype.getMajorVersion = function () {
    return this.data.major_version;
};

Version.prototype.setMajorVersion = function (majorVersion) {
    this.data.major_version = majorVersion;
    return this;
};

Version.prototype.getMinorVersion = function () {
    return this.data.minor_version;
};

Version.prototype.setMinorVersion = function (minorVersion) {
    this.data.minor_version = minorVersion;
    return this;
};

Version.prototype.getVersion = function () {
    return this.data.major_version + '.' + this.data.minor_version;
};

Version.prototype.getType = function () {
    return this.data.type;
};

Version.prototype.setType = function (type) {
    this.data.type = type;
    return this;
};

Version.prototype.getTags = function () {
    return this.data.tags;
};

Version.prototype.setTags = function (tags) {
    this.data.tags = tags;
    return this;
};

Version.prototype.getModelImage = function () {
    return this.data.model_image;
};

Version.prototype.setModelImage = function (image) {
    this.data.image = image;
    return this;
};

Version.prototype.getUpdateTime = function () {
    return new Date(moment(this.data.update_time).format());
};

Version.prototype.setUpdateTime = function (time) {
    this.data.update_time = time;
    return this;
};

Version.prototype.getUpdater = function () {
    return this.data.updater;
};

Version.prototype.setUpdater = function (updater) {
    this.data.updater = updater;
    return this;
};

Version.prototype.getCreateTime = function () {
    return new Date(moment(this.data.create_time).format());
};

Version.prototype.setCreateTime = function (time) {
    this.data.create_time = time;
    return this;
};

Version.prototype.getCreator = function () {
    return this.data.creator;
};

Version.prototype.setCreator = function (creator) {
    this.data.creator = creator;
    return this;
};

Version.prototype.getContents = function () {
    return this.data.contents;
};

Version.prototype.setContents = function (contents) {
    this.data.contents = contents;
    Object(__WEBPACK_IMPORTED_MODULE_2__adjust_vo__["b" /* adjustVersion */])(this.data);
    Object(__WEBPACK_IMPORTED_MODULE_2__adjust_vo__["c" /* migrate */])(this.data.contents);
    return this;
};

Version.prototype.toJSON = function (all) {
    if (all) {
        return this.data;
    }
    return _.omit(this.data, [
        'isManual',
        'isMajor'
    ]);
};

Version.prototype.setIsMajor = function (val) {
    this.data.isMajor = val;
    return this;
};

Version.prototype.setIsManual = function (val) {
    this.data.isManual = val;
    return this;
};

Version.prototype.compareToByVersion = function (other) {
    if (this.getMajorVersion() !== other.getMajorVersion()) {
        return this.getMajorVersion() - other.getMajorVersion();
    }
    return this.getMinorVersion() - other.getMinorVersion();
};

Version.prototype.equals = function (that) {
    return this.getVersionId() === that.getVersionId() &&
        Number(this.getUpdateTime()) === Number(that.getUpdateTime());
};

Version.prototype.getHashCode = function () {
    return this.getVersionId();
};

Version.prototype.getResourceName = function () {
    return 'version';
};




/***/ }),
/* 22 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__hash_map_hash_map__ = __webpack_require__(8);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__project_tree_project_tree__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__tree_tree_node__ = __webpack_require__(24);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return __WEBPACK_IMPORTED_MODULE_0__hash_map_hash_map__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return __WEBPACK_IMPORTED_MODULE_1__project_tree_project_tree__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return __WEBPACK_IMPORTED_MODULE_2__tree_tree_node__["a"]; });







/***/ }),
/* 23 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ProjectTree; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__tree_tree_node__ = __webpack_require__(24);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__event_emitter_event_emitter__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__utils_inherits__ = __webpack_require__(0);




function ProjectTree() {
    this.__root = new __WEBPACK_IMPORTED_MODULE_0__tree_tree_node__["a" /* TreeNode */]();
}

Object(__WEBPACK_IMPORTED_MODULE_2__utils_inherits__["a" /* inherits */])(ProjectTree, __WEBPACK_IMPORTED_MODULE_1__event_emitter_event_emitter__["a" /* EventEmitter */]);

ProjectTree.prototype.getRootNode = function () {
    return this.__root;
};

ProjectTree.prototype.getProjectNode = function (projectId) {
    return this.__root.go(projectId);
};

ProjectTree.prototype.getProjectNodeBruteForce = function (fn) {
    return this.getRootNode().findChildNodeBruteForce(fn);
};

ProjectTree.prototype.getProjectNodeByFileId = function (fileId) {
    var projectNode = this.getProjectNodeBruteForce(function (node) {
        return node.hasChild(fileId);
    });
    return projectNode;
};

ProjectTree.prototype.getFileNode = function (projectId, fileId) {
    if (projectId) {
        return this.getProjectNode(projectId).go(fileId);
    }
    console.warn('NO PROJECT ID');
    var projectNode = this.getProjectNodeByFileId(fileId);
    return projectNode.go(fileId);
};

ProjectTree.prototype.getVersionNode = function (projectId, fileId, versionId) {
    return this.getFileNode(projectId, fileId).go(versionId);
};

ProjectTree.prototype.getProjectMap = function () {
    return this.getRootNode().getChildrenMap();
};

ProjectTree.prototype.getProjectArray = function () {
    return this.getRootNode().getChildren();
};

ProjectTree.prototype.getFileMap = function (projectId) {
    return this.getProjectNode(projectId).getChildrenMap();
};

ProjectTree.prototype.getFileArray = function (projectId) {
    return this.getProjectNode(projectId).getChildren();
};

ProjectTree.prototype.getVersionMap = function (projectId, fileId) {
    return this.getFileNode(projectId, fileId).getChildrenMap();
};

ProjectTree.prototype.getVersionArray = function (projectId, fileId) {
    return this.getFileNode(projectId, fileId).getChildren();
};

ProjectTree.prototype.getProjects = function () {
    try {
        return this.getRootNode().getChildren();
    } catch (e) {
        return undefined;
    }
};

ProjectTree.prototype.getProject = function (projectId) {
    var projectNode = this.getProjectNode(projectId);
    if (projectNode) {
        return projectNode.getData();
    }
    return undefined;
};

ProjectTree.prototype.getFiles = function (projectId) {
    try {
        return this.getProjectNode(projectId).getChildren();
    } catch (e) {
        return undefined;
    }
};

ProjectTree.prototype.getFile = function (projectId, fileId) {
    try {
        return this.getFileNode(projectId, fileId).getData();
    } catch (e) {
        return undefined;
    }
};

ProjectTree.prototype.getVersions = function (projectId, fileId) {
    try {
        return this.getFileNode(projectId, fileId).getChildren();
    } catch (e) {
        return undefined;
    }
};

ProjectTree.prototype.getVersion = function (projectId, fileId, versionId) {
    try {
        return this.getVersionNode(projectId, fileId, versionId).getData();
    } catch (e) {
        return undefined;
    }
};

ProjectTree.prototype.updateProject = function (project) {
    return this.getProjectNode(project.getProjectId()).setData(project);
};

ProjectTree.prototype.updateFile = function (projectId, file) {
    return this.getFileNode(projectId, file.getFileId()).setData(file);
};

ProjectTree.prototype.updateVersion = function (projectId, fileId, version) {
    return this.getVersionNode(projectId, fileId, version.getVersionId()).setData(version);
};

ProjectTree.prototype.addProject = function (project) {
    return this.getRootNode().addChild(project.getProjectId(), project);
};

ProjectTree.prototype.addFile = function (projectId, file) {
    return this.getProjectNode(projectId).addChild(file.getFileId(), file);
};

ProjectTree.prototype.addVersion = function (projectId, fileId, version) {
    return this.getFileNode(projectId, fileId).addChild(version.getVersionId(), version);
};

ProjectTree.prototype.deleteProject = function (projectId) {
    var node = this.getRootNode();
    return node.deleteChild(projectId).getData();
};

ProjectTree.prototype.deleteFile = function (projectId, fileId) {
    var node = this.getProjectNode(projectId);
    return node.deleteChild(fileId).getData();
};

ProjectTree.prototype.deleteVersion = function (projectId, fileId, versionId) {
    var node = this.getFileNode(projectId, fileId);
    return node.deleteChild(versionId).getData();
};




/***/ }),
/* 24 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return TreeNode; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__hash_map_hash_map__ = __webpack_require__(8);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__event_emitter_event_emitter__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__utils_inherits__ = __webpack_require__(0);



/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 31
 */

/* global _ */

function TreeNode(key, data) {
    __WEBPACK_IMPORTED_MODULE_1__event_emitter_event_emitter__["a" /* EventEmitter */].call(this);
    this.key = key;
    this.data = data;
    this.__parentNode = this;
    this.__childrenNodes = [];
    this.__childrenMap = new __WEBPACK_IMPORTED_MODULE_0__hash_map_hash_map__["a" /* HashMap */]();
}

Object(__WEBPACK_IMPORTED_MODULE_2__utils_inherits__["a" /* inherits */])(TreeNode, __WEBPACK_IMPORTED_MODULE_1__event_emitter_event_emitter__["a" /* EventEmitter */]);

TreeNode.prototype.hasChild = function (key) {
    return this.__childrenMap.has(key);
};

TreeNode.prototype.setData = function (data) {
    this.data = data;
    return this;
};

TreeNode.prototype.getData = function () {
    return this.data;
};

TreeNode.prototype.getKey = function () {
    return this.key;
};

TreeNode.prototype.setParent = function (parent) {
    this.__patrentNode = parent;
};

TreeNode.prototype.getParent = function () {
    return this.__parentNode;
};

TreeNode.prototype.addChild = function (key, data) {
    if (this.__childrenMap.has(key)) {
        return this.__childrenMap.get(key).setData(data);
    } else {
        var child = new TreeNode(key, data);
        child.setParent(this);
        this.__childrenMap.set(key, child);
        this.__childrenNodes.push(child);
        return child;
    }
};

TreeNode.prototype.deleteChild = function (key) {
    var ret = this.__childrenMap.remove(key);
    _.remove(this.__childrenNodes, function (node) {
        return node.getKey() == key;
    });
    return ret;
};

TreeNode.prototype.updateChild = function (key, data) {
    return this.__childrenMap.get(key).setData(data);
};

TreeNode.prototype.getChildren = function () {
    return _.map(this.__childrenNodes, function (node) {
        return node.getData();
    });
};

TreeNode.prototype.getChildrenNodes = function () {
    return this.__childrenNodes;
};

TreeNode.prototype.getChildrenMap = function () {
    return _.forIn(this.__childrenMap.toJSON(), function (e) {
        return e.getData();
    });
};

TreeNode.prototype.go = function (key) {
    return this.__childrenMap.get(key);
};

//사실 go 랑 같은기능인데 이름때문에
TreeNode.prototype.getChild = function (key) {
    return this.__childrenMap.get(key);
};

TreeNode.prototype.findChildNodeBruteForce = function (fn) {
    var idx = _.findIndex(this.__childrenNodes, function (node) {
        return fn(node);
    });
    if (idx > -1) return this.__childrenNodes[idx];
    return null;
};




/***/ }),
/* 25 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return resourceManager; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__src_event_emitter_event_emitter__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__dao_project_dao__ = __webpack_require__(18);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__dao_file_dao__ = __webpack_require__(16);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__dao_version_dao__ = __webpack_require__(20);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__src_utils_inherits__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__src_data_structures_index__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__src_data_structures_project_tree_project_tree__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__src_utils_index__ = __webpack_require__(55);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__resource_validator__ = __webpack_require__(62);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 31
 */











var EVENT = {
    PROJECT: {
        ADD: 'project:add',
        CHANGE: 'project:change',
        DELETE: 'project:delete'
    },
    FILE: {
        ADD: 'file:add',
        CHANGE: 'file:change',
        DELETE: 'file:delete'
    },
    VERSION: {
        ADD: 'version:add',
        CHANGE: 'version:change',
        DELETE: 'version:delete'
    }
};

var ADD = 'add';
var CHANGE = 'change';
var DELETE = 'delete';

/**
 * @event root:change
 * @event project:change
 * @event project:add
 * @event project:delete
 * @event file:change
 * @event file:add
 * @event file:delete
 * @event version:change
 * @event version:add
 * @event version:delete
 */

/* global _ */

function ResourceManager() {
    __WEBPACK_IMPORTED_MODULE_0__src_event_emitter_event_emitter__["a" /* EventEmitter */].call(this);
    this.projectTree = new __WEBPACK_IMPORTED_MODULE_6__src_data_structures_project_tree_project_tree__["a" /* ProjectTree */]();
}

Object(__WEBPACK_IMPORTED_MODULE_4__src_utils_inherits__["a" /* inherits */])(ResourceManager, __WEBPACK_IMPORTED_MODULE_0__src_event_emitter_event_emitter__["a" /* EventEmitter */]);

ResourceManager.prototype.initProject = function (project) {
    var _this = this;
    return this.fetchFiles(project.getProjectId()).then(function (files) {
        return Promise.all(_.map(files, _this.initFile.bind(_this)));
    });
};

ResourceManager.prototype.initFile = function (file) {
    return this.fetchVersions(file.getProjectId(), file.getFileId());
};

ResourceManager.prototype._getResourceDiff = function (_prev, cur) {
    var prev = _.compact(_.flatten(_prev));
    var hashMap = new __WEBPACK_IMPORTED_MODULE_5__src_data_structures_index__["a" /* HashMap */]();
    var diff = [];

    Object(__WEBPACK_IMPORTED_MODULE_7__src_utils_index__["a" /* forEach */])(prev, function (elem) {
        hashMap.set(elem.getHashCode(), elem);
    });

    Object(__WEBPACK_IMPORTED_MODULE_7__src_utils_index__["a" /* forEach */])(cur, function (elem) {
        var code = elem.getHashCode();
        if (hashMap.has(code)) {
            var prevElem = hashMap.get(code);
            if (!prevElem.equals(elem)) {
                diff.push({
                    type: CHANGE,
                    data: elem
                });
            }
            hashMap.remove(code);
        } else {
            diff.push({
                type: ADD,
                data: elem
            });
        }
    });

    Object(__WEBPACK_IMPORTED_MODULE_7__src_utils_index__["a" /* forEach */])(hashMap.toArray(), function (elem) {
        diff.push({
            type: DELETE,
            data: elem
        });
    });
    return diff;
};

ResourceManager.prototype._syncProject = function (diff) {
    var _this = this;
    Object(__WEBPACK_IMPORTED_MODULE_7__src_utils_index__["a" /* forEach */])(diff, function (diffInfo) {
        var data = diffInfo.data;
        if (diffInfo.type == ADD) _this._addProject(data);
        if (diffInfo.type == CHANGE) _this._updateProject(data);
        if (diffInfo.type == DELETE) _this._deleteProject(data.getProjectId());
    });
};

ResourceManager.prototype._syncFile = function (diff) {
    var _this = this;
    Object(__WEBPACK_IMPORTED_MODULE_7__src_utils_index__["a" /* forEach */])(diff, function (diffInfo) {
        var data = diffInfo.data;
        if (diffInfo.type == ADD) _this._addFile(data.getProjectId(), data);
        if (diffInfo.type == CHANGE) _this._updateFile(data.getProjectId(), data);
        if (diffInfo.type == DELETE) _this._deleteProject(data.getProjectId(), data.getFileId());
    });
};

ResourceManager.prototype._syncVersion = function (diff) {
    var _this = this;
    Object(__WEBPACK_IMPORTED_MODULE_7__src_utils_index__["a" /* forEach */])(diff, function (diffInfo) {
        var data = diffInfo.data;
        var pid = _this.projectTree
            .getProjectNodeByFileId(data.getFileId()).getData().getProjectId();
        if (diffInfo.type == ADD) _this._addVersion(pid, data.getFileId(), data);
        if (diffInfo.type == CHANGE) _this._updateVersion(pid, data.getFileId(), data);
        // if (diff.type == DELETE) _this._deleteVersion(pid, data.getFileId(), data.getVersionId());
    });
};

ResourceManager.prototype._updateProject = function (project) {
    this.projectTree.updateProject(project);
    this.emit(EVENT.PROJECT.CHANGE, project);
};

ResourceManager.prototype._addProject = function (project) {
    this.projectTree.addProject(project);
    this.emit(EVENT.PROJECT.ADD, project);
};

ResourceManager.prototype._deleteProject = function (projectId) {
    var project = this.projectTree.deleteProject(projectId);
    this.emit(EVENT.PROJECT.DELETE, project);
    return project;
};

ResourceManager.prototype._updateFile = function (projectId, file) {
    this.projectTree.updateFile(projectId, file);
    this.emit(EVENT.FILE.CHANGE, file);
    return file;
};

ResourceManager.prototype._addFile = function (projectId, file) {
    this.projectTree.addFile(projectId, file);
    this.emit(EVENT.FILE.ADD, file);
    return file;
};

ResourceManager.prototype._deleteFile = function (projectId, fileId) {
    var file = this.projectTree.deleteFile(projectId, fileId);
    this.emit(EVENT.FILE.DELETE, file);
    return file;
};

ResourceManager.prototype._updateVersion = function (projectId, fileId, version) {
    this.projectTree.updateVersion(projectId, fileId, version);
    this.emit(EVENT.VERSION.CHANGE, version);
    return version;
};

ResourceManager.prototype._addVersion = function (projectId, fileId, version) {
    this.projectTree.addVersion(projectId, fileId, version);
    this.emit(EVENT.VERSION.ADD, version);
    return version;
};

ResourceManager.prototype._deleteVersion = function (projectId, fileId, versionId) {
    var version = this.projectTree.addVersion(projectId, fileId, versionId);
    this.emit(EVENT.VERSION.DELETE, version);
    return version;
};

ResourceManager.prototype.fetchProject = function (projectId) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_1__dao_project_dao__["a" /* ProjectDao */].getProject(projectId)
        .then(function (project) {
            var prevProject = _this.projectTree.getProject(projectId);
            _this._syncProject(_this._getResourceDiff([prevProject], [project]));
            return project;
        })
        .catch(function (err) {
            console.error(err);
            throw new Error('failed to fetch project');
        });
};

/**
 * 서버에서 프로젝트 정보 받아옴
 * @return {Promise<Array<Project>>}
 */
ResourceManager.prototype.fetchProjects = function () {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_1__dao_project_dao__["a" /* ProjectDao */].getProjects()
        .then(function (projects) {
            var prevProjects = _this.projectTree.getProjects();
            _this._syncProject(_this._getResourceDiff([prevProjects], projects));
            return projects;
        })
        .catch(function (err) {
            throw new Error('failed to fetch projects');
        });
};

/**
 * 서버에서 해당 프로젝트에 있는 파일 정보 받아옴
 * @param {String} projectId 프로젝트 아이디
 * @return {Promise<Array<File>>}
 */
ResourceManager.prototype.fetchFiles = function (projectId) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_2__dao_file_dao__["a" /* FileDao */].getFiles(projectId)
        .then(function (files) {
            var prevFiles = _this.projectTree.getFiles(projectId);
            _this._syncFile(_this._getResourceDiff([prevFiles], files));
            return files;
        });
    // .catch(function (err) {
    //     console.error(err);
    //     throw err;
    // });
};

ResourceManager.prototype.fetchFile = function (projectId, fileId) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_2__dao_file_dao__["a" /* FileDao */].getFile(projectId, fileId)
        .then(function (file) {
            var prevFile = _this.projectTree.getFile(projectId, fileId);
            _this._syncFile(_this._getResourceDiff([prevFile], [file]));
            return file;
        })
        .catch(function (err) {
            throw new Error('filed to fetch file');
        });
};

/**
 * 서버에서 해당 프로젝트, 파일에 있는 버전 정보 받아옴
 * @param {String} projectId 프로젝트 아이디
 * @param {String} fileId 파일 아이디
 * @return {Promise<Array<Version>>}
 */
ResourceManager.prototype.fetchVersions = function (projectId, fileId) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_3__dao_version_dao__["a" /* VersionDao */].getVersions(projectId, fileId)
        .then(function (versions) {
            var projectId = _this.projectTree
                .getProjectNodeByFileId(fileId).getData().getProjectId();
            var prevVersions = _this.projectTree.getVersions(projectId, fileId);
            _this._syncVersion(_this._getResourceDiff([prevVersions], versions));
            return versions;
        })
        .catch(function (err) {
            throw new Error('failed to fetch versions');
        });
};

ResourceManager.prototype.fetchVersion = function (projectId, fileId, versionId) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_3__dao_version_dao__["a" /* VersionDao */].getVersion(projectId, fileId, versionId)
        .then(function (version) {
            // var projectId = _this.projectTree
            //     .getProjectNodeByFileId(fileId).getData().getProjectId();
            var prevVersion = _this.projectTree.getVersion(projectId, fileId, versionId);
            _this._syncVersion(_this._getResourceDiff([prevVersion], [version]));
            return version;
        })
        .catch(function (err) {
            throw new Error('filed to fetch version');
        });
};

/**
 * 서버에서 프로젝트, 파일, 버전 정보 받아와서 캐싱
 */
ResourceManager.prototype.build = function () {
    var _this = this;
    return this.fetchProjects()
        .then(function (projects) {
            return Promise.all(_.map(projects, _this.initProject.bind(_this)));
        });
};

/**
 * 캐싱되어 있는 프로젝트 정보 반환
 * @return {Array<Project>}
 */
ResourceManager.prototype.getProjects = function () {
    return this.projectTree.getProjects();
};

/**
 * 캐싱되어 있는 해당 프로젝트 정보 반환
 * @param {String} projectId 프로젝트 아이디
 * @return {Project}
 */
ResourceManager.prototype.getProject = function (projectId) {
    return this.projectTree.getProject(projectId);
};

/**
 * 프로젝트 추가
 * @event root:change
 * @event project:add
 * @param {Project} project 프로젝트 정보
 * @return {Promise<Project>}
 */
ResourceManager.prototype.addProject = function (project) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_1__dao_project_dao__["a" /* ProjectDao */].addProject(project)
        .then(function (/* project */) {
            _this._addProject(project);
            return project;
        })
        .catch(function (err) {
            console.error(err);
            throw err;
        });
};

/**
 * @event root:change
 * @event project:change
 * @param {Project} project 프로젝트 정보
 * @return {Promise<Project>}
 */
ResourceManager.prototype.updateProject = function (project) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_1__dao_project_dao__["a" /* ProjectDao */].updateProject(project)
        .then(function () {
            _this._updateProject(project);
            return project;
        })
        .catch(function (err) {
            console.error(err);
            throw err;
        });
};

/**
 * @event root:change
 * @event project:delete
 * @param {String} projectId
 * @return {Promise<Object>}
 */
ResourceManager.prototype.deleteProject = function (projectId) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_1__dao_project_dao__["a" /* ProjectDao */].deleteProject(projectId)
        .then(function () {
            return _this._deleteProject(projectId);
        })
        .catch(function (err) {
            console.error(err);
            throw err;
        });
};

/**
 * 캐싱되어 있는 해당 프로젝트의 파일 정보를 반환
 * @param {String} projectId 프로젝트 아이디
 * @return {Array<File>}
 */
ResourceManager.prototype.getFiles = function (projectId) {
    return this.projectTree.getFiles(projectId);
};

ResourceManager.prototype.getFilesByModelType = function (projectId, type) {
    return _.filter(this.getFiles(projectId), function (file) {
        return file.getContents().type == type;
    });
};

/**
 * 캐싱되어 있는 해당 파일 정보를 반환
 * @param {String} projectId 프로젝트 아이디
 * @param {String} fileId 파일 아이디
 * @return {File}
 */
ResourceManager.prototype.getFile = function (projectId, fileId) {
    return this.projectTree.getFile(projectId, fileId);
};

/**
 * @event root:change
 * @event project:change
 * @event file:add
 * @param {String} projectId 프로젝트 아이디
 * @param {File} file 파일 정보
 * @return {Promise<File>}
 */
ResourceManager.prototype.addFile = function (projectId, file) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_2__dao_file_dao__["a" /* FileDao */].addFile(projectId, file)
        .then(function () {
            _this._addFile(projectId, file);
            return file;
        })
        .catch(function (err) {
            console.error(err);
            throw err;
        });
};

/**
 * @event root:change
 * @event project:change
 * @event file:change
 * @param {String} projectId 프로젝트 아이디
 * @param {File} file 파일 아이디
 * @return {Promise<File>}
 */
ResourceManager.prototype.updateFile = function (projectId, file) {
    var _this = this;
    this.lastQuery = this.lastQuery || Promise.resolve();
    this.lastQuery = this.lastQuery
        .then(function () {
            return new Promise(function (resolve, reject) {
                __WEBPACK_IMPORTED_MODULE_2__dao_file_dao__["a" /* FileDao */].updateFileSync(projectId, file)
                    .then(function (updated) {
                        // file == updated임이 보장되는가?
                        file.setEventKey(updated.getEventKey());
                        file.setUpdateTime(updated.getUpdateTime());
                        _this._updateFile(projectId, file);
                        resolve([null, file]);
                    })
                    .catch(function (err) {
                        console.error(err);
                        resolve([err, file]);
                    });
            });
        });
    return this.lastQuery;
};

ResourceManager.prototype.saveFile = function (projectId, file, modelDiff) {
    this.lastQuery = this.lastQuery || Promise.resolve();
    this.lastQuery = this.lastQuery.then(() => {
        return __WEBPACK_IMPORTED_MODULE_2__dao_file_dao__["a" /* FileDao */].saveFileSync(projectId, file, modelDiff)
            .then((updated) => {
                if (updated) {
                    const { event_key, update_time } = updated;
                    file.setEventKey(event_key);
                    file.setUpdateTime(update_time);
                    this._updateFile(projectId, file);
                    return file;
                }

                return new Promise((resolve) => {
                    __WEBPACK_IMPORTED_MODULE_2__dao_file_dao__["a" /* FileDao */].updateFileSync(projectId, file)
                        .then((updated) => {
                            // file == updated임이 보장되는가?
                            file.setEventKey(updated.getEventKey());
                            file.setUpdateTime(updated.getUpdateTime());
                            this._updateFile(projectId, file);
                            resolve([null, file]);
                        })
                        .catch(function (err) {
                            console.error(err);
                            resolve([err, file]);
                        });
                });
            })
            .catch(function (err) {
                console.error(err);
                throw err;
            });
    });
    return this.lastQuery;
};

/**
 * @event root:change
 * @event project:change
 * @event file:delete
 * @param {String} projectId 프로젝트 아이디
 * @param {String} fileId 파일 아이디
 * @return {Promise<Boolean>}
 */
ResourceManager.prototype.deleteFile = function (projectId, fileId) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_2__dao_file_dao__["a" /* FileDao */].deleteFile(projectId, fileId)
        .then(function () {
            return _this._deleteFile(projectId, fileId);
        })
        .catch(function (err) {
            console.error(err);
            throw err;
        });
};

/**
 * @param {String} projectId 프로젝트 아이디
 * @param {String} fileId 파일 아이디
 * @return {Array<Version>}
 */
ResourceManager.prototype.getVersions = function (projectId, fileId) {
    return this.projectTree.getVersions(projectId, fileId);
};

/**
 * @param {String} projectId 프로젝트 아이디
 * @param {String} fileId 파일 아이디
 * @param {String} versionId 버전 아이디
 * @return {Version}
 */
ResourceManager.prototype.getVersion = function (projectId, fileId, versionId) {
    return this.projectTree.getVersion(projectId, fileId, versionId);
};

/**
 * @event root:change
 * @event project:change
 * @event file:change
 * @event version:add
 * @param {String} projectId 프로젝트 아이디
 * @param {String} fileId 파일 아이디
 * @param {Verion} version 버전 정보
 * @return {Promise<Version>}
 */
ResourceManager.prototype.addVersion = function (projectId, fileId, version) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_3__dao_version_dao__["a" /* VersionDao */].addVersion(projectId, fileId, version)
        .then(function (version) {
            _this._addVersion(projectId, fileId, version);
            return version;
        })
        .catch(function (err) {
            console.error(err);
            throw err;
        });
};

/**
 * @event root:change
 * @event project:change
 * @event file:change
 * @event version:change
 * @param {String} projectId 프로젝트 아이디
 * @param {String} fileId 파일 아이디
 * @param {Version} version 버전 정보
 * @return {Promise<Version>}
 */
ResourceManager.prototype.updateVersion = function (projectId, fileId, version) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_3__dao_version_dao__["a" /* VersionDao */].updateVersion(projectId, fileId, version)
        .then(function () {
            _this._updateVersion(projectId, fileId, version);
            return version;
        })
        .catch(function (err) {
            console.error(err);
            throw err;
        });
};

/**
 * @event root:change
 * @event project:change
 * @event file:change
 * @param {String} projectId 프로젝트 아이디
 * @param {String} fileId 파일 아이디
 * @param {String} versionId 버전 아이디
 * @param {Promise<File>}
 */
ResourceManager.prototype.loadVersion = function (projectId, fileId, versionId) {
    var _this = this;
    return __WEBPACK_IMPORTED_MODULE_3__dao_version_dao__["a" /* VersionDao */].loadVersion(projectId, fileId, versionId)
        .then(function (file) {
            _this._updateFile(projectId, file);
            return file;
        })
        .catch(function (err) {
            console.error(err);
            throw err;
        });
};

ResourceManager.prototype.validateFile = function (file, fileType) {    
    return __WEBPACK_IMPORTED_MODULE_8__resource_validator__["a" /* ResourceValidator */].validate(file, fileType);
};

var resourceManager = new ResourceManager();




/***/ }),
/* 26 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return fnUnitUtils; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__event_emitter_event_emitter__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__utils_inherits__ = __webpack_require__(0);



/* global Brightics */

/* global _ */
const DATA_TYPES = {
    TABLE: 'table',
    MODEL: 'model',
    IMAGE: 'image',
}

const PATH = {
    '1.0': {
        in: {
            data: 'inData'
        },
        out: {
            data: 'outData'
        }
    },
    '3.5': {
        in: {
            data: 'inData'
        },
        out: {
            data: 'outData'
        }
    },
    '3.6': {
        in: {
            data: 'inputs'
        },
        out: {
            data: 'outputs'
        }
    }
};

function FnUnitUtils() {
    __WEBPACK_IMPORTED_MODULE_0__event_emitter_event_emitter__["a" /* EventEmitter */].call(this);
}

Object(__WEBPACK_IMPORTED_MODULE_1__utils_inherits__["a" /* inherits */])(FnUnitUtils, __WEBPACK_IMPORTED_MODULE_0__event_emitter_event_emitter__["a" /* EventEmitter */]);

/**
 * @param {Object} fnUnit
 * @return {Object}
 */
FnUnitUtils.prototype.getMeta = function (fnUnit) {
    return (fnUnit.meta) ? fnUnit.meta : undefined;
};

/**
 * @param {Object} fnUnit
 * @return {String}
 */
FnUnitUtils.prototype.getVersion = function (fnUnit) {
    return (fnUnit.version) ? fnUnit.version : '1.0';
};

FnUnitUtils.prototype._getVersionPath = function (fnUnit) {
    var version = this.getVersion(fnUnit);
    return PATH[version];
};

FnUnitUtils.prototype._getPath = function (fnUnit, inOutType, key) {
    var versionPath = this._getVersionPath(fnUnit);
    return Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(versionPath, [inOutType, key]);
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getInputs = function (fnUnit) {
    var path = this._getPath(fnUnit, 'in', 'data');
    return Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(fnUnit, path);
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getOutputs = function (fnUnit) {
    var path = this._getPath(fnUnit, 'out', 'data');
    return Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(fnUnit, path);
};

/**
 * @param {Object} fnUnit
 * @return {Object}
 */
FnUnitUtils.prototype.getInputsToObject = function (fnUnit) {
    if (!fnUnit) return {};

    var rt = {};
    var inputs = this.getInputs(fnUnit);

    if (this.hasMeta(fnUnit)) {
        for (var key in inputs) {
            rt[inputs[key]] = key;
        }
    } else {
        var label = this.getLabel(fnUnit);

        for (var i in inputs) {
            rt[inputs[i]] = '[' + i + ']' + label;
        }
        ;
    }

    return rt;
};

/**
 * @param {Object} fnUnit
 * @return {Object}
 */
FnUnitUtils.prototype.getOutputsToObject = function (fnUnit) {
    if (!fnUnit) return {};

    var rt = {};
    var outputs = this.getOutputs(fnUnit);

    if (this.hasMeta(fnUnit)) {
        for (var key in outputs) {
            if (Array.isArray(outputs[key])) {
                for (var i in outputs[key]) {
                    rt[outputs[key][i]] = key;
                }
            } else {
                rt[outputs[key]] = key;
            }
        }
    } else {
        var label = this.getLabel(fnUnit);

        for (var i in outputs) {
            rt[outputs[i]] = '[' + i + ']' + label;
        }
        ;
    }

    return rt;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getInData = function (fnUnit, type) {
    var rt = [];
    var meta = this.getMeta(fnUnit);
    var inData = this.getInputs(fnUnit);
    if (meta) {
        for (var key in inData) {
            if (!inData[key]) continue;

            if (type) {
                if (meta[key].type === type) rt = rt.concat(inData[key]);
            } else {
                rt = rt.concat(inData[key]);
            }
        }
    } else {
        if (type) {
            if (type === DATA_TYPES.TABLE) rt = inData;
        } else {
            rt = inData;
        }
    }

    return rt;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getOutData = function (fnUnit, type) {
    var rt = [];
    var meta = this.getMeta(fnUnit);
    var outData = this.getOutputs(fnUnit);
    if (meta) {
        for (var key in outData) {
            if (!outData[key]) continue;
            if (type) {
                if (meta[key].type === type) rt = rt.concat(outData[key]);
            } else {
                rt = rt.concat(outData[key]);
            }
        }
    } else {
        if (type) {
            if (type === DATA_TYPES.TABLE) rt = outData;
        } else {
            rt = outData;
        }
    }

    return rt;
};

FnUnitUtils.prototype._getData = function (fnUnit) {
    var a = (o) => {
        if (_.isUndefined(o)) return [];
        if (_.isString(o)) return [o];
        if (_.isArray(o)) return o.map((x) => a(x));
        return Object.values(o).map((x) => a(x));
    };
    return _.compact(_.flattenDeep([a(fnUnit.inputs || []), a(fnUnit.outputs || [])]));
};

FnUnitUtils.prototype.getAllData = function (fnUnit) {
    return _.union(this.getInData(fnUnit),
        this.getOutData(fnUnit),
        this._getData(fnUnit));
};
/**
 * @param {Object} fnUnit
 * @param {String} inOutType in / out
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getData = function (fnUnit, inOutType) {
    return (inOutType === 'in') ? this.getInData(fnUnit) : this.getOutData(fnUnit);
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getInputTypes = function (fnUnit) {
    var meta = this.getMeta(fnUnit);

    if (!meta) return [DATA_TYPES.TABLE];

    var types = [];
    var inputs = this.getInputs(fnUnit);

    for (var key in inputs) {
        if (types.indexOf(meta[key].type) < 0) types.push(meta[key].type);
    }

    return types;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getOutputTypes = function (fnUnit) {
    var meta = this.getMeta(fnUnit);

    if (!meta) return [DATA_TYPES.TABLE];

    var types = [];
    var outputs = this.getOutputs(fnUnit);

    for (var key in outputs) {
        if (types.indexOf(meta[key].type) < 0) types.push(meta[key].type);
    }

    return types;
};

/**
 * @param {Object} fnUnit
 * @param {String} inOutType in / out
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getTypes = function (fnUnit, inOutType) {
    return (inOutType === 'in') ? this.getInputTypes(fnUnit) : this.getOutputTypes(fnUnit);
};

/**
 * @param {Object} fnUnit
 * @param {String} tid 테이블 ID
 * @return {String}
 */
FnUnitUtils.prototype.getKeyByTableId = function (fnUnit, tid) {
    if (!fnUnit) return '';

    var meta = this.getMeta(fnUnit);

    if (!meta) return '';

    var puts = _.assign({}, this.getInputs(fnUnit), this.getOutputs(fnUnit));

    for (var key in puts) {
        if ((puts[key]).indexOf(tid) > -1) {
            return key;
        }
    }
};

/**
 * @param {Object} fnUnit
 * @param {String} tid 테이블 ID
 * @return {String}
 */
FnUnitUtils.prototype.getTypeByTableId = function (fnUnit, tid) {
    if (!fnUnit) return '';

    var meta = this.getMeta(fnUnit);

    if (!meta) return DATA_TYPES.TABLE;

    var puts = _.assign({}, this.getInputs(fnUnit), this.getOutputs(fnUnit));

    for (var key in puts) {
        if ((puts[key]).indexOf(tid) > -1) {
            return meta[key].type;
        }
    }

    return '';
};

/**
 * @param {Object} fnUnit
 * @param {String} tid 테이블 ID
 * @return {String}
 */
FnUnitUtils.prototype.getTypeByKey = function (fnUnit, key) {
    if (!fnUnit) return '';

    var meta = this.getMeta(fnUnit);

    if (!meta) return DATA_TYPES.TABLE;

    return meta[key].type;

};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getInTable = function (fnUnit) {
    var tables = [];
    var meta = this.getMeta(fnUnit);
    if (!meta) {
        tables = fnUnit[IN_DATA];
    } else {
        var inputs = this.getInputs(fnUnit);

        for (var key in inputs) {
            if (!inputs[key]) continue;
            if (meta[key].type === DATA_TYPES.TABLE && inputs[key]) {
                tables = tables.concat(inputs[key]);
            }
        }
    }

    return tables;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getInTableByKeys = function (fnUnit, keys) {
    var tables = [];
    var meta = this.getMeta(fnUnit);
    if (meta) {
        var inputs = this.getInputs(fnUnit);
        var key;

        for (let i = 0; i < keys.length; i++) {
            key = keys[i];
            if (!inputs[key]) continue;
            if (meta[key].type === DATA_TYPES.TABLE && inputs[key]) {
                tables = tables.concat(inputs[key]);
            }
        }
    }

    return tables;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getOutTable = function (fnUnit) {
    var tables = [];
    var meta = this.getMeta(fnUnit);
    if (!meta) {
        tables = fnUnit[OUT_DATA];
    } else {
        var outputs = this.getOutputs(fnUnit);

        for (var key in outputs) {
            if (!outputs[key]) continue;
            if (meta[key].type === DATA_TYPES.TABLE && outputs[key]) {
                tables = tables.concat(outputs[key]);
            }
        }
    }

    return tables;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getInModel = function (fnUnit) {
    var models = [];
    var meta = this.getMeta(fnUnit);
    if (!meta) {
    } else {
        var inputs = this.getInputs(fnUnit);

        for (var key in inputs) {
            if (!inputs[key]) continue;
            if (meta[key].type === DATA_TYPES.MODEL && inputs[key]) {
                models = models.concat(inputs[key]);
            }
        }
    }

    return models;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getOutModel = function (fnUnit) {
    var models = [];
    var meta = this.getMeta(fnUnit);
    if (!meta) {
    } else {
        var outputs = this.getOutputs(fnUnit);

        for (var key in outputs) {
            if (!outputs[key]) continue;
            if (meta[key].type === DATA_TYPES.MODEL && outputs[key]) {
                models = models.concat(outputs[key]);
            }
        }
    }

    return models;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getInImage = function (fnUnit) {
    var images = [];
    var meta = this.getMeta(fnUnit);
    if (!meta) {
    } else {
        var inputs = this.getInputs(fnUnit);

        for (var key in inputs) {
            if (!inputs[key]) continue;
            if (meta[key].type === DATA_TYPES.IMAGE && inputs[key]) {
                images = images.concat(inputs[key]);
            }
        }
    }

    return images;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getOutImage = function (fnUnit) {
    var images = [];
    var meta = this.getMeta(fnUnit);
    if (!meta) {
    } else {
        var outputs = this.getOutputs(fnUnit);

        for (var key in outputs) {
            if (!outputs[key]) continue;
            if (meta[key].type === DATA_TYPES.IMAGE && outputs[key]) {
                images = images.concat(outputs[key]);
            }
        }
    }

    return images;
};

/**
 * @param {Object} fnUnit
 * @param {String} inOutType in / out
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getPreviousFnUnits = function (fnUnit) {
    var _this = this;

    var fnUnits = [];

    var model = this.getParent(fnUnit);
    var prevFids = model.getPrevious(fnUnit.fid);

    _.forEach(prevFids, function (fid) {
        var fnUnit = model.getFnUnitById(fid);
        var tmpUnits = _this.isProcessFunction(fnUnit) ?
            model.getAllPreviousFnUnits(fnUnit.fid) :
            [fnUnit];

        fnUnits = _.union(fnUnits, tmpUnits);
    });

    return fnUnits;
};

/**
 * @param {Object} fnUnit
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getLinkedTable = function (fnUnit) {
    var _this = this;

    var tables = [];
    var fnUnits = this.getPreviousFnUnits(fnUnit);

    _.forEach(fnUnits, function (fn) {
        tables = tables.concat(_this.getOutTable(fn));
    });

    return tables;
};

/**
 * @param {Object} fnUnit
 * @param {String} inOutType in / out
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getTable = function (fnUnit, inOutType) {
    return (inOutType === 'in') ? this.getInTable(fnUnit) : this.getOutTable(fnUnit);
};

/**
 * @param {Object} fnUnit
 * @param {String} inOutType in / out
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getModel = function (fnUnit, inOutType) {
    return (inOutType === 'in') ? this.getInModel(fnUnit) : this.getOutModel(fnUnit);
};

/**
 * @param {Object} fnUnit
 * @param {String} inOutType in / out
 * @return {Array<String>}
 */
FnUnitUtils.prototype.getImage = function (fnUnit, inOutType) {
    return (inOutType === 'in') ? this.getInImage(fnUnit) : this.getOutImage(fnUnit);
};

/**
 * @param {Object} fnUnit
 * @return {Boolean}
 */
FnUnitUtils.prototype.hasMeta = function (fnUnit) {
    return (fnUnit.meta) ? true : false;
};

/**
 * @param {Object} fnUnit
 * @return {Boolean}
 */
FnUnitUtils.prototype.hasInput = function (fnUnit) {
    var path = this._getPath(fnUnit, 'in', 'data');
    return (Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(fnUnit, path)) ? true : false;
};

/**
 * @param {Object} fnUnit
 * @return {Boolean}
 */
FnUnitUtils.prototype.hasOutput = function (fnUnit) {
    var path = this._getPath(fnUnit, 'out', 'data');
    return (Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(fnUnit, path)) ? true : false;
};

/**
 * @param {Object} fnUnit
 * @return {Object}
 */
FnUnitUtils.prototype.getInRange = function (fnUnit) {
    var range = {};

    var meta = this.getMeta(fnUnit);

    if (meta) {
        var inputs = this.getInputs(fnUnit);
        for (var key in inputs) {
            var type = meta[key].type;
            if (!range[type]) range[type] = {min: 0, max: 0};

            if (meta[key].range) {
                range[type].min += meta[key].range.min;
                range[type].max += meta[key].range.max;
            } else {
                range[type].min += 1;
                range[type].max += 1;
            }
        }

    } else {
        var functionDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnUnit.func);
        range[DATA_TYPES.TABLE] = functionDef['in-range'];
    }

    return range;
};

/**
 * @param {Object} fnUnit
 * @return {Object}
 */
FnUnitUtils.prototype.getOutRange = function (fnUnit) {
    var range = {};

    var meta = this.getMeta(fnUnit);

    if (meta) {
        var outputs = this.getOutputs(fnUnit);
        for (var key in outputs) {
            var type = meta[key].type;
            if (!range[type]) range[type] = {min: 1, max: 1};

            if (meta[key].range) {
                range[type].min = meta[key].range.min;
                range[type].max = meta[key].range.max;
            }
        }

    } else {
        var functionDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnUnit.func);
        range[DATA_TYPES.TABLE] = functionDef['out-range'];
    }

    return range;
};

FnUnitUtils.prototype.getTotalInRangeCount = function (fnUnit) {
    var count = {min: 0, max: 0};

    var range = this.getInRange(fnUnit);

    for (var key in range) {
        count.min += range[key].min;
        count.max += range[key].max;
    }

    return count;
};

FnUnitUtils.prototype.getTotalOutRangeCount = function (fnUnit) {
    var count = {min: 0, max: 0};

    var range = this.getOutRange(fnUnit);

    for (var key in range) {
        count.min += range[key].min;
        count.max += range[key].max;
    }

    return count;
};

FnUnitUtils.prototype.getKeyByType = function (fnUnit, type, inOutType) {
    var meta = this.getMeta(fnUnit);
    if (!meta) return undefined;

    var puts = (inOutType === 'in') ? this.getInputs(fnUnit) : this.getOutputs(fnUnit);

    for (var key in puts) {
        if (meta[key].type === type) return key;
    }

    return undefined;
};

FnUnitUtils.prototype.isProcessFunction = function (fnUnit) {
    var funcList = ['SetValue', 'ImportData', 'ExportData', 'brightics.function.io$unload_model'];
    var isProcessFunction = false;

    isProcessFunction = funcList.indexOf(fnUnit[FUNCTION_NAME]) >= 0;

    return isProcessFunction;
};

FnUnitUtils.prototype.isSkip = function (fnUnit) {
    return fnUnit.skip && _.isEqual(fnUnit.skip, true);
};

FnUnitUtils.prototype.getDefinition = function (type, func) {
    return Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(type, func);
};

FnUnitUtils.prototype.isExist = function (sourceFnUnit, targetFnUnit) {
    var sourceOutData = this.getOutData(sourceFnUnit);
    var targetInData = this.getInData(targetFnUnit);

    _.forEach(sourceOutData, function (sourceData) {
        _.forEach(targetInData, function (targetData) {
            if (sourceData === targetData) return true;
        });
    });
    return false;
};

FnUnitUtils.prototype.isConnectable = function (sourceFnUnit, targetFnUnit) {
    // 1. connectable-functions
    var sourceDef = this.getDefinition('data', sourceFnUnit.func);
    var targetDef = this.getDefinition('data', targetFnUnit.func);

    if (sourceDef['connectable-functions']) {
        if (sourceDef['connectable-functions'].indexOf(targetFnUnit.func) < 0) {
            return false;
        }
    } else if (targetDef['acceptable-functions']) {
        if (targetDef['acceptable-functions'].indexOf(sourceFnUnit.func) < 0) {
            return false;
        }
    }

    // 2. Data Type 체크
    var sourceOutTypes = this.getOutputTypes(sourceFnUnit);
    var targetInTypes = this.getInputTypes(targetFnUnit);
    var typeCount = 0;

    for (var i in sourceOutTypes) {
        var sourceType = sourceOutTypes[i];
        if (targetInTypes.indexOf(sourceType) > -1) typeCount++;
    }
    if (typeCount === 0) return false;

    // 3. 갯수 체크
    var targetInRange = this.getInRange(targetFnUnit);
    var connectableCount = 0;

    for (var type in targetInRange) {
        var inMax = targetInRange[type].max;
        var inData = this.getInData(targetFnUnit, type);

        if (inData.length < inMax) connectableCount++;
    }

    if (connectableCount === 0) return false;

    return true;
};

FnUnitUtils.prototype.connect = function (sourceFnUnit, targetFnUnit) {
    var sourceOutData = this.getOutData(sourceFnUnit);
    var targetInputTypes = this.getInputTypes(targetFnUnit);

    var sourceType = {
        table: [],
        model: [],
        image: [],
    }

    for (var i in sourceOutData) {
        var tid = sourceOutData[i];

        var type = this.getTypeByTableId(sourceFnUnit, tid);

        sourceType[type].push(tid);
    }

    for (var type in sourceType) {
        if (sourceType[type].length === 0) continue;
        if (targetInputTypes.indexOf(type) > -1) this.addInData(targetFnUnit, type, sourceType[type]);
    }
};

FnUnitUtils.prototype.disconnect = function (sourceFnUnit, targetFnUnit) {
    var sourceOutData = this.getOutData(sourceFnUnit);

    var sourceType = {
        table: [],
        model: [],
        image: [],
    }

    //source에서 모든 tid를 찾아서 target에서 지워준다.
    for (var i in sourceOutData) {
        var tid = sourceOutData[i];

        var type = this.getTypeByTableId(sourceFnUnit, tid);

        sourceType[type].push(tid);
    }

    for (var type in sourceType) {
        if (sourceType[type].length === 0) continue;

        this.removeInData(targetFnUnit, type, sourceType[type]);
    }
};

FnUnitUtils.prototype.addInData = function (fnUnit, type, tids) {
    var _this = this;

    if (tids.length === 0) return;

    if (type === DATA_TYPES.TABLE) {

        var meta = this.getMeta(fnUnit);
        if (meta) {
            var inputs = this.getInputs(fnUnit);
            _.forEach(inputs, function (input, key) {
                if (_.isArray(input) && _.isEqual(type, _this.getTypeByKey(fnUnit, key))) {
                    fnUnit.inputs[key] = _.union([], input, tids);
                } else {
                    if (_.isEmpty(input) &&
                        _.isEqual(type, _this.getTypeByKey(fnUnit, key)) &&
                        _.isEmpty(_this.getKeyByTableId(fnUnit, tids[0]))) {
                        fnUnit.inputs[key] = tids[0];
                    }
                }

            });
        } else {
            fnUnit[IN_DATA].push(tids[0]);
        }

    } else if (type === 'model') {
        var inputs = this.getInputs(fnUnit);
        _.forEach(inputs, function (input, key) {
            if (_.isArray(input) && _.isEqual(type, _this.getTypeByKey(fnUnit, key))) {
                fnUnit.inputs[key] = _.union([], input, tids);
            } else {
                if (_.isEmpty(input) &&
                    _.isEqual(type, _this.getTypeByKey(fnUnit, key)) &&
                    _.isEmpty(_this.getKeyByTableId(fnUnit, tids[0]))) {
                    fnUnit.inputs[key] = tids[0];
                }
            }
        });
    } else if (type === 'image') {
        var inputs = this.getInputs(fnUnit);
        _.forEach(inputs, function (input, key) {
            if (_.isArray(input) && _.isEqual(type, _this.getTypeByKey(fnUnit, key))) {
                fnUnit.inputs[key] = _.union([], input, tids);
            } else {
                if (_.isEmpty(input) &&
                    _.isEqual(type, _this.getTypeByKey(fnUnit, key)) &&
                    _.isEmpty(_this.getKeyByTableId(fnUnit, tids[0]))) {
                    fnUnit.inputs[key] = tids[0];
                }
            }
        });
    }
};

FnUnitUtils.prototype.removeInData = function (fnUnit, type, tids) {
    if (tids.length === 0) return;

    var tids = (Array.isArray(tids)) ? tids : [tids];
    var meta = this.getMeta(fnUnit);
    if (meta) {
        _.forEach(this.getInputs(fnUnit), function (input, key) {
            _.forEach(tids, function (tid) {
                if (_.isArray(input) && _.indexOf(input, tid) > -1) {
                    _.remove(input, function (id) {
                        return id == tid;
                    });
                    fnUnit.inputs[key] = input;
                } else if (_.isEqual(input, tid)) {
                    fnUnit.inputs[key] = '';
                }
            });
        });
    } else {
        Brightics.VA.Core.Utils.CommonUtils.removeArrayElement(fnUnit[IN_DATA], tids);
    }
};

FnUnitUtils.prototype.createOutData = function (type, func) {
    var funcDefinition = this.getDefinition('data', func);
    var fnUnit = $.extend(true, {}, funcDefinition.defaultFnUnit);

    var outData = {};
    var meta = fnUnit.meta;

    if (meta) {
        outData['outputs'] = fnUnit['outputs'];

        for (var key in outData['outputs']) {
            if (Array.isArray(outData['outputs'][key])) {
                outData['outputs'][key].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
            } else {
                outData['outputs'][key] = Brightics.VA.Core.Utils.IDGenerator.table.id();
            }
        }

    } else {
        outData[OUT_DATA] = fnUnit[OUT_DATA];

        var outRange = funcDefinition['out-range'];
        for (var i = 0; i < outRange.min; i++) {
            outData[OUT_DATA].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
        }
    }

    return outData;
};

FnUnitUtils.prototype.wrapInputs = function (inputs) {
    if (Array.isArray(inputs)) return {inData: inputs};
    else return {inputs: inputs};
};

FnUnitUtils.prototype.clearInData = function (fnUnit) {
    if (this.hasInput(fnUnit)) {
        var meta = this.getMeta(fnUnit);
        if (meta) {
            for (var key in fnUnit['inputs']) {
                var newInputs = (Array.isArray(fnUnit['inputs'][key])) ? [] : '';
                fnUnit['inputs'][key] = newInputs;
            }
        } else {
            fnUnit[IN_DATA] = [];
        }
    }
};

FnUnitUtils.prototype.isArray = function (target) {
    return Array.isArray(target);
};

FnUnitUtils.prototype.getFunc = function (fnUnit) {
    return (fnUnit) ? fnUnit.func : '';
};

FnUnitUtils.prototype.getName = function (fnUnit) {
    return (fnUnit) ? fnUnit.name : '';
};

FnUnitUtils.prototype.getLabel = function (fnUnit) {
    return (fnUnit) ? fnUnit.display.label : '';
};

FnUnitUtils.prototype.getId = function (fnUnit) {
    return (fnUnit) ? fnUnit.fid : '';
};

FnUnitUtils.prototype.getParam = function (fnUnit) {
    return (fnUnit) ? fnUnit.param : {};
};

FnUnitUtils.prototype.getKeyLabel = function (fnUnit, key) {
    var meta = this.getMeta(fnUnit);
    return _.isEmpty(meta) ? '' : meta[key]['label'] ? meta[key]['label'] : key;
};

FnUnitUtils.prototype.getCategory = function (fnUnit) {
    var def = this.getDefinition('data', fnUnit.func);
    return def.category;
};

FnUnitUtils.prototype.getContext = function (fnUnit) {
    return fnUnit.context || 'scala';
};

FnUnitUtils.prototype.isFlexibleFunction = function (fnUnit) {
    if (this.getCategory(fnUnit) === 'control'
        || this.getCategory(fnUnit) === 'script'
        || this.getFunc(fnUnit) === 'rowAppend') {
        return true;
    }
    return false;
};

FnUnitUtils.prototype.inputChangable = function (fnUnit) {
    if (this.getCategory(fnUnit) === 'script'
        || this.getFunc(fnUnit) === 'rowAppend') {
        return false;
    }
    return true;
};

FnUnitUtils.prototype.getDataPanel = function (fnUnit, inOutType) {
    var panel = Brightics.VA.Core.Editors.Sheet.Panels.DataPanel;
    if (inOutType === 'out') {
        var func = this.getFunc(fnUnit);
        panel =
            (Brightics.VA.Implementation.DataFlow.Functions[func] &&
                Brightics.VA.Implementation.DataFlow.Functions[func].DataPanel) || panel;
    }

    return panel;
};

FnUnitUtils.prototype.getParent = function (fnUnit) {
    return typeof fnUnit.parent === 'function' ? fnUnit.parent() :
        Studio.getEditorContainer().getActiveModelEditor().getActiveModel();
};

FnUnitUtils.prototype.hasTable = function (fnUnit) {
    var types = this.getTypes(fnUnit);
    return types.indexOf(DATA_TYPES.TABLE) > -1;
};

FnUnitUtils.prototype.changeData = function (fnUnit, oldData, newData) {
    if (this.hasMeta(fnUnit)) {
        var inputs = this.getInputs(fnUnit);
        var outputs = this.getOutputs(fnUnit);

        _.forEach(inputs, function (tid, key) {
            if (_.isEqual(tid, oldData)) fnUnit.inputs[key] = newData;
        })

        _.forEach(outputs, function (tid, key) {
            if (_.isEqual(tid, oldData)) fnUnit.outputs[key] = newData;
        })

        var a = (x) => {
            if (_.isString(x)) {
                return _.isEqual(x, oldData) ? newData : x;
            }
            if (_.isArray(x)) {
                return x.map((e) => a(e));
            }
            if (_.isObject(x)) {
                return _.zipObject(Object.entries(x).map((kv) => {
                    var k = kv[0];
                    var v = kv[1];
                    return [k, a(v)];
                }));
            }
        };

        if (fnUnit.inputs) {
            fnUnit.inputs = a(fnUnit.inputs);
        }
        if (fnUnit.outputs) {
            fnUnit.outputs = a(fnUnit.outputs);
        }
    } else {
        _.forEach(fnUnit.inData, function (tid, index) {
            if (_.isEqual(tid, oldData)) fnUnit.inData[index] = newData;
        })

        _.forEach(fnUnit.outData, function (tid, index) {
            if (_.isEqual(tid, oldData)) fnUnit.outData[index] = newData;
        })
    }
};

FnUnitUtils.prototype.isDustNode = function (fnUnit) {
    var dustList = ['brightics'];

    if (dustList.indexOf(this.getCategory(fnUnit)) > -1) return true;
    return false;
};

FnUnitUtils.prototype.isBluffNode = function (fnUnit) {
    if (!(fnUnit.inData ||
        fnUnit.outData ||
        fnUnit.inputs ||
        fnUnit.outputs)) return true;
    return false;
};

FnUnitUtils.prototype.isInputtable = function (fnUnit) {
    var isInputtable = false;

    isInputtable =
        this.getTotalInRangeCount(fnUnit).min > 0 ? true : false ||
            this.isBluffNode(fnUnit);

    return isInputtable;
};

FnUnitUtils.prototype.isOutputtable = function (fnUnit) {
    var isOutputtable = false;

    isOutputtable =
        Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnUnit.func)['out-node'] ? false : true ||
            this.isBluffNode(fnUnit);

    return isOutputtable;
};

FnUnitUtils.prototype.isSkippable = function (fnUnit) {
    return this.isBluffNode(fnUnit) || this.isProcessFunction(fnUnit);
};

FnUnitUtils.prototype.isAvailable = function (fnUnit) {
    var func = this.getFunc(fnUnit);
    return !_.isUndefined(Brightics.VA.Core.Interface.Functions['data'][func]);
};

FnUnitUtils.prototype.isThirdPartyFunction = function (fnUnit) {
    var funcList = ['DataFrameExportForTableau', 'DataFrameExportForMSTR', 'DataFrameExportForQlikSense'];
    var isThirdPartyFunction = false;
    isThirdPartyFunction = funcList.indexOf(fnUnit[FUNCTION_NAME]) >= 0;
    return isThirdPartyFunction;
};

var fnUnitUtils = new FnUnitUtils();




/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/**
 * Created by SDS on 2016-01-28.
 */


var ALPHABET = '23456789abcdefghjkmnpqrstuvwxyz';
var ID_LENGTH = 16;

var nextChar = function (str) {
    return str.charAt(Math.floor(Math.random() * str.length));
};

var nextId = function (length) {
    var size = length || ID_LENGTH;
    var rtn = '';
    for (var i = 0; i < size; i++) {
        rtn += nextChar(ALPHABET);
    }
    return rtn;
};

var IDGenerator = {
    project: {
        id: function () {
            return 'p' + nextId(15);
        }
    },
    model: {
        id: function () {
            return 'm' + nextId(15);
        }
    },
    control: {
        id: function () {
            return 'c' + nextId(15);
        }
    },
    func: {
        id: function () {
            return 'f' + nextId(15);
        }
    },
    table: {
        id: function () {
            return 't' + nextId(15);
        }
    },
    link: {
        id: function () {
            return 'k' + nextId(15);
        }
    },
    template: {
        id: function () {
            return 't' + nextId(15);
        }
    },
    notice: {
        id: function () {
            return 'n' + nextId(15);
        }
    },
    send: {
        id: function () {
            return 's' + nextId(39);
        }
    },
    report: {
        id: function (length) {
            var idLength = length || 8;
            return 'r' + nextId(idLength);
        }
    },
    schedule: {
        id: function () {
            return 'j' + nextId(15);
        }
    },
    file: {
        id: function () {
            return 'f' + nextId(8);
        }
    },
    reportPage: {
        id: function () {
            return 'rp' + nextId(14);
        }
    },
    reportContent: {
        id: function () {
            return 'rc' + nextId(14);
        }
    },
    dataSource: {
        id: function () {
            return 'ds' + nextId(14);
        }
    },
    udf: {
        id: function (prefix) {
            return 'udf_' + prefix + '_' + nextId(8);
        }
    },
    uuid: {
        id: function (length) {
            return nextId(length);
        }
    },
    importedFile: {
        id: function (prefix) {
            return 'importedFile_' + nextId(8);
        }
    },
    version: {
        id: function (length) {
            return 'v' + nextId(length || 15);
        }
    }
};

// export { IDGenerator };
module.exports = IDGenerator;


/***/ }),
/* 28 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ExportProjectSpec; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__src_const_env__ = __webpack_require__(3);

/* -----------------------------------------------------
 *  export-files-spec.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-14.
 * ----------------------------------------------------*/

/* global _ */


function ExportProjectSpec(project, children) {
    this.project = {};
    this.children = [];

    if (project) {
        this.project = project;
    }

    if (children && children instanceof Array) {
        this.children = this.children.concat(children);
    }
}

ExportProjectSpec.prototype.toJSON = function () {
    return {
        type: 'project',
        data: this.project.toJSON(),
        children: _.map(this.children, function (r) {
            return {
                type: r.getResourceName(),
                data: r.toJSON()
            };
        }),
        version: this.getCoreVersion()
    };
};

ExportProjectSpec.prototype.setProject = function (project) {
    this.project = project;
    return this;
};

ExportProjectSpec.prototype.addFile = function (file) {
    this.children.add(file);
    return this;
};

ExportProjectSpec.prototype.addFiles = function (files) {
    this.children = this.children.concat(files);
    return this;
};

ExportProjectSpec.prototype.getProject = function () {
    return this.project;
};

ExportProjectSpec.prototype.getFiles = function () {
    return this.children;
};

ExportProjectSpec.prototype.getCoreVersion = function () {
    return __WEBPACK_IMPORTED_MODULE_0__src_const_env__["CORE_VERSION"];
};




/***/ }),
/* 29 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ExportFilesSpec; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__src_const_env__ = __webpack_require__(3);
/* -----------------------------------------------------
 *  export-files-spec.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-14.
 * ----------------------------------------------------*/

/* global _  */


function ExportFilesSpec(data) {
    this.data = [];

    if (data) {
        if (data instanceof Array) {
            this.data = this.data.concat(data);
        } else {
            this.data.push(data);
        }
    }
}

ExportFilesSpec.prototype.toJSON = function () {
    return {
        type: 'files',
        data: _.map(this.data, function (data) {
            return {
                type: data.getResourceName(),
                data: data.toJSON(true)
            };
        }),
        version: this.getCoreVersion()
    };
};

ExportFilesSpec.prototype.addFile = function (file) {
    this.data.push(file);
    return this;
};

ExportFilesSpec.prototype.addFiles = function (files) {
    this.data = this.data.concat(files);
    return this;
};

ExportFilesSpec.prototype.getFiles = function () {
    return this.data;
};

ExportFilesSpec.prototype.getCoreVersion = function () {
    return __WEBPACK_IMPORTED_MODULE_0__src_const_env__["CORE_VERSION"];
};




/***/ }),
/* 30 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__public_js_va_source_core_components_controls_index__ = __webpack_require__(31);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__public_js_va_source_core_dao_index__ = __webpack_require__(52);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__data_structures_index__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__public_js_va_source_core_resource_manager_resource_manager__ = __webpack_require__(25);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__fnunit_fnunit_utils__ = __webpack_require__(26);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__fnunit_fnunit_inputs__ = __webpack_require__(63);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__fnunit_key_items__ = __webpack_require__(64);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__board_status_board__ = __webpack_require__(65);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__event_emitter_event_emitter__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__public_js_va_source_core_vomodels_index__ = __webpack_require__(10);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__utils_inherits__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__idgenerator__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__idgenerator___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_11__idgenerator__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12__public_js_va_source_core_service_index__ = __webpack_require__(67);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_13__utils_promise_utils__ = __webpack_require__(9);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_14__utils_object_utils__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_15_crel__ = __webpack_require__(71);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_15_crel___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_15_crel__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_16__tab_channel_tab_channel__ = __webpack_require__(72);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_17__const_data_types__ = __webpack_require__(73);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_18__model_diff_model_diff__ = __webpack_require__(74);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_19__const_env__ = __webpack_require__(3);
/* -----------------------------------------------------
 *  entry.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-13.
 * ----------------------------------------------------*/























// import './data-structures/entry';

/* global _ */

window.__module__ = window.__module__ || {};

window.brtc_require = function (moduleName) {
    return window.__module__[moduleName];
};

var attach = function (key, obj) {
    window.__module__[key] = window.__module__[key] || {};
    window.__module__[key] = obj;
};

attach('DataStructures', {
    HashMap: __WEBPACK_IMPORTED_MODULE_2__data_structures_index__["a" /* HashMap */],
    ProjectTree: __WEBPACK_IMPORTED_MODULE_2__data_structures_index__["b" /* ProjectTree */],
    TreeNode: __WEBPACK_IMPORTED_MODULE_2__data_structures_index__["c" /* TreeNode */]
});

attach('Dao', {
    ProjectDao: __WEBPACK_IMPORTED_MODULE_1__public_js_va_source_core_dao_index__["c" /* ProjectDao */],
    FileDao: __WEBPACK_IMPORTED_MODULE_1__public_js_va_source_core_dao_index__["b" /* FileDao */],
    VersionDao: __WEBPACK_IMPORTED_MODULE_1__public_js_va_source_core_dao_index__["d" /* VersionDao */],
    DatasourceDao: __WEBPACK_IMPORTED_MODULE_1__public_js_va_source_core_dao_index__["a" /* DatasourceDao */]
});

attach('Controls', __WEBPACK_IMPORTED_MODULE_0__public_js_va_source_core_components_controls_index__["a" /* Controls */]);
attach('ResourceManager', __WEBPACK_IMPORTED_MODULE_3__public_js_va_source_core_resource_manager_resource_manager__["a" /* ResourceManager */]);
attach('FnUnitUtils', __WEBPACK_IMPORTED_MODULE_4__fnunit_fnunit_utils__["a" /* FnUnitUtils */]);
attach('FnUnitInputs', __WEBPACK_IMPORTED_MODULE_5__fnunit_fnunit_inputs__["a" /* FnUnitInputs */]);
attach('StatusBoard', __WEBPACK_IMPORTED_MODULE_7__board_status_board__["a" /* StatusBoard */]);
attach('KeyItems', __WEBPACK_IMPORTED_MODULE_6__fnunit_key_items__["a" /* KeyItems */]);
attach('Vo', {
    Project: __WEBPACK_IMPORTED_MODULE_9__public_js_va_source_core_vomodels_index__["c" /* Project */],
    File: __WEBPACK_IMPORTED_MODULE_9__public_js_va_source_core_vomodels_index__["a" /* File */],
    Version: __WEBPACK_IMPORTED_MODULE_9__public_js_va_source_core_vomodels_index__["d" /* Version */],
    PROP_KEY: __WEBPACK_IMPORTED_MODULE_9__public_js_va_source_core_vomodels_index__["b" /* PROP_KEY */]
});

_.forIn(__WEBPACK_IMPORTED_MODULE_9__public_js_va_source_core_vomodels_index__["b" /* PROP_KEY */], function (val, key) {
    window[key] = val;
});

attach('EventEmitter', __WEBPACK_IMPORTED_MODULE_8__event_emitter_event_emitter__["a" /* EventEmitter */]);

attach('ClassUtils', {
    inherits: __WEBPACK_IMPORTED_MODULE_10__utils_inherits__["a" /* inherits */]
});

attach('IDGenerator', __WEBPACK_IMPORTED_MODULE_11__idgenerator___default.a);
attach('ResourceService', __WEBPACK_IMPORTED_MODULE_12__public_js_va_source_core_service_index__["a" /* ResourceService */]);
attach('PromiseUtils', {
    serial: __WEBPACK_IMPORTED_MODULE_13__utils_promise_utils__["b" /* serial */],
    parallel: __WEBPACK_IMPORTED_MODULE_13__utils_promise_utils__["a" /* parallel */]
});

attach('ObjectUtils', {
    get: __WEBPACK_IMPORTED_MODULE_14__utils_object_utils__["b" /* get */],
    updateProp: __WEBPACK_IMPORTED_MODULE_14__utils_object_utils__["d" /* updateProp */],
    addProp: __WEBPACK_IMPORTED_MODULE_14__utils_object_utils__["a" /* addProp */],
    removeProp: __WEBPACK_IMPORTED_MODULE_14__utils_object_utils__["c" /* removeProp */]
});

attach('_', _);

window.crel = __WEBPACK_IMPORTED_MODULE_15_crel___default.a;
attach('crel', __WEBPACK_IMPORTED_MODULE_15_crel___default.a);

attach('TabChannel', __WEBPACK_IMPORTED_MODULE_16__tab_channel_tab_channel__["a" /* TabChannel */]);
attach('DATA_TYPES', __WEBPACK_IMPORTED_MODULE_17__const_data_types__["a" /* DATA_TYPES */]);
attach('modelDiff', __WEBPACK_IMPORTED_MODULE_18__model_diff_model_diff__["a" /* modelDiff */]);
attach('ENV', __WEBPACK_IMPORTED_MODULE_19__const_env__);


/***/ }),
/* 31 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Controls; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__list_listwrapper__ = __webpack_require__(11);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__list_jqxlistwrapper__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__dropdown_dropdownwrapper__ = __webpack_require__(14);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__dropdown_jqxdropdownwrapper__ = __webpack_require__(15);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__base_base__ = __webpack_require__(4);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__base_controlfactory__ = __webpack_require__(51);








var Controls = {
    Wrapper: {
        ListWrapper: __WEBPACK_IMPORTED_MODULE_0__list_listwrapper__["a" /* ListWrapper */],
        JqxListWrapper: __WEBPACK_IMPORTED_MODULE_1__list_jqxlistwrapper__["a" /* JqxListWrapper */],
        DropdownWrapper: __WEBPACK_IMPORTED_MODULE_2__dropdown_dropdownwrapper__["a" /* DropdownWrapper */],
        JqxDropdownWrapper: __WEBPACK_IMPORTED_MODULE_3__dropdown_jqxdropdownwrapper__["a" /* JqxDropdownWrapper */]
    },
    Base: __WEBPACK_IMPORTED_MODULE_4__base_base__["a" /* Base */],
    ControlFactory: __WEBPACK_IMPORTED_MODULE_5__base_controlfactory__["a" /* ControlFactory */]
};



/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var d        = __webpack_require__(33)
  , callable = __webpack_require__(50)

  , apply = Function.prototype.apply, call = Function.prototype.call
  , create = Object.create, defineProperty = Object.defineProperty
  , defineProperties = Object.defineProperties
  , hasOwnProperty = Object.prototype.hasOwnProperty
  , descriptor = { configurable: true, enumerable: false, writable: true }

  , on, once, off, emit, methods, descriptors, base;

on = function (type, listener) {
	var data;

	callable(listener);

	if (!hasOwnProperty.call(this, '__ee__')) {
		data = descriptor.value = create(null);
		defineProperty(this, '__ee__', descriptor);
		descriptor.value = null;
	} else {
		data = this.__ee__;
	}
	if (!data[type]) data[type] = listener;
	else if (typeof data[type] === 'object') data[type].push(listener);
	else data[type] = [data[type], listener];

	return this;
};

once = function (type, listener) {
	var once, self;

	callable(listener);
	self = this;
	on.call(this, type, once = function () {
		off.call(self, type, once);
		apply.call(listener, this, arguments);
	});

	once.__eeOnceListener__ = listener;
	return this;
};

off = function (type, listener) {
	var data, listeners, candidate, i;

	callable(listener);

	if (!hasOwnProperty.call(this, '__ee__')) return this;
	data = this.__ee__;
	if (!data[type]) return this;
	listeners = data[type];

	if (typeof listeners === 'object') {
		for (i = 0; (candidate = listeners[i]); ++i) {
			if ((candidate === listener) ||
					(candidate.__eeOnceListener__ === listener)) {
				if (listeners.length === 2) data[type] = listeners[i ? 0 : 1];
				else listeners.splice(i, 1);
			}
		}
	} else {
		if ((listeners === listener) ||
				(listeners.__eeOnceListener__ === listener)) {
			delete data[type];
		}
	}

	return this;
};

emit = function (type) {
	var i, l, listener, listeners, args;

	if (!hasOwnProperty.call(this, '__ee__')) return;
	listeners = this.__ee__[type];
	if (!listeners) return;

	if (typeof listeners === 'object') {
		l = arguments.length;
		args = new Array(l - 1);
		for (i = 1; i < l; ++i) args[i - 1] = arguments[i];

		listeners = listeners.slice();
		for (i = 0; (listener = listeners[i]); ++i) {
			apply.call(listener, this, args);
		}
	} else {
		switch (arguments.length) {
		case 1:
			call.call(listeners, this);
			break;
		case 2:
			call.call(listeners, this, arguments[1]);
			break;
		case 3:
			call.call(listeners, this, arguments[1], arguments[2]);
			break;
		default:
			l = arguments.length;
			args = new Array(l - 1);
			for (i = 1; i < l; ++i) {
				args[i - 1] = arguments[i];
			}
			apply.call(listeners, this, args);
		}
	}
};

methods = {
	on: on,
	once: once,
	off: off,
	emit: emit
};

descriptors = {
	on: d(on),
	once: d(once),
	off: d(off),
	emit: d(emit)
};

base = defineProperties({}, descriptors);

module.exports = exports = function (o) {
	return (o == null) ? create(base) : defineProperties(Object(o), descriptors);
};
exports.methods = methods;


/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isValue         = __webpack_require__(12)
  , isPlainFunction = __webpack_require__(34)
  , assign          = __webpack_require__(38)
  , normalizeOpts   = __webpack_require__(46)
  , contains        = __webpack_require__(47);

var d = (module.exports = function (dscr, value/*, options*/) {
	var c, e, w, options, desc;
	if (arguments.length < 2 || typeof dscr !== "string") {
		options = value;
		value = dscr;
		dscr = null;
	} else {
		options = arguments[2];
	}
	if (isValue(dscr)) {
		c = contains.call(dscr, "c");
		e = contains.call(dscr, "e");
		w = contains.call(dscr, "w");
	} else {
		c = w = true;
		e = false;
	}

	desc = { value: value, configurable: c, enumerable: e, writable: w };
	return !options ? desc : assign(normalizeOpts(options), desc);
});

d.gs = function (dscr, get, set/*, options*/) {
	var c, e, options, desc;
	if (typeof dscr !== "string") {
		options = set;
		set = get;
		get = dscr;
		dscr = null;
	} else {
		options = arguments[3];
	}
	if (!isValue(get)) {
		get = undefined;
	} else if (!isPlainFunction(get)) {
		options = get;
		get = set = undefined;
	} else if (!isValue(set)) {
		set = undefined;
	} else if (!isPlainFunction(set)) {
		options = set;
		set = undefined;
	}
	if (isValue(dscr)) {
		c = contains.call(dscr, "c");
		e = contains.call(dscr, "e");
	} else {
		c = true;
		e = false;
	}

	desc = { get: get, set: set, configurable: c, enumerable: e };
	return !options ? desc : assign(normalizeOpts(options), desc);
};


/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isFunction = __webpack_require__(35);

var classRe = /^\s*class[\s{/}]/, functionToString = Function.prototype.toString;

module.exports = function (value) {
	if (!isFunction(value)) return false;
	if (classRe.test(functionToString.call(value))) return false;
	return true;
};


/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isPrototype = __webpack_require__(36);

module.exports = function (value) {
	if (typeof value !== "function") return false;

	if (!hasOwnProperty.call(value, "length")) return false;

	try {
		if (typeof value.length !== "number") return false;
		if (typeof value.call !== "function") return false;
		if (typeof value.apply !== "function") return false;
	} catch (error) {
		return false;
	}

	return !isPrototype(value);
};


/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isObject = __webpack_require__(37);

module.exports = function (value) {
	if (!isObject(value)) return false;
	try {
		if (!value.constructor) return false;
		return value.constructor.prototype === value;
	} catch (error) {
		return false;
	}
};


/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isValue = __webpack_require__(12);

// prettier-ignore
var possibleTypes = { "object": true, "function": true, "undefined": true /* document.all */ };

module.exports = function (value) {
	if (!isValue(value)) return false;
	return hasOwnProperty.call(possibleTypes, typeof value);
};


/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = __webpack_require__(39)()
	? Object.assign
	: __webpack_require__(40);


/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = function () {
	var assign = Object.assign, obj;
	if (typeof assign !== "function") return false;
	obj = { foo: "raz" };
	assign(obj, { bar: "dwa" }, { trzy: "trzy" });
	return (obj.foo + obj.bar + obj.trzy) === "razdwatrzy";
};


/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var keys  = __webpack_require__(41)
  , value = __webpack_require__(45)
  , max   = Math.max;

module.exports = function (dest, src /*, …srcn*/) {
	var error, i, length = max(arguments.length, 2), assign;
	dest = Object(value(dest));
	assign = function (key) {
		try {
			dest[key] = src[key];
		} catch (e) {
			if (!error) error = e;
		}
	};
	for (i = 1; i < length; ++i) {
		src = arguments[i];
		keys(src).forEach(assign);
	}
	if (error !== undefined) throw error;
	return dest;
};


/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = __webpack_require__(42)() ? Object.keys : __webpack_require__(43);


/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = function () {
	try {
		Object.keys("primitive");
		return true;
	} catch (e) {
		return false;
	}
};


/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isValue = __webpack_require__(5);

var keys = Object.keys;

module.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };


/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


// eslint-disable-next-line no-empty-function
module.exports = function () {};


/***/ }),
/* 45 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isValue = __webpack_require__(5);

module.exports = function (value) {
	if (!isValue(value)) throw new TypeError("Cannot use null or undefined");
	return value;
};


/***/ }),
/* 46 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var isValue = __webpack_require__(5);

var forEach = Array.prototype.forEach, create = Object.create;

var process = function (src, obj) {
	var key;
	for (key in src) obj[key] = src[key];
};

// eslint-disable-next-line no-unused-vars
module.exports = function (opts1 /*, …options*/) {
	var result = create(null);
	forEach.call(arguments, function (options) {
		if (!isValue(options)) return;
		process(Object(options), result);
	});
	return result;
};


/***/ }),
/* 47 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = __webpack_require__(48)()
	? String.prototype.contains
	: __webpack_require__(49);


/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var str = "razdwatrzy";

module.exports = function () {
	if (typeof str.contains !== "function") return false;
	return (str.contains("dwa") === true) && (str.contains("foo") === false);
};


/***/ }),
/* 49 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var indexOf = String.prototype.indexOf;

module.exports = function (searchString/*, position*/) {
	return indexOf.call(this, searchString, arguments[1]) > -1;
};


/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = function (fn) {
	if (typeof fn !== "function") throw new TypeError(fn + " is not a function");
	return fn;
};


/***/ }),
/* 51 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ControlFactory; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__list_jqxlistwrapper__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__dropdown_jqxdropdownwrapper__ = __webpack_require__(15);
/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 23
 */





var ControlFactory = (function () {
    var createListControl = function ($parent, options) {
        return new __WEBPACK_IMPORTED_MODULE_0__list_jqxlistwrapper__["a" /* JqxListWrapper */]($parent, options);
    };

    var createDropdownControl = function ($parent, options) {
        return new __WEBPACK_IMPORTED_MODULE_1__dropdown_jqxdropdownwrapper__["a" /* JqxDropdownWrapper */]($parent, options);
    };

    return {
        createListControl: createListControl,
        createDropdownControl: createDropdownControl
    };
}());




/***/ }),
/* 52 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__file_dao__ = __webpack_require__(16);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__project_dao__ = __webpack_require__(18);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__version_dao__ = __webpack_require__(20);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__datasource_dao__ = __webpack_require__(54);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return __WEBPACK_IMPORTED_MODULE_0__file_dao__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return __WEBPACK_IMPORTED_MODULE_1__project_dao__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "d", function() { return __WEBPACK_IMPORTED_MODULE_2__version_dao__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return __WEBPACK_IMPORTED_MODULE_3__datasource_dao__["a"]; });








/***/ }),
/* 53 */
/***/ (function(module, exports, __webpack_require__) {

var require;var require;!function(e){if(true)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.objectHash=e()}}(function(){return function e(t,n,r){function o(u,a){if(!n[u]){if(!t[u]){var f="function"==typeof require&&require;if(!a&&f)return require(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var s=n[u]={exports:{}};t[u][0].call(s.exports,function(e){var n=t[u][1][e];return o(n?n:e)},s,s.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){(function(r,o,i,u,a,f,s,c,l){"use strict";function d(e,t){return t=h(e,t),g(e,t)}function h(e,t){if(t=t||{},t.algorithm=t.algorithm||"sha1",t.encoding=t.encoding||"hex",t.excludeValues=!!t.excludeValues,t.algorithm=t.algorithm.toLowerCase(),t.encoding=t.encoding.toLowerCase(),t.ignoreUnknown=t.ignoreUnknown===!0,t.respectType=t.respectType!==!1,t.respectFunctionNames=t.respectFunctionNames!==!1,t.respectFunctionProperties=t.respectFunctionProperties!==!1,t.unorderedArrays=t.unorderedArrays===!0,t.unorderedSets=t.unorderedSets!==!1,t.unorderedObjects=t.unorderedObjects!==!1,t.replacer=t.replacer||void 0,t.excludeKeys=t.excludeKeys||void 0,"undefined"==typeof e)throw new Error("Object argument required.");for(var n=0;n<v.length;++n)v[n].toLowerCase()===t.algorithm.toLowerCase()&&(t.algorithm=v[n]);if(v.indexOf(t.algorithm)===-1)throw new Error('Algorithm "'+t.algorithm+'"  not supported. supported values: '+v.join(", "));if(m.indexOf(t.encoding)===-1&&"passthrough"!==t.algorithm)throw new Error('Encoding "'+t.encoding+'"  not supported. supported values: '+m.join(", "));return t}function p(e){if("function"!=typeof e)return!1;var t=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i;return null!=t.exec(Function.prototype.toString.call(e))}function g(e,t){var n;n="passthrough"!==t.algorithm?b.createHash(t.algorithm):new w,"undefined"==typeof n.write&&(n.write=n.update,n.end=n.update);var r=y(t,n);if(r.dispatch(e),n.update||n.end(""),n.digest)return n.digest("buffer"===t.encoding?void 0:t.encoding);var o=n.read();return"buffer"===t.encoding?o:o.toString(t.encoding)}function y(e,t,n){n=n||[];var r=function(e){return t.update?t.update(e,"utf8"):t.write(e,"utf8")};return{dispatch:function(t){e.replacer&&(t=e.replacer(t));var n=typeof t;return null===t&&(n="null"),this["_"+n](t)},_object:function(t){var o=/\[object (.*)\]/i,u=Object.prototype.toString.call(t),a=o.exec(u);a=a?a[1]:"unknown:["+u+"]",a=a.toLowerCase();var f=null;if((f=n.indexOf(t))>=0)return this.dispatch("[CIRCULAR:"+f+"]");if(n.push(t),"undefined"!=typeof i&&i.isBuffer&&i.isBuffer(t))return r("buffer:"),r(t);if("object"===a||"function"===a){var s=Object.keys(t);e.unorderedObjects&&(s=s.sort()),e.respectType===!1||p(t)||s.splice(0,0,"prototype","__proto__","constructor"),e.excludeKeys&&(s=s.filter(function(t){return!e.excludeKeys(t)})),r("object:"+s.length+":");var c=this;return s.forEach(function(n){c.dispatch(n),r(":"),e.excludeValues||c.dispatch(t[n]),r(",")})}if(!this["_"+a]){if(e.ignoreUnknown)return r("["+a+"]");throw new Error('Unknown object type "'+a+'"')}this["_"+a](t)},_array:function(t,o){o="undefined"!=typeof o?o:e.unorderedArrays!==!1;var i=this;if(r("array:"+t.length+":"),!o||t.length<=1)return t.forEach(function(e){return i.dispatch(e)});var u=[],a=t.map(function(t){var r=new w,o=n.slice(),i=y(e,r,o);return i.dispatch(t),u=u.concat(o.slice(n.length)),r.read().toString()});return n=n.concat(u),a.sort(),this._array(a,!1)},_date:function(e){return r("date:"+e.toJSON())},_symbol:function(e){return r("symbol:"+e.toString())},_error:function(e){return r("error:"+e.toString())},_boolean:function(e){return r("bool:"+e.toString())},_string:function(e){r("string:"+e.length+":"),r(e.toString())},_function:function(t){r("fn:"),p(t)?this.dispatch("[native]"):this.dispatch(t.toString()),e.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this._object(t)},_number:function(e){return r("number:"+e.toString())},_xml:function(e){return r("xml:"+e.toString())},_null:function(){return r("Null")},_undefined:function(){return r("Undefined")},_regexp:function(e){return r("regex:"+e.toString())},_uint8array:function(e){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){return r("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){return r("uint8array:"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){return r("uint16array:"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){return r("uint32array:"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){return r("float32array:"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){return r("float64array:"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){return r("arraybuffer:"),this.dispatch(new Uint8Array(e))},_url:function(e){return r("url:"+e.toString(),"utf8")},_map:function(t){r("map:");var n=Array.from(t);return this._array(n,e.unorderedSets!==!1)},_set:function(t){r("set:");var n=Array.from(t);return this._array(n,e.unorderedSets!==!1)},_blob:function(){if(e.ignoreUnknown)return r("[blob]");throw Error('Hashing Blob objects is currently not supported\n(see https://github.com/puleos/object-hash/issues/26)\nUse "options.replacer" or "options.ignoreUnknown"\n')},_domwindow:function(){return r("domwindow")},_process:function(){return r("process")},_timer:function(){return r("timer")},_pipe:function(){return r("pipe")},_tcp:function(){return r("tcp")},_udp:function(){return r("udp")},_tty:function(){return r("tty")},_statwatcher:function(){return r("statwatcher")},_securecontext:function(){return r("securecontext")},_connection:function(){return r("connection")},_zlib:function(){return r("zlib")},_context:function(){return r("context")},_nodescript:function(){return r("nodescript")},_httpparser:function(){return r("httpparser")},_dataview:function(){return r("dataview")},_signal:function(){return r("signal")},_fsevent:function(){return r("fsevent")},_tlswrap:function(){return r("tlswrap")}}}function w(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}var b=e("crypto");n=t.exports=d,n.sha1=function(e){return d(e)},n.keys=function(e){return d(e,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},n.MD5=function(e){return d(e,{algorithm:"md5",encoding:"hex"})},n.keysMD5=function(e){return d(e,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var v=b.getHashes?b.getHashes().slice():["sha1","md5"];v.push("passthrough");var m=["buffer","hex","binary","base64"];n.writeToStream=function(e,t,n){return"undefined"==typeof n&&(n=t,t={}),t=h(e,t),y(t,n).dispatch(e)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_e8180ef5.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(e,t,n){(function(e,t,r,o,i,u,a,f,s){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(e){"use strict";function t(e){var t=e.charCodeAt(0);return t===i||t===l?62:t===u||t===d?63:t<a?-1:t<a+10?t-a+26+26:t<s+26?t-s:t<f+26?t-f+26:void 0}function n(e){function n(e){s[l++]=e}var r,i,u,a,f,s;if(e.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=e.length;f="="===e.charAt(c-2)?2:"="===e.charAt(c-1)?1:0,s=new o(3*e.length/4-f),u=f>0?e.length-4:e.length;var l=0;for(r=0,i=0;r<u;r+=4,i+=3)a=t(e.charAt(r))<<18|t(e.charAt(r+1))<<12|t(e.charAt(r+2))<<6|t(e.charAt(r+3)),n((16711680&a)>>16),n((65280&a)>>8),n(255&a);return 2===f?(a=t(e.charAt(r))<<2|t(e.charAt(r+1))>>4,n(255&a)):1===f&&(a=t(e.charAt(r))<<10|t(e.charAt(r+1))<<4|t(e.charAt(r+2))>>2,n(a>>8&255),n(255&a)),s}function r(e){function t(e){return c.charAt(e)}function n(e){return t(e>>18&63)+t(e>>12&63)+t(e>>6&63)+t(63&e)}var r,o,i,u=e.length%3,a="";for(r=0,i=e.length-u;r<i;r+=3)o=(e[r]<<16)+(e[r+1]<<8)+e[r+2],a+=n(o);switch(u){case 1:o=e[e.length-1],a+=t(o>>2),a+=t(o<<4&63),a+="==";break;case 2:o=(e[e.length-2]<<8)+e[e.length-1],a+=t(o>>10),a+=t(o>>4&63),a+=t(o<<2&63),a+="="}return a}var o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="+".charCodeAt(0),u="/".charCodeAt(0),a="0".charCodeAt(0),f="a".charCodeAt(0),s="A".charCodeAt(0),l="-".charCodeAt(0),d="_".charCodeAt(0);e.toByteArray=n,e.fromByteArray=r}("undefined"==typeof n?this.base64js={}:n)}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(e,t,n){(function(t,r,o,i,u,a,f,s,c){function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);var r=typeof e;if("base64"===t&&"string"===r)for(e=N(e);e.length%4!==0;)e+="=";var i;if("number"===r)i=F(e);else if("string"===r)i=o.byteLength(e,t);else{if("object"!==r)throw new Error("First argument needs to be a number, array or string.");i=F(e.length)}var u;o._useTypedArrays?u=o._augment(new Uint8Array(i)):(u=this,u.length=i,u._isBuffer=!0);var a;if(o._useTypedArrays&&"number"==typeof e.byteLength)u._set(e);else if(O(e))for(a=0;a<i;a++)o.isBuffer(e)?u[a]=e.readUInt8(a):u[a]=e[a];else if("string"===r)u.write(e,0,t);else if("number"===r&&!o._useTypedArrays&&!n)for(a=0;a<i;a++)u[a]=0;return u}function l(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var u=t.length;$(u%2===0,"Invalid hex string"),r>u/2&&(r=u/2);for(var a=0;a<r;a++){var f=parseInt(t.substr(2*a,2),16);$(!isNaN(f),"Invalid hex string"),e[n+a]=f}return o._charsWritten=2*a,a}function d(e,t,n,r){var i=o._charsWritten=W(V(t),e,n,r);return i}function h(e,t,n,r){var i=o._charsWritten=W(q(t),e,n,r);return i}function p(e,t,n,r){return h(e,t,n,r)}function g(e,t,n,r){var i=o._charsWritten=W(R(t),e,n,r);return i}function y(e,t,n,r){var i=o._charsWritten=W(P(t),e,n,r);return i}function w(e,t,n){return 0===t&&n===e.length?G.fromByteArray(e):G.fromByteArray(e.slice(t,n))}function b(e,t,n){var r="",o="";n=Math.min(e.length,n);for(var i=t;i<n;i++)e[i]<=127?(r+=J(o)+String.fromCharCode(e[i]),o=""):o+="%"+e[i].toString(16);return r+J(o)}function v(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;o++)r+=String.fromCharCode(e[o]);return r}function m(e,t,n){return v(e,t,n)}function _(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;i++)o+=H(e[i]);return o}function E(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function I(e,t,n,r){r||($("boolean"==typeof n,"missing or invalid endian"),$(void 0!==t&&null!==t,"missing offset"),$(t+1<e.length,"Trying to read beyond buffer length"));var o=e.length;if(!(t>=o)){var i;return n?(i=e[t],t+1<o&&(i|=e[t+1]<<8)):(i=e[t]<<8,t+1<o&&(i|=e[t+1])),i}}function A(e,t,n,r){r||($("boolean"==typeof n,"missing or invalid endian"),$(void 0!==t&&null!==t,"missing offset"),$(t+3<e.length,"Trying to read beyond buffer length"));var o=e.length;if(!(t>=o)){var i;return n?(t+2<o&&(i=e[t+2]<<16),t+1<o&&(i|=e[t+1]<<8),i|=e[t],t+3<o&&(i+=e[t+3]<<24>>>0)):(t+1<o&&(i=e[t+1]<<16),t+2<o&&(i|=e[t+2]<<8),t+3<o&&(i|=e[t+3]),i+=e[t]<<24>>>0),i}}function B(e,t,n,r){r||($("boolean"==typeof n,"missing or invalid endian"),$(void 0!==t&&null!==t,"missing offset"),$(t+1<e.length,"Trying to read beyond buffer length"));var o=e.length;if(!(t>=o)){var i=I(e,t,n,!0),u=32768&i;return u?(65535-i+1)*-1:i}}function L(e,t,n,r){r||($("boolean"==typeof n,"missing or invalid endian"),$(void 0!==t&&null!==t,"missing offset"),$(t+3<e.length,"Trying to read beyond buffer length"));var o=e.length;if(!(t>=o)){var i=A(e,t,n,!0),u=2147483648&i;return u?(4294967295-i+1)*-1:i}}function U(e,t,n,r){return r||($("boolean"==typeof n,"missing or invalid endian"),$(t+3<e.length,"Trying to read beyond buffer length")),Q.read(e,t,n,23,4)}function x(e,t,n,r){return r||($("boolean"==typeof n,"missing or invalid endian"),$(t+7<e.length,"Trying to read beyond buffer length")),Q.read(e,t,n,52,8)}function S(e,t,n,r,o){o||($(void 0!==t&&null!==t,"missing value"),$("boolean"==typeof r,"missing or invalid endian"),$(void 0!==n&&null!==n,"missing offset"),$(n+1<e.length,"trying to write beyond buffer length"),K(t,65535));var i=e.length;if(!(n>=i))for(var u=0,a=Math.min(i-n,2);u<a;u++)e[n+u]=(t&255<<8*(r?u:1-u))>>>8*(r?u:1-u)}function j(e,t,n,r,o){o||($(void 0!==t&&null!==t,"missing value"),$("boolean"==typeof r,"missing or invalid endian"),$(void 0!==n&&null!==n,"missing offset"),$(n+3<e.length,"trying to write beyond buffer length"),K(t,4294967295));var i=e.length;if(!(n>=i))for(var u=0,a=Math.min(i-n,4);u<a;u++)e[n+u]=t>>>8*(r?u:3-u)&255}function C(e,t,n,r,o){o||($(void 0!==t&&null!==t,"missing value"),$("boolean"==typeof r,"missing or invalid endian"),$(void 0!==n&&null!==n,"missing offset"),$(n+1<e.length,"Trying to write beyond buffer length"),z(t,32767,-32768));var i=e.length;n>=i||(t>=0?S(e,t,n,r,o):S(e,65535+t+1,n,r,o))}function k(e,t,n,r,o){o||($(void 0!==t&&null!==t,"missing value"),$("boolean"==typeof r,"missing or invalid endian"),$(void 0!==n&&null!==n,"missing offset"),$(n+3<e.length,"Trying to write beyond buffer length"),z(t,2147483647,-2147483648));var i=e.length;n>=i||(t>=0?j(e,t,n,r,o):j(e,4294967295+t+1,n,r,o))}function T(e,t,n,r,o){o||($(void 0!==t&&null!==t,"missing value"),$("boolean"==typeof r,"missing or invalid endian"),$(void 0!==n&&null!==n,"missing offset"),$(n+3<e.length,"Trying to write beyond buffer length"),X(t,3.4028234663852886e38,-3.4028234663852886e38));var i=e.length;n>=i||Q.write(e,t,n,r,23,4)}function M(e,t,n,r,o){o||($(void 0!==t&&null!==t,"missing value"),$("boolean"==typeof r,"missing or invalid endian"),$(void 0!==n&&null!==n,"missing offset"),$(n+7<e.length,"Trying to write beyond buffer length"),X(t,1.7976931348623157e308,-1.7976931348623157e308));var i=e.length;n>=i||Q.write(e,t,n,r,52,8)}function N(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Y(e,t,n){return"number"!=typeof e?n:(e=~~e,e>=t?t:e>=0?e:(e+=t,e>=0?e:0))}function F(e){return e=~~Math.ceil(+e),e<0?0:e}function D(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function O(e){return D(e)||o.isBuffer(e)||e&&"object"==typeof e&&"number"==typeof e.length}function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(e.charCodeAt(n));else{var o=n;r>=55296&&r<=57343&&n++;for(var i=encodeURIComponent(e.slice(o,n+1)).substr(1).split("%"),u=0;u<i.length;u++)t.push(parseInt(i[u],16))}}return t}function q(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}function P(e){for(var t,n,r,o=[],i=0;i<e.length;i++)t=e.charCodeAt(i),n=t>>8,r=t%256,o.push(r),o.push(n);return o}function R(e){return G.toByteArray(e)}function W(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);o++)t[o+n]=e[o];return o}function J(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}function K(e,t){$("number"==typeof e,"cannot write a non-number as a number"),$(e>=0,"specified a negative value for writing an unsigned value"),$(e<=t,"value is larger than maximum value for type"),$(Math.floor(e)===e,"value has a fractional component")}function z(e,t,n){$("number"==typeof e,"cannot write a non-number as a number"),$(e<=t,"value larger than maximum allowed value"),$(e>=n,"value smaller than minimum allowed value"),$(Math.floor(e)===e,"value has a fractional component")}function X(e,t,n){$("number"==typeof e,"cannot write a non-number as a number"),$(e<=t,"value larger than maximum allowed value"),$(e>=n,"value smaller than minimum allowed value")}function $(e,t){if(!e)throw new Error(t||"Failed assertion")}var G=e("base64-js"),Q=e("ieee754");n.Buffer=o,n.SlowBuffer=o,n.INSPECT_MAX_BYTES=50,o.poolSize=8192,o._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(n){return!1}}(),o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.isBuffer=function(e){return!(null===e||void 0===e||!e._isBuffer)},o.byteLength=function(e,t){var n;switch(e+="",t||"utf8"){case"hex":n=e.length/2;break;case"utf8":case"utf-8":n=V(e).length;break;case"ascii":case"binary":case"raw":n=e.length;break;case"base64":n=R(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=2*e.length;break;default:throw new Error("Unknown encoding")}return n},o.concat=function(e,t){if($(D(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new o(0);if(1===e.length)return e[0];var n;if("number"!=typeof t)for(t=0,n=0;n<e.length;n++)t+=e[n].length;var r=new o(t),i=0;for(n=0;n<e.length;n++){var u=e[n];u.copy(r,i),i+=u.length}return r},o.prototype.write=function(e,t,n,r){if(isFinite(t))isFinite(n)||(r=n,n=void 0);else{var o=r;r=t,t=n,n=o}t=Number(t)||0;var i=this.length-t;n?(n=Number(n),n>i&&(n=i)):n=i,r=String(r||"utf8").toLowerCase();var u;switch(r){case"hex":u=l(this,e,t,n);break;case"utf8":case"utf-8":u=d(this,e,t,n);break;case"ascii":u=h(this,e,t,n);break;case"binary":u=p(this,e,t,n);break;case"base64":u=g(this,e,t,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":u=y(this,e,t,n);break;default:throw new Error("Unknown encoding")}return u},o.prototype.toString=function(e,t,n){var r=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,n=void 0!==n?Number(n):n=r.length,n===t)return"";var o;switch(e){case"hex":o=_(r,t,n);break;case"utf8":case"utf-8":o=b(r,t,n);break;case"ascii":o=v(r,t,n);break;case"binary":o=m(r,t,n);break;case"base64":o=w(r,t,n);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=E(r,t,n);break;default:throw new Error("Unknown encoding")}return o},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.copy=function(e,t,n,r){var i=this;if(n||(n=0),r||0===r||(r=this.length),t||(t=0),r!==n&&0!==e.length&&0!==i.length){$(r>=n,"sourceEnd < sourceStart"),$(t>=0&&t<e.length,"targetStart out of bounds"),$(n>=0&&n<i.length,"sourceStart out of bounds"),$(r>=0&&r<=i.length,"sourceEnd out of bounds"),r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var u=r-n;if(u<100||!o._useTypedArrays)for(var a=0;a<u;a++)e[a+t]=this[a+n];else e._set(this.subarray(n,n+u),t)}},o.prototype.slice=function(e,t){var n=this.length;if(e=Y(e,n,0),t=Y(t,n,n),o._useTypedArrays)return o._augment(this.subarray(e,t));for(var r=t-e,i=new o(r,(void 0),(!0)),u=0;u<r;u++)i[u]=this[u+e];return i},o.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},o.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},o.prototype.readUInt8=function(e,t){if(t||($(void 0!==e&&null!==e,"missing offset"),$(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},o.prototype.readUInt16LE=function(e,t){return I(this,e,!0,t)},o.prototype.readUInt16BE=function(e,t){return I(this,e,!1,t)},o.prototype.readUInt32LE=function(e,t){return A(this,e,!0,t)},o.prototype.readUInt32BE=function(e,t){return A(this,e,!1,t)},o.prototype.readInt8=function(e,t){if(t||($(void 0!==e&&null!==e,"missing offset"),$(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length)){var n=128&this[e];return n?(255-this[e]+1)*-1:this[e]}},o.prototype.readInt16LE=function(e,t){return B(this,e,!0,t)},o.prototype.readInt16BE=function(e,t){return B(this,e,!1,t)},o.prototype.readInt32LE=function(e,t){return L(this,e,!0,t)},o.prototype.readInt32BE=function(e,t){return L(this,e,!1,t)},o.prototype.readFloatLE=function(e,t){return U(this,e,!0,t)},o.prototype.readFloatBE=function(e,t){return U(this,e,!1,t)},o.prototype.readDoubleLE=function(e,t){return x(this,e,!0,t)},o.prototype.readDoubleBE=function(e,t){return x(this,e,!1,t)},o.prototype.writeUInt8=function(e,t,n){n||($(void 0!==e&&null!==e,"missing value"),$(void 0!==t&&null!==t,"missing offset"),$(t<this.length,"trying to write beyond buffer length"),K(e,255)),t>=this.length||(this[t]=e)},o.prototype.writeUInt16LE=function(e,t,n){S(this,e,t,!0,n)},o.prototype.writeUInt16BE=function(e,t,n){S(this,e,t,!1,n)},o.prototype.writeUInt32LE=function(e,t,n){j(this,e,t,!0,n)},o.prototype.writeUInt32BE=function(e,t,n){j(this,e,t,!1,n)},o.prototype.writeInt8=function(e,t,n){n||($(void 0!==e&&null!==e,"missing value"),$(void 0!==t&&null!==t,"missing offset"),$(t<this.length,"Trying to write beyond buffer length"),z(e,127,-128)),t>=this.length||(e>=0?this.writeUInt8(e,t,n):this.writeUInt8(255+e+1,t,n))},o.prototype.writeInt16LE=function(e,t,n){C(this,e,t,!0,n)},o.prototype.writeInt16BE=function(e,t,n){C(this,e,t,!1,n)},o.prototype.writeInt32LE=function(e,t,n){k(this,e,t,!0,n)},o.prototype.writeInt32BE=function(e,t,n){k(this,e,t,!1,n)},o.prototype.writeFloatLE=function(e,t,n){T(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){T(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){M(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){M(this,e,t,!1,n)},o.prototype.fill=function(e,t,n){if(e||(e=0),t||(t=0),n||(n=this.length),"string"==typeof e&&(e=e.charCodeAt(0)),$("number"==typeof e&&!isNaN(e),"value is not a number"),$(n>=t,"end < start"),n!==t&&0!==this.length){$(t>=0&&t<this.length,"start out of bounds"),$(n>=0&&n<=this.length,"end out of bounds");for(var r=t;r<n;r++)this[r]=e}},o.prototype.inspect=function(){for(var e=[],t=this.length,r=0;r<t;r++)if(e[r]=H(this[r]),r===n.INSPECT_MAX_BYTES){e[r+1]="...";break}return"<Buffer "+e.join(" ")+">"},o.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(o._useTypedArrays)return new o(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var Z=o.prototype;o._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=Z.get,e.set=Z.set,e.write=Z.write,e.toString=Z.toString,e.toLocaleString=Z.toString,e.toJSON=Z.toJSON,e.copy=Z.copy,e.slice=Z.slice,e.readUInt8=Z.readUInt8,e.readUInt16LE=Z.readUInt16LE,e.readUInt16BE=Z.readUInt16BE,e.readUInt32LE=Z.readUInt32LE,e.readUInt32BE=Z.readUInt32BE,e.readInt8=Z.readInt8,e.readInt16LE=Z.readInt16LE,e.readInt16BE=Z.readInt16BE,e.readInt32LE=Z.readInt32LE,e.readInt32BE=Z.readInt32BE,e.readFloatLE=Z.readFloatLE,e.readFloatBE=Z.readFloatBE,e.readDoubleLE=Z.readDoubleLE,e.readDoubleBE=Z.readDoubleBE,e.writeUInt8=Z.writeUInt8,e.writeUInt16LE=Z.writeUInt16LE,e.writeUInt16BE=Z.writeUInt16BE,e.writeUInt32LE=Z.writeUInt32LE,e.writeUInt32BE=Z.writeUInt32BE,e.writeInt8=Z.writeInt8,e.writeInt16LE=Z.writeInt16LE,e.writeInt16BE=Z.writeInt16BE,e.writeInt32LE=Z.writeInt32LE,e.writeInt32BE=Z.writeInt32BE,e.writeFloatLE=Z.writeFloatLE,e.writeFloatBE=Z.writeFloatBE,e.writeDoubleLE=Z.writeDoubleLE,e.writeDoubleBE=Z.writeDoubleBE,e.fill=Z.fill,e.inspect=Z.inspect,e.toArrayBuffer=Z.toArrayBuffer,e}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(e,t,n){(function(n,r,o,i,u,a,f,s,c){function l(e,t){if(e.length%p!==0){var n=e.length+(p-e.length%p);e=o.concat([e,g],n)}for(var r=[],i=t?e.readInt32BE:e.readInt32LE,u=0;u<e.length;u+=p)r.push(i.call(e,u));return r}function d(e,t,n){for(var r=new o(t),i=n?r.writeInt32BE:r.writeInt32LE,u=0;u<e.length;u++)i.call(r,e[u],4*u,!0);return r}function h(e,t,n,r){o.isBuffer(e)||(e=new o(e));var i=t(l(e,r),e.length*y);return d(i,n,r)}var o=e("buffer").Buffer,p=4,g=new o(p);g.fill(0);var y=8;t.exports={hash:h}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(e,t,n){(function(t,r,o,i,u,a,f,s,c){function l(e,t,n){o.isBuffer(t)||(t=new o(t)),o.isBuffer(n)||(n=new o(n)),t.length>m?t=e(t):t.length<m&&(t=o.concat([t,_],m));for(var r=new o(m),i=new o(m),u=0;u<m;u++)r[u]=54^t[u],i[u]=92^t[u];var a=e(o.concat([r,n]));return e(o.concat([i,a]))}function d(e,t){e=e||"sha1";var n=v[e],r=[],i=0;return n||h("algorithm:",e,"is not yet supported"),{update:function(e){return o.isBuffer(e)||(e=new o(e)),r.push(e),i+=e.length,this},digest:function(e){var i=o.concat(r),u=t?l(n,t,i):n(i);return r=null,e?u.toString(e):u}}}function h(){var e=[].slice.call(arguments).join(" ");throw new Error([e,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"))}function p(e,t){for(var n in e)t(e[n],n)}var o=e("buffer").Buffer,g=e("./sha"),y=e("./sha256"),w=e("./rng"),b=e("./md5"),v={sha1:g,sha256:y,md5:b},m=64,_=new o(m);_.fill(0),n.createHash=function(e){return d(e)},n.createHmac=function(e,t){return d(e,t)},n.randomBytes=function(e,t){if(!t||!t.call)return new o(w(e));try{t.call(this,void 0,new o(w(e)))}catch(n){t(n)}},p(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(e){n[e]=function(){h("sorry,",e,"is not implemented yet")}})}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(e,t,n){(function(n,r,o,i,u,a,f,s,c){function l(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;for(var n=1732584193,r=-271733879,o=-1732584194,i=271733878,u=0;u<e.length;u+=16){var a=n,f=r,s=o,c=i;n=h(n,r,o,i,e[u+0],7,-680876936),i=h(i,n,r,o,e[u+1],12,-389564586),o=h(o,i,n,r,e[u+2],17,606105819),r=h(r,o,i,n,e[u+3],22,-1044525330),n=h(n,r,o,i,e[u+4],7,-176418897),i=h(i,n,r,o,e[u+5],12,1200080426),o=h(o,i,n,r,e[u+6],17,-1473231341),r=h(r,o,i,n,e[u+7],22,-45705983),n=h(n,r,o,i,e[u+8],7,1770035416),i=h(i,n,r,o,e[u+9],12,-1958414417),o=h(o,i,n,r,e[u+10],17,-42063),r=h(r,o,i,n,e[u+11],22,-1990404162),n=h(n,r,o,i,e[u+12],7,1804603682),i=h(i,n,r,o,e[u+13],12,-40341101),o=h(o,i,n,r,e[u+14],17,-1502002290),r=h(r,o,i,n,e[u+15],22,1236535329),n=p(n,r,o,i,e[u+1],5,-165796510),i=p(i,n,r,o,e[u+6],9,-1069501632),o=p(o,i,n,r,e[u+11],14,643717713),r=p(r,o,i,n,e[u+0],20,-373897302),n=p(n,r,o,i,e[u+5],5,-701558691),i=p(i,n,r,o,e[u+10],9,38016083),o=p(o,i,n,r,e[u+15],14,-660478335),r=p(r,o,i,n,e[u+4],20,-405537848),n=p(n,r,o,i,e[u+9],5,568446438),i=p(i,n,r,o,e[u+14],9,-1019803690),o=p(o,i,n,r,e[u+3],14,-187363961),r=p(r,o,i,n,e[u+8],20,1163531501),n=p(n,r,o,i,e[u+13],5,-1444681467),i=p(i,n,r,o,e[u+2],9,-51403784),o=p(o,i,n,r,e[u+7],14,1735328473),r=p(r,o,i,n,e[u+12],20,-1926607734),n=g(n,r,o,i,e[u+5],4,-378558),i=g(i,n,r,o,e[u+8],11,-2022574463),o=g(o,i,n,r,e[u+11],16,1839030562),r=g(r,o,i,n,e[u+14],23,-35309556),n=g(n,r,o,i,e[u+1],4,-1530992060),i=g(i,n,r,o,e[u+4],11,1272893353),o=g(o,i,n,r,e[u+7],16,-155497632),r=g(r,o,i,n,e[u+10],23,-1094730640),n=g(n,r,o,i,e[u+13],4,681279174),i=g(i,n,r,o,e[u+0],11,-358537222),o=g(o,i,n,r,e[u+3],16,-722521979),r=g(r,o,i,n,e[u+6],23,76029189),n=g(n,r,o,i,e[u+9],4,-640364487),i=g(i,n,r,o,e[u+12],11,-421815835),o=g(o,i,n,r,e[u+15],16,530742520),r=g(r,o,i,n,e[u+2],23,-995338651),n=y(n,r,o,i,e[u+0],6,-198630844),i=y(i,n,r,o,e[u+7],10,1126891415),o=y(o,i,n,r,e[u+14],15,-1416354905),r=y(r,o,i,n,e[u+5],21,-57434055),n=y(n,r,o,i,e[u+12],6,1700485571),i=y(i,n,r,o,e[u+3],10,-1894986606),o=y(o,i,n,r,e[u+10],15,-1051523),r=y(r,o,i,n,e[u+1],21,-2054922799),n=y(n,r,o,i,e[u+8],6,1873313359),i=y(i,n,r,o,e[u+15],10,-30611744),o=y(o,i,n,r,e[u+6],15,-1560198380),r=y(r,o,i,n,e[u+13],21,1309151649),n=y(n,r,o,i,e[u+4],6,-145523070),i=y(i,n,r,o,e[u+11],10,-1120210379),o=y(o,i,n,r,e[u+2],15,718787259),r=y(r,o,i,n,e[u+9],21,-343485551),n=w(n,a),r=w(r,f),o=w(o,s),i=w(i,c)}return Array(n,r,o,i)}function d(e,t,n,r,o,i){return w(b(w(w(t,e),w(r,i)),o),n)}function h(e,t,n,r,o,i,u){return d(t&n|~t&r,e,t,o,i,u)}function p(e,t,n,r,o,i,u){return d(t&r|n&~r,e,t,o,i,u)}function g(e,t,n,r,o,i,u){return d(t^n^r,e,t,o,i,u)}function y(e,t,n,r,o,i,u){return d(n^(t|~r),e,t,o,i,u)}function w(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function b(e,t){return e<<t|e>>>32-t}var v=e("./helpers");t.exports=function(e){return v.hash(e,l,16)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(e,t,n){(function(e,n,r,o,i,u,a,f,s){!function(){var e,n,r=this;e=function(e){for(var t,t,n=new Array(e),r=0;r<e;r++)0==(3&r)&&(t=4294967296*Math.random()),n[r]=t>>>((3&r)<<3)&255;return n},r.crypto&&crypto.getRandomValues&&(n=function(e){var t=new Uint8Array(e);return crypto.getRandomValues(t),t}),t.exports=n||e}()}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(e,t,n){(function(n,r,o,i,u,a,f,s,c){function l(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var n=Array(80),r=1732584193,o=-271733879,i=-1732584194,u=271733878,a=-1009589776,f=0;f<e.length;f+=16){for(var s=r,c=o,l=i,y=u,w=a,b=0;b<80;b++){b<16?n[b]=e[f+b]:n[b]=g(n[b-3]^n[b-8]^n[b-14]^n[b-16],1);var v=p(p(g(r,5),d(b,o,i,u)),p(p(a,n[b]),h(b)));a=u,u=i,i=g(o,30),o=r,r=v}r=p(r,s),o=p(o,c),i=p(i,l),u=p(u,y),a=p(a,w)}return Array(r,o,i,u,a)}function d(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function h(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function p(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function g(e,t){return e<<t|e>>>32-t}var y=e("./helpers");t.exports=function(e){return y.hash(e,l,20,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(e,t,n){(function(n,r,o,i,u,a,f,s,c){var l=e("./helpers"),d=function(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n},h=function(e,t){return e>>>t|e<<32-t},p=function(e,t){return e>>>t},g=function(e,t,n){return e&t^~e&n},y=function(e,t,n){return e&t^e&n^t&n},w=function(e){return h(e,2)^h(e,13)^h(e,22);
},b=function(e){return h(e,6)^h(e,11)^h(e,25)},v=function(e){return h(e,7)^h(e,18)^p(e,3)},m=function(e){return h(e,17)^h(e,19)^p(e,10)},_=function(e,t){var n,r,o,i,u,a,f,s,c,l,h,p,_=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),E=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),I=new Array(64);e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var c=0;c<e.length;c+=16){n=E[0],r=E[1],o=E[2],i=E[3],u=E[4],a=E[5],f=E[6],s=E[7];for(var l=0;l<64;l++)l<16?I[l]=e[l+c]:I[l]=d(d(d(m(I[l-2]),I[l-7]),v(I[l-15])),I[l-16]),h=d(d(d(d(s,b(u)),g(u,a,f)),_[l]),I[l]),p=d(w(n),y(n,r,o)),s=f,f=a,a=u,u=d(i,h),i=o,o=r,r=n,n=d(h,p);E[0]=d(n,E[0]),E[1]=d(r,E[1]),E[2]=d(o,E[2]),E[3]=d(i,E[3]),E[4]=d(u,E[4]),E[5]=d(a,E[5]),E[6]=d(f,E[6]),E[7]=d(s,E[7])}return E};t.exports=function(e){return l.hash(e,_,32,!0)}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(e,t,n){(function(e,n,r,o,i,u,a,f,s){function c(){}var e=t.exports={};e.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=c,e.addListener=c,e.once=c,e.off=c,e.removeListener=c,e.removeAllListeners=c,e.emit=c,e.binding=function(e){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw new Error("process.chdir is not supported")}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(e,t,n){(function(e,t,r,o,i,u,a,f,s){n.read=function(e,t,n,r,o){var i,u,a=8*o-r-1,f=(1<<a)-1,s=f>>1,c=-7,l=n?o-1:0,d=n?-1:1,h=e[t+l];for(l+=d,i=h&(1<<-c)-1,h>>=-c,c+=a;c>0;i=256*i+e[t+l],l+=d,c-=8);for(u=i&(1<<-c)-1,i>>=-c,c+=r;c>0;u=256*u+e[t+l],l+=d,c-=8);if(0===i)i=1-s;else{if(i===f)return u?NaN:(h?-1:1)*(1/0);u+=Math.pow(2,r),i-=s}return(h?-1:1)*u*Math.pow(2,i-r)},n.write=function(e,t,n,r,o,i){var u,a,f,s=8*i-o-1,c=(1<<s)-1,l=c>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,u=c):(u=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-u))<1&&(u--,f*=2),t+=u+l>=1?d/f:d*Math.pow(2,1-l),t*f>=2&&(u++,f/=2),u+l>=c?(a=0,u=c):u+l>=1?(a=(t*f-1)*Math.pow(2,o),u+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,o),u=0));o>=8;e[n+h]=255&a,h+=p,a/=256,o-=8);for(u=u<<o|a,s+=o;s>0;e[n+h]=255&u,h+=p,u/=256,s-=8);e[n+h-p]|=128*g}}).call(this,e("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)});

/***/ }),
/* 54 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return DatasourceDao; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__ = __webpack_require__(2);


var dbGetDatasources = function () {
    var url = 'api/admin/v2/datasources';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url);
};

var dbGetDatasource = function (datasourceName) {
    var url = 'api/admin/v2/datasources/' + datasourceName;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url);
};

var dbAddDatasource = function (data) {
    var url = 'api/admin/v2/datasources/' + data.datasourceName;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, data);
};

var dbUpdateDatasource = function (data) {
    var url = 'api/admin/v2/datasources/' + data.datasourceName + '/update';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, data);
};


var dbDeleteDatasource = function (datasourceName) {
    var url = 'api/admin/v2/datasources/' + datasourceName + '/delete';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url);
};

var dbGetDbTypes = function () {
    var url = 'api/admin/v2/datasources/dbtype';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url);
};

var cloudGetDatasources = function () {
    var url = 'api/admin/v2/s3';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url);
};

var cloudGetDatasource = function (datasourceName) {
    var url = 'api/admin/v2/s3/' + datasourceName;
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["a" /* ajaxGet */])(url);
};

var cloudAddDatasource = function (data) {
    var url = 'api/admin/v2/s3/' + data.datasourceName;
    return cloudGetDatasource(data.datasourceName).then(function (_data) {
        if (!_data) {
            return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, data);
        } else {
            var err = {
                errors: [
                    {
                        code: 500,
                        message: 'Datasource name already exists.'
                    }
                ]
            };
            throw err;
        }
    });
};

var cloudUpdateDatasource = function (data) {
    var url = 'api/admin/v2/s3/' + data.datasourceName + '/update';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url, data);
};


var cloudDeleteDatasource = function (datasourceName) {
    var url = 'api/admin/v2/s3/' + datasourceName + '/delete';
    return Object(__WEBPACK_IMPORTED_MODULE_0__src_utils_ajax2promise__["b" /* ajaxPost */])(url);
};

var DatasourceDao = {
    DB: {
        getDbTypes: dbGetDbTypes,
        getDatasources: dbGetDatasources,
        getDatasource: dbGetDatasource,
        addDatasource: dbAddDatasource,
        updateDatasource: dbUpdateDatasource,
        deleteDatasource: dbDeleteDatasource
    },
    Cloud: {
        getS3s: cloudGetDatasources,
        getS3: cloudGetDatasource,
        addS3: cloudAddDatasource,
        updateS3: cloudUpdateDatasource,
        deleteS3: cloudDeleteDatasource
    }
};





/***/ }),
/* 55 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__inherits__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ajax2promise__ = __webpack_require__(2);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__promise_utils__ = __webpack_require__(9);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__array_utils_index__ = __webpack_require__(56);
/* unused harmony reexport inherits */
/* unused harmony reexport ajaxGet */
/* unused harmony reexport ajaxPost */
/* unused harmony reexport difference */
/* unused harmony reexport intersection */
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return __WEBPACK_IMPORTED_MODULE_3__array_utils_index__["a"]; });
/* unused harmony reexport serial */
/* unused harmony reexport parallel */








/***/ }),
/* 56 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__difference__ = __webpack_require__(57);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__intersection__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__for_each__ = __webpack_require__(59);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__filter__ = __webpack_require__(60);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__map__ = __webpack_require__(61);
/* unused harmony reexport difference */
/* unused harmony reexport intersection */
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return __WEBPACK_IMPORTED_MODULE_2__for_each__["a"]; });
/* unused harmony reexport filter */
/* unused harmony reexport map */
/**
 * 2018. 02. 08
 * hyunseok.oh@samsung.com
 */










/***/ }),
/* 57 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export difference */
/**
 * 2018. 02. 08
 * hyunseok.oh@samsung.com
 */

/**
 * @param {Array} a
 * @param {Array} b
 * @param {Function} getKey
 * @return {Array} a - b
 */
var difference = function (a, b, _getKey) {
    var set = {};
    var getKey = _getKey || function (e) {
        return e;
    };
    _.forEach(b, function (e) {
        set[getKey(e)] = true;
    });
    return _.filter(a, function (e) {
        return set[getKey(e)] ? false : true;
    });
};




/***/ }),
/* 58 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export intersection */
/**
 * 2018. 02. 08
 * hyunseok.oh@samsung.com
 */

/**
 * @param {Array} a
 * @param {Array} b
 * @param {Function} getKey
 * @return {Array} a intersection b
 */
var intersection = function (a, b, _getKey) {
    var set = {};
    var getKey = _getKey || function (e) {
        return e;
    };
    _.forEach(a, function (e) {
        set[getKey(e)] = true;
    });
    return _.filter(b, function (e) {
        return set[getKey(e)];
    });
};




/***/ }),
/* 59 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return forEach; });
/**
 * 2018. 02.08
 * hyunseok.oh@samsung.com
 */

var forEach = function (arr, fn) {
    return _.forEach(arr, fn);
};




/***/ }),
/* 60 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export filter */
/**
 * 2018. 02.08
 * hyunseok.oh@samsung.com
 */

var filter = function (arr, fn) {
    return _.filter(arr, fn);
};




/***/ }),
/* 61 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export map */
/**
 * 2018. 02.08
 * hyunseok.oh@samsung.com
 */

var map = function (arr, fn) {
    return _.map(arr, fn);
};




/***/ }),
/* 62 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return resourceValidator; });

function ResourceValidator() {
    this.validateVersion = {
        '3.5': this.validateVersion3_5,
        '3.6': this.validateVersion3_5
    };
}

ResourceValidator.prototype.getValidateFunction = function (version) {
    var validate = this.validateVersion[version];
    return (validate) ? (validate) : (this.validateLegacy);
};

ResourceValidator.prototype.validate = function (file, fileType) {
    var validate = this.getValidateFunction(file.version);
    return validate(file, fileType);
};

ResourceValidator.prototype.validateLegacy = function (file, fileType) {
    var message = 'Invalid Model File.';
    var runnableMessage = 'Runnable Model File.';
    var errorMessage = '';

    var exportable = [
        'data',
        'control',
        'visual',
        'deeplearning'
    ];
    if (fileType === 'Report') {
        message = 'Invalid Report File.';
    }
    try {
        if (file instanceof Array) {
            var reportFiles = [];
            for (var i in file) {
                if (typeof file[i].mid === 'undefined' || exportable.indexOf(file[i].type) === -1) {
                    errorMessage = message;
                    break;
                } else if (file[i].type === 'visual') {
                    reportFiles.push(file[i]);
                }
            }
            if (fileType === 'Report' && reportFiles.length === 0) {
                errorMessage = message;
            } else if (fileType === 'Model' && reportFiles.length > 0) {
                errorMessage = message;
            }
        } else {
            if (typeof file.mid === 'undefined') {
                if (file.jid) {
                    errorMessage = runnableMessage;
                } else {
                    errorMessage = message;
                }
            } else if ((fileType === 'Report' && file.type !== 'visual') ||
                       (fileType === 'Model' && file.type === 'visual')) {
                errorMessage = message;
            } else if (exportable.indexOf(file.type) === -1) {
                errorMessage = message;
            }
        }
        return errorMessage;
    } catch (err) {
        return 'Invalid Model(.json) File.';
    }
};

ResourceValidator.prototype.validateVersion3_5 = function (file, fileType) {
    var message = 'Invalid Model File.';
    var runnableMessage = 'Runnable Model File.';
    var projectMessage = 'Project File.';
    var errorMessage = '';
    if (file.main && file.models) {
        errorMessage = runnableMessage;
    } else if (file.data.length === 0) {
        errorMessage = message;
    } else if (file.type === 'project') {
        errorMessage = projectMessage;
    }
    return errorMessage;
};

var resourceValidator = new ResourceValidator();




/***/ }),
/* 63 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return fnUnitInputs; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__ = __webpack_require__(26);


const TYPE_TABLE = 'table';
const FLEXIBLE_FUNCTIONS = [
    'rowAppend',
    'forLoop',
    'flow'

]

var PROBLEM_MESSAGE = {
    duplicate: function (label) {
        return '"'+ label +'" is already exist';
    },
    index: function () {
        return 'Should be filled previous element first';
    },
    empty: function () {
        return 'can not switch to "Empty"';
    }
}

function FnUnitInputs() {
}

FnUnitInputs.prototype.render = function (options) {
    this.empty(options);
    this.init(options);
    this.createLayout(options);
    this.createInputs(options);
    this.bindEvents(options);

    return this;
};

FnUnitInputs.prototype.init = function (options) {
    if (__WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].hasMeta(options.fnUnit)) this.DATA_TYPE = 'object';
    else this.DATA_TYPE = 'array';
};

FnUnitInputs.prototype.getPrevFnUnitByTableId = function (fnUnit, inTableId) {
    var prevFnUnits = __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getPreviousFnUnits(fnUnit);
    for (var i in prevFnUnits) {
        var fn = prevFnUnits[i];
        var outData = __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getOutData(fn);

        if (outData.indexOf(inTableId) > -1) { return fn; }
    };
};

FnUnitInputs.prototype.empty = function (options) {
    options.appendTo.empty();
};

FnUnitInputs.prototype.createLayout = function (options) {
    var $mainControl = $('' +
        '<div class="brtc-va-editors-sheet-controls-input-list">' +
        '   <div class="brtc-va-editors-sheet-controls-input-list-content"/>' +
        '</div>');

    $mainControl.attr('autoArrange', options.autoArrange || false);

    var $container = $('<div class="brtc-va-editors-sheet-controls-input-list-container"></div>');

    $mainControl.append($container);

    options.appendTo.append($mainControl);
};

FnUnitInputs.prototype.createInputs = function (options) {
    var _this = this;
    var inputs = __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getInputs(options.fnUnit);

    if (__WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].hasMeta(options.fnUnit)) {
        _.forEach(inputs, function (tableId, key) {
            var unitOptions = {
                type: __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getTypeByKey(options.fnUnit, key),
                tableId: tableId,
                key: key,
                fnUnit: options.fnUnit,
                appendTo: options.appendTo,
                emptyLabel: options.emptyLabel,
                readOnly: options.readOnly,
                autoArrange: false
            }
            _this.createInputUnit(unitOptions);
        });
    } else {
        var inRange = __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getInRange(options.fnUnit)[TYPE_TABLE];
        var max = inRange.max;

        if (__WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].isFlexibleFunction(options.fnUnit)) 
            max = __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getInTable(options.fnUnit).length;

        for (var i=0; i < max; i++) {
            var unitOptions = {
                type: TYPE_TABLE,
                tableId: inputs[i],
                key: '[' + i + ']' + __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getLabel(options.fnUnit),
                fnUnit: options.fnUnit,
                appendTo: options.appendTo,
                emptyLabel: options.emptyLabel,
                readOnly: options.readOnly,
                autoArrange: true
            }
            _this.createInputUnit(unitOptions);
        }
    }
};

FnUnitInputs.prototype.enableDragEvent = function ($el) {
    var $target = 
        $el.hasClass('brtc-style-controls-inputselector-box-wrapper')? 
            $el : $el.closest('.brtc-style-controls-inputselector-box-wrapper');

    if (this.isDraggable($target)) $target.draggable('enable');
};

FnUnitInputs.prototype.disableDragEvent = function ($el) {
    var $target = 
        $el.hasClass('brtc-style-controls-inputselector-box-wrapper')? 
            $el : $el.closest('.brtc-style-controls-inputselector-box-wrapper');

    if (this.isDraggable($target)) $target.draggable('disable');
};

FnUnitInputs.prototype.isDraggable = function ($el) {
    var $target = 
    $el.hasClass('brtc-style-controls-inputselector-box-wrapper')? 
        $el : $el.closest('.brtc-style-controls-inputselector-box-wrapper');

    return $target.hasClass('ui-draggable');
};

FnUnitInputs.prototype.createInputUnit = function (unitOptions) {
    var key = unitOptions.key;
    var tableId = unitOptions.tableId;
    var type = unitOptions.type;
    var fnUnit = unitOptions.fnUnit;
    var prevFnUnit = this.getPrevFnUnitByInTableId(fnUnit, tableId);
    var readOnly = unitOptions.readOnly;
    var autoArrange = unitOptions.autoArrange;

    var $box = this.createBox({appendTo: unitOptions.appendTo, label: key, type: type});
    
    if (!unitOptions.readOnly && _.isEqual(this.DATA_TYPE, 'array')) {
        this.createDragEvent(unitOptions.appendTo, $box);
        tableId? this.enableDragEvent($box) : this.disableDragEvent($box);
    }

    if (this.DATA_TYPE === 'array' && !readOnly) {
        $box.css('cursor', 'move');
    }

    $box.attr('key', key);
    $box.attr('type', type);
    $box.attr('table-id', tableId);

    var $contents = $box.find('.brtc-style-controls-inputselector-box-contents');
    var $figureArea = $contents.find('.brtc-style-controls-inputselector-box-contents-figure');
    var $removeArea = $contents.find('.brtc-style-controls-inputselector-box-contents-remove');
    var $keyArea = $contents.find('.brtc-style-controls-inputselector-box-key');
    var $container = unitOptions.appendTo.find('.brtc-va-editors-sheet-controls-input-list-container');

    $container.append($box);
    $contents.append($emptyItem);

    var $emptyItem = this.createEmptyItem({
        parent: $figureArea,
        type: type,
        label: unitOptions.emptyLabel,
        readOnly: readOnly
    });
    var $funcItem = this.createFuncItem({
        label: __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getLabel(prevFnUnit),
        func: __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getFunc(prevFnUnit),
        type: __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getTypeByTableId(prevFnUnit, tableId),
        tableId: tableId
    });
    var outputObject = __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getOutputsToObject(prevFnUnit);
    var $keyItem =  this.createKeyItem({key: outputObject[tableId], type: type});
    var $removeItem = this.createRemoveButton({autoArrange: autoArrange});

    $figureArea.append($funcItem);
    $keyArea.append($keyItem);
    if (!readOnly) $removeArea.append($removeItem);
    if (!readOnly) this.createDropEvent($box);

    if (tableId) {
        $emptyItem.hide();
        $funcItem.show();
        $keyItem.show();
        $removeItem.show();
    } else {
        $emptyItem.show();
        $funcItem.hide();
        $keyItem.hide();
        $removeItem.hide();
    }

    this.registerRemoveEvent($removeItem);

    return $box;
};

FnUnitInputs.prototype.getPrevFnUnitByInTableId = function (fnUnit, inTalbeId) {
    if (!fnUnit) return;

    var prevFnUnits = __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getPreviousFnUnits(fnUnit);

    for (var i in prevFnUnits) {
        var outData = __WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getOutData(prevFnUnits[i]);
        if (outData && outData.indexOf(inTalbeId) > -1) return  prevFnUnits[i];
    }
};

FnUnitInputs.prototype.createBox = function (options) {
    var $boxWrapper = this.createBoxWrapper(options.label, options.type);
    return $boxWrapper;
};

FnUnitInputs.prototype.createDragEvent = function ($parent, $item) {
    $item.draggable({
        helper: 'clone',
        appendTo: $parent,
        start: function (e, ui) {
            $item.css('opacity', '.3');
            ui.helper.css({
                'width': '220px',
                'border':'none'
            });
            ui.helper.find('.brtc-style-controls-inputselector-box-title').hide();
        },
        stop: function (e, ui) {
            $item.css('opacity', '1');
        }
    });
};

FnUnitInputs.prototype.createBoxWrapper = function (title, type) {
    var $wrapper = $('<div class="brtc-style-controls-inputselector-box-wrapper"></div>');

    var $title = $('' +
        '<div class="brtc-style-controls-inputselector-box-title brtc-style-ellipsis">' +
            '<div class="icon"></div>' +
            '<div class="brtc-label"></div>' +
        '</div>'
        );

    var $contents = $('' +
        '<div class="brtc-style-controls-inputselector-box-contents">' +
        '<div class="brtc-style-controls-inputselector-box-contents-figure"></div>' +
        '<div class="brtc-style-controls-inputselector-box-contents-remove"></div>' +
        '</div>'
    );

    var $key = $('<div class="brtc-style-controls-inputselector-box-key"></div>');

    $wrapper.append($title).append($contents);
    $contents.append($key);
    $title.find('.icon').attr('type', type);
    $title.find('.brtc-label').text(title);

    return $wrapper;
};

FnUnitInputs.prototype.createFuncItem = function (options) {
    var label = options.label;
    var func = options.func;
    var type = options.type;
    var tableId = options.tableId;

    var $itemWrapper = $('<div class="brtc-va-editors-sheet-controls-inputselector-item"></div>');
    var $item = Brightics.VA.Core.Utils.WidgetUtils.createPaletteBox({func: func, label: label});
    $itemWrapper.append($item);
    $item.find('.brtc-va-views-palette-fnunit-label').addClass('brtc-style-ellipsis');

    $item.find('.brtc-va-views-palette-fnunit-label').text(label);

    $itemWrapper.attr('table-id', tableId);
    $itemWrapper.attr('type', type);

    $item.find('.brtc-va-views-palette-fnunit-label').text(label);
    $item.attr('title', label);
    $item.addClass('item');

    return $itemWrapper;
};

FnUnitInputs.prototype.createKeyItem = function (options) {
    var $wrapper = $('<div class="brtc-style-controls-inputselector-box-key-wrapper"></div>');
    var $type = $('<div class="brtc-style-controls-inputselector-box-key-type"></div>');
    var $label = $('<div class="brtc-style-ellipsis brtc-style-controls-inputselector-box-key-label"></div>');

    $wrapper.append($type).append($label);

    $label.text(options.key);
    $label.attr('title', options.key);
    $type.append(this.createTypeIcon(options.type));

    return $wrapper;
};

FnUnitInputs.prototype.createTypeIcon = function (type) {
    return $('<div class="brtc-style-controls-inputselector-box-key-type-icon"></div>').attr('type', type);
};

FnUnitInputs.prototype.createEmptyItem = function (emptyOptions) {
    var label = emptyOptions.label || 'Drop Data';
    var $parent = emptyOptions.parent;
    var type = emptyOptions.type;
    var readOnly = emptyOptions.readOnly;

    var $emptyItem = $('' +
        '<div class="brtc-va-fnunit-input-empty">' +
        '   <div>' + label  + '</div>' +
        '</div>');

    $parent.append($emptyItem);

    if (!readOnly) this.createDropEvent($emptyItem, type);

    return $emptyItem;
};

FnUnitInputs.prototype.getDropFuncTarget = function ($item) {
    return $item.find('.brtc-style-controls-inputselector-box-contents');
    // return $item.find('.brtc-va-views-palette-fnunit').length == !0 ? $item.find('.brtc-va-views-palette-fnunit') : $item;
};

FnUnitInputs.prototype.getDroppableCssSelector = function () {
    return [
        '.brtc-va-fnunit-input-empty',
        '.brtc-va-editors-sheet-controls-inputselector-item',
        '.brtc-va-tools-sidebar-variable-remove',
        '.brtc-style-controls-inputselector-box-key-wrapper',
    ].join(',');
};
FnUnitInputs.prototype.addActivateClass = function ($item) {
    $item.find(this.getDroppableCssSelector()).addClass('brtc-style-droppable-active');
};
FnUnitInputs.prototype.removeActivateClass = function ($item) {
    $item.find(this.getDroppableCssSelector()).removeClass('brtc-style-droppable-active');
};
FnUnitInputs.prototype.addHoverClass = function ($item) {
    $item.find(this.getDroppableCssSelector()).addClass('brtc-style-droppable-hover');
};
FnUnitInputs.prototype.removeHoverClass = function ($item) {
    $item.find(this.getDroppableCssSelector()).removeClass('brtc-style-droppable-hover');
};

FnUnitInputs.prototype.createDropEvent = function ($item) {
    var _this = this;
    var type = $item.attr('type');

    $item.droppable({
        accept: '.brtc-va-controls-datatree-li-table[type='+ type +'] .ui-draggable, .brtc-style-controls-inputselector-box-wrapper',
        activate: function (event, ui) {
            _this.addActivateClass($(this));
        },
        deactivate: function (event, ui) {
            _this.removeActivateClass($(this));
            _this.removeHoverClass($(this));
        },
        over: function (event, ui) {
            _this.addHoverClass($(this));
        },
        out: function (event, ui) {
            _this.removeHoverClass($(this));
        },
        drop: function (event, ui) {
            var $source = ui.draggable;
            var $mainControl = _this.getMainArea($(this));
            var label =  $source.text();

            var problem = _this.validate($source, $(this));

            if (_.isEmpty(problem)) {
                _this.removeActivateClass($(this));
                _this.removeHoverClass($(this));
                _this.switchData($source, $(this));
                _this.handleChange($(this));

            } else {
                _this.handleError($mainControl, PROBLEM_MESSAGE[problem.type](label)); 
            }
        }
    });
};

FnUnitInputs.prototype.validate = function ($source, $target) {
    if (this.checkDuplicated($source, $target)) return {type: 'duplicate'};
    if (this.checkIndex($source, $target)) return {type: 'index'};
    if (this.checkEmpty($source, $target)) return {type: 'empty'};
    return undefined;
};

FnUnitInputs.prototype.checkDuplicated = function ($source, $target) {
    var inputs = this.getInputs(this.getMainArea($target));
    var tableId = $source.closest('li').attr('table-id');

    for (var key in inputs) {
        if (_.isEqual(inputs[key], tableId)) return true;
    }

    return false;
};

FnUnitInputs.prototype.checkIndex = function ($source, $target) {
    if (this.DATA_TYPE === 'object') return false;
    
    var $prev = $target.prev();

    if (!_.isEmpty($prev) && this.isEmptyBox($prev)) return true;
    return false;
};

FnUnitInputs.prototype.checkEmpty = function ($source, $target) {
    if ($source.hasClass('jqx-tree-item')) return false;
    if (this.isEmptyBox($source) || this.isEmptyBox($target)) return true;
    return false;
};

FnUnitInputs.prototype.switchData = function ($source, $target) {
    var isSelf = $source.hasClass('brtc-style-controls-inputselector-box-wrapper');

    if (isSelf) {
        var $sourceBox = $source.closest('.brtc-style-controls-inputselector-box-wrapper');
        var $sourceContents = $sourceBox.find('.brtc-style-controls-inputselector-box-contents');
        var $sourceClone = $sourceContents.clone();

        var $targetBox = $target.closest('.brtc-style-controls-inputselector-box-wrapper');
        var $targetContents = $targetBox.find('.brtc-style-controls-inputselector-box-contents');
        var $targetClone = $targetContents.clone();

        $targetContents.replaceWith($sourceClone);
        $sourceContents.replaceWith($targetClone);

        this.registerRemoveEvent($sourceClone.find('.brtc-va-tools-sidebar-variable-remove'));
        this.registerRemoveEvent($targetClone.find('.brtc-va-tools-sidebar-variable-remove'));

        this.isEmptyBox($sourceClone)? this.disableDragEvent($sourceClone) : this.enableDragEvent($sourceClone);
        this.isEmptyBox($targetClone)? this.disableDragEvent($targetClone) : this.enableDragEvent($targetClone);

        return $targetClone;
    } else {
        var sourceKey = $source.closest('li').attr('key');
        var sourceLabel = $source.closest('li').attr('label');
        var sourceType = $source.closest('li').attr('type');
        var sourceFunc = $source.closest('li').attr('func');
        var sourceTableId = $source.closest('li').attr('table-id');
    
        var $funcItem = this.createFuncItem({
            label: sourceLabel,
            func: sourceFunc,
            type: sourceType,
            tableId: sourceTableId
        });
        var $keyItem =  this.createKeyItem({key: sourceKey, type: sourceType});
    
        var $box = $target.closest('.brtc-style-controls-inputselector-box-wrapper');
        var $contents = $box.find('.brtc-style-controls-inputselector-box-contents');
        var $targetFuncItem = $contents.find('.brtc-va-editors-sheet-controls-inputselector-item');
        var $targetKeyItem = $contents.find('.brtc-style-controls-inputselector-box-key-wrapper');
        var $emptyItem = $contents.find('.brtc-va-fnunit-input-empty');
        var $removeButton = $contents.find('.brtc-va-tools-sidebar-variable-remove');
    
        $emptyItem.hide();
        $target.show();
        $targetKeyItem.show();
        $removeButton.show();

        this.registerRemoveEvent($removeButton);
    
        $targetFuncItem.replaceWith($funcItem);
        $targetKeyItem.replaceWith($keyItem);
    
        this.enableDragEvent($funcItem);

        this.createDropEvent($box);
    }
};

FnUnitInputs.prototype.createRemoveButton = function (options) {
    var $removeButton = $('<span class="brtc-va-tools-sidebar-variable-remove"></span>');
    return $removeButton;
};

FnUnitInputs.prototype.registerRemoveEvent = function ($removeButton) {
    var _this = this;

    $removeButton.off('click');
    $removeButton.click(function () {
        var $mainControl = _this.getMainArea($(this));
        var $box = $(this).closest('.brtc-style-controls-inputselector-box-wrapper');

        var $tableItem = $box.find('.brtc-va-editors-sheet-controls-inputselector-item');
        var $keyItem = $box.find('.brtc-style-controls-inputselector-box-key-wrapper');
        var $emptyItem = $box.find('.brtc-va-fnunit-input-empty');
        var $removeButton = $box.find('.brtc-va-tools-sidebar-variable-remove');

        $removeButton.hide();
        $keyItem.hide();
        $tableItem.hide();
        $emptyItem.show();

        _this.disableDragEvent($box);

        if ($mainControl.attr('autoArrange') === 'true') _this.autoArrange($box);

        _this.handleRemove($mainControl);
    });
};

FnUnitInputs.prototype.autoArrange = function ($box) {
    var $nextBox = $box.next();
    if (_.isEmpty($nextBox) || this.isEmptyBox($nextBox)) return;
    
    var $target = this.switchData($nextBox, $box);
    
    this.autoArrange($target);
};

FnUnitInputs.prototype.isEmptyBox = function ($el) {
    var $target = 
        $el.hasClass('brtc-style-controls-inputselector-box-wrapper')? 
            $el : $el.closest('.brtc-style-controls-inputselector-box-wrapper');
    return $target.find('.brtc-va-fnunit-input-empty').is(':visible');
};

FnUnitInputs.prototype.handleChange = function ($el) {
    var $mainControl = this.getMainArea($el);
    $mainControl.trigger('change',[this.getInputs($el)]);
};

FnUnitInputs.prototype.handleRemove = function ($el) {
    var $mainControl = this.getMainArea($el);
    $mainControl.trigger('change',[this.getInputs($el)]);
};

FnUnitInputs.prototype.handleError = function ($el, message) {
    var $mainControl = this.getMainArea($el);
    $mainControl.trigger('error',[message]);
};

FnUnitInputs.prototype.getPreviousFnUnits = function (fnUnit) {
    var fnUnits = [];

    var model = fnUnit.parent();
    var prevFids = model.getPrevious(__WEBPACK_IMPORTED_MODULE_0__fnunit_utils__["a" /* FnUnitUtils */].getId(fnUnit));

    _.forEach(prevFids, function (fid) {
        fnUnits.push(model.getFnUnitById(fid));
    });
    return fnUnits;
};
FnUnitInputs.prototype.getMainArea = function ($el) {
    return $el.closest('.brtc-va-editors-sheet-controls-input-list') || $el;
};

FnUnitInputs.prototype.getInputs = function ($el) {
    var $mainControl = this.getMainArea($el);
    var inputs = $mainControl.find('.brtc-style-controls-inputselector-box-wrapper');
    var rt = {};

    _.forEach(inputs, function (input) {
        var $input = $(input);
        var $table = $input.find('.brtc-va-editors-sheet-controls-inputselector-item');

        var key = $input.attr('key');
        var tableId = ($table.is(':visible'))? $table.attr('table-id') : '';
        rt[key] = tableId;
    });

    return rt;
};

FnUnitInputs.prototype.destroyDragEvent = function ($item) {
    $item.on('dragstop', function (event, ui) {
        if ($item.hasClass('ui-draggable') && ui.helper.attr('table-id') !== event.target.getAttribute('table-id')) {
            $item.draggable('destroy');
        }
    });
};

FnUnitInputs.prototype.bindEvents = function (options) {
    var $parent = options.appendTo;
    var $target = $parent.find('.brtc-va-editors-sheet-controls-input-list');

    if (typeof options.onClick === 'function') $target.bind('click', options.onClick);
    if (typeof options.onChange === 'function') $target.bind('change', options.onChange);
    if (typeof options.onError === 'function') $target.bind('error', options.onError);
};

var fnUnitInputs = new FnUnitInputs();



/***/ }),
/* 64 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return keyItems; });
function KeyItems() {
}

KeyItems.prototype.create = function (options) {
    return this.createUnit(options);
};

KeyItems.prototype.createUnit = function (unitOptions) {
    var key = unitOptions.key;
    var tableId = unitOptions.tableId;
    var type = unitOptions.type;
    var label = unitOptions.label;
    var func = unitOptions.func

    var $box = this.createBox(key);
    $box.attr('key', key);
    $box.attr('type', type);
    $box.attr('label', label);
    $box.attr('func', func);
    $box.attr('table-id', tableId);

    var $contents = $box.find('.brtc-style-controls-inputselector-box-contents');
    var $figureArea = $contents.find('.brtc-style-controls-inputselector-box-contents-figure');
    var $keyArea = $contents.find('.brtc-style-controls-inputselector-box-key');

    var $funcItem = this.createFuncItem({
        label: label,
        func: func,
        type: type,
        tableId: tableId
    });

    var $keyItem =  this.createKeyItem({key: key, type: type});
    var $removeItem = this.createRemoveButton();

    $figureArea.append($funcItem);
    $keyArea.append($keyItem);

    return $box;
};

KeyItems.prototype.bindEvents = function ($box, options) {
    if (typeof options.onClick === 'function') $box.bind('click', options.onClick);
    if (typeof options.onChange === 'function') $box.bind('change', options.onChange);
    if (typeof options.onRemove === 'function') $box.bind('remove', options.onRemove);
};

KeyItems.prototype.getPrevFnUnitByInTableId = function (fnUnit, inTalbeId) {
    if (!fnUnit) return;

    var prevFnUnits = FnUnitUtils.getPreviousFnUnits(fnUnit);

    for (var i in prevFnUnits) {
        var outData = FnUnitUtils.getOutData(prevFnUnits[i]);
        if (outData && outData.indexOf(inTalbeId) > -1) return  prevFnUnits[i];
    }
};

KeyItems.prototype.createBox = function (label) {
    var $boxWrapper = this.createBoxWrapper(label);
    return $boxWrapper;
};

KeyItems.prototype.createBoxWrapper = function (title) {
    var $wrapper = $('<div class="brtc-style-controls-inputselector-box-wrapper"></div>');
    $wrapper.css('width', '100%');
    $wrapper.css('height', '55px');

    var $contents = $('' +
        '<div class="brtc-style-controls-inputselector-box-contents">' +
            '<div class="brtc-style-controls-inputselector-box-contents-figure"></div>' +
            '<div class="brtc-style-controls-inputselector-box-contents-remove"></div>' +
        '</div>'
    );

    var $key = $('<div class="brtc-style-controls-inputselector-box-key"></div>');

    $wrapper.append($contents);
    $contents.append($key);

    return $wrapper;
};

KeyItems.prototype.createFuncItem = function (options) {
    var label = options.label;
    var func = options.func;
    var type = options.type;
    var tableId = options.tableId;

    var $itemWrapper = $('<div class="brtc-va-editors-sheet-controls-inputselector-item"></div>');
    var $item = Brightics.VA.Core.Utils.WidgetUtils.createPaletteBox({func: func, label: label});
    $itemWrapper.append($item);

    $item.find('.brtc-va-views-palette-fnunit-label').text(label);

    $itemWrapper.attr('table-id', tableId);
    $itemWrapper.attr('type', type);

    $item.find('.brtc-va-views-palette-fnunit-label').text(label);
    $item.attr('title', label);
    $item.addClass('item');

    return $itemWrapper;
};

KeyItems.prototype.createKeyItem = function (options) {
    var $wrapper = $('<div class="brtc-style-controls-inputselector-box-key-wrapper"></div>');
    var $type = $('<div class="brtc-style-controls-inputselector-box-key-type"></div>');
    var $label = $('<div class="brtc-style-controls-inputselector-box-key-label"></div>');

    $wrapper.append($type).append($label);

    $label.text(options.key);
    $type.append(this.createTypeIcon());

    return $wrapper;
};

KeyItems.prototype.createTypeIcon = function () {
    return $('<div class="brtc-style-controls-inputselector-box-key-type-icon" type="table"></div>');
};

KeyItems.prototype.createEmptyItem = function (emptyOptions) {
    var label = emptyOptions.label || 'Drop Data';
    var $parent = emptyOptions.parent;
    var type = emptyOptions.type;
    var readOnly = emptyOptions.readOnly;

    var $emptyItem = $('' +
        '<div class="brtc-va-fnunit-input-empty">' +
        '   <div>' + label  + '</div>' +
        '</div>');

    $parent.append($emptyItem);

    if (!readOnly) this.createDropEvent($emptyItem, type);

    return $emptyItem;
};

KeyItems.prototype.getDropFuncTarget = function ($item) {
    return $item.find('.brtc-va-views-palette-fnunit').length == !0 ? $item.find('.brtc-va-views-palette-fnunit') : $item;
};

KeyItems.prototype.createDropEvent = function ($item) {
    var _this = this;
    // var type = $item.attr('type');

    $item.droppable({
        // accept: '.key-items-draggable .ui-draggable',
        accept: '.key-items-draggable',
        activate: function (event, ui) {
            var $dropTarget = _this.getDropFuncTarget($(this));
            $dropTarget.addClass('brtc-style-droppable-active');
        },
        deactivate: function (event, ui) {
            var $dropTarget = _this.getDropFuncTarget($(this));
            $dropTarget.removeClass('brtc-style-droppable-active');
            $dropTarget.removeClass('brtc-style-droppable-hover');
        },
        over: function (event, ui) {
            var $dropTarget = _this.getDropFuncTarget($(this));
            $dropTarget.addClass('brtc-style-droppable-hover');
        },
        out: function (event, ui) {
            var $dropTarget = _this.getDropFuncTarget($(this));
            $dropTarget.removeClass('brtc-style-droppable-hover');
        },
        drop: function (event, ui) {
            var $source = ui.draggable;
            var $dropTarget = _this.getDropFuncTarget($(this));
            var $mainControl = _this.getMainArea($(this));

            $dropTarget.removeClass('brtc-style-droppable-active');
            $dropTarget.removeClass('brtc-style-droppable-hover');

            _this.switchData($source, $(this));

            var inputs = _this.getItems($mainControl);
            $mainControl.trigger('change', [inputs]);
        }
    });
};

KeyItems.prototype.switchData = function ($source, $target) {
    var sourceKey = $source.closest('li').attr('key');
    var sourceLabel = $source.closest('li').attr('label');
    var sourceType = $source.closest('li').attr('type');
    var sourceFunc = $source.closest('li').attr('func');
    var sourceTableId = $source.closest('li').attr('table-id');

    var $funcItem = this.createFuncItem({
        label: sourceLabel,
        func: sourceFunc,
        type: sourceType,
        tableId: sourceTableId
    });
    var $keyItem =  this.createKeyItem({key: sourceKey, type: sourceType});

    var isEmptyTarget =
        ($target.hasClass('brtc-style-controls-inputselector-empty-fnunit'))? true : false;

    var $box = $target.closest('.brtc-style-controls-inputselector-box-wrapper');
    var $contents = $box.find('.brtc-style-controls-inputselector-box-contents');
    var $targetFuncItem = $contents.find('.brtc-va-editors-sheet-controls-inputselector-item');
    var $targetKeyItem = $contents.find('.brtc-style-controls-inputselector-box-key-wrapper');
    var $emptyItem = $contents.find('.brtc-va-fnunit-input-empty');
    var $removeButton = $contents.find('.brtc-va-tools-sidebar-variable-remove');

    $emptyItem.hide();
    $target.show();
    $targetKeyItem.show();
    $removeButton.show();

    $targetFuncItem.replaceWith($funcItem);
    $targetKeyItem.replaceWith($keyItem);

    this.createDropEvent($box);
};

KeyItems.prototype.createRemoveButton = function () {
    var _this = this;

    var $removeButton = $('<span class="brtc-va-tools-sidebar-variable-remove"></span>');

    $removeButton.click(function () {
        var $box = $(this).closest('.brtc-style-controls-inputselector-box-wrapper');

        var $tableItem = $box.find('.brtc-va-editors-sheet-controls-inputselector-item');
        var $keyItem = $box.find('.brtc-style-controls-inputselector-box-key-wrapper');
        var $emptyItem = $box.find('.brtc-va-fnunit-input-empty');
        var $removeButton = $box.find('.brtc-va-tools-sidebar-variable-remove');

        $removeButton.hide();
        $keyItem.hide();
        $tableItem.hide();
        $emptyItem.show();

        _this.handleRemove($(this));

    });

    return $removeButton;
};

KeyItems.prototype.handleRemove = function ($removeButton) {
    var $mainControl = this.getMainArea($removeButton);
    $mainControl.trigger('change',[this.getItems($removeButton)]);
};

KeyItems.prototype.getPreviousFnUnits = function (fnUnit) {
    var fnUnits = [];

    var model = fnUnit.parent();
    var prevFids = model.getPrevious(FnUnitUtils.getId(fnUnit));

    _.forEach(prevFids, function (fid) {
        fnUnits.push(model.getFnUnitById(fid));
    });
    return fnUnits;
};
KeyItems.prototype.getMainArea = function ($el) {
    return $el.closest('.brtc-va-editors-sheet-controls-input-list') || $el;
};

KeyItems.prototype.getItems = function ($el) {
    var $mainControl = this.getMainArea($el);
    var inputs = $mainControl.find('.brtc-style-controls-inputselector-box-wrapper');
    var rt = {};

    _.forEach(inputs, function (input) {
        var $input = $(input);
        var $table = $input.find('.brtc-va-editors-sheet-controls-inputselector-item');

        var key = $input.attr('key');
        var tableId = ($table.is(':visible'))? $table.attr('table-id') : '';
        rt[key] = tableId;
    });

    return rt;
};

KeyItems.prototype.destroyDragEvent = function ($item) {
    $item.on('dragstop', function (event, ui) {
        if ($item.hasClass('ui-draggable') && ui.helper.attr('table-id') !== event.target.getAttribute('table-id')) {
            $item.draggable('destroy');
        }
    });
};

var keyItems = new KeyItems();



/***/ }),
/* 65 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return statusBoard; });
function StatusBoard() {
    this.init();
}

StatusBoard.prototype.init = function () {
    this.board = {};
};

StatusBoard.prototype.add = function (id, status, message) {
    this.board[id] = {
        status: status,
        message: message
    };
};

StatusBoard.prototype.remove = function (id) {
    delete this.board[id];
};

StatusBoard.prototype.get = function (id) {
    return this.board[id];
};

StatusBoard.prototype.refresh = function () {
    this.init();
};

StatusBoard.prototype.show = function (id, $target) {
    if (!this.get(id)) return;
    $target.attr('title', this.get(id).message);
};

var statusBoard = new StatusBoard();



/***/ }),
/* 66 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return PROP_KEY; });
/* -----------------------------------------------------
 *  model-prop-key.js
 *  Created by hyunseok.oh@samsung.com on 2018-04-02.
 * ---------------------------------------------------- */

var PROP_KEY = {
    IN_DATA: 'inData', // IN_DATA: 'inData',  // IN_DATA: 'inData',
    OUT_DATA: 'outData',  //OUT_DATA: 'outData',  //OUT_DATA: 'outData',
    INPUTS: 'inputs',
    OUTPUTS: 'outputs',
    FUNCTIONS: 'functions',
    TYPE: 'type',
    TITLE: 'title',
    PARAMETER: 'param',
    MODEL_ID: 'mid',
    INNER_MODELS: 'innerModels',
    PERSIST_MODE: 'persist-mode',
    SOURCE_FID: 'sourceFid', //SOURCE_FID: 'sourceFid',  //SOURCE_FID: 'sourceFid',
    TARGET_FID: 'targetFid', //TARGET_FID: 'targetFid',  //TARGET_FID: 'targetFid',
    FUNCTION_NAME: 'name', //FUNCTION_NAME: 'operation'  //FUNCTION_NAME: 'name'
    FONT_SIZES: ['10', '11', '12', '14', '16', '18', '24', '36', '48' , '64']
};




/***/ }),
/* 67 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__resource_service__ = __webpack_require__(68);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return __WEBPACK_IMPORTED_MODULE_0__resource_service__["a"]; });





/***/ }),
/* 68 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return resourceService; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__vomodels_index__ = __webpack_require__(10);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__ = __webpack_require__(25);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__src_data_structures_hash_map_hash_map__ = __webpack_require__(8);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__src_utils_promise_utils__ = __webpack_require__(9);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__export_project_spec__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__export_files_spec__ = __webpack_require__(29);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__export_spec_converter__ = __webpack_require__(69);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__src_idgenerator__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__src_idgenerator___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_7__src_idgenerator__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__src_const_env__ = __webpack_require__(3);
/* -----------------------------------------------------
 *  resource-service.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-13.
 * ----------------------------------------------------*/











/* global Brightics, _, OUT_DATA,FUNCTION_NAME */

'use strict';

const resourceType2Info = {
    // 'project': {
    //     _constructor: Project
    //     // priority: 0
    // },
    // 'file': {
    //     _constructor: File
    //     // priority: 1
    // },
    // 'version': {
    //     _constructor: Version
    //     // priority: 2
    // }
};

const Resources = [__WEBPACK_IMPORTED_MODULE_0__vomodels_index__["c" /* Project */], __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */], __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]];
_.forEach(Resources, function (rsc) {
    resourceType2Info[rsc.prototype.getResourceName()] = {
        _constructor: rsc,
    };
});


class ResourceService {
    exportProject(projectId) {
        return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */].fetchProject(projectId)
            .then((project) => {
                return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */].fetchFiles(projectId)
                    .then((files) => {
                        return this._collectResources(files, projectId, true);
                    })
                    .then((resources) => {
                        return this._exportProjectFromResources(project, resources);
                    });
            })
            .catch((err) => {
                console.error(err);
            });
    }

    _collectResources(_files, projectId, includeDependency) {
        const files = _.isArray(_files) ? _files : [_files];

        return Promise
            .all(_.map(files, (file) => {
                return includeDependency ? this._getDependentResources(file, projectId) : [file];
            }))
            .then((resources) => {
                return this._makeUnique(_.flatten(resources));
            })
            .then((uniqueResources) => {
                return this._appendMissedFiles(uniqueResources, projectId);
            });
    }

    exportJSON(fileId, sourceProjectId, includeDependency) {
        return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */].fetchFile(sourceProjectId, fileId)
            .then(_.bind(this._collectResources, this, _, sourceProjectId, includeDependency))
            .then(_.bind(this._exportFilesFromResources, this))
            .catch(console.error);
    }

    exportJSONs(fileIds, sourceProjectId, includeDependency) {
        return Promise
            .all(_.map(fileIds,
                _.bind(this.exportJSON, this, _, sourceProjectId, includeDependency)))
            .catch(console.error);
    }

    _exportFilesFromResources(resources, sourceProjectId) {
        return new __WEBPACK_IMPORTED_MODULE_5__export_files_spec__["a" /* ExportFilesSpec */](resources).toJSON();
    }

    _exportProjectFromResources(project, resources) {
        return new __WEBPACK_IMPORTED_MODULE_4__export_project_spec__["a" /* ExportProjectSpec */](project, resources).toJSON();
    }

    _appendMissedFiles(resources, projectId) {
        return this._getMissedFile(resources, projectId)
            .then(function (missed) {
                return resources.concat(missed);
            });
    }

    _traverseParamFunctions(fns, forEachFn) {
        _.forEach(fns, (fn) => {
            if (fn.param.functions) {
                this._traverseParamFunctions(fn.param.functions, forEachFn);
            }
            forEachFn(fn);
        });
    }

    _getDependentResources(file, projectId) {
        const mainModel = file.getContents();
        const registerDependentResources = new __WEBPACK_IMPORTED_MODULE_2__src_data_structures_hash_map_hash_map__["a" /* HashMap */]();

        const recModel = function (model) {
            return Promise.all(_.map(model.functions, function (fn) {
                if (fn[FUNCTION_NAME] === 'Flow') {
                    if (fn.param.mid && fn.param.versionId) {
                        if (!registerDependentResources.has(fn.param.versionId)) {
                            return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */]
                                .fetchVersion(projectId, fn.param.mid, fn.param.versionId)
                                .then(function (v) {
                                    registerDependentResources.set(fn.param.versionId, v);
                                    return recResource(v);
                                })
                                .catch(_.noop);
                        }
                    } else if (fn.param.mid) {
                        if (!registerDependentResources.has(fn.param.mid)) {
                            return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */]
                                .fetchFile(projectId, fn.param.mid)
                                .then(function (f) {
                                    registerDependentResources.set(fn.param.mid, f);
                                    return recResource(f);
                                })
                                .catch(_.noop);
                        }
                    }
                } else if (fn.func === 'loadFromStaging') {
                    if (fn.param.modelId) {
                        if (!registerDependentResources.has(fn.param.model)) {
                            return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */]
                                .fetchFile(projectId, fn.param.modelId)
                                .then(function (f) {
                                    registerDependentResources.set(fn.param.modelId, f);
                                    return recResource(f);
                                })
                                .catch(_.noop);
                        }
                    }
                }
                const subModels = Brightics.VA.Core.Utils.NestedFlowUtils
                    .getSubModels(mainModel, fn);
                return Promise.all(_.map(subModels, recModel));
            }));
        };

        const recResource = function (resource) {
            const model = resource.getContents();
            return recModel(model);
        };

        return recResource(file)
            .then(function () {
                return _.compact(registerDependentResources.toArray()).concat([file]);
            });
    }

    _makeUnique(resources) {
        const resourceMap = new __WEBPACK_IMPORTED_MODULE_2__src_data_structures_hash_map_hash_map__["a" /* HashMap */]();
        _.forEach(resources, function (resource) {
            resourceMap.set(resource.getHashCode(), resource);
        });
        return resourceMap.toArray();
    }

    _getMissedFile(resources, projectId) {
        const includedFiles = new __WEBPACK_IMPORTED_MODULE_2__src_data_structures_hash_map_hash_map__["a" /* HashMap */]();
        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */]) {
                includedFiles.set(resource.getFileId(), resource);
            }
        });

        const missedFilesId = new __WEBPACK_IMPORTED_MODULE_2__src_data_structures_hash_map_hash_map__["a" /* HashMap */]();
        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */] &&
                    !includedFiles.has(resource.getFileId()) &&
                    !missedFilesId.has(resource.getFileId())) {
                missedFilesId.set(resource.getFileId(), resource.getFileId());
            }
        });

        return Promise.all(_.map(missedFilesId.toArray(), function (fileId) {
            return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */].fetchFile(projectId, fileId);
        }));
    }

    _jsons2resource(jsons) {
        return _.map(jsons, function (json) {
            const constructor = resourceType2Info[json.type]._constructor;
            return new constructor(json.data);
        });
    }

    _importResources(resources, targetProjectId) {
        this._changePrevKeys(resources);
        const prv2newVersionId = this._collectVersionId(resources);
        const prv2newFileId = this._collectModelId(resources);
        this._remapProjectId(resources, targetProjectId);
        this._remapFileAndVersionId(resources, prv2newFileId, prv2newVersionId);
        // 필요없는 로직
        // const links = this.calcTableIdLinks(resources);

        const projectPromises = [];
        const filePromises = [];
        const versionPromises = [];

        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["c" /* Project */]) {
                throw new Error('unexpected data');
            }
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */]) {
                filePromises.push(function () {
                    return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */].addFile(targetProjectId, resource);
                });
            }
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]) {
                resource.setIsManual(true);
                versionPromises.push(function () {
                    return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */].addVersion(
                        targetProjectId,
                        resource.getFileId(),
                        resource);
                });
            }
        });

        const promiseFn = function (fns) {
            return function () {
                return Object(__WEBPACK_IMPORTED_MODULE_3__src_utils_promise_utils__["a" /* parallel */])(fns);
            };
        };
        return Object(__WEBPACK_IMPORTED_MODULE_3__src_utils_promise_utils__["b" /* serial */])([
            promiseFn(projectPromises),
            promiseFn(filePromises),
            promiseFn(versionPromises),
        ]);
        // .then(function () {
        //     const opt = {
        //         url: 'api/va/v2/data/link/create',
        //         type: 'POST',
        //         contentType: 'application/json; charset=utf-8',
        //         data: JSON.stringify({
        //             links: links
        //         }),
        //         blocking: true
        //     };
        //     return Promise.resolve($.ajax(opt));
        // });
    }

    checkPreviousFileSpec(json) {
        // TODO : Implement
        let isValid = true;
        if (json.type === 'project') isValid = false;
        if (_.has(json, 'version')) isValid = false;
        return isValid;
    }

    // 가정: 한 프로젝트(target project)에 import 된다
    importJSONs(_jsons, targetProjectId) {
        const preprocessJsons = (jsons) => {
            return Promise
                .all(_.map(jsons, (json) => {
                    if (json.type !== 'files') {
                        if (this.checkPreviousFileSpec(json)) {
                            return __WEBPACK_IMPORTED_MODULE_6__export_spec_converter__["a" /* ExportSpecConverter */].convertFilesSpec(json, json.version);
                        } else {
                            return Promise.reject(new Error('invalid export file spec'));
                        }
                    }

                    if (json.version !== __WEBPACK_IMPORTED_MODULE_8__src_const_env__["CORE_VERSION"]) {
                        return __WEBPACK_IMPORTED_MODULE_6__export_spec_converter__["a" /* ExportSpecConverter */].convertFilesSpec(json, json.version);
                    }
                    return json;
                }));
        };

        return preprocessJsons(_jsons)
            .then((jsons) => {
                return _.map(jsons, (json) => {
                    return this._jsons2resource(json.data);
                });
            })
            .then(_.flatten)
            .then(this._makeUnique.bind(this))
            .then((resources) => {
                return this._importResources(resources, targetProjectId);
            });
    }

    importJSON(jsons, targetProjectId) {
        return this.importJSONs([jsons], targetProjectId);
    }

    // FIXME: 컨트롤플로우에서 쓰고 있는 버전인데 없는 파일이면?
    _collectVersionId(resources) {
        const map = new __WEBPACK_IMPORTED_MODULE_2__src_data_structures_hash_map_hash_map__["a" /* HashMap */]();
        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]) {
                if (!map.has(resource.getVersionId())) {
                    map.set(resource.getVersionId(), __WEBPACK_IMPORTED_MODULE_7__src_idgenerator___default.a.version.id());
                }
            }
        });
        return map;
    }

    _collectModelId(resources) {
        const map = new __WEBPACK_IMPORTED_MODULE_2__src_data_structures_hash_map_hash_map__["a" /* HashMap */]();
        const set = function (id) {
            if (!map.has(id)) {
                map.set(id, __WEBPACK_IMPORTED_MODULE_7__src_idgenerator___default.a.model.id());
            }
        };
        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */] || resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]) {
                set(resource.getFileId());
                _.forIn(resource.getContents().functions, function (fn) {
                    if (fn.param && fn.param.modelId) {
                        set(fn.param.modelId);
                    }
                });
                _.forIn(resource.getContents().innerModels, function (innerModel) {
                    set(innerModel.mid);
                });
            }
        });
        return map;
    }

    _remapProjectId(resources, targetProjectId) {
        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */]) {
                // 필요없긴 함
                resource.setProjectId(targetProjectId);
            }
        });
    }

    _remapFileAndVersionId(resources, midMap, vidMap) {
        const remapInnerModel = function (mainModel, model) {
            _.forEach(model.functions, function (fn) {
                if (fn[FUNCTION_NAME] === 'Flow') {
                    if (fn.param.mid) {
                        fn.param.mid = midMap.get(fn.param.mid) || fn.param.mid;
                    }
                    if (fn.param.versionId) {
                        fn.param.versionId = vidMap.get(fn.param.versionId) || fn.param.versionId;
                    }
                }

                if (fn[FUNCTION_NAME] === 'DataViewer') {
                    fn.param.mid = midMap.get(fn.param.mid);
                }

                if (fn[FUNCTION_NAME] === 'If') {
                    fn.param.if.mid = midMap.get(fn.param.if.mid) || fn.param.if.mid;
                    _.forEach(fn.param.elseif, function (elseif) {
                        elseif.mid = midMap.get(elseif.mid) || elseif.mid;
                    });
                    fn.param.else.mid = midMap.get(fn.param.else.mid) || fn.param.else.mid;
                }

                if (fn[FUNCTION_NAME] === 'ForLoop' || fn[FUNCTION_NAME] === 'WhileLoop') {
                    fn.param.mid = midMap.get(fn.param.mid) || fn.param.mid;
                }
                const subModels = Brightics.VA.Core.Utils.NestedFlowUtils
                    .getSubModels(mainModel, fn);
                _.forEach(subModels, _.partial(remapInnerModel, mainModel, _));
            });
        };
        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */] || resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]) {
                resource.setFileId(midMap.get(resource.getFileId()));
                resource.getContents().mid = resource.getFileId();
                if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]) {
                    resource.setVersionId(vidMap.get(resource.getVersionId()));
                    resource.getContents().version_id = resource.getVersionId();
                }
                if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */] && resource.getType() === 'visual') {
                    _.forEach(resource.getContents().functions, function (fn) {
                        if (fn.param.modelId) {
                            fn.param.modelId = midMap.get(fn.param.modelId);
                        }
                    });
                }
                const mainModel = resource.getContents();
                const newInnerModels = _.reduce(_.map(mainModel.innerModels, function (model, key) {
                    const ret = {};
                    model.mid = midMap.get(key) || key;
                    ret[model.mid] = model;
                    return ret;
                }), _.merge, {});
                mainModel.innerModels = newInnerModels;
                remapInnerModel(mainModel, mainModel);
            }
        });
    }

    _changePrevKeys(resources) {
        const cacheMap = {
            fidCache: {},
            tidCache: {},
        };
        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */] || resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]) {
                const model = resource.getContents();
                Brightics.VA.Core.Utils.ModelUtils
                    .createCacheNestedFlow(model, model, cacheMap);
            }
        });

        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */] || resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]) {
                const model = resource.getContents();
                const contents = Brightics.VA.Core.Utils.ModelUtils
                    .setKeyNestedFlow(model, model, cacheMap);
                resource.setContents(contents);
            }
        });
    }


    preprocessProjectJson(json) {
        if (json.type === 'project' && json.version === __WEBPACK_IMPORTED_MODULE_8__src_const_env__["CORE_VERSION"]) {
            return Promise.resolve(json);
        } else {
            return __WEBPACK_IMPORTED_MODULE_6__export_spec_converter__["a" /* ExportSpecConverter */].convertProjectSpec(json, json.version);
        }
    }

    importProject(json) {
        return this.preprocessProjectJson(json)
            .then(function (json) {
                const project = new __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["c" /* Project */](json.data);
                const projectId = __WEBPACK_IMPORTED_MODULE_7__src_idgenerator___default.a.project.id();
                project.setProjectId(projectId);

                const resources = this._jsons2resource(json.children);

                return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */].addProject(project)
                    .then(() => {
                        return __WEBPACK_IMPORTED_MODULE_1__resource_manager_resource_manager__["a" /* ResourceManager */].fetchProject(projectId);
                    })
                    .then((project) => {
                        return this._importResources(resources, projectId);
                    })
                    .then(() => {
                        return projectId;
                    })
                    .catch((err) => {
                        console.error(err);
                    });
            }.bind(this));
    }

    validateExportedProjectSpec(json) {
        try {
            return this.preprocessProjectJson(json);
            // TODO: validate
        } catch (e) {
            return Promise.reject(e);
        }
    }

    duplicateFile(fileId,
            sourceProjectId, targetProjectId, includeDependency, prvFileName, newFileName) {
        const renameFileName = function (json) {
            json.data = _.map(json.data, function (exportedResourceSpec) {
                if (exportedResourceSpec.type === 'file' && exportedResourceSpec.data.id === fileId) {
                    exportedResourceSpec.data.label = newFileName;
                } else {
                    exportedResourceSpec.data.label += '_' + prvFileName;
                }
                return exportedResourceSpec;
            });
        };

        return this.exportJSON(fileId, sourceProjectId, includeDependency)
            .then((json) => {
                const cloned = _.cloneDeep(json);
                renameFileName(cloned);
                return this.importJSON(cloned, targetProjectId);
            })
            .catch(function (err) {
                console.error(err);
            });
    }

    calcTableIdLinks(resources) {
        const links = [];
        const forEachModels = function (mainModel, model) {
            _.forEach(model.functions, function (fn) {
                if (fn[FUNCTION_NAME] === 'DataViewer') {
                    _.forEach(fn[OUT_DATA], function (tid) {
                        links.push({
                            source: ['',
                                Brightics.VA.Env.Session.userId,
                                fn.param.mid,
                                fn[OUT_DATA],
                            ].join('/'),
                            alias: ['',
                                Brightics.VA.Env.Session.userId,
                                model.mid,
                                fn[OUT_DATA],
                            ].join('/'),
                        });
                    });
                }
                const subModels = Brightics.VA.Core.Utils.NestedFlowUtils
                    .getSubModels(mainModel, fn);
                _.forEach(subModels, _.partial(forEachModels, mainModel, _));
            });
        };

        _.forEach(resources, function (resource) {
            if (resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */] || resource instanceof __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]) {
                const model = resource.getContents();
                forEachModels(model, model);
            }
        });
        return links;
    }
}

const resourceService = new ResourceService();




/***/ }),
/* 69 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ExportSpecConverter; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__vomodels_index__ = __webpack_require__(10);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__export_files_spec__ = __webpack_require__(29);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__export_project_spec__ = __webpack_require__(28);
/* -----------------------------------------------------
 *  export-spec-converter.js
 *  Created by hyunseok.oh@samsung.com on 2018-04-12.
 * ---------------------------------------------------- */





/* global Brightics, _ */

const ExportSpecConverter = (function () {
    const coreConverterAPI = function (contents, version) {
        const ajax = $.ajax({
            url: 'api/va/v2/convert/store',
            type: 'POST',
            data: JSON.stringify({
                contents: contents,
                version: version,
            }),
            contentType: 'application/json; charset=utf-8',
        });
        return Promise.resolve(ajax)
            .then(function (result) {
                return result.contents;
            })
            .catch(function (err) {
                err.responseJSON.errors[0].mid = contents.mid;
                throw err;
            });
    };

    const wrapFile = function (contents) {
        const wrapped =
            new __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */]()
                .setFileId(contents.mid)
                .setLabel(contents.title)
                .setDescription('')
                .setCreator(Brightics.VA.Env.Session.userId)
                .setContents(contents);
        return wrapped;
    };

    const wrapVersion = function (contents) {
        const wrapped =
            new __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */]()
                .setVersionId(contents.version_id)
                .setFileId(contents.mid)
                .setLabel(contents.title)
                .setTags(contents.versionTags)
                .setDescription(contents.versionDescription)
                .setType(contents.type)
                .setMajorVersion(_.has(contents, 'majorVersion') ?
                    contents.majorVersion :
                    contents.major_version)
                .setMinorVersion(_.has(contents, 'minorVersion') ?
                    contents.minorVersion :
                    contents.minor_version)
                .setCreator(Brightics.VA.Env.Session.userId)
                .setIsManual(true);

        wrapped.setContents(_.omit(contents, [
            'versionId',
            'versionTags',
            'versionDescription',
            'majorVersion',
            'minorVersion',
        ]));

        return wrapped;
    };

    const toFile = (f) => new __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["a" /* File */](f);
    const toVersion = (v) => new __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["d" /* Version */](v);

    const convertFilesSpec = function (oldfilesSpec, version) {
        const toFiles = (spec) => spec.data.map(_.property('data'));
        const contentsArray = (function () {
            if (!version) return _.isArray(oldfilesSpec) ? oldfilesSpec : [oldfilesSpec];
            return toFiles(oldfilesSpec).map(_.property('contents'));
        }());
        return Promise.all(_.map(contentsArray, (contents) => coreConverterAPI(contents, version)))
            .then(function (coreConverted) {
                const legacy = (cvt) => cvt.map((c) => (c.version_id ? wrapVersion : wrapFile)(c));
                const legacy2 = (cvt) => _.zip(toFiles(oldfilesSpec), cvt).map(([f, c]) => {
                    const to = c.version_id ? toVersion : toFile;
                    return to(Object.assign({}, f, { contents: c }));
                });
                const matchedLegacy = version ? legacy2 : legacy;
                const exp = new __WEBPACK_IMPORTED_MODULE_1__export_files_spec__["a" /* ExportFilesSpec */](matchedLegacy(coreConverted));
                return exp.toJSON();
            });
    };

    const convertProjectSpec = function (projectSpec, version) {
        const [files, versions, project] = (function () {
            if (!version) {
                const adjust = (r) => _.merge({
                    contents: {
                        gv: [],
                    },
                }, r);
                return [
                    projectSpec[0].files.map(adjust),
                    projectSpec[0].versions.map(adjust),
                    new __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["c" /* Project */](_.omit(projectSpec[0], ['files', 'versions'])),
                ];
            }
            const [files, versions] = _.partition(projectSpec.children, _.matchesProperty('type', 'file'))
                .map((els) => els.map(_.property('data')));
            return [
                files,
                versions,
                new __WEBPACK_IMPORTED_MODULE_0__vomodels_index__["c" /* Project */](projectSpec.data),
            ];
        }());

        const convertContents = function (el) {
            return coreConverterAPI(el.contents, version)
                .then(function (convertedContents) {
                    return _.assign({}, el, { contents: convertedContents });
                });
        };


        const getConverter = function (to) {
            return function (x) {
                return convertContents(x).then(to);
            };
        };

        return Promise.all([].concat(
            _.map(files, getConverter(toFile)),
            _.map(versions, getConverter(toVersion))
        )).then(function (convertedChildren) {
            return (new __WEBPACK_IMPORTED_MODULE_2__export_project_spec__["a" /* ExportProjectSpec */](project, convertedChildren)).toJSON();
        });
    };

    return {
        convertFilesSpec: convertFilesSpec,
        convertProjectSpec: convertProjectSpec,
    };
}());




/***/ }),
/* 70 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return get; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "d", function() { return updateProp; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return addProp; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return removeProp; });
/* -----------------------------------------------------
 *  object-utils.js
 *  Created by hyunseok.oh@samsung.com on 2018-03-08.
 * ---------------------------------------------------- */

/* global _ */

var _getByPath = function (obj, path) {
    try {
        var idx = -1;
        var length = path.length;
        var ret = obj;
        while (++idx < length) {
            ret = ret[path[idx]];
        }
        return ret;
    } catch (e) {
        return undefined;
    }
};

var get = function (obj, key) {
    if (key instanceof Array) return _getByPath(obj, key);
    return obj[key];
};

var copy = function (val) {
    return _.clone(val);
};

var updateProp = function (_obj, path, val) {
    var obj = _obj;
    var idx = -1;
    var len = path.length;
    while (++idx < len - 1) {
        obj = obj[path[idx]];
    }
    var old = copy(obj[path[path.length - 1]]);
    obj[path[path.length - 1]] = copy(val);
    return old;
};

var addProp = function (_obj, path, val) {
    var obj = _obj;
    var idx = -1;
    var len = path.length;
    while (++idx < len - 1) {
        obj = obj[path[idx]];
    }
    if (Array.isArray(obj)) {
        obj.splice(path[path.length - 1], 0, val);
    } else {
        obj[path[path.length - 1]] = copy(val);
    }
    return undefined;
};

var removeProp = function (_obj, path) {
    var obj = _obj;
    var idx = -1;
    var len = path.length;
    while (++idx < len - 1) {
        obj = obj[path[idx]];
    }
    var old = copy(obj[path[path.length - 1]]);
    if (Array.isArray(obj)) {
        obj.splice(path[path.length - 1], 1);
    } else {
        delete obj[path[path.length - 1]];
    }
    return old;
};




/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

//Copyright (C) 2012 Kory Nunn

//Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

//The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

//THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

/*

    This code is not formatted for readability, but rather run-speed and to assist compilers.

    However, the code's intention should be transparent.

    *** IE SUPPORT ***

    If you require this library to work in IE7, add the following after declaring crel.

    var testDiv = document.createElement('div'),
        testLabel = document.createElement('label');

    testDiv.setAttribute('class', 'a');
    testDiv['className'] !== 'a' ? crel.attrMap['class'] = 'className':undefined;
    testDiv.setAttribute('name','a');
    testDiv['name'] !== 'a' ? crel.attrMap['name'] = function(element, value){
        element.id = value;
    }:undefined;


    testLabel.setAttribute('for', 'a');
    testLabel['htmlFor'] !== 'a' ? crel.attrMap['for'] = 'htmlFor':undefined;



*/

(function (root, factory) {
    if (true) {
        module.exports = factory();
    } else if (typeof define === 'function' && define.amd) {
        define(factory);
    } else {
        root.crel = factory();
    }
}(this, function () {
    var fn = 'function',
        obj = 'object',
        nodeType = 'nodeType',
        textContent = 'textContent',
        setAttribute = 'setAttribute',
        attrMapString = 'attrMap',
        isNodeString = 'isNode',
        isElementString = 'isElement',
        d = typeof document === obj ? document : {},
        isType = function(a, type){
            return typeof a === type;
        },
        isNode = typeof Node === fn ? function (object) {
            return object instanceof Node;
        } :
        // in IE <= 8 Node is an object, obviously..
        function(object){
            return object &&
                isType(object, obj) &&
                (nodeType in object) &&
                isType(object.ownerDocument,obj);
        },
        isElement = function (object) {
            return crel[isNodeString](object) && object[nodeType] === 1;
        },
        isArray = function(a){
            return a instanceof Array;
        },
        appendChild = function(element, child) {
            if (isArray(child)) {
                child.map(function(subChild){
                    appendChild(element, subChild);
                });
                return;
            }
            if(!crel[isNodeString](child)){
                child = d.createTextNode(child);
            }
            element.appendChild(child);
        };


    function crel(){
        var args = arguments, //Note: assigned to a variable to assist compilers. Saves about 40 bytes in closure compiler. Has negligable effect on performance.
            element = args[0],
            child,
            settings = args[1],
            childIndex = 2,
            argumentsLength = args.length,
            attributeMap = crel[attrMapString];

        element = crel[isElementString](element) ? element : d.createElement(element);
        // shortcut
        if(argumentsLength === 1){
            return element;
        }

        if(!isType(settings,obj) || crel[isNodeString](settings) || isArray(settings)) {
            --childIndex;
            settings = null;
        }

        // shortcut if there is only one child that is a string
        if((argumentsLength - childIndex) === 1 && isType(args[childIndex], 'string') && element[textContent] !== undefined){
            element[textContent] = args[childIndex];
        }else{
            for(; childIndex < argumentsLength; ++childIndex){
                child = args[childIndex];

                if(child == null){
                    continue;
                }

                if (isArray(child)) {
                  for (var i=0; i < child.length; ++i) {
                    appendChild(element, child[i]);
                  }
                } else {
                  appendChild(element, child);
                }
            }
        }

        for(var key in settings){
            if(!attributeMap[key]){
                if(isType(settings[key],fn)){
                    element[key] = settings[key];
                }else{
                    element[setAttribute](key, settings[key]);
                }
            }else{
                var attr = attributeMap[key];
                if(typeof attr === fn){
                    attr(element, settings[key]);
                }else{
                    element[setAttribute](attr, settings[key]);
                }
            }
        }

        return element;
    }

    // Used for mapping one kind of attribute to the supported version of that in bad browsers.
    crel[attrMapString] = {};

    crel[isElementString] = isElement;

    crel[isNodeString] = isNode;

    if(typeof Proxy !== 'undefined'){
        crel.proxy = new Proxy(crel, {
            get: function(target, key){
                !(key in crel) && (crel[key] = crel.bind(null, key));
                return crel[key];
            }
        });
    }

    return crel;
}));


/***/ }),
/* 72 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = TabChannel;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__event_emitter_event_emitter__ = __webpack_require__(1);
/* -----------------------------------------------------
 *  tab-channel.js
 *  Created by hyunseok.oh@samsung.com on 2018-08-08.
 * ---------------------------------------------------- */

/* global _ */


var TAB_CHANNEL_PREFIX = '_TAB_CH_';
var DEFAULT_TIMEOUT = 5000;

function TabChannel(connectionKey) {
    this.ee = new __WEBPACK_IMPORTED_MODULE_0__event_emitter_event_emitter__["a" /* EventEmitter */]();
    this.connectionKey = connectionKey;

    window.addEventListener('storage', (function (ee) {
        return function (storageEvent) {
            var key = storageEvent.key;
            var newValue = (JSON.parse(storageEvent.newValue) || {});
            ee.emit(key, newValue);
        };
    }(this.ee)));
}

TabChannel.prototype.request = function (topic, data, _opt) {
    var self = this;
    var timeout = (_opt || {}).timeout || DEFAULT_TIMEOUT;
    return new Promise(function (resolve, reject) {
        var cur = Date.now();
        var requestKey = 'req_' + cur;
        var done = function (res) {
            if (res.connectionKey !== self.connectionKey) return;
            if (res.requestKey === requestKey) {
                resolve(res.value);
                self.off(topic, done);
            }
        };
        self.on(topic, done);
        // TODO : (request시작 -> 응답이 timeout인데,
        //         request시작 -> request의 timeout으로 변경 필요
        //         현재는 request 받는데 성공했지만 response까지의 시간이 길경우 TIMEOUT error를 띄움
        setTimeout(function () {
            reject(new Error('TIMEOUT'));
            self.off(topic, done);
        }, timeout);

        self.emit(topic, {
            timestamp: cur,
            requestKey: 'req_' + cur,
            connectionKey: self.connectionKey,
            value: data,
            timeout: timeout
        });
    });
};

TabChannel.prototype.setConnectionKey = function (connectionKey) {
    this.connectionKey = connectionKey;
};

TabChannel.prototype.getConnectionKey = function () {
    return this.connectionKey;
};

TabChannel.prototype.listen = function (topic, cb) {
    var self = this;
    self.on(topic, function (req) {
        if (req.connectionKey !== self.connectionKey) return;
        var cur = Date.now();
        if (cur - req.timestamp >= req.timeout) return;
        self.emit(topic, _.assign({}, req, {
            value: cb(req),
            timestamp: cur,
            responseKey: 'res_' + cur
        }));
    });
};

TabChannel.prototype.on = function (topic, cb) {
    this.ee.on(TAB_CHANNEL_PREFIX + topic, cb);
};

TabChannel.prototype.off = function (topic, cb) {
    this.ee.off(TAB_CHANNEL_PREFIX + topic, cb);
};

TabChannel.prototype.emit = function (topic, data) {
    localStorage.setItem(TAB_CHANNEL_PREFIX + topic, JSON.stringify(data));
};


/***/ }),
/* 73 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return DATA_TYPES; });

const DATA_TYPES = {
    // spark type
    'integertype': {
        type: 'number',
        internalType: 'Integer'
    },
    'longtype': {
        type: 'number',
        internalType: 'Long'
    },
    'doubletype': {
        type: 'number',
        internalType: 'Double'
    },
    'booleantype': {
        type: 'string',
        internalType: 'Boolean'
    },
    'stringtype': {
        type: 'string',
        internalType: 'String'
    },
    'arraytype(doubletype)': {
        type: 'number[]',
        internalType: 'Double[]'
    },
    'arraytype(longtype)': {
        type: 'number[]',
        internalType: 'Long[]'
    },
    'arraytype(booleantype)': {
        type: 'string[]',
        internalType: 'Boolean[]'
    },
    'arraytype(stringtype)': {
        type: 'string[]',
        internalType: 'String[]'
    },
    'arraytype(bytetype)': {
        type: 'byte[]',
        internalType: 'Byte[]'
    },
    'arraytype(doubletype,true)': {
        type: 'number[]',
        internalType: 'Double[]'
    },
    'arraytype(longtype,true)': {
        type: 'number[]',
        internalType: 'Long[]'
    },
    'arraytype(stringtype,true)': {
        type: 'string[]',
        internalType: 'String[]'
    },
    'arraytype(bytetype,true)': {
        type: 'byte[]',
        internalType: 'Byte[]'
    },
    'maptype(integertype,doubletype)': {
        type: 'map',
        internalType: 'Map(Integer,Double)'
    },
    'maptype(stringtype,doubletype)': {
        type: 'map',
        internalType: 'Map(String,Double)'
    },
    'maptype(integertype,doubletype,true)': {
        type: 'map',
        internalType: 'Map(Integer,Double)'
    },
    'maptype(stringtype,doubletype,true)': {
        type: 'map',
        internalType: 'Map(String,Double)'
    },
    'maptype(stringtype,stringtype,true)': {
        type: 'map',
        internalType: 'Map(String,String)'
    },
    'timestamptype': {
        type: 'date',
        internalType: 'Date'
    },
    'timestamp': {
        type: 'date',
        internalType: 'Date'
    },
    'date': {
        type: 'date',
        internalType: 'Date'
    },
    // alluxio type
    'string': {
        type: 'string',
        internalType: 'String'
    },
    'double': {
        type: 'number',
        internalType: 'Double'
    },
    'boolean': {
        type: 'string',
        internalType: 'Boolean'
    },
    'long': {
        type: 'number',
        internalType: 'Long'
    },
    'int': {
        type: 'number',
        internalType: 'Integer'
    },
    'integer': {
        type: 'number',
        internalType: 'Integer'
    },
    'array(string)': {
        type: 'string[]',
        internalType: 'String[]'
    },
    'array(double)': {
        type: 'number[]',
        internalType: 'Double[]'
    },
    'array(long)': {
        type: 'number[]',
        internalType: 'Long[]'
    },
    'array(int)': {
        type: 'number[]',
        internalType: 'Integer[]'
    },
    'array(integer)': {
        type: 'number[]',
        internalType: 'Integer[]'
    },
    'map(integer,double)': {
        type: 'map',
        internalType: 'Map(Integer,Double)'
    },
    'map(string,double)': {
        type: 'map',
        internalType: 'Map(String,Double)'
    },
    'map(int,double)': {
        type: 'map',
        internalType: 'Map(Integer,Double)'
    },

    // workflow 3.5
    'tinyint': {
        type: 'byte',
        internalType: 'Byte'
    },
    'float': {
        type: 'number',
        internalType: 'Float'
    },
    'bigint': {
        type: 'number',
        internalType: 'Long'
    },
    'smallint': {
        type: 'short',
        internalType: 'Short'
    },
    'array<string>': {
        type: 'string[]',
        internalType: 'String[]'
    },
    'array<double>': {
        type: 'number[]',
        internalType: 'Double[]'
    },
    'array<long>': {
        type: 'number[]',
        internalType: 'Long[]'
    },
    'array<int>': {
        type: 'number[]',
        internalType: 'Integer[]'
    },
    'array<integer>': {
        type: 'number[]',
        internalType: 'Integer[]'
    },
    'array<tinyint>': {
        type: 'byte[]',
        internalType: 'Byte[]'
    },
    'map<integer,double>': {
        type: 'map',
        internalType: 'Map(Integer,Double)'
    },
    'map<string,double>': {
        type: 'map',
        internalType: 'Map(String,Double)'
    },
    'map<int,double>': {
        type: 'map',
        internalType: 'Map(Integer,Double)'
    }
};




/***/ }),
/* 74 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export diff */
/* harmony export (immutable) */ __webpack_exports__["a"] = modelDiff;
/* -----------------------------------------------------
 *  model-diff.js
 *  Created by hyunseok.oh@samsung.com on 2018-07-23.
 * ---------------------------------------------------- */

/* global _ */
const MODEL_SYNC_KEY = '__brtc__model__sync__';

function keyValue(key, val) {
    var x = {};
    x[key] = val;
    return x;
}

function arrayDiff(a, b) {
    var len = Math.max(a.length, b.length);
    return _.range(len).reduce(function (prv, idx) {
        if (!_.has(a, idx)) {
            return _.merge(prv, keyValue(idx, {
                [MODEL_SYNC_KEY]: true,
                action: 'add',
                val: b[idx]
            }));
        } else if (!_.has(b, idx)) {
            return _.merge(prv, keyValue(idx, {
                [MODEL_SYNC_KEY]: true,
                action: 'remove'
            }));
        } else {
            var dif = diff(a[idx], b[idx]);
            if (!(_.isObject(dif) && _.isEmpty(dif))) {
                return _.merge(prv, keyValue(idx, dif));
            }
        }
        return prv;
    }, {});
}

function diff(a, b) {
    if (a === b) return {};
    var aIsArray = _.isArray(a);
    var bIsArray = _.isArray(b);
    if (aIsArray && bIsArray) return arrayDiff(a, b);
    if (aIsArray || bIsArray || !_.isObject(a) || !_.isObject(b)) {
        return {
            [MODEL_SYNC_KEY]: true,
            action: 'update',
            val: b
        };
    }

    var allKeys = _.union(_.keys(a), _.keys(b));

    return _.reduce(allKeys, function (prv, key) {
        if (!_.has(a, key)) {
            return _.merge(prv, keyValue(key, {
                [MODEL_SYNC_KEY]: true,
                action: 'add',
                val: b[key]
            }));
        }

        if (!_.has(b, key)) {
            return _.merge(prv, keyValue(key, {
                [MODEL_SYNC_KEY]: true,
                action: 'remove'
            }));
        }

        var dif = diff(a[key], b[key]);

        if (_.isObject(dif) && _.isEmpty(dif)) return prv;
        return _.merge(prv, keyValue(key, dif));
    }, {});
}

function omitFunction(a) {
    // return JSON.parse(JSON.stringify(a));
    return _.reduce(a, function (prv, val, key) {
        if (_.isFunction(val)) return prv;
        prv[key] = val;
        return prv;
    }, {});
}

function modelDiff(a, b) {
    // var prv = performance.now();
    var x = diff(omitFunction(a), omitFunction(b));
    // console.log(performance.now() - prv);
    return x;
}


/***/ })
/******/ ]);
/**
 * Created by daewon.park on 2016-01-27.
 */

/* global _, FUNCTION_NAME, OUT_DATA, SOURCE_FID, TARGET_FID */
(function () {
    'use strict';

    var root = this;
    var MODULE = window.__module__;

    root.Brightics = root.Brightics || {};
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');
    var ENV = brtc_require('ENV');

    $.extend(true, root.Brightics, {
        VA: {
            Core: {
                Interface: {
                    Clazz: {},
                    Label: {},
                    Editor: {},
                    ModelLayoutManager: {},
                    Toolbar: {},
                    SideBarManager: {},
                    RightSideBarAdapter: {},
                    LeftSideBarAdapter: {},
                    Validator: {},
                    Launcher: {},
                    LauncherDialog: {},
                    Functions: {},
                    WidgetUtils: {},
                    DefaultModel: {},
                    ProjectContextMenuList: {},
                    Clipboard: {},
                    RunnableFactory: {},
                    AddonFunctionUtil: {}
                },
                Components: {
                    Base: {}
                },
                Controls: {},
                Default: {},
                Dialogs: {
                    FunctionProperties: {},
                    RefineSteps: {}
                },
                Editors: {
                    Diagram: {
                        Commands: {
                            ControlEditor: {}
                        }
                    },
                    Sheet: {
                        Controls: {
                            Optimization: {}
                        },
                        Commands: {},
                        Panels: {
                            Properties: {}
                        }
                    }
                },
                Functions: {
                    Library: {}
                },
                Shapes: {},
                Tools: {
                    MenuBar: {},
                    Adapter: {},
                    Manager: {},
                    ModelMigrator: {
                        Executor: {},
                        RuleList: {}
                    }
                },
                Utils: {},
                Views: {
                    Pages: {}
                },
                Widget: {
                    Controls: {}
                },
                Wizards: {
                    Pages: {}
                },
                Validator: {},
                AddonFunctionManager: {}
            },
            Implementation: {},
            Window: {
                Utils: {},
            },
            Controls: MODULE.Controls,
            Dao: MODULE.Dao,
            DataStructures: MODULE.DataStructures,
            Default: {},
            Dialogs: {},
            Setting: {
                Registry: {},
                Implement: {},
            },    //FIXME: ENV.Setting으로 들어가야하는지 확인필요.
            Env: {
                Session: {},
                Recommend: {}
            },
            Utils: {},
            Views: {},
            Workspace: {},
            Log: {},
            EventEmitter: MODULE.EventEmitter,
            ClassUtils: MODULE.ClassUtils,
            Vo: MODULE.Vo
        },
        Admin: {},
        COMMUNITY: {}
    });

    root.Brightics.VA.Core.Utils.IDGenerator = MODULE.IDGenerator;

    root.Brightics.VA.Env.Theme = 'office';

    root.Brightics.VA.Env.CoreVersion = ENV.CORE_VERSION;

    root.Brightics.VA.Env.Diagram = {
        PAPER_MARGIN_TOP: 20,
        PAPER_MARGIN_LEFT: 20,
        FIGURE_WIDTH: 195,
        FIGURE_HEIGHT: 60,
        GAP_WIDTH: 55,
        GAP_HEIGHT: 40
    };

    root.Brightics.VA.Env.DiagramInit = {
        PAPER_MARGIN_TOP: 20,
        PAPER_MARGIN_LEFT: 20,
        FIGURE_WIDTH: 195,
        FIGURE_HEIGHT: 60,
        GAP_WIDTH: 55,
        GAP_HEIGHT: 20
    };

    root.Brightics.VA.Env.Multiplicity = {
        Zero: '0',
        geZero: '0..*',
        One: '1',
        geOne: '1..*'
    };

    root.Brightics.VA.Env.Recommend.NextChart = {
        load: ['table', 'scatter'],
        associationRule: ['table', 'network'],
        bigDataScatter: ['scatter', 'table'],
        bigDataLine: ['line', 'table'],
        bigDataBoxPlot: ['boxplot', 'table'],
        bigDataColumn: ['column', 'table'],
        bigDataBar: ['bar', 'table']
    };

    root.Brightics.VA.Env.Recommend.Next = {
        data: {
            default: ['load', 'createTable', 'brightics.function.io$load13889', 'brightics.function.io$read_csv97059'],
            mdReplaceNumber: ['mdReplaceString', 'imputeNumberTypeFillColumn', 'numericalVariableDerivation'],
            mdReplaceString: ['mdReplaceNumber', 'imputeStringTypeFillColumn'],
            numericalVariableDerivation: ['conditionalUpdate', 'conditionalDerivation'],
            conditionalDerivation: ['conditionalUpdate'],
            conditionFilter: ['minmaxFilter', 'lengthFilter', 'stringFilter'],
            lengthFilter: ['stringFilter', 'conditionFilter', 'minmaxFilter'],
            minmaxFilter: ['conditionFilter', 'stringFilter', 'lengthFilter'],
            stringFilter: ['lengthFilter', 'conditionFilter', 'minmaxFilter'],
            imputeNumberTypeFillColumn: ['mdReplaceNumber', 'numericalVariableDerivation'],
            imputeRemoveLine: ['mdReplaceNumber', 'mdReplaceString'],
            imputeStringTypeFillColumn: ['mdReplaceString'],
            join: ['imputeRemoveLine', 'imputeNumberTypeFillColumn', 'imputeStringTypeFillColumn'],
            changeColumnName: ['capitalizeColName'], // 'reorganizeTable'
            frequency: ['join'],
            frequencyMat: ['join'],
            statisticSummary: ['join'],
            capitalizeColName: ['changeColumnName'], // 'reorganizeTable'
            linearRegressionTrain: ['linearRegressionPredict'],
            linearRegressionPredict: ['regressionEvaluation'],
            logisticRegressionTrain: ['logisticRegressionPredict'],
            logisticRegressionPredict: ['binaryClassEvaluation'],
            movingAverage: ['ewma'],
            pivot: ['imputeRemoveLine', 'imputeNumberTypeFillColumn', 'imputeStringTypeFillColumn'],
            hierarchicalClustering: ['hierarchicalClusteringPostProcess'],
            timeSeriesTranspose: ['timeSeriesDistance'],
            quantileDiscretizer: ['typeCast'],
            reorganizeTable: ['changeColumnName', 'capitalizeColName']
        },
        realtime: {
            default: ['streamingRead']
        },

        etl: {
            default: ['erdTSum', 'fabData', 'ept']
        },

        deeplearning: {
            default: ['dlLoad', 'conv2D', 'maxPooling2D']
        },


        getList: function (func, type) {
            return this[type || 'data'][func] || [];
        }
    };

    root.Brightics.VA.Env.Tags = {
        data: ['Trend', 'Timeseries', 'Transform', 'Sort', 'Preprocessing', 'Add Column', 'Filter', 'Remove', 'Missing Value', 'Statistics', 'Prescriptive'],
        realtime: ['I/O', 'Clustering', 'Filter', 'Preprocessing', 'Prescriptive', 'Trend', 'Transform'],
        etl: []
    };

    root.Brightics.VA.Default.model = {
        addProblems: function (problems) {
            if (problems && this.problemList.indexOf(problems) < 0) this.problemList = this.problemList.concat(problems);
        },
        getProblemsByFid: function (fid) {
            var problems = [];
            for (var i in this.problemList) {
                if (this.problemList[i] && this.problemList[i].fid === fid) {
                    problems.push(this.problemList[i]);
                }
            }
            return problems;
        },
        getProblemsByMid: function (mid) {
            var problems = [];
            for (var i in this.problemList) {
                if (this.problemList[i] && this.problemList[i].mid === mid) {
                    problems.push(this.problemList[i]);
                }
            }
            return problems;
        },
        newFnUnit: function (type) {
            var funcDefinition = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(this.type, type);
            var newFnUnitOption = {
                fid: Brightics.VA.Core.Utils.IDGenerator.func.id()
            };

            if (type === 'ifElse') {
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        functions: [{
                            fid: Brightics.VA.Core.Utils.IDGenerator.func.id()
                        }, {
                            fid: Brightics.VA.Core.Utils.IDGenerator.func.id()
                        }]
                    }
                };
            } else if (type === 'outData') {
                var unloadFid = Brightics.VA.Core.Utils.IDGenerator.func.id();
                var exportFid = Brightics.VA.Core.Utils.IDGenerator.func.id();
                var filePathId = '/brtc/repo/tmp/' + Brightics.VA.Core.Utils.IDGenerator.file.id();
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        functions: [{
                            fid: unloadFid,
                            param: {
                                'fs-paths': [filePathId]
                            }
                        }, {
                            fid: exportFid,
                            param: {
                                'input-path': filePathId,
                                'output-path': filePathId + '.csv'
                            }
                        }],
                        links: [{
                            'kid': Brightics.VA.Core.Utils.IDGenerator.link.id(),
                            'sourceFid': unloadFid,
                            'targetFid': exportFid
                        }]
                    }
                };
            } else if (type === 'refine') {
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        functions: [{
                            fid: Brightics.VA.Core.Utils.IDGenerator.func.id()
                        }]
                    }
                };
            } else if (type === 'dbReader') {
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        functions: [{
                            fid: Brightics.VA.Core.Utils.IDGenerator.func.id()
                        }]
                    }
                };
            } else if (type === 'load') {
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        functions: [{
                            fid: Brightics.VA.Core.Utils.IDGenerator.func.id()
                        }]
                    }
                };
            } else if (funcDefinition.defaultFnUnit[FUNCTION_NAME] === 'Subflow') {
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        functions: [{
                            fid: Brightics.VA.Core.Utils.IDGenerator.func.id()
                        }]
                    }
                };
            } else if (type === 'if') {
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        'if': $.extend(true,
                            funcDefinition.defaultFnUnit.param.if,
                            {mid: Brightics.VA.Core.Utils.IDGenerator.model.id()}
                        ),
                        'elseif': [],
                        'else': $.extend(true,
                            funcDefinition.defaultFnUnit.param.else,
                            {mid: Brightics.VA.Core.Utils.IDGenerator.model.id()}
                        )
                    }
                };
            } else if (type === 'forLoop') {
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        mid: Brightics.VA.Core.Utils.IDGenerator.model.id(),
                        'type': 'count',
                        'prop': {
                            'start': '${=}',
                            'end': '${=}',
                            'index-variable': ''
                        }
                    }
                };
            } else if (type === 'whileLoop') {
                newFnUnitOption = {
                    fid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
                    param: {
                        mid: Brightics.VA.Core.Utils.IDGenerator.model.id(),
                        'type': 'while',
                        'prop': {
                            'expression': '${=}',
                            'index-variable': ''
                        }
                    }
                };
            }

            if (funcDefinition.defaultFnUnit.outputs || funcDefinition.defaultFnUnit.outData) {
                var outData = FnUnitUtils.createOutData(this.type, type);
                $.extend(newFnUnitOption, outData);
                // for (var i = 0; i < funcDefinition['out-range'].min; i++) {
                //     newFnUnitOption[OUT_DATA] = newFnUnitOption[OUT_DATA] || [];
                //     newFnUnitOption[OUT_DATA].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
                // }

                if (type === 'refine') {
                    newFnUnitOption.param.functions[0][OUT_DATA] = newFnUnitOption[OUT_DATA];
                    newFnUnitOption.param.entries = [newFnUnitOption.param.functions[0].fid];
                } else if (type === 'dbReader') {
                    newFnUnitOption.param.functions[0][OUT_DATA] = newFnUnitOption[OUT_DATA];
                    newFnUnitOption.param.functions[0].param = {'df-names': [newFnUnitOption[OUT_DATA][0]]};
                } else if (type === 'load') {
                    newFnUnitOption.param.functions[0][OUT_DATA] = newFnUnitOption[OUT_DATA];
                    newFnUnitOption.param.functions[0].param = {'df-names': [newFnUnitOption[OUT_DATA][0]]};
                    newFnUnitOption.param.entries = [newFnUnitOption.param.functions[0].fid];
                } else if (funcDefinition.defaultFnUnit[FUNCTION_NAME] === 'Subflow') {
                    newFnUnitOption.param.functions[0][OUT_DATA] = newFnUnitOption[OUT_DATA];
                    newFnUnitOption.param.entries = [newFnUnitOption.param.functions[0].fid];
                }
            }
            
            return $.extend(true, {
                'persist-mode': 'auto'
            }, funcDefinition.defaultFnUnit, newFnUnitOption);
        },
        addFnUnit: function (fnUnit, index) {
            var _this = this;
            fnUnit.parent = function () {
                return _this;
            };

            if (typeof index !== 'undefined' && index > -1) {
                _this.functions.splice(index, 0, fnUnit);
            } else {
                _this.functions.push(fnUnit);
            }
        },
        removeFnUnit: function (fnUnitId) {
            var index = -1;
            for (var i in this.functions) {
                var fnUnit = this.functions[i];
                if (fnUnit.fid == fnUnitId) {
                    index = i;
                    delete fnUnit.parent;
                    break;
                }
            }
            if (index > -1) {
                var removed = this.functions[index];
                this.functions.splice(index, 1);
                return removed;
            }
        },
        getFnUnitById: function (fnUnitId) {
            for (var i in this.functions) {
                var fnUnit = this.functions[i];
                if (fnUnit.fid == fnUnitId) {
                    return fnUnit;
                }
            }
        },

        //메세지 처리 시 서브플로우의 상위 function 이름까지 조합하여 return
        getFnUnitNameById: function (fnUnitId, functions) {
            var functionHierarchy = [];
            var functions = functions || this.functions;
            for (var i in functions) {
                var fnUnit = functions[i];

                if (fnUnit.param && fnUnit.param.functions) {
                    var subFunc = this.getFnUnitNameById(fnUnitId, fnUnit.param.functions);
                    if (subFunc) {
                        return fnUnit.func + '.' + subFunc;
                    }
                }
                if (fnUnit.fid == fnUnitId) {
                    return fnUnit.func;
                }
            }
        },
        existsFnUnit: function (fnUnitId) {
            for (var i in this.functions) {
                var fnUnit = this.functions[i];
                if (fnUnit.fid == fnUnitId) {
                    return fnUnit;
                }

                if (fnUnit[FUNCTION_NAME] == 'Subflow') {
                    for (var j in fnUnit.param.functions) {
                        if (fnUnit.param.functions[j].fid == fnUnitId) {
                            return fnUnit;
                        }
                    }
                }
            }
        },
        getFnUnitByOutTable: function (table) {
            for (var i in this.functions) {
                var fnUnit = this.functions[i];
                var outTable = FnUnitUtils.getOutTable(fnUnit);
                // if ($.inArray(table, fnUnit[OUT_DATA]) > -1) {
                if ($.inArray(table, outTable) > -1) {
                    return fnUnit;
                }
            }
        },
        getFnUnitByOutData: function (table) {
            for (var i in this.functions) {
                var fnUnit = this.functions[i];
                var outData = FnUnitUtils.getOutData(fnUnit);
                // if ($.inArray(table, fnUnit[OUT_DATA]) > -1) {
                if ($.inArray(table, outData) > -1) {
                    return fnUnit;
                }
            }
        },
        getLinkUnitById: function (kid) {
            for (var i in this.links) {
                var linkUnit = this.links[i];
                if (linkUnit.kid == kid) {
                    return linkUnit;
                }
            }
        },
        getRoots: function (fnUnitId) {
            var roots = [];
            var previous = this.getPrevious(fnUnitId);
            if (previous.length == 0) {
                roots.push(fnUnitId);
            } else {
                for (var i in previous) {
                    roots = roots.concat(this.getRoots(previous[i]));
                }
            }
            return roots;
        },
        getParents: function (fnUnitId) {
            var parents = [];
            for (var i in this.links) {
                var link = this.links[i];
                if (link[TARGET_FID] == fnUnitId) {
                    parents.push(link[SOURCE_FID]);
                    parents = parents.concat(this.getParents(link[SOURCE_FID]));
                }
            }
            return parents;
        },
        getPrevious: function (fnUnitId) {
            var prev = [];
            for (var i in this.links) {
                var link = this.links[i];
                if (link[TARGET_FID] == fnUnitId) {
                    prev.push(link[SOURCE_FID]);
                }
            }
            return prev;
        },
        getPreFnUnitByCondition: function (fnUnitId, condition) {
            var previous = this.getPrevious(fnUnitId);
            for (var i in previous) {
                var fnUnit = this.getFnUnitById(previous[i]);
                if (condition(fnUnit)) {
                    return fnUnit;
                }
            }
        },
        getNext: function (fnUnitId) {
            var next = [];
            for (var i in this.links) {
                var link = this.links[i];
                if (link[SOURCE_FID] == fnUnitId) {
                    next.push(link[TARGET_FID]);
                }
            }
            return next;
        },
        getLeafs: function () {
            var leafs = [];
            for (var i in this.functions) {
                var fnUnit = this.functions[i];
                if (this.getNext(fnUnit.fid).length === 0) {
                    leafs.push(fnUnit.fid);
                }
            }
            return leafs;
        },
        getConnectedLinkUnits: function (fnUnitId) {
            var links = [];
            for (var i in this.links) {
                var link = this.links[i];
                if (link[SOURCE_FID] == fnUnitId || link[TARGET_FID] == fnUnitId) {
                    links.push(link);
                }
            }
            return links;
        },
        getParamValue: function (fid, key) {
            return this.getFnUnitById(fid).param[key];
        },
        adjustLinks: function () {
            var i, fids = [];
            for (i in this.functions) {
                if (this.functions[i]) {
                    fids.push(this.functions[i].fid);
                }
            }

            var unlinks = [];
            for (i in this.links) {
                var link = this.links[i];
                if (fids.indexOf(link[SOURCE_FID] || link['source-fid']) < 0 || fids.indexOf(link[TARGET_FID] || link['target-fid']) < 0) {
                    unlinks.push(link);
                }
            }
            for (i in unlinks) {
                this.links.splice(this.links.indexOf(unlinks[i]), 1);
            }
        },
        getAllPreviousFnUnitIds: function (fid) {
            var previousFnUnitIds = this.getPrevious(fid);
            var _this = this;
            return _.unique(previousFnUnitIds.reduce(function (acc, pFid) {
                var fnUnit = _this.getFnUnitById(pFid);
                if (Brightics.VA.Core.Utils.NestedFlowUtils.isProcessFunction(fnUnit)) {
                    var fids = _this.getAllPreviousFnUnitIds(pFid);
                    return acc.concat(fids);
                } else {
                    return acc.concat(pFid);
                }
            }, []));
        },
        getAllNextFnUnitIds: function (fid) {
            var nextFnUnitIds = this.getNext(fid);
            var _this = this;
            return _.unique(nextFnUnitIds.reduce(function (acc, nFid) {
                var fnUnit = _this.getFnUnitById(nFid);
                if (Brightics.VA.Core.Utils.NestedFlowUtils.isProcessFunction(fnUnit)) {
                    var fids = _this.getAllNextFnUnitIds(nFid);
                    return acc.concat(fids);
                } else {
                    return acc.concat(nFid);
                }
            }, []));
        },
        getAllPreviousFnUnits: function (fid) {
            var _this = this;
            return this.getAllPreviousFnUnitIds(fid).map(function (_fid) {
                return _this.getFnUnitById(_fid);
            });
        },
        getAllNextFnUnits: function (fid) {
            var _this = this;
            return this.getAllNextFnUnitIds(fid).map(function (_fid) {
                return _this.getFnUnitById(_fid);
            });
        },
        getLinkSourceFnUnits: function (fid) {
            var _this = this;
            var fnUnit = this.getFnUnitById(fid);
            if (Brightics.VA.Core.Utils.NestedFlowUtils.isProcessFunction(fnUnit)) {
                var prvFids = this.getPrevious(fid);
                return _.unique(prvFids.reduce(function (acc, nFid) {
                    return acc.concat(_this.getLinkSourceFnUnits(nFid));
                }, [fnUnit]), 'fid');
            } else {
                return [fnUnit];
            }
        },
        getLinkTargetFnUnits: function (fid) {
            var _this = this;
            var fnUnit = this.getFnUnitById(fid);
            if (Brightics.VA.Core.Utils.NestedFlowUtils.isProcessFunction(fnUnit)) {
                var nextFids = this.getNext(fid);
                return _.unique(nextFids.reduce(function (acc, nFid) {
                    return acc.concat(_this.getLinkTargetFnUnits(nFid));
                }, [fnUnit]), 'fid');
            } else {
                return [fnUnit];
            }
        }
    };

    root.Brightics.VA.Default.analyticsModel = {
        type: 'data',
        sheets: [],
        param: {},
        functions: [],
        links: [],
        preferences: {},
        problemList: [],
        report: {
            title: 'Report',
            data: []
        },
        inVariableList: function (fid) {
            return _.findIndex(this.variableRef, function (ref) {
                return ref.fid === fid;
            });
        },
        getVariable: function (fid, paramKey) {
            var index = this.inVariableList(fid);
            if (index > -1) {
                return this.variableRef[index].param[paramKey];
            }
        },
        getVariables: function (fid) {
            var index = this.inVariableList(fid);
            if (index > -1) {
                return this.variableRef[index].param;
            }
        },
        getParameters: function () {
            return this.param;
        },
        getParameter: function (key) {
            return this.param[key];
        },
        setParameter: function (key, val) {
            this.param[key] = val;
        },
        addVariableDef: function (name, variable) {
            this.variables[name] = $.extend({}, variable);
        },
        removeVariableDef: function (name) {
            delete this.variables[name];
        },
        setVariableDef: function (name, variable) {
            if (this.variables[name]) this.variables[name] = $.extend({}, variable);
        },
        addVariable: function (fid, paramKey, variable) {
            var index = this.inVariableList(fid);
            if (index > -1) {
                this.variableRef[index].param[paramKey] = variable;
            } else {
                var item = {
                    fid: fid,
                    param: {}
                };
                item.param[paramKey] = variable;
                this.variableRef.push(item);
            }
        },
        setVariable: function (fid, paramKey, variable) {
            var index = this.inVariableList(fid);
            if (index > -1 && this.variableRef[index].param[paramKey]) {
                this.variableRef[index].param[paramKey] = variable;
            }
        },
        removeVariable: function (fid, paramKey) {
            var index = this.inVariableList(fid);
            if (index > -1) {
                delete this.variableRef[index].param[paramKey];
                if (Object.keys(this.variableRef[index].param).length === 0) {
                    this.variableRef.splice(index, 1);
                }
            }
        }
    };

    root.Brightics.VA.Utils.CookieUtil = {
        setCookie: function (cname, cvalue, exdays) {
            var expires = '';
            if (exdays) {
                var d = new Date();
                d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
                expires = "expires=" + d.toUTCString();
            }
            document.cookie = cname + "=" + cvalue + "; " + expires;
        },


        getCookie: function (cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return undefined;
        }
    };

    root.Brightics.VA.Env.SQLFunctions = [
        'ROUND()', 'MAX()', 'MIN()', 'SUM()', 'AVG()', 'OVER()', //Related to NUMBER
        'NVL()', 'CONCAT()', 'LPAD()', 'LTRIM()', 'RPAD()', 'RTRIM()', 'SUBSTR()', 'SUBSTRING()', //Related to STRING
        'FROM_UNIXTIME()', 'YEAR()', 'MONTH()', 'WEEKOFYEAR()' //Related to DATE;
    ];

    root.Brightics.VA.Env.PersistFalseFunctions = [
        //TODO 추후 재설계후 적용해야함. 2017.06.01 PVR 제외
        // 'Filter',
        // 'StringFilter',
        // 'Remove',
        // 'ReplaceNumeric',
        // 'ReplaceString',
        // 'AddColumn',
        // 'AddFunctionColumn',
        // 'AddStringLength',
        // 'Capitalize',
        // 'CapitalizeColumnName',
        // 'ChangeColumnName',
        // 'CompareDateTime',
        // 'DateTimeFormatter',
        // 'DecomposeDateTime',
        // 'ImputeRemoveLine',
        // 'ImputeStringTypeFillColumn',
        // 'LengthFilter',
        // 'SelectColumn',
        // 'ShiftDateTime',
        // 'StringSplit',
        // 'Trim',
        // 'TypeCast'
    ]

}).call(this);
/**
 * Created by sds on 2017-08-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    const LOG_LEVEL = {'trace': 0, 'debug': 1, 'info': 2, 'warn': 3, 'error': 4};

    function Log(funcName) {
        this.funcName = funcName;
    };

    Log.prototype.sendLog = function (clientLogLevel, message, options) {
        //TODO: Batch-Compatible Logger
        var bodyOption = $.extend(true, {
            funcNm: this.funcName,
            level: clientLogLevel || 'error',
            message: message
        }, options);
        var option = {
            url: "api/va/log4js",
            type: "POST",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(bodyOption)
        };

        var sessionLogLevel = Brightics.VA.Env.Session.logLevel.toLowerCase();
        if (LOG_LEVEL[sessionLogLevel] <= LOG_LEVEL[clientLogLevel]) {
            $.ajax(option);
        }
    };

    Log.prototype.trace = function (message, options) {
        this.sendLog('trace', message, options);
        console.log('[' + this.funcName + '] TRACE: ' + message);
    };

    Log.prototype.debug = function (message, options) {
        this.sendLog('debug', message, options);
        console.log('[' + this.funcName + '] DEBUG: ' + message);
    };

    Log.prototype.info = function (message, options) {
        this.sendLog('info', message, options);
        console.log('[' + this.funcName + '] INFO: ' + message);
    };


    Log.prototype.warn = function (message, options) {
        this.sendLog('warn', message, options);
        console.log('[' + this.funcName + '] WRAN: ' + message);
    };
    Log.prototype.error = function (message, options) {
        this.sendLog('error', message, options);
        console.log('[' + this.funcName + '] ERROR: ' + message);
    };


    Brightics.VA.Log = Log;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Command(eventSource, options) {
        this.event = {
            source: eventSource,
            type: ''
        };
        this.options = options && $.extend({undoable: true}, options) || {undoable: true};
        this.old = {};
        this.FnUnitUtils = brtc_require('FnUnitUtils');
    }

    Command.prototype.canUndo = function () {
        return true;
    };

    Command.prototype.canRedo = function () {
        return true;
    };

    Command.prototype.execute = function () {

    };

    Command.prototype.undo = function () {

    };

    Command.prototype.redo = function () {
        this.execute();
    };

    Command.prototype.getId = function () {
        return 'brightics.va.command';
    };

    Command.prototype.getLabel = function () {
        return this.options.label || '';
    };

    Command.prototype.getMainModel = function () {
        return this.options.mainModel;
    };

    Command.prototype.getTargetModel = function () {
        return this.options.analyticsModel;
    };

    Command.prototype.getActiveModel = function () {
        return Studio.getActiveEditor().getActiveModel();
    }

    Brightics.VA.Core.Command = Command;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function CompoundCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);

        this.options.type = this.options.type || 'none-interval';
        this.commandList = this.commandList || [];
    }

    CompoundCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    CompoundCommand.prototype.constructor = CompoundCommand;

    CompoundCommand.prototype.add = function (command) {
        if (command instanceof Brightics.VA.Core.Command) {
            this.commandList.push(command);
            $.extend(true, this.options, command.options);
        } else if (_.isArray(command)) {
            _.forEach(command, function (cmd) {
                if (cmd instanceof Brightics.VA.Core.Command) {
                    this.commandList.push(cmd);
                    $.extend(true, this.options, cmd.options);
                }
            }.bind(this));
        }
    };

    CompoundCommand.prototype.canUndo = function () {
        return !(this.commandList === undefined || this.commandList.length === 0);
    };

    CompoundCommand.prototype.canRedo = function () {
        return !(this.commandList === undefined || this.commandList.length === 0);
    };

    CompoundCommand.prototype.execute = function () {
        var _this = this;
        if (this.options.type === 'interval') {
            var i = this.commandList.length - 1;
            this.commandList[i].options.type = this.options.type;
            this.commandList[i].options.analyticsModel = this.options.analyticsModel;
            this.commandList[i].options.mainModel = this.options.mainModel;
            this.commandList[i].execute();
        } else {
            $.each(this.commandList, function (index, command) {
                command.event.type = _this.event.type;
                command.options.type = _this.options.type;
                command.options.analyticsModel = _this.options.analyticsModel;
                command.options.mainModel = _this.options.mainModel;
                command.execute();
            });
        }
    };

    CompoundCommand.prototype.undo = function () {
        var _this = this;
        if (this.options.type === 'interval') {
            this.commandList[0].options.type = this.options.type;
            this.commandList[0].undo();
        } else {
            for (var i = _this.commandList.length - 1; i >= 0; i--) {
                var command = _this.commandList[i];
                command.event.type = _this.event.type;
                command.options.type = _this.options.type;
                command.undo();
            }
        }
    };

    CompoundCommand.prototype.redo = function () {
        var _this = this;
        if (this.options.type === 'interval') {
            var i = this.commandList.length - 1;
            this.commandList[i].options.type = this.options.type;
            this.commandList[i].redo();
        } else {
            $.each(this.commandList, function (index, command) {
                command.event.type = _this.event.type;
                command.options.type = _this.options.type;
                command.redo();
            });
        }
    };

    CompoundCommand.prototype.getId = function () {
        return this.options.id ? this.options.id : this.commandList[0].getId();
    };

    CompoundCommand.prototype.getLabel = function () {
        return this.options.label ? this.options.label : this.commandList[0].getLabel();
    };

    Brightics.VA.Core.CompoundCommand = CompoundCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */

/* global _, brtc_require */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Logger = new Brightics.VA.Log('CommandManager');

    var modelDiff = brtc_require('modelDiff');

    function CommandManager(analyticsModel, editor) {
        this.index = -1;
        this.stack = [];
        this.listeners = [];
        this.historyListener = [];
        this.isExecuting = false;
        this.analyticsModel = analyticsModel || {};

        this.interval = 1000; // interval time to treat commands as a compound command

        this.init(editor);
    }

    CommandManager.prototype.init = function (editor) {
        if (editor) {
            this.editor = editor;
            this.mainModel = editor.getModel();
        }
    };

    CommandManager.prototype.canUndo = function (command) {
        if (this.isExecuting) {
            return false;
        }

        if (typeof command === 'undefined') {
            command = this.stack[this.index];
        }

        if (!(command instanceof Brightics.VA.Core.Command)) {
            return false;
        }

        return (this.index !== -1) && command.canUndo();
    };

    CommandManager.prototype.canRedo = function (command) {
        if (this.isExecuting) {
            return false;
        }

        if (typeof command === 'undefined') {
            command = this.stack[this.index + 1];
        }

        if (!(command instanceof Brightics.VA.Core.Command)) {
            return false;
        }

        return (this.index + 1 < this.stack.length) && command.canRedo();
    };

    CommandManager.prototype.notifyListeners = function (command, modelDiff) {
        for (let i = 0; i < this.listeners.length; i++) {
            try {
                this.listeners[i](command, modelDiff);
            } catch (err) {
                throw err;
            }
        }
    };

    CommandManager.prototype.registerCallback = function (callback) {
        if (typeof callback === 'function') {
            this.listeners.push(callback);
        }
    };

    CommandManager.prototype.registerCallbackLeft = function (callback) {
        if (typeof callback === 'function') {
            this.listeners.splice(0, 0, callback);
        }
    };

    CommandManager.prototype.unRegisterCallback = function (callback) {
        if (typeof callback === 'function') {
            var index = this.listeners.indexOf(callback);
            if (index > -1) {
                this.listeners.splice(index, 1);
            }
        }
    };

    CommandManager.prototype.execute = function (command) {
        if (!command) return;
        return this._execute(command);
    };
    CommandManager.prototype.setActiveModel = function (command) {
        var model = this.editor.getActiveModel();
        command.options.analyticsModel = model || this.analyticsModel;
    };

    CommandManager.prototype._execute = function (command) {
        try {
            Logger.trace('Execute Command START...');
            command.event.type = 'EXECUTE';


            // command.options.analyticsModel = this.analyticsModel;
            this.setActiveModel(command);
            command.options.mainModel = this.mainModel;
            this.check();
            if (command.options.mainModel.type == 'data')// TODO @sungjin1.kim 확인필요
                command.options.editorContext = {
                    mid: this.editor.getActiveModel().mid,
                    fnUnit: this.editor.getActiveFnUnit()
                };
            if (command.execute() === false || !command.options.undoable) {
                return false;
            }

            if (this.index + 1 !== this.stack.length) {
                this.stack.splice(this.index + 1, this.stack.length - this.index - 1);
            }
            this.stack.push(command);
            this.index++;
            this.notifyListeners(command, this.getModelDiff());
            Logger.debug('Command Executed: \'' + this._getCommandName(command) + '\'');
            Logger.trace('Execute Command END...');
            return true;
        } catch (e) {
            Logger.error('Failed to execute command: ' + this._getCommandName(command));
            Logger.error(JSON.stringify(command.options));
            Logger.error(e.stack);
            
            var  commandErrorMessage = 'Failed to save last operation. Back up the data from the last operation, then reopen the editor and try again.';
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(commandErrorMessage);
            return false;
        }
    };

    CommandManager.prototype.undo = function (notify) {
        var command = this.stack[this.index];
        var hasToNotify = !!notify || _.isUndefined(notify);
        if (this.canUndo(command)) {
            command.event.type = 'UNDO';
            if (hasToNotify) this.check();
            command.undo();

            this.index--;

            if (hasToNotify) {
                this.notifyListeners(command, this.getModelDiff());
            }
        }
        return command;
    };

    CommandManager.prototype.redo = function (notify) {
        var command = this.stack[this.index + 1];
        var hasToNotify = !!notify || _.isUndefined(notify);
        if (this.canRedo(command)) {
            command.event.type = 'REDO';
            if (hasToNotify) this.check();
            command.redo();

            this.index++;
            if (hasToNotify) {
                this.notifyListeners(command, this.getModelDiff());
            }
        }
        return command;
    };

    CommandManager.prototype.getStacks = function () {
        return this.stack;
    };

    CommandManager.prototype.go = function (history) {
        var commands = [];
        this.check();
        if (parseInt(history.index) < this.index) {
            for (var undoIdx = this.index; undoIdx > parseInt(history.index); undoIdx--) {
                commands.push(this.undo(false));

                if (undoIdx === parseInt(history.index + 1)) {
                    this.notifyRefresh(new Brightics.VA.Core.Editors.Diagram.Commands.GoHistoryCommand(
                        this.stack[history.index] ? {
                            options: this.stack[history.index].options,
                            commands: commands
                        } : {
                            options: {},
                            commands: commands
                        }),
                        this.getModelDiff()
                    );
                }
            }
        } else if (parseInt(history.index) > this.index) {
            for (var redoIdx = this.index; redoIdx < parseInt(history.index); redoIdx++) {
                commands.push(this.redo(false));

                if ((redoIdx + 1) === parseInt(history.index)) {
                    this.notifyRefresh(new Brightics.VA.Core.Editors.Diagram.Commands.GoHistoryCommand(
                        this.stack[history.index] ? {
                            options: this.stack[history.index].options,
                            commands: commands
                        } : {
                            options: {},
                            commands: commands
                        }),
                        this.getModelDiff()
                    );
                }
            }
        }
    };

    CommandManager.prototype.notifyRefresh = function (historyListener, modelDiff) {
        for (var i = 0; i < this.historyListener.length; i++) {
            this.historyListener[i](historyListener, modelDiff);
        }
    };

    CommandManager.prototype.registerGoHistoryCallback = function (callback) {
        if (typeof callback === 'function') {
            this.historyListener.push(callback);
        }
    };

    CommandManager.prototype.registerGoHistoryCallbackLeft = function (callback) {
        if (typeof callback === 'function') {
            this.historyListener.splice(0, 0, callback);
        }
    };

    CommandManager.prototype.unRegisterGoHistoryCallback = function (callback) {
        if (typeof callback === 'function') {
            var index = this.historyListener.indexOf(callback);
            if (index > -1) {
                this.historyListener.splice(index, 1);
            }
        }
    };

    CommandManager.prototype._getCommandName = function (inputCmd) {
        var cmdName = inputCmd.getId() || inputCmd.constructor.name;
        if (inputCmd instanceof Brightics.VA.Core.CompoundCommand) {
            inputCmd.commandList.forEach(function (cmdObj) {
                cmdName += cmdObj.getId() || cmdObj.constructor.name + ' ';
            });
        }
        return cmdName || '';
    };

    CommandManager.prototype.getIndex = function () {
        return this.index;
    };

    CommandManager.prototype.check = function () {
        this.clonedModel = _.cloneDeep(this.mainModel);
    };

    CommandManager.prototype.getModelDiff = function () {
        var diff = modelDiff(this.clonedModel, this.mainModel);
        this.clonedModel = null;
        return diff;
    };

    Brightics.VA.Core.CommandManager = CommandManager;
}.call(this));

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const STATUS = 'status';
    const SUCCESS = 'success';
    const ABORT = 'abort';
    const FAIL = 'fail';
    const CATCH = 'catch';
    const READY = 'ready';
    const PENDING = 'pending';

    function JobDelegator(options) {
        this.eventTypes = [
            STATUS, SUCCESS, ABORT, FAIL, CATCH, READY, PENDING
        ];
        this.initListeners();
        this.setListeners(options || {});
    }

    JobDelegator.prototype.initListeners = function () {
        this.listeners = {};
        this.eventTypes.forEach(function (type) {
            this.listeners[type] = [];
        }.bind(this));
    }

    JobDelegator.prototype.setListeners = function (options) {
        this.eventTypes.forEach(function (type) {
            var callbacks = options[type];
            var listeners = this.listeners[type];
            if (callbacks) {
                // callback이 array인 경우
                if ($.isArray(callbacks)) {
                    callbacks.forEach(function (fn) {
                        if (typeof fn === 'function') {
                            listeners.push(fn);
                        }
                    })
                }
                // callback이 함수인 경우
                else if (typeof callbacks === 'function') {
                    listeners.push(callbacks);
                }
            }
        }.bind(this));
    }

    JobDelegator.prototype.getProcessingUnit = function (callback) {
        if (callback) this.processingUnit = callback;
        return this;
    };    

    JobDelegator.prototype._fire = function (type, res, index) {
        var listeners = this.listeners[type];
        listeners.forEach(function (callback) {
            if (typeof callback === 'function') {
                callback(res, index);
            }
        });
    }

    JobDelegator.prototype._fireStatus = function (res, index) {        
        this._fire(STATUS, res, index);
    };

    JobDelegator.prototype._fireSuccess = function (res, index) {
        this._fire(SUCCESS, res, index);
    };

    JobDelegator.prototype._fireFail = function (res, index) {
        this._fire(FAIL, res, index);
    };

    JobDelegator.prototype._fireAbort = function (res, index) {
        this._fire(ABORT, res, index);
    };

    JobDelegator.prototype._fireCatch = function (err, index) {
        this._fire(CATCH, err, index);
    };

    JobDelegator.prototype._firePending = function (res, index) {
        this._fire(PENDING, res, index);
    };

    Brightics.VA.Core.JobDelegator = JobDelegator;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Job(options) {
        Brightics.VA.Core.JobDelegator.call(this, options);

        this.runnable = null;
        this._abort = false;
    }

    Job.prototype = Object.create(Brightics.VA.Core.JobDelegator.prototype);
    Job.prototype.constructor = Job;

    Job.prototype._start = function (runnable) {
        var opt = {
            url: 'api/va/v2/analytics/jobs',
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            blocking: false,
            data: JSON.stringify(runnable)
        };
        return $.ajax(opt);
    };

    Job.prototype._stop = function (type) {
        var opt = {
            url: 'api/va/v2/analytics/jobs/' + this.runnable.jid + '/delete',
            type: 'POST',
            blocking: false,
            contentType: 'application/json; charset=utf-8'
        };
        if (type) {
            var data = {'type': type};
            opt.data = JSON.stringify(data);
        }
        return $.ajax(opt);
    };

    Job.prototype._check = function (jobId) {
        var option = {
            url: 'api/va/v2/analytics/jobs/' + jobId,
            type: 'GET',
            blocking: false
        };
        return $.ajax(option);
    };

    Job.prototype._scheduleCheckStatus = function (jobId) {
        var _this = this;
        var checkTimer = function () {
            _this._check(jobId).done(function (res) {
                if (_this._abort) {
                    _this._fireAbort({
                        jobId: _this.runnable.jid,
                        end: Date.now(),
                        status: 'ABORT',
                        message: 'Job aborted by user'
                    });
                } else {
                    if (res.status === 'FAIL') {
                        _this._fireFail(res);
                    }
                    else if (res.status === 'SUCCESS') {
                        _this._fireSuccess(res);
                    } else if (res.status === 'WAIT') {
                        _this._firePending(res);
                        setTimeout(checkTimer, 500);
                    } else {
                        _this._fireStatus(res);
                        setTimeout(checkTimer, 500);
                    }
                }
            }).fail(_this._fireCatch.bind(_this));
        };
        setTimeout(checkTimer, 500);
    };

    Job.prototype.start = function (runnable) {
        var _this = this;
        this.runnable = runnable;
        this._start(runnable).done(function () {
            _this._scheduleCheckStatus(runnable.jid);
        }).fail(_this._fireCatch.bind(_this));
    };

    Job.prototype.stop = function (type) {
        this._stop(type);
        this._abort = true;
    };

    Brightics.VA.Core.Job = Job;

}).call(this);
/**
 * Created by daewon.park on 2016-09-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');

    function ModelLauncher() {
        this.jobScheduler = {};
    }

    ModelLauncher.prototype._generateJobId = function (mainId) {
        return 'va_' + mainId + '_' + moment(Date.now()).format('YYYYMMDDHHmmssSSS');
    };

    ModelLauncher.prototype.launchUnit = function (fnUnit, args, options, listeners) {
        console.error('must implement Function launchUnit');
    };

    ModelLauncher.prototype.launchModel = function (model, args, options, listeners) {
        console.error('must implement Function launchModel');
    };

    ModelLauncher.prototype._launch = function (launchOptions, args, options, listeners) {
        console.error('must implement Function _launch');        
    };

    ModelLauncher.prototype._extendListeners = function (defaultListeners, listeners) {
        var _listeners = defaultListeners;
        for (var type in listeners) {
            var listener = listeners[type];
            if (listener) {
                if ($.isArray(listener)) {
                    listener.forEach(function (fn) {
                        if (!_listeners[type]) _listeners[type] = [];
                        _listeners[type].push(fn);
                    })
                }
                else if (typeof listener === 'function') {
                    if (!_listeners[type]) _listeners[type] = [];
                    _listeners[type].push(listener);
                }
            }
        }
    }

    ModelLauncher.prototype.terminate = function (jobId) {
        var job = this.jobScheduler[jobId];
        if (job) {
            job.stop();
            delete this.jobScheduler[jobId];
        }
    };

    ModelLauncher.prototype._getPendingMessage = function (res) {
        return res.pendingStatus || 'Pending';
    };

    ModelLauncher.prototype._getProcessingMessage = function (res) {
        var exceptErrorCodeList = ['BR-0021', 'BR-0022', 'BR-0023', 'BR-0024', 'BR-0025', 'BR-0026'];
        if (res.errorInfo) {
            var failedFuncId = this._getFailedFuncId(res);
            var messages = [];
            for (var i in res.errorInfo) {
                var errorInfo = res.errorInfo[i];
                if (errorInfo.errorCode) { // 예전 버전
                    var model = Studio.getEditorContainer().getActiveModelEditor().getModel();
                    var funcName = model.getFnUnitNameById(failedFuncId);
                    var params = Brightics.VA.Core.Utils.MessageUtils.getFunctionLabels(funcName, res.errorInfo[i].parameter);
                    messages.push(Brightics.VA.Core.Utils.MessageUtils.getMessage(res.errorInfo[i].errorCode, params));
                    if (res.errorInfo[i].detailMessage) messages.push(res.errorInfo[i].detailMessage);
    
                    if ($.inArray(res.errorInfo[i].errorCode, exceptErrorCodeList) > -1) {
                        var message = [];
                        message.push(Brightics.VA.Core.Utils.MessageUtils.getMessage(res.errorInfo[i].errorCode, params));
                        return message.join('\n');
                    }
                } else {
                    if (errorInfo.message) {
                        messages.push(errorInfo.message);
                    }
                }
            }
            return messages.join('\n');
        } else {
            return res.message || '';
        }

    };

    ModelLauncher.prototype._getProcessingDetailMessage = function (res) {
        if (res.errorInfo) {
            var detailMessages = [];
            for (var i in res.errorInfo) {
                var errorInfo = res.errorInfo[i];
                if (errorInfo.detailMessage) {
                    detailMessages.push(errorInfo.detailMessage);
                }
            }
            return detailMessages.join('\n');
        } else {
            return res.detailMessage || '';
        }
    };

    ModelLauncher.prototype._getFailedFuncId = function (res) {
        var processes = res.processes;

        for (var i in processes) {
            var functions = processes[i].functions;
            for (var j in functions) {
                if (functions[j].status === 'FAIL') {
                    return functions[j].fid;
                }
            }
        }
    };

    ModelLauncher.prototype._fireEvents = function (events) {
        // 하나의 PROCESS 에 대한 EVENT 만 들어온다고 가정한다.
        // 즉 BEGIN-PROCESS(혹은 END-PROCESS) 가 2개 이상 들어올 일은 없다.
        // BEGIN-PROCESS, BEGIN-UNIT, END-UNIT, END-PROCESS 순으로 정렬한다.
        var eventOrder = {
            'BEGIN-JOB': 0,
            'PENDING-JOB': 1,
            'BEGIN-PROCESS': 2,
            'BEGIN-UNIT': 3,
            'END-UNIT': 4,
            'END-PROCESS': 5,
            'END-JOB': 6
        };
        events.sort(function (e1, e2) {
            var order = eventOrder[e1.eventType] - eventOrder[e2.eventType];
            if (order == 0) {
                return e1.begin - e2.begin;
            } else {
                return order;
            }
        });
        for (var i in events) {
            Studio.getInstance().fireDebugEvent(events[i]);
        }
    };

    Brightics.VA.Core.ModelLauncher = ModelLauncher;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');

    function ModelLauncherManager() {
        this.jobScheduler = {};
        this.createControls();
    }

    ModelLauncherManager.prototype.createControls = function () {
        this.launchers = {};
        for (var clazz in Brightics.VA.Core.Interface.Launcher) {
            this.launchers[clazz] = new Brightics.VA.Core.Interface.Launcher[clazz]();
        }
    };

    ModelLauncherManager.prototype.terminate = function (jobId, clazz) {
        if (clazz && this.launchers[clazz]) {
            this.launchers[clazz].terminate(jobId);
        } else {
            for (var i in this.launchers) {
                this.launchers[i].terminate(jobId);
            }
        }
    };

    ModelLauncherManager.prototype.prepareLaunch = function () {
        Studio.getEditorContainer().getActiveModelEditor().prepareLaunch();
    };

    ModelLauncherManager.prototype.launchModel = function (model, args, options, listeners) {
        try {
            var _listeners = {
                'catch': [function (err) {
                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                }]
            };
            this._extendListeners(_listeners, listeners);
            this.launchers[model.type].launchModel(model, args, options, listeners);
        } catch (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Cannot execute the flow. It contains invalid contents.');
        }
    };

    ModelLauncherManager.prototype.launchUnit = function (fnUnit, args, options, listeners) {
        var model = fnUnit.parent().getMainModel();
        var _this = this, args = args || {}, options = options || {}, clazz = model.type;

        var outTable = FnUnitUtils.getOutTable(fnUnit);
        for (var i in outTable) {
            Brightics.VA.Core.DataQueryTemplate.removeCache(model.mid, outTable[i]);
        }

        var regex = /\$\{=(?:[a-zA-z_])(?:[a-zA-Z0-9_]*)\}/,
            regexComment = /"(\\[\s\S]|[^"])*"|'(\\[\s\S]|[^'])*'|(--.*|\/\/.*|\/\*[\s\S]*?\*\/)/gm,
            needToSetVariable = false;
        for (var key in fnUnit.param) {
            var value = typeof fnUnit.param[key] == 'string' ? fnUnit.param[key] : JSON.stringify(fnUnit.param[key]);
            var replaced = value.replace(regexComment, function (match, g1, g2, g3) {
                if (g1) return match;
                if (g2) return match;
                if (g3) return '';
            });
            var ret = regex.exec(replaced);
            var keyword = ['${=true}', '${=false}'];

            if (ret && ret.length > 0) {
                if (keyword.indexOf(ret[0]) === -1) {
                    needToSetVariable = true;
                    break;
                }
            }
        }

        var _listeners = {
            'catch': [function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            }]
        };
        this._extendListeners(_listeners, listeners);

        var launch = function (dialogResult) {
            var _args = dialogResult ? dialogResult.args : args;
            _this.launchers[clazz].launchUnit(fnUnit, _args, options, _listeners);
        };


        var dialogOptions = {
            close: function (dialogResult) {
                if (dialogResult.OK) launch(dialogResult);
            },
            analyticsModel: model
        };


        if (!needToSetVariable &&
                model.variableRef &&
                model.variableRef.length) {
            for (var j in model.variableRef) {
                var gvFid = model.variableRef[j].fid;
                if (gvFid === fnUnit.fid) {
                    needToSetVariable = true;
                    break;
                }

                if (fnUnit[FUNCTION_NAME] === 'Subflow') {
                    for (var k in fnUnit.param.functions) {
                        if (gvFid === fnUnit.param.functions[k].fid) {
                            needToSetVariable = true;
                            break;
                        }
                    }
                }
                if (needToSetVariable) break;
            }
        }


        if (needToSetVariable) {
            var appendTo = Studio.getEditorContainer().getActiveModelEditor().getMainArea();
            if (model.variables && Object.keys(model.variables).length > 0) {
                if (clazz === 'realtime') {
                    if (Brightics.VA.SettingStorage.getValue('editor.variable.visible') === 'true') {
                        new Brightics.VA.Core.Dialogs.RunRealTimeDialog(appendTo, dialogOptions);
                    } else {
                        var defaultArgs = {};
                        for (var key in model.variables) {
                            var gvDef = model.variables[key];
                            var temp;
                            if (gvDef.type.indexOf('array') > -1 &&
                                    gvDef.value.length == 1) {
                                temp = gvDef.value[0];
                            } else {
                                temp = gvDef.value;
                            }

                            if (!_.isUndefined(temp)) defaultArgs[key] = gvDef.value;
                        }
                        launch({
                            OK: true,
                            args: defaultArgs
                        });
                    }
                } else if (clazz === 'etl') {
                    new Brightics.VA.Implementation.ETLFlow.Dialogs.LaunchProgressDialog(appendTo, dialogOptions);
                } else {
                    if (Brightics.VA.SettingStorage.getValue('editor.variable.visible') === 'true') {
                        new Brightics.VA.Core.Dialogs.RunDataDialog(appendTo, dialogOptions);
                    } else {
                        var defaultArgs = {};
                        for (var key in model.variables) {
                            var gvDef = model.variables[key];
                            var temp;
                            if (_.isArray(gvDef.value) && gvDef.value.length === 1) {
                                temp = gvDef.value[0];
                            } else {
                                temp = gvDef.value;
                            }

                            if (!_.isUndefined(temp)) defaultArgs[key] = gvDef.value;
                        }
                        launch({
                            OK: true,
                            args: defaultArgs
                        });
                    }
                }
            } else {
                setTimeout(function () {
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Variables are required to run the function.');
                }, 100);
            }
        } else {
            launch();
        }
    };

    ModelLauncherManager.prototype.stopCheckModel = function () {
        this.launchers['deeplearning'].stopCheckModel();
    };

    ModelLauncherManager.prototype._extendListeners = function (defaultListeners, listeners) {
        var _listeners = defaultListeners;
        for (var type in listeners) {
            var listener = listeners[type];
            if (listener) {
                if ($.isArray(listener)) {
                    listener.forEach(function (fn) {
                        if (!_listeners[type]) _listeners[type] = [];
                        _listeners[type].push(fn);
                    })
                }
                else if (typeof listener === 'function') {
                    if (!_listeners[type]) _listeners[type] = [];
                    _listeners[type].push(listener);
                }
            }
        }
    };

    Brightics.VA.Core.ModelLauncherManager = ModelLauncherManager;
}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function EventDetector(launchOptions) {
        this.cache = {};
        this.labelMap = {};
        this.subflowMap = {};
        this.launchOptions = launchOptions;

        for (var i in this.launchOptions.originalModels) {
            var model = this.launchOptions.originalModels[i];
            this.labelMap[model.mid] = model.title;
            this._scanFunctions(model.mid, model);
        }
    }

    EventDetector.prototype._scanFunctions = function (mid, model, parentId) {
        for (var j in model.functions) {
            var fnUnit = model.functions[j],
                key = mid + '_' + fnUnit.fid;
            
            this.labelMap[key] = fnUnit.display.label;
            // Subflow 의 경우 backend 에서 Subflow 의 BEGIN, END 상태를 주지 않는다.
            // Subflow 의 첫번째 함수가 시작되었을 때 Subflow 를 BEGIN 상태로
            // Subflow 의 마지막 함수가 종료되었을 때 Subflow 를 END 상태로 변경하기 위해 저장한다.
            if (fnUnit[FUNCTION_NAME] == 'Subflow' && fnUnit.param.functions.length > 0) {
                var subflow = {
                    fid: fnUnit.fid,
                    first: fnUnit.param.functions[0].fid,
                    last: fnUnit.param.functions[fnUnit.param.functions.length - 1].fid
                };
                for (var s in fnUnit.param.functions) {
                    var func = fnUnit.param.functions[s];
                    this.subflowMap[mid + '_' + func.fid] = subflow;
                }
            } else if (fnUnit.param.functions) {
                this._scanFunctions(mid, fnUnit.param, fnUnit.fid);
            }
        }
    };

    EventDetector.prototype.createUnitEvent = function (pid, mid, unit, sequence) {
        var events = [], evt;

        evt = this._createUnitStartEvent(pid, mid, unit, sequence);
        if (evt) events.push(evt);

        evt = this._createUnitEndEvent(pid, mid, unit, sequence);
        if (evt) events.push(evt);

        return events;
    };

    EventDetector.prototype._createUnitStartEvent = function (pid, mid, unit, sequence) {
        if (!this.cache[pid]) return;
        // if (unit.fid.indexOf('read_alluxio_pagination') > -1) return;
        // if (unit.fid.indexOf('write_alluxio_pagination') > -1) return;
        if (unit.fid.indexOf('internal_function') > -1) return;

        var fid = unit.fid;
        var cacheId;
        // Subflow 의 sub function 일 경우 Subflow 가 시작된 것이다.
        var subflow = this.subflowMap[mid + '_' + unit.fid];
        if (subflow) {
            fid = subflow.fid;
            cacheId = fid;
        } else {
            cacheId = fid + '@' + sequence;
        }

        // WAIT 가 아니고 해당 PID & FID 에 해당하는 Cache 가 없는 경우만 UNIT 이 Start 된 경우
        if (unit.status !== 'WAIT' && !this.cache[pid][cacheId]) {
            var evt = {
                eventType: 'BEGIN-UNIT',
                launchOptions: this.launchOptions,
                pid: pid,
                mid: mid,
                fid: fid,
                status: 'PROCESSING',
                label: this.labelMap[mid + '_' + fid],
                begin: unit.begin,
                message: unit.message,
                sequence: sequence
            };
            if (unit.fid.indexOf('read_alluxio_pagination') > -1) {
                evt.label = '(read)';
            } else if (unit.fid.indexOf('write_alluxio_pagination') > -1) {
                evt.label = '(write)';
            }
            this.cache[pid][cacheId] = {
                event: evt
            };
            return evt;
        } else if (this.cache[pid][cacheId]
            && (this.cache[pid][cacheId].event.begin != unit.begin || this.cache[pid][cacheId].event.status == 'SUCCESS')) {
            var evt = {
                eventType: 'BEGIN-UNIT',
                launchOptions: this.launchOptions,
                pid: pid,
                mid: mid,
                fid: fid,
                status: 'PROCESSING',
                label: this.labelMap[mid + '_' + fid],
                begin: unit.begin,
                message: unit.message,
                sequence: sequence
            };
            if (unit.fid.indexOf('read_alluxio_pagination') > -1) {
                evt.label = '(read)';
            } else if (unit.fid.indexOf('write_alluxio_pagination') > -1) {
                evt.label = '(write)';
            }
            this.cache[pid][cacheId] = {
                event: evt
            };
            return evt;
        } else if (this.cache[pid][cacheId]
            && (this.cache[pid][cacheId].event.begin != unit.begin || this.cache[pid][cacheId].event.status == 'PROCESSING')) {
            var evt = {
                eventType: 'UPDATE-UNIT',
                launchOptions: this.launchOptions,
                pid: pid,
                mid: mid,
                fid: fid,
                status: 'PROCESSING',
                label: this.labelMap[mid + '_' + fid],
                begin: unit.begin,
                message: unit.message,
                sequence: sequence
            };
            if (unit.fid.indexOf('read_alluxio_pagination') > -1) {
                evt.label = '(read)';
            } else if (unit.fid.indexOf('write_alluxio_pagination') > -1) {
                evt.label = '(write)';
            }
            this.cache[pid][cacheId] = {
                event: evt
            };
            return evt;
        } else if (this.cache[pid][cacheId]
            && (this.cache[pid][cacheId].event.begin != unit.begin || this.cache[pid][cacheId].event.status == 'SUCCESS')) {
            var evt = {
                eventType: 'BEGIN-UNIT',
                launchOptions: this.launchOptions,
                pid: pid,
                mid: mid,
                fid: fid,
                status: 'PROCESSING',
                label: this.labelMap[mid + '_' + fid],
                begin: unit.begin,
                sequence: sequence
            };
            if (unit.fid.indexOf('read_alluxio_pagination') > -1) {
                evt.label = '(read)';
            } else if (unit.fid.indexOf('write_alluxio_pagination') > -1) {
                evt.label = '(write)';
            }
            this.cache[pid][cacheId] = {
                event: evt
            };
            return evt;
        } else if (this.cache[pid][cacheId]
            && (this.cache[pid][cacheId].event.begin != unit.begin || this.cache[pid][cacheId].event.status == 'SUCCESS')) {
            var evt = {
                eventType: 'BEGIN-UNIT',
                launchOptions: this.launchOptions,
                pid: pid,
                mid: mid,
                fid: fid,
                status: 'PROCESSING',
                label: this.labelMap[mid + '_' + fid],
                begin: unit.begin,
                sequence: sequence
            };
            if (unit.fid.indexOf('read_alluxio_pagination') > -1) {
                evt.label = '(read)';
            } else if (unit.fid.indexOf('write_alluxio_pagination') > -1) {
                evt.label = '(write)';
            }
            this.cache[pid][cacheId] = {
                event: evt
            };
            return evt;
        }
    };

    EventDetector.prototype._createUnitEndEvent = function (pid, mid, unit, sequence) {
        var fid = unit.fid;
        var cacheId;
        // Subflow 의 sub function 일 경우 마지막 sub function 이 끝난 경우에만 Subflow 가 끝난 것이다.
        var subflow = this.subflowMap[mid + '_' + unit.fid];
        if (subflow) {
            fid = subflow.fid;
            cacheId = fid;
        } else {
            cacheId = fid + '@' + sequence;
        }

        if (this.cache[pid] &&
            this.cache[pid][cacheId] &&
            this.cache[pid][cacheId].event.status == 'PROCESSING' &&
            this.cache[pid][cacheId].event.status != unit.status) {

            this.cache[pid][cacheId].event.status = unit.status;
            return {
                eventType: 'END-UNIT',
                launchOptions: this.launchOptions,
                pid: pid,
                mid: mid,
                fid: fid,
                status: unit.status,
                label: this.labelMap[mid + '_' + fid],
                begin: unit.begin,
                end: unit.end,
                message: unit.message,
                sequence: sequence
            };

        }
    };

    EventDetector.prototype.createProcessEvent = function (pid, mid, begin, end, status, index) {
        var events = [], evt;

        evt = this._createProcessStartEvent(pid, mid, begin, index, status);
        if (evt) events.push(evt);

        evt = this._createProcessEndEvent(pid, mid, begin, end, status);
        if (evt) events.push(evt);

        return events;
    };

    EventDetector.prototype._createProcessStartEvent = function (pid, mid, begin, index, status) {
        if (mid.indexOf('internal_process') > -1) return;
        if (!this.cache[pid] || this.cache[pid].begin !== begin || index != '0') {
            var evt = {
                eventType: 'BEGIN-PROCESS',
                launchOptions: this.launchOptions,
                pid: pid,
                mid: mid,
                label: this.labelMap[mid],
                status: status,
                begin: begin,
                count: 1
            };
            this.cache[pid] = {
                mid: evt.mid,
                status: evt.status,
                begin: evt.begin
            };
            return evt;
        }
    };

    EventDetector.prototype._createProcessEndEvent = function (pid, mid, begin, end, status) {
        if (this.cache[pid] && this.cache[pid].begin === begin && this.cache[pid].status !== status) {
            return {
                eventType: 'END-PROCESS',
                launchOptions: this.launchOptions,
                pid: pid,
                mid: mid,
                label: this.labelMap[mid],
                status: status,
                begin: begin,
                end: end
            };
        }
    };

    Brightics.VA.Core.EventDetector = EventDetector;

}).call(this);
(function () {
    'use strict';

    var root = this;
    root.Brightics.VA.Core.Functions.Library = {
        getListByTags: function (tags) {
            var list = [];
            for (var key in this) {
                var findFlag = false;
                var fnUnitTags = this[key].tags;
                if (fnUnitTags) {
                    var temp = $.grep(fnUnitTags, function (tag) {
                        var matched = false;
                        for (var i in tags) {
                            if (tag.toLowerCase().indexOf(tags[i].toLowerCase()) > -1) matched = true;
                        }
                        return matched;
                    });
                    if (temp.length > 0) {
                        findFlag = true;
                        list.push(key);
                    }
                }

                // Tag로 못 찾은 경우, Label로 한번 더 검색 (UDF의 경우 ver로 검색이 안되기 때문에 로직 추가)
                if (!findFlag && this[key] && this[key].defaultFnUnit && this[key].defaultFnUnit.display && this[key].defaultFnUnit.display.label) {
                    var displayLabel = this[key].defaultFnUnit.display.label;
                    for (var i in tags) {
                        if (displayLabel.toLowerCase().indexOf(tags[i].toLowerCase()) > -1) {
                            list.push(key);
                            break;
                        }
                    }
                }
            }
            return list;
        },
        getFunction: function (func) {
            return $.extend(true, {}, this[func]);
        },
        extendFunctions: function (funcList) {
            var functions = {};
            var func = {};
            for (var i = 0; i < funcList.length; i++) {
                func[funcList[i]] = this[funcList[i]];
                $.extend(true, functions, func);
            }
            return functions;
        },
        addFunction: function (key, func) {
            this[key] = func;
        },
        getFunctionViewer: function (func, inOutType) {
            var viewerLists = [];

            if (Brightics.VA.Core.Functions.Viewer[func]) {
                viewerLists = Brightics.VA.Core.Functions.Viewer[func][inOutType];
            } else {
                viewerLists.push('data');
            }

            return viewerLists;
        }
    };
}).call(this);

(function () {
    'use strict';

    var root = this;
    root.Brightics.VA.Core.Functions.Viewer = {
        kmeans2: {
            'in': ['data'],
            'out': ['data', 'model', 'image']
        },
        sort: {
            'in': ['data', 'model'],
            'out': ['data', 'model', 'image', 'html']
        },
        load: {
            'out': ['data']
        },
        load2: {
            'out': ['model']
        }
    };
}).call(this);

(function () {
	'use strict';

	var root = this;
	root.Brightics.OptFunctions = {
		ALSRecommend: {
			"optSelected": "true",
			"optParam": {
				"topn-number": {
					"min": 1,
					"max": 5,
					"value": 3,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				}
			}
		},
		AutoFeatureSelection: {
			"optSelected": "true",
			"optParam": {
				"max-num-features": {
					"min": 1,
					"max": 5,
					"value": 3,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				}
			}
		},
		AutoRandomForestTrainForClassification: {
			"optSelected": "true",
			"optParam": {
				"max-bins": {
					"set": [2, 4, 8, 32, 128],
					"value": 32,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"max-depth": {
					"set": [1, 5, 10, 30],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"min-info-gain": {
					"min": 0,
					"max": 1,
					"value": 0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"min-instances-per-node": {
					"set": [1, 3, 5, 7, 10],
					"value": 1,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-folds": {
					"set": [3, 5, 9],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-trees": {
					"set": [20, 50, 100],
					"value": 50,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"sub-sampling-rate": {
					"min": 0.01,
					"max": 1,
					"value": 1,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"train-ratio": {
					"min": 0,
					"max": 1,
					"value": 0.75,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		AutoRandomForestTrainForRegression: {
			"optSelected": "true",
			"optParam": {
				"max-bins": {
					"set": [2, 4, 8, 32, 128],
					"value": 32,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"max-depth": {
					"set": [1, 5, 10, 30],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"min-info-gain": {
					"min": 0,
					"max": 1,
					"value": 0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"min-instances-per-node": {
					"set": [1, 3, 5, 7, 10],
					"value": 1,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-folds": {
					"set": [3, 5, 9],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-trees": {
					"set": [20, 50, 100],
					"value": 50,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"sub-sampling-rate": {
					"min": 0.01,
					"max": 1,
					"value": 1,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"train-ratio": {
					"min": 0,
					"max": 1,
					"value": 0.75,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		ArimaTrain: {
			"optSelected": "true",
			"optParam": {
				"p": {
					"min": 0,
					"max": 5,
					"value": 1,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				},
				"d": {
					"min": 0,
					"max": 2,
					"value": 0,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				},
				"q": {
					"min": 0,
					"max": 5,
					"value": 1,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				}
			}
		},
		ARX: {
			"optSelected": "true",
			"optParam": {
				"xMaxLag": {
					"min": 0,
					"max": 5,
					"value": 1,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				},
				"yMaxLag": {
					"min": 0,
					"max": 5,
					"value": 1,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				}
			}
		},
		Binarizer: {
			"optSelected": "true",
			"optParam": {
				"Threshold": {
					"min": -10,
					"max": 10,
					"value": 0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		ChiSqSelection: {
			"optSelected": "true",
			"optParam": {
				"numFolds": {
					"set": [3, 5, 9],
					"value": 9,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"trainRatio": {
					"min": 0,
					"max": 1,
					"value": 0.75,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		DecisionTreeTrain: {
			"optSelected": "true",
			"optParam": {
				"max-bins": {
					"set": [2, 4, 8, 32, 128],
					"value": 32,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"max-depth": {
					"set": [1, 5, 10, 30],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				}
			}
		},
		Ewma: {
			"optSelected": "true",
			"optParam": {
				"number": {
					"set": [2, 4, 6, 8, 10],
					"value": 4,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"ratio": {
					"min": 0.1,
					"max": 0.9,
					"value": 0.5,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		HoltWintersTrain: {
			"optSelected": "true",
			"optParam": {
				"period": {
					"set": [4, 5, 7, 30, 52, 168],
					"value": 4,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"model-type": {
					"set": ["additive", "multiplicative"],
					"type": "DISCRETE_SET_STRING",
					"optParamSelected": "true"
				}
			}
		},
		GaussianMixtureTrain: {
			"optSelected": "true",
			"optParam": {
				"num-clusters": {
					"min": 1,
					"max": 5,
					"value": 3,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				}
			}
		},
		IndependentFilter: {
			"optSelected": "true",
			"optParam": {
				"threshold": {
					"min": 0,
					"max": 10,
					"value": 0.000001,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		KMeans: {
			"optSelected": "true",
			"optParam": {
				"clusters": {
					"set": [2, 3, 4, 5, 8, 10],
					"value": 3,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				}
			}
		},
		LinearRegressionTrain: {
			"optSelected": "true",
			"optParam": {
				"regularization": {
					"min": 0,
					"max": 1,
					"value": 0.01,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"types": {
					"min": 0,
					"max": 1,
					"value": 0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		LogisticRegressionTrain: {
			"optSelected": "true",
			"optParam": {
				"regularization": {
					"min": 0,
					"max": 1,
					"value": 0.01,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"types": {
					"min": 0,
					"max": 1,
					"value": 0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		MahalanobisDistanceOutlierDetection: {
			"optSelected": "true",
			"optParam": {
				"sampling-rate": {
					"min": 0,
					"max": 1,
					"value": 1,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		MovingAverage: {
			"optSelected": "true",
			"optParam": {
				"number": {
					"set": [3, 5, 7, 11, 20],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				}
			}
		},
		NaiveBayesTrain: {
			"optSelected": "true",
			"optParam": {
				"lambda": {
					"min": 0,
					"max": 10,
					"value": 1,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		NGram: {
			"optSelected": "true",
			"optParam": {
				"number": {
					"min": 1,
					"max": 8,
					"value": 3,
					"type": "DISCRETE_RANGE",
					"optParamSelected": "true"
				}
			}
		},
		OneVsRestLRClassifierTrain: {
			"optSelected": "true",
			"optParam": {
				"reg-param": {
					"min": 0,
					"max": 1,
					"value": 0.01,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		OutlierRemoval: {
			"optSelected": "true",
			"optParam": {
				"method": {
					"set": ['carling', 'tuckey'],
					"type": "DISCRETE_SET_STRING",
					"optParamSelected": "true"
				},
				"multiplier": {
					"min": 0.1,
					"max": 3.0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		PolynomialRegressionTrain: {
			"optSelected": "true",
			"optParam": {
				"regularization": {
					"min": 0,
					"max": 1,
					"value": 0.01,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"types": {
					"min": 0,
					"max": 1,
					"value": 0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		PowerIterationClustering: {
			"optSelected": "true",
			"optParam": {
				"n-clusters": {
					"set": [2, 3, 4, 5, 8, 10],
					"value": 3,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				}
			}
		},
		RandomForestClassificationTrain: {
			"optSelected": "true",
			"optParam": {
				"max-bins": {
					"set": [2, 4, 8, 32, 128],
					"value": 32,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"max-depth": {
					"set": [1, 5, 10, 30],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"min-info-gain": {
					"min": 0,
					"max": 1,
					"value": 0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"min-instances-per-node": {
					"set": [1, 3, 5, 7, 10],
					"value": 1,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-folds": {
					"set": [3, 5, 9],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-trees": {
					"set": [20, 50, 100],
					"value": 50,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"sub-sampling-rate": {
					"min": 0.01,
					"max": 1,
					"value": 1,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"train-ratio": {
					"min": 0,
					"max": 1,
					"value": 0.75,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		RandomForestRegressionTrain: {
			"optSelected": "true",
			"optParam": {
				"max-bins": {
					"set": [2, 4, 8, 32, 128],
					"value": 32,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"max-depth": {
					"set": [1, 5, 10, 30],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"min-info-gain": {
					"min": 0,
					"max": 1,
					"value": 0,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"min-instances-per-node": {
					"set": [1, 5, 10],
					"value": 1,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-folds": {
					"set": [3, 5, 9],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-trees": {
					"set": [20, 50, 100],
					"value": 50,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"sub-sampling-rate": {
					"min": 0.01,
					"max": 1,
					"value": 1,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				},
				"train-ratio": {
					"min": 0,
					"max": 1,
					"value": 0.75,
					"type": "CONTINUOUS",
					"optParamSelected": "true"
				}
			}
		},
		RandomForestTrain: {
			"optSelected": "true",
			"optParam": {
				"num-classes": {
					"set": [2, 4, 16],
					"value": 2,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"num-trees": {
					"set": [3, 15, 30],
					"value": 3,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"max-depth": {
					"set": [5, 10, 20],
					"value": 5,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"max-bins": {
					"set": [2, 4, 8, 32, 128],
					"value": 32,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				}
			}
		},
		TimeSeriesDecomposition: {
			"optSelected": "true",
			"optParam": {
				"period": {
					"set": [4, 5, 7, 30, 52, 168],
					"value": 4,
					"type": "DISCRETE_SET_INTEGER",
					"optParamSelected": "true"
				},
				"model-type": {
					"set": ["additive", "multiplicative"],
					"type": "DISCRETE_SET_STRING",
					"optParamSelected": "true"
				}
			}
		},
		'brightics.function.regression$xgb_regression_train': {
            "optSelected": "true",
            "optParam": {
                "max_depth": {
                    "set": [3,5,10],
                    "value": 3,
                    "type": "DISCRETE_SET_INTEGER",
                    "optParamSelected": "true"
                },
                "n_estimators": {
					"set": [50,100,200],
					"value": 100,
                    "type": "DISCRETE_SET_INTEGER",
                    "optParamSelected": "true"
                }
            }
		},
		'brightics.function.classification$xgb_classification_train': {
            "optSelected": "true",
            "optParam": {
                "max_depth": {
                    "set": [3,5,10],
                    "value": 3,
                    "type": "DISCRETE_SET_INTEGER",
                    "optParamSelected": "true"
                },
                "n_estimators": {
					"set": [50,100,200],
					"value": 100,
                    "type": "DISCRETE_SET_INTEGER",
                    "optParamSelected": "true"
                }
            }
        }

	};
}).call(this);

/**
 * Created by daewon.park on 2016-02-21.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    Brightics.VA.Core.DataQueryTemplate = {
        schemaCache: {},
        cache: {},
        requested: {},
        addCache: function (mid, table, data) {
            var id = mid + '_' + table;
            // TODO 메모리 사용을 줄이기 위해 cache 기능을 off 해보자 by daewon.park since 2017-05-23
            // this.cache[id] = data;
            this.schemaCache[id] = data;
        },
        removeCache: function (mid, table) {
            // TODO 메모리 사용을 줄이기 위해 cache 기능을 off 하고 schemaCache 별도 관리 by daewon.park since 2017-05-23
            if (table) {
                var id = mid + '_' + table;
                delete this.cache[id];
                delete this.schemaCache[id];
            } else {
                var deleted = [];
                for (var key in this.cache) {
                    if (key.indexOf(mid + '_') == 0) {
                        deleted.push(key);
                    }
                }
                for (var d in deleted) {
                    delete this.cache[deleted[d]];
                }

                deleted = [];
                for (var key in this.schemaCache) {
                    if (key.indexOf(mid + '_') == 0) {
                        deleted.push(key);
                    }
                }
                for (var d in deleted) {
                    delete this.schemaCache[deleted[d]];
                }
            }
        },
        isCached: function (mid, table) {
            var id = mid + '_' + table;
            return this.cache[id];
        },
        clearCache: function () {
            this.cache = {};
            this.schemaCache = {};
        },
        queryTable: function (mid, table, doneCallback, failCallback, force, options) {
            var id = mid + '_' + table, options = options || {};
            if (force === true || !this.cache[id]) {
                if (options.publish) {
                    options.destination = 'publish';
                    this.queryData(mid, table, options.offset || 0, options.limit || 1000, doneCallback, failCallback, options);
                } else {
                    this.queryData(mid, table, options.offset || 0, options.limit || 1000, doneCallback, failCallback, options);
                }
            } else {
                doneCallback(this.cache[id], table);
            }
        },
        queryTableForReport: function (mid, table, doneCallback, failCallback, force) {
            var id = mid + '_' + table;
            if (force === true || !this.cache[id]) {
                this.queryData(mid, table, 0, 1000, doneCallback, failCallback, '/report');
            } else {
                doneCallback(this.cache[id], table);
            }
        },
        fetchMore: function (mid, table, more, doneCallback, failCallback) {
            var length = 1000, id = mid + '_' + table;
            if (this.cache[id] && this.cache[id].columns && this.cache[id].data) {
                length = this.cache[id].data.length + more;
            } else {
                length = more;
            }
            this.queryData(mid, table, 0, length, doneCallback, failCallback);
        },
        queryData: function (mid, table, offset, length, doneCallback, failCallback, _options) {
            var _this = this, id = mid + '_' + table;
            var options = _options || {};

            if (!this.requested[id]) this.requested[id] = [];
            this.requested[id].push({
                done: doneCallback,
                fail: failCallback
            });
            
            // if (!this.requested[id]) {
            //     this.requested[id] = [];
            //     this.requested[id].push({
            //         done: doneCallback,
            //         fail: failCallback
            //     });
            // }
            // else {
            //     this.requested[id].push({
            //         done: doneCallback,
            //         fail: failCallback
            //     });
            //     return;
            // }

            var userId = options.user || Brightics.VA.Env.Session.userId;
            var errorHandler = function (err) {
                _this.removeCache(mid, table);

                var data = {
                    columns: [],
                    data: [],
                    count: 0
                };
                _this.requested[id].shift().fail(data, table, err);
                // for (var i in _this.requested[id]) {
                //     _this.requested[id][i].fail(data, table, err); //TODO _this.requested[id][i].fail(data, table)로 수정 및 에러 확인 필요
                // }
                // delete _this.requested[id];
            };

            var doneHandler = function (data) {
                _this.addCache(mid, table, data);
                _this.requested[id].shift().done(data, table);
                // for (var i in _this.requested[id]) {
                //     _this.requested[id][i].done(data, table);
                // }
                // delete _this.requested[id];
            };

            var urlDestination = options.destination || 'api/va/v2/data';
            var url = urlDestination + '/staging/query?user=' + userId + '&mid=' + mid + '&tab=' + table + '&offset=' + offset + '&limit=' + length;
            $.get(url).done(doneHandler).fail(errorHandler);
        },
        getSchemaAsync: function (mid, table, doneCallback, failCallback, _options) {
            var _this = this;
            var options = _options || {};
            var userId = options.user || Brightics.VA.Env.Session.userId;
            var queryString = Brightics.VA.Core.Utils.CommonUtils.getQueryString({
                user: userId,
                mid: mid,
                tab: table,
                offset: 0,
                limit: 1
            });
            var url = 'api/va/v2/data/staging/query?' + queryString;
            var done = function (data) {
                _this.addCache(mid, table, data);
                return doneCallback(data.columns);
            };

            var fail = function (err) {
                _this.removeCache(mid, table);
                return failCallback([], table, err);
            };
            $.get(url).done(done).fail(fail);
        },
        getSchema: function (mid, table) {
            var id = mid + '_' + table;
            return this.schemaCache[id] && table !== undefined ? this.schemaCache[id].columns : undefined;
        },
        querySchema: function (mid, table, doneCallback, failCallback, force) {
            this.queryTable(mid, table, doneCallback, failCallback, force);
        },
        getSchemaFromData: function (mid, table) {
            console.warn('This method is deprecated');
            return this.getData(mid, table)
        },
        getData: function (mid, table) {
            var id = mid + '_' + table;
            return this.schemaCache[id] && table !== undefined ? this.schemaCache[id].data : undefined;
        },
        getTable: function (mid, table) {
            var id = mid + '_' + table;
            return this.schemaCache[id] && table !== undefined ? this.schemaCache[id] : undefined;
        }
    };

}).call(this);
/**
 * Created by daewon.park on 2016-10-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    Brightics.VA.RepositoryQueryTemplate = {
        pathCache: {},
        schemaCache: {},
        getFiles: function (path) {
            return this.pathCache[path];
        },
        getColumns: function (path) {
            return this.schemaCache[path];
        },
        browse: function (path, rescan, additionalOpt) {
            var _this = this;
            var scan = rescan || false;
            var opt = {
                url: 'api/va/v2/data/browse',
                type: 'GET',
                blocking: false,
                contentType: 'application/json; charset=utf-8'
            };
            $.extend(true, opt, additionalOpt);
            return $.ajax(opt).done(function (files) {
                _this.pathCache[path] = files.sort(function (a, b) {
                    return a.path.localeCompare(b.path);
                });
            });
        },
        schema: function (path, rescan, additionalOpt) {
            var _this = this;
            var scan = rescan || true;
            var opt = {
                url: 'api/va/v2/data/schema?key=' + path + '&rescan=' + scan,
                type: 'GET',
                blocking: false,
                contentType: 'application/json; charset=utf-8'
            };
            $.extend(true, opt, additionalOpt);
            return $.ajax(opt).done(function (schema) {
                _this.schemaCache[path] = schema.columns;
            });
        },
        move: function (source, destination, additionalOpt) {
            var opt = {
                url: 'api/va/v2/data/move',
                type: 'POST',
                blocking: false,
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({
                    source: source,
                    destination : destination
                })
            };
            $.extend(true, opt, additionalOpt);
            return $.ajax(opt);
        },
        copy: function (source, destination, additionalOpt) {
            var opt = {
                url: 'api/va/v2/data/copy',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: true,
                data: JSON.stringify({
                    source: source,
                    destination : destination
                })
            };
            $.extend(true, opt, additionalOpt);
            return $.ajax(opt);
        },
        delete: function (path, additionalOpt) {
            var opt = {
                url: 'api/va/v2/data/delete',
                type: 'POST',
                blocking: false,
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({
                    path: path
                })
            };
            $.extend(true, opt, additionalOpt);
            return $.ajax(opt);
        }
    };

}).call(this);
/**
 * Created by daewon.park on 2016-02-21.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    Brightics.VA.Core.GarbageCollector = {
        list: {},
        clearAlluxio: function () {
            for (var i in this.list) {
                var opt = {
                    url: this.list[i],
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    blocking: false,
                    data: JSON.stringify({user: Brightics.VA.Env.Session.userId})
                };
                $.ajax(opt).done(function (data) {
                }).fail(function (err) {
                });
            }
            this.clearList();
        },
        addList: function (mid, fid) {
            var id = mid + '_' + fid;
            var path = this.getPath(mid, fid);
            this.list[id] = path;
        },
        removeList: function (mid, fid) {
            var id = mid + '_' + fid;
            delete this.list[id];
        },
        clearList: function () {
            this.list = {};
        },
        getPath: function (mid, fid) {
            return 'api/v1/repo/alluxio/functions/' + mid + '/' + fid + '/destroy';
        },
        immediatelyClearData: function (models, tables) {
            var options = {
                user: Brightics.VA.Env.Session.userId
            };
            if (models && models.length > 0) {
                options.mids = {};
                for (var i in models) {
                    if (tables && tables.length > 0) {
                        options.mids[models[i]] = tables;
                    } else {
                        options.mids[models[i]] = [];
                    }
                }
            }
            var opt = {
                url: 'api/va/v2/datasources/staging/remove',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: false,
                data: JSON.stringify(options)
            };
            $.ajax(opt).done(function (data) {
            }).fail(function (err) {
            });
        }
    };

}).call(this);
/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function LayoutManager() {
    }

    Brightics.VA.ClassUtils.inherits(LayoutManager, Brightics.VA.EventEmitter);

    LayoutManager.prototype.registerEditorTab = function (editorTab) {
        this.editorTab = editorTab;
    };

    LayoutManager.prototype.registerProjectViewer = function (projectViewer) {
        this.projectViewer = projectViewer;
    };

    LayoutManager.prototype.initLayout = function () {
        this.editorTab.hideNewEditorButton();
        this.editorTab.unselectAll();
        this.projectViewer.show();
    };

    LayoutManager.prototype.openEditor = function (editorInput) {
        this.projectViewer.hide();
        this.editorTab.showNewEditorButton();
        
        if (this.editorTab.openTab(editorInput)) {
            Studio.getEditorContainer().openEditor(editorInput);
            Studio.getClipboardManager().setEditorType(editorInput.getType());
        } 
        
    };

    LayoutManager.prototype.closeEditor = function (editorInput) {
        var nextEditorInput = this.editorTab.closeTab(editorInput);

        Studio.getEditorContainer().closeEditor(editorInput);

        if (nextEditorInput) {
            Studio.getEditorContainer().openEditor(nextEditorInput);
        }
    };

    LayoutManager.prototype.showProjectViewer = function () {
        this.editorTab.hideNewEditorButton();
        this.editorTab.unselectAll();

        this.projectViewer.fillProjectList();
        this.projectViewer.show();
    };

    LayoutManager.prototype.refreshProjectViewer = function () {
        this.projectViewer.fillProjectList();
    };

    LayoutManager.prototype.showProjectViewerPopup = function () {
        this.projectViewer.showPopup();
    };

    LayoutManager.prototype.hideProjectViewer = function () {
        this.projectViewer.hide();
    };

    LayoutManager.prototype.handleProjectDelete = function (event) {
        var editors = Studio.getEditorContainer().findEditorsByProjectId(event.getProjectId());
        for (var i in editors) {
            this.closeEditor(editors[i].options.editorInput);
        }
    };

    LayoutManager.prototype.handleProjectChange = function (event) {
        var editors = Studio.getEditorContainer().findEditorsByProjectId(event.getProjectId());
        for (var i in editors) {
            // TODO: editor에 wrapper function 만들지 
            // 직접 editor의 modellayoutmanager의 refreshModelInfo 사용할지 고민 필요
            editors[i].getModelLayoutManager().refreshModelInfo();
        }
    };

    LayoutManager.prototype.handleFileDelete = function (event) {
        var editor = Studio.getEditorContainer().findEditorById(event.getProjectId(), event.getFileId());
        if (editor) {
            this.closeEditor(editor.options.editorInput);
        }
    };

    LayoutManager.prototype.handleFileChange = function (event) {
        var editor = Studio.getEditorContainer().findEditorById(event.getProjectId(), event.getFileId());
        if (editor) {
            editor.options.editorInput = event;
            this.editorTab.updateTab(editor.options.editorInput);

            // TODO: editor에 wrapper function 만들지 
            // 직접 editor의 modellayoutmanager의 refreshModelInfo 사용할지 고민 필요
            editor.getModelLayoutManager().refreshModelInfo();
        }
    };

    // for commonjs
    if (typeof module !== 'undefined') {
        module.exports = LayoutManager;
    }

    // for browser
    if (typeof window !== 'undefined') {
        Brightics.VA.LayoutManager = LayoutManager;
    }

}).call(this);

/**
 * Created by samsungSDS on 2018-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AddonFunctionManager() {
        this._functionInterfaceMap = {};
        for (var modelType in Brightics.VA.Core.Interface.Functions) {
            this._functionInterfaceMap[modelType] = Brightics.VA.Core.Interface.Functions[modelType];
        }
    }

    AddonFunctionManager.prototype.init = function (cb) {
        var _this = this;
        var udfOpt = {
            url: 'api/va/v3/ws/udfs',
            type: 'GET',
            blocking: false
        };
        var late = false;
        $.ajax(udfOpt).done(function (functions) {
            var udf, modelType;

            var udfList = functions;
            for (var i in udfList) {
                udf = udfList[i];
                modelType = udf.modelType || 'data';
                _this._addFunction(udf);
            }
            if (late && cb) cb();
            late = true;
        });

        var addonfunctionOpt = {
            url: 'api/va/v3/ws/functions',
            type: 'GET',
            blocking: false
        };
        $.ajax(addonfunctionOpt).done(function (functions) {
            var addonFunction;
            var functionList = functions;

            for (var i in functionList) {
                addonFunction = {};
                addonFunction.id = functionList[i].func;
                addonFunction.modelType = 'data';
                addonFunction.contents = functionList[i];
                _this._addFunction(addonFunction);
            }
            if (late && cb) cb();
            late = true;
        });
    };
    AddonFunctionManager.prototype._addFunction = function (addonFunction) {
        var modelType = addonFunction.modelType || 'data';
        if (this._functionInterfaceMap[modelType] && Brightics.VA.Core.Interface.AddonFunctionUtil[modelType]) {
            Brightics.VA.Core.Interface.AddonFunctionUtil[modelType].addFunction(addonFunction);
        }
    };

    Brightics.VA.Core.AddonFunctionManager = AddonFunctionManager;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');

    var defaultDialogOption = {
        destroyOnClose: false,
        position: {my: 'center', at: 'center', of: window},
        appendTo: 'body',
        modal: true,
        resizable: false,
        draggable: true,
        width: 600,
        height: 500,
        maxWidth: 600,
        maxHeight: 500
    };

    function Dialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.destroyOnClose = this.options.destroyOnClose === false ? false : true;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.FnUnitUtils = FnUnitUtils;

        this.retrieveParent();
        this._initOptions();
        this.createControls();
        this.setAttrName();
        this.initContents();
        this.bindEventHandler();
    }

    Dialog.prototype._initOptions = function () {
        this.dialogOptions = $.extend(true, {}, defaultDialogOption, this.options);
    };

    Dialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    Dialog.prototype.getTitle = function () {
        return this.dialogOptions.title;
    };

    Dialog.prototype.getPosition = function () {
        return this.dialogOptions.position;
    };

    Dialog.prototype.setAttrName = function () {
        this.$mainControl.attr('name', this.getTitle());
    };

    Dialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main">' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '       </div>' +
            '   </div>' +
            '</div>');
    };

    Dialog.prototype.initContents = function () {
        this.$mainControl.dialog(this.dialogOptions);

        this.createDialogButtonBar(this.$mainControl.find('.brtc-va-dialogs-buttonbar'));
        this.createDialogContentsArea(this.$mainControl.find('.brtc-va-dialogs-contents'));
        
        if (!this.dialogOptions.title) this.$parent.find('.ui-dialog-titlebar.ui-widget-header').attr('style', 'border-bottom: none !important;');
    };


    Dialog.prototype.bindEventHandler = function () {
        var _this = this;
        this.$mainControl.on('dialogclose', function (e) {
            e.stopPropagation();

            if (typeof _this.options.close == 'function') {
                _this.options.close(_this.dialogResult);
            }
            if (_this.destroyOnClose !== false) {
                _this.destroy();
            }
        });
    };

    Dialog.prototype._setStopPropagationHandler = function () {
        this.$mainControl.closest('.ui-dialog').on('click', function (e) {
            e.stopPropagation();
        });

        this.$mainControl.closest('.ui-dialog').on('mousedown', function (e) {
            e.stopPropagation();
        });

        if (this.dialogOptions.modal) {
            $('.ui-widget-overlay').on('click', function (e) {
                e.stopPropagation();
            });
        }
    };

    Dialog.prototype.setFocus = function () {
        this.$mainControl.focus();
    };

    Dialog.prototype.close = function () {
        if (this.$mainControl && this.$mainControl.dialog('isOpen')) {
            this.$mainControl.dialog('close');
        }
    };

    Dialog.prototype.open = function () {
        if (this.$mainControl) {
            this.$mainControl.dialog('open');
        }
    };

    Dialog.prototype.createDialogButtonBar = function ($parent) {
        this.$okButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />');
        $parent.append(this.$okButton);
        this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$okButton.click(this.handleOkClicked.bind(this));

        this.$cancelButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />');
        $parent.append(this.$cancelButton);
        this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$cancelButton.click(this.handleCancelClicked.bind(this));
    };

    Dialog.prototype.destroy = function () {
        this.$mainControl.dialog('destroy');
        this.$mainControl = undefined;
    };

    Dialog.prototype.createDialogContentsArea = function ($parent) {
    };

    Dialog.prototype.handleOkClicked = function () {
        if (typeof this.$mainControl === 'undefined') return;
        this.dialogResult.OK = true;
        this.dialogResult.Cancel = false;

        this.$mainControl.dialog('close');
    };

    Dialog.prototype.handleCancelClicked = function () {
        this.dialogResult.OK = false;
        this.dialogResult.Cancel = true;

        this.$mainControl.dialog('close');
    };

    Dialog.prototype.createEmptyControl = function (message) {
        this.$mainControl.empty();

        this.$mainControl
            .css({
                'text-align': 'center',
                'line-height': (this.dialogOptions.height - this.getHeaderHeight()) + 'px'
            })
            .text(message);
    };

    Dialog.prototype.getHeader = function () {
        return this.$parent.find('.ui-dialog-titlebar.ui-widget-header');
    };

    Dialog.prototype.getHeaderHeight = function () {
        return 60;
    };

    Dialog.prototype._configureDialogOption = function (additionalOption) {
        return $.extend(true, this.dialogOptions, additionalOption);
    };

    Dialog.prototype.setStyle = function (style) {
        this.$mainControl.css(style);
    };

    Dialog.prototype.modifyCloseButton = function ($button ,callback) {
        var $header = this.getHeader();
        $header.find('button.ui-dialog-titlebar-close').hide();

        $header.append($button);
        $header.click(callback);
    };

    Brightics.VA.Dialogs.Dialog = Dialog;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    var SUMMER_NOTE_TOOLBAR = [
        ['style', ['bold', 'italic', 'underline', 'clear']],
        ['fontsize', ['fontsize']],
        ['color', ['color']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['height', ['height']]
    ];

    /**
     * reportData
     * [
     *   id: {String},
     *   layout: BOX.TYPE_{number},
     *   type: {Chart or Text},
     *   position: {left : px, top : px}
     *   size: {height: px, width: px}
     *   originData: data
     * ]
     */
    function ReportManager(editorInput) {
        this.editorInput = editorInput;
        this.reportData = editorInput.getContents().report.data || [];
        // this.reportTitle = editorInput.contents.report.title || 'Report';
    }

    /**
     * data structure
     * {
     *  options: {
     *      id: {String},
     *      chartOption: {Object}
     *  },
     *  data: {
     *      mid: {String},
     *      fid: {String}
     *  },
     *  title: {
     *      fnUnitLabel: {String},
     *      panelTitle: {String}
     *  }
     * }
     */
    ReportManager.prototype.addReportData = function (data) {
        var _this = this;
        var isCorrectData = function (data) {
            return data.options.id && data.options.chartOption && data.data.mid && data.data.table;
        };
        return new Promise(function (resolve, reject) {
            if (isCorrectData(data)) {
                var dataIndex = _this.reportData.push(_this.formattedData(data));
                _this.editorInput.getContents().report = {
                    // title: _this.reportTitle,
                    data: _this.reportData
                };
                resolve(dataIndex - 1);
            } else {
                reject("Data are not correct");
            }
        });
    };
    ReportManager.prototype.openDialog = function ($report, closeHandler) {
        var _this = this;
        $report.dialog({
            theme: Brightics.VA.Env.Theme,
            width: 950,
            maxWidth: 950,
            minWidth: 950,
            height: 800,
            minHeight: 400,
            maxHeight: 1200,
            modal: true,
            resizable: false,
            open: function () {
                _this.initReportViewer($report);
                _this.render();
            },
            keyboardCloseKey: ''
        });

        this.$reportWindow.on('close', function () {
            closeHandler();
            $report.dialog('destroy');
        });
    };

    ReportManager.prototype.formattedData = function (data) {
        return {
            id: data.options.id + '-' + data.options.chartOption.chart.type,
            type: 'Chart',
            originData: data
        };
    };

    ReportManager.prototype.removeReportData = function (contentPanelId, chartType) {
        var checkId = id(contentPanelId, chartType);
        for (var index in this.reportData) {
            if (this.reportData[index].id === checkId) {
                this.removeReportDataByIndex(index);
                return;
            }
        }
    };

    ReportManager.prototype.initReportViewer = function ($parent) {
        this.$reportWindow = $parent;

        this.initReportWindowToolbar();
        this.initReportWindowBody();
    };

    ReportManager.prototype.initReportWindowToolbar = function () {
        var _this = this;

        this.$reportWindowBody = this.$reportWindow.find('.brtc-va-editors-modeleditor-report-window-body');
        var $toolBar = $('<div class="brtc-va-editors-modeleditor-report-window-head-tools-container"></div>');
        this.$reportWindowBody.prepend($toolBar);

        var $shareAddButton = $('<div class="brtc-va-editors-modeleditor-report-window-head-tools brtc-va-editors-modeleditor-report-window-head-tools-share fa fa-share-alt" title="Publish"></div>');
        var $textAddButton = $('<div class="brtc-va-editors-modeleditor-report-window-head-tools brtc-va-editors-modeleditor-report-window-head-tools-add" title="Click to add text"></div>');
        var $reportDownloadAllButton = $('<div class="brtc-va-editors-modeleditor-report-window-head-tools brtc-va-editors-modeleditor-report-window-head-tools-report-all" title="Download Report Image"></div>');
        var $reportDownloadEachAllButton = $('<div class="brtc-va-editors-modeleditor-report-window-head-tools brtc-va-editors-modeleditor-report-window-head-tools-report-each" title="Download Report Each Element Image"></div>');
        $toolBar.append($reportDownloadAllButton);
        $toolBar.append($reportDownloadEachAllButton);
        $toolBar.append($textAddButton);
        $toolBar.append($shareAddButton);

        $reportDownloadAllButton.on('click', function () {
            _this.downloadAll();
        });
        $reportDownloadEachAllButton.on('click', function () {
            _this.downloadEachAll();
        });
        $shareAddButton.on('click', function () {
            _this.publishReport();
        });

        $textAddButton.on('click', function () {
            _this.addReportTextBox();
        });
    };

    ReportManager.prototype.publishReport = function () {
        var _this = this;
        if (!this.editorInput.getContents().report.id) {
            this.editorInput.getContents().report.id = Brightics.VA.Core.Utils.IDGenerator.report.id(60);
            var opt = {
                url: '/report',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({
                    reportId: this.editorInput.getContents().report.id,
                    userId: Brightics.VA.Env.Session.userId,
                    modelId: this.editorInput.id,
                    projectId: this.editorInput.getProjectId()
                })
            };
            $.ajax(opt).done(function () {
                _this.showPublishInfo();
            });
        } else {
            this.showPublishInfo();
        }
    };

    ReportManager.prototype.showPublishInfo = function () {
        var _this = this;
        var opt = {
            url: '/report/publishsite',
            type: 'GET',
            contentType: 'application/json; charset=utf-8'
        };
        $.ajax(opt).done(function (data) {
            var options = {
                title: 'Publish Information'
            };
            options.window = {
                theme: Brightics.VA.Env.Theme,
                width: '600px',
                height: '150px',
                maxWidth: '600px',
                maxHeight: '150px',
                modal: true,
                resizable: false,
                cancelButton: _this.$cancelButton,
                open: function () {
                    _this.createDialogContentsArea($(this.element).find('.brtc-va-dialogs-contents'), data);
                }
            };
            new Brightics.VA.Core.Dialogs.Dialog(_this.$reportWindowBody, options);
        });
    };

    ReportManager.prototype.createDialogContentsArea = function ($contentsArea, serverInfo) {
        var url = 'http://' + serverInfo.ip + ':' + serverInfo.port + '/report?report=' + this.editorInput.getContents().report.id;
        $contentsArea.append('' +
            '<div style="width:100%">' +
            '   <div style="width:10%;float: left">url: </div>' +
            '   <div style="width:70%;float: left"><input class="brtc-va-widget-contents-input-control" value="' + url + '" readonly></div>' +
            '   <div style="width:20%;float: left;display: flex;justify-content: center;"><button class="brtc-va-copy-clipboard-button" type="button"">Copy</button></div>' +
            '</div>');

        var $copyBtn = $contentsArea.find('.brtc-va-copy-clipboard-button');
        $copyBtn.jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        $copyBtn.on('click', function(){
            window.prompt("Copy to clipboard: Ctrl+C", url);
        });
    };


    ReportManager.prototype.initReportWindowBody = function () {

        this.$reportWindowBody.perfectScrollbar();
        this.$reportContentsArea = $('<div class="brtc-va-editors-modeleditor-report-contents-area"></div>');
        this.$reportContainer = this.$reportWindow.find('.brtc-va-editors-modeleditor-report-element-container');
        this.$reportContainer.append(this.$reportContentsArea);

        this.pageHandler = new PageHandler(this.$reportContentsArea);

        this.$processingWindow = $('<div><div>Processing ...</div><div><div class="brtc-va-progress">' +
            '<div><span class="brtc-va-progress-loading"></div>' +
            // '<i class="fa fa-circle-o-notch fa-spin fa-5x"></i>' +
            '</div></div>');
        this.$reportContainer.append(this.$processingWindow);
        $(this.$processingWindow).dialog({
            width: 300,
            height: 200,
            theme: Brightics.VA.Env.Theme,
            showCloseButton: false,
            autoOpen: false,
            modal: true,
            resizable: false,
            keyboardCloseKey: ''
        });
    };

    ReportManager.prototype.addReportTextBox = function () {

        var index = this.reportData.push({
            id: Brightics.VA.Core.Utils.IDGenerator.report.id() + '-Text',
            type: 'Text',
            originData: ''
        });

        this.renderIndexData(index - 1);
    };


    ReportManager.prototype.render = function () {
        var _this = this;

        $(this.$reportWindow).on('open', function () {
            _this.showProcessingWindow();
        });

        // var title = this.$reportTitleArea.find('.brtc-va-editors-modeleditor-report-title-textarea');
        // title.val(this.reportTitle);
        // this.$reportWindowHeadTitle.text(this.reportTitle);

        // this.$reportWindowHeadTitle.parent().css({
        //     'white-space': 'nowrap',
        //     'width': 'calc(100% - 70px)',
        //     'overflow': 'hidden',
        //     'text-overflow': 'ellipsis'
        // });

        // $(title).css('height', '1px').css('height', (20 + $(title).prop('scrollHeight')) + 'px');
        // $(title).css('resize', 'none');

        this.clearReport();

        this.setReportContentsAreaSize();

        var promises = [];
        promises.push(new Promise(function (resolve, reject) {
            $(_this.$processingWindow).on('open', function () {
                resolve();
            });
        }));
        for (var index in this.reportData) {
            var promise = this.renderIndexData(index);
            promises.push(promise);
        }

        Promise.all(promises).then(function () {
            _this.hideProcessingWindow();

            //relatePosition to absolutePosition
            _this.convertReportLayout();
        }, function (error) {
            _this.hideProcessingWindow();
        });
    };

    ReportManager.prototype.renderIndexData = function (dataIndex) {
        if (this.reportData[dataIndex]) {
            var result = this.renderReportElementBox(this.reportData[dataIndex], dataIndex);
            this.attachReportElementBoxHeaderItems(this.reportData[dataIndex], result.elementBox);
            return result.promise;
        }
    };

    ReportManager.prototype.clearReport = function () {
        this.$reportContentsArea.empty();
    };

    ReportManager.prototype.setReportContentsAreaSize = function () {
        var dataList = this.reportData;
        var maxHeight = 0;
        this.relativeContentsIndexList = [];
        for (var i = 0; i < dataList.length; i++) {
            if (!dataList[i].position) {
                this.relativeContentsIndexList.push(i);
                continue;
            }
            maxHeight = Math.max(maxHeight, dataList[i].position.top + dataList[i].size.height + 5);
        }

        var additionalHeight = this.relativeContentsIndexList.length * 300;
        this.$reportContentsArea.css('height', maxHeight + additionalHeight);
    };

    ReportManager.prototype.containsData = function (contentPanelId, chartType) {
        var checkId = id(contentPanelId, chartType);
        for (var index in this.reportData) {
            if (this.reportData[index].id === checkId) return true;
        }
        return false;
    };

    function id(panelId, type) {
        return panelId + '-' + type;
    }

    ReportManager.prototype.renderReportElementBox = function (target, dataIndex) {
        if (target.type === 'Chart') {
            return this.renderReportChartBox(target, dataIndex);
        } else if (target.type === 'Text') {
            return this.renderReportTextBox(target, dataIndex);
        }
    };

    ReportManager.prototype.renderReportChartBox = function (target, dataIndex) {
        var _this = this;

        var $reportChartBox = $('' +
            '<div class="brtc-va-editors-modeleditor-report-element" content-type="' + target.type + '">' +
            '   <div class="brtc-va-editors-modeleditor-report-element-head">' +
            '       <div class="brtc-va-editors-modeleditor-report-element-head-label" title="' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(makeTitle(target.originData)) + '">'
            + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(makeTitle(target.originData)) + '</div>' +
            '   </div>' +
            '   <div class="brtc-va-editors-modeleditor-report-element-body"></div>' +
            '</div>');
        _this.$reportContentsArea.append($reportChartBox);

        this.setContentsSizeAndPosition($reportChartBox, target.size, target.position, dataIndex);

        this.setResizable($reportChartBox);
        this.setDraggable($reportChartBox);

        var outTable = target.originData.data.table || target.originData.data.fid,
            functionRemoved = false;
        if (this.editorInput.getContents().mid && !this.editorInput.getContents().getFnUnitByOutTable(outTable)) {
            var $label = $reportChartBox.find('.brtc-va-editors-modeleditor-report-element-head-label');
            $label.text('Function has been removed.');
            $label.addClass('function-removed');
            functionRemoved = true;
        }

        var promise = new Promise(function (resolve, reject) {
            queryTable(target.originData.data).then(function (data) {
                var chartOptions = $.extend({}, target.originData.options.chartOption, data);
                if (functionRemoved) {
                    chartOptions.columns = [];
                    chartOptions.data = [];
                }
                $reportChartBox.find('.brtc-va-editors-modeleditor-report-element-body').BrighticsChart(chartOptions);
                resolve();
            }, function (err) {
                reject(err);
            });
        });

        return {elementBox: $reportChartBox, promise: promise};
    };

    ReportManager.prototype.setContentsSizeAndPosition = function ($target, size, position, dataIndex) {
        if (size && position) {
            $target.css({
                position: 'absolute',
                top: position.top,
                left: position.left,
                width: size.width,
                height: size.height
            });
        } else {
            var reportContentsAreaHeight = this.$reportContentsArea.height();
            var additionalContentsLength = this.relativeContentsIndexList.length;
            var additionalContentsIndex = this.relativeContentsIndexList.indexOf(parseInt(dataIndex));

            $target.css({
                position: 'absolute',
                top: reportContentsAreaHeight - 300 * (additionalContentsLength - additionalContentsIndex),
                left: 15,
                width: 900,
                height: 290
            });
        }
    };

    ReportManager.prototype.setNewContentsSizeAndPosition = function ($target, targetData) {
        var reportContentsAreaHeight = this.$reportContentsArea.height();
        var top = reportContentsAreaHeight,
            left = 15,
            width = 300,
            height = 290;
        this.pageHandler.increasePageHeight(height);
        $target.css({
            position: 'absolute',
            top: reportContentsAreaHeight,
            left: 15,
            width: 300,
            height: 290
        });
        targetData.position = {
            top: top,
            left: left
        };
        targetData.size = {
            width: width,
            height: height
        }
    };


    ReportManager.prototype.renderReportTextBox = function (target, dataIndex) {
        var $reportTextBox = $('' +
            '<div class="brtc-va-editors-modeleditor-report-element" content-type="' + target.type + '">' +
            '   <div class="brtc-va-editors-modeleditor-report-element-head">' +
            '       <div class="brtc-va-editors-modeleditor-report-element-head-label"></div>' +
            '   </div>' +
            '   <div class="brtc-va-editors-modeleditor-report-element-body">' +
            '       <div class="brtc-va-editors-modeleditor-report-element-body-contents"></div>' +
            '   </div>' +
            '</div>');
        this.$reportContentsArea.append($reportTextBox);

        this.setContentsSizeAndPosition($reportTextBox, target.size, target.position);

        this.setResizable($reportTextBox);
        this.setDraggable($reportTextBox);

        var $reportTextBody = $reportTextBox.find('textarea.brtc-va-editors-modeleditor-report-element-body-textarea');
        $reportTextBody.val(target.originData);
        $reportTextBody.on('blur', function () {
            target.originData = $(this).val().trim();
        });

        $reportTextBox.find('.brtc-va-editors-modeleditor-report-element-body-contents').append(target.originData);

        return {elementBox: $reportTextBox, promise: Promise.resolve()};
    };

    ReportManager.prototype.setResizable = function ($target) {
        var _this = this;
        $target.resizable({
            // containment: this.$reportContentsArea,
            autoHide: true,
            stop: function (event, ui) {
                var index = ui.element.index();
                var position = ui.position;
                var size = {
                    width: ui.element.outerWidth(),
                    height: ui.element.outerHeight()
                };
                size = _this.configureContentSize($target, position, size);
                _this.setPositionToReportDataByIndex(index, position, size);
            },
            resize: function (event, ui) {
                var position = ui.position;
                var size = {
                    width: ui.element.outerWidth(),
                    height: ui.element.outerHeight()
                };
                var bottomPosition = position.top + size.height;
                _this.pageHandler.handlePageHeight(bottomPosition);
            },
            minHeight: 80,
            minWidth: 150
        });
    };

    ReportManager.prototype.setDraggable = function ($target) {
        var _this = this;
        $target.draggable({
            // containment: this.$reportContentsArea,
            handle: _this.$reportContentsArea.find('.brtc-va-editors-modeleditor-report-element-head'),
            stop: function (event, ui) {
                var index = ui.helper.index();
                var position = ui.position;
                var size = {width: ui.helper.outerWidth(), height: ui.helper.outerHeight()};
                position = _this.configureContentPosition($target, position, size);
                _this.setPositionToReportDataByIndex(index, position, size);
            },
            drag: function (event, ui) {
                var position = ui.position;
                var bottomPosition = position.top + ui.helper.height();
                _this.pageHandler.handlePageHeight(bottomPosition + 10);
            }
        });
    };
    ReportManager.prototype.configureContentSize = function ($target, currentPosition, currentSize) {
        var rightPosition = currentPosition.left + currentSize.width,
            contentsAreaWidth = this.$reportContentsArea.width();

        if (rightPosition > contentsAreaWidth) {
            $target.width(contentsAreaWidth - currentPosition.left);
            currentSize.width = (contentsAreaWidth - currentPosition.left);
        }
        return currentSize;
    };

    ReportManager.prototype.configureContentPosition = function ($target, currentPosition, currentSize) {
        var rightPosition = currentPosition.left + currentSize.width,
            contentsAreaWidth = this.$reportContentsArea.width();

        if (currentPosition.top < 5) currentPosition.top = 5;
        if (currentPosition.left < 5) currentPosition.left = 5;

        if (rightPosition > contentsAreaWidth) {
            currentPosition.left = currentPosition.left - (rightPosition - contentsAreaWidth);
        }

        $target.css({top: currentPosition.top, left: currentPosition.left});

        return currentPosition;
    };


    function makeTitle(target) {
        var title = "Title";
        var fnUnitLabel = target.title.fnUnitLabel;

        if (fnUnitLabel !== null && fnUnitLabel !== undefined) {
            title = '[' + fnUnitLabel + '] ';
        }

        if (target.title.panelTitle !== undefined) {
            title += target.title.panelTitle;
        }

        return title;
    }

    function queryTable(dataInfo) {
        return new Promise(function (resolve, reject) {
            /**
             * 2016-11-14
             * fid라고 저장하지만 실제의미는 out-table이기 때문에 dataInfo.fid -> dataInfo.table 로 변경
             * sungjin1.kim
             */
            Brightics.VA.Core.DataQueryTemplate.queryTable(dataInfo.mid, dataInfo.table || dataInfo.fid, function (newData) {
                resolve(newData);
            }, function (err) {
                reject(err);
            });
        });
    }

    ReportManager.prototype.attachReportElementBoxHeaderItems = function (target, $reportElementBox) {
        var _this = this;
        var $elementHead = $reportElementBox.find('.brtc-va-editors-modeleditor-report-element-head');

        if (target.type === 'Text') {
            var $editButton = $('<div class="brtc-va-editors-modeleditor-report-element-toolbar brtc-va-editors-modeleditor-report-element-toolbar-edit">' +
                '<i class="fa fa-pencil-square-o" aria-hidden="true"></i></div>');
            $elementHead.append($editButton);
            $editButton.click(function () {
                var $reportTextBox = $(this).parents('.brtc-va-editors-modeleditor-report-element');
                var $contents = $reportTextBox.find('.brtc-va-editors-modeleditor-report-element-body-contents');

                var options = {
                    contents: $contents.html(),
                    save: function (markupStr) {
                        target.originData = markupStr;
                        $reportTextBox.attr('content-type', 'Text');
                        $contents.empty();
                        $contents.append(markupStr);
                    }
                };
                new Brightics.VA.Core.Dialogs.NoteDialog($(this).closest('.brtc-va-editors-modeleditor-report-element-body'), options);
            });

            if (!target.position) {
                this.setNewContentsSizeAndPosition($reportElementBox, target);
            }

        }

        var $removeButton = $('<div class="brtc-va-editors-modeleditor-report-element-toolbar brtc-va-editors-modeleditor-report-element-toolbar-remove"></div>');
        $elementHead.append($removeButton);

        $removeButton.click(function () {
            var $target = $(this).parents('.brtc-va-editors-modeleditor-report-element');
            var position = $target.index();

            Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog('Are you sure you want to delete this graph?', function (dialogResult) {
                if (dialogResult.OK) {
                    _this.removeReportDataByIndex(position);
                }
            });
        });
    };

    ReportManager.prototype.removeReportDataByIndex = function (index) {
        if (index > -1) {
            var reportElements = this.$reportContentsArea.find('.brtc-va-editors-modeleditor-report-element');
            if (reportElements.length > index) {
                reportElements[index].remove();
            }
            this.reportData.splice(index, 1);
        }
    };


    ReportManager.prototype.setPositionToReportDataByIndex = function (index, position, size) {
        this.reportData[index].size = size;
        this.reportData[index].position = position;
    };


    ReportManager.prototype.showProcessingWindow = function () {
        $(this.$processingWindow).dialog('open');
    };

    ReportManager.prototype.hideProcessingWindow = function () {
        $(this.$processingWindow).dialog('close');
    };

    ReportManager.prototype.convertReportLayout = function () {
        var contentsList = this.$reportContentsArea.find('.brtc-va-editors-modeleditor-report-element');
        this.pageHandler.setHeight(this.$reportContentsArea.height());

        for (var i = contentsList.length - 1; i >= 0; i--) {
            this.convertRelativeToAbsolute(i, $(contentsList[i]));
        }

        this.relativeContentsIndexList = [];
    };

    ReportManager.prototype.convertRelativeToAbsolute = function (index, $content) {

        var height, width, position;

        position = $content.position();
        height = $content.outerHeight();
        width = $content.outerWidth();

        $content.css({
            position: 'absolute',
            width: width,
            height: height,
            left: position.left,
            top: position.top
        });

        this.setPositionToReportDataByIndex(index, position, {width: width, height: height});
    };

    ReportManager.prototype.downloadAll = function () {
        this.showProcessingWindow();
        this.changeReportCss(false);
        html2canvas(this.$reportContainer, {
            onrendered: function (canvas) {
                var img = canvas.toDataURL('image/png');
                var a = $('<a>').attr('href', img).attr('download', 'report.png').appendTo('body');
                a[0].click();
                a.remove();
            }
        });
        this.changeReportCss(true);
        this.hideProcessingWindow();
    };

    ReportManager.prototype.downloadEachAll = function () {
        var _this = this;
        this.showProcessingWindow();
        this.changeReportCss(false);
        var elementArray = this.$reportContentsArea.find('.brtc-va-editors-modeleditor-report-element');
        var count = 0;
        downloadEachImage();
        function downloadEachImage() {
            if (count < elementArray.length) {
                html2canvas(elementArray[count], {
                    onrendered: function (canvas) {
                        var img = canvas.toDataURL('image/png');
                        var a = $('<a>').attr('href', img).attr('download', 'report' + count + '.png').appendTo('body');
                        a[0].click();
                        a.remove();
                        count++;
                        downloadEachImage();
                    }
                });
            }
            else {
                _this.changeReportCss(true);
                _this.hideProcessingWindow();
            }
        }
    };

    ReportManager.prototype.changeReportCss = function (revert) {
        if (revert) {
            this.$reportWindowBody.perfectScrollbar();
            this.$reportWindowBody.css({'height': this.reportWindowBodyHeight});
            this.$reportWindow.css({
                'height': this.reportWindowHeight,
                'max-height': this.reportWindowMaxHeight
            });
        }
        else {
            this.$reportWindowBody.perfectScrollbar('destroy');
            this.reportWindowBodyHeight = this.$reportWindowBody.css('height');
            this.$reportWindowBody.css({'height': 'auto'});
            this.reportWindowHeight = this.$reportWindow.css('height');
            this.reportWindowMaxHeight = this.$reportWindow.css('max-height');
            this.$reportWindow.css({
                'max-height': '',
                'height': 'auto'
            });
        }
    };

    function PageHandler($controlArea) {
        this.$controlArea = $controlArea;
    }

    PageHandler.prototype.setHeight = function (height) {
        this.$controlArea.height(height);
    };

    PageHandler.prototype.increasePageHeight = function (increaseSize) {
        increaseSize = increaseSize || 50;
        var preHeight = this.$controlArea.height() || 0;

        this.$controlArea.height(preHeight + increaseSize);
    };

    PageHandler.prototype.handlePageHeight = function (bottomPosition) {
        if (bottomPosition + 10 > this.$controlArea.height()) {
            this.$controlArea.height(bottomPosition + 10);
        }
    };


    Brightics.VA.Core.ReportManager = ReportManager;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ReportStandAlone($parent, contents) {
        this.contents = contents;
        this.reportData = contents.report.data || [];

        this.$parent = $parent;
        this.initReport();
    }


    ReportStandAlone.prototype.initReport = function () {
        this.initReportViewer();
        this.render();
    };


    ReportStandAlone.prototype.formattedData = function (data) {
        return {
            id: data.options.id + '-' + data.options.chartOption.chart.type,
            type: 'Chart',
            originData: data
        };
    };

    ReportStandAlone.prototype.removeReportData = function (contentPanelId, chartType) {
        var checkId = id(contentPanelId, chartType);
        for (var index in this.reportData) {
            if (this.reportData[index].id === checkId) {
                this.removeReportDataByIndex(index);
                return;
            }
        }
    };

    ReportStandAlone.prototype.initReportViewer = function () {
        this.$reportWindow = this.$parent;

        this.initReportWindowBody();
    };

    ReportStandAlone.prototype.initReportWindowBody = function () {

        this.$reportContentsArea = $('<div class="brtc-va-editors-modeleditor-report-contents-area"></div>');
        this.$reportWindow.append(this.$reportContentsArea);

        this.pageHandler = new PageHandler(this.$reportContentsArea);

        this.$processingWindow = $('<div><div>Processing ...</div><div><div class="brtc-va-progress">' +
            '<div><span class="brtc-va-progress-loading"></div>' +
            // '<i class="fa fa-circle-o-notch fa-spin fa-5x"></i>' +
            '</div></div>');
        this.$parent.append(this.$processingWindow);
        $(this.$processingWindow).dialog({
            width: 300,
            height: 200,
            theme: Brightics.VA.Env.Theme,
            showCloseButton: false,
            autoOpen: false,
            modal: true,
            resizable: false,
            keyboardCloseKey: ''
        });
    };

    ReportStandAlone.prototype.addReportTextBox = function () {

        var index = this.reportData.push({
            id: Brightics.VA.Core.Utils.IDGenerator.report.id() + '-Text',
            type: 'Text',
            originData: ''
        });

        this.renderIndexData(index - 1);
    };


    ReportStandAlone.prototype.render = function () {
        var _this = this;
        _this.showProcessingWindow();

        this.clearReport();

        this.setReportContentsAreaSize();

        var promises = [];
        promises.push(new Promise(function (resolve, reject) {
            resolve();
        }));
        for (var index in this.reportData) {
            var promise = this.renderIndexData(index);
            promises.push(promise);
        }

        Promise.all(promises).then(function () {
            _this.hideProcessingWindow();

            //relatePosition to absolutePosition
            _this.convertReportLayout();
        }, function (error) {
            _this.hideProcessingWindow();
        });
    };

    ReportStandAlone.prototype.renderIndexData = function (dataIndex) {
        if (this.reportData[dataIndex]) {
            var result = this.renderReportElementBox(this.reportData[dataIndex], dataIndex);
            this.attachReportElementBoxHeaderItems(this.reportData[dataIndex], result.elementBox);
            return result.promise;
        }
    };

    ReportStandAlone.prototype.clearReport = function () {
        this.$reportContentsArea.empty();
    };

    ReportStandAlone.prototype.setReportContentsAreaSize = function () {
        var dataList = this.reportData;
        var maxHeight = 0;
        this.relativeContentsIndexList = [];
        for (var i = 0; i < dataList.length; i++) {
            if (!dataList[i].position) {
                this.relativeContentsIndexList.push(i);
                continue;
            }
            maxHeight = Math.max(maxHeight, dataList[i].position.top + dataList[i].size.height + 5);
        }

        var additionalHeight = this.relativeContentsIndexList.length * 300;
        this.$reportContentsArea.css('height', maxHeight + additionalHeight);
    };

    function id(panelId, type) {
        return panelId + '-' + type;
    }

    ReportStandAlone.prototype.renderReportElementBox = function (target, dataIndex) {
        if (target.type === 'Chart') {
            return this.renderReportChartBox(target, dataIndex);
        } else if (target.type === 'Text') {
            return this.renderReportTextBox(target, dataIndex);
        }
    };

    ReportStandAlone.prototype.renderReportChartBox = function (target, dataIndex) {
        var _this = this;

        var $reportChartBox = $('' +
            '<div class="brtc-va-editors-modeleditor-report-element" content-type="' + target.type + '">' +
            '   <div class="brtc-va-editors-modeleditor-report-element-head">' +
            '       <div class="brtc-va-editors-modeleditor-report-element-head-label" title="' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(makeTitle(target.originData)) + '">'
            + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(makeTitle(target.originData)) + '</div>' +
            '   </div>' +
            '   <div class="brtc-va-editors-modeleditor-report-element-body"></div>' +
            '</div>');
        _this.$reportContentsArea.append($reportChartBox);

        this.setContentsSizeAndPosition($reportChartBox, target.size, target.position, dataIndex);

        this.setResizable($reportChartBox);
        this.setDraggable($reportChartBox);

        var outTable = target.originData.data.table || target.originData.data.fid,
            functionRemoved = false;
        if (this.contents.mid && !this.getFnUnitByOutTable(outTable)) {
            var $label = $reportChartBox.find('.brtc-va-editors-modeleditor-report-element-head-label');
            $label.text('Function has been removed.');
            $label.addClass('function-removed');
            functionRemoved = true;
        }

        var promise = new Promise(function (resolve, reject) {
            queryTable(target.originData.data).then(function (data) {
                var chartOptions = $.extend({}, target.originData.options.chartOption, data);
                if (functionRemoved) {
                    chartOptions.columns = [];
                    chartOptions.data = [];
                }
                $reportChartBox.find('.brtc-va-editors-modeleditor-report-element-body').BrighticsChart(chartOptions);
                resolve();
            }, function (err) {
                reject(err);
            });
        });

        return {elementBox: $reportChartBox, promise: promise};
    };

    ReportStandAlone.prototype.setContentsSizeAndPosition = function ($target, size, position, dataIndex) {
        if (size && position) {
            $target.css({
                position: 'absolute',
                top: position.top,
                left: position.left,
                width: size.width,
                height: size.height
            });
        } else {
            var reportContentsAreaHeight = this.$reportContentsArea.height();
            var additionalContentsLength = this.relativeContentsIndexList.length;
            var additionalContentsIndex = this.relativeContentsIndexList.indexOf(parseInt(dataIndex));

            $target.css({
                position: 'absolute',
                top: reportContentsAreaHeight - 300 * (additionalContentsLength - additionalContentsIndex),
                left: 15,
                width: 900,
                height: 290
            });
        }
    };

    ReportStandAlone.prototype.setNewContentsSizeAndPosition = function ($target, targetData) {
        var reportContentsAreaHeight = this.$reportContentsArea.height();
        var top = reportContentsAreaHeight,
            left = 15,
            width = 300,
            height = 290;
        this.pageHandler.increasePageHeight(height);
        $target.css({
            position: 'absolute',
            top: reportContentsAreaHeight,
            left: 15,
            width: 300,
            height: 290
        });
        targetData.position = {
            top: top,
            left: left
        };
        targetData.size = {
            width: width,
            height: height
        }
    };


    ReportStandAlone.prototype.renderReportTextBox = function (target, dataIndex) {
        var $reportTextBox = $('' +
            '<div class="brtc-va-editors-modeleditor-report-element" content-type="' + target.type + '">' +
            '   <div class="brtc-va-editors-modeleditor-report-element-head">' +
            '       <div class="brtc-va-editors-modeleditor-report-element-head-label"></div>' +
            '   </div>' +
            '   <div class="brtc-va-editors-modeleditor-report-element-body">' +
            '       <div class="brtc-va-editors-modeleditor-report-element-body-contents"></div>' +
            '   </div>' +
            '</div>');
        this.$reportContentsArea.append($reportTextBox);

        this.setContentsSizeAndPosition($reportTextBox, target.size, target.position);

        this.setResizable($reportTextBox);
        this.setDraggable($reportTextBox);

        var $reportTextBody = $reportTextBox.find('textarea.brtc-va-editors-modeleditor-report-element-body-textarea');
        $reportTextBody.val(target.originData);
        $reportTextBody.on('blur', function () {
            target.originData = $(this).val().trim();
        });

        $reportTextBox.find('.brtc-va-editors-modeleditor-report-element-body-contents').append(target.originData);

        return {elementBox: $reportTextBox, promise: Promise.resolve()};
    };

    ReportStandAlone.prototype.setResizable = function ($target) {
    };

    ReportStandAlone.prototype.setDraggable = function ($target) {
    };

    ReportStandAlone.prototype.configureContentSize = function ($target, currentPosition, currentSize) {
        var rightPosition = currentPosition.left + currentSize.width,
            contentsAreaWidth = this.$reportContentsArea.width();

        if (rightPosition > contentsAreaWidth) {
            $target.width(contentsAreaWidth - currentPosition.left);
            currentSize.width = (contentsAreaWidth - currentPosition.left);
        }
        return currentSize;
    };

    ReportStandAlone.prototype.configureContentPosition = function ($target, currentPosition, currentSize) {
        var rightPosition = currentPosition.left + currentSize.width,
            contentsAreaWidth = this.$reportContentsArea.width();

        if (currentPosition.top < 5) currentPosition.top = 5;
        if (currentPosition.left < 5) currentPosition.left = 5;

        if (rightPosition > contentsAreaWidth) {
            currentPosition.left = currentPosition.left - (rightPosition - contentsAreaWidth);
        }

        $target.css({top: currentPosition.top, left: currentPosition.left});

        return currentPosition;
    };


    function makeTitle(target) {
        var title = "Title";
        var fnUnitLabel = target.title.fnUnitLabel;

        if (fnUnitLabel !== null && fnUnitLabel !== undefined) {
            title = '[' + fnUnitLabel + '] ';
        }

        if (target.title.panelTitle !== undefined) {
            title += target.title.panelTitle;
        }

        return title;
    }

    function queryTable(dataInfo) {
        return new Promise(function (resolve, reject) {
            Brightics.VA.Core.DataQueryTemplate.queryTableForReport(dataInfo.mid, dataInfo.table || dataInfo.fid, function (newData) {
                resolve(newData);
            }, function (err) {
                reject(err);
            });
        });
    }

    ReportStandAlone.prototype.attachReportElementBoxHeaderItems = function (target, $reportElementBox) {
        var _this = this;
        var $elementHead = $reportElementBox.find('.brtc-va-editors-modeleditor-report-element-head');

        if (target.type === 'Text') {
            var $editButton = $('<div class="brtc-va-editors-modeleditor-report-element-toolbar brtc-va-editors-modeleditor-report-element-toolbar-edit">' +
                '<i class="fa fa-pencil-square-o" aria-hidden="true"></i></div>');
            $elementHead.append($editButton);
            $editButton.click(function () {
                var $reportTextBox = $(this).parents('.brtc-va-editors-modeleditor-report-element');
                var $contents = $reportTextBox.find('.brtc-va-editors-modeleditor-report-element-body-contents');

                var options = {
                    contents: $contents.html(),
                    save: function (markupStr) {
                        target.originData = markupStr;
                        $reportTextBox.attr('content-type', 'Text');
                        $contents.empty();
                        $contents.append(markupStr);
                    }
                };
                new Brightics.VA.Core.Dialogs.NoteDialog($(this).closest('.brtc-va-editors-modeleditor-report-element-body'), options);
            });

            if (!target.position) {
                this.setNewContentsSizeAndPosition($reportElementBox, target);
            }

        }

        var $removeButton = $('<div class="brtc-va-editors-modeleditor-report-element-toolbar brtc-va-editors-modeleditor-report-element-toolbar-remove"></div>');
        $elementHead.append($removeButton);

        $removeButton.click(function () {
            var $target = $(this).parents('.brtc-va-editors-modeleditor-report-element');
            var position = $target.index();

            Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog('Are you sure you want to delete this graph?', function (dialogResult) {
                if (dialogResult.OK) {
                    _this.removeReportDataByIndex(position);
                }
            });
        });
    };

    ReportStandAlone.prototype.removeReportDataByIndex = function (index) {
        if (index > -1) {
            var reportElements = this.$reportContentsArea.find('.brtc-va-editors-modeleditor-report-element');
            if (reportElements.length > index) {
                reportElements[index].remove();
            }
            this.reportData.splice(index, 1);
        }
    };


    ReportStandAlone.prototype.setPositionToReportDataByIndex = function (index, position, size) {
        this.reportData[index].size = size;
        this.reportData[index].position = position;
    };


    ReportStandAlone.prototype.showProcessingWindow = function () {
        $(this.$processingWindow).dialog('open');
    };

    ReportStandAlone.prototype.hideProcessingWindow = function () {
        $(this.$processingWindow).dialog('close');
    };

    ReportStandAlone.prototype.convertReportLayout = function () {
        var contentsList = this.$reportContentsArea.find('.brtc-va-editors-modeleditor-report-element');
        this.pageHandler.setHeight(this.$reportContentsArea.height());

        for (var i = contentsList.length - 1; i >= 0; i--) {
            this.convertRelativeToAbsolute(i, $(contentsList[i]));
        }

        this.relativeContentsIndexList = [];
    };

    ReportStandAlone.prototype.convertRelativeToAbsolute = function (index, $content) {

        var height, width, position;

        position = $content.position();
        height = $content.outerHeight();
        width = $content.outerWidth();

        $content.css({
            position: 'absolute',
            width: width,
            height: height,
            left: position.left,
            top: position.top
        });

        this.setPositionToReportDataByIndex(index, position, {width: width, height: height});
    };


    ReportStandAlone.prototype.changeReportCss = function (revert) {
        
    };

    ReportStandAlone.prototype.getFnUnitByOutTable = function (table) {

        for (var i in this.contents.functions) {
            var fnUnit = this.contents.functions[i];
            if ($.inArray(table, fnUnit[OUT_DATA]) > -1) {
                return fnUnit;
            }
        }
    };

    function PageHandler($controlArea) {
        this.$controlArea = $controlArea;
    }

    PageHandler.prototype.setHeight = function (height) {
        this.$controlArea.height(height);
    };

    PageHandler.prototype.increasePageHeight = function (increaseSize) {
        increaseSize = increaseSize || 50;
        var preHeight = this.$controlArea.height() || 0;

        this.$controlArea.height(preHeight + increaseSize);
    };

    PageHandler.prototype.handlePageHeight = function (bottomPosition) {
        if (bottomPosition + 10 > this.$controlArea.height()) {
            this.$controlArea.height(bottomPosition + 10);
        }
    };


    Brightics.VA.Core.ReportStandAlone = ReportStandAlone;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var MODULE = window.__module__;
    var Log = new Brightics.VA.Log('Studio');

    function Studio(parentId, options) {
        this.parentId = parentId;
        this.options = options || {};

        Brightics.VA.Env.Session.userId = options.userId;
        Brightics.VA.Env.Session.permissions = options.permissions;
        Brightics.VA.Env.Session.logLevel = options.logLevel;

        var isPublish = options.isPublish || false;

        if (!isPublish) {
            Brightics.VA.Core.Utils.ModelUtils.initDefaultModelContents();
            this.getResourceManager().build()
                .then(function () {
                    _retrieveParent.bind(this)();
                    _initWindow.bind(this)();
                    _createControls.bind(this)();

                    _initDebugListener.bind(this)();
                    _initWidgetConfiguration.bind(this)();
                    _initMessageInfo.bind(this)();
                    _initPreference.bind(this)();

                    _initAddonFunctions.bind(this)();
                }.bind(this))
                .catch(function (err) {
                    console.error(err);
                    throw err;
                });
        }
    }

    var _retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    var _initWindow = function () {
        var _this = this;
        var permissions = $.map(Brightics.VA.Env.Session.permissions || [], function (n, i) {
            return n.permission_id;
        });
        $('body').attr('perm', permissions.join(' '));

        if (Brightics.VA.SettingStorage.getValue('common.scroll.indicate.mouseover') !== 'true') $('body').addClass('scroll-always');
        else $('body').removeClass('scroll-always');

        $(window).on('beforeunload', function (evt) {
            return 'Are you sure you want to leave?';
        });

        $(window).on('unload', function () {
            if (_this.options.immediatelyClearData) Brightics.VA.Core.GarbageCollector.immediatelyClearData();
        });

        $(document).bind('contextmenu', function (e) {
            return false;
        });
    };

    var _createControls = function () {
        var _this = this;
        this.$mainControl = $(
            crel('div', {class: 'brtc-va-studio'},
                crel('div', {class: 'brtc-va-studio-top-area'}),
                crel('dlv', {class: 'brtc-va-studio-body-area'},
                    crel('div', {class: 'brtc-va-studio-editor-area'})
                ),
                crel('dlv', {class: 'brtc-va-workspace-body-area'}),
                crel('dlv', {class: 'brtc-va-studio-bottom-area'})
            )
        );
        this.$parent.append(this.$mainControl);

        var $topArea = this.$mainControl.find('.brtc-va-studio-top-area');
        this.menuBar = new Brightics.VA.Core.Tools.MenuBar($topArea, {
            width: '100%',
            height: '100%',
            selectedProject: this.options.selectedProject
        });

        var $bottomArea = this.$mainControl.find('.brtc-va-studio-bottom-area');
        this.statusBar = new Brightics.VA.Core.Tools.StatusBar($bottomArea, {
            height: '100%'
        });

        var $editorArea = this.$mainControl.find('.brtc-va-studio-editor-area');
        this.editorContainer = new Brightics.VA.Core.Editors.EditorContainer($editorArea, {
            width: '100%',
            height: '100%'
        });

        var $projectViewerArea = this.$mainControl.find('.brtc-va-workspace-body-area');
        this.projectViewer = new Brightics.VA.Workspace.ProjectViewer($projectViewerArea, {
            resourceManager: _this.getResourceManager(),
            selectedProject: _this.options.selectedProject,
            close: function (result) {
                _this.setChartContentAddedReport([]);
                if (result.selectedProject && result.selectedFiles.length > 0) {
                    var editorInput = _this.getResourceManager()
                        .getFile(result.selectedProject, result.selectedFiles[0]);
                    _this.getLayoutManager().openEditor(editorInput);
                } else {
                    _this.getLayoutManager().hideProjectViewer();
                }
            }
        });

        this.getResourceManager().on('project:delete',
            this.getLayoutManager().handleProjectDelete.bind(this.getLayoutManager()));
        this.getResourceManager().on('project:change',
            this.getLayoutManager().handleProjectChange.bind(this.getLayoutManager()));
        this.getResourceManager().on('file:delete',
            this.getLayoutManager().handleFileDelete.bind(this.getLayoutManager()));
        this.getResourceManager().on('file:change',
            this.getLayoutManager().handleFileChange.bind(this.getLayoutManager()));

        this.getLayoutManager().registerProjectViewer(this.projectViewer);
        this.getLayoutManager().registerEditorTab(this.menuBar.editorTab);
        this.getLayoutManager().initLayout();
    };

    var _initDebugListener = function () {
        this.$mainControl.bind('debug', function (event, eventData) {
            var fnUnit, table, model;
            if (eventData.eventType == 'BEGIN-UNIT') {
                var models = eventData.launchOptions.originalModels;
                for (var m in models) {
                    model = models[m];
                    fnUnit = model.getFnUnitById(eventData.fid);
                    if (fnUnit) {
                        for (var i in fnUnit[OUT_DATA]) {
                            table = fnUnit[OUT_DATA][i];
                            Brightics.VA.Core.DataQueryTemplate.removeCache(model.mid, table);
                        }
                    }
                }
            }
        });
    };

    var _initWidgetConfiguration = function () {
        Brightics.VA.Core.Widget.Configurator.setCodeMirrorConfiguration();
    };

    var _initMessageInfo = function () {
        Brightics.VA.Core.Utils.MessageUtils.initMessage();
        Brightics.VA.Core.Utils.MessageUtils.initFunctionLabel();
    };

    var _initPreference = function () {
        this.getPreference().init();
    };

    var _initAddonFunctions = function () {
        this.addonFunctionManager = new Brightics.VA.Core.AddonFunctionManager();
        this.addonFunctionManager.init();
    };

    var _refreshAddonFunctions = function (cb) {
        this.addonFunctionManager.init(cb);
    }

    Studio.prototype.getValidator = function () {
        this.validator = this.validator || {};
        for (var clazz in Brightics.VA.Core.Interface.Validator) {
            var Validator = Brightics.VA.Core.Interface.Validator[clazz];
            this.validator[clazz] = new Validator({studio: this});
        }

        return this.validator;
    };

    Studio.prototype.getResourceManager = function () {
        return MODULE.ResourceManager;
    };

    Studio.prototype.getResourceService = function () {
        return MODULE.ResourceService;
    };

    Studio.prototype.getSession = function () {
        return Brightics.VA.Env.Session;
    };

    Studio.prototype.getLayoutManager = function () {
        this.layoutManager = this.layoutManager || new Brightics.VA.LayoutManager();
        return this.layoutManager;
    };

    Studio.prototype.getPreference = function () {
        this.preference = this.preference || new Brightics.VA.Preference();
        return this.preference;
    };

    Studio.prototype.getJobExecutor = function () {
        this.modelLauncherManager = this.modelLauncherManager || new Brightics.VA.Core.ModelLauncherManager(this);
        return this.modelLauncherManager;
    };

    Studio.prototype.getEditorContainer = function () {
        return this.editorContainer;
    };

    Studio.prototype.getActiveEditor = function () {
        return this.getEditorContainer().getActiveModelEditor();
    };

    Studio.prototype.getClipboardManager = function () {
        this.clipboardManager = this.clipboardManager || new Brightics.VA.Core.Tools.Manager.ClipboardManager();
        return this.clipboardManager;
    };

    Studio.prototype.addDebugListener = function (callback) {
        this.$mainControl.bind('debug', callback);
    };

    Studio.prototype.fireDebugEvent = function (event) {
        this.$mainControl.trigger('debug', [event]);
    };

    Studio.prototype.removeDebugListener = function (callback) {
        this.$mainControl.unbind('debug', callback);
    };

    Studio.prototype.addResourceChangedListener = function (callback) {
        this.$mainControl.bind('resourceChanged', callback);
    };

    Studio.prototype.removeResourceChangedListener = function (callback) {
        this.$mainControl.unbind('resourceChanged', callback);
    };

    Studio.prototype.onCommand = function (command) {
        this.doValidate(command.options.analyticsModel);
    };

    Studio.prototype.addProblemListener = function (callback) {
        this.$mainControl.bind('onProblem', callback);
    };

    Studio.prototype.fireProblemEvent = function (mid, problemList) {
        this.$mainControl.trigger('onProblem', [mid, problemList]);
    };

    Studio.prototype.removeProblemListener = function (handler) {
        this.$mainControl.unbind('onProblem', handler);
    };

    //no more Front-End validation, but Runtime only
    Studio.prototype.doValidate = function (analyticsModel, options) {
        // var _this = this;
        // this.validationJob = this.validationJob || {};
        // if (this.validationJob && this.validationJob[analyticsModel.mid]) {
        //     clearTimeout(_this.validationJob[analyticsModel.mid]);
        //     _this.validationJob[analyticsModel.mid] = null;
        // }
        // this.validationJob[analyticsModel.mid] = setTimeout(function () {
        //     var type = analyticsModel.type || 'data';
        //     var problems = _this.getValidator()[type].validate(analyticsModel, options);
        //     _this.fireProblemEvent(analyticsModel.mid, problems);
        // }, 1000);
    };

    Studio.prototype.reloadResource = function (callback) {
        _refreshAddonFunctions.bind(this)(callback);
    };

    Studio.prototype.setChartContentAddedReport = function (selectedModels) {
        this.projectViewer.setChartContentAddedReport(selectedModels);
    };

    Studio.prototype.getControl = function () {
        return this.$mainControl;
    };

    Brightics.VA.Studio = Studio;
}).call(this);

/**
 * Created by daewon.park on 2016-03-02.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    Brightics.VA.Core.Shapes.DiagramPaper = joint.dia.Paper.extend({
        initialize: function () {
            joint.dia.Paper.prototype.initialize.apply(this, arguments);
        }
    });

}).call(this);
/**
 * Created by daewon.park on 2016-02-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    // width: 225, height: 58
    Brightics.VA.Core.Shapes.FnUnitFigure = joint.shapes.basic.Generic.extend({

        markup: '' +
        '<g class="brtc-va-rotatable">' +
        '   <g class="brtc-va-scalable">' +
        '       <rect class="brtc-va-bounds"/>' +
        '       <rect class="brtc-va-outer"/>' +
        '       <image class="brtc-va-icon"/>' +
        '       <text class="brtc-va-label"/>' +
        '       <text class="brtc-va-last-runtime"/>' +
        '       <circle class="brtc-va-inner"/>' +
        '       <circle class="brtc-va-tooltip"/>' +
        '       <image class="brtc-va-tooltip-icon"/>' +
        '       <title/>' +
        '   </g>' +
        '</g>',
        resource: {
            'scala': {
                'classification':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-classification-20-scala.png',
                        'selected-image':
                            'css/va/images/func-classification-w-20.png'
                    }
                ,
                'evaluation':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-evaluation-20-scala.png',
                        'selected-image':
                            'css/va/images/func-evaluation-w-20.png'
                    }
                ,
                'extraction':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-extraction-20-scala.png',
                        'selected-image':
                            'css/va/images/func-extraction-w-20.png'
                    }
                ,
                'io':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-io-20-scala.png',
                        'selected-image':
                            'css/va/images/func-io-w-20.png'
                    }
                ,
                'brightics':
                    {
                        "opacity":
                            "0.3",
                        "stroke-dasharray":
                            "2,5",
                        "fill":
                            "green",
                        "image":
                            "css/va/images/func-script-20-scala.png",
                        "selected-image":
                            "css/va/images/func-script-w-20.png"
                    }
                ,
                'control':
                    {
                        fill: '#36968B',
                        image:
                            'css/va/images/func-control-20.png',
                        'selected-image':
                            'css/va/images/func-control-w-20.png'
                    }
                ,
                'process':
                    {
                        fill: '#9966FF',
                        image:
                            'css/va/images/func-process-20.png',
                        'selected-image':
                            'css/va/images/func-process-w-20.png'
                    }
                ,
                'manipulation':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-manipulation-20-scala.png',
                        'selected-image':
                            'css/va/images/func-manipulation-w-20.png'
                    }
                ,
                'regression':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-regression-20-scala.png',
                        'selected-image':
                            'css/va/images/func-regression-w-20.png'
                    }
                ,
                'statistics':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-statistics-20-scala.png',
                        'selected-image':
                            'css/va/images/func-statistics-w-20.png'
                    }
                ,
                'transform':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-transform-20-scala.png',
                        'selected-image':
                            'css/va/images/func-transform-w-20.png'
                    }
                ,
                // 'validation'    : {fill: '#57BAB1', image: 'css/va/images/func-validation-20.png', 'selected-image': 'css/va/images/func-validation-w-20.png'},
                'script':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-script-20-scala.png',
                        'selected-image':
                            'css/va/images/func-script-w-20.png'
                    }
                ,
                'streaming':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-streaming-20.png',
                        'selected-image':
                            'css/va/images/func-streaming-w-20.png'
                    }
                ,
                'deeplearning':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-deeplearning-20-scala.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'bigdata':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-bigdata-20.png',
                        'selected-image':
                            'css/va/images/func-bigdata-w-20.png'
                    }
                ,
                'udf':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-udf-normal.png',
                        'selected-image':
                            'css/va/images/func-udf-select.png'
                    }
                ,
                'clustering':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-clustering-20-scala.png',
                        'selected-image':
                            'css/va/images/func-clustering-w-20.png'
                    }
                ,
                'recommendation':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-recommendation-20-scala.png',
                        'selected-image':
                            'css/va/images/func-recommendation-w-20.png'
                    }
                ,
                'timeseries':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-timeseries-20-scala.png',
                        'selected-image':
                            'css/va/images/func-timeseries-w-20.png'
                    }
                ,
                'autonomousanalytics':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-autonomousanalytics-20-scala.png',
                        'selected-image':
                            'css/va/images/func-autonomousanalytics-w-20.png'
                    }
                ,
                'opt':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-opt-20-scala.png',
                        'selected-image':
                            'css/va/images/func-opt-w-20.png'
                    }
                ,
                'ad':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-ad-20-scala.png',
                        'selected-image':
                            'css/va/images/func-ad-w-20.png'
                    }
                ,
                'unknown':
                    {
                        fill: 'red',
                        image:
                            'css/va/images/func-unknown-20.png',
                        'selected-image':
                            'css/va/images/func-unknown-w-20.png'
                    }
                ,
                'core-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'convolutional-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'pooling-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'application':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'recurrent-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'merge-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'normalization-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'advanced-activations-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'textanalytics':
                    {
                        fill: '#E45A00',
                        image:
                            'css/va/images/func-textanalytics-20.png',
                        'selected-image':
                            'css/va/images/func-textanalytics-w-20.png'
                    }
            },
            'python': {
                'classification':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-classification-20-python.png',
                        'selected-image':
                            'css/va/images/func-classification-w-20.png'
                    }
                ,
                'evaluation':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-evaluation-20-python.png',
                        'selected-image':
                            'css/va/images/func-evaluation-w-20.png'
                    }
                ,
                'extraction':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-extraction-20-python.png',
                        'selected-image':
                            'css/va/images/func-extraction-w-20.png'
                    }
                ,
                'io':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-io-20-python.png',
                        'selected-image':
                            'css/va/images/func-io-w-20.png'
                    }
                ,
                'brightics':
                    {
                        "opacity":
                            "0.3",
                        "stroke-dasharray":
                            "2,5",
                        "fill":
                            "green",
                        "image":
                            "css/va/images/func-script-20-python.png",
                        "selected-image":
                            "css/va/images/func-script-w-20.png"
                    }
                ,
                'control':
                    {
                        fill: '#36968B',
                        image:
                            'css/va/images/func-control-20.png',
                        'selected-image':
                            'css/va/images/func-control-w-20.png'
                    }
                ,
                'process':
                    {
                        fill: '#9966FF',
                        image:
                            'css/va/images/func-process-20.png',
                        'selected-image':
                            'css/va/images/func-process-w-20.png'
                    }
                ,
                'manipulation':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-manipulation-20-python.png',
                        'selected-image':
                            'css/va/images/func-manipulation-w-20.png'
                    }
                ,
                'regression':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-regression-20-python.png',
                        'selected-image':
                            'css/va/images/func-regression-w-20.png'
                    }
                ,
                'statistics':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-statistics-20-python.png',
                        'selected-image':
                            'css/va/images/func-statistics-w-20.png'
                    }
                ,
                'transform':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-transform-20-python.png',
                        'selected-image':
                            'css/va/images/func-transform-w-20.png'
                    }
                ,
                // 'validation'    : {fill: '#57BAB1', image: 'css/va/images/func-validation-20.png', 'selected-image': 'css/va/images/func-validation-w-20.png'},
                'script':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-script-20-python.png',
                        'selected-image':
                            'css/va/images/func-script-w-20.png'
                    }
                ,
                'streaming':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-streaming-20-python.png',
                        'selected-image':
                            'css/va/images/func-streaming-w-20.png'
                    }
                ,
                'deeplearning':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-deeplearning-20-python.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'bigdata':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-bigdata-20.png',
                        'selected-image':
                            'css/va/images/func-bigdata-w-20.png'
                    }
                ,
                'udf':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-udf-normal.png',
                        'selected-image':
                            'css/va/images/func-udf-select.png'
                    }
                ,
                'clustering':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-clustering-20-python.png',
                        'selected-image':
                            'css/va/images/func-clustering-w-20.png'
                    }
                ,
                'recommendation':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-recommendation-20-python.png',
                        'selected-image':
                            'css/va/images/func-recommendation-w-20.png'
                    }
                ,
                'timeseries':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-timeseries-20-python.png',
                        'selected-image':
                            'css/va/images/func-timeseries-w-20.png'
                    }
                ,
                'autonomousanalytics':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-autonomousanalytics-20-python.png',
                        'selected-image':
                            'css/va/images/func-autonomousanalytics-w-20.png'
                    }
                ,
                'opt':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-opt-20-python.png',
                        'selected-image':
                            'css/va/images/func-opt-w-20.png'
                    }
                ,
                'ad':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-ad-20-python.png',
                        'selected-image':
                            'css/va/images/func-ad-w-20.png'
                    }
                ,
                'unknown':
                    {
                        fill: 'red',
                        image:
                            'css/va/images/func-unknown-20.png',
                        'selected-image':
                            'css/va/images/func-unknown-w-20.png'
                    }
                ,
                'core-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'convolutional-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'pooling-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'application':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'recurrent-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'advanced-activations-layer':
                    {
                        fill: '#4CB87D',
                        image:
                            'css/va/images/func-deeplearning-20.png',
                        'selected-image':
                            'css/va/images/func-deeplearning-w-20.png'
                    }
                ,
                'textanalytics':
                    {
                        fill: '#366E9D',
                        image:
                            'css/va/images/func-textanalytics-20-python.png',
                        'selected-image':
                            'css/va/images/func-textanalytics-w-20.png'
                    }
            },
            'sql': {
                'udf': {
                    fill: '#d771eb',
                    image:
                        'css/va/images/func-udf-normal.png',
                    'selected-image':
                        'css/va/images/func-udf-select.png'
                }
            }
        },
        getColor: function () {
            var category = this.attributes.attrs['category'];
            var context = this.attributes.attrs['context'];
            var resource = this.resource[context][category] || this.resource[context].io;
            return resource.fill;
        },
        select: function () {
            var category = this.attributes.attrs['category'];
            var context = this.attributes.attrs['context'];
            var resource = this.resource[context][category] || this.resource[context].io;
            if (category && resource && resource.fill) {
                this.attr('.brtc-va-outer/opacity', resource.opacity || 1);
                this.attr('.brtc-va-outer/fill', resource.fill);
                this.attr('.brtc-va-inner/stroke', resource.fill);
                this.attr('.brtc-va-icon/xlink:href', resource['selected-image']);
            }

            if (this.attributes.attrs.deprecated) {
                this.attr('.brtc-va-outer/fill', this.attributes.colorSet.DEPRECATED);
                this.attr('.brtc-va-inner/stroke', this.attributes.colorSet.DEPRECATED);
            }

            this.attr('.brtc-va-label/fill', "#FFFFFF");
        },
        unselect: function () {
            var category = this.attributes.attrs['category'];
            var context = this.attributes.attrs['context'];
            var customCategoryList = ['unknown', 'brightics'];

            var resource = this.resource[context][category] || this.resource[context].io;
            this.attr('.brtc-va-outer/opacity', resource.opacity || 1);
            this.attr('.brtc-va-outer/fill', customCategoryList.indexOf(category) > -1 ? resource.fill : "#FFFFFF");
            this.attr('.brtc-va-inner/stroke', customCategoryList.indexOf(category) > -1 ? resource.fill : "#FFFFFF");
            this.attr('.brtc-va-label/fill', customCategoryList.indexOf(category) > -1 ? "#FFFFFF" : "#667185");

            if (this.attributes.attrs.deprecated) {
                this.attr('.brtc-va-outer/fill', this.attributes.colorSet.DEPRECATED);
                this.attr('.brtc-va-inner/stroke', this.attributes.colorSet.DEPRECATED);
            }

            if (category && resource && resource.image) {
                this.attr('.brtc-va-icon/xlink:href', resource.image);
            }
        },
        changeScale: function (scale) {
            this.label(this.originalLabel, scale);
        },
        label: function (label, scale) {
            if (label) {
                this.originalLabel = label;

                var scaleValue = scale || 1;
                var text = label;
                var lines;

                if (scaleValue < 0.7) {
                    text = label.replace(/\s/g, '\u0006');
                    text = joint.util.breakText(text,
                        {width: (Brightics.VA.Env.Diagram.FIGURE_WIDTH - 80) * scaleValue},
                        {
                            'font-size': 12 * scaleValue,
                            'font-family': 'Arial, Dotum, Tahoma, sans-serif',
                            'font-weight': 'bold'
                        });
                    lines = text.split('\n');
                    if (lines.length > 1) {
                        text = lines[0] + '...';
                    } else {
                        text = lines[0];
                    }
                    text = text.replace(/\u0006/g, ' ');
                    this.attr('text.brtc-va-label/text', text);
                    this.attr('text.brtc-va-label/ref', '.brtc-va-outer');
                    this.attr('text.brtc-va-label/ref-x', 50);
                    this.attr('text.brtc-va-label/ref-y', 27);
                    this.attr('text.brtc-va-label/y-alignment', 'middle');
                } else {
                    text = joint.util.breakText(text,
                        {width: (Brightics.VA.Env.Diagram.FIGURE_WIDTH - 80) * scaleValue},
                        {
                            'font-size': 12 * scaleValue,
                            'font-family': 'Arial, Dotum, Tahoma, sans-serif',
                            'font-weight': 'bold'
                        });
                    lines = text.split('\n');
                    if (lines.length > 2) {
                        text = lines[0] + '\n' + lines[1] + '...';
                    }
                    this.attr('text.brtc-va-label/text', text);
                    this.attr('text.brtc-va-label/ref', '.brtc-va-outer');
                    this.attr('text.brtc-va-label/ref-x', 50);
                    this.attr('text.brtc-va-label/ref-y', 25);
                    this.attr('text.brtc-va-label/y-alignment', 'middle');
                }
            } else {
                console.log('label is undefined !!!');
            }
        },
        lastRuntime: function (time) {
            this.attr('text.brtc-va-last-runtime/text', time);
        },
        resetRuntime: function () {
            this.attr('text.brtc-va-last-runtime/text', '- -:- -:- -.- - -');
        },
        tooltip: function (tooltip) {
            // this.attr('title/text', tooltip);
        },
        category: function (fnUnitDef) {
            var category = fnUnitDef.category;
            var context = fnUnitDef.defaultFnUnit.context || 'scala';
            this.attr('category', category);
            this.attr('context', context);
            var image = this.resource[context][category] ? this.resource[context][category].image : this.resource[context].io.image;
            if (category === 'unknown') {
                this.attr('.brtc-va-outer/fill', this.resource[context][category].fill);
                this.attr('.brtc-va-inner/stroke', this.resource[context][category].fill);
                this.attr('.brtc-va-icon/xlink:href', this.resource[context][category]['selected-image']);
                this.attr('.brtc-va-label/fill', "#FFFFFF");
            } else if (category === 'brightics') {
                this.attr('.brtc-va-outer/fill', this.resource[context][category].fill);
                this.attr('.brtc-va-outer/opacity', this.resource[context][category].opacity);
            } else {
                this.attr('.brtc-va-icon/xlink:href', image);
            }
        },
        updateStatus: function (status) {
            this.attr('.brtc-va-inner/fill', this.attributes.colorSet[status]);
            if (status === 'FAIL') this.showError();
            if (status === 'SUCCESS') this.hideError();
        },
        refresh: function () {
            this.attr('.brtc-va-outer/stroke', this.attributes.colorSet.READY);
            this.attr('.brtc-va-inner/fill', this.attributes.colorSet.READY);
        },
        showError: function () {
            this.attr('.brtc-va-outer/stroke', this.attributes.colorSet['FAIL']);
        },
        hideError: function () {
            this.attr('.brtc-va-outer/stroke', this.attributes.colorSet['READY']);
        },
        showToolTipIcon: function () {
            this.attr('.brtc-va-tooltip/display', 'block');
            this.attr('.brtc-va-tooltip-icon/display', 'block');
        },
        hideToolTipIcon: function () {
            this.attr('.brtc-va-tooltip/display', 'none');
            this.attr('.brtc-va-tooltip-icon/display', 'none');
        },
        setOnShade: function () {
            this.attr('text.brtc-va-label/opacity', '.25');
            this.attr('.brtc-va-icon/opacity', '.25');
        },
        setOffShade: function () {
            this.attr('text.brtc-va-label/opacity', '1');
            this.attr('.brtc-va-icon/opacity', '1');
        },
        setCursorType: function (cursorType) {
            this.attr('.brtc-va-scalable/cursor', cursorType);
        },
        setDeprecated: function (message) {
            this.attr('deprecated', true);
            // this.attr('.brtc-va-outer/title', message);
            this.attr('title/text', 'Deprecated: ' + message);
            this.attr('.brtc-va-label/text-decoration', 'line-through');
            this.attr('.brtc-va-outer/fill', this.attributes.colorSet.DEPRECATED);
            this.attr('.brtc-va-inner/stroke', this.attributes.colorSet.DEPRECATED);
        },
        defaults: joint.util.deepSupplement({
            inPorts: ['in1', 'in2'],
            outPorts: ['out'],
            type: 'brtc.va.shapes.FnUnit',
            attrs: {
                '.brtc-va-bounds': {
                    fill: '#DFDFEF',
                    'fill-opacity': 0,
                    width: Brightics.VA.Env.Diagram.FIGURE_WIDTH,
                    height: Brightics.VA.Env.Diagram.FIGURE_HEIGHT
                },
                '.brtc-va-outer': {
                    fill: '#FFFFFF',
                    ref: '.brtc-va-bounds',
                    'ref-y': 6,
                    width: Brightics.VA.Env.Diagram.FIGURE_WIDTH - 5,
                    height: Brightics.VA.Env.Diagram.FIGURE_HEIGHT - 12,
                    rx: (Brightics.VA.Env.Diagram.FIGURE_HEIGHT - 12) / 2,
                    ry: (Brightics.VA.Env.Diagram.FIGURE_HEIGHT - 12) / 2
                },
                '.brtc-va-icon': {
                    width: 16, height: 16,
                    'xlink:href': 'css/va/images/func-io-20.png',
                    ref: '.brtc-va-outer',
                    'ref-x': 25,
                    'ref-y': 16
                },
                '.brtc-va-label': {
                    fill: '#667185',
                    text: '',
                    ref: '.brtc-va-outer',
                    'ref-x': 50,
                    'ref-y': (Brightics.VA.Env.Diagram.FIGURE_HEIGHT - 8) / 2,
                    'y-alignment': 'middle',
                    'font-size': '12px',
                    'font-family': 'Arial, Dotum, Tahoma, sans-serif',
                    'font-weight': 'bold'
                },
                '.brtc-va-last-runtime': {
                    fill: '#667185',
                    text: '- -:- -:- -.- - -',
                    ref: '.brtc-va-outer',
                    'ref-x': 120,
                    'ref-y': 50,
                    'font-size': 10,
                    'font-family': 'Arial, Dotum, Tahoma, sans-serif',
                    'font-weight': 'normal'
                },
                '.brtc-va-inner': {
                    fill: '#E5E9EF',
                    ref: '.brtc-va-bounds',
                    'ref-x': Brightics.VA.Env.Diagram.FIGURE_WIDTH - 6,
                    'ref-y': Brightics.VA.Env.Diagram.FIGURE_HEIGHT / 2,
                    'stroke-width': 2,
                    'stroke': '#FFFFFF',
                    r: 5
                },
                '.brtc-va-tooltip': {
                    fill: '#FFFFFF',
                    ref: '.brtc-va-bounds',
                    'ref-x': 8,
                    'ref-y': Brightics.VA.Env.Diagram.FIGURE_HEIGHT / 2 - 15,
                    'stroke-width': 2,
                    'stroke': '#E5E9EF',
                    r: 10,
                    // 'xlink:href': 'css/va/images/func-memo-s-11.png',
                    display: 'none'
                },
                '.brtc-va-tooltip-icon': {
                    width: 18,
                    height: 18,
                    'xlink:href': 'css/va/images/func-memo-18x18.png',
                    ref: '.brtc-va-tooltip',
                    'ref-x': 1,
                    'ref-y': 1,
                    display: 'none'
                }
            }

        }, joint.shapes.basic.Generic.prototype.defaults)
    });

}).call(this);
/**
 * Created by daewon.park on 2016-03-02.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    Brightics.VA.Core.Shapes.LinkFigure = joint.dia.Link.extend({
        showRemoveButton: function () {
            this.attr('.link-tools/display', 'block');
            this.attr('.marker-arrowheads/display', 'block');
            this.attr('.connection/stroke-width', '4');
            this.attr('.connection/style', 'stroke: #656EEA');
            this.attr('.marker-target/style', 'stroke: #656EEA; fill: #656EEA');
        },
        hideRemoveButton: function () {
            this.attr('.link-tools/display', 'none');
            this.attr('.marker-arrowheads/display', 'none');
            this.attr('.connection/stroke-width', '2');
            this.attr('.connection/style', 'stroke: #9FA7A2');
            this.attr('.marker-target/style', 'stroke: #9FA7A2; fill: #9FA7A2');
        },
        defaults: joint.util.deepSupplement({
            type: 'brtc.va.shapes.Link',
            router: {name: 'metro'},
            connector: {name: 'rounded'},
            attrs: {
                '.connection': {stroke: '#9FA7A2', 'stroke-width': 2},
                '.marker-target': {fill: '#9FA7A2', stroke: '#9FA7A2', d: 'M 8 0 L 0 4 L 8 8 z'},
                '.marker-arrowhead': {fill: '#9FA7A2', stroke: '#9FA7A2', d: 'M-8,0a8,8 0 1,0 16,0a8,8 0 1,0 -16,0'},
                '.link-tools': {display: 'none'},
                '.marker-arrowheads': {display: 'none'}
            }
        })
    });

}).call(this);
/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function MenuBar(parentId, options) {
        this.parentId = parentId;
        this.options = options || {};
        this.retrieveParent();
        this.createControls();
    }

    MenuBar.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    MenuBar.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-tools-menubar">' +
            '   <div class="brtc-va-tools-menubar-left-area">' +
            '       <div class="brtc-va-tools-menubar-logo"></div>' +
            '   </div>' +
            '   <div class="brtc-va-tools-menubar-center-area"></div>' +
            '   <div class="brtc-va-tools-menubar-right-area">' +
            '       <div class="brtc-va-tools-menubar-doc" title="Documentation">' +
            '           <i class="fa fa-file-text-o"></i>' +
            '       </div>' +
            '       <div class="brtc-va-tools-menubar-notice" title="Notice">' +
            '           <div class="brtc-va-tools-menubar-notice-default"></div>' +
            '           <div class="brtc-va-tools-menubar-notice-new"></div>' +
            '       </div>' +
            '       <div class="brtc-va-tools-menubar-setting" title="Settings"></div>' +
            '       <div class="brtc-va-tools-menubar-myprofile" title="Profile"></div>' +
            '       <div class="brtc-va-tools-menubar-logout" title="Logout">Logout</div>' +
            '   </div>' +
            '</div>');

        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);

        this.createLogoButton();
        this.createEditorHeader();
        this.createSideBarButton();
        this.createManagementButton();
        this.createMyProfileButton();
        this.createLogoutButton();
        this.createHelpButton();
        this.createNoticeButton();

        this.invisibleMenuForPermissions();
    };

    MenuBar.prototype.createLogoButton = function () {
        var _this = this;
        this.$mainControl.find('.brtc-va-tools-menubar-logo').on('click', function () {
            Studio.getLayoutManager().showProjectViewer();
        });
    };

    MenuBar.prototype.createEditorHeader = function () {
        var editorTabArea = this.$mainControl.find('.brtc-va-tools-menubar-center-area');
        this.editorTab = new Brightics.VA.Core.Views.EditorTab(editorTabArea);
    };

    MenuBar.prototype._getEditorInput = function (projectId, fileId) {
        return Studio.getResourceManager().getFile(projectId, fileId);
    };

    MenuBar.prototype.createSideBarButton = function () {
        var _this = this;
        this.$mainControl.find('.brtc-va-tools-menubar-sidebar').click(function () {
            $(this).toggleClass('brtc-va-tools-menubar-toggle-on');
            var show = $(this).hasClass('brtc-va-tools-menubar-toggle-on');
            _this.$mainControl.trigger('showSideBar', [show]);
        });
    };

    MenuBar.prototype.createManagementButton = function () {
        var _this = this;
        this.$mainControl.find('.brtc-va-tools-menubar-setting').click(function (event) {
            var dialog = new Brightics.VA.Core.Tools.MenuBar.SettingContainerDialog(_this.$mainControl, {
                title: 'Settings',
                close: function (result) {
                }
            });
        });
    };

    MenuBar.prototype.createMyProfileButton = function () {
        var _this = this;

        this.$mainControl.find('.brtc-va-tools-menubar-myprofile').click(function (event) {
            event.stopPropagation();
            var $profileContainer = $('.brtc-va-tools-menubar-myprofile-detail-container');
            if ($profileContainer.length) {
                $(window).click();
            }
            else {
                $(window).click();
                $.ajax({
                    type: 'GET',
                    url: 'api/va/v2/users/my',
                    contentType: 'application/json; charset=utf-8',
                    blocking: true,
                    success: function (response) {
                        var options = {};
                        options.id = response[0].id;
                        options.name = response[0].name;
                        options.email = response[0].email;

                        var profileContainer = new Brightics.VA.Core.Tools.MenuBar.ProfileContainer(_this.$mainControl, options);
                        profileContainer.render();
                    }
                });
            }
        });
    };

    MenuBar.prototype.createLogoutButton = function () {
        var _this = this;
        this.$mainControl.find('.brtc-va-tools-menubar-logout').click(function () {
            var closeHandler = function (dialogResult) {
                if (dialogResult.OK) {
                    $(window).unbind('beforeunload');
                    Brightics.VA.Core.GarbageCollector.clearAlluxio();
                    window.location.href = 'auth/' + Brightics.VA.Env.Session.userId + '/logout';

                    if (sessionStorage) sessionStorage.clear();
                }
            };
            var options = {
                contentText: 'Are you sure you want to logout?',
                close: closeHandler,
                isCancel: true
            };
            Brightics.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(_this.$mainControl, options);
        })
    };

    MenuBar.prototype.createHelpButton = function () {
        var $helpIcon = this.$mainControl.find('.brtc-va-tools-menubar-doc');
        $helpIcon.click(function (event) {
            Brightics.VA.Core.Utils.ModelUtils.openDocumentationPopup();
        });
    };

    MenuBar.prototype.createNoticeButton = function () {
        var _this = this;

        var option = {
            url: 'api/admin/v2/notices',
            type: 'GET',
            blocking: false,
            contentType: 'application/json; charset=utf-8'
        };
        $.ajax(option).done(function (noticeData) {
            var $newIcon = $('.brtc-va-tools-menubar-notice-new');

            for (var i in noticeData) {
                if (Brightics.VA.Core.Utils.CommonUtils.getTimeDifferenceFromNow(noticeData[i].update_time) < 24) {
                    $newIcon.show();
                }
                break;
            }
            _this.$mainControl.find('.brtc-va-tools-menubar-notice').click(function (event) {
                new Brightics.VA.Core.Tools.MenuBar.NoticeContainerDialog(_this.$mainControl, {
                    data: noticeData,
                    title: 'Notice',
                    close: function (result) {
                        $(this).dialog('destroy');
                        $(this).remove();
                    }
                });
            });
        }).fail(function (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        });
    };

    MenuBar.prototype.invisibleMenuForPermissions = function () {
        var visibleLogout = true, visibleProfile = true, visibleSetting = true;

        for (var i in Brightics.VA.Env.Session.permissions) {
            if (Brightics.VA.Env.Session.permissions[i].permission_id === 'perm_invisible_logout') {
                visibleLogout = false;
            } else if (Brightics.VA.Env.Session.permissions[i].permission_id === 'perm_invisible_profile_setting') {
                visibleProfile = false;
            } else if (Brightics.VA.Env.Session.permissions[i].permission_id === 'perm_invisible_setting') {
                visibleSetting = false;
            }
        }
        visibleProfile ? this.$mainControl.find('.brtc-va-tools-menubar-myprofile').show() : this.$mainControl.find('.brtc-va-tools-menubar-myprofile').hide();
        visibleLogout ? this.$mainControl.find('.brtc-va-tools-menubar-logout').show() : this.$mainControl.find('.brtc-va-tools-menubar-logout').hide();
        visibleSetting ? this.$mainControl.find('.brtc-va-tools-menubar-setting').show() : this.$mainControl.find('.brtc-va-tools-menubar-setting').hide();
    };

    Brightics.VA.Core.Tools.MenuBar = MenuBar;

}).call(this);

/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function StatusBar(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
    }

    StatusBar.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    StatusBar.prototype.createControls = function() {
        this.$mainControl = $('' +
            '<div class="brtc-va-tools-statusbar">' +
            '   <div class="brtc-va-tools-statusbar-logo"></div>' +
            '   <div class="brtc-va-tools-statusbar-copyright">' +
            '       Copyright <i class="fa fa-copyright"></i> 2016 Samsung SDS, All Rights Reserved.' +
            '   </div>' +
            '   <div class="brtc-va-tools-statusbar-right-area">' +
            '   </div>' +
            '</div>');

        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);
    };

    Brightics.VA.Core.Tools.StatusBar = StatusBar;

}).call(this);
/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SubToolBar(parentId, options) {
        this.parentId = parentId;
        this.options = options || {};
        this.retrieveParent();
        this.createControls();
    }

    SubToolBar.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SubToolBar.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-tools-subtoolbar">' +
            '   <div class="brtc-va-tools-subtoolbar-left-arrow-area"></div>' +
            '   <div class="brtc-va-tools-subtoolbar-center-area"></div>' +
            '   <div class="brtc-va-tools-subtoolbar-right-arrow-area"></div>' +
            '   <div class="brtc-va-tools-subtoolbar-add-button-area"></div>' +
            '</div>');

        //TODO createControls
        console.log('SubToolBar.prototype.createControls');
        //this.$parent.append(this.$mainControl);
    };

    SubToolBar.prototype.openActivity = function (activity) {
        // TODO createTab
        console.log('SubToolBar.prototype.openActivity');
    };

    SubToolBar.prototype.closeActivity = function () {
        // TODO closeTab
        console.log('SubToolBar.prototype.closeActivity');
    };

    Brightics.VA.Core.Tools.SubToolBar = SubToolBar;

}).call(this);

/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function NoticeContainerDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    NoticeContainerDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    NoticeContainerDialog.prototype.constructor = NoticeContainerDialog;

    NoticeContainerDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 500;
        this.dialogOptions.height = 600;
        this.dialogOptions.position = {my: 'right top', at: 'right top+50', of: window};
    };
    
    NoticeContainerDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        this.$mainControl = $('<div class="brtc-va-tools-menubar-notice-container" />');
        $parent.append(this.$mainControl);

        var $emptyBox = $('<div class="brtc-va-tools-menubar-notice-box empty">Loading...</div>');

        this.$mainControl.append($emptyBox);

        var callback = function (data) {
            for (var i in data) {
                $('.brtc-va-tools-menubar-notice-box.empty').remove();

                var timeStamp = new Date(data[i].create_time);
                var date = Brightics.VA.Core.Utils.CommonUtils.transferTimestampToDateString(timeStamp);

                var $noticeBox = $('' +
                    '   <div class="brtc-va-tools-menubar-notice-box">' +
                    '       <div class="brtc-va-tools-menubar-notice-box-header">' +
                    '           <div class="brtc-va-tools-menubar-notice-box-header-new"></div>' +
                    '           <div class="brtc-va-tools-menubar-notice-box-header-title"></div>' +
                    '       </div>' +
                    '       <div class="brtc-va-tools-menubar-notice-box-body">' +
                    '           <div class="brtc-va-tools-menubar-notice-box-body-content"></div>' +
                    '       </div>' +
                    '       <div class="brtc-va-tools-menubar-notice-box-footer border-bottom">' +
                    '           <div class="brtc-va-tools-menubar-notice-box-footer-date">' + date + '</div>' +
                    '           <div class="brtc-va-tools-menubar-notice-box-footer-link-img"></div>' +
                    '           <div class="brtc-va-tools-menubar-notice-box-footer-link" index="' + i + '"><u>more</u></div>' +
                    '       </div>' +
                    '   </div>' +
                    ''
                );

                $noticeBox.find('.brtc-va-tools-menubar-notice-box-header-title').text(data[i].title);

                $noticeBox.find('.brtc-va-tools-menubar-notice-box-body-content').html(((data[i].content) ? data[i].content : ''));
                this.$mainControl.append($noticeBox);

                var $more = $noticeBox.find('.brtc-va-tools-menubar-notice-box-footer-link');
                $more.click(function () {
                    var noticeData = data[$(this).attr('index')];
                    new Brightics.VA.Core.Dialogs.NoticeDetailDialog($(this).closest('.brtc-va-editors-modeleditor-report-element-body'), {
                        noticeData: noticeData,
                        title: 'Notice Detail'
                    });
                });

                var $new = $noticeBox.find('.brtc-va-tools-menubar-notice-box-header-new');
                (Brightics.VA.Core.Utils.CommonUtils.getTimeDifferenceFromNow(data[i].update_time) < 24) ? $new.show() : $new.hide();

                if (i == 2) break;
            }
            if (data.length === 0) $emptyBox.text('No Notice.');
        };

        this.getNoticeData(callback.bind(this));
    };

    NoticeContainerDialog.prototype.getNoticeData = function (callback) {
        var option = {
            url: 'api/admin/v2/notices',
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            blocking: true
        };
        $.ajax(option).done(function (noticeData) {
            callback(noticeData);
        }).fail(function (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        });
    };

    NoticeContainerDialog.prototype.createDialogButtonBar = function () {

    };

    Brightics.VA.Core.Tools.MenuBar.NoticeContainerDialog = NoticeContainerDialog;

}).call(this);

/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function ProfileContainer(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.setDefaultSetting();
    }

    ProfileContainer.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ProfileContainer.prototype.setDefaultSetting = function () {
        if (!this.options) {
            this.options = {};
            this.options.id = Studio.getSession().userId;
            this.options.name = '';
            this.options.email = '';
        }
    };

    ProfileContainer.prototype.render = function () {
        this.createControls();
        this.bindCloseHandler();
    };

    ProfileContainer.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-tools-menubar-myprofile-detail-container">' +
            '   <div class="profile-close-button"></div>' +
            '   <div class="profile-datail-picture-area">' +
            '       <div class="profile-datail-picture"></div>' +
            '   </div>' +
            '   <div class="profile-datail-info-area">' +
            '       <div class="profile-datail-info-text-area">' +
            '           <span class="profile-datail-name" title="' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.name) + '">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.name) + '</span>' +
            '           <span>(</span><span class="profile-datail-id" title="' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.id) + '">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.id) + '</span><span>)</span>' +
            '           <span class="profile-datail-email" title="' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.email) + '">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.email) + '</span></div>' +
            '       <div class="profile-datail-info-setting-area">' +
            '           <span class="profile-datail-info-settings">Profile Settings</span>' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$mainControl.find('.profile-datail-info-settings').click(function (event) {
            event.stopPropagation();
		    window.open('profile');
            $(window).click();
        });
    };

    ProfileContainer.prototype.bindCloseHandler = function () {
        this.$mainControl.click(function (event) {
            event.stopPropagation();
        });

        $(window).on('click', closeProfileDetail);

        this.$mainControl.find('.profile-close-button').click(function () {
            $('.brtc-va-tools-menubar-myprofile-detail-container').remove();
            $(window).off('click', closeProfileDetail);
        });

        function closeProfileDetail() {
            $('.profile-close-button').click();
        }
    };

    ProfileContainer.prototype.getOptions = function () {
        return this.options;
    };

    Brightics.VA.Core.Tools.MenuBar.ProfileContainer = ProfileContainer;

}).call(this);

/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SettingContainerDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    SettingContainerDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    SettingContainerDialog.prototype.constructor = SettingContainerDialog;

    SettingContainerDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 500;
        this.dialogOptions.height = 380;
        this.dialogOptions.position = {my: 'right top', at: 'right top+50', of: window};
    };

    SettingContainerDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        var $container = $('' +
            '<div class="brtc-va-tools-menubar-setting-container">' +
            '   <div class="setting-box"/>' +
            '</div>');
        $parent.append($container);

        this._createSettingSection({
            title: 'Management',
            funcTitle: 'Go to Management page',
            clickFunc: function () {
                var w = window.open("ng1123/user", "Brightics Management");
                w.blur();
            }
        });

        this._createSettingSection({
            title: 'Preferences',
            funcTitle: 'Open the Preferences window',
            clickFunc: function () {
                new Brightics.VA.Core.Dialogs.SettingDialog(_this.$parent, {
                    title: 'Preferences'
                });
            }
        });

        this._createSettingSection({
            title: 'Readme',
            funcTitle: 'About Brightics',
            clickFunc: function () {
                var w = window.open("readme", "Brightics Visual Analytics");
                w.blur();
            }
        });

    };

    SettingContainerDialog.prototype._createSettingSection = function (options) {
        var $section = $('' +
            '       <div class="section">' +
            '           <p class="section-title"></p>' +
            '           <div class="function">' +
            '               <p class="func-title"></p>' +
            '               <div class="brtc-va-tools-menubar-setting-container-link">Go</div>' +
            '           </div>' +
            '       </div>' +
            '');

        this.$mainControl.find('.setting-box').append($section);
        $section.find('.section-title').text(options.title);
        $section.find('.func-title').text(options.funcTitle);

        // var adminPageLink = this.$mainControl.find('.section.management');
        var linkButton = $section.find('.brtc-va-tools-menubar-setting-container-link');
        linkButton.jqxButton({theme: Brightics.VA.Env.Theme});
        linkButton.on('click', options.clickFunc);
    };

    SettingContainerDialog.prototype.createDialogButtonBar = function () {

    };

    Brightics.VA.Core.Tools.MenuBar.SettingContainerDialog = SettingContainerDialog;

}).call(this);

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function ChartMigrator() {
    }

    ChartMigrator.prototype.migrate = function (sheet) {
        if (typeof sheet === 'undefined') return;
        if (sheet.in && sheet.in.length > 0) {
            this.sliceChartOpion(sheet.in);
            sheet.in = this.migrateSheetOption(sheet.in);
        } else if (sheet.in && sheet.in.full && sheet.in.full.length == 0) {
            sheet.in.full = [{'panel': [], 'layout': {}}];
        }

        if (sheet.out && sheet.out.length > 0) {
            this.sliceChartOpion(sheet.out);
            sheet.out = this.migrateSheetOption(sheet.out);
        } else if (sheet.out && sheet.out.full && sheet.out.full.length == 0) {
            sheet.out.full = [{'panel': [], 'layout': {}}];
        }

        this.doMigrationSource(sheet);
    };

    ChartMigrator.prototype.doMigrationSource = function (sheet) {
        for (var inOutKey in sheet) {
            for (var fpKey in sheet[inOutKey]) {
                var fpSheet = sheet[inOutKey][fpKey];
                for (var sheetIndex in fpSheet) {
                    var panels = fpSheet[sheetIndex].panel;
                    for (var panelIndex in panels) {
                        if (!(panels[panelIndex] && panels[panelIndex].chartOption)) continue;
                        if (panels[panelIndex].chartOption.source && panels[panelIndex].chartOption.source.localData) panels[panelIndex].chartOption.source.localData = [];
                        if (panels[panelIndex].chartOption.source && panels[panelIndex].chartOption.source.lazyData) panels[panelIndex].chartOption.source.lazyData = [];
                    }
                }
            }
        }
    };

    ChartMigrator.prototype.sliceChartOpion = function (sheetList) {
        var _this = this;
        if (typeof sheetList === 'undefined' || sheetList.length === 0) return;
        sheetList.forEach(function (sheet) {
            if (sheet.panel && sheet.panel.length > 0) {
                sheet.panel.forEach(function (chartPanel) {
                    if (chartPanel) _this.doMigration(chartPanel.chartOption);
                })
            }
        });

    };

    ChartMigrator.prototype.doMigration = function (chartOption) {
        if (typeof chartOption === 'undefined' || typeof chartOption.chart === 'undefined' || typeof chartOption.chart.type === 'undefined') return;
        if (typeof chartOption['xAxis'] === 'undefined' || chartOption['xAxis'].constructor === Array) return;

        this.doMigrationAxis(chartOption, 'xAxis');
        this.doMigrationAxis(chartOption, 'yAxis');
        this.doMigrationAxis(chartOption, 'colorBy');

        this.configurePreVersionOptions(chartOption);
    };

    ChartMigrator.prototype.doMigrationAxis = function (chartOption, axisName) {
        if (chartOption[axisName].constructor === Object) {
            chartOption[axisName] = [chartOption[axisName]];
        }
    };

    ChartMigrator.prototype.configurePreVersionOptions = function (chartOption) {
        this.changePreVersionChartToTable(chartOption);
        this.configurePreVersionChartOptions(chartOption);
        this.deletePreVersionChartOptions(chartOption)
    };

    ChartMigrator.prototype.changePreVersionChartToTable = function (chartOption) {
        var deletedChartTypes = ['treediagram', 'mcc', 'dendrogram', 'treemap', 'correlation-matrix'];
        if (deletedChartTypes.indexOf(chartOption.chart.type) >= 0) {
            chartOption.chart = {
                type: 'table'
            };
        }

    };


    ChartMigrator.prototype.configurePreVersionChartOptions = function (chartOption) {

        if (chartOption.chart.type === 'heatmap') {
            chartOption.plotOptions = {
                heatmap: {
                    valueBy: [chartOption.valueBy]
                }
            }
        }

        if (chartOption.chart.type === 'pie') {
            chartOption.plotOptions = {
                pie: {
                    sizeBy: [chartOption.sizeBy]
                }
            }
        }

        if (chartOption.chart.type === 'network') {
            chartOption.plotOptions = {
                network: {
                    fromColumn: [chartOption.fromCol],
                    toColumn: [chartOption.toCol]
                }
            }
        }

        if (chartOption.chart.type === 'roc') {
            chartOption.chart.type = 'roccurve';
        }

    };


    ChartMigrator.prototype.deletePreVersionChartOptions = function (chartOption) {
        var preVersionKeys = ['stripLines', 'trendLines', 'groupBy', 'lineBy', 'valueBy', 'sizeBy', 'shapeBy', 'fromCol', 'toCol', 'conditionCol',
            'nodeLabelCol', 'edgeLabelCol', 'parentCol', 'childCol', 'valueCol', 'clusterCol', 'clusterGroupCol', 'heightCol', 'typeCol', 'columnFormatters'];

        for (var key in preVersionKeys) {
            delete chartOption[preVersionKeys[key]];
        }
    };

    ChartMigrator.prototype.migrateSheetOption = function (sheet) {
        return sheet = {
            partial: sheet,
            full: [{'panel': [], 'layout': {}}]
        };
    };

    Brightics.VA.Core.Tools.ChartMigrator = ChartMigrator;

}).call(this);
/* global _, FUNCTION_NAME */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');

    function ModelMigratorExecutor(options) {
        this.options = options || {};
        this.ruleList = {};
        this.addRule();
        this.chartMigrator = new Brightics.VA.Core.Tools.ChartMigrator();
    }

    ModelMigratorExecutor.prototype.addRule = function () {
        for (var rule in Brightics.VA.Core.Tools.ModelMigrator.RuleList) {
            this.ruleList[rule] = new Brightics.VA.Core.Tools.ModelMigrator.RuleList[rule]();
        }
    };

    ModelMigratorExecutor.prototype.migrate = function (contents) {
        this._doModelMigration(contents);

        if (typeof contents.functions === 'undefined') return;
        for (var i = 0; i < contents.functions.length; i++) {
            var func = contents.functions[i];
            if (!func) continue;

            this._doFunctionMigration(func);
            if (func[FUNCTION_NAME] === "Subflow") {
                this.migrate(func.param);
            }
        }
    };

    ModelMigratorExecutor.prototype._doModelMigration = function (model) {
        var _this = this;
        var variables;
        if (model.type == 'control') {
            variables = model.variables;

            for (var i in variables) {
                if (variables[i]['type'] == 'string' || variables[i]['type'] == 'number') variables[i]['type'] = 'literal';
            }
        } else if (model.type == 'data' || model.type == 'realtime') {
            // TODO : 임시로직임 코어에서 바꾸도록 해야함
            model[IN_DATA] = model[IN_DATA] || [];
            model[OUT_DATA] = model[OUT_DATA] || [];
            _.forIn(model.innerModels, function (m) {
                _this.migrate(m);
                // m[IN_DATA] = m[IN_DATA] || [];
                // m[OUT_DATA] = m[OUT_DATA] || [];
            });

            model = this._migrateDiagram(model);
            this._migrateModelOutdata(model);

            variables = model['gv-def'];

            for (var i in variables) {
                if (variables[i]['variable-type'] == 'string' || variables[i]['variable-type'] == 'number') variables[i]['variable-type'] = 'literal';
            }
        } else if (model.type == 'visual') {
            if (typeof model.report.display == 'undefined') {
                model.report.display = {};
            }
            if (!model.report.display['page-type']) {
                model.report.display['page-type'] = 'a4-vertical';
                model.report.display['height'] = '1125';
                model.report.display['width'] = '795';
            }
        }


        var migrateVariable = function (variable) {
            return {
                type: variable.type,
                value: variable.type === 'calculation' && _.isArray(variable.value) ?
                    variable.value[0] : variable.value
            };
        };

        if (model.type === 'data') {
            model.variables = (function (variables) {
                return _.reduce(
                    _.keys(variables), function (acc, key) {
                        var variable = variables[key];
                        return _.merge({}, acc, _.set({}, key, migrateVariable(variable)));
                    }, {});
            }(model.variables));

            var models = [model].concat(_.toArray(model.innerModels));
            _.forEach(models, function (m) {
                m.functions = _.map(m.functions, function (fn) {
                    if (fn[FUNCTION_NAME] === 'Flow') {
                        return _.merge({}, _.omit(fn, 'param.variables'),
                            _.set({},
                                'param.variables',
                                _.mapValues(fn.param.variables, migrateVariable)
                            ));
                    }
                    return fn;
                });
            });
        }
    };
    
    ModelMigratorExecutor.prototype._migrateDiagram = function (model) {
        if (typeof model.diagram === 'undefined' || model.diagram != Brightics.VA.Env.Diagram) {
            try {
                var fnUnitIndex, fnUnit, position;
                for (fnUnitIndex in model.functions) {
                    fnUnit = model.functions[fnUnitIndex];
                    position = fnUnit.display.diagram.position;
                    fnUnit.display.diagram.position = this._configureDiagramPosition(position, model.diagram);
                }
            } catch (e) {
                // TODO : 임시로직임 코어에서 바꾸도록 해야함
                for (var i = 0; i < model.functions.length; i++) {
                    model.functions[i].display = model.functions[i].display || {};
                    model.functions[i].display.diagram = model.functions[i].display.diagram || {};
                    model.functions[i].display.diagram.position = this._getPositionByIndex(i + 1, 1);
                }
            }
            model.diagram = $.extend(true, {}, Brightics.VA.Env.Diagram);
        }
        return model;
    };

    ModelMigratorExecutor.prototype._getPositionByIndex = function (xDiagramIndex, yDiagramIndex) {
        var currentDiagram = Brightics.VA.Env.Diagram;
        return {
            x: currentDiagram.PAPER_MARGIN_LEFT +
                xDiagramIndex * (currentDiagram.FIGURE_WIDTH + currentDiagram.GAP_WIDTH),
            y: currentDiagram.PAPER_MARGIN_TOP +
                yDiagramIndex * (currentDiagram.FIGURE_HEIGHT + currentDiagram.GAP_HEIGHT)
        };
    };

    ModelMigratorExecutor.prototype._configureDiagramPosition = function (position, diagramInit) {
        diagramInit = diagramInit || Brightics.VA.Env.DiagramInit;
        var xDiagramIndex =
            (position.x - diagramInit.PAPER_MARGIN_LEFT) /
            (diagramInit.FIGURE_WIDTH + diagramInit.GAP_WIDTH);
        var yDiagramIndex =
            (position.y - diagramInit.PAPER_MARGIN_TOP) /
            (diagramInit.FIGURE_HEIGHT + diagramInit.GAP_HEIGHT);

        return this._getPositionByIndex(xDiagramIndex, yDiagramIndex);
    };

    ModelMigratorExecutor.prototype._doFunctionMigration = function (func) {
        if (func.display && func.display.sheet) {
            this.chartMigrator.migrate(func.display.sheet);
        }

        if (typeof func.parent !== 'undefined' && typeof func.parent().type !== 'undefined') {
            var target = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(func.parent().type, func.func);
            if (target && target.category === 'udf') {
                this.ruleList['udf'].migrate(func);
            }
        }

        // TODO : 임시로직
        if (_.indexOf(['Flow', 'If', 'ForLoop', 'WhileLoop'], func[FUNCTION_NAME]) > -1) {
            func[IN_DATA] = func[IN_DATA] || [];
            func[OUT_DATA] = func[OUT_DATA] || [];
            func.display.sheet = func.display.sheet || {
                'in': { 'partial': [{ 'panel': [], 'layout': {} }], 'full': [{ 'panel': [], 'layout': {} }] },
                'out': { 'partial': [{ 'panel': [], 'layout': {} }], 'full': [{ 'panel': [], 'layout': {} }] }
            };
        }

        var rule = this.ruleList[func.func];
        if (!rule) return;
        rule.migrate(func);
    };

    ModelMigratorExecutor.prototype._migrateModelOutdata = function (model) {
        var functionOutTables = [];
        _.forEach(model.functions, function (f) {
            functionOutTables = functionOutTables.concat(FnUnitUtils.getOutTable(f));
        })
        model.outData = _.intersection(model.outData, functionOutTables);
    };

    Brightics.VA.Core.Tools.ModelMigrator.Executor = ModelMigratorExecutor;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function ALSTrainRule() {
    }

    ALSTrainRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['reg-param'] === 'undefined') {
            param['reg-param'] = param['reg-parm'] || '';
        }
        delete param['reg-parm'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.alsTrain = ALSTrainRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function AnovaRule() {
    }

    AnovaRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['flag'] === 'undefined') {
            param['flag'] = 'true';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.anova = AnovaRule;

}).call(this);
/**
 * Created by sds on 2017-11-21.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function ArimaPredictRule() {
    }

    ArimaPredictRule.prototype.migrate = function (func) {
        var param = func.param;
        delete param['groupby'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.arimaPredict = ArimaPredictRule;

}).call(this);
/**
 * Created by SDS on 2017-06-16.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function ArimaTrainRule() {
    }

    ArimaTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['intercept'] === 'undefined') {
            param['intercept'] = 'true';
        }

        delete param['groupby'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.arimaTrain = ArimaTrainRule;

}).call(this);
/**
 * Created by ji_sung.park on 2017-05-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AssociationRuleRule() {
    }

    AssociationRuleRule.prototype.migrate = function (func) {
        var param = func.param;
        if (Array.isArray(param['column'][0]) == true){
            param['column'] = param['column'][0];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.associationRule = AssociationRuleRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function AutoArimaPredictRule() {
    }

    AutoArimaPredictRule.prototype.migrate = function (func) {
        var param = func.param;
        delete param['groupby'];

        //change label: Auto Arima Train -> Auto ARIMA Train 170321/mk90.kim
        func.display.label = (func.display.label=== "Auto Arima Predict")? "Auto ARIMA Predict" : func.display.label;
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.autoArimaPredict = AutoArimaPredictRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function AutoArimaTrainRule() {
    }

    AutoArimaTrainRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['columns'] === 'undefined') {
            param['columns'] = param['column'] || [[]];
        }
        if (typeof param['maxP'] === 'undefined') {
            param['maxP'] = '';
        }
        if (typeof param['maxD'] === 'undefined') {
            param['maxD'] = '';
        }
        if (typeof param['maxQ'] === 'undefined') {
            param['maxQ'] = '';
        }

        delete param['column'];
        delete param['tolerance'];
        delete param['iteration'];
        delete param['groupby'];

        //change label: Auto Arima Train -> Auto ARIMA Train 170321/mk90.kim
        func.display.label = (func.display.label=== "Auto Arima Train")? "Auto ARIMA Train" : func.display.label;

        if (func['outData'].length == 1) {
            func['outData'].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.autoArimaTrain = AutoArimaTrainRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoClassificationTrainRule() {
    }

    AutoClassificationTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'random';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.autoClassificationTrain = AutoClassificationTrainRule;

}).call(this);
/**
 * Created by SDS on 2017-10-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoCorrelationRule() {
    }

    AutoCorrelationRule.prototype.migrate = function (func) {
        if (func.display.label === 'Auto Correlation') {
            func.display.label = 'AutoCorrelation'
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.autoCorrelation = AutoCorrelationRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoDecisionTreeClassificationTrainRule() {
    }

    AutoDecisionTreeClassificationTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'grid';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.decisionTreeClassificationTrain = AutoDecisionTreeClassificationTrainRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoDecisionTreeRegressionTrainRule() {
    }

    AutoDecisionTreeRegressionTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'grid';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.decisionTreeRegressionTrain = AutoDecisionTreeRegressionTrainRule;

}).call(this);
/**
 * Created by SDS on 2017-12-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function AutoFeatureSelectionRule() {
    }

    AutoFeatureSelectionRule.prototype.migrate = function (func) {
        var param = func.param;

        if (typeof param['max-num-features'] === 'undefined') {
            param['max-num-features'] = param['num-top-features'];
        }

        delete param['method-arr'];
        delete param['num-top-features'];
        delete param['on-exhaustive'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.autoFeatureSelection = AutoFeatureSelectionRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoGBTClassificationTrainRule() {
    }

    AutoGBTClassificationTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'grid';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.gBTClassificationTrain = AutoGBTClassificationTrainRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoGBTRegressionTrainRule() {
    }

    AutoGBTRegressionTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'grid';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.gBTRegressionTrain = AutoGBTRegressionTrainRule;

}).call(this);
/**
 * Created by SDS on 2017-10-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoLinearRegressionTrainRule() {
    }

    AutoLinearRegressionTrainRule.prototype.migrate = function (func) {
        var param = func.param;

        if (Array.isArray(param['label-col'])) {
            param['label-col'] = param['label-col'][0];
        }

        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'random';
        }

        if (func[OUT_DATA].length < 5) this.changeOutTable(func);

    };

    AutoLinearRegressionTrainRule.prototype.changeOutTable = function (func) {
        var param = func.param;
        var outData = func[OUT_DATA];
        var newOutData = [];

        newOutData.unshift(outData.pop());
        newOutData.unshift(outData.pop());
        newOutData.unshift(Brightics.VA.Core.Utils.IDGenerator.table.id());
        newOutData.unshift(Brightics.VA.Core.Utils.IDGenerator.table.id());

        while (outData.length > 0) {
            newOutData.unshift(outData.pop());
        }

        func[OUT_DATA] = newOutData;
    };
    
    Brightics.VA.Core.Tools.ModelMigrator.RuleList.autoLinearRegressionTrain = AutoLinearRegressionTrainRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoLogisticRegressionTrainRule() {
    }

    AutoLogisticRegressionTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'random';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.autoLogisticRegressionTrain = AutoLogisticRegressionTrainRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoRandomForestClassificationTrainRule() {
    }

    AutoRandomForestClassificationTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'grid';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.randomForestClassificationTrain = AutoRandomForestClassificationTrainRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoRandomForestRegressionTrainRule() {
    }

    AutoRandomForestRegressionTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'grid';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.randomForestRegressionTrain = AutoRandomForestRegressionTrainRule;

}).call(this);
/**
 * Created by SDS on 2018-08-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AutoRegressionTrainRule() {
    }

    AutoRegressionTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['search-method'] === 'undefined') {
            param['search-method'] = 'random';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.autoRegressionTrain = AutoRegressionTrainRule;

}).call(this);
/**
 * Created by ji_sung.park on 2017-05-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataLineRule() {
    }

    BigDataLineRule.prototype.migrate = function (func) {
        var param = func.param;
        if (Array.isArray(param['xcolumn'][0]) == false){
            param['xcolumn'] = [param['xcolumn']];
        }
        if (Array.isArray(param['ycolumn'][0]) == false){
            param['ycolumn'] = [param['ycolumn']];
        }

        delete param['x-step'];
        delete param['y-step'];
        delete param['line-by'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.bigDataLine = BigDataLineRule;

}).call(this);
/**
 * Created by ji_sung.park on 2017-05-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataScatterRule() {
    }

    BigDataScatterRule.prototype.migrate = function (func) {
        var param = func.param;
        if (Array.isArray(param['xcolumn'][0]) == false){
            param['xcolumn'] = [param['xcolumn']];
        }
        if (Array.isArray(param['ycolumn'][0]) == false){
            param['ycolumn'] = [param['ycolumn']];
        }

        delete param['x-step'];
        delete param['y-step'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.bigDataScatter = BigDataScatterRule;

}).call(this);
/**
 * Created by ji_sung.park on 2017-04-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function ChartRule() {
    }

    ChartRule.prototype.migrate = function (func) {
        func.func = 'bigDataScatter';
        func.name = 'BigDataScatter';
        var param = func.param;
        if (typeof param['color-by'] === 'undefined'){
            param['color-by'] = [];
        }

        /*var param = func.param;
        if (typeof param['flag'] === 'undefined') {
            param['flag'] = 'true';
        }*/
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.chart = ChartRule;

}).call(this);
/**
 * Created by ji_sung.park on 2017-06-21.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function Conv2DRule() {
    }

    Conv2DRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['strides'] === 'undefined') {
            param['strides'] = ['1', '1'];
        }
        if (typeof param['padding'] === 'undefined') {
            param['padding'] = 'valid';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.conv2D = Conv2DRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function CorrelationRule() {
    }

    CorrelationRule.prototype.migrate = function (func) {

        var param = func.param;
        delete param['iteration'];
        delete param['rate'];

        // if (typeof param['sequence-column'] === 'undefined') {
        //     param['sequence-column'] = [];
        // }
        // if (typeof param['by'] === 'undefined') {
        //     param['by'] = [];
        // }
        // if (typeof param['rate'] === 'undefined' || typeof param['rate']==='number') {
        //     param['rate'] = '100';
        // }
        // if (typeof param['iteration'] === 'undefined'|| typeof param['iteration']==='number') {
        //     param['iteration'] = '1';
        // }
        // if (func['outData'].length > 1) {
        //     func['outData'] = func['outData'].slice(0, 1);
        // }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.correlation = CorrelationRule;

}).call(this);
/**
 * Created by SDS on 2017-12-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function CrossTableRule() {
    }

    CrossTableRule.prototype.migrate = function (func) {
        var param = func.param;

        if (typeof param['row-total-col'] === 'undefined') {
            param['row-total-col'] = param['row-total-name'];
        }
        if (typeof param['col-total-row'] === 'undefined') {
            param['col-total-row'] = param['col-total-name'];
        }

        delete param['row-total-name'];
        delete param['col-total-name'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.crossTable = CrossTableRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function DataNormalizationRule() {
    }

    DataNormalizationRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['min-max-cut'] === 'undefined') {
            param['min-max-cut'] = 'false';
        }

        if (func['outData'].length == 1) {
            func['outData'].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.dataNormalization = DataNormalizationRule;

}).call(this);
/**
 * Created by SDS on 2017-06-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function DLLoadRule() {
    }

    DLLoadRule.prototype.migrate = function (func) {
        if (!func['param']['loadType']) {
            func['param']['loadType'] = 'CSV';
        }
        if (!func['param']['input_path']) {
            func['param']['input_path'] = '';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.dlLoad = DLLoadRule;

}).call(this);
/**
 * Created by SDS on 2017-06-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function DLPredictRule() {
    }

    DLPredictRule.prototype.migrate = function (func) {
        if (!func['inData']) {
            func['inData'] = [];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.dlPredict = DLPredictRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function EDSChipBinRule() {
    }

    EDSChipBinRule.prototype.migrate = function (func) {
        var param = func.param;
        var etlParam = func.etlparam;
        if (typeof param['site'] === 'undefined') {
            param['site'] = etlParam.site || '';
        }
        if (typeof param['by'] === 'undefined') {
            param['by'] = etlParam.condition.by || '';
        }
        if (typeof param['datasource'] === 'undefined') {
            param['datasource'] = 'EDS CHIP BIN';
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.edsChipbin = EDSChipBinRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function EDSChipMeasureRule() {
    }

    EDSChipMeasureRule.prototype.migrate = function (func) {

        var param = func.param;
        var etlParam = func.etlparam;
        if (typeof param['site'] === 'undefined') {
            param['site'] = etlParam.site || '';
        }
        if (typeof param['by'] === 'undefined') {
            param['by'] = etlParam.condition.by || '';
        }
        if (typeof param['datasource'] === 'undefined') {
            param['datasource'] = 'EDS CHIP MEASURE';
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.edsChipMeasure = EDSChipMeasureRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function EDSWaferRule() {
    }

    EDSWaferRule.prototype.migrate = function (func) {

        var param = func.param;
        var etlParam = func.etlparam;
        if (typeof param['site'] === 'undefined') {
            param['site'] = etlParam.site || '';
        }
        if (typeof param['by'] === 'undefined') {
            param['by'] = etlParam.condition.by || '';
        }
        if (typeof param['datasource'] === 'undefined') {
            param['datasource'] = 'EDS WAFER';
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.edsWafer = EDSWaferRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function EPTRule() {
    }

    EPTRule.prototype.migrate = function (func) {

        var param = func.param;
        var etlParam = func.etlparam;
        if (typeof param['site'] === 'undefined') {
            param['site'] = etlParam.site || '';
        }
        if (typeof param['by'] === 'undefined') {
            param['by'] = etlParam.condition.by || '';
        }
        if (typeof param['datasource'] === 'undefined') {
            param['datasource'] = 'EPT';
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.ept = EPTRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function ERDTSumRule() {
    }

    ERDTSumRule.prototype.migrate = function (func) {

        var param = func.param;
        var etlParam = func.etlparam;
        if (typeof param['site'] === 'undefined') {
            param['site'] = etlParam.site || '';
        }
        if (typeof param['by'] === 'undefined') {
            param['by'] = etlParam.condition.by || '';
        }
        if (typeof param['datasource'] === 'undefined') {
            param['datasource'] = 'ERDTSUM';
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.erdTSum = ERDTSumRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function FabDataRule() {
    }

    FabDataRule.prototype.migrate = function (func) {

        var param = func.param;
        var etlParam = func.etlparam;
        if (typeof param['site'] === 'undefined') {
            param['site'] = etlParam.site || '';
        }
        if (typeof param['by'] === 'undefined') {
            param['by'] = etlParam.condition.by || '';
        }
        if (typeof param['datasource'] === 'undefined') {
            param['datasource'] = 'FAB';
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.fabData = FabDataRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function FabMSRRule() {
    }

    FabMSRRule.prototype.migrate = function (func) {

        var param = func.param;
        var etlParam = func.etlparam;
        if (typeof param['site'] === 'undefined') {
            param['site'] = etlParam.site || '';
        }
        if (typeof param['by'] === 'undefined') {
            param['by'] = etlParam.condition.by || '';
        }
        if (typeof param['datasource'] === 'undefined') {
            param['datasource'] = 'FABMSR';
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.fabmsr = FabMSRRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function GaussianMixturePredictRule() {
    }

    GaussianMixturePredictRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['columns'] === 'undefined') {
            param['columns'] = [[]];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.gaussianMixturePredict = GaussianMixturePredictRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function GaussianMixtureTrainRule() {
    }

    GaussianMixtureTrainRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['columns'] === 'undefined') {
            param['columns'] = [[]];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.gaussianMixtureTrain = GaussianMixtureTrainRule;

}).call(this);
/**
 * Created by SDS on 2017-05-18.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function GLMForLogisticRegressionRule() {
    }

    GLMForLogisticRegressionRule.prototype.migrate = function (func) {
        if (func.name === 'GLMforLogisticRegression') {
            func.name = 'GLMTrainforLogisticRegression'
        }
        if (func.display.label === 'GLM For Logistic Regression') {
            func.display.label = 'GLM Train For Logistic Regression'
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.glmForLogisticRegression = GLMForLogisticRegressionRule;

}).call(this);
/**
 * Created by SDS on 2017-05-18.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function GLMRule() {
    }

    GLMRule.prototype.migrate = function (func) {
        if (func.name === 'GLM') {
            func.name = 'GLMTrain'
        }
        if (func.display.label === 'GLM') {
            func.display.label = 'GLM Train'
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.glm = GLMRule;

}).call(this);
/**
 * Created by SDS on 2017-11-21.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function HierarchicalClusteringRule() {
    }

    HierarchicalClusteringRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['key-col'] === 'undefined') {
            param['key-col'] = '';
        }

        delete param['hold-columns'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.hierarchicalClustering = HierarchicalClusteringRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function HoltWintersPredictRule() {
    }

    HoltWintersPredictRule.prototype.migrate = function (func) {
        var param = func.param;

        delete param['column'];
        delete param['groupby'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.holtWintersPredict = HoltWintersPredictRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function HoltWintersTrainRule() {
    }

    HoltWintersTrainRule.prototype.migrate = function (func) {
        if (func['outData'].length == 1) {
            func['outData'].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
        }

        var param = func.param;
        if (typeof param['columns'] === 'undefined') {
            param['columns'] = param['column'] || [[]];
        }

        delete param['column'];
        delete param['groupby'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.holtWintersTrain = HoltWintersTrainRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function InputDataFrameRule() {
    }

    InputDataFrameRule.prototype.migrate = function (func) {
        func.func = (func.func === 'inputDataFrame') ? ('createTable') : (func.func);
        func.name = (func.name === 'InputDataFrame') ? ('CreateTable') : (func.name);
        func.display.label = (func.display.label === 'Input Data Frame') ? ('Create Table') : (func.display.label);
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.inputDataFrame = InputDataFrameRule;

}).call(this);
/**
 * Created by SDS on 2017-06-10.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function IsotonicRegressionTrainRule() {
    }

    IsotonicRegressionTrainRule.prototype.migrate = function (func) {
        var param = func.param;

        if (typeof param['mode'] === 'undefined') {
            param['mode'] = '';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.isotonicRegressionTrain = IsotonicRegressionTrainRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function KmeansRule() {
    }

    KmeansRule.prototype.migrate = function (func) {

        var param = func.param;

        delete param['features-name'];
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.kmeans = KmeansRule;

}).call(this);
/**
 * Created by SDS on 2017-06-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function LinearRegressionTrainRule() {
    }

    LinearRegressionTrainRule.prototype.migrate = function (func) {
        if (func['outData'].length == 1) {
            func['outData'].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
            func['outData'].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
        }

        if (func[OUT_DATA].length < 4) this.changeOutTable(func);
    };

    LinearRegressionTrainRule.prototype.changeOutTable = function (func) {
        func[OUT_DATA].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.linearRegressionTrain = LinearRegressionTrainRule;

}).call(this);
/**
 * Created by SDS on 2017-10-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function MaxPooling2DRule() {
    }

    MaxPooling2DRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['strides'] === 'undefined') {
            param['strides'] = [];
        }
        if (typeof param['padding'] === 'undefined') {
            param['padding'] = 'valid';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.maxPooling2D = MaxPooling2DRule;

}).call(this);
/**
 * Created by SDS on 2017-06-16.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function MulticlassClassificationEvaluation() {
    }

    MulticlassClassificationEvaluation.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['groupby'] === 'undefined') {
            param['groupby'] = [];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.multiclassClassificationEvaluation = MulticlassClassificationEvaluation;

}).call(this);
/**
 * Created by SDS on 2017-06-02.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function NaiveBayesPredictRule() {
    }

    NaiveBayesPredictRule.prototype.migrate = function (func) {

        var param = func.param;

        delete param['out-col-name'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.naiveBayesPredict = NaiveBayesPredictRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function OneVsRestLRClassifierRule() {
    }

    OneVsRestLRClassifierRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['reg-param'] === 'undefined') {
            param['reg-param'] = param['reg-parm'] || '';
        }
        delete param['reg-parm'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.oneVsRestLRClassifierTrain = OneVsRestLRClassifierRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function PCARule() {
    }

    PCARule.prototype.migrate = function (func) {
        if (func['outData'].length == 2) {
            func['outData'].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.pca = PCARule;

}).call(this);
/**
 * Created by ji_sung.park on 2017-06-21.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function PivotRule() {
    }

    PivotRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['column-labels'] === 'undefined') {
            param['column-labels'] = [param['column-label']] || [];
            delete param['column-label'];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.pivot = PivotRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function PolynomialExpansionRule() {
    }

    PolynomialExpansionRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['hold-columns'] === 'undefined') {
            param['hold-columns'] = [[]];
        }

        delete param['degree'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.polynomialExpansion = PolynomialExpansionRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function PythonScriptRule() {
    }

    PythonScriptRule.prototype.migrate = function (fnUnit) {
        var functionDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnUnit.func);
        var dummyFnUnit = $.extend(true, {}, functionDef.defaultFnUnit);

        if (fnUnit.meta) {
            var inputs = fnUnit.inputs;

            _.forEach(inputs, function (input, key) {
                if (_.isArray(dummyFnUnit.inputs[key]) && !_.isArray(input)) {
                    fnUnit.inputs[key] = [input];
                }
            });

        } else {
            var functionDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnUnit.func);
            var dummyFnUnit = $.extend(true, {}, functionDef.defaultFnUnit);

            //meta
            fnUnit.meta = dummyFnUnit.meta;
            fnUnit.version = dummyFnUnit.version;
            fnUnit.context = dummyFnUnit.context;

            //inData => inputs.inputs
            fnUnit.inputs = dummyFnUnit.inputs;
            fnUnit.inputs.inputs = fnUnit[IN_DATA];
            //outData => outputs.outputs
            fnUnit.outputs = dummyFnUnit.outputs;
            _.forEach(fnUnit.param['out-table-alias'], function (alias, index) {
                fnUnit.outputs[alias] = fnUnit.outData[index];
                fnUnit.meta[alias] = {'type': 'table'};
            });

            //delete inData
            delete fnUnit.inData;
            //delete inData
            delete fnUnit.outData;
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.pythonScript = PythonScriptRule;

}).call(this);
/**
 * Created by SDS on 2017-06-16.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function QRDecompositionRule() {
    }

    QRDecompositionRule.prototype.migrate = function (func) {

        var param = func.param;

        if (typeof param['computeQ'] === 'undefined') {
            param['computeQ'] = 'false';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.qrDecomposition = QRDecompositionRule;

}).call(this);
/**
 * Created by SDS on 2017-06-16.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function QRDecompositionRule() {
    }

    QRDecompositionRule.prototype.migrate = function (func) {

        var param = func.param;

        if (typeof param['computeQ'] === 'undefined') {
            param['computeQ'] = 'false';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.qrDecomposition = QRDecompositionRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function RandomSamplingRule() {
    }

    RandomSamplingRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['method'] === 'undefined') {
            param['method'] = 'fraction';
        }
        if (typeof param['value'] === 'undefined') {
            param['value'] = '0.5';
        }
        if (typeof param['seed'] === 'undefined') {
            param['seed'] = '';
        }
        if (typeof param['shuffle'] === 'undefined') {
            param['shuffle'] = 'false';
        }

        delete param['fraction'];
        delete param['number'];
        delete param['model'];
        delete param['accuracy'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.randomSampling = RandomSamplingRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function ScalaScriptRule() {
    }

    ScalaScriptRule.prototype.migrate = function (fnUnit) {
        var functionDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnUnit.func);
        var dummyFnUnit = $.extend(true, {}, functionDef.defaultFnUnit);

        if (fnUnit.meta) {
            var inputs = fnUnit.inputs;

            _.forEach(inputs, function (input, key) {
                if (_.isArray(dummyFnUnit.inputs[key]) && !_.isArray(input)) {
                    fnUnit.inputs[key] = [input];
                }
            });

        } else {
            var functionDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnUnit.func);
            var dummyFnUnit = $.extend(true, {}, functionDef.defaultFnUnit);

            //meta
            fnUnit.meta = dummyFnUnit.meta;
            fnUnit.version = dummyFnUnit.version;
            fnUnit.context = dummyFnUnit.context;

            //inData => inputs.inputs
            fnUnit.inputs = dummyFnUnit.inputs;
            fnUnit.inputs.inputs = fnUnit[IN_DATA];
            //outData => outputs.outputs
            fnUnit.outputs = dummyFnUnit.outputs;
            _.forEach(fnUnit.param['out-table-alias'], function (alias, index) {
                fnUnit.outputs[alias] = fnUnit.outData[index];
                fnUnit.meta[alias] = {'type': 'table'};
            });

            //delete inData
            delete fnUnit.inData;
            //delete inData
            delete fnUnit.outData;
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.scalaScript = ScalaScriptRule;

}).call(this);
/**
 * Created by SDS on 2017-07-12.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SplitDataRule() {
    }

    SplitDataRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['seed'] === 'undefined') {
            param['seed'] = '';
        }
        if (typeof param['ordering'] === 'undefined') {
            param['ordering'] = 'false';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.splitData = SplitDataRule;

}).call(this);
/**
 * Created by SDS on 2017-06-15.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function StatisticDerivationRule() {
    }

    StatisticDerivationRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['percentile-amounts'] === 'undefined') {
            param['percentile-amounts'] = [];
        }
        if (typeof param['trimmed-mean-amounts'] === 'undefined') {
            param['trimmed-mean-amounts'] = [];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.statisticDerivation = StatisticDerivationRule;

}).call(this);
/**
 * Created by SDS on 2017-06-15.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function StatisticSummaryRule() {
    }

    StatisticSummaryRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['percentile-amounts'] === 'undefined') {
            param['percentile-amounts'] = [];
        }
        if (typeof param['trimmed-mean-amounts'] === 'undefined') {
            param['trimmed-mean-amounts'] = [];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.statisticSummary = StatisticSummaryRule;

}).call(this);
/**
 * Created by SDS on 2017-06-15.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function StratifiedSamplingRule() {
    }

    StratifiedSamplingRule.prototype.migrate = function (func) {

        var param = func.param;

        delete param['accuracy'];
        delete param['groups'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.stratifiedSampling = StratifiedSamplingRule;

}).call(this);
/**
 * Created by sds on 2017-08-30.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function StringSplitRule() {
    }

    StringSplitRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['column'] === 'undefined') {
            param['column'] = param['columns'] || [[]];
        }
        delete param['columns'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.stringSplit = StringSplitRule;

}).call(this);
/**
 * Created by sds on 2017-10-30.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SVDRule() {
    }

    SVDRule.prototype.migrate = function (func) {
        if (func['outData'].length == 3) {
            func['outData'].push(Brightics.VA.Core.Utils.IDGenerator.table.id());
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.svd = SVDRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function SVMRBFPredictRule() {
    }

    SVMRBFPredictRule.prototype.migrate = function (func) {

        var param = func.param;
        if (typeof param['hold-columns'] === 'undefined') {
            param['hold-columns'] = [];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.sVMRBFPredict = SVMRBFPredictRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function SVMTrainRule() {
    }

    SVMTrainRule.prototype.migrate = function (func) {
        var param = func.param;
        if (typeof param['reg-param'] === 'undefined') {
            param['reg-param'] = param['reg-parm'] || '';
        }
        delete param['reg-parm'];
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.svmTrain = SVMTrainRule;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function TimeSeriesAnalysisRule() {
    }

    TimeSeriesAnalysisRule.prototype.migrate = function (func) {
        func.display.label = (func.display.label === "Time Series Autonomous") ? "Autonomous Time Series" : func.display.label;

        if (func['outData'].length > 2) {
            func['outData'].splice(2, func['outData'].length - 2);
        }

        var param = func.param;
        if (typeof param['score'] === 'undefined') {
            param['score'] = 'trainRank';
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.timeSeriesAnalysis = TimeSeriesAnalysisRule;

}).call(this);
/**
 * Created by SDS on 2017-10-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function TimeSeriesDecompositionRule() {
    }

    TimeSeriesDecompositionRule.prototype.migrate = function (func) {
        var param = func.param;

        if (Array.isArray(param['column'][0]) == true){
            param['column'] = param['column'][0];
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.timeSeriesDecomposition = TimeSeriesDecompositionRule;

}).call(this);
/**
 * Created by SDS on 2017-10-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function TransposeRule() {
    }

    TransposeRule.prototype.migrate = function (func) {
        if (typeof func.display.sheet['in'] == 'undefined') {
            func.display.sheet['in'] = {'partial': [{'panel': [], 'layout': {}}], 'full': [{'panel': [], 'layout': {}}]}
        }
        if (typeof func.display.sheet['out'] == 'undefined') {
            func.display.sheet['out'] = {
                'partial': [{'panel': [], 'layout': {}}],
                'full': [{'panel': [], 'layout': {}}]
            }
        } else {
            if (typeof func.display.sheet.out.partial == 'undefined') {
                func.display.sheet['out'] = {
                    'partial': [{'panel': [], 'layout': {}}],
                    'full': [{'panel': [], 'layout': {}}]
                }
            }
        }
    };

    Brightics.VA.Core.Tools.ModelMigrator.RuleList.transpose = TransposeRule;

}).call(this);
/**
 * Created by SDS on 2017-05-18.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;


    function UDGeneralRule() {
    }

    UDGeneralRule.prototype.migrate = function (func) {
        if (typeof func.display.sheet['in'] == 'undefined') {
            func.display.sheet['in'] = {'partial': [{'panel': [], 'layout': {}}], 'full': [{'panel': [], 'layout': {}}]}
        }
    };


    Brightics.VA.Core.Tools.ModelMigrator.RuleList.udf = UDGeneralRule;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-04-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Verifier() {
        this.initVerifier();
    }

    Verifier.prototype.initVerifier = function () {
        //Abstract function
    };

    Verifier.prototype.getRule = function () {
        return this.rule;
    };

    Verifier.prototype.getRuleMode = function () {
        return (this.rule) ? this.rule.id : undefined;
    };

    Verifier.prototype.getSyntaxRule = function () {
        return (this.rule) ? this.rule.syntaxRule : undefined;
    };

    Verifier.prototype.getVerifyRule = function () {
        return (this.rule) ? this.rule.verifyRule : undefined;
    };

    Verifier.prototype.verify = function (data) {
        //Abstract function
    };

    Verifier.prototype.getTokenData = function (data) {
        var offset = 0;
        var tokenResult = [];
        while (offset < data.length) {
            var find = false;
            for (var i in this.rule.syntaxRule) {
                var ret = this.rule.syntaxRule[i].regex.exec(data.toString().substring(offset));
                if (ret && ret.index == 0) {
                    tokenResult.push({
                        token: this.rule.syntaxRule[i].token,
                        matched: ret[0],
                        offset: offset,
                        length: ret[0].length
                    });

                    offset += ret[0].length;
                    find = true;
                    break;
                }
            }

            if (find === false) {
                offset++;
            }
        }

        return tokenResult;
    };

    Brightics.VA.Core.Verifier = Verifier;

}).call(this);
/**
 * Created by gy84.bae on 2016-09-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function CFConditionVerifier() {
        Brightics.VA.Core.Verifier.call(this);
    }

    CFConditionVerifier.prototype = Object.create(Brightics.VA.Core.Verifier.prototype);
    CFConditionVerifier.prototype.constructor = CFConditionVerifier;

    CFConditionVerifier.prototype.initVerifier = function () {
        this.rule = {
            id: 'brtc-control',
            syntaxRule: [
                {regex: /"(?:[^\\]|\\.)*?"/, token: "string"},
                {regex: /0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i, token: "number"},
                {regex: /and|or/, token: "func"},
                {regex: /true|false|null|undefined/, token: "atom"},
                {regex: /\$\{(?:[a-zA-z_])(?:[a-zA-Z0-9_]*)\}/, token: "variable"},
                {regex: /\$\{(sys\.user|sys\.date)\}/g, token: "variable"},
                {regex: /\+|\-|\*|div|mod|=|!=|<=?|>=?/, token: "operator"},
                {regex: /[\{\[\(]/, token: 'open-bracket', indent: true},
                {regex: /[\}\]\)]/, token: 'close-bracket', dedent: true}
            ],
            verifyRule: null
        }
    };

    CFConditionVerifier.prototype.verify = function (data) {
        var errorMessage = [];

        var tokenResult = this.getTokenData(data);

        var untokenizedString = this.checkUntokenizedString(data, tokenResult);
        if (untokenizedString.length) {
            errorMessage.push({
                type: 'Invalid Syntax',
                message: 'There is syntax error in this expression', //TODO 메세지 변경
                data: $.extend(true, [], untokenizedString)
            });
        }
        else {
            var checkOperatorPositionResult = this.checkOperatorPosition(tokenResult);
            if (checkOperatorPositionResult.length) {
                errorMessage.push({
                    type: 'Invalid Operator Position',
                    message: 'There is syntax error in this expression', //TODO 메세지 변경
                    data: $.extend(true, [], checkOperatorPositionResult)
                });
            }

            var checkOperandTypeResult = this.checkOperandType(tokenResult);
            if (checkOperandTypeResult.length) {
                errorMessage.push({
                    type: 'Invalid Operand Type',
                    message: 'There is syntax error in this expression', //TODO 메세지 변경
                    data: $.extend(true, [], checkOperandTypeResult)
                });
            }

            var bracketStackCount = this.checkBracketStack(tokenResult);
            if (bracketStackCount != 0) {
                errorMessage.push({
                    type: 'Invalid Bracket Stack',
                    message: 'There is syntax error in this expression' //TODO 메세지 변경
                });
            }
        }

        return errorMessage;
    };

    CFConditionVerifier.prototype.checkUntokenizedString = function (data, tokenResult) {
        //토큰화 못한 문자열 찾기
        var result = [];

        if (tokenResult.length == 0) {
            //token 된 것이 한개도 없을 떄
            result.push({
                'untokenized-data': data,
                startOffset: 0,
                endOffset: data.toString().length,
                'left-token-index': undefined,
                'right-token-index': undefined
            });
        }
        else if (tokenResult[0].offset != 0) {
            // 첫번째 토큰 앞에 토큰화 되지 못한 string
            result.push({
                'untokenized-data': data.toString().substring(0, tokenResult[0].offset),
                startOffset: 0,
                endOffset: tokenResult[0].offset,
                'left-token-index': undefined,
                'right-token-index': 0
            });
        }

        // 토큰 사이사이에 존재하는 untokenized-data 찾기
        for (var i = 0; i < tokenResult.length; i++) {
            var startOffset = tokenResult[i].offset + tokenResult[i].length;
            var endOffset, leftTokenIndex, rightTokenIndex;
            if (i == tokenResult.length - 1) {
                endOffset = data.toString().length;
                leftTokenIndex = i;
                rightTokenIndex = undefined;
            } else {
                endOffset = tokenResult[i + 1].offset;
                leftTokenIndex = i;
                rightTokenIndex = i + 1;
            }
            var untokenizedString = data.toString().substring(startOffset, endOffset);
            // 토큰 사이의 untokenized-data 찾기 (space는 제외)
            if (untokenizedString.trim() !== '') {
                result.push({
                    'untokenized-data': untokenizedString,
                    startOffset: startOffset,
                    endOffset: endOffset,
                    'left-token-index': leftTokenIndex,
                    'right-token-index': rightTokenIndex
                });
            }
        }

        return result;
    };

    CFConditionVerifier.prototype.checkOperatorPosition = function (tokenResult) {
        var result = [];

        if (tokenResult[0].token === 'func' || tokenResult[0].token === 'operator') {
            result.push({
                index: 0,
                target: tokenResult[0]
            });
        }

        if (tokenResult[tokenResult.length - 1].token === 'func' || tokenResult[tokenResult.length - 1].token === 'operator') {
            result.push({
                index: tokenResult.length - 1,
                target: tokenResult[tokenResult.length - 1]
            });
        }

        return result;
    };

    CFConditionVerifier.prototype.checkOperandType = function (tokenResult) {
        var result = [];

        for (var i = 1; i < tokenResult.length - 1; i++) {
            if (tokenResult[i].token === 'func' || tokenResult[i].token === 'operator') {
                if (tokenResult[i - 1].token === 'func' || tokenResult[i - 1].token === 'operator' || tokenResult[i - 1].token === 'open-bracket' ||
                    tokenResult[i + 1].token === 'func' || tokenResult[i + 1].token === 'operator' || tokenResult[i + 1].token === 'close-bracket') {
                    result.push({
                        index: i,
                        target: tokenResult[i]
                    });
                }
            }
        }

        return result;
    };

    CFConditionVerifier.prototype.checkBracketStack = function (tokenResult) {
        //TODO 고도화 필요
        var bracketStackCount = 0;
        for (var i = 0; i < tokenResult.length; i++) {
            // 괄호 갯수가 안 맞는지 확인
            if (tokenResult[i].token === 'open-bracket') {
                bracketStackCount++;
            }
            if (tokenResult[i].token === 'close-bracket') {
                bracketStackCount--;
            }
        }
        return bracketStackCount;
    };

    CFConditionVerifier.prototype.getTokenData = function (data) {
        var offset = 0;
        var tokenResult = [];
        while (offset < data.length) {
            var find = false;
            for (var i in this.rule.syntaxRule) {
                var ret = this.rule.syntaxRule[i].regex.exec(data.toString().substring(offset));
                if (ret && ret.index == 0) {
                    tokenResult.push({
                        token: this.rule.syntaxRule[i].token,
                        matched: ret[0],
                        offset: offset,
                        length: ret[0].length
                    });

                    offset += ret[0].length;
                    find = true;
                    break;
                }
            }

            if (find === false) {
                offset++;
            }
        }

        return tokenResult;
    };

    Brightics.VA.Core.Verifier.CFConditionVerifier = CFConditionVerifier;

}).call(this);
/**
 * Created by gy84.bae on 2016-09-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function CFVariableVerifier() {
        Brightics.VA.Core.Verifier.call(this);
    }

    CFVariableVerifier.prototype = Object.create(Brightics.VA.Core.Verifier.prototype);
    CFVariableVerifier.prototype.constructor = CFVariableVerifier;

    CFVariableVerifier.prototype.initVerifier = function () {
        this.rule = {
            id: 'brtc-controlflow-variable',
            syntaxRule: [
                {regex: /\$\{(?:[a-zA-Z0-9_]*)\}/, token: "variable"} // /\$(?:[a-zA-z_])(?:[a-zA-Z0-9_]*)/
            ],
            verifyRule: null
        }
    };

    CFVariableVerifier.prototype.verify = function (data) {
        var tokenResult = this.getTokenData(data);
        var errorMessage = [];
        if (tokenResult.length == 0 || tokenResult[0].offset != 0 || data.length != tokenResult[0].length) {
            errorMessage.push({
                type: 'Invalid Syntax',
                message: 'There is syntax error in this expression'
            });
        }
        return errorMessage;
    };

    CFVariableVerifier.prototype.getTokenData = function (data) {
        var offset = 0;
        var tokenResult = [];
        while (offset < data.length) {
            var find = false;
            for (var i in this.rule.syntaxRule) {
                var ret = this.rule.syntaxRule[i].regex.exec(data.toString().substring(offset));
                if (ret && ret.index == 0) {
                    tokenResult.push({
                        token: this.rule.syntaxRule[i].token,
                        matched: ret[0],
                        offset: offset,
                        length: ret[0].length
                    });

                    offset += ret[0].length;
                    find = true;
                    break;
                }
            }

            if (find === false) {
                offset++;
            }
        }

        return tokenResult;
    };

    Brightics.VA.Core.Verifier.CFVariableVerifier = CFVariableVerifier;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-04-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ConditionVerifier() {
        Brightics.VA.Core.Verifier.call(this);
    }

    ConditionVerifier.prototype = Object.create(Brightics.VA.Core.Verifier.prototype);
    ConditionVerifier.prototype.constructor = ConditionVerifier;

    ConditionVerifier.prototype.initVerifier = function () {
        this.rule = {
            id: 'brtc-va-condition-rule',
            syntaxRule: [
                {regex: /\[(?:[^\"\[\]\(\)])*?\]/, token: "column"},
                {regex: /true|false|null|undefined/, token: "atom"},
                {regex: /0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i, token: "number"},
                {regex: /[-+\/*=<>!]+/, token: "operator"},
                {regex: /([A-z])\w+/, token: "string"},
                {regex: /[\{\[\(]/, indent: true},
                {regex: /[\}\]\)]/, dedent: true}
            ],
            verifyRule: null
        };
    };

    ConditionVerifier.prototype.getTokenData = function (data) {
        var offset = 0;
        var rules = this.rule.syntaxRule;
        var tokenData = [];
        while (offset < data.length ) {
            var find = false;
            for (var i in rules) {
                var ret = rules[i].regex.exec(data.substring(offset));
                if (ret && ret.index == 0) {
                    tokenData.push(ret[0]);
                    offset += ret[0].length;
                    find = true;
                    break;
                }
            }
            if (find === false) {
                offset++;
            }
        }
        return tokenData;
    };

    ConditionVerifier.prototype.verify = function (data) {
        //TODO
        var errorMessage = null;

        return errorMessage;
    };

    Brightics.VA.Core.Verifier.ConditionVerifier = ConditionVerifier;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-04-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function NumericalFormulaVerifier() {
        Brightics.VA.Core.Verifier.call(this);
    }

    NumericalFormulaVerifier.prototype = Object.create(Brightics.VA.Core.Verifier.prototype);
    NumericalFormulaVerifier.prototype.constructor = NumericalFormulaVerifier;

    NumericalFormulaVerifier.prototype.initVerifier = function () {
        this.rule = {
            id: 'brtc-va-numerical-formula-rule',
            syntaxRule: [
                {regex: /"(?:[^\\]|\\.)*?"/, token: "string"},
                {regex: /\[(?:[^\"\[\]\(\)])*?\]/, token: "column"},
                {regex: /true|false|null|undefined/, token: "atom"},
                {regex: /0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i, token: "number"},
                {regex: /(?:pow|exp|log10|log2|ln|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|degrees|radians|round|floor|ceil|sqrt|abs)\b/, token: "func"},
                {regex: /[-+\/*%]+/, token: "operator"},
                {regex: /[\{\[\(]/, indent: true},
                {regex: /[\}\]\)]/, dedent: true}
            ],
            verifyRule: null
        };
    };

    NumericalFormulaVerifier.prototype.verify = function (data) {
        var tokenResult = this.getTokenData(data);

        var errorMessage = [];
        if(tokenResult.length == 0 || tokenResult[0].offset != 0){
            errorMessage.push({
                type:'Invalid Syntax',
                message: 'There is syntax error in this expression'
            });
        }

        return errorMessage;
    };

    NumericalFormulaVerifier.prototype.getTokenData = function (data) {
        var offset = 0;
        var tokenResult = [];
        while (offset < data.length ) {
            var find = false;
            for (var i in this.rule.syntaxRule) {
                var ret = this.rule.syntaxRule[i].regex.exec(data.substring(offset));
                if (ret && ret.index == 0) {
                    tokenResult.push({
                        token: this.rule.syntaxRule[i].token,
                        matched: ret[0],
                        offset: offset,
                        length: ret[0].length
                    });

                    offset += ret[0].length;
                    find = true;
                    break;
                }
            }

            if (find === false) {
                offset++;
            }
        }

        return tokenResult;
    };

    Brightics.VA.Core.Verifier.NumericalFormulaVerifier = NumericalFormulaVerifier;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-04-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ScalaVerifier() {
        Brightics.VA.Core.Verifier.call(this);
    }

    ScalaVerifier.prototype = Object.create(Brightics.VA.Core.Verifier.prototype);
    ScalaVerifier.prototype.constructor = ScalaVerifier;

    ScalaVerifier.prototype.initVerifier = function () {
        this.rule = {
            id: 'text/x-scala',
            syntaxRule: 'default',
            verifyRule: 'default'
        };
    };

    ScalaVerifier.prototype.verify = function (data) {
        //TODO
        var errorMessage = null;

        return errorMessage;
    };

    Brightics.VA.Core.Verifier.ScalaVerifier = ScalaVerifier;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-04-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SqlVerifier() {
        Brightics.VA.Core.Verifier.call(this);
    }

    SqlVerifier.prototype = Object.create(Brightics.VA.Core.Verifier.prototype);
    SqlVerifier.prototype.constructor = SqlVerifier;

    SqlVerifier.prototype.initVerifier = function () {
        this.rule = {
            id: 'sql',
            syntaxRule: 'default',
            verifyRule: 'default'
        };
    };

    SqlVerifier.prototype.verify = function (data) {
        //TODO
        var errorMessage = null;

        return errorMessage;
    };

    Brightics.VA.Core.Verifier.SqlVerifier = SqlVerifier;

}).call(this);
/**
 * Created by gy84.bae on 2016-09-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SystemVariableVerifier() {
        Brightics.VA.Core.Verifier.call(this);
    }

    SystemVariableVerifier.prototype = Object.create(Brightics.VA.Core.Verifier.prototype);
    SystemVariableVerifier.prototype.constructor = SystemVariableVerifier;

    SystemVariableVerifier.prototype.initVerifier = function () {
        this.rule = {
            id: 'brtc-system-variable',
            syntaxRule: [
                {regex: /\$\{(?:[a-zA-z_])(?:[a-zA-Z0-9_]*)\}/, token: "no-variable"},
                {regex: /\$\{(sys\.user|sys\.date)\}/g, token: "variable"}
            ],
            verifyRule: null
        }
    };

    SystemVariableVerifier.prototype.verify = function (data) {
        var errorMessage = [];
        return errorMessage;
    };

    Brightics.VA.Core.Verifier.SystemVariableVerifier = SystemVariableVerifier;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    const DUMMY_FNUNIT = {
        'func': 'dummy',
        'name': 'BigDataDummy',
        'inData': [],
        'outData': [],
        'param': {},
        'label': 'Big Data Dummy',
        'display': {
            'label': 'Big Data Dummy',
            'diagram': {
                'position': {
                    'x': 20,
                    'y': 10
                }
            },
            'sheet': {
                'out': [
                    {
                        'panel': [],
                        'layout': {}
                    }
                ]
            }
        },
        'mandatory': []
    };
    const CHART_TYPE_FUNCS = {
        "scatter": "bigDataScatter",
        "line": "bigDataLine",
        "area": "bigDataLine",
        "area-stacked": "bigDataColumn",
        "area-stacked-100": "bigDataColumn",
        "roccurve": "bigDataLine",
        "pie": "bigDataPie",
        "column": "bigDataColumn",
        "column-stacked": "bigDataColumn",
        "column-stacked-100": "bigDataColumn",
        "bar": "bigDataColumn",
        "bar-stacked": "bigDataColumn",
        "bar-stacked-100": "bigDataColumn",
        "histogram": "bigDataHistogram",
        "boxplot": "bigDataBoxPlot",
        'bubble': 'bigDataBubble',
        'card': 'bigDataCard',
        'heatmap': 'bigDataHeatmap',
        'heatmap-matrix': 'bigDataHeatmapMatrix',
        'treemap': 'bigDataTreemap',
        'donut': "bigDataPie"
    };

    function FnUnitGenerator(options) {
        this.options = options || {};
    }

    FnUnitGenerator.prototype.initFnUnit = function () {
        var chartOptions = this.options.chartOptions;
        var chartType = chartOptions.chart.type;
        var func = CHART_TYPE_FUNCS[chartType];
        var fnUnit = Brightics.VA.Core.Functions.Library.getFunction(func).defaultFnUnit;
        if (!fnUnit) fnUnit = $.extend(true, {}, DUMMY_FNUNIT);
        fnUnit.fid = Brightics.VA.Core.Utils.IDGenerator.func.id();
        this.fnUnit = fnUnit;
    };

    FnUnitGenerator.prototype.inputParams = function () {
        // abstract function
    };

    FnUnitGenerator.prototype.setColorByParam = function () {
        var chartOptions = this.options.chartOptions;
        var param = this.fnUnit.param;

        if (chartOptions.colorBy && chartOptions.colorBy[0] && chartOptions.colorBy[0].selected) {
            for (var i in chartOptions.colorBy[0].selected) {
                if (chartOptions.colorBy[0].selected[i] && chartOptions.colorBy[0].selected[i].name) {
                    if (_.isEmpty(param['color-by'])) param['color-by'] = [];
                    param['color-by'].push(chartOptions.colorBy[0].selected[i].name);
                }
            }
        }
    };

    FnUnitGenerator.prototype.setAggregationParam = function () {
        var param = this.fnUnit.param;

        var agg = this.aggregation;

        if (!agg || agg == '') {
            delete param['aggregation'];
            return;
        }
        if (agg == 'average') agg = 'avg';
        if (agg == 'unique_count') agg = 'ucount';
        param['aggregation'] = agg;
    };

    FnUnitGenerator.prototype.generate = function () {
        this.initFnUnit();
        this.inputParams();
        return $.extend(true, {}, this.fnUnit);
    };


    Brightics.VA.Core.Utils.FnUnitGenerator = FnUnitGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataAreaGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataAreaGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataAreaGenerator.prototype.constructor = BigDataAreaGenerator;

    BigDataAreaGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.area = BigDataAreaGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataAreaStacked100Generator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataAreaStacked100Generator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataAreaStacked100Generator.prototype.constructor = BigDataAreaStacked100Generator;

    BigDataAreaStacked100Generator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setStackByParam();
    };

    BigDataAreaStacked100Generator.prototype.setStackByParam = function () {
        var chartOptions = this.options.chartOptions.plotOptions.area;
        var param = this.fnUnit.param;

        if (chartOptions.stackBy && chartOptions.stackBy[0] && chartOptions.stackBy[0].selected) {
            for (var i in chartOptions.stackBy[0].selected) {
                if (chartOptions.stackBy[0].selected[i] && chartOptions.stackBy[0].selected[i].name) {
                    param['color-by'].push(chartOptions.stackBy[0].selected[i].name);
                }
            }
        }else{
            param['color-by'] = [];
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator['area-stacked-100'] = BigDataAreaStacked100Generator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataAreaStackedGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataAreaStackedGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataAreaStackedGenerator.prototype.constructor = BigDataAreaStackedGenerator;

    BigDataAreaStackedGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setStackByParam();
    };

    BigDataAreaStackedGenerator.prototype.setStackByParam = function () {
        var chartOptions = this.options.chartOptions.plotOptions.area;
        var param = this.fnUnit.param;

        if (chartOptions.stackBy && chartOptions.stackBy[0] && chartOptions.stackBy[0].selected) {
            for (var i in chartOptions.stackBy[0].selected) {
                if (chartOptions.stackBy[0].selected[i] && chartOptions.stackBy[0].selected[i].name) {
                    param['color-by'].push(chartOptions.stackBy[0].selected[i].name);
                }
            }
        }else{
            param['color-by'] = [];
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator['area-stacked'] = BigDataAreaStackedGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataBarGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataBarGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataBarGenerator.prototype.constructor = BigDataBarGenerator;

    BigDataBarGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
            this.aggregation = chartOptions.xAxis[0].selected[0].aggregation;
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
        }

        this.setAggregationParam();
        this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.bar = BigDataBarGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataBarStackedGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataBarStackedGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataBarStackedGenerator.prototype.constructor = BigDataBarStackedGenerator;

    BigDataBarStackedGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
            this.aggregation = chartOptions.xAxis[0].selected[0].aggregation;
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
        }

        this.setAggregationParam();
        this.setStackByParam();
    };

    BigDataBarStackedGenerator.prototype.setStackByParam = function () {
        var chartOptions = this.options.chartOptions.plotOptions.bar;
        var param = this.fnUnit.param;

        if (chartOptions.stackBy && chartOptions.stackBy[0] && chartOptions.stackBy[0].selected) {
            for (var i in chartOptions.stackBy[0].selected) {
                if (chartOptions.stackBy[0].selected[i] && chartOptions.stackBy[0].selected[i].name) {
                    param['color-by'].push(chartOptions.stackBy[0].selected[i].name);
                }
            }
        }else{
            param['color-by'] = [];
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator['bar-stacked'] = BigDataBarStackedGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataBarStacked100Generator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataBarStacked100Generator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataBarStacked100Generator.prototype.constructor = BigDataBarStacked100Generator;

    BigDataBarStacked100Generator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
            this.aggregation = chartOptions.xAxis[0].selected[0].aggregation;
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
        }

        this.setAggregationParam();
        this.setStackByParam();
    };

    BigDataBarStacked100Generator.prototype.setStackByParam = function () {
        var chartOptions = this.options.chartOptions.plotOptions.bar;
        var param = this.fnUnit.param;

        if (chartOptions.stackBy && chartOptions.stackBy[0] && chartOptions.stackBy[0].selected) {
            for (var i in chartOptions.stackBy[0].selected) {
                if (chartOptions.stackBy[0].selected[i] && chartOptions.stackBy[0].selected[i].name) {
                    param['color-by'].push(chartOptions.stackBy[0].selected[i].name);
                }
            }
        }else{
            param['color-by'] = [];
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator['bar-stacked-100'] = BigDataBarStacked100Generator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataBoxPlotGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataBoxPlotGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataBoxPlotGenerator.prototype.constructor = BigDataBoxPlotGenerator;

    BigDataBoxPlotGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
        }

        //this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.boxplot = BigDataBoxPlotGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataBubbleGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataBubbleGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataBubbleGenerator.prototype.constructor = BigDataBubbleGenerator;

    BigDataBubbleGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
        }

        this.setColorByParam();
        this.setSizeByParam();
    };

    BigDataBubbleGenerator.prototype.setSizeByParam = function () {
        var chartOptions = this.options.chartOptions.plotOptions.bubble;
        var param = this.fnUnit.param;

        if (chartOptions.sizeBy && chartOptions.sizeBy[0] && chartOptions.sizeBy[0].selected) {
            for (var i in chartOptions.sizeBy[0].selected) {
                if (chartOptions.sizeBy[0].selected[i] && chartOptions.sizeBy[0].selected[i].name) {
                    param['size-by'].push(chartOptions.sizeBy[0].selected[i].name);
                    param['aggregation'] = chartOptions.sizeBy[0].selected[0].aggregation;
                }
            }
        }else{
            param['size-by'] = [];
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.bubble = BigDataBubbleGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataCardGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataCardGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataCardGenerator.prototype.constructor = BigDataCardGenerator;

    BigDataCardGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.plotOptions.card && chartOptions.plotOptions.card.valueBy && chartOptions.plotOptions.card.valueBy[0] && chartOptions.plotOptions.card.valueBy[0].selected[0]) {
            param['value'] = [[chartOptions.plotOptions.card.valueBy[0].selected[0].name]];
            this.aggregation = chartOptions.plotOptions.card.valueBy[0].selected[0].aggregation;
        }

        this.setAggregationParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.card = BigDataCardGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataColumnGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataColumnGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataColumnGenerator.prototype.constructor = BigDataColumnGenerator;

    BigDataColumnGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.column = BigDataColumnGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataColumnStacked100Generator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataColumnStacked100Generator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataColumnStacked100Generator.prototype.constructor = BigDataColumnStacked100Generator;

    BigDataColumnStacked100Generator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setStackByParam();
    };

    BigDataColumnStacked100Generator.prototype.setStackByParam = function () {
        var chartOptions = this.options.chartOptions.plotOptions.column;
        var param = this.fnUnit.param;

        if (chartOptions.stackBy && chartOptions.stackBy[0] && chartOptions.stackBy[0].selected) {
            for (var i in chartOptions.stackBy[0].selected) {
                if (chartOptions.stackBy[0].selected[i] && chartOptions.stackBy[0].selected[i].name) {
                    param['color-by'].push(chartOptions.stackBy[0].selected[i].name);
                }
            }
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator['column-stacked-100'] = BigDataColumnStacked100Generator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataColumnStackedGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataColumnStackedGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataColumnStackedGenerator.prototype.constructor = BigDataColumnStackedGenerator;

    BigDataColumnStackedGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setStackByParam();
    };

    BigDataColumnStackedGenerator.prototype.setStackByParam = function () {
        var chartOptions = this.options.chartOptions.plotOptions.column;
        var param = this.fnUnit.param;

        if (chartOptions.stackBy && chartOptions.stackBy[0] && chartOptions.stackBy[0].selected) {
            for (var i in chartOptions.stackBy[0].selected) {
                if (chartOptions.stackBy[0].selected[i] && chartOptions.stackBy[0].selected[i].name) {
                    param['color-by'].push(chartOptions.stackBy[0].selected[i].name);
                }
            }
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator['column-stacked'] = BigDataColumnStackedGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataDonutGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataDonutGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataDonutGenerator.prototype.constructor = BigDataDonutGenerator;

    BigDataDonutGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.plotOptions.donut && chartOptions.plotOptions.donut.sizeBy && chartOptions.plotOptions.donut.sizeBy[0] && chartOptions.plotOptions.donut.sizeBy[0].selected[0]) {
            param['size-by'] = [chartOptions.plotOptions.donut.sizeBy[0].selected[0].name];
            this.aggregation = chartOptions.plotOptions.donut.sizeBy[0].selected[0].aggregation;
        }else{
            param['size-by'] = [[]];
        }

        this.setAggregationParam();
        this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.donut = BigDataDonutGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataHeatmapGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataHeatmapGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataHeatmapGenerator.prototype.constructor = BigDataHeatmapGenerator;

    BigDataHeatmapGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
        }

        this.setValueByParam();
        this.setAggregationParam();
    };

    BigDataHeatmapGenerator.prototype.setValueByParam = function () {
        var chartOptions = this.options.chartOptions.plotOptions.heatmap;
        var param = this.fnUnit.param;

        if (chartOptions.valueBy && chartOptions.valueBy[0] && chartOptions.valueBy[0].selected) {
            for (var i in chartOptions.valueBy[0].selected) {
                if (chartOptions.valueBy[0].selected[i] && chartOptions.valueBy[0].selected[i].name) {
                    param['value-by'].push(chartOptions.valueBy[0].selected[i].name);
                    this.aggregation = chartOptions.valueBy[0].selected[0].aggregation;
                }
            }
        }else{
            param['value-by'] = [];
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.heatmap = BigDataHeatmapGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataHeatmapMatrixGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataHeatmapMatrixGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataHeatmapMatrixGenerator.prototype.constructor = BigDataHeatmapMatrixGenerator;

    BigDataHeatmapMatrixGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected) {
            param['xcolumn'] = [];
            for (var i in chartOptions.xAxis[0].selected) {
                if (chartOptions.xAxis[0].selected[i] && chartOptions.xAxis[0].selected[i].name) {
                    param['xcolumn'].push([chartOptions.xAxis[0].selected[i].name]);
                }
            }
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[chartOptions.yAxis[0].selected[0].name]];
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator['heatmap-matrix'] = BigDataHeatmapMatrixGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataHistogramGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataHistogramGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataHistogramGenerator.prototype.constructor = BigDataHistogramGenerator;

    BigDataHistogramGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['column'] = this.options.chartOptions.xAxis[0].selected[0].name;
        }
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.histogram = BigDataHistogramGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataLineGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataLineGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataLineGenerator.prototype.constructor = BigDataLineGenerator;

    BigDataLineGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.line = BigDataLineGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataPieGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataPieGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataPieGenerator.prototype.constructor = BigDataPieGenerator;

    BigDataPieGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.plotOptions.pie && chartOptions.plotOptions.pie.sizeBy && chartOptions.plotOptions.pie.sizeBy[0] && chartOptions.plotOptions.pie.sizeBy[0].selected[0]) {
            param['size-by'] = [chartOptions.plotOptions.pie.sizeBy[0].selected[0].name];
            this.aggregation = chartOptions.plotOptions.pie.sizeBy[0].selected[0].aggregation;
        }else{
            param['size-by'] = [[]];
        }

        this.setAggregationParam();
        this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.pie = BigDataPieGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataROCCurveGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataROCCurveGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataROCCurveGenerator.prototype.constructor = BigDataROCCurveGenerator;

    BigDataROCCurveGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.roccurve = BigDataROCCurveGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataScatterGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataScatterGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataScatterGenerator.prototype.constructor = BigDataScatterGenerator;

    BigDataScatterGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.xAxis && chartOptions.xAxis[0] && chartOptions.xAxis[0].selected && chartOptions.xAxis[0].selected[0]) {
            param['xcolumn'] = [[this.options.chartOptions.xAxis[0].selected[0].name]];
        }

        if (chartOptions.yAxis && chartOptions.yAxis[0] && chartOptions.yAxis[0].selected && chartOptions.yAxis[0].selected[0]) {
            param['ycolumn'] = [[this.options.chartOptions.yAxis[0].selected[0].name]];
            this.aggregation = chartOptions.yAxis[0].selected[0].aggregation;
        }

        this.setAggregationParam();
        this.setColorByParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.scatter = BigDataScatterGenerator;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BigDataTreemapGenerator(options) {
        Brightics.VA.Core.Utils.FnUnitGenerator.call(this, options);
    }

    BigDataTreemapGenerator.prototype = Object.create(Brightics.VA.Core.Utils.FnUnitGenerator.prototype);
    BigDataTreemapGenerator.prototype.constructor = BigDataTreemapGenerator;

    BigDataTreemapGenerator.prototype.inputParams = function () {
        var param = this.fnUnit.param;
        var chartOptions = this.options.chartOptions;
        this.aggregation = '';

        if (chartOptions.plotOptions.treemap && chartOptions.plotOptions.treemap.hierarchyCol && chartOptions.plotOptions.treemap.hierarchyCol[0]) {
            param['hierarchy'] = [];
            for (var i in chartOptions.plotOptions.treemap.hierarchyCol[0].selected) {
                if (chartOptions.plotOptions.treemap.hierarchyCol[0].selected[i] && chartOptions.plotOptions.treemap.hierarchyCol[0].selected[i].name) {
                    param['hierarchy'].push([chartOptions.plotOptions.treemap.hierarchyCol[0].selected[i].name]);
                }
            }
        }
        
        if (chartOptions.plotOptions.treemap && chartOptions.plotOptions.treemap.sizeBy && chartOptions.plotOptions.treemap.sizeBy[0] && chartOptions.plotOptions.treemap.sizeBy[0].selected[0]) {
            param['size-by'] = [chartOptions.plotOptions.treemap.sizeBy[0].selected[0].name];
            this.aggregation = chartOptions.plotOptions.treemap.sizeBy[0].selected[0].aggregation;
        }

        this.setAggregationParam();
    };

    Brightics.VA.Core.Utils.FnUnitGenerator.treemap = BigDataTreemapGenerator;

}).call(this);
/**
 * Created by ng1123.kim on 2016-03-18.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BaseValidator(options) {
        this.options = options || {};
        this.FnUnitUtils = brtc_require('FnUnitUtils');
        this.init();
    }

    BaseValidator.prototype.init = function () {
        this.problemFactory = new Brightics.VA.Core.Validator.ProblemFactory();
        this.rule = [];

        this.initRules();
    };

    BaseValidator.prototype.validate = function (fnUnit, model) {
        var problemList = [];
        this.options.model = model;
        this.problemFactory.mid = model.mid;

        for (var i in this.rule) {
            var checkFunc = (this.rule[i]).bind(this);
            var problem = checkFunc(fnUnit);
            if (problem) problemList = problemList.concat(problem);
        }

        return problemList;
    };

    BaseValidator.prototype.isEmptyForObject = function (object) {
        var keys = Object.keys(object);
        if (keys == 0) return true;
        return false;
    };


    BaseValidator.prototype.isEmptyForArray = function (arrayValue) {
        if (arrayValue[0]) {
            if (arrayValue[0].constructor == Array) {
                if ((arrayValue[0])[0]) return false;
                return true;
            } else {
                if (arrayValue[0]) return false;
                return true;
            }
        } else {
            return true;
        }
    };

    BaseValidator.prototype.isEmptyForString = function (stringValue) {
        if (stringValue) return false;
        return true;
    };

    BaseValidator.prototype.isConnectedWithPrev = function (fnUnit, inputCount) {
        var count = 1;
        if (inputCount) count = inputCount;
        var model = fnUnit.parent();

        if (model.getPrevious(fnUnit.fid).length === count) return true;
        return false;
    };

    BaseValidator.prototype.initRules = function () {

    };

    BaseValidator.prototype.addRule = function (func) {
        if (func) this.rule.push(func);
    };

    BaseValidator.prototype.isUndefinedForArray = function (arrayValue) {
        if (typeof arrayValue[0] !== 'undefined') {
            if (arrayValue[0].constructor == Array) {
                if (typeof  (arrayValue[0])[0] === 'undefined') return true;
            }
        } else {
            return true;
        }
        return false;
    };

    BaseValidator.prototype.checkLinkIsConnected = function (fnUnit) {
        if (this.FnUnitUtils.hasMeta(fnUnit)) {
            if (!this.FnUnitUtils.hasInput(fnUnit)) return;

            var hasProblem = false;
            var inputs = this.FnUnitUtils.getInputs(fnUnit);
            var messageInfo;
            for (var key in inputs) {
                if (_.isEmpty(inputs[key])) {
                    messageInfo = {
                        errorCode: 'BR-0059',
                        messageParam: ['Inputs', this.FnUnitUtils.getTotalInRangeCount(fnUnit).min]
                    };
                }
            }

            if (!_.isEmpty(messageInfo)) {
                return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        } else {
            if (!this.FnUnitUtils.getInTable(fnUnit)) return;

            var clazz = fnUnit.parent().type;
            var defFuncInRange = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func)['in-range'];
            var inTableLength = this.FnUnitUtils.getInTable(fnUnit).length;
    
            var messageInfo;
            if (defFuncInRange.min === defFuncInRange.max && defFuncInRange.min != inTableLength) {
                messageInfo = {
                    errorCode: 'BR-0059',
                    messageParam: ['Inputs', defFuncInRange.min]
                };
            } else if (defFuncInRange.min !== defFuncInRange.max) {
                if (inTableLength < defFuncInRange.min) {
                    messageInfo = {
                        errorCode: 'BR-0024',
                        messageParam: ['Inputs', defFuncInRange.min]
                    };
                } else if (inTableLength > defFuncInRange.max) {
                    messageInfo = {
                        errorCode: 'BR-0022',
                        messageParam: ['Inputs', defFuncInRange.max]
                    };
                }
            }
    
            if (messageInfo) {
                return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        }
    };
    /**
     * @deprecated use emptyLinkRule
     */
    BaseValidator.prototype.inputLinkRule = function () {
        this.addRule(function (fnUnit) {
            var messageInfo = {
                errorCode: 'EL001',
                messageParam: [fnUnit.display.label]
            };
            if (!this._hasPrevious(fnUnit)) return this.problemFactory.createProblem(messageInfo, fnUnit);
        });
    };

    BaseValidator.prototype.emptyColumnsRule = function (paramKey, label) {
        this.addRule(function (fnUnit) {
            var checkInfo = {
                errorCode: 'BR-0033',
                param: paramKey,
                messageParam: [label]
            };

            if (this.isEmptyForArray(fnUnit.param[paramKey])) return this.problemFactory.createProblem(checkInfo, fnUnit);
        });
    };

    BaseValidator.prototype.notExistColumnRule = function (paramKey) {
        this.addRule(function (fnUnit) {
            var schema = Brightics.VA.Core.DataQueryTemplate.getSchema(fnUnit.parent().mid, this.FnUnitUtils.getInTable(fnUnit));
            if (typeof schema === 'undefined') return;

            var checkInfo = {
                errorCode: 'EI001',
                param: paramKey,
                messageParam: []
            };

            var massageParamsLabel = [];
            var columns = fnUnit.param[paramKey][0];
            if (columns.length === 0) return;
            for (var i in columns) {
                var column = columns[i];
                var contains = false;

                for (var j in schema) {
                    if (schema[j].name == column) {
                        contains = true;
                        break;
                    }
                }
                if (!contains) {
                    massageParamsLabel.push('[' + column + ']');
                }

            }
            if (massageParamsLabel.length > 0) {
                checkInfo.messageParam = [massageParamsLabel];
                return this.problemFactory.createProblem(checkInfo, fnUnit);
            }


        });
    };

    BaseValidator.prototype.invalidColumnTypeRule = function (paramKey, type, label) {
        this.addRule(function (fnUnit) {
            var checkInfo = {
                errorCode: 'ET002',
                param: paramKey,
                messageParam: [label]
            };

            var invalidColumnProblems = [];

            var schema = Brightics.VA.Core.DataQueryTemplate.getSchema(fnUnit.parent().mid, this.FnUnitUtils.getInTable(fnUnit));

            var columns = fnUnit.param[paramKey][0];
            if (columns.length === 0) return;

            for (var i in columns) {
                var isValidColumn = false;

                if (schema === undefined) return;
                else {
                    for (var j in schema) {
                        if (columns[i] === schema[j].name && type === schema[j].type) {
                            isValidColumn = true;
                            break;
                        }
                    }
                }
                if (!isValidColumn) invalidColumnProblems.push(this.problemFactory.createProblem(checkInfo, fnUnit));
            }

            return invalidColumnProblems;
        });
    };

    BaseValidator.prototype.emptyProblemMessage = function (fnUnit, paramKey, checkData, label) {
        var checkInfo = {
            errorCode: 'BR-0033',
            param: paramKey,
            messageParam: [label ? label : paramKey]
        };
        if (this.isEmptyForString(checkData)) return this.problemFactory.createProblem(checkInfo, fnUnit);
    };

    BaseValidator.prototype.emptyNumberRule = function (paramKey, checkData) {
        var _this = this;
        this.addRule(function (fnUnit) {
            _this.emptyProblemMessage(fnUnit, paramKey, checkData);
        });
    };

    BaseValidator.prototype.emptyStringRule = function (paramKey, checkData) {
        var _this = this;
        this.addRule(function (fnUnit) {
            _this.emptyProblemMessage(fnUnit, paramKey, checkData);
        });
    };

    BaseValidator.prototype.emptyComboBoxRule = function (paramKey, checkData) {
        var _this = this;
        this.addRule(function (fnUnit) {
            _this.emptyProblemMessage(fnUnit, paramKey, checkData);
        });
    };

    BaseValidator.prototype.equalColumnInDataRule = function (paramKey, label) {
        this.addRule(function (fnUnit) {
            var checkInfo = {
                errorCode: 'EE007',
                param: paramKey,
                messageParam: [label]
            };

            var equalColumnProblems = [];

            var schema = Brightics.VA.Core.DataQueryTemplate.getSchema(fnUnit.parent().mid, this.FnUnitUtils.getInTable(fnUnit));

            var columns = fnUnit.param[paramKey][0];
            if (columns.length === 0) return;

            for (var i in columns) {
                var isEqualColumn = false;

                for (var j in schema) {
                    if (columns[i] === schema[j].name) {
                        isEqualColumn = true;
                        break;
                    }
                }
                if (!isEqualColumn) equalColumnProblems.push(this.problemFactory.createProblem(checkInfo, fnUnit));
            }

            return equalColumnProblems;
        });
    };

    BaseValidator.prototype.addNewColumnNameRule = function (paramKey) {
        var _this = this;
        this.addRule(function (fnUnit) {
            if (_this._hasPrevious(fnUnit)) {
                if (!fnUnit.param[paramKey]) return;

                var messageInfo = {
                    errorCode: 'BR-0045',
                    param: paramKey,
                    messageParam: [fnUnit.param[paramKey]]
                };

                if (fnUnit.param[paramKey].constructor == Array) {
                    var problems = [];
                    for (var k in fnUnit.param[paramKey]) {
                        if (!fnUnit.param[paramKey][k]) continue;
                        if (!(Brightics.VA.Core.Utils.InputValidator.isValid.columnNameType(fnUnit.param[paramKey][k]))) {
                            messageInfo.paramIndex = k;
                            problems.push(this.problemFactory.createProblem(messageInfo, fnUnit));
                        }
                    }
                    return problems;
                } else {
                    if (!(Brightics.VA.Core.Utils.InputValidator.isValid.columnNameType(fnUnit.param[paramKey]))) {
                        return this.problemFactory.createProblem(messageInfo, fnUnit);
                    }
                }
            }
        });
    };

    BaseValidator.prototype.addBaseGroupByRule = function (columnsParam, columnsLabel, groupbyParam) {
        var _this = this;
        if (!columnsParam) return;
        groupbyParam = groupbyParam || 'groupby';

        this.addRule(function (fnUnit) {
            var schema = Brightics.VA.Core.DataQueryTemplate.getSchema(fnUnit.parent().mid, this.FnUnitUtils.getInTable(fnUnit)[0]);
            if (typeof schema === 'undefined') return;

            var overlappedColumns = [], targetColumns;
            var groupbyColumns = fnUnit.param[groupbyParam];

            if (fnUnit.param[columnsParam].constructor === Array) {
                targetColumns = fnUnit.param[columnsParam][0];
                if (targetColumns && targetColumns.length) {
                    for (var i in groupbyColumns) {
                        if (targetColumns.indexOf(groupbyColumns[i]) > -1) {
                            overlappedColumns.push(groupbyColumns[i]);
                        }
                    }
                }
            } else if (fnUnit.param[columnsParam].constructor === String) {
                targetColumns = fnUnit.param[columnsParam];
                if (targetColumns) {
                    for (var j in groupbyColumns) {
                        if (targetColumns === groupbyColumns[j]) {
                            overlappedColumns.push(groupbyColumns[j]);
                        }
                    }
                }
            }

            if (overlappedColumns.length) {
                var messageInfo = {
                    errorCode: 'BR-0057',
                    param: groupbyParam
                };

                if (overlappedColumns.length == 1) messageInfo.messageParam = [overlappedColumns[0], columnsLabel, 'Group By'];
                else messageInfo.messageParam = [JSON.stringify(overlappedColumns), columnsLabel, 'Group By'];

                return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        });
    };

    BaseValidator.prototype._isEmptyArray = function (value) {
        return !value[0];
    };

    BaseValidator.prototype._isEmptyString = function (value) {
        return !value;
    };

    BaseValidator.prototype._hasPrevious = function (fnUnit) {
        return fnUnit.parent().getPrevious(fnUnit.fid).length !== 0;
    };

    BaseValidator.prototype._hasIntables = function (fnUnit) {
        if (this.FnUnitUtils.getInTable(fnUnit) && this.FnUnitUtils.getInTable(fnUnit).length > 0) {
            return true;
        } else {
            return false;
        }
    };

    BaseValidator.prototype._checkStringIsEmpty = function (messageInfo, fnUnit, value) {
        if (this._isEmptyString(value)) return this.problemFactory.createProblem(messageInfo, fnUnit);
    };

    BaseValidator.prototype._checkArrayIsEmpty = function (messageInfo, fnUnit, value) {
        if (!value || this._isEmptyArray(value)) return this.problemFactory.createProblem(messageInfo, fnUnit);
    };

    BaseValidator.prototype._checkArrayIsCompact = function (messageInfo, fnUnit, value,
            label, type) {
        const isValid = (v) => {
            if (type === 'String') return !!v;
            // Integer or Double ??
            return !_.isNull(v) && !_.isUndefined(v);
        };
        if (!value ||
                !Array.isArray(value) ||
                !value.every(isValid)) {
            return this.problemFactory.createProblem(messageInfo, fnUnit);
        }
    };

    BaseValidator.prototype.getArrayConflicted = function (base /*, array2, array3, ... */) {
        var comparisonTarget = [];
        for (var i = 1; i < arguments.length; i++) {
            if ($.isArray(arguments[i])) comparisonTarget = comparisonTarget.concat(arguments[i]);
        }
        $.unique(comparisonTarget);

        return $.grep(base, function (value, index) {
            return (value !== '') ? ($.inArray(value, comparisonTarget) !== -1) : (false);
        });
    };

    BaseValidator.prototype.createProblemForConflicted = function (conflicted, param, label1, label2, fnUnit) {
        if ($.isArray(conflicted) && conflicted.length) {
            var messageInfo;
            if (conflicted.length == 1) {
                messageInfo = {
                    errorCode: 'BR-0057',
                    param: param,
                    messageParam: [conflicted[0], label1, label2]
                };
            } else {
                messageInfo = {
                    errorCode: 'BR-0057',
                    param: param,
                    messageParam: [JSON.stringify(conflicted), label1, label2]
                };
            }
            return this.problemFactory.createProblem(messageInfo, fnUnit);
        }
    };

    Brightics.VA.Core.Validator.BaseValidator = BaseValidator;

}).call(this);
/**
 * Created by ng1123.kim on 2016-03-18.
 */
(function () {
        'use strict';

        var root = this;
        var Brightics = root.Brightics;

        function SingleInputValidator() {
            Brightics.VA.Core.Validator.BaseValidator.call(this);
        }

        SingleInputValidator.prototype = Object.create(Brightics.VA.Core.Validator.BaseValidator.prototype);
        SingleInputValidator.prototype.constructor = SingleInputValidator;

        SingleInputValidator.prototype.initRules = function () {
            this.addLinkRule();
            this.addInTableRule();
        };

        SingleInputValidator.prototype.addLinkRule = function () {
            var _this = this;
            this.addRule(function (fnUnit) {
                return _this.checkLinkIsConnected(fnUnit);
            });
        };

        SingleInputValidator.prototype.addInTableRule = function () {
            var _this = this;
            this.addRule(function (fnUnit) {
                return _this.checkInTableIsEmpty(fnUnit);
            });
        };

        SingleInputValidator.prototype.checkInTableIsEmpty = function (fnUnit) {
            var messageInfo = {
                    errorCode: 'BR-0138',
                    // param: 'inData',
                    messageParam: []
                },
                previous = fnUnit.parent().getFnUnitById(fnUnit.parent().getPrevious(fnUnit.fid)[0]);

            if (!this._hasIntables(fnUnit)) return;
            if (!this._getSchema(fnUnit) || (this._getSchema(fnUnit).length === 0)) {
                messageInfo.messageParam.push(previous.display.label);
                return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        };

        /**
         *
         * @param fnUnit
         * @param param
         * @param value columns (array || string)
         * @param messageParam
         * @returns {{level, mid, fid, param, paramIndex, code, message}}
         */
        SingleInputValidator.prototype.checkColumnIsEmpty = function (fnUnit, param, value, messageParam, index) {
            if (!this._hasSchema(fnUnit)) return;

            var empty = true;
            JSON.stringify(value, function (k, v) {
                if (typeof v === 'string' && v.length > 0) {
                    empty = false;
                } else {
                    return v;
                }
            });
            if (empty) {
                var messageInfo = {
                    errorCode: 'BR-0033',
                    param: param,
                    messageParam: [messageParam],
                    paramIndex: index
                };
                return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        };

        SingleInputValidator.prototype.checkColumnExists = function (fnUnit, param, value, index) {
            if (!this._hasSchema(fnUnit, index)) return;

            var columnNames = [];
            JSON.stringify(value, function (k, v) {
                if (typeof v === 'string' && v.length > 0) {
                    columnNames.push(v);
                } else {
                    return v;
                }
            });
            if (columnNames.length == 0) return;

            var schema = this._getSchema(fnUnit, index || 0);
            var existingNames = $.map(schema, function (item) {
                return item.name;
            });

            var invalidNames = [];
            for (var i in columnNames) {
                if ($.inArray(columnNames[i], existingNames) < 0) {
                    invalidNames.push(columnNames[i]);
                }
            }
            if (invalidNames.length > 0) {

                var errorCode = 'BR-0001';
                // if (invalidNames.length === 1) {
                //     errorCode = 'BR-0001';
                // } else {
                //     errorCode = 'BR-0000';
                // }

                var messageInfo = {
                    errorCode: errorCode,
                    param: param,
                    messageParam: [invalidNames.join(', ')]
                };
                return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        };

        SingleInputValidator.prototype.checkColumnType = function (fnUnit, param, value, type, index) {
            if (!this._hasSchema(fnUnit)) return;

            var columnNames = [];
            JSON.stringify(value, function (k, v) {
                if (typeof v === 'string' && v.length > 0) {
                    columnNames.push(v);
                } else {
                    return v;
                }
            });
            if (columnNames.length == 0) return;

            var availableTypes = Array.isArray(type) ? type : [type];
            var schema = this._getSchema(fnUnit, index || 0);
            var invalidNames = [];
            for (var i in columnNames) {
                $.each(schema, function (index, column) {
                    if (columnNames[i] == column.name && ($.inArray(column.type, availableTypes) < 0 && $.inArray(column.internalType, availableTypes) < 0)) {
                        invalidNames.push(columnNames[i]);
                        return false;
                    }
                });
            }

            if (invalidNames.length > 0) {
                var messageInfo = {
                    errorCode: 'BR-0002',
                    param: param,
                    messageParam: [invalidNames.join(', '), type]
                };

                return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        };

        SingleInputValidator.prototype.checkSingleNumberArray = function (fnUnit, param, columns, index) {
            var schema = this._getSchema(fnUnit, index || 0),
                _numberArrayTypeCnt = 0,
                messageInfo = {
                    errorCode: 'ET006',
                    param: param,
                    messageParam: []
                };

            for (var i in columns) {
                for (var j in schema) {
                    if (columns[i] === schema[j].name) {
                        if (schema[j].type.toLowerCase() === 'number[]') {
                            _numberArrayTypeCnt++;
                            break;
                        }
                    }
                }
            }

            if (_numberArrayTypeCnt > 1) return this.problemFactory.createProblem(messageInfo, fnUnit);
        };

        SingleInputValidator.prototype.checkSingleColumnType = function (fnUnit, param, columns, types, index) {
            var schema = this._getSchema(fnUnit, index || 0),
                messageInfo = {
                    errorCode: 'ET009',
                    param: param,
                    messageParam: [types.join(', ')]
                };

            var columnsCount = columns.length;
            var _typeCount = 0;
            for (var i in columns) {
                for (var j in schema) {
                    if (columns[i] === schema[j].name) {
                        var found = false;
                        for (var k in types) {
                            if (schema[j].type === types[k] || schema[j].internalType === types[k]) {
                                _typeCount++;
                                found = true;
                                break;
                            }
                        }
                        if (found) break;
                    }
                }
            }

            if (columnsCount > 1 && _typeCount != 0) return this.problemFactory.createProblem(messageInfo, fnUnit);
        };

        SingleInputValidator.prototype.checkNumberArray = function (fnUnit, param, columns, index) {
            var schema = this._getSchema(fnUnit, index || 0),
                _numberTypeCnt = 0,
                _numberArrayTypeCnt = 0,
                messageInfo = {
                    errorCode: 'ET005',
                    param: param,
                    messageParam: []
                };

            for (var i in columns) {
                for (var j in schema) {
                    if (columns[i] === schema[j].name) {
                        if (schema[j].type.toLowerCase() === 'number') {
                            _numberTypeCnt++;
                            break;
                        } else if (schema[j].type.toLowerCase() === 'number[]') {
                            _numberArrayTypeCnt++;
                            break;
                        }
                    }
                }
            }

            if (_numberTypeCnt * _numberArrayTypeCnt > 0) return this.problemFactory.createProblem(messageInfo, fnUnit);
        };

        SingleInputValidator.prototype.checkNewColumnName = function (fnUnit, param, newColumnName) {
            if (!this._hasSchema(fnUnit)) return;
            if (!newColumnName) return;

            var messageInfo = {
                errorCode: 'BR-0045',
                param: param,
                messageParam: []
            };

            if (!(Brightics.VA.Core.Utils.InputValidator.isValid.columnNameType(newColumnName))) {
                return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        };

        SingleInputValidator.prototype._getSchema = function (fnUnit, index) {
            // var schema = Brightics.VA.Core.DataQueryTemplate.getSchema(fnUnit.parent().mid, fnUnit[IN_DATA][index || 0]);
            var schema = Brightics.VA.Core.DataQueryTemplate.getSchema(fnUnit.parent().mid, this.FnUnitUtils.getInTable(fnUnit)[index || 0]);
            if (schema && schema.length === 0) schema = undefined;
            return schema;
        };

        SingleInputValidator.prototype._hasSchema = function (fnUnit, index) {
            return this._getSchema(fnUnit, index);
        };

        Brightics.VA.Core.Validator.SingleInputValidator = SingleInputValidator;

    }
).call(this);
/**
 * Created by ng1123.kim on 2016-03-18.
 */
(function () {
        'use strict';

        var root = this;
        var Brightics = root.Brightics;

        function PairInputValidator() {
            Brightics.VA.Core.Validator.SingleInputValidator.call(this);
        }

        PairInputValidator.prototype = Object.create(Brightics.VA.Core.Validator.SingleInputValidator.prototype);
        PairInputValidator.prototype.constructor = PairInputValidator;

        PairInputValidator.prototype.initRules = function () {
            Brightics.VA.Core.Validator.SingleInputValidator.prototype.initRules.call(this);
        };

        PairInputValidator.prototype.checkInTableIsEmpty = function (fnUnit, numOfInTable) {
            var messageInfo = {
                errorCode: 'BR-0138',
                messageParam: [[]]
            };

            numOfInTable = (typeof numOfInTable == 'undefined' || typeof numOfInTable != 'number') ? 2 : numOfInTable;
            if (this.FnUnitUtils.getInTable(fnUnit).length !== numOfInTable) return;
            else {
                var prevFnUnit;
                for (var i = 0; i < numOfInTable; i++) {
                    prevFnUnit = fnUnit.parent().getFnUnitByOutTable(this.FnUnitUtils.getInTable(fnUnit)[i]);
                    if (!this._getSchema(fnUnit, i))  messageInfo.messageParam[0].push('[' + prevFnUnit.display.label + ']');
                }

                if (messageInfo.messageParam[0].length > 0) return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        };

        PairInputValidator.prototype._hasSchema = function (fnUnit) {
            return this._getSchema(fnUnit, 0) && this._getSchema(fnUnit, 1);
        };

        Brightics.VA.Core.Validator.PairInputValidator = PairInputValidator;

    }
).call(this);
/**
 * Created by ng1123.kim on 2016-03-18.
 */
(function () {
        'use strict';

        var root = this;
        var Brightics = root.Brightics;

        function MultiInputValidator() {
            Brightics.VA.Core.Validator.SingleInputValidator.call(this);
        }

        MultiInputValidator.prototype = Object.create(Brightics.VA.Core.Validator.SingleInputValidator.prototype);
        MultiInputValidator.prototype.constructor = MultiInputValidator;

        MultiInputValidator.prototype.initRules = function () {
            Brightics.VA.Core.Validator.SingleInputValidator.prototype.initRules.call(this);
        };

        MultiInputValidator.prototype.checkInTableIsEmpty = function (fnUnit) {
            var messageInfo = {
                    errorCode: 'BR-0138',
                    // param: 'inData',
                    messageParam: [[]]
                },
                previous = fnUnit.parent().getPrevious(fnUnit.fid);

            var clazz = fnUnit.parent().type;
            var defFuncInRange = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func)['in-range'];
            var currentLink = fnUnit.parent().getPrevious(fnUnit.fid);
            if (currentLink.length > defFuncInRange.max || currentLink.length < defFuncInRange.min) return;
            else {
                for(var i = 0; i < previous.length; i ++){
                    var previousFnUnit = fnUnit.parent().getFnUnitById(previous[i]);
                    if (!this._getSchema(fnUnit, i))  messageInfo.messageParam[0].push('[' + previousFnUnit.display.label + ']');
                }
                if (messageInfo.messageParam[0].length > 0) return this.problemFactory.createProblem(messageInfo, fnUnit);
            }
        };

        Brightics.VA.Core.Validator.MultiInputValidator = MultiInputValidator;

    }
).call(this);
/**
 * Created by ng1123.kim on 2016-03-18.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ProblemFactory() {
        this.initRule();
    }

    ProblemFactory.prototype.initRule = function () {
        this.rule = {
            //필수값(empty) 체크
            EE001: {
                level: 'error',
                message: '"[0]" field is required.'
            },
            //Param Index 값 체크 ex) columns의 3번째 값[columns, 3]
            EE002: {
                level: 'error',
                message: 'Please check out [1]th value of "[0]".'
            },
            //Param Index 값 체크 ex) columns의 첫번째 row의 3번째 값[columns, 1, 3]
            EE003: {
                level: 'error',
                message: 'Please check out [1] row [2]th value of [[0]].'
            },
            //필수값(invalid) 체크
            EE004: {
                level: 'error',
                message: 'Must be valid "[0]"'
            },
            EE005: {
                level: 'error',
                message: 'One of the "[0]" and "[1]" fields are required.'
            },
            EE006: {
                level: 'error',
                message: 'One or more "[0]" tables are required.'
            },
            EE007: {
                level: 'error',
                message: 'Must be different "[0]" from columnName of In-Data' //새로운 컬럼명은 in-data의 컬럼명들과 다른 컬럼명이 요구된다.
            },
            EE009: {
                level: 'error',
                message: 'More than [0] [1] values is required.'
            },
            EE010: {
                level: 'error',
                message: '"[0]", "[1]" are required.'
            },
            //Column 중복체크
            EE011: {
                level: 'error',
                message: 'This column "[0]" already exists in other parameter.'
            },
            EE012: {
                level: 'error',
                message: 'The number of columns must be two.'
            },
            EE013: {
                level: 'error',
                message: 'This column "[0]" duplicates the selection in Columns above.'
            },
            EE014: {
                level: 'error',
                message: 'This column "[0]" is not allowed.'
            },
            ////값 비교 -->사용안함. ==> NGram에서 사용
            EC001: {
                level: 'error',
                message: '[0] must greater than or equals to [1]'
            },
            ////값 비교 ==> LinUCB에서 사용
            EC002: {
                level: 'error',
                message: '"[0]" must be less than "[1]".'
            },
            ////값 비교 ==> Greater than
            EC003: {
                level: 'error',
                message: '"[0]" must be greater than "[1]"'
            },
            //링크 에러
            EL001: {
                level: 'error',
                message: 'Link connection is required.'
            },
            //링크 에러 2개 이상의 Connection이 존재해야 하는 경우
            EL002: {
                level: 'error',
                message: '"[0]" requires two in-tables.'
            },
            //링크 에러 특정함수로 돌린 outData가 연결되야 하는 경우 ex) prediction 함수는 right table이 항상 train함수 결과값이어야 함
            EL003: {
                level: 'error',
                message: '"[0]" must be equal to "[1]".'
            },
            EL004: {
                level: 'error',
                message: 'The column is invalid in [[0]].'//'[[0]] columns must be equal to "[1]".'
            },
            //링크 에러 2개 이상의 Connection이 존재해야 하는 경우
            EL006: {
                level: 'error',
                message: '"[0]" is required more than two link connections.'
            },
            //링크 에러 2개 이상의 Connection이 존재해야 하는 경우
            EL007: {
                level: 'error',
                message: '"[0]" is required more than three link connections.'
            },
            //링크 에러 2개 이상의 Connection이 존재해야 하는 경우
            EL008: {
                level: 'error',
                message: '"[0]" is required three link connections.'
            },//Input 타입 체크
            ET001: {
                level: 'error',
                message: '"[0]" contains invalid characters.'
            },
            //Column 타입 체크
            ET002: {
                level: 'error',
                message: '[[0]] type is invalid.'
            },
            ET003: {
                level: 'error',
                message: '[0] type is invalid.'
            },
            ET004: {
                level: 'error',
                message: '[0] is invalid operator.'
            },
            ET005: {
                level: 'error',
                message: 'number only or number[] only.'
            },
            ET006: {
                level: 'error',
                message: 'only one number[] type column is allowed.'
            },
            ET007: {
                level: 'error',
                message: 'only one string type column is allowed.'
            },
            ET008: {
                level: 'error',
                message: 'only one column is allowed.'
            },
            ET009: {
                level: 'error',
                message: 'Only one column is allowed if column type is one of ([0]).'
            },
            //범위체크
            ER001: {
                level: 'error',
                message: '[0]'
            },
            //Column 유무 체크
            EX001: {
                level: 'error',
                message: '[[0]] does not exist.'
            },
            //유무 체크
            EX002: {
                level: 'error',
                message: '"[0]" does not exist.'
            },
            //유무 체크
            EX003: {
                level: 'error',
                message: '"[0]" already exists.'
            },
            EX004: {
                level: 'error',
                message: '"[0]" already exists in previous.'
            },
            EX005: {
                level: 'error',
                message: '"[0]" does not exist in previous.'
            },
            //Input 체크
            WI001: {
                level: 'warning',
                message: 'Input from [0] does not exist.'
            },
            WI002: {
                level: 'warning',
                message: 'Input from [[0]] does not exist.'
            },
            // Column Name 체크
            EN001: {
                level: 'error',
                message: 'If the column name begins with _ or is only a number, it may be a problem in some functions later.'
            },
            // Data Duplicated 체크 //Frequency
            ED001: {
                level: 'error',
                message: '"[0]" column is already chosen for "[1]" parameter.'
            },
            // GroupBy 체크 //Outlier Removal
            ED002: {
                level: 'error',
                message: '[[0]] column is already chosen for "[1]" parameter.'
            },
            ED003: {
                level: 'error',
                message: '[0] Change Name field is no changed.'
            },
            ED004: {
                level: 'error',
                message: '[0] columns are already chosen for "[1]" parameter.'
            },
            EP001: {
                level: 'error',
                message: '"[0]" must start with "/shared/upload" or "/{userid}/upload".'
            },
            EP002: {
                level: 'error',
                message: '"[0]" can not start with "/shared/upload" or "/{userid}/upload".'
            },
            EF001: {
                level: 'error',
                message: 'This UDF[[0]] is not available.'
            },
            EF002: {
                level: 'error',
                message: 'This function[[0]] is not available.'
            },
            'BR-0113': {
                level: 'error',
                message: 'Data Flow does not exist.'
            },
            EI001: {
                level: 'error',
                message: 'Model does not exist.'
            },
            EI002: {
                level: 'warning',
                message: 'Model specification is changed.'
            }
        };
    };


    /*
     Required "Please enter a value"

     Invalid Column Type "Please enter a correct format"

     invalid value "Please enter a value less than or equal to {0}."

     invalid value "Please enter a value greater than or equal to {0}."

     invalid value "Please enter a value between {0} and {1}."

     invalid value "Please enter a value between {0} and {1} characters long."

     already in use "Please enter a valid value"

     Disconnected link "Please check out {0} link connection"

     invalid character "Please enter valid character"

     Do not exist "Please check out the input data"

     */


    ProblemFactory.prototype.createProblem = function (checkResult, fnUnit) {
        var _this = this;
        if (checkResult) {
            checkResult.messageParam = this._createMessageParam(fnUnit, checkResult.messageParam);
            return {
                // level: _this.rule[checkResult.errorCode].level,
                mid: _this.mid, //fnUnit.parent().mid,
                fid: fnUnit.fid,
                param: checkResult.param,
                paramIndex: checkResult.paramIndex,
                code: checkResult.errorCode,
                message: _this.makeMessage(checkResult),
                mode: checkResult.mode
            };
        }
    };

    ProblemFactory.prototype._createMessageParam = function (fnUnit, messageParam) {
        if (fnUnit && typeof fnUnit.parent === 'function' && typeof fnUnit.parent().getFnUnitNameById === 'function') {
            var funcName = fnUnit.parent().getFnUnitNameById(fnUnit.fid);
            return Brightics.VA.Core.Utils.MessageUtils.getFunctionLabels(funcName, messageParam);
        } else {
            return messageParam;
        }
    };


    ProblemFactory.prototype.makeMessage = function (checkResult) {
        if (this.rule[checkResult.errorCode]) {
            return this._createMessage(checkResult);
        }
        var message = Brightics.VA.Core.Utils.MessageUtils.getMessage(checkResult.errorCode, checkResult.messageParam);
        if (message) return message;
    };

    ProblemFactory.prototype._createMessage = function (checkResult) {
        console.warn('This Error Code[' + checkResult.errorCode + '] should be deprecated');

        var originMessage = this.rule[checkResult.errorCode].message;
        for (var i in checkResult.messageParam) {
            var messageparam = checkResult.messageParam[i];
            if (originMessage.indexOf('%s') < 0) {
                var indexStr = '[' + i + ']';
                if (typeof messageparam == 'number') messageparam = String(messageparam);
                originMessage = originMessage.replace(indexStr, messageparam);
            } else {
                originMessage = originMessage.replace('%s', messageparam);
            }

        }
        return originMessage;
    };


    Brightics.VA.Core.Validator.ProblemFactory = ProblemFactory;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Editor(parentId, options) {
        this.parentId = parentId;
        this.options = options;

        _retrieveParent.bind(this)();

        this.init();
        this.createControls.bind(this)();

        this.modelLayoutManager = new Brightics.VA.Core.Interface.ModelLayoutManager[this.options.clazz](this);
        this.sideBarManager = new Brightics.VA.Core.Interface.SideBarManager[this.options.clazz](this);

        this.modelLayoutManager.initEditorSelectionChangeListener();
        this.modelLayoutManager.adjustLayout();
    }

    var _retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    Editor.prototype.init = function () {
        this.StatusBoard = brtc_require('StatusBoard');
    };

    Editor.prototype.checkInfo = function () {
        if (!_.isEqual(localStorage.getItem('info.script.show'), 'false')) {
            this.openScriptInfoDialog();
        }
    };

    Editor.prototype.openScriptInfoDialog = function () {
        new Brightics.VA.Core.Dialogs.ScriptInfoDialog(this.$mainControl, {
            type: 'warn',
            modal: true,
            isCancel: false
        });
    };

    Editor.prototype.createControls = function () {
        console.error('createControls must be implemented');
    };

    Editor.prototype.save = function (command, modelDiff) {
        var _this = this;
        var fileInput = this.options.editorInput;

        fileInput.setUpdater(Brightics.VA.Env.Session.userId);
        delete fileInput.getContents().problemList;

        var saveFile = (function (diff) {
            if (diff) {
                return Studio.getResourceManager()
                    .saveFile(fileInput.getProjectId(), fileInput, diff);
            } else {
                return Studio.getResourceManager()
                    .updateFile(fileInput.getProjectId(), fileInput);
            }
        }(modelDiff));

        saveFile
            .catch(function (err) {
                var errCode = _this.getPrimaryErrorCode(err);
                if (errCode == 32031) {
                    Studio.getLayoutManager().closeEditor(fileInput);
                }
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err, function () {
                    if (errCode == 32031) {
                        Studio.getResourceManager()
                            .fetchFile(fileInput.getProjectId(), fileInput.getFileId())
                            .then(function (file) {
                                Studio.getInstance().reloadResource(function () {
                                    Studio.getLayoutManager().openEditor(file);
                                });
                            })
                            .catch(function (err) {
                                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                            });
                    }
                });
            });
    };

    Editor.prototype.getPrimaryErrorCode = function (err) {
        var json = err.responseJSON;
        if (json && json.errors && json.errors.length > 0) {
            return json.errors[0].code;
        }
    };

    Editor.prototype.initEditorSelectionChangeListener = function () {
        var _this = this;
        this.$mainControl.bind('editorSelectionChanged', function (event, selection) {
            _this.getModelLayoutManager().handleEditorSelectionChange(selection);
        });
    };

    Editor.prototype.initUDFChangeListener = function () {
    };

    Editor.prototype.fireUDFChanged = function (selection) {
    };

    Editor.prototype.setSelection = function (selection) {
    };

    Editor.prototype.addToLibrary = function (template) {
    };

    Editor.prototype.addToClipboard = function (template) {
    };

    Editor.prototype.resize = function () {
    };

    Editor.prototype.createToolbar = function () {
        if (Brightics.VA.Core.Interface.Toolbar[this.options.clazz]
            && typeof Brightics.VA.Core.Interface.Toolbar[this.options.clazz] === 'function') {
            this.toolbar =
                new Brightics.VA.Core.Interface.Toolbar[this.options.clazz](
                    this.$mainControl.find('.brtc-style-editor-toolbar-area'),
                    {editor: this}
                );
        }
    };

    Editor.prototype.destroy = function () {
        console.error('destroy must be implemented.');
    };

    Editor.prototype.getToolbar = function () {
        return this.toolbar;
    };

    Editor.prototype.getModelLayoutManager = function () {
        return this.modelLayoutManager;
    };

    Editor.prototype.getSideBarManager = function () {
        return this.sideBarManager;
    };

    Editor.prototype.getMainArea = function () {
        console.error('getMainArea must be implemented.');
    };

    Editor.prototype.getHeaderArea = function () {
        console.error('getHeaderArea must be implemented.');
    };

    Editor.prototype.getLeftTabBarArea = function () {
        console.error('getLeftTabBarArea must be implemented.');
    };

    Editor.prototype.getRightTabBarArea = function () {
        console.error('getRightTabBarArea must be implemented.');
    };

    Editor.prototype.preProcess = function () {
        return Promise.resolve();
    };

    Editor.prototype.registerCommandCallback = function () {
        this.getCommandManager().registerCallback(Studio.getInstance().onCommand.bind(Studio.getInstance()));
        this.getCommandManager().registerCallback(this.save.bind(this));
    };

    Editor.prototype.getCommandManager = function () {
        this.commandManager = this.commandManager || new Brightics.VA.Core.CommandManager(this.options.editorInput.getContents(), this);
        return this.commandManager;
    };

    Editor.prototype.addCommandListener = function (callback) {
        this.getCommandManager().registerCallback(callback);
    };

    Editor.prototype.removeCommandListener = function (callback) {
        this.getCommandManager().unRegisterCallback(callback);
    };

    Editor.prototype.addGoHistoryListener = function (callback) {
        this.getCommandManager().registerGoHistoryCallback(callback);
    };

    Editor.prototype.removeGoHistoryListener = function (callback) {
        this.getCommandManager().unRegisterGoHistoryCallback(callback);
    };

    Editor.prototype.getModelClazz = function () {
        return this.options.clazz;
    };

    Editor.prototype.getEditorInput = function () {
        return this.options.editorInput;
    };

    Editor.prototype.getModel = function () {
        return this.options.editorInput.getContents();
    };

    Editor.prototype.getActiveModel = function () {
        return this.getModel();
    };

    Editor.prototype.updateStatus = function () {
    };

    Editor.prototype.openSidebar = function () {
        if (this.sideBarManager) this.sideBarManager.openAll();
    };

    Brightics.VA.Core.Editors.Editor = Editor;

}).call(this);

/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function EditorContainer(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
        this.registerDebugListener();
    }

    EditorContainer.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    EditorContainer.prototype.registerDebugListener = function () {
        var _this = this;
        Studio.getInstance().addDebugListener(function (event, eventData) {
            var clazz = eventData.launchOptions.clazz;

            if (eventData.eventType == 'BEGIN-JOB') {
                var LaunchProgressDialog = 
                Brightics.VA.Core.Interface.LauncherDialog[clazz] || Brightics.VA.Core.Dialogs.LaunchProgressDialog;
                
                _this.launchProgressDialog = new LaunchProgressDialog(_this.$mainControl, {
                    jobId: eventData.launchOptions.runnable.jid,
                    close: function (event) {
                        _this.launchProgressDialog = null;
                    },
                    title: 'Run Progress'
                });
            }

            var editor = _this.getActiveModelEditor();

            if (_this.launchProgressDialog) {
                _this.launchProgressDialog.progress(eventData);
                //if (editor) editor.debug(eventData);
            }

            if (clazz === 'deeplearning') {
                if (editor.dialog && editor.dialog['run']) {
                    editor.dialog['run'].progress(eventData);
                }
            }
        });
    };

    EditorContainer.prototype.createControls = function () {
        var _this = this;

        this.$mainControl = $('<div class="brtc-va-editors-editorcontainer"></div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });

        this.$parent.append(this.$mainControl);
    };

    EditorContainer.prototype.closeEditor = function (editorInput) {
        var $editors = this.$mainControl.find('.brtc-va-editor-wrapper');
        for (var i = 0; i < $editors.length; i++) {
            var editor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef($editors.eq(i).children());
            if (editor.options.editorInput.getFileId() == editorInput.getFileId()) {
                if (editor.$ctxMenu) editor.$ctxMenu.jqxMenu('destroy');
                if (editor.sideBarManager) editor.sideBarManager.destroy();
                editor.destroy();
                $editors.eq(i).remove();
                return;
            }
        }
    };

    EditorContainer.prototype.openEditor = function (editorInput) {
        var _this = this;
        var $menubarCenter = $('.brtc-va-studio-top-area').find('.brtc-va-tools-menubar-center-area');
        if($menubarCenter.find('.brtc-va-tools-menubar-editor-tab.newmodel').css('display') == 'none'){
            $menubarCenter.find('.brtc-va-tools-menubar-editor-tab.newmodel').css('display', 'block');
        }

        var $editors = this.$mainControl.find('.brtc-va-editor-wrapper');
        var editor;
        for (var i = 0; i < $editors.length; i++) {
            editor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef($editors.eq(i).children());
            if (editor.options.editorInput.getFileId() == editorInput.getFileId()) {
                $editors.removeClass('selected');
                $editors.eq(i).addClass('selected');
                $editors.eq(i).trigger('selected');
                return editor;
            }
        }

        var $content = $('<div class="brtc-va-editor-wrapper"></div>');

        $editors.removeClass('selected');
        $content.addClass('selected');

        this.$mainControl.append($content);

        var clazz = editorInput.getContents().type || 'data';
        var Editor = Brightics.VA.Core.Interface.Editor[clazz];

        editor = new Editor($content, {
            width: '100%',
            height: '100%',
            editorInput: editorInput,
            clazz: clazz
        });

        $content.on('selected', function () {
            var editor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef($content.children());
            if (editor && editor.onActivated) {
                editor.onActivated();
            }
        });

        Studio.getInstance().doValidate(editorInput.getContents());
        return editor;
    };

    EditorContainer.prototype.getActiveModelEditor = function () {
        var $activeEditor = this.$mainControl.find('.brtc-va-editor-wrapper.selected').children();
        return Brightics.VA.Core.Utils.WidgetUtils.getEditorRef($activeEditor);
    };

    EditorContainer.prototype.getEditors = function () {
        var editors = [];
        var $editors = this.$mainControl.find('.brtc-va-editor-wrapper');
        for (var i = 0; i < $editors.length; i++) {
            var editor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef($editors.eq(i).children());
            editors.push(editor);
        }
        return editors;
    };

    EditorContainer.prototype.findEditorsByProjectId = function (projectId) {
        var editors = [];
        var $editors = this.$mainControl.find('.brtc-va-editor-wrapper');
        for (var i = 0; i < $editors.length; i++) {
            var editor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef($editors.eq(i).children());
            if (editor.options.editorInput.getProjectId() == projectId) {
                editors.push(editor);
            }
        }
        return editors;
    };

    EditorContainer.prototype.findEditorById = function (projectId, fileId) {
        var $editors = this.$mainControl.find('.brtc-va-editor-wrapper');
        for (var i = 0; i < $editors.length; i++) {
            var editor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef($editors.eq(i).children());
            if (editor.options.editorInput.getProjectId() == projectId &&
                    editor.options.editorInput.getFileId() == fileId) {
                return editor;
            }
        }
    };

    Brightics.VA.Core.Editors.EditorContainer = EditorContainer;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-01-30.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function EditorPage(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
    }

    EditorPage.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    EditorPage.prototype.createControls = function () {
        // do nothing
    };

    Brightics.VA.Core.Editors.EditorPage = EditorPage;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-01-28.
 */

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');

    function ModelEditor(parentId, options) {
        Brightics.VA.Core.Editors.Editor.call(this, parentId, options);

        this.activeModelChangeListeners = [];
        this.initModelLayoutManager();
        this.registerCommandCallback();
    }

    ModelEditor.prototype = Object.create(Brightics.VA.Core.Editors.Editor.prototype);
    ModelEditor.prototype.constructor = ModelEditor;

    ModelEditor.prototype.init = function () {
        Brightics.VA.Core.Editors.Editor.prototype.init.call(this);
        this.setActiveModel(this.getModel().mid);
    };

    ModelEditor.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-editors-modeleditor brtc-va-editor">' +
            '   <div class="brtc-style-editor-toolbar-area brtc-style-s-editor-toolbar-area"></div>' +
            '   <div class="brtc-va-editors-modeleditor-header"></div>' +
            '   <div class="brtc-va-editors-side-tab-bar brtc-va-editors-left-tab-bar"></div>' +
            '   <div class="brtc-va-editors-side-tab-bar brtc-va-editors-right-tab-bar"></div>' +
            '   <div class="brtc-va-editors-modeleditor-splitter">' +
            '      <div class="brtc-va-editors-modeleditor-diagram"></div>' +
            '      <div class="brtc-va-editors-modeleditor-sheet"></div>' +
            '   </div>' +
            '   <div class="brtc-va-editors-modeleditor-notification-container"></div>' +
            '   <div class="brtc-va-editors-modeleditor-notification">' +
            '       <div class="brtc-va-editors-modeleditor-notification-content"></div>' +
            '   </div>' +
            '</div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });

        this.$parent.append(this.$mainControl);
        this.initEditorState();

        Brightics.VA.Core.Utils.WidgetUtils.putModelEditorRef(this.$mainControl, this);

        this.createEditorSplitter();
        this.createHeader();
        this.getHeaderArea().hide();
        this.createDiagramEditorPage();
        this.createDiagramEditorWrapper();
        this.createToolbar();
        this.createSheetEditorPage();

        this.createNotification();
        this.createChartSettingDialog();
    };

    ModelEditor.prototype.initModelLayoutManager = function () {
        this.modelLayoutManager.registerConditionHeader(this.conditionHeader);
        this.modelLayoutManager.registerLoopHeader(this.loopHeader);
    };

    ModelEditor.prototype.createDiagramEditorPage = function () {
        var $diagram = this.getDiagramEditorPageArea();

        this.diagramEditorPage = new Brightics.VA.Implementation.DataFlow.Editors.Diagram.EditorPage($diagram, {
            width: '100%',
            height: '100%',
            editor: this
        });
        this._createEventListener();
    };

    ModelEditor.prototype.getColorSet = function () {
        return {
            READY: '#E5E9EF',
            DEPRECATED: '#D3D3D3',
            PROCESSING: 'blue',
            SUCCESS: '#58bd7c',
            FAIL: 'red'
        }
    };

    ModelEditor.prototype.updateStatus = function (event) {
        this.addStatus(event)
        this.diagramEditorPage.updateStatus(event);
        this.sideBarManager.updateStatus(event);
    };

    ModelEditor.prototype.getDiagramEditorPage = function () {
        return this.diagramEditorPage;
    };

    ModelEditor.prototype.createSheetEditorPage = function () {
        var $sheet = this.getSheetEditorPageArea();
        this.sheetEditorPage = new Brightics.VA.Core.Editors.Sheet.SheetEditorPage($sheet, {
            width: '100%',
            height: '100%',
            panelFactory: this.getPanelFactory()
        });
    };

    ModelEditor.prototype.getSheetEditorPage = function () {
        return this.sheetEditorPage;
    };

    ModelEditor.prototype._createEventListener = function () {
        var $diagram = this.$mainControl.find('.brtc-va-editors-modeleditor-diagram');
        this._createFnUnitSelectEventListener($diagram);
        this._createFnUnitDoubleClickEventListener($diagram);
        this._createFnUnitMoveEventListener($diagram);
    };

    ModelEditor.prototype._createFnUnitSelectEventListener = function ($diagram) {
        var _this = this;
        $diagram.bind('fnUnit:select', function (event, eventData) {
            var fnUnits = $.map(eventData, function (value, key) {
                return _this.getActiveModel().getFnUnitById(value);
            });

            if (!_this.getEditorState('move-mode-enabled') && fnUnits.length === 1) {
                if (FnUnitUtils.isDustNode(fnUnits[0])) return;
                if (!FnUnitUtils.isAvailable(fnUnits[0])) {
                    var message = 'This function is not available.';
                    _this.notification('error', message);
                    return;
                }

                if (FnUnitUtils.isProcessFunction(fnUnits[0])) {
                    _this.resetSheetEditorPage();
                    _this.openPopupDialog(fnUnits[0]);
                } else {
                    _this.$editorSplitter.jqxSplitter('expand');
                    _this.renderSheetEditorPage(fnUnits);
                }
            } else {
                _this.resetSheetEditorPage();
            }
        });
    };

    ModelEditor.prototype._createFnUnitMoveEventListener = function ($diagram) {
        var _this = this;
        $diagram.bind('fnUnit:move', function () {
            _this.resetSheetEditorPage();
        });
    };

    ModelEditor.prototype.getFunctionDef = function (fnUnit) {
        var clazz = this.getModel().type;
        return Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func);
    };

    ModelEditor.prototype._createFnUnitDoubleClickEventListener = function ($diagram) {
        var _this = this;
        $diagram.bind('fnUnit:dbclick', function (event, eventData) {
            if (_this.getEditorState('move-mode-enabled')) return;
            var fnUnits = $.map(eventData, function (value, key) {
                return _this.getActiveModel().getFnUnitById(value);
            });
            if (fnUnits.length === 1) {
                if (fnUnits[0][FUNCTION_NAME] === 'If' ||
                    fnUnits[0][FUNCTION_NAME] === 'ForLoop' ||
                    fnUnits[0][FUNCTION_NAME] === 'WhileLoop') {
                    var mid = fnUnits[0][FUNCTION_NAME] == 'If' ?
                        fnUnits[0].param.if.mid :
                        fnUnits[0].param.mid;

                    _this.modelLayoutManager.openActivity(mid, fnUnits[0]);
                // } else if (fnUnits[0][FUNCTION_NAME] === 'Flow') {
                //     var projectId = _this.getEditorInput().getProjectId();
                //     var fileId = fnUnits[0].param.mid;

                //     var fileInput = Studio.getResourceManager().getFile(projectId, fileId);
                //     if (fileInput) Studio.getLayoutManager().openEditor(fileInput);
                //     else Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('File not found.');
                } else {
                    _this.resetSheetEditorPage();
                }
            }
        });
    };

    ModelEditor.prototype.destroy = function () {
        this.modelLayoutManager.destroy();
    };

    ModelEditor.prototype.createChartSettingDialog = function () {
        var _this = this;
        // TODO In/Out Panel 에서 동시에 사용할 Dialog 인데,
        // TODO DataWorksheet 에서 구현하자니 복잡도가 올라가서 일단 여기다 구현함.
        // TODO Dialog Open 은 DataWorksheet 에서 하고 있음 by daewon.park since 20170523
        var $dialog = $('' +
            '<div class="brtc-va-dialog brtc-va-chart-settings">' +
            '   <div class="brtc-va-dialog-header">' +
            '       <div class="brtc-va-dialog-title">Chart Settings</div>' +
            '       <div class="brtc-va-dialog-button" action="close"></div>' +
            '   </div>' +
            '   <div class="brtc-va-dialog-contents"></div>' +
            '</div>');
        this.$mainControl.append($dialog);
        $dialog.draggable({
            handle: $dialog.find('.brtc-va-dialog-header > .brtc-va-dialog-title'),
            containment: 'parent'
        });

        $dialog.find('.brtc-va-dialog-header > .brtc-va-dialog-button[action="close"]').click(function () {
            $(this).closest('.brtc-va-dialog.brtc-va-chart-settings').hide();
        });
        $dialog.hide();

        return $dialog;
    };

    ModelEditor.prototype.showChartSettingDialog = function () {
        this.$mainControl.children('.brtc-va-dialog.brtc-va-chart-settings').show();
    };

    ModelEditor.prototype.hideChartSettingDialog = function () {
        this.$mainControl.children('.brtc-va-dialog.brtc-va-chart-settings').hide();
    };

    ModelEditor.prototype.createNotification = function () {
        var $notificationContainer = this.$mainControl.children(".brtc-va-editors-modeleditor-notification-container");
        this.$notification = this.$mainControl.children(".brtc-va-editors-modeleditor-notification");
        this.$notification.jqxNotification({
            theme: Brightics.VA.Env.Theme,
            appendContainer: $notificationContainer,
            autoOpen: false, animationOpenDelay: 800,
            autoClose: true, autoCloseDelay: 3000,
            template: "info"
        });
    };

    ModelEditor.prototype.notification = function (template, message) {
        this.$mainControl.children(".brtc-va-editors-modeleditor-notification-container").html('');
        var $notificationContent = this.$notification.find(".brtc-va-editors-modeleditor-notification-content");
        $notificationContent.html(message);
        this.$notification.jqxNotification({template: template});
        this.$notification.jqxNotification("open");
    };

    ModelEditor.prototype.getDiagramEditorPageArea = function () {
        return this.$mainControl.find('.brtc-va-editors-modeleditor-diagram');
    };

    ModelEditor.prototype.getSheetEditorPageArea = function () {
        return this.$mainControl.find('.brtc-va-editors-modeleditor-sheet');
    };

    ModelEditor.prototype.createEditorSplitter = function () {
        var _this = this;

        _this.$editorSplitter = _this.$mainControl.find('.brtc-va-editors-modeleditor-splitter');
        _this.expandedSize = 180;

        _this.$editorSplitter.jqxSplitter({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 'calc(100% - 40px)',
            orientation: 'horizontal',
            panels: [
                {size: _this.expandedSize, min: 90, collapsible: false},
                {min: 400, collapsible: true, collapsed: true}
            ],
            splitBarSize: 8
        });

        _this.$editorSplitter.on('resize', function (event) {
            if (event.args && event.args.panels) {
                if (event.args.panels[0].size == event.args.panels[0].min) {
                    // if (_this.$chevron.hasClass('fa-chevron-down') === false) {
                    //     _this.$chevron.addClass('fa-chevron-down');
                    // }
                } else {
                    // if (_this.$chevron.hasClass('fa-chevron-down')) {
                    //     _this.$chevron.removeClass('fa-chevron-down');
                    // }
                    _this.expandedSize = event.args.panels[0].size;
                }
                _this.getModelLayoutManager().handleFitToContent();
            }
        });
    };

    ModelEditor.prototype.onActivated = function () {
        $(window).trigger('resize');
        this.getModelLayoutManager().handleOnActivate();
    };

    ModelEditor.prototype.callFunction = function (fnUnit) {
        return Studio.getInstance().callFunction(this.getModel(), fnUnit);
    };

    ModelEditor.prototype.handleDebugEvent = function (eventData) {
        if (eventData.event == 'start-process') {

        }
    };

    ModelEditor.prototype.selectFunction = function (fid) {
        this.getModelLayoutManager().handleSelectFunction(fid);
    };

    ModelEditor.prototype.showFunctionProperty = function (fid) {
        if (!fid) return;
        var _this = this;
        var fnUnit = _this.getActiveModel().getFnUnitById(fid);
        if (fnUnit) {
            if (FnUnitUtils.isProcessFunction(fnUnit)) {
                _this.openPopupDiaog(fnUnit);
                _this.renderSheetEditorPage([fnUnit]);
            } else {
                _this.selectFunction(fid);
            }
        }
    };

    ModelEditor.prototype.getMainArea = function () {
        return this.$mainControl;
    };

    ModelEditor.prototype.getHeaderArea = function () {
        return this.$mainControl.find('.brtc-va-editors-modeleditor-header');
    };

    ModelEditor.prototype.getLeftTabBarArea = function () {
        return this.$mainControl.find('.brtc-va-editors-left-tab-bar');
    };

    ModelEditor.prototype.getRightTabBarArea = function () {
        return this.$mainControl.find('.brtc-va-editors-right-tab-bar');
    };

    ModelEditor.prototype.createHeader = function () {
        var $header = this.getHeaderArea();
        var Header = Brightics.VA.Implementation.DataFlow.Editors.Header;
        this.loopHeader = new Header.LoopHeader($header);
        this.conditionHeader = new Header.ConditionHeader($header);
    };

    ModelEditor.prototype.createDiagramEditorWrapper = function () {
        var DiagramEditorWrapper =
            Brightics.VA.Implementation.DataFlow.Editors.Diagram.DiagramEditorWrapper;
        this.diagramEditorWrapper = new DiagramEditorWrapper(null, {
            conditionHeader: this.conditionHeader,
            loopHeader: this.loopHeader,
            editor: this
        });
    };

    ModelEditor.prototype.renderSheetEditorPage = function (fnUnits) {
        this.sheetEditorPage.render(fnUnits);
        this.setActiveFnUnitOnProp(fnUnits[0]);
        if (fnUnits.length === 1) this.getDiagramEditorPage().ensureCenterByFnUnit(fnUnits[0]);
    };

    ModelEditor.prototype.resetSheetEditorPage = function () {
        this.$editorSplitter.jqxSplitter('collapse');
        this.sheetEditorPage.render();
        this.hideChartSettingDialog();
        this.setActiveFnUnitOnProp();
    };

    ModelEditor.prototype.getReportManager = function () {
        this.reportManager = this.reportManager || new Brightics.VA.Core.ReportManager(this.getEditorInput());
        return this.reportManager;
    };

    ModelEditor.prototype.getPanelFactory = function () {
        this.panelFactory = this.panelFactory || new Brightics.VA.Core.Editors.Sheet.PanelFactory();
        return this.panelFactory;
    };

    ModelEditor.prototype.getActiveModel = function () {
        return this.activeModel;
    };

    ModelEditor.prototype.getModelByMid = function (mid) {
        if (mid == this.getModel().mid) return this.getModel();
        return this.getModel().getInnerModel(mid);
    };

    ModelEditor.prototype.getFunctionByFid = function (fid) {
        var fnUnit = this.getModel().getFnUnitById(fid);
        if (fnUnit) return fnUnit;

        var models = this.getModel().getInnerModels();
        for (var mid in models) {
            var model = models[mid];
            fnUnit = model.getFnUnitById(fid);
            if (fnUnit) return fnUnit;
        }
        return undefined;
    };

    ModelEditor.prototype.setActiveModel = function (mid) {
        this.activeModel = this.getModelByMid(mid);
        this.handleActiveModelChange(this.activeModel);
    };

    ModelEditor.prototype.getActiveFnUnit = function () {
        return this.getModelLayoutManager().getFnUnit();
    };

    ModelEditor.prototype.getActiveFnUnitOnProp = function () {
        return this.activeFnUnitOnProp;
    };

    ModelEditor.prototype.getDiagramArea = function () {
        return this.$editorSplitter;
    };

    ModelEditor.prototype.setActiveFnUnitOnProp = function (val) {
        this.activeFnUnitOnProp = val;
        this.getSideBarManager().onFnUnitSelect(val);
    };

    ModelEditor.prototype.setHistorySelector = function (hs) {
        this.historySelector = hs;
    };

    ModelEditor.prototype.getDiagramEditorWrapper = function () {
        return this.diagramEditorWrapper;
    };

    ModelEditor.prototype.addActiveModelChangeListener = function (lis) {
        this.activeModelChangeListeners.push(lis);
    };

    ModelEditor.prototype.removeActiveModelChangeListener = function (lis) {
        this.activeModelChangeListeners =
            _.remove(this.activeModelChangeListeners, lis);
    };

    ModelEditor.prototype.handleActiveModelChange = function (model) {
        _.forEach(this.activeModelChangeListeners, function (lis) {
            if (_.isFunction(lis)) {
                lis(model);
            }
        });
    };

    ModelEditor.prototype.openPopupDialog = function (fnUnit) {
        if (FnUnitUtils.isBluffNode(fnUnit)) return;
        var clonedFnUnit = $.extend(true, {}, fnUnit);
        var func = fnUnit.func;
        var _this = this;

        var TargetDialogMap = {
            'setValue': 'SetValueSettingDialog',
            'import': 'ImportDataSettingDialog',
            'export': 'ExportDataSettingDialog',
            'unloadModel': 'UnloadModelSettingDialog'
        };
        var TargetDialog = Brightics.VA.Core.Dialogs[TargetDialogMap[func]];

        new TargetDialog(this.getDiagramEditorPage(), {
            event: event,
            editor: this,
            fnUnit: clonedFnUnit,
            param: clonedFnUnit.param,
            title: 'Setting Configuration',
            close: function (dialogResult) {
                if (dialogResult.OK && dialogResult.results) {
                    _this.createSetDialogFnUnitCommand(dialogResult.results.fnUnit, fnUnit);
                }
            }
        });
    };

    ModelEditor.prototype.createSetDialogFnUnitCommand = function (newFnUnit, oldFnUnit) {
        var commands = new Brightics.VA.Core.CompoundCommand(this, {label: 'Change a Function'});

        var inputsCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand(this, {
            fnUnit: oldFnUnit,
            ref: {
                inputs: _.isEmpty(newFnUnit.inputs)? oldFnUnit.inputs : newFnUnit.inputs
            }
        })

        var metaCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ChangeMetaCommand(this, {
            fnUnit: oldFnUnit,
            ref: {
                meta: _.isEmpty(newFnUnit.meta)? oldFnUnit.meta : newFnUnit.meta
            }
        })

        var paramCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetDialogFnUnitCommand(this, {
            fnUnit: oldFnUnit,
            ref: {param: newFnUnit.param}
        });

        var renameCommand = new Brightics.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this, {
            fid: newFnUnit.fid,
            name: newFnUnit.display.label,
            description: newFnUnit.display.description
        });

        commands.add(inputsCommand);
        commands.add(metaCommand);
        commands.add(paramCommand);
        commands.add(renameCommand);
        this.getCommandManager().execute(commands);
    };

    ModelEditor.prototype.getEditorState = function (key) {
        if (_.has(this.editorState, key)) {
            return this.editorState[key];
        } else {
            throw new Error('invalid editor state');
        }
    };

    ModelEditor.prototype.setEditorState = function (key, val) {
        if (_.has(this.editorState, key)) {
            this.editorState[key] = val;
            if (_.has(this.handleEditorStateChange, key)) {
                this.handleEditorStateChange[key](val);
            }
        } else {
            throw new Error('invalid editor state');
        }
    };

    ModelEditor.prototype.initEditorState = function () {
        var _this = this;

        this.editorState = {
            'tooltip-enabled': false,
            'move-mode-enabled': false,
            'readonly-figure-selected': false
        };

        this.handleEditorStateChange = {
            'move-mode-enabled': function (enabled) {
                if (enabled) {
                    _this.resetSheetEditorPage();
                    _this.$mainControl.addClass('brtc-va-editors-move-mode-enabled');
                } else {
                    _this.$mainControl.removeClass('brtc-va-editors-move-mode-enabled');
                }
            }
        };
    };
    
    ModelEditor.prototype.changeEditorContext = function (mid, fnUnit) {
        this.modelLayoutManager.openActivity(mid, fnUnit);
    };

    ModelEditor.prototype.prepareLaunch = function () {
        this.StatusBoard.refresh();
    };

    ModelEditor.prototype.addStatus = function (event) {
        if (event.status === 'FAIL') {
            var id = event.fid;
            var message = event.originalResponse.errorInfo[0].message;
            this.StatusBoard.add(id, event.status, message);
        } else if (event.status === 'SUCCESS') {
            var id = event.fid;
            this.StatusBoard.add(id, event.status,'');
        } 
    };

    ModelEditor.prototype.getStatus = function (id) {
        return this.StatusBoard.get(id);
    };

    ModelEditor.prototype.showStatus = function (id, $target) {
        this.StatusBoard.show(id, $target);
    };

    Brightics.VA.Core.Editors.ModelEditor = ModelEditor;
}).call(this);

/**
 * Created by sds on 2017-07-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ModelLayoutManager(editor) {
        this.editor = editor;
        this.init();
    }

    ModelLayoutManager.prototype.init = function () {
        this.$editor = this.editor.getMainArea();
    };

    ModelLayoutManager.prototype.getEditor = function () {
        return this.editor;
    };

    ModelLayoutManager.prototype.getSideBarManager = function () {
        return this.editor.getSideBarManager();
    };

    ModelLayoutManager.prototype.getToolbar = function () {
        return this.editor.getToolbar();
    };

    ModelLayoutManager.prototype.setWidth = function (width) {
        if (width) this.$editor.width(width);
    };

    ModelLayoutManager.prototype.setHeight = function (height) {
        if (height) this.$editor.height(height);
    };

    ModelLayoutManager.prototype.setMarginLeft = function (margin) {
        return this.$editor.css('margin-left', margin);
    };

    ModelLayoutManager.prototype.getWidth = function () {
        return this.$editor.width();
    };

    ModelLayoutManager.prototype.getHeight = function () {
        return this.$editor.height();
    };

    ModelLayoutManager.prototype.getPaddingLeft = function () {
        return Number(this.$editor.css('padding-left').replace('px', ''));
    };

    ModelLayoutManager.prototype.getPaddingRight = function () {
        return Number(this.$editor.css('padding-right').replace('px', ''));
    };

    ModelLayoutManager.prototype.getMainArea = function () {
        return this.editor.getMainArea();
    };

    ModelLayoutManager.prototype.getLeftTabBarArea = function () {
        return this.editor.getLeftTabBarArea();
    };

    ModelLayoutManager.prototype.getRightTabBarArea = function () {
        return this.editor.getRightTabBarArea();
    };

    ModelLayoutManager.prototype.handleEditorSelectionChange = function (selection) {
        for (var i in this.editorSelectionChangeListener) {
            this.editorSelectionChangeListener[i].selectionChanged(selection);
        }
    };

    ModelLayoutManager.prototype.initEditorSelectionChangeListener = function () {
        var _this = this;

        this.editor.$mainControl.bind('editorSelectionChanged', function (event, selection) {
            _this.handleEditorSelectionChange(selection);
        });

        this.editorSelectionChangeListener = [];
        for (var key in this.editor.getSideBarManager().getSideBars()) {
            this.editorSelectionChangeListener.push(this.editor.getSideBarManager().getSideBars()[key]);
        }
    };

    ModelLayoutManager.prototype.initTemplateChangeListener = function () {
    };

    ModelLayoutManager.prototype.handleOnActivate = function () {
        this.getSideBarManager().onActivated();
    };

    ModelLayoutManager.prototype.handleUDFChanged = function (selection) {
    };

    ModelLayoutManager.prototype.handleTemplateChanged = function (selection) {
    };

    ModelLayoutManager.prototype.handleExpandStatusChanged = function () {
        var sideBarManager = this.getSideBarManager();

        if (!sideBarManager) return;

        var $splitter = this.getSplitter(),
            layout = this.getSideBarManager().layout,
            sideBarWidth = 0,
            marginLeft = 0;

        var tabBarWidth = this.editor.getLeftTabBarArea().height();
        var sideBarWidth = sideBarManager.getLeftSideBarWidth() + sideBarManager.getRightSideBarWidth();
        if (sideBarManager.isOpen('left')) sideBarWidth += tabBarWidth;
        if (sideBarManager.isOpen('right')) sideBarWidth += tabBarWidth;

        var marginLeft = (sideBarManager.isOpen('left')) ? sideBarManager.getLeftSideBarWidth() + tabBarWidth : tabBarWidth;
        $splitter.css('width', 'calc(100% - ' + sideBarWidth + 'px)').css('margin-left', marginLeft);

        // for (var key in layout) {
        //     if (layout[key].visible) {
        //         sideBarWidth = sideBarWidth + layout[key].width + tabBarWidth;
        //
        //         var sideBarWidth = sideBarManager.getLeftSideBarWidth() + sideBarManager.getRightSideBarWidth();
        //         if (sideBarManager.isOpen('left')) sideBarWidth += tabBarWidth;
        //         if (sideBarManager.isOpen('right')) sideBarWidth += tabBarWidth;
        //
        //         if (layout[key].position === 'left') marginLeft = layout[key].width;
        //     }
        // }
    };

    ModelLayoutManager.prototype.destroy = function () {
    };

    ModelLayoutManager.prototype.getFnUnit = function () {
        // TODO: 일단 refreshModelInfo 동작을 위해서
        // Brightics.VA.Implementation.DataFlow.ModelLayoutManager에 있던 getFnUnit 이동하였음.
        // getFnUnit을 ModelEditor에서 호출하는데 구조가 꼬여있는 것 같음.
        return this.fnUnit || undefined;
    };

    ModelLayoutManager.prototype.refreshModelInfo = function () {
        var model = this.getEditor().getActiveModel();
        var fnUnit = this.getFnUnit();

        var mid = (model) ? (model.mid) : (undefined);
        var fid = (fnUnit) ? (fnUnit.fid) : (undefined);
        this.getToolbar().navigator.buildNavigator(mid, fid);
    };

    ModelLayoutManager.prototype.getSplitter = function () {
        return this.editor.getMainArea().find('.brtc-va-editors-modeleditor-splitter');
    };

    ModelLayoutManager.prototype.adjustLayout = function () {
        this.setDiagramHeight();
        this.setEditorWidth();
    };

    ModelLayoutManager.prototype.setDiagramHeight = function () {
    };

    ModelLayoutManager.prototype.setEditorWidth = function () {
        var $splitter = this.getSplitter();
        var sidebarManager = this.getSideBarManager();
        var sidebars = sidebarManager.getSideBars();
        var $tabBarArea = this.editor.getLeftTabBarArea();

        //아프지만 일단 항상 두개가 있다고 가정... 아직 top bottom에 관한 부분이 없으니..
        $splitter
            .css('margin-left', $tabBarArea.height())  //rotation
            .css('width', 'calc(100% - ' + $tabBarArea.height() * 2 + 'px)');  //rotation
    };

    Brightics.VA.Core.Editors.ModelLayoutManager = ModelLayoutManager;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-02-01.
 */
/* global IN_DATA, OUT_DATA, FUNCTION_NAME, _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var FnUnitUtils = brtc_require('FnUnitUtils');

    var BEHAVIOR_LINK = 'link';
    var BEHAVIOR_DEFAULT = 'default';

    var TOOLTIP_ENABLED = 'tooltip-enabled';

    var IN_PORT_ID = 'in-left';
    var OUT_PORT_ID = 'out-right';

    var IN_PORT = {
        id: IN_PORT_ID,
        group: 'in:l',
        args: {},
        markup: '<circle class="fnunit-port" r="0"/>',
    };
    var OUT_PORT = {
        id: OUT_PORT_ID,
        group: 'out:r',
        args: {},
        markup: '<circle class="fnunit-port" r="0"/>',
    };

    var DOUBLE_CLICK_INTERVAL = 200;

    function DiagramEditorPage(parentId, options) {
        this.MAX_FUNC_COUNT = Brightics.VA.SettingStorage.getValue('editor.maxfuncnum');
        this.MAX_FUNC_MESSAGE = 'You can only add up to ' + this.MAX_FUNC_COUNT + '.';
        this.parentId = parentId;
        this.options = options;
        this.options.scale = this.options.scale || 1;
        this.opacity4transition = {
            duration: 1000,
            timingFunction: joint.util.timing.inout,
            valueFunction: function (a, b) {
                return function (t) {
                    return Math.max(0.2, b + t);
                };
            }
        };
        this.translateProblems = {};
        this._highlightedViews = [];
        this._selectedLink;
        this.behaviorMode = BEHAVIOR_DEFAULT;
        this.toolItems = {};

        this.retrieveParent();
        this.createControls();
        this.registerDebugListener();
        this.render();
        this.registerCommandEventListener();
        this.registerGoHistoryEventListener();
        this.registerKeyListener();

        this.prvFnUnitSelectTrigger = {};

        var figures = this.graph.getElements();
        if (figures.length > 0) {
            var leftMost = figures[0];
            for (var i in figures) {
                if (leftMost.attributes.position.x > figures[i].attributes.position.x) {
                    leftMost = figures[i];
                }
            }
            this.ensureCenter(leftMost);
        }
        this.updateMiniMapWindow();
        Brightics.OptModelManager.renderOptModels(this);
    }

    DiagramEditorPage.prototype.findError = function (problems) {
        var _this = this;
        var errorIds = [];
        var errorFigures = [];
        var tmpProblems = [];

        if (problems) {
            tmpProblems = (problems.constructor == Array) ? problems : [problems];
            $.each(tmpProblems, function (index, element) {
                var figure = _this.getFigureByFnUnitId(element.fid);
                if ($.inArray(element.fid, errorIds) < 0) {
                    if (figure) {
                        errorIds.push(element.fid);
                        errorFigures.push(figure);
                    }
                }
            });
        }
        return errorFigures;
    };

    DiagramEditorPage.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    DiagramEditorPage.prototype.createControls = function () {
        var _this = this;

        this.$mainControl = $('' +
            '<div class="brtc-va-editors-diagram-diagrameditorpage brtc-style-editor-editorpage">' +
            '</div>');
        this.$parent.append(this.$mainControl);

        var $paper = $('<div class="brtc-va-editors-diagram-diagrameditorpage-paper"></div>');
        this.$mainControl.append($paper);

        this.createMainPanel();
        this.createDiagramPaper();

        this.$createCue = $('' +
            '<div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create">' +
            '    <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label-wrapper">' +
            '        <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue">' +
            '           <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label">Click</div>' +
            '           <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label">to add Function</div>' +
            '       </div>' +
            '       <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create-icon"></div>' +
            '    </div>' +
            '</div>');
        this.$selectedBounds = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected"></div>');
        this.$toolTip = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip"></div>');
        this.$toolbar = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-toolbar"></div>');
        this.$guideBox = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-guidebox"></div>');
        this.$guideMessageBox = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-guidemessage"></div>');
        this.$dragSelection = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-drag-selection"></div>');

        $paper.append(this.$createCue);
        $paper.append(this.$selectedBounds);
        $paper.append(this.$toolTip);
        $paper.append(this.$toolbar);
        $paper.append(this.$guideBox);
        $paper.append(this.$guideMessageBox);
        $paper.append(this.$dragSelection);

        this.createFnUnitToolbar();
        this.createMultiSelectionToolbar();
        this.createCue();
        this._createMiniMapControl();

        this.changeScale(this.options.scale);

        this.cellPointer = {};
    };

    DiagramEditorPage.prototype._createMiniMapControl = function () {
        this.minimap = new Brightics.VA.Core.Editors.Diagram.MinimapBoat(this.$parent.parent('.brtc-va-editors-modeleditor-splitter'), { diagramEditorPage: this });
    };

    DiagramEditorPage.prototype.createExpressionControl = function () {
        if (this.expression) this.expression.destroy();
        if (!this.options.editor.getActiveModel().isMainModel()) {
            this.expression = new Brightics.VA.Core.Editors.Diagram.ExpressionBoat(this.$parent.parent('.brtc-va-editors-modeleditor-splitter'),
                {
                    editor: this.options.editor,
                    resizable: false
                });
        }
    };

    DiagramEditorPage.prototype.getFunctionsLength = function () {
        return this.getModel().functions.length;
    };

    DiagramEditorPage.prototype.createMainPanel = function () {
        var _this = this;

        this.$mainControl.perfectScrollbar();
        this.$mainControl.scroll(function () {
            _this.updateMiniMapWindow();
        });

        this.$mainControl.hover(function () {
            _this.fitToContent();
        }, function () {
            _this.fitToContent();
        });
        this.$mainControl.mouseleave(function () {
            if (!_this.switchFnUnitDialog) _this.$createCue.css('display', 'none');
        });
    };

    DiagramEditorPage.prototype.ensureCenter = function (figure) {
        var centerFigure = figure;
        if (!centerFigure) return;

        var panel = {
            width: this.$mainControl.width(),
            height: this.$mainControl.height(),
            x: this.$mainControl.scrollLeft(),
            y: this.$mainControl.scrollTop()
        };

        var pos = {
            x: centerFigure.attributes.position.x * this.options.scale,
            y: centerFigure.attributes.position.y * this.options.scale
        };

        var xPage = (pos.x / panel.width) | 0;
        var scrollLeft = (xPage * panel.width) + (pos.x % panel.width) - (panel.width / 2) + (Brightics.VA.Env.Diagram.FIGURE_WIDTH * this.options.scale / 2);

        var yPage = (pos.y / panel.height) | 0;
        var scrollTop = (yPage * panel.height) + (pos.y % panel.height) - (panel.height / 2) + (Brightics.VA.Env.Diagram.FIGURE_HEIGHT * this.options.scale / 2);

        this.$mainControl.animate({ scrollLeft: scrollLeft, scrollTop: scrollTop }, 500);
    };

    DiagramEditorPage.prototype.ensureVisible = function (figure) {
        if (!figure) return;

        var panel = {
            width: this.$mainControl.width(),
            heigth: this.$mainControl.height(),
            x: this.$mainControl.scrollLeft(),
            y: this.$mainControl.scrollTop()
        };
        var pos = {
            x: figure.attributes.position.x * this.options.scale,
            y: figure.attributes.position.y * this.options.scale
        };

        if (panel.x > pos.x) {
            this.$mainControl.scrollLeft(pos.x - 10);
        }
        if (panel.y > pos.y) {
            this.$mainControl.scrollTop(pos.y - 10);
        }
        if (panel.x + panel.width < pos.x + 109) {
            this.$mainControl.scrollLeft(pos.x - panel.width + 110);
        }
        if (panel.y + panel.heigth < pos.y + 44) {
            this.$mainControl.scrollTop(panel.y + pos.y - panel.heigth + 45);
        }
    };

    DiagramEditorPage.prototype.createDiagramPaper = function () {
        var _this = this;

        var connectableFids;

        this.$paperElement = this.$mainControl.find('.brtc-va-editors-diagram-diagrameditorpage-paper');

        this.graph = new joint.dia.Graph();
        this.paper = new joint.dia.Paper({
            el: this.$paperElement,
            width: this.options.width,
            height: this.options.height,
            model: this.graph,
            snapLinks: true,
            linkPinning: true,
            gridSize: 10,
            theme: 'none',
            interactive: function (cellView) {
                if (cellView.model instanceof joint.dia.Link) {
                    return { vertexAdd: false };
                }
                if (_this.cellPointer && _this.cellPointer.state === 'link') {
                    return false;
                }

                return true;
            },
            validateConnection: function (cellViewS, magnetS, cellViewT, magnetT, end, linkView) {
                var figureS, figureT, fnUnitS, fnUnitT, defS, defT,
                    clazz = _this.getModel().type;
                figureS = cellViewS.model;
                figureT = cellViewT.model;
                var result = true;
                if (figureS && figureT) {
                    fnUnitS = _this.getFnUnitById(figureS.attributes.fid);
                    fnUnitT = _this.getFnUnitById(figureT.attributes.fid);
                }

                if (fnUnitS && fnUnitT) {
                    connectableFids = connectableFids || _this._getConnectableFids(figureS.attributes.fid);
                    if (connectableFids.indexOf(figureT.attributes.fid) < 0) {
                        result = false;
                    } else {
                        defS = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnitS.func);
                        defT = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnitT.func);
                    }
                }

                result = FnUnitUtils.isConnectable(fnUnitS, fnUnitT);

                connectableFids = undefined;
                return result;
            },
            linkView: joint.dia.LinkView.extend({
                options: _.defaults({
                    shortLinkLength: 45
                }, joint.dia.LinkView.prototype.options),
                updateToolsPosition: function () {
                    if (!this._V.linkTools) return this;

                    var scale = '';
                    var offset = this.options.linkToolsOffset;
                    var connectionLength = this.getConnectionLength();

                    if (!Number.isNaN(connectionLength)) {

                        /**
                         * sungjin1.kim@samsung.com
                         * Link 길이가 짧은 경우 scale 값 조정
                         */
                        if (connectionLength < 75) { // < this.options.shortLinkLength) {
                            scale = 'scale(.5)';
                            offset *= 0.7;
                        }

                        var toolPosition = this.getPointAtLength(offset);

                        this._toolCache.attr('transform', 'translate(' + toolPosition.x + ', ' + toolPosition.y + ') ' + 'scale(.8)');

                        if (this.options.doubleLinkTools && connectionLength >= this.options.longLinkLength) {

                            var doubleLinkToolsOffset = this.options.doubleLinkToolsOffset || offset;

                            toolPosition = this.getPointAtLength(connectionLength - doubleLinkToolsOffset);
                            this._tool2Cache.attr('transform', 'translate(' + toolPosition.x + ', ' + toolPosition.y + ') ' + scale);
                            this._tool2Cache.attr('visibility', 'visible');

                        } else if (this.options.doubleLinkTools) {

                            this._tool2Cache.attr('visibility', 'hidden');
                        }

                        // ===========================================================================================================================
                    }

                    return this;
                }
            })
        });

        this.paper.on('cell:pointerdown', this.handleCellPointerDown.bind(this));
        this.paper.on('cell:pointerup', this.handleCellPointerUp.bind(this));
        this.paper.on('cell:mouseover', this.handleCellMouseOver.bind(this));
        this.paper.on('cell:mouseout', this.handleCellMouseOut.bind(this));

        this.paper.on('blank:pointerdown', this.handleBlankPointerDown.bind(this));
        this.$paperElement.mousemove(this.handleBlankPointerMove.bind(this));
        this.$paperElement.mouseleave(this.handleBlankMouseLeave.bind(this));
        this.$paperElement.mouseenter(this.handleBlankMouseEnter.bind(this));
        // this.$paperElement.on('mouseup', this.handleBlankPointerUp.bind(this));

        var boundHandleBlankPointerUp = this.handleBlankPointerUp.bind(this);
        Studio.getInstance().getControl().on('mouseup', boundHandleBlankPointerUp);
        this.boundHandleBlankPointerUp = boundHandleBlankPointerUp;

        this.graph.on('change:position', this.handleGraphChangePosition.bind(this));
        this.graph.on('add', this.handleGraphAdd.bind(this));
        this.graph.on('remove', this.handleGraphRemove.bind(this));

        this.makeDroppable();
    };

    DiagramEditorPage.prototype.changeScale = function (scale) {
        this.options.scale = scale;
        if (this.options.scale == 0.8 && !this.$paperElement.hasClass('brtc-va-editors-diagram-diagrameditorpage-paper-scale-normal')) {
            this.$paperElement.removeClass('brtc-va-editors-diagram-diagrameditorpage-paper-scale-small');
            this.$paperElement.addClass('brtc-va-editors-diagram-diagrameditorpage-paper-scale-normal');
            this.paper.scale(this.options.scale);
        } else if (this.options.scale == 0.6 && !this.$paperElement.hasClass('brtc-va-editors-diagram-diagrameditorpage-paper-scale-small')) {
            this.$paperElement.removeClass('brtc-va-editors-diagram-diagrameditorpage-paper-scale-normal');
            this.$paperElement.addClass('brtc-va-editors-diagram-diagrameditorpage-paper-scale-small');
            this.paper.scale(this.options.scale);
        } else if (this.options.scale == 1.0) {
            this.$paperElement.removeClass('brtc-va-editors-diagram-diagrameditorpage-paper-scale-small');
            this.$paperElement.removeClass('brtc-va-editors-diagram-diagrameditorpage-paper-scale-normal');
            this.paper.scale(this.options.scale);
        } else {
            //select same scale twice.
            return;
        }

        var figures = this.graph.getElements();
        for (var i in figures) {
            figures[i].changeScale(this.options.scale);
        }

        this.showSelectionBounds();
        var selected = this.getSelectedFigures();
        if (selected.length > 0) {
            this.ensureCenter(selected[0]);
        } else if (figures.length > 0) {
            this.ensureCenter(figures[0]);
        }

        this.updateMiniMapWindow();
        Brightics.OptModelManager.renderOptModels();
    };

    DiagramEditorPage.prototype.changeTooltipEnabled = function (enabled) {
        this.getEditor().setEditorState(TOOLTIP_ENABLED, enabled);
    };

    DiagramEditorPage.prototype.makeDroppable = function () {
        var _this = this;
        
        /* 다이얼로그의 드래그 이동을 위한 상위 element */
        _this.$mainControl.closest('.brtc-va-editor').droppable({
            accept: '.ui-dialog',
            drop: function(event, ui) {
                /* draggable의 이동시에 intersect되는 모든 droppables의 isover상태가 true가 되기 때문에, drop이 끝난 후 isover를 false로 맞춰주어야 함. */
                $.ui.ddmanager.droppables.default.forEach(d => {
                    d.isover = false;       
                });
            }
        });    
    
        _this.$mainControl.droppable({
            accept: '.brtc-va-studio-dm-draggable',
            activate: function (event, ui) {
                _this.fitToContent();
            },
            deactivate: function (event, ui) {
                if (ui.helper.css('visibility') == 'visible') {
                    _this.fitToContent();
                }
            },
            over: function (event, ui) {
                _this.hideSelectionBounds();
                var figure, x, y, i;
                ui.helper.css('visibility', 'hidden');
                ui.helper.bind('feedback', function (event, eventData) {
                    var pos = _this.paper.clientToLocalPoint({ x: eventData.clientX, y: eventData.clientY });
                    for (var i in _this.dropContents.functions) {
                        figure = _this.dropFigures[i];
                        x = pos.x - 50 + _this.dropContents.functions[i].display.diagram.position.x;
                        y = pos.y - 30 + _this.dropContents.functions[i].display.diagram.position.y;
                        figure.position(x, y);
                    }
                    _this.showGuideBox(_this.dropFigures[0]);
                });

                var templateContents = Brightics.VA.Core.Utils.WidgetUtils.getData(ui.helper, 'template');
                var dragSource = Brightics.VA.Core.Utils.WidgetUtils.getData(ui.helper, 'source');
                var pos = _this.paper.clientToLocalPoint({ x: event.clientX, y: event.clientY });

                if (dragSource instanceof Brightics.VA.Core.Views.Palette) {
                    _this.dropContents = {
                        functions: [],
                        links: [],
                        isPalette: true
                    };
                    _this.dropContents.functions.push(_this.getModel().newFnUnit(templateContents.functions[0].func));
                } else {
                    _this.dropContents = templateContents;
                }

                _this.dropFigures = [];
                for (i in _this.dropContents.functions) {
                    figure = _this.createFnUnitFigure(_this.dropContents.functions[i]);
                    figure.attributes.dummy = true;
                    _this.dropFigures.push(figure);
                }
                _this.graph.addCells(_this.dropFigures);

                for (i in _this.dropContents.functions) {
                    figure = _this.dropFigures[i];
                    x = pos.x - 50 + _this.dropContents.functions[i].display.diagram.position.x;
                    y = pos.y - 30 + _this.dropContents.functions[i].display.diagram.position.y;
                    figure.position(x, y);
                }

                _this.dropLinks = [];
                for (i in _this.dropContents.links) {
                    var linkFigure = _this.createLinkFigure(_this.dropContents.links[i]);
                    if (linkFigure) {
                        _this.dropLinks.push(linkFigure);
                    }
                }
                _this.graph.addCells(_this.dropLinks);
                $.each(_this.dropLinks, function (index, link) {
                    link.toBack();
                });
            },
            out: function (event, ui) {
                ui.helper.css('visibility', 'visible');
                ui.helper.unbind('feedback');
                for (var i in _this.dropFigures) {
                    _this.dropFigures[i].remove();
                }
                _this.dropContents = null;
                _this.dropFigures = [];
                _this.dropLinks = [];

                _this.hideGuideBox();
                _this.hideGuideMessage();
                _this.hideTools(true);
                _this.showSelectionBounds();
                _this.$parent.trigger('mouseleave');
            },
            drop: function (event, ui) {
                var i, links = [];
                _this.hideGuideBox();

                if (_this.guideMessage) {
                    _this.hideGuideMessage();
                    for (i in _this.dropFigures) {
                        _this.dropFigures[i].remove();
                    }
                } else if (_this.getFunctionsLength() + _this.dropFigures.length > _this.MAX_FUNC_COUNT) {
                    _this.hideGuideMessage();
                    for (i in _this.dropFigures) {
                        _this.dropFigures[i].remove();
                    }
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(_this.MAX_FUNC_MESSAGE);
                } else if (_this.dropFigures.length > 0) {
                    var isMaintainIntable = false;
                    for (i in _this.dropFigures) {
                        var pos = _this.calcGuidePosition(_this.dropFigures[i]);
                        _this.dropFigures[i].position(pos.x, pos.y);
                        _this.dropFigures[i].attributes.dummy = false;
                    }
                    if (_this.dropFigures.length === 1 && Brightics.VA.SettingStorage.getValue('editor.diagram.autoconnect') === 'true') {
                        links = _this.connectSmartly(_this.dropFigures[i]);
                    } else {
                        isMaintainIntable = true;
                    }
                    _this.showTools(_this.dropFigures[0]);

                    var commands = new Brightics.VA.Core.CompoundCommand(_this, { label: 'Create a Function' });

                    for (i in _this.dropFigures) {
                        if (isMaintainIntable !== true) {
                            FnUnitUtils.clearInData(_this.dropContents.functions[i]);
                        }
                        commands.add(_this.createNewFnUnitCommand(_this.dropFigures[i],
                            _this.dropContents.functions[i],
                            _this.dropContents.isPalette ? undefined : _this.dropContents
                        ));
                        commands.add(_this.createSetFnUnitPositionCommand(_this.dropFigures[i], _this.dropFigures[i].attributes.position.x, _this.dropFigures[i].attributes.position.y));
                    }

                    for (i in _this.dropLinks) {
                        commands.add(_this.createConnectFnUnitCommand(_this.dropLinks[i], isMaintainIntable));
                    }

                    for (i in links) {
                        commands.add(_this.createConnectFnUnitCommand(links[i]));
                    }
                    _this.fireCommand(commands);
                    _this._rerouteLink();
                }

                _this.dropContents = null;
                _this.dropFigures = [];
                _this.dropLinks = [];

                _this.showSelectionBounds();
            }
        });
    };

    DiagramEditorPage.prototype.handleGraphChangePosition = function (model) {
        var _this = this;
        _this.$createCue.css('display', 'none');

        if (_this.cellPointer.figure == model) {

            var figures = _this.getSelectedFigures();
            if (_this.cellPointer.state === 'Down') {
                figures.forEach(function (fig) {
                    fig.toFront({ deep: true });
                });
            }
            if (_this.cellPointer.state == 'Down' || _this.cellPointer.state == 'Drag') {
                _this.cellPointer.state = 'Drag';
                _this.$parent.trigger('fnUnit:move');
                var prevPosition = model.previousAttributes().position;
                var currPosition = model.attributes.position;

                $.each(figures, function (index, figure) {
                    if (figure !== model) {
                        var xx = figure.attributes.position.x + (currPosition.x - prevPosition.x);
                        var yy = figure.attributes.position.y + (currPosition.y - prevPosition.y);
                        figure.position(xx, yy);
                    }
                });
            }
            $.each(figures, function (index, figure) {
                _this.updateSelectionBox(figure);
                _this.updateErrorBox(figure);
            });

            _this.hideTools(true);
            _this.updateToolsPosition(model);
        } else {
            _this.updateSelectionBox(model);
            _this.updateErrorBox(model);
        }

        _this.updateGuideBox(model);
        _this.hideGuideMessage();

        var messages = _this.validateTranslate([model]);
        for (var cid in messages) {
            _this.showGuideMessage(_this.graph.getCell(cid), messages[cid]);
        }

        _this.fitToContent();
        // Do not reroute the link for performance. by daewon.park
    };

    DiagramEditorPage.prototype.handleGraphAdd = function (model) {
        // Do not reroute the link for performance. by daewon.park
    };

    DiagramEditorPage.prototype.handleGraphRemove = function (model, collection, opt) {
        delete this.translateProblems[model.cid];
        if (model.attributes.type === 'brtc.va.shapes.Link' && opt.ui === true) {
            var link = model;
            model.graph = this.graph;
            var command = this.createDisconnectFnUnitCommand(link);
            this.fireCommand(command);
            this.notification('success', 'The connection was removed.');
        }
        // Do not reroute the link for performance. by daewon.park
    };

    DiagramEditorPage.prototype._rerouteLink = function () {
        var _this = this;
        if (_this.rerouteLinkTask) {
            clearTimeout(_this.rerouteLinkTask);
        }
        _this.rerouteLinkTask = function () {
            var links = _this.graph.getLinks();
            for (var i in links) {
                _this.paper.findViewByModel(links[i]).update();
            }
        };
        setTimeout(_this.rerouteLinkTask, 1000);
    };

    DiagramEditorPage.prototype._clearSelectedLink = function () {
        if (this._selectedLink) {
            this._selectedLink.hideRemoveButton();
            this._selectedLink = undefined;
        }
    };

    DiagramEditorPage.prototype._handleLinkCellPointerDown = function (cellView, evt, x, y) {
        if (!this._isConnectableCell(cellView.model)) {
            this._setBehaviorModeToDefault();
            this._handleDefaultCellPointerDown(cellView, evt, x, y);
            return;
        }

        var fromCell = this._fromCell;
        var toCell = cellView.model;
        var kid = Brightics.VA.Core.Utils.IDGenerator.link.id();
        var link = this._createLinkFigure(kid, fromCell, toCell);
        this.graph.addCells([link]);
        this.paper.findViewByModel(link).update();

        var command = this.createConnectFnUnitCommand(link);
        if (this.fireCommand(command)) {
            link.set('target', { id: cellView.model.id, port: IN_PORT_ID });
        } else {
            link.remove();
            this.notification('warning', 'No connection could be made.');
        }
        cellView.unhighlight();
        this._setBehaviorModeToDefault();
    };

    DiagramEditorPage.prototype._handleDefaultCellPointerDown = function (cellView, evt, x, y) {
        this.cellPointer = {};
        var _this = this;

        if (cellView.model instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
            setTimeout(function () {
                _this._clearSelectedLink();
            }, 100);
            var figure = cellView.model;

            this.cellPointer.state = 'Down';
            this.cellPointer.figure = figure;

            if (this.getSelectedFigureIds().indexOf(figure.cid) < 0) {
                this.showSelectionBox([figure], false);
            }

            this.hideSelectionBounds();
            this.showGuideBox(figure);
        } else if (cellView.model instanceof Brightics.VA.Core.Shapes.LinkFigure) {
            var selections = this.getSelectedFigureIds();
            for (var i in selections) {
                var cell = this.graph.getCell(selections[i]);
                if (cell) cell.unselect();
            }
            setTimeout(function () {
                _this._triggerClickOrDoubleClickEvent(selections);
                _this.hideSelectionBounds();
            }, 100);

            cellView.model.toFront();

            var link = cellView.model;
            if (this._selectedLink && link.cid !== this._selectedLink.cid) link.hideRemoveButton();
            link.attributes.action = '';

            if (evt.target.getAttribute('class') == 'marker-arrowhead') {
                link.attributes.action = 'arrowhead-move';
            } else if (evt.target.getAttribute('class') == 'connection-wrap') {
                this._clearSelectedLink();
                this._selectedLink = cellView.model;
                link.showRemoveButton();
            } else {
                try {
                    cellView.model.toFront()
                } catch (ex) {
                    // ignore exception
                }
            }
        }
    };

    DiagramEditorPage.prototype.handleCellPointerDown = function (cellView, evt, x, y) {
        if (this.behaviorMode === BEHAVIOR_LINK) {
            this._handleLinkCellPointerDown(cellView, evt, x, y);
        } else {
            this._handleDefaultCellPointerDown(cellView, evt, x, y);
        }
    };

    DiagramEditorPage.prototype.handleCellPointerUp = function (cellView, evt, x, y) {
        var _this = this, fnUnit, figures;
        _this.hideGuideBox();

        if (cellView.model instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
            var figure = cellView.model;
            if (_this.cellPointer.state == 'Down') {
                _this.showSelectionBox([figure], true);
            }
            _this.cellPointer.state = 'Up';

            if (_this.guideMessage) {
                // revert position
                _this.hideGuideMessage();

                figures = _this.getSelectedFigures();
                $.each(figures, function (index, f) {
                    _this._revertPosition(f);
                });
            } else {
                var pos = _this.calcGuidePosition(figure);
                figure.position(pos.x, pos.y);

                _this.showTools(figure);

                // fire position changed command
                fnUnit = _this.getFnUnitById(figure.attributes.fid);
                var commands = new Brightics.VA.Core.CompoundCommand(_this, { label: 'Change Position' });
                var prevPosition = fnUnit.display.diagram.position;
                var currPosition = pos;

                figures = _this.getSelectedFigures();
                $.each(figures, function (index, f) {
                    var unit = _this.getFnUnitById(f.attributes.fid);
                    var xx = unit.display.diagram.position.x + (currPosition.x - prevPosition.x);
                    var yy = unit.display.diagram.position.y + (currPosition.y - prevPosition.y);
                    f.position(xx, yy);
                    if (unit.display.diagram.position.x != xx || unit.display.diagram.position.y != yy) {
                        commands.add(_this.createSetFnUnitPositionCommand(f, xx, yy));
                    }
                });

                _this.fireCommand(commands);

                if (figures.length == 1) {
                    setTimeout(function () {
                        _this.ensureCenter(figure);
                    }, 100);
                }
            }

            _this._rerouteLink();
            _this.showSelectionBounds();
            _this.changeCursor(cellView.model, 'pointer');
        } else if (cellView.model instanceof Brightics.VA.Core.Shapes.LinkFigure) {
            var link = cellView.model;
            if (link.attributes.action === 'arrowhead-move') {
                var message = _this.validateConnect([link]);
                if (message) {
                    _this.notification('warning', message);
                    _this._revertLink(link);
                } else {
                    var command = this.createReconnectFnUnitCommand(link);
                    this.fireCommand(command);
                    this._clearSelectedLink();
                }
            }
        }
    };

    DiagramEditorPage.prototype.handleCellMouseOver = function (cellView, evt) {
        if (this.behaviorMode === BEHAVIOR_LINK) {
            for (var i = 0; i < this._connectableFigures.length; i++) {
                if (this._connectableFigures[i].cid === cellView.model.cid) {
                    cellView.highlight();
                }
            }
        } else if (this.$dragSelection.css('display') != 'block' && this.cellPointer.state != 'Drag') {
            this.showTools(cellView.model);
            this.showToolTip(cellView.model);
        }
    };

    DiagramEditorPage.prototype.handleCellMouseOut = function (cellView, evt) {
        if (cellView.model !== this._fromCell) {
            cellView.unhighlight();
        }
        this.hideTools();
        this.hideToolTip();
    };

    DiagramEditorPage.prototype.handleBlankPointerDown = function (evt, x, y) {
        if (evt.button === 0) {
            this.$dragSelection.css({
                display: 'block',
                width: 0,
                height: 0
            });
            this.$dragSelection.attr('start-x', x * this.options.scale);
            this.$dragSelection.attr('start-y', y * this.options.scale);
        }

        if (this.behaviorMode === BEHAVIOR_LINK) {
            this._setBehaviorModeToDefault();
        } else {
            this._clearSelectedLink();
        }

        if (this.getEditor().getSheetEditorPageArea().css('visibility') == 'hidden') {
            var _this = this;
            var selections = this.getSelectedFigureIds();
            for (var i in selections) {
                var cell = this.graph.getCell(selections[i]);
                if (cell) cell.unselect();
            }
            setTimeout(function () {
                _this._triggerClickOrDoubleClickEvent(selections);
                _this.hideSelectionBox();
            }, 100);
        }
    };

    DiagramEditorPage.prototype.handleBlankPointerMove = function (evt, x, y) {
        var _this = this;
        var paperOffset = this.$paperElement.offset();
        var x = evt.pageX - paperOffset.left, y = evt.pageY - paperOffset.top;
        if (this.$dragSelection.css('display') == 'block') {
            var startX = this.$dragSelection.attr('start-x');
            var startY = this.$dragSelection.attr('start-y');
            this.$dragSelection.css({
                left: Math.min(x, startX),
                top: Math.min(y, startY),
                width: Math.abs(x - startX),
                height: Math.abs(y - startY)
            });
            setTimeout(function () {
                _this._triggerClickOrDoubleClickEvent([]);
            }, 100);
        }

        if (this.$dragSelection.css('display') == 'none' &&
            this.$tools.css('display') == 'none' &&
            this.$guideBox.css('display') == 'none' && y >= 30) {
            var xx = x;
            var yy = y;
            var gap_width = this.GAP_WIDTH || Brightics.VA.Env.Diagram.GAP_WIDTH;
            var gap_height = this.GAP_HEIGHT || Brightics.VA.Env.Diagram.GAP_HEIGHT;
            var total_width = Brightics.VA.Env.Diagram.FIGURE_WIDTH + gap_width;
            var total_height = Brightics.VA.Env.Diagram.FIGURE_HEIGHT + gap_height;
            var differenceX = xx % Number.parseInt(total_width * this.options.scale);
            var differenceY = yy % Number.parseInt(total_height * this.options.scale);
            xx = xx - differenceX;
            xx = xx + Number.parseInt(Brightics.VA.Env.Diagram.PAPER_MARGIN_LEFT * this.options.scale);
            yy = yy - differenceY;
            yy = yy + Number.parseInt(Brightics.VA.Env.Diagram.PAPER_MARGIN_TOP * this.options.scale);
            var models = this.graph.findModelsFromPoint({
                x: xx / this.options.scale,
                y: yy / this.options.scale
            });

            if (models.length == 0) {
                this.$createCue.attr('mousedown', false);
                this.$createCue.css({ display: 'flex', left: xx, top: yy });

                var label = Brightics.VA.SettingStorage.getValue('editor.function.add.doubleclick') !== 'true' ? 'Click' : 'Double-Click';
                this.$createCue.find('.brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label').first().text(label);
            }
        }
    };

    DiagramEditorPage.prototype.handleBlankPointerUp = function (evt, x, y) {
        var _this = this;

        if (this.$dragSelection.css('display') == 'block') {
            var width = this.$dragSelection.width();
            var height = this.$dragSelection.height();
            if (width > 10 && height > 10) {
                var pos = this.$dragSelection.position();
                var bounds = new g.rect(pos.left / this.options.scale, pos.top / this.options.scale, width / this.options.scale, height / this.options.scale);
                var models = this.graph.findModelsInArea(bounds);
                if (models.length > 0) {
                    this.showSelectionBox(models);
                    if (models.length == 1) setTimeout(function () {
                        _this.ensureCenter(models[0]);
                    }, 100);
                }
            }

            this.$dragSelection.css({
                display: 'none'
            });
        }
    };


    DiagramEditorPage.prototype.configureSelectionBounds = function (figures) {
        this.$multiTools.toggleClass('single-selected', figures.length === 1);
    };

    DiagramEditorPage.prototype.showSelectionBounds = function () {
        var selectedRect;
        var figures = this.getSelectedFigures();
        var readOnlyFigureSelected = false;
        if (figures.length > 0) {
            for (var i in figures) {
                readOnlyFigureSelected =
                    readOnlyFigureSelected || this.isReadOnlyFigure(figures[i]);
                if (selectedRect) {
                    selectedRect.top = Math.min(selectedRect.top, figures[i].attributes.position.y);
                    selectedRect.left = Math.min(selectedRect.left, figures[i].attributes.position.x);
                    selectedRect.bottom = Math.max(selectedRect.bottom, figures[i].attributes.position.y + Brightics.VA.Env.Diagram.FIGURE_HEIGHT);
                    selectedRect.right = Math.max(selectedRect.right, figures[i].attributes.position.x + Brightics.VA.Env.Diagram.FIGURE_WIDTH);
                } else {
                    selectedRect = {
                        top: figures[i].attributes.position.y,
                        left: figures[i].attributes.position.x,
                        bottom: figures[i].attributes.position.y + Brightics.VA.Env.Diagram.FIGURE_HEIGHT,
                        right: figures[i].attributes.position.x + Brightics.VA.Env.Diagram.FIGURE_WIDTH
                    };
                }
            }

            var top = (selectedRect.top * this.options.scale);
            var left = (selectedRect.left * this.options.scale) + 3;
            var width = ((selectedRect.right - selectedRect.left) * this.options.scale) - 5;
            var height = ((selectedRect.bottom - selectedRect.top) * this.options.scale);
            if (Brightics.VA.Implementation.DataFlow && this.getModel().type === Brightics.VA.Implementation.DataFlow.Clazz) {
                height += 7;
            }
            this.$selectedBounds.css({ display: 'block', top: top, left: left, width: width, height: height });
        } else {
            this.$selectedBounds.css({
                display: 'none'
            });
        }
        this.getEditor().setEditorState('readonly-figure-selected', readOnlyFigureSelected);
        this.$multiTools
            .toggleClass('readonly-figure-selected',
                readOnlyFigureSelected);
    };

    DiagramEditorPage.prototype.hideSelectionBounds = function () {
        if (this.$selectedBounds) this.$selectedBounds.hide();
    };

    DiagramEditorPage.prototype.showSelectionBox = function (figures, triggerEvent) {
        var _this = this;
        var i;
        var oldSelections = this.getSelectedFigureIds();
        var fnUnitIds = [];
        this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected').remove();
        for (i in figures) {
            if (figures[i] instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
                var $selected = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-selected"></div>');
                $selected.attr('cid', figures[i].cid);
                $selected.css({
                    top: figures[i].attributes.position.y - 1,
                    left: figures[i].attributes.position.x - 2
                });
                this.$paperElement.prepend($selected);

                fnUnitIds.push(figures[i].attributes.fid);
            }
        }

        var newSelections = this.getSelectedFigureIds();
        for (i in oldSelections) {
            var cell = this.graph.getCell(oldSelections[i]);
            if (cell) cell.unselect();
        }
        for (i in figures) {
            figures[i].select();
        }

        var fireEvent = false;
        if (triggerEvent == true) {
            fireEvent = true;
        } else if (triggerEvent == false) {
            fireEvent = false;
        } else {
            fireEvent = JSON.stringify(oldSelections) !== JSON.stringify(newSelections);
        }
        if (fireEvent) {
            setTimeout(function () {
                _this._triggerClickOrDoubleClickEvent(fnUnitIds);
            }, 100);
        }

        this.configureSelectionBounds(figures);
        this.showSelectionBounds();
    };

    DiagramEditorPage.prototype.updateSelectionBox = function (figure) {
        if (figure instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
            var $selected = this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected[cid="' + figure.cid + '"]');
            $selected.css({
                top: figure.attributes.position.y - 3,
                left: figure.attributes.position.x - 3
            });
        }
    };

    DiagramEditorPage.prototype.hideSelectionBox = function (figure) {
        var oldSelections = this.getSelectedFigureIds();

        if (figure) {
            figure.unselect();

            var $selected = this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected[cid="' + figure.cid + '"]');
            $selected.remove();
        } else {
            this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected').remove();
        }

        var newSelections = this.getSelectedFigureIds();
        if (JSON.stringify(oldSelections) !== JSON.stringify(newSelections)) {
            var i;
            var fnUnitIds = [];
            for (i in newSelections) {
                var cid = newSelections[i];
                fnUnitIds.push(this.graph.getCell(cid).attributes.fid);
            }

            for (i in oldSelections) {
                var cell = this.graph.getCell(oldSelections[i]);
                if (cell) cell.unselect();
            }
            for (i in newSelections) {
                this.graph.getCell(newSelections[i]).select();
            }

            var _this = this;
            setTimeout(function () {
                _this._triggerClickOrDoubleClickEvent(fnUnitIds);
            }, 100);
        }

        this.showSelectionBounds();
    };

    DiagramEditorPage.prototype._triggerClickOrDoubleClickEvent = function (fnUnitIds) {
        var _this = this;
        var unset = function (obj, path) {
            if (obj[path]) {
                obj[path] = undefined;
                delete obj[path];
            }
        };
        if (fnUnitIds.length == 1) {
            if (this.prvFnUnitSelectTrigger[fnUnitIds[0]]) {
                this.$parent.trigger('fnUnit:dbclick', [fnUnitIds]);
                clearTimeout(_this.prvFnUnitSelectTrigger[fnUnitIds[0]]);
                unset(this.prvFnUnitSelectTrigger, fnUnitIds[0]);
            } else {
                this.prvFnUnitSelectTrigger[fnUnitIds[0]] = setTimeout(function () {
                    _this.$parent.trigger('fnUnit:select', [fnUnitIds]);
                    clearTimeout(_this.prvFnUnitSelectTrigger[fnUnitIds[0]]);
                    unset(_this.prvFnUnitSelectTrigger, fnUnitIds[0]);
                }, DOUBLE_CLICK_INTERVAL);
            }
        } else {
            this.$parent.trigger('fnUnit:select', [fnUnitIds]);
        }
    };

    DiagramEditorPage.prototype.showErrorBox = function (figures) {
        for (var i in figures) {
            if (figures[i] instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
                figures[i].showError();
            }
        }
    };

    DiagramEditorPage.prototype.updateErrorBox = function (figure) {
    };

    DiagramEditorPage.prototype.hideErrorBox = function () {
        var figures = this.graph.getElements();
        for (var i in figures) {
            figures[i].hideError();
        }
    };

    DiagramEditorPage.prototype.createToolTip = function () {
        this.$validationTooltip = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools-validation-tooltip"></div>');
        this.$tools.append(this.$validationTooltip);
        this.$validationTooltip.css('display', 'none');

    };

    DiagramEditorPage.prototype.showValidationToolTip = function (figure) {
        this.$validationTooltip.empty();
        for (var i in this.problems) {
            if (this.problems[i].fid === figure.attributes.fid) {
                var $problem = $('<div class="brtc-va-editors-diagram-diagrameditorpage-validation-problem">' +
                    '<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ' + this.problems[i].message +
                    '</div>');
                this.$validationTooltip.append($problem);
            }
        }
        this.$validationTooltip.css('display', 'block');
    };

    DiagramEditorPage.prototype.hideValidationToolTip = function () {
        if (this.$validationTooltip) this.$validationTooltip.css('display', 'none');
    };

    DiagramEditorPage.prototype.validateTranslate = function (figures) {
        for (var i in figures) {
            var figure = figures[i];
            var message;
            if (this.checkOverPosition(figure) === false) message = 'Can not move over other function.';
            else if (this.checkOutRangePosition(figure) === false) message = 'Can not move out of range.';
            if (message) {
                this.translateProblems[figure.cid] = message;
            } else {
                delete this.translateProblems[figure.cid];
            }
        }

        return this.translateProblems;
    };

    DiagramEditorPage.prototype.validateConnect = function (links) {
        for (var i in links) {
            var link = links[i];
            if (this.checkConnectedLink(link) === false) return 'No connection could be made.';
            else if (this.checkLoopLink(link) === false) return 'No connection could be made because connection loop.';
            else if (this.checkAlreadyExistLink(link) === false) return 'No connection could be made because connection already exists.';

            if (this.checkAlreadyExistLinkByTableId(link) === false) return 'No connection could be made because connection already exists.';
        }
    };

    DiagramEditorPage.prototype.notification = function (template, message) {
        var editor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);
        editor.notification(template, message);
    };

    DiagramEditorPage.prototype.createCue = function () {
        var _this = this;
        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                var fnUnit = _this.getModel().newFnUnit(dialogResult.func);
                var pos = dialogResult.position;
                fnUnit.display.diagram.position = _this.calcGuideLocation(pos.left / _this.options.scale, pos.top / _this.options.scale);
                var figure = _this.createFnUnitFigure(fnUnit);
                _this.graph.addCells([figure]);

                var command = new Brightics.VA.Core.CompoundCommand(_this, { label: 'Create a Function' });
                var links = [];
                if (Brightics.VA.SettingStorage.getValue('editor.diagram.autoconnect') === 'true') links = _this.connectSmartly(figure);
                if (links.length > 0) {
                    command.add(_this.createNewFnUnitCommand(figure, fnUnit));
                    for (var i in links) {
                        command.add(_this.createConnectFnUnitCommand(links[i]));
                    }
                } else {
                    command.add(_this.createNewFnUnitCommand(figure, fnUnit));
                }
                _this.fireCommand(command);
                _this.$createCue.css({ display: 'none' });
                _this.showSelectionBox([figure]);
            }

            _this.switchFnUnitDialog = null;
        };

        if (!this.getFunctionsLength()) {
            this.$createCue.css({
                display: 'flex',
                left: '19.5px',
                top: '27px'
            })
        }

        this.$createCue.find('.brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label-wrapper').mousedown(function (event) {
            _this.$createCue.attr('mousedown', true);
            var localPoint = _this.paper.snapToGrid({ x: event.clientX, y: event.clientY });
            _this.$dragSelection.css({
                display: 'block',
                width: 0,
                height: 0
            });
            _this.$dragSelection.attr('start-x', localPoint.x * _this.options.scale);
            _this.$dragSelection.attr('start-y', localPoint.y * _this.options.scale);
        });

        this.$createCue.find('.brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label-wrapper').mouseup(function (event) {
            if (Brightics.VA.SettingStorage.getValue('editor.function.add.doubleclick') === 'true') return;
            if (_this.$createCue.attr('mousedown') === 'false') return;

            _this.MAX_FUNC_COUNT = Brightics.VA.SettingStorage.getValue('editor.maxfuncnum');
            _this.MAX_FUNC_MESSAGE = 'You can only add up to ' + _this.MAX_FUNC_COUNT + '.';

            if (_this.getFunctionsLength() + 1 > _this.MAX_FUNC_COUNT) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(_this.MAX_FUNC_MESSAGE);
            } else {
                _this.switchFnUnitDialog = new Brightics.VA.Core.Dialogs.SwitchFnUnitDialog($(event.target), {
                    modelType: _this.getModel().type,
                    close: closeHandler,
                    position: _this.$createCue.position()
                });
            }
        });

        this.$createCue.find('.brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label-wrapper').dblclick(function (event) {
            if (Brightics.VA.SettingStorage.getValue('editor.function.add.doubleclick') !== 'true') return;

            if (_this.getFunctionsLength() + 1 > _this.MAX_FUNC_COUNT) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(_this.MAX_FUNC_MESSAGE);
            } else {
                _this.switchFnUnitDialog = new Brightics.VA.Core.Dialogs.SwitchFnUnitDialog($(event.target), {
                    modelType: _this.getModel().type,
                    close: closeHandler,
                    position: _this.$createCue.position()
                });
            }
        });
    };

    DiagramEditorPage.prototype.createFnUnitToolbar = function () {
        var _this = this;

        this.$tools = this.$mainControl.find('.brtc-va-editors-diagram-diagrameditorpage-function-toolbar');
        this.$tools.hover(function () {
            _this.clearHideToolsTimer();
        }, function () {
            _this.hideTools(false);
        });

        this.createRemoveToolItem();
        this.createClearLinkToolItem();
        this.createShiftLeftToolItem();
        this.createShiftRightToolItem();
        this.createSwitchToolItem();
        this.createStartRunToolItem();
        this.createCloneAndConnectToolItem();
        this.createConnectToolItem();
        this.createCloneToolItem();
        this.createEnterToolItem();
        this.createPopupToolItem();
        // this.createToolTip();
    };

    DiagramEditorPage.prototype.createEnterToolItem = function () {
        var _this = this;
        var $enter = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-enter" title="Step Into"></div>');
        this.$tools.append($enter);
        $enter.click(function () {
            var cid = _this.$tools.attr('cid');
            var figure = _this.graph.getCell(cid);
            _this.hideTools(true);
            _this.$parent.trigger('fnUnit:dbclick', [[figure.attributes.fid]]);
        });
        this.toolItems.enter = $enter;
    };

    DiagramEditorPage.prototype.createPopupToolItem = function () {
        var _this = this;
        var $popup = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-popup" title="Popup"></div>');
        this.$tools.append($popup);
        $popup.click(function (event) {
            var cid = _this.$tools.attr('cid');
            var figure = _this.graph.getCell(cid);
            _this.hideTools(true);

            var fnUnit = _this.getFnUnitById(figure.attributes.fid);
            var clonedFnUnit = $.extend(true, {}, fnUnit);
            var func = fnUnit.func;

            var anchorOffset = $(event.target).offset();
            var pos = {
                x: anchorOffset.left - 402 + 26,
                y: anchorOffset.top - 10 + 40
            };

            //원래는 propertiespanel에서 구현된 내용을 그대로 쓰는것으로 컨셉을 잡았으나...
            //일단 dialog로 해결...
            var TargetDialog;
            switch (func) {
                case "setValue":
                    TargetDialog = Brightics.VA.Core.Dialogs.SetValueSettingDialog;
                    break;
                case "import":
                    TargetDialog = Brightics.VA.Core.Dialogs.ImportDataSettingDialog;
                    break;
                case "export":
                    TargetDialog = Brightics.VA.Core.Dialogs.ExportDataSettingDialog;
                    break;
                case "unloadModel":
                    TargetDialog = Brightics.VA.Core.Dialogs.UnloadModelSettingDialog;
                    break;
            }

            new TargetDialog(_this.$mainControl, {
                event: event,
                editor: _this.getEditor(),
                fnUnit: clonedFnUnit,
                param: clonedFnUnit.param,
                position: pos,
                title: 'Setting Configuration',
                close: function (dialogResult) {
                    if (dialogResult.OK && dialogResult.results) {
                        _this.createSetDialogFnUnitCommand(dialogResult.results.fnUnit, fnUnit);
                    }
                }
            });

        });
        this.toolItems.popup = $popup;
    };

    DiagramEditorPage.prototype.createSetDialogFnUnitCommand = function (newFnUnit, oldFnUnit) {
        var commands = new Brightics.VA.Core.CompoundCommand(this, { label: 'Change a Function' });

        var paramCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetDialogFnUnitCommand(this, {
            fnUnit: oldFnUnit,
            ref: { param: newFnUnit.param }
        });

        var renameCommand = new Brightics.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this, {
            fid: newFnUnit.fid,
            name: newFnUnit.display.label,
            description: newFnUnit.display.description
        });

        commands.add(paramCommand);
        commands.add(renameCommand);

        var modelEditorRef = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);
        if (modelEditorRef) {
            modelEditorRef.getCommandManager().execute(commands);
        }
    };

    DiagramEditorPage.prototype.createConfigurationCommand = function (param, fnUnit) {
        var commandOption = {
            fnUnit: fnUnit,
            ref: { param: param }
        };

        var command = new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this, commandOption);
        var modelEditorRef = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);
        if (modelEditorRef) {
            modelEditorRef.getCommandManager().execute(command);
        }
    };

    DiagramEditorPage.prototype.createRemoveToolItem = function () {
        var _this = this;

        var $remove = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-remove" title="Remove"></div>');
        this.$tools.append($remove);

        $remove.click(function () {
            var cid = _this.$tools.attr('cid');
            var figure = _this.graph.getCell(cid);
            _this.removeFnUnitFigure(figure);
            _this.hideTools(true);
        });
        this.toolItems.remove = $remove;
    };

    DiagramEditorPage.prototype.createClearLinkToolItem = function () {
        var _this = this;

        var $clearLink = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-clearlink"><i class="fa fa-chain-broken"></i></div>');
        this.$tools.append($clearLink);

        $clearLink.click(function () {
            var cid = _this.$tools.attr('cid');
            var figure = _this.graph.getCell(cid);
            _this.removeFnUnitLink(figure);
        });
        this.toolItems.clearLink = $clearLink;
    };

    DiagramEditorPage.prototype.createShiftLeftToolItem = function () {
        var _this = this;

        var $shiftLeft = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-shiftleft brtc-style-flex-center"><i class="fa fa-angle-double-left fa-lg"></i></div>');
        this.$tools.append($shiftLeft);

        $shiftLeft.click(function () {
            var cid = _this.$tools.attr('cid');
            var figure = _this.graph.getCell(cid);
            var command = _this.createShiftLeftCommand(figure);
            if (_this.fireCommand(command) === false) {
                _this.notification('warning', command.message);
            } else {
                _this.hideSelectionBounds();
            }
        });
        this.toolItems.shiftLeft = $shiftLeft;
    };

    DiagramEditorPage.prototype.createShiftRightToolItem = function () {
        var _this = this;

        var $shiftRight = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-shiftright brtc-style-flex-center"><i class="fa fa-angle-double-right fa-lg"></i></div>');
        this.$tools.append($shiftRight);

        $shiftRight.click(function () {
            var cid = _this.$tools.attr('cid');
            var figure = _this.graph.getCell(cid);
            var command = _this.createShiftRightCommand(figure);
            _this.fireCommand(command);
            _this.hideSelectionBounds();
        });
        this.toolItems.shiftRight = $shiftRight;
    };

    DiagramEditorPage.prototype.createSwitchToolItem = function () {
        var _this = this;

        var $switch = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-switch" title="Change Function"></div>');
        this.$tools.append($switch);

        $switch.click(function (event) {
            var closeHandler = function (dialogResult) {
                if (dialogResult.OK) {
                    var cid = _this.$tools.attr('cid');
                    var figure = _this.graph.getCell(cid);
                    var currUnit = _this.getFnUnitById(figure.attributes.fid);
                    if (currUnit.func !== dialogResult.func) {
                        var replaceUnit = _this.getModel().newFnUnit(dialogResult.func);
                        replaceUnit.display.diagram.position = $.extend({}, currUnit.display.diagram.position);
                        var command = _this.createSwitchFnUnitCommand(figure, replaceUnit, currUnit);
                        command.event.source = this;
                        _this.fireCommand(command);
                    }
                }

                _this.switchFnUnitDialog = null;
            };

            var preCid = _this.$tools.attr('cid');
            var preFigure = _this.graph.getCell(preCid);
            var preFnUnit = _this.getModel().getPrevious(preFigure.attributes.fid);
            _this.switchFnUnitDialog = new Brightics.VA.Core.Dialogs.SwitchFnUnitDialog($(event.target), {
                preFnUnit: _this.getFnUnitById(preFnUnit[0]),
                modelType: _this.getModel().type,
                close: closeHandler
            });
        });
        this.toolItems.switch = $switch;
    };

    DiagramEditorPage.prototype.createStartRunToolItem = function () {
        //do nothing
    };

    DiagramEditorPage.prototype.createCloneAndConnectToolItem = function () {
        var _this = this;

        var $cloneAndConnect = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-cloneandconnect"><i class="fa fa-random"></i></div>');
        this.$tools.append($cloneAndConnect);
        $cloneAndConnect.click(function () {
            _this.notification('info', 'Click and drag to clone and connect function in one go');
        });

        $cloneAndConnect.draggable({
            appendTo: _this.$paperElement,
            helper: function (event) {
                return $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools-clone-helper"></div>');
            },
            start: function (event, ui) {
                var cid = _this.$tools.attr('cid');
                var model = _this.graph.getCell(cid);

                // need to change about 'id' & 'out-table'
                var duplicated = model.clone();
                duplicated.category = model.category;
                duplicated.unselect();

                _this.duplicatedFnUnit = Brightics.VA.Core.Utils.ModelUtils.cloneFnUnit(_this.getFnUnitById(duplicated.attributes.fid));

                duplicated.attributes.dummy = true;
                duplicated.attributes.fid = _this.duplicatedFnUnit.fid;

                var x = ui.position.left - model.attributes.position.x;
                var y = ui.position.top - model.attributes.position.y;
                duplicated.translate(x, y);
                _this.graph.addCells([duplicated]);
                duplicated.toFront({ deep: true });

                ui.helper.attr('cid', duplicated.cid);
                _this.showGuideBox(duplicated);

                if (duplicated.attributes.inputtable) {
                    var linkUnit = {
                        kid: Brightics.VA.Core.Utils.IDGenerator.link.id(),
                        'sourceFid': model.attributes.fid,
                        'targetFid': duplicated.attributes.fid
                    };
                    var link = _this.createLinkFigure(linkUnit);
                    if (link) {
                        _this.graph.addCells([link]);
                        link.toBack();
                        ui.helper.attr('link-cid', link.cid);
                    }
                }
            },
            drag: function (event, ui) {
                var cid = ui.helper.attr('cid');
                var duplicated = _this.graph.getCell(cid);
                var x = ui.position.left - duplicated.attributes.position.x;
                var y = ui.position.top - duplicated.attributes.position.y;
                duplicated.translate(x, y);
            },
            stop: function (event, ui) {
                var cid, duplicated, linkId, link;
                if (_this.guideMessage) {
                    _this.hideGuideBox();
                    _this.hideGuideMessage();

                    cid = ui.helper.attr('cid');
                    linkId = ui.helper.attr('link-cid');
                    if (linkId) {
                        _this.graph.getCell(linkId).remove();
                    }
                    _this.graph.getCell(cid).remove();
                } else {
                    cid = ui.helper.attr('cid');
                    duplicated = _this.graph.getCell(cid);
                    var x = ui.position.left - duplicated.attributes.position.x;
                    var y = ui.position.top - duplicated.attributes.position.y;
                    duplicated.translate(x, y);
                    var pos = _this.calcGuidePosition(duplicated);
                    duplicated.attributes.dummy = false;
                    duplicated.position(pos.x, pos.y);

                    _this.hideGuideBox();

                    var commands = new Brightics.VA.Core.CompoundCommand(_this, { label: 'Clone and Connect' });
                    commands.add(_this.createNewFnUnitCommand(duplicated, _this.duplicatedFnUnit));
                    commands.add(_this.createSetFnUnitPositionCommand(duplicated, pos.x, pos.y));

                    linkId = ui.helper.attr('link-cid');
                    if (linkId) {
                        link = _this.graph.getCell(linkId);
                        commands.add(_this.createConnectFnUnitCommand(link));
                    }

                    _this.fireCommand(commands);

                    var closeHandler = function (dialogResult) {
                        if (dialogResult.OK) {
                            var currUnit = _this.duplicatedFnUnit;
                            if (currUnit.func !== dialogResult.func) {
                                var replaceUnit = _this.getModel().newFnUnit(dialogResult.func);
                                replaceUnit.display.diagram.position = $.extend({}, currUnit.display.diagram.position);
                                var command = _this.createSwitchFnUnitCommand(duplicated, replaceUnit, currUnit);
                                command.event.source = this;
                                _this.fireCommand(command);
                            }
                        }

                        _this.switchFnUnitDialog = null;
                    };
                    _this.switchFnUnitDialog = new Brightics.VA.Core.Dialogs.SwitchFnUnitDialog(ui.helper, {
                        preFnUnit: _this.duplicatedFnUnit,
                        modelType: _this.getModel().type,
                        close: closeHandler
                    });
                }
            }
        });
        this.toolItems.cloneAndConnect = $cloneAndConnect;
    };

    DiagramEditorPage.prototype.setConnectToolItemVisible = function (visibled) {
        var connectTool = this.$tools.find('.brtc-va-editors-diagram-diagrameditorpage-function-tools-connect');
        if (!visibled) {
            connectTool.css('display', 'none');
        } else {
            connectTool.css('display', 'block');
        }
    };

    DiagramEditorPage.prototype._findConnectableFigures = function (fromCell) {
        var connectableFigures = [];
        var _this = this;

        var connectableFids = this._getConnectableFids(fromCell.attributes.fid);

        if (fromCell.attributes.connectableFunctions) {
            connectableFids = connectableFids.filter(function (fid) {
                var fromFnUnit = _this.getFnUnitById(fid);
                return fromCell.attributes.connectableFunctions.indexOf(fromFnUnit.func) >= 0;
            });
        }

        var figure;

        var connectedCellCids = [];

        var _link = this.graph.getConnectedLinks(fromCell);

        for (var i in _link) {
            connectedCellCids.push(_link[i].getTargetElement().cid);
        }

        for (var i in connectableFids) {
            figure = this.getFigureByFnUnitId(connectableFids[i]);
            if (fromCell.attributes.connectableFunctions) {
                if (connectedCellCids.indexOf(figure.cid) < 0) {
                    connectableFigures.push(figure);
                    figure.setCursorType('pointer');
                }
            } else {
                if (figure.attributes.inputtable && connectedCellCids.indexOf(figure.cid) < 0) {
                    connectableFigures.push(figure);
                    figure.setCursorType('pointer');
                }
            }
        }

        return connectableFigures;
    };

    DiagramEditorPage.prototype._setBehaviorModeToLink = function () {
        var _this = this;
        this.behaviorMode = BEHAVIOR_LINK;
        var figures = this.graph.getElements();
        for (var i in figures) {
            if (figures[i] instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
                if (!this._isConnectableCell(figures[i])) {
                    figures[i].setOnShade();
                }
            }
        }

        setTimeout(function () {
            _this._clearSelectedLink();
            _this.hideSelectionBox();
        }, 100);
    };

    DiagramEditorPage.prototype._setBehaviorModeToDefault = function () {
        this.behaviorMode = BEHAVIOR_DEFAULT;
        var figures = this.graph.getElements();
        for (var i in figures) {
            if (figures[i] instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
                figures[i].setOffShade();
                figures[i].setCursorType('inherit');
            }
        }
        this._connectableFigures = [];
        this._unhighlightAll();
    };


    DiagramEditorPage.prototype._isConnectableCell = function (figure) {
        var isConnectable = false;
        for (var i in this._connectableFigures) {
            if (this._connectableFigures[i] === figure) {
                isConnectable = true;
                break;
            }
        }
        return isConnectable;
    };

    DiagramEditorPage.prototype.createConnectToolItem = function () {
        var _this = this;
        var fromCell, link;
        var $link = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-connect" title="Connect"></div>');
        this.$tools.append($link);

        $link.click(function () {
            _this.cellPointer = {};
            _this.cellPointer.state = 'link';

            var cid = _this.$tools.attr('cid');
            fromCell = _this.graph.getCell(cid);
            var fromCellView = _this.paper.findViewByModel(fromCell);
            _this._highlightedViews.push(fromCellView);
            fromCellView.highlight();
            _this._connectableFigures = _this._findConnectableFigures(fromCell);
            _this._fromCell = fromCell;
            _this._setBehaviorModeToLink();
        });

        $link.draggable({
            appendTo: _this.$paperElement,
            helper: function (event) {
                return $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools-link-helper"></div>');
            },
            start: function (event, ui) {
                var cid = _this.$tools.attr('cid');
                fromCell = _this.graph.getCell(cid);
                var kid = Brightics.VA.Core.Utils.IDGenerator.link.id();
                link = _this._createLinkFigure(kid, fromCell, {
                    x: ui.position.left / _this.options.scale,
                    y: ui.position.top / _this.options.scale
                });
                _this.graph.addCells([link]);
                ui.helper.attr('cid', link.cid);
            },
            drag: function (event, ui) {
                var cid = ui.helper.attr('cid');
                // link = _this.graph.getCell(cid);
                var models = _this.graph.findModelsFromPoint({
                    x: ui.position.left / _this.options.scale,
                    y: ui.position.top / _this.options.scale
                });
                _this._unhighlightAll();

                var sourceModel = fromCell;

                if (models.length > 0 && _this._isConnectableFnUnit(sourceModel, models[0])) {
                    link.set('target', { id: models[0].id, port: IN_PORT_ID });
                    _this.paper.findViewByModel(link).update();
                    var highlightedView = _this.paper.findViewByModel(models[0]);
                    _this._highlightedViews.push(highlightedView);
                    highlightedView.highlight();
                } else {
                    link.set('target', {
                        x: ui.position.left / _this.options.scale,
                        y: ui.position.top / _this.options.scale
                    });
                    _this.paper.findViewByModel(link).update();
                }
            },
            stop: function (event, ui) {
                _this._unhighlightAll();
                var cid = ui.helper.attr('cid');
                // link = _this.graph.getCell(cid);
                var models = _this.graph.findModelsFromPoint({
                    x: ui.position.left / _this.options.scale,
                    y: ui.position.top / _this.options.scale
                });
                if (models.length > 0) {
                    if (link.attributes.source.id == models[0].id) {
                        link.remove();
                        _this.notification('warning', 'No connection could be made because connection loop.');
                    } else {
                        var message = _this.validateConnect([link]);
                        if (message) {
                            _this.notification('warning', message);
                            link.remove();
                        } else {
                            var command = _this.createConnectFnUnitCommand(link);
                            if (_this.fireCommand(command)) {
                                link.set('target', { id: models[0].id, port: IN_PORT_ID });
                                _this.paper.findViewByModel(link).update();
                            } else {
                                link.remove();
                                _this.notification('warning', 'No connection could be made because connection already exists.');
                            }
                        }
                    }
                } else {
                    link.remove();
                    _this.notification('warning', 'No connection could be made.');
                }
            },
            scope: 'tasks'
        });
        this.toolItems.connect = $link;
    };

    DiagramEditorPage.prototype._isConnectableFnUnit = function (fromCell, targetCell) {

        var isConnectable = false;
        var connectableFunctions = fromCell.attributes.connectableFunctions;
        var acceptableFunctions = targetCell.attributes.acceptableFunctions;

        if (connectableFunctions) {
            var targetFnUnit = this.getFnUnitById(targetCell.attributes.fid);
            for (var i = 0; i < connectableFunctions.length; i++) {
                if (connectableFunctions[i] === targetFnUnit.func) {
                    isConnectable = true;
                    break;
                }
            }
        } else if (acceptableFunctions) {
            var fromFnUnit = this.getFnUnitById(fromCell.attributes.fid);
            isConnectable = _.indexOf(acceptableFunctions, fromFnUnit.func) >= 0;
        } else if (targetCell.attributes.inputtable) {
            isConnectable = true;
        }

        return isConnectable;
    };

    DiagramEditorPage.prototype._unhighlightAll = function () {
        for (var i = 0; i < this._highlightedViews.length; i++) {
            this._highlightedViews[i].unhighlight();
        }
        this._highlightedViews = [];
    };

    DiagramEditorPage.prototype.createCloneToolItem = function () {
        var _this = this;

        var $duplicate = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-clone" title="Duplicate"></div>');
        this.$tools.append($duplicate);

        $duplicate.click(function () {
            _this.notification('info', 'Click and drag to clone function');
        });

        $duplicate.draggable({
            appendTo: _this.$paperElement,
            helper: function (event) {
                return $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools-clone-helper"></div>');
            },
            start: function (event, ui) {
                var cid = _this.$tools.attr('cid');
                var model = _this.graph.getCell(cid);

                // need to change about 'id' & 'outData'
                var duplicated = model.clone();
                duplicated.unselect();
                duplicated.resetRuntime();

                var dummy = {
                    functions: [_.cloneDeep(_this.getFnUnitById(duplicated.attributes.fid))],
                    links: [],
                    innerModels: {},
                    type: 'data'
                };
                dummy.innerModels = _this._collectInnerModels(_this.getEditor().getModel(), dummy);

                var dummyModel = Brightics.VA.Core.Utils.ModelUtils.cloneModel(dummy);

                _this.duplicatedFnUnit = dummyModel.functions[0];
                FnUnitUtils.clearInData(_this.duplicatedFnUnit);

                _this.duplicatedDummyModel = dummyModel;

                duplicated.attributes.dummy = true;
                duplicated.attributes.fid = _this.duplicatedFnUnit.fid;

                var x = ui.position.left / _this.options.scale - model.attributes.position.x;
                var y = ui.position.top / _this.options.scale - model.attributes.position.y;
                duplicated.translate(x, y);
                _this.graph.addCells([duplicated]);
                duplicated.toFront({ deep: true });

                ui.helper.attr('cid', duplicated.cid);
                _this.showGuideBox(duplicated);
            },
            drag: function (event, ui) {
                var cid = ui.helper.attr('cid');
                var duplicated = _this.graph.getCell(cid);
                var x = ui.position.left / _this.options.scale - duplicated.attributes.position.x;
                var y = ui.position.top / _this.options.scale - duplicated.attributes.position.y;
                duplicated.translate(x, y);
            },
            stop: function (event, ui) {
                var cid, duplicated;
                if (_this.guideMessage) {
                    _this.hideGuideBox();
                    _this.hideGuideMessage();

                    cid = ui.helper.attr('cid');
                    _this.graph.getCell(cid).remove();
                } else if (_this.getFunctionsLength() + 1 > _this.MAX_FUNC_COUNT) {
                    _this.hideGuideBox();
                    _this.hideGuideMessage();

                    cid = ui.helper.attr('cid');
                    _this.graph.getCell(cid).remove();
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(_this.MAX_FUNC_MESSAGE);
                } else {
                    cid = ui.helper.attr('cid');
                    duplicated = _this.graph.getCell(cid);
                    var x = ui.position.left / _this.options.scale - duplicated.attributes.position.x;
                    var y = ui.position.top / _this.options.scale - duplicated.attributes.position.y;
                    duplicated.translate(x, y);
                    _this.hideGuideBox();
                    var pos = _this.calcGuidePosition(duplicated);
                    duplicated.position(pos.x, pos.y);
                    duplicated.attributes.dummy = false;

                    var links = [];
                    if (Brightics.VA.SettingStorage.getValue('editor.diagram.autoconnect') === 'true') links = _this.connectSmartly(duplicated);

                    var commands = new Brightics.VA.Core.CompoundCommand(_this, { label: 'Clone a Function' });

                    commands.add(_this.createNewFnUnitCommand(duplicated,
                        _this.duplicatedFnUnit,
                        _this.duplicatedDummyModel));

                    commands.add(_this.createSetFnUnitPositionCommand(duplicated, pos.x, pos.y));
                    for (var i in links) {
                        commands.add(_this.createConnectFnUnitCommand(links[i]));
                    }
                    _this.fireCommand(commands);
                    _this.showSelectionBox([duplicated]);
                }
            }
        });
        this.toolItems.duplicate = $duplicate;
    };

    DiagramEditorPage.prototype.createMultiSelectionToolbar = function () {
        var _this = this;

        this.$multiTools = this.$mainControl.find('.brtc-va-editors-diagram-diagrameditorpage-function-multiselected');
        this.$multiTools.append('' +
            '<div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-toolbar">' +
            '   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-remove" title="Remove"></div>' +
            '   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-add-library" title="Add to Template"></div>' +
            '   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-run" title="Run"></div>' +
            '   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-add-clipboard" title="Add to Clipboard"></div>' +
            '   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-bind-functions" title="Bind for OPT"></div>' +
            '</div>');

        var $remove = this.$multiTools.find('.brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-remove');
        $remove.click(function () {
            var figures = _this.getSelectedFigures();
            _this.removeFnUnitFigures(figures);
        });

        var $addLibrary = this.$multiTools.find('.brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-add-library');
        $addLibrary.click(function () {
            if (_this.getEditor().getEditorState('readonly-figure-selected')) return;
            var template = _this.makeTemplate.call(_this);

            var editor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
            editor.addToLibrary(template);
        });

        var $addClippboard = this.$multiTools.find('.brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-add-clipboard');
        $addClippboard.click(function () {
            if (_this.getEditor().getEditorState('readonly-figure-selected')) return;
            var template = _this.makeTemplate.call(_this);

            var editor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
            editor.addToFunctionClipboard(template);
        });

        var $run = this.$multiTools.find('.brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-run');
        $run.click(function () {
            var fnUnit, figure;
            var link;
            var original = _this.getModel();
            var virtual = $.extend(true, {}, original);
            virtual.functions = [];
            var figures = _this.getSelectedFigures();
            var fids = [];
            for (var f in figures) {
                figure = figures[f];
                fnUnit = $.extend(true, {}, _this.getFnUnitById(figure.attributes.fid));
                virtual.addFnUnit(fnUnit);
                fids.push(fnUnit.fid);
            }
            var removeLinks = [];
            for (var k in virtual.links) {
                link = virtual.links[k];
                if (fids.indexOf(link[SOURCE_FID]) < 0 || fids.indexOf(link[TARGET_FID]) < 0) {
                    removeLinks.push(link);
                }
            }
            for (var r in removeLinks) {
                virtual.links.splice(virtual.links.indexOf(removeLinks[r]), 1);
            }

            var closeHandler = function (dialogResult) {
                if (dialogResult.OK) {
                    Brightics.VA.Core.DataQueryTemplate.removeCache(virtual.mid);
                    Studio.getJobExecutor().launchModel(virtual, dialogResult.args);
                }
            };

            if (Brightics.VA.SettingStorage.getValue('editor.variable.visible') === 'true' &&
                Object.keys(_this.getEditor().getModel().variables).length > 0) {
                new Brightics.VA.Core.Dialogs.RunDataDialog($(this), {
                    close: closeHandler,
                    analyticsModel: _this.getEditor().getModel()
                });
            } else {
                var defaultArgs = {};
                for (var key in _this.getEditor().getModel().variables) {
                    var gvDef = _this.getEditor().getModel().variables[key];
                    var temp;
                    if (_.isArray(gvDef.value) && gvDef.value.length === 1) {
                        temp = gvDef.value[0];
                    } else {
                        temp = gvDef.value;
                    }

                    if (!_.isUndefined(temp)) defaultArgs[key] = gvDef.value;
                }
                closeHandler({
                    OK: true,
                    args: defaultArgs
                });
            }
        });

        var $bindFunctionsButton = this.$multiTools.find('.brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-bind-functions');
        $bindFunctionsButton.click(function () {
            var JointConverter = {
                convertFigures2Fids: function (figures) {
                    var fids = [];
                    for (var i = 0; i < figures.length; i++) {
                        fids.push(figures[i].attributes.fid);
                    }
                    return fids;
                }
            };
            var pid = _this.getEditor().getEditorInput().getProjectId();
            var mid = _this.getEditor().getEditorInput().getFileId();

            if (mid != _this.getEditor().activeModel.mid) {
                return Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(
                    "OPT models cannot be made in inner models."
                );
            }

            var figures = _this.getSelectedFigures();
            var fids = JointConverter.convertFigures2Fids(figures);
            var hash = fids.sort().join("_");

            var optModels = _this.getEditor().activeModel.optModels;
            for (var key in optModels) {
                if (optModels[key].hash == hash) {
                    return Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(
                        "This OPT model already exists."
                    );
                }
            }

            var command = Brightics.OptModelManager.createNewOptModelCommand(pid, mid, fids);
            _this.fireCommand(command);
        });
    };

    DiagramEditorPage.prototype._collectInnerModels = function (mainModel, model) {
        return _.reduce(
            _.map(Brightics.VA.Core.Utils.NestedFlowUtils.getAllSubModelsFromModel(
                mainModel,
                model
            ), function (innerModel) {
                var ret = {};
                ret[innerModel.mid] = innerModel;
                return ret;
            }), _.merge, {});
    };

    DiagramEditorPage.prototype.makeTemplate = function () {
        var template = {
            functions: [],
            links: [],
            innerModels: {},
            type: 'data'
        };

        var mainModel = this.getEditor().getModel();
        var figures = this.getSelectedFigures();
        var i, j, minX = Number.MAX_VALUE, minY = Number.MAX_VALUE, kids = [];
        for (i in figures) {
            var fnUnit = this.getFnUnitById(figures[i].attributes.fid);
            minX = Math.min(minX, fnUnit.display.diagram.position.x);
            minY = Math.min(minY, fnUnit.display.diagram.position.y);
            template.functions.push($.extend(true, {}, fnUnit));
            var connection = this.graph.getConnectedLinks(figures[i]);
            for (j in connection) {
                if (kids.indexOf(connection[j].attributes.kid) < 0) {
                    kids.push(connection[j].attributes.kid);
                }
            }
        }
        for (i in template.functions) {
            template.functions[i].display.diagram.position.x -= minX;
            template.functions[i].display.diagram.position.y -= minY;
        }
        for (i in kids) {
            var linkUnit = this.getLinkUnitById(kids[i]);
            var findCount = 0;
            for (j in template.functions) {
                if (template.functions[j].fid == linkUnit[SOURCE_FID]) findCount++;
                if (template.functions[j].fid == linkUnit[TARGET_FID]) findCount++;
                if (findCount == 2) break;
            }
            if (findCount == 2) {
                template.links.push($.extend(true, {}, linkUnit));
            }
        }

        template.functions.sort(function (a, b) {
            if (a.display.diagram.position.x == b.display.diagram.position.x) {
                return a.display.diagram.position.y - b.display.diagram.position.y;
            } else {
                return a.display.diagram.position.x - b.display.diagram.position.x;
            }
        });

        template.innerModels = this._collectInnerModels(mainModel, template);

        var isProcessFn = Brightics.VA.Core.Utils.NestedFlowUtils.isProcessFunction;
        var isNotProcessFn = _.negate(isProcessFn);

        template = Brightics.VA.Core.Utils.ModelUtils.extendModel(template, true);

        var validTid = _.flatten(
            _.map(
                _.filter(template.functions, isNotProcessFn),
                OUT_DATA
            )
        );

        (function removeInvalidTid(model, validTid) {
            var hash = validTid.reduce(function (acc, tid) {
                return _.merge(acc, _.set({}, tid, true));
            }, {});

            var kv = function (k, v) {
                return _.set({}, k, v);
            };
            var isValidTid = _.partial(_.has, hash);
            var filterTableByValidTid = _.partial(_.filter, _, isValidTid);
            var allOutData = [];

            model.functions = model.functions.map(function (fn) {
                if (isNotProcessFn(fn) && fn[IN_DATA]) {
                    var removedIndex = _.reject(_.map(fn[IN_DATA], function (tid, idx) {
                        return isValidTid(tid) ? -1 : idx;
                    }, _.partial(_.isEqual, -1)));

                    var removeByIndex = function (tids) {
                        return _.reject(tids, function (tid, idx) {
                            return _.indexOf(removedIndex, idx) >= 0;
                        });
                    };
                    var subModels =
                        _.map(Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(model, fn), IN_DATA);

                    _.forEach(subModels, function (subModel) {
                        subModel[IN_DATA] = removeByIndex(subModel[IN_DATA]);
                    });
                    fn[IN_DATA] = removeByIndex(fn[IN_DATA]);
                } else if (isProcessFn(fn)) {
                    var _fn = _.clone(fn);
                    var int = _.clone(filterTableByValidTid(fn[IN_DATA]));
                    var outt = _.clone(filterTableByValidTid(fn[OUT_DATA]));
                    return _.merge({}, _.omit(_fn, [IN_DATA, OUT_DATA]),
                        kv(IN_DATA, int),
                        kv(OUT_DATA, outt)
                    );
                }

                allOutData = _.union(allOutData, FnUnitUtils.getOutData(fn));

                return fn;
            });

            model.functions = model.functions.map(function (fn) {
                if (isNotProcessFn(fn) && FnUnitUtils.hasInput(fn) && FnUnitUtils.hasMeta(fn)) {
                    var inData = FnUnitUtils.getInData(fn);
                    for (var i in inData) {
                        var tid = inData[i];
                        var type = FnUnitUtils.getTypeByTableId(fn, tid);

                        if (_.indexOf(allOutData, tid) < 0) {
                            FnUnitUtils.removeInData(fn, type, tid);
                        }
                    }
                }
                return fn;
            });

            return model;
        }(template, validTid));
        return template;
    };

    DiagramEditorPage.prototype.createNewFnUnitCommand = function (figure, fnUnit, dummyMainModel) {
        figure.attributes.fid = fnUnit.fid;
        var _this = this;
        var commands = [];

        if (fnUnit[FUNCTION_NAME] !== 'DataViewer' && fnUnit.skip) {
            fnUnit.skip = false;
        }

        commands.push(new Brightics.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand(this, { fnUnit: fnUnit }));

        var options = (function (fnUnit) {
            var ret = [];
            if (fnUnit.func === 'if') {
                ret.push({ mid: fnUnit.param.if.mid, type: fnUnit.func, conditionType: 'if' });
                ret = ret.concat(_.map(fnUnit.param.elseif, function (elseif) {
                    return {
                        mid: elseif.mid,
                        type: fnUnit.func,
                        conditionType: 'elseif'
                    };
                }));
                ret.push({
                    mid: fnUnit.param.else.mid,
                    type: fnUnit.func,
                    conditionType: 'else'
                });
            } else if (fnUnit.func === 'forLoop' ||
                fnUnit.func === 'whileLoop') {
                ret.push({
                    mid: fnUnit.param.mid,
                    type: fnUnit.func
                });
            }
            return ret;
        }(fnUnit));

        commands = commands.concat(_.flatten(_.map(options, function (opt) {
            var opts = (function () {
                if (dummyMainModel) {
                    var model = dummyMainModel.getInnerModel(opt.mid);
                    var models = Brightics.VA.Core.Utils.NestedFlowUtils
                        .getAllSubModelsFromModel(dummyMainModel, model).concat(model);
                    model[IN_DATA] = [];

                    return _.map(models, function (m) {
                        return {
                            contents: m,
                            mid: m.mid
                        };
                    });
                } else {
                    return [opt];
                }
            }());
            return _.map(opts, function (o) {
                return new Brightics.VA.Core.Editors.Diagram.Commands
                    .NewActivityCommand(_this, o);
            });
        })));

        return commands;
    };

    DiagramEditorPage.prototype.getActivityModels = function (fnUnit) {
        var models = Brightics.VA.Core.Utils.NestedFlowUtils
            .getSubModels(this.getEditor().getModel(), fnUnit);

        return _.map(models, function (model) {
            return model.mid;
        });
    };

    DiagramEditorPage.prototype.createRemoveFnUnitCommand = function (figure) {
        var compoundCommand = new Brightics.VA.Core.CompoundCommand(this);

        var fnUnit = this.getFnUnitById(figure.attributes.fid);
        var targetModels = this.getActivityModels(fnUnit);

        _.map(targetModels, function (mid) {
            compoundCommand.add(new Brightics.VA.Core.Editors.Diagram.Commands.RemoveActivityCommand(this, {
                mid: mid
            }));
        }.bind(this));

        compoundCommand.add(new Brightics.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand(this, {
            fid: figure.attributes.fid
        }));

        return compoundCommand;
    };

    DiagramEditorPage.prototype.createSetFnUnitPositionCommand = function (figure, x, y) {
        return new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitPositionCommand(this, {
            fid: figure.attributes.fid,
            position: { x: x, y: y }
        });
    };

    DiagramEditorPage.prototype.createShiftLeftCommand = function (figure) {
        return new Brightics.VA.Core.Editors.Diagram.Commands.ShiftLeftCommand(this, {
            fid: figure.attributes.fid
        });
    };

    DiagramEditorPage.prototype.createShiftRightCommand = function (figure) {
        return new Brightics.VA.Core.Editors.Diagram.Commands.ShiftRightCommand(this, {
            fid: figure.attributes.fid
        });
    };

    DiagramEditorPage.prototype.createSwitchFnUnitCommand = function (figure, fnUnit, prvFnUnit) {
        return new Brightics.VA.Core.Editors.Diagram.Commands.SwitchFnUnitCommand(this, {
            modelType: this.getModel().type,
            fid: figure.attributes.fid,
            fnUnit: fnUnit,
            prvFnUnit: prvFnUnit
        });
    };

    DiagramEditorPage.prototype.createConnectFnUnitCommand = function (link, isMaintainIntable) {
        var commands = new Brightics.VA.Core.CompoundCommand(this, {
            label: 'Connect a Function'
        });

        var connectFnUnit = {
            kid: link.attributes.kid,
            'sourceFid': link.getSourceElement().attributes.fid,
            'targetFid': link.getTargetElement().attributes.fid
        };
        if (isMaintainIntable === true) {
            connectFnUnit.isMaintainIntable = isMaintainIntable;
        }

        commands.add(new Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand(this, connectFnUnit));
        var connectFnUnit = {
            kid: link.attributes.kid,
            'sourceFid': link.getSourceElement().attributes.fid,
            'targetFid': link.getTargetElement().attributes.fid
        };
        if (isMaintainIntable === true) {
            connectFnUnit.isMaintainIntable = isMaintainIntable;
        }
        return commands;
    };

    DiagramEditorPage.prototype.createDisconnectFnUnitCommand = function (link) {
        return new Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand(this, {
            kid: link.attributes.kid,
            'sourceFid': link.getSourceElement().attributes.fid,
            'targetFid': link.getTargetElement().attributes.fid
        });
    };

    DiagramEditorPage.prototype.createReconnectFnUnitCommand = function (link) {
        return new Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this, {
            kid: link.attributes.kid,
            'sourceFid': link.getSourceElement().attributes.fid,
            'targetFid': link.getTargetElement().attributes.fid
        });
    };

    DiagramEditorPage.prototype.fireCommand = function (command) {
        if (command.constructor === Brightics.VA.Core.CompoundCommand) {
            if (command.commandList.length === 0) {
                return false;
            }
        }

        var editor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);
        return editor.getCommandManager().execute(command);
    };

    DiagramEditorPage.prototype.registerDebugListener = function () {
        var _this = this;
        this.debugListener = function (event, eventData) {
            var selected = _this.$mainControl.closest('.brtc-va-editor-wrapper').hasClass('selected');
            if (!selected) return;

            if (eventData.mid == _this.getModel().mid) {
                var figure;
                if (eventData.eventType == 'BEGIN-PROCESS'
                    && eventData.launchOptions.mode !== 'unit') {
                    _this.hideSelectionBox();
                } else if (eventData.eventType == 'BEGIN-UNIT') {
                    figure = _this.getFigureByFnUnitId(eventData.fid);
                } else if (eventData.eventType == 'END-UNIT') {
                    _this.renderCompletedFnUnit(eventData);
                }
            }
        };

        Studio.getInstance().addDebugListener(this.debugListener);
    };

    DiagramEditorPage.prototype.registerCommandEventListener = function () {
        var _this = this;
        var modelEditorRef = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);

        modelEditorRef.addCommandListener(this.onCommand.bind(_this));
    };

    DiagramEditorPage.prototype.onCommand = function (command) {
        if (this.behaviorMode === BEHAVIOR_LINK) {
            this._setBehaviorModeToDefault();
        } else {
            this._clearSelectedLink();
        }
        if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AppendNewFnUnitCommand) this.onAppendNewFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.PrependNewFnUnitCommand) this.onPrependNewFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand) this.onNewFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand) this.onRemoveFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand) this.onConnectFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand) this.onDisconnectFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand) this.onReconnectFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand) this.onSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand) this.onSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand) this.onSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand) this.onSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AddFnUnitParameterCommand) this.onSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveFnUnitParameterCommand) this.onSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReplaceFnUnitParamCommand) this.onSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitPositionCommand) this.onSetFnUnitPositionCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ShiftLeftCommand) this.onShiftCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ShiftRightCommand) this.onShiftCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand) this.onRenameFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetDialogFnUnitCommand) this.onSetDialogFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewOptModelCommand) this.onNewOptModelCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetOptModelCommand) this.onSetOptModelCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveOptModelCommand) this.onRemoveOptModelCommand(command);
        else if (command instanceof Brightics.VA.Core.CompoundCommand) this.onCompoundCommand(command);


        this.hideGuideMessage();
    };

    DiagramEditorPage.prototype.onCompoundCommand = function (command) {
        var i;

        // if (command.event.type == 'REDO' ||
        //     command.event.type == 'EXECUTE' && command.event.source !== this) {
        //왜 커맨들 발생시킨 주체와 자기자신을 비교하는지 모르겠어서 일단 풀어봤음
        if (command.event.type == 'REDO' || command.event.type == 'EXECUTE') {

            for (i in command.commandList) {
                this.onCommand(command.commandList[i]);
            }

        } else if (command.event.type == 'UNDO') {

            for (i = command.commandList.length - 1; i > -1; i--) {
                this.onCommand(command.commandList[i]);
            }

        }
    };

    DiagramEditorPage.prototype.onAppendNewFnUnitCommand = function (command) {
        this.onCompoundCommand(command);

        if (command.event.type == 'EXECUTE') {
            var figure = this.getFigureByFnUnitId(command.options.fnUnit.fid);
            this.showSelectionBox([figure]);
        }
    };

    DiagramEditorPage.prototype.onPrependNewFnUnitCommand = function (command) {
        this.onCompoundCommand(command);

        if (command.event.type == 'EXECUTE') {
            var figure = this.getFigureByFnUnitId(command.options.fnUnit.fid);
            this.showSelectionBox([figure]);
        }
    };

    DiagramEditorPage.prototype.onNewFnUnitCommand = function (command) {
        var figure, fnUnit;

        if (command.event.type == 'REDO' ||
            command.event.type == 'EXECUTE' && command.event.source !== this) {

            fnUnit = command.options.fnUnit;
            figure = this.createFnUnitFigure(fnUnit);
            this.graph.addCells([figure]);
            this.ensureVisible(figure);

            if (command.event.type == 'EXECUTE') {
                this.showSelectionBox([figure]);
            }

        } else if (command.event.type == 'UNDO') {

            fnUnit = command.options.fnUnit;
            figure = this.getFigureByFnUnitId(fnUnit.fid);
            this._removeFigure(figure);

        }
    };

    DiagramEditorPage.prototype.onRemoveFnUnitCommand = function (command) {
        var _this = this;
        var figure, fnUnit;

        if (command.event.type == 'REDO' ||
            command.event.type == 'EXECUTE' && command.event.source !== this) {

            figure = this.getFigureByFnUnitId(command.options.fid);
            this._removeFigure(figure);

        } else if (command.event.type == 'UNDO') {

            fnUnit = this.getFnUnitById(command.options.fid);
            figure = this.createFnUnitFigure(fnUnit);
            this.graph.addCells([figure]);

            this.fitToContent();
            this.ensureVisible(figure);

        }

        // _removeFigure에 durtaion이 설정되어 있음.
        setTimeout(function () {
            Brightics.OptModelManager.renderOptModels();
        }, 600);
    };

    DiagramEditorPage.prototype.onConnectFnUnitCommand = function (command) {
        var link;

        if (command.event.type == 'REDO' ||
            command.event.type == 'EXECUTE' && command.event.source !== this) {

            var linkUnit = this.getLinkUnitById(command.options.kid);
            link = this.createLinkFigure(linkUnit);
            if (link) {
                this.graph.addCells([link]);
                link.toBack();
            }

        } else if (command.event.type == 'UNDO') {

            link = this.getLinkFigureByLinkUnitId(command.options.kid);
            this._removeLink(link);

        }
    };

    DiagramEditorPage.prototype.onDisconnectFnUnitCommand = function (command) {
        var link;

        if (command.event.type == 'REDO' ||
            command.event.type == 'EXECUTE' && command.event.source !== this) {

            link = this.getLinkFigureByLinkUnitId(command.options.kid);
            this._removeLink(link);

        } else if (command.event.type == 'UNDO') {

            var linkUnit = this.getLinkUnitById(command.options.kid);
            link = this.createLinkFigure(linkUnit);
            if (link) {
                this.graph.addCells([link]);
                link.toBack();
            }

        }
    };

    DiagramEditorPage.prototype.onReconnectFnUnitCommand = function (command) {
        var link, linkUnit, sourceFigure, targetFigure;

        if (command.event.type == 'REDO' ||
            command.event.type == 'UNDO' ||
            command.event.type == 'EXECUTE' && command.event.source !== this) {

            linkUnit = this.getModel().getLinkUnitById(command.options.kid);
            sourceFigure = this.getFigureByFnUnitId(linkUnit[SOURCE_FID]);
            targetFigure = this.getFigureByFnUnitId(linkUnit[TARGET_FID]);

            link = this.getLinkFigureByLinkUnitId(linkUnit.kid);
            link.set('source', {
                id: sourceFigure.id,
                port: OUT_PORT_ID
            });
            link.set('target', {
                id: targetFigure.id,
                port: IN_PORT_ID
            });
        }
    };

    DiagramEditorPage.prototype.onSetFnUnitCommand = function (command) {
        var figure;

        if (command.event.type == 'REDO' ||
            command.event.type == 'UNDO') {

            figure = this.getFigureByFnUnitId(command.options.fnUnit.fid);
            if (figure) {
                this.showSelectionBox([figure]);
            }
        }
    };

    DiagramEditorPage.prototype.onSetDialogFnUnitCommand = function (command) {
        if (command.event.type == 'REDO' ||
            command.event.type == 'UNDO') {
            //현재 아무것도 하지 않지만 뭔가를 화면에서 보여줘야 하는지?
        }
    };

    DiagramEditorPage.prototype.onNewOptModelCommand = function (command) {
        Brightics.OptModelManager.renderOptModels();
    };

    DiagramEditorPage.prototype.onSetOptModelCommand = function (command) {
        Brightics.OptModelManager.renderOptModels();
    };

    DiagramEditorPage.prototype.onRemoveOptModelCommand = function (command) {
        Brightics.OptModelManager.renderOptModels();
    };

    DiagramEditorPage.prototype.onSetFnUnitPositionCommand = function (command) {
        var figure, fnUnit;

        if (command.event.type == 'REDO' ||
            command.event.type == 'UNDO' ||
            command.event.type == 'EXECUTE' && command.event.source !== this) {

            figure = this.getFigureByFnUnitId(command.options.fid);
            fnUnit = this.getFnUnitById(command.options.fid);
            if (fnUnit) {
                figure.position(fnUnit.display.diagram.position.x, fnUnit.display.diagram.position.y);
            }
            this._rerouteLink();
            //Refresh SelectionBounds Position
            this.hideSelectionBounds();
            this.showSelectionBounds();
        }
        Brightics.OptModelManager.renderOptModels();
    };

    DiagramEditorPage.prototype.onShiftCommand = function (command) {
        var fid, figure, fnUnit;
        for (var i in command.options.changed) {
            fid = command.options.changed[i];
            fnUnit = this.getFnUnitById(fid);
            figure = this.getFigureByFnUnitId(fid);
            if (fnUnit && figure) {
                figure.position(fnUnit.display.diagram.position.x, fnUnit.display.diagram.position.y);
            }
        }
        this.hideTools(true);
        Brightics.OptModelManager.renderOptModels();
    };

    DiagramEditorPage.prototype.onRenameFnUnitCommand = function (command) {
        var figure = this.getFigureByFnUnitId(command.options.fid);
        var fnUnit = this.getFnUnitById(command.options.fid);
        if (fnUnit) {
            figure.label(fnUnit.display.label, this.options.scale);

            if (this._hasDescription(fnUnit)) figure.showToolTipIcon();
            else figure.hideToolTipIcon();
        }
    };

    DiagramEditorPage.prototype.getFnUnitById = function (fid) {
        return this.getModel().getFnUnitById(fid);
    };

    DiagramEditorPage.prototype.getLinkUnitById = function (kid) {
        return this.getModel().getLinkUnitById(kid);
    };

    DiagramEditorPage.prototype.getFigureByFnUnitId = function (fid) {
        var figures = this.graph.getElements();
        for (var i in figures) {
            if (figures[i].attributes.fid === fid) {
                return figures[i];
            }
        }
    };

    DiagramEditorPage.prototype.getLinkFigureByLinkUnitId = function (kid) {
        var links = this.graph.getLinks();
        for (var i in links) {
            if (links[i].attributes.kid === kid) {
                return links[i];
            }
        }
    };

    DiagramEditorPage.prototype.getSelectedFigures = function () {
        var _this = this;
        return this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected').map(function () {
            var cid = $(this).attr('cid');
            return _this.graph.getCell(cid);
        }).toArray();
    };

    DiagramEditorPage.prototype.getSelectedFigureIds = function () {
        var selections = [];
        this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected').each(function (index, el) {
            selections.push($(this).attr('cid'));
        });
        selections.sort();
        return selections;
    };

    DiagramEditorPage.prototype.selectFunction = function (fid) {
        var _this = this;
        if (_this.behaviorMode === BEHAVIOR_LINK) _this._setBehaviorModeToDefault();
        var figure = this.getFigureByFnUnitId(fid);
        this.showSelectionBox([figure]);
        setTimeout(function () {
            _this.ensureCenter(figure);
        }, 100);
    };

    DiagramEditorPage.prototype.isReadOnlyFigure = function (figure) {
        return (figure.attributes.attrs.category === 'brightics') ? true : false;
    };

    DiagramEditorPage.prototype.calcGuidePosition = function (figure) {
        return this.calcGuideLocation(figure.attributes.position.x, figure.attributes.position.y);
    };

    DiagramEditorPage.prototype.calcGuideLocation = function (x, y) {
        var gap_width = this.GAP_WIDTH || Brightics.VA.Env.Diagram.GAP_WIDTH;
        var gap_height = this.GAP_HEIGHT || Brightics.VA.Env.Diagram.GAP_HEIGHT;

        var w = (Brightics.VA.Env.Diagram.FIGURE_WIDTH + gap_width);
        var h = (Brightics.VA.Env.Diagram.FIGURE_HEIGHT + gap_height);

        var xx = x - Brightics.VA.Env.Diagram.PAPER_MARGIN_LEFT;
        var minX = Math.floor(xx / w) * w;
        if (xx > minX + w / 2) {
            xx = minX + w;
        } else {
            xx = minX;
        }
        xx += Brightics.VA.Env.Diagram.PAPER_MARGIN_LEFT;

        var yy = y - Brightics.VA.Env.Diagram.PAPER_MARGIN_TOP;
        var minY = Math.floor(yy / h) * h;
        if (yy > minY + h / 2) {
            yy = minY + h;
        } else {
            yy = minY;
        }
        yy += Brightics.VA.Env.Diagram.PAPER_MARGIN_TOP;

        return { x: xx, y: yy };
    };

    DiagramEditorPage.prototype.showGuideBox = function (figure) {
        var pos = this.calcGuidePosition(figure);
        this.$guideBox.css({
            top: pos.y * this.options.scale,
            left: pos.x * this.options.scale,
            display: 'block'
        });
    };

    DiagramEditorPage.prototype.updateGuideBox = function (figure) {
        var pos = this.calcGuidePosition(figure);
        this.$guideBox.css({
            top: pos.y * this.options.scale,
            left: pos.x * this.options.scale
        });
    };

    DiagramEditorPage.prototype.hideGuideBox = function () {
        if (this.$guideBox) this.$guideBox.hide();
    };

    DiagramEditorPage.prototype.showGuideMessage = function (figure, message) {
        var pos = {
            x: figure.attributes.position.x,
            y: figure.attributes.position.y + Brightics.VA.Env.Diagram.FIGURE_HEIGHT
        };
        this.guideMessage = message;
        this.$guideMessageBox.text(message);
        this.$guideMessageBox.css({
            top: Math.max(0, pos.y * this.options.scale),
            left: Math.max(0, pos.x * this.options.scale),
            display: 'block'
        });
    };

    DiagramEditorPage.prototype.hideGuideMessage = function () {
        this.guideMessage = null;
        if (this.$guideMessageBox) this.$guideMessageBox.hide();
    };

    DiagramEditorPage.prototype.renderStartedFnUnit = function (figure) {
        this.ensureCenter(figure);
    };

    DiagramEditorPage.prototype.renderCompletedFnUnit = function (eventData) {
        var figure = this.getFigureByFnUnitId(eventData.fid);
        var date = eventData.end ? new Date(parseInt(eventData.end)) : Date.now();
        if (figure) figure.lastRuntime(date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds() + '.' + date.getMilliseconds());

        var item = $.extend(true, {}, eventData);
        delete item.launchOptions;
        delete item.originalResponse;

        if (window.sessionStorage) sessionStorage.setItem(item.fid, JSON.stringify(item));
    };

    DiagramEditorPage.prototype.render = function (_editorInput) {
        var editorInput = _editorInput || this.getModel();
        this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected').remove();

        this.graph.clear();

        var i;
        for (i in editorInput.functions) {
            var fnUnit = editorInput.functions[i];
            var figure = this.createFnUnitFigure(fnUnit);
            this.graph.addCells([figure]);

            if (sessionStorage) {
                var storedEventData = JSON.parse(sessionStorage.getItem(fnUnit.fid) || "{}");
                if (storedEventData && storedEventData.end) {
                    var date = new Date(parseInt(storedEventData.end));
                    figure.lastRuntime(date.getHours() + ':' + date.getMinutes() + ':' + date.getSeconds() + '.' + date.getMilliseconds());
                }
            }
        }
        for (i in editorInput.links) {
            var linkUnit = editorInput.links[i];
            var linkFigure = this.createLinkFigure(linkUnit);
            if (linkFigure) {
                this.graph.addCells([linkFigure]);
            }
        }
        var links = this.graph.getLinks();
        $.each(links, function (index, link) {
            link.toBack();
        });

        this.fitToContent();
        this.hideErrorBox();
        this.showErrorBox(this.findError());
    };

    DiagramEditorPage.prototype.onActivated = function () {
        var links = this.graph.getLinks();
        $.each(links, function (index, link) {
            link.remove();
        });

        var _this = this;
        setTimeout(function () {
            for (var i in _this.getModel().links) {
                var linkUnit = _this.getModel().links[i];
                var linkFigure = _this.createLinkFigure(linkUnit);
                if (linkFigure) {
                    _this.graph.addCells([linkFigure]);
                }
            }
            links = _this.graph.getLinks();
            $.each(links, function (index, link) {
                link.toBack();
            });
        }, 400);
    };

    DiagramEditorPage.prototype.getPaperSize = function () {
        var size = {};

        var box = this.graph.getBBox(this.graph.getElements());
        if (box) {
            size.width = (box.x + box.width) + 900;
            size.width = size.width + (900 - size.width % 900);
            size.width = Math.max(size.width, this.$mainControl.width());

            size.height = (box.y + box.height) + 50;
            size.height = size.height + (50 - size.height % 50);
            size.height = Math.max(size.height, this.$mainControl.height() - 4);
        } else {
            size.width = this.$mainControl.width();
            size.height = this.$mainControl.height() - 4;
        }

        return size;
    };

    DiagramEditorPage.prototype.fitToContent = function () {
        var size = this.getPaperSize();
        var width = size.width;
        var height = size.height;

        this.paper.setDimensions(width, height);

        this.updateMiniMapWindow();

        this.$mainControl.perfectScrollbar('update');
    };

    DiagramEditorPage.prototype.updateMiniMapWindow = function () {
        this.minimap.updateMiniMapWindow();
    };

    DiagramEditorPage.prototype.disableAllFnUnitFigure = function () {
        var cells = this.graph.getCells();
        for (var i in cells) {
            if (cells[i] instanceof Brightics.VA.Core.Shapes.LinkFigure) {
                this.disableLink(cells[i]);
            } else if (cells[i] instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
                this.disableFnUnit(cells[i]);
            }
        }
    };

    DiagramEditorPage.prototype.enableAllFnUnitFigure = function () {
        var cells = this.graph.getCells();
        for (var i in cells) {
            if (cells[i] instanceof Brightics.VA.Core.Shapes.LinkFigure) {
                this.enableLink(cells[i]);
            } else if (cells[i] instanceof Brightics.VA.Core.Shapes.FnUnitFigure) {
                this.enableFnUnit(cells[i]);
            }
        }
    };

    DiagramEditorPage.prototype.enableFnUnit = function (figure) {
        figure.transition('attrs/rect/opacity', 0.2, this.opacity4transition);
        figure.transition('attrs/circle/opacity', 0.2, this.opacity4transition);
        figure.transition('attrs/text/opacity', 0.2, this.opacity4transition);
        figure.attr('text/font-weight', 'bold');
    };

    DiagramEditorPage.prototype.disableFnUnit = function (figure) {
        figure.attr('rect/opacity', 0.2);
        figure.attr('circle/opacity', 0.2);
        figure.attr('text/opacity', 0.2);
        figure.attr('text/font-weight', '');
    };

    DiagramEditorPage.prototype.enableLink = function (link) {
        link.transition('attrs/path/opacity', 0.2, this.opacity4transition);
    };

    DiagramEditorPage.prototype.disableLink = function (link) {
        link.attr('path/opacity', 0.1);
    };

    DiagramEditorPage.prototype.checkInputtable = function (fnUnit) {
        var isInputtable = false;

        isInputtable = 
            FnUnitUtils.getTotalInRangeCount(fnUnit).min > 0 ? true : false ||
            FnUnitUtils.isBluffNode(fnUnit);

        return isInputtable;
    };

    DiagramEditorPage.prototype.createFnUnitFigure = function (fnUnit) {
        var clazz = this.getModel().type;

        var figure = new Brightics.VA.Core.Shapes.FnUnitFigure({
            colorSet: this.options.editor.getColorSet(),
            position: fnUnit.display.diagram.position,
            size: {
                width: Brightics.VA.Env.Diagram.FIGURE_WIDTH,
                height: Brightics.VA.Env.Diagram.FIGURE_HEIGHT
            },
            fid: fnUnit.fid,
            inputtable: FnUnitUtils.isInputtable(fnUnit),
            outputtable: FnUnitUtils.isOutputtable(fnUnit),
            connectableFunctions: Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func)['connectable-functions'],
            acceptableFunctions: Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func)['acceptable-functions'],
            ports: {
                groups: {
                    'in:l': {
                        position: {
                            name: 'left',
                        },
                        attrs: {
                            '.fnunit-port': {
                                stroke: 'red'
                            }
                        }
                    },
                    'out:r': {
                        position: {
                            name: 'right',
                        },
                        attrs: {
                            '.fnunit-port': {
                                stroke: 'blue'
                            }
                        }
                    }
                },
                items: [IN_PORT, OUT_PORT]
            }
        });

        figure.label(fnUnit.display.label, this.options.scale);
        figure.attr({
            '.brtc-va-rotatable': { fid: fnUnit.fid }
        });

        var funcDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func);
        if (funcDef) {
            figure.category(funcDef);
            if (funcDef.deprecated) {
                figure.setDeprecated(funcDef['deprecated-message']);
            }
        }

        if (this._hasDescription(fnUnit)) figure.showToolTipIcon();
        else figure.hideToolTipIcon();

        return figure;
    };

    DiagramEditorPage.prototype._hasDescription = function (fnUnit) {
        return (fnUnit.display.description && fnUnit.display.description !== '' && fnUnit.display.description && fnUnit.display.description !== '<p><br></p>');
    };

    DiagramEditorPage.prototype.createLinkFigure = function (linkUnit) {
        var _this = this;
        var sourceFigure = this.getFigureByFnUnitId(linkUnit[SOURCE_FID]);
        var targetFigure = this.getFigureByFnUnitId(linkUnit[TARGET_FID]);

        if (sourceFigure && targetFigure) {
            var link = new Brightics.VA.Core.Shapes.LinkFigure({
                kid: linkUnit.kid,
                source: {
                    id: sourceFigure.id,
                    port: OUT_PORT_ID
                },
                target: {
                    id: targetFigure.id,
                    port: IN_PORT_ID
                }
            });
            link.on('change', function (link, changed) {
                if (changed.ui && link.attributes.target.id && !link.attributes.target.port) {
                    link.set('target', {
                        id: link.attributes.target.id,
                        port: IN_PORT_ID
                    })
                }
                if (changed.ui && link.attributes.source.id && !link.attributes.source.port) {
                    link.set('source', {
                        id: link.attributes.source.id,
                        port: OUT_PORT_ID
                    })
                }
            });
            return link;
        }
    };

    DiagramEditorPage.prototype._createLinkFigure = function (kid, sourceFigure, targetFigure) {
        var opt = {
            kid: kid,
            source: {
                id: sourceFigure.id,
                port: OUT_PORT_ID
            },
            target: {
                id: targetFigure.id,
                port: IN_PORT_ID
            }
        };

        if (sourceFigure.x && sourceFigure.y) {
            opt.source = {
                x: sourceFigure.x,
                y: sourceFigure.y
            };
        }
        if (targetFigure.x && targetFigure.y) {
            opt.target = {
                x: targetFigure.x,
                y: targetFigure.y
            };
        }

        var link = new Brightics.VA.Core.Shapes.LinkFigure(opt);
        link.on('change:source', function () {
        });
        link.on('change:target', function () {
        });

        return link;
    };

    DiagramEditorPage.prototype.updateToolsPosition = function (figure) {
        var _this = this;
        var pos = figure.attributes.position;
        if (pos && figure instanceof Brightics.VA.Core.Shapes.FnUnitFigure && figure.attributes.fid) {
            this.$tools.css({
                top: pos.y * _this.options.scale,
                left: pos.x * _this.options.scale
            });
        }
    };

    DiagramEditorPage.prototype.showTools = function (figure) {
        var _this = this;
        var pos = figure.attributes.position;

        if (pos && figure instanceof Brightics.VA.Core.Shapes.FnUnitFigure && !figure.attributes.dummy) {
            this.clearHideToolsTimer();
            this.clearShowToolsTimer();
            this.showToolsTimer = setTimeout(function () {
                var fid = figure.attributes.fid;

                var fnUnit = _this.options.editor.getActiveModel().getFnUnitById(fid);
                if (!fnUnit) return;

                _this.$tools.attr('has-model',
                    _this.hasModel(figure.attributes.attrs.category, fnUnit));
                _this.$tools.attr('cid', figure.cid);
                _this.$tools.attr('category', figure.attributes.attrs.category);
                _this.$tools.attr('select', figure.attributes.attrs['.brtc-va-outer'].fill != '#FFFFFF');
                _this.$tools.css({
                    top: pos.y * _this.options.scale,
                    left: pos.x * _this.options.scale,
                    display: 'block'
                });
            }, 50);
        }
        this.setConnectToolItemVisible(figure.attributes.outputtable);
    };

    DiagramEditorPage.prototype.clearShowToolsTimer = function () {
        if (this.showToolsTimer) {
            clearTimeout(this.showToolsTimer);
            this.showToolsTimer = null;
        }
    };

    DiagramEditorPage.prototype.hideTools = function (immediately) {
        if (this.$tools) {
            if (immediately) {
                Brightics.OptModelManager.renderOptModels(_this);
                this.$tools.hide();
            } else {
                this.clearShowToolsTimer();
                this.clearHideToolsTimer();
                var _this = this;
                this.hideToolsTimer = setTimeout(function () {
                    Brightics.OptModelManager.renderOptModels(_this);
                    _this.$tools.hide();
                }, 200);
            }
        }
    };

    DiagramEditorPage.prototype.clearHideToolsTimer = function () {
        if (this.hideToolsTimer) {
            clearTimeout(this.hideToolsTimer);
            this.hideToolsTimer = null;
        }
    };

    DiagramEditorPage.prototype.showToolTip = function (figure) {
        var _this = this;
        var labelColor;
        var clazz = this.getModel().type;
        var pos = figure.attributes.position;
        if (pos && figure instanceof Brightics.VA.Core.Shapes.FnUnitFigure &&
            !figure.attributes.dummy && this.getEditor().getEditorState(TOOLTIP_ENABLED)) {
            var fnUnit = _this.getFnUnitById(figure.attributes.fid);
            var funcDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func);
            // if (figure.resource[funcDef.category]) {
            //     labelColor = figure.resource[funcDef.category].fill;
            // }

            labelColor = figure.getColor();

            _this.$toolTip.empty();
            var $tooltipHeaderFunc = $('' +
                '<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header-func">' +
                '   <label class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header-func-label" style="background-color:' + labelColor + '"></label>' +
                '</div>');
            if (funcDef.category === 'udf') {
                $tooltipHeaderFunc.find('.brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header-func-label').text('UDF');
            } else {
                $tooltipHeaderFunc.find('.brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header-func-label').text(funcDef.defaultFnUnit.display.label);
            }
            _this.$toolTip.append($tooltipHeaderFunc);
            var $tooltipHeader = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header"><p></p></div>');
            $tooltipHeader.find('p').text(fnUnit.display.label);
            _this.$toolTip.append($tooltipHeader);

            _this.$toolTip.addClass('brtc-va-editors-visible');
            _this.$toolTip.css({
                top: (pos.y + Brightics.VA.Env.Diagram.FIGURE_HEIGHT) * _this.options.scale,
                left: (pos.x) * _this.options.scale
            });
            var $container, $contents, $editButton;
            if (_this._hasDescription(fnUnit)) {
                $container = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents-container"></div>');
                $contents = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents">' + fnUnit.display.description + '</div>');
                $editButton = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents-edit"></div>');
                _this.$toolTip.append($container);
                $container.append($contents);
                $container.append($editButton);
                $contents.perfectScrollbar();
            } else {
                $container = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents-empty-container"></div>');
                $editButton = $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents-edit"></div>');
                _this.$toolTip.append($container);
                $container.append($editButton);
                $container.append($editButton);
            }
            $editButton.click(function (event) {
                var dialogOptions = {
                    title: 'Edit Function',
                    label: fnUnit.display.label,
                    description: fnUnit.display.description || '',
                    close: function (dialogResult) {
                        if (dialogResult.OK) {
                            _this.doEditFunction(fnUnit.fid, dialogResult.label, dialogResult.description);
                        }
                    }
                };
                new Brightics.VA.Core.Dialogs.EditResourceDialog(_this.$mainControl, dialogOptions);
            });
        }
    };

    DiagramEditorPage.prototype.hideToolTip = function () {
        if (this.$toolTip) this.$toolTip.removeClass('brtc-va-editors-visible');
    };

    DiagramEditorPage.prototype.doEditFunction = function (fid, label, description) {
        var command = new Brightics.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this, {
            fid: fid,
            name: label,
            description: description
        });
        this.fireCommand(command);
    };

    DiagramEditorPage.prototype.removeFnUnitFigure = function (figure) {
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var pid = activeModelEditor.getEditorInput().getProjectId();
        var mid = activeModelEditor.getEditorInput().getFileId();
        
        var fnUnit = this.getFnUnitById(figure.attributes.fid);
        var label = fnUnit.display.label;
        this.notification('success', 'The function [' + label + '] was removed.');

        var commands = new Brightics.VA.Core.CompoundCommand(this, {
            label: 'Remove a Function'
        });

        // Unbind Global Parameter
        for (var paramKey in fnUnit.param) {
            var variable = fnUnit.parent().getVariable(fnUnit.fid, paramKey);
            if (variable) {
                commands.add(new Brightics.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(this, {
                    fid: fnUnit.fid,
                    paramKey: paramKey,
                    variable: variable
                }));
            }
        }

        var links = this.graph.getConnectedLinks(figure);
        for (var i in links) {
            this._removeLink(links[i]);
            commands.add(this.createDisconnectFnUnitCommand(links[i]));
        }

        this._removeFigure(figure);
        commands.add(this.createRemoveFnUnitCommand(figure));
        commands.add(this.createRemoveConnectedOutDataCommand([figure]));
        
        var targetOptModelId = Brightics.OptModelManager.getTargetOptModelId(pid, mid, fnUnit.fid);
        if (targetOptModelId) {
            commands.add(Brightics.OptModelManager.createRemoveOptModelCommand(pid, mid, targetOptModelId));
        }

        this.fireCommand(commands);
    };

    DiagramEditorPage.prototype.removeFnUnitFigures = function (figures) {
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var pid = activeModelEditor.getEditorInput().getProjectId();
        var mid = activeModelEditor.getEditorInput().getFileId();

        var commands = new Brightics.VA.Core.CompoundCommand(this, {
            label: 'Remove functions'
        });

        var fnUnit;
        var fnUnits = [];
        var links = [], linkIds = [];
        var i, j;
        for (i in figures) {
            fnUnit = this.getFnUnitById(figures[i].attributes.fid);
            fnUnits.push(fnUnit);

            var connection = this.graph.getConnectedLinks(figures[i]);
            for (j in connection) {
                if (linkIds.indexOf(connection[j].attributes.kid) < 0) {
                    linkIds.push(connection[j].attributes.kid);
                    links.push(connection[j]);
                }
            }
        }

        // Remove LinkUnit
        for (i in links) {
            this._removeLink(links[i]);
            commands.add(this.createDisconnectFnUnitCommand(links[i]));
        }

        // Remove FnUnit
        var targetOptModelIds = {};
        for (i in figures) {
            figures[i].remove();
            commands.add(this.createRemoveFnUnitCommand(figures[i]));

            // Unbind Global Parameter
            var variables = fnUnits[i].parent().getVariables(fnUnits[i].fid);
            for (var key in variables) {
                commands.add(new Brightics.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(this, {
                    fid: fnUnits[i].fid,
                    paramKey: key,
                    variable: variables[key]
                }));
            }

            var targetOptModelId = Brightics.OptModelManager.getTargetOptModelId(pid, mid, fnUnits[i].fid);
            if (targetOptModelId) {
                targetOptModelIds[targetOptModelId] = true;
            }
        }

        for (var optId in targetOptModelIds) {
            commands.add(Brightics.OptModelManager.createRemoveOptModelCommand(pid, mid, optId));
        }

        commands.add(this.createRemoveConnectedOutDataCommand(figures));

        this.hideSelectionBox();
        this.hideTools(true);

        this.notification('success', figures.length + ' functions were removed.');
        this.fireCommand(commands);
    };

    DiagramEditorPage.prototype.removeFnUnitLink = function (figure) {
        var links = this.graph.getConnectedLinks(figure);
        if (links.length > 0) {
            var fnUnit = this.getFnUnitById(figure.attributes.fid);
            var label = fnUnit.display.label;
            this.notification('success', 'All associated connections to [' + label + '] was removed.');

            var commands = new Brightics.VA.Core.CompoundCommand(this, {});
            for (var i in links) {
                this._removeLink(links[i]);
                commands.add(this.createDisconnectFnUnitCommand(links[i]));
            }
            this.fireCommand(commands);
        } else {
            this.notification('info', 'Already removed all the associated connections to the function');
        }
    };

    DiagramEditorPage.prototype._removeFigure = function (figure) {
        if (figure) {
            var transition = {
                duration: 200,
                timingFunction: joint.util.timing.inout,
                valueFunction: function (a, b) {
                    return function (t) {
                        return 1 - (b + t);
                    };
                }
            };
            figure.on('transition:end', function () {
                figure.remove();
            });
            figure.transition('attrs/rect.outer/opacity', 0.2, transition);
            figure.transition('attrs/text/opacity', 0.2, transition);
            figure.attributes.dummy = true;

            this.hideSelectionBox(figure);

            if (figure.cid == this.$tools.attr('cid')) {
                this.hideTools(true);
            }
        }
    };

    DiagramEditorPage.prototype._revertPosition = function (figure) {
        var revert = this.getFnUnitById(figure.attributes.fid).display.diagram.position;
        var pos = figure.position();
        if (revert.x != pos.x || revert.y != pos.y) {
            figure.position(revert.x, revert.y);
        }
    };

    DiagramEditorPage.prototype._revertLink = function (link) {
        var linkUnit = this.getLinkUnitById(link.attributes.kid);
        var sourceFigure = this.getFigureByFnUnitId(linkUnit[SOURCE_FID]);
        var targetFigure = this.getFigureByFnUnitId(linkUnit[TARGET_FID]);
        link.set('source', {
            id: sourceFigure.id,
            port: OUT_PORT_ID
        });
        link.set('target', {
            id: targetFigure.id,
            port: IN_PORT_ID
        });
    };

    DiagramEditorPage.prototype._removeLink = function (link) {
        if (link) {
            var transition = {
                duration: 200,
                timingFunction: joint.util.timing.inout,
                valueFunction: function (a, b) {
                    return function (t) {
                        return 1 - (b + t);
                    };
                }
            };
            link.on('transition:end', function () {
                link.remove();
            });
            link.transition('attrs/path/opacity', 0.2, transition);
        }
    };

    DiagramEditorPage.prototype.connectSmartly = function (figure) {
        var links = [], linkUnit,
            inLink, outLink;

        var x = figure.attributes.position.x;
        var y = figure.attributes.position.y;
        var gap_width = this.GAP_WIDTH || Brightics.VA.Env.Diagram.GAP_WIDTH;
        var gap_height = this.GAP_HEIGHT || Brightics.VA.Env.Diagram.GAP_HEIGHT;

        var prev = this.graph.findModelsFromPoint({
            x: x - gap_width,
            y: y
        });
        var next = this.graph.findModelsFromPoint({
            x: x + Brightics.VA.Env.Diagram.FIGURE_WIDTH + gap_width,
            y: y
        });
        var inbounds = this.graph.getConnectedLinks(figure, { inbound: true });
        if (inbounds.length === 0 && prev.length > 0 && !prev[0].attributes.connectableFunctions && figure.attributes.inputtable && prev[0].attributes.outputtable && (prev[0].attributes.position.y == y)) {
            linkUnit = {
                kid: Brightics.VA.Core.Utils.IDGenerator.link.id(),
                'sourceFid': prev[0].attributes.fid,
                'targetFid': figure.attributes.fid
            };
            inLink = this.createLinkFigure(linkUnit);
            if (inLink) {
                this.graph.addCells([inLink]);
                inLink.toBack();
                links.push(inLink);
            }
        }
        var outbounds = this.graph.getConnectedLinks(figure, { outbound: true });
        if (!figure.attributes.connectableFunctions && outbounds.length === 0 && next.length > 0 && next[0].attributes.inputtable && figure.attributes.outputtable && (next[0].attributes.position.y == y)) {
            linkUnit = {
                kid: Brightics.VA.Core.Utils.IDGenerator.link.id(),
                'sourceFid': figure.attributes.fid,
                'targetFid': next[0].attributes.fid
            };
            outLink = this.createLinkFigure(linkUnit);
            if (outLink) {
                this.graph.addCells([outLink]);
                outLink.toBack();
                links.push(outLink);
            }
        }

        return links;
    };

    DiagramEditorPage.prototype.checkOverPosition = function (figure) {
        var pos = this.calcGuidePosition(figure);
        var models = this.graph.findModelsFromPoint(pos);
        for (var i in models) {
            if (models[i] != figure) {
                if (models[i].position().x == pos.x && models[i].position().y == pos.y) {
                    return false;
                }
            }
        }
        return true;
    };

    DiagramEditorPage.prototype.checkPreviousPosition = function (figure) {
        var pos = this.calcGuidePosition(figure);
        var inLinks = this.graph.getConnectedLinks(figure, { inbound: true });
        for (var i in inLinks) {
            if (inLinks[i].getSourceElement().position().x >= pos.x) {
                return false;
            }
        }

        return true;
    };

    DiagramEditorPage.prototype.checkNextPosition = function (figure) {
        var pos = this.calcGuidePosition(figure);
        var outLinks = this.graph.getConnectedLinks(figure, { outbound: true });
        for (var i in outLinks) {
            if (outLinks[i].getTargetElement().position().x <= pos.x) {
                return false;
            }
        }

        return true;
    };

    DiagramEditorPage.prototype.checkOutRangePosition = function (figure) {
        var pos = this.calcGuidePosition(figure);
        return pos.x > 0 && pos.y > 0;
    };

    DiagramEditorPage.prototype.checkConnectedLink = function (link) {
        return link.getSourceElement() != null && link.getTargetElement() != null;
    };

    DiagramEditorPage.prototype.checkLoopLink = function (link) {
        var sourceFid = link.getSourceElement().attributes.fid;
        var targetFid = link.getTargetElement().attributes.fid;
        return this._getConnectableFids(sourceFid).indexOf(targetFid) >= 0;
    };

    DiagramEditorPage.prototype._getConnectableFids = function (startFid) {
        var _this = this;
        var links = this.options.editor.getActiveModel().links;
        var fids = [];

        this.options.editor.getActiveModel().functions.forEach(function (a) {
            fids.push(a.fid)
        });

        var reverseLinks = {};
        var n = fids.length;
        var m = links.length;
        var i;
        for (i = 0; i < n; i++) {
            reverseLinks[fids[i]] = [];
        }
        for (i = 0; i < m; i++) {
            reverseLinks[links[i]['targetFid']].push(links[i]['sourceFid']);
        }

        var visited = {};
        var dfs = function (cur) {
            visited[cur] = true;
            for (var i = 0; i < reverseLinks[cur].length; i++) {
                var nxt = reverseLinks[cur][i];
                if (!visited[nxt]) {
                    dfs(nxt);
                }
            }
        };

        dfs(startFid);

        var result = [];
        for (i = 0; i < n; i++) {
            if (!visited[fids[i]]) {
                result.push(fids[i]);
            }
        }

        var fnS = this.getFnUnitById(startFid);
        result = result.filter(function (fid) {
            var fnT = _this.getFnUnitById(fid);
            var defT = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnT.func);
            return !defT['acceptable-functions'] ||
                defT['acceptable-functions'].indexOf(fnS.func) >= 0;
        });
        return result;
    };

    DiagramEditorPage.prototype.checkLinkPosition = function (link) {
        var sourceElement = link.getSourceElement();
        var targetElement = link.getTargetElement();
        if (typeof sourceElement.position === 'function' && typeof targetElement.position === 'function') {
            var sourcePos = sourceElement.position();
            var targetPos = targetElement.position();
            return targetPos.x > sourcePos.x;
        } else {
            return true;
        }
    };

    DiagramEditorPage.prototype.checkAlreadyExistLink = function (link) {
        var sourceFid = link.getSourceElement().attributes.fid;
        var targetFid = link.getTargetElement().attributes.fid;
        var links = this.getModel().links;
        for (var i = 0; i < links.length; i++) {
            if (links[i][SOURCE_FID] === sourceFid && links[i][TARGET_FID] === targetFid) return false;
        }
        return true;
    };

    DiagramEditorPage.prototype.checkAlreadyExistLinkByTableId = function (link) {
        var sourceFid = link.getSourceElement().attributes.fid;
        var targetFid = link.getTargetElement().attributes.fid;

        var sourceFnUnit = this.getFnUnitById(sourceFid);
        var targetFnUnit = this.getFnUnitById(targetFid);

        var sourceOutData = FnUnitUtils.getOutData(sourceFnUnit);
        var targetInData = FnUnitUtils.getInData(targetFnUnit);

        for (var sourceIndex in sourceOutData) {
            if (targetInData && targetInData.indexOf(sourceOutData[sourceIndex]) > -1) return false;
        }

        return true;
    };

    DiagramEditorPage.prototype.registerGoHistoryEventListener = function () {
        var _this = this;
        var modelEditorRef = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);
        this.onGoHistoryCommand = function (command) {
            _this.hideSelectionBox();
            _this.render();

            var errorIds = [];
            var errorFigures = [];
            for (var j in _this.problems) {
                if (errorIds[_this.problems[j].fid] === undefined) {
                    errorIds.push(_this.problems[j].fid);
                    errorFigures.push(_this.getFigureByFnUnitId(_this.problems[j].fid));
                }
            }
            _this.hideErrorBox();
            _this.showErrorBox(errorFigures);
        };

        modelEditorRef.addGoHistoryListener(this.onGoHistoryCommand);
    };

    DiagramEditorPage.prototype.updateStatus = function (event) {
        var figure = this.getFigureByFnUnitId(event.fid);
        if (figure) figure.updateStatus(event.status);
    };

    DiagramEditorPage.prototype.destroy = function () {
        Studio.getInstance().removeProblemListener(this.problemsListener);
        Studio.getInstance().removeDebugListener(this.debugListener);
        if (this.boundHandleBlankPointerUp) {
            Studio.getInstance().getControl().off('mouseup', this.boundHandleBlankPointerUp);
        }
    };

    DiagramEditorPage.prototype.registerKeyListener = function () {
    };

    DiagramEditorPage.prototype._addTemplate = function (template) {
        var _this = this;
        this.$copyTemplate.css({
            'top': _this.mouseY,
            'left': _this.mouseX,
            'position': 'absolute',
            'width': $(window).data('function-clipboard-width'),
            'height': $(window).data('function-clipboard-height'),
            'background': 'transparent',
            'border': 'none',
            'padding': 'none',
            'margin': 'none'
        });

        this.$copyTemplate.find('.brtc-va-views-library-template-preview').empty();

        var $paperElement = this.$copyTemplate.find('.brtc-va-views-library-template-preview');
        $paperElement.css('background', 'transparent');

        var graph = new joint.dia.Graph();
        var paper = new joint.dia.Paper({
            el: $paperElement,
            width: '100%',
            height: '100%',
            model: graph,
            interactive: false,
            theme: 'none'
        });
        paper.$el.css('pointer-events', 'none');
        paper.scale(1);

        var i;
        for (i in template.functions) {
            var figure = this._createFnUnitFigure(template.functions[i]);
            graph.addCells([figure]);
        }
        for (i in template.links) {
            var link = this._createLinkFigureCopy(graph, template.links[i]);
            graph.addCells([link]);
        }
        var links = graph.getLinks();
        $.each(links, function (index, link) {
            link.toBack();
        });

        this._draggableTemplate(this.$copyTemplate, template);

        return this.$copyTemplate;
    };

    DiagramEditorPage.prototype._draggableTemplate = function ($template, contents) {
        $('.brtc-va-studio').addClass('brtc-va-studio-dragging');
    };

    DiagramEditorPage.prototype._createFnUnitFigure = function (fnUnit) {
        fnUnit.display.diagram.position.x += Brightics.VA.Env.Diagram.PAPER_MARGIN_LEFT;
        fnUnit.display.diagram.position.y += Brightics.VA.Env.Diagram.PAPER_MARGIN_TOP;

        var figure = new Brightics.VA.Core.Shapes.FnUnitFigure({
            position: fnUnit.display.diagram.position,
            size: {
                width: Brightics.VA.Env.Diagram.FIGURE_WIDTH,
                height: Brightics.VA.Env.Diagram.FIGURE_HEIGHT
            },
            fid: fnUnit.fid,
            ports: {
                groups: {
                    'in:l': {
                        position: {
                            name: 'left'
                        },
                        attrs: {
                            '.fnunit-port': {
                                stroke: 'red'
                            }
                        }
                    },
                    'out:r': {
                        position: {
                            name: 'right',
                        },
                        attrs: {
                            '.fnunit-port': {
                                stroke: 'blue'
                            }
                        }
                    }
                },
                items: [IN_PORT, OUT_PORT]
            }
        });

        figure.label(fnUnit.display.label, 1);

        var clazz = this.options.editor.getModelType();
        var funcDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', fnUnit.func);
        if (funcDef) {
            figure.tooltip(fnUnit.display.label + ' (' + funcDef.defaultFnUnit.display.label + ')');
            figure.category(funcDef);
        }

        return figure;
    };

    DiagramEditorPage.prototype._createLinkFigureCopy = function (graph, linkUnit) {
        var sourceFigure = this.getFigureByFnUnitIdCopy(graph, linkUnit[SOURCE_FID]);
        var targetFigure = this.getFigureByFnUnitIdCopy(graph, linkUnit[TARGET_FID]);
        return new Brightics.VA.Core.Shapes.LinkFigure({
            kid: linkUnit.kid,
            source: {
                id: sourceFigure.id,
                port: OUT_PORT_ID
            },
            target: {
                id: targetFigure.id,
                port: IN_PORT_ID
            }
        });
    };


    DiagramEditorPage.prototype.getFigureByFnUnitIdCopy = function (graph, fid) {
        var figures = graph.getElements();
        for (var i in figures) {
            if (figures[i].attributes.fid === fid) {
                return figures[i];
            }
        }
    };

    DiagramEditorPage.prototype.setModel = function (model) {
        this.render();
        this.hideAdditionalItems();
    };

    DiagramEditorPage.prototype.hideAdditionalItems = function (model) {
        this.hideValidationToolTip();
        this.hideSelectionBounds();
        this.hideErrorBox();
        this.hideGuideBox();
        this.hideGuideMessage();
        this.hideTools(true);
        this.hideToolTip();
    };

    DiagramEditorPage.prototype.createNewActivityCommand = function (fnUnit) {
        var options = Brightics.VA.Core.Utils.NestedFlowUtils.getNewActivityCommandOptions(fnUnit);
        return _.map(options, function (opt) {
            return new Brightics.VA.Core.Editors.Diagram.Commands.NewActivityCommand(this, opt);
        }.bind(this));
    };

    DiagramEditorPage.prototype.createRemoveConnectedOutDataCommand = function (figures) {
        var _this = this;
        var commands = [];
        var indices = [];
        var activeModel = this.getEditor().getActiveModel();
        _.forEach(figures, function (figure) {
            var fnUnit = _this.getFnUnitById(figure.attributes.fid);
            var outData = FnUnitUtils.getOutData(fnUnit);

            for (var i = 0; outData && i < outData.length; i++) {
                var index = _.indexOf(activeModel[OUT_DATA], outData[i]);
                if (index > -1) {
                    indices.push(index);
                }
            }
        });

        indices.sort(function (a, b) {
            return b - a;
        });

        for (var i = 0; i < indices.length; i++) {
            commands.push(new Brightics.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(
                this,
                {
                    target: activeModel,
                    path: [OUT_DATA, indices[i]]
                }
            ));
        }

        if (this.isNestedFlow()) {
            var nextFnUnitOutTableSize =
                Brightics.VA.Core.Utils.NestedFlowUtils.calcNextFnUnitOutTableSize(
                    this.getEditor().getModel(),
                    this.getEditor().getActiveFnUnit(),
                    activeModel.mid,
                    -indices.length);

            commands.push(Brightics.VA.Core.Utils.NestedFlowUtils.createAdjustOutTableCommand(
                this,
                this.getEditor().getModel(),
                this.getEditor().getActiveFnUnit(),
                nextFnUnitOutTableSize
            ));
        }
        return _.flatten(commands);
    };

    DiagramEditorPage.prototype.getEditorInput = function () {
        return this.getEditor().getEditorInput();
    };

    DiagramEditorPage.prototype.getEditor = function () {
        return this.options.editor;
    };

    DiagramEditorPage.prototype.getModel = function () {
        return this.options.editor.getActiveModel();
    };

    DiagramEditorPage.prototype.isNestedFlow = function () {


        var activeFnUnit = this.getEditor().getActiveFnUnit();
        return activeFnUnit &&
            (activeFnUnit.func === 'if' ||
                activeFnUnit.func === 'forLoop' ||
                activeFnUnit.func === 'whileLoop');
    };

    DiagramEditorPage.prototype.getOptions = function () {
        return this.options;
    };

    DiagramEditorPage.prototype.hasModel = function (categoty, fnUnit) {
        var categoryArr = ['process', 'control'];

        return (categoryArr.indexOf(categoty) > -1 &&
            fnUnit[FUNCTION_NAME] !== 'Flow') ? true : false;
    };

    DiagramEditorPage.prototype.handleBlankMouseLeave = function (evt) {
        /**
         * sungjin1.kim@samsung.com
         * 사용성 점검 조치: Diagram Editor 여백의 'Add' 버튼 클릭시 'Select Function' 팝업이 뜨면서 배경의 'Add' 버튼이 사라져서 사용자가 제대로 된 위치에 버튼을 눌렀는지에 대한 확신을 가지기 어려움
         */
        // this.$createCue.css('display', 'none');
    };

    DiagramEditorPage.prototype.handleBlankMouseEnter = function (evt) {
    };

    DiagramEditorPage.prototype.changeCursor = function (model, cursor) {
        var clazz = [
            'brtc-style-cursor-pointer',
            'brtc-style-cursor-move'
        ];
        var view = V(this.paper.findViewByModel(model).el);
        clazz.forEach(function (cl) {
            view.removeClass(cl, false);
        });

        if (cursor === 'pointer') {
            view.addClass('brtc-style-cursor-pointer', true);
        } else if (cursor === 'move') {
            view.addClass('brtc-style-cursor-move', true);
        }
    };

    DiagramEditorPage.prototype.ensureCenterByFnUnit = function (fnUnit) {
        var figure = this.getFigureByFnUnitId(fnUnit.fid);
        this.ensureCenter(figure);
    };

    DiagramEditorPage.prototype.refresh = function () {
        var figures = this.graph.getElements();
        for (var i in figures) {
            figures[i].refresh();
        }
    };

    Brightics.VA.Core.Editors.Diagram.DiagramEditorPage = DiagramEditorPage;
    /* eslint-disable no-invalid-this */
}).call(this);

/* -----------------------------------------------------
 *  add-operation-command.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-27.
 * ---------------------------------------------------- */

(function () {
    'use strict';
    var root = this;
    var Brightics = root.Brightics;
    var ObjectUtils = root.__module__.ObjectUtils;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function AddOperationCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    AddOperationCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    AddOperationCommand.prototype.constructor = AddOperationCommand;

    AddOperationCommand.prototype.canUndo = function () {
        return true;
    };

    AddOperationCommand.prototype.canRedo = function () {
        return true;
    };

    AddOperationCommand.prototype.execute = function () {
        this.setValue(this.options.path, this.options.value);
    };

    AddOperationCommand.prototype.undo = function () {
        this.removeValue(this.options.path);
    };

    AddOperationCommand.prototype.redo = function () {
        this.execute();
    };

    AddOperationCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.addoperationcommand';
    };

    AddOperationCommand.prototype.getLabel = function () {
        return this.options.label;
    };

    // AddOperationCommand.prototype.copy = function (newValue) {
    //     return _.clone(newValue);
    //     // if (newValue instanceof Array) return $.extend(true, [], newValue);
    //     // else if (newValue instanceof Object) return $.extend(true, {}, newValue);
    //     // return newValue;
    // };

    AddOperationCommand.prototype.setValue = function (path, newValue) {
        var fn = this.options.fnUnit || this.options.target;
        ObjectUtils.addProp(fn, path, newValue);
        // var idx = -1;
        // var len = path.length;
        // while (++idx < len - 1) {
        //     fn = fn[path[idx]];
        // }
        // fn[path[path.length - 1]] = this.copy(newValue);
    };

    AddOperationCommand.prototype.removeValue = function (path) {
        var fn = this.options.fnUnit || this.options.target;
        ObjectUtils.removeProp(fn, path);
        // var idx = -1;
        // var len = path.length;
        // while (++idx < len - 1) {
        //     fn = fn[path[idx]];
        // }
        // if (fn instanceof Array) {
        //     fn.splice(path[path.length - 1], 1);
        // } else {
        //     delete fn[path[path.length - 1]];
        // }
    };

    Brightics.VA.Core.Editors.Diagram.Commands.AddOperationCommand = AddOperationCommand;
/* eslint-disable no-invalid-this */
}.call(this));


/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AddFnUnitParameterCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    AddFnUnitParameterCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    AddFnUnitParameterCommand.prototype.constructor = AddFnUnitParameterCommand;

    AddFnUnitParameterCommand.prototype.execute = function () {
        this.old.param = $.extend(true, {}, this.options.fnUnit.param);
        $.extend(true, this.options.fnUnit.param, this.options.ref.param);
    };

    AddFnUnitParameterCommand.prototype.undo = function () {
        for (var key in this.options.fnUnit.param) delete this.options.fnUnit.param[key];
        $.extend(true, this.options.fnUnit.param, this.old.param);
    };

    AddFnUnitParameterCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.addfnunitparametercommand';
    };

    AddFnUnitParameterCommand.prototype.getLabel = function () {
        return 'Change FnUnit Properties';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.AddFnUnitParameterCommand = AddFnUnitParameterCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      kid : '',
     *      source-fid : '',
     *      target-fid : ''
     * }
     * @param options
     * @constructor
     */
    function AddInnerModelCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    AddInnerModelCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    AddInnerModelCommand.prototype.constructor = AddInnerModelCommand;

    AddInnerModelCommand.prototype.canUndo = function () {
        return true;
    };

    AddInnerModelCommand.prototype.canRedo = function () {
        return true;
    };

    AddInnerModelCommand.prototype.execute = function () {
        var innerModels = this.options.activeModel.innerModels;

        
        this.options.activeModel.links.push(this.linkUnit);

        var sourceFnUnit = this.options.activeModel.getFnUnitById(this.options[SOURCE_FID]);
        var targetFnUnit = this.options.activeModel.getFnUnitById(this.options[TARGET_FID]);

        if (sourceFnUnit[OUT_DATA].length > 0 && targetFnUnit.hasOwnProperty('inData')) {
            var clazz = targetFnUnit.parent().type;
            var inTableMaxLength = Brightics.VA.Core.Interface.Functions[clazz][targetFnUnit.func]['in-range'].max;

            if (targetFnUnit[IN_DATA] && targetFnUnit[IN_DATA].length < inTableMaxLength && this.options.isMaintainIntable !== true) {
                targetFnUnit[IN_DATA].push(sourceFnUnit[OUT_DATA][0]);
            }

            if (targetFnUnit.func === 'unload') {
                targetFnUnit.param['df-names'] = targetFnUnit[IN_DATA];
            }


            if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], targetFnUnit[IN_DATA]);
                if (targetFnUnit.param.functions[0].func === 'unload') {
                    targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
                }
            }
        }
    };

    AddInnerModelCommand.prototype.undo = function () {
        //TODO
    };

    AddInnerModelCommand.prototype.redo = function () {
        this.execute();
    };

    AddInnerModelCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.addInnerModelCommand';
    };

    AddInnerModelCommand.prototype.getLabel = function () {
        return 'Add InnerModel';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.AddInnerModelCommand = AddInnerModelCommand;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-04-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function AddVariableDefCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    AddVariableDefCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    AddVariableDefCommand.prototype.constructor = AddVariableDefCommand;

    AddVariableDefCommand.prototype.canUndo = function () {
        return true;
    };

    AddVariableDefCommand.prototype.canRedo = function () {
        return true;
    };

    AddVariableDefCommand.prototype.execute = function () {
        var analyticsModel = this.getMainModel();
        analyticsModel.addVariableDef(this.options.name, this.options.ref);
    };

    AddVariableDefCommand.prototype.undo = function () {
        var analyticsModel = this.getMainModel();
        analyticsModel.removeVariableDef(this.options.name);
    };

    AddVariableDefCommand.prototype.redo = function () {
        this.execute();
    };

    AddVariableDefCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.addvariabledefcommand';
    };

    AddVariableDefCommand.prototype.getLabel = function () {
        return 'Add Variable';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand = AddVariableDefCommand;

}).call(this);
/**
 * Created by daewon.park on 2016-03-14.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      selectedId : ''
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function AppendNewFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.CompoundCommand.call(this, eventSource, options);
    }

    AppendNewFnUnitCommand.prototype = Object.create(Brightics.VA.Core.CompoundCommand.prototype);
    AppendNewFnUnitCommand.prototype.constructor = AppendNewFnUnitCommand;

    AppendNewFnUnitCommand.prototype.execute = function () {
        this.commandList = [];

        var selected = this.options.analyticsModel.getFnUnitById(this.options.selectedId);

        // shift right
        var shiftCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ShiftRightCommand(this.event.source, {
            fid: selected.fid
        });
        this.add(shiftCommand);

        // rollback selected
        var moveCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitPositionCommand(this.event.source, {
            fid: selected.fid,
            position: {
                x: selected.display.diagram.position.x,
                y: selected.display.diagram.position.y
            }
        });
        this.add(moveCommand);

        // create a new function
        this.options.fnUnit.display.diagram.position.x = selected.display.diagram.position.x + 150;
        this.options.fnUnit.display.diagram.position.y = selected.display.diagram.position.y;
        var newCommand = new Brightics.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand(this.event.source, {
            fnUnit: this.options.fnUnit
        });
        this.add(newCommand);

        // reconnect
        var connectCommand;
        for (var i in this.options.analyticsModel.links) {
            var link = this.options.analyticsModel.links[i];
            if (link[SOURCE_FID] == this.options.selectedId) {
                connectCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this.event.source, {
                    kid: link.kid,
                    'sourceFid': this.options.fnUnit.fid,
                    'targetFid': link[TARGET_FID]
                });
                this.add(connectCommand);
            }
        }

        // connect
        connectCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand(this.event.source, {
            kid: Brightics.VA.Core.Utils.IDGenerator.func.id(),
            'sourceFid': this.options.selectedId,
            'targetFid': this.options.fnUnit.fid
        });
        this.add(connectCommand);

        Brightics.VA.Core.CompoundCommand.prototype.execute.call(this);
    };

    AppendNewFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.appendnewfnunitcommand';
    };

    AppendNewFnUnitCommand.prototype.getLabel = function () {
        return 'Append a new Function';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.AppendNewFnUnitCommand = AppendNewFnUnitCommand;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-04-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function BindVariableCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    BindVariableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    BindVariableCommand.prototype.constructor = BindVariableCommand;

    BindVariableCommand.prototype.canUndo = function () {
        return true;
    };

    BindVariableCommand.prototype.canRedo = function () {
        return true;
    };

    BindVariableCommand.prototype.execute = function () {
        var variable = this.getMainModel().getVariable(this.options.fid, this.options.paramKey);
        if (variable) {
            this.old.variable = variable;
            this.getMainModel().setVariable(this.options.fid, this.options.paramKey, this.options.variable);
        }
        else this.getMainModel().addVariable(this.options.fid, this.options.paramKey, this.options.variable);
    };

    BindVariableCommand.prototype.undo = function () {
        if (this.old.variable) this.getMainModel().setVariable(this.options.fid, this.options.paramKey, this.old.variable);
        else this.getMainModel().removeVariable(this.options.fid, this.options.paramKey);
    };

    BindVariableCommand.prototype.redo = function () {
        this.execute();
    };

    BindVariableCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.bindvariablecommand';
    };

    BindVariableCommand.prototype.getLabel = function () {
        return 'Bind Variable';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.BindVariableCommand = BindVariableCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ChangeDataSourceCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    ChangeDataSourceCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ChangeDataSourceCommand.prototype.constructor = ChangeDataSourceCommand;


    ChangeDataSourceCommand.prototype.execute = function () {
        this.old.panel = {};
        // backup
        this.old.panel.tableIndexes = this.options.panel.tableIndexes || [0];
        // change
        this.options.panel.tableIndexes = this.options.ref.panel.tableIndexes;
    };

    ChangeDataSourceCommand.prototype.undo = function () {
        this.options.panel.tableIndexes = this.old.panel.tableIndexes;
    };

    ChangeDataSourceCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.changedatasourcecommand';
    };

    ChangeDataSourceCommand.prototype.getLabel = function () {
        return 'Change Chart Data Source';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand = ChangeDataSourceCommand;

}).call(this);
/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ChangeInputsCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit Inputs Properties';
    }

    ChangeInputsCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ChangeInputsCommand.prototype.constructor = ChangeInputsCommand;

    ChangeInputsCommand.prototype.execute = function () {
        this.old = $.extend(true, {}, this.FnUnitUtils.getInputs(this.options.fnUnit));

        this.options.fnUnit.inputs = this.options.ref.inputs;
    };

    ChangeInputsCommand.prototype.undo = function () {
        this.options.fnUnit.inputs = this.old;
    };

    ChangeInputsCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.changeinputscommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand = ChangeInputsCommand;

}).call(this);

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');
    var ObjectUtils = root.__module__.ObjectUtils;

    function ChangeIntableCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit In-Table Properties';
    }

    ChangeIntableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ChangeIntableCommand.prototype.constructor = ChangeIntableCommand;

    ChangeIntableCommand.prototype.execute = function () {
        // this.old = $.extend(true, [], this.options.fnUnit[IN_DATA]);
        this.old = $.extend(true, [], FnUnitUtils.getInputs(this.options.fnUnit));

        // this.options.fnUnit[IN_DATA] = $.extend(true, [], this.options.ref[IN_DATA]);
        var meta = FnUnitUtils.getMeta(this.options.fnUnit);
        if (meta) {
            var key = FnUnitUtils.getKeyByType(this.options.fnUnit, 'table', 'in');
            this.options.fnUnit.inputs[key] = this.options.ref[0] || '';
        } else {
            this.options.fnUnit[IN_DATA] = this.options.ref;
        }

        if (this.options.fnUnit[FUNCTION_NAME] === 'Subflow') {
            this.options.fnUnit.param.functions[0][IN_DATA] = $.extend(true, [], this.options.fnUnit[IN_DATA]);
        } else if (this.options.fnUnit[FUNCTION_NAME] === 'If' ||
                this.options.fnUnit[FUNCTION_NAME] === 'ForLoop' ||
                this.options.fnUnit[FUNCTION_NAME] === 'WhileLoop') {
            this.processInnerModel();
        }
    };

    ChangeIntableCommand.prototype.undo = function () {
        // $.extend(true, this.options.fnUnit[IN_DATA], this.old);

        var meta = FnUnitUtils.getMeta(this.options.fnUnit);
        if (meta) {
            var key = FnUnitUtils.getKeyByType(this.options.fnUnit, 'table', 'in');
            this.options.fnUnit.inputs[key] = this.old[key];

        } else {
            this.options.fnUnit[IN_DATA] = this.old;
        }

        if (FnUnitUtils.getInData(this.options.fnUnit) && this.options.fnUnit[FUNCTION_NAME] === 'Subflow') {
            this.options.fnUnit.param.functions[0][IN_DATA] = $.extend(true, [], this.options.fnUnit[IN_DATA]);
        } else if (this.options.fnUnit[FUNCTION_NAME] === 'If' ||
            this.options.fnUnit[FUNCTION_NAME] === 'ForLoop' ||
            this.options.fnUnit[FUNCTION_NAME] === 'WhileLoop') {
            this.cancelInnerModel();
        }
    };

    ChangeIntableCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.changeintablecommand';
    };

    //처리해야함
    ChangeIntableCommand.prototype.processInnerModel = function () {
        var mainModel = this.options.mainModel;
        var fnUnit = this.options.fnUnit;
        var models = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(mainModel, fnUnit);
        var i;
        var j;
        var k;
        this.ops = [];
        this.oldByMid = {};
        for (i = 0; i < models.length; i++) {
            var model = models[i];
            var functions = model.functions;
            this.oldByMid[model.mid] = _.clone(model[IN_DATA]);
            model[IN_DATA] = FnUnitUtils.getInData(fnUnit);//fnUnit[IN_DATA];
            for (j = 0; j < functions.length; j++) {
                var fn = functions[j];
                if (!FnUnitUtils.getInData(fn)) continue;
                for (k = FnUnitUtils.getInData(fn).length - 1; k >= 0; k--) {
                    var tableId = FnUnitUtils.getInData(fn)[k];
                    var index = _.indexOf(FnUnitUtils.getInData(fnUnit), tableId);

                    //처리해야함
                    if (index === -1) {
                        this.ops.push({
                            fnUnit: fn,
                            path: [IN_DATA, k],
                            old: tableId
                        });
                    }
                }
            }
        }

        for (i = 0; i < this.ops.length; i++) {
            var op = this.ops[i];
            ObjectUtils.removeProp(op.fnUnit, op.path);
            if (op.fnUnit[FUNCTION_NAME] === 'Subflow') {
                op.fnUnit.param.functions[0][IN_DATA] =
                    $.extend(true, [], op.fnUnit[IN_DATA]);
            }
        }
    };

    //처리해야함
    ChangeIntableCommand.prototype.cancelInnerModel = function () {
        for (var i = this.ops.length - 1; i >= 0; --i) {
            var op = this.ops[i];
            ObjectUtils.addProp(op.fnUnit, op.path, op.old);
            if (op.fnUnit[FUNCTION_NAME] === 'Subflow') {
                op.fnUnit.param.functions[0][IN_DATA] =
                    $.extend(true, [], op.fnUnit[IN_DATA]);
            }
        }

        var _this = this;
        _.forIn(this.oldByMid, function (inData, mid) {
            var model = _this.getMainModel().getInnerModel(mid);
            if (model) {
                model[IN_DATA] = _.clone(inData);
            }
        });
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand = ChangeIntableCommand;

}).call(this);
/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ChangeMetaCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit Meta Properties';
    }

    ChangeMetaCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ChangeMetaCommand.prototype.constructor = ChangeMetaCommand;

    ChangeMetaCommand.prototype.execute = function () {
        this.old = $.extend(true, {}, this.FnUnitUtils.getMeta(this.options.fnUnit));

        this.options.fnUnit.meta = this.options.ref.meta;
    };

    ChangeMetaCommand.prototype.undo = function () {
        this.options.fnUnit.meta = this.old;
    };

    ChangeMetaCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.changemetacommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ChangeMetaCommand = ChangeMetaCommand;

}).call(this);

/**
 * Created by jhoon80.park on 2017-04-25.
 */
(function () {
    'use strict';
    var root = this;
    var Brightics = root.Brightics;
    function ChangeOutputsCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }
    ChangeOutputsCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ChangeOutputsCommand.prototype.constructor = ChangeOutputsCommand;
    ChangeOutputsCommand.prototype.canUndo = function () {
        return true;
    };
    ChangeOutputsCommand.prototype.canRedo = function () {
        return true;
    };

    ChangeOutputsCommand.prototype.findTypeChangedData = function () {
        var rt = [];

        var oldKeys = Object.keys(this.old['outputs']);
        var newOutputs = this.options.ref['outputs'];
        var oldMeta = this.FnUnitUtils.getMeta(this.options.fnUnit);
        var newMeta = this.options.ref['meta'];

        _.forEach(oldKeys, function (key) {
            var oldType = oldMeta[key].type;
            var newType = newMeta[key]? newMeta[key].type : oldType;

            if (oldType != newType) rt.push(newOutputs[key]);
        });

        return rt;
    };

    ChangeOutputsCommand.prototype.findDeletedData = function () {
        var _this = this;
        var oldKeys = Object.keys(this.old['outputs']);
        var newKeys = Object.keys(this.options.ref['outputs']);

        return _.difference(oldKeys, newKeys).map(function (key) {
            return _this.old['outputs'][key];
        });
    };

    ChangeOutputsCommand.prototype.findAddedData = function () {
        var _this = this;
        var oldKeys = Object.keys(this.old['outputs']);
        var newKeys = Object.keys(this.options.ref['outputs']);

        return _.difference(newKeys, oldKeys).map(function (key) {
            return _this.options.ref['outputs'][key];
        });
    };

    ChangeOutputsCommand.prototype.execute = function () {
        var _this = this;

        this.old['outputs'] = $.extend(true, {}, this.options.fnUnit['outputs']);
        
        var addedOutData = this.findAddedData();
        var deletedOutData = this.findDeletedData();
        var typeChangedData = this.findTypeChangedData();

        //fnUnit의 Out을 바꾼다.
        this.options.fnUnit['outputs'] = this.options.ref['outputs'];
        this.options.fnUnit['meta'] = this.options.ref['meta'];
        
        var nextFnUnits = this.options.analyticsModel.getNext(this.options.fnUnit.fid);
        var changedFnUnits = [];

        _.forEach(addedOutData, function (addedTid) {
            _.forEach(nextFnUnits, function (fid) {
                var nextFn = _this.options.analyticsModel.getFnUnitById(fid);
                var nextInData = _this.FnUnitUtils.getInData(nextFn);
                if (nextInData.indexOf(addedTid) < 0) {
                    if (_this.FnUnitUtils.hasMeta(nextFn)) {
                        changedFnUnits.push({fid: nextFn.fid, 'inputs': _.extend({}, nextFn['inputs'])});
                    } else {
                        changedFnUnits.push({fid: nextFn.fid, 'inData': _.extend([], nextFn[IN_DATA])});
                    }

                    var type = _this.FnUnitUtils.getTypeByTableId(_this.options.fnUnit, addedTid);
                    _this.FnUnitUtils.addInData(nextFn, type, [addedTid]); 
                };
            });
        });

        _.forEach(deletedOutData, function (deletedTid) {
            _.forEach(nextFnUnits, function (fid) {
                var nextFn = _this.options.analyticsModel.getFnUnitById(fid);
                var nextInData = _this.FnUnitUtils.getInData(nextFn);
                if (nextInData.indexOf(deletedTid) > -1) {
                    if (_this.FnUnitUtils.hasMeta(nextFn)) {
                        changedFnUnits.push({fid: nextFn.fid, 'inputs': _.extend({}, nextFn['inputs'])});
                    } else {
                        changedFnUnits.push({fid: nextFn.fid, 'inData': _.extend([], nextFn[IN_DATA])});
                    }

                    var type = _this.FnUnitUtils.getTypeByTableId(nextFn, deletedTid);
                    _this.FnUnitUtils.removeInData(nextFn, type, deletedTid); 
                };
            });
        });

        _.forEach(typeChangedData, function (changedTid) {
            _.forEach(nextFnUnits, function (fid) {
                var nextFn = _this.options.analyticsModel.getFnUnitById(fid);
                var nextInData = _this.FnUnitUtils.getInData(nextFn);
                var currentType = _this.FnUnitUtils.getTypeByTableId(_this.options.fnUnit, changedTid);
                var nextType = _this.FnUnitUtils.getTypeByTableId(nextFn, changedTid);

                if (nextInData.indexOf(changedTid) > -1 && currentType != nextType) {
                    if (_this.FnUnitUtils.hasMeta(nextFn)) {
                        changedFnUnits.push({fid: nextFn.fid, 'inputs': _.extend({}, nextFn['inputs'])});
                    } else {
                        changedFnUnits.push({fid: nextFn.fid, 'inData': _.extend([], nextFn[IN_DATA])});
                    }

                    _this.FnUnitUtils.removeInData(nextFn, nextType, changedTid); 
                };
            });
        });

        this.old.changedNextFnUnit = _.extend([], changedFnUnits);
    };
    ChangeOutputsCommand.prototype.undo = function () {
        var _this = this;
        this.options.fnUnit['outputs'] = this.old['outputs'];
        var nextFnUnits = this.options.analyticsModel.getNext(this.options.fnUnit.fid);

        for (var i in nextFnUnits) {
            for (var j in this.old.changedNextFnUnit) {
                var oldFnUnit = this.old.changedNextFnUnit[j];
                var nextFnUnit = this.options.analyticsModel.getFnUnitById(nextFnUnits[i]);
                if (nextFnUnit.fid === oldFnUnit.fid) {
                    if (this.FnUnitUtils.hasMeta(nextFnUnit)) {
                        nextFnUnit['inputs'] = oldFnUnit['inputs'];
                    } else {
                        nextFnUnit[IN_DATA] = oldFnUnit[IN_DATA];
                    }
                    break;
                }
            }
        }
    };
    ChangeOutputsCommand.prototype.redo = function () {
        this.execute();
    };
    ChangeOutputsCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.changeoutputscommand';
    };
    ChangeOutputsCommand.prototype.getLabel = function () {
        return 'Delete Output';
    };
    Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutputsCommand = ChangeOutputsCommand;
    
}).call(this);

/**
 * Created by jhoon80.park on 2017-04-25.
 */
(function () {
        'use strict';
        var root = this;
        var Brightics = root.Brightics;
        function ChangeOutTableCommand(eventSource, options) {
            Brightics.VA.Core.Command.call(this, eventSource, options);
        }
        ChangeOutTableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
        ChangeOutTableCommand.prototype.constructor = ChangeOutTableCommand;
        ChangeOutTableCommand.prototype.canUndo = function () {
            return true;
        };
        ChangeOutTableCommand.prototype.canRedo = function () {
            return true;
        };
        ChangeOutTableCommand.prototype.execute = function () {
            this.old[OUT_DATA] = $.extend(true, [], this.options.fnUnit[OUT_DATA]);
            //삭제된 Out-Table 목록으로 작업한다.
            var deletedOutTables = [];
            //out table이 추가 된 경우는 처리하지 않는다.
            //out table이 삭제된 경우
            for (var i in this.options.fnUnit[OUT_DATA]) {
                if (this.options.ref[OUT_DATA].indexOf(this.options.fnUnit[OUT_DATA][i]) == -1) {
                    deletedOutTables.push(this.options.fnUnit[OUT_DATA][i]);
                }
            }
            var nextFnUnits = this.options.analyticsModel.getNext(this.options.fnUnit.fid);
            var changedFnUnits = [];
            for (var i in deletedOutTables) {
                for (var j in nextFnUnits) {
                    var nextFnUnit = this.options.analyticsModel.getFnUnitById(nextFnUnits[j]);
                    var deletedOutTable = deletedOutTables[i];
                    //삭제할 out-table이 nextFnUnit의 In-table로 존재하는 경우
                    var nextFnUnitInTable = this.FnUnitUtils.getInTable(nextFnUnit);
                    if ($.inArray(deletedOutTable, nextFnUnitInTable) > -1) {
                        var fidList = changedFnUnits.map(function (fnUnit) {
                            return fnUnit.fid;
                        });
                        if (fidList.indexOf(nextFnUnit.fid) == -1) {
                            if (this.FnUnitUtils.hasMeta(nextFnUnit)) {
                                changedFnUnits.push({fid: nextFnUnit.fid, 'inputs': nextFnUnit['inputs']});
                            } else {
                                changedFnUnits.push({fid: nextFnUnit.fid, 'inData': nextFnUnit[IN_DATA]});
                            }
                        }
                    }
                }
            }
            this.old.changedNextFnUnit = $.extend(true, [], changedFnUnits);
            this.options.fnUnit[OUT_DATA] = this.options.ref[OUT_DATA];
            for (var i in deletedOutTables) {
                var deletedOutTable = deletedOutTables[i];
                //나와 연결된 FnUnit들의 In-Table에서 하나씩 삭제한다.
                for (var j in nextFnUnits) {
                    var nextFnUnit = this.options.analyticsModel.getFnUnitById(nextFnUnits[j]);
                    var nextFnUnitInTable = this.FnUnitUtils.getInTable(nextFnUnit);
                    if ($.inArray(deletedOutTable, nextFnUnitInTable) > -1) {
                        this.FnUnitUtils.removeInData(nextFnUnit, 'table', deletedOutTable);
                    }
                }
            }
        };
        ChangeOutTableCommand.prototype.undo = function () {
            this.options.fnUnit[OUT_DATA] = this.old[OUT_DATA];
            var nextFnUnits = this.options.analyticsModel.getNext(this.options.fnUnit.fid);
            for (var i in nextFnUnits) {
                for (var j in this.old.changedNextFnUnit) {
                    var oldFnUnit = this.old.changedNextFnUnit[j];
                    var nextFnUnit = this.options.analyticsModel.getFnUnitById(nextFnUnits[i]);
                    if (nextFnUnit.fid === oldFnUnit.fid) {
                        if (this.FnUnitUtils.hasMeta(nextFnUnit)) {
                            nextFnUnit['inputs'] = oldFnUnit['inputs'];
                        } else {
                            nextFnUnit[IN_DATA] = oldFnUnit[IN_DATA];
                        }

                        break;
                    }
                }
            }
        };

        ChangeOutTableCommand.prototype.redo = function () {
            this.execute();
        };
        ChangeOutTableCommand.prototype.getId = function () {
            return 'brightics.va.editors.diagram.commands.deleteouttablecommand';
        };
        ChangeOutTableCommand.prototype.getLabel = function () {
            return 'Delete Output';
        };
        Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand = ChangeOutTableCommand;
    }
).call(this);

/**
 * Created by ty_tree.kim on 2016-02-11.
 */

/* global _, IN_DATA, OUT_DATA, SOURCE_FID, TARGET_FID, FUNCTION_NAME */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');
    var INNER_MODEL_FUNC = ['If', 'ForLoop', 'WhileLoop'];

    /**
     * options : {
     *      kid : '',
     *      source-fid : '',
     *      target-fid : ''
     * }
     * @param options
     * @constructor
     */
    function ConnectFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    ConnectFnUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ConnectFnUnitCommand.prototype.constructor = ConnectFnUnitCommand;

    ConnectFnUnitCommand.prototype.canUndo = function () {
        return true;
    };

    ConnectFnUnitCommand.prototype.canRedo = function () {
        return true;
    };

    ConnectFnUnitCommand.prototype.execute = function () {
        var i;
        for (i in this.options.analyticsModel.links) {
            if (this.options.analyticsModel.links[i][SOURCE_FID] === this.options[SOURCE_FID] &&
                this.options.analyticsModel.links[i][TARGET_FID] === this.options[TARGET_FID]) {
                // Already Linked
                return false;
            }
        }

        this.linkUnit = {
            'kid': this.options.kid,
            'sourceFid': this.options[SOURCE_FID],
            'targetFid': this.options[TARGET_FID]
        };
        this.options.analyticsModel.links.push(this.linkUnit);

        var sourceFnUnits = this.getSourceUnits(this.options[SOURCE_FID]);
        var targetFnUnits = this.getTargetUnits(this.options[TARGET_FID]);

        var _this = this;
        var valid = true;
        _.forEach(targetFnUnits, function (targetFnUnit) {
            _.forEach(sourceFnUnits, function (sourceFnUnit) {
                // if (!(!_this.isProcessFunction(sourceFnUnit) &&
                //     sourceFnUnit[OUT_DATA] &&
                //     sourceFnUnit[OUT_DATA].length > 0 &&
                //     targetFnUnit.hasOwnProperty(IN_DATA) &&
                //     _.indexOf(targetFnUnit[IN_DATA], sourceFnUnit[OUT_DATA][0]) === -1)) {
                //     return true;
                // }
                var sourceOutData = _this.FnUnitUtils.getOutData(sourceFnUnit);
                var targetInData = _this.FnUnitUtils.getInData(targetFnUnit);

                // !(process 함수가 아니다 && 소스데이터가 있다 && 소스데이터 1개이상 && 타겟에 인풋이 필요 && 타겟에 소스[0]이 없다)
                // process함수거나, 소스데이터 없거나, 타겟에 인풋필요없거나, 타겟에 소스[0] 이미 있거나
                if (!(!_this.FnUnitUtils.isProcessFunction(sourceFnUnit) &&
                    sourceOutData &&
                    sourceOutData.length > 0 &&
                    _this.FnUnitUtils.hasInput(targetFnUnit) &&
                    !_this.FnUnitUtils.isExist(sourceFnUnit, targetFnUnit))) {
                    return true;
                }

                var inTableMaxLength = _this.FnUnitUtils.getTotalInRangeCount(targetFnUnit).max;
                // var clazz = targetFnUnit.parent().type;
                // var inTableMaxLength = Brightics.VA.Core.Interface
                //     .Functions[clazz][targetFnUnit.func]['in-range'].max;

                if (_this.FnUnitUtils.isProcessFunction(targetFnUnit)) {
                    var diff = _.difference(sourceOutData, targetInData);
                    if (diff.length + targetInData.length > inTableMaxLength) {
                        valid = false;
                        return;
                    }
                    _this.FnUnitUtils.connect(sourceFnUnit, targetFnUnit);

                } else if (targetInData &&
                    _this.FnUnitUtils.isConnectable(sourceFnUnit, targetFnUnit) &&
                    _this.options.isMaintainIntable !== true) {
                        _this.FnUnitUtils.connect(sourceFnUnit, targetFnUnit);

                        if (_.find(INNER_MODEL_FUNC, _.matches(targetFnUnit[FUNCTION_NAME]))) {
                            var tid = sourceOutData[0];
                            _this.addTidsInnerModel(targetFnUnit, [tid]);
                        }
                }

                if (targetFnUnit.func === 'unload') {
                    targetFnUnit.param['df-names'] = targetFnUnit[IN_DATA];
                }

                if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                    targetFnUnit.param.functions[0][IN_DATA] =
                        $.extend(true, [], targetFnUnit[IN_DATA]);
                    if (targetFnUnit.param.functions[0].func === 'unload') {
                        targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
                    }
                }
                // return false = break in _.forEach
                // return false 왜 넣었는지 기억 안나서 주석처리
                // return false;
            });
        });
        if (!valid) return false;
    };

    ConnectFnUnitCommand.prototype.undo = function () {
        var links = this.options.analyticsModel.links;
        links.splice(links.indexOf(this.linkUnit), 1);

        var sourceFnUnits = this.getSourceUnits(this.options[SOURCE_FID]);
        var targetFnUnits = this.getTargetUnits(this.options[TARGET_FID]);

        var _this = this;
        _.forEach(targetFnUnits, function (targetFnUnit) {
            _.forEach(sourceFnUnits, function (sourceFnUnit) {

                var sourceOutData = _this.FnUnitUtils.getOutData(sourceFnUnit);
                var targetInData = _this.FnUnitUtils.getInData(targetFnUnit);

                if (!(sourceOutData &&
                    sourceOutData.length > 0 &&
                    !_this.FnUnitUtils.isProcessFunction(sourceFnUnit))) return;

                var inTables = targetInData;
                if (inTables && _this.options.isMaintainIntable !== true) {
                    _this.FnUnitUtils.disconnect(sourceFnUnit, targetFnUnit);

                    if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                        targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], inTables);
                        if (targetFnUnit.param.functions[0].func === 'unload') {
                            targetFnUnit.param.functions[0].param['df-names'] = inTables;
                        }
                    } else if (targetFnUnit[FUNCTION_NAME] === 'OutData') {
                        targetFnUnit.param['df-names'] = $.extend(true, [], inTables);
                    }
                }

                if (_.find(INNER_MODEL_FUNC, _.matches(targetFnUnit[FUNCTION_NAME]))) {
                    _this.removeTidsInnerModel(sourceFnUnit, targetFnUnit);
                }
            });
        });
    };

    ConnectFnUnitCommand.prototype.redo = function () {
        this.execute();
    };

    ConnectFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.connectfnunitcommand';
    };

    ConnectFnUnitCommand.prototype.getLabel = function () {
        return 'Connect a function';
    };

    ConnectFnUnitCommand.prototype.addTidsInnerModel = function (fnUnit, tids) {
        var subModels = Brightics.VA.Core.Utils.NestedFlowUtils
            .getSubModels(this.getMainModel(), fnUnit);
        _.forEach(tids, function (tid) {
            _.forEach(subModels, function (model) {
                if (_.indexOf(model[IN_DATA], tid) === -1) {
                    model[IN_DATA].push(tid);
                }
            });
        });
    };

    ConnectFnUnitCommand.prototype.removeTidsInnerModel = function (sourceFnUnit, targetFnUnit) {
        var _this = this;

        var tids = this.FnUnitUtils.getOutData(sourceFnUnit);;
        var subModels = Brightics.VA.Core.Utils.NestedFlowUtils
            .getSubModels(this.getMainModel(), targetFnUnit);
        _.forEach(tids, function (tid) {
            if (_this.hasToRemove(sourceFnUnit, targetFnUnit, tid)) {
                _.forEach(subModels, function (model) {
                    var idx = _.indexOf(model[IN_DATA], tid);
                    if (idx > -1) {
                        model[IN_DATA].splice(idx, 1);
                    }
                });
            }
        });
    };

    ConnectFnUnitCommand.prototype.getSourceUnits = function (fid) {
        return this.getTargetModel().getLinkSourceFnUnits(fid);
    };

    ConnectFnUnitCommand.prototype.getTargetUnits = function (fid) {
        return this.getTargetModel().getLinkTargetFnUnits(fid);
    };

    ConnectFnUnitCommand.prototype.hasToRemove = function (source, target, tid) {
        var _this = this;
        var prvFnUnits = this.getTargetModel().getLinkSourceFnUnits(target.fid);
        return _.every(prvFnUnits, function (fnUnit) {
            return _this.FnUnitUtils.isProcessFunction(fnUnit) ||
                fnUnit.fid === source.fid ||
                _.indexOf(_this.FnUnitUtils.getOutData(fnUnit), tid) === -1;
        });
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand = ConnectFnUnitCommand;

    /* eslint-disable no-invalid-this */
}).call(this);

/**
 * Created by daewon.park on 2016-03-05.
 */

/* global _, IN_DATA, OUT_DATA, SOURCE_FID, TARGET_FID, FUNCTION_NAME */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');
    var INNER_MODEL_FUNC = ['If', 'ForLoop', 'WhileLoop'];

    /**
     * options : {
     *      kid : ''
     * }
     * @param options
     * @constructor
     */
    function DisconnectFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.old = {};
    }

    DisconnectFnUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    DisconnectFnUnitCommand.prototype.constructor = DisconnectFnUnitCommand;

    DisconnectFnUnitCommand.prototype.canUndo = function () {
        return true;
    };

    DisconnectFnUnitCommand.prototype.canRedo = function () {
        return true;
    };

    DisconnectFnUnitCommand.prototype.execute = function () {
        this.old.linkUnit = this.options.analyticsModel.getLinkUnitById(this.options.kid);
        var i;
        var links = this.options.analyticsModel.links;
        links.splice(links.indexOf(this.old.linkUnit), 1);

        var sourceFnUnits = this.getSourceUnits(this.old.linkUnit[SOURCE_FID]);
        var targetFnUnits = this.getTargetUnits(this.old.linkUnit[TARGET_FID]);

        // model.getPrevious(fnUnit.fid).length
        // this.options.analyticsModel.getPrevious(this.old.linkUnit[TARGET_FID]).length === 1

        this.old['target-fnunit-in-table'] = {};
        this.old['additional-in-table'] = {};
        var _this = this;

        _.forEach(targetFnUnits, function (targetFnUnit) {
            _.forEach(sourceFnUnits, function (sourceFnUnit) {
                if (FnUnitUtils.isProcessFunction(sourceFnUnit)) return;
                if (_.find(INNER_MODEL_FUNC, _.matches(targetFnUnit[FUNCTION_NAME]))) {
                    _this.processInnerModel(sourceFnUnit, targetFnUnit);
                }
                if (FnUnitUtils.getInData(targetFnUnit)) {
                    for (i in FnUnitUtils.getOutData(sourceFnUnit)) {
                        if (_this.hasToRemove(sourceFnUnit, targetFnUnit, FnUnitUtils.getOutData(sourceFnUnit)[i])) {
                            var idx = FnUnitUtils.getInData(targetFnUnit).indexOf(FnUnitUtils.getOutData(sourceFnUnit)[i]);
                            if (idx > -1) {
                                var inputs = FnUnitUtils.wrapInputs(FnUnitUtils.getInputs(targetFnUnit));
                                _this.old['target-fnunit-in-table'][targetFnUnit.fid] =
                                    _this.old['target-fnunit-in-table'][targetFnUnit.fid] ||
                                    $.extend(true, {}, inputs);

                                FnUnitUtils.disconnect(sourceFnUnit, targetFnUnit);

                                if (targetFnUnit.func === 'unload' && !targetFnUnit.context) {
                                    targetFnUnit.param['df-names'].splice(idx, 1);
                                }
                            }
                        }
                    }

                    //fnUnit테스트필요???? 이거 뭡니까?
                    // targetFnUnit[IN_DATA]이 비어있고 targetFnUnit link가 한개일 때, Push 'inData'
                    /*
                    var prevFnUnitIds = _this.getTargetModel().getAllPreviousFnUnitIds(targetFnUnit.fid);
                    if (targetFnUnit.getInData().length === 0 && prevFnUnitIds.length === 1) {
                        var prevFnUnit = _this.getTargetModel().getFnUnitById(prevFnUnitIds[0]);
                        if (prevFnUnit.getOutData().length > 0) {

                            // targetFnUnit[IN_DATA].push(prevFnUnit[OUT_DATA][0]);
                            _this.old['additional-in-table'][targetFnUnit.fid] = [prevFnUnit[OUT_DATA][0]];
                        }
                    }
                    */

                    if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                        targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], targetFnUnit[IN_DATA]);
                        if (targetFnUnit.param.functions[0].func === 'unload') {
                            targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
                        }
                    } else if (targetFnUnit[FUNCTION_NAME] === 'OutData') {
                        targetFnUnit.param['df-names'] = $.extend(true, [], targetFnUnit[IN_DATA]);
                    }
                }
            });
        });
    };

    DisconnectFnUnitCommand.prototype.undo = function () {
        var links = this.options.analyticsModel.links;
        links.push(this.old.linkUnit);

        var _this = this;
        var targetFnUnits = this.getTargetUnits(this.old.linkUnit[TARGET_FID]);
        _.forEach(targetFnUnits, function (targetFnUnit) {
            if (FnUnitUtils.getInData(targetFnUnit)) {
                if (_this.old['additional-in-table'][targetFnUnit.fid] &&
                _this.old['additional-in-table'][targetFnUnit.fid].length > 0) {
                    //fnUnit테스트필요???? 이거 뭡니까?
                    // var idx = targetFnUnit[IN_DATA].indexOf(_this.old['additional-in-table'][targetFnUnit.fid][0]);
                    // if (idx > -1) {
                    //     targetFnUnit[IN_DATA].splice(idx, 1);
                    // }
                }

                if (_this.old['target-fnunit-in-table'][targetFnUnit.fid]) {
                    // targetFnUnit[IN_DATA] = _this.old['target-fnunit-in-table'][targetFnUnit.fid];
                    $.extend(true, targetFnUnit, _this.old['target-fnunit-in-table'][targetFnUnit.fid]);
                }


                if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                    targetFnUnit.param.functions[0][IN_DATA] =
                        $.extend(true, [], targetFnUnit[IN_DATA]);
                    if (targetFnUnit.param.functions[0].func === 'unload') {
                        targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
                    }
                } else if (targetFnUnit[FUNCTION_NAME] === 'OutData') {
                    targetFnUnit.param['df-names'] = $.extend(true, [], targetFnUnit[IN_DATA]);
                }
            }
        });

        if (this.removedTables) {
            this.cancelProcessInnerModel();
        }
    };

    DisconnectFnUnitCommand.prototype.redo = function () {
        this.execute();
    };

    DisconnectFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.disconnectfnunitcommand';
    };

    DisconnectFnUnitCommand.prototype.getLabel = function () {
        return 'Disconnect a function';
    };

    DisconnectFnUnitCommand.prototype.processInnerModel = function (sourceFnUnit, targetFnUnit) {
        var mainModel = this.options.mainModel;
        var models = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(mainModel, targetFnUnit);

        var i;
        var j;

        this.removedTables = this.removedTables || {};

        for (i = 0; i < models.length; i++) {
            var model = models[i];
            this.removedTables[model.mid] = this.removedTables[model.mid] || [];
            for (j = model[IN_DATA].length - 1; j >= 0; --j) {
                if (_.indexOf(FnUnitUtils.getOutData(sourceFnUnit), model[IN_DATA][j]) > -1 &&
                    this.hasToRemove(sourceFnUnit, targetFnUnit, model[IN_DATA][j])) {
                    this.removedTables[model.mid].push({ index: j, id: model[IN_DATA][j] });
                    model[IN_DATA].splice(j, 1);
                }
            }
        }
    };

    DisconnectFnUnitCommand.prototype.cancelProcessInnerModel = function () {
        var j;
        var _this = this;
        _.forIn(this.removedTables, function (tables, mid) {
            var model = _this.getMainModel().getInnerModel(mid);
            if (model) {
                for (j = tables.length - 1; j >= 0; --j) {
                    model[IN_DATA].splice(tables[j].index, 0, tables[j].id);
                }
            }
        });
    };

    DisconnectFnUnitCommand.prototype.getSourceUnits = function (fid) {
        return this.getTargetModel().getLinkSourceFnUnits(fid);
    };

    DisconnectFnUnitCommand.prototype.getTargetUnits = function (fid) {
        return this.getTargetModel().getLinkTargetFnUnits(fid);
    };

    DisconnectFnUnitCommand.prototype.hasToRemove = function (source, target, tid) {
        var _this = this;
        var prvFnUnits = this.getTargetModel().getLinkSourceFnUnits(target.fid);
        return _.every(prvFnUnits, function (fnUnit) {
            return FnUnitUtils.isProcessFunction(fnUnit) ||
                fnUnit.fid === source.fid ||
                _.indexOf(FnUnitUtils.getOutData(fnUnit), tid) === -1;
        });
    };

    Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand = DisconnectFnUnitCommand;
}).call(this);

/**
 * Created by jhoon80.park on 2016-04-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function GoHistoryCommand(options) {
        this.options = $.extend({}, options.options);
        this.options.commands = options.commands;
    }

    GoHistoryCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.gohistorycommand';
    };

    GoHistoryCommand.prototype.getLabel = function () {
        return 'Go History';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.GoHistoryCommand = GoHistoryCommand;

}).call(this);
/* -----------------------------------------------------
 *  new-activity-command.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-27.
 * ---------------------------------------------------- */

(function () {
    'use strict';
    var Brightics = this.Brightics;
    function NewActivityCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    NewActivityCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    NewActivityCommand.prototype.constructor = NewActivityCommand;

    NewActivityCommand.prototype.canUndo = function () {
        return true;
    };

    NewActivityCommand.prototype.canRedo = function () {
        return true;
    };

    NewActivityCommand.prototype.execute = function () {
        var _this = this;
        var contents = (function (contents) {
            if (contents) {
                // Deep clone 필요?
                return Brightics.VA.Core.Utils.ModelUtils
                    .extendInnerModel(_this.getMainModel(), contents, true);
            }
            return Brightics.VA.Core.Utils.ModelUtils
                .extendInnerModel(_this.getMainModel(),
                    Brightics.VA.Core.Utils.ModelUtils.getDefaultModelContents(), true);
        }(this.options.contents));

        contents.mid = this.options.mid;
        // if (this.options.type === 'if') {
        //     contents['sub-type'] = 'if';
        //     contents['condition-type'] = this.options.conditionType;
        // } else if (this.options.type === 'loop') {
        //     contents['sub-type'] = 'loop';
        // }
        this.options.mainModel.addInnerModel(contents);
    };

    NewActivityCommand.prototype.undo = function () {
        this.options.mainModel.removeInnerModelRecursion(this.options.mid);
    };

    NewActivityCommand.prototype.redo = function () {
        this.execute();
    };

    NewActivityCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.newactivitycommand';
    };

    NewActivityCommand.prototype.getLabel = function () {
        return 'New Activity Command';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.NewActivityCommand = NewActivityCommand;
/* eslint-disable no-invalid-this */
}.call(this));

/**
 * Created by sungjin1.kim on 2016-03-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options: {
     *      panel: this.options.panel,
     *      layout: this.options.layout,
     *      new: {
     *          contentsPanelOption: {
     *              id: id,
     *              chartOption: JSON.parse(JSON.stringify(contentsPanel.options.chartOption))
     *          },
     *          layoutOption: {
     *              id: id,
     *              type: 'panel'
     *          },
     *          size: size
     *      },
     * }
     * @param options
     * @constructor
     */
    function NewChartCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    NewChartCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    NewChartCommand.prototype.constructor = NewChartCommand;

    NewChartCommand.prototype.canUndo = function () {
        return true;
    };

    NewChartCommand.prototype.canRedo = function () {
        return true;
    };

    NewChartCommand.prototype.execute = function () {
        this.options.panel.push(this.options.panelOption);
    };

    NewChartCommand.prototype.undo = function () {
        this.options.panel.splice(this.options.panel.indexOf(this.options.panelOption), 1);
    };

    NewChartCommand.prototype.redo = function () {
        this.execute();
    };

    NewChartCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.newchartcommand';
    };

    NewChartCommand.prototype.getLabel = function () {
        return 'Clone a Chart';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.NewChartCommand = NewChartCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function NewFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Create a Function';
    }

    NewFnUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    NewFnUnitCommand.prototype.constructor = NewFnUnitCommand;

    NewFnUnitCommand.prototype.execute = function () {
        this.options.analyticsModel.addFnUnit(this.options.fnUnit);
    };

    NewFnUnitCommand.prototype.undo = function () {
        this.options.analyticsModel.removeFnUnit(this.options.fnUnit.fid);
    };

    NewFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.newfnunitcommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand = NewFnUnitCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function NewOptModelCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Create a OPT model';
    }

    NewOptModelCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    NewOptModelCommand.prototype.constructor = NewOptModelCommand;

    NewOptModelCommand.prototype.execute = function () {
        var pid = this.options.pid;
        var mid = this.options.mid;
        var optModel = this.options.optModel;
        Brightics.OptModelManager.addOptModel(pid, mid, optModel);
    };

    NewOptModelCommand.prototype.undo = function () {
        var pid = this.options.pid;
        var mid = this.options.mid;
        var optId = this.options.optModel['optId'];
        Brightics.OptModelManager.removeOptModel(pid, mid, optId);
    };

    NewOptModelCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.newoptmodelcommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.NewOptModelCommand = NewOptModelCommand;

}).call(this);
/**
 * Created by jhoon80.park on 2017-04-25.
 */

/* global _, IN_DATA, OUT_DATA */
(function () {
    'use strict';
    var root = this;
    var Brightics = root.Brightics;
    function NewOutTableCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }
    NewOutTableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    NewOutTableCommand.prototype.constructor = NewOutTableCommand;
    NewOutTableCommand.prototype.canUndo = function () {
        return true;
    };
    NewOutTableCommand.prototype.canRedo = function () {
        return true;
    };
    NewOutTableCommand.prototype.execute = function () {
        var _this = this;
        this.old[OUT_DATA] = $.extend(true, [], this.options.fnUnit[OUT_DATA]);

        var removed = _.difference(this.options.fnUnit[OUT_DATA], this.options.ref[OUT_DATA]);
        var added = _.difference(this.options.ref[OUT_DATA], this.options.fnUnit[OUT_DATA]);

        this.options.fnUnit[OUT_DATA] = this.options.ref[OUT_DATA];

        var nextFnUnits =
            _.unique(this.getTargetModel().getNext(this.options.fnUnit.fid)
                .reduce(function (acc, fid) {
                    return acc.concat(_this.getTargetModel().getLinkTargetFnUnits(fid));
                }, []), 'fid');
        this.oldFnUnitInData = {};
        this.oldModelOutData = _.clone(_this.getTargetModel()[OUT_DATA]);
        nextFnUnits.forEach(function (fn) {
            var clazz = fn.parent().type;
            var maxTableSize = Brightics.VA.Core.Interface
                .Functions[clazz][fn.func]['in-range'].max;

            if (fn[IN_DATA]) {
                _this.oldFnUnitInData[fn.fid] = _.clone(fn[IN_DATA]);
                fn[IN_DATA] = _.chain(fn[IN_DATA])
                    .difference(removed)
                    .concat(added)
                    .take(maxTableSize)
                    .value();
            }
        });

        this.getTargetModel()[OUT_DATA] = _.difference(this.getTargetModel()[OUT_DATA], removed);
    };
    NewOutTableCommand.prototype.undo = function () {
        var _this = this;
        this.options.fnUnit[OUT_DATA] = this.old[OUT_DATA];

        _.forIn(_this.oldFnUnitInData, function (inData, fid) {
            var fn = _this.getTargetModel().getFnUnitById(fid);
            fn[IN_DATA] = inData;
        });

        this.getTargetModel()[OUT_DATA] = this.oldModelOutData;
    };
    NewOutTableCommand.prototype.redo = function () {
        this.execute();
    };
    NewOutTableCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.newouttablecommand';
    };
    NewOutTableCommand.prototype.getLabel = function () {
        return 'New Out Data';
    };
    Brightics.VA.Core.Editors.Diagram.Commands.NewOutTableCommand = NewOutTableCommand;
/* eslint-disable no-invalid-this */
}).call(this);

/**
 * Created by daewon.park on 2016-03-14.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      selectedId : ''
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function PrependNewFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.CompoundCommand.call(this, eventSource, options);
    }

    PrependNewFnUnitCommand.prototype = Object.create(Brightics.VA.Core.CompoundCommand.prototype);
    PrependNewFnUnitCommand.prototype.constructor = PrependNewFnUnitCommand;

    PrependNewFnUnitCommand.prototype.execute = function () {
        this.commandList = [];

        var selected = this.options.analyticsModel.getFnUnitById(this.options.selectedId);

        // shift right
        var shiftCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ShiftRightCommand(this.event.source, {
            fid: selected.fid
        });
        this.add(shiftCommand);

        // create a new function
        this.options.fnUnit.display.diagram.position.x = selected.display.diagram.position.x;
        this.options.fnUnit.display.diagram.position.y = selected.display.diagram.position.y;
        var newCommand = new Brightics.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand(this.event.source, {
            fnUnit: this.options.fnUnit
        });
        this.add(newCommand);

        // reconnect
        var connectCommand;
        for (var i in this.options.analyticsModel.links) {
            var link = this.options.analyticsModel.links[i];
            if (link[TARGET_FID] == this.options.selectedId) {
                connectCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this.event.source, {
                    kid: link.kid,
                    'sourceFid': link[SOURCE_FID],
                    'targetFid': this.options.fnUnit.fid
                });
                this.add(connectCommand);
                break;
            }
        }

        // connect
        connectCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand(this.event.source, {
            kid: Brightics.VA.Core.Utils.IDGenerator.link.id(),
            'sourceFid': this.options.fnUnit.fid,
            'targetFid': this.options.selectedId
        });
        this.add(connectCommand);

        Brightics.VA.Core.CompoundCommand.prototype.execute.call(this);
    };

    PrependNewFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.prependnewfnunitcommand';
    };

    PrependNewFnUnitCommand.prototype.getLabel = function () {
        return 'Append a new Function';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.PrependNewFnUnitCommand = PrependNewFnUnitCommand;

}).call(this);
/**
 * Created by daewon.park on 2016-03-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');
    var ObjectUtils = root.__module__.ObjectUtils;

    /**
     * options : {
     *      kid : '',
     *      source-fid : '',
     *      target-fid : ''
     * }
     * @param options
     * @constructor
     */
    function ReconnectFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.old = {};
    }

    ReconnectFnUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ReconnectFnUnitCommand.prototype.constructor = ReconnectFnUnitCommand;

    ReconnectFnUnitCommand.prototype.canUndo = function () {
        return true;
    };

    ReconnectFnUnitCommand.prototype.canRedo = function () {
        return true;
    };

    ReconnectFnUnitCommand.prototype.execute = function () {
        var currLink = this.options.analyticsModel.getLinkUnitById(this.options.kid);
        var i;
        this.old[SOURCE_FID] = currLink[SOURCE_FID];
        this.old[TARGET_FID] = currLink[TARGET_FID];

        // remove in-table of target fnUnit
        var sourceFnUnit = this.options.analyticsModel.getFnUnitById(currLink[SOURCE_FID]);
        var targetFnUnit = this.options.analyticsModel.getFnUnitById(currLink[TARGET_FID]);
        var clazz = targetFnUnit.parent().type;

        this.old['target-fnunit-in-table'] = [];
        this.old['additional-in-table'] = [];

        if (targetFnUnit[FUNCTION_NAME] === 'If' ||
                targetFnUnit[FUNCTION_NAME] === 'ForLoop' ||
                targetFnUnit[FUNCTION_NAME] === 'WhileLoop') {
            this.processInnerModel(sourceFnUnit, targetFnUnit);
        }

        //reconnect가 사용되는 경우 : switch, 링크 reconnect
        //1. 먼저 링크가 끊어진 함수부터 링크를 끊는 작업을 한다. (tid 뺀다)
        //새로 바뀐 함수에 input이 허용되는 경우
        if (FnUnitUtils.hasInput(targetFnUnit)) {
            if (FnUnitUtils.hasOutput(sourceFnUnit)) {
                // 소스에 있는것 중에서 target에 있는거는 따로 챙겨둔다.
                for (i in FnUnitUtils.getOutData(sourceFnUnit)) {
                    var idx = FnUnitUtils.getInData(targetFnUnit).indexOf(FnUnitUtils.getOutData(sourceFnUnit)[i]);
                    if (idx > -1) {
                        this.old['target-fnunit-in-table'].push(FnUnitUtils.getOutData(sourceFnUnit)[i]);
                    }
                }
                // target함수에서 source함수에 있는 tid를 뺀다.
                FnUnitUtils.disconnect(sourceFnUnit, targetFnUnit);

                //fix me!
                //targetFnUnit[IN_DATA]이 비어있고 targetFnUnit link가 한개일 때, Push 'inData'
                // if (currLink[TARGET_FID] != this.options[TARGET_FID]) {
                //     var prevFnUnitFidList = this.options.analyticsModel.getPrevious(currLink[TARGET_FID]);
                //     var index = prevFnUnitFidList.indexOf(this.options[SOURCE_FID]);
                //     if (index > -1) {
                //         prevFnUnitFidList.splice(index, 1);
                //     }
                //     if (targetFnUnit[IN_DATA].length === 0 && prevFnUnitFidList.length === 1) {
                //         var prevFnUnit = this.options.analyticsModel.getFnUnitById(prevFnUnitFidList[0]);
                //         targetFnUnit[IN_DATA].push(prevFnUnit[OUT_DATA][0]);
                //         this.old['additional-in-table'].push(prevFnUnit[OUT_DATA][0]);
                //     }
                // }

                if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                    targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], targetFnUnit[IN_DATA]);
                    if (targetFnUnit.param.functions[0].func === 'unload') {
                        targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
                    }
                } else if (targetFnUnit[FUNCTION_NAME] === 'OutData') {
                    targetFnUnit.param['df-names'] = $.extend(true, [], targetFnUnit[IN_DATA]);
                }
            }

        }

        // change link
        currLink[SOURCE_FID] = this.options[SOURCE_FID];
        currLink[TARGET_FID] = this.options[TARGET_FID];

        // add in-table of target fnUnit
        //2. 새로운 함수에 tid를 넣는다.
        sourceFnUnit = this.options.analyticsModel.getFnUnitById(currLink[SOURCE_FID]);
        targetFnUnit = this.options.analyticsModel.getFnUnitById(currLink[TARGET_FID]);

        if (FnUnitUtils.hasOutput(sourceFnUnit) && FnUnitUtils.getOutData(sourceFnUnit).length > 0 && FnUnitUtils.hasInput(targetFnUnit)) {
            FnUnitUtils.connect(sourceFnUnit, targetFnUnit);

            if (targetFnUnit.func === 'unload' && !targetFnUnit.context) {
                targetFnUnit.param['df-names'] = targetFnUnit[IN_DATA];
            }

            if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], targetFnUnit[IN_DATA]);
                if (targetFnUnit.param.functions[0].func === 'unload') {
                    targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
                }
            }
        }
    };

    // ReconnectFnUnitCommand.prototype.execute = function () {
    //     var currLink = this.options.analyticsModel.getLinkUnitById(this.options.kid);
    //     var i;
    //     this.old[SOURCE_FID] = currLink[SOURCE_FID];
    //     this.old[TARGET_FID] = currLink[TARGET_FID];

    //     // remove in-table of target fnUnit
    //     var sourceFnUnit = this.options.analyticsModel.getFnUnitById(currLink[SOURCE_FID]);
    //     var targetFnUnit = this.options.analyticsModel.getFnUnitById(currLink[TARGET_FID]);
    //     var clazz = targetFnUnit.parent().type;

    //     this.old['target-fnunit-in-table'] = [];
    //     this.old['additional-in-table'] = [];

    //     if (targetFnUnit[FUNCTION_NAME] === 'If' ||
    //             targetFnUnit[FUNCTION_NAME] === 'ForLoop' ||
    //             targetFnUnit[FUNCTION_NAME] === 'WhileLoop') {
    //         this.processInnerModel(sourceFnUnit, targetFnUnit);
    //     }

    //     if (targetFnUnit[IN_DATA]) {
    //         for (i in sourceFnUnit[OUT_DATA]) {
    //             var idx = targetFnUnit[IN_DATA].indexOf(sourceFnUnit[OUT_DATA][i]);
    //             if (idx > -1) {
    //                 this.old['target-fnunit-in-table'].push(sourceFnUnit[OUT_DATA][i]);
    //                 targetFnUnit[IN_DATA].splice(idx, 1);
    //             }
    //         }

    //         //targetFnUnit[IN_DATA]이 비어있고 targetFnUnit link가 한개일 때, Push 'inData'
    //         if (currLink[TARGET_FID] != this.options[TARGET_FID]) {
    //             var prevFnUnitFidList = this.options.analyticsModel.getPrevious(currLink[TARGET_FID]);
    //             var index = prevFnUnitFidList.indexOf(this.options[SOURCE_FID]);
    //             if (index > -1) {
    //                 prevFnUnitFidList.splice(index, 1);
    //             }
    //             if (targetFnUnit[IN_DATA].length === 0 && prevFnUnitFidList.length === 1) {
    //                 var prevFnUnit = this.options.analyticsModel.getFnUnitById(prevFnUnitFidList[0]);
    //                 targetFnUnit[IN_DATA].push(prevFnUnit[OUT_DATA][0]);
    //                 this.old['additional-in-table'].push(prevFnUnit[OUT_DATA][0]);
    //             }
    //         }

    //         if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
    //             targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], targetFnUnit[IN_DATA]);
    //             if (targetFnUnit.param.functions[0].func === 'unload') {
    //                 targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
    //             }
    //         } else if (targetFnUnit[FUNCTION_NAME] === 'OutData') {
    //             targetFnUnit.param['df-names'] = $.extend(true, [], targetFnUnit[IN_DATA]);
    //         }
    //     }

    //     // change link
    //     currLink[SOURCE_FID] = this.options[SOURCE_FID];
    //     currLink[TARGET_FID] = this.options[TARGET_FID];

    //     // add in-table of target fnUnit
    //     sourceFnUnit = this.options.analyticsModel.getFnUnitById(currLink[SOURCE_FID]);
    //     targetFnUnit = this.options.analyticsModel.getFnUnitById(currLink[TARGET_FID]);

    //     if (sourceFnUnit[OUT_DATA] && sourceFnUnit[OUT_DATA].length > 0 && targetFnUnit[IN_DATA]) {
    //         var inTableMaxLength = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, targetFnUnit.func)['in-range'].max;
    //         inTableMaxLength = inTableMaxLength === '*' ? Number.MAX_VALUE : inTableMaxLength;
    //         if (targetFnUnit[IN_DATA].length < inTableMaxLength) {
    //             targetFnUnit[IN_DATA].push(sourceFnUnit[OUT_DATA][0]);
    //         }

    //         if (targetFnUnit.func === 'unload') {
    //             targetFnUnit.param['df-names'] = targetFnUnit[IN_DATA];
    //         }

    //         if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
    //             targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], targetFnUnit[IN_DATA]);
    //             if (targetFnUnit.param.functions[0].func === 'unload') {
    //                 targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
    //             }
    //         }
    //     }
    // };

    ReconnectFnUnitCommand.prototype.undo = function () {
        var currLink = this.options.analyticsModel.getLinkUnitById(this.options.kid);
        var i;
        // remove in-table of target fnUnit
        var sourceFnUnit = this.options.analyticsModel.getFnUnitById(currLink[SOURCE_FID]);
        var targetFnUnit = this.options.analyticsModel.getFnUnitById(currLink[TARGET_FID]);

        // if (sourceFnUnit[OUT_DATA] && sourceFnUnit[OUT_DATA].length > 0) {
        if (FnUnitUtils.hasOutput(sourceFnUnit) && FnUnitUtils.getOutData(sourceFnUnit).length > 0) {
            // var inTables = targetFnUnit[IN_DATA];
            var inTables = FnUnitUtils.getInData(targetFnUnit);
            if (inTables) {
                for (i in FnUnitUtils.getOutData(sourceFnUnit)) {
                    var idx = inTables.indexOf(FnUnitUtils.getOutData(sourceFnUnit)[i]);
                    if (idx > -1) {
                        inTables.splice(idx, 1);
                    }
                }
            }

            if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], inTables);
                if (targetFnUnit.param.functions[0].func === 'unload') {
                    targetFnUnit.param.functions[0].param['df-names'] = inTables;
                }
            } else if (targetFnUnit[FUNCTION_NAME] === 'OutData') {
                targetFnUnit.param['df-names'] = $.extend(true, [], inTables);
            }
        }

        // change link
        currLink[SOURCE_FID] = this.old[SOURCE_FID];
        currLink[TARGET_FID] = this.old[TARGET_FID];

        // add in-table of target fnUnit
        sourceFnUnit = this.options.analyticsModel.getFnUnitById(currLink[SOURCE_FID]);
        targetFnUnit = this.options.analyticsModel.getFnUnitById(currLink[TARGET_FID]);

        if (FnUnitUtils.hasInput(targetFnUnit)) {
            //????
            // if (this.old['additional-in-table'].length > 0) {
            //     var idx = FnUnitUtils.getInData(targetFnUnit).indexOf(this.old['additional-in-table'][0]);
            //     if (idx > -1) {
            //         targetFnUnit[IN_DATA].splice(idx, 1);
            //     }
            // }
            var clazz = targetFnUnit.parent().type;
            var inTableMaxLength = '';
            //3.6 이전 함수만 적용
            if (!FnUnitUtils.hasMeta(targetFnUnit)) inTableMaxLength = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, targetFnUnit.func)['in-range'].max;

            for (i in this.old['target-fnunit-in-table']) {
                if (inTableMaxLength === '*') {
                    targetFnUnit[IN_DATA].push(this.old['target-fnunit-in-table'][i]);
                }
                else {
                    //sourceFnUnit은 위아래 같다.
                    var type = FnUnitUtils.getTypeByTableId(sourceFnUnit, this.old['target-fnunit-in-table'][i]);
                    FnUnitUtils.addInData(targetFnUnit, type, [this.old['target-fnunit-in-table'][i]]);
                }
            }

            if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                targetFnUnit.param.functions[0][IN_DATA] = $.extend(true, [], targetFnUnit[IN_DATA]);
                if (targetFnUnit.param.functions[0].func === 'unload') {
                    targetFnUnit.param.functions[0].param['df-names'] = targetFnUnit[IN_DATA];
                }
            } else if (targetFnUnit[FUNCTION_NAME] === 'OutData') {
                targetFnUnit.param['df-names'] = $.extend(true, [], targetFnUnit[IN_DATA]);
            }
        }

        if (this.ops) {
            this.cancelProcessInnerModel(sourceFnUnit, targetFnUnit);
        }
    };

    ReconnectFnUnitCommand.prototype.redo = function () {
        this.execute();
    };

    ReconnectFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.reconnectfnunitcommand';
    };

    ReconnectFnUnitCommand.prototype.getLabel = function () {
        return 'Reconnect a function';
    };

    ReconnectFnUnitCommand.prototype.processInnerModel = function (sourceFnUnit, targetFnUnit) {
        var mainModel = this.options.mainModel;
        var models = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(mainModel, targetFnUnit);

        var i;
        var j;
        var k;

        this.ops = [];

        var desc = function (a, b) {
            return b - a;
        };

        for (i = 0; i < models.length; i++) {
            var model = models[i];
            var functions = model.functions;
            for (j = 0; j < functions.length; j++) {
                var fn = functions[j];
                var indices = [];
                if (!fn[IN_DATA]) continue;
                for (k = 0; k < sourceFnUnit[OUT_DATA].length; k++) {
                    var index = _.indexOf(fn[IN_DATA], sourceFnUnit[OUT_DATA][k]);
                    if (index >= 0) {
                        indices.push(index);
                    }
                }
                indices.sort(desc);

                var olds = [];
                for (k = 0; k < indices.length; k++) {
                    olds.push(fn[IN_DATA][indices[k]]);
                }

                this.ops.push({
                    fnUnit: fn,
                    indices: indices,
                    olds: olds
                });

                if (targetFnUnit[FUNCTION_NAME] === 'Subflow') {
                    targetFnUnit.param.functions[0][IN_DATA] =
                        $.extend(true, [], targetFnUnit[IN_DATA]);
                    if (targetFnUnit.param.functions[0].func === 'unload') {
                        targetFnUnit.param.functions[0].param['df-names'] =
                            targetFnUnit[IN_DATA];
                    }
                } else if (targetFnUnit[FUNCTION_NAME] === 'OutData') {
                    targetFnUnit.param['df-names'] = $.extend(true, [], targetFnUnit[IN_DATA]);
                }
            }
        }

        for (i = 0; i < this.ops.length; i++) {
            var fnUnit = this.ops[i].fnUnit;
            for (j = 0; j < this.ops[i].indices.length; j++) {
                var path = [IN_DATA, this.ops[i].indices[j]];
                ObjectUtils.removeProp(fnUnit, path);

                if (fnUnit[FUNCTION_NAME] === 'Subflow') {
                    fnUnit.param.functions[0][IN_DATA] =
                        $.extend(true, [], fnUnit[IN_DATA]);
                    if (fnUnit.param.functions[0].func === 'unload') {
                        fnUnit.param.functions[0].param['df-names'] = fnUnit[IN_DATA];
                    }
                } else if (fnUnit[FUNCTION_NAME] === 'OutData') {
                    fnUnit.param['df-names'] = $.extend(true, [], fnUnit[IN_DATA]);
                }
            }
        }
    };

    ReconnectFnUnitCommand.prototype.cancelProcessInnerModel = function (
            sourceFnUnit,
            targetFnUnit) {
        var i;
        var j;
        for (i = 0; i < this.ops.length; i++) {
            var fnUnit = this.ops[i].fnUnit;
            for (j = this.ops[i].indices.length; j >= 0; j--) {
                var path = [IN_DATA, this.ops[i].indices[j]];
                ObjectUtils.addProp(fnUnit, path, this.ops[i].olds[j]);
                if (fnUnit[FUNCTION_NAME] === 'Subflow') {
                    fnUnit.param.functions[0][IN_DATA] =
                        $.extend(true, [], fnUnit[IN_DATA]);
                    if (fnUnit.param.functions[0].func === 'unload') {
                        fnUnit.param.functions[0].param['df-names'] = fnUnit[IN_DATA];
                    }
                } else if (fnUnit[FUNCTION_NAME] === 'OutData') {
                    fnUnit.param['df-names'] = $.extend(true, [], fnUnit[IN_DATA]);
                }
            }
        }
    };


    Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand = ReconnectFnUnitCommand;

}).call(this);

/* -----------------------------------------------------
 *  remove-activity-command.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-27.
 * ---------------------------------------------------- */

(function () {
    'use strict';
    var Brightics = this.Brightics;
    function RemoveActivityCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    RemoveActivityCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveActivityCommand.prototype.constructor = RemoveActivityCommand;

    RemoveActivityCommand.prototype.canUndo = function () {
        return true;
    };

    RemoveActivityCommand.prototype.canRedo = function () {
        return true;
    };

    RemoveActivityCommand.prototype.execute = function () {
        // this.old = this.options.mainModel.getInnerModel(this.options.mid);
        this.old = this.options.mainModel.removeInnerModelRecursion(this.options.mid);
    };

    RemoveActivityCommand.prototype.undo = function () {
        // this.options.mainModel.addInnerModel(this.old);
        _.forEach(this.old, _.bind(this.options.mainModel.addInnerModel, this.options.mainModel));
    };

    RemoveActivityCommand.prototype.redo = function () {
        this.execute();
    };

    RemoveActivityCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.removeactivitycommand';
    };

    RemoveActivityCommand.prototype.getLabel = function () {
        return 'New Activity Command';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.RemoveActivityCommand = RemoveActivityCommand;
/* eslint-disable no-invalid-this */
}.call(this));

/* -----------------------------------------------------
 *  remove-operation-command.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-27.
 * ---------------------------------------------------- */

(function () {
    'use strict';
    var root = this;
    var Brightics = root.Brightics;
    var ObjectUtils = root.__module__.ObjectUtils;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function RemoveOperationCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    RemoveOperationCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveOperationCommand.prototype.constructor = RemoveOperationCommand;

    RemoveOperationCommand.prototype.canUndo = function () {
        return true;
    };

    RemoveOperationCommand.prototype.canRedo = function () {
        return true;
    };

    RemoveOperationCommand.prototype.execute = function () {
        this.removeValue(this.options.path);
    };

    RemoveOperationCommand.prototype.undo = function () {
        this.setValue(this.options.path, this.old);
    };

    RemoveOperationCommand.prototype.redo = function () {
        this.execute();
    };

    RemoveOperationCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.removeoperationcommand';
    };

    RemoveOperationCommand.prototype.getLabel = function () {
        return this.options.label;
    };

    RemoveOperationCommand.prototype.copy = function (newValue) {
        return _.clone(newValue);
        // if (newValue.constructor == Array) return $.extend(true, [], newValue);
        // else if (newValue.constructor == Object) return $.extend(true, {}, newValue);
        // return newValue;
    };

    RemoveOperationCommand.prototype.setValue = function (path, newValue) {
        var fn = this.options.fnUnit || this.options.target;
        ObjectUtils.addProp(fn, path, newValue);
        // var idx = -1;
        // var len = path.length;
        // while (++idx < len - 1) {
        //     fn = fn[path[idx]];
        // }
        // fn[path[path.length - 1]] = this.copy(this.old);
    };

    RemoveOperationCommand.prototype.removeValue = function (path) {
        var fn = this.options.fnUnit || this.options.target;
        this.old = ObjectUtils.removeProp(fn, path);
        // var idx = -1;
        // var len = path.length;
        // while (++idx < len - 1) {
        //     fn = fn[path[idx]];
        // }
        // this.old = this.copy(fn[path[path.length - 1]]);
        // if (fn instanceof Array) {
        //     console.log(fn);
        //     fn.splice(path[path.length - 1], 1);
        //     console.log(fn, path);
        // } else {
        //     delete fn[path[path.length - 1]];
        // }
    };

    Brightics.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand = RemoveOperationCommand;
/* eslint-disable no-invalid-this */
}.call(this));

/**
 * Created by sungjin1.kim on 2016-03-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options: {
     *      panel: this.options.panel,
     *      layout: this.options.layout,
     *      new: {
     *          contentsPanelOption: {
     *              id: id,
     *              chartOption: JSON.parse(JSON.stringify(contentsPanel.options.chartOption))
     *          },
     *          layoutOption: {
     *              id: id,
     *              type: 'panel'
     *          },
     *          size: size
     *      },
     * }
     * @param options
     * @constructor
     */
    function RemoveChartCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.old = {};
    }

    RemoveChartCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveChartCommand.prototype.constructor = RemoveChartCommand;

    RemoveChartCommand.prototype.canUndo = function () {
        return true;
    };

    RemoveChartCommand.prototype.canRedo = function () {
        return true;
    };

    RemoveChartCommand.prototype.execute = function () {
        this.options.old.index = this.options.panel.indexOf(this.options.panelOption);
        this.options.panel.splice(this.options.old.index, 1);
    };

    RemoveChartCommand.prototype.undo = function () {
        this.options.panel.splice(this.options.old.index, 0, this.options.panelOption);
    };

    RemoveChartCommand.prototype.redo = function () {
        this.execute();
    };

    RemoveChartCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.removechartcommand';
    };

    RemoveChartCommand.prototype.getLabel = function () {
        return 'Close a Chart';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.RemoveChartCommand = RemoveChartCommand;

}).call(this);
/**
 * Created by daewon.park on 2016-03-05.
 */

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var ObjectUtils = root.__module__.ObjectUtils;

    /**
     * options : {
     *      fid : ''
     * }
     *
     * @param eventSource
     * @param options
     * @constructor
     */
    function RemoveFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.old = {};
    }

    RemoveFnUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveFnUnitCommand.prototype.constructor = RemoveFnUnitCommand;

    RemoveFnUnitCommand.prototype.canUndo = function () {
        return true;
    };

    RemoveFnUnitCommand.prototype.canRedo = function () {
        return true;
    };

    RemoveFnUnitCommand.prototype.execute = function () {
        this.processMainModelInput();
        this.old.fnUnit = this.options.analyticsModel.removeFnUnit(this.options.fid);
        Brightics.VA.Core.GarbageCollector.addList(this.options.analyticsModel.mid, this.options.fid);
    };

    RemoveFnUnitCommand.prototype.undo = function () {
        this.options.analyticsModel.addFnUnit(this.old.fnUnit);
        Brightics.VA.Core.GarbageCollector.removeList(this.options.analyticsModel.mid, this.options.fid);
        this.cancelMainModelInput();
    };

    RemoveFnUnitCommand.prototype.redo = function () {
        this.execute();
    };

    RemoveFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.removefnunitcommand';
    };

    RemoveFnUnitCommand.prototype.getLabel = function () {
        return 'Remove a Function';
    };

    RemoveFnUnitCommand.prototype.processMainModelInput = function () {
        var fnUnit = this.options.analyticsModel.getFnUnitById(this.options.fid);
        var model = this.options.mainModel;
        var i;
        var j;

        this.ops = [];

        if (!model[IN_DATA]) return;

        for (i = model[IN_DATA].length - 1; i >= 0; --i) {
            var outs = fnUnit[OUT_DATA];
            if (outs) {
                var index = _.indexOf(outs, model[IN_DATA][i]);
                if (index > -1) {
                    this.ops.push({
                        path: [i],
                        old: model[IN_DATA][i]
                    });
                }
            }
        }

        for (i = 0; i < this.ops.length; i++) {
            var op = this.ops[i];
            ObjectUtils.removeProp(model[IN_DATA], op.path);
        }
    };

    RemoveFnUnitCommand.prototype.cancelMainModelInput = function () {
        var model = this.options.mainModel;
        if (!model[IN_DATA]) return;
        for (var i = this.ops.length - 1; i >= 0; --i) {
            var op = this.ops[i];
            ObjectUtils.addProp(model[IN_DATA], op.path, op.old);
        }
    };

    Brightics.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand = RemoveFnUnitCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RemoveFnUnitParameterCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    RemoveFnUnitParameterCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveFnUnitParameterCommand.prototype.constructor = RemoveFnUnitParameterCommand;

    RemoveFnUnitParameterCommand.prototype.execute = function () {
        this.old.param = $.extend(true, {}, this.options.fnUnit.param);
        for (var key in this.options.ref.param) delete this.options.fnUnit.param[key];
    };

    RemoveFnUnitParameterCommand.prototype.undo = function () {
        for (var key in this.options.fnUnit.param) delete this.options.fnUnit.param[key];
        $.extend(true, this.options.fnUnit.param, this.old.param);
    };

    RemoveFnUnitParameterCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.removefnunitparametercommand';
    };

    RemoveFnUnitParameterCommand.prototype.getLabel = function () {
        return 'Change FnUnit Properties';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.RemoveFnUnitParameterCommand = RemoveFnUnitParameterCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function RemoveOptModelCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Remove a OPT model';
    }

    RemoveOptModelCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveOptModelCommand.prototype.constructor = RemoveOptModelCommand;

    RemoveOptModelCommand.prototype.execute = function () {
        var pid = this.options.pid;
        var mid = this.options.mid;
        var optId = this.options.optId;
        this.old.optModel = Brightics.OptModelManager.removeOptModel(pid, mid, optId);
    };

    RemoveOptModelCommand.prototype.undo = function () {
        var pid = this.options.pid;
        var mid = this.options.mid;
        var optModel = this.old.optModel;
        Brightics.OptModelManager.addOptModel(pid, mid, optModel);
    };

    RemoveOptModelCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.removeoptmodelcommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.RemoveOptModelCommand = RemoveOptModelCommand;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-04-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function RemoveVariableDefCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    RemoveVariableDefCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveVariableDefCommand.prototype.constructor = RemoveVariableDefCommand;

    RemoveVariableDefCommand.prototype.canUndo = function () {
        return true;
    };

    RemoveVariableDefCommand.prototype.canRedo = function () {
        return true;
    };

    RemoveVariableDefCommand.prototype.execute = function () {
        var analyticsModel = this.getMainModel();
        this.options.old = analyticsModel.variables[this.options.name];
        analyticsModel.removeVariableDef(this.options.name);
    };

    RemoveVariableDefCommand.prototype.undo = function () {
        var analyticsModel = this.getMainModel();
        analyticsModel.addVariableDef(this.options.name, this.options.old);
    };

    RemoveVariableDefCommand.prototype.redo = function () {
        this.execute();
    };

    RemoveVariableDefCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.removevariabledefcommand';
    };

    RemoveVariableDefCommand.prototype.getLabel = function () {
        return 'Remove Variable';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand = RemoveVariableDefCommand;

}).call(this);
/**
 * Created by daewon.park on 2016-03-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fid : '',
     *      name : ''
     * }
     * @param options
     * @constructor
     */
    function RenameFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Edit function';
    }

    RenameFnUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RenameFnUnitCommand.prototype.constructor = RenameFnUnitCommand;

    RenameFnUnitCommand.prototype.execute = function () {
        var fnUnit = this.options.analyticsModel.getFnUnitById(this.options.fid);
        this.old.name = fnUnit.display.label;
        this.old.description = fnUnit.display.description;
        fnUnit.display.label = this.options.name;
        fnUnit.display.description = this.options.description;
    };

    RenameFnUnitCommand.prototype.undo = function () {
        var fnUnit = this.options.analyticsModel.getFnUnitById(this.options.fid);
        fnUnit.display.label = this.old.name;
        fnUnit.display.description = this.old.description || '';
    };

    RenameFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.renamefnunitcommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand = RenameFnUnitCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ReplaceFnUnitParamCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    ReplaceFnUnitParamCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ReplaceFnUnitParamCommand.prototype.constructor = ReplaceFnUnitParamCommand;

    ReplaceFnUnitParamCommand.prototype.canUndo = function () {
        return true;
    };

    ReplaceFnUnitParamCommand.prototype.canRedo = function () {
        return true;
    };

    ReplaceFnUnitParamCommand.prototype.execute = function () {
        this.oldFnUnit = $.extend({}, this.options.fnUnit);
        for (var key in this.options.ref) {
            if (this.options.ref[key].constructor == Array)
                this.options.fnUnit[key] = $.extend(true, [], this.options.ref[key]);
            else if (this.options.ref[key].constructor == Object)
                this.options.fnUnit[key] = $.extend(true, {}, this.options.ref[key]);
            else
                this.options.fnUnit[key] = this.options.ref[key];
        }
    };

    ReplaceFnUnitParamCommand.prototype.undo = function () {
        for (var key in this.options.fnUnit) {
            delete this.options.fnUnit[key];
        }

        $.extend(this.options.fnUnit, this.oldFnUnit);
    };

    ReplaceFnUnitParamCommand.prototype.redo = function () {
        this.execute();
    };

    ReplaceFnUnitParamCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.replacefnunitparamcommand';
    };

    ReplaceFnUnitParamCommand.prototype.getLabel = function () {
        return 'Replace FnUnit Properties';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ReplaceFnUnitParamCommand = ReplaceFnUnitParamCommand;

}).call(this);
(function () {
    'use strict';
    var root = this;
    var Brightics = root.Brightics;
    var OUT_DATA = 'outData';
    /**
    * options : {
    * fnUnit : {}
    * }
    *
    * @param options
    * @constructor
    */
    function ReturnDataCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }
    ReturnDataCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ReturnDataCommand.prototype.constructor = ReturnDataCommand;
    ReturnDataCommand.prototype.canUndo = function () {
        return true;
    };
    ReturnDataCommand.prototype.canRedo = function () {
        return true;
    };
    ReturnDataCommand.prototype.execute = function () {
        var activeModel = this.getActiveModel();
        this.old = activeModel[OUT_DATA];
        activeModel[OUT_DATA] = this.options[OUT_DATA];
    };
    ReturnDataCommand.prototype.undo = function () {
        var activeModel = this.getActiveModel();
        activeModel[OUT_DATA] = this.old;
    };
    ReturnDataCommand.prototype.redo = function () {
        this.execute();
    };
    ReturnDataCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.returndatacommand';
    };
    ReturnDataCommand.prototype.getLabel = function () {
        return 'Change Return Data';
    };
    Brightics.VA.Core.Editors.Diagram.Commands.ReturnDataCommand = ReturnDataCommand;
}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetContentsPanelCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    SetContentsPanelCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetContentsPanelCommand.prototype.constructor = SetContentsPanelCommand;

    /**
     * $.extend 로는 array 가 deep copy 되지 않아서, 별도로 구현 by daewon.park
     * @param targetObject
     * @param sourceObject
     * @private
     */
    SetContentsPanelCommand.prototype._assignArray = function (targetObject, sourceObject) {
        for (var key in sourceObject) {
            if ($.isPlainObject(sourceObject[key])) {
                this._assignArray(targetObject[key], sourceObject[key]);
            } else if ($.isArray(sourceObject[key])) {
                targetObject[key] = $.extend(true, [], sourceObject[key]);
            }
        }
    };

    SetContentsPanelCommand.prototype.execute = function () {
        this.old.chartOption = {};
        for (var key in this.options.ref.chartOption) {
            // backup
            if (this.options.panelOption.chartOption[key]) {
                this.old.chartOption[key] = JSON.parse(JSON.stringify(this.options.panelOption.chartOption[key]));
            } else {
                this.old.chartOption[key] = null;
            }
            // change
            this.options.panelOption.chartOption[key] = JSON.parse(JSON.stringify(this.options.ref.chartOption[key]));
        };
    };

    SetContentsPanelCommand.prototype.undo = function () {
        for (var key in this.old.chartOption) {
            if (this.old.chartOption[key]) {
                this.options.panelOption.chartOption[key] = JSON.parse(JSON.stringify(this.old.chartOption[key]));
            } else {
                this.options.panelOption.chartOption[key] = null;
            }
        }
    };

    SetContentsPanelCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setcontentspanelcommand';
    };

    SetContentsPanelCommand.prototype.getLabel = function () {
        return 'Change Chart Options';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand = SetContentsPanelCommand;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-03-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options: {
     *      layout: {}
     * }
     * @param options
     * @constructor
     */
    function SetDataWorksheetLayoutCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    SetDataWorksheetLayoutCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetDataWorksheetLayoutCommand.prototype.constructor = SetDataWorksheetLayoutCommand;

    SetDataWorksheetLayoutCommand.prototype.canUndo = function () {
        return true;
    };

    SetDataWorksheetLayoutCommand.prototype.canRedo = function () {
        return true;
    };

    SetDataWorksheetLayoutCommand.prototype.execute = function () {
        this.options.oldLayout = $.extend(true, {}, this.options.layout);

        for(var p in this.options.layout) {
            delete this.options.layout[p];
        }
        $.extend(true, this.options.layout, this.options.newLayout);
    };

    SetDataWorksheetLayoutCommand.prototype.undo = function () {
        for(var p in this.options.layout) {
            delete this.options.layout[p];
        }
        $.extend(true, this.options.layout, this.options.oldLayout);
    };

    SetDataWorksheetLayoutCommand.prototype.redo = function () {
        this.execute();
    };

    SetDataWorksheetLayoutCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setdataworksheetlayoutcommand';
    };

    SetDataWorksheetLayoutCommand.prototype.getLabel = function () {
        return 'Change Layout';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand = SetDataWorksheetLayoutCommand;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-03-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options: {
     *      Panel: []
     * }
     * @param options
     * @constructor
     */
    function SetDataWorksheetPanelCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    SetDataWorksheetPanelCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetDataWorksheetPanelCommand.prototype.constructor = SetDataWorksheetPanelCommand;

    SetDataWorksheetPanelCommand.prototype.canUndo = function () {
        return true;
    };

    SetDataWorksheetPanelCommand.prototype.canRedo = function () {
        return true;
    };

    SetDataWorksheetPanelCommand.prototype.execute = function () {
        this.options.oldPanel = $.extend(true, {}, this.options.panel);

        for (var i = 0; i < this.options.panel.length; i++) {
            delete this.options.panel[i];
        }
        $.extend(true, this.options.panel, this.options.newPanel);
    };

    SetDataWorksheetPanelCommand.prototype.undo = function () {
        for (var i = 0; i < this.options.panel.length; i++) {
            delete this.options.panel[i];
        }
        $.extend(true, this.options.panel, this.options.oldPanel);
    };

    SetDataWorksheetPanelCommand.prototype.redo = function () {
        this.execute();
    };

    SetDataWorksheetPanelCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.SetDataWorksheetPanelCommand';
    };

    SetDataWorksheetPanelCommand.prototype.getLabel = function () {
        return 'Change Panel';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetPanelCommand = SetDataWorksheetPanelCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetDialogFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit Properties';
    }

    SetDialogFnUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetDialogFnUnitCommand.prototype.constructor = SetDialogFnUnitCommand;

    SetDialogFnUnitCommand.prototype.execute = function () {
        this.old.param = $.extend(true, {}, this.options.fnUnit.param);
        for (var key in this.options.ref.param) this.copy(this.options.fnUnit.param, this.options.ref.param, key);
    };

    SetDialogFnUnitCommand.prototype.copy = function (to, from, key) {
        if (from[key].constructor == Array) to[key] = $.extend(true, [], from[key]);
        else if (from[key].constructor == Object) to[key] = $.extend(true, {}, from[key]);
        else to[key] = from[key];
    };

    SetDialogFnUnitCommand.prototype.undo = function () {
        for (var key in this.options.fnUnit.param) delete this.options.fnUnit.param[key];
        $.extend(true, this.options.fnUnit.param, this.old.param);
    };

    SetDialogFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setdialogfnUnitcommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetDialogFnUnitCommand = SetDialogFnUnitCommand;

}).call(this);
/**
 * @deprecated
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit Properties';
    }

    SetFnUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetFnUnitCommand.prototype.constructor = SetFnUnitCommand;

    SetFnUnitCommand.prototype.execute = function () {
        this.old = $.extend(true, {}, this.options.fnUnit);

        for (var key in this.options.ref) {
            if (key === 'param') for (var paramKey in this.options.ref.param) {
                this.copy(this.options.fnUnit.param, this.options.ref.param, paramKey);
            }
            else this.copy(this.options.fnUnit, this.options.ref, key);
        }

        if (this.options.fnUnit[IN_DATA] && this.options.fnUnit[FUNCTION_NAME] === 'Subflow') {
            this.options.fnUnit.param.functions[0][IN_DATA] = $.extend(true, [], this.options.fnUnit[IN_DATA]);
        }
    };

    SetFnUnitCommand.prototype.copy = function (target, ref, key) {
        if (ref[key].constructor == Array) target[key] = $.extend(true, [], ref[key]);
        else if (ref[key].constructor == Object) target[key] = $.extend(true, {}, ref[key]);
        else target[key] = ref[key];
    };

    SetFnUnitCommand.prototype.undo = function () {
        for (var key in this.options.fnUnit) delete this.options.fnUnit[key];
        $.extend(true, this.options.fnUnit, this.old);

        if (this.options.fnUnit[IN_DATA] && this.options.fnUnit[FUNCTION_NAME] === 'Subflow') {
            this.options.fnUnit.param.functions[0][IN_DATA] = $.extend(true, [], this.options.fnUnit[IN_DATA]);
        }
    };

    SetFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setfnunitcommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand = SetFnUnitCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetFnUnitDexParameterValueCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit Properties';
    }

    SetFnUnitDexParameterValueCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetFnUnitDexParameterValueCommand.prototype.constructor = SetFnUnitDexParameterValueCommand;

    SetFnUnitDexParameterValueCommand.prototype.execute = function () {
        this.old['dex-param'] = $.extend(true, {}, this.options.fnUnit['dex-param']);
        for (var key in this.options.ref['dex-param']) this.copy(this.options.fnUnit['dex-param'], this.options.ref['dex-param'], key);
        this._buildQuery();
    };

    SetFnUnitDexParameterValueCommand.prototype.copy = function (to, from, key) {
        if (from[key].constructor == Array) to[key] = $.extend(true, [], from[key]);
        else if (from[key].constructor == Object) to[key] = $.extend(true, {}, from[key]);
        else to[key] = from[key];
    };

    SetFnUnitDexParameterValueCommand.prototype.undo = function () {
        for (var key in this.options.fnUnit['dex-param']) delete this.options.fnUnit['dex-param'][key];
        $.extend(true, this.options.fnUnit['dex-param'], this.old['dex-param']);
        this._buildQuery();
    };

    SetFnUnitDexParameterValueCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setfnunitparametervaluecommand';
    };

    SetFnUnitDexParameterValueCommand.prototype._buildQuery = function () {
        var sql = Brightics.VA.Core.Functions.Library[this.options.fnUnit.func]['base-sql'];
        for (var key in this.options.fnUnit['dex-param']) {
            var value = this.options.fnUnit['dex-param'][key];
            var pattern = key.replace('$', '\\$').replace('{', '\\{').replace('}', '\\}');
            if (typeof value === 'string') {
                // 문자열은 single quotation 으로 감싸서 치환
                sql = sql.replace(new RegExp(pattern, 'gi'), '\'' + value + '\'');
            } else if (typeof value === 'number') {
                // 숫자 치환
                sql = sql.replace(new RegExp(pattern, 'gi'), value);
            } else if ($.isArray(value)) {

            } else {
                // null 은 공백으로 치환
                sql = sql.replace(new RegExp(pattern, 'gi'), '\'\'');
            }
        }
        this.options.fnUnit.param.sql = sql;
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitDexParameterValueCommand = SetFnUnitDexParameterValueCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetFnUnitParameterValueCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit Properties';
    }

    SetFnUnitParameterValueCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetFnUnitParameterValueCommand.prototype.constructor = SetFnUnitParameterValueCommand;

    SetFnUnitParameterValueCommand.prototype.execute = function () {
        this.old.param = $.extend(true, {}, this.options.fnUnit.param);
        for (var key in this.options.ref.param) this.copy(this.options.fnUnit.param, this.options.ref.param, key);
    };

    SetFnUnitParameterValueCommand.prototype.copy = function (to, from, key) {
        if (from[key].constructor == Array) to[key] = $.extend(true, [], from[key]);
        else if (from[key].constructor == Object) to[key] = $.extend(true, {}, from[key]);
        else to[key] = from[key];
    };

    SetFnUnitParameterValueCommand.prototype.undo = function () {
        for (var key in this.options.fnUnit.param) delete this.options.fnUnit.param[key];
        $.extend(true, this.options.fnUnit.param, this.old.param);
    };

    SetFnUnitParameterValueCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setfnunitparametervaluecommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand = SetFnUnitParameterValueCommand;

}).call(this);
/**
 * Created by daewon.park on 2016-03-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fid : '',
     *      position : {
     *          x: 0,
     *          y: 0
     *      }
     * }
     *
     * @param options
     * @constructor
     */
    function SetFnUnitPositionCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.old = {};
    }

    SetFnUnitPositionCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetFnUnitPositionCommand.prototype.constructor = SetFnUnitPositionCommand;

    SetFnUnitPositionCommand.prototype.canUndo = function () {
        return true;
    };

    SetFnUnitPositionCommand.prototype.canRedo = function () {
        return true;
    };

    SetFnUnitPositionCommand.prototype.execute = function () {
        var fnUnit = this.options.analyticsModel.getFnUnitById(this.options.fid);

        this.old.position = {
            x : fnUnit.display.diagram.position.x,
            y : fnUnit.display.diagram.position.y
        };

        fnUnit.display.diagram.position.x = this.options.position.x;
        fnUnit.display.diagram.position.y = this.options.position.y;
    };

    SetFnUnitPositionCommand.prototype.undo = function () {
        var fnUnit = this.options.analyticsModel.getFnUnitById(this.options.fid);

        fnUnit.display.diagram.position.x = this.old.position.x;
        fnUnit.display.diagram.position.y = this.old.position.y;
    };

    SetFnUnitPositionCommand.prototype.redo = function () {
        this.execute();
    };

    SetFnUnitPositionCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setfnunitpositioncommand';
    };

    SetFnUnitPositionCommand.prototype.getLabel = function () {
        return 'Change Position';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitPositionCommand = SetFnUnitPositionCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetUDFFnUnitParameterValueCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit Properties';
    }

    SetUDFFnUnitParameterValueCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetUDFFnUnitParameterValueCommand.prototype.constructor = SetUDFFnUnitParameterValueCommand;

    SetUDFFnUnitParameterValueCommand.prototype.execute = function () {
        this.old['input-variables'] = $.extend(true, {}, this.options.fnUnit.param['input-variables']);
        for (var key in this.options.ref.param['input-variables']) this.copy(this.options.fnUnit.param['input-variables'], this.options.ref.param['input-variables'], key);
    };

    SetUDFFnUnitParameterValueCommand.prototype.copy = function (to, from, key) {
        if (from[key].constructor == Array) to[key] = $.extend(true, [], from[key]);
        else if (from[key].constructor == Object) to[key] = $.extend(true, {}, from[key]);
        else to[key] = from[key];
    };

    SetUDFFnUnitParameterValueCommand.prototype.undo = function () {
        for (var key in this.options.fnUnit.param['input-variables']) delete this.options.fnUnit.param['input-variables'][key];
        $.extend(true, this.options.fnUnit.param['input-variables'], this.old['input-variables']);
    };

    SetUDFFnUnitParameterValueCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.SetUDFFnUnitParameterValueCommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetUDFFnUnitParameterValueCommand = SetUDFFnUnitParameterValueCommand;

}).call(this);
/**
 * Created by sds on 2018-02-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * overwrite options command
     * @param eventSource
     * @param options
     * @constructor
     */
    function SetOptFnUnitParameterValueCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Change FnUnit Properties';
    }

    SetOptFnUnitParameterValueCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetOptFnUnitParameterValueCommand.prototype.constructor = SetOptFnUnitParameterValueCommand;

    SetOptFnUnitParameterValueCommand.prototype.execute = function () {
        this.old.param = $.extend(true, {}, this.options.fnUnit.param);
        this.options.fnUnit.param = this.options.ref.param;
    };

    SetOptFnUnitParameterValueCommand.prototype.undo = function () {
        this.options.fnUnit.param = this.old.param;
    };

    SetOptFnUnitParameterValueCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setoptfnunitparametervaluecommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetOptFnUnitParameterValueCommand = SetOptFnUnitParameterValueCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function SetOptModelCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.label = this.options.label || 'Set a OPT model';
    }

    SetOptModelCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SetOptModelCommand.prototype.constructor = SetOptModelCommand;

    SetOptModelCommand.prototype.execute = function () {
        var pid = this.options.pid;
        var mid = this.options.mid;
        var optId = this.options.optId;

        this.old = $.extend(true, {}, Brightics.OptModelManager.getOptModel(pid, mid, optId));
        var optModel = this.options.optModel;
        Brightics.OptModelManager.setOptModel(pid, mid, optId, optModel);
    };

    SetOptModelCommand.prototype.undo = function () {
        var pid = this.options.pid;
        var mid = this.options.mid;
        var optId = this.options.optId;

        var optModel = $.extend(true, {}, this.old);
        Brightics.OptModelManager.setOptModel(pid, mid, optId, optModel);
    };

    SetOptModelCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.setoptmodelcommand';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SetOptModelCommand = SetOptModelCommand;

}).call(this);
/**
 * Created by daewon.park on 2016-03-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fid : ''
     * }
     * @param options
     * @constructor
     */
    function ShiftLeftCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.changed = [];
        this.old = {};
    }

    ShiftLeftCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ShiftLeftCommand.prototype.constructor = ShiftLeftCommand;

    ShiftLeftCommand.prototype.canUndo = function () {
        return true;
    };

    ShiftLeftCommand.prototype.canRedo = function () {
        return true;
    };

    ShiftLeftCommand.prototype.execute = function () {
        this.old = {};
        this.options.changed = [];

        var fnUnit = this.options.analyticsModel.getFnUnitById(this.options.fid);
        if (this.shiftLeft(fnUnit) === false) {
            this.old = {};
            this.options.changed = [];

            return false;
        }
    };

    ShiftLeftCommand.prototype.canShift = function (fnUnit) {
        var i;
        for (i in this.options.analyticsModel.functions) {
            var fn = this.options.analyticsModel.functions[i];
            if (fn.fid != fnUnit.fid &&
                fn.display.diagram.position.x == fnUnit.display.diagram.position.x - (Brightics.VA.Env.Diagram.FIGURE_WIDTH + Brightics.VA.Env.Diagram.GAP_WIDTH) &&
                fn.display.diagram.position.y == fnUnit.display.diagram.position.y) {
                return false;
            }
        }

        var prevIds = this.options.analyticsModel.getPrevious(fnUnit.fid);
        for (i in prevIds) {
            var prev = this.options.analyticsModel.getFnUnitById(prevIds[i]);
            if (prev.display.diagram.position.x == fnUnit.display.diagram.position.x - (Brightics.VA.Env.Diagram.FIGURE_WIDTH + Brightics.VA.Env.Diagram.GAP_WIDTH)) {
                return false;
            }
        }

        return true;
    };

    ShiftLeftCommand.prototype.shiftLeft = function (fnUnit) {
        if (this.old[fnUnit.fid]) {
            // do nothing
        } else {
            if (fnUnit.display.diagram.position.x - (Brightics.VA.Env.Diagram.FIGURE_WIDTH + Brightics.VA.Env.Diagram.GAP_WIDTH) < Brightics.VA.Env.Diagram.PAPER_MARGIN_LEFT) {
                this.message = 'Unable to shift further left.';
                return false;
            }

            if (this.canShift(fnUnit) === false) {
                this.message = 'Unable to shift left.';
                return false;
            }

            this.options.changed.push(fnUnit.fid);

            this.old[fnUnit.fid] = {
                x: fnUnit.display.diagram.position.x,
                y: fnUnit.display.diagram.position.y
            };
            fnUnit.display.diagram.position.x -= (Brightics.VA.Env.Diagram.FIGURE_WIDTH + Brightics.VA.Env.Diagram.GAP_WIDTH);

            var nextIds = this.options.analyticsModel.getNext(fnUnit.fid);
            for (var i in nextIds) {
                var next = this.options.analyticsModel.getFnUnitById(nextIds[i]);
                this.shiftLeft(next);
            }
        }

        return true;
    };

    ShiftLeftCommand.prototype.undo = function () {
        for (var fid in this.old) {
            var fnUnit = this.options.analyticsModel.getFnUnitById(fid);
            fnUnit.display.diagram.position.x = this.old[fid].x;
            fnUnit.display.diagram.position.y = this.old[fid].y;
        }
    };

    ShiftLeftCommand.prototype.redo = function () {
        this.execute();
    };

    ShiftLeftCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.shiftleftcommand';
    };

    ShiftLeftCommand.prototype.getLabel = function () {
        return 'Shift Left';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ShiftLeftCommand = ShiftLeftCommand;

}).call(this);
/**
 * Created by daewon.park on 2016-03-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fid : ''
     * }
     * @param options
     * @constructor
     */
    function ShiftRightCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.changed = [];
        this.old = {};
    }

    ShiftRightCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ShiftRightCommand.prototype.constructor = ShiftRightCommand;

    ShiftRightCommand.prototype.canUndo = function () {
        return true;
    };

    ShiftRightCommand.prototype.canRedo = function () {
        return true;
    };

    ShiftRightCommand.prototype.execute = function () {
        this.old = {};
        this.options.changed = [];

        var fnUnit = this.options.analyticsModel.getFnUnitById(this.options.fid);
        this.shiftRight(fnUnit);
        this.options.changed.reverse();
    };

    ShiftRightCommand.prototype.shiftRight = function (fnUnit) {
        if (this.old[fnUnit.fid]) {
            // do nothing
        } else {
            var i, next;

            this.options.changed.push(fnUnit.fid);
            this.old[fnUnit.fid] = {
                x: fnUnit.display.diagram.position.x,
                y: fnUnit.display.diagram.position.y
            };
            fnUnit.display.diagram.position.x += Brightics.VA.Env.Diagram.FIGURE_WIDTH + Brightics.VA.Env.Diagram.GAP_WIDTH;

            for (i in this.options.analyticsModel.functions) {
                next = this.options.analyticsModel.functions[i];
                if (next.display.diagram.position.x == fnUnit.display.diagram.position.x &&
                    next.display.diagram.position.y == fnUnit.display.diagram.position.y) {
                    this.shiftRight(next);
                }
            }

            var nextIds = this.options.analyticsModel.getNext(fnUnit.fid);
            for (i in nextIds) {
                next = this.options.analyticsModel.getFnUnitById(nextIds[i]);
                if (next.display.diagram.position.x == fnUnit.display.diagram.position.x) {
                    this.shiftRight(next);
                }
            }
        }
    };

    ShiftRightCommand.prototype.undo = function () {
        for (var fid in this.old) {
            var fnUnit = this.options.analyticsModel.getFnUnitById(fid);
            fnUnit.display.diagram.position.x = this.old[fid].x;
            fnUnit.display.diagram.position.y = this.old[fid].y;
        }
    };

    ShiftRightCommand.prototype.redo = function () {
        this.execute();
    };

    ShiftRightCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.shiftrightcommand';
    };

    ShiftRightCommand.prototype.getLabel = function () {
        return 'Shift Right';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ShiftRightCommand = ShiftRightCommand;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-03-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options: {
     *      chart: {
     *          type: ''
     *      },
     *      new: {
     *          type: ''
     *      },
     *      old: {
     *          type: ''
     *      }
     * }
     * @param options
     * @constructor
     */
    function SwitchChartCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.options.old = {};
    }

    SwitchChartCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    SwitchChartCommand.prototype.constructor = SwitchChartCommand;

    SwitchChartCommand.prototype.canUndo = function () {
        return true;
    };

    SwitchChartCommand.prototype.canRedo = function () {
        return true;
    };

    SwitchChartCommand.prototype.execute = function () {
        this.options.old.type = this.options.panelOption.chartOption.chart.type;
        this.options.panelOption.chartOption.chart.type = this.options.type;
    };

    SwitchChartCommand.prototype.undo = function () {
        this.options.panelOption.chartOption.chart.type = this.options.old.type;
    };

    SwitchChartCommand.prototype.redo = function () {
        this.execute();
    };

    SwitchChartCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.switchchartcommand';
    };

    SwitchChartCommand.prototype.getLabel = function () {
        return 'Switch a Chart Type';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SwitchChartCommand = SwitchChartCommand;

}).call(this);
/**
 * Created by daewon77.park on 2016-03-27.
 */

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');

    /**
     * options : {
     *      fid : ''
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function SwitchFnUnitCommand(eventSource, options) {
        Brightics.VA.Core.CompoundCommand.call(this, eventSource, options);
    }

    SwitchFnUnitCommand.prototype = Object.create(Brightics.VA.Core.CompoundCommand.prototype);
    SwitchFnUnitCommand.prototype.constructor = SwitchFnUnitCommand;

    SwitchFnUnitCommand.prototype.execute = function () {
        var _this = this;
        this.commandList = [];

        this.add(new Brightics.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand(this.event.source, {
            fnUnit: this.options.fnUnit
        }));

        var newActivityOptions = Brightics.VA.Core.Utils.NestedFlowUtils
            .getNewActivityCommandOptions(this.options.fnUnit);

        if (!_.isEmpty(newActivityOptions)) {
            this.add(_.map(newActivityOptions, function (opt) {
                return new Brightics.VA.Core.Editors.Diagram.Commands
                    .NewActivityCommand(_this.event.source, opt);
            }));
        }

        var command;
        var funcDefinition = Brightics.VA.Core.Interface.Functions[this.options.modelType][this.options.fnUnit.func];

        for (var i in this.options.analyticsModel.links) {
            var linkUnit = this.options.analyticsModel.links[i];
            if (linkUnit[SOURCE_FID] == this.options.fid) {
                //바뀐 함수가 Out이 없는 경우 링크를 끊는다.
                // if (!funcDefinition['out-range'].min) {
                if (!FnUnitUtils.hasOutput(this.options.fnUnit)) {
                    command = new Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand(this.event.source, {
                        kid: linkUnit.kid,
                        'sourceFid': this.options.fnUnit.fid,
                        'targetFid': linkUnit[TARGET_FID]
                    });
                } else {
                    command = new Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this.event.source, {
                        kid: linkUnit.kid,
                        'sourceFid': this.options.fnUnit.fid,
                        'targetFid': linkUnit[TARGET_FID]
                    });
                }
                this.add(command);
            }
            if (linkUnit[TARGET_FID] == this.options.fid) {
                //바뀐 함수가 IN이 없는 경우 링크를 끊는다.
                // if (!funcDefinition['in-range'].min) {
                if (!FnUnitUtils.hasInput(this.options.fnUnit)) {
                    command = new Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand(this.event.source, {
                        kid: linkUnit.kid,
                        'sourceFid': linkUnit[SOURCE_FID],
                        'targetFid': this.options.fnUnit.fid
                    });
                } else {
                    command = new Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this.event.source, {
                        kid: linkUnit.kid,
                        'sourceFid': linkUnit[SOURCE_FID],
                        'targetFid': this.options.fnUnit.fid
                    });
                }
                this.add(command);
            }
        }

        var innerModels = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(
            this.getTargetModel(), this.options.prvFnUnit);

        if (!_.isEmpty(innerModels)) {
            this.add(_.map(innerModels, function (model) {
                return new Brightics.VA.Core.Editors.Diagram.Commands
                    .RemoveActivityCommand(_this.event.source, {
                        mid: model.mid
                    });
            }));
        }

        this.add(new Brightics.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand(this.event.source, {
            fid: this.options.fid
        }));

        Brightics.VA.Core.CompoundCommand.prototype.execute.call(this);
    };

    SwitchFnUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.switchfnunitcommand';
    };

    SwitchFnUnitCommand.prototype.getLabel = function () {
        return 'Switch a Function';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.SwitchFnUnitCommand = SwitchFnUnitCommand;

}).call(this);

/**
 * Created by sungjin1.kim on 2016-04-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function UnBindVariableCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    UnBindVariableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    UnBindVariableCommand.prototype.constructor = UnBindVariableCommand;

    UnBindVariableCommand.prototype.canUndo = function () {
        return true;
    };

    UnBindVariableCommand.prototype.canRedo = function () {
        return true;
    };

    UnBindVariableCommand.prototype.execute = function () {
        this.getMainModel().removeVariable(this.options.fid, this.options.paramKey);
    };

    UnBindVariableCommand.prototype.undo = function () {
        this.getMainModel()
            .addVariable(this.options.fid, this.options.paramKey, this.options.variable);
    };

    UnBindVariableCommand.prototype.redo = function () {
        this.execute();
    };

    UnBindVariableCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.unbindvariablecommand';
    };

    UnBindVariableCommand.prototype.getLabel = function () {
        return 'Unbind Variable';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand = UnBindVariableCommand;

}).call(this);
/* -----------------------------------------------------
 *  update-multichart-option-command.js
 *  Created by hyunseok.oh@samsung.com on 2018-08-10.
 * ---------------------------------------------------- */

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function UpdateMultiChartOptionCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
        this.old = {};
    }

    UpdateMultiChartOptionCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    UpdateMultiChartOptionCommand.prototype.constructor = UpdateMultiChartOptionCommand;

    UpdateMultiChartOptionCommand.prototype.canUndo = function () {
        return true;
    };

    UpdateMultiChartOptionCommand.prototype.canRedo = function () {
        return true;
    };

    UpdateMultiChartOptionCommand.prototype.execute = function () {
        var self = this;
        var getChartOptionPath = function (opt, model, _cb) {
            var cb = _.once(_cb);
            var path = ['functions'];
            _.forEach(model.functions, function (fn, idx) {
                if (fn.fid === opt.fid) {
                    path = path.concat([idx, 'display', 'sheet']);
                    _.forIn(_.get(fn, 'display.sheet'), function (inOut, inOutKey) {
                        _.forIn(inOut, function (sheet, modeKey) {
                            var chartPanelIndex = _.findIndex(sheet[0].panel, function (modePanel) {
                                return modePanel.id === opt.cid;
                            });
                            if (typeof sheet[0].panel[chartPanelIndex] !== 'undefined') {
                                path = path.concat([
                                    inOutKey,
                                    modeKey,
                                    0,
                                    'panel',
                                    chartPanelIndex,
                                    'multiChartOption']);
                                return cb(path);
                            }
                        });
                    });
                }
            });
        };

        getChartOptionPath(self.options, self.getTargetModel(), function (path) {
            self.path = path;
            self.old = _.cloneDeep(_.get(self.getTargetModel(), path));
            _.set(self.getTargetModel(), path, self.options.value);
        });
    };

    UpdateMultiChartOptionCommand.prototype.undo = function () {
        _.set(self.getTargetModel(), self.path, self.old);
    };

    UpdateMultiChartOptionCommand.prototype.redo = function () {
        this.execute();
    };

    UpdateMultiChartOptionCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.updatemultichartoptioncommand';
    };

    UpdateMultiChartOptionCommand.prototype.getLabel = function () {
        return 'Update Multi Chart Option';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.UpdateMultiChartOptionCommand =
        UpdateMultiChartOptionCommand;
/* eslint-disable no-invalid-this */
}.call(this));

/* -----------------------------------------------------
 *  update-operation-command.js
 *  Created by hyunseok.oh@samsung.com on 2018-02-27.
 * ---------------------------------------------------- */

(function () {
    'use strict';
    var root = this;
    var Brightics = root.Brightics;
    var ObjectUtils = root.__module__.ObjectUtils;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function UpdateOperationCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    UpdateOperationCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    UpdateOperationCommand.prototype.constructor = UpdateOperationCommand;

    UpdateOperationCommand.prototype.canUndo = function () {
        return true;
    };

    UpdateOperationCommand.prototype.canRedo = function () {
        return true;
    };

    UpdateOperationCommand.prototype.execute = function () {
        this.setValue(this.options.path, this.options.value, true);
    };

    UpdateOperationCommand.prototype.undo = function () {
        this.setValue(this.options.path, this.old, false);
    };

    UpdateOperationCommand.prototype.redo = function () {
        this.execute();
    };

    UpdateOperationCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.updateoperationcommand';
    };

    UpdateOperationCommand.prototype.getLabel = function () {
        return this.options.label;
    };

    // UpdateOperationCommand.prototype.copy = function (newValue) {
    //     return _.clone(newValue);
    //     // if (newValue.constructor == Array) return $.extend(true, [], newValue);
    //     // else if (newValue.constructor == Object) return $.extend(true, {}, newValue);
    //     // return newValue;
    // };

    UpdateOperationCommand.prototype.setValue = function (path, newValue, setOld) {
        var fn = this.options.fnUnit || this.options.target;
        if (setOld) this.old = ObjectUtils.updateProp(fn, path, newValue);
        else ObjectUtils.updateProp(fn, path, newValue);
        // var idx = -1;
        // var len = path.length;
        // while (++idx < len - 1) {
        //     fn = fn[path[idx]];
        // }
        // if (setOld) this.old = this.copy(fn[path[path.length - 1]]);
        // fn[path[path.length - 1]] = this.copy(newValue);
    };

    Brightics.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand = UpdateOperationCommand;
/* eslint-disable no-invalid-this */
}.call(this));


/**
 * Created by sungjin1.kim on 2016-04-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function UpdateParameterCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    UpdateParameterCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    UpdateParameterCommand.prototype.constructor = UpdateParameterCommand;

    UpdateParameterCommand.prototype.canUndo = function () {
        return true;
    };

    UpdateParameterCommand.prototype.canRedo = function () {
        return true;
    };

    UpdateParameterCommand.prototype.execute = function () {
        this.options.old = {};
        this.options.old[this.options.name] = this.options.analyticsModel.getParameter(this.options.name)
        this.options.analyticsModel.setParameter(this.options.name, this.options.ref);

    };

    UpdateParameterCommand.prototype.undo = function () {
        var key = (Object.keys(this.options.old))[0];
        this.options.analyticsModel.setParameter(key, this.options.old[key]);
    };

    UpdateParameterCommand.prototype.redo = function () {
        this.execute();
    };

    UpdateParameterCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.UpdateParameterCommand';
    };

    UpdateParameterCommand.prototype.getLabel = function () {
        return 'Update Parameters';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand = UpdateParameterCommand;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-04-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function UpdateVariableCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    UpdateVariableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    UpdateVariableCommand.prototype.constructor = UpdateVariableCommand;

    UpdateVariableCommand.prototype.canUndo = function () {
        return true;
    };

    UpdateVariableCommand.prototype.canRedo = function () {
        return true;
    };

    UpdateVariableCommand.prototype.execute = function () {
        this.options.old = this.getMainModel().getVariable(this.options.fid, this.options.paramKey);
        this.getMainModel().setVariable(this.options.fid, this.options.paramKey, this.options.ref);
    };

    UpdateVariableCommand.prototype.undo = function () {
        this.getMainModel().setVariable(this.options.fid, this.options.paramKey, this.options.old);
    };

    UpdateVariableCommand.prototype.redo = function () {
        this.execute();
    };

    UpdateVariableCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.updatevariablecommand';
    };

    UpdateVariableCommand.prototype.getLabel = function () {
        return 'Update Variable';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.UpdateVariableCommand = UpdateVariableCommand;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-04-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var ARRAY_TYPE = ['array[string]', 'array[number]'];
    var NUMBER_TYPE = ['number', 'array[number]'];

    /**
     * options : {
     *      fnUnit : {}
     * }
     *
     * @param options
     * @constructor
     */
    function UpdateVariableDefCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    UpdateVariableDefCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    UpdateVariableDefCommand.prototype.constructor = UpdateVariableDefCommand;

    UpdateVariableDefCommand.prototype.canUndo = function () {
        return true;
    };

    UpdateVariableDefCommand.prototype.canRedo = function () {
        return true;
    };

    UpdateVariableDefCommand.prototype.execute = function () {
        var analyticsModel = this.getMainModel();
        this.options.old = _.cloneDeep(analyticsModel.variables[this.options.name]);
        if (this.options.name === this.options.newName) {
            if (this.options.old.type !== this.options.ref.type) {
                var val = this.getValueByType(
                    this.options.old.type,
                    this.options.ref.type,
                    this.options.ref.value);
                    // this.options.old.value);

                val = this.typeCast(val, this.options.ref.type);
                
                // if (this.isArrayType(this.options.old['variable-type'])) {
                //     this.options.ref.value = '';
                // } else {
                //     this.options.ref.value =
                //         this.getValueByType(this.options.old.type, this.options.old.value[0]);
                // }
                // if (this.options.old['variable-type'] === 'array') {
                //     if (this.options.ref['variable-type'] === 'number') {
                //         this.options.ref.value = "";
                //     } else {
                //         this.options.ref.value = String(this.options.old.value[0]);
                //     }
                // } else if (this.options.ref['variable-type'] === 'number') {
                //     this.options.ref.value = "";
                // } else if (this.options.ref['variable-type'] === 'array') {
                //     this.options.ref.value = [this.options.old.value];
                // }
                this.options.ref.value = val;
                this.options.ref.type = this.options.ref.type;
            }
            analyticsModel.setVariableDef(this.options.name, this.options.ref);
        } else {
            analyticsModel.removeVariableDef(this.options.name);
            analyticsModel.addVariableDef(this.options.newName, this.options.old);
        }
    };

    UpdateVariableDefCommand.prototype.undo = function () {
        var analyticsModel = this.getMainModel();
        if (this.options.name === this.options.newName) {
            analyticsModel.setVariableDef(this.options.name, this.options.old);
        } else {
            analyticsModel.addVariableDef(this.options.name, this.options.old);
            analyticsModel.removeVariableDef(this.options.newName);
        }
    };

    UpdateVariableDefCommand.prototype.redo = function () {
        this.execute();
    };

    UpdateVariableDefCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.updatevariabledefcommand';
    };

    UpdateVariableDefCommand.prototype.getLabel = function () {
        return 'Update Variable';
    };

    UpdateVariableDefCommand.prototype.isArrayType = function (type) {
        return ARRAY_TYPE.indexOf(type) > -1;
    };

    UpdateVariableDefCommand.prototype.isNumeric = function (type) {
        return NUMBER_TYPE.indexOf(type) > -1;
    };

    UpdateVariableDefCommand.prototype.getValueByType = function (curType, nxtType, val) {
        if (this.isArrayType(curType) && !this.isArrayType(nxtType)) {
            return val[0];
        } else if (!this.isArrayType(curType) && this.isArrayType(nxtType)) {
            return [val];
        }
        return val;
    };

    UpdateVariableDefCommand.prototype.typeCast = function (val, type) {
        var ret = val;
        if (this.isNumeric(type)) {
            if (this.isArrayType(type)) ret = _.map(ret, this.toNumber.bind(this));
            else ret = this.toNumber(ret);
        } else {
            if (this.isArrayType(type)) ret = _.map(ret, this.toString.bind(this));
            else ret = this.toString(ret);
        }
        return ret;
    };

    // UpdateVariableDefCommand.prototype.toString = function (val) {
    //     if (_.isNumber(val)) {
    //         if (_.isNaN(val)) return '';
    //         return val.toString();
    //     }
    //     return val;
    // };

    UpdateVariableDefCommand.prototype.toString = function (val) {
        if (_.isNull(val) || _.isUndefined(val) || val === '') return '';
        if (_.isNumber(val)) {
            if (_.isNaN(val) || _.isUndefined(val)) return '';
            return val.toString();
        }
        return val;
    };

    UpdateVariableDefCommand.prototype.toNumber = function (val) {
        if (_.isNull(val) || _.isUndefined(val) || val === '') return 0;
        return Number(this.toString(Number(val)));
    };
    
    Brightics.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand = UpdateVariableDefCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AddVariableCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    AddVariableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    AddVariableCommand.prototype.constructor = AddVariableCommand;

    AddVariableCommand.prototype.execute = function () {
        // this.old.variables = JSON.parse(JSON.stringify(this.options.analyticsModel.variables));
        this.options.analyticsModel.variables.push(this.options.variable);
    };

    AddVariableCommand.prototype.undo = function () {
        // this.options.analyticsModel.variables = JSON.parse(JSON.stringify(this.old.variables));
        this.options.analyticsModel.variables.splice(this.options.analyticsModel.variables.length - 1, 1);
    };

    AddVariableCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.controleditor.addvariablecommand';
    };

    AddVariableCommand.prototype.getLabel = function () {
        return 'Add Control Flow Variable';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.AddVariableCommand = AddVariableCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AppendUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    AppendUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    AppendUnitCommand.prototype.constructor = AppendUnitCommand;

    AppendUnitCommand.prototype.execute = function () {
        var newFunctions = this.options.newParent.param ? this.options.newParent.param.functions : this.options.newParent.functions;
        var oldFunctions = this.options.oldParent.param ? this.options.oldParent.param.functions : this.options.oldParent.functions;

        this.options.oldIndex = oldFunctions.indexOf(this.options.unit);
        oldFunctions.splice(this.options.oldIndex, 1);

        if (this.options.newIndex !== -1) {
            newFunctions.splice(this.options.newIndex, 0, this.options.unit);
        } else {
            newFunctions.push(this.options.unit);
            this.options.newIndex = newFunctions.indexOf(this.options.unit);
        }
    };

    AppendUnitCommand.prototype.undo = function () {
        var newFunctions = this.options.newParent.param ? this.options.newParent.param.functions : this.options.newParent.functions;
        var oldFunctions = this.options.oldParent.param ? this.options.oldParent.param.functions : this.options.oldParent.functions;

        newFunctions.splice(this.options.newIndex, 1);
        oldFunctions.splice(this.options.oldIndex, 0, this.options.unit);
    };

    AppendUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.controleditor.appendunitcommand';
    };

    AppendUnitCommand.prototype.getLabel = function () {
        return 'Move Unit';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.AppendUnitCommand = AppendUnitCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function NewUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    NewUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    NewUnitCommand.prototype.constructor = NewUnitCommand;

    NewUnitCommand.prototype.execute = function () {
        var functions = this.options.parent.param ? this.options.parent.param.functions : this.options.parent.functions;
        this.options.unit = this.options.analyticsModel.newFnUnit(this.options.func);
        // this.options.fid = this.options.unit.fid;

        if (this.options.dataFlowFile) {
            this.createDataFlowUnitInformation();
        }

        if (this.options.index !== -1) {
            functions.splice(this.options.index, 0, this.options.unit);
        } else {
            functions.push(this.options.unit);
            this.options.index = functions.indexOf(this.options.unit);
        }
    };

    NewUnitCommand.prototype.redo = function () {
        var functions = this.options.parent.param ? this.options.parent.param.functions : this.options.parent.functions;
        // this.options.unit = this.options.analyticsModel.newFnUnit(this.options.func);
        // this.options.unit.fid = this.options.fid;

        if (this.options.dataFlowFile) {
            this.createDataFlowUnitInformation();
        }

        if (this.options.index !== -1) {
            functions.splice(this.options.index, 0, this.options.unit);
        } else {
            functions.push(this.options.unit);
            this.options.index = functions.indexOf(this.options.unit);
        }
    };

    NewUnitCommand.prototype.undo = function () {
        var functions = this.options.parent.param ? this.options.parent.param.functions : this.options.parent.functions;
        functions.splice(this.options.index, 1);
    };

    NewUnitCommand.prototype.createDataFlowUnitInformation = function () {
        var unit = this.options.unit;
        var file = this.options.dataFlowFile;
        var gvMap = file.getContents()['gv-def'] || {};

        unit.param.mid = file.getFileId();
        unit.param.label = file.getLabel() || '';
        unit.param.description = file.getDescription() || '';

        unit.display = {
            label: file.getLabel(),
            description: ''
        };

        $.map(gvMap, function (gv, key) {
            unit.param.args[key] = {
                'type': 'literal',
                'value': gv.value,
                'variable-type': gv['variable-type'] || 'string'
            };
        });
    };

    NewUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.controleditor.newunitcommand';
    };

    NewUnitCommand.prototype.getLabel = function () {
        return 'New Unit';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.NewUnitCommand = NewUnitCommand;
}).call(this);

/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RemoveUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    RemoveUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveUnitCommand.prototype.constructor = RemoveUnitCommand;

    RemoveUnitCommand.prototype.execute = function () {
        var functions = this.options.parent.param ? this.options.parent.param.functions : this.options.parent.functions;

        this.options.index = -1;
        for (var i in functions) {
            var func = functions[i];
            if (func.fid == this.options.unit.fid) {
                this.options.index = i;
            }
        }
        functions.splice(this.options.index, 1);
    };

    RemoveUnitCommand.prototype.undo = function () {
        var functions = this.options.parent.param ? this.options.parent.param.functions : this.options.parent.functions;

        functions.splice(this.options.index, 0, this.options.unit);
    };

    RemoveUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.controleditor.removeunitcommand';
    };

    RemoveUnitCommand.prototype.getLabel = function () {
        return 'Remove Unit';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.RemoveUnitCommand = RemoveUnitCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RemoveVariableCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    RemoveVariableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    RemoveVariableCommand.prototype.constructor = RemoveVariableCommand;

    RemoveVariableCommand.prototype.execute = function () {
        this.old.index = this.options.analyticsModel.variables.indexOf(this.options.variable);
        this.options.analyticsModel.variables.splice(this.old.index, 1);
    };

    RemoveVariableCommand.prototype.undo = function () {
        this.options.analyticsModel.variables.splice(this.old.index, 0, this.options.variable);
    };

    RemoveVariableCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.controleditor.removevariablecommand';
    };

    RemoveVariableCommand.prototype.getLabel = function () {
        return 'Remove Control Flow Variable';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.RemoveVariableCommand = RemoveVariableCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ReorderUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    ReorderUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    ReorderUnitCommand.prototype.constructor = ReorderUnitCommand;

    ReorderUnitCommand.prototype.execute = function () {
        var functions = this.options.parent.param.functions;
        this.options.oldIndex = functions.indexOf(this.options.unit);
        functions.splice(this.options.newIndex, 0, functions.splice(this.options.oldIndex, 1)[0]);
    };

    ReorderUnitCommand.prototype.undo = function () {
        var functions = this.options.parent.param.functions;
        functions.splice(this.options.oldIndex, 0, functions.splice(this.options.newIndex, 1)[0]);
    };

    ReorderUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.controleditor.reorderunitcommand';
    };

    ReorderUnitCommand.prototype.getLabel = function () {
        return 'Reorder Unit';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.ReorderUnitCommand = ReorderUnitCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function UpdateUnitCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);

        this.old.display = {};
        this.old.param = {};
    }

    UpdateUnitCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    UpdateUnitCommand.prototype.constructor = UpdateUnitCommand;

    UpdateUnitCommand.prototype.execute = function () {
        for (var key in this.options.display) {
            this.old.display[key] = this.options.unit.display[key];
            this.options.unit.display[key] = this.options.display[key];
        }
        for (var key in this.options.param) {

            this.old.param[key] = Array.isArray(this.options.unit.param[key]) ? $.extend([], this.options.unit.param[key]) : this.options.unit.param[key];
            this.options.unit.param[key] = this.options.param[key];
        }
    };

    UpdateUnitCommand.prototype.undo = function () {
        for (var key in this.old.display) {
            this.options.unit.display[key] = this.old.display[key];
        }
        for (var key in this.old.param) {
            this.options.unit.param[key] = Array.isArray(this.old.param[key]) ? $.extend([], this.old.param[key]) : this.old.param[key];
        }
    };

    UpdateUnitCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.controleditor.updateunitcommand';
    };

    UpdateUnitCommand.prototype.getLabel = function () {
        return 'Update Unit';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.UpdateUnitCommand = UpdateUnitCommand;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-02-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function UpdateVariableCommand(eventSource, options) {
        Brightics.VA.Core.Command.call(this, eventSource, options);
    }

    UpdateVariableCommand.prototype = Object.create(Brightics.VA.Core.Command.prototype);
    UpdateVariableCommand.prototype.constructor = UpdateVariableCommand;

    UpdateVariableCommand.prototype.execute = function () {
        this.old.index = this.options.analyticsModel.variables.indexOf(this.options.variable);
        this.old.variable = $.extend(true, {}, this.options.analyticsModel.variables[this.old.index]);

        var originType = this.options.analyticsModel.variables[this.old.index].type;
        var changedType = this.options.ref.type || this.options.analyticsModel.variables[this.old.index].type;
        if (originType !== changedType) {
            if (originType === 'array') {
                if (changedType === 'number') {
                    this.options.ref.value = "";
                } else {
                    this.options.ref.value = String(this.options.analyticsModel.variables[this.old.index].value[0]);
                }
            } else if (changedType === 'number') {
                this.options.ref.value = "";
            } else if (changedType === 'array') {
                this.options.ref.value = [this.options.analyticsModel.variables[this.old.index].value];
            }
        }

        this.options.analyticsModel.variables[this.old.index].name = this.options.ref.name || this.old.variable.name;
        this.options.analyticsModel.variables[this.old.index].type = this.options.ref.type || this.old.variable.type;
        this.options.analyticsModel.variables[this.old.index].value = this.options.ref.value !== '' ? this.options.ref.value || this.old.variable.value : this.options.ref.value;
    };

    UpdateVariableCommand.prototype.undo = function () {
        this.options.analyticsModel.variables[this.old.index].name = this.old.variable.name;
        this.options.analyticsModel.variables[this.old.index].type = this.old.variable.type;
        this.options.analyticsModel.variables[this.old.index].value = this.old.variable.value;
    };

    UpdateVariableCommand.prototype.getId = function () {
        return 'brightics.va.editors.diagram.commands.controleditor.updatevariablecommand';
    };

    UpdateVariableCommand.prototype.getLabel = function () {
        return 'Update Control Flow Variable';
    };

    Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.UpdateVariableCommand = UpdateVariableCommand;

}).call(this);
/**
 * Created by sds on 2017-07-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Boat($parent, options) {
        this.$parent = $parent;
        this.options = {
            draggable: true,
            resizable: true
        };

        this.options = $.extend(true, this.options, options);

        this.init();
    }

    Boat.prototype.init = function () {
        this.createLayout();
        this.createContents();
    };

    Boat.prototype.getTitle = function () {
    };

    Boat.prototype.setPosition = function () {
    };

    Boat.prototype.createLayout = function () {
        var _this = this;

        this.$boatArea = $('' +
            '<div class="brtc-va-editors-diagram-minimap">' +
            '   <div class="brtc-va-editors-diagram-minimap-header">' +
            '       <div class="brtc-va-editors-diagram-minimap-title">'+ this.getTitle() +'</div>' +
            '       <div class="brtc-va-editors-diagram-minimap-collapse"><i class="fa fa-chevron-up" aria-hidden="true"></i></div>' +
            '   </div>' +
            '   <div class="brtc-va-editors-diagram-minimap-contents">' +
            '   </div>' +
            '</div>');
        this.$boat = this.$boatArea.find('.brtc-va-editors-diagram-minimap-contents');

        this.$parent.append(this.$boatArea);

        this.setPosition();

        if (this.options.draggable) {
            this.$boatArea.draggable({
                containment: 'parent',
                handle: '.brtc-va-editors-diagram-minimap-header',
                start: function () {
                    $(this).css('right', 'auto');
                },
                stop: function () {
                    var position = $(this).position();
                    if (position.left > $(this).parent().width() / 2) {
                        $(this).css('left', 'auto');
                        $(this).css('right', $(this).parent().width() - position.left - $(this).width());
                    }
                }
            });
        }

        if (this.options.resizable) {
            this.$boat.resizable({
                maxWidth: 1280,
                minWidth: 190,
                minHeight: 90,
                containment: '.brtc-va-editors-modeleditor-splitter',
                start: function (event, ui) {
                    _this.$boatArea.css('left', _this.$boatArea.position().left);
                    _this.$boatArea.css('right', 'initial');
                },
                stop: function (event, ui) {
                    var position = _this.$boatArea.position();
                    if (position.left > _this.$boatArea.parent().width() / 2) {
                        _this.$boatArea.css('left', 'initial');
                        _this.$boatArea.css('right', _this.$boatArea.parent().width() - position.left - _this.$boatArea.width());
                    }
                    _this.updateMiniMapWindow();
                }
            });
        }
        
        var $collapseButton = this.$boatArea.find('.brtc-va-editors-diagram-minimap-collapse');
        $collapseButton.on('click', function (event) {
            if ($collapseButton.find('i').hasClass('fa-chevron-down')) {
                $collapseButton.find('i').removeClass('fa-chevron-down');
                _this.$boat.removeClass('collapsed');
            }
            else {
                $collapseButton.find('i').addClass('fa-chevron-down');
                _this.$boat.addClass('collapsed');
            }
        });

        var $closeButton = this.$boatArea.find('.brtc-va-editors-diagram-minimap-close');
        $closeButton.on('click', function (event) {
            _this.$boatArea.addClass('closed');
        });
    };

    Boat.prototype.destroy = function () {
        this.$boatArea.remove();
    };
    Brightics.VA.Core.Editors.Diagram.Boat = Boat;

}).call(this);
/**
 * Created by sds on 2017-07-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ExpressionBoat($parent, options) {
        Brightics.VA.Core.Editors.Diagram.Boat.call(this, $parent, options);
    }

    ExpressionBoat.prototype = Object.create(Brightics.VA.Core.Editors.Diagram.Boat.prototype);
    ExpressionBoat.prototype.constructor = ExpressionBoat;

    ExpressionBoat.prototype.createContents = function () {
        var $container = $('<div class="brtc-va-dialogs-index-item-container"></div>');
        this.$boat.append($container);

        //data proxy가 optional 하도록..
        var mid = this.options.editor.getModel().mid;
        var propDataProxy = new Brightics.VA.Core.Editors.Sheet.DataProxy($container, mid);

        this.innerPropertiesPanel = this.options.editor.getPanelFactory().createPropertiesPanel($container, {
            width: '100%',
            height: '100%',
            fnUnit: this.options.editor.getActiveFnUnit(),
            dataProxy: propDataProxy,
            blockCommandListener: true
        });

        this.innerPropertiesPanel.setHeight(300);
        this.innerPropertiesPanel.setType('inner');
        this.innerPropertiesPanel.hideTopArea();
        this.innerPropertiesPanel.hideBottomArea();
        this.innerPropertiesPanel.hideInTableControl();

        //propertiespanel에 넣기 애매한 것들..
        this.innerPropertiesPanel.$mainControl.find('.brtc-va-editors-sheet-controls-propertycontrol-columnlist').hide();
        $container.find('.brtc-va-progress').hide();

        // this.$boat.perfectScrollbar();
        this.configureStyle();
    };

    ExpressionBoat.prototype.configureStyle = function () {
        this.$boat
            .addClass('brtc-style-height-400px')
            .addClass('brtc-style-border-top-grey')
            .addClass('brtc-style-background-white');
    };

    ExpressionBoat.prototype.getTitle = function () {
        return 'Expression';
    };

    ExpressionBoat.prototype.setPosition = function () {
        this.$boatArea.css('right', '300px');
    };

    Brightics.VA.Core.Editors.Diagram.ExpressionBoat = ExpressionBoat;

}).call(this);
/**
 * Created by sds on 2017-07-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function MinimapBoat($parent, options) {
        Brightics.VA.Core.Editors.Diagram.Boat.call(this, $parent, options);
    }

    MinimapBoat.prototype = Object.create(Brightics.VA.Core.Editors.Diagram.Boat.prototype);
    MinimapBoat.prototype.constructor = MinimapBoat;

    MinimapBoat.prototype.createContents = function () {
        var _this = this;

        this.$paper = $('<div class="brtc-va-editors-diagram-minimap-paper"></div>');
        this.$window = $('<div class="brtc-va-editors-diagram-minimap-window"></div>');

        this.$boat.append(this.$paper).append(this.$window);

        this.$wrapper = Studio
            .getEditorContainer()
            .getActiveModelEditor()
            .getDiagramEditorPageArea()
            .find('.brtc-va-editors-diagram-diagrameditorpage'); 

        this.$window.draggable({
            containment: 'parent',
            stop: function () {
                var pos = $(this).position();
                var size = _this.getPaperSize();
                var $miniSvg = _this.$paper.find('svg');
                var widthScale = $miniSvg.width() / size.width;
                var heightScale = $miniSvg.height() / size.height;
                var scrollLeft = pos.left / widthScale;
                var scrollTop = pos.top / heightScale;
                _this.$wrapper.scrollLeft(scrollLeft).scrollTop(scrollTop);
                _this.updateMiniMapWindow();
            }
        });

        if (Brightics.VA.SettingStorage.getValue('editor.minimap.visible') !== 'true') _this.$boatArea.addClass('closed');


        this.miniPaper = new joint.dia.Paper({
            el: this.$paper,
            width: 190,
            height: 90,
            model: this.options.diagramEditorPage.graph,
            theme: 'none'
        });
        this.miniPaper.scale(.3);
        this.miniPaper.$el.css('pointer-events', 'none');
    };

    MinimapBoat.prototype.updateMiniMapWindow = function () {
        var _this = this;
        if (this.miniPaper) {
            var size = this.getPaperSize();

            var baseWidth = this.$boat.width();
            var baseHeight = this.$boat.height();
            var miniScale;
            if (size.height * baseWidth / size.width <= baseHeight) {
                miniScale = baseWidth / size.width;
                this.miniPaper.setDimensions(baseWidth, size.height * miniScale);
            } else {
                miniScale = baseHeight / size.height;
                this.miniPaper.setDimensions(size.width * miniScale, baseHeight);
            }
            this.miniPaper.scale(miniScale * this.options.diagramEditorPage.getOptions().scale);

            this.$window.css({
                width: this.$wrapper.width() * miniScale,
                height: this.$wrapper.height() * miniScale,
                left: this.$wrapper.scrollLeft() * miniScale,
                top: this.$wrapper.scrollTop() * miniScale
            });

            if (this.$boat.width() != Math.max(190, this.miniPaper.options.width)) {
                this.$boat.width(Math.max(190, this.miniPaper.options.width));
            }
            if (this.$boat.height() != Math.max(90, this.miniPaper.options.height)) {
                this.$boat.height(Math.max(90, this.miniPaper.options.height));
            }
        }
    };

    MinimapBoat.prototype.getPaperSize = function () {
        return this.options.diagramEditorPage.getPaperSize();
    };

    MinimapBoat.prototype.getTitle = function () {
        return 'Minimap';
    };

    Brightics.VA.Core.Editors.Diagram.MinimapBoat = MinimapBoat;

}).call(this);
/**
 * Created by jmk09.jung on 2016-01-26.
 */
(function () {
    'use strict';

    var root = this;

    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function FnUnitNavigator(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
    }

    FnUnitNavigator.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    FnUnitNavigator.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-editors-sheet-fnunitnavigator"></div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);

        this.createLayout();
        this.createNavigator();
    };

    FnUnitNavigator.prototype.createLayout = function () {
        var $newNavigator = $('<div class="brtc-va-editors-sheet-fnunitnavigator-navigator"></div>');
        this.$mainControl.append($newNavigator);

        var $newMode = $('<div class="brtc-va-editors-sheet-fnunitnavigator-mode"></div>');
        this.$mainControl.append($newMode);

        this.$navigator = $newNavigator;
        this.$mode = $newMode;
    };

    FnUnitNavigator.prototype.createNavigator = function () {
        var fnUnitList = this.options.analyticsModel.getFnUnitListBySheetId(this.options.sheetId);
        for (var i in fnUnitList) {
            this.createNavigatorElement(this.$navigator, fnUnitList[i]);
        }

        this.$navigator.append('<div class="brtc-va-editors-sheet-fnunitnavigator-navigator-addfn"><i class="fa fa-plus-circle"></i></div>');
    };

    FnUnitNavigator.prototype.createNavigatorElement = function ($parent, fnUnit) {
        var clazz = fnUnit.parent().type;
        var category = 'brtc-va-fnunit-category-'+ Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func).category;
        var _this = this;
        var $main = $('' +
            '<div class="brtc-va-editors-sheet-fnunitnavigator-navigator-main">' +
            '   <div class="brtc-va-editors-sheet-fnunitnavigator-navigator-element ' + category + '">' +
            '       <div class="brtc-va-editors-sheet-fnunitnavigator-navigator-element-title">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(fnUnit.display.label) + '</div>' +
            '   </div>' +
            '</div>');
        $main.attr('fnunitid', fnUnit.id);
        $parent.append($main);

        $main.on('click', function () {
            var fnUnitId = $(this).attr('fnunitid');
            _this.select(fnUnitId, true);
        });
    };

    FnUnitNavigator.prototype.select = function (fnUnitId, trigger) {
        this.$navigator.find('.brtc-va-editors-sheet-fnunitnavigator-navigator-element').removeClass('brtc-va-editors-sheet-fnunitnavigator-navigator-element-selected');

        var $choose = this.$navigator.children('.brtc-va-editors-sheet-fnunitnavigator-navigator-main[fnunitid="' + fnUnitId + '"]');
        $choose.children('.brtc-va-editors-sheet-fnunitnavigator-navigator-element').addClass('brtc-va-editors-sheet-fnunitnavigator-navigator-element-selected');

        var $addButton = this.$navigator.children('.brtc-va-editors-sheet-fnunitnavigator-navigator-addfn');
        $addButton.detach();
        $choose.after($addButton);

        if (trigger) {
            this.$parent.trigger('select', [{ fnUnitId: fnUnitId }]);
        }
    };

    FnUnitNavigator.prototype.setFocusElement = function (clazz) {
        var _this = this;
        var $target = $('.' + clazz);

        //1. addFn
        var $addFn = this.$navigator.find('.brtc-va-editors-sheet-fnunitnavigator-navigator-addfn');
        if ($addFn.length > 0) {
            $target.after($addFn);

        } else {
            $addFn = this.createAddFn();
            this.$navigator.append($addFn);
        }

        //2.color
        var navArr = $target.parent().children();
        for (var i = 0; i < navArr.length; i++) {
            $(navArr[i]).children().removeClass('brtc-va-editors-sheet-fnunitnavigator-navigator-element-selected');
        }

        $target.children().addClass('brtc-va-editors-sheet-fnunitnavigator-navigator-element-selected');
    };

    FnUnitNavigator.prototype.createAddFn = function () {
        //addFn
        var $addFn = $('' +
            '<div class="brtc-va-editors-sheet-fnunitnavigator-navigator-addfn">' +
            '   <i class="fa fa-plus-circle"></i>' +
            '</div>'
        );

        return $addFn;
    };

    FnUnitNavigator.prototype.createMode = function () {
        //test
        var source = [
            '2',
            '3'
        ];
        // Create a jqxDropDownList
        $(this.$mode).jqxDropDownList({
            source: source,
            theme: 'office',
            autoOpen: false,
            itemHeight: 30,
            width: '48px',
            height: '90%',
            selectedIndex: 1,
            autoDropDownHeight: true
        });
    };

    Brightics.VA.Core.Editors.Sheet.FnUnitNavigator = FnUnitNavigator;

}).call(this);

/**
 * Created by jmk09.jung on 2016-01-26.
 */
(function () {
    'use strict';

    var root = this;

    var Brightics = root.Brightics;

    var FnUnitUtils = brtc_require('FnUnitUtils');

    const PANEL_TYPE_IN = 'in';
    const PANEL_TYPE_OUT = 'out';
    const DATA_POST_FIX = 'Data';

    function FnUnitViewer(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
    }

    FnUnitViewer.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    FnUnitViewer.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-editors-sheet-fnunitviewer"></div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);

        this.createLayout();
    };

    FnUnitViewer.prototype.createLayout = function () {
        this.$mainControl.append('' +
            '<div class="brtc-va-editors-sheet-fnunitviewer-panel brtc-va-editors-sheet-fnunitviewer-flex-width brtc-va-editors-sheet-fnunitviewer-indata-fncenter" datapaneltype="in"></div>' +
            '<div class="brtc-va-editors-sheet-fnunitviewer-panel brtc-va-editors-sheet-fnunitviewer-fixed-width brtc-va-editors-sheet-fnunitviewer-fn-fncenter"></div>' +
            '<div class="brtc-va-editors-sheet-fnunitviewer-panel brtc-va-editors-sheet-fnunitviewer-flex-width brtc-va-editors-sheet-fnunitviewer-outdata-fncenter" datapaneltype="out"></div>' +
            '');
    };

    FnUnitViewer.prototype.destroy = function () {
        if (this.inPanel) {
            this.inPanel.destroy();
        }
        if (this.propertiesPanel) {
            this.propertiesPanel.destroy();
        }
        if (this.outPanel) {
            this.outPanel.destroy();
        }
        if (this.inViewerTab) {
            this.inViewerTab.destroy();
        }
        if (this.outViewerTab) {
            this.outViewerTab.destroy();
        }

        this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-indata-fncenter').off('sizeChange');
        this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-outdata-fncenter').off('sizeChange');

        this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-indata-fncenter').empty();
        this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-fn-fncenter').empty();
        this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-outdata-fncenter').empty();

        this._status = 'destroyed';
    };

    FnUnitViewer.prototype._alreadyRendered = function (fnUnit) {
        return (this.fnUnit && this.fnUnit.fid === fnUnit.fid && this._status === 'rendered');
    };

    FnUnitViewer.prototype.movePanel = function (index) {
        this.outViewerTab.select(index);
    };

    FnUnitViewer.prototype.getDataTypes = function (fnUnit, panelType) {
        return FnUnitUtils.getTypes(fnUnit, panelType);
    };

    FnUnitViewer.prototype.createOutPages = function (options) {
        var _this = this;

        var pages = [];
        var dataTypes = this.getDataTypes(options.fnUnit, PANEL_TYPE_OUT);
        dataTypes = _.isEmpty(dataTypes) ? ['table', 'model', 'image'] : dataTypes;

        for (var i in dataTypes) {
            var type = dataTypes[i];
            var page = {
                label: type,
                type: type,
                renderer: function ($page, type) {
                    $page.empty();
                    $page.attr('datapaneltype', 'out');
                    options.type = type;
                    options.panelType = 'out';
                    var panelControl = _this.options.panelFactory.create($page, options)
                    $page.data('panelControl_ref', panelControl);
                },
                destroy: function ($page) {
                    var panelControl = $page.data('panelControl_ref');
                    if (panelControl && typeof panelControl.destroy === 'function') {
                        panelControl.destroy();
                    }
                }
            };

            pages.push(page);
        }

        return pages;
    };

    FnUnitViewer.prototype.createInPages = function (options) {
        var _this = this;

        var pages = [];
        var dataTypes = this.getDataTypes(options.fnUnit, PANEL_TYPE_IN);
        dataTypes = _.isEmpty(dataTypes) ? ['table', 'model', 'image'] : dataTypes;

        for (var i in dataTypes) {
            var type = dataTypes[i];
            var page = {
                label: type,
                type: type,
                renderer: function ($page, type) {
                    $page.empty();
                    $page.attr('datapaneltype', 'in');
                    options.type = type;
                    options.panelType = 'in';
                    var panelControl = _this.options.panelFactory.create($page, options)
                    $page.data('panelControl_ref', panelControl);
                },
                destroy: function ($page) {
                    var panelControl = $page.data('panelControl_ref');
                    if (panelControl && typeof panelControl.destroy === 'function') {
                        panelControl.destroy();
                    }
                }
            };

            pages.push(page);
        }

        return pages;
    };

    FnUnitViewer.prototype.createInPanel = function ($parent, options) {
        var $in = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-indata-fncenter');
        if (FnUnitUtils.hasInput(options.fnUnit)) {
            $parent.show();
            var pages = this.createInPages(options);

            options.pages = pages;

            this.inViewerTab = new Brightics.VA.Core.Tools.Tab($in, options);
        } else {
            if (FnUnitUtils.isBluffNode(options.fnUnit)) {
                $parent.show();
                this.inPanel = new Brightics.VA.Core.Editors.Sheet.Panels.BluffPanel($in, {label: 'No Inputs'});
            } else {
                $parent.hide();
            }
        }
    };

    FnUnitViewer.prototype.createOutPanel = function ($parent, options) {
        var $out = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-outdata-fncenter');

        if (FnUnitUtils.hasOutput(options.fnUnit)) {
            $parent.show();
            var pages = this.createOutPages(options);

            options.pages = pages;

            this.outViewerTab = new Brightics.VA.Core.Tools.Tab($out, options);
        } else {
            if (FnUnitUtils.isBluffNode(options.fnUnit)) {
                $parent.show();
                this.outPanel = new Brightics.VA.Core.Editors.Sheet.Panels.BluffPanel($out, {label: 'No Outputs'});
            } else {
                $parent.hide();
            }
        }
    };

    FnUnitViewer.prototype.render = function (fnUnit) {
        if (this._alreadyRendered(fnUnit)) return;
        var _this = this;

        this.destroy();

        this.fnUnit = fnUnit;
        var mid = fnUnit.parent().mid;
        var propDataProxy, inDataProxy, outDataProxy;
        var $propContainer = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-fn-fncenter');
        var $inContainer = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-indata-fncenter');
        var $outContainer = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-outdata-fncenter');

        if (!propDataProxy) propDataProxy = new Brightics.VA.Core.Editors.Sheet.DataProxy($propContainer, mid);
        if (!inDataProxy) inDataProxy = new Brightics.VA.Core.Editors.Sheet.DataProxy($inContainer, mid);
        if (!outDataProxy) outDataProxy = new Brightics.VA.Core.Editors.Sheet.DataProxy($outContainer, mid);
        propDataProxy.reset();
        inDataProxy.reset();
        outDataProxy.reset();

        this.propertiesPanel = this.options.panelFactory.createPropertiesPanel($propContainer, {
            width: '100%',
            height: '100%',
            fnUnit: fnUnit,
            dataProxy: propDataProxy
        });

        var inOptions = {
            width: '100%',
            height: '100%',
            fnUnit: fnUnit,
            resizable: true,
            dataProxy: inDataProxy
        };

        var outOptions = {
            width: '100%',
            height: '100%',
            fnUnit: fnUnit,
            resizable: true,
            dataProxy: outDataProxy
        };

        this.propertiesPanel.$mainControl.bind('callFunction', function (event, eventData) {
            var fid = eventData;
            if (fid && fid !== _this.propertiesPanel.options.fnUnit.fid) return;

            if (_this.outPanel) {
                _this.outPanel.destroy();
                _this.outPanel = null;
            }
            var $outContainer = _this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-outdata-fncenter');
            $outContainer.empty();
            _this.outPanel = _this.createOutPanel($outContainer, outOptions);
        });

        this.inPanel = this.createInPanel($inContainer, inOptions);
        this.outPanel = this.createOutPanel($outContainer, outOptions);

        this.bindEventHandlers();
        this.updatePanelWidth();

        this._status = 'rendered';
    };

    FnUnitViewer.prototype.bindEventHandlers = function () {
        var _this = this;
        var $inDataPanel = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-indata-fncenter'),
            $outDataPanel = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-outdata-fncenter');

        $inDataPanel.on('sizeChange', function () {
            if ($outDataPanel && $outDataPanel.css('display') === 'none') $outDataPanel.show();
            else $outDataPanel.hide();

            _this.updatePanelWidth();
        });
        $outDataPanel.on('sizeChange', function (panelType) {
            if ($inDataPanel && $inDataPanel.css('display') === 'none') $inDataPanel.show();
            else $inDataPanel.hide();

            _this.updatePanelWidth();
        });
    };

    FnUnitViewer.prototype.updatePanelWidth = function () {
        var fixedWidth = 0;
        var $fixedPanels = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-fixed-width');
        $fixedPanels.each(function () {
            if ($(this).css('display') !== 'none') {
                fixedWidth += $(this).width();
            }
        });

        var flexPanelCount = 0;
        var $flexPanels = this.$mainControl.children('.brtc-va-editors-sheet-fnunitviewer-flex-width');
        $flexPanels.each(function () {
            if ($(this).css('display') !== 'none') {
                flexPanelCount++;
            }
        });
        $flexPanels.each(function () {
            if ($(this).css('display') !== 'none') {
                $(this).css('width', 'calc((100% - ' + (fixedWidth + 2) + 'px) / ' + flexPanelCount + ')');
            }
        });

        if (flexPanelCount == 2) {
            if (this.inPanel) this.inPanel.adjustMaximize(false);
            if (this.outPanel) this.outPanel.adjustMaximize(false);
        }

        this.adjustHeader($flexPanels);
        // if (this.inPanel) this.inPanel.adjustHeader();
        // if (this.outPanel) this.outPanel.adjustHeader();

        $(window).trigger('resize');
    };

    FnUnitViewer.prototype.adjustHeader = function ($panels) {
        $panels.each(function () {
            var $panel = $(this);
            if ($panel.children().length === 0) return;

            //임시....Toolbar의 위치를 보고 판단할 수 밖에 없음...
            var $toolBar = $panel.find('.brtc-va-editors-sheet-panels-datapanel-toolbar');
            if ($toolBar.length === 0) return;
            var $workSheetSelector = $panel.find('.brtc-va-editors-sheet-worksheet-selector');
            var $context = $panel.find('.brtc-va-editors-sheet-panels-basepanel-header-context-menu-open');
            var $title = $panel.find('.brtc-va-editors-sheet-panels-basepanel-header-title');

            var toolBarPosition = $toolBar.position();
            var width = $title.width();

            // top이 0 이면 접히지 않았을 경우
            if (toolBarPosition.top === 0) {
                width = $panel.width() - ($workSheetSelector.width() + $toolBar.width());
            } else {
                width = $panel.width() - ($workSheetSelector.width() + $context.width());
            }

            $title.width(width);
        });
    };

    FnUnitViewer.prototype.refresh = function () {
        if (this.propertiesPanel) {
            this.propertiesPanel.refresh();
        }
    };

    FnUnitViewer.prototype.getPreviousFnUnit = function (fnUnit) {
        var fnUnits = [];
        var model = fnUnit.parent();
        var fids = model.getPrevious(fnUnit.fid);

        _.forEach(fids, function (fid) {
            fnUnits.push(model.getFnUnitById(fid));
        });
        return fnUnits;
    };

    Brightics.VA.Core.Editors.Sheet.FnUnitViewer = FnUnitViewer;

    function DataProxy(parentId, mid) {
        this.parentId = parentId;
        this.mid = mid;
        this.requested = {};
        this.retrieveParent();
        this.createControls();
    }

    DataProxy.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    DataProxy.prototype.createControls = function () {
        this.$parent.append($('' +
            '<div class="brtc-va-progress">' +
            '   <div>' +
            '       <span class="brtc-va-progress-loading"></span>' +
            '       <p class="brtc-va-progress-loading-label">Fetching rows ...</p>' +
            '   </div>' +
            '</div>'
        ));
    };

    DataProxy.prototype.requestPageData = function (table, doneCallback, failCallback, pageNum, pageSize) {
        var _this = this;
        if (!this.requested[table]) this.requested[table] = [];
        this.requested[table].push({
            doneCallback: doneCallback,
            failCallback: failCallback
        });
        this._showProgress();
        var offset = (pageNum - 1) * pageSize;
        var limit = pageSize;
        Brightics.VA.Core.DataQueryTemplate.queryData(_this.mid, table, offset, limit, function (data, tableId) {
            if (_this.requested[tableId]) _this.requested[tableId].shift().doneCallback(data, tableId);

            _this._done(tableId);
        }, function (data, tableId, err) {
            if (failCallback) {
                if (_this.requested[tableId]) _this.requested[tableId].shift().failCallback(data);
            }
            _this._done(tableId);
        });
    };

    DataProxy.prototype.requestData = function (table, doneCallback, failCallback, length, force) {
        var _this = this;
        if (!this.requested[table]) this.requested[table] = [];
        this.requested[table].push({
            doneCallback: doneCallback,
            failCallback: failCallback
        });

        this._showProgress();
        if (length) {
            Brightics.VA.Core.DataQueryTemplate.fetchMore(_this.mid, table, length, function (data, tableId) {
                if (_this.requested[tableId]) _this.requested[tableId].shift().doneCallback(data);

                _this._done(tableId);
            }, function (data, tableId, err) {
                if (failCallback) {
                    if (_this.requested[tableId]) _this.requested[tableId].shift().failCallback(data);
                }
                _this._done(tableId);
            });
        } else {
            Brightics.VA.Core.DataQueryTemplate.queryTable(_this.mid, table, function (data, tableId) {
                if (_this.requested[tableId]) _this.requested[tableId].shift().doneCallback(data);

                _this._done(tableId);
            }, function (data, tableId, err) {
                if (failCallback) {
                    if (_this.requested[tableId]) _this.requested[tableId].shift().failCallback(data);
                }
                _this._done(tableId);
            }, force);
        }
    };

    //kill me
    DataProxy.prototype.requestDataForEDA = function (table, doneCallback, failCallback, length, force) {
        var _this = this;
        if (!this.requested[table]) this.requested[table] = [];
        this.requested[table].push({
            doneCallback: doneCallback,
            failCallback: failCallback
        });

        this._showProgress();
        if (length) {
            Brightics.VA.Core.DataQueryTemplate.fetchMore(_this.mid, table, length, function (data, tableId) {
                if (_this.requested[tableId]) _this.requested[tableId].shift().doneCallback(data);

                _this._done(tableId);
            }, function (data, tableId, err) {
                var rt = {
                    "type": "table",
                    "data": [],
                    "bytes": 1,
                    "count": 0,
                    "columns": [{
                        "name": "continuous_feature_idx",
                        "type": "number",
                        "internalType": "Integer"
                    }, {
                        "name": "continuous_feature_num",
                        "type": "number",
                        "internalType": "Integer"
                    }, {
                        "name": "category_feature_idx",
                        "type": "number",
                        "internalType": "Integer"
                    }, {
                        "name": "category_feature_num",
                        "type": "number",
                        "internalType": "Integer"
                    }, {"name": "label_idx", "type": "number", "internalType": "Integer"}]
                }
                if (_this.requested[tableId]) _this.requested[tableId].shift().doneCallback(rt);
                _this._done(tableId);
            });
        } else {
            Brightics.VA.Core.DataQueryTemplate.queryTable(_this.mid, table, function (data, tableId) {
                if (_this.requested[tableId]) _this.requested[tableId].shift().doneCallback(data);

                _this._done(tableId);
            }, function (data, tableId, err) {
                var rt = {
                    "type": "table",
                    "data": [],
                    "bytes": 1,
                    "count": 0,
                    "columns": [{
                        "name": "continuous_feature_idx",
                        "type": "number",
                        "internalType": "Integer"
                    }, {
                        "name": "continuous_feature_num",
                        "type": "number",
                        "internalType": "Integer"
                    }, {
                        "name": "category_feature_idx",
                        "type": "number",
                        "internalType": "Integer"
                    }, {
                        "name": "category_feature_num",
                        "type": "number",
                        "internalType": "Integer"
                    }, {"name": "label_idx", "type": "number", "internalType": "Integer"}]
                }
                if (_this.requested[tableId]) _this.requested[tableId].shift().doneCallback(rt);
                _this._done(tableId);
            }, force);
        }
    };

    DataProxy.prototype.requestSchema = function (table, doneCallback, failCallback) {
        this.requestData(table, doneCallback, failCallback, false);
    };

    DataProxy.prototype.requestFetchMore = function (table, length, doneCallback, failCallback) {
        this.requestData(table, doneCallback, failCallback, length);
    };

    DataProxy.prototype.requestDataForce = function (table, doneCallback, failCallback) {
        this.requestData(table, doneCallback, failCallback, false, true);
    };

    DataProxy.prototype._done = function (table) {
        if (!this.requested[table] || this.requested[table].length === 0) delete this.requested[table];
        if (Object.keys(this.requested).length === 0) this._hideProgress();
    };

    DataProxy.prototype.reset = function () {
        this._hideProgress();
        this.requested = {};
    };

    DataProxy.prototype._hideProgress = function () {
        this.$parent.find('.brtc-va-progress').hide();
    };

    DataProxy.prototype._showProgress = function () {
        this.$parent.find('.brtc-va-progress').show();
    };

    Brightics.VA.Core.Editors.Sheet.DataProxy = DataProxy;

}).call(this);
/**
 * Created by jmk09.jung on 2016-02-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var FnUnitUtils = brtc_require('FnUnitUtils');

    function PanelFactory() {
    }

    PanelFactory.prototype.createInDataPanel = function ($parent, options) {
        if (options.fnUnit[IN_DATA]) {
            options.title = options.title || 'In';
            options.resizable = options.fnUnit[OUT_DATA] ? true : false;
            return new Brightics.VA.Core.Editors.Sheet.Panels.DataPanel($parent, options);
        }
    };

    PanelFactory.prototype.createOutDataPanel = function ($parent, options) {
        if (options.fnUnit[OUT_DATA]) {
            options.title = options.title || 'Out';
            options.resizable = options.fnUnit[IN_DATA] ? true : false;
            return new Brightics.VA.Core.Editors.Sheet.Panels.DataPanel($parent, options);
        }
    };

    PanelFactory.prototype.createPropertiesPanel = function ($parent, options) {
        if (options.fnUnit && options.fnUnit.func) {
            var implementationClazz = options.fnUnit.parent().type;
            options.title = options.title || options.fnUnit.display.label;
            var clazz = typeof Brightics.VA.Core.Interface.Functions[implementationClazz][options.fnUnit.func] === 'undefined' ? Brightics.VA.Core.Interface.Functions[implementationClazz].unknownFunction.propertiesPanel : Brightics.VA.Core.Interface.Functions[implementationClazz][options.fnUnit.func].propertiesPanel;
            return new clazz($parent, options);
        }
    };

    PanelFactory.prototype.create = function ($parent, options) {
        var panelType = options.type;
        var panel;

        if (!this[panelType]) {
            panel = this.note();
        } else {
            if (options.panelType === 'in') options.resizable = FnUnitUtils.hasOutput(options.fnUnit) ? true : false;
            if (options.panelType === 'out') options.resizable = FnUnitUtils.hasInput(options.fnUnit) ? true : false;

            panel = this[panelType]($parent, options);
        }
        return panel;
    };
    PanelFactory.prototype.inData = function ($parent, options) {
        if (options.fnUnit[IN_DATA]) {
            options.title = options.title || 'In';
            options.resizable = options.fnUnit[OUT_DATA] ? true : false;
            return new Brightics.VA.Core.Editors.Sheet.Panels.DataPanel($parent, options);
        }
    };
    PanelFactory.prototype.outData = function ($parent, options) {
        if (options.fnUnit[OUT_DATA]) {
            options.title = options.title || 'Out';
            options.resizable = options.fnUnit[IN_DATA] ? true : false;
            return new Brightics.VA.Core.Editors.Sheet.Panels.DataPanel($parent, options);
        }
    };
    PanelFactory.prototype.table = function ($parent, options) {
        var table = FnUnitUtils.getTable(options.fnUnit, options.panelType);
        options.title = options.title || (options.panelType === 'in') ? 'In' : 'Out';
        var DataPanel = FnUnitUtils.getDataPanel(options.fnUnit, options.panelType);

        return new DataPanel($parent, options);
    };
    PanelFactory.prototype.model = function ($parent, options) {
        options.title = options.title || (options.panelType === 'in') ? 'In' : 'Out';
        return new Brightics.VA.Core.Editors.Sheet.Panels.ModelPanel($parent, options);
    };
    PanelFactory.prototype.html = function ($parent, options) {
        return new Brightics.VA.Core.Editors.Sheet.Panels.HtmlPanel($parent, options);
    };
    PanelFactory.prototype.md = function ($parent, options) {
    };
    PanelFactory.prototype.image = function ($parent, options) {
        options.title = options.title || (options.panelType === 'in') ? 'In' : 'Out';
        return new Brightics.VA.Core.Editors.Sheet.Panels.ImagePanel($parent, options);
    };
    PanelFactory.prototype.note = function ($parent, options) {
    };

    Brightics.VA.Core.Editors.Sheet.PanelFactory = PanelFactory;
}).call(this);

/**
 * Created by sungjin1.kim on 2016-01-30.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SheetEditorPage(parentId, options) {
        Brightics.VA.Core.Editors.EditorPage.call(this, parentId, options);
        this.registerCommandEventListener();
    }

    SheetEditorPage.prototype = Object.create(Brightics.VA.Core.Editors.EditorPage.prototype);
    SheetEditorPage.prototype.constructor = SheetEditorPage;

    SheetEditorPage.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-editors-sheet-sheeteditorpage">' +
            '   <div class="brtc-va-editors-sheet-sheeteditorpage-description">' +
            '       <i class="fa fa-info fa-5x"></i><br>' +
            '       There is no selected function for this page.<br>Please select a function.' +
            '   </div>' +
            '   <div class="brtc-va-editors-sheet-sheeteditorpage-fnunitviewer"></div>' +
            '</div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);

        this.$description = this.$mainControl.find('.brtc-va-editors-sheet-sheeteditorpage-description');
        this.$fnUnitViewer = this.$mainControl.find('.brtc-va-editors-sheet-sheeteditorpage-fnunitviewer');

        this.showDescription(false);
        this.createFnUnitViewer(this.$fnUnitViewer);
    };

    SheetEditorPage.prototype.createFnUnitViewer = function ($parent) {
        this.fnUnitViewer = new Brightics.VA.Core.Editors.Sheet.FnUnitViewer($parent, {
            width: '100%',
            height: '100%',
            panelFactory: this.options.panelFactory
        });
    };

    SheetEditorPage.prototype.registerCommandEventListener = function () {
        var modelEditorRef = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);
        modelEditorRef.addCommandListener(function (command) {
            // TODO
        });
    };

    SheetEditorPage.prototype.render = function (fnUnits) {
        var _this = this;
        if (fnUnits && fnUnits.length > 0) {
            if (fnUnits.length == 1) {
                this.showDescription(false);
                this.fnUnitViewer.render(fnUnits[0]);
            } else {
                this.$description.empty();
                this.$description.append('Do you want to ');
                var $removeButton = $('<input value="Delete" type="button" style="margin-left: 6px; margin-right: 6px"/>');
                this.$description.append($removeButton);
                this.$description.append('selected ' + fnUnits.length + ' functions ?');
                $removeButton.jqxButton({
                    theme: Brightics.VA.Env.Theme,
                    width: 80, height: 30
                });
                $removeButton.on('click', function () {
                    var modelEditorRef = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
                    var modelContents = modelEditorRef.options.editorInput.getContents();
                    var command = new Brightics.VA.Core.CompoundCommand(this, {});
                    // Search Connected Links with Removing FnUnit
                    var linkIds = [], i, j;
                    for (i in fnUnits) {
                        var links = modelContents.getConnectedLinkUnits(fnUnits[i].fid);
                        for (j in links) {
                            if (linkIds.indexOf(links[j].kid) < 0) {
                                linkIds.push(links[j].kid);
                            }
                        }
                    }
                    // Remove LinkUnit
                    for (i in linkIds) {
                        command.add(new Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand(this, {kid: linkIds[i]}));
                    }
                    // Remove FnUnit
                    for (i in fnUnits) {
                        command.add(new Brightics.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand(this, {fid: fnUnits[i].fid}));

                        // Unbind Global Parameter 
                        for (var paramKey in fnUnits[i].param) {
                            var variable = fnUnits[i].parent().getVariable(fnUnits[i].fid, paramKey);
                            if (variable) {
                                command.add(new Brightics.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(this, {
                                    fid: fnUnits[i].fid,
                                    paramKey: paramKey,
                                    variable: variable
                                }));
                            }
                        }
                    }
                    modelEditorRef.getCommandManager().execute(command);
                });
                this.showDescription(true);
            }
        } else {
            this.fnUnitViewer.destroy();
            this.$description.empty();
            this.$description.append('<i class="fa fa-info fa-5x"></i><br>There is no selected function for this page.<br>Please select a function.');
            this.showDescription(true);
        }
    };

    SheetEditorPage.prototype.showDescription = function (visible) {
        if (visible) {
            this.$description.css('display', 'block');
            this.$fnUnitViewer.css('display', 'none');
        } else {
            this.$description.css('display', 'none');
            this.$fnUnitViewer.css('display', 'block');
        }
    };

    SheetEditorPage.prototype.destroy = function () {
        this.fnUnitViewer.destroy();
    };

    SheetEditorPage.prototype.getFnUnitViewer = function () {
        return this.fnUnitViewer;
    };

    SheetEditorPage.prototype.onActivated = function () {
        return this.getFnUnitViewer().refresh();
    };

    Brightics.VA.Core.Editors.Sheet.SheetEditorPage = SheetEditorPage;

}).call(this);
/**
 * Created by jhoon80.park on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;

    var Brightics = root.Brightics;

    function PropertyControl(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
    }

    PropertyControl.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    PropertyControl.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-editors-sheet-controls-propertycontrol">' +
            '   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>' +
            '   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents">' +
            '</div>');

    this.$labelArea = this.$mainControl.find('.brtc-va-editors-sheet-controls-propertycontrol-label');
    this.$contentsArea = this.$mainControl.find('.brtc-va-editors-sheet-controls-propertycontrol-contents');
    this.setLabel(this.$labelArea);

        this.$mainControl.jqxExpander(
            {
                theme: Brightics.VA.Env.Theme,
                arrowPosition: "left"
            });
        this.$parent.append(this.$mainControl);

    };

    PropertyControl.prototype.setLabel = function ($parents) {
        $parents.text(this.options.label);
    };


  root.Brightics.VA.Core.Editors.Sheet.Controls.PropertyControl = PropertyControl;

}).call(this);

/**
 * Created by ng1123.kim on 2016-02-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var FnUnitUtils = brtc_require('FnUnitUtils');

    const PANEL_TYPE_IN = 'in';
    const PANEL_TYPE_OUT = 'out';
    const DATA_POST_FIX = 'Data';
    var Logger = new Brightics.VA.Log('DataWorksheet');

    /**
     * options: {
     *      panel: [],
     *      layout: {},
     *      data: {},
     * }
     *
     * dataInfo: {
     *      mid: {String},
     *      fid: {String},
     *      fnUnitLabel: {String}
     * }
     * @param parentId
     * @param options
     * @constructor
     */
    function DataWorksheet(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.controls = {};

        this.retrieveParent();
        this._init();
        this._setDataInfo();
        this.renderDataWorksheet();
    }

    DataWorksheet.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    DataWorksheet.prototype.renderDataWorksheet = function () {
        var _this = this;
        this._prepareTables();
        this._queryTables(function () {
            _this.createControls();
        });
    };


    DataWorksheet.prototype._init = function () {
        var wsOption = this.getDataWorksheetOption('partial');

        this.options.style = {
            width: '100%',
            height: '100%'
        };
        this.options.worksheet = {
            panel: wsOption.panel,
            layout: wsOption.layout
        };

        this.chartOptions = {};
    };

    DataWorksheet.prototype.getDataWorksheetOption = function (mode) {
        if (this.options.fnUnit.display.sheet
            && this.options.fnUnit.display.sheet[this.options.panelType]
            && this.options.fnUnit.display.sheet[this.options.panelType][mode]
            && this.options.fnUnit.display.sheet[this.options.panelType][mode][0]) {
            return this.options.fnUnit.display.sheet[this.options.panelType][mode][0];
        }
        return {'panel': [], 'layout': {}};
    };

    DataWorksheet.prototype._setDataInfo = function () {
        this.dataInfo = {
            mid: this.options.fnUnit.parent().mid,
            fid: this.options.fnUnit.fid,
            fnUnitLabel: this.options.fnUnit.display.label,
            panelType: this.options.panelType,
            tableList: FnUnitUtils.getTable(this.options.fnUnit, this.options.panelType)
        }
    };

    DataWorksheet.prototype._updateDataInfoTableList = function () {
        this.dataInfo.tableList = FnUnitUtils.getTable(this.options.fnUnit, this.options.panelType);
        // this.dataInfo.tableList = this.options.fnUnit[this.options.panelType + DATA_POST_FIX];
    };

    DataWorksheet.prototype.getDataTable = function () {
        return FnUnitUtils.getTable(this.options.fnUnit, this.options.panelType);
    };

    DataWorksheet.prototype._prepareTables = function () {

        this._updateDataInfoTableList();
        var tableList = this.getDataTable();
        this._tableMap = {};

        if (this.options.worksheet.panel.length === 0) {
            this.options.worksheet.panel.push({
                id: 'default-' + Date.now(),
                chartOption: {
                    chart: {
                        type: 'table'
                    }
                }
            });
        } else if (this.options.worksheet.panel.length === 1 && this.options.selectedChart !== 'table') {
            this.options.worksheet.panel[0].chartOption.chart.type = this.options.selectedChart;
        }

        for (var panelIdx in this.options.worksheet.panel) {
            var panel = this.options.worksheet.panel[panelIdx];
            var defaultRegistry = Brightics.Chart.Registry[panel.chartOption.chart.type] || Brightics.Chart.Registry['table'];
            var opt = $.extend(true, {}, defaultRegistry.DefaultOptions, panel.chartOption);
            opt.colorSet = panel.chartOption.colorSet || defaultRegistry.DefaultOptions.colorSet;
            panel.chartOption = opt;
            var tableIndexes = this.options.worksheet.panel[panelIdx].tableIndexes || [0];
            for (var index = 0; index < tableIndexes.length; index++) {
                var tableId = tableList[tableIndexes[index]] || tableList[0];
                if (typeof tableId === 'undefined') continue;
                this._tableMap[tableId] = this._tableMap[tableId] || {};
            }
        }
    };


    DataWorksheet.prototype._queryTables = function (doneCallback) {
        var _this = this;
        var _finishedJobCount = 0;
        var tableList = Object.keys(this._tableMap);

        if (tableList.length === 0) {
            var callBack = this._getCallBackFunction('createRecommendedChartSheet');
            if (callBack) callBack();
        } else {
            for (var i = 0; i < tableList.length; i++) {
                var table = tableList[i];
                var tableObj = this._tableMap[table] || {};
                var _page = tableObj.page || 1;
                var _pageSize = tableObj.pageSize || Brightics.VA.SettingStorage.getValue('editor.datapanel.defaultrowcount') * 1;
                this.options.dataProxy.requestPageData(tableList[i], function (data, tableId) {

                    _this._tableMap[tableId] = data;
                    _this._tableMap[tableId].page = _page;
                    _this._tableMap[tableId].pageSize = _pageSize;
                    _this._tableMap[tableId].count = data.count;
                    _this._tableMap[tableId].offset = (_page - 1) * _pageSize;


                    _finishedJobCount = _finishedJobCount + 1;
                    if (tableList.length === _finishedJobCount) {
                        doneCallback();
                    }
                }, function (result) {
                    _finishedJobCount = _finishedJobCount + 1;
                    if (tableList.length !== _finishedJobCount) return;
                    if (_this.options.worksheet.panel.length <= 1 && result && result.columns && result.columns.length === 0) {
                        var callBack = _this._getCallBackFunction('createRecommendedChartSheet');
                        if (callBack) callBack();
                    } else {
                        doneCallback();
                    }
                }, _page, _pageSize);
            }
        }
    };


    DataWorksheet.prototype.createControls = function () {
        var _this = this;
        this.$parent.empty();

        this.$mainControl = $('<div class="brtc-va-editors-sheet-controls-dataworksheet"></div>');
        this.$mainControl.css({
            width: '100%',
            height: '100%'
        });
        this.$parent.append(this.$mainControl);

        // this.options.worksheet.$panelSelectionGroup = _this.$mainControl.closest('.brtc-va-editors-sheet-fnunitviewer');
        this.options.worksheet.onAddChart = this.onAddChart.bind(this);
        this.options.worksheet.onRemoveChart = this.onRemoveChart.bind(this);
        this.options.worksheet.onChangeLayout = this.onChangeLayout.bind(this);
        this.options.worksheet.onChangeChart = this.onChangeChart.bind(this);
        this.options.worksheet.onSelectChart = this.onSelectChart.bind(this);

        for (var i in this.options.worksheet.panel) {
            this.options.worksheet.panel[i].chartOption.source = this._getPanelSource(this.options.worksheet.panel[i]);
            $.extend(true, this.options.worksheet.panel[i].chartOption,{
                plotOptions:{
                    map: {
                        geoData: {
                            url: function(mapName){
                                //if( typeof mapName =='undefined' || mapName == '')
                                return 'api/va/v2/map/' + mapName
                            }
                        }
                    }
                }
            });
            this.options.worksheet.panel[i].chartOption.guide = this._getGuideOption();
            this.options.worksheet.panel[i].dataSource = this._setPanelDataSource(i);
        }

        this.options.component = {
            right: {
                chartOption: true
            }
        };

        this.options.worksheet.toolbar = {
            menu: {
                multichart: {
                    title: 'MultiChart',
                    click: function () {
                        var panel = this;
                        _this._handleOpenMultiChart(panel);
                    }
                },
                report: {
                    title: 'Add to Report',
                    click: function () {
                        var panel = this;
                        _this._handleAddToReport(panel);
                    }
                },
                setting: {
                    click: function () {
                        var panel = this;
                        _this._handleChartSettings(panel);
                    }
                },
                duplicate: {},
                details: {},
                close: {}
            }
        };

        this.$mainControl.bchartsAdonis(this.options);

        this.bindEventHandlers();

        this._initDataWorkSheet();
    };

    DataWorksheet.prototype._getGuideOption = function () {
        var callback = function () {
            console.log('clicked validation Message');
        };

        var guide = {
            message: 'Set data options using Chart Setting Button.',
            onClick: callback    
        };
        return guide;
    };

    DataWorksheet.prototype._handleChartSettings = function (panel) {
        this._openChartSettingsDialog();
        this.onSelectChart(panel.getOptions());
    };

    DataWorksheet.prototype._attachChartOptionPanelToDialog = function ($chartOptionPanel) {
        $chartOptionPanel.data('original-parent', $chartOptionPanel.parent());
        $chartOptionPanel.detach();

        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');
        $dialog.find('.brtc-va-dialog-contents').append($chartOptionPanel);
    };

    DataWorksheet.prototype._detachChartOptionPanel = function () {
        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');
        $dialog.find('.bcharts-option-panel').each(function (index, element) {
            var $chartOptionPanel = $(element);
            var $parent = $chartOptionPanel.data('original-parent');
            $chartOptionPanel.detach().appendTo($parent);
        });
    };

    DataWorksheet.prototype._openChartSettingsDialog = function () {
        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');

        var parentOffset = this.$mainControl.offset(),
            parentWidth = this.$mainControl.width(),
            studioHeaderWidth = 50,
            editorHeaderWidth = 50,
            splitterHeight = 5,
            footerHeight = 30,
            windowWidth = $(window).width(),
            windowHeight = $(window).height();

        var getRightPosition = function (parentOffset, parentWidth) {
            return (windowWidth < (parentWidth + parentOffset.left)) ? 0 : (windowWidth - (parentWidth + parentOffset.left));
        };

        if ($dialog.height() > ( this.$mainControl.height() + footerHeight)) {
            $dialog.css({
                left: '',
                right: getRightPosition(parentOffset, parentWidth),
                top: '',
                bottom: 0
            });
        } else {
            $dialog.css({
                left: '',
                right: getRightPosition(parentOffset, parentWidth),
                top: studioHeaderWidth + editorHeaderWidth + splitterHeight
                + this.$mainControl.parents('.brtc-va-editors-modeleditor-sheet').siblings('.brtc-va-editors-modeleditor-diagram').height(),
                bottom: ''
            });
        }

        $dialog.show();
    };

    DataWorksheet.prototype.arrange = function (direction) {
        if (this.$mainControl) {
            this.$mainControl.bchartsAdonis('layout', direction);
        }
    };

    DataWorksheet.prototype.onAddChart = function (panelOption, layout) {
        var existPanels = $.grep(this.options.worksheet.panel, function (element, index) {
            return element.id == panelOption.id;
        });
        if (existPanels.length === 0) {
            var compoundCommand = new Brightics.VA.Core.CompoundCommand(this, {
                id: 'brightics.va.editors.diagram.commands.addchartcommand'
            });
            compoundCommand.add(this.createNewChartCommand(panelOption));
            compoundCommand.add(this.createSetDataWorksheetLayoutCommand(layout));

            this.executeCommand(compoundCommand);
        }
    };

    DataWorksheet.prototype.onRemoveChart = function (panelOption, layout) {
        var existPanels = $.grep(this.options.worksheet.panel, function (element, index) {
            return element.id == panelOption.id;
        });
        if (existPanels.length > 0) {
            var compoundCommand = new Brightics.VA.Core.CompoundCommand(this, {
                id: 'brightics.va.editors.diagram.commands.removechartcommand'
            });
            compoundCommand.add(this.createRemoveChartCommand(panelOption));
            compoundCommand.add(this.createSetDataWorksheetLayoutCommand(layout));

            this.executeCommand(compoundCommand);
        }
    };

    DataWorksheet.prototype.onChangeLayout = function (layout) {
        if (JSON.stringify(this.options.worksheet.layout) !== JSON.stringify(layout)) {
            this.executeCommand(this.createSetDataWorksheetLayoutCommand(layout));
        }
    };

    DataWorksheet.prototype._assignArray = function (targetObject, sourceObject) {
        for (var key in sourceObject) {
            if ($.isPlainObject(sourceObject[key])) {
                this._assignArray(targetObject[key], sourceObject[key]);
            } else if ($.isArray(sourceObject[key])) {
                targetObject[key] = $.extend(true, [], sourceObject[key]);
            }
        }
    };

    DataWorksheet.prototype._mergeArraySafely = function (targetObject, sourceObject) {
        var merged = $.extend(true, {}, targetObject, sourceObject);
        this._assignArray(merged, sourceObject);
        return merged;
    };

    DataWorksheet.prototype.onChangeChart = function (panelOption, changedOption) {
        var original = this.chartOptions[panelOption.id];
        var changed = this._mergeArraySafely(this.chartOptions[panelOption.id], changedOption);
        if (JSON.stringify(original) !== JSON.stringify(changed)) {
            var changing = $.extend(true, {}, changedOption);
            delete changing.source;

            var command = new Brightics.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand(this, {
                panelOption: panelOption,
                ref: {
                    chartOption: changing
                }
            });
            this.executeCommand(command);
        }
    };

    DataWorksheet.prototype.onSelectChart = function (panelOptions) {
        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');
        if ($dialog.is(':visible')) {
            this.$chartOptionPanel = this.$mainControl.find('.bcharts-option-panel');
            if (this.$chartOptionPanel.length > 0) {
                this._detachChartOptionPanel();
                this._attachChartOptionPanelToDialog(this.$chartOptionPanel);
            }
        }

        var tableIndex = 0;
        this._selectedPanelOptions = panelOptions;
        if (panelOptions && panelOptions.tableIndexes && panelOptions.tableIndexes[0]) tableIndex = panelOptions.tableIndexes[0];

        var pageInfo = this.getPaginationInfoByTableIndex(tableIndex);
        this.options.callback.setPaginationInfo(pageInfo);

        if ($($('.bo-control-container-contents')[0]).css('display') == 'block') {
            $('#complexTab').css({'display': 'block'});
        } else {
            $('#complexTab').css({'display': 'none'});
        }
    };

    DataWorksheet.prototype.getPaginationInfoByTableIndex = function (tableIndex) {
        var tableId = this.dataInfo.tableList[tableIndex];
        var tableObj = this._tableMap[tableId] || {};
        if (this._tableMap[tableId] && this._tableMap[tableId].data) {
            tableObj.page = tableObj.page || 1;
            tableObj.pageSize = tableObj.pageSize || Brightics.VA.SettingStorage.getValue('editor.datapanel.defaultrowcount') * 1;
            tableObj.totalCount = tableObj.count;
            tableObj.tableId = tableId;
        }
        return tableObj;
    };

    DataWorksheet.prototype.updataPageInfo = function (tableId, pageInfo) {
        var tableObj = this._tableMap[tableId] || {};
        tableObj.page = pageInfo.page;
        tableObj.pageSize = pageInfo.pageSize;
        tableObj.offset = (tableObj.page - 1) * pageInfo.pageSize;
    };

    DataWorksheet.prototype.bindEventHandlers = function () {
        var _this = this;
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        if (modelEditor) {
            this.commandListener = function (command) {
                if (command.event.source.dataInfo
                    && command.event.source.dataInfo.fid === _this.dataInfo.fid
                    && command.event.source.dataInfo.panelType === _this.dataInfo.panelType
                    && !(command.event.source instanceof Brightics.VA.Core.Editors.Sheet.Controls.BigDataWorksheet)) {
                    if (command.event.type == 'REDO') _this.redo(command);
                    else if (command.event.type == 'UNDO') _this.undo(command);
                    else if (command.event.type == 'EXECUTE') _this.execute(command);
                }
            };
            modelEditor.addCommandListener(this.commandListener);
        }
    };

    DataWorksheet.prototype.unbindEventHandlers = function () {
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        if (modelEditor && this.commandListener) {
            modelEditor.removeCommandListener(this.commandListener);
            this.commandListener = null;
        }
    };

    DataWorksheet.prototype.redo = function (command) {
        if (command instanceof Brightics.VA.Core.CompoundCommand) {
            if (command.getId() === 'brightics.va.editors.diagram.commands.addchartcommand') this.onNewChartCommand(command);
            else if (command.getId() === 'brightics.va.editors.diagram.commands.removechartcommand') this.onRemoveChartCommand(command);
            else for (var i in command.commandList) this.redo(command.commandList[i]);
        }
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewChartCommand) this.onNewChartCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveChartCommand) this.onRemoveChartCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand) this.onSetDataWorksheetLayoutCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand) this.onSetContentsPanelCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand) this._onChangeDataSourceCommand(command);
    };

    DataWorksheet.prototype.undo = function (command) {
        if (command instanceof Brightics.VA.Core.CompoundCommand) {
            if (command.getId() === 'brightics.va.editors.diagram.commands.addchartcommand') this.onNewChartCommand(command);
            else if (command.getId() === 'brightics.va.editors.diagram.commands.removechartcommand') this.onRemoveChartCommand(command);
            else for (var i = command.commandList.length - 1; i >= 0; i--) this.undo(command.commandList[i]);
        }
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewChartCommand) this.onNewChartCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveChartCommand) this.onRemoveChartCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand) this.onSetDataWorksheetLayoutCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand) this.onSetContentsPanelCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand) this._onChangeDataSourceCommand(command);
    };

    DataWorksheet.prototype.execute = function (command) {
        if (command instanceof Brightics.VA.Core.CompoundCommand) {
            if (command.getId() === 'brightics.va.editors.diagram.commands.addchartcommand') this.configureSheetLayout();
        }
    };

    DataWorksheet.prototype.onNewChartCommand = function (command) {
        if (command.event.type == 'REDO') {
            command.options.panelOption.chartOption.source = this._getPanelSource(command.options.panelOption);
            command.options.panelOption.dataSource = this._setPanelDataSource();
            this.$mainControl.bchartsAdonis('addChartPanel', command.options.panelOption);
            this.configureSheetLayout();
        } else {
            this.$mainControl.bchartsAdonis('removeChartPanel', command.options.panelOption.id);
        }
    };

    DataWorksheet.prototype.onRemoveChartCommand = function (command) {
        if (command.event.type == 'REDO') {
            this.$mainControl.bchartsAdonis('removeChartPanel', command.options.panelOption.id);
        } else {
            this.$mainControl.bchartsAdonis('addChartPanel', command.options.panelOption);
            this.configureSheetLayout();
        }
    };

    DataWorksheet.prototype.onSetDataWorksheetLayoutCommand = function (command) {
        this.$mainControl.bchartsAdonis('layout', command.options.layout);
    };

    DataWorksheet.prototype.configureSheetLayout = function () {
    };

    DataWorksheet.prototype.onSetContentsPanelCommand = function (command) {
        this.chartOptions[command.options.panelOption.id] = command.options.panelOption.chartOption;
        this.$mainControl.bchartsAdonis('setChartOptions', command.options.panelOption.id, command.options.panelOption.chartOption);
    };

    DataWorksheet.prototype.createNewChartCommand = function (panelOption) {
        var newChartCommand = new Brightics.VA.Core.Editors.Diagram.Commands.NewChartCommand(this, {
            panel: this.options.worksheet.panel,
            panelOption: panelOption
        });

        return newChartCommand;
    };

    DataWorksheet.prototype.createRemoveChartCommand = function (panelOption) {
        var removeChartCommand = new Brightics.VA.Core.Editors.Diagram.Commands.RemoveChartCommand(this, {
            panel: this.options.worksheet.panel,
            panelOption: panelOption
        });

        return removeChartCommand;
    };

    DataWorksheet.prototype.createSetDataWorksheetLayoutCommand = function (newLayout) {
        var setDataWorksheetLayoutCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand(this, {
            layout: this.options.worksheet.layout,
            newLayout: newLayout
        });

        return setDataWorksheetLayoutCommand;
    };

    DataWorksheet.prototype.executeCommand = function (command) {
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        modelEditor.getCommandManager().execute(command);
    };

    DataWorksheet.prototype._handleOpenMultiChart = function (panel) {
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        var param = {
            user: Brightics.VA.Env.Session.userId,
            pid: modelEditor.options.editorInput.getProjectId(),
            mid: this.dataInfo.mid,
            fid: this.dataInfo.fid,
            tid: this.dataInfo.tableList[this._getSelectedPanelTableIndex()],
            cid: panel.getOptions().id,
            ch: modelEditor.getConnectionKey()
        };
        var params = $.map(param, function (value, key) {
            return key + '=' + value;
        }).join('&');
        window.open('multichart?' + params, 'multiChart');
    };

    DataWorksheet.prototype._handleAddToReport = function (panel) {
        var _this = this;

        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
        var panelTitle = this.$mainControl.closest('.brtc-va-editors-sheet-panels-basepanel').find('.brtc-va-editors-sheet-panels-basepanel-header-title').text();
        modelEditor.getReportManager().addReportData({
            options: {
                id: panel.getOptions().id,
                chartOption: $.extend(true, {}, panel.getOptions().chartOption)
            },
            data: {
                mid: _this.dataInfo.mid,
                fid: _this.dataInfo.fid,
                table: _this.dataInfo.tableList[panel.options.tableIndexes || 0],
            },
            title: {
                fnUnitLabel: _this.dataInfo.fnUnitLabel,
                panelTitle: panelTitle
            }
        }).then(function (dataIndex) {
            modelEditor.notifyReportDataAdded();

            var fnUnit = modelEditor.options.editorInput.getContents().getFnUnitById(_this.dataInfo.fid);
            Brightics.VA.Core.Utils.ModelUtils.carvePersist(fnUnit, true);

            modelEditor.save();
        }, function (err) {
            modelEditor.notification('error', err);
        });

        if (Brightics.VA.Implementation.Visual) {
            var projectId = modelEditor.options.editorInput.getProjectId();
            var projectLabel = Studio.getResourceManager().getProject(projectId).getLabel();
            var visualModels = Studio.getResourceManager().getFilesByModelType(projectId, Brightics.VA.Implementation.Visual.Clazz);

            var modelLabel = modelEditor.options.editorInput.getLabel();
            var functionLabel = _this.dataInfo.fnUnitLabel;
            if (visualModels.length) {
                new Brightics.VA.Implementation.Visual.Dialogs.SelectVisualModelDialog(_this.$mainControl, {
                    projectId: projectId,
                    projectLabel: projectLabel,
                    visualModels: visualModels,
                    modelId: _this.dataInfo.mid,
                    tableId: _this.dataInfo.tableList[panel.options.tableIndexes || 0],
                    defaultDataSourceLabel: modelLabel + '-' + functionLabel + '-' + panelTitle,
                    close: function (dialogResult) {
                        if (dialogResult.OK) {
                            Brightics.VA.Implementation.Visual.Utils.ModelUtils.addChartContentToSelectedVisualModel({
                                resourceManager: Studio.getResourceManager(),
                                dataSourceLabel: (dialogResult.dataSourceLabel) ? (dialogResult.dataSourceLabel) : (modelLabel + '-' + functionLabel + '-' + panelTitle),
                                dataSourceTag: (dialogResult.dataSourceTag) ? (dialogResult.dataSourceTag) : (''),
                                selectedModels: dialogResult.selectedModels,
                                projectId: projectId,
                                modelId: _this.dataInfo.mid,
                                tableId: _this.dataInfo.tableList[panel.options.tableIndexes || 0],
                                chartOptions: $.extend(true, {}, panel.getOptions().chartOption),
                                columns: $.extend(true, [], Brightics.VA.Core.DataQueryTemplate.getSchema(_this.dataInfo.mid, _this.dataInfo.tableList[panel.options.tableIndexes || 0])),
                                changeLabel: dialogResult.changeLabel
                            });
                            var selectedReports = dialogResult.selectedModels;
                            // Studio.setChartContentAddedReport(selectedReports);
                            Studio.getInstance().setChartContentAddedReport(selectedReports);
                            var option = {
                                type: 'info',
                                isCancel: true,
                                contentText: 'Successfully Added To The Report.',
                                okLabel: 'Open Report',
                                cancelLabel: 'Close',
                                close: function (result) {
                                    if (result.OK) {
                                        for (var i in selectedReports) {
                                            var projectId = selectedReports[i].getProjectId();
                                            var fileId = selectedReports[i].getFileId();
                                            var fileInput = Studio.getResourceManager().getFile(projectId, fileId);
                                            if (fileInput) Studio.getLayoutManager().openEditor(fileInput);
                                            else Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('File not found.');
                                        }
                                    }
                                }
                            };
                            Brightics.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(_this.$mainControl, option);
                        }
                    },
                    resizable: true,
                    title: 'Select Reports to Add'
                });
            }
            else {
                var option = {
                    type: 'info',
                    isCancel: true,
                    contentText: 'No report in this project. Do you want to create a report?',
                    okLabel: 'Create Report',
                    cancelLabel: 'Close',
                    close: function (result) {
                        if (result.OK) {
                            Studio.getInstance().projectViewer.openNewFileDialog(projectId, 'Report');
                        }
                    }
                };
                Brightics.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(_this.$mainControl, option);
            }
        }
    };

    DataWorksheet.prototype.destroy = function () {
        if (!this.$mainControl) return;
        this._cleanTableMap();
        this.unbindEventHandlers();
        this.$mainControl.bchartsAdonis('destroy');
    };

    DataWorksheet.prototype._cleanTableMap = function () {
        for (var tableId in this._tableMap) {
            delete this._tableMap[tableId];
        }
    };


    DataWorksheet.prototype.setDataSet = function (tableId, data) {
        this._tableMap[tableId].columns = data.columns;
        this._tableMap[tableId].data = data.data;
        this.$mainControl.bchartsAdonis('refreshChartPanel');
    };

    DataWorksheet.prototype._getDataSourceList = function () {
        var fnUnit = this.options.fnUnit;
        var panelType = this.dataInfo.panelType;
        // var tableList = fnUnit[panelType + DATA_POST_FIX];
        var tableList = FnUnitUtils.getTable(fnUnit, panelType);
        var list = [];
        for (var i = 0; i < tableList.length; i++) {
            list.push({
                value: tableList[i],
                label: this._getDataSourceLabel(i)
            })
        }
        return list;
    };


    DataWorksheet.prototype._getPanelSource = function (panel) {
        var tableIndexes = panel.tableIndexes || [0];
        return this._getSourceByTableIndexes(tableIndexes);
    };


    DataWorksheet.prototype._getSourceByTableIndexes = function (tableIndexes) {
        var source = {
            dataType: 'lazy',
            lazyData: []
        };

        for (var i = 0; i < tableIndexes.length; i++) {
            source.lazyData.push(this._getLazyData(tableIndexes[i]));
        }

        return source;
    };
    DataWorksheet.prototype._getDataSourceLabel = function (tableIndex) {
        var panelType = this.dataInfo.panelType;
        // var tableList = this.options.fnUnit[panelType + DATA_POST_FIX];
        var tableList = FnUnitUtils.getTable(this.options.fnUnit, panelType);
        var tableId = tableList[tableIndex];
        var model = this.options.fnUnit.parent();
        var preFnUnit = model.getFnUnitByOutTable(tableId);
        var label = preFnUnit.display.label || '';
        if (panelType === PANEL_TYPE_OUT && tableList.length > 1) {
            label = label + '-' + (tableIndex + 1);
        }
        return label;
    };


    DataWorksheet.prototype._getTableSchema = function (tableId) {
        if (this._tableMap[tableId] && this._tableMap[tableId].columns) {
            return this._tableMap[tableId].columns
        } else {
            var mid = this.options.fnUnit.parent().mid;
            return Brightics.VA.Core.DataQueryTemplate.getSchema(mid, tableId);
        }
    };

    DataWorksheet.prototype._setTableMapFromCache = function (tableId) {
        if (this._tableMap[tableId] && this._tableMap[tableId].data) {
            return this._tableMap[tableId].data
        } else {
            var mid = this.options.fnUnit.parent().mid;
            return Brightics.VA.Core.DataQueryTemplate.getTable(mid, tableId);
        }
    };

    DataWorksheet.prototype._getTableMap = function (tableId) {
        if (!this._tableMap[tableId]) {
            var mid = this.options.fnUnit.parent().mid;
            this._tableMap[tableId] = Brightics.VA.Core.DataQueryTemplate.getTable(mid, tableId);
        }
        return this._tableMap[tableId];
    };

    DataWorksheet.prototype._getLazyData = function (tableIndex) {
        var _this = this;
        var fnUnit = this.options.fnUnit;
        var panelType = this.dataInfo.panelType;
        // var tableList = fnUnit[panelType + DATA_POST_FIX];
        var tableList = FnUnitUtils.getTable(fnUnit, panelType);
        var tableId = tableList[tableIndex];

        if (tableId) {
            return {
                id: {
                    value: tableId,
                    label: this._getDataSourceLabel(tableIndex)
                },
                columns: function () {
                    return _this._getTableSchema(tableId)
                },
                data: function (prepare) {
                    _this._prepareCache = _this._prepareCache || {};
                    var _prepare = prepare;

                    if (_this._prepareCache[_prepare.chartInstanceId]) {
                        clearTimeout(_this._prepareCache[_prepare.chartInstanceId]);
                        delete _this._prepareCache[_prepare.chartInstanceId];
                    }

                    _this._prepareCache[_prepare.chartInstanceId] = setTimeout(function () {
                        if (!_this._getTableMap(tableId)) return;
                        try {
                            _prepare.done({
                                dataType: 'rawdata',
                                columns: _this._tableMap[tableId].columns,
                                data: _this._getData(tableId, prepare),
                                count: _this._tableMap[tableId].count,
                                offset: _this._tableMap[tableId].offset,
                            })
                        } catch (e) {
                            Logger.error(e.stack, {category: 'Chart'});
                        }
                    }, 300);
                }
            }
        } else {
            return {
                id: {
                    value: ''
                },
                columns: function () {
                    return [];
                },
                data: function (prepare) {
                    setTimeout(function () {
                        prepare.done({
                            dataType: 'rawdata',
                            columns: [],
                            data: [],
                            count: 0,
                            offset: 0,
                        });

                    }, 100);
                }
            }
        }
    };

    DataWorksheet.prototype._getData = function (tableId, prepare) {
        var data;
        var filters = prepare.filters;
        if (filters && filters.length > 0) {
            var filterHelper = new Brightics.Chart.Helper.SelectionFilterHelper(filters);
            data = filterHelper.filter(this._tableMap[tableId].columns, this._tableMap[tableId].data);
        } else if (filters && filters.length === 0) {
            data = [];
        } else {
            data = this._tableMap[tableId].data;
        }
        return data;
    };


    DataWorksheet.prototype._setPanelDataSource = function (panelIndex) {
        var _this = this;
        var dataSource = {
            selectable: true,
            getDataSourceList: function () {
                return _this._getDataSourceList();
            },
            getDataSourceColumnList: function (id) {
                return _this._tableMap[id].columns
            },
            onDataSourceChangedCallBack: function (panelId, idList) {
                idList.forEach(function (id) {
                    _this._tableMap[id] = _this._tableMap[id] || {};
                });
                _this._queryTables(function () {
                    var panel = _this._getPanelByPanelId(panelId);
                    var command = new Brightics.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand(_this, {
                        panel: panel,
                        ref: {
                            panel: {
                                tableIndexes: _this._getTableIndexes(idList)
                            }
                        }
                    });
                    _this.executeCommand(command);

                    // var newSourceOption = {
                    //     source: _this._getPanelSource(panel)
                    // };

                    _this.$mainControl.bchartsAdonis('setDataSource', panelId, _this._getPanelSource(panel));

                    var tableIndex = _this._getSelectedPanelTableIndex();
                    var pageInfo = _this.getPaginationInfoByTableIndex(tableIndex);
                    if (_this.options.callback && typeof _this.options.callback.setPaginationInfo === 'function') {
                        _this.options.callback.setPaginationInfo(pageInfo);
                    }
                });

            }
        };
        return dataSource
    };

    DataWorksheet.prototype._getSelectedPanelTableIndex = function () {
        var panelOptions = this._selectedPanelOptions;
        var tableIndex = 0;
        if (panelOptions && panelOptions.tableIndexes && panelOptions.tableIndexes[0]) tableIndex = panelOptions.tableIndexes[0];
        return tableIndex;
    };


    DataWorksheet.prototype._getPanelByPanelId = function (panelId) {

        var panel;
        for (var i = 0; i < this.options.worksheet.panel.length; i++) {
            if (this.options.worksheet.panel[i].id === panelId) {
                panel = this.options.worksheet.panel[i];
                break;
            }
        }
        return panel;
    };


    DataWorksheet.prototype._getTableIndexes = function (tableIdList) {
        var fnUnit = this.options.fnUnit;
        var panelType = this.dataInfo.panelType;
        var tableList = FnUnitUtils.getTable(fnUnit, panelType);
        var tableIndexes = [];
        tableIdList.forEach(function (tableId) {
            tableIndexes.push(tableList.indexOf(tableId))
        });
        return tableIndexes;
    };

    DataWorksheet.prototype._onChangeDataSourceCommand = function (command) {
        this.$mainControl.bchartsAdonis('setDataSource', command.options.panel.id, this._getSourceByTableIndexes(command.options.panel.tableIndexes));
    };


    DataWorksheet.prototype._getCallBackFunction = function (callBackFunction) {
        if (this.options.callback[callBackFunction]) {
            return this.options.callback[callBackFunction];
        }
    };

    DataWorksheet.prototype._initDataWorkSheet = function () {
        if (this.options.worksheet.panel.length > 0) {
            this.$mainControl.bchartsAdonis('selectChartPanel', this.options.worksheet.panel[0].id)
        }
    };

    Brightics.VA.Core.Editors.Sheet.Controls.DataWorksheet = DataWorksheet;

}).call(this);

/**
 * Created by ng1123.kim on 2016-03-23.
 */
(function () {
    'use strict';

    var root = this; //
    var Brightics = root.Brightics;

    function ArrayInput(parentId, options) {
        return Brightics.VA.Core.Widget.Factory.arrayInputControl(parentId, options);
    }
    Brightics.VA.Core.Editors.Sheet.Controls.ArrayInput = ArrayInput;

}).call(this);
/**
 * Created by jhoon80.park on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;

    var Brightics = root.Brightics;
    var PropertyControl = Brightics.VA.Core.Editors.Sheet.Controls.PropertyControl;

    CheckListControl.prototype = Object.create(PropertyControl.prototype);

    function CheckListControl(parentId, options) {
        PropertyControl.call(this, parentId, options);
    }

    CheckListControl.prototype.setContents = function ($parents) {
        var data = [];
        for (var i = 0; i < this.options.value.length; i++) {
            data[i] = {
                item: this.options.value[i]
            };
        }
        var source =
            {
                localdata: data,
                datafields:
                    [
                        { name: 'item', type: 'string' }
                    ],
                datatype: "array"
            };
        var dataAdapter = new $.jqx.dataAdapter(source);
        this.$contentsControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-checklist" style="margin: 10px;"/>');
        this.$contentsControl.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            source: dataAdapter,
            editable: true,
            width: "85%",
            height: "200px",
            rowsheight: 25,
            columns: [
                { text: 'select', editable: true,  columntype: 'checkbox', width: "25%", align: "center"},
                { text: 'item', editable: false, datafield: 'item', width: "75%", align: "center", cellsalign:"center"}
            ]
        });
        $parents.append(this.$contentsControl);

    };

    root.Brightics.VA.Core.Editors.Sheet.Controls.CheckListControl = CheckListControl;

}).call(this);

/**
 * Created by ty0314.kim on 2016-01-27.
 */

(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function ColumnList(parentId, options) {
        this.parentId = parentId;
        this.options = options;

        this.initOptions();
        this.retrieveParent();
        this.createControls();
        this.$mainControl.data(this);
    }

    ColumnList.prototype.initOptions = function () {
        var defaultOptions = {
            multiple: true,
            rowCount: 1,
            maxRowCount: 3,
            expand: false,
            draggable: false,
            sort: 'none',
            sortBy: 'name',
            showOpener: 'button',
            removable: true,
            defaultType: '',
            openerPosition: 'right',
            placeHolder: '',
            fromModal: false,
            isOneType: false
        };

        this.options = $.extend(true, defaultOptions, this.options);
        this.options.rowCount = this.options.multiple ? this.options.rowCount : 1;
        this.options.maxRowCount = this.options.multiple ? this.options.maxRowCount : 1;
        this.options.height = this.options.height? this.options.height : 25;

        this.options.items = [];
        this.options.selectedItems = [];
        this.options.renderedItems = {};
        this.options.changedItems = {};
    };

    ColumnList.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ColumnList.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-editors-sheet-controls-columnlist"/>');
        this.$parent.append(this.$mainControl);

        this.createColumnSelectButtonControl();
        this.createColumnListControl();
        this.createColumnSelector();
    };

    ColumnList.prototype.createColumnSelectButtonControl = function () {
        var _this = this;
        if (this.options.multiple) {
            this.$columnSelectButtonWrapper = $('<div class="brtc-va-editors-sheet-controls-columnlist-selectbutton-wrapper" />');
            this.$mainControl.append(this.$columnSelectButtonWrapper);

            this.$selectCounter = $('<div class="brtc-va-editors-sheet-controls-columnlist-selectcounter"><span class="columnlist-select-counter">0</span><span> columns selected</span></div>');
            this.$columnSelectButtonWrapper.append(this.$selectCounter);

            var $buttonContainer = $('<div class="brtc-va-selectbutton-container"></div>');
            this.$columnSelectButtonWrapper.append($buttonContainer);

            if (this.options.showOpener !== 'none') {
                this.$selectButton = $('<button class="brtc-va-editors-sheet-controls-columnlist-selectbutton">Select</button>');
                $buttonContainer.append(this.$selectButton);

                this.$selectButton.jqxButton({
                    theme: 'office',
                    height: this.options.height
                });

                this.$selectButton.on('click', function () {
                    _this.openColumnSelector(this);
                });
            }
        }
    };

    ColumnList.prototype.sortSelectedItems = function () {
        var _this = this;
        if (_this.options.sort === 'ascending') {
            this.options.selectedItems.sort(function (a, b) {
                return a[_this.options.sortBy] > b[_this.options.sortBy] ? 1 : a[_this.options.sortBy] < b[_this.options.sortBy] ? -1 : 0;
            });
        }
        if (_this.options.sort === 'descending') {
            this.options.selectedItems.sort(function (a, b) {
                return a[_this.options.sortBy] < b[_this.options.sortBy] ? 1 : a[_this.options.sortBy] > b[_this.options.sortBy] ? -1 : 0;
            });
        }
    };

    ColumnList.prototype.setMaxHeight = function () {
        // var height = this.$columnList.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element').css('height');
        if (this.options.maxRowCount !== undefined && this.options.maxRowCount > 0) {
            var maxHeight = parseInt(this.options.maxRowCount) * parseInt(this.options.height);
            this.$columnList.css({'max-height': maxHeight});
        }
    };

    ColumnList.prototype.setSortable = function () {
        if (this.options.sort === 'none' && this.options.draggable === true
            && this.options.selectedItems.length > 1
            && this.options.selectedItems.length >= this.options.rowCount) {

            if (this.options.expand || this.$expanderContainer.css('display') === 'none') {
                this.$columnList.sortable({
                    axis: "y",
                    containment: "parent",
                    cursor: "move",
                    items: "div",
                    tolerance: "pointer",
                    helper: function (event, ui) {
                        var $clone = $(ui).clone();
                        $clone.css('position', 'absolute');
                        return $clone.get(0);
                    }
                });
                this.$columnList.sortable('enable');
            }
        }
    };

    ColumnList.prototype.setEmptyUnitHeight = function () {
        var height = this.options.height * ( (this.options.maxRowCount == 0) ? 1 : this.options.maxRowCount);
        this.$emptyUnit.css({'height': height + 'px'});
        this.$emptyUnit.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-empty').css({'line-height': height + 'px'});
    };

    ColumnList.prototype.createColumnListControl = function () {
        var _this = this;

        if (!this.options.placeHolder) {
            this.options.placeHolder = (this.options.multiple) ? '+ Select Columns' : '+ Select Column';
        }

        this.$columnContainerWrapper = $('<div class="brtc-va-editors-sheet-controls-columnlist-columncontainer-wrapper" />');
        this.$columnListControl = $('<div class="brtc-va-editors-sheet-controls-columnlist-columncontainer" />');
        this.$emptyUnit = $('' +
            '<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element">' +
            '   <div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-empty">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.placeHolder) + '</div>' +
            '</div>');
        this.setEmptyUnitHeight();


        //this.$emptyUnit.css({'cursor': 'pointer'});
        this.$emptyUnit.on('click', function (event) {
            _this.openColumnSelector(this);
        });

        this.$columnListControl.append(this.$emptyUnit);
        this.$columnList = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-sortable" style="position: relative;"/>');
        this.$columnListControl.append(this.$columnList);
        this.$columnContainerWrapper.append(this.$columnListControl);

        /*if (this.options.multiple == true) {
            this.$columnList.perfectScrollbar({suppressScrollX: true});
        }*/

        this.$columnList.sortable({
            axis: "y",
            containment: "parent",
            cursor: "move",
            items: "div",
            tolerance: "pointer",
            helper: function (event, ui) {
                var $clone = $(ui).clone();
                $clone.css('position', 'absolute');
                return $clone.get(0);
            }
        });
        this.$columnList.sortable('disable');
        this.$columnList.on("sortstop", function (event, ui) {
            _this.options.selectedItems = _this.$columnList.sortable('toArray', {attribute: 'value'});
            _this.options.changed('sortchange', {items: _this.options.selectedItems});
        });

        this.$columnList.on('mousewheel', function(event){
            event.stopPropagation();
        });

        this.$expanderContainer = $('<div class="brtc-va-editors-sheet-controls-columnselector-expandercontainer" />');
        var $expand = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander" />'),
            $expandLeft = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-left" />'),
            $expandCenter = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-center" />'),
            $expandRight = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-right" />');

        $expand.append($expandLeft).append($expandCenter).append($expandRight);

        this.$expandUp = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-up" />');
        this.$expandUp.append('<i class="fa fa-angle-double-up"></i>');
        this.$expandDown = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-down" />');
        this.$expandDown.append('<i class="fa fa-angle-double-down"></i>');
        $expandCenter.append(this.$expandUp).append(this.$expandDown);

        this.$remainNumber = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-remain" />');
        $expandRight.append(this.$remainNumber);

        this.$expandUp.hide();
        this.$expandDown.show();

        $expand.click(function (event) {
            if (_this.$expandUp.css('display') === 'block') {
                _this.options.expand = false;
                _this.$expandUp.hide();
                _this.$expandDown.show();
                _this.$columnList.sortable('disable');
            } else if (_this.$expandDown.css('display') === 'block') {
                _this.options.expand = true;
                _this.$expandUp.show();
                _this.$expandDown.hide();
            }
            _this.renderColumnContainer();
        });

        this.$expanderContainer.append($expand);
        this.$expanderContainer.hide();
        this.$columnContainerWrapper.append(this.$expanderContainer);
        this.$mainControl.append(this.$columnContainerWrapper);
    };

    ColumnList.prototype.renderColumnContainer = function () {
        var _this = this;

        var selectedItems = this.options.selectedItems;
        var renderedItems = this.options.renderedItems;

        _this.$columnList.find('div[empty="true"]').remove();

        selectedItems.length > 0 ? this.$emptyUnit.hide() : this.$emptyUnit.show();
        this.setEmptyUnitHeight();
        this.sortSelectedItems();

        $.each(selectedItems, function (index, column) {
            if (!renderedItems[column]) {
                renderedItems[column] = _this.createColumnUnit(column);
                _this.$columnList.append(renderedItems[column]);
            }
        });

        if (this.options.selectedItems.length > 0) {
            for (var i = this.options.selectedItems.length; i < this.options.maxRowCount; i++) {
                var $empty = this.$emptyUnit.clone();
                $empty.css({'height': this.options.height}).on('click', function (event) {
                    _this.openColumnSelector(this);
                });
                _this.$columnList.append($empty.attr('empty', 'true').text('').show());
            }
        }

        if (this.options.multiple) {
            this.$selectCounter.find('.columnlist-select-counter').text(this.options.selectedItems.length);
        }

        this.setMaxHeight();
        this.setSortable();
    };

    ColumnList.prototype.addColumnUnitAll = function () {
        this.renderColumnContainerAll();
        this.fillBackground();
    };

    ColumnList.prototype.renderColumnContainerAll = function () {
        var _this = this;

        var selectedItems = this.options.items;
        var renderedItems = this.options.renderedItems;

        _this.$columnList.find('div[empty="true"]').remove();

        selectedItems.length > 0 ? this.$emptyUnit.hide() : this.$emptyUnit.show();
        this.setEmptyUnitHeight();

        $.each(selectedItems, function (index, column) {
            if (typeof renderedItems[column.name] === 'undefined') {
                renderedItems[column.name] = _this.createColumnUnit(column.name);
                _this.$columnList.append(renderedItems[column.name]);
            }
        });

        if (this.options.selectedItems.length > 0) {
            for (var i = this.options.selectedItems.length; i < this.options.maxRowCount; i++) {
                var $empty = this.$emptyUnit.clone();
                $empty.css({'height': this.options.height}).on('click', function (event) {
                    _this.openColumnSelector(this);
                });
                _this.$columnList.append($empty.attr('empty', 'true').text('').show());
            }
        }

        this.$selectCounter.find('.columnlist-select-counter').text(this.options.selectedItems.length);

        this.setMaxHeight();
        this.setSortable();
    };

    ColumnList.prototype.createColumnSelector = function () {
        var _this = this;

        this.columnSelector = new Brightics.VA.Core.Editors.Sheet.Controls.ColumnSelector(this.$mainControl, {
            columnList: this,
            multiple: _this.options.multiple,
            fromModal: _this.options.fromModal,
            changed: function (event, data) {
                if (event === 'selectAll') {
                    if (data.length == _this.options.items.length && !_this.options.isOneType) {

                        var allItemArr = [];
                        for (var i in _this.options.items) {
                            if (_this.isSameType(_this.options.items[i])) return;
                            _this.options.changedItems[_this.options.items[i].name] = 'select';
                            allItemArr.push(_this.options.items[i].name);
                        }

                        _this.options.selectedItems = allItemArr;
                        _this.options.renderedItems = {};
                        _this.$columnList.empty();
                        _this.addColumnUnitAll();

                        // _this.options.added({
                        //     added: allItemArr,
                        //     removed: [],
                        //     items: allItemArr
                        // });
                    } else {
                        for (var i in data) {
                            if (_this.isSameType(data[i])) return;
                            var inArray = $.inArray(data[i].name, _this.options.selectedItems);
                            if (inArray < 0) _this.options.changedItems[data[i].name] = 'select';
                            _this.addColumnUnit(data[i].name);

                            if (_this.options.multiple) {
                                _this.options.added({
                                    added: [data.name],
                                    removed: [],
                                    items: _this.options.selectedItems
                                });
                            }
                        }
                    }
                }
                if (event === 'unselectAll') {
                    if (data.length == _this.options.items.length) {
                        _this.options.selectedItems = [];
                        _this.options.renderedItems = {};
                        _this.$columnList.empty();

                        var allItemArr = [];
                        for (var i in _this.options.items) {
                            _this.options.changedItems[_this.options.items[i].name] = 'unselect';
                            allItemArr.push(_this.options.items[i].name);
                        }

                        _this.renderColumnContainer(true);
                        _this.fillBackground();

                        _this.options.removed({
                            added: [],
                            removed: allItemArr,
                            items: []
                        });
                    } else {
                        for (var i in data) {
                            var inArray = $.inArray(data[i].name, _this.options.selectedItems);
                            if (inArray > -1) _this.options.changedItems[data[i].name] = 'unselect';
                            _this.removeColumnUnit(data[i].name);

                            if (_this.options.multiple) {
                                _this.options.removed({
                                    added: [],
                                    removed: [data[i].name],
                                    items: _this.options.selectedItems
                                });
                            }
                        }
                    }
                }
                if (event === 'select') {
                    if (_this.isSameType(data)) return;
                    var inArray = $.inArray(data.name, _this.options.selectedItems);
                    if (inArray < 0) _this.options.changedItems[data.name] = 'select';
                    _this.addColumnUnit(data.name);

                    if (_this.options.multiple) {
                        _this.options.added({
                            added: [data.name],
                            removed: [],
                            items: _this.options.selectedItems
                        });
                    }
                }
                if (event === 'unselect') {
                    var inArray = $.inArray(data.name, _this.options.selectedItems);
                    if (inArray > -1) _this.options.changedItems[data.name] = 'unselect';
                    _this.removeColumnUnit(data.name);

                    if (_this.options.multiple) {
                        _this.options.removed({
                            added: [],
                            removed: [data.name],
                            items: _this.options.selectedItems
                        });
                    }
                }
                if (event === 'close') {
                    var added = [], removed = [];
                    for (var key in _this.options.changedItems) {
                        if (_this.options.changedItems[key] === 'select') {
                            added.push(key);
                        } else {
                            removed.push(key);
                        }
                    }
                    if (added.length > 0 || removed.length > 0) {
                        _this.options.changed('change', {
                            added: added,
                            removed: removed,
                            items: _this.options.selectedItems
                        });
                    }
                    _this.options.changedItems = {};

                    _this.showColumnSelector = false;
                    _this.$mainControl.removeClass('brtc-va-editors-sheet-controls-columnselector-hover');
                    var $removeButtons = _this.$mainControl.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove');
                    $removeButtons.css({'background-color': 'white'});
                }
            }
        });
    };

    ColumnList.prototype.createTypeLabel = function (columnName) {
        var type = '';
        $.each(this.options.items, function (index, column) {
            if (column.name === columnName) {
                type = column.type;
                return false;
            }
        });
        return type;
    };

    ColumnList.prototype.getInternalType = function (columnName) {
        for (var i in this.options.items) {
            if (this.options.items[i].name === columnName) {
                return (this.options.items[i].internalType) ? this.options.items[i].internalType : this.options.items[i].type;
            }
        }
    };

    ColumnList.prototype.createColumnUnit = function (columnName) {
        var _this = this;
        var typeLabel = this.createTypeLabel(columnName);
        var internalType = this.getInternalType(columnName);

        var $composite = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element brtc-style-relative" />');
        $composite.css({'height': this.options.height});

        this.$type = $('<span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-type" internal-type="' + internalType + '" data-type="' + (typeLabel? typeLabel : undefined) + '" >' + typeLabel + '</span>');
        this.$type.text(Brightics.VA.Core.Utils.CommonUtils.convertDataTypeForText(typeLabel, internalType));
        this.$type.attr('title', Brightics.VA.Core.Utils.CommonUtils.convertDataTypeForTitle(typeLabel, internalType));

        this.$name = $('<span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-name" >' + columnName + '</span>').text(columnName);

        this.$remove = $('<span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove"></span>');
        $composite.append(this.$type).append(this.$name).append(this.$remove);
        $composite.attr('value', columnName);
        $composite.attr('title', columnName);

        $composite.mouseover(function (event) {
            if (_this.options.removable) $(this).find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove').css({'display': 'block'});
            if (_this.options.multiple && $composite.attr('value')) {
                $composite.addClass('brtc-va-editors-sheet-controls-columnselector-columncontainer-element-hover');
            }
        });

        $composite.mouseout(function (event) {
            $(this).find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove').css({'display': 'none'});

            $composite.removeClass('brtc-va-editors-sheet-controls-columnselector-columncontainer-element-hover');
        });
        $composite.on('click', function (event) {
            _this.openColumnSelector(this);
        });

        this.$remove.click(function (event) {
            var $container = $(this).closest('.brtc-va-editors-sheet-controls-columnlist-columncontainer');

            var removeButtons = $container.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove'),
                removeButtonIndex = -1,
                $focusTarget = undefined;

            for (var i=0; i<removeButtons.length; i++) {
                if (this == removeButtons[i]) {
                    removeButtonIndex = i;
                    if (removeButtons[i+1]) $focusTarget = $(removeButtons[i+1]);
                    break;
                }
            }

            var unSelectColumnName = $(this).prevAll('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-name').text();
            _this.removeColumnUnit(unSelectColumnName);
            _this.options.changed('removed', {
                added: [],
                removed: [unSelectColumnName],
                items: _this.options.selectedItems
            });

            _this.options.removed({
                added: [],
                removed: [unSelectColumnName],
                items: _this.options.selectedItems
            });
            _this.options.removed({
                added: [],
                removed: [unSelectColumnName],
                items: _this.options.selectedItems
            });

            if ($focusTarget) $focusTarget.mouseover();
        });

        return $composite;
    };

    ColumnList.prototype.checkWidth = function ($target) {
        var text = $target.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-name').text();
        var res = {
            isTextOverflown: false,
            width: 0
        };

        var cont = $('<div>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(text) + '</div>').css("display", "table")
            .css("z-index", "-1").css("position", "absolute")
            .css("font-family", $target.css("font-family"))
            .css("font-size", $target.css("font-size"))
            .css("font-weight", $target.css("font-weight")).appendTo('body');
        res.isTextOverflown = (cont.width() > $target.width());
        res.width = cont.width();

        cont.remove();
        return res;
    };

    ColumnList.prototype.addColumnUnit = function (selectedColName) {
        if (this.options.multiple === false) {
            this.options.selectedItems = [];
            this.options.renderedItems = {};
            this.$columnList.empty();
        }

        for (var i in this.options.selectedItems) {
            if (this.options.selectedItems[i] === selectedColName) {
                return;
            }
        }
        this.options.selectedItems.push(selectedColName);
        this.renderColumnContainer();
        this.fillBackground();
    };

    ColumnList.prototype.removeColumnUnit = function (selectedColName) {
        var _this = this;

        for (var i in this.options.selectedItems) {
            if (this.options.selectedItems[i] === selectedColName) {
                this.options.selectedItems.splice(i, 1);
                break;
            }
        }

        if (this.options.renderedItems[selectedColName]) {
            this.options.renderedItems[selectedColName].remove();
            delete this.options.renderedItems[selectedColName];
        }

        this.renderColumnContainer();
        this.fillBackground();
    };

    ColumnList.prototype.setSelectedItems = function (items) {
        if (!items) return;
        this.options.selectedItems = [];
        this.options.renderedItems = {};

        var temp = $.extend(true, [], $.grep(items, function (column) {
            return column;
        }));
        if (this.options.multiple) {
            this.options.selectedItems = temp;
        } else if (temp.length > 0) {
            this.options.selectedItems = [temp[0]];
        }

        this.$columnList.empty();
        this.renderColumnContainer();
    };

    ColumnList.prototype.getSelectedItems = function () {
        return this.options.selectedItems.length > 0 ? $.extend(true, [], this.options.selectedItems) : [];
    };

    ColumnList.prototype.getSelectedItemsWithType = function () {
        var rtItems = [];

        for (var i in this.options.selectedItems) {
            for (var j in this.options.items) {
                if (this.options.selectedItems[i] === this.options.items[j].name) {
                    rtItems.push(this.options.items[j]);
                }
            }
        }
        return rtItems;
    };

    ColumnList.prototype.clearList = function () {
        this.$columnListControl.empty();
    };

    ColumnList.prototype.setItems = function (columns) {
        if(this._isDestroyed()) return;
        columns = columns || [];
        this.options.items = columns;
        this.columnSelector.setSource(columns);
    };

    ColumnList.prototype._isDestroyed = function () {
        return !this.$mainControl.closest('body').length;
    };

    ColumnList.prototype.onChange = function (callback) {
        this.options.changed = callback;
    };

    // ColumnList.prototype.getSelectorPosition = function () {
    //     var position = {
    //         left: '',
    //         top: ''
    //     };
    //
    //     var browserWidth = document.all ? document.body.clientWidth : window.innerWidth,
    //         browserHeight = document.all ? document.body.clientHeight : window.innerHeight,
    //         columnSelectorHeight = this.columnSelector.getHeight(),
    //         columnSelectorWidth = this.columnSelector.getWidth();
    //
    //     if (this.options.openerPosition === 'right') {
    //         position.left = this.$mainControl.offset().left + this.$mainControl.width() + 5;
    //         position.top = this.$mainControl.offset().top;
    //     }
    //     if (this.options.openerPosition === 'bottom') {
    //         position.left = this.$mainControl.offset().left;
    //         position.top = this.$mainControl.offset().top + this.$mainControl.height() + 5;
    //     }
    //
    //     if (this.options.openerPosition === 'left') {
    //         position.left = this.$mainControl.offset().left - columnSelectorWidth - 5;
    //         position.top = this.$mainControl.offset().top;
    //     }
    //
    //     if (browserHeight - columnSelectorHeight - 10 < position.top) {
    //         position.top = browserHeight - columnSelectorHeight - 10;
    //     }
    //     if (browserWidth - columnSelectorWidth - 10 < position.left) {
    //         position.left = browserWidth - columnSelectorWidth - 10;
    //     }
    //     return position;
    // };

    ColumnList.prototype.closeSelector = function () {
        this.columnSelector.close();

    };

    ColumnList.prototype.openColumnSelector = function (button) {
        if (this.options.showOpener !== 'none') {
            this.columnSelector.open(button, this.options.selectedItems);
            this.showColumnSelector = true;
            this.fillBackground();
        }
    };

    ColumnList.prototype.fillBackground = function () {
        var $removeButtons = this.$mainControl.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove');
        if (this.showColumnSelector) {
            this.$mainControl.addClass('brtc-va-editors-sheet-controls-columnselector-hover');
            $removeButtons.css({'background-color': '#D3F0E0'});
        } else {
            this.$mainControl.removeClass('brtc-va-editors-sheet-controls-columnselector-hover');
            $removeButtons.css({'background-color': 'white'});
        }
    };

    ColumnList.prototype.isSameType = function (data) {
        if (this.options.isOneType) {
            if (this.options.rowCount === 1) {
                if (this.options.selectedItems.length > 0) {
                    Brightics.VA.Core.Utils.WidgetUtils.openWarningDialog('You can only select one column.');
                    this.columnSelector.close();
                    return true;
                }
            } else {
                var types = [];
                if (this.options.selectedItems.length > 0) {
                    for (var i in this.options.selectedItems) {
                        for (var j in this.options.items) {
                            if (this.options.selectedItems[i] === this.options.items[j].name) {
                                if ($.inArray(this.options.items[j].type, types) == -1) types.push(this.options.items[j].type);
                                break;
                            }
                        }
                    }
                } else {
                    types.push(data.type);
                }
                if (types.length > 0 && $.inArray(data.type, types) == -1) {
                    Brightics.VA.Core.Utils.WidgetUtils.openWarningDialog('You can only select columns of the same type.');
                    this.columnSelector.close();
                    return true;
                }
            }
        }
        return false;
    };

    Brightics.VA.Core.Editors.Sheet.Controls.ColumnList = ColumnList;

}).call(this);

/**
 * Created by ty0314.kim on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    const ITEM_HEIGHT = 30;

    /**
     * {
     *      source: [],
     *      width: 250,
     *      height: 320,
     *      resizable: false,
     *      title: '',
     *      multiple: true, // if true multi select
     *      changed: Function
     * }
     * @param parentId
     * @param options
     * @constructor
     */
    function ColumnSelector(parentId, options) {
        this.parentId = parentId;
        this.options = options;

        this.initOptions();
        this.retrieveParent();
        this.createControl();
    };

    ColumnSelector.prototype.initOptions = function () {
        var defaultOptions = {
            source: [],
            width: 300,
            height: 320,
            resizable: true,
            multiple: false,
            fromModal: false
        };

        this.options = $.extend(true, defaultOptions, this.options);
    };

    ColumnSelector.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ColumnSelector.prototype.createControl = function () {
        var _this = this;

        this.$mainControl = $('<div class="brtc-va-editors-sheet-controls-columnselector-editarea">' +
            '   <div class="brtc-va-editors-sheet-controls-columnselector-header" />' +
            '   <div class="brtc-va-editors-sheet-controls-columnselector-content brtc-style-full brtc-style-display-flex brtc-style-flex-direction-column" />' +
            '</div>');

        var $contentControl = this.$mainControl.find('.brtc-va-editors-sheet-controls-columnselector-content');

        this.createFilter($contentControl);
        if (this.options.multiple) {
            this.createSelectButton($contentControl);
        }
        this.createColumnContainer($contentControl);

        var dialogOptions = {
            theme: Brightics.VA.Env.Theme,
            width: this.options.width || 300,
            height: this.options.height,
            resizable: true,
            title: (this.options.multiple) ? 'Select Columns' : 'Select Column',
            autoOpen: false,
            modal: false,
            showAnimationDuration: 50,
            minHeight: 285,
            minWidth: 307,
            resize: function () {
                _this._updateViewPort();
                _this._renderItems();
                _this._updatePerfectScroll();
            },
            close: function () {
                $(window).off('mousedown', _this.closeHandler);
                _this.options.changed('close');
            },
            destroy: function () {
                _this.$mainControl.dialog('destroy');
            }
        };
        if (!this.options.multiple) {
            dialogOptions.height -= 33;
        }
        this.$mainControl.dialog(dialogOptions);
        this.$mainControl.attr('name', dialogOptions.title);
        this.$mainControl.parent().find('.ui-dialog-titlebar.ui-widget-header').css({'border-bottom': 'none !important;'});
        this.$mainControl.parent().find('button.ui-dialog-titlebar-close').attr('style', 'right: -38px !important;');

        this.closeHandler = function (event) {
            if (_this.$mainControl.closest('.ui-dialog').has(event.target).length === 0) {
                _this.$mainControl.dialog('close');
            }
        };
    };

    ColumnSelector.prototype.createFilter = function ($parent) {
        var _this = this;

        var $container = $('<div class="brtc-va-editors-sheet-controls-columnselector-filter-container"></div>');
        $parent.append($container);

        this.$filterControl = $('<input type="search" placeholder="Search Column" />');
        $container.append(this.$filterControl);

        this.$filterControl.jqxInput({
            theme: Brightics.VA.Env.Theme,
            placeHolder: "Search Column",
            height: 31,
            minLength: 1
        });

        this.$filterControl.on('keyup search', function (event) {
            clearTimeout(_this._searchHandler);

            _this._searchHandler = setTimeout(function () {
                var value = event.target.value;
                _this._searchFilteredItem(value);
            }, 100);
        });
    };

    ColumnSelector.prototype._updatePerfectScroll = function () {
        this.$mainControl.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper').perfectScrollbar('update');
    };

    ColumnSelector.prototype._searchFilteredItem = function (value) {
        this._filteredItems = [];

        for (var key in this._itemMap) {
            if (key.toLowerCase().indexOf(value.toLowerCase()) !== -1) {
                this._getItemControl(key).show();
                this._filteredItems.push(key);
            } else {
                this._getItemControl(key).hide();
            }
        }
        this.setAllCheckBoxCondition();

        this._setBackground();
        this._renderItems();
        this._updatePerfectScroll();
    };


    ColumnSelector.prototype._resetFilter = function () {
        this.$filterControl.val('');
        this._searchFilteredItem('');
    };


    ColumnSelector.prototype.setAllCheckBoxCondition = function () {
        if (!this.options.multiple) return;
        var key;
        var isSelectedAll = true;
        for (var i = 0; i < this._filteredItems.length; i++) {
            key = this._filteredItems[i];
            if (this._getItemControl(key).find('.checked').length === 0) {
                isSelectedAll = false;
                break;
            }
        }

        if (isSelectedAll) {
            this.$selectButton.jqxCheckBox('checked', true);
        } else {
            this.$selectButton.jqxCheckBox('checked', false);
        }
    };


    ColumnSelector.prototype.createSelectButton = function ($parent) {
        var _this = this;

        var $wrapper = $('<div class="brtc-column-check-box-wrapper"></div>');
        $parent.append($wrapper);

        this.$selectButton = $('<div id="brtc-column-check-box"><span>Select All</span></div>');
        $wrapper.append(this.$selectButton);

        this.$selectButton.jqxCheckBox({
            theme: "office",
            width: 120,
            height: 25,
            checked: false,
            boxSize: "17px",
            animationShowDelay: 10,
            animationHideDelay: 10
        });

        this.$selectButton.on('click', function (event, indirectClick) {
            if (!indirectClick) {
                if ($(this).val()) {
                    _this._selectAllItem();
                }
                else {
                    _this._unSelectAllItem();
                }
            } else {
                $(this).val(!$(this).val());
            }
        });
    };

    ColumnSelector.prototype.createColumnContainer = function ($parent) {
        var _this = this;

        var $columnContainerWrapper = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper brtc-style-flex-1"></div>');
        $parent.append($columnContainerWrapper);

        this.$columnContainer = $('<div class ="brtc-va-editors-sheet-controls-columnselector-columncontainer-list"></div>');
        $columnContainerWrapper.append(this.$columnContainer);

        $columnContainerWrapper.perfectScrollbar({suppressScrollX: true});
        $columnContainerWrapper.on('ps-scroll-y', function () {
            _this._renderItems();
        });
    };

    ColumnSelector.prototype.createTypeLabel = function (type) {
        return type ? type.substring(0, 1).toUpperCase() : this.options.defaultType;
    };

    ColumnSelector.prototype.getSelectedItems = function () {
        return Object.keys(this._selectedItemMap);
    };

    // ColumnSelector.prototype.getMaxWidth = function (source) {
    //     return 250;
    // };

    ColumnSelector.prototype._getItem = function (columnName) {
        return this._itemMap[columnName].source;
    };

    ColumnSelector.prototype._getItemControl = function (columnName) {
        if (this._itemMap[columnName] && this._itemMap[columnName].control) {
            return this._itemMap[columnName].control;
        }
    };


    ColumnSelector.prototype._selectAllItem = function () {
        var columnName;
        var itemList = [];
        for (var i = 0; i < this._filteredItems.length; i++) {
            columnName = this._filteredItems[i];
            this._checkItemButton(columnName);
            this._selectedItemMap[columnName] = true;
            itemList.push(this._getItem(columnName));
        }
        this.options.changed('selectAll', itemList);
    };

    ColumnSelector.prototype._unSelectAllItem = function () {
        var columnName;
        var itemList = [];
        for (var i = 0; i < this._filteredItems.length; i++) {
            columnName = this._filteredItems[i];
            this._unCheckItemButton(columnName);
            delete this._selectedItemMap[columnName];
            itemList.push(this._getItem(columnName));
        }
        this.options.changed('unselectAll', itemList);
    };

    ColumnSelector.prototype._addSelectedItem = function (columnName) {
        if (!this.options.multiple) {
            this._selectedItemMap = {};
        }

        this._checkItemButton(columnName);
        this._selectedItemMap[columnName] = true;
        this.options.changed('select', this._getItem(columnName));
    };

    ColumnSelector.prototype._deleteSelectedItem = function (columnName) {
        this._unCheckItemButton(columnName);
        delete this._selectedItemMap[columnName];
        this.options.changed('unselect', this._getItem(columnName));
    };
    ColumnSelector.prototype._checkItemButton = function (columnName) {
        this._getItemControl(columnName).find('.brtc-va-editors-sheet-controls-columnselector-button').addClass('checked');
    };
    ColumnSelector.prototype._unCheckItemButton = function (columnName) {
        this._getItemControl(columnName).find('.checked').removeClass('checked');
    };

    ColumnSelector.prototype.setSource = function (source) {
        this.options.source = source;

        this._selectedItemMap = {};
        this._itemMap = {};


        // 2016.10.20 정명규 수정
        // source에 internalType과 type을 합쳐 combineType을 추가 :
        // jqxListBox에 renderer 할때 displayMember 랑 value 멤버 둘만 보여준다.
        // 현재는 type을 보고 있는데 나중에 internalType을 보게되면 합칠 필요는 없어짐
        for (var i in this.options.source) {
            var _internalType = (this.options.source[i].internalType) ? this.options.source[i].internalType : this.options.source[i].type;
            this.options.source[i].combineType = _internalType + '?' + this.options.source[i].type;
        }

        this._createItems(this.options.source);
        this._filteredItems = Object.keys(this._itemMap);
        this._setBackground();
    };

    ColumnSelector.prototype._setBackground = function () {
        this._display = {
            virtualHeight: this._filteredItems.length * ITEM_HEIGHT,
            viewPortHeight: this.$mainControl.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper').height(),
            viewPortScrollTop: this.$mainControl.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper').scrollTop()
        };
        this.$columnContainer.height(this._display.virtualHeight);
    };

    ColumnSelector.prototype._updateViewPort = function () {
        this._display.viewPortHeight = this.$mainControl.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper').height();
        this._display.viewPortScrollTop = this.$mainControl.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper').scrollTop();
    };


    ColumnSelector.prototype._renderItems = function () {
        this._updateViewPort();
        this.$columnContainer.empty();
        var startIndex = Math.ceil(this._display.viewPortScrollTop / ITEM_HEIGHT) - 1;
        var endIndex = startIndex + Math.ceil(this._display.viewPortHeight / ITEM_HEIGHT) + 2;

        for (var i = startIndex; i < endIndex; i++) {
            if (!this._filteredItems[i]) continue;
            var columnName = this._filteredItems[i];

            var $item = this._getItemControl(columnName);
            $item.css('top', i * ITEM_HEIGHT + 'px');
            $item.css('display', 'flex');
            this.$columnContainer.append($item);
            this._createItemClickEvent($item);
        }
    };


    ColumnSelector.prototype._createItems = function (items) {
        var item;
        var buttonType = this.options.multiple === true ? 'checkbox' : 'radio';
        for (var i = 0; i < items.length; i++) {
            item = items[i];

            var typeArr = item.combineType.split('?');

            var internalType = typeArr[0],
                type = typeArr[1];

            var text = Brightics.VA.Core.Utils.CommonUtils.convertDataTypeForText(type, internalType),
                title = Brightics.VA.Core.Utils.CommonUtils.convertDataTypeForTitle(type, internalType);

            var dataType = this.createTypeLabel(type);

            var $item = $('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-list-wrapper" name="' + item.name + '">');
            $item.append('<div class="brtc-va-editors-sheet-controls-columnselector-button brtc-style-button" button-type="' + buttonType + '"></div>');
            $item.append('' +
                '<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element" title="' + Utils.WidgetUtils.convertHTMLSpecialChar(item.name) + '">' +
                '   <span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-type" title="' + title + '" internal-type="' + internalType.toLowerCase() + '" data-type="' + Utils.WidgetUtils.convertHTMLSpecialChar(dataType) + '">' + text + '</span>' +
                '   <span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-name" name="' + item.name + '">' + Utils.WidgetUtils.convertHTMLSpecialChar(item.name) + '</span>' +
                '</div>');

            this._itemMap[item.name] = {
                control: $item,
                source: item
            };
        }
    };

    ColumnSelector.prototype._createItemClickEvent = function ($item) {
        var _this = this;
        $item.click(function () {
            if (!_this.options.multiple) {
                for (var key in _this._selectedItemMap) {
                    _this._getItemControl(key).find('.brtc-style-button.checked').removeClass('checked');
                }
                var columnName = $item.attr('name');
                _this._checkItemButton(columnName);
                _this._addSelectedItem(columnName);

            } else {
                var isChecked = $item.find('.brtc-style-button').hasClass('checked');
                if (isChecked) {
                    var columnName = $item.attr('name');
                    _this._unCheckItemButton(columnName);
                    _this._deleteSelectedItem(columnName);
                } else {
                    var columnName = $item.attr('name');
                    _this._checkItemButton(columnName);
                    _this._addSelectedItem(columnName);
                }

                _this.setAllCheckBoxCondition();
            }
        });
    };


    ColumnSelector.prototype.setSelectedItems = function (selectedData) {
        var $itemControl, $checkbox;
        for (var key in this._selectedItemMap) {
            $itemControl = this._getItemControl(key);
            if (!$itemControl) continue;
            $checkbox = $itemControl.find('.brtc-va-editors-sheet-controls-columnselector-button');
            if ($checkbox.hasClass('checked')) $checkbox.removeClass('checked');
        }

        this._selectedItemMap = {};

        for (var i in selectedData) {
            $itemControl = this._getItemControl(selectedData[i]);
            if (!$itemControl) continue;
            $checkbox = $itemControl.find('.brtc-va-editors-sheet-controls-columnselector-button');
            if (!$checkbox.hasClass('checked')) $checkbox.addClass('checked');
            this._selectedItemMap[selectedData[i]] = true;
        }
    };

    ColumnSelector.prototype.open = function (position, listsource) {
        var _this = this;

        this._resetFilter();
        this.setSelectedItems(listsource);
        this.setAllCheckBoxCondition();

        this.$mainControl.dialog({
            position: {my: "left top", at: "right+5 top", of: position}
        });

        this.$mainControl.parent().find('.ui-dialog-titlebar.ui-widget-header').attr('style', 'border: none !important; margin-left: 11px !important');
        this.$mainControl.dialog('open');
        $(window).on('mousedown', this.closeHandler);
        this.$parent.closest('.ps-container').on('scroll', function (event) {
            _this.closeHandler(event);
        });

        this._updateViewPort();
        this._renderItems();
        this._updatePerfectScroll();
    };

    ColumnSelector.prototype.close = function (source) {
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Editors.Sheet.Controls.ColumnSelector = ColumnSelector;

}).call(this);

/**
 * Created by jhoon80.park on 2016-01-27.
 */
(function () {
  "use strict";

  var root = this;

  var Brightics = root.Brightics;
  var PropertyControl = Brightics.VA.Core.Editors.Sheet.Controls.PropertyControl;

  ComboControl.prototype = Object.create(PropertyControl.prototype);

  function ComboControl(parentId, options) {
    PropertyControl.call(this, parentId, options);
  }

  ComboControl.prototype.setContents = function ($parents) {
    this.$contentsControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox" style="margin: 10px;"/>');
    this.$contentsControl.jqxComboBox({
      theme        : Brightics.VA.Env.Theme,
      source       : this.options.value,
      selectedIndex: 0,
      height       : 25,
      width        : "85%"
    });

    if (this.options.value.length < 7) {
      this.$contentsControl.jqxComboBox({dropDownHeight: this.options.value.length * 25});
    }
    $parents.append(this.$contentsControl);

  };

  root.Brightics.VA.Core.Editors.Sheet.Controls.ComboControl = ComboControl;

}).call(this);


(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DataList(parentId, options) {
        this.parentId = parentId;
        this.options = options;

        this.retrieveParent();
        this.createControls();
    }

    DataList.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    DataList.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-controls-datatree"></div>');
        this.$treeWrapper = $('<div class="brtc-va-controls-datatree-wrapper"><ul></ul></div>');

        this.$parent.append(this.$mainControl);
        this.$mainControl.append(this.$treeWrapper);

        this.$mainControl.css({
            'width': '200px',
            'height': '100%',
            'border': '1px solid grey',
            'float': 'left',
            'background-color': 'white'
        });

        this.createTree();
    };

    DataList.prototype.createTree = function () {
        var _this = this;
        var $container = this.$treeWrapper.find('ul');

        _.forEach(this.options.source, function (map, funcLabel) {
            _this.createTreeElement($container, funcLabel, map);
        });

        this.$treeWrapper.jqxTree({
            height: '100%',
            width: '100%',
            theme: Brightics.VA.Env.Theme,
            allowDrag: false
        });

        this.addTypeIcon();

        if (_this.options.draggable) _this.createDragEvent();
    };

    DataList.prototype.createTreeElement = function ($container, funcLabel, map) {
        var _this = this;

        var $funcLi = $('<li></li>');

        $container.append($funcLi);

        $funcLi.attr('item-expanded', 'true');
        $funcLi.text(funcLabel);

        _.forEach(map, function (data, tableId) {
            var $li = $('<li class="brtc-va-controls-datatree-li-table"></li>');
            $li.text(data.key);
            $li.attr('key', data.key);
            $li.attr('table-id', tableId);
            $li.attr('type', data.type);

            $funcLi.append('<ul></ul>');
            $funcLi.find('ul').append($li);

            _this.createClickEvent($li);
        });
    };

    DataList.prototype.addTypeIcon = function () {
        var items = this.$treeWrapper.find('.brtc-va-controls-datatree-li-table');

        for (var i=0; i<items.length; i++) {
            var $icon = $('<div class="brtc-va-controls-datatree-type-icon"></div>');
            var iconText = ($(items[i]).attr('type')).substring(0,1).toUpperCase();
            $icon.text(iconText);
            $(items[i]).prepend($icon);
        }
    };

    DataList.prototype.createClickEvent = function ($unit) {
        var _this = this;

        $unit.click(function () {
            if (typeof _this.options.onClick === 'function') {
                var key = $(this).attr('key');
                var tableId = $(this).attr('table-id');

                _this.options.onClick({
                    key: key,
                    tableId: tableId
                });
            }
        });
    };

    DataList.prototype.createDragEvent = function () {
        var _this = this;

        var items = this.$treeWrapper.find('.brtc-va-controls-datatree-li-table div');

        _.forEach(items, function (item) {
            var $item = $(item);
            $item.draggable({
                helper: 'clone',
                appendTo: _this.options.dragTarget,
                start: function (event, ui) {
                    var $target = $(event.target);
                    var tableId = $target.closest('.brtc-va-controls-datatree-li-table').attr('table-id');

                    ui.helper.attr('table-id', tableId);
                }
            });
        });
    };

    DataList.prototype.getSource = function () {
        return this.options.source;
    };

    Brightics.VA.Core.Editors.Sheet.Controls.DataList = DataList;

}).call(this);

(function () {
    'use strict';

    /*
     options = {
     fnUnit: fnUnit,
     rowHeaderType: 'number' or 'custom'
     rowHeaderList: ['aaa', 'bbb'] -> only rowHeaderType is 'custom'
     rowHeaderWidth: 30 -> default 20
     }
     */
    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');

    function DataSelector(parentId, options) {
        this.parentId = parentId;
        this.options = options;

        this.inTargetList = $.extend(true, [], FnUnitUtils.getInTable(this.options.fnUnit));
        this.linkedTargetList = this.getAllTableList(this.options.fnUnit);
        this.command = new Brightics.VA.Core.CompoundCommand(this, {});
        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    DataSelector.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    DataSelector.prototype.createInputUnit = function (unitOptions) {
        var key = unitOptions.key;
        var tableId = unitOptions.tableId;
        var type = unitOptions.type;
        var fnUnit = unitOptions.fnUnit;
        var prevFnUnit = this.getPrevFnUnitByInTableId(fnUnit, tableId);
        var readOnly = unitOptions.readOnly;
    
        var $box = this.createBox(key);
        $box.attr('key', key);
        $box.attr('type', type);
        $box.attr('table-id', tableId);
    
        var $contents = $box.find('.brtc-style-controls-inputselector-box-contents');
        var $figureArea = $contents.find('.brtc-style-controls-inputselector-box-contents-figure');
        var $removeArea = $contents.find('.brtc-style-controls-inputselector-box-contents-remove');
        var $keyArea = $contents.find('.brtc-style-controls-inputselector-box-key');
        var $container = unitOptions.appendTo.find('.brtc-va-editors-sheet-controls-input-list-container');
    
        $container.append($box);
        $contents.append($emptyItem);
    
        var $emptyItem = this.createEmptyItem({
            parent: $figureArea,
            type: type,
            label: unitOptions.emptyLabel,
            readOnly: readOnly
        });
        var $funcItem = this.createFuncItem({
            label: FnUnitUtils.getLabel(prevFnUnit),
            func: FnUnitUtils.getFunc(prevFnUnit),
            type: FnUnitUtils.getTypeByTableId(prevFnUnit, tableId),
            tableId: tableId
        });
        var outputObject = FnUnitUtils.getOutputsToObject(prevFnUnit);
        var $keyItem =  this.createKeyItem({key: outputObject[tableId], type: type});
        var $removeItem = this.createRemoveButton();
    
        $figureArea.append($funcItem);
        $keyArea.append($keyItem);
        if (!readOnly) $removeArea.append($removeItem);
        if (!readOnly) this.createDropEvent($box);
    
        if (tableId) {
            $emptyItem.hide();
            $funcItem.show();
            $keyItem.show();
            $removeItem.show();
        } else {
            $emptyItem.show();
            $funcItem.hide();
            $keyItem.hide();
            $removeItem.hide();
        }
    };
    
    DataSelector.prototype.createSingleTypeItem = function (fnUnit) {
        var clazz = fnUnit.parent().type,
            $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single"></div>'),
            $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz),
            outTable = FnUnitUtils.getOutTable(fnUnit)[0];

        if (!outTable) return;

        $selectedItem.find('.brtc-va-views-palette-fnunit-label').text(fnUnit.display.label);
        $selectedItem.find('.brtc-va-views-palette-fnunit-label').attr('title', fnUnit.display.label);
        $item.attr('value', outTable);
        $item.attr('fid', fnUnit['fid']);
        $selectedItem.addClass('item');

        if (this.inTargetList.indexOf(outTable) >= 0) {
            this.usedDataMap = this.usedDataMap || {};
            this.usedDataMap[outTable] = $.extend(true, {}, $item);
        }
        else {
            this.notUsedDataMap = this.notUsedDataMap || {};
            this.notUsedDataMap[outTable] = $.extend(true, {}, $item);
        }
    };

    DataSelector.prototype.createMultiTypeItem = function (fnUnit, inputTableList) {
        for (var i in FnUnitUtils.getOutTable(fnUnit)) {
            var clazz = fnUnit.parent().type,
                $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single"></div>'),
                label = fnUnit.display.label + '-' + (parseInt(i) + 1),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);


            $selectedItem.find('.brtc-va-views-palette-fnunit-label').text(label);
            $selectedItem.attr('title', label);
            $item.attr('value', FnUnitUtils.getOutTable(fnUnit)[i]);
            $item.attr('fid', fnUnit['fid']);
            $selectedItem.addClass('item');

            if (inputTableList.indexOf(FnUnitUtils.getOutTable(fnUnit)[i]) < 0) {

                this.notUsedDataMap = this.notUsedDataMap || {};
                this.notUsedDataMap[FnUnitUtils.getOutTable(fnUnit)[i]] = $.extend(true, {}, $item);
            } else {
                this.usedDataMap = this.usedDataMap || {};
                this.usedDataMap[FnUnitUtils.getOutTable(fnUnit)[i]] = $.extend(true, {}, $item);
            }

        }
    };
    // DataSelector.prototype.getLinkedTableList = function () {
    //     var model = this.options.fnUnit.parent();
    //     var previousFnUnitList = model.getPrevious(this.options.fnUnit.fid);
    //     var linkedTableList = [];
    //     previousFnUnitList.forEach(function (fid) {
    //         var tableList = model.getFnUnitById(fid)[OUT_DATA];
    //         if (tableList) {
    //             linkedTableList = linkedTableList.concat(tableList)
    //         }
    //     });
    //     return linkedTableList;
    // };

    DataSelector.prototype.insertUsedDataContainer = function () {
        for (var i = 0; i < this.inTargetList.length; i++) {
            this.appendUsedDataItem(this.usedDataMap[this.inTargetList[i]]);
        }
    };

    DataSelector.prototype.appendUsedDataItem = function ($item, index) {
        var _this = this;
        var $itemWrapper = $('<div class="brtc-style-flex-center" style="padding-left: 10px"></div>');
        var $removeButton = $('<span class="brtc-style-editor-content-remove-button"></span>');
        $itemWrapper.append($item);
        $itemWrapper.append($removeButton);

        if (typeof index === 'undefined') {
            this.$selectedContents.append($itemWrapper);
        } else {
            $(this.$selectedContents.children()[index]).after($itemWrapper);
        }
        this.createDropEvent($item);

        $removeButton.click(function () {
            var $removeItem = $item.detach();
            _this.appendNotUsedDataItem($removeItem);
            $itemWrapper.remove();
            _this.setAddableDataContainer();
            _this.configureRowHeader();
            _this.onChangeInputTable();
        });
    };


    DataSelector.prototype.insertNotUsedDataContainer = function () {
        for (var dataKey in this.notUsedDataMap) {
            this.appendNotUsedDataItem(this.notUsedDataMap[dataKey]);
        }
    };

    DataSelector.prototype.appendNotUsedDataItem = function ($item) {
        this.$notUsedDataContainer = this.$notUsedDataContainer || this.getNotUsedDataContainer();
        this.$notUsedDataContainer.append($item);
        this.createNotUsedDataDragEvent($item);
        if ($item.hasClass('ui-droppable')) {
            $item.droppable('destroy');
        }

    };
    DataSelector.prototype.createNotUsedDataDragEvent = function ($item) {
        var _this = this;

        $item.draggable({
            helper: 'clone',
            // start: function () {
            //     var targetList = _this.$selectedContents.find('.brtc-va-editors-sheet-controls-dataselector-item');
            // },
            appendTo: _this.$dataContainer
        });
    };
    DataSelector.prototype.destroyDragEvent = function ($item) {
        $item.on('dragstop', function (event, ui) {
            if ($item.hasClass('ui-draggable') && ui.helper.attr('value') !== event.target.getAttribute('value')) {
                $item.draggable('destroy');
            }
        });
    };
    DataSelector.prototype.getDropFuncTarget = function ($item) {
        return $item.find('.brtc-va-views-palette-fnunit').length == !0 ? $item.find('.brtc-va-views-palette-fnunit') : $item;
    };


    DataSelector.prototype.createDropEvent = function ($item) {
        var _this = this;
        $item.droppable({
            accept: '.brtc-va-editors-sheet-controls-notused-dataselector-contents-wrapper .brtc-va-editors-sheet-controls-dataselector-item, ',
            activate: function (event, ui) {
                console.log(event, ui);
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.addClass('brtc-style-droppable-active');
            },
            deactivate: function (event, ui) {
                console.log(event, ui);
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.removeClass('brtc-style-droppable-active');
                $dropTarget.removeClass('brtc-style-droppable-hover');
            },
            over: function (event, ui) {
                console.log(event, ui);
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.addClass('brtc-style-droppable-hover');
            },
            out: function (event, ui) {
                console.log(event, ui);
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.removeClass('brtc-style-droppable-hover');
            },
            drop: function (event, ui) {
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.removeClass('brtc-style-droppable-active');
                $dropTarget.removeClass('brtc-style-droppable-hover');

                var tableId = $(this).attr('value');
                var $source = ui.draggable;
                if (tableId) {
                    _this.switchData($source, $(this));
                } else {
                    _this.appendUsedDataItem($source);
                    $source.closest('.brtc-va-editors-sheet-controls-notused-dataselector-contents-wrapper').remove();
                    _this.setAddableDataContainer();
                    _this.configureRowHeader();
                }
                _this.destroyDragEvent($source);

                _this.onChangeInputTable();
                _this.$selectedContents.find('.brtc-style-droppable-active').removeClass('brtc-style-droppable-active');
            }
        });
    };
    DataSelector.prototype.switchData = function ($source, $target) {
        var targetIndex = $target.parent().index();
        this.appendUsedDataItem($source, targetIndex);
        this.appendNotUsedDataItem($target);
        $(this.$selectedContents.children()[targetIndex]).remove();
    };


    DataSelector.prototype.getNotUsedDataContainer = function () {
        var $notUsedDataContainer = $('' +
            '<div class="brtc-va-editors-sheet-controls-notused-dataselector-contents brtc-style-controls-notused-dataselector-contents brtc-style-display-flex brtc-style-flex-direction-column">' +
            '   <div>Connected Table</div>' +
            '</div>');
        var $contentsWrapper = $('<div class="brtc-va-editors-sheet-controls-notused-dataselector-contents-wrapper brtc-style-full brtc-style-relative"></div>');
        this.$dataContainer.append($notUsedDataContainer);
        $notUsedDataContainer.append($contentsWrapper);

        return $contentsWrapper;
    };


    DataSelector.prototype.createRowHeaderContents = function () {
        var $parent = this.$dataContainer.find('.brtc-va-editors-sheet-controls-dataselector-contents-wrapper');
        var headerList = [];
        if (this.options.rowHeaderType === 'number') {
            $.each(this.getUsedDataList(), function (index, com) {
                headerList.push(index + 1);
            });
        } else if (this.options.rowHeaderType === 'custom') {
            headerList = this.options.rowHeaderList;
        }

        if (headerList.length === 0) return;

        var rowHeaderWidth = this.options.rowHeaderWidth || 20;

        this.$rowHeaderContentsArea = $('<div class="brtc-style-dataselecter-rowheader-container"></div>');
        $parent.prepend(this.$rowHeaderContentsArea);
        this.$rowHeaderContentsArea.width(rowHeaderWidth);
        for (var i = 0; i < headerList.length; i++) {
            this.$rowHeaderContentsArea.append($('<div class="brtc-style-height-45px brtc-style-flex-center">' + headerList[i] + '</div>'));
        }
    };

    DataSelector.prototype.configureRowHeader = function () {
        if (this.$rowHeaderContentsArea) {
            this.$rowHeaderContentsArea.remove();
        }
        this.createRowHeaderContents();
    };

    DataSelector.prototype.createContents = function ($parent) {
        var clazz = this.options.fnUnit.parent().type;
        var allTableList = this.linkedTargetList;
        var inputTableList = FnUnitUtils.getInTable(this.options.fnUnit);

        this.$selectedContentsContainer = $('<div class="brtc-style-col-12" />');
        this.$selectedContents = $('<div class="brtc-style-col-12" />');

        $parent.append(this.$selectedContentsContainer);
        this.$selectedContentsContainer.append(this.$selectedContents);

        var fnUnits = this.getAllPrevFnUnits(this.options.fnUnit);


        for (var i in allTableList) {
            var fnUnit = _.find(fnUnits, function (fn) {
                return _.indexOf(FnUnitUtils.getOutTable(fn), allTableList[i]) >= 0;
            });

            if (fnUnit && FnUnitUtils.getOutTable(fnUnit).length > 1) {
                this.createMultiTypeItem(fnUnit, inputTableList);
            }
            else if (fnUnit) this.createSingleTypeItem(fnUnit);
        }

        this.insertUsedDataContainer();
        if (this.notUsedDataMap) {
            this.insertNotUsedDataContainer();
        }

        this.setAddableDataContainer();
    };


    DataSelector.prototype.createDataContainer = function ($parent) {
        var _this = this;
        this.$dataContainer = $('' +
            '<div class="brtc-va-editors-sheet-controls-dataselector-container brtc-style-editors-sheet-controls-dataselector-container">' +
            '   <div class="brtc-va-editors-sheet-controls-dataselector-contents brtc-style-display-flex brtc-style-flex-1 brtc-style-flex-direction-column">' +
            '       <div>Selected Table</div>' +
            '       <div class="brtc-va-editors-sheet-controls-dataselector-contents-wrapper brtc-style-full brtc-style-display-flex brtc-style-relative"></div>' +
            '   </div>' +
            '</div>');
        $parent.append(this.$dataContainer);

        this.createContents(this.$dataContainer.find('.brtc-va-editors-sheet-controls-dataselector-contents-wrapper'));

        this.$selectedContents.sortable({
            axis: 'y',
            cancel: '.empty'
        });
        this.$selectedContents.on('sortstop', function () {
            _this.inTargetList = _this.$selectedContents.sortable('toArray', {attribute: 'value'});
            _this.onChangeInputTable();
        });

        this.createRowHeaderContents();

        this.$dataContainer.find('.brtc-va-editors-sheet-controls-dataselector-contents-wrapper').perfectScrollbar();
        this.$dataContainer.find('.brtc-va-editors-sheet-controls-notused-dataselector-contents-wrapper').perfectScrollbar();

    };


    DataSelector.prototype.createControls = function () {
        var _this = this;

        this.$mainControl = $('<div class="brtc-va-editors-sheet-controls-dataselector-editarea">' +
            // '   <div class="brtc-style-dialogs-header brtc-style-slim-header" />' +
            '   <div class="brtc-style-controls-dataselector-content"/>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        // var jqxOptions = {
        //     theme: Brightics.VA.Env.Theme,
        //     position: {
        //         my: "right top",
        //         at: "left top",
        //         of: this.$parent.find('.brtc-va-editors-sheet-controls-dataselector-contents')
        //     },
        //     width: this.options.width,
        //     height: this.options.height,
        //     title: 'Select Table',
        //     modal: false,
        //     showAnimationDuration: 50,
        //     minHeight: 250,
        //     open: function () {
        //         $('.ui-dialog-titlebar.ui-widget-header', $(this).parent()).css({
        //             'width': 'calc(100% - 40px) !important',
        //             'padding-left': '0px !important',
        //             'padding-right': '0px !important',
        //             'margin-left': '20px !important'
        //         });
        //     }
        // };
        // if (!this.options.multiple) {
        //     jqxOptions.height -= 33;
        // }
        // this.$mainControl.dialog(jqxOptions);
        // this.$mainControl.css({
        //     'width': '-webkit-fill-available',
        //     'min-height': '50px',
        //     'max-height': '600px',
        //     'min-width': '100px',
        //     'max-width': '800px'
        // });
        // this.$mainControl.parent().find('.ui-resizable-handle:not(.ui-resizable-s)').hide();

        // this.closeHandler = function (event) {
        //     var $target = $(event.target);

        //     if ($target.attr('class')) {
        //         if ($target.attr('class').indexOf('ui-dialog') > -1) return;
        //     }

        //     if (_this.$mainControl.has(event.target).length === 0) {
        //         _this.$mainControl.dialog('close');
        //     }
        // };
        // _this.$mainControl.on('close', function (event) {
        //     $(window).off('mousedown', this.closeHandler);
        //     _this.$mainControl.dialog('destroy');
        // });

        // _this.$mainControl.parent().on('mousedown', function (event) {
        //     event.stopPropagation();
        // });

        // $(window).on('mousedown', _this.closeHandler);
    };

    DataSelector.prototype.initContents = function () {
        var $contentControl = this.$mainControl.find('.brtc-style-controls-dataselector-content');
        this.createDataContainer($contentControl);
    };

    DataSelector.prototype.onChangeInputTable = function () {
        var _this = this;
        if (typeof _this.options.onChangedHandler === 'function') {
            _this.options.onChangedHandler(_this.getUsedDataList(), this.options.type);
        }
    };

    DataSelector.prototype.getFunctionDef = function (fnUnit) {
        return Brightics.VA.Core.Interface.Functions['data'][fnUnit.func];
    };

    DataSelector.prototype.setAddableDataContainer = function () {
        var selectedDataList = this.getUsedDataList();
        // var funcDefinition = Brightics.VA.Core.Interface.Functions[model.type][this.options.fnUnit.func];
        // var inRange = funcDefinition['in-range'];
        var inRange = FnUnitUtils.getInRange(this.options.fnUnit).table;

        if (selectedDataList.length < inRange.max &&
            this.$selectedContentsContainer.find('.brtc-va-editors-sheet-controls-empty-fnunit').length === 0) {
            var $emptyItemContainer = $('' +
                '<div class="brtc-style-flex-center brtc-va-editors-sheet-controls-empty-fnunit">' +
                '   <div class="brtc-style-controls-dataselector-empty-fnunit">' +
                '       <div>Drop Data</div>' +
                '   </div>' +
                '</div>');
            this.$selectedContentsContainer.append($emptyItemContainer);
            this.createDropEvent($emptyItemContainer.find('.brtc-style-controls-dataselector-empty-fnunit'));
        } else if (selectedDataList.length >= inRange.max &&
            this.$selectedContentsContainer.find('.brtc-va-editors-sheet-controls-empty-fnunit').length === 1) {
            this.$selectedContentsContainer.find('.brtc-va-editors-sheet-controls-empty-fnunit').remove();
        }
    };

    DataSelector.prototype.getUsedDataList = function () {
        var itemList = this.$selectedContents.find('.brtc-va-editors-sheet-controls-dataselector-item');
        var dataList = [];
        for (var i = 0; i < itemList.length; i++) {
            dataList.push($(itemList[i]).attr('value'));
        }
        return dataList;
    };

    DataSelector.prototype.getAllPrevFnUnits = function (fnUnit) {
        var model = fnUnit.parent();
        var fnUnits = model.getAllPreviousFnUnits(fnUnit.fid);
        return fnUnits;
    };

    DataSelector.prototype.getAllTableList = function (fnUnit) {
        return _.flatten(this.getAllPrevFnUnits(fnUnit)
            .filter(function (fn) {
                return !Brightics.VA.Core.Utils.NestedFlowUtils.isProcessFunction(fn);
            })
            .map(function (fn) {
                return FnUnitUtils.getOutTable(fn) || [];
            }));
    };


    Brightics.VA.Core.Editors.Sheet.Controls.DataSelector = DataSelector;


}).call(this);


(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DataTree(parentId, options) {
        this.parentId = parentId;
        this.options = options;

        this.retrieveParent();
        this.createControls();
    }

    DataTree.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    DataTree.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-controls-datatree"></div>');
        this.$treeWrapper = $('<div class="brtc-va-controls-datatree-wrapper"></div>');

        this.$parent.append(this.$mainControl);
        this.$mainControl.append(this.$treeWrapper);

        this.$mainControl.css({
            'width': '100%',
            'height': '100%',
            'float': 'left',
            'background-color': 'white'
        });

        (this.isEmpty())? this.createEmpty() : this.createTree();
    };

    DataTree.prototype.isEmpty = function () {
        var source = this.options.source;

        if (!source || Object.keys(source).length === 0) return true;
        return false; 
    };

    DataTree.prototype.createEmpty = function () {
        var $empty = $('' +
            '<div class="brtc-va-controls-datatree-empty">' +
                '<div class="brtc-va-controls-datatree-empty-contents">No Inputs</div>' +
            '</div>'
            );
        this.$treeWrapper.append($empty);
    };

    DataTree.prototype.createTree = function () {
        var _this = this;

        var $container = $('<ul></ul>');
        this.$treeWrapper.append($container);

        _.forEach(this.options.source, function (map, fid) {
            _this.createTreeElement($container, fid, map);
        });

        this.$treeWrapper.jqxTree({
            height: '100%',
            width: '100%',
            theme: Brightics.VA.Env.Theme,
            allowDrag: false
        });

        this.makeFunctionItem();
        this.addEllipsisClass();
        this.addTypeIcon();

        if (_this.options.draggable) _this.createDragEvent();
    };

    DataTree.prototype.makeFunctionItem = function () {
        var functions = this.$treeWrapper.find('.brtc-va-controls-datatree-li-function');
        
        for (var i=0; i<functions.length; i++) {
            var $function = $(functions[i]); 
            var $oldItem = $function.children('div');
            var $arrow = $function.children('span');
            $arrow.addClass('brtc-style-height-22px');
            var func = $function.attr('func');
            var label = $oldItem.text();

            $oldItem.hide();

            var $newItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteBox({
                func: func,
                label: label
            });

            $newItem.find('.brtc-va-views-palette-fnunit-label').addClass('brtc-style-ellipsis');

            $oldItem.replaceWith($newItem);
        };
    };

    DataTree.prototype.addTypeIcon = function () {
        var items = this.$treeWrapper.find('.brtc-va-controls-datatree-li-table');

        for (var i=0; i<items.length; i++) {
            var $icon = $('<div class="brtc-va-controls-datatree-li-table-icon"></div>');
            $icon.attr('type', $(items[i]).attr('type'));
            $(items[i]).prepend($icon);
        }
    };

    DataTree.prototype.addEllipsisClass = function () {
        var target = this.$treeWrapper.find('.brtc-va-controls-datatree-li-table > div');
        for (var i = 0; i < target.length; ++i) {
            const $target = $(target[i]);
            $target.addClass('brtc-style-ellipsis');
            $target.css('width', '100%');
            $target.attr('title', target[i].innerHTML);
        }
    };

    DataTree.prototype.createTreeElement = function ($container, fid, map) {
        var _this = this;
        var funcLabel = map.label;
        var $funcLi = $('<li class="brtc-va-controls-datatree-li-function">'+ funcLabel +'</li>');

        $container.append($funcLi);

        $funcLi.attr('item-expanded', 'true');

        _.forEach(map.data, function (data, tableId) {
            var $li = $('<li class="brtc-va-controls-datatree-li-table"></li>');
            
            $li.text(data.label);
            $li.attr('key', data.key);
            $li.attr('table-id', tableId);
            $li.attr('type', data.type);
            $li.attr('func', data.func);
            $li.attr('label', funcLabel);

            $funcLi.text(data.funcLabel);
            $funcLi.append('<ul></ul>');
            $funcLi.find('ul').append($li);
            $funcLi.attr('func', data.func);   

            _this.createClickEvent($li);
        });
    };

    DataTree.prototype.createClickEvent = function ($unit) {
        var _this = this;

        $unit.click(function () {
            if (typeof _this.options.onClick === 'function') {
                var key = $(this).attr('key');
                var tableId = $(this).attr('table-id');

                _this.options.onClick({
                    key: key,
                    tableId: tableId
                });
            }
        });
    };

    DataTree.prototype.createDragEvent = function () {
        var _this = this;

        var items = this.$treeWrapper.find('.brtc-va-controls-datatree-li-table .jqx-tree-item');

        _.forEach(items, function (item) {
            var $item = $(item);
            $item.draggable({
                helper: function () {
                    var $helper = $(this).clone();
                    var width = $(this).width();
                    $helper.css({
                        'z-index': 5100,
                        'width': width,
                        'height': '30px',
                        'line-height': '30px',
                        'overflow': 'hidden',
                        'white-space': 'nowrap',
                        'text-overflow': 'ellipsis'
                    }); 
                    return $helper;
                },
                appendTo: _this.options.dragTarget,
                start: function (event, ui) {
                    var $target = $(event.target);
                    var tableId = $target.closest('.brtc-va-controls-datatree-li-table').attr('table-id');

                    ui.helper.attr('table-id', tableId);
                }
            });
        });
    };

    DataTree.prototype.getSource = function () {
        return this.options.source;
    };

    Brightics.VA.Core.Editors.Sheet.Controls.DataTree = DataTree;

}).call(this);

/**
 * Source:
 * Created by daewon.park on 2017-05-24.
 */

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');

    const PANEL_TYPE_IN = 'in';
    const PANEL_TYPE_OUT = 'out';
    const DATA_POST_FIX = 'Data';
    const CHART_TYPE_LIST = ['scatter', 'line', 'pie', 'column', 'column-stacked', 'column-stacked-100', 'bar', 'bar-stacked', 'bar-stacked-100', 'boxplot', 'area', 'area-stacked', 'area-stacked-100', 'histogram', 'roccurve', 'bubble', 'card', 'heatmap', 'heatmap-matrix', 'treemap', 'donut'];

    function BigDataWorksheet(parentId, options, dataInfo) {
        Brightics.VA.Core.Editors.Sheet.Controls.DataWorksheet.call(this, parentId, options, dataInfo);
    }

    BigDataWorksheet.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Controls.DataWorksheet.prototype);
    BigDataWorksheet.prototype.constructor = BigDataWorksheet;

    BigDataWorksheet.prototype._init = function () {
        var wsOption = this.getDataWorksheetOption('full');
        this.chartOptions = {};
        var hideToolbarOpt = {type: 'custom', show: 'false'};

        if (wsOption.panel.length === 0) {
            wsOption.panel.push({
                id: 'default-chart' + Date.now(),
                chartOption: {
                    chart: {
                        type: 'scatter'
                    },
                    toolbar: hideToolbarOpt
                },
                chartTypeList: CHART_TYPE_LIST
            });
            wsOption.panel.push({
                id: 'default-table' + Date.now(),
                chartOption: {
                    chart: {
                        type: 'table'
                    }
                },
                chartTypeSelectable: false
            });

            for (var i in wsOption.panel) {
                var panel = wsOption.panel[i];
                panel.chartOption = $.extend(true, {}, Brightics.Chart.Registry[panel.chartOption.chart.type || 'table'].DefaultOptions, panel.chartOption);
            }
            wsOption.layout = {
                type: 'splitter',
                direction: 'horizontal',
                ratio: '60%',
                items: [{
                    'id': wsOption.panel[0].id,
                    'type': 'panel'
                }, {
                    'id': wsOption.panel[1].id,
                    'type': 'panel'
                }]
            }
        } else {
            for (var i = 0; i < wsOption.panel.length; i++) {
                if (wsOption.panel[i].chartTypeList) {
                    wsOption.panel[i].chartTypeList = CHART_TYPE_LIST;
                }
                if (wsOption.panel[i].chartOption) {
                    wsOption.panel[i].chartOption.toolbar = $.extend(true, {}, wsOption.panel[i].chartOption.toolbar, hideToolbarOpt);
                }
            }
        }

        this.options.style = {
            width: '100%',
            height: '100%'
        };
        this.options.worksheet = {
            panel: wsOption.panel,
            layout: wsOption.layout
        };
    };


    BigDataWorksheet.prototype.createControls = function () {
        var _this = this;
        this.$parent.empty();

        this.$mainControl = $('<div class="brtc-va-editors-sheet-controls-dataworksheet brtc-va-editors-sheet-controls-big-dataworksheet"></div>');
        this.$mainControl.css({
            width: '100%',
            height: '100%'
        });
        this.$parent.append(this.$mainControl);

        // this.options.worksheet.$panelSelectionGroup = _this.$mainControl.closest('.brtc-va-editors-sheet-fnunitviewer');
        this.options.worksheet.onChangeLayout = this.onChangeLayout.bind(this);
        this.options.worksheet.onChangeChart = this.onChangeChart.bind(this);
        this.options.worksheet.onSelectChart = this.onSelectChart.bind(this);
        this.options.columnConf = {
            scatter: {
                xAxis: {
                    aggregationEnabled: false,
                    axisTypeList: []
                },
                yAxis: {
                    aggregationEnabled: true
                },
                colorBy: {
                    aggregationEnabled: false,
                    multiple: true
                }
            },
            line: {
                xAxis: {
                    aggregationEnabled: false,
                    axisTypeList: []
                },
                yAxis: {
                    aggregationEnabled: true
                },
                colorBy: {
                    aggregationEnabled: false,
                    multiple: true
                }
            },
            boxplot: {
                xAxis: {
                    axisTypeList: []
                }
            }
        };

        for (var i in this.options.worksheet.panel) {
            this.options.worksheet.panel[i].chartOption.source = this._getPanelSource(this.options.worksheet.panel[i]);
            this.options.worksheet.panel[i].chartOption.guide = this._getGuideOption();
            this.options.worksheet.panel[i].dataSource = this._setPanelDataSource(i);
        }

        this.options.component = {
            right: {
                chartOption: true
            }
        };

        this.options.worksheet.toolbar = {
            menu: {
                multichart: {
                    title: 'MultiChart',
                    click: function () {
                        var panel = this;
                        _this._handleOpenMultiChart(panel);
                    }
                },
                report: {
                    title: 'Add to Report',
                    click: function () {
                        var panel = this;
                        _this._handleAddToReport(panel);
                    }
                },
                setting: {
                    click: function () {
                        var panel = this;
                        _this._handleChartSettings(panel);
                    }
                }
            }
        };

        this.$mainControl.bchartsAdonis(this.options);

        this.$mainControl.find('.bcharts-ws-panel-chart-selector[chart="table"]').css({
            "background-image": "none",
            "pointer-events": "none"
        });

        this.bindEventHandlers();

        this._initDataWorkSheet();

        
        // this.removeAddReport();
    };


    BigDataWorksheet.prototype._getLazyData = function (tableIndex) {
        var _this = this;
        var fnUnit = this.options.fnUnit;
        var model = fnUnit.parent();
        var panelType = this.dataInfo.panelType;
        var tableList = FnUnitUtils.getTable(fnUnit, panelType);
        var tableId = tableList[tableIndex];
        var preFnUnit = model.getFnUnitByOutTable(tableId);

        if (tableId) {
            return {
                id: {
                    value: tableId,
                    label: preFnUnit.display.label
                },
                columns: function () {
                    return _this._tableMap[tableId].columns
                },
                data: function (prepare) {
                    if (prepare.options.chart.type === 'table') {
                        setTimeout(function () {
                            try {
                                prepare.done({
                                    dataType: 'rawdata',
                                    columns: _this._tableMap[tableId].columns,
                                    data: _this._tableMap[tableId].data,
                                    count: _this._tableMap[tableId].count,
                                    offset: _this._tableMap[tableId].offset,
                                });
                            } catch (e) {
                                Logger.error(e.stack, {category: 'Chart'});
                            }
                        }, 100);
                    } else {
                        _this._executeBigDataRendering(prepare, tableId);
                    }

                }
            }
        } else {
            return {
                id: {
                    value: ''
                },
                columns: function () {
                    return [];
                },
                data: function (prepare) {
                    setTimeout(function () {
                        prepare.done({
                            dataType: 'rawdata',
                            columns: [],
                            data: [],
                            count: 0,
                            offset: _this._tableMap[tableId].offset,
                        });

                    }, 100);
                }
            }
        }
    };

    BigDataWorksheet.prototype._executeBigDataRendering = function (prepare, tableId) {
        var _this = this;

        var options = prepare.options;
        var outTable = Brightics.VA.Core.Utils.IDGenerator.table.id();
        var fnUnit = Brightics.VA.Core.Utils.FullRenderingUtils.getFnUnit(options);
        fnUnit[IN_DATA].push(tableId);
        fnUnit[OUT_DATA].push(outTable);
        fnUnit.persist = false;

        var model = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl).getModel();
        Brightics.VA.Core.Utils.ModelUtils.extendParent(model, fnUnit);

        var launchOptions = {hideDialog: true};

        prepare.aborted = function () {
            if (this.jid) {
                Studio.getJobExecutor().terminate(this.jid);
            }
        };

        /** getRenderedData(function, launcher, launchoptions, successCallback, failCallback, jobIdCallback) **/
        Brightics.VA.Core.Utils.FullRenderingUtils.getRenderedData(fnUnit, Studio.getJobExecutor(), launchOptions,
            function (data, tableId) {
                prepare.done(data);
            }, function (data, tableId, err) {
                if (err && err.message) {
                    prepare.fail(err.message);
                } else if (err && err.errorInfo.length > 0) {
                    var messages = err.errorInfo.map(function (item) {
                        return item.message;
                    });
                    prepare.fail(messages);
                } else {
                    prepare.fail('Failed to get data.');
                }
            }, function (jid) {
                prepare.jid = jid;
            }
        );
    };

    BigDataWorksheet.prototype.bindEventHandlers = function () {
        var _this = this;
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        if (modelEditor) {
            this.commandListener = function (command) {
                if (command.event.source.dataInfo
                    && command.event.source.dataInfo.fid === _this.dataInfo.fid
                    && command.event.source.dataInfo.table === _this.dataInfo.table
                    && command.event.source instanceof Brightics.VA.Core.Editors.Sheet.Controls.BigDataWorksheet) {
                    if (command.event.type == 'REDO') _this.redo(command);
                    else if (command.event.type == 'UNDO') _this.undo(command);
                }
            };
            modelEditor.addCommandListener(this.commandListener);
        }
    };

    BigDataWorksheet.prototype.onAddChart = function (panelOption, layout) {
    };

    BigDataWorksheet.prototype.onRemoveChart = function (panelOption, layout) {
    };

    BigDataWorksheet.prototype.setDataSet = function (tableId, data) {
        for (var i in this.options.worksheet.panel) {
            if (this.options.worksheet.panel[i].chartOption.chart.type === 'table') {
                this._tableMap[tableId].columns = data.columns;
                this._tableMap[tableId].data = data.data;
                this.$mainControl.bchartsAdonis('refreshChartPanel', this.options.worksheet.panel[i].id);
            }
        }
    };

    BigDataWorksheet.prototype.onSelectChart = function (panelOptions) {
        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');
        if ($dialog.is(':visible')) {
            this.$chartOptionPanel = this.$mainControl.find('.bcharts-option-panel');
            if (this.$chartOptionPanel.length > 0) {
                this._detachChartOptionPanel();
                this._attachChartOptionPanelToDialog(this.$chartOptionPanel);
            }
        }

        var tableIndex = 0;
        this._selectedPanelOptions = panelOptions;
        if (panelOptions && panelOptions.tableIndexes && panelOptions.tableIndexes[0]) tableIndex = panelOptions.tableIndexes[0];

        var showPageSelector = true;
        if (panelOptions && panelOptions.chartOption && panelOptions.chartOption.chart.type !== 'table') showPageSelector = false;

        var pageInfo = this.getPaginationInfoByTableIndex(tableIndex);
        pageInfo.showPageSelector = showPageSelector;
        this.options.callback.setPaginationInfo(pageInfo);
    };


    BigDataWorksheet.prototype._setPanelDataSource = function (panelIndex) {
        var _this = this;
        var dataSource = {
            selectable: true,
            getDataSourceList: function () {
                return _this._getDataSourceList();
            },
            getDataSourceColumnList: function (id) {
                return _this._tableMap[id].columns
            },
            onDataSourceChangedCallBack: function (panelId, idList) {
                idList.forEach(function (id) {
                    _this._tableMap[id] = _this._tableMap[id] || {};
                });
                _this._queryTables(function () {
                    var compoundCommand = new Brightics.VA.Core.CompoundCommand(_this, {label: 'Change DataSource In Big Data WorkSheet'});
                    for (var i in _this.options.worksheet.panel) {
                        var panel = _this.options.worksheet.panel[i];
                        var command = new Brightics.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand(_this, {
                            panel: panel,
                            ref: {
                                panel: {
                                    tableIndexes: _this._getTableIndexes(idList)
                                }
                            }
                        });

                        compoundCommand.add(command);
                    }
                    _this.executeCommand(compoundCommand);
                    for (var i in _this.options.worksheet.panel) {
                        var panel = _this.options.worksheet.panel[i];
                        _this.$mainControl.bchartsAdonis('setDataSource', panel.id, _this._getPanelSource(panel));
                    }

                    var panelOptions = _this.options.worksheet.panel[1];
                    var tableIndex = 0;
                    if (panelOptions && panelOptions.tableIndexes && panelOptions.tableIndexes[0]) tableIndex = panelOptions.tableIndexes[0];
                    var pageInfo = _this.getPaginationInfoByTableIndex(tableIndex);
                    if (_this.options.callback && typeof _this.options.callback.setPaginationInfo === 'function') {
                        _this.options.callback.setPaginationInfo(pageInfo);
                    }
                });

            }
        };
        return dataSource
    };

    BigDataWorksheet.prototype._initDataWorkSheet = function () {
        if (this.options.worksheet.panel.length > 0) {
            this.$mainControl.bchartsAdonis('selectChartPanel', this.options.worksheet.panel[1].id)
        }
    };


    BigDataWorksheet.prototype._onChangeDataSourceCommand = function (command) {
        this.$mainControl.bchartsAdonis('setDataSource', command.options.panel.id, this._getSourceByTableIndexes(command.options.panel.tableIndexes));
    };

    BigDataWorksheet.prototype.removeAddReport = function () {
        var panelType = this.dataInfo.panelType;
        if (panelType === PANEL_TYPE_IN) {
            var inTableList = FnUnitUtils.getInTable(this.options.fnUnit);
            for (var i in inTableList) {
                var preFnUnit = this.options.fnUnit.parent().getPreFnUnitByCondition(this.options.fnUnit.fid, function (fnUnit) {
                    return $.inArray(inTableList[i], FnUnitUtils.getOutTable(fnUnit)) > -1;
                });
                if (preFnUnit.func === 'load') {
                    this.$mainControl.find('.bcharts-ws-panel-toolbar .bcharts-ws-panel-toolitem[action="report"]').css({display: 'none'})
                }
            }
        } else if (panelType === PANEL_TYPE_OUT && this.options.fnUnit.func === 'load') {
            this.$mainControl.find('.bcharts-ws-panel-toolbar .bcharts-ws-panel-toolitem[action="report"]').css({display: 'none'})
        }
    };

    Brightics.VA.Core.Editors.Sheet.Controls.BigDataWorksheet = BigDataWorksheet;

}).call(this);    
/**
 * Created by ng1123.kim on 2016-02-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     * options: {
     *      panel: [],
     *      layout: {},
     *      data: {},
     * }
     *
     * dataInfo: {
     *      mid: {String},
     *      fid: {String},
     *      fnUnitLabel: {String}
     * }
     * @param parentId
     * @param options
     * @param {object} dataInfo - for Report
     * @constructor
     */
    function SingleDataWorksheet(parentId, options, dataInfo) {
        this.parentId = parentId;
        this.options = options;
        this.dataInfo = dataInfo;
        this.controls = {};

        this.retrieveParent();
        this.createControls();
        this.bindEventHandlers();
    }

    SingleDataWorksheet.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SingleDataWorksheet.prototype.createControls = function () {
        var _this = this;

        this.$mainControl = $('<div class="brtc-va-editors-sheet-controls-dataworksheet"></div>');
        this.$mainControl.css({
            width: '100%',
            height: '100%'
        });
        this.$parent.append(this.$mainControl);


        this.chartOptions = {};

        this.options.worksheet.$panelSelectionGroup = _this.$mainControl.closest('.brtc-va-editors-sheet-fnunitviewer');
        this.options.worksheet.onAddChart = this.onAddChart.bind(this);
        this.options.worksheet.onRemoveChart = this.onRemoveChart.bind(this);
        this.options.worksheet.onChangeLayout = this.onChangeLayout.bind(this);
        this.options.worksheet.onChangeChart = this.onChangeChart.bind(this);
        this.options.worksheet.onSelectChart = this.onSelectChart.bind(this);

        if (this.options.worksheet.panel.length === 0) {
            this.options.worksheet.panel.push({
                id: 'default-' + Date.now(),
                chartOption: {
                    chart: {
                        type: 'table'
                    },
                    plotOptions: {
                        table: {
                            formatter: []
                        }
                    }
                }
            });
        }

        var source = {
            dataType: 'lazy',
            lazyData: [{
                columns: function () {
                    return _this.options.dataSet.columns;
                },
                data: function (prepare) {
                    setTimeout(function () {
                        prepare.done({
                            dataType: 'rawdata',
                            columns: _this.options.dataSet.columns,
                            data: _this.options.dataSet.data,
                            count: _this.options.dataSet.count,
                            offset: _this.options.dataSet.offset
                        });
                    }, 100);
                }
            }]
        };
        for (var i in this.options.worksheet.panel) {
            this.options.worksheet.panel[i].chartOption.source = source;
        }

        this.options.worksheet.toolbar = {
            menu: {
                //multichart: {
                //    title: 'MultiChart',
                //    click: function () {
                //        var panel = this;
                //        _this._handleOpenMultiChart(panel);
                //    }
                //},
                report: {
                    title: 'Add to Report',
                    click: function () {
                        var panel = this;
                        _this._handleAddToReport(panel);
                    }
                },
                setting: {
                    click: function () {
                        var panel = this;
                        _this._handleChartSettings(panel);
                    }
                },
                duplicate: {},
                close: {}
            }
        };

        this.$mainControl.bchartsAdonis(this.options);
    };

    SingleDataWorksheet.prototype._handleChartSettings = function (panel) {
        this._openChartSettingsDialog();
        this.onSelectChart();
    };

    SingleDataWorksheet.prototype._attachChartOptionPanelToDialog = function ($chartOptionPanel) {
        $chartOptionPanel.data('original-parent', $chartOptionPanel.parent());
        $chartOptionPanel.detach();

        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');
        $dialog.find('.brtc-va-dialog-contents').append($chartOptionPanel);
    };

    SingleDataWorksheet.prototype._detachChartOptionPanel = function () {
        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');
        $dialog.find('.bcharts-option-panel').each(function (index, element) {
            var $chartOptionPanel = $(element);
            var $parent = $chartOptionPanel.data('original-parent');
            $chartOptionPanel.detach().appendTo($parent);
        });
    };

    SingleDataWorksheet.prototype._openChartSettingsDialog = function () {
        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');

        var visible = $dialog.is(':visible');
        if (visible) {
            var clientWidth = $dialog.parent().width();
            var clientHeight = $dialog.parent().height();
            var offset = $dialog.offset();
            var width = $dialog.outerWidth();
            var height = $dialog.outerHeight();
            if (offset.left + width > clientWidth) {
                visible = false;
            }
            if (offset.top + height > clientHeight) {
                visible = false;
            }
        }
        if (visible == false) {
            var offset = this.$mainControl.offset();
            offset.right = offset.left + this.$mainControl.outerWidth();
            offset.bottom = offset.top + this.$mainControl.outerHeight();
            var width = $dialog.outerWidth();
            var height = $dialog.outerHeight();
            offset.top -= 50;
            if (offset.top + height > offset.bottom) {
                offset.top = offset.bottom - height - 20;
            }
            offset.left = offset.right - width;
            $dialog.css({
                left: offset.left,
                top: offset.top
            });

            $dialog.show();
        }
    };

    SingleDataWorksheet.prototype.arrange = function (direction) {
        this.$mainControl.bchartsAdonis('layout', direction);
    };

    SingleDataWorksheet.prototype.onAddChart = function (panelOption, layout) {
        var existPanels = $.grep(this.options.worksheet.panel, function (element, index) {
            return element.id == panelOption.id;
        });
        if (existPanels.length === 0) {
            var compoundCommand = new Brightics.VA.Core.CompoundCommand(this, {
                id: 'brightics.va.editors.diagram.commands.addchartcommand'
            });
            compoundCommand.add(this.createNewChartCommand(panelOption));
            compoundCommand.add(this.createSetDataWorksheetLayoutCommand(layout));

            this.executeCommand(compoundCommand);
        }
    };

    SingleDataWorksheet.prototype.onRemoveChart = function (panelOption, layout) {
        var existPanels = $.grep(this.options.worksheet.panel, function (element, index) {
            return element.id == panelOption.id;
        });
        if (existPanels.length > 0) {
            var compoundCommand = new Brightics.VA.Core.CompoundCommand(this, {
                id: 'brightics.va.editors.diagram.commands.removechartcommand'
            });
            compoundCommand.add(this.createRemoveChartCommand(panelOption));
            compoundCommand.add(this.createSetDataWorksheetLayoutCommand(layout));

            this.executeCommand(compoundCommand);
        }
        ;
    };

    SingleDataWorksheet.prototype.onChangeLayout = function (layout) {
        if (JSON.stringify(this.options.worksheet.layout) !== JSON.stringify(layout)) {
            this.executeCommand(this.createSetDataWorksheetLayoutCommand(layout));
        }
    };

    SingleDataWorksheet.prototype._assignArray = function (targetObject, sourceObject) {
        for (var key in sourceObject) {
            if ($.isPlainObject(sourceObject[key])) {
                this._assignArray(targetObject[key], sourceObject[key]);
            } else if ($.isArray(sourceObject[key])) {
                targetObject[key] = $.extend(true, [], sourceObject[key]);
            }
        }
    };

    SingleDataWorksheet.prototype._mergeArraySafely = function (targetObject, sourceObject) {
        var merged = $.extend(true, {}, targetObject, sourceObject);
        this._assignArray(merged, sourceObject);
        return merged;
    };

    SingleDataWorksheet.prototype.onChangeChart = function (panelOption, changedOption) {
        var original = this.chartOptions[panelOption.id];
        var changed = this._mergeArraySafely(this.chartOptions[panelOption.id], changedOption);
        if (JSON.stringify(original) !== JSON.stringify(changed)) {
            // TODO Chart Option Panel ?�서 clone ?��? ?�고 event �?발생?�키�??�문??Command ?�우기전??clone ?�줘???�다.
            var changing = $.extend(true, {}, changedOption);
            delete changing.source;
            var command = new Brightics.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand(this, {
                panelOption: panelOption,
                ref: {
                    chartOption: changing
                }
            });
            this.executeCommand(command);
        }
    };

    SingleDataWorksheet.prototype.onSelectChart = function () {
        var $dialog = this.$mainControl.closest('.brtc-va-editors-modeleditor').children('.brtc-va-dialog.brtc-va-chart-settings');
        if ($dialog.is(':visible')) {
            this.$chartOptionPanel = this.$mainControl.find('.bcharts-option-panel');
            if (this.$chartOptionPanel.length > 0) {
                this._detachChartOptionPanel();
                this._attachChartOptionPanelToDialog(this.$chartOptionPanel);
            }
        }
    };

    SingleDataWorksheet.prototype.bindEventHandlers = function () {
        var _this = this;
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        if (modelEditor) {
            this.commandListener = function (command) {
                if (command.event.source.dataInfo
                    && command.event.source.dataInfo.fid === _this.dataInfo.fid
                    && command.event.source.dataInfo.table === _this.dataInfo.table
                    && !(command.event.source instanceof Brightics.VA.Core.Editors.Sheet.Controls.BigDataWorksheet)) {
                    if (command.event.type == 'REDO') _this.redo(command);
                    else if (command.event.type == 'UNDO') _this.undo(command);
                }
            };
            modelEditor.addCommandListener(this.commandListener);
        }
    };

    SingleDataWorksheet.prototype.unbindEventHandlers = function () {
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        if (modelEditor && this.commandListener) {
            modelEditor.removeCommandListener(this.commandListener);
            this.commandListener = null;
        }
    };

    SingleDataWorksheet.prototype.redo = function (command) {
        if (command instanceof Brightics.VA.Core.CompoundCommand) {
            if (command.getId() === 'brightics.va.editors.diagram.commands.addchartcommand') this.onNewChartCommand(command);
            else if (command.getId() === 'brightics.va.editors.diagram.commands.removechartcommand') this.onRemoveChartCommand(command);
            else for (var i in command.commandList) this.redo(command.commandList[i]);
        }
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewChartCommand) this.onNewChartCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveChartCommand) this.onRemoveChartCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand) this.onSetDataWorksheetLayoutCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand) this.onSetContentsPanelCommand(command);
    };

    SingleDataWorksheet.prototype.undo = function (command) {
        if (command instanceof Brightics.VA.Core.CompoundCommand) {
            if (command.getId() === 'brightics.va.editors.diagram.commands.addchartcommand') this.onNewChartCommand(command);
            else if (command.getId() === 'brightics.va.editors.diagram.commands.removechartcommand') this.onRemoveChartCommand(command);
            else for (var i = command.commandList.length - 1; i >= 0; i--) this.undo(command.commandList[i]);
        }
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewChartCommand) this.onNewChartCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveChartCommand) this.onRemoveChartCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand) this.onSetDataWorksheetLayoutCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand) this.onSetContentsPanelCommand(command);
    };

    SingleDataWorksheet.prototype.onNewChartCommand = function (command) {
        if (command.event.type == 'REDO') {
            this.$mainControl.bchartsAdonis('addChartPanel', command.options.panelOption);
        } else {
            this.$mainControl.bchartsAdonis('removeChartPanel', command.options.panelOption.id);
        }
    };

    SingleDataWorksheet.prototype.onRemoveChartCommand = function (command) {
        if (command.event.type == 'REDO') {
            this.$mainControl.bchartsAdonis('removeChartPanel', command.options.panelOption.id);
        } else {
            this.$mainControl.bchartsAdonis('addChartPanel', command.options.panelOption);
        }
    };

    SingleDataWorksheet.prototype.onSetDataWorksheetLayoutCommand = function (command) {
        this.$mainControl.bchartsAdonis('layout', command.options.layout);
    };

    SingleDataWorksheet.prototype.onSetContentsPanelCommand = function (command) {
        this.chartOptions[command.options.panelOption.id] = command.options.panelOption.chartOption;
        this.$mainControl.bchartsAdonis('setChartOptions', command.options.panelOption.id, command.options.panelOption.chartOption);
    };

    SingleDataWorksheet.prototype.createNewChartCommand = function (panelOption) {
        var newChartCommand = new Brightics.VA.Core.Editors.Diagram.Commands.NewChartCommand(this, {
            panel: this.options.worksheet.panel,
            panelOption: panelOption
        });

        return newChartCommand;
    };

    SingleDataWorksheet.prototype.createRemoveChartCommand = function (panelOption) {
        var removeChartCommand = new Brightics.VA.Core.Editors.Diagram.Commands.RemoveChartCommand(this, {
            panel: this.options.worksheet.panel,
            panelOption: panelOption
        });

        return removeChartCommand;
    };

    SingleDataWorksheet.prototype.createSetDataWorksheetLayoutCommand = function (newLayout) {
        var setDataWorksheetLayoutCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand(this, {
            layout: this.options.worksheet.layout,
            newLayout: newLayout
        });

        return setDataWorksheetLayoutCommand;
    };

    SingleDataWorksheet.prototype.executeCommand = function (command) {
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        modelEditor.getCommandManager().execute(command);
    };

    SingleDataWorksheet.prototype._handleOpenMultiChart = function (panel) {
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);
        var param = {
            user: Brightics.VA.Env.Session.userId,
            pid: modelEditor.options.editorInput.getProjectId(),
            mid: this.dataInfo.mid,
            fid: this.dataInfo.fid,
            tid: this.dataInfo.table,
            cid: panel.getOptions().id
        };
        var params = $.map(param, function (value, key) {
            return key + '=' + value;
        }).join('&');
        window.open('multichart?' + params, 'multiChart');
    };

    SingleDataWorksheet.prototype._handleAddToReport = function (panel) {
        var _this = this;

        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
        var panelTitle = this.$mainControl.closest('.brtc-va-editors-sheet-panels-basepanel').find('.brtc-va-editors-sheet-panels-basepanel-header-title').text();

        if (Brightics.VA.Implementation.Visual) {
            var resourceManager = Studio.getResourceManager();
            var projectId = modelEditor.options.editorInput.getProjectId();
            var projectLabel = resourceManager.getProject(projectId).getLabel();
            var visualModels = resourceManager.getFilesByModelType(projectId, Brightics.VA.Implementation.Visual.Clazz);

            var modelLabel = modelEditor.options.editorInput.getLabel();
            var functionLabel = _this.dataInfo.fnUnitLabel;
            if (visualModels.length) {
                new Brightics.VA.Implementation.Visual.Dialogs.SelectVisualModelDialog(_this.$mainControl, {
                    projectId: projectId,
                    projectLabel: projectLabel,
                    visualModels: visualModels,
                    modelId: _this.dataInfo.mid,
                    tableId: _this.dataInfo.table,
                    defaultDataSourceLabel: modelLabel + '-' + functionLabel + '-' + panelTitle,
                    close: function (dialogResult) {
                        if (dialogResult.OK) {
                            Brightics.VA.Implementation.Visual.Utils.ModelUtils.addChartContentToSelectedVisualModel({
                                resourceManager: resourceManager,
                                dataSourceLabel: (dialogResult.dataSourceLabel) ?
                                    (dialogResult.dataSourceLabel) :
                                    (modelLabel + '-' + functionLabel + '-' + panelTitle),
                                selectedModels: dialogResult.selectedModels,
                                projectId: projectId,
                                modelId: _this.dataInfo.mid,
                                tableId: _this.dataInfo.table,
                                chartOptions: $.extend(true, {}, panel.getOptions().chartOption),
                                columns: $.extend(true, [], Brightics.VA.Core.DataQueryTemplate.getSchema(_this.dataInfo.mid, _this.dataInfo.table)),
                                changeLabel: dialogResult.changeLabel
                            });
                            Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Successfully Added To The Report.');
                        }
                    },
                    resizable: true,
                    title: 'Select Reports to Add'
                });
            }
            else {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('No report in this project. Create a report in this project.');
            }
        }
    };

    SingleDataWorksheet.prototype.destroy = function () {
        this.unbindEventHandlers();
        this.$mainControl.bchartsAdonis('destroy');
    };

    SingleDataWorksheet.prototype.setDataSet = function (dataSet) {
        this.options.dataSet = dataSet;
        this.$mainControl.bchartsAdonis('refreshChartPanel');
    };

    Brightics.VA.Core.Editors.Sheet.Controls.SingleDataWorksheet = SingleDataWorksheet;

}).call(this);

/**
 * Created by jhoon80.park on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;

    var Brightics = root.Brightics;
    var PropertyControl = Brightics.VA.Core.Editors.Sheet.Controls.PropertyControl;

    GridControl.prototype = Object.create(PropertyControl.prototype);

    function GridControl(parentId, options) {
        PropertyControl.call(this, parentId, options);
    }

    GridControl.prototype.setContents = function ($parents) {
        var columns = [];
        var columnsLength = this.options.value.length;
        var columnswidth = 100/columnsLength + "%";
        for (var i = 0; i < columnsLength; i++) {
            columns[i] = {text: this.options.value[i] , width: columnswidth, align: "center", cellsalign:"center"};
        }
        this.$contentsControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-grid" style="margin: 10px;"/>');
        this.$contentsControl.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: "85%",
            height: "200px",
            rowsheight: 25,
            editable: true,
            columns: columns
        });
        this.$contentsControl.jqxGrid('addrow', null, {});

        $parents.append(this.$contentsControl);

    };

    root.Brightics.VA.Core.Editors.Sheet.Controls.GridControl = GridControl;

}).call(this);

(function () {
    'use strict';

    /*
     options = {
     fnUnit: fnUnit,
     rowHeaderType: 'number' or 'custom'
     rowHeaderList: ['aaa', 'bbb'] -> only rowHeaderType is 'custom'
     rowHeaderWidth: 30 -> default 20
     }
     */
    var root = this;
    var Brightics = root.Brightics;
    var FnUnitUtils = brtc_require('FnUnitUtils');
    var FnUnitInputs = brtc_require('FnUnitInputs');

    function InputSelector(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.keyMap = {};

        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    InputSelector.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    InputSelector.prototype.createControls = function () {
        var _this = this;

        this.$mainControl = $('' +
            '<div class="brtc-va-editors-sheet-controls-inputselector-editarea">' +
            '   <div class="brtc-style-controls-inputselector-content"/>' +
            '</div>');

        var jqxOptions = {
            theme: Brightics.VA.Env.Theme,
            position: {
                my: "left top",
                at: "right top",
                of: this.$parent
                // of: this.$parent.find('.brtc-va-editors-sheet-controls-dataselector-contents')
            },
            appendTo: 'body',
            width: 600,
            height: 550,
            title: 'Set Inputs',
            modal: false,
            showAnimationDuration: 50,
            minHeight: 250,
            open: function () {
                $('.ui-dialog-titlebar.ui-widget-header', $(this).parent()).css({
                    'width': 'calc(100% - 40px) !important',
                    'padding-left': '0px !important',
                    'padding-right': '0px !important',
                    'margin-left': '20px !important'
                });
            }
        };
        if (!this.options.multiple) {
            jqxOptions.height -= 33;
        }

        $.extend(jqxOptions, this.options);

        this.$mainControl.dialog(jqxOptions);
        this.$mainControl.css({
            'width': '-webkit-fill-available',
            'min-height': '50px',
            'max-height': '600px',
            'min-width': '100px',
            'max-width': '800px'
        });
        this.$mainControl.parent().find('.ui-resizable-handle:not(.ui-resizable-s)').hide();

        this.closeHandler = function (event) {
            var $target = $(event.target);

            if ($target.attr('class')) {
                if ($target.attr('class').indexOf('ui-dialog') > -1) return;
            }

            if (_this.$mainControl.has(event.target).length === 0) {
                _this.$mainControl.dialog('close');
            }
        };
        _this.$mainControl.on('dialogclose', function (event) {
            $(window).off('mousedown', this.closeHandler);
            _this.$mainControl.dialog('destroy');
        });

        _this.$mainControl.parent().on('mousedown', function (event) {
            event.stopPropagation();
        });

        $(window).on('mousedown', _this.closeHandler);
    };

    InputSelector.prototype.reset = function () {
        this.initContents();
    };

    InputSelector.prototype.initContents = function () {
        var $contentControl = this.$mainControl.find('.brtc-style-controls-inputselector-content');
        $contentControl.empty();

        var $sourceWrapper = $('<div class="brtc-style-controls-inputselector-content-source-wrapper brtc-style-margin-right-10"></div>');
        var $inputWrapper = $('<div class="brtc-style-controls-inputselector-content-inputs-wrapper"></div>');

        this.$sourceArea = $('<div class="brtc-style-controls-inputselector-content-source"></div>');
        this.$inputArea = $('<div class="brtc-style-controls-inputselector-content-input"></div>');

        $sourceWrapper.append(this.$sourceArea);
        $inputWrapper.append(this.$inputArea);

        $contentControl.append($sourceWrapper).append($inputWrapper);

        this.createSourceContainer(this.$sourceArea);
        this.createInputContainer(this.$inputArea);
    };

    InputSelector.prototype.getDropFuncTarget = function ($item) {
        return $item.find('.brtc-va-views-palette-fnunit').length == !0 ? $item.find('.brtc-va-views-palette-fnunit') : $item;
    };

    InputSelector.prototype.createDropEvent = function ($item) {
        var _this = this;
        $item.droppable({
            accept: '.brtc-va-controls-datatree-li-table .ui-draggable',
            activate: function (event, ui) {
                var type = ui.draggable.attr('type');
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.addClass('brtc-style-droppable-active');
            },
            deactivate: function (event, ui) {
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.removeClass('brtc-style-droppable-active');
                $dropTarget.removeClass('brtc-style-droppable-hover');
            },
            over: function (event, ui) {
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.addClass('brtc-style-droppable-hover');
            },
            out: function (event, ui) {
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.removeClass('brtc-style-droppable-hover');
            },
            drop: function (event, ui) {
                var $source = ui.draggable;
                var $dropTarget = _this.getDropFuncTarget($(this));
                $dropTarget.removeClass('brtc-style-droppable-active');
                $dropTarget.removeClass('brtc-style-droppable-hover');

                _this.switchData($source, $(this));
                _this.destroyDragEvent($source);
                _this.onChange();
            }
        });
    };
    InputSelector.prototype.switchData = function ($source, $target) {
        var sourceKey = $source.closest('li').attr('key');
        var sourceTableId = $source.closest('li').attr('table-id');
        var sourceType = $source.closest('li').attr('type');

        var $tableItem = this.createTableItem({
            fnUnit: this.options.fnUnit,
            label: sourceKey,
            value: sourceTableId,
            type: sourceType
        });

        var isEmptyTarget =
            ($target.hasClass('brtc-style-controls-inputselector-empty-fnunit'))? true : false;

        // var $newCloneSource = $source.clone();
        // $newCloneSource.removeClass('ui-draggable').removeClass('ui-draggable-handle');

        var $contents = $target.closest('.brtc-style-controls-inputselector-box-contents');
        var $emptyItem = $contents.find('.brtc-va-editors-sheet-controls-empty-fnunit');
        var $removeButton = $contents.find('.brtc-style-editor-content-remove-button');

        $removeButton.show();
        // $tableItem.remove();
        $emptyItem.hide();

        this.createDropEvent($tableItem);

        (isEmptyTarget)? $contents.prepend($tableItem): $target.replaceWith($tableItem);
    };

    InputSelector.prototype.createTreeSource = function (fn) {
        var rt = {};
        var el = {
            label: '',
            data: {}
        };

        var outputs = FnUnitUtils.getOutputsToObject(fn);
        var funcLabel = FnUnitUtils.getLabel(fn);
        var id = FnUnitUtils.getId(fn);
        $.extend(this.keyMap, outputs) ;
        

        var data = {};
        for (var tableId in outputs) {
            data[tableId] = {};
            data[tableId]['key'] = outputs[tableId];
            data[tableId]['type'] = FnUnitUtils.getTypeByTableId(fn, tableId);
            data[tableId]['func'] = FnUnitUtils.getFunc(fn);
            // data[tableId]['funcLabel'] = funcLabel;
            data[tableId]['label'] = FnUnitUtils.getKeyLabel(fn, outputs[tableId]) || outputs[tableId];
        }

        el.label = funcLabel;
        el.data = data;
        // source[id] = el;
        rt[id] = el;
        return rt;
    };

    InputSelector.prototype.createSourceContainer = function () {
        var _this = this;

        var source = {};

        var prevFnUnits = this.getPreviousFnUnits(this.options.fnUnit);
        var model = FnUnitUtils.getParent(this.options.fnUnit);

        _.forEach(prevFnUnits, function (fn) {
            if (FnUnitUtils.isProcessFunction(fn)) {
                var tmpFnUnits = model.getAllPreviousFnUnits(FnUnitUtils.getId(fn));
                _.forEach(tmpFnUnits, function (tmpFn) {
                    source = _.assign(source, _this.createTreeSource(tmpFn));
                });
            } else {
                source = _.assign(source, _this.createTreeSource(fn));
            }
        });

        var options = {
            draggable: true,
            dragTarget: this.$mainControl,
            source: source,
            onClick: function (data) {
                console.log(data);
            }
        }
        new Brightics.VA.Core.Editors.Sheet.Controls.DataTree(this.$sourceArea, options);
    };

    InputSelector.prototype.createInputContainer = function () {
        var options = {
            appendTo: this.$inputArea,
            fnUnit: this.options.fnUnit,
            onChange: this.onChange.bind(this),
            onError: this.onError.bind(this),
            autoArrange: FnUnitUtils.hasMeta(this.options.fnUnit)? false : true,
            // readOnly: FnUnitUtils.isFlexibleFunction(this.options.fnUnit)? true : false
            // readOnly: !hasMeta && !_.isEqual(inRange.table.max, inRange.table.min)? true : false
        };

        this.inputsList = FnUnitInputs.render(options);
        var $inputWrapper = 
            this.$inputArea.closest('.brtc-style-controls-inputselector-content-inputs-wrapper');
        $inputWrapper.perfectScrollbar();
    };

    InputSelector.prototype.createRemoveButton = function () {
        var _this = this;

        var $removeButton = $('<span class="brtc-style-editor-content-remove-button"></span>');

        $removeButton.click(function () {
            var $box = $(this).closest('.brtc-style-controls-inputselector-box-wrapper');
            var tableId = $box.attr('table-id');
            var key = $box.attr('key');

            var $tableItem = $box.find('.brtc-va-editors-sheet-controls-dataselector-item');
            var $emptyItem = $box.find('.brtc-va-editors-sheet-controls-empty-fnunit');
            var $removeButton = $box.find('.brtc-style-editor-content-remove-button');

            $removeButton.hide();
            $tableItem.remove();
            $emptyItem.show();

            _this.handleRemove(key, tableId);

        });

        return $removeButton;
    };

    InputSelector.prototype.handleRemove = function (key, tableId) {
        console.log(tableId);
        console.log(key);
        this.onChange();
    };

    InputSelector.prototype.createBoxWrapper = function (title) {
        var $wrapper = $(''+
            '<div class="brtc-style-controls-inputselector-box-wrapper">' +
            '</div>'
        );

        var $header = $('<div class="brtc-style-controls-inputselector-box-header"></div>');
        var $contents = $('<div class="brtc-style-controls-inputselector-box-contents"></div>');

        $wrapper.append($header).append($contents);

        $header.text(title);

        return $wrapper;
    };

    InputSelector.prototype.createBox = function (label) {
        var $boxWrapper = this.createBoxWrapper(label);
        return $boxWrapper;
    };

    InputSelector.prototype.createTableItem = function (options) {
        var label = options.label;
        var value = options.value;

        var $itemWrapper = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single"></div>'),
            $item = Brightics.VA.Core.Utils.WidgetUtils.createTableItem($itemWrapper, {
                label: options.label,
                id: options.value,
                type: options.type
            });

        $itemWrapper.attr('table-id', value);
        $itemWrapper.attr('type', options.type);

        $item.find('.brtc-va-views-palette-fnunit-label').addClass('brtc-style-ellipsis');
        $item.find('.brtc-va-views-palette-fnunit-label').text(label);
        $item.attr('title', label);
        $item.addClass('item');

        return $itemWrapper;
    };

    InputSelector.prototype.createEmptyContainer = function (message) {
        var $emptyContainer = $('<div class="brtc-style-controls-inputselector-content-empty"></div>');
        $emptyContainer.text(message);

        return $emptyContainer;
    };

    InputSelector.prototype.createEmptyItem = function () {
        var $emptyItem = $('' +
            '<div class="brtc-style-flex-center brtc-va-editors-sheet-controls-empty-fnunit">' +
            '   <div class="brtc-style-controls-inputselector-empty-fnunit">' +
            '       <div>Drop Data</div>' +
            '   </div>' +
            '</div>');

        return $emptyItem;
    };

    InputSelector.prototype.getPreviousFnUnits = function () {
        var fnUnits = [];

        var model = this.options.fnUnit.parent();
        var prevFids = model.getPrevious(this.options.fnUnit.fid);

        _.forEach(prevFids, function (fid) {
            fnUnits.push(model.getFnUnitById(fid));
        });
        return fnUnits;
    };

    InputSelector.prototype.destroyDragEvent = function ($item) {
        $item.on('dragstop', function (event, ui) {
            if ($item.hasClass('ui-draggable') && ui.helper.attr('table-id') !== event.target.getAttribute('table-id')) {
                $item.draggable('destroy');
            }
        });
    };

    InputSelector.prototype.onChange = function (e, inputs) {
        if (typeof this.options.onChange === 'function') {
            this.options.onChange(inputs);
        }
    };

    InputSelector.prototype.onError = function (e, message) {
        if (typeof this.options.onError === 'function') {
            this.options.onError(message);
        }
    };

    Brightics.VA.Core.Editors.Sheet.Controls.InputSelector = InputSelector;


}).call(this);

/**
 * Created by jhoon80.park on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;

    var Brightics = root.Brightics;
    var PropertyControl = Brightics.VA.Core.Editors.Sheet.Controls.PropertyControl;

    NumberInputControl.prototype = Object.create(PropertyControl.prototype);

    function NumberInputControl(parentId, options) {
        PropertyControl.call(this, parentId, options);
    }

    NumberInputControl.prototype.setContents = function ($parents) {
        this.$contentsControl = $('<div class="brtc-va-editors-sheet-controls-numberinputcontrol" style="margin: 10px;"/>');
        this.$contentsControl.jqxNumberInput({theme: Brightics.VA.Env.Theme, height: 25, width: "85%"});

        $parents.append(this.$contentsControl);

    };

    root.Brightics.VA.Core.Editors.Sheet.Controls.NumberInputControl = NumberInputControl;

}).call(this);

/**
 * Created by ng1123.kim on 2016-03-23.
 */
(function () {
    'use strict';

    var root = this; //
    var Brightics = root.Brightics;

    function NumericInput(parentId, options) {
        return Brightics.VA.Core.Widget.Factory.numericInputControl(parentId, options);
    }
    Brightics.VA.Core.Editors.Sheet.Controls.NumericInput = NumericInput;

}).call(this);
/**
 * Created by ng1123.kim on 2016-02-03.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const PANEL_TYPE_IN = 'in';
    const PANEL_TYPE_OUT = 'out';

    /**
     * options: {
     *      panel: [],
     *      layout: {},
     *      data: {},
     * }
     *
     * dataInfo: {
     *      mid: {String},
     *      fid: {String},
     *      fnUnitLabel: {String}
     * }
     * @param parentId
     * @param options
     * @constructor
     */
    function ReportWorksheet(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.controls = {};

        this.retrieveParent();
        this.createControls();
        this.init();
    }

    ReportWorksheet.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ReportWorksheet.prototype.init = function () {
        var _this = this;

        return this.getReportOptions()
            .then(this.renderReportWorksheet.bind(this))
            .catch(function (err) {
                console.error(err);
                throw err;
            });
    };

    ReportWorksheet.prototype.textRenderer = function ($parent, options, resolve, reject) {
        $parent.html(options.html);
        resolve();
    };

    ReportWorksheet.prototype.chartRenderer = function ($parent, options, resolve, reject) {
        var tableId = options.source;

        this.options.dataProxy.requestPageData(tableId, function (table) {
            var chartOptions = options;

            chartOptions.source = {
                "dataType": "local",
                "localData": [
                    {
                        "dataType": "rawdata",
                        "columns": table.columns,
                        "data": table.data
                    }
                ]
            };

            $parent.bcharts(chartOptions);

            resolve();
        }, function (err) {
            reject();
        }, 1, 1000)
    };

    ReportWorksheet.prototype.addUnit = function (type) {
        var $unit = $('<div class="brtc-va-editors-sheet-controls-dataworksheet-unit"></div>');
        $unit.css({
            'width': '95%',
            'height': (type === 'text')? 'auto' : '300px',
            'margin-bottom': '15px',
            'margin-left': '10px'
        });
        this.$mainControl.append($unit);

        return $unit;
    };

    ReportWorksheet.prototype.renderReportWorksheet = function (result) {
        var _this = this;

        this.unitRenderer = {
            text: this.textRenderer,
            chart: this.chartRenderer
        };
        var promises = [];

        for (var i in result) {
            var options = result[i].options || result[i].option;

            var $unit = this.addUnit(result[i].type);

            var promise = new Promise(function (resolve, reject) {
                var type = result[i].type;

                //option, options가 섞여서 넘어옴..
                _this.unitRenderer[result[i].type].bind(_this)($unit, options, resolve, reject);
            });

            promises.push(promise);
        }

        return Promise.all(promises).then(this.$mainControl.perfectScrollbar());
    };

    ReportWorksheet.prototype.getReportOptions = function () {
        var _this = this;

        //sample
        var outTable = this.options.fnUnit[OUT_DATA][0];
        
        var promise = new Promise(function (resolve, reject) {
                _this.options.dataProxy.requestPageData(outTable, function (reportOptions) {
                    var result = JSON.parse((reportOptions.data[0][0]).replace('\'', ''));

                    resolve(result);
                }, function (err) {
                    reject();
                }, 1, 1000)
            })

        return promise;
    };

    ReportWorksheet.prototype.queryTable = function (tableId) {
        var _this = this;
        
        var promise = new Promise(function (resolve, reject) {
                _this.options.dataProxy.requestPageData(tableId, function (data) {
                    resolve(data);
                }, function (err) {
                    reject();
                }, 1, 1000)
            })

        return promise;
    };

    ReportWorksheet.prototype.createControls = function () {
        this.$parent.empty();

        this.$mainControl = $('<div class="brtc-va-editors-sheet-controls-dataworksheet"></div>');
        this.$mainControl.css({
            width: '100%',
            height: '100%'
        });
        this.$parent.append(this.$mainControl);
    };

    ReportWorksheet.prototype.destroy = function () {
    };

    Brightics.VA.Core.Editors.Sheet.Controls.ReportWorksheet = ReportWorksheet;

}).call(this);

/**
 * Created by ty0314.kim on 2016-01-27.
 */

(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function TableList(parentId, options) {
        this.parentId = parentId;
        this.options = options;

        this.initOptions();
        this.retrieveParent();
        this.createControls();
    }

    TableList.prototype.initOptions = function () {
        var defaultOptions = {
            rowCount: 5,
            maxRowCount: 7,
            expand: false,
        };

        this.options = $.extend(true, defaultOptions, this.options);

        this.options.items = [];
        this.options.renderedItems = {};
    };

    TableList.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    TableList.prototype.createControls = function () {
        this.createTableListControl();
        this.createExpanderControl();
    };

    TableList.prototype.setMaxHeight = function () {
        var height = this.$tableList.find('.brtc-va-editors-sheet-controls-tablelist-element').css('height');
        if (this.options.maxRowCount !== undefined && this.options.maxRowCount > 0) {
            var maxHeight = parseInt(this.options.expand ? this.options.maxRowCount : this.options.rowCount) * parseInt(height);
            this.$tableList.css({'max-height': maxHeight, height: maxHeight});
            this.$tableList.closest('.slimScrollDiv').css({height: maxHeight});
        }

        // if (this.options.expand || (this.options.items.length <= this.options.rowCount)) {
        //     this.$tableList.sortable('enable');
        // } else {
        //     this.$tableList.sortable('disable');
        // }
    };

    TableList.prototype.createTableListControl = function () {
        var _this = this;
        this.$mainControl = $('<div class="brtc-va-editors-sheet-controls-tablelist-wrapper" />');
        this.$tableListControl = $('<div class="brtc-va-editors-sheet-controls-tablelist" />');
        this.$tableList = $('<ul class="brtc-va-editors-sheet-controls-tablelist-sortable"/>');
        this.$tableListControl.append(this.$tableList);
        this.$mainControl.append(this.$tableListControl);

        this.resetTableList();
        
        /**
         * Sortable Drag 시 Help 위치 문제 및 동적으로 height 할당하기 위래 Slim Scroll 사용
         */
        this.$tableList.slimScroll({});
        // this.$tableList.perfectScrollbar();
    };

    TableList.prototype.createExpanderControl = function () {
        var _this = this;
        this.$expanderContainer = $('<div class="brtc-va-editors-sheet-controls-tablelist-expandercontainer" />');
        var $expand = $('<div class="brtc-va-editors-sheet-controls-tablelist-expander" />'),
            $expandLeft = $('<div class="brtc-va-editors-sheet-controls-tablelist-expander-left" />'),
            $expandCenter = $('<div class="brtc-va-editors-sheet-controls-tablelist-expander-center" />'),
            $expandRight = $('<div class="brtc-va-editors-sheet-controls-tablelist-expander-right" />');

        $expand.append($expandLeft).append($expandCenter).append($expandRight);

        this.$expandUp = $('<div class="brtc-va-editors-sheet-controls-tablelist-expander-up" />');
        this.$expandUp.append('<i class="fa fa-angle-double-up"></i>');
        this.$expandDown = $('<div class="brtc-va-editors-sheet-controls-tablelist-expander-down" />');
        this.$expandDown.append('<i class="fa fa-angle-double-down"></i>');
        $expandCenter.append(this.$expandUp).append(this.$expandDown);

        this.$remainNumber = $('<div class="brtc-va-editors-sheet-controls-tablelist-expander-remain" />');
        $expandRight.append(this.$remainNumber);

        this.$expandUp.hide();
        this.$expandDown.show();

        $expand.click(function () {
            _this.options.expand = !_this.options.expand;
            if (_this.options.expand) {
                _this.$expandUp.show();
                _this.$expandDown.hide();
            } else {
                _this.$tableList.scrollTop();
                _this.$expandUp.hide();
                _this.$expandDown.show();
            }
            _this.render();
        });

        this.$expanderContainer.append($expand);
        this.$expanderContainer.hide();
        this.$mainControl.append(this.$expanderContainer);
        this.$parent.append(this.$mainControl);
    };

    TableList.prototype.render = function () {
        var _this = this;

        if (this.options.items.length > 0) this.$emptyElemet.hide();
        else this.$emptyElemet.show();

        var count = this.options.items.length;
        if (this.options.expand) {
            $.each(this.options.items, function (index, table) {
                if (!_this.options.renderedItems[table.value]) {
                    _this.options.renderedItems[table.value] = _this.createTableUnit(table);
                    _this.$tableList.append(_this.options.renderedItems[table.value]);
                }
            });

            if (count <= this.options.rowCount) this.$expanderContainer.hide();
            else this.$expanderContainer.show();

            this.$remainNumber.text(count);
        } else {
            for (var i = 0; i < this.options.items.length; i++) {
                var table = this.options.items[i];
                if (i < this.options.rowCount) {
                    if (table && !_this.options.renderedItems[table.value]) {
                        _this.options.renderedItems[table.value] = _this.createTableUnit(table);
                        _this.$tableList.append(_this.options.renderedItems[table.value]);
                    }
                } else {
                    if (table && _this.options.renderedItems[table.value]) {
                        _this.options.renderedItems[table.value].remove();
                        delete _this.options.renderedItems[table.value];
                    }
                }
            }

            count = this.options.items.length - this.options.rowCount;
            if (count > 0) this.$expanderContainer.show();
            else this.$expanderContainer.hide();

            this.$remainNumber.text('+' + count);
        }
        this.setMaxHeight();
    };

    TableList.prototype.createTableUnit = function (table) {
        var $composite = $('<li class="brtc-va-editors-sheet-controls-tablelist-element" />');
        $composite.append($('<span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(table.label) + '</span>'));
        $composite.attr('value', table.value);
        return $composite;
    };

    TableList.prototype.setItems = function (items) {
        if (!items) return;
        this.options.items = [];
        var temp = $.grep(items, function (table) {
            return table;
        });

        this.options.items = temp;
        this.resetTableList();
        this.render();
    };

    TableList.prototype.resetTableList = function () {
        var _this = this;

        this.options.renderedItems = {};
        this.$tableList.empty();
        this.$emptyElemet = $('<div><span></span></div>');
        this.$emptyElemet.css({'height': '80px'});
        this.$tableList.append(this.$emptyElemet);
        // this.$tableList.sortable({
        //     axis: 'y'
        // });
        // this.$tableList.sortable('disable');

        // this.$tableList.on("sortstop", function (event, ui) {
        //     var values = _this.$tableList.sortable('toArray', {attribute: 'value'});
        //     var temp = [];
        //     $.each(values, function (index, value) {
        //         for (var i in _this.options.items) {
        //             if (_this.options.items[i].value == value) {
        //                 temp.push(_this.options.items[i]);
        //             }
        //         }
        //     });
        //     _this.options.items = temp;
        //     _this.options.changed('sortchange', _this.options.items);
        // });
    };

    TableList.prototype.getItems = function () {
        return this.options.items.length > 0 ? this.options.items : undefined;
    };

    Brightics.VA.Core.Editors.Sheet.Controls.TableList = TableList;

}).call(this);
/**
 * Created by ty_tree.kim on 2016-04-22.
 */
(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;

    function TextAreaControl(control, options) {
        try {
            //if (control[0].tagName.toLowerCase() !== 'textarea') {
            //    throw new Error('Tag name should be "textarea"');
            //}

            this.$mainControl = control;
            this.options = options;
            this.verifier = options.verifier;
            this.data = null;

            this.createControls();
        }
        catch (e) {
            console.error(e);
        }
    }

    TextAreaControl.prototype.createControls = function () {
        var _this = this;
        var syntaxRule = (this.verifier)? this.verifier.getSyntaxRule(): '';

        // 초기화만 해놓으면 CodeMirror가 Coloring과 Verify를 자동으로 해준다.
        this.initCodeMirror();
    };

    TextAreaControl.prototype.initCodeMirror = function () {
        var _this = this;

        // CodeMirror를 Setting한다.
        var mode = (this.verifier)? this.verifier.getRuleMode(): 'brtc-default';
        var codeMirrorDefaultOptions = {
            mode: mode,
            theme: 'default',
            lineNumbers: false,
            lineWrapping: true,
            // viewportMargin: Infinity,
            scrollbarStyle: (typeof _this.options.scrollbarStyle !== 'undefined') ? 'null' : 'simple',
            placeholder: 'Enter value',
            extraKeys: {'Ctrl-Space': 'autocomplete'},
            showTrailingSpace: true,
            autoCloseBrackets: true,
            matchBrackets: true
        };

        var options = $.extend(true, {}, codeMirrorDefaultOptions, this.options);
        this.codeMirror = CodeMirror.fromTextArea(this.$mainControl[0], options);
        this.codeMirror.on('focus', function (instance, event) {
            _this.old = instance.getValue();
        });
        this.codeMirror.on('blur', function (instance, event) {
            if (instance.getValue() != _this.old && typeof _this.callback === 'function') {
                _this.callback('change', event);
            }
        });
        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror);
    };

    TextAreaControl.prototype.getValue = function () {
        return this.codeMirror.getValue();
    };

    TextAreaControl.prototype.setValue = function (data) {
        this.codeMirror.setValue(data);
    };

    TextAreaControl.prototype.onChange = function (callback) {
        this.callback = callback;
    };

    TextAreaControl.prototype.getControl = function () {
        return this.$mainControl;
    };

    root.Brightics.VA.Core.Editors.Sheet.Controls.TextAreaControl = TextAreaControl;

}).call(this);
/**
 * Created by jhoon80.park on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;

    var Brightics = root.Brightics;
    var PropertyControl = Brightics.VA.Core.Editors.Sheet.Controls.PropertyControl;

    TextInputControl.prototype = Object.create(PropertyControl.prototype);

    function TextInputControl(parentId, options) {
        PropertyControl.call(this, parentId, options);
    }

    TextInputControl.prototype.setContents = function ($parents) {
        this.$contentsControl = $('<input type= "text" class="brtc-va-editors-sheet-controls-textinputcontrol" style="margin: 10px;"/>');
        this.$contentsControl.jqxInput({ height: 25, width: "85%", minLength :1, placeHolder: "Enter text"});

        $parents.append(this.$contentsControl);


    };

    root.Brightics.VA.Core.Editors.Sheet.Controls.TextInputControl = TextInputControl;

}).call(this);

/**
 * Created by sds on 2018-02-06.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const CONTROL_KEY = '';

    function BaseControl(caller, options) {
        this.caller = caller;
        this.options = options || {};
        this.init();
        this.createControl();
    }

    BaseControl.prototype.init = function () {
        this.controls = {};
    };

    BaseControl.prototype.registerSpec = function (paramInfo) {
        var _this = this;
        this.PARAM_INFO = {};
        paramInfo.forEach(function (paramObj) {
            _this.PARAM_INFO[paramObj.Key] = {
                Label: paramObj.Label,
                Default: paramObj.Default || ''
            };

            if (paramObj.Source) {
                _this.PARAM_INFO[paramObj.Key].Source = paramObj.Source
            }
            if (paramObj.NumberType) {
                _this.PARAM_INFO[paramObj.Key].NumberType = paramObj.NumberType
            }

        });
    };

    BaseControl.prototype.createControl = function () {
    };

    BaseControl.prototype.renderControl = function () {
        var settingVal = this.Default;
        if (this.options.value) {
            settingVal = this.options.value;
        }
        this.controls[this.CONTROL_KEY].setValue(settingVal);
    };

    BaseControl.prototype.getSection = function (section) {
        //default : center
        if (section == 'left') {
            return this.caller.$leftArea
        } else if (section == 'right') {
            return this.caller.$rightArea
        } else {
            return this.caller.$contentsArea
        }
    };

    BaseControl.prototype.getValue = function () {
        var result = {};
        result[this.CONTROL_KEY] = this.controls[this.CONTROL_KEY].getValue();
        return result;
    };

    BaseControl.prototype.bindValidation = function (ctrlInfo) {
        var _this = this;
        if (typeof ctrlInfo.$target == 'undefined') {
            return;
        }
        if (ctrlInfo.mandatory || this.options.isMandatory) {
            this.checkValidation(ctrlInfo);
            ctrlInfo.$target.on('change', function (event) {
                _this.checkValidation(ctrlInfo)
            })
        }
    };

    BaseControl.prototype.checkValidation = function (ctrlInfo) {
        this.removeValidation(ctrlInfo.$target);
        if (ctrlInfo.control &&
            (!ctrlInfo.control.getValue() || $.isEmptyObject(ctrlInfo.control.getValue()))) {
            var errObj = {
                $target: ctrlInfo.$target,
                message: this.caller.problemFactory.makeMessage({
                    errorCode: 'BR-0033',
                    param: ctrlInfo.$target,
                    messageParam: [ctrlInfo.label]
                })
            };
            this.createValidationContent(errObj)
        }
    };

    BaseControl.prototype.removeValidation = function ($target) {
        $target.find('.brtc-va-editors-opt-validation-tooltip-wrapper').remove();
        $target.removeClass('brtc-va-editors-opt-validation-error');
    };

    BaseControl.prototype.createValidationContent = function (problemData) {
        var $problemContent = $('<div class="brtc-va-editors-opt-validation-tooltip-wrapper">' +
            '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ' +
            '   <div class="brtc-va-editors-opt-validation-tooltip">' + problemData.message + '</div>' +
            '</div>');
        problemData.$target.append($problemContent);
        problemData.$target.addClass('brtc-va-editors-opt-validation-error');
        $problemContent.show();
    };

    /*
     propertey utils
     */
    BaseControl.prototype.createDeckProperties = function ($parent, label, callback, option) {
        var $methodProperty = $('' +
            '<div class="deck-property">' +
            '    <div class="property-label"></div>' +
            '    <div class="property-control"></div>' +
            '</div>');
        $parent.append($methodProperty);

        $methodProperty.find('.property-label').text(label);

        if (typeof  callback === 'function') {
            callback.call(this, $methodProperty.find(".property-control"));
        }

        if (option.mandatory) {
            var $mandatory = '<div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div>';
            $methodProperty.find('.property-label').append($mandatory);

            this.bindValidation({
                $target: $methodProperty.find(".property-control"),
                control: this._getControl(option),
                mandatory: true,
                label: label
            });
        }

        return $methodProperty;
    };

    BaseControl.prototype.getFilteredData = function () {
        var columnData = this.dataMap ? this.options.fnUnit['in-table'][0] ? this.dataMap[this.options.fnUnit['in-table'][0]].columns : [] : [];
        var numberData = $.grep(columnData, function (el) {
            return (el.internalType.toLowerCase() === 'double');
        });
        return numberData;
    };

    BaseControl.prototype.configureControls = function ($deckControl, paramName, selectedVal) {
    };

    BaseControl.prototype._setControl = function (target, source) {// options, controlIndex
        var CONTROL_KEY = this.CONTROL_KEY;
        var paramName = (target.options) ? target.options.attr : undefined;

        if (typeof paramName == 'undefined') {
            this.controls[CONTROL_KEY] = source;
        } else {
            if (target.options.control) {
                target.options.control[paramName] = source;
            } else if (typeof target.controlIndex != 'undefined') {
                this.controls[CONTROL_KEY][target.controlIndex][paramName] = source;
            } else {
                this.controls[CONTROL_KEY][paramName] = source;
            }
        }
    };

    BaseControl.prototype._getControl = function (targetOpt) {
        if (typeof targetOpt == 'undefined') {
            return;
        }
        var CONTROL_KEY = this.CONTROL_KEY;
        var paramName = targetOpt.attr;

        if (targetOpt.control) {
            return targetOpt.control[paramName]
        } else if (typeof targetOpt.controlIndex != 'undefined') {
            return this.controls[CONTROL_KEY][targetOpt.controlIndex][paramName]
        } else {
            return this.controls[CONTROL_KEY][paramName]
        }
    };

    /**
     * create Controls
     * @param $container
     * @param options
     */
    BaseControl.prototype.createRadioButtonControl = function ($container, options) {
        var _this = this, $elements = {};
        var source = options.source, CONTROL_KEY = this.CONTROL_KEY;
        var controlVal = function () {
            if (options.value && source.some(function (srcObj) {
                    return srcObj.value == options.value
                })) {
                return options.value;
            }
        }();
        var control = {};

        source.forEach(function (srcObj) {
            $elements[CONTROL_KEY + '.' + srcObj.value] = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">' + srcObj.label + '</div>');
            $container.append($elements[CONTROL_KEY + '.' + srcObj.value]);
            control[CONTROL_KEY + '.' + srcObj.value] = _this.caller.createRadioButton($elements[CONTROL_KEY + '.' + srcObj.value], {
                disabled: options.disabled,
                groupName: CONTROL_KEY
            });

            control[CONTROL_KEY + '.' + srcObj.value].on('checked', function (event) {
                controlVal = srcObj.value;
                _this.configureControls($container, options.attr, controlVal);
            });
        });

        control.getValue = function () {
            if (options.getValue) {
                return options.getValue.call(this, controlVal);
            } else {
                return controlVal;
            }
        };
        control.setValue = function (value) {
            $elements[CONTROL_KEY + '.' + value].jqxRadioButton('check');
        };

        this._setControl({options: options}, control)
    };

    BaseControl.prototype.createTextAreaControl = function ($control, jqxOptions) {
        var _this = this;

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '264px',
            height: '75px'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxTextArea(options);
        return $control;
    };

    BaseControl.prototype.createNumberArrayControl = function ($container, options) {
        var _this = this;
        var CONTROL_KEY = this.CONTROL_KEY;
        var control = {};

        var $elements = $('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-input"/>');
        $elements.attr('maxlength', 1000);
        $container.append($elements);
        control[CONTROL_KEY] = _this.caller.createInput($elements, {
            placeHolder: (options && options.placeHolder) ? options.placeHolder : 'ex) 0.4, 0.5'
        });

        control[CONTROL_KEY].setValue = function (value) {
            if (typeof value != 'undefined') {
                $elements.val(value.replace(/\[|\]/g, ''));
            }
        };
        control[CONTROL_KEY].getValue = function () {
            if ($elements.val()) {
                return '[' + $elements.val() + ']'
            }
        };

        if (this.options.isMandatory) {
            this.bindValidation({
                $target: $container,
                control: control[CONTROL_KEY],
                label: this.constructor.Label
            });
        }

        this._setControl({options: options}, control[CONTROL_KEY])
    };

    BaseControl.prototype.createInputControl = function ($container, options) {
        var _this = this;
        var CONTROL_KEY = this.CONTROL_KEY;
        var control = {};

        var $elements = $('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-input"/>');
        if (options.maxLength > 0) {
            $elements.attr('maxlength', options.maxLength);
        }

        $container.append($elements);
        control[CONTROL_KEY] = this.caller.createInput($elements, {
            placeHolder: (options && options.placeHolder) ? options.placeHolder : 'ex) 0.4, 0.5'
        });

        control[CONTROL_KEY].setValue = function (value) {
            $elements.val(value);
        };
        control[CONTROL_KEY].getValue = function () {
            return $elements.val();
        };

        this._setControl({options: options}, control[CONTROL_KEY])
    };

    BaseControl.prototype.createDropDownControl = function ($container, options) {
        var _this = this;
        var source = (options && options.source) ? options.source : [],
            CONTROL_KEY = this.CONTROL_KEY;
        var control = {};

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');
        $container.append($elements);
        var jqxOptions = {
            source: source,
            selectedIndex: 0
        };
        control[CONTROL_KEY] = _this.caller.createDropDownList($elements, jqxOptions);

        control[CONTROL_KEY].setValue = function (value) {
            if (typeof value != 'undefined') {
                this.jqxDropDownList('selectItem', value);
            }
        };
        control[CONTROL_KEY].getValue = function () {
            return this.jqxDropDownList('getSelectedItem').value;
        };

        this._setControl({options: options}, control[CONTROL_KEY])
    };

    /**
     * Create Deck Controls
     * @param $container
     * @param options
     * @param controlIndex
     */
    BaseControl.prototype.createDeckDropdownControl = function ($container, options, controlIndex) {
        var _this = this;
        var source = options.source, paramName = options.attr;
        var target = (options.target) ? options.target : {};
        var control;

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');
        target[paramName] = this.createDeckProperties($container, this.PARAM_INFO[paramName].Label, function ($controlParent) {
            $controlParent.append($elements);
            var selectedIdx;
            if (!source) {
                source = _this.PARAM_INFO[paramName].Source || [];
            }
            if (source && source.length > 0) {
                selectedIdx = source.findIndex(function (elem) {
                    return elem.value == _this.PARAM_INFO[paramName].Default
                });
                selectedIdx = (selectedIdx > -1) ? selectedIdx : 0;
            }
            var controlOpt = {
                source: source,
                selectedIndex: selectedIdx || 0
            };
            control = _this.caller.createDropDownList($elements, controlOpt);
            _this._setControl({options: options, controlIndex: controlIndex}, control);

            control.setValue = function (value) {
                this.jqxDropDownList('selectItem', value);
            };
            control.getValue = function () {
                return this.jqxDropDownList('getSelectedItem').value;
            };

            _this.configureControls($container, paramName, control.getValue(), controlIndex);
            control.on('change', function (event) {
                _this.configureControls($container, paramName, event.args.item.value, controlIndex);
            });
        }, {
            mandatory: options.mandatory,
            controlIndex: controlIndex,
            attr: paramName
        });
    };

    BaseControl.prototype.createDeckInputControl = function ($container, options, controlIndex) {
        var _this = this;
        var source = options.source, paramName = options.attr;
        var target = (options.target) ? options.target : {};
        var control;

        var $elements = $('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-input"/>');
        target[paramName] = this.createDeckProperties($container, this.PARAM_INFO[paramName].Label, function ($controlParent) {
            $controlParent.append($elements);
            var controlOpt = {
                placeHolder: _this.PARAM_INFO[paramName].Default
            };
            control = _this.caller.createInput($elements, controlOpt);
            _this._setControl({options: options, controlIndex: controlIndex}, control);

            control.setValue = function (value) {
                $elements.val(value);
            };
            control.getValue = function () {
                return $elements.val();
            };
        }, {
            mandatory: options.mandatory,
            controlIndex: controlIndex,
            attr: paramName
        });
    };

    BaseControl.prototype.createDeckNumberInputControl = function ($container, options, controlIndex) {
        var _this = this;
        var source = options.source, paramName = options.attr;
        var target = (options.target) ? options.target : {};
        var control;

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');
        target[paramName] = this.createDeckProperties($container, _this.PARAM_INFO[paramName].Label, function ($controlParent) {
            $controlParent.append($elements);

            if ( _this.CONTROL_KEY === 'constraints'  && paramName === 'min' && _this.PARAM_INFO[paramName].Default ) {
                var controlOpt = {
                    placeholder: _this.PARAM_INFO[paramName].Default,
                    numberType: _this.PARAM_INFO[paramName].NumberType || 'int',
                    min: parseFloat(_this.PARAM_INFO[paramName].Default)
                };
            } else {
                var controlOpt = {
                    placeholder: _this.PARAM_INFO[paramName].Default,
                    numberType: _this.PARAM_INFO[paramName].NumberType || 'int'
                };
            }

            control = _this.caller.createNumberInput($elements, controlOpt);
            _this._setControl({options: options, controlIndex: controlIndex}, control);
        }, {
            mandatory: options.mandatory,
            controlIndex: controlIndex,
            attr: paramName,
            control: options.control
        });
    };

    BaseControl.prototype.configureScalingControls = function () {
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base = BaseControl;

}).call(this);
/**
 * Created by sds on 2018-03-08.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;
    const METHOD_CONTROL_KEY = 'method',
        SCALING_CONTROL_KEY = 'scaling',
        PARAM_SCALE_TYPE = 'scale-type',
        PARAM_SCALE = 'scale';

    function BaseMultipleDeckControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    BaseMultipleDeckControl.prototype = Object.create(_super);
    BaseMultipleDeckControl.prototype.constructor = BaseMultipleDeckControl;

    BaseMultipleDeckControl.prototype.createDeleteButton = function ($deckControl) {
        var $removeButton = $('<div class ="brtc-va-editors-sheet-controls-propertycontrol-deck-remove"></div>');
        $deckControl.append($removeButton);

        var _this = this;
        $removeButton.click(function (event) {
            event.stopPropagation();
            var deleteIdx = $deckControl.index();
            _this.controls[_this.CONTROL_KEY].splice(deleteIdx, 1);
            $deckControl.remove();
            if (_this.options.multiple || (!_this.options.multiple && _this.controls[_this.CONTROL_KEY].length == 0)) {
                _this.$addButton.appendTo(_this.$controlContainer);
            }
            _this.updateSectionScroll();
        });
    };

    BaseMultipleDeckControl.prototype.renderControl = function () {
        var _this = this;
        if (!this.options.value) {
            return;
        }
        var paramSpecList = this.options.params;
        var controlValue = this.options.value.slice();
        this.$addButton.detach();
        if (!this.options.multiple) {
            controlValue = controlValue.splice(0, 1);
        }
        for (var controlIdx = 0; controlIdx < controlValue.length; controlIdx++) {
            this.createDeck();
            paramSpecList.forEach(function (paramObj) {
                if (_this.controls[_this.CONTROL_KEY][controlIdx][paramObj.attr]) {
                    _this.controls[_this.CONTROL_KEY][controlIdx][paramObj.attr].setValue(controlValue[controlIdx][paramObj.attr]);
                }
            });
        }
        if (this.options.multiple || (!this.options.multiple && this.controls[this.CONTROL_KEY].length == 0)) {
            this.$addButton.appendTo(this.$controlContainer);
        }
    };

    BaseMultipleDeckControl.prototype.createAddButton = function () {
        var _this = this;
        this.$addButton = $('<input type="button" class= "brtc-va-editors-sheet-controls-propertycontrol-addbutton" />');
        this.$addButton.val('+ Add ' + this.getLabel());
        this.$controlContainer.append(this.$addButton);
        this.$addButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 25
        });

        this.$addButton.click(function () {
            $(this).detach();
            _this.createDeck();
            _this.updateSectionScroll();
            if (_this.options.multiple) {
                $(this).appendTo(_this.$controlContainer);
            }
        });
    };


    BaseMultipleDeckControl.prototype.getValue = function () {
        var result = [];
        var _this = this;
        var paramSpecList = this.options.params;
        for (var controlIdx = 0; controlIdx < this.controls[this.CONTROL_KEY].length; controlIdx++) {
            result[controlIdx] = {};
            paramSpecList.forEach(function (paramObj) {
                if (_this.controls[_this.CONTROL_KEY][controlIdx][paramObj.attr]) {
                    result[controlIdx][paramObj.attr] = _this.controls[_this.CONTROL_KEY][controlIdx][paramObj.attr].getValue();
                }
            });
        }
        return result;
    };

    BaseMultipleDeckControl.prototype.configureScalingControls = function () {
        var scalingVal = this.getScalingValue();

        if (scalingVal) {
            var $parentDeck;
            for (var controlIndex = 0; controlIndex < this.controls[this.CONTROL_KEY].length; controlIndex++) {
                $parentDeck = $(this.$controlContainer.find('.method')[controlIndex]);
                this._createDeckDetailControls($parentDeck, PARAM_SCALE_TYPE, controlIndex);
                this._createDeckDetailControls($parentDeck, PARAM_SCALE, controlIndex);
            }
        } else {
            for (var controlIndex = 0; controlIndex < this.controls[this.CONTROL_KEY].length; controlIndex++) {
                if(this.$deckElem[controlIndex][PARAM_SCALE_TYPE] && this.$deckElem[controlIndex][PARAM_SCALE]){
                    this.$deckElem[controlIndex][PARAM_SCALE_TYPE].remove();
                    delete this.controls[this.CONTROL_KEY][controlIndex][PARAM_SCALE_TYPE];
                    this.$deckElem[controlIndex][PARAM_SCALE].remove();
                    delete this.controls[this.CONTROL_KEY][controlIndex][PARAM_SCALE];
                }
            }
        }
        this.updateSectionScroll();
    };

    //constraints, objectives control에서 사용함.
    BaseMultipleDeckControl.prototype.getScalingValue = function () {
        if (this.caller.controls[METHOD_CONTROL_KEY][SCALING_CONTROL_KEY]) {
            var controlVal = this.caller.controls[METHOD_CONTROL_KEY][SCALING_CONTROL_KEY].getValue();
            return controlVal && controlVal[SCALING_CONTROL_KEY] == 'true'
        } else {
            return false;
        }
    };

    BaseMultipleDeckControl.prototype.updateSectionScroll = function () {
    };

    BaseMultipleDeckControl.prototype.getLabel = function () {
    };


    Brightics.VA.Core.Editors.Sheet.Controls.Optimization.BaseMultipleDeck = BaseMultipleDeckControl;

}).call(this);
/**
 * Created by sds on 2018-02-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'constraints-column';

    /**
     * opt script dialog에서 viewer용으로 사용.
     * @param caller
     * @param options
     * @constructor
     */
    function ConstraintsColumnControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ConstraintsColumnControl.prototype = Object.create(_super);
    ConstraintsColumnControl.prototype.constructor = ConstraintsColumnControl;

    ConstraintsColumnControl.Label = 'Constraints';

    ConstraintsColumnControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    ConstraintsColumnControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;
        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-textareacontrol"/>');
        propPanel.addPropertyControl(ConstraintsColumnControl.Label, function ($container) {
            $container.append($elements);
            var controlOpt = {
                disabled: true
            };

            _this.controls[CONTROL_KEY] = _this.createTextAreaControl($elements, controlOpt);
            _this.controls[CONTROL_KEY].setValue = function (value) {
                if(value){
                    var nameList =
                    $elements.val(value.map(function (elem) {
                        return elem.name
                    }).join('\n'));
                }
            };
            _this.controls[CONTROL_KEY].getValue = function () {
                return $elements.val();
            };
        }, {mandatory: _this.options.isMandatory});
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ConstraintsColumnControl;

}).call(this);
/**
 * Created by sds on 2018-02-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.BaseMultipleDeck.prototype;

    const CONTROL_KEY = 'constraints',
        PARAM_NAME = 'name',
        PARAM_TYPE = 'type',
        PARAM_TARGET = 'target',
        PARAM_MIN = 'min',
        PARAM_MAX = 'max',
        PARAM_SCALE_TYPE = 'scale-type',
        PARAM_SCALE = 'scale';

    function ConstraintsControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ConstraintsControl.prototype = Object.create(_super);
    ConstraintsControl.prototype.constructor = ConstraintsControl;

    ConstraintsControl.Label = 'Constraints';

    ConstraintsControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;

        var paramInfo = [{
            Key: PARAM_NAME,
            Label: 'Name'
        }, {
            Key: PARAM_TYPE,
            Label: 'Type',
            Default: 'inequality',  //dropdown
            Source: [
                {
                    "label": "Inequality",
                    "value": "inequality"
                },
                {
                    "label": "Equality",
                    "value": "equality"
                }
            ]
        }, {
            Key: PARAM_TARGET,
            Label: 'Target',
            Default: '0',
            NumberType: 'double'
        }, {
            Key: PARAM_MIN,
            Label: 'Min',
            Default: '-1.e+30',
            NumberType: 'double'
        }, {
            Key: PARAM_MAX,
            Label: 'Max',
            Default: '0',
            NumberType: 'double'
        }, {

            Key: PARAM_SCALE_TYPE,
            Label: 'Scale Type',//dropdown
            Default: 'none',
            Source: [
                "none",
                "value",
                "auto",
                "log"
            ]
        }, {
            Key: PARAM_SCALE,
            Label: 'Scale',
            Default: '1',
            NumberType: 'double'
        }];

        this.registerSpec(paramInfo);
        this.controls[CONTROL_KEY] = [];
        this.$deckElem = [];
    };

    ConstraintsControl.prototype.createControl = function () {
        var _this = this;

        var propPanel = this.caller;
        propPanel.addPropertyControl(this.getLabel(), function ($container) {
            _this.$controlContainer = $container;
        }, {
            propertyControlParent: _this.getSection(ConstraintsControl.Section),
            mandatory: _this.options.isMandatory
        });

        this.createAddButton();
    };


    ConstraintsControl.prototype.createDeck = function ($container) {
        var $deckControl = $('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');
        this.$controlContainer.append($deckControl);
        var methodIdx = (this.controls[CONTROL_KEY]) ? this.controls[CONTROL_KEY].length : 0;
        this.createDeleteButton($deckControl);
        this._createDeckDetailControls($deckControl, PARAM_NAME, methodIdx);
        this._createDeckDetailControls($deckControl, PARAM_TYPE, methodIdx);
    };

    ConstraintsControl.prototype.configureControls = function ($deckControl, paramName, selectedVal, controlIndex) {
        this._removeControls(paramName, controlIndex);

        if (paramName == PARAM_TYPE) {
            if (selectedVal == 'equality') {
                this._createDeckDetailControls($deckControl, PARAM_TARGET, controlIndex);
            } else if (selectedVal == 'inequality') {
                this._createDeckDetailControls($deckControl, PARAM_MIN, controlIndex);
                this._createDeckDetailControls($deckControl, PARAM_MAX, controlIndex);
            }
            if (this.getScalingValue()) {
                this._createDeckDetailControls($deckControl, PARAM_SCALE_TYPE, controlIndex);
                this._createDeckDetailControls($deckControl, PARAM_SCALE, controlIndex);
            }
        }
    };

    ConstraintsControl.prototype._createDeckDetailControls = function ($deckControl, paramName, controlIndex) {
        var _this = this, controlOpt = {};
        if (!this.controls[CONTROL_KEY][controlIndex]) {
            this.controls[CONTROL_KEY][controlIndex] = {};
            this.$deckElem[controlIndex] = {};
        }

        var paramObj = this.options.params.find(function (paramConf) {
            return paramName == paramConf.attr
        });
        if (typeof paramObj == 'undefined') {
            console.warn(paramName+' is not defined in json');
            return;
        } else {
            controlOpt = $.extend(true, {
                target: this.$deckElem[controlIndex],
                control: this.controls[CONTROL_KEY][controlIndex]
            }, paramObj);
        }

        if (paramName === PARAM_TYPE || paramName === PARAM_SCALE_TYPE) {
            _this.createDeckDropdownControl($deckControl, controlOpt, controlIndex);
        } else if (paramName === PARAM_NAME) {
            _this.createDeckInputControl($deckControl, controlOpt, controlIndex);
        } else if ([PARAM_TARGET, PARAM_MIN, PARAM_MAX, PARAM_SCALE].includes(paramName)) {
            _this.createDeckNumberInputControl($deckControl, controlOpt, controlIndex);
        }
    };

    ConstraintsControl.prototype._removeControls = function (paramName, controlIndex) {
        var copiedControl;
        if (paramName == PARAM_TYPE) {
            copiedControl = $.extend(true, {}, this.$deckElem[controlIndex]);
            for (var controlElem in copiedControl) {
                if (controlElem != paramName && ![PARAM_NAME, PARAM_TYPE].includes(controlElem)) {
                    this.$deckElem[controlIndex][controlElem].remove();
                    delete this.$deckElem[controlIndex][controlElem];
                    delete this.controls[CONTROL_KEY][controlIndex][controlElem];
                }
            }
        }
    };

    ConstraintsControl.prototype.updateSectionScroll = function () {
        this.getSection(ConstraintsControl.Section).perfectScrollbar('update');
    };

    ConstraintsControl.prototype.getLabel = function () {
        return ConstraintsControl.Label;
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ConstraintsControl;

}).call(this);
/**
 * Created by sds on 2018-02-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'convergence-tolerance';

    function ConvergenceToleranceControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ConvergenceToleranceControl.prototype = Object.create(_super);
    ConvergenceToleranceControl.prototype.constructor = ConvergenceToleranceControl;

    ConvergenceToleranceControl.Label = 'Convergence Tolerance';
    ConvergenceToleranceControl.Section = 'left';

    ConvergenceToleranceControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    ConvergenceToleranceControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');
        propPanel.addPropertyControl(ConvergenceToleranceControl.Label, function ($container) {
            $container.append($elements);
            var jqxOptions = {
                placeholder: '1.e-4',
                numberType: 'double'
            };
            _this.controls[CONTROL_KEY] = propPanel.createNumberInput($elements, jqxOptions);
        }, {
            propertyControlParent: _this.getSection(ConvergenceToleranceControl.Section),
            mandatory: _this.options.isMandatory
        });

        this.bindValidation({
            $target: $elements,
            control: this.controls[CONTROL_KEY],
            label: ConvergenceToleranceControl.Label
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ConvergenceToleranceControl;

}).call(this);
/**
 * Created by sds on 2018-02-21.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'dace-type';

    function DaceTypeControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    DaceTypeControl.prototype = Object.create(_super);
    DaceTypeControl.prototype.constructor = DaceTypeControl;

    DaceTypeControl.Label = 'Dace Type';
    DaceTypeControl.Section = 'left';

    DaceTypeControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Source = [
            {
                "label": "Random",
                "value": "random"
            },
            {
                "label": "Grid Sampling",
                "value": "grid_sampling"
            },
            {
                "label": "Orthogonal Array",
                "value": "orthogonal_array"
            },
            {
                "label": "Orthogonal Array Latin Hypercube Sampling",
                "value": "orthogonal_array_latin_hypercube_sampling"
            },
            {
                "label": "Latin Hypercube Sampling",
                "value": "latin_hypercube_sampling"
            },
            {
                "label": "Box Behnken",
                "value": "box_behnken"
            },
            {
                "label": "Central Composite",
                "value": "central_composite"
            }
        ];
    };

    DaceTypeControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(DaceTypeControl.Label, function ($container) {
            _this.createDropDownControl($container, {
                source: _this.options.source || _this.Source
            });
        }, {
            propertyControlParent: _this.getSection(DaceTypeControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = DaceTypeControl;

}).call(this);
/**
 * Created by sds on 2018-02-26.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'distribution';

    function DistributionControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    DistributionControl.prototype = Object.create(_super);
    DistributionControl.prototype.constructor = DistributionControl;

    DistributionControl.Label = 'Distribution';
    DistributionControl.Section = 'left';

    DistributionControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Source = [
            {
                "label": "Cumulative",
                "value": "cumulative"
            },
            {
                "label": "Complementary",
                "value": "complementary"
            }
        ];

    };

    DistributionControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(DistributionControl.Label, function ($container) {
            _this.createDropDownControl($container, {
                source: _this.options.source || _this.Source
            });
        }, {
            propertyControlParent: _this.getSection(DistributionControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = DistributionControl;

}).call(this);
/**
 * Created by sds on 2018-02-26.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'gen-reliability-levels';

    function GenReliabilityLevelsControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    GenReliabilityLevelsControl.prototype = Object.create(_super);
    GenReliabilityLevelsControl.prototype.constructor = GenReliabilityLevelsControl;

    GenReliabilityLevelsControl.Label = 'Gen Reliability Levels';
    GenReliabilityLevelsControl.Section = 'left';

    GenReliabilityLevelsControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    GenReliabilityLevelsControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(GenReliabilityLevelsControl.Label, function ($container) {
            _this.createInputControl($container, {
                maxLength: 1000,
                placeHolder: "ex) '[[0.1,0.2], [0.3,0.4]]"
            });
        }, {
            propertyControlParent: _this.getSection(GenReliabilityLevelsControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = GenReliabilityLevelsControl;

}).call(this);
/**
 * Created by sds on 2018-02-12.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'gradient';

    function GradientControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    GradientControl.prototype = Object.create(_super);
    GradientControl.prototype.constructor = GradientControl;

    GradientControl.Label = 'Gradient';
    GradientControl.Section = 'right';

    GradientControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Default = 'no_gradient';
        this.Source = [
            {
                "label": "No Gradient",
                "value": "no_gradient"
            },
            {
                "label": "Numerical Gradient",
                "value": "numerical_gradient"
            }
        ];

        this.controls[CONTROL_KEY] = [];
    };

    GradientControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller,
            source = this.options.source,
            checked;
        var $elements = {};
        var controlVal = (typeof this.options.value != 'undefined') ? this.options.value : this.Default;

        propPanel.addPropertyControl(GradientControl.Label, function ($container) {
            _this.createRadioButtonControl($container, {
                disabled: _this.options.disabled,
                source: _this.options.source || _this.Source,
                value: controlVal
            });
        }, {
            propertyControlParent: _this.getSection(GradientControl.Section),
            mandatory: _this.options.isMandatory
        });
    };


    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = GradientControl;

}).call(this);

/**
 * Created by sds on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'hessian';

    function HessianControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    HessianControl.prototype = Object.create(_super);
    HessianControl.prototype.constructor = HessianControl;

    HessianControl.Label = 'Hessian';
    HessianControl.Section = 'right';

    HessianControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Default = 'no_hessian';
        this.Source = [
            {
                "label": "No Hessian",
                "value": "no_hessian"
            },
            {
                "label": "Numerical Hessian",
                "value": "numerical_hessian"
            }
        ];

        this.controls[CONTROL_KEY] = [];
    };

    HessianControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller,
            source = this.options.source,
            checked;
        var $elements = {};
        var controlVal = (typeof this.options.value != 'undefined') ? this.options.value : this.Default;

        propPanel.addPropertyControl(HessianControl.Label, function ($container) {
            _this.createRadioButtonControl($container, {
                disabled: _this.options.disabled,
                source: _this.options.source || _this.Source,
                value: controlVal
            });
        }, {
            propertyControlParent: _this.getSection(HessianControl.Section),
            mandatory: _this.options.isMandatory
        });
    };


    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = HessianControl;

}).call(this);

/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'list';

    function ListControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ListControl.prototype = Object.create(_super);
    ListControl.prototype.constructor = ListControl;

    ListControl.Label = 'List';
    ListControl.Section = 'left';

    ListControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    ListControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(ListControl.Label, function ($container) {
            _this.createInputControl($container, {
                maxLength: 1000,
                placeHolder: "ex) {'x1':[0.4, 0.5, 1.2, 3], 'x2':[6, 7, 8, 9]}"
            });
        }, {
            propertyControlParent: _this.getSection(ListControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ListControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'list-type';

    function ListTypeControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ListTypeControl.prototype = Object.create(_super);
    ListTypeControl.prototype.constructor = ListTypeControl;

    ListTypeControl.Label = 'List Type';
    ListTypeControl.Section = 'left';

    ListTypeControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Source = [
            {
                "label": "Val List",
                "value": "val_list"
            },
            // OPT쪽에서 테스트 완료후 적용요청하면 적용할것 
            // {
            //     "label": "Val File",
            //     "value": "val_file"
            // }
        ];

        this.controls[CONTROL_KEY] = {}
    };

    ListTypeControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(ListTypeControl.Label, function ($container) {
            _this.createDropDownControl($container, {
                source: _this.options.source || _this.Source
            });
        }, {
            propertyControlParent: _this.getSection(ListTypeControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ListTypeControl;

}).call(this);
/**
 * Created by sds on 2018-02-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'max-evaluations';

    function MaxEvaluationControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    MaxEvaluationControl.prototype = Object.create(_super);
    MaxEvaluationControl.prototype.constructor = MaxEvaluationControl;

    MaxEvaluationControl.Label = 'Max Evaluations';
    MaxEvaluationControl.Section = 'left';

    MaxEvaluationControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    MaxEvaluationControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');
        propPanel.addPropertyControl(MaxEvaluationControl.Label, function ($container) {
            $container.append($elements);
            var jqxOptions = {
                placeholder: 1000,
                numberType: 'int'
            };
            _this.controls[CONTROL_KEY] = propPanel.createNumberInput($elements, jqxOptions);
        }, {
            propertyControlParent: _this.getSection(MaxEvaluationControl.Section),
            mandatory: _this.options.isMandatory
        });

        this.bindValidation({
            $target: $elements,
            control: this.controls[CONTROL_KEY],
            label: MaxEvaluationControl.Label
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = MaxEvaluationControl;

}).call(this);
/**
 * Created by sds on 2018-02-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'max-iterations';

    function MaxIterationControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    MaxIterationControl.prototype = Object.create(_super);
    MaxIterationControl.prototype.constructor = MaxIterationControl;

    MaxIterationControl.Label = 'Max Iterations';
    MaxIterationControl.Section = 'left';

    MaxIterationControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    MaxIterationControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');
        propPanel.addPropertyControl(MaxIterationControl.Label, function ($container) {
            $container.append($elements);
            var jqxOptions = {
                placeholder: 100,
                numberType: 'int'
            };
            _this.controls[CONTROL_KEY] = propPanel.createNumberInput($elements, jqxOptions);
        }, {
            propertyControlParent: _this.getSection(MaxIterationControl.Section),
            mandatory: _this.options.isMandatory
        });

        this.bindValidation({
            $target: $elements,
            control: this.controls[CONTROL_KEY],
            label: MaxIterationControl.Label
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = MaxIterationControl;

}).call(this);
/**
 * Created by sds on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'model',
        PARAM_APPROXIMATION = 'surr-approximation',
        PARAM_TRAINING_POINTS = 'surr-training-points',
        PARAM_MAX_NODES = 'max-nodes',
        PARAM_POLYNOMIAL_ORDER_TYPE = 'polynomial-order-type',
        PARAM_BASIS_ORDER = 'basis-order',
        PARAM_TOTAL_POINT = 'total-point';

    function ModelControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ModelControl.prototype = Object.create(_super);
    ModelControl.prototype.constructor = ModelControl;

    ModelControl.Label = 'Model';
    ModelControl.Section = 'left';

    ModelControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        var paramInfo = [{
            Key: PARAM_APPROXIMATION,
            Label: 'Approximation',
            Default: 'gaussian_process',
            Source: [
                {
                    "label": "Gaussian Process",
                    "value": "gaussian_process"
                },
                {
                    "label": "Mars",
                    "value": "mars"
                },
                {
                    "label": "Moving Least Squares",
                    "value": "moving_least_squares"
                },
                {
                    "label": "Radial Basis",
                    "value": "radial_basis"
                },
                {
                    "label": "Neural Network",
                    "value": "neural_network"
                },
                {
                    "label": "Polynomial",
                    "value": "polynomial"
                }
            ]
        }, {
            Key: PARAM_TRAINING_POINTS,
            Label: 'Training Points',
            Source: [
                {
                    "label": "Total Points",
                    "value": "total_points"
                },
                {
                    "label": "Minimum Points",
                    "value": "minimum_points"
                },
                {
                    "label": "Recommended Points",
                    "value": "recommended_points"
                }
            ]
        }, {
            Key: PARAM_MAX_NODES,
            Label: 'Max Nodes' //input
        }, {
            Key: PARAM_POLYNOMIAL_ORDER_TYPE,
            Label: 'Polynomial Order Type',
            Source: [
                {
                    "label": "Cubic",
                    "value": "cubic"
                },
                {
                    "label": "Basis Order",
                    "value": "basis_order"
                },
                {
                    "label": "Linear",
                    "value": "linear"
                },
                {
                    "label": "Quadratic",
                    "value": "quadratic"
                }
            ]
        }, {
            Key: PARAM_BASIS_ORDER,
            Label: 'Basis Order' //input
        }, {
            Key: PARAM_TOTAL_POINT,
            Label: 'Total Point'//input
        }];

        this.registerSpec(paramInfo);
        this.controls[CONTROL_KEY] = {},
            this.deckControl = {};
    };

    ModelControl.prototype.createControl = function () {
        var _this = this;

        var propPanel = this.caller;
        this.$mainControl = propPanel.addPropertyControl(ModelControl.Label, function ($container) {
            _this.$controlContainer = $container;
        }, {
            propertyControlParent: _this.getSection(ModelControl.Section),
            mandatory: _this.options.isMandatory
        });
    };


    ModelControl.prototype.createDeck = function ($container) {
        var $deckControl = $('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');
        this.$controlContainer.append($deckControl);
        this._createDeckDetailControls($deckControl);
    };

    ModelControl.prototype._createDeckDetailControls = function ($deckControl, paramName) {
        var _this = this;
        var paramNm, paramObj;
        if (paramName) {
            paramObj = this.options.params.find(function (paramConf) {
                return paramName == paramConf.attr
            });
            paramNm = paramName;
        } else {
            paramObj = this.options.params[0];
            paramNm = paramObj.attr;
        }
        paramObj.target = this.deckControl;
        if (paramNm === PARAM_APPROXIMATION || paramNm === PARAM_TRAINING_POINTS || paramNm === PARAM_POLYNOMIAL_ORDER_TYPE) {
            _this.createDeckDropdownControl($deckControl, paramObj);
        } else if (paramNm === PARAM_MAX_NODES || paramNm === PARAM_BASIS_ORDER || paramNm === PARAM_TOTAL_POINT) {
            _this.createDeckNumberInputControl($deckControl, paramObj);
        }
    };

    ModelControl.prototype.configureControls = function ($deckControl, paramName, selectedVal) {
        this._removeControls(paramName);
        if (paramName == PARAM_APPROXIMATION) {
            // selectedVal == 'gaussian_process' : do nothing
            if (['mars', 'moving_least_squares', 'radial_basis'].includes(selectedVal)) {
                this._createDeckDetailControls($deckControl, PARAM_TRAINING_POINTS);
            } else if (selectedVal == 'neural_network') {
                this._createDeckDetailControls($deckControl, PARAM_MAX_NODES);
            } else if (selectedVal == 'polynomial') {
                this._createDeckDetailControls($deckControl, PARAM_POLYNOMIAL_ORDER_TYPE);
            }
        } else if (paramName == PARAM_TRAINING_POINTS) {
            if (selectedVal == 'total_points') {
                this._createDeckDetailControls($deckControl, PARAM_TOTAL_POINT);
            }
        } else if (paramName == PARAM_POLYNOMIAL_ORDER_TYPE) {
            if (selectedVal == 'basis_order') {
                this._createDeckDetailControls($deckControl, PARAM_BASIS_ORDER);
            }
        }
    };

    ModelControl.prototype._removeControls = function (paramName) {
        var copiedControl = $.extend(true, {}, this.deckControl);
        for (var controlElem in copiedControl) {
            if (controlElem != paramName && controlElem != PARAM_APPROXIMATION) {
                this.deckControl[controlElem].remove();
                delete this.controls[CONTROL_KEY][controlElem];
            }
        }
    };

    ModelControl.prototype.renderControl = function () {
        var _this = this;
        if(this.controls[CONTROL_KEY]){
            this.createDeck();
        }
        if (!this.options.value) {
            return;
        }
        var paramSpecList = this.options.params;
        paramSpecList.forEach(function (paramObj) {
            if (_this.controls[CONTROL_KEY][paramObj.attr] && _this.options.value[paramObj.attr]) {
                _this.controls[CONTROL_KEY][paramObj.attr].setValue(_this.options.value[paramObj.attr]);
            }
        });
    };

    ModelControl.prototype.getValue = function () {
        var result = {};
        var _this = this;

        var paramSpecList = this.options.params;
        paramSpecList.forEach(function (paramObj) {
            if (_this.controls[CONTROL_KEY] && _this.controls[CONTROL_KEY][paramObj.attr]) {
                result[paramObj.attr] = _this.controls[CONTROL_KEY][paramObj.attr].getValue();
            }
        });
        return result;
    };

    ModelControl.prototype.removeControl = function () {
        if (this.$mainControl) {
            delete this.controls[CONTROL_KEY];
            this.$mainControl.remove();
        }
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ModelControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'mpp-search';

    function MppSearchTypeControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    MppSearchTypeControl.prototype = Object.create(_super);
    MppSearchTypeControl.prototype.constructor = MppSearchTypeControl;

    MppSearchTypeControl.Label = 'Mpp Search';
    MppSearchTypeControl.Section = 'left';

    MppSearchTypeControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Source = [
            {
                "label": "None",
                "value": "none"
            },
            {
                "label": "X Taylor Mean",
                "value": "x_taylor_mean"
            },
            {
                "label": "U Taylor Mean",
                "value": "u_taylor_mean"
            },
            {
                "label": "X Taylor Mpp",
                "value": "x_taylor_mpp"
            },
            {
                "label": "U Taylor Mpp",
                "value": "u_taylor_mpp"
            },
            {
                "label": "X Two Point",
                "value": "x_two_point"
            },
            {
                "label": "U Two Point",
                "value": "u_two_point"
            },
            {
                "label": "No Approx",
                "value": "no_approx"
            }
        ];

        this.controls[CONTROL_KEY] = {}
    };

    MppSearchTypeControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(MppSearchTypeControl.Label, function ($container) {
            _this.createDropDownControl($container, {
                source: _this.options.source || _this.Source
            });
        }, {
            propertyControlParent: _this.getSection(MppSearchTypeControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = MppSearchTypeControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'num-delta';

    function NumDeltaControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    NumDeltaControl.prototype = Object.create(_super);
    NumDeltaControl.prototype.constructor = NumDeltaControl;

    NumDeltaControl.Label = 'Num Delta';
    NumDeltaControl.Section = 'left';

    NumDeltaControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    NumDeltaControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(NumDeltaControl.Label, function ($container) {
            _this.createNumberArrayControl($container, {
                value: _this.options.value
            });
        }, {
            propertyControlParent: _this.getSection(NumDeltaControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = NumDeltaControl;

}).call(this);

/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'num-step';

    function NumStepControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    NumStepControl.prototype = Object.create(_super);
    NumStepControl.prototype.constructor = NumStepControl;

    NumStepControl.Label = 'Num Step';
    NumStepControl.Section = 'left';

    NumStepControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    NumStepControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');
        propPanel.addPropertyControl(NumStepControl.Label, function ($container) {
            $container.append($elements);
            var jqxOptions = {
                min: 1,
                max: 1000,
                placeholder: 100,
                numberType: 'int'
            };
            _this.controls[CONTROL_KEY] = propPanel.createNumberInput($elements, jqxOptions);
        }, {
            propertyControlParent: _this.getSection(NumStepControl.Section),
            mandatory: _this.options.isMandatory
        });

        this.bindValidation({
            $target: $elements,
            control: this.controls[CONTROL_KEY],
            label: NumStepControl.Label
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = NumStepControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'objectives-column';

    /**
     * opt script dialog에서 viewer용으로 사용.
     * @param caller
     * @param options
     * @constructor
     */
    function ObjectivesColumnControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ObjectivesColumnControl.prototype = Object.create(_super);
    ObjectivesColumnControl.prototype.constructor = ObjectivesColumnControl;

    ObjectivesColumnControl.Label = 'Objectives';

    ObjectivesColumnControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    ObjectivesColumnControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;
        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-textareacontrol"/>');
        propPanel.addPropertyControl(ObjectivesColumnControl.Label, function ($container) {
            $container.append($elements);
            var controlOpt = {
                disabled: true
            };

            _this.controls[CONTROL_KEY] = _this.createTextAreaControl($elements, controlOpt);
            _this.controls[CONTROL_KEY].setValue = function (value) {
                if (value) {
                    var nameList =
                        $elements.val(value.map(function (elem) {
                            return elem.name
                        }).join('\n'));
                }
            };
            _this.controls[CONTROL_KEY].getValue = function () {
                return $elements.val();
            };
        }, {mandatory: _this.options.isMandatory});
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ObjectivesColumnControl;

}).call(this);
/**
 * Created by sds on 2018-02-12.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.BaseMultipleDeck.prototype;

    const CONTROL_KEY = 'objectives',
        PARAM_NAME = 'name',
        PARAM_SENSE = 'sense',
        PARAM_SCALE_TYPE = 'scale-type',
        PARAM_SCALE = 'scale';

    function ObjectivesControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ObjectivesControl.prototype = Object.create(_super);
    ObjectivesControl.prototype.constructor = ObjectivesControl;

    ObjectivesControl.Label = 'Objectives';

    ObjectivesControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;

        var paramInfo = [{
            Key: PARAM_NAME,
            Label: 'Name'
        }, {
            Key: PARAM_SENSE,
            Label: 'Sense',
            Default: 'minimize',
            Source: [
                {
                    "label": "Maximize",
                    "value": "maximize"
                },
                {
                    "label": "Minimize",
                    "value": "minimize"
                }
            ]
        }, {
            Key: PARAM_SCALE_TYPE,
            Label: 'Scale Type',
            Default: 'none',
            Source: [
                {
                    "label": "None",
                    "value": "none"
                },
                {
                    "label": "Value",
                    "value": "value"
                },
                {
                    "label": "Log",
                    "value": "log"
                }
            ]
        }, {
            Key: PARAM_SCALE,
            Label: 'Scale',
            NumberType: 'double',
            Default: '1.0'
        }];

        this.registerSpec(paramInfo);
        this.controls[CONTROL_KEY] = [];
        this.$deckElem = [];
    };

    ObjectivesControl.prototype.createControl = function () {
        var _this = this;

        var propPanel = this.caller;
        propPanel.addPropertyControl(this.getLabel(), function ($container) {
            _this.$controlContainer = $container;
        }, {
            propertyControlParent: _this.getSection(ObjectivesControl.Section),
            mandatory: _this.options.isMandatory
        });

        this.createAddButton();
    };


    ObjectivesControl.prototype.createDeck = function () {
        var $deckControl = $('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');
        this.$controlContainer.append($deckControl);
        var methodIdx = (this.controls[CONTROL_KEY]) ? this.controls[CONTROL_KEY].length : 0;
        this.createDeleteButton($deckControl);

        var _this = this;
        var scalingVal = this.getScalingValue();
        var paramObj;
        for (var paramIdx = 0; paramIdx < this.options.params.length; paramIdx++) {
            paramObj = this.options.params[paramIdx];
            if (!scalingVal && [PARAM_SCALE_TYPE, PARAM_SCALE].includes(paramObj.attr)) {
                continue;
            }
            _this._createDeckDetailControls($deckControl, paramObj.attr, methodIdx);
        }
    };

    ObjectivesControl.prototype._createDeckDetailControls = function ($deckControl, paramName, controlIndex) {
        var _this = this, controlOpt = {};
        if (!this.controls[CONTROL_KEY][controlIndex]) {
            this.controls[CONTROL_KEY][controlIndex] = {};
            this.$deckElem[controlIndex] = {};
        }

        var paramObj = this.options.params.find(function (paramConf) {
            return paramName == paramConf.attr
        });
        if (typeof paramObj == 'undefined') {
            console.warn(paramName+' is not defined in json');
            return;
        } else {
            controlOpt = $.extend(true, {
                target: this.$deckElem[controlIndex]
            }, paramObj);
        }

        if (paramName === PARAM_SENSE || paramName === PARAM_SCALE_TYPE) {
            _this.createDeckDropdownControl($deckControl, controlOpt, controlIndex);
        } else if (paramName === PARAM_NAME) {
            _this.createDeckInputControl($deckControl, controlOpt, controlIndex);
        } else if (paramName === PARAM_SCALE) {
            _this.createDeckNumberInputControl($deckControl, controlOpt, controlIndex);
        }
    };

    ObjectivesControl.prototype.updateSectionScroll = function () {
        this.getSection(ObjectivesControl.Section).perfectScrollbar('update');
    };

    ObjectivesControl.prototype.getLabel = function () {
        return ObjectivesControl.Label;
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ObjectivesControl;

}).call(this);
/**
 * Created by sds on 2018-02-12.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'parameters';

    function ParametersControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ParametersControl.prototype = Object.create(_super);
    ParametersControl.prototype.constructor = ParametersControl;

    ParametersControl.Label = 'Parameters';

    ParametersControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    ParametersControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;
        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-columnlist"/>');
        propPanel.addPropertyControl(ParametersControl.Label, function ($container) {
            $container.append($elements);
            var controlOpt = {
                maxRowCount: 3,
                multiple: true
            };
            _this.controls[CONTROL_KEY] = propPanel.createColumnList($elements, controlOpt);
            _this.controls[CONTROL_KEY].setValue = function (value) {
                this.setSelectedItems(value);
                _this.bindValidation({
                    $target: $elements,
                    control: _this.controls[CONTROL_KEY],
                    label: ParametersControl.Label
                });
            };
            _this.controls[CONTROL_KEY].getValue = function () {
                return this.getSelectedItems();
            };
        }, {mandatory: _this.options.isMandatory});

        propPanel.registerColumnControl(_this.controls[CONTROL_KEY]);
    };

    ParametersControl.prototype.bindValidation = function (ctrlInfo) {
        var _this = this;
        if (typeof ctrlInfo.$target == 'undefined') {
            return;
        }
        if (ctrlInfo.mandatory || this.options.isMandatory) {
            this.checkValidation(ctrlInfo);
            ctrlInfo.control.onChange(function (event) {
                _this.checkValidation(ctrlInfo)
            })
        }
    };


    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ParametersControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'partition';

    function PartitionControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    PartitionControl.prototype = Object.create(_super);
    PartitionControl.prototype.constructor = PartitionControl;

    PartitionControl.Label = 'Partition';
    PartitionControl.Section = 'left';

    PartitionControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    PartitionControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(PartitionControl.Label, function ($container) {
            _this.createNumberArrayControl($container, {
                placeHolder: 'ex) 5,5',
                value: _this.options.value
            });
        }, {
            propertyControlParent: _this.getSection(PartitionControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = PartitionControl;

}).call(this);

/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'probability-levels';

    function ProbabilityLevelsControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ProbabilityLevelsControl.prototype = Object.create(_super);
    ProbabilityLevelsControl.prototype.constructor = ProbabilityLevelsControl;

    ProbabilityLevelsControl.Label = 'Probability Levels';
    ProbabilityLevelsControl.Section = 'left';

    ProbabilityLevelsControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    ProbabilityLevelsControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(ProbabilityLevelsControl.Label, function ($container) {
            _this.createInputControl($container, {
                maxLength: 1000,
                placeHolder: "ex) '[[0.1,0.2], [0.3,0.4]]"
            });
        }, {
            propertyControlParent: _this.getSection(ProbabilityLevelsControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ProbabilityLevelsControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'reliability-levels';

    function ReliabilityLevelsControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ReliabilityLevelsControl.prototype = Object.create(_super);
    ReliabilityLevelsControl.prototype.constructor = ReliabilityLevelsControl;

    ReliabilityLevelsControl.Label = 'Reliability Levels';
    ReliabilityLevelsControl.Section = 'left';

    ReliabilityLevelsControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    ReliabilityLevelsControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(ReliabilityLevelsControl.Label, function ($container) {
            _this.createInputControl($container, {
                maxLength: 1000,
                placeHolder: "ex) '[[0.1,0.2], [0.3,0.4]]"
            });
        }, {
            propertyControlParent: _this.getSection(ReliabilityLevelsControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ReliabilityLevelsControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'response-levels';

    function ResponseLevelsControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ResponseLevelsControl.prototype = Object.create(_super);
    ResponseLevelsControl.prototype.constructor = ResponseLevelsControl;

    ResponseLevelsControl.Label = 'Response Levels';
    ResponseLevelsControl.Section = 'left';

    ResponseLevelsControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    ResponseLevelsControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(ResponseLevelsControl.Label, function ($container) {
            _this.createInputControl($container, {
                maxLength: 1000,
                placeHolder: "ex) '[[0.1,0.2], [0.3,0.4]]"
            });
        }, {
            propertyControlParent: _this.getSection(ResponseLevelsControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ResponseLevelsControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'sample-type';

    function SampleTypeControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    SampleTypeControl.prototype = Object.create(_super);
    SampleTypeControl.prototype.constructor = SampleTypeControl;

    SampleTypeControl.Label = 'Sample Type';
    SampleTypeControl.Section = 'left';

    SampleTypeControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Source = [
            {
                "label": "Latin Hypercube Sampling",
                "value": "latin_hypercube_sampling"
            },
            {
                "label": "Random",
                "value": "random"
            }
        ];

        this.controls[CONTROL_KEY] = {}
    };

    SampleTypeControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(SampleTypeControl.Label, function ($container) {
            _this.createDropDownControl($container, {
                source: _this.options.source || _this.Source
            });
        }, {
            propertyControlParent: _this.getSection(SampleTypeControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = SampleTypeControl;

}).call(this);
/**
 * Created by sds on 2018-02-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;
    const CONTROL_KEY = 'samples';

    function SamplesControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    SamplesControl.prototype = Object.create(_super);
    SamplesControl.prototype.constructor = SamplesControl;

    SamplesControl.Label = 'Samples';
    SamplesControl.Section = 'left';

    SamplesControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    SamplesControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');
        propPanel.addPropertyControl(SamplesControl.Label, function ($container) {
            $container.append($elements);
            var jqxOptions = {
                placeholder: '0',
                numberType: 'int'
            };
            _this.controls[CONTROL_KEY] = propPanel.createNumberInput($elements, jqxOptions);
        }, {
            propertyControlParent: _this.getSection(SamplesControl.Section),
            mandatory: _this.options.isMandatory
        });

        this.bindValidation({
            $target: $elements,
            control: this.controls[CONTROL_KEY],
            label: SamplesControl.Label
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = SamplesControl;

}).call(this);
/**
 * Created by sds on 2018-02-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'scaling',
        OBJECTIVES_CONTROL_KEY = 'objectives',
        CONSTRAINTS_CONTROL_KEY = 'constraints';

    function ScalingControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    ScalingControl.prototype = Object.create(_super);
    ScalingControl.prototype.constructor = ScalingControl;

    ScalingControl.Label = 'Scaling';
    ScalingControl.Section = 'left';

    ScalingControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Default = 'false';
        this.Source = [
            {
                "label": "True",
                "value": "true"
            },
            {
                "label": "False",
                "value": "false"
            }
        ];

        this.controls[CONTROL_KEY] = [];
    };

    ScalingControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller,
            source = this.options.source,
            checked;
        var $elements = {};
        var controlVal = (typeof this.options.value != 'undefined') ? this.options.value : this.Default;

        propPanel.addPropertyControl(ScalingControl.Label, function ($container) {
            _this.createRadioButtonControl($container, {
                source: _this.options.source || _this.Source,
                value: controlVal
            });
        }, {
            propertyControlParent: _this.getSection(ScalingControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    ScalingControl.prototype.configureControls = function ($deckControl, paramName, selectedVal) {
        this.caller.controls[OBJECTIVES_CONTROL_KEY].configureScalingControls();
        this.caller.controls[CONSTRAINTS_CONTROL_KEY].configureScalingControls();
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = ScalingControl;

}).call(this);

/**
 * Created by sds on 2018-02-06.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;
    const CONTROL_KEY = 'seed';

    function SeedControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    SeedControl.prototype = Object.create(_super);
    SeedControl.prototype.constructor = SeedControl;

    SeedControl.Label = 'Seed';
    SeedControl.Section = 'left';

    SeedControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    SeedControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');
        propPanel.addPropertyControl(SeedControl.Label, function ($container) {
            $container.append($elements);
            var jqxOptions = {
                placeholder: 'Random',
                numberType: 'int'
            };
            _this.controls[CONTROL_KEY] = propPanel.createNumberInput($elements, jqxOptions);
        }, {
            propertyControlParent: _this.getSection(SeedControl.Section),
            mandatory: _this.options.isMandatory
        });

        this.bindValidation({
            $target: $elements,
            control: this.controls[CONTROL_KEY],
            label: SeedControl.Label
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = SeedControl;

}).call(this);
/**
 * Created by sds on 2018-02-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'sequence-type';

    function SequenceTypeControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    SequenceTypeControl.prototype = Object.create(_super);
    SequenceTypeControl.prototype.constructor = SequenceTypeControl;

    SequenceTypeControl.Label = 'Sequence Type';
    SequenceTypeControl.Section = 'left';

    SequenceTypeControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Source = [
            {
                "label": "Halton",
                "value": "halton"
            },
            {
                "label": "Hammersley",
                "value": "hammersley"
            }
        ];

        this.controls[CONTROL_KEY] = {}
    };

    SequenceTypeControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(SequenceTypeControl.Label, function ($container) {
            _this.createDropDownControl($container, {
                source: _this.options.source || _this.Source
            });
        }, {
            propertyControlParent: _this.getSection(SequenceTypeControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = SequenceTypeControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'step-size';

    function StepSizeControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    StepSizeControl.prototype = Object.create(_super);
    StepSizeControl.prototype.constructor = StepSizeControl;

    StepSizeControl.Label = 'Step Size';
    StepSizeControl.Section = 'left';

    StepSizeControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    StepSizeControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(StepSizeControl.Label, function ($container) {
            _this.createNumberArrayControl($container);
        }, {
            propertyControlParent: _this.getSection(StepSizeControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = StepSizeControl;

}).call(this);

/**
 * Created by sds on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'submethod',
        PARAM_METHOD_NAME = 'method-name',
        PARAM_MAX_ITERATIONS = 'max-iterations';

    function SubmethodControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    SubmethodControl.prototype = Object.create(_super);
    SubmethodControl.prototype.constructor = SubmethodControl;

    SubmethodControl.Label = 'Submethod';
    SubmethodControl.Section = 'left';

    SubmethodControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        var paramInfo = [{
            Key: PARAM_METHOD_NAME,
            Label: 'Method Name',
            Source: [
                {
                    "label": "Conmin Frcg",
                    "value": "conmin_frcg"
                },
                {
                    "label": "Conmin Mfd",
                    "value": "conmin_mfd"
                },
                {
                    "label": "Optpp Fd Newton",
                    "value": "optpp_fd_newton"
                },
                {
                    "label": "Optpp G Newton",
                    "value": "optpp_g_newton"
                },
                {
                    "label": "Optpp Newton",
                    "value": "optpp_newton"
                },
                {
                    "label": "Optpp Pds",
                    "value": "optpp_pds"
                },
                {
                    "label": "Coliny Cobyla",
                    "value": "coliny_cobyla"
                },
                {
                    "label": "Coliny Solis Wets",
                    "value": "coliny_solis_wets"
                },
                {
                    "label": "Ncsu Direct",
                    "value": "ncsu_direct"
                },
                {
                    "label": "Soga",
                    "value": "soga"
                },
                {
                    "label": "Moga",
                    "value": "moga"
                },
                {
                    "label": "Asynch Pattern Search",
                    "value": "asynch_pattern_search"
                },
                {
                    "label": "Coliny Pattern Search",
                    "value": "coliny_pattern_search"
                },
                {
                    "label": "Coliny Direct",
                    "value": "coliny_direct"
                },
                {
                    "label": "Coliny Ea",
                    "value": "coliny_ea"
                },
                {
                    "label": "Efficient Global",
                    "value": "efficient_global"
                }
            ]
        }, {
            Key: PARAM_MAX_ITERATIONS,
            Default: '100',
            Label: 'Max Iterations'
        }];

        this.registerSpec(paramInfo);
        this.controls[CONTROL_KEY] = {}
    };

    SubmethodControl.prototype.createControl = function () {
        var _this = this;

        var propPanel = this.caller;
        propPanel.addPropertyControl(SubmethodControl.Label, function ($container) {
            _this.$controlContainer = $container;
        }, {
            propertyControlParent: _this.getSection(SubmethodControl.Section),
            mandatory: _this.options.isMandatory
        });
    };


    SubmethodControl.prototype.createDeck = function ($container) {
        var $deckControl = $('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');
        this.$controlContainer.append($deckControl);
        this._createDeckDetailControls($deckControl);
    };

    SubmethodControl.prototype._createDeckDetailControls = function ($deckControl) {
        var _this = this;
        var paramName;
        var paramSpecList = this.options.params;
        paramSpecList.forEach(function (paramObj) {
            paramName = paramObj.attr;
            if (paramName === PARAM_METHOD_NAME) {
                _this.createDeckDropdownControl($deckControl, paramObj);
            } else {
                _this.createDeckNumberInputControl($deckControl, paramObj);
            }
        });
    };

    SubmethodControl.prototype.renderControl = function () {
        var _this = this;
        this.createDeck();
        if (!this.options.value) {
            return;
        }
        var paramSpecList = this.options.params;
        paramSpecList.forEach(function (paramObj) {
            _this.controls[CONTROL_KEY][paramObj.attr].setValue(_this.options.value[paramObj.attr]);
        });
    };

    SubmethodControl.prototype.getValue = function () {
        var result = {};
        var _this = this;
        var paramSpecList = this.options.params;
        paramSpecList.forEach(function (paramObj) {
            result[paramObj.attr] = _this.controls[CONTROL_KEY][paramObj.attr].getValue();
        });
        return result;
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = SubmethodControl;

}).call(this);
/**
 * Created by sds on 2018-02-13.
 */
/**
 result json spec
 "surrogate": {
    "type": "true",
    "method-name": "dace",
    "dace-type": "random",
    "samples": "5",
    "seed": "1234"
  },
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'surrogate',
        PARAM_TYPE = 'type',
        PARAM_SUB_METHOD = 'submethod',
        PARAM_METHOD_NAME = 'method-name',
        PARAM_SAMPLE_TYPE = 'sample-type',
        PARAM_DACE_TYPE = 'dace-type',
        PARAM_SAMPLES = 'samples',
        PARAM_SEED = 'seed',
        PARAM_MODEL = 'model'
        ;

    function SurrogateControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    SurrogateControl.prototype = Object.create(_super);
    SurrogateControl.prototype.constructor = SurrogateControl;

    SurrogateControl.Label = 'Surrogate';
    SurrogateControl.Section = 'right';

    SurrogateControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;

        var paramInfo = [{
            Key: PARAM_TYPE,
            Label: 'Surrogate',
            Default: 'false',
            Source: [
                {
                    "label": "True",
                    "value": "true"
                },
                {
                    "label": "False",
                    "value": "false"
                }
            ]
        }, {
            Key: PARAM_SUB_METHOD,
            Label: 'Surrogate Method'
        }, {
            Key: PARAM_METHOD_NAME,
            Label: 'Method Name',
            Source: [
                {
                    "label": "Sampling",
                    "value": "sampling"
                },
                {
                    "label": "Dace",
                    "value": "dace"
                }
            ]
        }, {
            Key: PARAM_SAMPLE_TYPE,
            Label: 'Sample Type',
            Source: [
                {
                    "label": "Latin Hypercube Sampling",
                    "value": "latin_hypercube_sampling"
                },
                {
                    "label": "Random",
                    "value": "random"
                }
            ]
        }, {
            Key: PARAM_DACE_TYPE,
            Label: 'Dace Type',
            Source: [
                {
                    "label": "Random",
                    "value": "random"
                },
                {
                    "label": "Grid Sampling",
                    "value": "grid_sampling"
                },
                {
                    "label": "Orthogonal Array",
                    "value": "orthogonal_array"
                },
                {
                    "label": "Orthogonal Array Latin Hypercube Sampling",
                    "value": "orthogonal_array_latin_hypercube_sampling"
                },
                {
                    "label": "Latin Hypercube Sampling",
                    "value": "latin_hypercube_sampling"
                },
                {
                    "label": "Box Behnken",
                    "value": "box_behnken"
                },
                {
                    "label": "Central Composite",
                    "value": "central_composite"
                }
            ]
        }, {
            Key: PARAM_SAMPLES,
            Label: 'Samples',
            Default: 'Random'
        }, {
            Key: PARAM_SEED,
            Label: 'Seed',
            Default: 'Random'
        }];

        this.registerSpec(paramInfo);
        this.controls[CONTROL_KEY] = {};
    };

    SurrogateControl.prototype.createControl = function () {
        if (!this.options.isMandatory) {
            this._createTypeControl();
        } else {
            this._createModelControl();
            this._createMethodControl();
        }
    };

    SurrogateControl.prototype._createTypeControl = function () {
        var _this = this;
        var propPanel = this.caller,
            source = this.options.source,
            checked;
        var $elements = {};
        var controlVal = (typeof this.options.value != 'undefined') ? this.options.value[PARAM_TYPE] : this.PARAM_INFO[PARAM_TYPE].Default;

        propPanel.addPropertyControl(SurrogateControl.Label, function ($container) {
            _this.createRadioButtonControl($container, {
                source: _this.options.source || _this.PARAM_INFO[PARAM_TYPE].Source,
                // value: controlVal,
                attr: PARAM_TYPE,
                control: _this.controls[CONTROL_KEY]
            });
        }, {
            propertyControlParent: _this.getSection(SurrogateControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    SurrogateControl.prototype._createModelControl = function () {
        var hasModel = this.options.params.some(function (elem) {
            return elem.attr == PARAM_MODEL
        });
        if (hasModel) {
            this.caller._createObjectArrayControl(PARAM_MODEL);
        }
    };

    SurrogateControl.prototype._createMethodControl = function () {
        var _this = this;
        this.$deckElem = {};
        this.controls[CONTROL_KEY][PARAM_SUB_METHOD] = {};

        var propPanel = this.caller;
        this.$deckControlWrapper = propPanel.addPropertyControl(_this.PARAM_INFO[PARAM_SUB_METHOD].Label, function ($container) {
            var $control = $('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');
            $container.append($control);
            _this._createDeckDetailControls($control, PARAM_METHOD_NAME);
        }, {
            propertyControlParent: _this.getSection(SurrogateControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    SurrogateControl.prototype.configureControls = function ($deckControl, paramName, selectedVal) {
        this._removeControls(paramName);
        if (paramName == PARAM_TYPE) {
            if (selectedVal == 'true') {
                //create model, surrogate method control
                this._createModelControl();
                this._renderModelControl();
                this._createMethodControl();
            } else {
                //remove model, surrogate method control
                if (this.$deckControlWrapper) {
                    this.$deckControlWrapper.remove();
                    delete this.controls[CONTROL_KEY][PARAM_SUB_METHOD];
                }
                if (this.caller.controls[PARAM_MODEL]) {
                    this.caller.controls[PARAM_MODEL].removeControl();
                }
            }
        } else if (paramName == PARAM_METHOD_NAME) {
            if (selectedVal == 'sampling') {
                this._createDeckDetailControls($deckControl, PARAM_SAMPLE_TYPE);
            } else {
                //selectedVal == dace
                this._createDeckDetailControls($deckControl, PARAM_DACE_TYPE);
            }
        } else {
            this._createDeckDetailControls($deckControl, PARAM_SAMPLES);
            this._createDeckDetailControls($deckControl, PARAM_SEED);
        }
    };

    SurrogateControl.prototype._createDeckDetailControls = function ($control, paramName) {
        var paramObj = this.options.params.find(function (paramConf) {
            return paramName == paramConf.attr
        });
        var controlOpt = $.extend(true, {
            target: this.$deckElem,
            control: this.controls[CONTROL_KEY][PARAM_SUB_METHOD]
        }, paramObj);
        if (paramName === PARAM_METHOD_NAME || paramName === PARAM_SAMPLE_TYPE || paramName === PARAM_DACE_TYPE) {
            this.createDeckDropdownControl($control, controlOpt);
        } else {
            this.createDeckNumberInputControl($control, controlOpt);
        }
    };

    SurrogateControl.prototype._removeControls = function (paramName) {
        if (!this.$deckControlWrapper) {
            return;
        }
        var copiedControl = $.extend(true, {}, this.$deckElem);
        for (var controlElem in copiedControl) {
            if (controlElem != paramName && controlElem != PARAM_METHOD_NAME) {
                this.$deckElem[controlElem].remove();
                delete this.$deckElem[controlElem];
                delete this.controls[CONTROL_KEY][PARAM_SUB_METHOD][controlElem];
            }
        }
    };

    SurrogateControl.prototype.getValue = function () {
        var result = {};
        var _this = this;
        var paramSpecList = this.options.params;
        var controls = this.controls[CONTROL_KEY];
        paramSpecList.forEach(function (paramObj) {
            if (paramObj.attr == PARAM_TYPE) {
                result[paramObj.attr] = (controls[paramObj.attr]) ? controls[paramObj.attr].getValue() : "true";
            } else if (controls[PARAM_SUB_METHOD] && controls[PARAM_SUB_METHOD][paramObj.attr]) {
                result[paramObj.attr] = controls[PARAM_SUB_METHOD][paramObj.attr].getValue();
            }
        });
        return result;
    };


    SurrogateControl.prototype.renderControl = function () {
        if (!this.options.isMandatory) {
            this._renderTypeControl();
            this._renderMethodControl();
        } else {
            this._renderModelControl();
            this._renderMethodControl();
        }
    };

    SurrogateControl.prototype._renderTypeControl = function () {
        var settingVal = this.PARAM_INFO[PARAM_TYPE].Default;
        if (this.options.value && this.options.value[PARAM_TYPE]) {
            settingVal = this.options.value[PARAM_TYPE]
        }
        if (this.controls[CONTROL_KEY][PARAM_TYPE]) {
            this.controls[CONTROL_KEY][PARAM_TYPE].setValue(settingVal);
        }
    };

    SurrogateControl.prototype._renderModelControl = function () {
        var hasModel = this.options.params.some(function (elem) {
            return elem.attr == PARAM_MODEL
        });
        if (hasModel) {
            this.caller._renderObjectArrayControl(PARAM_MODEL);
        }
    };

    SurrogateControl.prototype._renderMethodControl = function () {
        var _this = this;
        var paramSpecList = this.options.params;
        var controls = this.controls[CONTROL_KEY];
        var settingVal;
        paramSpecList.forEach(function (paramObj) {
            if (paramObj.attr != PARAM_TYPE && paramObj.attr != PARAM_MODEL
                && controls[PARAM_SUB_METHOD] && controls[PARAM_SUB_METHOD][paramObj.attr]) {
                if (_this.options.value && _this.options.value[paramObj.attr]) {
                    settingVal = _this.options.value[paramObj.attr];
                    controls[PARAM_SUB_METHOD][paramObj.attr].setValue(settingVal);
                }
            }
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = SurrogateControl;

}).call(this);
/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'vector';

    function VectorControl(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    VectorControl.prototype = Object.create(_super);
    VectorControl.prototype.constructor = VectorControl;

    VectorControl.Label = 'Vector';
    VectorControl.Section = 'left';

    VectorControl.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
    };

    VectorControl.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(VectorControl.Label, function ($container) {
            _this.createNumberArrayControl($container, {
                value: _this.options.value
            });
        }, {
            propertyControlParent: _this.getSection(VectorControl.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = VectorControl;

}).call(this);

/**
 * Created by sds on 2018-02-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;

    const CONTROL_KEY = 'vector-type';

    function VectorTypeContol(caller, options) {
        _super.constructor.call(this, caller, options);
    }

    VectorTypeContol.prototype = Object.create(_super);
    VectorTypeContol.prototype.constructor = VectorTypeContol;

    VectorTypeContol.Label = 'Vector Type';
    VectorTypeContol.Section = 'left';

    VectorTypeContol.prototype.init = function () {
        _super.init.call(this);
        this.CONTROL_KEY = CONTROL_KEY;
        this.Source = [
            {
                "label": "Final Val",
                "value": "final_val"
            },
            {
                "label": "Step Size",
                "value": "step_size"
            }
        ];

        this.controls[CONTROL_KEY] = {}
    };

    VectorTypeContol.prototype.createControl = function () {
        var _this = this;
        var propPanel = this.caller;

        propPanel.addPropertyControl(VectorTypeContol.Label, function ($container) {
            _this.createDropDownControl($container, {
                source: _this.options.source || _this.Source
            });
        }, {
            propertyControlParent: _this.getSection(VectorTypeContol.Section),
            mandatory: _this.options.isMandatory
        });
    };

    Brightics.VA.Core.Editors.Sheet.Controls.Optimization[CONTROL_KEY] = VectorTypeContol;

}).call(this);
/**
 * Created by jhoon80.park on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;

    function BasePanel(parentId, options) {
        this.parentId = parentId;
        this.panelId = _.uniqueId();
        this.options = options;
        this.FnUnitUtils = brtc_require('FnUnitUtils');
        this.retrieveParent();

        this.registerProblemListener();
        this.registerCommandListener();

        this.createControls();
        this.configureOptions();

        this.init();
    }

    BasePanel.prototype.init = function () {
        this.$mainControl.attr('type', this.options.type);
    };

    BasePanel.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
        if(!this.options.modelEditor){
            this.options.modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$parent);
        }
    };

    BasePanel.prototype.registerScrollListener = function () {
    };

    BasePanel.prototype.registerProblemListener = function () {
    };

    BasePanel.prototype.registerCommandListener = function () {
    };

    BasePanel.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('<div class="brtc-va-editors-sheet-panels-basepanel"/>');
        this.$parent.append(this.$mainControl);

        this.createTopArea();
        this.createContentsArea();
        this.createBottomArea();

        if (this.$topArea) {
            this.createTopAreaControls(this.$topArea);
        }
        if (this.$bottomArea) {
            this.createBottomAreaControls(this.$bottomArea);
        }
        if (this.$contentsArea) {
            this.createContentsAreaControls(this.$contentsArea);
            if (this.$contentsArea.hasClass('brtc-va-editors-sheet-panels-propertiespanel-contents-area')) {
                this.$contentsArea.perfectScrollbar();
            }
        }

        var $persistButton = this.$topArea.find('.brtc-va-editors-sheet-panels-basepanel-header-tooltip');
        $persistButton.click(function () {
            if ($persistButton.attr('persist-mode') === 'auto') {
                $persistButton.attr('persist-mode', 'true');
                _this.options.fnUnit["persist-mode"] = 'true';
            } else if ($persistButton.attr('persist-mode') === 'true') {
                $persistButton.attr('persist-mode', 'false');
                _this.options.fnUnit["persist-mode"] = 'false';
            } else {
                $persistButton.attr('persist-mode', 'auto');
                _this.options.fnUnit["persist-mode"] = 'auto';
            }
            var properties = {
                'persist-mode': _this.options.fnUnit["persist-mode"]
            };
            var command = _this.createSetFnUnitCommand(properties);
            _this.executeCommand(command);
        });

    };

    BasePanel.prototype.destroy = function () {
        // abstract
    };

    BasePanel.prototype.createTopAreaHeaderTitle = function ($parent) {
        var _this = this;

        this.$header = $('' +
            '<div class="brtc-va-editors-sheet-panels-basepanel-header brtc-va-editors-sheet-panels-datapanel-header">' +
            '   <div class="brtc-va-editors-sheet-worksheet-selector"></div>' +
            '   <div class="brtc-va-editors-sheet-panels-basepanel-header-container">' +
            '       <div class="brtc-va-editors-sheet-panels-basepanel-header-title" />' +
            '   </div>' +
            '</div>');

        var $title = this.$header.find('.brtc-va-editors-sheet-panels-basepanel-header-title');
        $title.attr('title', this.options.title);

        $parent.append(this.$header);
    };

    BasePanel.prototype.createMinMaxToolItem = function ($toolbar) {
        var _this = this;

        this.$minMaxButton = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-maximize" title="Max/Min"></div>');
        this.$minMaxButton.attr('maximize', 'false');
        $toolbar.append(this.$minMaxButton);

        var $inDataPanel = this.$parent.closest('.brtc-va-editors-sheet-fnunitviewer').find('.brtc-va-editors-sheet-fnunitviewer-indata-fncenter'),
            $outDataPanel = this.$parent.closest('.brtc-va-editors-sheet-fnunitviewer').find('.brtc-va-editors-sheet-fnunitviewer-outdata-fncenter');

        if (_this.options.panelType === 'in' && $outDataPanel.css('display') === 'none') {
            this.adjustMaximize(true);
        } else if (_this.options.panelType === 'out' && $inDataPanel.css('display') === 'none') {
            this.adjustMaximize(true);
        }

        this.$minMaxButton.on('click', function (event) {
            if ($(this).attr('maximize') === 'true') {
                _this.adjustMaximize(false);
            } else {
                _this.adjustMaximize(true);
            }

            _this.$parent.trigger('sizeChange', [_this.options.panelType]);
        });
        this.$minMaxButton.css('display', this.options.resizable ? 'block' : 'none');
    };

    BasePanel.prototype.adjustMaximize = function (isMaximize) {
        if (isMaximize) {
            this.$minMaxButton.removeClass('brtc-va-editors-sheet-panels-datapanel-toolitem-maximize').addClass('brtc-va-editors-sheet-panels-datapanel-toolitem-minimize').attr('maximize', 'true');
        } else {
            this.$minMaxButton.removeClass('brtc-va-editors-sheet-panels-datapanel-toolitem-minimize').addClass('brtc-va-editors-sheet-panels-datapanel-toolitem-maximize').attr('maximize', 'false');
        }
    };

    BasePanel.prototype.adjustHeader = function () {
    };

    BasePanel.prototype.createTopArea = function () {
        this.$topArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-top-area"></div>');
        this.$mainControl.append(this.$topArea);
    };

    BasePanel.prototype.createContentsArea = function () {
        this.$contentsArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-contents-area" ></div>');
        this.$mainControl.append(this.$contentsArea);
    };

    BasePanel.prototype.createBottomArea = function () {
        this.$bottomArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-bottom-area"></div>');
        this.$mainControl.append(this.$bottomArea);
    };

    BasePanel.prototype.createTopAreaControls = function ($parent) {
        var $header = $('' +
            '<div class="brtc-va-editors-sheet-panels-basepanel-header">' +
            '   <div class="brtc-va-editors-sheet-panels-basepanel-header-tooltip" item-type="persist" persist-mode="auto"><i title="Persist" class="fa fa-hdd-o" style="font-size: 1.5em;" aria-hidden="true"></i></div>' +
            '   <div class="brtc-va-editors-sheet-panels-basepanel-header-title"></div>' +
            '</div>' +
            '');

        $header.find('.brtc-va-editors-sheet-panels-basepanel-header-title').text(this.options.title);
        $parent.append($header);
        return $header;
    };

    BasePanel.prototype.createContentsAreaControls = function ($parent) {
    };

    BasePanel.prototype.createBottomAreaControls = function ($parent) {
    };

    BasePanel.prototype.configureOptions = function () {
    };

    BasePanel.prototype.configureRunnable = function () {
    };

    BasePanel.prototype.hideCallFunctionButton = function () {
    };

    BasePanel.prototype.setInOutData = function () {
    };

    BasePanel.prototype.hideTopArea = function () {
        this.$topArea.hide();
    };

    BasePanel.prototype.hideBottomArea = function () {
        this.$bottomArea.hide();
    };

    BasePanel.prototype.renderFail = function ($parent, message) {
        var $fail = $('<div class="brtc-va-editors-sheet-panels-basepanel-fail"><h3></h3></div>');
        $parent.append($fail);

        $fail.addClass('brtc-style-full').addClass('brtc-style-flex-center');
        $fail.find('h3').text(message);
    };

    Brightics.VA.Core.Editors.Sheet.Panels.BasePanel = BasePanel;

}).call(this);

/**
 * Created by gy84.bae on 2016-02-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var downloader = Brightics.VA.Core.Utils.DownLoader;

    const PANEL_TYPE_IN = 'in';
    const PANEL_TYPE_OUT = 'out';
    const DATA_POST_FIX = 'Data';
    const DEFAULT_PAGE_OPTION = {
        pageNum: 1,
        pageSize: 1000,
        count: 0
    };
    const ScriptArr = ['scalaScript', 'pythonScript'];

    function DataPanel(parentId, options) {
        this.pageOptionsMap = {};

        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.call(this, parentId, options);
        this.createDataWorksheet();
        this._setOutTableInfo();
    }

    DataPanel.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype);
    DataPanel.prototype.constructor = DataPanel;

    DataPanel.prototype.registerCommandListener = function () {
        var _this = this;
        this.commandListener = function (command) {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand || command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand) {
                if (_this.options.fnUnit.fid === command.options[TARGET_FID]) {
                    _this.handleConnectionCommand(command);
                }
            } else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand) {
                if (_this.options.fnUnit.fid === command.options[TARGET_FID] || _this.options.fnUnit.fid === command.old[TARGET_FID]) {
                    _this.handleConnectionCommand(command);
                }
            } else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand) {
                if (_this.options.fnUnit.fid === command.options.fnUnit.fid) {
                    _this.handleOutTableCommand(command);
                }
            } else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand) {
                if (_this.options.fnUnit.fid === command.options.fnUnit.fid) {
                    _this.handleConnectionCommand(command);
                }
            } else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand) {
                if (_this.options.fnUnit.fid === command.options.fnUnit.fid) {
                    _this.handleConnectionCommand(command);
                }
            } else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewOutTableCommand) {
                if (_this.options.fnUnit.fid === command.options.fnUnit.fid) {
                    _this.handleNewOutTableCommand(command);
                }
            }
            else if (command instanceof Brightics.VA.Core.CompoundCommand) {
                $.each(command.commandList, function (index, com) {
                    if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand || com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand) {
                        if (_this.options.fnUnit.fid === com.options[TARGET_FID]) {
                            _this.handleConnectionCommand(com);
                        }
                    } else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand) {
                        if (_this.options.fnUnit.fid === com.options[TARGET_FID] || _this.options.fnUnit.fid === com.old[TARGET_FID]) {
                            _this.handleConnectionCommand(com);
                        }
                    } else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand) {
                        if (_this.options.fnUnit.fid === com.options.fnUnit.fid && ScriptArr.indexOf(_this.options.fnUnit.func) == -1) {
                            _this.handleOutTableCommand(com);
                        }
                    }
                    else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand) {
                        if (_this.options.fnUnit.fid === com.options.fnUnit.fid) {
                            _this.handleConnectionCommand(com);
                        }
                    }
                    else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand) {
                        if (_this.options.fnUnit.fid === com.options.fnUnit.fid) {
                            _this.handleConnectionCommand(com);
                        }
                    }
                    else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewOutTableCommand) {
                        if (_this.options.fnUnit.fid === com.options.fnUnit.fid) {
                            _this.handleNewOutTableCommand(com);
                        }
                    }
                });
            }
        };
        this.options.modelEditor.addCommandListener(this.commandListener);
    };

    DataPanel.prototype.handleOutTableCommand = function (command) {
        if (this.options.fnUnit.hasOwnProperty('parent')) {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand) {
                if (this.display.panelType === PANEL_TYPE_OUT) {
                    this.initialize(this.display.panelType);
                    this.refreshHeaderToolbar();
                    this.dataWorksheet.renderDataWorksheet();
                }
            }
        }
    };

    DataPanel.prototype.handleConnectionCommand = function (command) {
        if (this.options.fnUnit.hasOwnProperty('parent')) {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand ||
                command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand ||
                command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand ||
                command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand ||
                command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand) {
                if (this.display.panelType === PANEL_TYPE_IN) {
                    this.initialize(this.display.panelType);
                    this.refreshHeaderToolbar();
                    this.dataWorksheet.renderDataWorksheet();
                }
            }
        }
    };

    DataPanel.prototype.handleNewOutTableCommand = function (command) {
        if (this.options.fnUnit.hasOwnProperty('parent')) {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewOutTableCommand) {
                if (this.display.panelType === PANEL_TYPE_OUT) {
                    this.initialize(this.display.panelType);
                    this.refreshHeaderToolbar();
                    this.dataWorksheet.renderDataWorksheet();
                }
            }
        }
    };

    DataPanel.prototype.destroy = function () {
        this.$worksheetSelector.jqxDropDownList('destroy');
        this.$contextMenu.jqxMenu('destroy');

        if (this.pagination) {
            this.pagination.destroy();
        }
        if (this.dataSchema) {
            this.dataSchema.destroy();
        }
        if (this.dataWorksheet) {
            this.dataWorksheet.destroy();
        }
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.destroy.call(this);
        this.options.modelEditor.removeCommandListener(this.commandListener);
    };

    DataPanel.prototype.initialize = function (panelType) {
        this.display.tableList = [];
        var analyticsModel = this.options.fnUnit.parent();
        if (panelType === PANEL_TYPE_IN) {
            var previous = analyticsModel.getPrevious(this.options.fnUnit.fid);
            for (var i = 0; i < previous.length; i++) {
                var sourceFnUnit = analyticsModel.getFnUnitById(previous[i]);
                if (sourceFnUnit) this.display.tableList = this.display.tableList.concat(this.FnUnitUtils.getOutTable(sourceFnUnit));
            }
        }

        if (panelType === PANEL_TYPE_OUT) {
            this.display.tableList = this.FnUnitUtils.getOutTable(this.options.fnUnit) || [];
        }
    };

    DataPanel.prototype._getSelectedTable = function () {
        var selectedTable;
        if (this.selectedTableId) selectedTable = this.selectedTableId;
        else selectedTable = this.display.tableList[0];
        return selectedTable;
    };

    DataPanel.prototype._isDisposed = function () {
        return this.$contentsArea.closest('.brtc-va-editors-sheet-fnunitviewer-panel').length === 0;
    };

    DataPanel.prototype._updatePagination = function (tableId, currentRowCount) {
        if (this.pagination) {
            this.pageOptionsMap[tableId] = this.pageOptionsMap[tableId] || $.extend(true, {}, DEFAULT_PAGE_OPTION);
            var begin = (this.pageOptionsMap[tableId].pageNum - 1) * this.pageOptionsMap[tableId].pageSize + 1;
            var end = begin + currentRowCount - 1;
            this.pagination.setPageRows(begin, end);
            var totalCount = -1;
            if (this.pageOptionsMap[tableId].count >= 0) totalCount = this.pageOptionsMap[tableId].count;
            else {
                if (currentRowCount < this.pageOptionsMap[tableId].pageSize) totalCount = currentRowCount;
            }
            this.pagination.setTotalCount(totalCount);
        }
    };

    DataPanel.prototype.getChartTypeList = function () {
        return Object.keys(Brightics.Chart.Registry);
    };

    DataPanel.prototype.getChartLabelByType = function (type) {
        return Brightics.Chart.Registry[type].Label;
    };

    DataPanel.prototype.getRenderChart = function () {
        var rt = [];

        var requested = this.options.dataProxy.requested;
        var tid = Object.keys(requested)[0];
        var inOutType = 'in';

        if (this.options.fnUnit.version === '3.6') {
            var outputsObj = this.options.fnUnit['outputs'];
            if (outputsObj) {
                for (var element in outputsObj) {
                    if (outputsObj[element] === tid) {
                        inOutType = 'out';
                        break;
                    }
                }
            }
        } else {
            var outTableArr = this.options.fnUnit[OUT_DATA];
            if (outTableArr && outTableArr.indexOf(tid) > -1) {
                inOutType = 'out';
            }
        }

        var panels = this.options.fnUnit.display.sheet[inOutType].partial[0].panel;

        for (var i in panels) {
            rt.push(panels[i].chartOption.chart.type);
        }

        return rt;
    };

    DataPanel.prototype.createRecommendedChartSheet = function () {
        var _this = this,
            func = this.options.fnUnit.func,
            recommendChartList = this.display.panelType == PANEL_TYPE_IN ? ['table'] : root.Brightics.VA.Env.Recommend.NextChart[func] || ['table'],
            chartTypes = this.getChartTypeList();

        var ctArr = this.getRenderChart();
        var defaultChartType = ctArr[0];

        var $recommendArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-contents-recommend-area"></div>');
        this.$contentsArea.empty();
        this.$contentsArea.append($recommendArea);

        var $firstChart = $recommendArea.find('.brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box').first();
        $firstChart.addClass('brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box-selected');
        _this.options.selectedChart = $firstChart.find(':first-child').attr('type');

        $recommendArea.append('<div class="brtc-va-editors-sheet-panels-basepanel-contents-recommend-title">Recommended Graph Type</div>');
        var $chartListArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-contents-recommend-chart-list"></div>');
        $recommendArea.append($chartListArea);

        $.each(recommendChartList, function (index, value) {
            $chartListArea.append('<div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box">' +
                '<div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-icon" type=' + value + '></div>' +
                '<div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-text">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(_this.getChartLabelByType(value)) + '</div>' +
                '</div>');
        });

        $recommendArea.append('<div class="brtc-va-editors-sheet-panels-basepanel-contents-recommend-title">Available Graph Type</div>');
        var $commonChartListArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-contents-available-chart-list"></div>');
        $recommendArea.append($commonChartListArea);

        $.each(chartTypes, function (index, value) {
            $commonChartListArea.append('<div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box">' +
                '<div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-icon" type=' + value + '></div>' +
                '<div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-text">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(_this.getChartLabelByType(value)) + '</div>' +
                '</div>');
        });

        var $selectedChart = $recommendArea.find('.brtc-va-editors-sheet-panels-basepanel-contents-chart-icon[type=' + defaultChartType + ']').closest('.brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box');
        $selectedChart.addClass('brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box-selected');
        _this.options.selectedChart = defaultChartType;

        $recommendArea.slimScroll({
            color: '#a4bed4',
            height: '100%'
        });

        var $chartIcons = $recommendArea.find('.brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box');
        $chartIcons.click(function (event) {
            var $target = $(event.target);

            if (!$target.hasClass('brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box')) {
                $target = $target.closest('.brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box');
            }

            $chartIcons.removeClass('brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box-selected');
            $target.addClass('brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box-selected');
            _this.options.selectedChart = $target.find(':first-child').attr('type');
        });

        if (window.useSpark !== 'true') {
            $('.brtc-va-editors-sheet-panels-basepanel-contents-chart-icon[type="decisionTreeForBrightics"]').parent().hide();
        }
    };

    DataPanel.prototype.createBottomAreaControls = function ($parent) {
        var _this = this;

        this.pagination = new Brightics.Chart.Component.Pagination($parent, {
            pageNum: 1,
            pageSize: Brightics.VA.SettingStorage.getValue('editor.datapanel.defaultrowcount') * 1,
            changed: function (info) {
                var selectedTableId = _this._getSelectedTable();
                _this.pageOptionsMap[selectedTableId] = _this.pageOptionsMap[selectedTableId] || $.extend(true, {}, DEFAULT_PAGE_OPTION);
                _this.pageOptionsMap[selectedTableId].pageNum = info.pageNum;
                _this.pageOptionsMap[selectedTableId].pageSize = info.pageSize;
                _this.options.dataProxy.requestPageData(selectedTableId, function (result, tableId) {
                    if (_this._isDisposed() === false && result.data.length > 0) {
                        result.offset = (_this.pageOptionsMap[tableId].pageNum - 1) * _this.pageOptionsMap[tableId].pageSize;
                        _this.dataWorksheet.updataPageInfo(tableId,
                            {
                                page: info.pageNum,
                                pageSize: info.pageSize
                            });
                        _this.dataWorksheet.setDataSet(tableId, result);
                        _this._updatePagination(tableId, result.data.length);
                    }
                }, function (err) {
                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                }, _this.pageOptionsMap[selectedTableId].pageNum, _this.pageOptionsMap[selectedTableId].pageSize);
            }
        });

        this.pagination.$mainControl.find('.bcharts-pagination-showing').hide();
        this.pagination.$mainControl.css('float', 'right');
        this.pagination.hide();
    };

    DataPanel.prototype.setPaginationInfo = function (pageInfo) {
        if (pageInfo.page) {
            if (pageInfo.showPageSelector === false) {
                this.pagination.showOnlyCount();
            } else {
                this.pagination.show();
            }
            this.pagination.update({
                pageNum: pageInfo.page,
                totalCount: pageInfo.count,
                pageSize: pageInfo.pageSize,
                columnCount: pageInfo.columns.length
            });
            this.dataSchema.show();
            this.dataSchema.update(pageInfo);
            this.selectedTableId = pageInfo.tableId;

            this.pageOptionsMap[pageInfo.tableId] = this.pageOptionsMap[pageInfo.tableId] || $.extend(true, {}, DEFAULT_PAGE_OPTION);
            this.pageOptionsMap[pageInfo.tableId].count = pageInfo.count;

        } else {
            this.pagination.hide();
            this.dataSchema.hide();
        }
    };

    DataPanel.prototype.createDataWorksheet = function () {
        var _this = this;
        if (this.dataWorksheet) {
            this.dataWorksheet.destroy();
        }
        _this.$contentsArea.empty();
        var dataWorksheetType = this.$worksheetSelector.jqxDropDownList('getSelectedIndex');
        if (dataWorksheetType === 0) {
            _this.$topArea.attr('sheet-type', 'partial');
            _this.dataWorksheet = new Brightics.VA.Core.Editors.Sheet.Controls.DataWorksheet(_this.$contentsArea, {
                selectedChart: this.options.selectedChart || 'table',
                dataProxy: this.options.dataProxy,
                panelType: _this.display.panelType,
                fnUnit: _this.options.fnUnit,
                callback: {
                    createRecommendedChartSheet: _this.createRecommendedChartSheet.bind(this),
                    setPaginationInfo: this.setPaginationInfo.bind(this)
                }
            });
        } else if (dataWorksheetType === 1) {
            _this.$topArea.attr('sheet-type', 'full');
            _this.dataWorksheet = new Brightics.VA.Core.Editors.Sheet.Controls.BigDataWorksheet(_this.$contentsArea, {
                dataProxy: this.options.dataProxy,
                panelType: _this.display.panelType,
                fnUnit: _this.options.fnUnit,
                callback: {
                    createRecommendedChartSheet: _this.createRecommendedChartSheet.bind(this),
                    setPaginationInfo: this.setPaginationInfo.bind(this)
                }
            });
        }
    };

    DataPanel.prototype.createContentsArea = function () {
        this.display = {
            panelType: this.$parent.attr("datapaneltype") || 'in'
        };

        this.initialize(this.display.panelType);
        var preContents = this.$mainControl.find('.brtc-va-editors-sheet-panels-basepanel-contents-area');
        if (preContents.length > 0) preContents.remove();

        this.$infoArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-info-area" />');
        this.$contentsArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-contents-area brtc-va-editors-sheet-panels-datapanel-content brtc-style-margin-bottom-3" />');

        this.$mainControl.append(this.$infoArea).append(this.$contentsArea);
    };

    DataPanel.prototype.createTopAreaControls = function ($parent) {
        this.$header = $('' +
            '<div class="brtc-va-editors-sheet-panels-basepanel-header brtc-va-editors-sheet-panels-datapanel-header">' +
            '   <div class="brtc-va-editors-sheet-worksheet-selector"></div>' +
            '   <div class="brtc-va-editors-sheet-panels-basepanel-header-container">' +
            '       <div class="brtc-va-editors-sheet-panels-basepanel-header-title" />' +
            '   </div>' +
            '   <div title="Chart Context Menu" class="brtc-va-editors-sheet-panels-basepanel-header-context-menu-open" />' +
            '   <div class="brtc-va-editors-sheet-panels-basepanel-header-context-menu" />' +
            '</div>');

        this.$contextMenuOpen = this.$header
            .find('.brtc-va-editors-sheet-panels-basepanel-header-context-menu-open');
        this.createTopAreaHeaderTitle($parent);
        this.createTopAreaHeaderToolbar();
        this.createTopAreaHeaderContext(this.$contextMenuOpen);
    };

    DataPanel.prototype.createTopAreaHeaderTitle = function ($parent) {
        var _this = this;

        // var $title = this.$header.find('.brtc-va-editors-sheet-panels-basepanel-header-title');
        
        this.dataSchema = new Brightics.VA.Core.Editors.Sheet.Panels.DataSchema(this.$infoArea);
        this.dataSchema.hide();

        $parent.append(this.$header);
        this.$worksheetSelector = this.$header.children('.brtc-va-editors-sheet-worksheet-selector').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            source: ['Partial Rendering', 'Full Rendering'],
            width: 120,
            autoDropDownHeight: true,
            dropDownWidth: 120,
            selectedIndex: 0
        });
        this.$worksheetSelector.on('change', function (event) {
            _this.pagination.hide();
            _this.dataSchema.hide();
            _this.createDataWorksheet();
        });
    };

    DataPanel.prototype.createTopAreaHeaderContext = function ($ctxMenuOpen) {
        var _this = this;
        this._createTopAreaHeaderContext = this._createTopAreaHeaderContext || (function ($ctxMenuOpen) {
            var init = false;
            var $toolbarChildren = this.$toolbar.children();
            var $contextMenu = this.$header
                .find('.brtc-va-editors-sheet-panels-basepanel-header-context-menu');
            this.$contextMenu = $contextMenu;

            return function () {
                var items = _.filter($toolbarChildren, function ($toolbarChild) {
                    return !($($toolbarChild)
                        .hasClass('brtc-va-editors-sheet-panels-datapanel-toolitem-splitter'));
                });

                var handlers = items.map(function (item) {
                    return function () {
                        item.click();
                    };
                });

                if (!init) {

                    $contextMenu.jqxMenu({
                        theme: Brightics.VA.Env.Theme,
                        width: '120px',
                        height: '100%',
                        autoOpenPopup: false,
                        mode: 'popup',
                        animationHideDuration: 0,
                        animationShowDuration: 0
                    });

                    $ctxMenuOpen.click(function (evt) {
                        $contextMenu.jqxMenu('open', Math.min(evt.clientX, $(window).width() - 120),
                            evt.clientY);
                    });

                    $contextMenu.on('itemclick', function (evt) {
                        var index = $(evt.args.children[0]).attr('index');
                        handlers[index]();
                    });
                    init = true;
                }

                var source = items.map(function (item, index) {
                    return _.template('<span index="${index}" title="${label}">${label}</span>')({
                        label: item.title,
                        index: index
                    });
                });

                $contextMenu.jqxMenu('source', source);
            };
        }.call(this, $ctxMenuOpen));

        this._createTopAreaHeaderContext($ctxMenuOpen);
    };

    DataPanel.prototype.createTopAreaHeaderToolbar = function () {
        var _this = this,
            $toolbar = $('' +
                '<div class="brtc-va-editors-sheet-panels-datapanel-toolbar"/>');
        this.$header.append($toolbar);
        this.$toolbar = $toolbar;

        this.createPopupToolItem($toolbar);
        this.createMinMaxToolItem($toolbar);
        $toolbar.append('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-splitter"></div>');
        this.createArrangeToolItem($toolbar);
        $toolbar.append('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-splitter"></div>');
        this.createDownloadItem($toolbar);
        $toolbar.find('.brtc-va-editors-sheet-panels-datapanel-toolitem-splitter:eq(0)').css('display', this.options.resizable ? 'block' : 'none');
    };

    DataPanel.prototype.createMinMaxToolItem = function ($toolbar) {
        var _this = this;

        this.$minMaxButton = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-maximize" title="Max/Min"></div>');
        this.$minMaxButton.attr('maximize', 'false');
        $toolbar.append(this.$minMaxButton);

        var $inDataPanel = this.$parent.closest('.brtc-va-editors-sheet-fnunitviewer').find('.brtc-va-editors-sheet-fnunitviewer-indata-fncenter'),
            $outDataPanel = this.$parent.closest('.brtc-va-editors-sheet-fnunitviewer').find('.brtc-va-editors-sheet-fnunitviewer-outdata-fncenter');

        if (_this.display.panelType === 'in' && $outDataPanel.css('display') === 'none') {
            this.adjustMaximize(true);
        } else if (_this.display.panelType === 'out' && $inDataPanel.css('display') === 'none') {
            this.adjustMaximize(true);
        }

        this.$minMaxButton.on('click', function (event) {
            if ($(this).attr('maximize') === 'true') {
                _this.adjustMaximize(false);
            } else {
                _this.adjustMaximize(true);
            }

            _this.$parent.trigger('sizeChange', [_this.display.panelType]);
        });
        this.$minMaxButton.css('display', this.options.resizable ? 'block' : 'none');
    };

    DataPanel.prototype.adjustMaximize = function (isMaximize) {
        if (isMaximize) {
            this.$minMaxButton.removeClass('brtc-va-editors-sheet-panels-datapanel-toolitem-maximize').addClass('brtc-va-editors-sheet-panels-datapanel-toolitem-minimize').attr('maximize', 'true');
        } else {
            this.$minMaxButton.removeClass('brtc-va-editors-sheet-panels-datapanel-toolitem-minimize').addClass('brtc-va-editors-sheet-panels-datapanel-toolitem-maximize').attr('maximize', 'false');
        }
    };

    DataPanel.prototype.createArrangeToolItem = function ($toolbar) {
        var _this = this;
        var $arrangeEvenly = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-arrange-evenly" title="Evenly"></div>');
        $toolbar.append($arrangeEvenly);
        $arrangeEvenly.on('click', function (event) {
            _this.dataWorksheet.arrange('evenly');
        });

        var $arrangeStacked = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-arrange-stacked" title="Horizontal"></div>');
        $toolbar.append($arrangeStacked);
        $arrangeStacked.on('click', function (event) {
            _this.dataWorksheet.arrange('horizontal');
        });

        var $arrangeSideBySide = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-arrange-side-by-side" title="Vertical"></div>');
        $toolbar.append($arrangeSideBySide);
        $arrangeSideBySide.on('click', function (event) {
            _this.dataWorksheet.arrange('vertical');
        });
    };

    DataPanel.prototype.createPopupToolItem = function ($toolbar) {
        var _this = this;
        var $popup = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-popup" title="Pop up Chart" target="popupChart"></div>');
        $toolbar.append($popup);

        var _makePageOptionArray = function () {
            var tableIds = _this.FnUnitUtils.getTable(_this.options.fnUnit, _this.options.panelType);
            var offsetArr = [], limitArr = [];
            tableIds.forEach(function (tableId) {
                if (_this.pageOptionsMap[tableId]) {
                    offsetArr.push((_this.pageOptionsMap[tableId].pageNum - 1) * _this.pageOptionsMap[tableId].pageSize);
                    limitArr.push(_this.pageOptionsMap[tableId].pageSize)
                } else {
                    offsetArr.push(0);
                    limitArr.push(1000);
                }
            });
            return {
                offsetArr: offsetArr,
                limitArr: limitArr
            };
        };

        $popup.click(
            function () {
                var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
                var pageOptArr = _makePageOptionArray();
                var param = {
                    user: Brightics.VA.Env.Session.userId,
                    pid: modelEditor.options.editorInput.getProjectId(),
                    mid: _this.options.fnUnit.parent().mid,
                    fid: _this.options.fnUnit.fid,
                    tids: _this.FnUnitUtils.getTable(_this.options.fnUnit, _this.options.panelType),
                    offsetArr: pageOptArr.offsetArr,
                    limitArr: pageOptArr.limitArr
                };

                var params = $.map(param, function (value, key) {
                    return key + '=' + value;
                }).join('&');
                window.open('popupchart?' + params, 'popupChart');
            }
        );
    };

    DataPanel.prototype.onSetDataWorksheetInform = function (worksheetData) {
        var compoundCommand = new Brightics.VA.Core.CompoundCommand(this, {
            id: 'brightics.va.editors.diagram.commands.setdataworksheetimformation'
        });
        compoundCommand.add(this.createSetDataWorksheetPanelCommand(worksheetData.panel));
        compoundCommand.add(this.createSetDataWorksheetLayoutCommand(worksheetData.layout));

        this.executeCommand(compoundCommand);
    };

    DataPanel.prototype.createSetDataWorksheetPanelCommand = function (newPanel) {
        var setDataWorksheetPanelCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetPanelCommand(this, {
            panel: this.options.fnUnit.display.sheet[this.display.panelType][0].panel,
            newPanel: newPanel
        });

        return setDataWorksheetPanelCommand;
    };

    DataPanel.prototype.createSetDataWorksheetLayoutCommand = function (newLayout) {
        var setDataWorksheetLayoutCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand(this, {
            layout: this.options.fnUnit.display.sheet[this.display.panelType][0].layout,
            newLayout: newLayout
        });

        return setDataWorksheetLayoutCommand;
    };

    DataPanel.prototype.executeCommand = function (command) {
        var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);
        modelEditor.getCommandManager().execute(command);
    };

    DataPanel.prototype.createDownloadItem = function ($toolbar) {
        var $download = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-download" title="Download"></div>');
        $toolbar.append($download);
        var _this = this;
        $download.click(function (event) {
            var model = _this.options.fnUnit.parent();
            var userId = Brightics.VA.Env.Session.userId;
            var mid = model.mid;
            var tableObjList = [];
            var tidList = _this.FnUnitUtils.getTable(_this.options.fnUnit, _this.options.panelType);
            for (var index in tidList) {
                var label = model.getFnUnitByOutTable(tidList[index]).display.label;
                var indexedLabel = (tidList.length == 1 || _this.display.panelType !== 'out') ? label : label + '-' + (Number(index) + 1);
                tableObjList.push({
                    value: tidList[index],
                    label: indexedLabel
                });
            }

            var rgExp = /[~!@\#$%^&*\()\[\]\{\}=+'";:?`|\\/]/gi;
            var fileName = (_this.options.fnUnit.display.label.replace(/\s/g, '_') + '_' + _this.display.panelType + '.csv').replace(rgExp, "");

            var downloaderOptions = {
                userId: userId,
                mid: mid,
                tableObjList: tableObjList,
                fileName: fileName
            };

            if (_this.dataWorksheet) {
                new Brightics.VA.Core.Wizards.DataDownloadWizard(_this.$mainControl, {
                    mode: 'open',
                    height: 400,
                    close: function () {

                    },
                    downloader: downloader,
                    downloaderOptions: downloaderOptions,
                    previewData: _this.dataWorksheet.dataSet
                });
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('No data to download.');
            }
        });
    };

    DataPanel.prototype.refreshHeaderToolbar = function () {
        this.$header.find('.brtc-va-editors-sheet-panels-datapanel-toolbar').remove();
        this.createTopAreaHeaderToolbar();
        this.createTopAreaHeaderContext(this.$contextMenuOpen);
    };


    DataPanel.prototype._setOutTableInfo = function () {
        if (this.display.panelType !== PANEL_TYPE_OUT) return;

        if (this.FnUnitUtils.getOutTable(this.options.fnUnit) && this.FnUnitUtils.getOutTable(this.options.fnUnit).length > 1) {
            var $title = this.$header.find('.brtc-va-editors-sheet-panels-basepanel-header-title');
            var title = this.options.title + ' (' + this.FnUnitUtils.getOutTable(this.options.fnUnit).length + ' Outputs)';
            $title.text(title);
            $title.attr('title', title);
        }
    };

    Brightics.VA.Core.Editors.Sheet.Panels.DataPanel = DataPanel;

    function DataSchema($parent) {
        this.$parent = $parent;

        this.createLayout();
    }

    DataSchema.prototype.createLayout = function () {
        this.$mainControl = $('<div class="brtc-va-editors-sheet-panels-datapanel-schema"></div>');

        this.$column = $('' +
            '<div class="brtc-va-editors-sheet-panels-datapanel-schema-column">' +
                '<div type="text">Column(s) :</div>' +
                '<div type="count"></div>' +
            '</div>');
        this.$row = $('' +
            '<div class="brtc-va-editors-sheet-panels-datapanel-schema-row">' +
                '<div type="text">Row(s) :</div>' +
                '<div type="count"></div>' +
            '</div>');

        this.$parent.append(this.$mainControl);
        this.$mainControl.append(this.$column).append(this.$row);
    };

    DataSchema.prototype.update = function (schema) {
        var columnCount = (schema.columns)? schema.columns.length : 0;
        var rowCount = Brightics.VA.Core.Utils.CommonUtils.numberToStringWithComma(schema.totalCount);
        this.$column.find('[type=count]').text(columnCount);
        this.$row.find('[type=count]').text(rowCount);
    };

    DataSchema.prototype.destroy = function () {
        this.$mainControl.remove();
    };

    DataSchema.prototype.hide = function () {
        this.$mainControl.hide();
    };

    DataSchema.prototype.show = function () {
        this.$mainControl.show();
    };

    Brightics.VA.Core.Editors.Sheet.Panels.DataSchema = DataSchema;

}).call(this);

/**
 * Created by jhoon80.park on 2016-01-29.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var BasePanel = Brightics.VA.Core.Editors.Sheet.Panels.BasePanel;

    NewFnUnitPanel.prototype = Object.create(BasePanel.prototype);

    function NewFnUnitPanel(parentId, options) {
        BasePanel.call(this, parentId, options);
    }

    NewFnUnitPanel.prototype.createBottomArea = function () {
    };

    NewFnUnitPanel.prototype.createTopAreaControls = function ($parent) {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createTopAreaControls.call(this, $parent);

        var $header = this.$mainControl.find('.brtc-va-editors-sheet-panels-basepanel-header');
        $header.addClass('brtc-va-editors-sheet-panels-newfnunitpanel-header');
    };

    NewFnUnitPanel.prototype.createContentsArea = function ($parent) {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createContentsArea.call(this, $parent);

        var $contents = this.$mainControl.find('.brtc-va-editors-sheet-panels-basepanel-contents-area');
        $contents.append('' +
            '<div>' +
            '   <i class="fa fa-plus-circle fa-4x"></i>' +
            '</div>');
        $contents.addClass('brtc-va-editors-sheet-panels-newfnunitpanel-contents');
    };


    Brightics.VA.Core.Editors.Sheet.Panels.NewFnUnitPanel = NewFnUnitPanel;

}).call(this);
/**
 * Created by jhoon80.park on 2016-01-27.
 */

/* global IN_DATA, OUT_DATA, TARGET_FID, crel */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var CHANGE_IN_TABLE_PARAM_KEYS = ['df-names'];

    function PropertiesPanel(parentId, options) {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.call(this, parentId, options);
    }

    PropertiesPanel.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype);
    PropertiesPanel.prototype.constructor = PropertiesPanel;

    PropertiesPanel.prototype.createContentsAreaControls = function ($parent) {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createContentsAreaControls.call(this, $parent);

        this.FnUnitInputs = brtc_require('FnUnitInputs');

        this.createInputsControl();
    };

    PropertiesPanel.prototype.registerScrollEventListener = function (type, callback) {
        if (!this.scrollEventTypeList) this.scrollEventTypeList = [];
        if (this.scrollEventTypeList.indexOf(type) === -1) this.scrollEventTypeList.push(type);

        this.$contentsArea.on(type, callback);
    };

    PropertiesPanel.prototype.destroyScrollEventListener = function () {
        for (var type in this.scrollEventTypeList) {
            this.$contentsArea.off(type);
        }
    };

    PropertiesPanel.prototype.registerProblemListener = function () {
        var _this = this;
        this.problemsListener = function (event, mid, problems) {
            if (_this.options.fnUnit && _this.getModel() && mid === _this.getModel().mid) {
                _this.problems = [];
                for (var i in problems) {
                    if (problems[i] && problems[i].fid === _this.options.fnUnit.fid) {
                        _this.problems.push(problems[i]);
                    }
                }
                _this.handleProblem();
            }
        };
        Studio.getInstance().addProblemListener(this.problemsListener);
    };

    PropertiesPanel.prototype.registerCommandListener = function () {
        if (this.isBlockCommandListener()) return;

        var _this = this;
        this.commandListener = function (command) {
            if (_this.options.isRendered) {
                _this.options.isRendered = false;
                _this.handleCommand(command);
                _this.options.isRendered = true;
            } else {
                _this.handleCommand(command);
            }
        };
        this.options.modelEditor.addCommandListener(this.commandListener);
    };

    PropertiesPanel.prototype.handleCommand = function (command) {
        if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand) this.handleSetFnUnitParameterValueCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand) this.handleSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetUDFFnUnitParameterValueCommand) this.handleSetUDFFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReplaceFnUnitParamCommand) this.handleSetFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand) this.handleRenameFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand) this.handleConnectFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand) this.handleConnectFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand) this.handleConnectFnUnitCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.BindVariableCommand) this.handleGlobalVariableCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand) this.handleGlobalVariableCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand) this.handleChangeIntableCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand) this.handleChangeInputsCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand) this.handleChangeOutTableCommand(command);
        // else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutputsCommand) this.handleChangeOutputsCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AddOperationCommand) this.handleOperationCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand) this.handleOperationCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand) this.handleOperationCommand(command);
        else if (command instanceof Brightics.VA.Core.CompoundCommand) this.handleCompoundCommand(command);
    };

    PropertiesPanel.prototype.handleGlobalVariableCommand = function (command) {
        if (command.options.subFnUnitIndex > -1) {
            if (command.options.fid == this.options.fnUnit.param.functions[command.options.subFnUnitIndex].fid) {
                this.refreshGlobalVariableControl(command.options.paramKey, command.options.subFnUnitIndex);
            }
        } else if (command.options.fid == this.options.fnUnit.fid) {
            this.refreshGlobalVariableControl(command.options.paramKey, command.options.subFnUnitIndex);
        }
    };

    PropertiesPanel.prototype.handleCompoundCommand = function (command) {
        var i;
        if (command.event.type == 'REDO' || command.event.type == 'EXECUTE') {
            for (i in command.commandList) {
                this.handleCommand(command.commandList[i]);
            }
        } else if (command.event.type == 'UNDO') {
            for (i = command.commandList.length - 1; i > -1; i--) {
                this.handleCommand(command.commandList[i]);
            }
        }
    };

    PropertiesPanel.prototype.handleSetFnUnitCommand = function (command) {
        if (this.options.fnUnit.fid == command.options.fnUnit.fid && (command.event.type === 'UNDO' || command.event.type === 'REDO')) {
            this.renderPersistButton();
            this.renderValues(command);
        } else if (command.event.source !== this) {
            if (command.event.source instanceof Brightics.VA.Core.Editors.Sheet.Controls.DataSelector) {
                var inData = this.FnUnitUtils.getInData(command.options.fnUnit);
                // this.retrieveTableInfo(command.options.fnUnit[IN_DATA]);
                this.retrieveTableInfo(inData);
            } else {
                this.renderPersistButton();
                this.renderValues(command);
                this.fillControlValues();
            }
        }
    };

    PropertiesPanel.prototype.handleChangeOutputsCommand = function (command) {
        if (this.options.fnUnit.fid == command.options.fnUnit.fid && (command.event.type === 'UNDO' || command.event.type === 'REDO')) {
        } else if (command.event.source !== this) {
            if (command.event.source instanceof Brightics.VA.Core.Editors.Sheet.Controls.DataSelector) {
                var outTable = this.FnUnitUtils.getOutTable(command.options.fnUnit);
                if (outTable.length > 0)
                    this.retrieveTableInfo(outTable);
            }
        }
    };

    PropertiesPanel.prototype.handleChangeOutTableCommand = function (command) {
        if (this.options.fnUnit.fid == command.options.fnUnit.fid && (command.event.type === 'UNDO' || command.event.type === 'REDO')) {
        } else if (command.event.source !== this) {
            if (command.event.source instanceof Brightics.VA.Core.Editors.Sheet.Controls.DataSelector) {
                this.retrieveTableInfo(command.options.fnUnit[OUT_DATA]);
            }
        }
    };

    PropertiesPanel.prototype.handleSetFnUnitParameterValueCommand = function (command) {
        if (this.options.fnUnit.fid == command.options.fnUnit.fid && (command.event.type === 'UNDO' || command.event.type === 'REDO')) {
            this.renderValues(command);
        } else if (command.event.source !== this) {
            this.renderValues(command);
        }
    };

    PropertiesPanel.prototype.handleOperationCommand = function (command) {
        if (command.options.fnUnit &&
            this.options.fnUnit.fid === command.options.fnUnit.fid &&
            (command.event.type === 'UNDO' || command.event.type === 'REDO')) {
            this.renderOperationValues(command);
        } else if (command.event.source !== this) {
            this.renderOperationValues(command);
        }
    };

    PropertiesPanel.prototype.renderOperationValues = function (command) {
        console.error('check here');
    };

    PropertiesPanel.prototype.handleRenameFnUnitCommand = function (command) {
        if (this.options.fnUnit.fid == command.options.fid) {
            var $headerTitle = this.$mainControl.find('.brtc-va-editors-sheet-panels-basepanel-header-title');
            $headerTitle.text(this.options.fnUnit.display.label);

            var tooltip = this.options.fnUnit.display.label;
            var clazz = this.getModel().type;
            var funcDef = Brightics.VA.Core.Interface.Functions[clazz][this.options.fnUnit.func];
            if (funcDef) {
                tooltip = this.options.fnUnit.display.label + ' (' + funcDef.defaultFnUnit.display.label + ')';
            }
            $headerTitle.attr('title', tooltip);
        }
    };

    PropertiesPanel.prototype.handleConnectFnUnitCommand = function (command) {
        if (this.options.fnUnit.fid === command.options[TARGET_FID]) {
            var inTable = this.FnUnitUtils.getInTable(this.options.fnUnit);
            this.retrieveTableInfo(inTable);

            this.handleChangeInputsCommand();
        }
    };


    PropertiesPanel.prototype.handleChangeIntableCommand = function () {
        var inTable = this.FnUnitUtils.getInTable(this.options.fnUnit);
        this.retrieveTableInfo(inTable);

        if (this.inputsList) {
            var widgetOptions = {
                fnUnit: this.options.fnUnit,
                disable: true,
            };

            this.createInputsList(this.$inputsControl, widgetOptions);
        }
    };

    PropertiesPanel.prototype.handleChangeInputsCommand = function () {
        var inTable = this.FnUnitUtils.getInTable(this.options.fnUnit);
        this.retrieveTableInfo(inTable);

        if (this.inputsList) {
            var widgetOptions = {
                fnUnit: this.options.fnUnit,
                disable: true,
            };

            this.createInputsList(this.$inputsControl, widgetOptions);
        }
    };

    PropertiesPanel.prototype.setContentsEditable = function (block) {
        if (!block) {
            this.options.isRendered = false;
        } else {
            this.options.isRendered = false;
            this.fillControlValues();
            this.renderValues();
            this.options.isRendered = true;
            if (this.options.fnUnit.hasOwnProperty('parent')) {
                Studio.getInstance().doValidate(this.getModel());
            }
            this.updateScroll();
        }
    };

    PropertiesPanel.prototype.getProblems = function () {
        this.problems = this.getModel().getProblemsByFid(this.options.fnUnit.fid);
    };

    PropertiesPanel.prototype.fillControlValues = function () {

    };

    PropertiesPanel.prototype.destroy = function () {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.destroy.call(this);
        this.options.modelEditor.removeCommandListener(this.commandListener);
        Studio.getInstance().removeProblemListener(this.problemsListener);

        this.destroyGrid();
        this.destroyColumnSelector();
        this.destroyComboBox();
        this.destroyDropDownList();
        this.destroyScrollEventListener();
        if (this.$ctxMenu) {
            this.$ctxMenu.jqxMenu('destroy');
        }
    };

    PropertiesPanel.prototype.destroyGrid = function () {
        var $grid = this.$contentsArea.find('.jqx-grid');
        if ($grid.length > 0) {
            $grid.each(function (index) {
                $(this).jqxGrid('destroy');
            });
        }
    };

    PropertiesPanel.prototype.destroyColumnSelector = function (command) {
        var $columnSelector = $('.brtc-va-editors-sheet-controls-columnselector-editarea');
        if ($columnSelector.length > 0) {
            $columnSelector.dialog('close');
            $columnSelector.dialog('destroy');
        }
    };

    PropertiesPanel.prototype.destroyDropDownList = function () {
        var $dropDownList = this.$contentsArea.find('.brtc-va-editors-sheet-controls-wrapper').children('.jqx-dropdownlist-state-normal');
        if ($dropDownList.length > 0) {
            $dropDownList.each(function (index) {
                $(this).jqxDropDownList('destroy');
            });
        }
    };

    PropertiesPanel.prototype.destroyComboBox = function () {
        var $dropDownList = this.$contentsArea.find('.brtc-va-editors-sheet-controls-wrapper').children('.jqx-combobox');
        if ($dropDownList.length > 0) {
            $dropDownList.each(function (index) {
                $(this).jqxComboBox('destroy');
            });
        }
    };

    PropertiesPanel.prototype.renderValues = function (command) {
        var _this = this;
        if (command && command.options.renderParams) {
            for (var i in command.options.renderParams) {
                this.render[command.options.renderParams[i]].bind(_this)();
            }
        } else {
            for (var j in command ? command.options.ref.param : this.render) {
                if (this.render[j]) this.render[j].bind(_this)();
                else if (typeof this.render[j] === 'undefined') delete this.render[j]
            }
        }

        this.updateScroll();
    };

    PropertiesPanel.prototype.renderCommonValidation = function () {
        for (var i in this.problems) {
            var param = this.problems[i].param;
            if (!param) {
                this.$contentsArea.prepend($('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">' +
                    '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' +
                    '   <div class="brtc-va-editors-sheet-panels-validation-tooltip">' + this.problems[i].message + '</div>' +
                    '</div>'));
            }
        }
    };

    PropertiesPanel.prototype.renderValidation = function () {
    };

    PropertiesPanel.prototype.removeValidation = function () {
        this.$mainControl.find('.brtc-va-editors-sheet-panels-validation-tooltip-wrapper').remove();
        this.$mainControl.find('.brtc-va-editors-sheet-controls-propertycontrol-label').removeClass('brtc-va-editors-sheet-controls-propertycontrol-label-error');
        this.$mainControl.find('.brtc-va-editors-sheet-controls-property-in-table-control-label').removeClass('brtc-va-editors-sheet-controls-property-in-table-control-label-error');
        this.$mainControl.find('.brtc-va-editor-sheet-panels-validation-error').removeClass('brtc-va-editor-sheet-panels-validation-error');
        this.$mainControl.find('.brtc-va-editors-sheet-panels-validation-tooltip-wrapper').remove();
    };

    PropertiesPanel.prototype.renderPropertyControlHeader = function ($widget, problem) {
        // var $header = $widget.closest('.brtc-va-editors-sheet-controls-propertycontrol').find('.brtc-va-editors-sheet-controls-propertycontrol-label');
        //
        // if (problem.level === 'error') {
        //    $header.addClass('brtc-va-editors-sheet-controls-propertycontrol-label-error');
        // }
    };

    PropertiesPanel.prototype.showValidation = function ($widget, problem) {
        this.renderPropertyControlHeader($widget);
        this.createValidationContent($widget, problem);
    };

    PropertiesPanel.prototype.createValidationContent = function ($el, problemData, clearBoth) {
        var $parent = $el.hasClass('brtc-va-editors-sheet-controls-wrapper') ? $el : $el.parent('.brtc-va-editors-sheet-controls-wrapper');
        $parent = ($parent.length) ? ($parent) : ($el);
        var $problemContent = $('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">' +
            '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' +
            '   <div class="brtc-va-editors-sheet-panels-validation-tooltip">' + problemData.message + '</div>' +
            '</div>');
        $parent.append($problemContent);
        $parent.addClass('brtc-va-editor-sheet-panels-validation-error');
        if (clearBoth) $problemContent.css('clear', 'both');
        $problemContent.show();
    };

    PropertiesPanel.prototype.handleProblem = function () {
        var _this = this;
        try {
            if (_this.getModel()) {
                if (_this.options.isRendered) {
                    this.removeValidation();
                    this.renderCommonValidation();
                    this.renderValidation();
                    this.updateScroll();
                }
            }
        } catch (e) {

        }
    };

    PropertiesPanel.prototype.bindValidationTooltip = function ($widget, tooltip) {
        // do nothing
    };

    PropertiesPanel.prototype.getRequestData = function (tables) {
        this.dataMap = {};
        var dataMap = {}, _this = this, tableIndex = 0;

        $.each(tables, function (index, table) {
            _this.options.dataProxy.requestSchema(table, function (data) {
                dataMap[table] = data;
                tableIndex++;
                if (tableIndex === tables.length) {
                    _this.dataMap = dataMap;
                    _this.setContentsEditable(true);
                }
            }, function (data) {
                dataMap[table] = data;
                tableIndex++;
                if (tableIndex === tables.length) {
                    _this.dataMap = dataMap;
                    _this.setContentsEditable(true);
                }
            });
        });
    };

    PropertiesPanel.prototype.retrieveTableInfo = function (tables) {
        var _this = this;

        if (tables && tables.length > 0) {
            this.getRequestData(tables);
        } else {
            _this.setContentsEditable(true);
        }
    };

    PropertiesPanel.prototype.createTopAreaControls = function ($parent) {
        var _this = this;
        var clazz = this.options.fnUnit.parent().type;
        var $header = Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createTopAreaControls.call(this, $parent);
        $header.addClass('brtc-va-editors-sheet-panels-propertiespanel-header');

        var category = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, this.options.fnUnit.func).category;
        $header.addClass('brtc-va-fnunit-category-' + category);

        var context = this.options.fnUnit.context || ((category === 'control' || category === 'process') ? category : 'scala');
        $header.attr('context', context);

        var $headerTitle = $header.find('.brtc-va-editors-sheet-panels-basepanel-header-title');
        var funcDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, this.options.fnUnit.func);
        var tooltip = funcDef ? this.options.fnUnit.display.label + ' (' + funcDef.defaultFnUnit.display.label + ')' : this.options.fnUnit.display.label;
        $headerTitle.attr('title', tooltip);

        var $itemWrapper = $(crel('div', {
            class: 'brtc-style-display-flex brtc-style-float-right'
        }));

        $header.append($itemWrapper);

        $itemWrapper.append('<div class="brtc-va-editors-sheet-panels-propertiespanel-header-help" title="Help"></div>');
        $itemWrapper.append('<div class="brtc-va-editors-sheet-panels-propertiespanel-header-more-menu"></div>');
        $itemWrapper.append('<div class="brtc-va-editors-sheet-panels-propertiespanel-header-help-popover"></div>');

        if (clazz === 'data') {
            $itemWrapper.append($(crel('div', {
                class: 'brtc-va-editors-sheet-panels-propertiespanel-header-close-panel',
                title: 'Close'
            })));
        }

        this.createPersistButton();
        this.createPropertiesContextMenu();
        this.createHelpPopover();

        $header.find('.brtc-va-editors-sheet-panels-propertiespanel-header-more-menu').on('click', function (event) {
            var scrollTop = $(window).scrollTop();
            var scrollLeft = $(window).scrollLeft();
            var left = parseInt(event.clientX) + scrollLeft;

            var diffPosition = $(window).width() - event.clientX;
            if (diffPosition < 100) {
                left = left - 130;
            }
            var top = parseInt(event.clientY) + scrollTop;
            top += 5;

            _this.$ctxMenu.jqxMenu('open', left, top);
            $(window).on('resize', _this.ctxMenuCloseHandler);
        });

        $header.find('.brtc-va-editors-sheet-panels-propertiespanel-header-close-panel').on('click', function (evt) {
            _this.getEditor().resetSheetEditorPage();
        });

        return $header;
    };

    PropertiesPanel.prototype.createPersistButton = function () {
        var _this = this;
        this.$mainControl.find('.brtc-va-editors-sheet-panels-propertiespanel-header > .brtc-va-editors-sheet-panels-basepanel-header-title').attr('persist-mode', 'auto');
        var $persistButton = this.$mainControl.find('.brtc-va-editors-sheet-panels-propertiespanel-header [item-type=persist]');
        $persistButton.click(function () {
            var modes = ['auto', 'true', 'false'];
            var idx = modes.indexOf($(this).attr('persist-mode'));
            idx = (idx + 1) % modes.length;
            $(this).attr('persist-mode', modes[idx]);
            var properties = {
                'persist-mode': modes[idx]
            };
            var command = _this.createSetFnUnitCommand(properties);
            _this.executeCommand(command);
        });
        this.renderPersistButton();
    };

    PropertiesPanel.prototype.renderPersistButton = function () {
        var _this = this;

        var $persistButton = this.$mainControl.find('.brtc-va-editors-sheet-panels-propertiespanel-header > .brtc-va-editors-sheet-panels-basepanel-header-title').before();

        if (this.options.fnUnit['persist-mode']) {
            $(this).attr('persist-mode', this.options.fnUnit['persist-mode']);
        } else {
            $(this).attr('persist-mode', 'auto');
        }
    };

    PropertiesPanel.prototype.createHelpPopover = function () {
        var _this = this;
        this.$mainControl.find('.brtc-va-editors-sheet-panels-propertiespanel-header-help').click(function () {
            var operation = _this.getPrimaryOperation();
            if (_this.getFunctionDef().defaultFnUnit.name === 'UDF') operation = 'udf_' + _this.getFunctionDef().defaultFnUnit.func;
            var context = _this.getFunctionDef().defaultFnUnit.context || 'scala';
            if (_this.getFunctionDef().category === 'control') {
                context = 'common';
            }
            Brightics.VA.Core.Utils.ModelUtils.openFunctionReferencePopup('data', operation, context);
        });
    };

    PropertiesPanel.prototype.createPropertiesContextMenu = function () {
        var _this = this;
        var $header = this.$mainControl.find('.brtc-va-editors-sheet-panels-propertiespanel-header');
        var $ctxMenu = $('' +
            '<div class="brtc-va-editors-sheet-panels-propertiespanel-header-ctxmenu">' +
            '   <ul>' +
            '       <li action="rename">Edit</li>' +
            '       <li action="select_function">Select Function</li>' +
            '   </ul>' +
            '</div>');
        $header.append($ctxMenu);

        this.$ctxMenu = $ctxMenu.jqxMenu({
            theme: Brightics.VA.Env.Theme,
            width: '120px',
            height: '120px',
            autoOpenPopup: false,
            mode: 'popup',
            animationHideDuration: 0,
            animationShowDuration: 0
        });

        this.$ctxMenu.on('itemclick', function (event) {
            var $el = $(event.args);
            if ($el.attr('action') == 'rename') {
                var dialogOptions = {
                    title: 'Edit Function',
                    label: _this.options.fnUnit.display.label,
                    description: _this.options.fnUnit.display.description || '',
                    close: function (dialogResult) {
                        if (dialogResult.OK) {
                            _this.doEditFunction(_this.options.fnUnit.fid, dialogResult.label, dialogResult.description);
                        }
                    }
                };
                new Brightics.VA.Core.Dialogs.EditResourceDialog($(document.body), dialogOptions);
            } else if ($el.attr('action') == 'select_function') {
                var fnUnit = _this.getFnUnit();
                var editorInput = fnUnit.parent();
                var preFnUnit = editorInput.getPrevious(fnUnit.fid);
                new Brightics.VA.Core.Dialogs.SwitchFnUnitDialog($(event.target), {
                    modelType: _this.getModel().type,
                    position: 'center',
                    preFnUnit: editorInput.getFnUnitById(preFnUnit[0]),
                    close: function (dialogResult) {
                        if (dialogResult.OK) {
                            var currUnit = editorInput.getFnUnitById(fnUnit.fid);
                            if (currUnit.func !== dialogResult.func) {
                                var replaceUnit = editorInput.newFnUnit(dialogResult.func);
                                replaceUnit.display.diagram.position = $.extend({}, currUnit.display.diagram.position);

                                var command = new Brightics.VA.Core.Editors.Diagram.Commands.SwitchFnUnitCommand($(event.target), {
                                    modelType: _this.getModel().type,
                                    fid: currUnit.fid,
                                    fnUnit: replaceUnit,
                                    prvFnUnit: currUnit
                                });
                                command.event.source = $(event.target);

                                var editor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
                                editor.getCommandManager().execute(command);
                            }
                        }
                    }
                });
            }
        });


        this.ctxMenuCloseHandler = function () {
            _this.$ctxMenu.jqxMenu('close');
        };

        this.$ctxMenu.on('closed', function () {
            $(window).off('resize', _this.ctxMenuCloseHandler);
        });
    };

    PropertiesPanel.prototype.doEditFunction = function (fid, label, description) {
        var command = new Brightics.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this, {
            fid: fid,
            name: label,
            description: description
        });
        this.executeCommand(command);
    };


    PropertiesPanel.prototype.createExample = function ($parent, example) {
        var $example = $('<div class="brtc-va-popover-help-func-example"></div>');
        $parent.append($example);
        var $exampleTitle = $('<div class="brtc-va-popover-help-func-example-title"></div>');
        $exampleTitle.text(example.title);

        $example.append($ex);
        for (var key in example.params) {
            var $param = $('<div class="brtc-va-popover-help-func-example-param"></div>');
            var $key = $('<span></span>');
            $key.text(key);
            var $paramSpan = $('<span></span>');
            $paramSpan.text(example.params[key]);
            $param.append($key);
            $param.append($paramSpan);
            $example.append($param);
        }

        var i;
        for (i in example.input) {
            $example.append('<div class="brtc-va-popover-help-func-example-param"><span>Input</span></div>');
            this.createExampleTable($example, example.input[i]);
        }

        for (i in example.output) {
            $example.append('<div class="brtc-va-popover-help-func-example-param"><span>Output</span></div>');
            this.createExampleTable($example, example.output[i]);
        }
    };

    PropertiesPanel.prototype.createExampleTable = function ($parent, options) {
        var $table = $('<table class="brtc-va-popover-help-func-example-table"></table>');
        $parent.append($table);

        var $columns = $('<tr></tr>');
        $table.append($columns);
        for (var i in options.columns) {
            var $columnVal = $('<td></td>');
            $columnVal.text(options.columns[i].name);
            $columns.append($columnVal);
        }

        var $row;
        for (var r in options.data) {
            $row = $('<tr></tr>');
            $table.append($row);
            for (var c in options.data[r]) {
                var $rowVal = $('<td></td>');
                $rowVal.text(options.data[r][c]);
                $row.append($rowVal);
            }
        }
    };

    PropertiesPanel.prototype.hasInModel = function () {
        var funcDef = this.getFunctionDef();
        if (funcDef.viewer && funcDef.viewer.in) {
            var inTypes = funcDef.viewer.in;
            if (inTypes.indexOf('model') >= 0) {
                return true;
            }
        }

        return false;
    };

    PropertiesPanel.prototype.createInputsControl = function (disable) {
        var _this = this;

        if (!this.FnUnitUtils.inputChangable(this.options.fnUnit)) return;
        if (!this.FnUnitUtils.hasInput(this.options.fnUnit)) return;

        this.$inputsControl = $('<div class="brtc-va-editors-sheet-controls-property-inputs-control-columnlist"/>');

        this.addPropertyInTableControl('Inputs', function ($parent) {
            $parent.append(_this.$inputsControl);
            _this.wrapControl(_this.$inputsControl);

            var widgetOptions = {
                fnUnit: _this.options.fnUnit,
                disable: disable,
            };

            _this.createInputsList(_this.$inputsControl, widgetOptions);
        }, {mandatory: true});
    };

    PropertiesPanel.prototype.getFunctionDef = function () {
        var clazz = this.getModel().type;
        return Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, this.options.fnUnit.func);
    };

    PropertiesPanel.prototype.getPrimaryOperation = function () {
        var clazz = this.getModel().type;
        return Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, this.options.fnUnit.func).defaultFnUnit.name;
    };

    PropertiesPanel.prototype.createContentsArea = function () {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createContentsArea.call(this);
        this.$contentsArea.addClass('brtc-va-editors-sheet-panels-propertiespanel-contents-area');
    };

    PropertiesPanel.prototype.createBottomAreaControls = function ($parent) {
        this.$callFunctionButton = $('' +
            '<button type="button" class="brtc-va-editors-sheet-panels-propertiespanel-button">' +
            'Run' +
            '</button>');
        $parent.append(this.$callFunctionButton);

        this.$callFunctionButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: '92px',
            height: '100%'
        });
        var _this = this;
        this.$callFunctionButton.click(function () {
            this.blur(); // focus out
            _this.callFunction();
        });
    };

    PropertiesPanel.prototype.callFunction = function () {
        var _this = this;
        var listener = {
            'success': function (res) {
                _this.$mainControl.trigger('callFunction', []);
            }
        };
        Studio.getJobExecutor().launchUnit(_this.options.fnUnit, {}, {}, listener);
    };

    PropertiesPanel.prototype.addPropertyControl = function (label, callback, option) {
        var _this = this,
            $propertyControl = $('' +
                '<div class="brtc-va-editors-sheet-controls-propertycontrol" label="' + label + '">' +
                '   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>' +
                '   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents">' +
                '</div>');

        if (option) {
            if (option.mandatory) {
                label = '<div>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(label) +
                    '   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div>' +
                    '</div>';
            }
            if (option.propertyControlParent) option.propertyControlParent.append($propertyControl);
            else this.$contentsArea.append($propertyControl);
        } else {
            this.$contentsArea.append($propertyControl);
        }

        $propertyControl.jqxExpander(
            {
                theme: Brightics.VA.Env.Theme,
                arrowPosition: 'left',
                initContent: function () {
                    if (typeof callback === 'function') {
                        callback.call(_this, $propertyControl.find('.brtc-va-editors-sheet-controls-propertycontrol-contents'), option);
                    }
                }
            });
        $propertyControl.jqxExpander('setHeaderContent', label);

        return $propertyControl;
    };

    PropertiesPanel.prototype.addPropertyInTableControl = function (label, callback, option) {
        var _this = this,
            $propertyControl = $('' +
                '<div class="brtc-va-editors-sheet-controls-property-in-table-control">' +
                '   <div class="brtc-va-editors-sheet-controls-property-in-table-control-label"></div>' +
                '   <div class="brtc-va-editors-sheet-controls-property-in-table-control-contents">' +
                '</div>');

        if (option) {
            if (option.mandatory) {
                label = '<div>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(label) +
                    '   <div class="brtc-va-editors-sheet-controls-property-in-table-control-mandatory">*</div>' +
                    '</div>';
            }
            if (option.propertyControlParent) option.propertyControlParent.append($propertyControl);
            else this.$contentsArea.append($propertyControl);
        } else {
            this.$contentsArea.append($propertyControl);
        }

        $propertyControl.jqxExpander(
            {
                theme: Brightics.VA.Env.Theme,
                arrowPosition: 'left',
                initContent: function () {
                    if (typeof callback === 'function') {
                        callback.call(_this, $propertyControl.find('.brtc-va-editors-sheet-controls-property-in-table-control-contents'), option);
                    }
                }
            });
        $propertyControl.jqxExpander('setHeaderContent', label);

        return $propertyControl;
    };

    PropertiesPanel.prototype.addGlobalVariableControl = function ($control, cssOption, paramKey, paramLabel, options) {
        var _this = this,
            $variable = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-variable"></div>');
        $variable.css(cssOption);
        if (options && options.type) {
            $variable.attr('type', options.type);
        }
        $variable.click(function (event) {
            var $expanderHeader = $(this).closest('.brtc-va-editors-sheet-controls-propertycontrol-label');
            if ($expanderHeader) $expanderHeader.closest('.jqx-expander').jqxExpander('disable');

            var closeHandler = function (dialogResult) {
                if (dialogResult.OK) {
                    _this.executeCommand(dialogResult.command);
                    // _this.refreshGlobalVariableControl(paramKey);
                }
                if ($expanderHeader) $expanderHeader.closest('.jqx-expander').jqxExpander('enable');
            };

            var removeHandler = function (dialogResult) {
                _this.executeCommand(dialogResult.command);
                // _this.refreshGlobalVariableControl(paramKey);
            };

            new Brightics.VA.Core.Dialogs.SettingVariableDialog($(this), {
                close: closeHandler,
                remove: removeHandler,
                fnUnit: _this.options.fnUnit,
                param: {
                    key: paramKey,
                    label: paramLabel,
                    type: options && options.type ? options.type : 'string',
                    index: _this.globalVariableFnUnitIndex[paramKey]
                }
            });
        });
        $control.append($variable);

        this.globalVariableControls = this.globalVariableControls || {};
        this.globalVariableFnUnitIndex = this.globalVariableFnUnitIndex || {};
        this.globalVariableControls[paramKey] = $variable;
        this.globalVariableFnUnitIndex[paramKey] = options && options.index > -1 ? options.index : -1;

        this.refreshGlobalVariableControl(paramKey, options && options.index > -1 ? options.index : -1);
    };

    PropertiesPanel.prototype.refreshGlobalVariableControl = function (paramKey, index) {
        var analyticModel = this.options.modelEditor.getModel();
        var variable = analyticModel.getVariable(this.options.fnUnit.fid, paramKey);
        if (index > -1) variable = analyticModel.getVariable(this.options.fnUnit.param.functions[index].fid, paramKey);
        if (variable) this.globalVariableControls[paramKey].addClass('set');
        else this.globalVariableControls[paramKey].removeClass('set');
    };

    PropertiesPanel.prototype.executeCommand = function (command) {
        var modelEditorRef = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);
        // if (modelEditorRef && this.options.isRendered) {
        //     modelEditorRef.getCommandManager().execute(command);
        // }

        var tmpList = ['kmeans2', 'kmeans2model', 'kmeansmodelpy', 'testftn1', 'testftn2', 'testftn3'];
        if (tmpList.indexOf(this.options.fnUnit.func) > -1) {
            modelEditorRef.getCommandManager().execute(command);
        } else {
            if (modelEditorRef && this.options.isRendered) {
                modelEditorRef.getCommandManager().execute(command);
            }
        }
    };

    PropertiesPanel.prototype.createCommandOptions = function () {
        return {};
    };

    PropertiesPanel.prototype.createSetFnUnitCommand = function (properties) {
        var commandOption = {
            fnUnit: this.options.fnUnit,
            ref: {}
        };

        for (var key in properties) {
            commandOption.ref[key] = properties[key];
        }

        return new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand(this, commandOption);
    };

    PropertiesPanel.prototype.createSetParameterValueCommand = function (paramName, paramValue,
                                                                         force = true) {
        if (!force && this.getParam(paramName) === paramValue) return null;
        var commandOption = {
            fnUnit: this.options.fnUnit,
            ref: {param: {}}
        };

        if (paramValue !== 0 && !paramValue && typeof paramValue !== 'boolean') paramValue = '';
        commandOption.ref.param[paramName] = paramValue;

        return new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this, commandOption);
    };


    PropertiesPanel.prototype.getColumnsOfInTable = function (index, columnTypes) {
        var columns = [];
        if (this.dataMap && this.FnUnitUtils.getInTable(this.options.fnUnit)[index] && this.FnUnitUtils.getInTable(this.options.fnUnit)[index]) {
            columns = this.dataMap[this.FnUnitUtils.getInTable(this.options.fnUnit)[index]].columns;
        }
        if (columnTypes && columnTypes.length > 0) {
            columns = $.grep(columns, function (el) {
                return columnTypes.indexOf(el.type) > -1 || columnTypes.indexOf(el.internalType) > -1;
            });
        }
        return columns;
    };

    PropertiesPanel.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');
        $control.wrap($wrapper);
    };

    PropertiesPanel.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    PropertiesPanel.prototype.addCssToWrapper = function ($control, cssOptions) {
        if (cssOptions) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.css(cssOptions);
        }
    };

    PropertiesPanel.prototype.createComboBox = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '25px',
            closeDelay: 0,
            openDelay: 0
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxComboBox(options);

        var preValue = $control.val();
        $control.find('input').focus(function () {
            preValue = $control.val();
        });
        $('svg').on('mousedown', function () {
            var value = $control.val();
            if (value !== preValue && $control.find('input').is(':focus')) {
                $control.trigger('change');
            }
        });

        this.registerScrollEventListener('ps-scroll-y', function () {
            $control.jqxComboBox('close');
        });
    };

    PropertiesPanel.prototype.createInput = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);

        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }

        if (!$control.attr('type')) $control.attr('type', 'text');
        if (!$control.attr('maxlength')) $control.attr('maxlength', '100');

        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            placeHolder: 'Enter value'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxInput(options);
        var preValue = $control.val();
        $control.focus(function () {
            preValue = $control.val();
        });
        $('svg').on('mousedown', function () {
            var value = $control.val();
            if (value !== preValue && $control.is(':focus')) {
                $control.trigger('change');
            }
        });

        var _this = this;
        $control.on('keydown', function (event) {
            clearTimeout(_this.keydownTimeout);
            _this.keydownTimeout = setTimeout(function () {
                if ($control.is(':focus')) {
                    $control.blur();
                    $control.focus();
                }
            }, 1000);
        });

        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($control);
        return $control;
    };

    PropertiesPanel.prototype.createNumberInput = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);
        return new Brightics.VA.Core.Editors.Sheet.Controls.NumericInput($control, widgetOptions, className);
    };

    PropertiesPanel.prototype.createDropDownList = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            enableBrowserBoundsDetection: true,
            animationType: 'none',
            width: '100%',
            height: '25px',
            openDelay: 0
        };
        if (jqxOptions) {
            if (jqxOptions.source && jqxOptions.source.length > 7) {
                options.autoDropDownHeight = false;
                options.dropDownHeight = 120;
            } else {
                options.autoDropDownHeight = true;
            }
            $.extend(options, jqxOptions);
        }
        $control.jqxDropDownList(options);

        this.registerScrollEventListener('ps-scroll-y', function () {
            $control.jqxDropDownList('close');
        });

        return $control;
    };

    PropertiesPanel.prototype.createGrid = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            rowsheight: 25
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxGrid(options);
        return $control;
    };

    PropertiesPanel.prototype.createCheckBox = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = 'brtc-va-editors-sheet-controls-checkbox-default';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxCheckBox(options);

        return $control;
    };

    PropertiesPanel.prototype.createRadioButton = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = 'brtc-va-editors-sheet-controls-radiobutton-default';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions, {
                groupName: (jqxOptions.groupName || '') + this.panelId
            });
        }
        $control.jqxRadioButton(options);
        return $control;
    };

    PropertiesPanel.prototype.createButton = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxButton(options);
        return $control;
    };

    PropertiesPanel.prototype.createSwitchButton = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '23px'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxSwitchButton(options);
        return $control;
    };

    PropertiesPanel.prototype.createButtonGroup = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxButtonGroup(options);
        return $control;
    };

    PropertiesPanel.prototype.onInputsChange = function (inputs) {
        if (this.FnUnitUtils.hasMeta(this.options.fnUnit)) {
            if (!this.isInputsChanged(inputs)) return;

            var commandOption = {
                fnUnit: this.options.fnUnit,
                ref: {
                    inputs: inputs
                }
            };

            var compoundCommand = new Brightics.VA.Core.CompoundCommand(this);
            var changeInputsCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand(this, commandOption);
            compoundCommand.add(changeInputsCommand);
        } else {
            var tableList = [];

            for (var key in inputs) {
                if (!_.isEmpty(inputs[key])) tableList.push(inputs[key]);
            }

            if (_.isEqual(this.FnUnitUtils.getInTable(this.options.fnUnit), tableList)) return;

            var commandOption = {
                fnUnit: this.options.fnUnit,
                ref: tableList
            };

            var compoundCommand = new Brightics.VA.Core.CompoundCommand(this);
            var changeInTableCommand = new Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand(this, commandOption);
            compoundCommand.add(changeInTableCommand);
        }

        this.executeCommand(compoundCommand);
    };

    PropertiesPanel.prototype.onInputsError = function (message) {
        this.options.modelEditor.notification('error', message);
    };

    PropertiesPanel.prototype.createInputsList = function ($control, widgetOptions, className, additionalCss) {
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            appendTo: $control,
            fnUnit: this.options.fnUnit,
            emptyLabel: 'Empty',
            onClick: this.openInputSelector.bind(this),
            readOnly: true
        };

        if (widgetOptions) {
            $.extend(options, widgetOptions);
        }

        this.inputsList = this.FnUnitInputs.render(options);
    };

    PropertiesPanel.prototype.openInputSelector = function () {
        var _this = this;

        this.inputSelector = new Brightics.VA.Core.Editors.Sheet.Controls.InputSelector(this.$mainControl, {
            fnUnit: _this.options.fnUnit,
            onChange: _this.onInputsChange.bind(this),
            onClose: _this.onInputsChange.bind(this),
            onError: _this.onInputsError.bind(this)
        });
    };

    PropertiesPanel.prototype.isInputsChanged = function (inputs) {
        return !_.isEqual(this.FnUnitUtils.getInputs(this.options.fnUnit), inputs);
    };

    PropertiesPanel.prototype.addFnUnitCommandToCompoundCommand = function (compoundCommand, paramValue) {
        var isParamChanged = false;

        var commandOption = {
            fnUnit: this.options.fnUnit,
            ref: {
                param: {}
            }
        };

        var paramKeys = Object.keys(this.options.fnUnit.param);
        for (var i in paramKeys) {
            var key = paramKeys[i];
            if (CHANGE_IN_TABLE_PARAM_KEYS.indexOf(key) > -1) {
                isParamChanged = true;
                commandOption.ref.param[key] = paramValue;
            }
        }

        if (isParamChanged) {
            var setFnUnitCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand(this, commandOption);
            compoundCommand.add(setFnUnitCommand);
        }
    };

    PropertiesPanel.prototype.createColumnList = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            multiple: true,
            rowCount: 1,
            maxRowCount: 5,
            expand: false,
            sort: 'none',
            sortBy: 'name',
            showOpener: 'button',
            removable: true,
            defaultType: '-',
            changed: function (type, data) {

            },
            added: function () {

            },
            removed: function () {

            }
        };

        if (widgetOptions) {
            $.extend(options, widgetOptions);
        }

        return new Brightics.VA.Core.Editors.Sheet.Controls.ColumnList($control, options);
    };

    PropertiesPanel.prototype.createTableList = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        return new Brightics.VA.Core.Editors.Sheet.Controls.TableList($control, widgetOptions);
    };

    PropertiesPanel.prototype.createDateTimeInput = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '25px'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxDateTimeInput(options);
        return $control;
    };

    PropertiesPanel.prototype.createTextArea = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '60px'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxTextArea(options);
        return $control;
    };

    PropertiesPanel.prototype.createNumericInput = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        return new Brightics.VA.Core.Editors.Sheet.Controls.NumericInput($control, widgetOptions);
    };

    PropertiesPanel.prototype.createArrayInput = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        return new Brightics.VA.Core.Editors.Sheet.Controls.ArrayInput($control, widgetOptions);
    };

    PropertiesPanel.prototype.getPreviousFnUnit = function (fid) {
        var analyticModel = this.options.modelEditor.getModel();
        return analyticModel.getFnUnitById(fid);
    };

    PropertiesPanel.prototype.createResizableTextArea = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = 'brtc-va-editors-sheet-controls-resizable-textarea-default';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        $control.addClass(additionalClass);

        if (additionalCss) {
            $.extend(widgetOptions, additionalCss);
        }
        $control.css(widgetOptions);
    };

    PropertiesPanel.prototype.createTextAreaControl = function ($control, controlOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = 'brtc-va-editors-sheet-controls-textareacontrol';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        $control.addClass(additionalClass);
        if (additionalCss) $control.css(additionalCss);

        return new Brightics.VA.Core.Editors.Sheet.Controls.TextAreaControl($control, controlOptions);
    };

    PropertiesPanel.prototype.createItemList = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        // return new Brightics.VA.Core.Widget.Controls.ItemListControl($control, options);
        return new Brightics.VA.Core.Widget.Controls.ItemList($control, widgetOptions);
    };


    PropertiesPanel.prototype.createDateTimePickerControl = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = 'brtc-va-editors-sheet-controls-datetime-picker';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);
        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '23px',
            // selectionMode: 'range',
            formatString: 'yyyy/MM/dd HH:mm:ss',
            textAlign: 'center'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxDateTimeInput(options);
    };

    PropertiesPanel.prototype.createTildeControl = function ($control, additionalClass, additionalCss) {
        this.wrapControl($control);
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);
    };

    PropertiesPanel.prototype.handleSetUDFFnUnitCommand = function (command) {
        if (this.options.fnUnit.fid == command.options.fnUnit.fid && (command.event.type === 'UNDO' || command.event.type === 'REDO')) {
            this.renderUDFValues(command);
        } else if (command.event.source !== this) {
            if (command.event.source instanceof Brightics.VA.Core.Editors.Sheet.Controls.DataSelector) {
                this.retrieveTableInfo(command.options.fnUnit[IN_DATA]);
            } else {
                this.renderUDFValues(command);
                this.fillControlValues();
            }
        }
    };

    PropertiesPanel.prototype.createSetUDFParameterValueCommand = function (paramName, paramValue) {
        var commandOption = {
            fnUnit: this.options.fnUnit,
            ref: {
                param: {
                    'input-variables': $.extend(true, [], this.options.fnUnit.param['input-variables'])
                }
            }
        };
        for (var i in this.options.fnUnit.param['input-variables']) {
            if (this.options.fnUnit.param['input-variables'][i][0] === paramName) {
                commandOption.ref.param['input-variables'][i][2] = paramValue;
            }
        }
        return new Brightics.VA.Core.Editors.Diagram.Commands.SetUDFFnUnitParameterValueCommand(this, commandOption);
    };

    PropertiesPanel.prototype.renderUDFValues = function (command) {
        var _this = this;
        if (command && command.options.renderParams) {
            for (var i in command.options.renderParams) {
                this.render[command.options.renderParams[i]].bind(_this)();
            }
        } else {
            if (command) {
                for (var j in command.options.ref.param['input-variables']) {
                    this.render[command.options.ref.param['input-variables'][j][0]].bind(_this)();
                }
            } else {
                for (var j in this.render) {
                    this.render[j].bind(_this)();
                }
            }
        }
    };

    PropertiesPanel.prototype.isInputValueChanged = function (colName, data) {
        var fnUnitParam = this.options.fnUnit.param[colName],
            commandParam = data;

        // 함수 파라미터의 type이 array인 경우
        if (_.isArray(fnUnitParam) && _.isEmpty(fnUnitParam[0])){
            if (_.isEmpty(commandParam)) {
                return false;
            }
        }
        return _.isUndefined(fnUnitParam) || !_.isEqual(fnUnitParam, commandParam);
    };

    PropertiesPanel.prototype.createBarButton = function ($control, jqxOptions, className, additionalCss) {
        var defaultOption = {
            width: '100%',
            height: 25
        };

        if (jqxOptions) {
            $.extend(defaultOption, jqxOptions);
        }
        return this.createButton($control, defaultOption, className, additionalCss);
    };

    PropertiesPanel.prototype.getFnUnit = function () {
        return this.options.fnUnit;
    };

    PropertiesPanel.prototype.getModel = function () {
        return this.FnUnitUtils.getParent(this.getFnUnit());
    };

    PropertiesPanel.prototype.getEditor = function () {
        return this.options.modelEditor;
    };

    PropertiesPanel.prototype.configureOptions = function () {
    };

    PropertiesPanel.prototype.refresh = function () {
    };
    PropertiesPanel.prototype.getParam = function (key) {
        return key ? this.getFnUnit().param[key] : this.getFnUnit().param;
    };

    PropertiesPanel.prototype.hideInTableControl = function () {
        this.$mainControl.find('.brtc-va-editors-sheet-controls-property-in-table-control').hide();
    };

    PropertiesPanel.prototype.updateScroll = function () {
        this.$contentsArea.perfectScrollbar('update');
    };

    PropertiesPanel.prototype.createDropEvent = function ($item) {
    };

    PropertiesPanel.prototype.isBlockCommandListener = function () {
        return this.options.blockCommandListener? true : false;
    };

    PropertiesPanel.prototype.createReturnDataCommand = function (compoundCommand, evt) {
        var modelOutData = _.clone(Studio.getActiveEditor().getActiveModel()['outData']);
        var oldOutputs = this.FnUnitUtils.getOutputs(this.options.fnUnit);
        var oldMeta = this.FnUnitUtils.getMeta(this.options.fnUnit);
        // outputs에서 table로 meta가 바뀐 것을 찾아서 
        var changedOutputs = [];
        _.forEach(evt.outputs, function (tid, key) {
            var newType = evt.meta[key].type;
            var oldType = oldMeta[key] ? oldMeta[key].type : '';
            if (_.isEqual('table', oldType) && !_.isEqual('table', newType)) {
                changedOutputs.push(tid);
            }
        });
        //변경된거 없으면 탈출
        if (_.isEmpty(changedOutputs)) return;
        // 새로운 outData를 만들고
        var dup = _.intersection(modelOutData, changedOutputs);
        _.remove(modelOutData, function (tid) {
            return _.indexOf(dup, tid) >= 0;
        })
        // 커맨드에 add
        compoundCommand.add(new Brightics.VA.Core.Editors.Diagram.Commands.ReturnDataCommand(this, {
            outData: modelOutData
        }));
    };

    Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel = PropertiesPanel;
}).call(this);

/**
 * Source:
 * Created by daewon.park on 2017-06-15.
 */

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DexPropertiesPanel(parentId, options) {
        Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.call(this, parentId, options);
    }

    DexPropertiesPanel.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype);
    DexPropertiesPanel.prototype.constructor = DexPropertiesPanel;

    DexPropertiesPanel.prototype.createPersistButton = function () {
        var $persistButton = this.$mainControl.find('.brtc-va-editors-sheet-panels-propertiespanel-header > .brtc-va-editors-sheet-panels-basepanel-header-title');
        $persistButton.addClass('no-content');
    };

    DexPropertiesPanel.prototype.renderPersistButton = function () {
        // do nothing
    };

    DexPropertiesPanel.prototype.renderValues = function (command) {
        var _this = this;
        for (var j in command ? command.options.ref['dex-param'] : this.render) {
            this.render[j].bind(_this)();
        }
    };

    DexPropertiesPanel.prototype.createSetParameterValueCommand = function (paramName, paramValue) {
        var commandOption = {
            fnUnit: this.options.fnUnit,
            ref: {
                'dex-param': {}
            }
        };

        commandOption.ref['dex-param'][paramName] = paramValue;

        return new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitDexParameterValueCommand(this, commandOption);
    };

    DexPropertiesPanel.prototype.handleCommand = function (command) {
        Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype.handleCommand.call(this, command);

        if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitDexParameterValueCommand) this.handleSetFnUnitParameterValueCommand(command);
    };

    Brightics.VA.Core.Editors.Sheet.Panels.DexPropertiesPanel = DexPropertiesPanel;

}).call(this);    
/**
 * Created by gy84.bae on 2016-02-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BluffPanel($parent, options) {
        this.$parent = $parent;
        this.options = options;
        this.createControls();
        // Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.call(this, parentId, options);
    }

    // BluffPanel.prototype.createTopAreaControls = function ($parent) {
        // this.$header = $('' +
        //     '<div class="brtc-va-editors-sheet-panels-basepanel-header">' +
        //     '   <div class="brtc-va-editors-sheet-worksheet-selector"></div>' +
        //     '</div>' +
        //     '');

        // this.$selector = this.$header.find('.brtc-va-editors-sheet-worksheet-selector');
        // $parent.append(this.$header);

        // this.createTopAreaHeaderToolbar();

        // return this.$header;
    // };
                         
    BluffPanel.prototype.createControls = function () {
        this.$parent.addClass('brtc-style-flex-1');

        var $empty = $('<div class="brtc-va-editors-sheet-panels-basepanel-empty"></div>');
        this.$parent.append($empty);
        $empty.append('<h3>'+ this.options.label +'</h3');
        // this.createTopArea();
        // this.createContentsArea();
        // this.createBottomArea();

        // if (this.$topArea) {
        //     this.createTopAreaControls(this.$topArea);
        // }
        // if (this.$bottomArea) {
        //     this.createBottomAreaControls(this.$bottomArea);
        // }
        // if (this.$contentsArea) {
            // this.createContentsAreaControls(this.$contentsArea);
            // if (this.$contentsArea.hasClass('brtc-va-editors-sheet-panels-propertiespanel-contents-area')) {
            //     this.$contentsArea.perfectScrollbar();
            // }
        // }
    };

    Brightics.VA.Core.Editors.Sheet.Panels.BluffPanel = BluffPanel;
}).call(this);

/**
 * Created by jhoon80.park on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;

    function DistributedJdbcLoaderProperties(parentId, options) {
        Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.call(this, parentId, options);
    }

    DistributedJdbcLoaderProperties.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype);
    DistributedJdbcLoaderProperties.prototype.constructor = DistributedJdbcLoaderProperties;

    DistributedJdbcLoaderProperties.prototype.createContentsAreaControls = function ($parent) {
        Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype.createContentsAreaControls.call(this, $parent);
        this.$elements = {};
        this.controls = {};
    };

    DistributedJdbcLoaderProperties.prototype.renderValidation = function () {
        var _this = this;
        for (var i in _this.problems) {
            var key = _this.problems[i].param;
            if (_this.$elements[key]) {
                _this.createValidationContent(_this.$elements[key], _this.problems[i]);
            }
        }
    };

    DistributedJdbcLoaderProperties.prototype.changeCallback = function (changedParam) {

    };

    DistributedJdbcLoaderProperties.prototype.setValues = function (conditionObj) {
        var keys = Object.keys(conditionObj);
        for (var i in keys) {
            this.changeCallback(keys[i])
        }
    };

    DistributedJdbcLoaderProperties.prototype.getQueryResult = function ($control, sqlId, options, controlType, inputType) {
        inputType = inputType || 'String';
        var opt = {
            url: 'api/va/v2/datasources/jdbcloader/query/' + sqlId,
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(options || {}),
            blocking: true,
            async: false
        };
        $.ajax(opt).done(function (result) {
            var resultData = [];
            if (inputType === 'Integer' || inputType === 'Double') {
                for (var i = 0; i < result.data.length; i++) {
                    var d = result.data[i];
                    if (d[0]) result.data[i][0] = Number(d[0]);
                }
            }
            if (controlType === 'DropDownList') {
                for (var i = 0; i < result.data.length; i++) {
                    var d = result.data[i];
                    if (d[0]) resultData.push({label: d[0], value: d[0]});
                }
                $control.jqxDropDownList({source: resultData});
            }
            else if (controlType === 'ItemSelector') {
                for (var i = 0; i < result.data.length; i++) {
                    var d = result.data[i];
                    if (d[0]) resultData.push({item: d[0], description: d[1]});
                }
                $control.setItems(resultData);
            }
        }).fail(function () {
            if (controlType === 'DropDownList') $control.jqxDropDownList({source: []});
            else if (controlType === 'ItemSelector') $control.setItems([]);
        });
    };

    DistributedJdbcLoaderProperties.prototype.createSetParameterValueJdbcLoaderCommand = function (paramName, paramValue) {
        var commandOption = {
            fnUnit: this.options.fnUnit,
            ref: {
                param: {
                    sql: {
                        metadata: 'sql',
                        sqlId: this.options.fnUnit.param.sql.sqlId,
                        condition: $.extend(true, {}, this.options.fnUnit.param.sql.condition)
                    }
                }
            }
        };

        commandOption.ref.param.sql.condition[paramName] = paramValue;

        return new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this, commandOption);
    };

    DistributedJdbcLoaderProperties.prototype.createSetDataSourceParamValueJdbcLoaderCommand = function (paramName, paramValue) {
        var commandOption = {
            fnUnit: this.options.fnUnit,
            ref: {
                param: {
                    datasource: {
                        metadata: 'datasource',
                        datasourceId: this.options.fnUnit.param.datasource.datasourceId                    }
                }
            }
        };

        commandOption.ref.param.datasource[paramName] = paramValue;

        return new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this, commandOption);
    };


    Brightics.VA.Core.Editors.Sheet.Panels.DistributedJdbcLoaderProperties = DistributedJdbcLoaderProperties;

}).call(this);

/**
 * Created by gy84.bae on 2016-02-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function HtmlPanel(parentId, options) {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.call(this, parentId, options);
    }

    HtmlPanel.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype);
    HtmlPanel.prototype.constructor = HtmlPanel;

    HtmlPanel.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('<div class="brtc-va-editors-sheet-panels-basepanel brtc-style-display-flex brtc-style-flex-direction-column"/>');
        this.$parent.append(this.$mainControl);

        this.createTopArea();
        this.createContentsArea();
        this.createBottomArea();

        if (this.$topArea) {
            this.createTopAreaControls(this.$topArea);
        }
        if (this.$bottomArea) {
            this.createBottomAreaControls(this.$bottomArea);
        }
        if (this.$contentsArea) {
            this.createContentsAreaControls(this.$contentsArea);
            if (this.$contentsArea.hasClass('brtc-va-editors-sheet-panels-propertiespanel-contents-area')) {
                this.$contentsArea.perfectScrollbar();
            }
        }

    };

    HtmlPanel.prototype.createContentsAreaControls = function ($parent) {
        $parent.addClass('brtc-style-flex-1');
        this.$contentsArea
            .addClass('brtc-style-padding-right-20')
            .addClass('brtc-style-padding-right-20')
            .addClass('rtc-style-width-minus-40');

        var tid = 'html';
        
        var doneCallback = function  (htmlText) {
            $parent.append(htmlText);
        };
        var failCallback = function  () {
            var htmlText = '<h3>There is No Model</h3>';

            $parent.append(htmlText);
        };

        this.options.dataProxy.requestDataForce(tid, doneCallback, failCallback);
    };

    Brightics.VA.Core.Editors.Sheet.Panels.HtmlPanel = HtmlPanel;
}).call(this);
/**
 * Created by gy84.bae on 2016-02-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ImagePanel(parentId, options) {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.call(this, parentId, options);
    }

    ImagePanel.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype);
    ImagePanel.prototype.constructor = ImagePanel;

    ImagePanel.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('<div class="brtc-va-editors-sheet-panels-basepanel brtc-style-display-flex brtc-style-flex-direction-column"/>');
        this.$parent.append(this.$mainControl);

        this.createTopArea();
        this.createContentsArea();
        this.createBottomArea();

        if (this.$topArea) {
            this.createTopAreaControls(this.$topArea);
        }
            if (this.$bottomArea) {
            this.createBottomAreaControls(this.$bottomArea);
        }
        if (this.$contentsArea) {
            this.createContentsAreaControls(this.$contentsArea);
            if (this.$contentsArea.hasClass('brtc-va-editors-sheet-panels-propertiespanel-contents-area')) {
                this.$contentsArea.perfectScrollbar();
            }
        }
    };

    ImagePanel.prototype.createTopAreaControls = function ($parent) {
        this.createTopAreaHeaderTitle($parent);
        this.createTopAreaHeaderToolbar();
    };

    ImagePanel.prototype.createTopAreaHeaderToolbar = function ($parent) {
        var $toolbar = $('' +
                '<div class="brtc-va-editors-sheet-panels-datapanel-toolbar"/>');
        this.$header.append($toolbar);

        this.createPopupToolItem($toolbar);
        this.createMinMaxToolItem($toolbar);
    };

    ImagePanel.prototype.createPopupToolItem = function ($toolbar) {
        var _this = this;
        var $popup = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-popup" title="Pop up Chart" target="popupChart"></div>');
        $toolbar.append($popup);

        $popup.click(
            function () {
                var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
                var param = {
                    user: Brightics.VA.Env.Session.userId,
                    pid: modelEditor.options.editorInput.getProjectId(),
                    mid: _this.options.fnUnit.parent().mid,
                    fid: _this.options.fnUnit.fid,
                    tids: _this.FnUnitUtils.getImage(_this.options.fnUnit, _this.options.panelType),
                    offsetArr: [0],
                    limitArr: [1000]
                };

                var params = $.map(param, function (value, key) {
                    return key + '=' + value;
                }).join('&');
                window.open('popupimage?' + params, 'popupImage');
            }
        );
    };

    ImagePanel.prototype.render = function ($parent, imageText) {
        Brightics.VA.Core.Utils.RenderUtils.image($parent, imageText);
    };

    ImagePanel.prototype.createContentsAreaControls = function ($parent) {
        var _this = this;

        $parent.addClass('brtc-style-flex-1');

        var doneCallback = function  (imageText) {
            var $imageWrapper = $('<div class="brtc-va-editors-sheet-panels-imagepanel"></div>');
            $parent.append($imageWrapper);
            _this.render($imageWrapper, imageText);
        };
        var failCallback = function  () {
            _this.renderFail(_this.$contentsArea, 'No Image');
        };

        var tid = this.FnUnitUtils.getImage(this.options.fnUnit, this.options.panelType);
        this.options.dataProxy.requestDataForce(tid, doneCallback, failCallback);
    };

    Brightics.VA.Core.Editors.Sheet.Panels.ImagePanel = ImagePanel;
}).call(this);

/**
 * Created by jhoon80.park on 2016-01-27.
 */

/* global IN_DATA, OUT_DATA, TARGET_FID */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function InnerPropertiesPanel(parentId, options) {
        Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.call(this, parentId, options);
        
        this.innerType = '';
    }

    InnerPropertiesPanel.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype);
    InnerPropertiesPanel.prototype.constructor = InnerPropertiesPanel;

    InnerPropertiesPanel.prototype.handleOperationCommand = function (command) {
        Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype.handleOperationCommand.call(this, command);

        Studio.getInstance().doValidate(this.getModel());
    };

    InnerPropertiesPanel.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('<div class="brtc-va-editors-sheet-panels-basepanel"/>');
        this.$parent.append(this.$mainControl);

        this.createTopArea();
        this.createStepArea();
        this.createContentsArea();
        this.createBottomArea();

        this.$contentsArea.perfectScrollbar('update');

        if (this.$topArea) {
            this.createTopAreaControls(this.$topArea);
        }
        if (this.$bottomArea) {
            this.createBottomAreaControls(this.$bottomArea);
        }
        if (this.$contentsArea) {
            this.createContentsAreaControls(this.$contentsArea);
            if (this.$contentsArea.hasClass('brtc-va-editors-sheet-panels-propertiespanel-contents-area')) {
                this.$contentsArea.perfectScrollbar();
            }
        }

        var $persistButton = this.$topArea.find('.brtc-va-editors-sheet-panels-basepanel-header-tooltip');
        $persistButton.click(function () {
            if ($persistButton.attr('persist-mode') === 'auto') {
                $persistButton.attr('persist-mode', 'true');
                _this.options.fnUnit["persist-mode"] = 'true';
            } else if ($persistButton.attr('persist-mode') === 'true') {
                $persistButton.attr('persist-mode', 'false');
                _this.options.fnUnit["persist-mode"] = 'false';
            } else {
                $persistButton.attr('persist-mode', 'auto');
                _this.options.fnUnit["persist-mode"] = 'auto';
            }
            var properties = {
                'persist-mode': _this.options.fnUnit["persist-mode"]
            };
            var command = _this.createSetFnUnitCommand(properties);
            _this.executeCommand(command);
        });

    };

    InnerPropertiesPanel.prototype.createContentsArea = function () {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createContentsArea.call(this);
        this.$contentsArea.addClass('brtc-va-editors-sheet-panels-propertiespanel-contents-area');
        this.$contentsArea.addClass('inner');
    };

    InnerPropertiesPanel.prototype.createStepArea = function () {
        this.$stepArea = $('<div class="brtc-va-editors-sheet-panels-basepanel-step-area"></div>');
        this.$mainControl.append(this.$stepArea);

        this.$stepArea.addClass('brtc-style-padding-left-20').addClass('brtc-style-padding-right-20');

        this.createStepIntoControl();
        this.createStepOutControl();
    };

    InnerPropertiesPanel.prototype.createStepIntoControl = function () {
        var _this = this;

        this.$stepIntoControl = $('<div class="brtc-va-editors-sheet-controls-property-step-control in"></div>');
        this.$stepArea.append(this.$stepIntoControl);

        this.$stepIntoButton = $('' +
            '<button type="button" class="brtc-va-editors-sheet-panels-propertiespanel-button">' +
            'Step Into' +
            '</button>');
        this.$stepIntoControl.append(this.$stepIntoButton);

        this.$stepIntoButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '30px'
        });

        this.$stepIntoButton.click(function () {
            _this.stepInto();
        });
    };

    InnerPropertiesPanel.prototype.createStepOutControl = function () {
        var _this = this;

        this.$stepOutControl = $('<div class="brtc-va-editors-sheet-controls-property-step-control out"></div>');
        this.$stepArea.append(this.$stepOutControl);

        this.$stepOutButton = $('' +
            '<button type="button" class="brtc-va-editors-sheet-panels-propertiespanel-button">' +
            'Step Out' +
            '</button>');
        this.$stepOutControl.append(this.$stepOutButton);

        this.$stepOutButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '30px'
        });

        this.$stepOutButton.click(function () {
            _this.stepOut();
        });
    };

    InnerPropertiesPanel.prototype.stepInto = function () {
        var $diagram = this.options.modelEditor.getDiagramEditorPageArea();
        $diagram.trigger('fnUnit:dbclick', [[this.options.fnUnit.fid]]);
    };

    InnerPropertiesPanel.prototype.stepOut = function () {
        var modelLayoutManager = this.options.modelEditor.getModelLayoutManager();
        var editorInput = this.options.modelEditor.getEditorInput();
        var navigator = this.options.modelEditor.getToolbar().navigator;
        var path = navigator.getPath();
        var beforePath = (path.length === 1)? {mid:editorInput.getFileId()} : path[path.length -2];

        modelLayoutManager.openActivity(beforePath.mid, beforePath.fnUnit);
    };

    InnerPropertiesPanel.prototype.setType = function (type) {
        this.$mainControl.find('.brtc-va-editors-sheet-controls-property-step-control').addClass(type);
    };

    InnerPropertiesPanel.prototype.setHeight = function (height) {
        this.$contentsArea.height(height);
    };

    Brightics.VA.Core.Editors.Sheet.Panels.InnerPropertiesPanel = InnerPropertiesPanel;

}).call(this);
/**
 * Created by gy84.bae on 2016-02-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const MODEL_NAME = '_repr_brtc_';

    function ModelPanel(parentId, options) {
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.call(this, parentId, options);
    }

    ModelPanel.prototype = Object.create(Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype);
    ModelPanel.prototype.constructor = ModelPanel;

    ModelPanel.prototype.init = function () {
        this.$mainControl.attr('type', this.options.type);

        this.model = {};
    };

    ModelPanel.prototype.createTopAreaControls = function ($parent) {
        this.$header = $('' +
            '<div class="brtc-va-editors-sheet-panels-basepanel-header">' +
            '   <div class="brtc-va-editors-sheet-worksheet-selector"></div>' +
            '</div>' +
            '');

        this.$selector = this.$header.find('.brtc-va-editors-sheet-worksheet-selector');
        $parent.append(this.$header);

        this.createTopAreaHeaderToolbar();

        return this.$header;
    };

    ModelPanel.prototype.createSelector = function (model) {
        var _this = this;

        this.$selector.jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            source: model[MODEL_NAME] ? ['MODEL', 'JSON'] : ['JSON'],
            width: 120,
            autoDropDownHeight: true,
            dropDownWidth: 120,
            selectedIndex: 0
        });
        this.$selector.on('change', function (event) {
            var type = $(this).val();

            if (type === 'JSON') {
                _this.showJson();
                _this.renderJson();
            } else {
                _this.showModel();
                _this.renderModel();
            }

            _this.$contentsArea.perfectScrollbar('update');
        });
    };

    ModelPanel.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-editors-sheet-panels-basepanel brtc-style-display-flex brtc-style-flex-direction-column"/>');
        this.$parent.append(this.$mainControl);

        this.createTopArea();
        this.createContentsArea();
        this.createBottomArea();

        if (this.$topArea) {
            this.createTopAreaControls(this.$topArea);
        }
        if (this.$bottomArea) {
            this.createBottomAreaControls(this.$bottomArea);
        }
        if (this.$contentsArea) {
            this.createContentsAreaControls(this.$contentsArea);
            if (this.$contentsArea.hasClass('brtc-va-editors-sheet-panels-propertiespanel-contents-area')) {
                this.$contentsArea.perfectScrollbar();
            }
        }
    };

    ModelPanel.prototype.createTopAreaHeaderToolbar = function ($parent) {
        var $toolbar = $('' +
            '<div class="brtc-va-editors-sheet-panels-datapanel-toolbar"/>');
        this.$header.append($toolbar);

        this.createPopupToolItem($toolbar);
        this.createMinMaxToolItem($toolbar);
    };

    ModelPanel.prototype.createPopupToolItem = function ($toolbar) {
        var _this = this;
        var $popup = $('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-popup" title="Pop up Chart" target="popupChart"></div>');
        $toolbar.append($popup);

        $popup.click(
            function () {
                var modelEditor = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$mainControl);
                var param = {
                    user: Brightics.VA.Env.Session.userId,
                    pid: modelEditor.options.editorInput.getProjectId(),
                    mid: _this.options.fnUnit.parent().mid,
                    fid: _this.options.fnUnit.fid,
                    tids: _this.FnUnitUtils.getModel(_this.options.fnUnit, _this.options.panelType),
                    offsetArr: [0],
                    limitArr: [1000]
                };

                var params = $.map(param, function (value, key) {
                    return key + '=' + value;
                }).join('&');
                window.open('popupmodel?' + params, 'popupModel');
            }
        );
    };

    ModelPanel.prototype.registerCommandListener = function () {
        var _this = this;
        this.commandListener = function (command) {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand || command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand) {
                if (_this.options.fnUnit.fid === command.options[TARGET_FID]) {
                    _this.handleConnectionCommand(command);
                }
            } else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand) {
                if (_this.options.fnUnit.fid === command.options[TARGET_FID] || _this.options.fnUnit.fid === command.old[TARGET_FID]) {
                    _this.handleConnectionCommand(command);
                }
            } else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand) {
                if (_this.options.fnUnit.fid === command.options.fnUnit.fid) {
                    _this.handleOutTableCommand(command);
                }
            } else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewOutTableCommand) {
                if (_this.options.fnUnit.fid === command.options.fnUnit.fid) {
                    _this.handleNewOutTableCommand(command);
                }
            }
            else if (command instanceof Brightics.VA.Core.CompoundCommand) {
                $.each(command.commandList, function (index, com) {
                    if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand || com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand) {
                        if (_this.options.fnUnit.fid === com.options[TARGET_FID]) {
                            _this.handleConnectionCommand(com);
                        }
                    } else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand) {
                        if (_this.options.fnUnit.fid === com.options[TARGET_FID] || _this.options.fnUnit.fid === com.old[TARGET_FID]) {
                            _this.handleConnectionCommand(com);
                        }
                    } else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand) {
                        if (_this.options.fnUnit.fid === com.options.fnUnit.fid) {
                            _this.handleOutTableCommand(com);
                        }
                    }
                    else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand) {
                        if (_this.options.fnUnit.fid === com.options.fnUnit.fid) {
                            _this.handleConnectionCommand(com);
                        }
                    }
                    else if (com instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewOutTableCommand) {
                        if (_this.options.fnUnit.fid === com.options.fnUnit.fid) {
                            _this.handleNewOutTableCommand(com);
                        }
                    }
                });
            }
        };
        this.options.modelEditor.addCommandListener(this.commandListener);
    };

    ModelPanel.prototype.handleNewOutTableCommand = function ($parent) {
    };
    ModelPanel.prototype.handleConnectionCommand = function ($parent) {
    };
    ModelPanel.prototype.handleOutTableCommand = function ($parent) {
    };

    ModelPanel.prototype.createContentsAreaControls = function ($parent) {
        var _this = this;

        $parent.addClass('brtc-style-flex-1');

        this.createLayout($parent);

        var doneCallback = function (model) {
            _this.model = model;
            _this.createSelector(_this.model);
            _this.reset();
            _this.render();
        };
        var failCallback = function () {
            _this.showFail();
            _this.renderFail('No Model');
        };

        var tid = this.FnUnitUtils.getModel(this.options.fnUnit, this.options.panelType);
        this.options.dataProxy.requestDataForce(tid, doneCallback, failCallback);
    };

    ModelPanel.prototype.createLayout = function ($parent) {
        this.$jsonContainer = $('<div class="brtc-va-editors-sheet-panels-basepanel-json"></div>');
        this.$modelContainer = $('<div class="brtc-va-editors-sheet-panels-basepanel-model"></div>');
        this.$failContainer = $('<div class="brtc-va-editors-sheet-panels-basepanel-fail"></div>');

        $parent.append(this.$jsonContainer).append(this.$modelContainer).append(this.$failContainer);

        this.$contentsArea.perfectScrollbar();
    };

    ModelPanel.prototype.getRenderType = function () {
        return this.$selector.val();
    };

    ModelPanel.prototype.reset = function () {
        this.renderedJson = false;
        this.renderedModel = false;
    };

    ModelPanel.prototype.showJson = function () {
        this.$jsonContainer.show();
        this.$modelContainer.hide();
        this.$failContainer.hide();
    };

    ModelPanel.prototype.showModel = function () {
        this.$jsonContainer.hide();
        this.$modelContainer.show();
        this.$failContainer.hide();
    };

    ModelPanel.prototype.showFail = function () {
        this.$jsonContainer.hide();
        this.$modelContainer.hide();
        this.$failContainer.show();
    };

    ModelPanel.prototype.render = function () {
        var selector = this.getRenderType();

        if (selector === 'JSON') {
            this.showJson();
            this.renderJson();
        } else {
            this.showModel();
            this.renderModel();
        }
    };

    ModelPanel.prototype.destroy = function () {
        this.$selector.jqxDropDownList('destroy');
        Brightics.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.destroy.call(this);
    };

    ModelPanel.prototype.renderJson = function () {
        if (this.renderedJson) return;

        this.$jsonWrapper = $('' +
            '<div class="brtc-va-editors-sheet-panels-modelpanel-json">' +
            '   <pre></pre>' +
            '</div>');
        this.$jsonContainer.append(this.$jsonWrapper);

        this.$jsonWrapper.find('pre').val(this.model)
        this.$jsonWrapper.find('pre').jsonViewer(this.model);

        this.$contentsArea.perfectScrollbar('update');

        this.renderedJson = true;
    };

    ModelPanel.prototype.renderModel = function () {
        if (this.renderedModel) return;

        if (typeof this.model[MODEL_NAME] === 'undefined') return;
        this[MODEL_NAME] = this.model[MODEL_NAME];
        this.resources = this[MODEL_NAME].resources;

        this.$modelWrapper = $('<div class="brtc-va-editors-sheet-panels-modelpanel-model"></div>');
        this.$modelContainer.append(this.$modelWrapper);

        for (var i in this[MODEL_NAME].contents) {
            var content = this[MODEL_NAME].contents[i];
            this.addContents(this.$modelWrapper, content);
        }

        this.$contentsArea.perfectScrollbar('update');

        this.renderedModel = true;
    };

    ModelPanel.prototype.addContents = function ($parent, content) {
        var type = content.type;

        if (type === 'md') {
            var mdText = '';
            var textArr = content.text.split('\n');

            for (var i in textArr) {
                var text = textArr[i].trim();
                if (_.isEmpty(text)) text = '\n';

                mdText += text + '\n';
            }
            var $content = Brightics.VA.Core.Utils.RenderUtils[type]($parent, mdText);
            this.makeChart($content);
        } else {
            var $content = Brightics.VA.Core.Utils.RenderUtils[type]($parent, content.text);
            this.makeChart($content);
        }


    };

    ModelPanel.prototype.makeChart = function ($target) {
        if (!this.resources || !this.resources.chart) return;

        var chartAreaList = $target.find('.brightics-chart');

        for (var i in chartAreaList) {
            var $chartArea = $(chartAreaList[i]);

            var chartId = $chartArea.attr('id');

            var chartOption = this.getChartOption(chartId);

            Brightics.VA.Core.Utils.RenderUtils.chart($chartArea, chartOption);
        }
    };

    ModelPanel.prototype.getChartOption = function (chartId) {
        var option = {};

        for (var i in this.resources.charts) {
            if (this.resources.charts[i].id === chartId) {
                option = this.resources.charts[i].options;
                option.source = {};
                option.source.dataType = 'local';
                option.source.localData = [{
                    dataType: 'rawdata',
                    columns: this.resources.charts[i].dataSource.columns,
                    data: this.resources.charts[i].dataSource.data
                }];

                return option;
            }
        }
    };

    ModelPanel.prototype.renderFail = function (message) {
        var $fail = $('<div class="brtc-va-editors-sheet-panels-basepanel-fail"><h3></h3></div>');
        this.$failContainer.append($fail);

        $fail.addClass('brtc-style-full').addClass('brtc-style-flex-center');
        $fail.find('h3').text(message);
    };

    Brightics.VA.Core.Editors.Sheet.Panels.ModelPanel = ModelPanel;
}).call(this);

/**
 * Created by sds on 2017-07-17.
 */

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var CLICKABLE = 'brtc-style-emphasis';
    var MAX_ITEM = 2;

    function Navigator($parent, options) {
        this.options = options;
        this.editorInput = this.options.editor.options.editorInput;
        this.editor = this.options.editor;
        this.activityList = [];
        this.path = [];

        this.retrieveParent($parent);
        this.createControls();
        this.init();
    }

    Navigator.prototype.retrieveParent = function ($parent) {
        this.$parent = $parent;
    };
    
    Navigator.prototype.createControls = function () {
        var $container = $('' +
        '<div class="brtc-va-editors-model-info-toolbar brtc-style-editor-model-info brtc-style-padding-0 brtc-va-editors-toolbar-navigator">' +
        '   <div class="brtc-va-editors-model-info-toolbar-title brtc-style-editors-model-info-toolitem brtc-style-cursor-default">Home' +
        '   </div>' +
        '</div>');

        this.$parent.append($container);

        ///// fix me
        this.$mainControl = $container.find('.brtc-va-editors-model-info-toolbar-title.brtc-style-editors-model-info-toolitem');
    };

    Navigator.prototype.init = function () {
        this.$mainControl.html('Home');
        this.addProject();
        this.addFile();
    };

    Navigator.prototype._getConditionType = function (condition, conditions) {
        if (conditions[0] === condition) return 'if';
        if (conditions[conditions.length - 1] === condition) return 'else';
        return 'else if';
    };

    Navigator.prototype.dfs = function (model, targetMid, targetFid) {
        if (_.isUndefined(model)) return false;
        if (model.mid === targetMid) return true;
        var _this = this;
        var getLabel = function (fn) {
            return fn.display.label;
        };
        for (var i = 0; i < model.functions.length; ++i) {
            var fn = model.functions[i];
            if (!targetMid && fn.fid === targetFid) {
                _this.path.push({
                    fnUnit: fn,
                    label: getLabel(fn)
                });
                return true;
            }
            if (fn.func === 'if') {
                var conditions = _this.getConditions(fn);
                for (var j = 0; j < conditions.length; ++j) {
                    var condition = conditions[j];
                    _this.path.push({
                        mid: condition.mid,
                        fnUnit: fn,
                        label: getLabel(fn) +
                            '(' + this._getConditionType(condition, conditions) + ')'
                    });
                    if (_this.dfs(_this._getModelByMid(condition.mid), targetMid, targetFid)) {
                        return true;
                    }
                    _this.path.pop();
                }
            } else if (fn.func === 'forLoop' ||
                    fn.func === 'whileLoop') {
                _this.path.push({
                    mid: fn.param.mid,
                    fnUnit: fn,
                    label: getLabel(fn)
                });
                if (_this.dfs(_this._getModelByMid(fn.param.mid), targetMid, targetFid)) {
                    return true;
                }
                _this.path.pop();
            }
        }
        return false;
    };

    Navigator.prototype.getConditions = function (fn) {
        var ret = [];
        ret.push(fn.param.if);
        ret = ret.concat(fn.param.elseif);
        ret.push(fn.param.else);
        return ret;
    };

    Navigator.prototype.buildNavigator = function (mid, fid) {
        var _this = this;
        this.init();
        this.path = [];
        this.activityList = [];
        if (this.dfs(this.options.editor.getModel(), mid, fid)) {
            if (this.path.length > MAX_ITEM) {
                _this.addDotDotDot();
            }
            _.forEach(_.dropRight(_.takeRight(this.path, MAX_ITEM)),
                _.partial(_this.addActivity, _, true),
                _this);
            if (!_.isEmpty(this.path)) {
                _this.addActivity(_.last(this.path));
                _this.$fileUnit.addClass(CLICKABLE);
            } else {
                _this.$fileUnit.removeClass(CLICKABLE);
            }
        }
    };

    Navigator.prototype.addProject = function () {
        var projectId = this.editorInput.getProjectId();
        var project = Studio.getResourceManager().getProject(projectId);
        var projectLabel = project.getLabel();

        var $unit = this.createUnit(projectId);

        var $projectArea = $('<div class="brtc-va-editors-modelinfo-toolbar-project-label"></div>');
        $projectArea.text(projectLabel).attr('title', projectLabel);

        $unit.append($projectArea);
    };

    Navigator.prototype.addFile = function () {
        var _this = this;
        
        var $unit = this.createUnit(this.editorInput.getFileId());
        
        var fileLabel = this.editorInput.getLabel();
        var $fileArea = $('<div class="brtc-va-editors-modelinfo-toolbar-file-label"></div>');
        $fileArea.text(fileLabel).attr('title', fileLabel);               
        $unit.append($fileArea);

        this.$fileUnit = $unit;

        $fileArea.click(function () {
            if (_this.isClickable($unit)) {
                var modelLayoutManager = _this.editor.modelLayoutManager;
                if (modelLayoutManager) {
                    if (modelLayoutManager.openActivity &&
                        typeof modelLayoutManager.openActivity === 'function') {
                        modelLayoutManager.openActivity(_this.editorInput.getFileId());
                    }
                }
            }
        });
    };

    Navigator.prototype.addDotDotDot = function () {
        var _this = this;
        var modelLayoutManager = this.options.editor.modelLayoutManager;
        var $unit = this.createUnit('---');
        var $activityArea = $('<div class="brtc-va-editors-modelinfo-toolbar-activity-label"></div>');
        var activityLabel = '...';
        $activityArea.text(activityLabel).attr('title', activityLabel);
        this.addEmphasis($unit);
        $unit.append($activityArea);
        $activityArea.addClass('brtc-va-editors-modelinfo-toolbar-dotdotdot');
        $activityArea.click(function (event) {
            var anchorOffset = $(event.target).offset();
            var pos = {
                x: anchorOffset.left - 402 + 26,
                y: anchorOffset.top - 10 + 40
            };
            _this.openNavigatorDialog(pos, _.dropRight(_this.path, MAX_ITEM), {
                getNavigatorData: function () {
                    return _.dropRight(_this.path, MAX_ITEM);
                },
                navigate: function (mid, fid) {
                    modelLayoutManager.openActivity(mid, fid);
                }
            });
        });
    };

    Navigator.prototype.addActivity = function (opt, clickable) {
        var _this = this;
        var activityId = opt.mid || opt.fnUnit.fid;
        var $unit = this.createUnit(activityId);
        var activityLabel = opt.label;
        var $activityArea = $('<div class="brtc-va-editors-modelinfo-toolbar-activity-label"></div>');
        $activityArea.text(activityLabel).attr('title', activityLabel);
        $unit.append($activityArea);
        if (clickable) {
            this.addEmphasis($unit);
            $activityArea.click(function () {
                _this.handleActivitySelected(activityId);
            });
        }

        this.addToActivityList({ id: activityId, view: $unit, fnUnit: opt.fnUnit });
        return $activityArea;
    };

    Navigator.prototype.addToActivityList = function (activityObj) {
        this.activityList.push(activityObj);
    };

    Navigator.prototype.createUnit = function (id) {
        this.activityList.push(id);
        
        var $unit = $('<div class="brtc-va-editors-modelinfo-toolbar-unit brtc-style-flex-center"></div>');
        $unit.attr('id', id);
        this.addArrow($unit);
        this.$mainControl.append($unit);

        return $unit;
    };

    Navigator.prototype.addArrow = function ($parent) {
        var $arrow = $('<div class="brtc-style-editors-model-info-arrow brtc-style-cursor-default" ></div>');
        $parent.append($arrow);
    };

    Navigator.prototype.getActivity = function (id) {
        for (var i in this.activityList) {
            if (this.activityList[i].id === id) {
                this.activityList[i].index = i;

                return this.activityList[i];
            }
        }
        return {};
    };

    Navigator.prototype.handleActivitySelected = function (id) {
        var selectedActivity = this.getActivity(id);

        var modelLayoutManager = this.options.editor.modelLayoutManager;
        if (modelLayoutManager) {
            if (modelLayoutManager.openActivity &&
                typeof modelLayoutManager.openActivity === 'function') {
                modelLayoutManager.openActivity(selectedActivity.id, selectedActivity.fnUnit);
            }
        }
    };

    Navigator.prototype._getModelByMid = function (mid) {
        return this.editor.getModelByMid(mid);
    };

    Navigator.prototype._getFunctionByFid = function (fid) {
        return this.editor.getFunctionByFid(fid);
    };

    Navigator.prototype.addEmphasis = function ($unit) {
        $unit.addClass(CLICKABLE);
    };
    
    Navigator.prototype.removeEmphasis = function ($unit) {
        $unit.removeClass(CLICKABLE);
    };

    Navigator.prototype.isClickable = function ($unit) {
        return $unit.hasClass(CLICKABLE);
    };

    Navigator.prototype.registerOpenNavigatorDialog = function (open) {
        this.openNavigatorDialog = open;
    };

    Navigator.prototype.getPath = function () {
        return this.path;
    };

    Brightics.VA.Core.Editors.Navigator = Navigator;

/* eslint-disable no-invalid-this */
}).call(this);

/**
 * Created by sds on 2017-07-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Module = window.__module__;
    var TreeNode = Module.DataStructures.TreeNode;

    function NavigatorTree(id, data) {
        this.__root = new TreeNode(id, data);
    }

    NavigatorTree.prototype.getRoot = function () {
        return this.__root;
    };
    
    NavigatorTree.prototype.addChild = function (id, data) {
        return this.getRoot().addChild(id, data);
    };

    NavigatorTree.prototype.getChild = function (id) {
        return this.getRoot().getChild(id);
    };

    NavigatorTree.prototype.deleteChild = function (id) {
        this.getRoot().deleteChild(id);
    };
    
    Brightics.VA.Core.Editors.NavigatorTree = NavigatorTree;
}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Toolbar($parent, options) {
        this.options = options;
        this.editor = options.editor || null;

        this.items = {};

        this.retrieveParent($parent);
        this.createControls();
        this.registerItems();
    }

    Toolbar.prototype.retrieveParent = function ($parent) {
        this.$parent = $parent;
    };

    Toolbar.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-editors-modeleditor-toolbar brtc-style-editor-toolbar brtc-style-col-12">' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.createNavigator(this.$mainControl);
    };

    Toolbar.prototype.createNavigator = function ($toolbarContainer) {
        this.navigator = new Brightics.VA.Core.Editors.Navigator($toolbarContainer, this.options);
    };

    Toolbar.prototype.registerItems = function () {
        console.error('registerItems must be implemented');
    };

    Toolbar.prototype.addItem = function (item) {
        var ITEM =
            (item.class && typeof item.class === 'function') ? (item.class) : (Brightics.VA.Core.Editors.Toolbar.Item);
        var itemInstance = new ITEM(this.$mainControl, item);
        this.items[itemInstance.getItemType()] = itemInstance;
    };

    Toolbar.prototype.getHeight = function () {
        return this.$mainControl.outerHeight();
    };

    Toolbar.prototype.showItem = function (itemType) {
        this.items[itemType].show();
    };

    Toolbar.prototype.hideItem = function (itemType) {
        this.items[itemType].hide();
    };

    Toolbar.prototype.getItem = function (itemType) {
        return this.items[itemType];
    };

    Brightics.VA.Core.Editors.Toolbar = Toolbar;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Item($parent, options) {
        this.options = options || {};
        this.options.attribute = this.options.attribute || {};
        this.options.action = this.options.action || {};

        this.retrieveParent($parent);
        this.createControls();

        this.initOptions();
        this.applyOptions();
    }

    Item.prototype.retrieveParent = function ($parent) {
        this.$parent = $parent;
    };

    Item.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem"></div>');
        this.$parent.append(this.$mainControl);
    };

    Item.prototype.initOptions = function() {
        //Override
    };

    Item.prototype.applyOptions = function () {
        this.applyAttribute();
        this.applyAction();
        this.applyVisible();
        this.applySeparator();
    };

    Item.prototype.applyAttribute = function () {
        for (var key in this.options.attribute) {
            this.$mainControl.attr(key, this.options.attribute[key]);
        }
    };

    Item.prototype.applyAction = function () {
        for (var key in this.options.action) {
            if (typeof this.options.action[key] === 'function') {
                this.$mainControl.on(key, this.options.action[key].bind(this));
            }
        }
    };

    Item.prototype.applyVisible = function () {
        if (this.options.visible === false) {
            this.$mainControl.hide();
        }
    };

    Item.prototype.applySeparator = function () {
        if (this.options.separator === true) {
            var $separator = $('<div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem" item-type="separator"></div>');
            this.$parent.append($separator);
        }
    };

    Item.prototype.setOptions = function (options) {
        this.options = $.extend(this.options, options);
    };

    Item.prototype.getOptions = function () {
        return this.options;
    };

    Item.prototype.getTitle = function () {
        return this.options.attribute['title'];
    };

    Item.prototype.getItemType = function () {
        return this.options.attribute['item-type'];
    };

    Item.prototype.show = function () {
        this.$mainControl.show();
    };

    Item.prototype.hide = function () {
        this.$mainControl.hide();
    };

    Item.prototype.setEnable = function () {
        this.$mainControl.removeClass('status-disabled');
    };

    Item.prototype.setDisable = function () {
        this.$mainControl.addClass('status-disabled');
    };

    Item.prototype.handleOnSelectionChanged = function () {
    };

    Brightics.VA.Core.Editors.Toolbar.Item = Item;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ClipboardItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    ClipboardItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    ClipboardItem.prototype.constructor = ClipboardItem;

    ClipboardItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Function Clipboard",
                    "item-type": "clipboard"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    ClipboardItem.prototype.handleOnClick = function (event) {
        Studio.getClipboardManager().openClipboardDialog(true);
    };

    Brightics.VA.Core.Editors.Toolbar.ClipboardItem = ClipboardItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DatasourceItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    DatasourceItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    DatasourceItem.prototype.constructor = DatasourceItem;

    DatasourceItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Datasource Management",
                    "item-type": "datasource"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    DatasourceItem.prototype.handleOnClick = function (event) {
        // Studio.getClipboardManager().openClipboardDialog(true);
        new Brightics.VA.Core.Dialogs.DatasourceManagementDialog(this.$parent);
    };

    Brightics.VA.Core.Editors.Toolbar.DatasourceItem = DatasourceItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function FunctionhelpItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    FunctionhelpItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    FunctionhelpItem.prototype.constructor = FunctionhelpItem;

    FunctionhelpItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Function Reference",
                    "item-type": "functionhelp"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    FunctionhelpItem.prototype.handleOnClick = function (event) {
        //Model마다 type이 다르므로 Implementation에서 override하여 구현
        //var w = window.open('api/va/v2/help/function?type=data', 'Brightics Help');
        //w.blur();
    };

    Brightics.VA.Core.Editors.Toolbar.FunctionhelpItem = FunctionhelpItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function HistoryItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    HistoryItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    HistoryItem.prototype.constructor = HistoryItem;

    HistoryItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "History",
                    "item-type": "history"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    HistoryItem.prototype.handleOnClick = function (event) {
        this.closeHistoryDialog();
        this.openHistoryDialog(event);
    };

    HistoryItem.prototype.closeHistoryDialog = function () {
        if (this.historySelector) {
            this.historySelector.close();
        }
        this.historySelector = null;
    };

    HistoryItem.prototype.openHistoryDialog = function (event) {
        var editor = Studio.getEditorContainer().getActiveModelEditor();
        var commandManager = editor.getCommandManager();

        var stacks = commandManager.getStacks();
        var source = [];
        var description;
        for (var i in stacks) {
            if (stacks[i].option && stacks[i].option.fnUnit) {
                description = stacks[i].getLabel() + " - " + stacks[i].options.fnUnit.display.label;
            }
            else {
                description = stacks[i].getLabel();
            }

            source.push({
                name: stacks[i].getLabel(),
                description: description
            });
        }
        var goHistoryHandler = function (dialogResult) {
            if (dialogResult.OK) {
                commandManager.go(dialogResult.goHistory);
            }
        };
        this.historySelector = new Brightics.VA.Core.Dialogs.HistorySelector(editor.$mainControl, {
            selectHistory: goHistoryHandler,
            stackIndex: commandManager.index,
            source: source,
            editor: editor
        });
    };

    Brightics.VA.Core.Editors.Toolbar.HistoryItem = HistoryItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function IndexItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    IndexItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    IndexItem.prototype.constructor = IndexItem;

    IndexItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Index",
                    "item-type": "index"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    IndexItem.prototype.handleOnClick = function (event) {
        this.closeIndexDialog();
        this.openIndexDialog();
    };

    IndexItem.prototype.closeIndexDialog = function (event) {
        var editor = Studio.getEditorContainer().getActiveModelEditor();
        var indexDialog = editor.indexDialog;

        if (indexDialog) {
            indexDialog.close();
        }
        indexDialog = null;
    };

    IndexItem.prototype.openIndexDialog = function (event) {
        var editor = Studio.getEditorContainer().getActiveModelEditor();

        editor.indexDialog = new Brightics.VA.Core.Dialogs.IndexDialog(editor.$mainControl, {
            editor: editor,
            appendTo: editor.$mainControl
        });
    };
    
    Brightics.VA.Core.Editors.Toolbar.IndexItem = IndexItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ModelInfoItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    ModelInfoItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    ModelInfoItem.prototype.constructor = ModelInfoItem;

    ModelInfoItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Model Information",
                    "item-type": "model-info"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    ModelInfoItem.prototype.handleOnClick = function (event) {
        this.closeInfoDialog();
        this.openInfoDialog(event);
    };

    ModelInfoItem.prototype.closeInfoDialog = function () {
        if (this.infoDialog) {
            this.infoDialog.close();
        }
        this.infoDialog = null;
    };

    ModelInfoItem.prototype.openInfoDialog = function (event) {
        var modelEditor = Studio.getEditorContainer().getActiveModelEditor()
        var modelFile = modelEditor.getEditorInput();
        var project = Studio.getResourceManager().getProject(modelFile.getProjectId());

        this.infoDialog = new Brightics.VA.Core.Dialogs.InfoDialog(modelEditor.getMainArea(), {
            project: project,
            model: modelFile,
            position: {my: 'left top', at: 'left bottom', of: event.target},
            appendTo: modelEditor.getMainArea(),
            modal: false,
            title: 'Model Information'
        });
    };

    Brightics.VA.Core.Editors.Toolbar.ModelInfoItem = ModelInfoItem;

}).call(this);
/* -----------------------------------------------------
 *  move-mode-item.js
 *  Created by hyunseok.oh@samsung.com on 2018-07-03.
 * ---------------------------------------------------- */

/* global Studio */

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function MoveModeItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);

        this.isSelected = false;
    }

    MoveModeItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    MoveModeItem.prototype.constructor = MoveModeItem;

    MoveModeItem.prototype.initOptions = function () {
        this.setOptions(
            {
                'attribute': {
                    'title': 'Move Mode',
                    'item-type': 'move-mode'
                },
                'action': {
                    'click': this.handleOnClick
                }
            }
        );
    };

    MoveModeItem.prototype.handleOnClick = function (event) {
        var modelEditor = Studio.getEditorContainer()
            .getActiveModelEditor();
        if (this.isSelected) {
            modelEditor.setEditorState('move-mode-enabled', false);
            this.$mainControl.removeClass('status-selected');
        } else {
            modelEditor.setEditorState('move-mode-enabled', true);
            this.$mainControl.addClass('status-selected');
        }
        this.isSelected = !this.isSelected;
    };

    Brightics.VA.Core.Editors.Toolbar.MoveModeItem = MoveModeItem;

/* eslint-disable no-invalid-this */
}.call(this));

/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RedoItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);

        this.refresh();
        this.addCommandListener();
        this.addGoHistoryListener();
    }

    RedoItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    RedoItem.prototype.constructor = RedoItem;

    RedoItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Redo",
                    "item-type": "redo"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    RedoItem.prototype.refresh = function () {
        this.refreshEnable();
        this.refreshTitle();
    };

    RedoItem.prototype.refreshEnable = function () {
        var commandManager = Studio.getEditorContainer().getActiveModelEditor().getCommandManager();

        if (commandManager.canRedo()) {
            this.$mainControl.removeClass('status-disabled');
        } else {
            this.$mainControl.addClass('status-disabled');
        }
    };

    RedoItem.prototype.refreshTitle = function () {
        var commandManager = Studio.getEditorContainer().getActiveModelEditor().getCommandManager();

        var commandStack = commandManager.stack, index = commandManager.index;
        var redoLabel = commandStack[index + 1] ? commandStack[index + 1].getLabel() : '';
        this.$mainControl.attr('title', 'Redo ' + redoLabel);
    };

    RedoItem.prototype.addCommandListener = function () {

        var _this = this;
        Studio.getEditorContainer().getActiveModelEditor().addCommandListener(function (command) {
            _this.refresh();
        })
    };

    RedoItem.prototype.addGoHistoryListener = function () {
        var _this = this;
        Studio.getEditorContainer().getActiveModelEditor().addGoHistoryListener(function (command) {
            _this.refresh();
        })
    };

    RedoItem.prototype.handleOnClick = function (event) {
        Studio.getEditorContainer().getActiveModelEditor().getCommandManager().redo();
    };

    Brightics.VA.Core.Editors.Toolbar.RedoItem = RedoItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RunItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    RunItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    RunItem.prototype.constructor = RunItem;

    RunItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Run",
                    "item-type": "run"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    RunItem.prototype.handleOnClick = function (event) {
        //Model마다 Run이 다르므로 Implementation에서 override하여 구현
    };

    Brightics.VA.Core.Editors.Toolbar.RunItem = RunItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ScheduleItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    ScheduleItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    ScheduleItem.prototype.constructor = ScheduleItem;

    ScheduleItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Schedule",
                    "item-type": "schedule"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    ScheduleItem.prototype.handleOnClick = function (event) {
        var editor = Studio.getEditorContainer().getActiveModelEditor();

        new Brightics.VA.Core.Dialogs.ScheduleManagementDialog(editor.$mainControl, {
            editorInput: editor.options.editorInput,
            appendTo: editor.$parent,
            position: {my: 'center top', at: 'center top+15%', of: window},
            title: 'Schedule list'
        });
    };

    Brightics.VA.Core.Editors.Toolbar.ScheduleItem = ScheduleItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Separator($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    Separator.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    Separator.prototype.constructor = Separator;

    Separator.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "item-type": "separator"
                }
            }
        );
    };

    Brightics.VA.Core.Editors.Toolbar.Separator = Separator;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function TooltipItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    TooltipItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    TooltipItem.prototype.TooltipItem = TooltipItem;

    TooltipItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Tooltip",
                    "item-type": "tooltip"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    TooltipItem.prototype.handleOnClick = function (event) {
        var editor = Studio.getEditorContainer().getActiveModelEditor();

        var isSelected = this.$mainControl.hasClass('status-selected');
        if (isSelected) {
            editor.diagramEditorPage.changeTooltipEnabled(false);
            this.$mainControl.removeClass('status-selected');
        } else {
            editor.diagramEditorPage.changeTooltipEnabled(true);
            this.$mainControl.addClass('status-selected');
        }
    };

    Brightics.VA.Core.Editors.Toolbar.TooltipItem = TooltipItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function UndoItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);

        this.refresh();
        this.addCommandListener();
        this.addGoHistoryListener();
    }

    UndoItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    UndoItem.prototype.constructor = UndoItem;

    UndoItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Undo",
                    "item-type": "undo"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    UndoItem.prototype.refresh = function () {
        this.refreshEnable();
        this.refreshTitle();
    };

    UndoItem.prototype.refreshEnable = function () {
        var editor = Studio.getEditorContainer().getActiveModelEditor();
        var commandManager = editor.getCommandManager();

        if (commandManager.canUndo()) {
            this.$mainControl.removeClass('status-disabled');
        } else {
            this.$mainControl.addClass('status-disabled');
        }
    };

    UndoItem.prototype.refreshTitle = function () {
        var editor = Studio.getEditorContainer().getActiveModelEditor();
        var commandManager = editor.getCommandManager();

        var commandStack = commandManager.stack, index = commandManager.index;
        var undoLabel = commandStack[index] ? commandStack[index].getLabel() : '';
        this.$mainControl.attr('title', 'Undo ' + undoLabel);
    };

    UndoItem.prototype.addCommandListener = function () {
        var editor = Studio.getEditorContainer().getActiveModelEditor();

        var _this = this;
        editor.addCommandListener(function (command) {
            _this.refresh();
        })
    };

    UndoItem.prototype.addGoHistoryListener = function () {
        var editor = Studio.getEditorContainer().getActiveModelEditor();

        var _this = this;
        editor.addGoHistoryListener(function (command) {
            _this.refresh();
        })
    };

    UndoItem.prototype.handleOnClick = function (event) {
        Studio.getEditorContainer().getActiveModelEditor().getCommandManager().undo();
    };

    Brightics.VA.Core.Editors.Toolbar.UndoItem = UndoItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function UploadItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    UploadItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    UploadItem.prototype.constructor = UploadItem;

    UploadItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Upload",
                    "item-type": "upload"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    UploadItem.prototype.handleOnClick = function (event) {
        this.openRepositoryBrowserDialog();
    };

    UploadItem.prototype.openRepositoryBrowserDialog = function (event) {
        var editor = Studio.getEditorContainer().getActiveModelEditor();

        new Brightics.VA.Core.Dialogs.RepositoryBrowserDialog(editor.getMainArea(), {
            useButton: false,
            filePath: '',
            open: function () {
                $('.ui-dialog-titlebar.ui-widget-header', $(this).parent()).css('margin-left', '30px !important');
            },
            resizable: true,
            title: 'Browse Repository'
        });
    };
    
    Brightics.VA.Core.Editors.Toolbar.UploadItem = UploadItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function VariableItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    VariableItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    VariableItem.prototype.constructor = VariableItem;

    VariableItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Variables",
                    "item-type": "variable"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    VariableItem.prototype.handleOnClick = function (event) {
        Studio.getEditorContainer().getActiveModelEditor().getSideBarManager()
            .expandStatusChange('variables', true);
    };

    Brightics.VA.Core.Editors.Toolbar.VariableItem = VariableItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function VersionItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);
    }

    VersionItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    VersionItem.prototype.constructor = VersionItem;

    VersionItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Version Management",
                    "item-type": "version"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    VersionItem.prototype.handleOnClick = function (event) {
        var editor = Studio.getEditorContainer().getActiveModelEditor();
        var editorInput = editor.getEditorInput();
        var projectId = editorInput.getProjectId();
        var fileId = editorInput.getFileId();

        new Brightics.VA.Core.Dialogs.VersionManagementDialog(this.$mainControl, {
            projectId: projectId,
            fileId: fileId,
            position: {my: 'center top', at: 'center top+15%', of: window},
            editor: editor
        });
    };

    Brightics.VA.Core.Editors.Toolbar.VersionItem = VersionItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ZoomItem($parent, options) {
        Brightics.VA.Core.Editors.Toolbar.Item.call(this, $parent, options);

        this.createZoomContextMenu();
    }

    ZoomItem.prototype = Object.create(Brightics.VA.Core.Editors.Toolbar.Item.prototype);
    ZoomItem.prototype.constructor = ZoomItem;

    ZoomItem.prototype.createZoomContextMenu = function () {
        var _this = this;
        var editor = Studio.getEditorContainer().getActiveModelEditor();

        this.$ctxMenu = $('' +
            '<div class="brtc-va-editor-toolitem-zoom-ctxmenu brtc-style-editor-toolitem-zoom-ctxmenu">' +
            '   <ul>' +
            '       <li action="0.6" title="x 0.6">x 0.6</li>' +
            '       <li action="0.8" title="x 0.8">x 0.8</li>' +
            '       <li action="1.0" title="x 1.0">x 1.0</li>' +
            '   </ul>' +
            '</div>');

        this.$parent.append(this.$ctxMenu);

        this.$ctxMenu.jqxMenu({
            theme: Brightics.VA.Env.Theme,
            width: '56px',
            height: '180px',
            autoOpenPopup: false,
            mode: 'popup',
            animationHideDuration: 0,
            animationShowDuration: 0
        });

        editor.options.lastSelectedScale = this.$ctxMenu.find('li[action="1.0"]');

        this.$ctxMenu.on('itemclick', function (event) {
            var $el = $(event.args);

            if (editor.options.lastSelectedScale) {
                editor.options.lastSelectedScale.removeClass('selected');
            }
            editor.options.lastSelectedScale = $el;
            editor.options.lastSelectedScale.addClass('selected');

            editor.diagramEditorPage.changeScale($el.attr('action') * 1);
        });

        this.$ctxMenu.find('li[action="1.0"]').addClass('selected');

        this.ctxMenuCloseHandler = function () {
            _this.$ctxMenu.jqxMenu('close');
        };
    };

    ZoomItem.prototype.initOptions = function () {
        this.setOptions(
            {
                "attribute": {
                    "title": "Zoom",
                    "item-type": "zoom"
                },
                "action": {
                    'click': this.handleOnClick
                }
            }
        );
    };

    ZoomItem.prototype.handleOnClick = function (event) {
        var left = $(event.target).offset().left - 16;
        var top = $(event.target).offset().top + $(event.target).height() + 4;

        this.$ctxMenu.jqxMenu('open', left, top);
        $('.brtc-va-editors-modeleditor-diagram').on('scroll', this.ctxMenuCloseHandler);
        $(window).on('resize', this.ctxMenuCloseHandler);
    };

    Brightics.VA.Core.Editors.Toolbar.ZoomItem = ZoomItem;

}).call(this);
/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    Brightics.VA.Core.Editors.Toolbar.ItemsTemplate = {

    };

}).call(this);
/**
 * Created by ng1123.kim on 2016-05-04.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function DataExplorer(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
    }

    DataExplorer.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    DataExplorer.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-views-dataexplorer brtc-va-tab-contents">' +
            // '   <div class="brtc-va-views-dataexplorer-repostiory brtc-style-s-sidebar-background"></div>' +
            '   <div class="brtc-va-views-dataexplorer-repostiory"></div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.repositoryViewer = new Brightics.VA.Core.Controls.RepositoryViewer(this.$mainControl.find('.brtc-va-views-dataexplorer-repostiory'));
    };

    DataExplorer.prototype.destroy = function () {
        this.repositoryViewer.destroy();
    };

    DataExplorer.prototype.render = function () {
        this.repositoryViewer.render();
    };

    Brightics.VA.Core.Views.DataExplorer = DataExplorer;

}).call(this);
/* -----------------------------------------------------
 *  datasource-management.js
 *  Created by hyunseok.oh@samsung.com on 2018-10-16.
 * ---------------------------------------------------- */

/* global RSAKey, brtc_require */
(function (root) {
    const Brightics = root.Brightics;
    const dim = (...args) => Brightics.VA.Core.Utils.CommonUtils.dim(...args);
    const crel = brtc_require('crel');
    const theme = Brightics.VA.Env.Theme;
    const {DB, Cloud} = brtc_require('Dao').DatasourceDao;
    const {getDatasources, addDatasource,
        updateDatasource, deleteDatasource, getDbTypes} = DB;
    const {getS3s, addS3, updateS3, deleteS3} = Cloud;

    const ITEM_HEIGHT = 25;
    const MAX_DROPDOWN_HEIGHT = 150;
    const DEBUG = false;

    const S3 = 'Amazon S3';

    const print = (msg) => DEBUG && console.log(msg);

    let dbTypes = [];

    const getRSA = function () {
        return Promise.resolve($.ajax({
            type: 'GET',
            url: 'api/va/v2/rsa/publickey'
        })).then(({publicN, publicE}) => {
            const rsa = new RSAKey();
            rsa.setPublic(publicN, publicE);
            return rsa;
        });
    };

    const getEncryptedDatasource = function (datasource) {
        return getRSA().then((rsa) => {
            if (datasource.datasourceType === 'RDB') {
                return Object.assign({}, datasource, {
                    password: rsa.encrypt(datasource.password)
                });
            } else {
                return Object.assign({}, datasource, {
                    secretAccessKey: rsa.encrypt(datasource.secretAccessKey)
                });
            }
        });
    };

    const DatasourceTree = (function () {
        function DatasourceTree($parent, options) {
            print($parent, options);
            this.data = options.data;
            this.handler = options.handler;
            this.$control = $(
                crel('div', 'datasource-management-view__tree')
            );

            this.$control.jqxTree({
                theme: Brightics.VA.Env.Theme,
                source: this.getTreeSourceFromData(options.data),
                height: '100%',
                width: '100%',
                allowDrag: false,
                allowDrop: false
            });

            this.$control.on('itemClick', (e) => {
                print(e);
                const item = this.$control.jqxTree('getItem', e.args.element);
                const data = this.getDataByItem(item);
                print(data, 'selected');
                this.handler.itemClick(data);
            });
            $parent.append(this.$control);
        }

        DatasourceTree.prototype.destroy = function () {
            this.$control.jqxTree('destroy');
        };

        DatasourceTree.prototype.getTreeSourceFromData = function (data) {
            return data.map(({label, items}, id) => {
                return {
                    html: `
                        <i
                            class="fa fa-${label === 'DB' ? 'database' : 'cloud'}"
                            aria-hidden="true"
                        ></i> ${_.escape(label)}`,
                    expanded: false,
                    items: items.map((_el, _id) => {
                        const label = `${_el.datasourceName} (${_el.dbType || (_el.cloudType || S3)})`;
                        return {
                            html: `
                                <span
                                    class="datasource-management-view__tree-item brtc-style-ellipsis"
                                    ds-type="${_el.datasourceType === 'RDB' ? 'RDB' : 'Cloud'}"
                                    ds-name="${_el.datasourceName}"
                                    title="${label}"
                                >${_.escape(label)}</span>
                            `,
                            items: []
                        };
                    })
                };
            });
        };

        DatasourceTree.prototype.render = function (data) {
            this.setData(data);
            this.$control.jqxTree({
                theme: Brightics.VA.Env.Theme,
                source: this.getTreeSourceFromData(this.data)
            });
            this.$control.jqxTree('refresh');
        };

        DatasourceTree.prototype.select = function ({datasourceName, datasourceType} = {}) {
            const item = this.getItemByLabelAndType(datasourceName, datasourceType);
            this.$control.jqxTree('selectItem', item);
            if (!item) return;
            const parent = this.getItemByElement(item.parentElement);
            if (parent) this.$control.jqxTree('expandItem', parent);
        };

        DatasourceTree.prototype.getItemByElement = function (el) {
            const items = this.$control.jqxTree('getItems');
            for (let item of items) {
                if (item.element === el) return item;
            }
            return null;
        };

        DatasourceTree.prototype.getItemByLabelAndType = function (label, datasourceType) {
            var items = this.$control.jqxTree('getItems');
            for (let item of items) {
                const span = item.element.querySelector('span');
                if (span &&
                    span.getAttribute('ds-name') === label &&
                    span.getAttribute('ds-type') === datasourceType) return item;
            }
            return null;
        };

        DatasourceTree.prototype.setData = function (data) {
            this.data = data;
        };

        DatasourceTree.prototype.deleteById = function ({datasourceName, datasourceType = 'Cloud'}) {
            var item = this.getItemByLabelAndType(datasourceName, datasourceType);
            if (item) {
                this.$control.jqxTree('removeItem', item.element);
            }
        };

        DatasourceTree.prototype.getDataByItem = function (item) {
            const span = item.element.querySelector('span');
            if (span) {
                const datasourceName = span.getAttribute('ds-name');
                const datasourceType = span.getAttribute('ds-type');
                for (let p of this.data) {
                    for (let q of p.items) {
                        if (q.datasourceName === datasourceName &&
                            (q.datasourceType || 'Cloud') === datasourceType) return q;
                    }
                }
                return null;
            }
        };
        return DatasourceTree;
    }());

    const DatasourceManagementViewForm = (function () {
        function DatasourceManagementViewForm($parent, _options) {
            var options = _options || {};
            this.options = options;
            this.handler = options.handler || {};
            var $control = $(crel('div', {class: 'datasource-management-view__form'}));
            this.$control = $control;
            $parent.append($control);
        }

        DatasourceManagementViewForm.prototype.getAllValidationMessage = function () {
            return this.view.map(({validate}) => validate()).filter((v) => v);
        };

        DatasourceManagementViewForm.prototype.focusFirstInvalidInput = function () {
            const firstInvalid = this.view.find(({validate}) => validate());
            firstInvalid && firstInvalid.focus();
        };

        DatasourceManagementViewForm.prototype.validate = function () {
            return this.view.forEach((v) => v.validate());
        };

        DatasourceManagementViewForm.prototype.isDirty = function () {
            return this.view.some(({getValue, key}) => {
                print(getValue(), this.data[key]);
                return getValue() !== this.data[key];
            });
        };

        DatasourceManagementViewForm.prototype.getJSON = function () {
            const obj = this.view.reduce((acc, e) => {
                return Object.assign(acc, {
                    [e.key]: e.getValue()
                });
            }, {});

            if (this.data.datasourceType === 'RDB') {
                return Object.assign({datasourceType: 'RDB'}, obj);
            }
            return Object.assign({datasourceType: 'Cloud'}, obj);
        };

        DatasourceManagementViewForm.prototype.setData = function (data) {
            this.data = data;
            if (!data) return;
            if (data.datasourceType !== 'RDB') {
                this.data = Object.assign({cloudType: S3}, data);
            }
        };

        DatasourceManagementViewForm.prototype.render = function (data, readOnly) {
            this.setData(data);
            this.$control.empty();
            if (!data) return;

            const wrap = (label, el) => {
                return crel('div', {class: 'datasource-management-view__input-row'},
                    crel('div', {class: 'datasource-management-view__input-wrapper'},
                        crel('div', {class: 'datasource-management-view__label-wrapper'},
                            crel('label', label,
                                crel('span', {class: 'datasource-management-view__required-star'},
                                    '*'))
                        ),
                        el
                    ),
                    crel('div', {class: 'datasource-management-view__validation-area'})
                );
            };

            const requiredValidator = (val) => {
                if (val.trim().length === 0) return 'Required field';
                return '';
            };

            const createInputPair = (key, label, value,
                    {validator = requiredValidator, option = {}} = {}) => {
                const inp = crel('input',
                    Object.assign({
                        class: 'datasource-management-view__input',
                        value: value,
                        maxlength: 80,
                        title: option.disabled ? value : ''
                    }, option));
                const $pair = $(wrap(label, inp));
                const $inp = $(inp).jqxInput({
                    theme,
                    value,
                    disabled: option.disabled,
                    height: '100%',
                    width: '300px'
                });
                const $v = $pair.find('.datasource-management-view__validation-area');
                const getValue = () => $inp.jqxInput('val');
                const focus = () => $inp.focus();
                const validate = () => {
                    const val = $inp.jqxInput('val');
                    const msg = validator ? validator(val) : '';
                    $pair.toggleClass('datasource-management-view__input-row--error', !!msg);
                    $v.html(msg);
                    return msg;
                };
                $inp.on('keyup', () => this.handler.valueChange());
                $inp.on('focusout', () => {
                    validate();
                });
                return {
                    $el: $pair,
                    getValue,
                    validate,
                    focus,
                    key
                };
            };

            const createDropdownPair = (key, label, items, value, option) => {
                const div = crel('div',
                    Object.assign({class: 'datasource-management-view__dropdown'}, option));


                const index = Math.max(0, items.indexOf(value));

                const calcDropdownHeight = (num) => {
                    return Math.min(ITEM_HEIGHT * num, MAX_DROPDOWN_HEIGHT) + 'px';
                };

                const $dropdown = $(div).jqxDropDownList({
                    theme,
                    source: items,
                    selectedIndex: index,
                    height: '100%',
                    width: '300px',
                    dropDownHeight: calcDropdownHeight(items.length)
                });

                $dropdown.on('change', () => this.handler.handleValueChange());

                const getValue = () => $dropdown.jqxDropDownList('val');
                const validate = () => '';

                const $pair = $(wrap(label, div));
                return {
                    $el: $pair,
                    getValue,
                    validate,
                    key
                };
            };

            const viewTarget = data.datasourceType === 'RDB' ? 'RDB' : 'Cloud';
            const viewMap = {
                RDB: [
                    createInputPair('datasourceName', 'Name', data.datasourceName, {
                        option: {
                            disabled: readOnly
                        }
                    }),
                    createInputPair('ip', 'IP', data.ip),
                    createInputPair('port', 'Port', data.port, {
                        validator: (val) => {
                            const num = '01234567890';
                            if (requiredValidator(val)) return requiredValidator(val);
                            const length = val.length;
                            for (let i = 0; i < length; i++) {
                                if (num.indexOf(val[i]) === -1) return 'Number type is required.';
                            }
                            return '';
                        }
                    }),
                    createDropdownPair('dbType', 'DB Type', dbTypes, data.dbType),
                    createInputPair('dbName', 'DB Name', data.dbName),
                    createInputPair('userName', 'User Name', data.userName),
                    createInputPair('password', 'Password', data.password, {option: {type: 'password'}})
                ],
                Cloud: [
                    createInputPair('datasourceName', 'Name', data.datasourceName, {
                        option: {
                            disabled: readOnly
                        }
                    }),
                    createDropdownPair('cloudType', 'Cloud Type', [
                        S3
                    ], data.cloudType || S3),
                    createInputPair('accessKeyId', 'Access Key ID', data.accessKeyId),
                    createInputPair('secretAccessKey', 'Secret Access Key', data.secretAccessKey, {
                        option: {
                            type: 'password'
                        }
                    }),
                    createInputPair('bucketName', 'Bucket Name', data.bucketName)
                ]
            };

            const view = viewMap[viewTarget];

            this.view = view;

            this.$control.append(view.map((x) => x.$el));
            print(view.map((x) => x.getValue()));
            return;
        };
        return DatasourceManagementViewForm;
    }());

    const DatasourceDetail = (function () {
        function DatasourceDetail($parent, _options) {
            var options = _options || {};
            this.handler = options.handler;
            var $control = $(
                crel('div', {class: 'datasource-management-view__detail'},
                    crel('div', {class: 'datasource-management-view__form-area'}),
                    crel('div', {class: 'datasource-management-view__button-area'},
                        crel('div', {class: 'datasource-management-view__left-button-area'},
                            crel('button', {class: 'datasource-management-view__delete-button'},
                                'Delete')
                        ),
                        crel('div', {class: 'datasource-management-view__right-button-area'},
                            crel('button', {class: 'datasource-management-view__cancel-button'},
                                'Cancel'),
                            crel('button', {class: 'datasource-management-view__save-button'},
                                'Save')
                        )
                    )
                )
            );
            this.data = options.item;
            this.$control = $control;
            this.$formArea = this.$control.find('.datasource-management-view__form-area');
            this.dmvForm = new DatasourceManagementViewForm(
                this.$formArea,
                {
                    item: this.item,
                    handler: {
                        valueChange: this.handleValueChange.bind(this)
                    }
                }
            );
            this.$formArea.perfectScrollbar();
            $parent.append($control);

            const defBtnOpt = {
                theme,
                width: 100,
                height: 30
            };

            this.$buttonArea = this.$control.find('.datasource-management-view__button-area');
            this.$saveButton = this.$buttonArea.find('.datasource-management-view__save-button')
                .jqxInput(defBtnOpt);
            this.$cancelButton = this.$buttonArea.find('.datasource-management-view__cancel-button')
                .jqxInput(defBtnOpt);
            this.$deleteButton = this.$buttonArea.find('.datasource-management-view__delete-button')
                .jqxInput(defBtnOpt);

            this.$saveButton.click((e) => {
                this.handler.saveClick(this.getDataByType());
            });
            this.$cancelButton.click((e) => {
                this.render(this.data, this.lastReadOnly);
            });
            this.$deleteButton.click((e) => {
                if (this.data) this.handler.deleteClick(this.data);
            });

            this.$buttonArea.hide();
        }

        DatasourceDetail.prototype.isValid = function () {
            return this.dmvForm.getAllValidationMessage().length === 0;
        };

        DatasourceDetail.prototype.focusFirstInvalidInput = function () {
            return this.dmvForm.focusFirstInvalidInput();
        };

        DatasourceDetail.prototype.getDataByType = function () {
            return this.dmvForm.getJSON();
        };

        DatasourceDetail.prototype.handleValueChange = function () {
            print('disabled', !this.dmvForm.isDirty());
            this.$saveButton.jqxInput({
                disabled: !this.dmvForm.isDirty()
            });
        };

        DatasourceDetail.prototype.render = function (data, readOnly) {
            this.data = data;
            this.dmvForm.render(data, readOnly);
            this.lastReadOnly = readOnly;
            this.$buttonArea.toggle(!!data);
            this.$deleteButton.toggle(!!(data && data.datasourceName));
            if (data) {
                this.$saveButton.jqxInput({
                    disabled: !this.dmvForm.isDirty()
                });
            }
        };

        DatasourceDetail.prototype.getDatasourceName = function () {
            return this.data ? this.data.datasourceName : '';
        };
        return DatasourceDetail;
    }());

    function DatasourceManagementView(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
        this.$control = this._createControl(this.$parent);
        this.data = [
            {
                label: 'Cloud Datasource',
                items: []
            },
            {
                label: 'DB',
                items: []
            }
        ];

        this.fetched = false;
        dim(() => {
            return this._fetchData()
                .then((data) => this._init(data));
        }, {appendTo: this.$parent})
            .catch((err) => {
                console.error(err);
            });
    }

    DatasourceManagementView.prototype._createControl = function ($parent) {
        var $control = $(
            crel('div', {class: 'datasource-managemenet-view__wrapper'},
                crel('div', {class: 'datasource-management-view__upper-button-area'},
                    crel('button', {class: 'datasource-management-view__new-connection-button'},
                        'New Connection ▼')
                ),
                crel(
                    'div', {class: 'datasource-managemenet-view'},
                        crel('div', {class: 'datasource-management-view__left-panel'}),
                        crel('div', {class: 'datasource-management-view__right-panel'})
                )
            )
        );
        this.$dmvLeftPanel = $control.find('.datasource-management-view__left-panel');
        this.$dmvRightPanel = $control.find('.datasource-management-view__right-panel');
        this.$addNew = $control.find('.datasource-management-view__new-connection-button')
            .jqxInput({
                theme,
                width: 120,
                height: 30
            });

        this.$newConnectionMenu = $(
            crel('div', {class: 'datasource-management-view__add-connection-menu'},
                crel('ul',
                    crel('li', {action: 'cloud'}, 'Cloud'),
                    crel('li', {action: 'db'}, 'DB')
                )
            )
        );

        this.$newConnectionMenu.jqxMenu({
            theme: Brightics.VA.Env.Theme,
            width: '100px',
            height: '180px',
            autoOpenPopup: false,
            mode: 'popup',
            animationHideDuration: 0,
            animationShowDuration: 0
        });

        this.$newConnectionMenu.on('itemclick', (e) => {
            var action = e.args.getAttribute('action');
            print(e, action);
            this._handleNewConnectionClick(action);
        });

        this.$addNew.click((e) => {
            const {top, left} = this.$addNew.offset();
            this.$newConnectionMenu.jqxMenu('open',
                left - this.$newConnectionMenu.outerWidth() + this.$addNew.outerWidth(),
                top + this.$addNew.outerHeight());
            print(e);
        });

        $parent.append($control);
        return $control;
    };

    DatasourceManagementView.prototype.getElement = function () {
        return this.$control;
    };

    DatasourceManagementView.prototype._fetchData = function () {
        this.fetched = true;
        const fetchDB = getDatasources();
        const fetchCloud = getS3s();
        const fetchDbTypes = getDbTypes();

        return Promise.all([fetchDB, fetchCloud, fetchDbTypes])
            .then(([db, cloud, _dbTypes]) => {
                dbTypes = _dbTypes;
                return new Promise((resolve, reject) => {
                    resolve([
                        {
                            label: 'Cloud Datasource',
                            items: cloud
                        },
                        {
                            label: 'DB',
                            items: db
                        }
                    ]);
                });
            });
    };

    DatasourceManagementView.prototype._init = function (data) {
        print('render', data);
        this.data = data;
        this.datasourceTree = new DatasourceTree(this.$dmvLeftPanel, {
            data,
            handler: {
                itemClick: this._handleItemClick.bind(this)
            }
        });

        this.datasourceDetail = new DatasourceDetail(this.$dmvRightPanel, {
            item: null,
            handler: {
                saveClick: this._handleSaveClick.bind(this),
                cancelClick: this._handleCancelClick.bind(this),
                deleteClick: this._handleDeleteClick.bind(this)
            }
        });
    };

    DatasourceManagementView.prototype._handleSaveClick = function (data) {
        print('handle save click', data);
        if (this.datasourceDetail.isValid()) {
            if (!this.selected) {
                dim(() => {
                    const newData = getEncryptedDatasource(data).then((_data) => {
                        return _data.datasourceType === 'RDB' ?
                            addDatasource(_data) :
                            addS3(_data);
                    });
                    return newData
                        .then(() => {
                            this._new(data)
                                .then(() => {
                                    this.selected = data;
                                    this.datasourceTree.select(data);
                                    this.datasourceDetail.render(data, true);
                                });
                        })
                        .catch((err) => {
                            if (err.responseText) {
                                Brightics.VA.Core.Utils.WidgetUtils
                                    .openErrorDialog(JSON.parse(err.responseText));
                            } else {
                                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(err);
                            }
                        });
                });
            } else {
                dim(() => {
                    const updateData = getEncryptedDatasource(data).then((_data) => {
                        return _data.datasourceType === 'RDB' ?
                            updateDatasource(_data) :
                            updateS3(_data);
                    });
                    return updateData.then(() => {
                        this._modify(this.selected, data);
                        return;
                    });
                });
                print(data);
            }
        } else {
            print('validation error');
            this.datasourceDetail.focusFirstInvalidInput();
        }
    };

    DatasourceManagementView.prototype._new = function (data) {
        return Promise.resolve(data)
            .then((_d) => {
                const d = _d || data;
                print('add', d);
                if (d.datasourceType === 'RDB') {
                    const t = this.data.find((el) => {
                        return el.label === 'DB';
                    });
                    if (t) {
                        t.items = t.items.concat(Object.assign({}, d, {password: ''}));
                    }
                } else {
                    const t = this.data.find((el) => {
                        return el.label === 'Cloud Datasource';
                    });
                    if (t) {
                        t.items = t.items.concat(Object.assign({}, d, {secretAccessKey: ''}));
                    }
                }
                this.datasourceTree.render(this.data);
            })
            .catch((err) => {
                console.error(err);
            });
    };

    DatasourceManagementView.prototype._modify = function (target, data) {
        const {datasourceName} = target;
        const prev = [];
        if (datasourceName === data.datasourceName) {
            this.data = this.data.map(({label, items}) => {
                return {
                    label,
                    items: items.map((item) => {
                        return item.datasourceName === datasourceName ? data : item;
                    })
                };
            });
            this.datasourceTree.setData(this.data);
            this.datasourceDetail.render(data, true);
        }
        prev.reduce((acc, c) => {
            return acc.then(c);
        }, Promise.resolve())
            .then(() => {
                this.datasourceTree.select(data);
                this.selected = data;
            })
            .catch((err) => {
                console.error(err);
            });
    };

    DatasourceManagementView.prototype._handleCancelClick = function () {
        print('handle cancel click');
    };

    DatasourceManagementView.prototype._delete = function ({datasourceName, datasourceType = 'Cloud'}) {
        this.data = this.data.map(({label, items}) => {
            return {
                label,
                items: items.filter((item) => {
                    return !((item.datasourceType || 'Cloud') === datasourceType &&
                        item.datasourceName === datasourceName);
                })
            };
        });
    };

    DatasourceManagementView.prototype._handleDeleteClick = function (data) {
        const {datasourceName} = data;
        print('handle delete click', datasourceName);
        dim(() => {
            const deleteData = data.datasourceType === 'RDB' ?
                deleteDatasource(data.datasourceName) :
                deleteS3(data.datasourceName);
            return deleteData
                .then(() => {
                    this._delete(data);
                    this.datasourceTree.deleteById(data);
                    this.datasourceTree.setData(this.data);
                    this.datasourceDetail.render(null);
                });
        });
    };

    DatasourceManagementView.prototype._handleNewConnectionClick = function (e) {
        print('handle new connection click', e);
        this.selected = null;

        const newData = e === 'cloud' ?
            {
                datasourceName: '',
                datasourceType: 'Cloud',
                accessKeyId: '',
                secretAccessKey: '',
                bucketName: ''
            } : {
                datasourceName: '',
                datasourceType: 'RDB',
                deploy: false,
                ip: '',
                port: '',
                userName: '',
                password: '',
                dbType: 'postgre',
                dbName: ''
            };
        this.datasourceDetail.render(newData);
        this.datasourceTree.select();
    };

    DatasourceManagementView.prototype._handleItemClick = function (data) {
        print('handle item click');
        this.selected = data;
        this.datasourceDetail.render(data, true);
    };

    DatasourceManagementView.prototype.destroy = function () {
        if (this.datasourceTree) {
            this.datasourceTree.destroy();
            this.datasourceTree = null;
        }
    };

    Brightics.VA.Core.Views.DatasourceManagementView = DatasourceManagementView;
/* eslint-disable no-invalid-this */
}(this));

/**
 * Created by gy84.bae on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function DeepLearningPalette(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
    }

    DeepLearningPalette.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    DeepLearningPalette.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-views-palette brtc-va-tab-contents brtc-style-tab-content">' +
            '   <div class="brtc-va-views-palette-filter brtc-va-searcharea brtc-style-search-area"></div>' +
            '   <div class="brtc-va-views-palette-navigator-wrapper  brtc-va-contentsarea">' +
            '       <div class="brtc-va-views-palette-navigator"></div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$filter = this.$mainControl.find('.brtc-va-views-palette-filter');
        this.$navigator = this.$mainControl.find('.brtc-va-views-palette-navigator');

        this.createFilterControl();
        this.createNavigatorControl();
        this.$mainControl.find('.brtc-va-views-palette-navigator-wrapper').perfectScrollbar();
    };

    DeepLearningPalette.prototype.createFilterControl = function () {
        var _this = this;

        var $filterInput = $('<input type="search" class="brtc-va-views-palette-filter-input searchinput"/>');
        this.$filter.append($filterInput);

        $filterInput.jqxInput({
            placeHolder: 'Search Item',
            theme: Brightics.VA.Env.Theme
        });
        var applyFilter = function (event) {
            var filterValue = event.target.value.toLowerCase();

            var containers = _this.$mainControl.find('.brtc-va-views-palette-fnunit-list');
            $.each(containers, function (index, container) {
                _this.$navigator.jqxNavigationBar('expandAt', index);
            });

            var matchedList = Brightics.VA.Implementation.DeepLearning.Functions.Library.getListByTags([filterValue.trim()]);
            var paletteItems = _this.$mainControl.find('.brtc-va-views-palette-fnunit');
            $.each(paletteItems, function (index, item) {
                var $funcElement = $(item).parent();
                var funcName = Brightics.VA.Core.Utils.WidgetUtils.getData($funcElement.find('.brtc-va-views-palette-fnunit'), 'func');
                $funcElement.css('display', $.inArray(funcName, matchedList) > -1 ? 'block' : 'none');
            });

            containers = _this.$mainControl.find('.brtc-va-views-palette-fnunit-list');
            $.each(containers, function (index, container) {
                var visibleElements = $(container).find('.brtc-va-views-palette-fnunit-content').filter(function () {
                    return $(this).css('display') == 'block';
                });
                $(container).css('display', visibleElements.length > 0 ? 'block' : 'none');
                $(container).prev().css('display', visibleElements.length > 0 ? 'block' : 'none');
            });

            _this.$mainControl.find('.brtc-va-views-palette-navigator-wrapper').perfectScrollbar('update');
        };
        $filterInput.keyup(function (event) {
            applyFilter(event);
        });

        $filterInput.on('search', function () {
            applyFilter(event);
        });
    };

    DeepLearningPalette.prototype.createNavigatorControl = function () {
        var _this = this;

        var option = {
            url: 'api/va/v2/studio/palette/' + this.options.modelType,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            blocking: false
        };
        $.ajax(option).done(function (data) {
            if (_this.options.additionalGroup) data.push(_this.options.additionalGroup);
            _this.createFunctions(data);


            if (_this.options.modelType === Brightics.VA.Implementation.DataFlow.Clazz) {

            } else {
                if (_this.options.draggable) _this.draggablePalette();

                var opt = {
                    theme: Brightics.VA.Env.Theme,
                    expandMode: 'multiple',
                    expandedIndexes: [],
                    width: '100%'
                    // width: 'calc(100% - 20px)'
                };
                for (var idx in data) {
                    opt.expandedIndexes.push(idx);
                }
                _this.$navigator.jqxNavigationBar(opt);

            }
        });

    };

    DeepLearningPalette.prototype.appendFunction = function (funcGroup) {
        var _this = this;
        var $functionListControl = $('<div class = "brtc-va-views-palette-fnunit-list"></div>');
        $.each(funcGroup.functions, function (index, funcItem) {
            if (funcItem.visible) {
                var clazz = _this.options.modelType;
                Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($functionListControl, funcItem.func, clazz);
            }
        });

        // add header
        _this.$navigator.append('' +
            '<div>' +
            '   <div>' +
            '       <div class="brtc-va-views-palette-fnunit-type">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(funcGroup.label) + '</div>' +
            '   </div>' +
            '</div>');
        // add content
        _this.$navigator.append($functionListControl);
    };

    DeepLearningPalette.prototype.createFunctions = function (funcGroupList) {
        var _this = this;

        $.each(funcGroupList, function (index, funcGroup) {
            if (funcGroup.visible) {
                _this.appendFunction(funcGroup);
            }
        });
    };

    DeepLearningPalette.prototype.draggablePalette = function () {
        var _this = this;

        this.$navigator.find(".brtc-va-views-palette-fnunit").each(function () {
            $(this).mouseover(function () {
                $(this).toggleClass('brtc-va-views-palette-fnunit-hover');
            }).mouseout(function () {
                $(this).toggleClass('brtc-va-views-palette-fnunit-hover');
            });

            _this._draggableFnUnit($(this));
        });
    };

    DeepLearningPalette.prototype._draggableFnUnit = function ($fnUnitElement) {
        var _this = this;
        $fnUnitElement.draggable({
            appendTo: 'body',
            scroll: false,
            cursor: 'move',
            cursorAt: {left: 5, top: 5},
            helper: function (event) {
                var $helper = $(this).clone();
                $helper.css({'z-index': 5100});

                var funcType = Brightics.VA.Core.Utils.WidgetUtils.getData($fnUnitElement, 'func');
                var template = {
                    functions: [{func: funcType}],
                    links: []
                };
                Brightics.VA.Core.Utils.WidgetUtils.putData($helper, 'template', template);
                Brightics.VA.Core.Utils.WidgetUtils.putData($helper, 'source', _this);
                return $helper;
            },
            start: function (event, ui) {
                $('.brtc-va-studio').addClass('brtc-va-studio-dragging');

                $(this).draggable("option", "cursorAt", {
                    left: Math.floor(ui.helper.width() / 2),
                    top: Math.floor(ui.helper.height() / 2)
                });
            },
            drag: function (event, ui) {
                ui.helper.trigger('feedback', [{clientX: event.clientX, clientY: event.clientY}]);
            },
            stop: function (event, ui) {
                $('.brtc-va-studio').removeClass('brtc-va-studio-dragging');
            }
        });
    };



    Brightics.VA.Core.Views.DeepLearningPalette = DeepLearningPalette;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function EditorTab(parentId, options) {
        this.parentId = parentId;
        this.options = options || {};
        this.listeners = {};
        this.opened = [];
        this.maxTabCount = this.options.maxTabCount || 6;

        this.retrieveParent();
        this.createControls();
    }

    EditorTab.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    EditorTab.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-tools-menubar-editor-title-container">' +
            '   <ul>' +
            '       <li class="brtc-va-tools-menubar-editor-tab newmodel" title="Open Model/Report">' +
            '           <div class="brtc-va-tools-menubar-editor-title-new-button"></div>' +
            '       </li>' +
            '   </ul>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.createNewEditorButton(this.$mainControl.find('.brtc-va-tools-menubar-editor-tab.newmodel'));
    };

    EditorTab.prototype.createNewEditorButton = function ($element) {
        this.newEditorButton = $element;
        $element.on('click', this.handleNewEditorButtonClicked.bind(this));
    };

    EditorTab.prototype.showNewEditorButton = function () {
        this.newEditorButton.css('display', 'block');
    };

    EditorTab.prototype.hideNewEditorButton = function () {
        this.newEditorButton.css('display', 'none');
    };

    EditorTab.prototype.handleNewEditorButtonClicked = function () {
        Studio.getLayoutManager().showProjectViewerPopup();
    };

    EditorTab.prototype.openTab = function (editorInput) {
        var pid = this.getIdFromEditorInput(editorInput).pid;
        var fid = this.getIdFromEditorInput(editorInput).fid;

        var targetTabIndex = this.getTargetTabIndex(pid, fid);
        if (targetTabIndex > -1) {
            this.selectTabIndex(targetTabIndex);
        } else {
            if (this.isOverMaxTabCount()) {
                this.showErrorMessage();

                return false;
            } else {
                this.createTab(editorInput);
                this.selectTab(pid, fid);
            }
        }

        return true;
    };

    EditorTab.prototype.updateTab = function (editorInput) {
        var pid = this.getIdFromEditorInput(editorInput).pid;
        var fid = this.getIdFromEditorInput(editorInput).fid;

        var targetTabIndex = this.getTargetTabIndex(pid, fid);
        if (targetTabIndex > -1) {
            var $tabTemplate = this.$mainControl.find('li:eq(' + targetTabIndex + ')');
            this.setTabTemplateData($tabTemplate, editorInput);
        }
    };

    EditorTab.prototype.closeTab = function (editorInput) {
        var pid = this.getIdFromEditorInput(editorInput).pid;
        var fid = this.getIdFromEditorInput(editorInput).fid;

        var selectedIndex = this.getSelectedTabIndex();
        var targetTabIndex = this.getTargetTabIndex(pid, fid);
        if (targetTabIndex > -1) {
            this.closeTabIndex(targetTabIndex);

            if (selectedIndex === targetTabIndex && this.getOpenedTabs().length) {
                var nextIndex = (targetTabIndex === 0) ? (0) : (targetTabIndex - 1);
                this.selectTabIndex(nextIndex);
                return this.getEditorInputByIndex(nextIndex);
            }
        }
    };

    EditorTab.prototype.unselectAll = function () {
        this.$mainControl.find('li').removeClass('selected');
    };

    EditorTab.prototype.getSelectedTabIndex = function () {
        if (this.$mainControl.find('li.selected').length) {
            return this.$mainControl.find('li.selected').prevAll().length;
        } else {
            return -1;
        }
    };

    EditorTab.prototype.getOpenedTabs = function () {
        return this.opened;
    };

    EditorTab.prototype.getTargetTabIndex = function (pid, fid) {
        var index = -1;
        for (var i = 0; i < this.opened.length; i++) {
            if (this.opened[i].pid === pid && this.opened[i].fid === fid) {
                index = i;
                break;
            }
        }
        return index;
    };

    EditorTab.prototype.getEditorInputByIndex = function (index) {
        if (0 <= index && index < this.opened.length) {
            var pid = this.opened[index].pid;
            var fid = this.opened[index].fid;
            return this.getEditorInput(pid, fid);
        }
        return undefined;
    };

    EditorTab.prototype.selectTab = function (pid, fid) {
        for (var i = 0; i < this.opened.length; i++) {
            if (this.opened[i].pid === pid && this.opened[i].fid === fid) {
                this.selectTabIndex(i);
                break;
            }
        }
    };

    EditorTab.prototype.selectTabIndex = function (tabIndex) {
        this.$mainControl.find('li').removeClass('selected');
        if (tabIndex > -1) {
            this.$mainControl.find('li:eq(' + tabIndex + ')').addClass('selected');
        }
    };

    EditorTab.prototype.closeTabIndex = function (tabIndex) {
        if (tabIndex > -1) {
            this.opened.splice(tabIndex, 1);
            this.$mainControl.find('li:eq(' + tabIndex + ')').remove();
        }
    };

    EditorTab.prototype.isOverMaxTabCount = function () {
        return (this.opened.length >= this.maxTabCount);
    };

    EditorTab.prototype.showErrorMessage = function () {
        return Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog(
            'You can not open more than ' + this.maxTabCount + ' editors.');
    };

    EditorTab.prototype.createTab = function (editorInput) {
        var pid = this.getIdFromEditorInput(editorInput).pid;
        var fid = this.getIdFromEditorInput(editorInput).fid;

        this.opened.push({ pid: pid, fid: fid });
        this.createTabTemplate(editorInput);
    };

    EditorTab.prototype.createTabTemplate = function (editorInput) {
        var $template = $('' +
            '<li class="brtc-va-tools-menubar-editor-tab">' +
            '   <div class="brtc-va-tools-menubar-editor-title">' +
            '      <div class="brtc-va-tools-menubar-editor-title-icon"></div>' +
            '      <div class="brtc-va-tools-menubar-editor-title-text"></div>' +
            '   </div>' +
            '   <div class="brtc-va-tools-menubar-editor-close-button"></div>' +
            '</li>');
        this.$mainControl.find('.brtc-va-tools-menubar-editor-tab.newmodel').before($template);
        this.setTabTemplateData($template, editorInput);
        this.createTabCloseHandler($template.find('.brtc-va-tools-menubar-editor-close-button'));
        this.createTabClickHandler($template);
    };

    EditorTab.prototype.setTabTemplateData = function ($target, editorInput) {
        var pid = this.getIdFromEditorInput(editorInput).pid;
        var fid = this.getIdFromEditorInput(editorInput).fid;

        var label = editorInput.getLabel();
        var type = editorInput.getContents().type;

        $target.data({ 'pid': pid, 'fid': fid });
        $target.find('.brtc-va-tools-menubar-editor-title-icon').addClass(type);
        $target.find('.brtc-va-tools-menubar-editor-title-text').text(label);
        $target.attr('title', label);
    };

    EditorTab.prototype.createTabCloseHandler = function ($control) {
        $control.on('click', this.handleTabClosed.bind(this));
    };

    EditorTab.prototype.getTabTemplateFromEventTarget = function (event) {
        var $tabTemplate;
        if ($(event.target).hasClass('brtc-va-tools-menubar-editor-tab')) {
            $tabTemplate = $(event.target);
        } else {
            $tabTemplate = $(event.target).parents('.brtc-va-tools-menubar-editor-tab');
        }
        return $tabTemplate;
    };

    EditorTab.prototype.handleTabClosed = function (event) {
        var $tabTemplate = this.getTabTemplateFromEventTarget(event);
        var pid = $tabTemplate.data('pid');
        var fid = $tabTemplate.data('fid');

        // TODO 여기 해결 필요.
        Studio.getLayoutManager().closeEditor(this.getEditorInput(pid, fid));
        event.stopPropagation();
    };

    EditorTab.prototype.createTabClickHandler = function ($control) {
        $control.on('click', this.handleTabClicked.bind(this));
    };

    EditorTab.prototype.handleTabClicked = function (event) {
        var $tabTemplate = this.getTabTemplateFromEventTarget(event);
        var pid = $tabTemplate.data('pid');
        var fid = $tabTemplate.data('fid');

        // TODO 여기 해결 필요.
        Studio.getLayoutManager().openEditor(this.getEditorInput(pid, fid));
    };

    EditorTab.prototype.getIdFromEditorInput = function (editorInput) {
        return {
            pid: editorInput.getProjectId(),
            fid: editorInput.getFileId()
        };
    };

    EditorTab.prototype.getEditorInput = function (projectId, fileId) {
        return Studio.getResourceManager().getFile(projectId, fileId);
    };

    Brightics.VA.Core.Views.EditorTab = EditorTab;
}).call(this);

/**
 * Created by gy84.bae on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function FuncProperties(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();
    }

    FuncProperties.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    FuncProperties.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-views-funcproperties brtc-va-tab-contents brtc-style-tab-content">' +
            '</div>');
        this.$parent.append(this.$mainControl);
    };

    FuncProperties.prototype.selectionChanged = function (fnUnit) {
        if (this.propertiesPanel) {
            this.propertiesPanel.destroy();
        }

        this.empty();

        if (fnUnit && fnUnit.length > 0) {
            this.propertiesPanel = this.options.panelFactory.createPropertiesPanel(this.$mainControl, {
                width: '100%',
                height: '100%',
                fnUnit: fnUnit[0]
            });
        }
    };

    FuncProperties.prototype.empty = function () {
        this.$mainControl.empty();
    };

    Brightics.VA.Core.Views.FuncProperties = FuncProperties;

}).call(this);
/**
 * Created by daewon.park on 2016-09-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var SCALE = .5;

    var IN_PORT_ID = 'in-left';
    var OUT_PORT_ID = 'out-right';
    var IN_PORT = {
        id: IN_PORT_ID,
        group: 'in:l',
        args: {},
        markup: '<circle class="fnunit-port" r="0"/>',
    };
    var OUT_PORT = {
        id: OUT_PORT_ID,
        group: 'out:r',
        args: {},
        markup: '<circle class="fnunit-port" r="0"/>',
    };

    function LibraryExplorer(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.templates = [];
        this.retrieveParent();
        this.createControls();
    }

    LibraryExplorer.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    LibraryExplorer.prototype.createControls = function () {
        var _this = this;

        this.$mainControl = $('' +
            '<div class="brtc-va-views-library brtc-va-tab-contents">' +
            '   <div class="brtc-va-views-library-group">' +
            '       <div class="brtc-va-views-library-group-selector"></div>' +
            '   </div>' +
            '   <div class="brtc-va-views-library-separator"></div>' +
            '   <div class="brtc-va-views-library-totalcount"><span>Total</span><span>0</span></div>' +
            '   <div class="brtc-va-views-library-container"></div>' +
            '   <div class="brtc-va-views-library-template-ctxmenu">' +
            '       <ul>' +
            '           <li action="edit">Edit</li>' +
            '           <li action="delete">Delete</li>' +
            '       </ul>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$mainControl.find('.brtc-va-views-library-container').perfectScrollbar();

        var source =
            {
                datatype: 'json',
                datafields: [
                    {name: 'id'},
                    {name: 'label'}
                ],
                url: 'api/va/v2/ws/libraries',
                async: true
            };
        var dataAdapter = new $.jqx.dataAdapter(source);
        this.$librarySelector = this.$parent.find('.brtc-va-views-library-group-selector').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            source: dataAdapter,
            displayMember: 'label',
            valueMember: 'id',
            placeHolder: 'Choose Template',
            width: '100%',
            // width: 'calc(100% - 20px)',
            height: '30px',
            itemHeight: 30
        });
        this.$librarySelector.on('select', function (event) {
            _this.fillTemplates(event.args.item.value);
        });

        this.$ctxMenu = this.$mainControl.find('.brtc-va-views-library-template-ctxmenu').jqxMenu({
            theme: Brightics.VA.Env.Theme,
            width: '140px',
            height: '150px',
            autoOpenPopup: false,
            mode: 'popup',
            animationHideDuration: 0,
            animationShowDuration: 0
        });
        this.$ctxMenu.on('itemclick', function (event) {
            var $el = $(event.args);
            var libraryId = $el.closest('.brtc-va-views-library-template-ctxmenu').attr('library-id');
            var templateId = $el.closest('.brtc-va-views-library-template-ctxmenu').attr('template-id');
            if ($el.attr('action') == 'edit') {
                _this.editTemplate(libraryId, templateId);
            }
            else if ($el.attr('action') == 'delete') {
                _this.deleteTemplate(libraryId, templateId);
            }
        });
    };

    LibraryExplorer.prototype.activate = function () {
        var item = this.$librarySelector.jqxDropDownList('getSelectedItem');
        if (item) {
            // 선택된 라이브러리가 있으므로 그냥 진행
        } else {
            // 선택된 라이브러리가 없으므로 첫번째 라이브러리 선택
            var items = this.$librarySelector.jqxDropDownList('getItems');
            if (items && items.length > 0) {
                this.selectLibrary(items[0].value);
            }
        }
    };

    LibraryExplorer.prototype.editTemplate = function (libraryId, templateId) {
        var _this = this;
        new Brightics.VA.Core.Dialogs.EditResourceDialog(this.$mainControl, {
            title: 'Edit Template',
            label: _this.templates[templateId].label,
            description: _this.templates[templateId].description,
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    var opt = {
                        url: 'api/va/v2/ws/libraries/' + libraryId + '/templates/' + templateId + '/update',
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        data: JSON.stringify({
                            label: dialogResult.label,
                            description: dialogResult.description
                        }),
                        blocking: true
                    };
                    $.ajax(opt).done(function (result) {
                        _this.selectLibrary(libraryId);
                    }).fail(function (error) {
                        Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
                    });
                }
            }
        });
    };

    LibraryExplorer.prototype.deleteTemplate = function (libraryId, templateId) {
        var _this = this;
        Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog('Are you sure you want to delete ?', function (dialogResult) {
            if (dialogResult.OK) {
                var opt = {
                    url: 'api/va/v2/ws/libraries/' + libraryId + '/templates/' + templateId + '/delete',
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    blocking: true
                };
                $.ajax(opt).done(function (result) {
                    _this.selectLibrary(libraryId);
                }).fail(function (error) {
                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
                });
            }
        });
    };

    LibraryExplorer.prototype.selectLibrary = function (libraryId) {
        var item = this.$librarySelector.jqxDropDownList('getSelectedItem');
        if (item && item.value == libraryId) {
            this.fillTemplates(libraryId);
        } else {
            var items = this.$librarySelector.jqxDropDownList('getItems');
            for (var i in items) {
                if (items[i].value == libraryId) {
                    this.$librarySelector.jqxDropDownList('selectItem', items[i]);
                    break;
                }
            }
        }
    };

    LibraryExplorer.prototype.appendTemplate = function (template) {
        var _this = this;
        template.id = Brightics.VA.Core.Utils.IDGenerator.template.id();
        var opt = {
            url: 'api/va/v2/ws/libraries/' + template.library_id + '/templates',
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(template),
            blocking: true
        };
        $.ajax(opt).done(function (result) {
            var item = _this.$librarySelector.jqxDropDownList('getSelectedItem');
            if (item && item.value == template.library_id) {
                _this.fillTemplates(template.library_id);
            }
        }).fail(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        });
    };

    LibraryExplorer.prototype.fillTemplates = function (libraryId) {
        var _this = this;
        var opt = {
            url: 'api/va/v2/ws/libraries/' + libraryId + '/templates',
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            blocking: true
        };
        $.ajax(opt).done(function (templates) {
            _this.$mainControl.find('.brtc-va-views-library-container').empty();
            _this.$mainControl.find('.brtc-va-views-library-totalcount > span:nth-child(2)').text('0');
            _this.templates = {};

            templates.sort(function (a, b) {
                if (a.label.toLowerCase() < b.label.toLowerCase()) return -1;
                if (a.label.toLowerCase() > b.label.toLowerCase()) return 1;
                return 0;
            });
            _this.$mainControl.find('.brtc-va-views-library-totalcount > span:nth-child(2)').text(templates.length);
            for (var i in templates) {
                _this._addTemplate(templates[i]);
                _this.templates[templates[i].id] = templates[i];
            }
        }).fail(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        });
    };

    LibraryExplorer.prototype._addTemplate = function (template) {
        var _this = this;
        var $item = $('' +
            '<div class="brtc-va-views-library-template">' +
            '   <div class="brtc-va-views-library-template-label brtc-va-studio-dm-draggable">GalaxyS7 Preprocessing</div>' +
            '   <div class="brtc-va-views-library-template-author"><span>Created on </span><span></span><span> by </span><span></span></div>' +
            '   <div class="brtc-va-views-library-template-edit"></div>' +
            '   <div class="brtc-va-views-library-template-preview"></div>' +
            '</div>');

        this.$mainControl.find('.brtc-va-views-library-container').append($item);

        $item.find('.brtc-va-views-library-template-label').text(template.label);
        // $item.find('.brtc-va-views-library-template-label').attr('title', Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(template.label));
        $item.find('.brtc-va-views-library-template-label').attr('title', template.label);
        $item.find('.brtc-va-views-library-template-author > span:nth-child(2)').text(moment(template.create_time).format('YYYY-MM-DD HH:mm'));
        $item.find('.brtc-va-views-library-template-author > span:nth-child(4)').text(template.creator);

        $item.find('.brtc-va-views-library-template-edit').click(function () {
            var left = $(this).offset().left + $(this).width() - 140 - 2;
            var top = $(this).offset().top + $(this).height();
            _this.$ctxMenu.attr('library-id', template.library_id);
            _this.$ctxMenu.attr('template-id', template.id);
            _this.$ctxMenu.jqxMenu('open', left, top);
        });

        var $paperElement = $item.find('.brtc-va-views-library-template-preview');

        var graph = new joint.dia.Graph();
        var paper = new joint.dia.Paper({
            el: $paperElement,
            width: '100%',
            height: 'calc(100% - 53px)',
            model: graph,
            theme: 'none',
            interactive: false
        });
        paper.$el.css('pointer-events', 'none');
        paper.scale(SCALE);

        var i;
        for (i in template.contents.functions) {
            var figure = this._createFnUnitFigure(template.contents.functions[i]);
            graph.addCells([figure]);
        }
        for (i in template.contents.links) {
            var link = this._createLinkFigure(graph, template.contents.links[i]);
            graph.addCells([link]);
        }
        var links = graph.getLinks();
        $.each(links, function (index, link) {
            link.toBack();
        });

        this._draggableTemplate($item, template.contents);

        return $item;
    };

    LibraryExplorer.prototype._draggableTemplate = function ($template, contents) {
        var _this = this;
        $template.find('.brtc-va-views-library-template-label').draggable({
            appendTo: 'body',
            scroll: false,
            cursor: 'move',
            cursorAt: {left: 5, top: 5},
            helper: function (event) {
                var $helper = $template.clone();
                $helper.css({width: 410, background: '#FFFFFF', 'z-index': 5100});
                var cloned = Brightics.VA.Core.Utils.ModelUtils.cloneModel(contents);
                Brightics.VA.Core.Utils.WidgetUtils.putData($helper, 'template', cloned);
                Brightics.VA.Core.Utils.WidgetUtils.putData($helper, 'source', _this);
                return $helper;
            },
            start: function (event, ui) {
                $('.brtc-va-studio').addClass('brtc-va-studio-dragging');

                $(this).draggable('option', 'cursorAt', {
                    left: Math.floor(ui.helper.width() / 2),
                    top: Math.floor(ui.helper.height() / 2)
                });
            },
            drag: function (event, ui) {
                ui.helper.trigger('feedback', [{clientX: event.clientX, clientY: event.clientY}]);
            },
            stop: function (event, ui) {
                $('.brtc-va-studio').removeClass('brtc-va-studio-dragging');
            }
        });
    };

    LibraryExplorer.prototype._createFnUnitFigure = function (fnUnit) {
        fnUnit.display.diagram.position.x += Brightics.VA.Env.Diagram.PAPER_MARGIN_LEFT;
        fnUnit.display.diagram.position.y += Brightics.VA.Env.Diagram.PAPER_MARGIN_TOP;

        var figure = new Brightics.VA.Core.Shapes.FnUnitFigure({
            position: fnUnit.display.diagram.position,
            size: {
                width: Brightics.VA.Env.Diagram.FIGURE_WIDTH,
                height: Brightics.VA.Env.Diagram.FIGURE_HEIGHT
            },
            fid: fnUnit.fid,
            ports: {
                groups: {
                    'in:l': {
                        position: {
                            name: 'left',
                        },
                        attrs: {
                            '.fnunit-port': {
                                stroke: 'red'
                            }
                        }
                    },
                    'out:r': {
                        position: {
                            name: 'right',
                        },
                        attrs: {
                            '.fnunit-port': {
                                stroke: 'blue'
                            }
                        }
                    }
                },
                items: [IN_PORT, OUT_PORT]
            }
        });

        figure.label(fnUnit.display.label, SCALE);

        var clazz = this.options.modelType;
        var funcDef = Brightics.VA.Core.Interface.Functions[clazz][fnUnit.func];
        if (funcDef) {
            figure.tooltip(fnUnit.display.label + ' (' + funcDef.defaultFnUnit.display.label + ')');
            figure.category(funcDef);
        }

        return figure;
    };

    LibraryExplorer.prototype._createLinkFigure = function (graph, linkUnit) {
        var sourceFigure = this.getFigureByFnUnitId(graph, linkUnit[SOURCE_FID]);
        var targetFigure = this.getFigureByFnUnitId(graph, linkUnit[TARGET_FID]);
        return new Brightics.VA.Core.Shapes.LinkFigure({
            kid: linkUnit.kid,
            source: {
                id: sourceFigure.id,
                port: OUT_PORT_ID
            },
            target: {
                id: targetFigure.id,
                port: IN_PORT_ID
            }
        });
    };

    LibraryExplorer.prototype.getFigureByFnUnitId = function (graph, fid) {
        var figures = graph.getElements();
        for (var i in figures) {
            if (figures[i].attributes.fid === fid) {
                return figures[i];
            }
        }
    };

    LibraryExplorer.prototype.refresh = function () {
        var libraryId = this.getSelectedLibraryId();
        if (libraryId) this.fillTemplates(libraryId);
    };

    LibraryExplorer.prototype.getSelectedLibraryId = function () {
        return this.$librarySelector.val();
    };

    LibraryExplorer.prototype.destroy = function () {
        this.$librarySelector.jqxDropDownList('destroy');
        this.$ctxMenu.jqxMenu('destroy');
    };

    Brightics.VA.Core.Views.LibraryExplorer = LibraryExplorer;

}).call(this);
/* -----------------------------------------------------
 *  outline.js
 *  Created by hyunseok.oh@samsung.com on 2018-07-11.
 * ---------------------------------------------------- */


/* global crel */
(function (root) {
    'use strict';

    var Brightics = root.Brightics;

    var DOUBLE_CLICK_TIME = 500;
    
    var assert = function (x) {
        if (_.isUndefined(x)) throw new Error('ASSERT');
    };

    function Outline(options) {
        assert(options.$parent);
        assert(options.projectId);
        assert(options.model);

        var self = this;

        self.$parent = options.$parent;
        self.projectId = options.projectId;
        self.model = options.model;
        self.editor = options.editor;

        self.view = (function ($parent) {
            var $el = $(
                crel('div', {class: 'flow-outline-wrapper', style: 'height: 100%;'},
                    crel('div', {class: 'flow-outline-button-wrapper'}),
                    crel('div', {class: 'flow-outline', style: 'box-sizing: border-box;'}),
                    crel('div', {class: 'flow-outline-error'})
                )
            );

            var $tree = $el.find('.flow-outline').jqxTree({
                width: '100%',
                height: '100%',
                source: [],
                theme: Brightics.VA.Env.Theme,
                allowDrag: false,
                allowDrop: false,
                toggleMode: 'x'
            });

            var $errorBox = $el.find('.flow-outline-error');

            $parent.append($el);

            var $expandAllBtn = $(crel('button', {class: 'flow-outline-expand-all-btn'},
                'Expand All')).jqxButton({theme: Brightics.VA.Env.Theme});
            var $collapseAllBtn = $(crel('button', {class: 'flow-outline-collapse-all-btn'},
                'Collapse All')).jqxButton({theme: Brightics.VA.Env.Theme});

            $el.find('.flow-outline-button-wrapper').append($collapseAllBtn, $expandAllBtn);

            var last = 0;
            var lastId = -1;
            var disabled = false;

            var bind = {
                doubleClickItem: function (handler) {
                    $tree.on('itemClick', function (evt) {
                        if (disabled) return;
                        var cur = Date.now();
                        var curId = evt.args.element.id;

                        if (lastId === curId && cur - last <= DOUBLE_CLICK_TIME) {
                            evt.stopPropagation();
                            last = 0;
                            lastId = -1;
                            handler(evt.args.element.id);
                        } else {
                            lastId = curId;
                            last = cur;
                        }
                    });
                },
                clickExpandAll: function (handler) {
                    $expandAllBtn.on('click', function (evt) {
                        handler();
                    });
                },
                clickCollapseAll: function (handler) {
                    $collapseAllBtn.on('click', function (evt) {
                        handler();
                    });
                }
            };

            var render = {
                error: function (err) {
                    $tree.jqxTree({disabled: true});
                    disabled = true;
                    $errorBox.html(err.message);
                    $el.addClass('error');
                },
                all: function () {
                    var data = self.getData();
                    self.source = data;
                    $tree.jqxTree({source: data, disabled: false});
                    disabled = false;
                    $el.removeClass('error');
                },
                underline: function (id) {
                    var prevElement = $tree.find('.underline');
                    if (prevElement) {
                        prevElement.removeClass('underline');
                    }
                    if (!id) return;
                    var li = $tree.find('#' + id);
                    if (li) {
                        li.children(0).children(0).addClass('underline');
                    }
                },
                navigate: function () {

                },
                expandAll: function () {
                    $tree.jqxTree('expandAll');
                },
                collapseAll: function () {
                    $tree.jqxTree('collapseAll');
                },
                status: function (args) {
                    var editor = Studio.getEditorContainer().getActiveModelEditor();
                    var id = args.fid;
                    var status = args.status;

                    if (!id) return;
                    var li = $tree.find('#' + id);
                    if (li) {
                        $(li).find('.item-status').attr('status', status);
                        editor.showStatus(id, $(li).find('.item-status'));
                    }
                },
            };

            return {
                bind: bind,
                render: render
            };
        }(self.$parent));

        self.view.bind.doubleClickItem(function (id) {
            self.onDoubleClickItem(id);
        });
        self.view.bind.clickExpandAll(function () {
            self.view.render.expandAll();
        });
        self.view.bind.clickCollapseAll(function () {
            self.view.render.collapseAll();
        });

        self.refresh();
    }

    Outline.prototype.onDoubleClickItem = function () {
        throw new Error('not implemented');
    };

    Outline.prototype.getData = function () {
        throw new Error('not implemented');
    };

    Outline.prototype.getProjectId = function () {
        return this.getEditor().getEditorInput().getProjectId();
    };

    Outline.prototype.refresh = function (target, args) {
        try {
            if (target) {
                this.view.render[target](args);
            } else {
                this.view.render.all();
            }
        } catch (e) {
            this.view.render.error(e);
        }
    };

    Brightics.VA.Core.Views.Outline = Outline;
/* eslint-disable no-invalid-this */
}(this));

/**
 * Created by gy84.bae on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function Palette(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.retrieveParent();
        this.createControls();

        this.functionsList = [];
    }

    Palette.prototype.retrieveParent = function () {
        this.$parent = Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    Palette.prototype.createControls = function () {
        var _this = this;

        this.$mainControl = $('' +
            '<div class="brtc-va-views-palette brtc-va-tab-contents brtc-style-tab-content">' +
            '   <div class="brtc-va-views-palette-context brtc-va-contextarea"></div>' +
            '   <div class="brtc-va-views-palette-filter brtc-va-searcharea brtc-style-search-area"></div>' +
            '   <div class="brtc-va-views-palette-navigator-wrapper  brtc-va-contentsarea">' +
            '       <div class="brtc-va-views-palette-navigator"></div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$context = this.$mainControl.find('.brtc-va-views-palette-context');
        this.$filter = this.$mainControl.find('.brtc-va-views-palette-filter');
        this.$navigator = this.$mainControl.find('.brtc-va-views-palette-navigator');

        this.createFilterControl();
        this.createNavigatorControl();
        
        this.$mainControl.find('.brtc-va-views-palette-navigator-wrapper').perfectScrollbar();
    };

    Palette.prototype.applyFilter = function (val, expand = true) {
        var _this = this;
        var filterValue = val;

        var containers = _this.$mainControl.find('.brtc-va-views-palette-fnunit-list');
        var tabs = _this.$mainControl.find('div[role="tab"]');
        if (expand) {
            $.each(containers, function (index, container) {
                _this.$navigator.jqxNavigationBar('expandAt', index);
            });
        }

        var matchedList = Brightics.VA.Core.Functions.Library.getListByTags([filterValue.trim()]);
        var paletteItems = _this.$mainControl.find('.brtc-va-views-palette-fnunit');
        $.each(paletteItems, function (index, item) {
            var $funcElement = $(item).parent();
            var funcName = Utils.WidgetUtils.getData($funcElement.find('.brtc-va-views-palette-fnunit'), 'func');
            $funcElement.css('display', $.inArray(funcName, matchedList) > -1 ? 'block' : 'none');
        });

        containers = _this.$mainControl.find('.brtc-va-views-palette-fnunit-list');
        var expandedIndexes = _this.$navigator.jqxNavigationBar('expandedIndexes');
        $.each(containers, function (index, container) {
            var visibleElements = $(container).find('.brtc-va-views-palette-fnunit-content').filter(function () {
                return $(this).css('display') == 'block';
            });
            var expanded = expandedIndexes.indexOf(index) >= 0;
            var title = $(tabs[index]).find('.brtc-va-views-palette-fnunit-type');
            title = title && title.length > 0 ? $($(tabs[index]).find('.brtc-va-views-palette-fnunit-type')[0]).text() : ''
            if ( title.trim() === 'UDF') return;
            $(container).css('display', expanded && visibleElements.length > 0 ? 'block' : 'none');
            $(container).prev().css('display', visibleElements.length > 0 ? 'block' : 'none');
        });

        _this.$mainControl.find('.brtc-va-views-palette-navigator-wrapper').perfectScrollbar('update');
    };

    Palette.prototype.getContextList = function () {
        var rt = [];
        var passCategory = ['control', 'process', 'deeplearning', 'opt', 'ad'];

        _.forEach(this.functionsList, function ($fn) {
            var context = $fn.attr('context');
            var category = $fn.attr('category');
            if (_.isEmpty(context) ||
                _.indexOf(passCategory, category) > -1) return;
            rt = _.union(rt, [context]);
        })

        return rt;
    };

    Palette.prototype.createContextControl = function () {
        //fix me or kill me
        if (this.getContextList().length < 2) return; 

        var _this = this;

        var $spark = $('<div class="brtc-va-views-palette-context-check-spark selected">Spark</div>');
        var $python = $('<div class="brtc-va-views-palette-context-check-python selected">Python</div>');
        
        this.$context.append($python).append($spark);

        $spark.click(function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
                _this.hideByContext('scala');
            } else {
                $(this).addClass('selected');
                _this.showByContext('scala');
            }
            
        });

        $python.click(function () {
            if ($(this).hasClass('selected')) {
                $(this).removeClass('selected');
                _this.hideByContext('python');
            } else {
                $(this).addClass('selected');
                _this.showByContext('python');
            }
        });
    };

    Palette.prototype.showByContext = function (context) {
        _.forEach(this.functionsList, function ($fn) {
            if (_.isEqual(context, $fn.attr('context')) &&
                !_.isEqual('none', $fn.attr('title')))
                $fn.removeClass('brtc-style-display-none-important')
                    .addClass('brtc-style-display-flex-important');
        })
    };

    Palette.prototype.hideByContext = function (context) {
        var passCategory = ['control', 'process', 'deeplearning', 'opt', 'ad'];

        _.forEach(this.functionsList, function ($fn) {
            if (_.isEqual(context, $fn.attr('context')) &&
                _.indexOf(passCategory, $fn.attr('category')) == -1)
                $fn.removeClass('brtc-style-display-flex-important')
                    .addClass('brtc-style-display-none-important');
        })
    };

    Palette.prototype.createFilterControl = function () {
        var _this = this;

        var $filterInput = $('<input type="search" class="brtc-va-views-palette-filter-input searchinput"/>');
        this.$filter.append($filterInput);

        this.$filterInput = $filterInput;

        $filterInput.jqxInput({
            placeHolder: 'Search Item',
            theme: Brightics.VA.Env.Theme
        });
        $filterInput.keyup(function (event) {
            _this.applyFilter(event.target.value.toLowerCase());
        });

        $filterInput.on('search', function () {
            _this.applyFilter(event.target.value.toLowerCase());
        });
    };

    Palette.prototype.createNavigatorControl = function () {
        var _this = this;
        var initNavigator = function () {
            var option = {
                url: 'api/va/v2/studio/palette/' + _this.options.modelType,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                blocking: false
            };
            $.ajax(option).done(function (data) {
                if (_this.options.additionalGroup) data.push(_this.options.additionalGroup);

                var modelType;

                if (_this.options.modelType === 'data') modelType = 'DataFlow';
                else if (_this.options.modelType === 'deeplearning') modelType = 'DeepLearning';
                else if (_this.options.modelType === 'script') modelType = 'Script';
                else if (_this.options.modelType === 'control') modelType = 'ControlFlow';

                var functions = Brightics.VA.Implementation[modelType].Functions;

                if (modelType !== 'Script') {
                    for (var f in functions) {
                        if (!functions[f].defaultFnUnit) continue;

                        var func = functions[f].defaultFnUnit.func;
                        var category = functions[f].category;

                        if (category === 'bigdata') continue;

                        var exist = false;
                        var obj = {func: func, visible: true};

                        for (var c in data) {
                            if (data[c].key === category) {
                                for (var k in data[c].functions) {
                                    var fnUnit = data[c].functions[k];
                                    if (fnUnit.func === func) {
                                        exist = true;
                                        break;
                                    }
                                }
                                if (!exist && category !== 'udf') data[c].functions.push(obj);
                            }
                        }
                    }
                }

                data = _this.createFunctions(data);

                _this.createContextControl();

                if (_this.options.draggable) _this.draggablePalette();
                var opt = {
                    theme: Brightics.VA.Env.Theme,
                    expandMode: 'multiple',
                    expandedIndexes: [],
                    width: '100%'
                    // width: 'calc(100% - 20px)'
                };
                for (var idx in data) {
                    opt.expandedIndexes.push(parseInt(idx, 10));
                }
                _this.$navigator.jqxNavigationBar(opt);

                _this.$navigator.on('collapsedItem', function (event) {
                    _this.$mainControl.find('.ps-container').perfectScrollbar('update');
                });
                _this.$navigator.on('expandedItem', function (event) {
                    _this.$mainControl.find('.ps-container').perfectScrollbar('update');
                });

            });
        }.bind(this);
        initNavigator();
    };

    Palette.prototype.makeHeaderButton = function ($parent) {
        var _this = this;
        var $udfButtonControl = $('' +
            '   <div class="brtc-va-views-palette-header-button">' +
            '       <button class="brtc-va-controls-palette-create"><div class="brtc-va-icon"></div>Create UDF</button>' +
            '       <button class="brtc-va-controls-palette-import"><div class="brtc-va-icon"></div>Import UDF</button>' +
            '   </div>');

        $parent.append($udfButtonControl);
        var $createUDFButton = $udfButtonControl.find('.brtc-va-controls-palette-create')
        var $importUDFButton = $udfButtonControl.find('.brtc-va-controls-palette-import')

        $createUDFButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        })

        $createUDFButton.on('click', function () {
            var toolKitUrl = window.location.origin + '/toolkit/udf-generator/spec-generator';
            window.open(toolKitUrl, 'Brightics ToolKit')
        })

        $importUDFButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        })

        $importUDFButton.on('click', function () {
            // import Dialog 생성
            new Brightics.VA.Core.Dialogs.ImportUDFDialog(_this.$mainControl, {
                fileType: 'AddonFunction',
                title: 'Import UDF',
                close: function (result) {
                    if (result.OK) {
                        Utils.WidgetUtils.openInformationDialog('Imported successfully new UDF');
                        _this.refreshControl();
                    }
                    else {
                    }
                }
            });
        })
    };

    Palette.prototype.appendFunction = function (funcGroup) {
        var _this = this;
        var $functionListControl = $('<div class = "brtc-va-views-palette-fnunit-list"></div>');

        if (funcGroup && funcGroup.key === 'udf') { // udf func list 일때 --> button control 추가.
            this.makeHeaderButton($functionListControl);
        }
        var functions = funcGroup.functions.sort(function (a, b) {
            var aFnUnitDef = Brightics.VA.Core.Interface.Functions[_this.options.modelType][a.func];
            var aDefaultFnUnit = aFnUnitDef ? aFnUnitDef.defaultFnUnit : undefined;
            var aValue = aDefaultFnUnit ? (aDefaultFnUnit.context === 'python' ? 1 : -1) : 1;

            var bFnUnitDef = Brightics.VA.Core.Interface.Functions[_this.options.modelType][b.func];
            var bDefaultFnUnit = bFnUnitDef ? bFnUnitDef.defaultFnUnit : undefined;
            var bValue = bDefaultFnUnit ? (bDefaultFnUnit.context === 'python' ? 1 : -1) : 1;

            return aValue - bValue;
        });

        if (funcGroup && funcGroup.key === 'udf') {
            functions.forEach(function (funcItem, index) {
                if (funcItem.visible) {
                    var clazz = _this.options.modelType
                    var closeCallBack = (function (index, item) {
                        return function (dialogResult) {
                            if (dialogResult.OK) {
                                //DELETE UDF
                                var udfid = item && item.func ? item.func : '';
                                $.ajax({
                                    url: 'api/va/v3/ws/udfs/' + udfid,
                                    type: 'DELETE',
                                    contentType: 'application/json; charset=utf-8',
                                    blocking: true
                                }).done(function (data) {
                                    if (data === 'OK') {
                                        _this.refreshControl();
                                        if (udfid === '') Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Sorry! UDF has been Deleted. Try again.');
                                        else {
                                            delete Brightics.VA.Core.Interface.Functions[clazz][udfid];
                                            _this.options.editor.diagramEditorPage.render();
                                            _this.options.editor.resetSheetEditorPage();
                                        }
                                    }
                                }).fail(function (err) {
                                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                                });
                            }
                        };
                    }(index, funcItem));
                    var clazz = _this.options.modelType;
                    if(funcItem.deletable)
                        Utils.WidgetUtils.createPaletteUDFItem($functionListControl, funcItem.func, clazz, closeCallBack);
                    else
                        Utils.WidgetUtils.createPaletteItem($functionListControl, funcItem.func, clazz);
                }
            });
        } else {
            $.each(functions, function (index, funcItem) {
                if (funcItem.visible) {
                    var clazz = _this.options.modelType;
                    var $item = Utils.WidgetUtils.createPaletteItem($functionListControl, funcItem.func, clazz);
                    //kill me
                    if (!_.isEqual($item.attr('title'), 'none')) {
                        _this.functionsList.push($item);
                    }
                }
            });
        }

        var totalCount = $functionListControl.find('.brtc-va-views-palette-fnunit-content').length;
        var hiddenCount = $functionListControl.find('.brtc-va-views-palette-fnunit.brtc-va-fnunit-category-none').length;

        var $navBar = $('' +
            '<div>' +
            '   <div>' +
            '       <div class="brtc-va-views-palette-fnunit-type">' + Utils.WidgetUtils.convertHTMLSpecialChar(funcGroup.label) + '</div>' +
            '   </div>' +
            '</div>');
        if (funcGroup && funcGroup.key !== 'udf' &&
            totalCount === hiddenCount) {
            $navBar.addClass('brtc-va-palette-display-none');
            $functionListControl.addClass('brtc-va-palette-display-none');
        }

        // add header
        _this.$navigator.append($navBar);
        // add content
        _this.$navigator.append($functionListControl);
    };

    Palette.prototype.createFunctions = function (funcGroupList) {
        var _this = this;
        var visibleFuncGroupList = [];

        $.each(funcGroupList, function (index, funcGroup) {
            if (funcGroup.visible) {
                _this.appendFunction(funcGroup);
                visibleFuncGroupList.push(funcGroup);
            }
        });
        return visibleFuncGroupList;
    };

    Palette.prototype.draggablePalette = function () {
        var _this = this;

        this.$navigator.find(".brtc-va-views-palette-fnunit").each(function () {
            $(this).mouseover(function () {
                $(this).toggleClass('brtc-va-views-palette-fnunit-hover');
            }).mouseout(function () {
                $(this).toggleClass('brtc-va-views-palette-fnunit-hover');
            });

            _this._draggableFnUnit($(this));
        });
    };

    Palette.prototype._draggableFnUnit = function ($fnUnitElement) {
        var _this = this;
        $fnUnitElement.draggable({
            appendTo: 'body',
            scroll: false,
            cursor: 'move',
            cursorAt: {left: 5, top: 5},
            helper: function (event) {
                var $helper = $(this).clone();
                $helper.css({'z-index': 5100});

                var funcType = Utils.WidgetUtils.getData($fnUnitElement, 'func');
                var template = {
                    functions: [{func: funcType}],
                    links: []
                };
                Utils.WidgetUtils.putData($helper, 'template', template);
                Utils.WidgetUtils.putData($helper, 'source', _this);
                return $helper;
            },
            start: function (event, ui) {
                $('.brtc-va-studio').addClass('brtc-va-studio-dragging');

                $(this).draggable("option", "cursorAt", {
                    left: Math.floor(ui.helper.width() / 2),
                    top: Math.floor(ui.helper.height() / 2)
                });
            },
            drag: function (event, ui) {
                ui.helper.trigger('feedback', [{clientX: event.clientX, clientY: event.clientY}]);
            },
            stop: function (event, ui) {
                $('.brtc-va-studio').removeClass('brtc-va-studio-dragging');
            }
        });
    };

    Palette.prototype.udfChanged = function () {
        this.refreshControl();
    };

    Palette.prototype.refreshControl = function () {

        Studio.getInstance().reloadResource();
        var _this = this;
        var lastIndex = this.$navigator.find('.jqx-widget-header').length - 1;
        var header = this.$navigator.jqxNavigationBar('getHeaderContentAt', lastIndex);
        if ($(header).find('.brtc-va-views-palette-fnunit-type').text() === 'UDF') {
            var udfOpt = {
                url: 'api/va/v3/ws/udfs',
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                blocking: true
            };
            $.ajax(udfOpt).done(function (udfItems) {
                var _udfItems = udfItems
                var udfPalette = {
                    label: "UDF",
                    visible: true,
                    functions: []
                };
                for (var i in _udfItems) {
                    udfPalette.functions.push({
                        func: _udfItems[i].id,
                        visible: true,
                        deletable: _udfItems[i].creator === Brightics.VA.Env.Session.userId ? true : false
                    });
                }
                Utils.WidgetUtils.putUdfRef($(document.body), udfPalette.functions);
                var navigatorHeader = '<div>' +
                    '   <div>' +
                    '       <div class="brtc-va-views-palette-fnunit-type">' + Utils.WidgetUtils.convertHTMLSpecialChar(udfPalette.label) + '</div>' +
                    '   </div>' +
                    '</div>';
                _this.$navigator.jqxNavigationBar('update', lastIndex, navigatorHeader, '');
                var $functionListControl = _this.$navigator.find('.brtc-va-views-palette-fnunit-list').last();
                _this.makeHeaderButton($functionListControl);
                udfPalette.functions.forEach(function (funcItem, index) {
                    if (funcItem.visible) {
                        var clazz = _this.options.modelType;
                        var closeCallBack = (function (index, item) {
                            return function (dialogResult) {
                                if (dialogResult.OK) {
                                    //DELETE UDF
                                    var udfid = item && item.func ? item.func : '';
                                    $.ajax({
                                        url: 'api/va/v3/ws/udfs/' + udfid,
                                        type: 'DELETE',
                                        contentType: 'application/json; charset=utf-8',
                                        blocking: true
                                    }).done(function (data) {
                                        if (data === 'OK') {
                                            _this.refreshControl();
                                            if (udfid === '') Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Sorry! UDF has been Deleted! Try again');
                                            else {
                                                delete Brightics.VA.Core.Interface.Functions[clazz][udfid];
                                                _this.options.editor.diagramEditorPage.render();
                                                _this.options.editor.resetSheetEditorPage();
                                            }
                                        }
                                    }).fail(function (err) {
                                        Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                                    });
                                }
                            };
                        }(index, funcItem))
                        if (funcItem.deletable)
                            Utils.WidgetUtils.createPaletteUDFItem($functionListControl, funcItem.func, clazz, closeCallBack);
                        else
                            Utils.WidgetUtils.createPaletteItem($functionListControl, funcItem.func, clazz);
                    }
                });
                if (_this.options.draggable) _this.draggablePalette();
                $functionListControl.css('height', 'auto');
                $functionListControl.show();
                _this.applyFilter(_this.$filterInput.val().toLowerCase(), false);
                _this.$navigator.jqxNavigationBar('refresh');
                _this.$mainControl.find('.brtc-va-views-palette-navigator-wrapper').perfectScrollbar('update');
            });
        }
        else {
            this.$mainControl.remove();
            Utils.WidgetUtils.removeUdfRefData($(document.body));
            this.createControls();
            this.$mainControl.find('.brtc-va-views-palette-navigator-wrapper').perfectScrollbar('update');
        }
        this.$mainControl.find('.brtc-va-views-palette-navigator-wrapper').perfectScrollbar('update');
    };

    Palette.prototype.destroy = function () {
    };

    Brightics.VA.Core.Views.Palette = Palette;

}).call(this);

/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Parameters(parentId, options) {

        this.parentId = parentId;
        this.options = options || {};
        this.init();
        this.retrieveParent();
        this.createControls();
        this.renderValues();
    }

    Parameters.prototype.init = function () {
        var _this = this;

        this.isRendered = false;

        this.parameters = $.extend(true, this.parameters, this.options.modelContents.param);

        this.commandListener = function (command) {
            if (_this.isRendered) {
                _this.isRendered = false;
                _this.handleCommand(command);
                _this.isRendered = true;
            } else {
                _this.handleCommand(command);
            }
        };
    };

    Parameters.prototype.executeCommand = function (command) {
        if (this.isRendered) {
            this.activeEditor.getCommandManager().execute(command);
        }
    };

    Parameters.prototype.handleCommand = function (command) {
        if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.GoHistoryCommand) {
            for (var i in command.options.commands) {
                this.handleCommand(command.options.commands[i]);
            }
        }
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand) this.handleUpdateParameterCommand(command);
    };

    Parameters.prototype.editorChanged = function (editor) {
        if (editor) {
            if (this.activeEditor) {
                this.activeEditor.removeCommandListener(this.commandListener);
                this.activeEditor.removeGoHistoryListener(this.commandListener);
            }
            this.activeEditor = editor;

            this.activeEditor.addCommandListener(this.commandListener);
            this.activeEditor.addGoHistoryListener(this.commandListener);
        }
        else {
            this.activeEditor = null;
        }
    };

    Parameters.prototype.handleUpdateParameterCommand = function (command) {
        if (command.event.type === 'UNDO') {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand) {
                this.parameters = $.extend(true, {}, this.options.modelContents.param);
                this.renderValues();
            }
        } else if (command.event.type === 'REDO') {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand) {
                this.parameters = $.extend(true, {}, this.options.modelContents.param);
                this.renderValues();
            }
        } else {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand) {
                this.parameters = $.extend(true, {}, this.options.modelContents.param);
                // this.renderValues();
            }
        }
    };

    Parameters.prototype.createUpdateParametersCommand = function (key, val) {
        var command = new Brightics.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand(this.activeEditor, {
            name: key,
            ref: val
        });
        this.executeCommand(command);
    };

    Parameters.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    Parameters.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-views-parameters">' +
            '   <div class="brtc-va-views-parameters-wrapper"></div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.createLossControl();
        this.createMetricsControl();
        this.createBatchSizeControl();
        this.createEpochsControl();
        this.createStepsPerEpochControl();
        this.createValidationStepsControl();
        this.createOptimizerControl();

        this.createCheckPointGroupNameControl();

        this.$mainControl.find('.brtc-va-views-parameters-wrapper').perfectScrollbar();
    };

    Parameters.prototype.renderValues = function () {
        this.isRendered = false;

        this.renderLossControl();
        this.renderMetricsControl();
        this.renderBatchSizeControl();
        this.renderEpochsControl();
        this.renderStepsPerEpochControl();
        this.renderValidationStepsControl();
        this.renderOptimizerControl();

        this.renderCheckPointGroupNameControl();
        this.isRendered = true;
    };

    Parameters.prototype.createLossControl = function (label, callback, option) {
        var _this = this;

        this.LOSSTYPES = [
            {label: 'mean_squared_error', value: 'mean_squared_error'},
            {label: 'mean_absolute_error', value: 'mean_absolute_error'},
            {label: 'categorical_crossentropy', value: 'categorical_crossentropy'},
            {label: 'binary_crossentropy', value: 'binary_crossentropy'}
        ];


        this.$loss = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');

        this.addPropertyControl('Loss', function ($parent) {
            _this.createDropDownList(this.$loss, {
                source: _this.LOSSTYPES,
                displayMember: 'label',
                valueMember: 'value'
            });
            $parent.append(this.$loss.parent());
            _this.$loss.on('change', function () {
                _this.createUpdateParametersCommand('loss', $(this).val());
                _this.setParameter('loss', $(this).val());
            });
        });
    };
    Parameters.prototype.createMetricsControl = function (label, callback, option) {
        var _this = this;

        this.MATRICSTYPES = [
            {label: 'accuracy', value: 'accuracy'},
            {label: 'binary_accuracy', value: 'binary_accuracy'},
            {label: 'categorical_accuracy', value: 'categorical_accuracy'}
        ];

        this.$metrics = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');

        this.addPropertyControl('Metrics', function ($parent) {
            _this.createDropDownList(this.$metrics, {
                source: _this.MATRICSTYPES,
                displayMember: 'label',
                valueMember: 'value'
            });
            $parent.append(this.$metrics.parent());
            _this.$metrics.on('change', function () {
                _this.createUpdateParametersCommand('metrics', $(this).val());
                _this.setParameter('metrics', $(this).val());
            });
        });
    };
    Parameters.prototype.createBatchSizeControl = function (label, callback, option) {
        var _this = this;

        this.$batchSize = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');

        var batchSizeControl = this.addPropertyControl('Batch Size', function ($parent) {
            $parent.append(this.$batchSize);
            var jqxOptions = {
                numberType: 'int',
                min: 0,
                minus: false,
                placeholder: 'Default: 32'
            };
            _this.batchSizeControl = _this.createNumericInput(_this.$batchSize, jqxOptions);
            _this.batchSizeControl.onChange(function () {
                _this.createUpdateParametersCommand('batch_size', this.getValue());
                _this.setParameter('batch_size', this.getValue());
            });
        });
    };

    Parameters.prototype.createEpochsControl = function (label, callback, option) {
        var _this = this;

        this.$epochs = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');

        var epochsControl = this.addPropertyControl('Epochs', function ($parent) {
            $parent.append(this.$epochs);
            var jqxOptions = {
                numberType: 'int',
                min: 0,
                minus: false,
                placeholder: 'Default: 10'
            };
            _this.epochsControl = _this.createNumericInput(_this.$epochs, jqxOptions);
            _this.epochsControl.onChange(function () {
                _this.createUpdateParametersCommand('epochs', this.getValue());
                _this.setParameter('epochs', this.getValue());
            });
        });
    };

    Parameters.prototype.createStepsPerEpochControl = function (label, callback, option) {
        var _this = this;

        var $stepsPerEpochs = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');

        this.addPropertyControl('Steps Per Epoch', function ($parent) {
            $parent.append($stepsPerEpochs);
            var jqxOptions = {
                numberType: 'int',
                min: 0,
                minus: false,
                placeholder: 'Default: None'
            };
            _this.stepsPerEpochsControl = _this.createNumericInput($stepsPerEpochs, jqxOptions);
            _this.stepsPerEpochsControl.onChange(function () {
                _this.createUpdateParametersCommand('steps_per_epoch', this.getValue());
                _this.setParameter('steps_per_epoch', this.getValue());
            });
        });
    };

    Parameters.prototype.createValidationStepsControl = function (label, callback, option) {
        var _this = this;

        var $validationSteps = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');

        this.addPropertyControl('Validation Steps', function ($parent) {
            $parent.append($validationSteps);
            var jqxOptions = {
                numberType: 'int',
                min: 0,
                minus: false,
                placeholder: 'Default: None'
            };
            _this.validationStepsControl = _this.createNumericInput($validationSteps, jqxOptions);
            _this.validationStepsControl.onChange(function () {
                _this.createUpdateParametersCommand('validation_steps', this.getValue());
                _this.setParameter('validation_steps', this.getValue());
            });
        });
    };


    Parameters.prototype.createOptimizerControl = function (label, callback, option) {
        var _this = this;

        this.OPTIMIZERTYPES = [
            {label: 'SGD', value: 'sgd'},
            {label: 'RMSprop', value: 'rmsprop'},
            {label: 'Adadelta', value: 'adadelta'},
            {label: 'Adam', value: 'adam'},
            {label: 'Adamax', value: 'adamax'},
            {label: 'Nadam', value: 'nadam'}
        ];

        this.$optimizer = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');

        this.addPropertyControl('Optimizer', function ($parent) {
            _this.createDropDownList(this.$optimizer, {
                source: _this.OPTIMIZERTYPES,
                displayMember: 'label',
                valueMember: 'value'
            });
            $parent.append(this.$optimizer.parent());
            _this.$optimizer.on('change', function () {
                _this.createUpdateParametersCommand('optimizer', $(this).val());
                _this.setParameter('optimizer', $(this).val());
            });
        });
    };
    Parameters.prototype.createEvaluationControl = function (label, callback, option) {
        var _this = this;
        this.$evaluationTrueControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">True</div>');
        this.$evaluationFalseControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">False</div>');

        this.addPropertyControl('Evaluation', function ($parent) {
            $parent.append(this.$evaluationTrueControl).append(this.$evaluationFalseControl);
            _this.createRadioButton(_this.$evaluationTrueControl, {width: '80', groupName: 'evaluation'});
            _this.createRadioButton(_this.$evaluationFalseControl, {width: '80', groupName: 'evaluation'});
            _this.$evaluationTrueControl.on('checked', function () {
                _this.createUpdateParametersCommand('evaluation', true);
                _this.setParameter('evaluation', true);
            });
            _this.$evaluationFalseControl.on('checked', function () {
                _this.createUpdateParametersCommand('evaluation', false);
                _this.setParameter('evaluation', false);
            });
        });

        this.$evaluationTrueControl.jqxRadioButton('check');
    };
    Parameters.prototype.createExecutionControl = function (label, callback, option) {
        var _this = this;
        this.$executionTrueControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">True</div>');
        this.$executionFalseControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">False</div>');

        this.addPropertyControl('Execution', function ($parent) {
            $parent.append(this.$executionTrueControl).append(this.$executionFalseControl);
            _this.createRadioButton(_this.$executionTrueControl, {width: '80', groupName: 'execution'});
            _this.createRadioButton(_this.$executionFalseControl, {width: '80', groupName: 'execution'});
            _this.$executionTrueControl.on('checked', function () {
                _this.createUpdateParametersCommand('execution', true);
                _this.setParameter('execution', true);
            });
            _this.$executionFalseControl.on('checked', function () {
                _this.createUpdateParametersCommand('execution', false);
                _this.setParameter('execution', false);
            });
        });

        this.$executionTrueControl.jqxRadioButton('check');
    };

    Parameters.prototype.createTrainDataControl = function (label, callback, option) {
        var _this = this;

        this.$trainData = $('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>');

        this.addPropertyControl('Train Data', function ($parent) {
            $parent.append(_this.$trainData);
            _this.trainDataControl = _this.createInput(_this.$trainData, {
                height: '23px'
            }, '')
        });

        this.$trainData.on('change', function () {
            _this.createUpdateParametersCommand('train_data', $(this).val());
            _this.setParameter('train_data', $(this).val());
        });
    };
    Parameters.prototype.createTrainLabelControl = function (label, callback, option) {
        var _this = this;

        this.$trainLabel = $('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>');

        this.addPropertyControl('Train Label', function ($parent) {
            $parent.append(_this.$trainLabel);
            _this.trainLabelControl = _this.createInput(_this.$trainLabel, {
                height: '23px'
            }, '')
        });

        this.$trainLabel.on('change', function () {
            _this.createUpdateParametersCommand('train_label', $(this).val());
            _this.setParameter('train_label', $(this).val());
        });
    };
    Parameters.prototype.createTestDataControl = function (label, callback, option) {
        var _this = this;

        this.$testData = $('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>');

        this.addPropertyControl('Test Data', function ($parent) {
            $parent.append(_this.$testData);
            _this.testDataControl = _this.createInput(_this.$testData, {
                height: '23px'
            }, '')
        });

        this.$testData.on('change', function () {
            _this.createUpdateParametersCommand('test_data', $(this).val());
            _this.setParameter('test_data', $(this).val());
        });
    };
    Parameters.prototype.createTestLabelControl = function (label, callback, option) {
        var _this = this;

        this.$testLabel = $('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>');

        this.addPropertyControl('Test Label', function ($parent) {
            $parent.append(_this.$testLabel);
            _this.testLabelControl = _this.createInput(_this.$testLabel, {
                height: '23px'
            }, '')
        });

        this.$testLabel.on('change', function () {
            _this.createUpdateParametersCommand('test_label', $(this).val());
            _this.setParameter('test_label', $(this).val());
        });
    };

    Parameters.prototype.createCheckPointGroupNameControl = function (label, callback, option) {
        var _this = this;

        this.$checkPointGroupName = $('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>');

        this.addPropertyControl('Checkpoint Group Name', function ($parent) {
            $parent.append(_this.$checkPointGroupName);
            _this.checkPointGroupName = _this.createInput(_this.$checkPointGroupName, {
                height: '23px',
                placeHolder: 'Default: checkpoint'
            }, '')
        });

        this.$checkPointGroupName.on('change', function () {

            if (_this.parameters.checkPointGroupName === $(this).val()) return;

            _this.createUpdateParametersCommand('checkPointGroupName', $(this).val());
            _this.setParameter('checkPointGroupName', $(this).val());
        });
    };

    Parameters.prototype.renderLossControl = function () {
        this.$loss.val(this.parameters.loss);
    };
    Parameters.prototype.renderMetricsControl = function (label, callback, option) {
        this.$metrics.val(this.parameters.metrics);
    };
    Parameters.prototype.renderBatchSizeControl = function (label, callback, option) {
        this.batchSizeControl.setValue(this.parameters.batch_size);
    };
    Parameters.prototype.renderEpochsControl = function (label, callback, option) {
        this.epochsControl.setValue(this.parameters.epochs);
    };
    Parameters.prototype.renderStepsPerEpochControl = function (label, callback, option) {
        this.stepsPerEpochsControl.setValue(this.parameters.steps_per_epoch);
    };
    Parameters.prototype.renderValidationStepsControl = function (label, callback, option) {
        this.validationStepsControl.setValue(this.parameters.validation_steps);
    };

    Parameters.prototype.renderOptimizerControl = function (label, callback, option) {
        this.$optimizer.val(this.parameters.optimizer);
    };
    Parameters.prototype.renderEvaluationControl = function (label, callback, option) {
        var isChecked = this.$evaluationTrueControl.jqxRadioButton('checked');

        if (this.parameters.evaluation && !isChecked) {
            this.$evaluationTrueControl.jqxRadioButton('check');
        } else if (!this.parameters.evaluation && isChecked) {
            this.$evaluationFalseControl.jqxRadioButton('check');
        }
    };
    Parameters.prototype.renderExecutionControl = function (label, callback, option) {
        var isChecked = this.$executionTrueControl.jqxRadioButton('checked');

        if (this.parameters.execution && !isChecked) {
            this.$executionTrueControl.jqxRadioButton('check');
        } else if (!this.parameters.execution && isChecked) {
            this.$executionFalseControl.jqxRadioButton('check');
        }
    };

    Parameters.prototype.renderTrainDataControl = function (label, callback, option) {
        this.$trainData.val(this.parameters.train_data);
    };
    Parameters.prototype.renderTrainLabelControl = function (label, callback, option) {
        this.$trainLabel.val(this.parameters.train_label);
    };
    Parameters.prototype.renderTestDataControl = function (label, callback, option) {
        this.$testData.val(this.parameters.test_data);
    };
    Parameters.prototype.renderTestLabelControl = function (label, callback, option) {
        this.$testLabel.val(this.parameters.test_label);
    };
    Parameters.prototype.renderCheckPointGroupNameControl = function (label, callback, option) {
        this.$checkPointGroupName.val(this.parameters.checkPointGroupName);
    };

    Parameters.prototype.addPropertyControl = function (label, callback, option) {
        var _this = this,
            $propertyControl = $('' +
                '<div class="brtc-va-editors-sheet-controls-propertycontrol">' +
                '   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>' +
                '   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents">' +
                '</div>');

        this.$mainControl.find('.brtc-va-views-parameters-wrapper').append($propertyControl);

        $propertyControl.jqxExpander(
            {
                theme: Brightics.VA.Env.Theme,
                arrowPosition: "left",
                initContent: function () {
                    if (typeof  callback === 'function') {
                        callback.call(_this, $propertyControl.find(".brtc-va-editors-sheet-controls-propertycontrol-contents"), option);
                    }
                }
            });
        $propertyControl.jqxExpander('setHeaderContent', label);

        return $propertyControl;
    };

    Parameters.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');
        $control.wrap($wrapper);
    };

    Parameters.prototype.createDropDownList = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            enableBrowserBoundsDetection: true,
            animationType: 'none',
            width: '100%',
            height: '25px',
            openDelay: 0
        };
        if (jqxOptions) {
            if (jqxOptions.source && jqxOptions.source.length > 7) {
                options.autoDropDownHeight = false;
                options.dropDownHeight = 120
            } else {
                options.autoDropDownHeight = true;
            }
            $.extend(options, jqxOptions);
        }
        $control.jqxDropDownList(options);
        return $control;
    };

    Parameters.prototype.createNumericInput = function ($control, widgetOptions, className, additionalCss) {

        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        return new Brightics.VA.Core.Editors.Sheet.Controls.NumericInput($control, widgetOptions);
    };

    Parameters.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    Parameters.prototype.addCssToWrapper = function ($control, cssOptions) {
        if (cssOptions) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.css(cssOptions);
        }
    };

    Parameters.prototype.createRadioButton = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = 'brtc-va-editors-sheet-controls-radiobutton-default';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxRadioButton(options);
        return $control;
    };

    Parameters.prototype.createInput = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);

        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }

        if (!$control.attr('type'))$control.attr('type', 'text');
        if (!$control.attr('maxlength'))$control.attr('maxlength', '100');

        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            placeHolder: 'Enter value'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxInput(options);
        var preValue = $control.val();
        $control.focus(function () {
            preValue = $control.val();
        });
        $('svg').on('mousedown', function () {
            var value = $control.val();
            if (value !== preValue && $control.is(":focus")) {
                $control.trigger("change");
            }
        });

        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($control);
        return $control;
    };

    Parameters.prototype.setParameter = function (key, val) {
        this.parameters[key] = val;
    };

    Parameters.prototype.activate = function () {
        this.$mainControl.find('.brtc-va-views-parameters-wrapper').perfectScrollbar('update');
    };

    Brightics.VA.Core.Views.Parameters = Parameters;

}).call(this);
/**
 * Created by gy84.bae on 2016-04-11.
 */

/* global Studio, _, FUNCTION_NAME */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const modelTypeLabel = {
        data: 'Data Flow',
        script: 'Script',
        control: 'Control Flow',
        realtime: 'Real-time',
        visual: 'Report',
        deeplearning: 'Deep Learning',
        etl: 'ETL'
    };

    function ProjectViewer(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.chartContentAddedReport = {};

        this.retrieveParent();
        this.createControls();
        this.fillProjectList();
    }

    ProjectViewer.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ProjectViewer.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-workspace-project-container">' +
            '   <div class="brtc-va-workspace-project-container-contents"></div>' +
            '   <div class="brtc-va-workspace-project-container-ctxmenu">' +
            '       <ul>' +
            '           <li action="edit">Edit</li>' +
            '           <li action="delete">Delete</li>' +
            '           <li action="duplicate">Duplicate</li>' +
            '           <li type="separator"></li>' +
            '           <li action="export">Export</li>' +
            '           <li action="exportAsRunnable">Export as Runnable</li>' +
            '           <li action="deploy">Deploy</li>' +
            '           <li type="separator"></li>' +
            '           <li action="members">Member Management</li>' +
            '           <li action="version">Version Management</li>' +
            '       </ul>' +
            '   </div>' +
            '</div>');

        this.$parent.append(this.$mainControl);
        this.$contentsContainer = this.$mainControl.find('.brtc-va-workspace-project-container-contents');
        this.createContentsContainer(this.$contentsContainer);

        this.$ctxMenu = this.$mainControl.find('.brtc-va-workspace-project-container-ctxmenu').jqxMenu({
            theme: Brightics.VA.Env.Theme,
            width: '200px',
            height: '180px',
            autoOpenPopup: false,
            mode: 'popup',
            animationHideDuration: 0,
            animationShowDuration: 0
        });

        var _this = this;
        this.$ctxMenu.on('itemclick', _.debounce(function (event) {
            var $el = $(event.args);
            var menuType = $el.closest('.brtc-va-workspace-project-container-ctxmenu').attr('menu-type');
            var projectId = $el.closest('.brtc-va-workspace-project-container-ctxmenu').attr('project-id');
            var fileId = $el.closest('.brtc-va-workspace-project-container-ctxmenu').attr('file-id');
            if (menuType == 'file-edit') {
                if ($el.attr('action') == 'edit') {
                    _this.editFile(projectId, fileId);
                }
                if ($el.attr('action') == 'delete') {
                    _this.openDeleteConfirmDialog(projectId, fileId);
                }
                if ($el.attr('action') == 'duplicate') {
                    _this.openDuplicateModelDialog(projectId, fileId);
                }
                if ($el.attr('action') == 'export') {
                    _this.exportFile(projectId, fileId);
                }
                if ($el.attr('action') == 'deploy') {
                    /*
                     TODO: deploy 다이어그램이 먼저 뜨고 버젼을 고를 수 있는 다이얼로그를 띄운다.
                     드롭다운 리스트로 하면 편하겠지만 보여지는 정보가 제한되므로 다이얼로그 형태가 좋아보임.
                     */
                    _this.deployFile(projectId, fileId);
                }
                if ($el.attr('action') == 'exportAsRunnable') {
                    _this.exportRunnableFile(projectId, fileId);
                }
                if ($el.attr('action') == 'sendTo') {
                    _this.openSelectUserDialog(projectId, fileId);
                }
                if ($el.attr('action') === 'version') {
                    _this.openVersionManagementDialog(projectId, fileId);
                }
            } else if (menuType == 'bulk-edit') {
                var type = _this.getSelectedTabType();
                var selected = _this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .brtc-va-workspace-model-list-item-select.jqx-checkbox-checked');

                if (!selected || selected.length == 0) {
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please select a ' + type + '.');
                    return;
                }

                var files = [];
                selected.each(function (index) {
                    files.push($(this).attr('id'));
                });

                if ($el.attr('action') == 'delete') {
                    _this.deleteFiles(projectId, files);
                }
                if ($el.attr('action') == 'duplicate') {
                    _this.duplicateFiles(projectId, files);
                }
                if ($el.attr('action') == 'export') {
                    _this.exportFiles(projectId, files);
                }
            } else if (menuType == 'project-edit') {
                if ($el.attr('action') == 'edit') {
                    _this.openEditProjectDialog(projectId);
                }
                if ($el.attr('action') == 'delete') {
                    _this.deleteProject(projectId);
                }
                if ($el.attr('action') == 'members') {
                    _this.openMemberManagementDialog(projectId);
                }
                if ($el.attr('action') == 'export') {
                    _this.exportProject(projectId);
                }
            }
        }, 300, {leading: true, trailing: false}));

        this.ctxMenuCloseHandler = function () {
            _this.$ctxMenu.jqxMenu('close');
        };

        this.$ctxMenu.on('closed', function () {
            $('.brtc-va-workspace-model-list-area').off('scroll', _this.ctxMenuCloseHandler);
            $(window).off('resize', _this.ctxMenuCloseHandler);
        });
    };

    ProjectViewer.prototype.openSelectUserDialog = function (projectId, fileId) {
        new Brightics.VA.Core.Dialogs.SelectUserDialog(this.$mainControl, {
            projectId: projectId,
            fileId: fileId,
            fileListByProject: Studio.getResourceManager().getFiles(projectId)
        });
    };


    ProjectViewer.prototype.openVersionManagementDialog = function (projectId, fileId) {
        new Brightics.VA.Core.Dialogs.VersionManagementDialog(this.$mainControl, {
            projectId: projectId,
            fileId: fileId,
            position: {my: 'center top', at: 'center top+15%', of: window}
        });
    };

    ProjectViewer.prototype.openDeleteConfirmDialog = function (projectId, fileId) {
        var _this = this;
        var file = Studio.getResourceManager().getFile(projectId, fileId);

        if (file.getType() === Brightics.VA.Implementation.DataFlow.Clazz) {
            var flows = this.getFlowUsingTargetDataFlow(projectId, fileId);
            if (flows.length > 0) {
                var labels = flows.map(function (f) {
                    return f.getLabel();
                });
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('This data flow is used for other flows. ' + JSON.stringify(labels));
                return;
            }
        }

        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                Studio.getResourceManager().deleteFile(projectId, fileId).then(function () {
                    _this.deleteAlluxioFile([fileId]);
                    _this.fillProjectList(file.getProjectId(), file.getContents().type);
                }).catch(function (err) {
                });
            }
        };
        var message = 'Are you sure you want to delete "' + file.getLabel() + '"?';
        Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog(message, closeHandler);
    };


    ProjectViewer.prototype.getControlFlowUsingTargetDataFlow = function (projectId, fileId) {
        var results = [];
        var controlFlows = Studio.getResourceManager().getFiles(projectId, 'control');
        for (var i in controlFlows) {
            var hasDataFlow = _hasDataFlow(controlFlows[i].getContents().functions);
            if (hasDataFlow) results.push(controlFlows[i]);
        }
        return results;

        function _hasDataFlow(functions) {
            var hasFlag = false;
            for (var j in functions) {
                if (functions[j].func === 'dataFlow' && functions[j].param.mid === fileId) {
                    hasFlag = true;
                } else {
                    hasFlag = _hasDataFlow(functions[j].param.functions);
                }
                if (hasFlag) break;
            }
            return hasFlag;
        }
    };
    
    ProjectViewer.prototype.getDataFlowUsingTargetDataFlow = function (projectId, fileId) {
        return Studio.getResourceManager().getFiles(projectId)
            .filter(function (file) {
                return file.getFileId() !== fileId &&
                    file.getType() === Brightics.VA.Implementation.DataFlow.Clazz;
            })
            .filter(function (file) {
                var model = file.getContents();
                var innerModels = _.toArray(model.getInnerModels());
                return _.any(innerModels.concat(model), function (m) {
                    return _.any(m.functions, function (fn) {
                        return fn[FUNCTION_NAME] === 'Flow' &&
                            fn.param.mid === fileId;
                    });
                });
            });
    };

    ProjectViewer.prototype.getFlowUsingTargetDataFlow = function (projectId, fileId) {
        return this.getControlFlowUsingTargetDataFlow(projectId, fileId)
            .concat(this.getDataFlowUsingTargetDataFlow(projectId, fileId));
    };

    ProjectViewer.prototype.openDuplicateModelDialog = function (projectId, fileId) {
        var _this = this,
            file = Studio.getResourceManager().getFile(projectId, fileId);

        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                _this.fillProjectList(dialogResult.projectId, _this.getSelectedTabType() == 'model' ? 'model' : 'visual');
            }
        };
        var title = this.getSelectedTabType() === 'model' ? 'Duplicate Model' : 'Duplicate Report';
        new Brightics.VA.Core.Dialogs.DuplicateModelDialog($('body'), {
            files: [file],
            title: title,
            resourceManager: Studio.getResourceManager(),
            close: closeHandler,
            width: 600,
            height: 300,
            minWidth: 600,
            minHeight: 300,
            maxWidth: 800,
            maxHeight: 400,
            resizable: false
        });
    };

    ProjectViewer.prototype.editFile = function (projectId, fileId) {
        var _this = this;
        var file = Studio.getResourceManager().getFile(projectId, fileId);
        _this.openEditFileDialog(file);
    };

    ProjectViewer.prototype.openEditFileDialog = function (file) {
        var _this = this;
        var title = this.getSelectedTabType() === 'model' ? 'Edit Model' : 'Edit Report';
        var dlg = new Brightics.VA.Core.Dialogs.EditResourceDialog(this.$mainControl, {
            title: title,
            label: file.getLabel(),
            description: file.getDescription(),
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    if (file.getLabel() == dialogResult.label && file.getDescription() == dialogResult.description) return;
                    file.setLabel(dialogResult.label);
                    file.setDescription(dialogResult.description);
                    _this.doEditFile(file).catch(function (err) {
                        if (err.status === 400) {
                            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                        } else if (!err.status) {
                            console.error(err);
                            throw err;
                        }
                        file.setLabel(dlg.options.label);
                        file.setDescription(dlg.options.description);
                        _this.fillProjectList(file.getProjectId(), file.getContents().type);
                    });
                }
            }
        });
    };

    ProjectViewer.prototype.doEditFile = function (file) {
        var _this = this;
        file.setUpdater(Brightics.VA.Env.Session.userId);

        return Studio.getResourceManager().updateFile(file.getProjectId(), file)
            .then(function ([err]) {
                if (!err) _this.fillProjectList(file.getProjectId(), file.getContents().type);
            });
    };

    ProjectViewer.prototype._exportObjectFile = function (file) {
        file.getContents().problemList = [];
        Brightics.VA.Core.Utils.CommonUtils.downloadJsonFile(JSON.stringify(file.getContents()), file.getLabel());
    };

    // ProjectViewer.prototype._modelTreeToArrayFile = function (dataflowTree, file, projectId) {
    //     var flowList = Brightics.VA.Core.Utils.ModelUtils.flattenModelTree(dataflowTree, projectId);
    //     flowList.push(file.contents);
    //     Brightics.VA.Core.Utils.CommonUtils
    //         .downloadJsonFile(JSON.stringify(flowList), file.label);
    // };

    ProjectViewer.prototype._exportArrayFile = function (projectId, file) {
        Brightics.VA.Core.Utils.ModelUtils.createModelTree(projectId, file.getContents())
            .then(function (modelTree) {
                var modelArray = Brightics.VA.Core.Utils.ModelUtils
                    .getModelArrayByTree(modelTree, file, projectId);
                return Brightics.VA.Core.Utils.CommonUtils
                    .downloadJsonFile(JSON.stringify(modelArray), file.getLabel());
            })
            .catch(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            });
    };

    ProjectViewer.prototype.exportFile = function (projectId, fileId) {
        this.exportFiles(projectId, [fileId], true);
    };

    ProjectViewer.prototype.searchDataFlowFile = function (projectId, functions, flowList) {
        var _this = this;

        for (var i in functions) {
            if (functions[i].param.functions) {
                _this.searchDataFlowFile(projectId, functions[i].param.functions, flowList);
            }

            var isDuplicateFlag = false;
            if (functions[i][FUNCTION_NAME] === 'DataFlow') {
                for (var j in flowList) {
                    if (functions[i].param.mid === flowList[j].mid) {
                        isDuplicateFlag = true;
                    }
                }
                if (!isDuplicateFlag) {
                    var dataFlowFile = Studio.getResourceManager().getFile(projectId, functions[i].param.mid);
                    // Dataflow 삭제된 경우
                    if (dataFlowFile == undefined) {
                        return '"' + functions[i].display.label + '" dataflow was deleted or format is invalid in selected control flow';
                    } else {
                        flowList.push(dataFlowFile.getContents());
                    }
                }
            }
        }
    };

    ProjectViewer.prototype.exportRunnableFile = function (projectId, fileId) {
        var file = Studio.getResourceManager().getFile(projectId, fileId);
        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                var getRunnable = function (file) {
                    return Brightics.VA.Core.Utils.RunnableFactory
                        .createForFlow(file.getContents(),
                            undefined,
                            undefined,
                            dialogResult.args,
                            {});
                };

                getRunnable(file)
                    .then(function (runnableFile) {
                        var data = JSON.stringify(runnableFile);
                        var fileName = file.getLabel();
                        Brightics.VA.Core.Utils.CommonUtils.downloadJsonFile(data, fileName);
                    })
                    .catch(console.error);
            }
        };

        if (Brightics.VA.SettingStorage.getValue('editor.variable.visible') === 'true' && file.getContents().type == 'control' && file.getContents().variables.length > 0) {
            new Brightics.VA.Core.Dialogs.RunControlDialog(this.$parent, {
                close: closeHandler,
                analyticsModel: file.getContents()
            });
        } else if (Brightics.VA.SettingStorage.getValue('editor.variable.visible') === 'true' && file.getContents().type == 'realtime') {
            new Brightics.VA.Core.Dialogs.RunRealTimeDialog(this.$parent, {
                close: closeHandler,
                analyticsModel: file.getContents()
            });
        } else if (Brightics.VA.SettingStorage.getValue('editor.variable.visible') === 'true' && file.getContents().type == 'data' && Object.keys(file.getContents().variables).length > 0) {
            new Brightics.VA.Core.Dialogs.RunDataDialog(this.$parent, {
                close: closeHandler,
                analyticsModel: file.getContents()
            });
        } else {
            closeHandler({OK: true});
        }
    };

    ProjectViewer.prototype.createDescriptionControl = function ($control) {
        var _this = this;
        var noteOption = {
            height: 230,
            description: this.options.description,
            okButton: this.$okButton,
            maxLength: 2000,
            toolbar: this.options.toolbar
        };

        this.noteControl = Brightics.VA.Core.Widget.Factory.noteControl($control, noteOption);

        this.$mainControl.on('resizing', function (event) {
            _this.noteControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height());
        });
    };

    // deployFile
    ProjectViewer.prototype.deployFile = function (projectId, fileId) {
        var projectName = $('.brtc-va-workspace-model-list-title').text();
        var variableflag = 'N';
        var args = {};
        var file = Studio.getResourceManager().getFile(projectId, fileId);
        var _this = this;

        if (Brightics.VA.SettingStorage.getValue('editor.variable.visible') === 'true' &&
            file.getContents().type === 'data' && _.keys(file.getContents().variables).length > 0) {
            variableflag = 'Y';
            var variables = file.getContents().variables;
            _.forIn(variables, function (v) {
                args[v.name] = v.value;
            });
        }

        return Brightics.VA.Core.Utils.RunnableFactory
            .createForFlow(file.getContents(), args, {})
            .then(function (runnable) {
                var fileContents = file.getContents();
                var runnableContents = runnable;
                return _this.openDeployModelDialog(
                    projectName,
                    file,
                    fileContents,
                    runnableContents,
                    variableflag);
            })
            .catch(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            });
    };

    ProjectViewer.prototype.openDeployModelDialog = function (projectName, file, fileContents, runnableContents, variableFlag) {
        var _this = this;
        var title = 'Deploy to Server';
        var userId = Brightics.VA.Env.Session.userId;
        var $dialog = new Brightics.VA.Core.Dialogs.DeployModelDialog(this.$mainControl, {
            title: title,
            projectId: file.getProjectId(),
            fileId: file.getFileId(),
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    var deployInfo =
                        {
                            server: dialogResult.server,
                            projectId: file.getProjectId(),
                            modelId: file.getFileId(),
                            registerUserId: userId,
                            projectName: projectName,
                            modelName: file.getLabel(),
                            title: dialogResult.name,
                            description: dialogResult.description,
                            contents: JSON.stringify(fileContents),
                            runnableContents: JSON.stringify(runnableContents),
                            gvFlag: variableFlag
                        };

                    // deploy action 수행
                    _this.deployAction(deployInfo);
                }
            }
        });
    };

    // 실제 deploy 수행
    ProjectViewer.prototype.deployAction = function (deployInfo) {
        var _this = this;
        $.ajax({
            type: 'POST',
            url: 'api/va/v2/ws/deploy',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(deployInfo),
            blocking: true
        }).done(function (data) {
            // deploy management 화면으로 이동
            var callback = function () {
                setTimeout(function () {
                    var w = window.open('/ng1123/deploy', 'Brightics Management');
                    w.blur();
                }, 1000);
            };

            _this.doCreateSuccessPopup(data, deployInfo.server, callback);
        }).fail(function (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        });
        return true;
    };

    ProjectViewer.prototype.createContentsContainer = function ($parent) {
        var _this = this;

        $parent.append('' +
            '<div class="brtc-va-workspace-model-list-popup-header">' +
            '   <div class="brtc-va-workspace-model-list-popup-header-title">Open Model/Report</div>' +
            '   <div class="brtc-va-workspace-model-list-popup-header-close"></div>' +
            '</div>');
        $parent.find('.brtc-va-workspace-model-list-popup-header-close').click(function () {
            _this.result = {
                selectedProject: undefined,
                selectedFiles: undefined
            };
            _this.performFinish();
        });

        var $projectListArea = $('<div class="brtc-va-workspace-project-list-area">' +
            '   <div class="brtc-va-workspace-project-filter brtc-va-searcharea brtc-style-search-area"></div>' +
            '   <div class="brtc-va-workspace-project-groups"></div>' +
            '</div>');
        $parent.append($projectListArea);

        var $filterInput = $('<input type="search" class="brtc-va-views-workspace-project-input searchinput"/>');
        $projectListArea.find('.brtc-va-workspace-project-filter').append($filterInput);

        $filterInput.jqxInput({
            placeHolder: 'Search Project',
            theme: Brightics.VA.Env.Theme
        });

        var applyFilter = function (event) {
            var filterValue = event.target.value.toLowerCase();

            var projectListItems = _this.$mainControl.find('.brtc-va-workspace-project-list-item');
            $.each(projectListItems, function (index, item) {
                var $projectElement = $(item);
                $projectElement.css('display', $(item).find('.brtc-va-workspace-project-list-item-label').text().toLowerCase().indexOf(filterValue) > -1 ? 'block' : 'none');
            });

            _this.renderProjectListContainer();
        };
        $filterInput.keyup(function (event) {
            applyFilter(event);
        });

        $filterInput.on('search', function () {
            applyFilter(event);
        });


        Brightics.VA.Core.Utils.WidgetUtils.createPrivatePolicy($parent.find('.brtc-va-workspace-project-list-area'));
        $parent.append('<div class="brtc-va-workspace-model-list-area"></div>');
    };

    ProjectViewer.prototype._clearProjectList = function () {
        this.$mainControl.find('.brtc-va-workspace-project-groups').empty();
        this.$mainControl.find('.brtc-va-views-workspace-project-input').val('');
    };

    ProjectViewer.prototype.renderProjectListContainer = function () {
        var myProjectGroup = this.$mainControl.find('.brtc-va-workspace-project-group-area.my');
        var sharedProjectGroup = this.$mainControl.find('.brtc-va-workspace-project-group-area.shared');

        var myProjectVisible = $(myProjectGroup).find('.brtc-va-workspace-project-list').css('display') == 'block' ? true : false;
        var sharedProjectVisible = $(sharedProjectGroup).find('.brtc-va-workspace-project-list').css('display') == 'block' ? true : false;

        // MY Project Height 조정.
        var myProjects = $(myProjectGroup).find('.brtc-va-workspace-project-list-item');
        var myVisibleElements = myProjects.filter(function () {
            return $(this).css('display') == 'block';
        });

        // Shared Project Height 조정
        var sharedProjects = $(sharedProjectGroup).find('.brtc-va-workspace-project-list-item');
        var sharedVisibleElements = sharedProjects.filter(function () {
            return $(this).css('display') == 'block';
        });

        if (!this.$mainControl.find('.brtc-va-workspace-project-groups').is(':visible')) {
            return;
        }

        var titleHeight = this.$mainControl.find('.brtc-va-workspace-project-list-title').height() + 1;
        var itemHeight = this.$mainControl.find('.brtc-va-workspace-project-list-item').height() + 4;
        var sharedProjectHeight = sharedVisibleElements.length * itemHeight + titleHeight;
        var myProjectHeight = myVisibleElements.length * itemHeight + titleHeight;

        if (myProjectVisible && sharedProjectVisible) {
            if (sharedProjectHeight > this.$mainControl.find('.brtc-va-workspace-project-groups').height() * 0.3) {
                $(sharedProjectGroup).css('height', '30%');
                $(sharedProjectGroup).css('min-height', '30%');
                if (myProjectHeight > this.$mainControl.find('.brtc-va-workspace-project-groups').height() * 0.7) {
                    $(myProjectGroup).css('height', '70%');
                    $(myProjectGroup).css('max-height', '70%');
                } else {
                    $(myProjectGroup).css('height', myProjectHeight);
                    $(myProjectGroup).css('max-height', myProjectHeight);
                }
            } else {
                $(sharedProjectGroup).css('height', sharedProjectHeight);
                $(sharedProjectGroup).css('min-height', sharedProjectHeight);
                if (myProjectHeight > this.$mainControl.find('.brtc-va-workspace-project-groups').height() - sharedProjectHeight) {
                    myProjectHeight = this.$mainControl.find('.brtc-va-workspace-project-groups').height() - sharedProjectHeight;
                    $(myProjectGroup).css('height', myProjectHeight);
                    $(myProjectGroup).css('max-height', myProjectHeight);
                } else {
                    $(myProjectGroup).css('height', myProjectHeight);
                    $(myProjectGroup).css('max-height', myProjectHeight);
                }
            }
            // } else if (myProjectVisible && !sharedProjectVisible) {
        } else if (myProjectVisible) {
            $(sharedProjectGroup).css('height', titleHeight);
            $(sharedProjectGroup).css('min-height', titleHeight);
            if (myProjectHeight > this.$mainControl.find('.brtc-va-workspace-project-groups').height() - titleHeight) {
                myProjectHeight = this.$mainControl.find('.brtc-va-workspace-project-groups').height() - titleHeight;
                $(myProjectGroup).css('height', myProjectHeight);
                $(myProjectGroup).css('max-height', myProjectHeight);
            } else {
                $(myProjectGroup).css('height', myProjectHeight);
                $(myProjectGroup).css('max-height', myProjectHeight);
            }
            // } else if (!myProjectVisible && sharedProjectVisible) {
        } else if (sharedProjectVisible) {
            sharedProjectHeight = this.$mainControl.find('.brtc-va-workspace-project-groups').height() - titleHeight;
            $(sharedProjectGroup).css('height', sharedProjectHeight);
            $(sharedProjectGroup).css('min-height', sharedProjectHeight);

            $(myProjectGroup).css('height', titleHeight);
            $(myProjectGroup).css('max-height', titleHeight);
        } else {
            $(sharedProjectGroup).css('height', titleHeight);
            $(sharedProjectGroup).css('min-height', titleHeight);

            $(myProjectGroup).css('height', titleHeight);
            $(myProjectGroup).css('max-height', titleHeight);
        }

        $(myProjectGroup).find('.brtc-va-workspace-project-group-total-count').text(myVisibleElements.length);
        $(myProjectGroup).find('.brtc-va-workspace-project-list').perfectScrollbar('update');

        $(sharedProjectGroup).find('.brtc-va-workspace-project-group-total-count').text(sharedVisibleElements.length);
        $(sharedProjectGroup).find('.brtc-va-workspace-project-list').perfectScrollbar('update');
    };

    ProjectViewer.prototype._addProjectItem = function (projects) {
        var _this = this;
        var projectGroups = {
            my: {
                label: 'My Projects',
                projects: []
            },
            shared: {
                label: 'Shared Projects',
                projects: []
            }
        };

        projects.filter(function (obj) {
            if (obj.getCreator() === Brightics.VA.Env.Session.userId) {
                projectGroups['my'].projects.push(obj);
            } else {
                projectGroups['shared'].projects.push(obj);
            }
        });

        for (var i in projectGroups) {
            var $projectGroupControl = $('<div class = "brtc-va-workspace-project-group-area"></div>');
            var $projectGroupName = $('<div class="brtc-va-workspace-project-list-item-label brtc-va-workspace-project-list-title">' + projectGroups[i].label +
                '<span class="brtc-va-workspace-project-group-total-count"></span>' +
                '<div class="brtc-va-workspace-project-list-tool-item"><i class="fa fa-chevron-up fa-chevron-down" aria-hidden="true"></i></div>' +
                '</div>');
            var $projectAdd = $('<div class="brtc-va-workspace-project-new" title="Create New Project"></div>');
            var $projectImport = $('<div class="brtc-va-workspace-project-import" title="Import Project"></div>');
            var $projectList = $('<div class="brtc-va-workspace-project-list">');

            $projectGroupControl.append($projectGroupName);
            $projectGroupControl.addClass(i);
            $projectGroupControl.append($projectList);

            this.$mainControl.find('.brtc-va-workspace-project-groups').append($projectGroupControl);
            if (i === 'my') {
                $projectGroupControl.append($projectAdd);
                $projectGroupControl.append($projectImport);

                $projectAdd.click(function () {
                    _this.openNewProjectDialog();
                });

                $projectImport.click(function () {
                    _this.openImportProjectDialog();
                });
            }

            $projectGroupName.find('.brtc-va-workspace-project-group-total-count').text(projectGroups[i].projects.length);
            $projectGroupName.find('.brtc-va-workspace-project-list-tool-item>i').toggleClass('fa-chevron-down');
            $projectGroupName.find('.brtc-va-workspace-project-list-tool-item').click(function (e) {
                e.preventDefault();

                if ($(this).find('i').hasClass('fa-chevron-down')) {
                    // expand
                    $(this).closest('.brtc-va-workspace-project-group-area').find('.brtc-va-workspace-project-list').show();
                } else {
                    // collpase
                    $(this).closest('.brtc-va-workspace-project-group-area').find('.brtc-va-workspace-project-list').hide();
                }
                _this.renderProjectListContainer();
                $(this).find('i').toggleClass('fa-chevron-down');
            });

            $projectGroupName.find('.brtc-va-workspace-project-list-tool-item').mouseover(function () {
                if ($(this).find('i').hasClass('fa-chevron-down')) {
                    $(this).attr('title', 'Expand');
                } else {
                    $(this).attr('title', 'Collapse');
                }
            });

            $projectGroupName.find('.brtc-va-workspace-project-group-total-count').text(projectGroups[i].projects.length);

            for (var j in projectGroups[i].projects) {
                var project = projectGroups[i].projects[j];
                var $projectItem = $('<div class="brtc-va-workspace-project-list-item" id="' + project.getProjectId() + '"></div>');
                var $projectNewArrive = $('<div class="brtc-va-worksapce-project-list-item-new"></div>');
                var $projectLabel = $('<div class="brtc-va-workspace-project-list-item-label"></div>');
                var $projectModelInfo = $('<div class="brtc-va-workspace-project-list-item-model"></div>');
                $projectItem.append($projectNewArrive);
                $projectItem.append($projectLabel);
                $projectItem.append($projectModelInfo);

                $projectLabel.text(project.getLabel());
                $projectLabel.attr('title', project.getLabel());
                $projectModelInfo.append('<span>Models</span><span>' + project.getModelCount() + '</span><span>Reports</span><span>' + project.getReportCount() + '</span>');
                $projectList.append($projectItem);
                if (Brightics.VA.Core.Utils.CommonUtils.getTimeDifferenceFromNow(project.getCreateTime()) < 24) {
                    $projectNewArrive.show();
                }

                $projectItem.click(function () {
                    _this.selectProject($(this).attr('id'));
                });
            }

            this.renderProjectListContainer();
            $projectList.perfectScrollbar();
        }
    };

    ProjectViewer.prototype.clearProjectItem = function () {
        this.$mainControl.find('.brtc-va-workspace-model-list-area').empty();
    };

    ProjectViewer.prototype.fillProjectList = function (selectionProjectId, fileType, callback) {
        var _this = this,
            projectId = selectionProjectId || this.$mainControl.find('.brtc-va-workspace-project-list-item-selected').attr('id');

        var sortByProjectName = function (a, b) {
            var label1 = a.getLabel().toLowerCase();
            var label2 = b.getLabel().toLowerCase();
            if (label1 < label2) return -1;
            if (label1 > label2) return 1;
            return 0;
        };

        Studio.getResourceManager().fetchProjects().then(function (projects) {
            projects.sort(sortByProjectName);
            _this._clearProjectList();
            _this._addProjectItem(projects);
            // Delete하고 난 후 Project가 있는지 검사.
            var projectList = $.grep(projects, function (project) {
                return project.getProjectId() === projectId;
            });
            if (projectList.length === 0) {
                if (projects.length > 0) {
                    _this.selectProject(_this.$mainControl.find('.brtc-va-workspace-project-list-item')[0].id);
                } else {
                    _this.clearProjectItem();
                }
            } else if (projectId) {
                _this.selectProject(projectId, fileType, callback);
            } else if (projects.length > 0) {
                _this.selectProject(projects[0].getProjectId());
            }
        }).catch(function (err) {
            console.error(err);
        });
    };

    ProjectViewer.prototype.selectProject = function (projectId, fileType, callback) {
        var $container = this.$mainControl.find('.brtc-va-workspace-project-list-area');
        if ($container.find('.brtc-va-workspace-project-list-item.brtc-va-workspace-project-list-item-selected').attr('id') == projectId) return;

        $container.find('.brtc-va-workspace-project-list-item').removeClass('brtc-va-workspace-project-list-item-selected');
        $container.find('#' + projectId).addClass('brtc-va-workspace-project-list-item-selected');
        this.renderModelList(projectId, fileType, callback);
    };

    ProjectViewer.prototype.renderModelList = function (projectId, fileType, callback) {
        this._fillModelList(projectId, fileType, callback);
    };

    ProjectViewer.prototype.openNewFileDialog = function (projectId, fileType) {
        var _this = this;
        new Brightics.VA.Core.Dialogs.NewFileDialog(this.$mainControl, {
            project: Studio.getResourceManager().getProject(projectId),
            fileType: fileType,
            close: function (result) {
                if (result.OK) {
                    Studio.getResourceManager().fetchFiles(projectId).catch().then(function () {
                        _this.selectProject(projectId);
                        _this.result = {
                            selectedProject: projectId,
                            selectedFiles: [result.selectedFile.getFileId()],
                            fileListByProject: Studio.getResourceManager().getFiles(projectId)
                        };
                        _this.performFinish();
                    });
                }
            },
            title: 'Create New ' + fileType
        });
    };

    ProjectViewer.prototype.openImportDialog = function (projectId, fileType) {
        var _this = this;
        new Brightics.VA.Core.Dialogs.ImportDialog(this.$mainControl, {
            resourceManager: Studio.getResourceManager(),
            fileType: fileType,
            project: Studio.getResourceManager().getProject(projectId),
            close: function (result) {
                if (result.OK) {
                    Studio.getResourceManager().fetchFiles(projectId).catch().then(function () {
                        _this.result = {
                            selectedProject: projectId,
                            selectedFiles: result.selectedFiles
                        };
                        _this.fillProjectList(projectId);
                    });
                }
            }
        });
    };

    ProjectViewer.prototype._clearModelList = function (projectId) {
        var $container = this.$mainControl.find('.brtc-va-workspace-model-list-area');
        $container.find('.brtc-va-workspace-model-list-header').remove();
        $container.find('.brtc-va-workspace-model-list-content').remove();
    };

    ProjectViewer.prototype._createModelContainer = function (projectId) {
        var _this = this,
            project = Studio.getResourceManager().getProject(projectId);

        var $container = this.$mainControl.find('.brtc-va-workspace-model-list-area');
        $container.attr('project-id', projectId);
        var $modelContainer = $('' +
            '<div class="brtc-va-workspace-model-list-header">' +
            '   <div class="brtc-va-workspace-model-list-title"></div>' +
            '   <div class="brtc-va-workspace-model-list-edit"></div>' +
            '   <div class="brtc-va-workspace-model-list-author">' +
            '       <div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem" title="Info" item-type="model-info" />' +
            '       <span>Created on</span><span>' + moment(project.getCreateTime()).format('YYYY-MM-DD HH:mm:ss') + '</span>' +
            '       <span>by</span><span></span>' +
            '   </div>' +
            '   <div class="brtc-va-workspace-model-list-hashtag"></div>' +
            '   <div class="brtc-va-workspace-model-list-type">' +
            '       <div class="brtc-va-workspace-model-list-type-item model"><div>Models</div></div>' +
            '       <div class="brtc-va-workspace-model-list-type-item report"><div>Reports</div><div class="addedcount"></div></div>' +
            '       <div class="brtc-va-workspace-model-list-toolbar">' +
            '           <div class="brtc-va-workspace-model-list-select"></div>' +
            '          <div class="brtc-style-workspace-toolitem brtc-style-s-workspace-toolitem" title="Bulk edit" item-type="bulk-edit"></div>' +
            '       </div>' +
            '   </div>' +
            '</div>' +
            '<div class="brtc-va-workspace-model-list-content" id="' + projectId + '" item-type="model">' +
            '</div>');

        $modelContainer.find('.brtc-va-workspace-model-list-title').attr('title', project.getLabel()).text(project.getLabel());
        $modelContainer.find('.brtc-va-workspace-model-list-author > span:nth-child(5)').text(project.getCreator());
        $container.append($modelContainer);

        $container.find('.brtc-style-editor-toolitem[item-type=model-info]').click(function (event) {
            _this.closeInfoDialog();
            _this.openInfoDialog(event);
        });

        $container.find('.brtc-va-workspace-model-list-select').jqxCheckBox({
            theme: Brightics.VA.Env.Theme,
            width: 23,
            height: 24,
            boxSize: 17,
            checked: false
        });
        $container.find('.brtc-va-workspace-model-list-select').on('checked', function () {
            var type = _this.getSelectedTabType();
            _this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .jqx-checkbox').jqxCheckBox({locked: false});
            _this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .jqx-checkbox').jqxCheckBox({checked: true});
            _this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .jqx-checkbox').jqxCheckBox({locked: true});
        });
        $container.find('.brtc-va-workspace-model-list-select').on('unchecked', function () {
            var type = _this.getSelectedTabType();
            _this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .jqx-checkbox').jqxCheckBox({locked: false});
            _this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .jqx-checkbox').jqxCheckBox({checked: false});
            _this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .jqx-checkbox').jqxCheckBox({locked: true});
        });
        $container.find('.brtc-style-workspace-toolitem[item-type=bulk-edit]').click(function () {
            _this.$ctxMenu.attr('project-id', $(this).closest('.brtc-va-workspace-model-list-area').attr('project-id'));
            _this.$ctxMenu.attr('menu-type', 'bulk-edit');
            _this.$ctxMenu.removeAttr('file-id');

            _this.$ctxMenu.find('li').css('display', 'none');
            _this.$ctxMenu.find('li[action=delete]').css('display', 'block');
            _this.$ctxMenu.find('li[action=duplicate]').css('display', 'none');
            _this.$ctxMenu.find('li[action=export]').css('display', 'block');
            _this.$ctxMenu.find('li[type=separator]:eq(0)').css('display', 'block');

            var left = $(this).offset().left + $(this).width() - 200 - 2;
            var top = $(this).offset().top + $(this).height();

            _this.$ctxMenu.jqxMenu('open', left, top);
            $('.brtc-va-workspace-model-list-area').on('scroll', _this.ctxMenuCloseHandler);
            $(window).on('resize', _this.ctxMenuCloseHandler);
        });

        $container.find('.brtc-va-workspace-model-list-edit').click(function () {
            _this.$ctxMenu.attr('project-id', $(this).closest('.brtc-va-workspace-model-list-area').attr('project-id'));
            _this.$ctxMenu.attr('menu-type', 'project-edit');
            _this.$ctxMenu.removeAttr('file-id');

            _this.$ctxMenu.find('li').css('display', 'none');
            _this.$ctxMenu.find('li[action=edit]').css('display', 'block');
            _this.$ctxMenu.find('li[action=delete]').css('display', 'block');
            _this.$ctxMenu.find('li[action=export]').css('display', 'block');
            _this.$ctxMenu.find('li[action=members]').css('display', 'block');
            _this.$ctxMenu.find('li[type=separator]').css('display', 'block');

            var left = $(this).offset().left + $(this).width() - 200 - 2;
            var top = $(this).offset().top + $(this).height();

            _this.$ctxMenu.jqxMenu('open', left, top);
            $('.brtc-va-workspace-model-list-area').on('scroll', _this.ctxMenuCloseHandler);
            $(window).on('resize', _this.ctxMenuCloseHandler);
        });

        $container.find('.brtc-va-workspace-model-list-type-item').click(function () {
            $container.find('.brtc-va-workspace-model-list-type-item').removeClass('selected');
            $(this).addClass('selected');
            if ($(this).hasClass('model')) {
                $container.find('.brtc-va-workspace-model-list-content').removeClass('report');
                $container.find('.brtc-va-workspace-model-list-content').addClass('model');
            } else {
                $container.find('.brtc-va-workspace-model-list-content').removeClass('model');
                $container.find('.brtc-va-workspace-model-list-content').addClass('report');
            }
            _this.$mainControl.find('.brtc-va-workspace-model-list-content').scrollTop(0);
            _this.$mainControl.find('.brtc-va-workspace-model-list-content').perfectScrollbar('update');
            _this._refreshCheckBoxStatus();
        });

        var $contents = this.$mainControl.find('#' + projectId + '.brtc-va-workspace-model-list-content');
        var $newModelItem = $('' +
            '<div class="brtc-va-workspace-model-list-cell model">' +
            '   <div class="brtc-va-workspace-model-list-item brtc-va-workspace-model-list-item-new" model-type="newmodel">' +
            '       <div class="brtc-va-workspace-model-list-item-new-title">Create a Model</div>' +
            '       <div class="brtc-va-workspace-model-list-item-new-content">' +
            '          <div class="brtc-va-workspace-model-list-item-new-item new">' +
            '               <div class="brtc-va-workspace-model-list-item-new-item-icon new"></div>' +
            '              <div>New</div>' +
            '           </div>' +
            '           <div class="brtc-va-workspace-model-list-item-new-item splitter"></div>' +
            '          <div class="brtc-va-workspace-model-list-item-new-item import">' +
            '               <div class="brtc-va-workspace-model-list-item-new-item-icon import"></div>' +
            '              <div>Import</div>' +
            '           </div>' +
            '       </div>' +
            '   </div>' +
            '</div>');

        var $newReportItem = $('' +
            '<div class="brtc-va-workspace-model-list-cell report">' +
            '   <div class="brtc-va-workspace-model-list-item brtc-va-workspace-model-list-item-new" model-type="newreport">' +
            '       <div class="brtc-va-workspace-model-list-item-new-title">Create a Report</div>' +
            '       <div class="brtc-va-workspace-model-list-item-new-content">' +
            '          <div class="brtc-va-workspace-model-list-item-new-item new">' +
            '               <div class="brtc-va-workspace-model-list-item-new-item-icon new"></div>' +
            '              <div>New</div>' +
            '           </div>' +
            '           <div class="brtc-va-workspace-model-list-item-new-item splitter"></div>' +
            '          <div class="brtc-va-workspace-model-list-item-new-item import">' +
            '               <div class="brtc-va-workspace-model-list-item-new-item-icon import"></div>' +
            '              <div>Import</div>' +
            '           </div>' +
            '       </div>' +
            '   </div>' +
            '</div>');


        $newModelItem.find('.brtc-va-workspace-model-list-item-new-item.new').click(function () {
            _this.openNewFileDialog(projectId, 'Model');
        });

        $newReportItem.find('.brtc-va-workspace-model-list-item-new-item.new').click(function () {
            _this.openNewFileDialog(projectId, 'Report');
        });

        $newModelItem.find('.brtc-va-workspace-model-list-item-new-item.import').click(function () {
            _this.openImportDialog(projectId, 'Model');
        });

        $newReportItem.find('.brtc-va-workspace-model-list-item-new-item.import').click(function () {
            _this.openImportDialog(projectId, 'Report');
        });

        $contents.append($newModelItem);
        $contents.append($newReportItem);
    };

    ProjectViewer.prototype.closeInfoDialog = function () {
        if (this.infoDialog) {
            this.infoDialog.close();
        }
        this.infoDialog = null;
    };

    ProjectViewer.prototype.openInfoDialog = function (event) {
        var projectId = this.$mainControl.find('.brtc-va-workspace-model-list-area').attr('project-id');
        var project = Studio.getResourceManager().getProject(projectId);

        this.infoDialog = new Brightics.VA.Core.Dialogs.InfoDialog(this.$mainControl, {
            project: project,
            appendTo: this.$mainControl,
            modal: true,
            title: 'Project Information'
        });
    };

    ProjectViewer.prototype._addModelItem = function (projectId, files) {
        var _this = this,
            $contents = this.$mainControl.find('#' + projectId + '.brtc-va-workspace-model-list-content');
        for (var i in files) {
            var file = files[i];

            var modelType = file.getContents().type ? file.getContents().type : 'data';
            var modelClass = modelType == 'visual' ? 'report' : 'model';
            var $item = $('' +
                '<div class="brtc-va-workspace-model-list-cell ' + modelClass + '">' +
                '   <div class="brtc-va-workspace-model-list-item" id="' + file.getFileId() + '" model-type="' + modelType + '">' +
                '       <div class="brtc-va-workspace-model-list-item-header">' +
                '           <div class="brtc-va-workspace-model-list-item-icon"></div>' +
                '           <div class="brtc-va-workspace-model-list-item-type brtc-style-width-minus-250">' + modelTypeLabel[modelType] + '</div>' +
                '           <div class="brtc-va-workspace-model-list-item-version"></div>' +
                '           <div class="brtc-va-workspace-model-list-item-select" id="' + file.getFileId() + '" model-type="' + modelType + '"></div>' +
                '           <div class="brtc-va-workspace-model-list-item-edit"></div>' +
                '       </div>' +
                '       <div class="brtc-va-workspace-model-list-item-label"></div>' +
                '       <div class="brtc-va-workspace-model-list-item-updatetime">' +
                '           <div>Updated on</div><div>' + moment(file.getUpdateTime()).format('YYYY-MM-DD HH:mm:ss') + '</div><div>by</div><div></div>' +
                '       </div>' +
                '       <div class="brtc-va-workspace-model-list-item-createtime">' +
                '           <div>Created on</div><div>' + moment(file.getCreateTime()).format('YYYY-MM-DD HH:mm:ss') + '</div><div>by</div><div></div>' +
                '       </div>' +
                '       <div class="brtc-va-workspace-model-list-item-description">' + file.getDescription() +
                '       </div>' +
                '       <div class="brtc-va-workspace-model-list-item-open">Open</div>' +
                '   </div>' +
                '</div>'
            );
            if (_this.chartContentAddedReport[projectId] && _this.chartContentAddedReport[projectId][file.id]) $item.find('.brtc-va-workspace-model-list-item-type').addClass('chartadded');
            $item.find('.brtc-va-workspace-model-list-item-label').attr('title', file.getLabel()).text(file.getLabel());
            $item.find('.brtc-va-workspace-model-list-item-updatetime div:nth-child(4)').text(file.getUpdater());
            $item.find('.brtc-va-workspace-model-list-item-createtime div:nth-child(4)').text(file.getCreator());
            $item.find('.brtc-va-workspace-model-list-item-version').text((file.getFromVersion()) ? ((file.getFromVersion() != '0.0') ? 'From ' + file.getFromVersion() : '') : '');
            $item.find('.brtc-va-workspace-model-list-item-type').css('cursor', 'pointer');
            $item.find('.brtc-va-workspace-model-list-item-icon').css('cursor', 'pointer');
            $item.hover(function () {
                $(this).addClass('brtc-va-workspace-model-list-cell-hover');
            }, function () {
                $(this).removeClass('brtc-va-workspace-model-list-cell-hover');
            });
            $item.find('.brtc-va-workspace-model-list-item-open').click(function () {
                _this.result = {
                    selectedProject: projectId,
                    selectedFiles: [$(this).parent().attr('id')],
                    fileListByProject: Studio.getResourceManager().getFiles(projectId)
                };
                _this.performFinish();
            });

            $item.find('.brtc-va-workspace-model-list-item-select').jqxCheckBox({
                theme: Brightics.VA.Env.Theme,
                width: 23,
                height: 24,
                boxSize: 17,
                checked: false,
                locked: true
            });
            // $item.find('.brtc-va-workspace-model-list-item-select').css('visibility', 'hidden');
            $item.find('.brtc-va-workspace-model-list-item-select').on('change', function () {
                _this._refreshCheckBoxStatus();
            });
            $item.find('.brtc-va-workspace-model-list-item-header').on('click', function (event) {
                if ($(this).find('.brtc-va-workspace-model-list-item-select').css('visibility') == 'hidden') return;
                $(this).find('.brtc-va-workspace-model-list-item-select').jqxCheckBox({locked: false});
                $(this).find('.brtc-va-workspace-model-list-item-select').jqxCheckBox('toggle');
                $(this).find('.brtc-va-workspace-model-list-item-select').jqxCheckBox({locked: true});
            });

            $item.find('.brtc-va-workspace-model-list-item-edit').click(function (event) {
                event.stopPropagation();

                var projectId = $(this).closest('.brtc-va-workspace-model-list-content').attr('id'),
                    fileId = $(this).closest('.brtc-va-workspace-model-list-item').attr('id');
                var file = Studio.getResourceManager().getFile(projectId, fileId),
                    type = file.getContents().type || 'data';

                _this.$ctxMenu.attr('menu-type', 'file-edit');
                _this.$ctxMenu.attr('project-id', projectId);
                _this.$ctxMenu.attr('file-id', fileId);

                _this.$ctxMenu.find('li').css('display', 'none');
                _this.$ctxMenu.find('li[action=edit]').css('display', 'block');
                _this.$ctxMenu.find('li[action=delete]').css('display', 'block');
                if (type == 'visual') _this.$ctxMenu.find('li[type=separator]:eq(0)').css('display', 'block');
                else _this.$ctxMenu.find('li[type=separator]').css('display', 'block');

                _this._configureCtxMenuVisible(type);

                var left = $(this).offset().left + $(this).width() - 200 - 2;
                var top = $(this).offset().top + $(this).height();

                _this.$ctxMenu.jqxMenu('open', left, top);
                $('.brtc-va-workspace-model-list-content').on('scroll', _this.ctxMenuCloseHandler);
                $(window).on('resize', _this.ctxMenuCloseHandler);
            });
            $contents.append($item);
        }
    };

    ProjectViewer.prototype._refreshCheckBoxStatus = function () {
        var type = this.getSelectedTabType();
        var checkBoxes = this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .brtc-va-workspace-model-list-item-select.jqx-checkbox');
        var selected = this.$contentsContainer.find('.brtc-va-workspace-model-list-cell.' + type + ' .brtc-va-workspace-model-list-item-select.jqx-checkbox-checked');

        if (selected.length == 0) this.$contentsContainer.find('.brtc-va-workspace-model-list-select').jqxCheckBox({checked: false});
        else if (selected.length == checkBoxes.length) this.$contentsContainer.find('.brtc-va-workspace-model-list-select').jqxCheckBox({checked: true});
        else this.$contentsContainer.find('.brtc-va-workspace-model-list-select').jqxCheckBox('indeterminate');
    };

    ProjectViewer.prototype._configureCtxMenuVisible = function (modelType) {
        var _this = this;

        Brightics.VA.Core.Interface.ProjectContextMenuList[modelType].forEach(function (menuName) {
            _this.$ctxMenu.find('li[action=' + menuName + ']').css('display', 'block');
        });
        if ($.inArray('duplicate', Brightics.VA.Core.Interface.ProjectContextMenuList[modelType]) === -1) {
            this.$ctxMenu.find('li[type=separator]:eq(0)').css('display', 'none');
        }
        if ($.inArray('version', Brightics.VA.Core.Interface.ProjectContextMenuList[modelType]) === -1) {
            this.$ctxMenu.find('li[type=separator]:eq(1)').css('display', 'none');
        }
    };

    ProjectViewer.prototype._fillModelList = function (projectId, fileType, callback) {
        var _this = this;
        Studio.getResourceManager().fetchFiles(projectId).then(function (files) {
            _this._clearModelList(projectId);
            _this._createModelContainer(projectId);
            if (fileType && fileType === 'visual') _this.$mainControl.find('.brtc-va-workspace-model-list-type-item.report').click();
            else _this.$mainControl.find('.brtc-va-workspace-model-list-type-item.model').click();
            if (_this.chartContentAddedReport[projectId]) {
                var modelCount = Object.keys(_this.chartContentAddedReport[projectId]).length;
                _this.$mainControl.find('.brtc-va-workspace-model-list-type-item.report .addedcount').text(modelCount);
            } else {
                _this.$mainControl.find('.brtc-va-workspace-model-list-type-item.report .addedcount').hide();
            }
            _this._addModelItem(projectId, files);

            // _this.$mainControl.find('.brtc-va-workspace-model-list-count').html('Models <span>' + files.length + '</span>');
            _this.$mainControl.find('.brtc-va-workspace-model-list-content').perfectScrollbar();
            // 프로젝트를 선택할 때 이전 프로젝트의 모델리스트가 많아서 스크롤이 생긴 경우에 스크롤이 안 사라지는 버그 해결을 위해 update 를 추가 실행
            _this.$mainControl.find('.brtc-va-workspace-model-list-content').perfectScrollbar('update');
            if (callback && typeof callback == 'function') callback();
            if (_this.$el) _this.$el.remove();
        })
            .catch(function (err) {
                console.error(err);
                throw err;
            });
    };

    ProjectViewer.prototype.performFinish = function () {
        if (typeof this.options.close == 'function') {
            this.options.close(this.result);
        }
    };

    ProjectViewer.prototype.openNewProjectDialog = function () {
        var _this = this;
        var $dialog = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-newprojectdialog">' +
            // '   <div class="brtc-va-dialogs-header"><div class="brtc-va-dialogs-header-title">Create Project</div></div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '           <div class="brtc-va-dialogs-contents-label-main">Name</div>' +
            '           <input type="text" class="brtc-va-dialogs-newfiledialog-name-input" maxlength="80"/>' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        $('body').append($dialog);

        $dialog.dialog({
            theme: Brightics.VA.Env.Theme,
            title: 'Create Project',
            width: 400,
            height: 200,
            modal: true,
            resizable: false,
            open: function () {
                $('.ui-dialog .ui-dialog-titlebar', $(this).parent()).css('border-bottom', '1px solid #d9d9d9');

                var $projectName = $dialog.find('.brtc-va-dialogs-contents > input');
                $projectName.jqxInput({
                    theme: Brightics.VA.Env.Theme
                });
                $projectName.jqxInput('selectAll');

                $dialog.find('.brtc-va-dialogs-buttonbar-ok').jqxButton({
                    theme: Brightics.VA.Env.Theme
                });
                $dialog.find('.brtc-va-dialogs-buttonbar-cancel').jqxButton({
                    theme: Brightics.VA.Env.Theme
                });
                $dialog.find('.brtc-va-dialogs-buttonbar-ok').click(function () {
                    if ($projectName.val().trim() === '') {
                        Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter name.');
                        return;
                    }
                    _this.doCreateProject($projectName.val());
                    $dialog.dialog('close');
                });

                $dialog.find('.brtc-va-dialogs-buttonbar-cancel').click(function () {
                    $dialog.dialog('close');
                });

                $dialog.find('.brtc-va-dialogs-contents > input').focus();
            }
        });

        $dialog.attr('name', 'Create Project');
        $dialog.on('close', function (event) {
            $dialog.dialog('destroy');
            $dialog.remove();
        });
    };

    ProjectViewer.prototype.openImportProjectDialog = function () {
        var _this = this;
        new Brightics.VA.Core.Dialogs.ImportProjectDialog(this.$mainControl, {
            close: function (result) {
                if (result.OK) {
                    _this.$mainControl.trigger('project:create', [{projectId: result.projectId}]);
                    _this.fillProjectList(result.projectId);
                }
            }
        });
    };

    // Create Deploy Success POPUP
    ProjectViewer.prototype.doCreateSuccessPopup = function (data, targetServer, callback) {
        var $dialog = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-newprojectdialog">' +
            '   <div class="brtc-va-dialogs-body" style="overflow: hidden;">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">' +
            '               <div class="brtc-va-dialogs-contents-label-main">Deploy ID</div>' +
            '                   <div class="target-id" style="margin-top: 5px;"></div>' +
            '           </div>' +
            '           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">' +
            '               <div class="brtc-va-dialogs-contents-label-main">Version</div>' +
            '                   <div class="target-version" style="margin-top: 5px;"></div>' +
            '           </div>' +
            '           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">' +
            '               <div class="brtc-va-dialogs-contents-label-main">Variable Flag</div>' +
            '                   <div class="target-gvyn" style="margin-top: 5px;"></div>' +
            '           </div>' +
            '           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">' +
            '               <div class="brtc-va-dialogs-contents-label-main">Target Store</div>' +
            '                   <div class="target-store brtc-va-text-ellipsis" style="margin-top: 5px;"></div>' +
            '           </div>' +
            '           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">' +
            '               <div class="brtc-va-dialogs-contents-label-main">Name</div>' +
            '                   <div class="target-name brtc-va-text-ellipsis" style="margin-top: 5px;"></div>' +
            '           </div>' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        $('body').append($dialog);

        $dialog.find('.brtc-va-dialogs-buttonbar-ok').jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        $dialog.find('.brtc-va-dialogs-buttonbar-ok').click(function () {
            $dialog.dialog('destroy');
            $dialog.remove();
            if (callback) callback();
        });
        $dialog.dialog({
            theme: Brightics.VA.Env.Theme,
            title: 'Success',
            width: 400,
            height: 310,
            modal: true,
            resizable: false,
            open: function () {
                var $targetId = $dialog.find('.target-id');
                var $targetName = $dialog.find('.target-name');
                var $targetVersion = $dialog.find('.target-version');
                var $targetStore = $dialog.find('.target-store');
                var $targetGvYn = $dialog.find('.target-gvyn');

                $targetId.text(data.deployId);
                $targetName.text(data.title);
                $targetName.attr('title', data.title);
                $targetVersion.text(data.version);
                $targetStore.text(targetServer);
                $targetStore.attr('title', targetServer);
                $targetGvYn.text(data.gvYn);
            }
        });

        $dialog.on('close', function (event) {
            $dialog.dialog('destroy');
            $dialog.remove();

            if (callback) callback();
        });

        return true;
    };

    ProjectViewer.prototype.doCreateProject = function (name) {
        var _this = this;
        // var project = {
        //     id: Brightics.VA.Core.Utils.IDGenerator.project.id(),
        //     label: name,
        //     description: '',
        //     creator: Brightics.VA.Env.Session.userId
        // };

        var project = new Brightics.VA.Vo.Project();
        project.setProjectId(Brightics.VA.Core.Utils.IDGenerator.project.id());
        project.setLabel(name);
        project.setDescription('');
        project.setCreator(Brightics.VA.Env.Session.userId);

        Studio.getResourceManager().addProject(project).then(function () {
            _this.$mainControl.trigger('project:create', [{projectId: project.getProjectId()}]);
            _this.fillProjectList(project.getProjectId());
        }).catch(function (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        });
    };

    ProjectViewer.prototype.openMemberManagementDialog = function (projectId) {
        var _this = this;
        new Brightics.VA.Core.Dialogs.MemberManagementDialog(this.$mainControl, {
            projectId: projectId,
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    var type = _this.getSelectedTabType() == 'model' ? 'model' : 'visual';
                    _this.fillProjectList(projectId, type);
                }
            },
            title: 'Member Management',
            appendTo: _this.$parent
        });
    };

    ProjectViewer.prototype.exportProject = function (projectId) {
        var rs = Studio.getResourceService();
        return rs.exportProject(projectId)
            .then(function (json) {
                Brightics.VA.Core.Utils.CommonUtils.downloadJsonFile(
                    JSON.stringify(json),
                    json.data.label || 'untitled'
                );
            })
            .catch(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            });
    };

    ProjectViewer.prototype.openEditProjectDialog = function (projectId) {
        var _this = this;
        var project = Studio.getResourceManager().getProject(projectId);
        var dlg = new Brightics.VA.Core.Dialogs.EditResourceDialog(this.$mainControl, {
            title: 'Edit Project',
            label: project.getLabel(),
            description: project.getDescription(),
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    project.setLabel(dialogResult.label);
                    project.setDescription(dialogResult.description);
                    _this.doEditProject(project).catch(function (err) {
                        if (err.status === 400) {
                            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                        }
                        project.setLabel(dlg.options.label);
                        project.setDescription(dlg.options.description);
                        _this.fillProjectList(project.getProjectId());
                    });
                }
            }
        });
    };

    ProjectViewer.prototype.doEditProject = function (project) {
        var _this = this;
        project.setUpdater(Brightics.VA.Env.Session.userId);

        return Studio.getResourceManager().updateProject(project).then(function () {
            _this.$mainControl.trigger('project:change', [{projectId: project.getProjectId()}]);
            _this.fillProjectList(project.getProjectId());
        });
    };

    ProjectViewer.prototype.deleteProject = function (projectId) {
        var _this = this;
        var project = Studio.getResourceManager().getProject(projectId);

        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                var files = Studio.getResourceManager().getFiles(projectId);
                var fileIds = [];
                for (var i in files) {
                    fileIds.push(files[i].getFileId());
                }
                _this.deleteAlluxioFile(fileIds);
                Studio.getResourceManager().deleteProject(projectId).then(function () {
                    _this.$mainControl.trigger('project:delete', [{projectId: projectId}]);
                    _this.fillProjectList();
                });
            }
        };

        var message = 'Are you sure you want to delete "' + project.getLabel() + '"?';
        Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog(message, closeHandler);
    };

    ProjectViewer.prototype.deleteAlluxioFile = function (files) {
        Brightics.VA.Core.GarbageCollector.immediatelyClearData(files);
    };

    ProjectViewer.prototype.deleteFiles = function (projectId, selected) {
        var _this = this;
        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                var deleteFiles = [];
                var file = Studio.getResourceManager().getFile(projectId, selected[0]);

                for (var i in selected) {
                    deleteFiles.push(new Promise(function (resolve, reject) {
                        Studio.getResourceManager().deleteFile(projectId, selected[i]).then(function (fileId) {
                            _this.$mainControl.trigger('file:delete', [{projectId: projectId, fileId: fileId}]);
                            resolve(fileId);
                        }).catch(function (err) {
                            reject(err.responseJSON);
                        });
                    }));
                }

                Promise.all(deleteFiles).then(function (files) {
                    _this.deleteAlluxioFile(files);
                }).catch(function (error) {
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(error);
                }).then(function () {
                    _this._clearModelList(projectId);
                    _this.fillProjectList(projectId, file.getContents().type);
                });
            }
        };

        var message = 'Are you sure you want to delete the ' + selected.length + ' ' + this.getSelectedTabType() + '(s)?';
        Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog(message, closeHandler);
    };

    ProjectViewer.prototype.duplicateFiles = function (projectId, selected) {
        var _this = this;

        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                _this.fillProjectList(dialogResult.projectId, _this.getSelectedTabType() == 'model' ? 'model' : 'visual');
            }
        };
        var title = this.getSelectedTabType() === 'model' ? 'Duplicate Model' : 'Duplicate Report';
        var files = [];
        for (var i in selected) {
            files.push(Studio.getResourceManager().getFile(projectId, selected[i]));
        }
        new Brightics.VA.Core.Dialogs.DuplicateModelDialog($('body'), {
            files: files,
            title: title,
            resourceManager: Studio.getResourceManager(),
            close: closeHandler,
            width: 600,
            height: 300,
            minWidth: 600,
            minHeight: 300,
            maxWidth: 800,
            maxHeight: 400,
            resizable: false
        });
    };

    // TODO : 리팩토링 필요
    ProjectViewer.prototype.exportFiles = function (projectId, selected, isSingle) {
        var _this = this;
        var closeHandler = function (dialogResult) {
            if (!dialogResult.OK) return;
            _.forEach(selected, function (fid) {
                var file = Studio.getResourceManager().getFile(projectId, fid);
                Studio.getResourceService()
                    .exportJSON(file.getFileId(), projectId, dialogResult.OPTION)
                    .then(function (jsons) {
                        console.log(jsons);
                        var commonUtils = Brightics.VA.Core.Utils.CommonUtils;
                        commonUtils.downloadJsonFile(JSON.stringify(jsons), file.getLabel());
                        return true;
                    })
                    .catch(console.error);
            });
        };

        var contentText = isSingle ?
            'Are you sure you want to export the ' +
            Studio.getResourceManager().getFile(projectId, selected[0]).getLabel() + '?' :
            'Are you sure you want to export the ' + selected.length + ' model(s)?'; // \n ※ Models without an export menu can not be exported.';

        var visualCnt = 0;
        for (var j in selected) {
            var file = Studio.getResourceManager().getFile(projectId, selected[j]);
            if (file && file.getContents().type === 'visual') visualCnt++;
        }
        var optionText = 'Include the data flow(s) along with the selected model.';
        if (visualCnt > 0) optionText = 'Include the data flow(s) along with the selected report.';

        Brightics.VA.Core.Utils.WidgetUtils.openConfirmWithOptionDialog('', contentText, optionText, closeHandler);
    };

    ProjectViewer.prototype.getSelectedTabType = function () {
        return this.$mainControl.find('.brtc-va-workspace-model-list-type-item.model').hasClass('selected') ? 'model' : 'report';
    };

    ProjectViewer.prototype.show = function () {
        this.$parent.removeClass('brtc-va-workspace-popup');
        this.$parent.css('display', 'block');
        this.$mainControl.css('display', 'block');
    };

    ProjectViewer.prototype.hide = function () {
        this.$parent.css('display', 'none');
        this.$mainControl.css('display', 'none');
    };

    ProjectViewer.prototype.showPopup = function () {
        var _this = this;
        this.fillProjectList(null, null, function () {
            _this.$parent.addClass('brtc-va-workspace-popup');
            _this.$parent.css('display', 'block');
            _this.$mainControl.css('display', 'flex');
            _this.renderProjectListContainer();
        });
    };

    ProjectViewer.prototype.setChartContentAddedReport = function (selectedModels) {
        this.chartContentAddedReport = {};
        for (var i in selectedModels) {
            var projectId = selectedModels[i]['project_id'];
            var fileId = selectedModels[i].id;
            if (!this.chartContentAddedReport[projectId]) this.chartContentAddedReport[projectId] = {};
            this.chartContentAddedReport[projectId][fileId] = selectedModels[i];
        }
    };

    Brightics.VA.Workspace.ProjectViewer = ProjectViewer;
}).call(this);

/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Properties(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.factory = this.getPropertyPageFactory();
        this.retrieveParent();
        this.createControls();
        this.init();
    }

    Properties.prototype.init = function () {
        var _this = this;
        this.commandListener = function (command) {
            if (_this.page) _this.page.onCommand(command);
        };

        this.problemsListener = function (event, mid, problems) {
            if (_this.page && _this.activeEditor.getModel().mid == mid) _this.page.onProblem(problems);
        };

        this.$contentsArea.bind('fireCommand', function (event, command) {
            if (_this.activeEditor) _this.activeEditor.getCommandManager().execute(command);
        });

        Studio.getInstance().addProblemListener(this.problemsListener);
    };

    Properties.prototype.getPropertyPageFactory = function () {
        return new PropertyPageFactory();
    };


    Properties.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    Properties.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-views-properties">' +
            '   <div class="brtc-va-views-properties-contents" />' +
            '</div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);

        this.$contentsArea = this.$mainControl.find('.brtc-va-views-properties-contents');
        this.$mainControl.perfectScrollbar();
    };

    Properties.prototype.editorChanged = function (editor) {
        this.activeEditor = null;
    };

    Properties.prototype.selectionChanged = function (selection) {
        var _this = this;
        if (selection && this.selection !== selection) {
            if(this.page) this.page.destroy();
            this.$contentsArea.empty();

            this.page = this.factory.createPage(this.$contentsArea, selection);
            this.page.parent = this;
            this.page.setInput(selection).then(function () {
                _this.page.removeValidation();
                _this.page.renderValidation();
            });
        } else if (!selection) {
            if(this.page) this.page.destroy();
            this.$contentsArea.empty();
            this.page = null;
        }
        this.selection = selection;
    };

    Brightics.VA.Core.Views.Properties = Properties;

    function PropertyPageFactory() {
    }

    PropertyPageFactory.prototype.createPage = function ($parent, unit) {
        return new Brightics.VA.Core.Views.Pages.PropertyPage($parent, {
            width: '100%',
            height: '100%'
        })
    };

}).call(this);
/**
 * Created by daewon.park on 2016-10-17.
 */
/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var PATH_ROOT = '';
    var PATH_SHARED = PATH_ROOT + '/shared/upload';
    var PATH_USERS = PATH_ROOT + '/' + Brightics.VA.Env.Session.userId + '/upload';
    var ELEMENT_HIDE = 'brtc-va-controls-repository-viewer-element-hide';

    function RepositoryViewer(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.loadedFolders = {};
        this.retrieveParent();
        this.createControls();
    }

    RepositoryViewer.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    RepositoryViewer.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-controls-repository-viewer">' +
            '   <input  class="brtc-va-controls-repository-viewer-search" type="search">' +
            '   <div    class="brtc-va-controls-repository-viewer-more"></div>' +
            '   <button class="brtc-va-controls-repository-viewer-upload"><div class="brtc-va-icon"></div>Add</button>' +
            '   <button class="brtc-va-controls-repository-viewer-refresh"><div class="brtc-va-icon"></div>Refresh</button>' +
            '   <div    class="brtc-va-controls-repository-viewer-tree"></div>' +
            '   <div    class="brtc-va-controls-repository-viewer-context-menu"></div>' +
            '</div>');

        this.$parent.append(this.$mainControl);

        this.createSearchControl(this.$mainControl.find('.brtc-va-controls-repository-viewer-search'));
        this.createRefreshButton(this.$mainControl.find('.brtc-va-controls-repository-viewer-refresh'));
        this.createUploadButton(this.$mainControl.find('.brtc-va-controls-repository-viewer-upload'));
        this.createMoreButton(this.$mainControl.find('.brtc-va-controls-repository-viewer-more'));
        this.createTreeControl(this.$mainControl.find('.brtc-va-controls-repository-viewer-tree'));
        this.createContextMenu(this.$mainControl.find('.brtc-va-controls-repository-viewer-context-menu'));
        this.$searchControl.focus();
    };

    RepositoryViewer.prototype.destroy = function () {
        this.$ctxMenu.jqxMenu('destroy');
        this.$tree.jqxTree('destroy');
    };

    RepositoryViewer.prototype.createSearchControl = function ($control) {
        var _this = this;
        this.$searchControl = $control.jqxInput({
            placeHolder: 'Search Item',
            theme: Brightics.VA.Env.Theme
        });

        this.throttledApplyFilter = _.throttle(function () {
            _this.applyFilter();
        }, 500);
        this.$searchControl.keyup(function (evt) {
            _this.throttledApplyFilter();
        });
        this.$searchControl.on('search', function (event) {
            _this.throttledApplyFilter();
        });
    };

    RepositoryViewer.prototype.applyFilter = function () {
        var _this = this;
        var filterValue = this.$searchControl.val().toLowerCase().trim();
        if (filterValue.length > 0) {
            _.forEach(_this.$tree[0].querySelectorAll('li'), function (el) {
                el.classList.add(ELEMENT_HIDE);
            });
            var items = _this.$tree.jqxTree('getItems');
            $.each(items, function (index, item) {
                if (item.value) {
                    var path = item.value;
                    var idx = path.lastIndexOf('/');
                    var parent = path.substring(0, idx);
                    if (parent == PATH_SHARED || parent.indexOf('/' + Brightics.VA.Env.Session.userId + '/upload') == 0) {
                        var file = path.substring(idx + 1).toLowerCase();
                        if (file.indexOf(filterValue) > -1) {
                            item.element.classList.remove(ELEMENT_HIDE);
                            var parentElement = item.parentElement;
                            while (parentElement) {
                                parentElement.classList.remove(ELEMENT_HIDE);
                                var parentItem = _this.$tree.jqxTree('getItem', parentElement);
                                parentElement = parentItem.parentElement;
                            }
                        }
                    }
                }
            });
        } else {
            _.forEach(_this.$tree[0].querySelectorAll('li'), function (el) {
                el.classList.remove(ELEMENT_HIDE);
            });
        }

        this.debouncedTriggerResize = this.debouncedTriggerResize || _.debounce(function () {
            $(window).trigger('resize');
        }, 1000);
        this.debouncedTriggerResize();

        if (_this.$tree.find('.brtc-va-controls-repository-viewer-loading').length > 0) {
            _this.$tree.jqxTree('expandAll');
            _this.throttledApplyFilter();
        }
    };

    RepositoryViewer.prototype.createRefreshButton = function ($control) {
        var _this = this;
        this.$refreshButton = $control.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$refreshButton.click(function (event) {
            _this.$searchControl.val('');
            _this.initRootItem();
            _this.loadedFolders = {};
            Brightics.VA.RepositoryQueryTemplate.browse(PATH_ROOT, true, {blocking: true});
        });
    };

    RepositoryViewer.prototype.createUploadButton = function ($control) {
        var _this = this;
        this.$uploadButton = $control.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$uploadButton.click(function (event) {
            new Brightics.VA.Core.Wizards.DataUploadWizard(_this.$mainControl, {
                mode: 'open',
                close: function (dialogResult) {
                    if (dialogResult.OK) {
                        if (dialogResult.path) {
                            _this.addItem(dialogResult.path);
                            _this.selectItem(dialogResult.path, true);
                        }
                        _this.$searchControl.val('');
                        Brightics.VA.RepositoryQueryTemplate.browse(PATH_ROOT, true, {blocking: true});
                    }
                }
            });
        });
    };

    RepositoryViewer.prototype.createMoreButton = function ($control) {
        var _this = this;
        $control.click(function (event) {
            _this.openContextMenu($(event.currentTarget));
        });
    };

    RepositoryViewer.prototype.createTreeControl = function ($control) {
        var _this = this;

        this.$tree = $control.jqxTree({
            theme: Brightics.VA.Env.Theme,
            width: 'calc(100% - 2px)',
            height: 'calc(100% - 82px)',
            allowDrag: false,
            allowDrop: false
        });

        this.initRootItem();

        this.$tree.on('select', function () {
            _this.pended = null;
        });

        this.$tree.on('expand', function (event) {
            var loader = false;
            var loaderItem = null;
            var $element = $(event.args.element);
            var children = $element.find('ul:first').children();
            $.each(children, function () {
                var item = _this.$tree.jqxTree('getItem', this);
                if (item && !item.value) {
                    // item ??value 가 ?�으�?(loading...) ?�다.
                    loaderItem = item;
                    loader = true;
                    return false;
                }
            });
            if (loader && !_this.loadedFolders[$element.attr('id')]) {
                _this.loadedFolders[$element.attr('id')] = true;
                var path = _this.$tree.jqxTree('getItem', $element[0]).value;
                Brightics.VA.RepositoryQueryTemplate.browse(path, false, {blocking: false}).done(function (files) {
                    _this.$tree.jqxTree('removeItem', loaderItem.element);

                    if (files.length > 0) {
                        var items = files.filter(function (file) {
                            if (file.path.indexOf(path) == 0) {
                                return file;
                            }
                        }).map(function (file) {
                            var idx = file.path.lastIndexOf('/');
                            var parent = file.path.substring(0, idx);
                            if (parent == '/' + Brightics.VA.Env.Session.userId + '/upload/') {
                                return _this.createFolderItem(file.path);
                            } else {
                                return _this.createFileItem(file.path);
                            }
                        });

                        if (items.length > 0) {
                            _this.$tree.jqxTree('addTo', items, $element[0]);
                        }
                        _this.$tree.jqxTree('refresh');
                        if (_this.pended) {
                            _this.selectItem(_this.pended);
                        }
                        _this._updateTooltip();
                    }
                }).fail(function (err) {
                    _this.$tree.jqxTree('removeItem', loaderItem.element);
                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                });
            }
        });
    };

    RepositoryViewer.prototype.openContextMenu = function ($target) {
        var left = $target.offset().left + $target.width() - 140 - 2;
        var top = $target.offset().top + $target.height() + 10;

        this.$ctxMenu.jqxMenu('open', left, top);
    };

    RepositoryViewer.prototype.createContextMenu = function ($control) {
        var _this = this;

        $control.append('' +
            '<ul>' +
            '   <li action="rename">Rename</li>' +
            '   <li action="delete">Delete</li>' +
            '   <li action="export">Export</li>' +
            '</ul>');

        this.$ctxMenu = $control.jqxMenu({
            theme: Brightics.VA.Env.Theme,
            width: '140px',
            height: '20px',
            autoOpenPopup: false,
            popupZIndex: 50000,
            mode: 'popup',
            animationHideDuration: 0,
            animationShowDuration: 0
        });

        this.$ctxMenu.on('itemclick', function (event) {
            var path;
            var $el = $(event.args);
            if ($el.attr('action') === 'rename') {
                path = _this.getSelectedFile();
                if (path) {
                    _this.openRenameDialog(path);
                } else {
                    Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('There is no selected file.');
                }
            } else if ($el.attr('action') === 'delete') {
                path = _this.getSelectedFile();
                if (path) {
                    _this.openDeleteDialog(path);
                } else {
                    Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('There is no selected file.');
                }
            } else {
                path = _this.getSelectedFile();
                if (path) {
                    _this.openExportDialog(path);
                } else {
                    Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('There is no selected file.');
                }
            }
        });
    };

    RepositoryViewer.prototype.openExportDialog = function (path) {
        var _this = this;
        var userId = Brightics.VA.Env.Session.userId;

        var offset = path.lastIndexOf('/');
        var dir = path.substring(0, offset);
        var name = path.substring(offset + 1);
        new Brightics.VA.Core.Wizards.DataExportWizard(_this.$mainControl, {
            name: name,
            path: path,
            mode: 'open',
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    _this.initRootItem();
                    Brightics.VA.RepositoryQueryTemplate.browse(PATH_ROOT, true, {blocking: true});
                }
            },
            userid: userId
        });
    };

    RepositoryViewer.prototype.openRenameDialog = function (path) {
        var _this = this;
        var offset = path.lastIndexOf('/');
        var dir = path.substring(0, offset);
        var name = path.substring(offset + 1);
        new Brightics.VA.Core.Dialogs.RenameDialog(this.$mainControl, {
            name: name,
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    Brightics.VA.RepositoryQueryTemplate.move(path, dir + '/' + dialogResult.newName, {blocking: true}).done(function () {
                        _this.$searchControl.val('');
                        _this.initRootItem();
                        Brightics.VA.RepositoryQueryTemplate.browse(PATH_ROOT, true, {blocking: false});
                    }).fail(function (err) {
                        Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                    });
                }
            },
            title: 'Rename'
        });
    };

    RepositoryViewer.prototype.openDeleteDialog = function (path) {
        var _this = this;
        var offset = path.lastIndexOf('/');
        var name = path.substring(offset + 1);
        var message = 'Are you sure you want to delete "' + name + '"?';
        Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog(message, function (dialogResult) {
            if (dialogResult.OK) {
                Brightics.VA.RepositoryQueryTemplate.delete(path, {blocking: true}).done(function () {
                    _this.initRootItem();
                    Brightics.VA.RepositoryQueryTemplate.browse(PATH_ROOT, true, {blocking: false});
                }).fail(function (err) {
                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                });
            }
        });
    };

    RepositoryViewer.prototype.createLoadingItem = function () {
        return {
            html: '<div class="brtc-va-controls-repository-viewer-loading"><div class="brtc-va-icon"></div> Loading...</div>'
        };
    };

    RepositoryViewer.prototype.createFolderItem = function (path) {
        var idx = path.lastIndexOf('/');
        return {
            html: '<i class="fa fa-folder" aria-hidden="true"></i>' + _.escape(path.substring(idx + 1)),
            value: path,
            items: [this.createLoadingItem()]
        };
    };

    RepositoryViewer.prototype.createFileItem = function (path) {
        var idx = path.lastIndexOf('/');
        return {
            html: '<i class="fa fa-file-o" aria-hidden="true"></i>' + _.escape(path.substring(idx + 1)),
            value: path,
            items: []
        };
    };

    RepositoryViewer.prototype._updateTooltip = function () {
        var items = this.$tree.jqxTree('getItems');
        $.each(items, function () {
            $(this.titleElement).attr('title', this.label);
        });
    };

    RepositoryViewer.prototype.initRootItem = function () {
        this.$tree.jqxTree('clear');

        var items = [{
            html: '<i class="fa fa-folder" aria-hidden="true"></i>shared',
            value: '/shared',
            expanded: true,
            items: [{
                html: '<i class="fa fa-folder" aria-hidden="true"></i>upload',
                value: '/shared/upload',
                items: [this.createLoadingItem()]
            }]
        },
            {
                html: '<i class="fa fa-folder" aria-hidden="true"></i>' + Brightics.VA.Env.Session.userId,
                value: '/' + Brightics.VA.Env.Session.userId,
                expanded: true,
                items: [{
                    html: '<i class="fa fa-folder" aria-hidden="true"></i>upload',
                    value: '/' + Brightics.VA.Env.Session.userId + '/upload',
                    items: [this.createLoadingItem()]
                }]
            }];

        this.$tree.jqxTree('addTo', items, this.$tree[0]);
        this._updateTooltip();
    };

    RepositoryViewer.prototype.getSelectedPath = function () {
        var item = this.$tree.jqxTree('getSelectedItem');
        return item ? item.value : undefined;
    };

    RepositoryViewer.prototype.render = function () {
        this.$tree.jqxTree('render');
    };

    RepositoryViewer.prototype.getSelectedFile = function () {
        var item = this.$tree.jqxTree('getSelectedItem');
        if (item && item.value && item.value.indexOf(PATH_SHARED + '/') == 0) {
            return item.value;
        } else if (item && item.value && item.value.indexOf('/' + Brightics.VA.Env.Session.userId + '/upload/') == 0) {
            // '/brtc/repo/users/daewon77.park@samsung.com/iris.csv'.split('/') ?�면 결과??
            // ["", "brtc", "repo", "users", "daewon77.park@samsung.com", "iris.csv"] ?�렇�??�온??
            // �? 배열 ?�기가 6 ?�어?��? ?�일 path ??것이??
            var segments = item.value.split('/');
            if (segments.length == 4) {
                return item.value;
            }
        }
    };

    RepositoryViewer.prototype.getSelectedFileType = function () {
        var selected = this.$tree.jqxTree('getSelectedItem');
        if (selected) {
            var el = _.get(selected, 'element');
            var div = el.querySelector('div');
            if (div && div.children[0]) {
                return div.children[0].classList.contains('fa-folder') ? 'folder' : 'file';
            }
        }
        return undefined;
    };

    var exporter = {
        progress: function (userId, jobId) {
            var rep = {
                fail: function (callback) {
                    this.failCallback = callback;
                    return this;
                },
                done: function (callback) {
                    this.doneCallback = callback;
                    return this;
                }
            };

            var checkStatus = function () {
                var opt = {
                    url: 'api/va/v2/analytics/jobs/' + jobId,
                    type: 'GET',
                    blocking: false
                };
                $.ajax(opt).done(function (res) {
                    if (res.status === 'FAIL' || res.status === 'ABORT') {
                        if (rep.failCallback) rep.failCallback();
                    }
                    else if (res.status === 'SUCCESS') {
                        if (rep.doneCallback) rep.doneCallback();
                    }
                    else {
                        setTimeout(checkStatus, 3000);
                    }
                }).fail(function (err) {
                    if (rep.failCallback) rep.failCallback();
                });
            };
            setTimeout(checkStatus, 3000);

            return rep;
        },
        unload: function (userId, mid, inTable, outPath, delimiters) {
            var _this = this;
            var rep = {
                fail: function (callback) {
                    this.failCallback = callback;
                    return this;
                },
                done: function (callback) {
                    this.doneCallback = callback;
                    return this;
                }
            };
            var jobId = 'va_' + Date.now();

            if (delimiters) {
                if (!delimiters.delimiter) delimiters.delimiter = ',';
                if (!delimiters['array-delimiter']) delimiters['array-delimiter'] = ';';
                if (!delimiters['key-value-delimiter']) delimiters['key-value-delimiter'] = ':';
            } else {
                delimiters = {
                    delimiter: ',',
                    'array-delimiter': ';',
                    'key-value-delimiter': ':'
                }
            }

            var option = {
                'user': userId,
                'jid': jobId,
                'main': mid,
                'args': {},
                'models': {}
            };
            option.models[mid] = {
                'mid': mid,
                'type': "data",
                'functions': [
                    {
                        'fid': 'f-unload',
                        'func': 'unload',
                        'inData': [inTable],
                        'name': 'OutData',
                        'param': {
                            'io-mode': 'write',
                            'fs-type': 'alluxiocsv',
                            'df-names': [inTable],
                            'fs-paths': [outPath],
                            'delimiter': delimiters.delimiter,
                            'array-delimiter': delimiters['array-delimiter'],
                            'key-value-delimiter': delimiters['key-value-delimiter']
                        }
                    }
                ],
                'links': [],
                'entries': ['f-unload']
            };

            var opt = {
                url: 'api/va/v2/analytics/jobs',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(option),
                blocking: false
            };
            $.ajax(opt).done(function () {

                _this.progress(userId, jobId).done(rep.doneCallback).fail(rep.failCallback);

            }).fail(function () {
                if (rep.failCallback) rep.failCallback();
            });

            return rep;
        },
        export: function (userId, mid, inPath, outPath) {
            var _this = this;
            var rep = {
                fail: function (callback) {
                    this.failCallback = callback;
                    return this;
                },
                done: function (callback) {
                    this.doneCallback = callback;
                    return this;
                }
            };

            var jobId = 'va_' + Date.now();
            var option = {
                'user': userId,
                'jid': jobId,
                'main': mid,
                'args': {},
                'models': {}
            };
            option.models[mid] = {
                'mid': mid,
                'type': "data",
                'functions': [
                    {
                        'fid': 'f-export',
                        'func': 'exportData',
                        'name': 'ExportData',
                        'param': {
                            'copy-to': 'alluxio',
                            'is-delete': 'true',
                            'input-path': inPath,
                            'output-path': outPath
                        }
                    }
                ],
                'links': [],
                'entries': ['f-export']
            };

            var opt = {
                url: 'api/va/v2/analytics/jobs',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(option),
                blocking: false
            };
            $.ajax(opt).done(function () {

                _this.progress(userId, jobId).done(rep.doneCallback).fail(rep.failCallback);

            }).fail(function () {
                if (rep.failCallback) rep.failCallback();
            });

            return rep;
        },
        download: function (remotePath, localFileName) {
            var option = {
                'remotePath': remotePath,
                'localFileName': localFileName
            };
            var opt = {
                url: 'api/va/v2/data/download',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(option),
                blocking: false
            };
            return $.ajax(opt).done(function (result) {
                window.open('api/va/v2/repo/download/files/' + result.file);
            });
        }
    };

    RepositoryViewer.prototype.addItem = function (path) {
        var repo = path.split('/')[1];
        var fname = path.split('/')[3];
        var repoItem = this.getRepo(repo);
        var uploadFolderItem = this.getChildren(repoItem)[0];
        var files = this.getChildren(uploadFolderItem);
        if (files.length > 0 && !files[0].value) return;
        var idx = 0;
        while (idx < files.length && files[idx].label.localeCompare(fname) < 0) {
            idx++;
        }
        if (idx < files.length && files[idx].label.localeCompare(fname) === 0) {
            return;
        }
        var newFile = this.createFileItem(path);
        if (idx >= files.length) {
            this.$tree.jqxTree('addTo', newFile, uploadFolderItem);
        } else {
            this.$tree.jqxTree('addBefore', newFile, files[idx]);
        }
    };

    RepositoryViewer.prototype.getChildren = function (parItem) {
        var items = this.$tree.jqxTree('getItems');
        if (!parItem) {
            return items.filter(function (item) {
                return !item.parentElement;
            });
        }
        return items.filter(function (item) {
            return item.parentElement === parItem.element;
        });
    };

    RepositoryViewer.prototype.getRepo = function (name) {
        var items = this.getChildren();
        return items.find(function (item) {
            return item.label === name;
        });
    };

    RepositoryViewer.prototype.selectItem = function (path, pending) {
        var _this = this;
        var repo = path.split('/')[1];
        var repoItem = this.getRepo(repo);
        var uploadFolderItem = this.getChildren(repoItem)[0];
        var select = function () {
            var files = _this.getChildren(uploadFolderItem);
            var target = files.find(function (file) {
                return file.value === path;
            });
            if (target) {
                _this.$tree.jqxTree('selectItem', target.element);
                return true;
            }
            return false;
        };
        this.$tree.jqxTree('expandItem', uploadFolderItem.element);
        if (select()) return;
        if (pending) this.pended = path;
    };

    Brightics.VA.Core.Controls.RepositoryViewer = RepositoryViewer;

}).call(this);

/**
 * Created by SDS on 2018-02-26.
 */
/**
 * Created by sds on 2018-02-26.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ResultReport(parentId, options) {
        this.parentId = parentId;
        this.options = options || {};

        this.retrieveParent();
        this.createControls();
        this.initialReport();
    }

    ResultReport.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ResultReport.prototype.createControls = function () {
        this.$parent.empty();

        this.$mainControl = $('<div class="brtc-va-views-report-result-contents"></div>');
        this.$mainControl.css({
            'width': '100%',
            'height': '100%',
            'margin-left': '10px'
        });
        this.$parent.append(this.$mainControl)

        $(document).bind('contextmenu', function (e) {
            return false;
        });
    };

    ResultReport.prototype.initialReport = function () {
        var _this = this;

        Brightics.VA.Env.Session.userId = this.options.userId;

        var resulReportContent = this.options.html;
        var chartInfos = JSON.parse(this.options.chartOptions);

        for (var i in chartInfos.charts) {
            var chartId = chartInfos.charts[i].id;
            var replace = "<code>{&quot;chart&quot;:&quot;" + chartId + "&quot;}<\/code>";
            var re = new RegExp(replace, "g");

            resulReportContent = resulReportContent.toString().replace(re, '<div id="' + chartId + '" class="' + chartId + '" style="width: 600px; height: 400px"></div>')
        }
        this.$mainControl.html(resulReportContent);

        this.dataProxy = new Brightics.VA.Core.Editors.Sheet.DataProxy(this.$mainControl, this.options.mid);

        var chartInfos = JSON.parse(this.options.chartOptions);
        for (var i in chartInfos.charts) {
            var chartId = chartInfos.charts[i].id;
            var chartOptions = chartInfos.charts[i].options;

            var source = chartInfos.charts[i].options.source;

            var $chartUnit = this.$mainControl.find('.' + chartId);
            $chartUnit.css({
                'width': '580px',
                'height': '400px',
                'margin-bottom': '15px'
            });

            this.chartRenderer($chartUnit, chartOptions, source);
        }

        this.$parent.perfectScrollbar();
    };

    ResultReport.prototype.chartRenderer = function ($chartUnit, options, source) {
        this.dataProxy.requestData(source, function (table) {
            options.source = {
                "dataType": "local",
                "localData": [
                    {
                        "dataType": "rawdata",
                        "columns": table.columns,
                        "data": table.data
                    }
                ]
            };

            $chartUnit.bcharts(options);
        }, function (err) {
        });
    };

    Brightics.VA.Core.Views.ResultReport = ResultReport;

}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */

/* global _, CodeMirror */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var PREFIX = 'variable';
    var SUFFIX = '';

    var VARIABLE = 'variable';
    var NAME = 'name-control';
    var VALUE = 'value-control';

    function Variable(parentId, options) {
        this.parentId = parentId;
        this.options = options || {};

        _retrieveParent.bind(this)();

        this.init();
        this.createControls();
    }

    var _retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    Variable.prototype.initTempDataStorage = function () {
        this.tempDataStorage = (function () {
            var storage = [];

            var newData = function (id, data) {
                return {
                    id: id,
                    data: data || {}
                };
            };

            var doIfDataExistsById = function (id, fn) {
                var index = _.findIndex(storage, function (dict) {
                    return dict.id === id;
                });
                if (index >= 0) return fn(storage[index].data);
            };

            var doIfDataExistsByIndex = function (index, fn) {
                if (storage[index]) return fn(storage[index].data);
            };

            var partialSetData = function (key, val) {
                return _.partial(_.set, _, key, val);
            };

            var partialGetData = function (key) {
                return _.partial(_.get, _, key);
            };

            return {
                init: function () {
                    storage = [];
                },
                push: function (id) {
                    storage.push(newData(id));
                },
                removeById: function (id) {
                    var index = _.findIndex(storage, function (dict) {
                        return dict.id === id;
                    });
                    if (index >= 0) storage.splice(index, 1);
                },
                splice: function (index, cnt, id) {
                    if (id) {
                        storage.splice(index, cnt, newData(id));
                    } else {
                        storage.splice(index, cnt);
                    }
                },
                putDataById: function (id, key, val) {
                    doIfDataExistsById(id, partialSetData(key, val));
                },
                getDataById: function (id, key) {
                    return doIfDataExistsById(id, partialGetData(key));
                },
                putDataByIndex: function (index, key, val) {
                    doIfDataExistsByIndex(index, partialSetData(key, val));
                },
                getDataByIndex: function (index, key) {
                    return doIfDataExistsByIndex(index, partialGetData(key));
                }
            };
        }());
    };

    Variable.prototype.init = function () {
        var _this = this;

        this.isRendered = false;
        this.propertyControls = [];
        this.index = 0;
        this.initTempDataStorage();

        this.commandListener = function (command) {
            if (_this.isRendered) {
                _this.isRendered = false;
                _this.handleCommand(command);
                _this.isRendered = true;
            } else {
                _this.handleCommand(command);
            }
        };

        this.options.editor.addCommandListener(this.commandListener);
        this.options.editor.addGoHistoryListener(this.commandListener);
    };

    Variable.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('' +
            '<div class="brtc-va-views-variable">' +
            '       <input type="button" class="brtc-va-tools-sidebar-variable-button add-variable-button" value="+ Add Variable"/>' +
            '       <div class="brtc-va-tools-sidebar-variable-filter brtc-va-searcharea">' +
            '           <input type="search" class="brtc-va-tools-sidebar-variable-filter-input" maxlength="80"/>' +
            '       </div>' +
            '       <div class="brtc-va-tools-sidebar-variable-list">' +
            '       </div>' +
            '</div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);

        this.$filter = this.$mainControl.find('.brtc-va-tools-sidebar-variable-filter');
        this.$variableList = this.$mainControl.find('.brtc-va-tools-sidebar-variable-list');

        this.createFilterControl();
        this.createAddVariableButton();

        this.refresh();

        this.$variableList.perfectScrollbar();
    };

    Variable.prototype.refresh = function () {
        this.variables = [];
        this.propertyControls = [];
        this.tempDataStorage.init();
        this.$variableList.find('.brtc-va-tools-sidebar-variable-deck').remove();

        this.parseVariables();
        this.renderValues(this.variables);
    };

    Variable.prototype.parseVariables = function () {
        if (this.options.editor.getModel().type === 'control') {
            this.variables = this.options.editor.getModel().variables;
        } else {
            for (var key in this.options.editor.getModel().variables) {
                this.variables.push({
                    name: key,
                    type: this.options.editor.getModel().variables[key].type,
                    value: this.options.editor.getModel().variables[key].value || ''
                });
            }
        }
    };

    Variable.prototype.createFilterControl = function () {
        var _this = this;
        var $filterInput = this.$filter.find('.brtc-va-tools-sidebar-variable-filter-input');

        $filterInput.jqxInput({
            placeHolder: 'Search Variable',
            theme: Brightics.VA.Env.Theme
        });
        var applyFilter = function (event) {
            var filterValue = event.target.value.toLowerCase();

            var variableItems = _this.$mainControl.find('.brtc-va-tools-sidebar-variable-name');
            $.each(variableItems, function (index, item) {
                $(item).find('.CodeMirror').each(function (i, $el) {
                    var matched = $el.CodeMirror.getValue().toLowerCase().indexOf(filterValue) > -1;
                    $(item).parents(".brtc-va-tools-sidebar-variable-deck").css('display', matched ? 'block' : 'none');
                });
            });
            _this.$variableList.perfectScrollbar('update');
        };
        $filterInput.keyup(function (event) {
            applyFilter(event);
        });

        $filterInput.on('search', function () {
            applyFilter(event);
        });
    };


    Variable.prototype.createAddVariableButton = function () {
        var _this = this;
        this.$addVariableButton = this.$mainControl.find(".add-variable-button");
        this.$addVariableButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        this.$addVariableButton.click(function () {
            var variable = { type: 'string', name: PREFIX + ++_this.index, value: '' };
            _this.createAddVariableCommand(variable);
            _this.$variableList.perfectScrollbar('update');
        });
    };

    Variable.prototype.removeVariableControl = function (variable, index) {
        var target = index;
        if (index <= -1) {
            target = this.propertyControls.length - 1;
        }

        Brightics.VA.Core.Utils.WidgetUtils.destroyJqxControl(this.propertyControls[target]);
        this.propertyControls[target].remove();
        this.propertyControls.splice(target, 1);
        this.tempDataStorage.splice(target, 1);
    };

    Variable.prototype.updateVariableControl = function (variable, index) {
        var $variable = this.propertyControls[index];
        var $type = $variable.find('.brtc-va-tools-sidebar-variable-type');
        var $name = $variable.find('.brtc-va-widget-contents-input-control');
        var $value = $variable.find('.brtc-va-tools-sidebar-variable-value');

        $type.val(variable.type);

        var getData = _.partial(this.tempDataStorage.getDataByIndex, index);
        this.setVariableName(getData(NAME), variable.name);
        getData(VALUE).setInputValue(variable.value);
    };

    Variable.prototype.setVariableName = function (codeMirror, value) {
        var nameValue = this.wrap(value);
        codeMirror.setValue(nameValue);
        codeMirror.markText(
            {line: 0, ch: 0},
            {line: 0, ch: 2},
            {
                readOnly: true,
                inclusiveLeft: true,
                atomic: true
            });
        codeMirror.markText(
            {line: 0, ch: nameValue.length - 1},
            {line: 0, ch: nameValue.length},
            {
                readOnly: true,
                inclusiveRight: true,
                atomic: true
            });
    };

    Variable.prototype.createVariableControl = function (variable, index) {
        var _this = this;
        var $variable = $('' +
            '<div class="brtc-va-tools-sidebar-variable-deck">' +
            '   <div class ="brtc-va-tools-sidebar-variable-remove" />' +
            '   <div class="controls">' +
            '       <div class="control-row">' +
            '            <div class="brtc-va-editors-sheet-controls-wrapper brtc-va-tools-sidebar-variable-name">' +
            '                <textarea  class="brtc-va-widget-contents-input-control"/>' +
            '            </div>' +
            '       </div>' +
            '       <div class="control-row">' +
            '            <div class="brtc-va-tools-sidebar-variable-type"/>' +
            '       </div>' +
            '       <div>' +
            '            <div class="brtc-va-tools-sidebar-variable-value" />' +
            '       </div>' +
            '   </div>' +
            '</div>');

        var storageId = _.uniqueId('var-');
        var putData = _.partial(this.tempDataStorage.putDataById, storageId);
        var getData = _.partial(this.tempDataStorage.getDataById, storageId);

        if (index || index > -1) {
            var $temp = this.propertyControls[index];
            if ($temp) $variable.insertBefore($temp);
            else this.$variableList.append($variable);
            this.propertyControls.splice(index, 0, $variable);
            this.tempDataStorage.splice(index, 0, storageId);
        } else {
            this.$variableList.append($variable);
            this.propertyControls.push($variable);
            this.tempDataStorage.push(storageId);
        }

        putData(VARIABLE, variable);

        var $type = $variable.find('.brtc-va-tools-sidebar-variable-type');
        var $name = $variable.find('.brtc-va-widget-contents-input-control');
        var $value = $variable.find('.brtc-va-tools-sidebar-variable-value');
        var $remove = $variable.find('.brtc-va-tools-sidebar-variable-remove');

        this.createDropDownList($type, {
            source: [{
                label: 'String',
                value: 'string'
            },
            {
                label: 'Number',
                value: 'number'
            },
            {
                label: 'Array String Value',
                value: 'array[string]'
            },
            {
                label: 'Array Number Value',
                value: 'array[number]'
            },
            {
                label: 'Calculation Value',
                value: 'calculation'
            }],
            displayMember: 'label',
            valueMember: 'value'
        });
        $type.on('change', function (event) {
            var variable = getData(VARIABLE);
            var type = $type.jqxDropDownList('val');

            getData(VALUE).setVariableType(type);
            _this.createUpdateVariableCommand(variable, {
                value: (type === 'calculation')? Brightics.VA.Core.Utils.VariableUtils.wrap(variable.value) : Brightics.VA.Core.Utils.VariableUtils.strip(variable.value),
                type: type
            });
        });

        var codeMirrorName = CodeMirror.fromTextArea($name[0], {
            mode: 'brtc-controlflow-variable',
            scrollbarStyle: 'null',
            placeholder: '',
            lineWrapping: false,
            lineNumbers: false,
            viewportMargin: Infinity,
            hintOptions: {
                list: []
            },
            extraKeys: {
                'Tab': false, // Let focus go to next control
                'Shift-Tab': false // Let focus go to previous control
            }
        });
        Brightics.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(codeMirrorName, {'valid-type': 'type1'});
        codeMirrorName.on('blur', function (instance, event) {
            var variable = getData(VARIABLE);
            var newName = _this.strip(instance.getValue());

            var exist = false;
            for (var i in _this.variables) {
                if (_this.variables[i].name == newName) {
                    exist = true;
                    break;
                }
            }

            if (variable.name !== newName) {
                if (exist) {
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('The typed name already exists. Variable Name must be unique.');
                    _this.setVariableName(codeMirrorName, variable.name);
                } else {
                    _this.createUpdateVariableCommand(variable, {name: newName});
                }
            }
        });
        putData(NAME, codeMirrorName);

        var control = Brightics.VA.Core.Widget.Factory.variableControl($value, {
            variable: {
                temp: {
                    type: 'literal',
                    value: variable.value,
                    'variable-type': variable.type
                }
            },
            onChangeCallback: function (variableObj) {
                var variable = getData(VARIABLE);
                _this.createUpdateVariableCommand(variable, {value: variableObj.value});
            },
            'valid-type': 'type1'
        });
        putData(VALUE, control);

        $remove.click(function (event) {
            var variable = getData(VARIABLE);
            _this.createRemoveVariableCommand(variable);
            _this.$variableList.perfectScrollbar('update');
            event.stopPropagation();
        });

        $type.val(variable.type);
        this.setVariableName(codeMirrorName, variable.name);
        control.setInputValue(variable.value);

        try {
            var idx = parseInt(variable.name.split(PREFIX)[1].replace('}', ''));
            this.index = Math.max(this.index, _.isNaN(idx) ? 0 : idx);
        } catch (err) {

        }

        return $variable;
    };

    Variable.prototype.renderValues = function (variables) {
        this.isRendered = false;
        for (var i in variables) {
            this.createVariableControl(variables[i]);
        }
        this.isRendered = true;
    };

    Variable.prototype.executeCommand = function (command) {
        if (this.isRendered) {
            this.options.editor.getCommandManager().execute(command);
        }
    };

    Variable.prototype.createAddVariableCommand = function (variable) {
        var command;
        if (this.options.editor.getModel().type === 'control') {
            command = new Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.AddVariableCommand(this.options.editor, {
                variable: variable
            });
        } else {
            command = new Brightics.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand(this.options.editor, {
                name: variable.name,
                ref: {
                    type: variable.type || 'string',
                    value: ''
                },
                variable: variable
            });
        }
        this.executeCommand(command);
    };

    Variable.prototype.createUpdateVariableCommand = function (variable, value) {
        var command;
        if (this.options.editor.getModel().type === 'control') {
            command = new Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.UpdateVariableCommand(this.options.editor, {
                variable: variable,
                ref: value
            });
        } else {
            var index = this.variables.indexOf(variable);
            var command = new Brightics.VA.Core.CompoundCommand(this.options.editor, {
                label: 'Update Variable'
            });

            var updateCommand = new Brightics.VA.Core.Editors.Diagram.Commands
                .UpdateVariableDefCommand(this.options.editor, {
                    name: variable.name,
                    newName: value.name || variable.name,
                    // ref: this.options.editor.modelContents['gv-def'][variable.name],
                    ref: {
                        type: value.type || variable.type,
                        value: _.isUndefined(value.value) ? variable.value : value.value
                    }
                });
            command.add(updateCommand);
            updateCommand.old.index = index;
            updateCommand.old.variable = $.extend(true, {}, variable);

            var assignedList = this.options.editor.getModel().getVariableAssignedParamList(variable.name);
            for (var i in assignedList) {
                command.add(new Brightics.VA.Core.Editors.Diagram.Commands.UpdateVariableCommand(this.options.editor, {
                    fid: assignedList[i].fid,
                    paramKey: assignedList[i].param,
                    ref: value.name || variable.name
                }));
            }
        }
        this.executeCommand(command);
    };

    Variable.prototype.createRemoveVariableCommand = function (variable) {
        var command;
        if (this.options.editor.getModel().type === 'control') {
            command = new Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.RemoveVariableCommand(this.options.editor, {
                variable: variable
            });
        } else {
            var index = this.variables.indexOf(variable);
            command = new Brightics.VA.Core.CompoundCommand(this.options.editor, {
                label: 'Delete Variable'
            });

            var removeCommand = new Brightics.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand(this.options.editor, {
                name: variable.name,
                variable: variable
            });
            command.add(removeCommand);
            removeCommand.old.index = index;

            var assignedList = this.options.editor.getModel().getVariableAssignedParamList(variable.name);
            for (var i in assignedList) {
                command.add(new Brightics.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(this.options.editor, {
                    fid: assignedList[i].fid,
                    paramKey: assignedList[i].param,
                    variable: variable.name,
                    subFnUnitIndex: -1
                }))
            }
        }
        this.executeCommand(command);
    };

    Variable.prototype._exist = function (variable) {
        for (var i in this.variables) {
            if (this.variables[i].name == variable.name) return true;
        }
        return false;
    };

    Variable.prototype.handleCommand = function (command) {
        if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.GoHistoryCommand) {
            for (var i in command.options.commands) {
                this.handleCommand(command.options.commands[i]);
            }
        }
        else if (command instanceof Brightics.VA.Core.CompoundCommand) this.handleCompoundCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand) this.handleAddVariableCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand) this.handleRemoveVariableCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand) this.handleUpdateVariableCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.AddVariableCommand) this.handleAddVariableCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.UpdateVariableCommand) this.handleUpdateVariableCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ControlEditor.RemoveVariableCommand) this.handleRemoveVariableCommand(command);
    };

    Variable.prototype.handleCompoundCommand = function (command) {
        var i;
        if (command.event.type == 'REDO' || command.event.type == 'EXECUTE') {
            for (i in command.commandList) {
                this.handleCommand(command.commandList[i]);
            }
        } else if (command.event.type == 'UNDO') {
            for (i = command.commandList.length - 1; i > -1; i--) {
                this.handleCommand(command.commandList[i]);
            }
        }
    };

    Variable.prototype.handleAddVariableCommand = function (command) {
        if (command.event.type === 'UNDO') {
            this.removeVariableControl(command.options.variable, this.variables.length - 1);
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand) {
                this.variables.splice(this.variables.length - 1, 1);
            }
        } else if (command.event.type === 'REDO') {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand) {
                if (this._exist(command.options.variable)) return;
                this.variables.push(command.options.variable);
                this.createVariableControl(command.options.variable);
            } else {
                this.createVariableControl(command.options.variable);
            }
        } else {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand) {
                if (this._exist(command.options.variable)) return;
                this.variables.push(command.options.variable);
                this.createVariableControl(command.options.variable);
            } else {
                this.createVariableControl(command.options.variable);
            }
        }

        this.$mainControl.perfectScrollbar('update');
    };

    Variable.prototype.handleUpdateVariableCommand = function (command) {
        if (command.event.type === 'UNDO') {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand) {
                this.variables[command.old.index].name = command.old.variable.name;
                this.variables[command.old.index].type = command.old.variable.type;
                this.variables[command.old.index].value = command.old.variable.value;
                this.updateVariableControl(command.old.variable, command.old.index);
            } else {
                this.updateVariableControl(command.old.variable, command.old.index);
            }
        } else if (command.event.type === 'REDO') {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand) {
                this.variables[command.old.index].name = command.options.newName;
                this.variables[command.old.index].type = command.options.ref.type || command.old.variable.type;
                this.variables[command.old.index].value =
                    _.isUndefined(command.options.ref.value) ?
                        command.old.variable.value : command.options.ref.value;
                this.updateVariableControl(this.variables[command.old.index], command.old.index);
            } else {
                this.updateVariableControl(command.options.analyticsModel.variables[command.old.index], command.old.index);
            }
        } else { //if (command.event.source === this) {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand) {
                this.variables[command.old.index].name = command.options.newName;
                this.variables[command.old.index].type = command.options.ref.type || command.old.variable.type;
                this.variables[command.old.index].value =
                    _.isUndefined(command.options.ref.value) ?
                        command.old.variable.value : command.options.ref.value;
                this.updateVariableControl(this.variables[command.old.index], command.old.index);
            } else {
                this.updateVariableControl(command.options.analyticsModel.variables[command.old.index], command.old.index);
            }
        }
    };

    Variable.prototype.handleRemoveVariableCommand = function (command) {
        if (command.event.type === 'UNDO') {
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand) {
                if (this._exist(command.options.variable)) return;
                this.variables.splice(command.old.index, 0, command.options.variable);
                this.createVariableControl(command.options.variable, command.old.index);
            } else {
                this.createVariableControl(command.options.variable, command.old.index);
            }
        } else if (command.event.type === 'REDO') {
            this.removeVariableControl(command.options.variable, command.old.index);
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand) {
                this.variables.splice(command.old.index, 1);
            }
        } else { //if (command.event.source === this) {
            this.removeVariableControl(command.options.variable, command.old.index);
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand) {
                this.variables.splice(command.old.index, 1);
            }
        }

        this.$mainControl.perfectScrollbar('update');
    };

// ======================================================================================

    Variable.prototype.createDropDownList = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            autoDropDownHeight: true,
            enableBrowserBoundsDetection: true,
            width: 'calc(100% - 2px)'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxDropDownList(options);
    };

    Variable.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');
        $control.wrap($wrapper);
    };

    Variable.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    Variable.prototype.addCssToWrapper = function ($control, cssOptions) {
        if (cssOptions) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.css(cssOptions);
        }
    };

    Variable.prototype.destroy = function () {
        for (var i in this.propertyControls) {
            this.removeVariableControl('', i);
        }
    };

    Variable.prototype.strip = function (name) {
        return name.substring(2, name.length - 1);
    };

    Variable.prototype.wrap = function (name) {
        return '${' + name + '}';
    };

    Brightics.VA.Core.Views.Variable = Variable;

}).call(this);
/**
 * Created by daewon.park on 2016-09-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var SCALE = .5;

    function ClipboardExplorer(parentId, options) {
        Brightics.VA.Core.Views.LibraryExplorer.call(this, parentId, options);
    }

    ClipboardExplorer.prototype = Object.create(Brightics.VA.Core.Views.LibraryExplorer.prototype);
    ClipboardExplorer.prototype.constructor = ClipboardExplorer;

    ClipboardExplorer.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-views-library brtc-va-tab-contents">' +
            '   <div class="brtc-va-views-library-container brtc-style-margin-0"></div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.fillTemplates();
    };

    ClipboardExplorer.prototype.fillTemplates = function () {
        var _this = this;
        for (var i in this.options.functionList) {
            _this._addTemplate(this.options.functionList[i]);
        }
    };

    ClipboardExplorer.prototype._addTemplate = function (template) {
        var $item = $('' +
            '<div class="brtc-va-views-library-template" uid="' + template.uid + '">' +
            '   <div class="brtc-va-views-library-template-label brtc-va-studio-dm-draggable"></div>' +
            '   <div class="brtc-va-views-library-template-preview"></div>' +
            '</div>');

        this.$mainControl.find('.brtc-va-views-library-container').append($item);

        this._addTemplateLabel($item.find('.brtc-va-views-library-template-label'), template);

        var $paperElement = $item.find('.brtc-va-views-library-template-preview');

        var graph = new joint.dia.Graph();
        var paper = new joint.dia.Paper({
            el: $paperElement,
            width: '100%',
            height: 'calc(100% - 43px)',
            model: graph,
            theme: 'none',
            interactive: false
        });
        paper.$el.css('pointer-events', 'none');
        paper.scale(SCALE);

        var i;
        for (i in template.contents.functions) {
            var figure = this._createFnUnitFigure(template.contents.functions[i]);
            graph.addCells([figure]);
        }
        for (i in template.contents.links) {
            var link = this._createLinkFigure(graph, template.contents.links[i]);
            graph.addCells([link]);
        }
        var links = graph.getLinks();
        $.each(links, function (index, link) {
            link.toBack();
        });

        this._draggableTemplate($item, template.contents);

        return $item;
    };

    ClipboardExplorer.prototype._removeTemplate = function (template) {
        var $item = this.$mainControl.find('.brtc-va-views-library-template[uid=' + template.uid + ']');
        $item.remove();
    };


    ClipboardExplorer.prototype._addTemplateLabel = function ($parent, template) {
        var functions = template.contents.functions;
        var labelText = functions.length === 1 ? '1 function' : functions.length + ' functions';
        var size = template.width + ' x ' + template.height;

        $parent.append(labelText + '<br>' + size);
    };

    ClipboardExplorer.prototype.updateFunctionList = function (newFunctionList) {

        for (var i in newFunctionList) {
            var newFunction = newFunctionList[i];
            if (!this._isInTargetFunctionList(newFunction, this.options.functionList)) {
                this._addTemplate(newFunction);
            }
        }

        for (var i in this.options.functionList) {
            var currentFunction = this.options.functionList[i];
            if (!this._isInTargetFunctionList(currentFunction, newFunctionList)) {
                this._removeTemplate(newFunction);
            }
        }
        this.options.functionList = $.extend(true, [], newFunctionList);
    };


    ClipboardExplorer.prototype._isInTargetFunctionList = function (func, targetList) {
        var isExist = false;
        for (var i in targetList) {
            var currentFunction = targetList[i];
            if (func.uid === currentFunction.uid) {
                isExist = true;
                break;
            }
        }
        return isExist;
    };


    Brightics.VA.Core.Views.ClipboardExplorer = ClipboardExplorer;

}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */

/* global _, CodeMirror */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var PREFIX = 'variable';
    var SUFFIX = '';

    var VARIABLE = 'variable';
    var NAME = 'name-control';
    var VALUE = 'value-control';

    function SetVariable(parentId, options) {
        Brightics.VA.Core.Views.Variable.call(this, parentId, options);
    }

    SetVariable.prototype = Object.create(Brightics.VA.Core.Views.Variable.prototype);
    SetVariable.prototype.constructor = SetVariable;

    var _retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SetVariable.prototype.init = function () {
        this.isRendered = false;
        this.propertyControls = [];
        this.index = 0;
        this.initTempDataStorage();
    };

    SetVariable.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('' +
            '<div class="brtc-va-views-variable">' +
            '       <input type="button" class="brtc-va-tools-sidebar-variable-button brtc-style-col-12 add-variable-button" value="+ Add Variable"/>' +
            '       <div class="brtc-va-tools-sidebar-variable-list brtc-style-padding-0 brtc-style-padding-right-10">' +
            '           <div class="brtc-va-tools-sidebar-variable-list-wrapper brtc-style-height-full"></div>' +
            '       </div>' +
            '</div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);

        this.$variableList = this.$mainControl.find('.brtc-va-tools-sidebar-variable-list-wrapper');

        this.createAddVariableButton();

        // this.refresh();

        this.$variableList.perfectScrollbar();
        this.configureOptions();
    };

    SetVariable.prototype.createAddVariableButton = function () {
        var _this = this;
        this.$addVariableButton = this.$mainControl.find('.add-variable-button');
        this.$addVariableButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        this.$addVariableButton.click(function () {
            if (_this.$empty) _this.$empty.remove();

            var variableCount = _this.$variableList.find('.brtc-va-tools-sidebar-variable-deck').length;

            // var variable = { type: 'string', name: PREFIX + (variableCount+1), value: '' };
            var variable = {type: 'string', name: PREFIX + (variableCount + 1), param: {value: ''}};
            _this.createVariableControl(variable);
            _this.options.onAdd(variable);
            _this.$variableList.perfectScrollbar('update');
        });
    };

    SetVariable.prototype.renderEmptyControl = function () {
        this.$empty = $('' +
            '<div class="brtc-va-tools-sidebar-variable-deck">' +
            '   <div class="controls">' +
            '       <div class="control-row empty">There is no Variables</div>' +
            '   </div>' +
            '</div>');

        this.$variableList.append(this.$empty);
    };

    SetVariable.prototype.createVariableControl = function (variable, index) {
        this.isRendered = false;

        var _this = this;
        var $variable = $('' +
            '<div class="brtc-va-tools-sidebar-variable-deck">' +
            '   <div class ="brtc-va-tools-sidebar-variable-remove" />' +
            '   <div class="controls">' +
            '       <div class="control-row">' +
            '            <div class="brtc-va-editors-sheet-controls-wrapper brtc-va-tools-sidebar-variable-name">' +
            '                <textarea  class="brtc-va-widget-contents-input-control"/>' +
            '            </div>' +
            '       </div>' +
            '       <div class="control-row">' +
            '            <div class="brtc-va-tools-sidebar-variable-type"/>' +
            '       </div>' +
            '       <div>' +
            '            <div class="brtc-va-tools-sidebar-variable-value" />' +
            '       </div>' +
            '   </div>' +
            '</div>');

        var storageId = _.uniqueId('var-');
        var putData = _.partial(this.tempDataStorage.putDataById, storageId);
        var getData = _.partial(this.tempDataStorage.getDataById, storageId);

        this.$variableList.append($variable);
        this.tempDataStorage.push(storageId);


        putData(VARIABLE, variable);

        var $type = $variable.find('.brtc-va-tools-sidebar-variable-type');
        var $name = $variable.find('.brtc-va-widget-contents-input-control');
        var $value = $variable.find('.brtc-va-tools-sidebar-variable-value');
        var $remove = $variable.find('.brtc-va-tools-sidebar-variable-remove');

        this.createDropDownList($type, {
            source: this.getSource(),
            displayMember: 'label',
            valueMember: 'value'
        });
        $type.on('change', function (event) {
            var oldVariable = getData(VARIABLE);
            var newVariable = $.extend(true, {}, oldVariable);
            var type = $type.jqxDropDownList('val');
            getData(VALUE).setVariableType(type);

            newVariable.type = type;

            newVariable.param = {};

            if (type === 'cell') newVariable.param = {inData: '', rowIndex: '', column: ''};
            else newVariable.param.value = '';

            if (_this.isRendered) {
                _this.options.onChange(oldVariable, newVariable);

                putData(VARIABLE, newVariable);
            }
        });

        var codeMirrorName = CodeMirror.fromTextArea($name[0], {
            mode: 'brtc-controlflow-variable',
            scrollbarStyle: 'null',
            placeholder: '',
            lineWrapping: false,
            lineNumbers: false,
            viewportMargin: Infinity,
            // readOnly: (this.options.isFixedVariable)? 'nocursor' : 'false',
            hintOptions: {
                list: []
            },
            extraKeys: {
                'Tab': false, // Let focus go to next control
                'Shift-Tab': false // Let focus go to previous control
            }
        });

        Brightics.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(codeMirrorName, {'valid-type': 'type1'});
        codeMirrorName.on('blur', function (instance, event) {
            if (!_this.isRendered) return;

            var variable = getData(VARIABLE);
            var newName = _this.strip(instance.getValue());

            var exist = false;
            for (var i in _this.variables) {
                if (_this.variables[i].name == newName) {
                    exist = true;
                    break;
                }
            }

            if (variable.name !== newName) {
                if (exist) {
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('The typed name already exists. Variable Name must be unique.');
                    _this.setVariableName(codeMirrorName, variable.name);
                } else {
                    var oldVariable = variable;
                    var newVariable = $.extend(true, {}, oldVariable);

                    newVariable.name = newName;
                    newVariable.param = {};
                    newVariable.param.value = variable.value;

                    _this.options.onChange(oldVariable, newVariable);

                    putData(VARIABLE, newVariable);
                }
            }
        });
        putData(NAME, codeMirrorName);

        var control = Brightics.VA.Core.Widget.Factory.variableControl($value, {
            fnUnit: this.options.fnUnit,
            variable: {
                temp: {
                    type: 'literal',
                    value: variable.value,
                    'variable-type': variable.type
                }
            },
            onChangeCallback: function (variableObj) {
                if (!_this.isRendered) return;
                var oldVariable = getData(VARIABLE);
                var newVariable = $.extend(true, {}, oldVariable);

                newVariable.type = variableObj['variable-type'];
                if (newVariable.type === 'cell') {
                    newVariable.param = variableObj['value'];
                } else {
                    newVariable.value = variableObj['value'];
                    newVariable.param = {};
                    newVariable.param.value = variableObj['value'];
                }

                _this.options.onChange(oldVariable, newVariable);

                putData(VARIABLE, newVariable);
            },
            'valid-type': 'type1'
        });
        putData(VALUE, control);

        $remove.click(function (event) {
            var variable = getData(VARIABLE);
            $variable.remove();
            _this.tempDataStorage.removeById(storageId);

            if (_this.$variableList.find('.brtc-va-tools-sidebar-variable-deck').length == 0) {
                _this.renderEmptyControl();
            }

            _this.options.onRemove(variable);
            _this.$variableList.perfectScrollbar('update');
            event.stopPropagation();
        });

        $type.val(variable.type);
        this.setVariableName(codeMirrorName, variable.name);
        control.setInputValue(variable.value);

        this.isRendered = true;
        return $variable;
    };

    SetVariable.prototype.renderValues = function (variables) {
        this.isRendered = false;

        this.empty();

        for (var i in variables) {
            this.createVariableControl(variables[i]);
        }

        if (variables.length === 0) this.renderEmptyControl();

        this.configureOptions();
        this.isRendered = true;
    };

    SetVariable.prototype.empty = function () {
        this.$variableList.empty();
    };

    SetVariable.prototype.configureOptions = function () {
        this.configureFixedVariable();
    };

    SetVariable.prototype.configureFixedVariable = function () {
        if (this.options.isFixedVariable) {
            this.$mainControl.find('input.add-variable-button').hide();
            this.$mainControl.find('.brtc-va-tools-sidebar-variable-remove').hide();
        }
    };

    SetVariable.prototype.getTargetByType = function (type, val) {
        var isArray = _.isArray(val);
        var toArray = ['array[string]', 'array[number]'].indexOf(type) >= 0;
        if (isArray && toArray) return val;
        if (!isArray && !toArray) return val;
        if (isArray && !toArray) return val[0];
        return [val];
    };

    SetVariable.prototype.getValueByType = function (type, val) {
        var VarUtils = this.getVarUtils();
        var defaultGetValue = function (val) {
            return val;
        };

        var getValue = {
            'calculation': VarUtils.wrap,
            'number': VarUtils.toNumber,
            'string': VarUtils.toString,
            'array[string]': function (val) {
                return _.map(val, VarUtils.toString);
            },
            'array[number]': function (val) {
                return _.map(val, VarUtils.toNumber);
            }
        };

        return (getValue[type] || defaultGetValue)(this.getTargetByType(type, val));
    };

    SetVariable.prototype.setValueByType = function (type, val) {
        var VarUtils = this.getVarUtils();
        var defaultSetValue = function (val) {
            return val;
        };
        var setValue = {
            'calculation': VarUtils.strip
        };

        return (setValue[type] || defaultSetValue)(val);
    };

    SetVariable.prototype.getVarUtils = function () {
        return Brightics.VA.Core.Utils.VariableUtils;
    };

    SetVariable.prototype.getSource = function () {
        var normal = [
            {
                label: 'String',
                value: 'string'
            },
            {
                label: 'Number',
                value: 'number'
            },
            {
                label: 'Array String Value',
                value: 'array[string]'
            },
            {
                label: 'Array Number Value',
                value: 'array[number]'
            },
            {
                label: 'Calculation Value',
                value: 'calculation'
            }
        ];

        var additional = [
            {
                label: 'Cell',
                value: 'cell'
            }
        ];

        if (this.options.isNormalType) {
            return normal;
        } else {
            return normal.concat(additional);
        }
    };


    Brightics.VA.Core.Views.SetVariable = SetVariable;

}).call(this);
/* -----------------------------------------------------
 *  local-outline.js
 *  Created by hyunseok.oh@samsung.com on 2018-07-12.
 * ---------------------------------------------------- */

/* global _, crel */
(function (Brightics) {
    var Outline = Brightics.VA.Core.Views.Outline;


    function LocalOutline(options) {
        Outline.call(this, options);
    }

    LocalOutline.prototype = _.create(Outline.prototype);
    LocalOutline.prototype.constructor = LocalOutline;

    LocalOutline.prototype.onDoubleClickItem = function (id) {
        var currentItem = this.id2item[id];
        var parentItem = currentItem.parent;

        if (currentItem.type === 'fn') {
            // change active model & select fnunit
            this.editor.changeEditorContext(parentItem.id,
                parentItem.parent ? parentItem.parent.fn : undefined);
            this.editor.showFunctionProperty(currentItem.id);
        } else {
            // change active model
            this.editor.changeEditorContext(currentItem.id,
                parentItem ? parentItem.fn : undefined);
        }
    };

    LocalOutline.prototype.getData = function () {
        var self = this;
        var model = self.model;
        var activeModel = self.editor.getActiveModel();
        var activeFid = self.editor.getActiveFnUnitOnProp() ?
            self.editor.getActiveFnUnitOnProp().fid : undefined;
        var localOutline = Brightics.VA.Core.Utils.NestedFlowUtils
            .getLocalOutline(model, activeModel, activeFid);

        self.id2item = {};

        var transform = function (item) {
            var id = item.type === 'fn' ? item.fn.fid : item.model.mid;
            var status = self.editor.getStatus(id);
            var ret = {
                type: item.type,
                id: id,
                items: item.items.map(function (_item) {
                    return transform(_item, id);
                })
            };

            if (item.model) ret.model = item.model;
            else ret.fn = item.fn;

            ret.html = [
                crel('div', {
                    class: 'item-status',
                    status: status && status.status? status.status : 'READY',
                    title: status && status.message? status.message : '',
                    type: item.type
                }).outerHTML,
                crel('span', {
                    class: [item.active ? 'active' : '', item.selected ? 'underline' : ''].join(' '),
                    title: item.label
                }, item.label).outerHTML
            ].join('');

            ret.items.forEach(function (child) {
                child.parent = ret;
            });

            self.id2item[ret.id] = ret;
            return ret;
        };

        return [transform(localOutline)];
    };

    LocalOutline.prototype.refresh = function (target, args) {
        try {
            if (target) {
                this.view.render[target](args);
            } else {
                this.view.render.all();
            }
        } catch (e) {
            this.view.render.error(e);
        }
    };

    Brightics.VA.Core.Views.LocalOutline = LocalOutline;
}(window.Brightics));

/* -----------------------------------------------------
 *  global-outline.js
 *  Created by hyunseok.oh@samsung.com on 2018-07-12.
 * ---------------------------------------------------- */

/* global _ */
(function (Brightics) {
    var Outline = Brightics.VA.Core.Views.Outline;

    function GlobalOutline(options) {
        Outline.call(this, options);
    }

    GlobalOutline.prototype = _.create(Outline.prototype);
    GlobalOutline.prototype.constructor = GlobalOutline;

    GlobalOutline.prototype.onClickItem = function (item) {
    };

    GlobalOutline.prototype.getData = function () {
        return [Brightics.VA.Core.Utils.NestedFlowUtils
            .getGlobalOutline(this.projectId, this.model)];
    };

    Brightics.VA.Core.Views.GlobalOutline = GlobalOutline;
}(window.Brightics));

(function () {
    'use strict';

    var root = this;
    root.Brightics.VA.SettingStorage = {
        getValue: function (key) {
            var value = this.DEFAULT_SETTINGS[key]; // default value

            if (typeof(Storage) !== 'undefined') {
                value = localStorage.getItem(key) !== null ? localStorage.getItem(key) : value;
            } else {
                value = typeof($.cookie(key)) !== 'undefined' ? $.cookie(key) : value;
            }

            return value;
        },
        setValue: function (key, value) {
            if (typeof(Storage) !== 'undefined') {
                localStorage.setItem(key, typeof value === 'object' ? JSON.stringify(value) : value);
            } else {
                $.cookie(key, typeof value === 'object' ? JSON.stringify(value) : value);
            }
        },
        setToDefault: function (key) {
            if (typeof(Storage) !== 'undefined') {
                localStorage.removeItem(key);
            } else {
                $.removeCookie(key);
            }
        },
        clear: function () {
            if (typeof(Storage) !== 'undefined') {
                localStorage.clear();
            } else {
                for (var key in this.DEFAULT_SETTINGS) {
                    $.removeCookie(key);
                }
            }
        }
    };

    root.Brightics.VA.SettingStorage.SETTINGS = {};
    root.Brightics.VA.SettingStorage.DEFAULT_SETTINGS = {
        'common.scroll.indicate.mouseover': 'true',
        'common.document.useonline': 'false',
        'common.document.onlinedocurl': '',
        'common.persist.mode': 'storage-mode',
        'editor.diagram.autoconnect': 'true',
        'editor.minimap.visible': 'true',
        'editor.function.add.doubleclick': 'true',
        'editor.variable.visible': 'true',
        'editor.datapanel.chart.table.pivotsinglerow': 'false',
        'editor.datapanel.defaultrowcount': '1000',
        'chart.table.formatter.use': 'false',
        'chart.table.formatter.double': '9',
        'chart.table.formatter.integer': '0',
        'chart.table.formatter.exponential': '2',
        'chart.table.formatter.type': 'number',
        'chart.table.formatter.pivot': 'false',
        'editor.maxfuncnum': '120',
        'editor.closePanelOnClick': 'true',
        'chart.style.selectedColorSet': 'Brightics',
        'chart.style.colorSet': JSON.stringify([
            {
                name: 'Brightics',
                colors: [
                    '#FD026C', '#4682B8', '#A5D22D', '#F5CC0A', '#FE8C01', '#6B9494', '#B97C46',
                    '#84ACD0', '#C2E173', '#F9DD5B', '#FE569D', '#FEB356', '#9CB8B8', '#D0A884',
                    '#2E6072', '#6D8C1E', '#A48806', '#A90148', '#A95E01', '#476363', '#7B532F'
                ]
            },
            {
                name: 'Rainbow',
                colors: [
                    '#FF0000', '#FF9D00', '#EEFF00', '#34B545', '#3E6DC4', '#4B0082', '#863DCC'
                ]
            }
        ])
    };

    (function convert() {
        const SettingStorage = root.Brightics.VA.SettingStorage;
        const num = SettingStorage.getValue('chart.table.formatter.number');
        if (num) {
            SettingStorage.setValue('chart.table.formatter.double', num);
            SettingStorage.setValue('chart.table.formatter.integer', num);
            SettingStorage.setToDefault('chart.table.formatter.number');
        }
    }());
}).call(this);

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var SettingPath = Brightics.VA.Setting;

    var BaseSettingWidget = {
        createInput: function (settingId, $inputControl) {
            var settingData = Brightics.VA.SettingStorage.getValue(settingId);
            var $control = $inputControl.jqxInput({
                theme: Brightics.VA.Env.Theme
            });
            $inputControl.jqxInput('val', settingData);

            return {
                id: settingId,
                $control: $control
            };
        }
    };


    SettingPath.Widget = BaseSettingWidget;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function BaseSetting($parent, options) {
        this.init();
        this.createContents($parent);
        this.applyPreferenceSettings();
        this.render();
    }

    BaseSetting.prototype.init = function () {
        Brightics.VA.SettingStorage.TEMP = Brightics.VA.SettingStorage.TEMP || {};
        this.controlList = [];

        this.initSettingId();
    };

    BaseSetting.prototype.initPerfectScrollbar = function () {
        this.$mainControl.perfectScrollbar();
    };

    BaseSetting.prototype.initSettingId = function ($parent) {
    };

    BaseSetting.prototype.createContents = function ($parent) {
        this.$mainControl = $('<div class="brtc-va-setting-container"/>');
        $parent.append(this.$mainControl);
    };

    BaseSetting.prototype.getValue = function (key) {
        return typeof Brightics.VA.SettingStorage.TEMP[key] == 'undefined' ? Brightics.VA.SettingStorage.getValue(key) : Brightics.VA.SettingStorage.TEMP[key];
    };

    BaseSetting.prototype.changeValue = function (key, value) {
        Brightics.VA.SettingStorage.TEMP[key] = typeof value === 'object' ? JSON.stringify(value) : ''+value;
    };

    BaseSetting.prototype.render = function () {
    };

    BaseSetting.prototype.save = function () {
        for (var key in Brightics.VA.SettingStorage.TEMP) {
            Brightics.VA.SettingStorage.setValue(key, Brightics.VA.SettingStorage.TEMP[key]);
        }
    };

    BaseSetting.prototype._createCheckBox = function ($target, options) {
        var settingId = options.settingId,
            label = options.label,
            tagList = options.tagList || [];

        var $control = $('' +
            '<div class="brtc-va-setting-component-wrapper">' +
            '   <div class="' + this._parseSettingIdToClassName(settingId) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-va-setting-checkbox-content"></div>' +
            '       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1"></div>' +
            '   </div>' +
            '</div>');
        $control.find('.brtc-va-setting-checkbox-label').text(label);
        $control.find('.brtc-va-setting-checkbox-content').jqxCheckBox({
            theme: Brightics.VA.Env.Theme,
        });

        $target.append($control);
        if (tagList && tagList.length > 0) {
            this._createEditorTagList($target, tagList);
        }

        var _this = this;
        $control.on('change', function (event) {
            var checked = event.args.checked;
            _this.changeValue(settingId, checked);
        });

        this.controlList.push($control);

        return $control;
    };

    BaseSetting.prototype._parseSettingIdToClassName = function (settingId) {
        var prefix = 'brtc-va-setting-';
        if (settingId) {
            return prefix + settingId.replace(/[.]/gi, '-');
        } else {
            return prefix + settingId;
        }
    };

    BaseSetting.prototype._createEditorTagList = function ($target, applyTagList) {
        var _this = this;
        var $tagControl = $('<div class = "brtc-va-setting-editor-label-group"/>');
        $target.append($tagControl);
        Object.keys(Brightics.VA.Core.Interface.Label).forEach(function (editorKey) {
            var applyYn = ($.inArray(editorKey, applyTagList) > -1) ? true : false;
            _this._createEditorTag($tagControl, Brightics.VA.Core.Interface.Label[editorKey], applyYn);
        });
    };

    BaseSetting.prototype._createEditorTag = function ($target, label, applyYn) {
        var $editorTag = $('<button class = "brtc-va-setting-editor-label">' + label + '</button>');
        if (applyYn) {
            $editorTag.addClass('apply');
            $editorTag.jqxButton({
                theme: 'Web'
            });
            $editorTag.css('font-size', '8px');
            $target.append($editorTag);
        }
    };

    BaseSetting.prototype._createSplitBar = function ($target) {
        var $splitBar = $('<div class="brtc-va-setting-splitbar"></div>');
        $target.append($splitBar);
    };

    BaseSetting.prototype._createDropDownList = function ($target, options) {
        var settingId = options.settingId,
            label = options.label,
            list = options.list,
            tagList = options.tagList || [],
            width = options.width || 100,
            dropDownHeight = options.dropDownHeight;

        var $control = $('' +
            '<div class="brtc-va-setting-component-wrapper">' +
            '   <div class="' + this._parseSettingIdToClassName(settingId) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-va-setting-dropdownlist-label brtc-style-setting-label"/>' +
            '       <div class="brtc-va-setting-dropdownlist-content"></div>' +
            '   </div>' +
            '</div>');

        $target.append($control);
        
        $control.find('.brtc-va-setting-dropdownlist-label').text(label);

        var distance = $target.closest('.brtc-va-dialogs-body').find('.brtc-va-dialogs-buttonbar-ok').offset().top - $control.find('.brtc-va-setting-dropdownlist-content').offset().top - 25;
        distance = distance - distance % 25;
        if(typeof(dropDownHeight) == "undefined") distance = distance || 100;
        else distance = dropDownHeight || 100;
        if(distance > 100) distance = 100;
        
        var dropDownList = $control.find('.brtc-va-setting-dropdownlist-content').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            source: list,
            width: width,
            dropDownHeight: distance
        });
        
        if (tagList && tagList.length > 0) {
            this._createEditorTagList($target, tagList);
        }

        var _this = this;
        $control.on('change', function (event) {
            var value = event.args.item.value;
            _this.changeValue(settingId, value);
        });

        $target.closest('.ps-container').on('scroll', function () {
            if (dropDownList != null) {
                dropDownList.jqxDropDownList('close');
            }
        });

        this.controlList.push($control);

        return $control;
    };

    BaseSetting.prototype._createNumericInput = function (parentId, options) {
        return Brightics.VA.Core.Widget.Factory.numericInputControl(parentId, options);
    };

    BaseSetting.prototype.getSettingId = function (key) {
        return this.SettingId[key];
    };

    BaseSetting.prototype.applySetting = function () {
    };

    BaseSetting.prototype.applyPreferenceSettings = function () {
    };

    Brightics.VA.Setting.BaseSetting = BaseSetting;
    Brightics.VA.Setting.CONST = {
        KEY_DELIMITER: '.'
    };
}).call(this);
/* global brtc_require, _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var crel = brtc_require('crel');

    var DEBUG = false;

    var debug = function () {
        if (DEBUG) console.log.apply(console, arguments);
    };

    function ChartSetting(parentId, options) {
        Brightics.VA.Setting.BaseSetting.call(this, parentId, options);
    }

    ChartSetting.prototype = Object.create(Brightics.VA.Setting.BaseSetting.prototype);
    ChartSetting.prototype.constructor = ChartSetting;

    ChartSetting.prototype.initSettingId = function ($parent) {
        this.SettingId = {
            use: 'chart.table.formatter.use',
            double: 'chart.table.formatter.double',
            integer: 'chart.table.formatter.integer',
            exponential: 'chart.table.formatter.exponential',
            type: 'chart.table.formatter.type',
            pivot: 'chart.table.formatter.pivot',
            selectedPalette: 'chart.style.selectedColorSet',
            palette: 'chart.style.colorSet'
        };
    };

    ChartSetting.prototype.createContents = function ($parent) {
        Brightics.VA.Setting.BaseSetting.prototype.createContents.call(this, $parent);

        this.createFormatterControl();
        this.createSingleRowPivotControl();
        this.createCustomColorPalettes();
    };

    ChartSetting.prototype.createFormatterControl = function () {
        var _this = this;

        var $controlWrapper = $('' +
            '<div class="brtc-va-setting-component-wrapper">' +
            '   <div class="' + this._parseSettingIdToClassName(this.getSettingId('use')) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-va-setting-checkbox-content use"></div>' +
            '       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1">Use default table format  (will be applied after screen refresh)</div>' +
            '   </div>' +
            '   <div class="' + this._parseSettingIdToClassName(this.getSettingId('number')) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-style-display-none" brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '           <div class="brtc-va-setting-input-content-label">Integer</div>' +
            '           <div class="brtc-va-setting-input-content number integer"></div>' +
            '       </div>' +
            '       <div class="brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '           <div class="brtc-va-setting-input-content-label">Number</div>' +
            '           <div class="brtc-va-setting-input-content number double"></div>' +
            '       </div>' +
            '   </div>' +
            '</div>');

        this.$mainControl.append($controlWrapper);

        this.$useControl = $controlWrapper.find('.brtc-va-setting-checkbox-content.use');
        this.$useControl.jqxCheckBox({
            theme: Brightics.VA.Env.Theme
        });

        var [$numberControl, $integerControl] = [
            '.brtc-va-setting-input-content.double',
            '.brtc-va-setting-input-content.integer'
        ].map((cls) => $controlWrapper.find(cls));
        [this.numberControl, this.integerControl] = [
            $numberControl,
            $integerControl
        ].map(($el) => {
            return this._createNumericInput($el, {
                numberType: 'int',
                min: 0,
                max: 10,
                minus: false,
                placeholder: 'Enter value'
            });
        });

        const els = [this.numberControl, this.integerControl];
        const zipped = _.zip(['double', 'integer'], els);
        this.$useControl.on('change', (event) => {
            var checked = event.args.checked;

            els.forEach((el) => el.setDisabled(!checked));
            if (!checked) {
                Brightics.Chart.Helper.PreferenceUtils.clearTableFormatter();
            }

            this.changeValue(this.getSettingId('use'), checked);
            if (checked) {
                zipped.forEach(([key, el]) => {
                    this.changeValue(this.getSettingId(key), el.getValue());
                });
            }
        });

        zipped.forEach(([key, el]) => {
            el.onChange(() => {
                const val = el.getValue();
                Brightics.Chart.Helper.PreferenceUtils.setTableFormatter([{type: key, digit: 3}]);
                _this.changeValue(_this.getSettingId(key), val);
            });
        });

        this._createEditorTagList(this.$mainControl, ['data', 'visual']);

        this.controlList.push($controlWrapper);
    };

    ChartSetting.prototype.createSingleRowPivotControl = function ($parent) {
        var _this = this;

        var $controlWrapper = $('' +
            '<div class="brtc-va-setting-component-wrapper">' +
            '   <div class="' + this._parseSettingIdToClassName(this.getSettingId('pivot')) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-va-setting-checkbox-content pivot"></div>' +
            '       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1"> Pivot single-row table (will be applied after screen refresh)</div>' +
            '</div>');

        this.$mainControl.append($controlWrapper);

        this.$pivotControl = $controlWrapper.find('.brtc-va-setting-checkbox-content.pivot');
        this.$pivotControl.jqxCheckBox({
            theme: Brightics.VA.Env.Theme
        });

        this.$pivotControl.on('change', function (event) {
            var checked = event.args.checked;

            if (checked) {
                Brightics.Chart.Helper.PreferenceUtils.setTableFormatter([{pivot: 'true'}]);
            } else {
                Brightics.Chart.Helper.PreferenceUtils.setTableFormatter([{pivot: 'false'}]);
            }
            _this.changeValue(_this.getSettingId('pivot'), checked);
        });
    };

    ChartSetting.prototype.createCustomColorPalettes = function () {
        var PALETTE_ITEM = 'brtc-va-setting-component-palette__item';
        var PALETTE_BUTTON = 'brtc-va-setting-component-palette__button';
        var PALETTE_INPUT = 'brtc-va-setting-component-palette__input';
        var PALETTE_SELECTOR = 'brtc-va-setting-component-palette__selecor';
        var PALETTE_BUTTON_WRAPPER = 'brtc-va-setting-component-palette__button-wrapper';
        var PALETTE_WRAPPER = 'brtc-va-setting-component-palette__wrapper';
        var self = this;
        var $controlWrapper = $('' +
            '<div class="brtc-va-setting-component-wrapper" style="margin-top: 20px;">' +
            '   <div class="' + this._parseSettingIdToClassName(this.getSettingId('palette')) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1"> Configure custom color palettes. </div>' +
            '       <div class="brtc-va-setting-checkbox-content colors"></div>' +
            '</div>');


        var store = this.getPlatteStateStore();

        var $paletteButtonWrapper = $(crel('div', {class: PALETTE_BUTTON_WRAPPER}));
        var $paletteSelector = $(crel('div', {class: PALETTE_SELECTOR}));
        var $saveButton = $(crel('div', {class: PALETTE_BUTTON}, 'Save'));
        var $saveAsButton = $(crel('div', {class: PALETTE_BUTTON}, 'Save As'));
        var $resetButton = $(crel('div', {class: PALETTE_BUTTON}, 'Reset'));
        var $deleteButton = $(crel('div', {class: PALETTE_BUTTON}, 'Delete'));
        var $okButton = $(crel('div', {class: PALETTE_BUTTON}, 'Ok'))
            .jqxButton({theme: Brightics.VA.Env.Theme});
        var $cancelButton = $(crel('div', {class: PALETTE_BUTTON}, 'Cancel'))
            .jqxButton({theme: Brightics.VA.Env.Theme});
        var $input = $(crel('input', {class: PALETTE_INPUT, maxLength: 80}));
        var $palette = $(crel('div', {class: PALETTE_WRAPPER}));

        $paletteButtonWrapper.append(
            $paletteSelector,
            $input,
            $saveButton,
            $saveAsButton,
            $resetButton,
            $deleteButton,
            $okButton,
            $cancelButton
        );

        (function (fn) {
            var last = -1;
            $paletteSelector.on('change', function (e) {
                if (last === e.args.index) return;
                // trigger 'value-change' when a value is actually changed.
                fn(e);
            });
        }(function (e) {
            var index = e.args.index;
            var selectPalette = function (index) {
                store.dispatch({
                    type: 'paletteSelected',
                    index: index
                });
                if (index === -1) return;
            };
            if (index !== store.get('index')) {
                var dirty = store.get('dirty');
                selectPalette(index);
                if (dirty) {
                    Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog(
                        'Are you sure you want to change palette?',
                        function (result) {
                            if (!result.OK) {
                                store.undo();
                            }
                            renderAll();
                        }
                    );
                } else {
                    renderAll();
                }
            }
        }));

        $input.keyup(function (e) {
            if (e.target.value !== store.get('input')) {
                store.dispatch({
                    type: 'inputChanged',
                    input: e.target.value
                });
                renderButton();
            }
        });

        $saveButton.on('click', function (e) {
            if (e.target.disabled) return;
            store.dispatch({type: 'saveClicked'});
            renderButton();
            renderDropDown();
        });

        $saveAsButton.on('click', function (e) {
            if (e.target.disabled) return;
            store.dispatch({type: 'saveAsClicked'});
            renderAll();
        });

        $resetButton.on('click', function (e) {
            if (e.target.disabled) return;
            store.dispatch({
                type: 'resetClicked'
            });
            renderButton();
            renderPalette();
        });

        $deleteButton.on('click', function (e) {
            if (e.target.disabled) return;
            store.dispatch({
                type: 'deleteClicked'
            });
            renderAll();
        });

        $okButton.on('click', function (e) {
            if (e.target.disabled) return;
            store.dispatch({
                type: 'saveOkClicked'
            });
            renderAll();
        });

        $cancelButton.on('click', function (e) {
            if (e.target.disabled) return;
            store.dispatch({
                type: 'cancelClicked'
            });
            renderAll();
        });

        var renderButton = function () {
            $saveButton.jqxButton({
                disabled: store.get('saveDisabled'),
                theme: Brightics.VA.Env.Theme
            });
            $saveAsButton.jqxButton({
                disabled: store.get('saveAsDisabled'),
                theme: Brightics.VA.Env.Theme
            });
            $deleteButton.jqxButton({
                disabled: store.get('deleteDisabled'),
                theme: Brightics.VA.Env.Theme
            });
            $okButton.jqxButton({
                disabled: !store.get('canSaveAs'),
                theme: Brightics.VA.Env.Theme
            });
            $resetButton.jqxButton({
                disabled: store.get('resetDisabled'),
                theme: Brightics.VA.Env.Theme
            });

            $saveButton.toggle(!store.get('inputActive'));
            $saveAsButton.toggle(!store.get('inputActive'));
            $deleteButton.toggle(!store.get('inputActive'));
            $resetButton.toggle(!store.get('inputActive'));
            $okButton.toggle(store.get('inputActive'));
            $cancelButton.toggle(store.get('inputActive'));
            $input.jqxInput({
                value: store.get('input'),
                width: 150
            });
            $input.toggle(store.get('inputActive'));
        };

        var renderDropDown = function () {
            $paletteSelector.jqxDropDownList({
                source: store.get('colorSet').map(function (e) {
                    return _.escape(e.name);
                }),
                selectedIndex: store.get('index'),
                theme: Brightics.VA.Env.Theme,
                width: 150
            });
            $paletteSelector.toggle(!store.get('inputActive'));
        };

        $palette.on('click', function (e) {
            if (store.get('inputActive')) return;
            if (e.target.classList.contains(PALETTE_ITEM)) {
                var idx = parseInt(e.target.getAttribute('palette-index'), 10);
                var col = e.target.getAttribute('palette-color');
                new Brightics.Chart.Adonis.Component
                    .Dialogs.ColorPickerDialog($(e.target), {
                        windowPosition: 'bottom',
                        close: function (_color) {
                            var toHex = function (v) {
                                return v >= 10 ? String.fromCharCode((v - 10) + 'A'.charCodeAt(0)) : v.toString();
                            };
                            var hexColors = function (colors) {
                                return '#' + ['r', 'g', 'b'].map(function (key) {
                                    var n = parseInt(colors[key], 10);
                                    return [parseInt(n / 16, 10), n % 16].map(toHex).join('');
                                }).join('');
                            };
                            const color = hexColors(_color);
                            if (color !== col) {
                                store.dispatch({
                                    type: 'paletteChanged',
                                    index: idx,
                                    color: color
                                });
                                $(e.target).css('background-color', color);
                                e.target.setAttribute('palette-color', color);
                                renderButton();
                            }
                        },
                        color: col
                    });
            }
        });

        var renderPalette = function () {
            var colors = store.get('tempPalette');
            $palette.empty();
            if (store.get('inputActive')) {
                $palette.addClass('saving');
            } else {
                $palette.removeClass('saving');
            }
            $palette.append(
                colors.map(function (el, idx) {
                    var $el = $(crel('div', {class: PALETTE_ITEM}));
                    $el.css('background-color', el);
                    $el.attr('palette-index', idx);
                    $el.attr('palette-color', el);
                    return $el;
                })
            );
            $palette.perfectScrollbar();
            $palette.perfectScrollbar('update');
        };

        var renderAll = function () {
            renderDropDown();
            renderButton();
            renderPalette();
        };

        renderAll();
        $controlWrapper.append($paletteButtonWrapper, $palette);
        this.$mainControl.append($controlWrapper);
    };

    ChartSetting.prototype.render = function () {
        this.renderNumberControl();
        this.renderUseControl();
        this.renderPivotControl();
    };

    ChartSetting.prototype.getPlatteStateStore = function () {
        var self = this;
        var store = (function () {
            var colorSet = JSON.parse(self.getValue(self.getSettingId('palette')));
            var selectedPalette = self.getValue(self.getSettingId('selectedPalette'));
            var selectedIndex = colorSet.findIndex(function (e) {
                return e.name === selectedPalette;
            });
            var state = {
                inputActive: false,
                input: '',
                colorSet: colorSet,
                index: selectedIndex,
                dirty: false,
                tempPalette: colorSet[selectedIndex].colors.slice()
            };

            var history = [];

            var computed = {
                deleteDisabled: function () {
                    return computed.isDefaultPalette();
                },
                paletteDisabled: function () {
                    return state.inputActive;
                },
                saveDisabled: function () {
                    return !state.dirty || computed.isDefaultPalette();
                },
                saveAsDisabled: function () {
                    return false;
                },
                resetDisabled: function () {
                    return !state.dirty;
                },
                currentPalette: function () {
                    return state.colorSet[state.index];
                },
                canSaveAs: function () {
                    return state.colorSet.filter(function (e) {
                        return e.name === state.input;
                    }).length === 0;
                },
                isDefaultPalette: function () {
                    return state.index < 2;
                }
            };

            var get = function (value) {
                if (typeof value !== 'undefined') {
                    if (typeof state[value] !== 'undefined') return state[value];
                    if (typeof computed[value] === 'function') return computed[value]();
                    throw new Error('unexpected state key');
                }
                return state;
            };

            var reducer = function (state, action) {
                debug('[REDUCER]', action.type, action);
                debug('   before: ', state);
                switch (action.type) {
                case 'saveAsClicked':
                    return {
                        inputActive: true,
                        input: computed.currentPalette().name
                    };
                case 'saveClicked':
                    if (get('saveDisabled')) return {};
                    return {
                        inputActive: false,
                        colorSet: state.colorSet.map(function (palette, i) {
                            if (i === state.index) {
                                return {
                                    name: palette.name,
                                    colors: state.tempPalette.slice()
                                };
                            }
                            return palette;
                        }),
                        dirty: false
                    };
                case 'deleteClicked':
                    var nxtColorSet = state.colorSet.filter(function (a, i) {
                        return i !== state.index;
                    });
                    var nxtIndex = Math.min(state.index, nxtColorSet.length - 1);
                    return {
                        colorSet: nxtColorSet,
                        index: nxtIndex,
                        dity: false,
                        tempPalette: nxtColorSet[nxtIndex].colors.slice()
                    };
                case 'paletteSelected':
                    if (state.index === action.index) return {};
                    return {
                        index: action.index,
                        tempPalette: state.colorSet[action.index].colors.slice(),
                        dirty: false
                    };
                case 'paletteChanged':
                    var newPalette = state.tempPalette.map(function (color, i) {
                        if (i === action.index) return action.color;
                        return color;
                    });
                    return {
                        tempPalette: newPalette.slice(),
                        dirty: true
                    };
                case 'cancelClicked':
                    return {inputActive: false};
                case 'inputChanged':
                    return {input: action.input};
                case 'resetClicked':
                    return {
                        tempPalette: computed.currentPalette().colors.slice(),
                        dirty: false
                    };
                case 'saveOkClicked':
                    var newColorSet = state.colorSet.concat([{
                        name: state.input,
                        colors: state.tempPalette.slice()
                    }]);
                    return {
                        inputActive: false,
                        index: newColorSet.length - 1,
                        colorSet: newColorSet,
                        dirty: false
                    };
                default:
                    throw new Error('unexpected action');
                }
            };

            return {
                dispatch: function (action) {
                    history.push(state);
                    state = _.merge({}, state, reducer(state, action), function (a, b) {
                        if (Array.isArray(b)) return b;
                    });
                    while (history.length > 5) history.shift();
                    debug('   after: ', state);
                    self.changeValue(self.getSettingId('palette'), state.colorSet);
                    self.changeValue(self.getSettingId('selectedPalette'),
                        computed.currentPalette().name);
                },
                get: get,
                undo: function () {
                    if (history.length === 0) throw new Error('cannot undo');
                    debug('[UNDO]');
                    debug('    before: ', state);
                    state = Object.assign({}, history.pop());
                    debug('    after: ', state);
                    self.changeValue(self.getSettingId('palette'), state.colorSet);
                    self.changeValue(self.getSettingId('selectedPalette'),
                        computed.currentPalette().name);
                }
            };
        }());
        return store;
    };

    ChartSetting.prototype.renderUseControl = function () {
        this.$useControl.jqxCheckBox({checked: this.getValue(this.getSettingId('use')) == 'true'});

        if (this.getValue(this.getSettingId('use')) != 'true') {
            [this.numberControl, this.integerControl].forEach((el) => el.setDisabled(true));
        }
    };

    ChartSetting.prototype.renderNumberControl = function () {
        this.numberControl.setValue(this.getValue(this.getSettingId('double')));
        this.integerControl.setValue(this.getValue(this.getSettingId('integer')));
    };

    ChartSetting.prototype.renderPivotControl = function () {
        var _this = this;
        this.$pivotControl.jqxCheckBox({checked: _this.getValue(_this.getSettingId('pivot')) == 'true'});
    };

    ChartSetting.prototype.getIndex = function () {
        return 3;
    };

    ChartSetting.Key = 'setting-chart';
    ChartSetting.Label = 'Chart';
    ChartSetting.index = 3;

    Brightics.VA.Setting.Registry[ChartSetting.Key] = ChartSetting;
}).call(this);

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function CommonSetting(parentId, options) {
        Brightics.VA.Setting.BaseSetting.call(this, parentId, options);
    }

    CommonSetting.prototype = Object.create(Brightics.VA.Setting.BaseSetting.prototype);
    CommonSetting.prototype.constructor = CommonSetting;

    CommonSetting.prototype.initSettingId = function ($parent) {
        this.SettingId = {
            scrollBar: 'common.scroll.indicate.mouseover',
            useOnline: 'common.document.useonline',
            url: 'common.document.onlinedocurl',
            urlDefault: 'common.document.onlinedocurl.default'
        }
    };

    CommonSetting.prototype.createContents = function ($parent) {
        Brightics.VA.Setting.BaseSetting.prototype.createContents.call(this, $parent);

        this.createScrollbarControl();
        this.createDocumentControl();
    };

    CommonSetting.prototype.createScrollbarControl = function () {
        this.$scrollbarControl = this._createCheckBox(this.$mainControl, {
            settingId: this.getSettingId('scrollBar'),
            label: 'Show scroll bar only when the mouse is over on scrollable area. (Show always when unchecked)'
        });
    };

    CommonSetting.prototype.createDocumentControl = function () {
        var _this = this;

        var $controlWrapper = $('' +
            '<div class="brtc-va-setting-component-wrapper">' +
            '   <div class="' + this._parseSettingIdToClassName(this.getSettingId('useOnline')) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-va-setting-checkbox-content use"></div>' +
            '       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1">Use on-line help document (※ The prefix "http://" is required.)</div>' +
            '   </div>' +
            '   <div class="' + this._parseSettingIdToClassName(this.getSettingId('url')) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-va-setting-input-content-label">URL</div>' +
            '       <input class="brtc-va-setting-input-content link" type="text">' +
            '   </div>' +
            '   <div class="brtc-va-setting-input-content-validation-tooltip-wrapper">' +
            // '       <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' +
            '       <div class="brtc-va-setting-input-content-validation-tooltip">' +
            '       </div>' +
            '   </div>' +
            '</div>');

        this.$mainControl.append($controlWrapper);

        this.$useControl = $controlWrapper.find('.brtc-va-setting-checkbox-content.use');
        this.$useControl.jqxCheckBox({
            theme: Brightics.VA.Env.Theme
        });

        this.$linkControl = $controlWrapper.find('.brtc-va-setting-input-content.link').jqxInput({
            theme: Brightics.VA.Env.Theme,
            placeHolder: _this.getValue(_this.getSettingId('urlDefault')),
            height: 25,
            width: '100%'
        });

        this.$useControl.on('change', function (event) {
            var checked = event.args.checked;

            if (checked) {
                _this.$linkControl.jqxInput({disabled:false});
            } else {
                _this.$linkControl.jqxInput({disabled:true});
            }

            _this.changeValue(_this.getSettingId('useOnline'), checked);
            _this.renderMessage(_this.validateUrl(_this.getValue(_this.getSettingId('url'))));
        });

        this.$linkControl.on('change', function () {
            var value = $(this).val();

            _this.changeValue(_this.getSettingId('url'), value);
            _this.renderMessage(_this.validateUrl(value));
        });

        this.$validationWrapper =
            $controlWrapper.find('.brtc-va-setting-input-content-validation-tooltip-wrapper');
        this.$validation =
            $controlWrapper.find('.brtc-va-setting-input-content-validation-tooltip');
    };

    CommonSetting.prototype.render = function () {
        this.renderScrollbarControl();
        this.renderDocumentControl();
    };

    CommonSetting.prototype.renderScrollbarControl = function () {
        var _this = this;

        this.$scrollbarControl.find('.brtc-va-setting-checkbox-content').jqxCheckBox({
            checked: _this.getValue(_this.getSettingId('scrollBar')) == 'true'
        });
    };

    CommonSetting.prototype.renderDocumentControl = function () {
        var _this = this;

        this.$useControl.jqxCheckBox({checked: _this.getValue(_this.getSettingId('useOnline')) == 'true'});

        if (_this.getValue(_this.getSettingId('useOnline')) != 'true') {
            _this.$linkControl.jqxInput({'disabled': true});
        }

        this.$linkControl.val(_this.getValue(_this.getSettingId('url')));
    };

    CommonSetting.prototype.getIndex = function () {
        return 1;
    };

    CommonSetting.prototype.validateUrl = function () {
        var useOnline = this.getValue(this.getSettingId('useOnline')) === 'true';
        var url = this.getValue(this.getSettingId('url'));
        var defaultUrl = this.getValue(this.getSettingId('urlDefault'));
        if (useOnline) {
            if (!url && defaultUrl) {
                return '';
            }
            if (!url && !defaultUrl) {
                return 'URL is not specified.';
            }
            if (!_.startsWith(url, 'http://')) {
                return 'URL must start with \'http://\'.';
            }
        }
        return '';
    };

    CommonSetting.prototype.renderMessage = function (msg) {
        if (msg === '' || this.getValue(this.getSettingId('useOnline')) !== 'true') {
            this.$validationWrapper.hide();
        } else {
            this.$validationWrapper.show();
            this.$validation.html(msg);
        }
    };

    CommonSetting.Key = 'setting-common';
    CommonSetting.Label = 'Common';
    CommonSetting.index = 1;

    Brightics.VA.Setting.Registry[CommonSetting.Key] = CommonSetting;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function EditorSetting(parentId, options) {
        Brightics.VA.Setting.BaseSetting.call(this, parentId, options);
    }

    EditorSetting.prototype = Object.create(Brightics.VA.Setting.BaseSetting.prototype);
    EditorSetting.prototype.constructor = EditorSetting;

    EditorSetting.prototype.initSettingId = function ($parent) {
        this.SettingId = {
            autoConnect: 'editor.diagram.autoconnect',
            minimap: 'editor.minimap.visible',
            doubleClick: 'editor.function.add.doubleclick',
            variable: 'editor.variable.visible',
            dataCount: 'editor.datapanel.defaultrowcount',
            useMaximum: 'editor.useMaximum',
            maxFuncNum: 'editor.maxfuncnum',
            closePanelOnClick: 'editor.closePanelOnClick'
        }
    };

    EditorSetting.prototype.createContents = function ($parent) {
        Brightics.VA.Setting.BaseSetting.prototype.createContents.call(this, $parent);

        this.createAutoConnectControl();
        this.createMinimapControl();
        this.createDoubleClickControl();
        this.createVariableControl();
        this.createDataCountControl();
        this.createMaxFuncControl();
        this.createClosePanelControl();
    };

    EditorSetting.prototype.createAutoConnectControl = function ($parent) {
        var _this = this;

        this.$autoConnectControl = this._createCheckBox(this.$mainControl, {
            settingId: _this.getSettingId('autoConnect'),
            label: "Link adjacent function(s) automatically.",
            // tagList: ['data', 'deeplearning']
            tagList: ['data']
        });
    };

    EditorSetting.prototype.createMinimapControl = function ($parent) {
        var _this = this;

        this.$minimapControl = this._createCheckBox(this.$mainControl, {
            settingId: _this.getSettingId('minimap'),
            label: "Show mini map when open a editor.",
            tagList: ['data', 'realtime', 'deeplearning']
        });
    };

    EditorSetting.prototype.createDoubleClickControl = function ($parent) {
        var _this = this;

        // this.$doubleClickControl = this._createCheckBox(this.$mainControl, {
        //     settingId: _this.getSettingId('doubleClick'),
        //     label: "Use double click to add function on editor.",
        //     tagList: ['data', 'realtime', 'deeplearning']
        // });
        this.$doubleClickControl = $(crel('div', {
            class: 'brtc-va-setting-component-wrapper'
        }, 'Change operation to add function.'));
        this.$mainControl.append(this.$doubleClickControl);

        var $radioDoubleClick = $(crel('div', {
            class: 'brtc-va-editors-sheet-controls-radiobutton-default doubleclick',
            style: 'margin-left: 10px'
        }, 'Use double click to add function.'));
        this.$doubleClickControl.append($radioDoubleClick);
        $radioDoubleClick.jqxRadioButton({theme: Brightics.VA.Env.Theme});

        var $radioClick = $(crel('div', {
            class: 'brtc-va-editors-sheet-controls-radiobutton-default click',
            style: 'margin-left: 10px'
        }, 'Use click to add function.'));
        this.$doubleClickControl.append($radioClick);
        $radioClick.jqxRadioButton({theme: Brightics.VA.Env.Theme});

        this._createEditorTagList(this.$doubleClickControl, ['data', 'realtime', 'deeplearning']);

        $radioDoubleClick.on('change', function (event) {
            var checked = event.args.checked;
            _this.changeValue(_this.getSettingId('doubleClick'), checked);
        });
    };

    EditorSetting.prototype.createVariableControl = function ($parent) {
        var _this = this;

        this.$variableControl = this._createCheckBox(this.$mainControl, {
            settingId: _this.getSettingId('variable'),
            label: "Use variable before running.",
            tagList: ['data', 'control', 'realtime']
        });
    };

    EditorSetting.prototype.createDataCountControl = function ($parent) {
        var _this = this;

        this.$dataCountControl = this._createDropDownList(this.$mainControl, {
            settingId: _this.getSettingId('dataCount'),
            label: 'Default number of rows to show in data panel',
            width: 100,
            list: ['1000', '3000', '5000', '10000', '50000'],
            tagList: ['data', 'realtime'],
            dropDownHeight: 100
        });
    };

    EditorSetting.prototype.createMaxFuncControl = function ($parent) {
        var _this = this;

        var $controlWrapper = $('' +
            '<div class="brtc-va-setting-component-wrapper">' +
            '   <div class="' + this._parseSettingIdToClassName(this.getSettingId('useMaximum')) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">' +
            '       <div class="brtc-va-setting-checkbox-content useMaximum"></div>' +
            '       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1"> Set maximum number of functions on editor.</div>' +
            '   </div>' +
            '   <div class="' + this._parseSettingIdToClassName(this.getSettingId('maxFuncNum')) + ' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center" style="margin-left:  30px;">' +
            '       <div class="brtc-va-setting-input-content-label">Number</div>' +
            '       <div class="brtc-va-setting-input-content number"></div>' +
            '   </div>' +
            '</div>');

        this.$mainControl.append($controlWrapper);

        this.$useControl = $controlWrapper.find('.brtc-va-setting-checkbox-content.useMaximum');
        this.$useControl.jqxCheckBox({
            theme: Brightics.VA.Env.Theme
        });

        var $numberControl = $controlWrapper.find('.brtc-va-setting-input-content.number');
        this.numberControl = this._createNumericInput($numberControl, {
            numberType: 'int',
            min: 1,
            max: 120,
            minus: false,
            placeholder: '120'
        });

        this.$useControl.on('change', function (event) {
            var checked = event.args.checked;

            if (checked) {
                _this.numberControl.setDisabled(false);
            } else {
                _this.numberControl.$mainControl.val('120');
                _this.numberControl.setDisabled(!checked);
                _this.changeValue(_this.getSettingId('maxFuncNum'), 120);
            }
            _this.changeValue(_this.getSettingId('useMaximum'), checked);

        });

        this.numberControl.onChange(function () {
            var digitValue = _this.numberControl.getValue();
            _this.changeValue(_this.getSettingId('maxFuncNum'), digitValue);
        });

        this._createEditorTagList(this.$mainControl, ['data']);

        this.controlList.push($controlWrapper);
    };

    EditorSetting.prototype.createClosePanelControl = function ($parent) {
        var _this = this;

        this.$closePanelControl = this._createCheckBox(this.$mainControl, {
            settingId: _this.getSettingId('closePanelOnClick'),
            label: "Close an open panel by clicking a blank outside.",
            tagList: ['data']
        });
    };

    EditorSetting.prototype.render = function () {
        this.renderAutoConnectControl();
        this.renderMinimapControl();
        this.renderDoubleClickControl();
        this.renderVariableControl();
        this.renderDataCountControl();
        this.renderMaxFuncControl();
        this.renderClosePanelControl();
    };

    EditorSetting.prototype.renderAutoConnectControl = function () {
        var _this = this;

        this.$autoConnectControl.find('.brtc-va-setting-checkbox-content').jqxCheckBox({
            checked: _this.getValue(_this.getSettingId('autoConnect')) == 'true'
        });
    };

    EditorSetting.prototype.renderMinimapControl = function () {
        var _this = this;

        this.$minimapControl.find('.brtc-va-setting-checkbox-content').jqxCheckBox({
            checked: _this.getValue(_this.getSettingId('minimap')) == 'true'
        });
    };

    EditorSetting.prototype.renderDoubleClickControl = function () {
        var _this = this;

        // this.$doubleClickControl.find('.brtc-va-setting-checkbox-content').jqxCheckBox({
        //     checked: _this.getValue(_this.getSettingId('doubleClick')) == 'true'
        // });
        var value = this.getValue(this.getSettingId('doubleClick'));
        this.$doubleClickControl.find('.brtc-va-editors-sheet-controls-radiobutton-default.click').jqxRadioButton({
            checked: value == 'false'
        });
        this.$doubleClickControl.find('.brtc-va-editors-sheet-controls-radiobutton-default.doubleclick').jqxRadioButton({
            checked: value == 'true'
        });
    };

    EditorSetting.prototype.renderVariableControl = function () {
        var _this = this;

        this.$variableControl.find('.brtc-va-setting-checkbox-content').jqxCheckBox({
            checked: _this.getValue(_this.getSettingId('variable')) == 'true'
        });
    };

    EditorSetting.prototype.renderDataCountControl = function () {
        var _this = this;

        this.$dataCountControl.find('.brtc-va-setting-dropdownlist-content').jqxDropDownList('selectItem', _this.getValue(_this.getSettingId('dataCount')));
    };

    EditorSetting.prototype.renderMaxFuncControl = function () {
        this.renderNumberControl();
        this.renderUseControl();
    };

    EditorSetting.prototype.renderNumberControl = function () {
        var _this = this;

        this.numberControl.setValue(_this.getValue(_this.getSettingId('maxFuncNum')));
        // this.numberControl.focus();
    };

    EditorSetting.prototype.renderUseControl = function () {
        var _this = this;

        this.$useControl.jqxCheckBox({checked: _this.getValue(_this.getSettingId('useMaximum')) == 'true'});

        if (_this.getValue(_this.getSettingId('useMaximum')) != 'true') {
            _this.numberControl.setDisabled(true);
        }
    };

    EditorSetting.prototype.renderClosePanelControl = function () {
        var _this = this;

        this.$closePanelControl.find('.brtc-va-setting-checkbox-content').jqxCheckBox({
            checked: _this.getValue(_this.getSettingId('closePanelOnClick')) == 'true'
        });
    };

    EditorSetting.prototype.getIndex = function () {
        return 2;
    };

    EditorSetting.prototype.applyPreferenceSettings = function () {
        // if( $('body').hasClass('scroll-always')){
        //     this.$mainControl.closest('.brtc-va-dialogs-content-panel').perfectScrollbar('update');
        // }
        this.$mainControl.closest('.brtc-va-dialogs-content-panel').perfectScrollbar('update');
    };

    EditorSetting.Key = 'setting-editor';
    EditorSetting.Label = 'Editor';
    EditorSetting.index = 2;

    Brightics.VA.Setting.Registry[EditorSetting.Key] = EditorSetting;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Preference(customPreference) {
        this.init();
        this.customPreference = customPreference;
    }

    Preference.prototype.init = function () {
        this.preferenceMap = {};

        for (var key in Brightics.VA.Setting.Registry) {
            if (Brightics.VA.Preference[key]) this.preferenceMap[key] = new Brightics.VA.Preference[key](this.customPreference);
        }

        this.applySetting();
    };

    Preference.prototype.applySetting = function () {
        for (var key in this.preferenceMap) {
            this.preferenceMap[key].applySetting();
        }
    };

    Preference.prototype.preferenceChanged = function () {
        this.applySetting();
    };

    Brightics.VA.Preference = Preference;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var KEY = 'setting-chart';

    function ChartPreference(customPreference) {
        this.storageMap = {
            table: {
                number: 'chart.table.formatter.number',
                double: 'chart.table.formatter.double',
                integer: 'chart.table.formatter.integer',
                use: 'chart.table.formatter.use',
                pivot: 'chart.table.formatter.pivot'
            },
            color: {
                selectedPalette: 'chart.style.selectedColorSet',
                palette: 'chart.style.colorSet'
            }
        };

        this.customPreference = customPreference;
    }

    ChartPreference.prototype.applySetting = function () {
        this.storage = (this.customPreference)? this.customPreference : localStorage;

        this.applyNumber();
        this.applyPivot();
        this.applyCustomColorPalettes();
    };

    ChartPreference.prototype.applyNumber = function () {
        var isDefault = this.storage[this.storageMap.table.use];
        if (isDefault === 'true') {
            var options = [
                'double',
                'integer'
            ].map((type) => {
                return {
                    type,
                    digit: this.storage[this.storageMap.table[type]]
                };
            });

            Brightics.Chart.Helper.PreferenceUtils.setTableFormatter(options);
        } else {
            Brightics.Chart.Helper.PreferenceUtils.clearTableFormatter();
        }
    };

    ChartPreference.prototype.applyPivot = function () {
        var pivotDefault = this.storage[this.storageMap.table.pivot];
        var options = [{
            pivot: pivotDefault
        }];

        Brightics.Chart.Helper.PreferenceUtils.setTableFormatter(options);
    };

    ChartPreference.prototype.applyCustomColorPalettes = function () {
        var get = function (storage, key) {
            if (typeof storage[key] !== 'undefined') return storage[key];
            return Brightics.VA.SettingStorage.DEFAULT_SETTINGS[key];
        };
        var selectedPalette = get(this.storage, this.storageMap.color.selectedPalette);
        var colorSet = JSON.parse(get(this.storage, this.storageMap.color.palette));
        Brightics.Chart.Adonis.Preference.setColorPalette(selectedPalette, colorSet);
    };

    Brightics.VA.Preference[KEY] = ChartPreference;
}).call(this);

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var KEY = 'setting-common';

    function CommonPreference(customPreference) {
        this.storageMap = {
            common: {
                scroll: 'common.scroll.indicate.mouseover'
            }
        };

        this.customPreference = customPreference;
    }

    CommonPreference.prototype.applySetting = function () {
        this.storage = (this.customPreference)? this.customPreference : localStorage;

        this.applyScroll();
    };

    CommonPreference.prototype.applyScroll = function () {
        var isIndicate = this.storage[this.storageMap.common['scroll']];

        if (isIndicate === 'false') {
            $('body').addClass('scroll-always');
        } else {
            $('body').removeClass('scroll-always');
        }
    };

    Brightics.VA.Preference[KEY] = CommonPreference;

}).call(this);
/**
 * Created by SDS on 2016-09-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function StepValidator() {
        Brightics.VA.Core.Validator.BaseValidator.call(this);
    }


    StepValidator.prototype = Object.create(Brightics.VA.Core.Validator.BaseValidator.prototype);
    StepValidator.prototype.constructor = StepValidator;

    StepValidator.prototype.initRules = function () {

    };

    StepValidator.prototype.createProblem = function (checkResult) {
        var _this = this;
        return {
            level: _this.problemFactory.rule[checkResult.errorCode].level,
            param: checkResult.param,
            paramIndex: checkResult.paramIndex,
            code: checkResult.errorCode,
            message: _this.problemFactory.makeMessage(checkResult)
        };
    };

    StepValidator.prototype.getSchema = function (fnUnit) {
        var columns = [];
        this.options.dataProxy.requestSchema(fnUnit[IN_DATA][0],
            function (result) {
                columns = result.columns;
            });
        return columns;
    };


    Brightics.VA.Core.Validator.StepValidator = StepValidator;

}).call(this);
/**
 * Created by SDS on 2016-09-11.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AddColumnValidator() {
        Brightics.VA.Core.Validator.StepValidator.call(this);
        this.PARAM_SELECT = 'select';
    }

    AddColumnValidator.prototype = Object.create(Brightics.VA.Core.Validator.StepValidator.prototype);
    AddColumnValidator.prototype.constructor = AddColumnValidator;

    AddColumnValidator.prototype.initRules = function () {
        Brightics.VA.Core.Validator.StepValidator.prototype.initRules.call(this);
        this.addRule(this.emptyNewColumnAndValue);
    };

    AddColumnValidator.prototype.emptyNewColumnAndValue = function (fnUnit) {
        var problems = [];
        if (typeof fnUnit.param[this.PARAM_SELECT] === 'undefined') {
            problems.push(this.createProblem({
                errorCode: 'BR-0033',
                paramIndex: key,
                param: 'New column name',
                messageParam: ['New column name', 'Value']
            }));
            return problems;
        } else {
            var newColumnNames = [];
            var select = fnUnit.param[this.PARAM_SELECT];
            var res = select.split("\n");
            if (res[0].startsWith('*')) {
                res.splice(0, 1);
            }

            for (var i = 0; i < res.length; i++) {
                var pos = res[i].lastIndexOf(' as ');
                var newValue = res[i].substring(0, pos).trim();
                var newColumn = res[i].substring(pos + 4).trim();
                if (newColumn.slice(-1) == ',') {
                    newColumn = newColumn.substring(0, newColumn.length - 1);
                }
                if (newColumn === '') {
                    problems.push(this.createProblem({
                        errorCode: 'BR-0033',
                        paramIndex: i,
                        param: 'New column name',
                        messageParam: ['New column name']
                    }));
                } else if ($.inArray(newColumn, newColumnNames) > -1) {
                    var messageParam = "New column name(s) - '" + newColumn + "' already exist.";
                    problems.push(this.createProblem({
                        errorCode: 'BR-0100',
                        paramIndex: i,
                        param: 'New column name',
                        messageParam: [messageParam]
                    }));
                }
                // else if ($.inArray(newColumn, $.map(this.getSchema(fnUnit), function (column) {
                //         return column.name
                //     })) > -1) {
                //     problems.push(this.createProblem({
                //         errorCode: 'EX004',
                //         paramIndex: i,
                //         param: 'New column name',
                //         messageParam: ['New column name']
                //     }));
                // }
                else {
                    if (newValue === '') {
                        problems.push(this.createProblem({
                            errorCode: 'BR-0033',
                            paramIndex: i,
                            param: 'Value',
                            messageParam: ['Value']
                        }));
                    }
                    newColumnNames.push(newColumn);
                }
            }
            return problems;
        }
    };

    Brightics.VA.Core.Validator.AddColumnValidator = AddColumnValidator;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function StepDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true,
            // SQLExecutor: {},
            FnUnit: {}
        };
        this.problemFactory = new Brightics.VA.Core.Validator.ProblemFactory();
        this.problems = [];
        this.resultFnUnit = {};
        this.DEFAULT_SCRIPT = 'from pandasql import sqldf\n' +
            'pysqldf = lambda q: sqldf(q, globals())\n' +
            'data = inputs[0]\n' +
            'result = pysqldf(\'SELECT ${SELECT_SQL} FROM data ${ADDITIONAL_QUERY}\')';

        this.DEFAULT_FN_UNIT = {
            'fid': '',
            'func': '',
            'name': 'SQLExecutor',
            'inData': [],
            'outData': [],
            'param': {
                'select': '',
                'additional-query': ''
            },
            'display': {
                'label': ''
            }
        };

        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    StepDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    StepDialog.prototype.getTitle = function () {
        return '';
    };

    StepDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main">' +
            // '   <div class="brtc-va-dialogs-header">' +'<div class="brtc-va-refine-step-header-help" title="Help"></div></div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />' +
            '       </div>' +
            '   </div>' +
            '</div>');

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: this.getTitle(),
            width: 600,
            height: 500,
            maxWidth: 600,
            maxHeight: 500,
            modal: true,
            resizable: false,
            close: this.destroy.bind(this)
        };
        this.$mainControl.dialog(jqxOpt);

        this.$mainControl.find('.brtc-va-refine-step-header-help').css('display', 'none');
        this.$mainControl.find('.brtc-va-refine-step-header-help').click(function () {
            var w = window.open('api/va/v2/help/function/sqlfunctionhelp', 'SQL Function Help');
            w.blur();
        });
    };

    StepDialog.prototype.initContents = function () {
        var _this = this;
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$okButton.click(_this.handleOkClicked.bind(_this));

        _this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$cancelButton.click(_this.handleCancelClicked.bind(_this));
    };

    StepDialog.prototype.destroy = function () {
        this.$mainControl.dialog('destroy');
        if (typeof this.options.close == 'function') {
            this.options.close(this.dialogResult);
        }
    };

    StepDialog.prototype.destroyColumnSelector = function () {
        var $columnSelector = $('.brtc-va-editors-sheet-controls-columnselector-editarea');
        if ($columnSelector.length > 0) {
            $columnSelector.dialog('close');
            $columnSelector.dialog('destroy');
        }
    };

    StepDialog.prototype.createDialogContentsArea = function ($parent) {
    };


    StepDialog.prototype.handleOkClicked = function () {
        this.dialogResult.OK = true;
        this.dialogResult.Cancel = false;
        this.dialogResult.force = this.options.force;
        this.dialogResult.FnUnit = this.resultFnUnit;

        this.$mainControl.dialog('close');
    };

    StepDialog.prototype.handleCancelClicked = function () {
        this.dialogResult.OK = false;
        this.dialogResult.Cancel = true;
        this.dialogResult.force = this.options.force;

        this.$mainControl.dialog('close');
    };

    StepDialog.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');
        $control.wrap($wrapper);
    };

    StepDialog.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    StepDialog.prototype.addCssToWrapper = function ($control, cssOptions) {
        if (cssOptions) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.css(cssOptions);
        }
    };

    StepDialog.prototype.createColumnList = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            multiple: true,
            rowCount: 1,
            maxRowCount: 5,
            expand: false,
            sort: 'none',
            sortBy: 'name',
            showOpener: 'button',
            removable: true,
            defaultType: '-',
            changed: function (type, data) {

            },
            added: function () {

            },
            removed: function () {

            }
        };

        if (widgetOptions) {
            $.extend(options, widgetOptions);
        }

        return new Brightics.VA.Core.Editors.Sheet.Controls.ColumnList($control, options);
    };
    StepDialog.prototype.createButton = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxButton(options);
    };

    StepDialog.prototype.createSQLExecutor = function (label, func, select, additionalQuery) {
        this.dialogResult.FnUnit = this.resultFnUnit;
        // this.dialogResult.SQLExecutor = {
        //     'fid': this.options.fid ? this.options.fid : Brightics.VA.Core.Utils.IDGenerator.func.id(),
        //     'func': func,
        //     'name': 'SQLExecutor',
        //     'inData': this.options.in,
        //     'outData': this.options.out,
        //     'param': {
        //         'select': select,
        //         'additional-query': additionalQuery
        //     },
        //     'display': {
        //         'label': label
        //     }
        // };
    };

    StepDialog.prototype.addProblem = function (problem) {
        this.problems.push(problem);
    };

    StepDialog.prototype.checkValidation = function () {

    };

    StepDialog.prototype.createValidationContent = function ($parent, problemData, $control) {
        var $problemContent = $('<div class="brtc-va-refine-step-validation-tooltip">' +
            '<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(problemData.message) +
            '</div>');
        $parent.append($problemContent);
        if ($control) {
            $control.addClass('brtc-va-refine-step-validation-error');
        } else {
            $parent.addClass('brtc-va-refine-step-validation-error');
        }

        $problemContent.show();
    };

    StepDialog.prototype.removeValidation = function () {
        this.$mainControl.find('.brtc-va-refine-step-validation-error').removeClass('brtc-va-refine-step-validation-error');
        this.$mainControl.find('.brtc-va-refine-step-validation-tooltip').remove();
        this.problems = [];
    };

    StepDialog.prototype.createProblem = function (checkResult, fid) {
        var _this = this;
        return {
            // level: _this.problemFactory.rule[checkResult.errorCode].level,
            param: checkResult.param,
            paramIndex: checkResult.paramIndex,
            code: checkResult.errorCode,
            message: _this.problemFactory.makeMessage(checkResult)
        };
    };

    StepDialog.prototype.sortableStopCallback = {
        hideRemoveButton: function (dialogControl, itemClass, removeButtonClass) {
            var itemList = dialogControl.$mainControl.find('.' + itemClass);

            for (var i = 0; i < itemList.length; i++) {
                if (i == 0) {
                    $(itemList[i]).find('.' + removeButtonClass).hide();
                } else {
                    $(itemList[i]).find('.' + removeButtonClass).show();
                }
            }
        }

    };

    StepDialog.prototype.sqlFunctionHelpContent = function () {
        var data = $('' +
            '<div class="brtc-va-searcharea" style="float:right; position:fixed; right:10px"><input type="search" class="searchinput" placeholder="Search Key..."/></div>' +
            '<div style="font-family: "Lucida Grande", "Segoe UI", "Apple SD Gothic Neo", "Malgun Gothic", "Lucida Sans Unicode", Helvetica, Arial, sans-serif; font-size: 0.9em; overflow-x: hidden; overflow-y: auto; margin: 0px !important; padding: 5px 20px 26px !important; background-color: rgb(255, 255, 255);font-family: "Hiragino Sans GB", "Microsoft YaHei", STHeiti, SimSun, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "Segoe UI", AppleSDGothicNeo-Medium, "Malgun Gothic", Verdana, Tahoma, sans-serif; padding: 20px;padding: 20px; font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", STHeiti, SimSun, "Segoe UI", AppleSDGothicNeo-Medium, "Malgun Gothic", Arial, freesans, sans-serif; font-size: 15px; line-height: 1.6; -webkit-font-smoothing: antialiased; background: rgb(255, 255, 255);">' +
            '<h1 id="sql-functions" style="clear: both;font-size: 2.2em; font-weight: bold; margin: 1.5em 0px 1em;margin-top: 0px;"><a name="sql-functions" href="#sql-functions" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>SQL Function Help</h1><h2 id="date-functions" style="clear: both;font-size: 1.8em; font-weight: bold; margin: 1.275em 0px 0.85em;border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(230, 230, 230); line-height: 1.6;"><a name="date-functions" href="#date-functions" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>Date Functions</h2><p style="margin-top: 0px;margin: 1em 0px; word-wrap: break-word;">The following built-in date functions are supported in hive.</p><table style="padding: 0px; border-collapse: collapse; border-spacing: 0px; margin-bottom: 16px;background-color: rgb(250, 250, 250);">' +
            '<thead>' +
            '<tr>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Return Type</th>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Name(Signature)</th>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Example</th>' +
            '</tr>' +
            '</thead>' +
            '<tbody>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">from_unixtime(bigint unixtime[, string format])</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts the number of seconds from unix epoch (1970-01-01 00:00:00 UTC) to a string representing the timestamp of that moment in the current system time zone in the format of "1970-01-01 00:00:00"</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bigint</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">unix_timestamp()</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Gets current time stamp using the default time zone.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bigint</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">unix_timestamp(string date)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts time string in format yyyy-MM-dd HH:mm:ss to Unix time stamp, return 0 if fail: unix_timestamp(??009-03-20 11:30:01?? = 1237573801</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bigint</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">unix_timestamp(string date, string pattern)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Convert time string with given pattern to Unix time stamp, return 0 if fail: unix_timestamp(??009-03-20?? ?�yyyy-MM-dd?? = 1237532400</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">to_date(string timestamp)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the date part of a timestamp string: to_date("1970-01-01 00:00:00") = "1970-01-01"</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">year(string date)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the year part of a date or a timestamp string: year("1970-01-01 00:00:00") = 1970, year("1970-01-01") = 1970</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">month(string date)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the month part of a date or a timestamp string: month("1970-11-01 00:00:00") = 11, month("1970-11-01") = 11</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">day(string date) dayofmonth(date)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return the day part of a date or a timestamp string: day("1970-11-01 00:00:00") = 1, day("1970-11-01") = 1</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">hour(string date)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the hour of the timestamp: hour(??009-07-30 12:58:59?? = 12, hour(??2:58:59?? = 12</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">minute(string date)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the minute of the timestamp</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">second(string date)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the second of the timestamp</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">weekofyear(string date)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return the week number of a timestamp string: weekofyear("1970-11-01 00:00:00") = 44, weekofyear("1970-11-01") = 44</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">datediff(string enddate, string startdate)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return the number of days from startdate to enddate: datediff(??009-03-01?? ??009-02-27?? = 2</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">date_add(string startdate, int days)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Add a number of days to startdate: date_add(??008-12-31?? 1) = ??009-01-01??/td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">date_sub(string startdate, int days)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Subtract a number of days to startdate: date_sub(??008-12-31?? 1) = ??008-12-30??/td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">timestamp</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">from_utc_timestamp(timestamp, string timezone)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Assumes given timestamp ist UTC and converts to given timezone (as of Hive 0.8.0)</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">timestamp</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">to_utc_timestamp(timestamp, string timezone)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Assumes given timestamp is in given timezone and converts to UTC (as of Hive 0.8.0)</td>' +
            '</tr>' +
            '</tbody>' +
            '</table><h2 id="mathematical-functions" style="clear: both;font-size: 1.8em; font-weight: bold; margin: 1.275em 0px 0.85em;border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(230, 230, 230); line-height: 1.6;">`<a name="mathematical-functions" href="#mathematical-functions" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>Mathematical Functions</h2><p style="margin-top: 0px;margin: 1em 0px; word-wrap: break-word;">The following built-in mathematical functions are supported in hive; most return NULL when the argument(s) are NULL:</p><table style="padding: 0px; border-collapse: collapse; border-spacing: 0px; margin-bottom: 16px;background-color: rgb(250, 250, 250);">' +
            '<thead>' +
            '<tr>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Return Type</th>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Name(Signature)</th>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Example</th>' +
            '</tr>' +
            '</thead>' +
            '<tbody>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">BIGINT</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">round(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the rounded BIGINT value of the double</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">DOUBLE</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">round(double a, int d)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the double rounded to d decimal places</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">BIGINT</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">floor(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the maximum BIGINT value that is equal or less than the double</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">BIGINT</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ceil(double a), ceiling(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the minimum BIGINT value that is equal or greater than the double</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">rand(), rand(int seed)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns a random number (that changes from row to row) that is distributed uniformly from 0 to 1. Specifiying the seed will make sure the generated random number sequence is deterministic.</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">exp(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns e<sup style="margin-top: 0px;margin-bottom: 0px;">a</sup> where e is the base of the natural logarithm</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ln(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the natural logarithm of the argument</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">log10(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the base-10 logarithm of the argument</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">log2(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the base-2 logarithm of the argument</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">log(double base, double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return the base "base" logarithm of the argument</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">pow(double a, double p), power(double a, double p)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return a<sup style="margin-top: 0px;margin-bottom: 0px;">p</sup></td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sqrt(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the square root of a</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bin(BIGINT a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the number in binary format</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">hex(BIGINT a) hex(string a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">If the argument is an int, hex returns the number as a string in hex format. Otherwise if the number is a string, it converts each character into its hex representation and returns the resulting string.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">unhex(string a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Inverse of hex. Interprets each pair of characters as a hexidecimal number and converts to the character represented by the number.</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">conv(BIGINT num, int from_base, int to_base), conv(STRING num, int from_base, int to_base)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts a number from a given base to another</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">abs(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the absolute value</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">pmod(int a, int b) pmod(double a, double b)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the positive value of a mod b</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sin(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the sine of a (a is in radians)</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">asin(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the arc sin of x if -1&lt;=a&lt;=1 or null otherwise</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">cos(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the cosine of a (a is in radians)</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">acos(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the arc cosine of x if -1&lt;=a&lt;=1 or null otherwise</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">tan(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">tan(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the tangent of a (a is in radians)</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">atan(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the arctangent of a</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">degrees(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts value of a from radians to degrees</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">radians(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts value of a from degrees to radians</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">positive(int a), positive(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns a</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">negative(int a), negative(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns -a</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">float</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sign(double a)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the sign of a as ??.0??or ??1.0??/td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">e()</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the value of e</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">pi()</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the value of pi</td>' +
            '</tr>' +
            '</tbody>' +
            '</table><h2 id="string-functions" style="clear: both;font-size: 1.8em; font-weight: bold; margin: 1.275em 0px 0.85em;border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(230, 230, 230); line-height: 1.6;"><a name="string-functions" href="#string-functions" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>String Functions</h2><p style="margin-top: 0px;margin: 1em 0px; word-wrap: break-word;">The following are built-in String functions are supported in hive</p><table style="padding: 0px; border-collapse: collapse; border-spacing: 0px; margin-bottom: 16px;background-color: rgb(250, 250, 250);">' +
            '<thead>' +
            '<tr>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Return Type</th>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Name(Signature)</th>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Example</th>' +
            '</tr>' +
            '</thead>' +
            '<tbody>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ascii(string str)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the numeric value of the first character of str</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">concat(string, string)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string or bytes resulting from concatenating the strings or bytes passed in as parameters in order. e.g. concat(?�foo?? ?�bar?? results in ?�foobar?? Note that this function can take any number of input strings.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array&lt;struct&lt;string,double&gt;&gt;</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">context_ngrams(array&lt;array&gt;, array, int K, int pf)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the top-k contextual N-grams from a set of tokenized sentences, given a string of "context". See StatisticsAndDataMining for more information.</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">concat_ws(string SEP, string A, string B??</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Like concat() above, but with custom separator SEP.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">concat_ws(string SEP, array)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Like concat_ws() above, but taking an array of strings. (as of Hive 0.9.0)</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">find_in_set(string str, string strList)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the first occurance of str in strList where strList is a comma-delimited string. Returns null if either argument is null. Returns 0 if the first argument contains any commas. e.g. find_in_set(?�ab?? ?�abc,b,ab,c,def?? returns 3</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">format_number(number x, int d)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Formats the number X to a format like ??,###,###.##?? rounded to D decimal places, and returns the result as a string. If D is 0, the result has no decimal point or fractional part. (as of Hive 0.10.0)</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">get_json_object(string json_string, string path)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Extract json object from a json string based on json path specified, and return json string of the extracted json object. It will return null if the input json string is invalid.NOTE: The json path can only have the characters [0-9a-z_], i.e., no upper-case or special characters. Also, the keys <em style="margin-top: 0px;margin-bottom: 0px;">cannot start with numbers.</em> This is due to restrictions on Hive column names.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">boolean</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">in_file(string str, string filename)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns true if the string str appears as an entire line in filename.</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">instr(string str, string substr)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the position of the first occurence of substr in str</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">length(string A)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the length of the string</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">locate(string substr, string str[, int pos])</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the position of the first occurrence of substr in str after position pos</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">lower(string A) lcase(string A)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);"></td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">lpad(string str, int len, string pad)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns str, left-padded with pad to a length of len</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ltrim(string A)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from trimming spaces from the beginning(left hand side) of A e.g. ltrim(??foobar ?? results in ?�foobar ??/td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array&lt;struct&lt;string,double&gt;&gt;</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ngrams(array&lt;array &gt;, int N, int K, int pf)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the top-k N-grams from a set of tokenized sentences, such as those returned by the sentences() UDAF. See StatisticsAndDataMining for more information.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">parse_url(string urlString, string partToExtract [, string keyToExtract])</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the specified part from the URL. Valid values for partToExtract include HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, and USERINFO. e.g. parse_url(??a href="http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1" style="text-decoration: none; vertical-align: baseline;margin-top: 0px;color: rgb(50, 105, 160);">http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1</a>?? ?�HOST?? returns ?�facebook.com?? Also a value of a particular key in QUERY can be extracted by providing the key as the third argument, e.g. parse_url(??a href="http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1" style="text-decoration: none; vertical-align: baseline;margin-bottom: 0px;color: rgb(50, 105, 160);">http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1</a>?? ?�QUERY?? ?�k1?? returns ?�v1??</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">printf(String format, Obj??args)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the input formatted according do printf-style format strings (as of Hive 0.9.0)</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">regexp_extract(string subject, string pattern, int index)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string extracted using the pattern. e.g. regexp_extract(?�foothebar?? ?�foo(.*?)(bar)?? 2) returns ?�bar.??Note that some care is necessary in using predefined character classes: using ??s??as the second argument will match the letter s; ?�s??is necessary to match whitespace, etc. The ?�index??parameter is the Java regex Matcher group() method index. See docs/api/java/util/regex/Matcher.html for more information on the ?�index??or Java regex group() method.</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">regexp_replace(string INITIAL_STRING, string PATTERN, string REPLACEMENT)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from replacing all substrings in INITIAL_STRING that match the java regular expression syntax defined in PATTERN with instances of REPLACEMENT, e.g. regexp_replace("foobar", "oo|ar", "") returns ?�fb.??Note that some care is necessary in using predefined character classes: using ??s??as the second argument will match the letter s; ?�s??is necessary to match whitespace, etc.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">repeat(string str, int n)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Repeat str n times</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">reverse(string A)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the reversed string</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">rpad(string str, int len, string pad)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns str, right-padded with pad to a length of len</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">rtrim(string A)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from trimming spaces from the end(right hand side) of A e.g. rtrim(??foobar ?? results in ??foobar??/td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array&lt;array&gt;</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sentences(string str, string lang, string locale)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Tokenizes a string of natural language text into words and sentences, where each sentence is broken at the appropriate sentence boundary and returned as an array of words. The ?�lang??and ?�locale??are optional arguments. e.g. sentences(?�Hello there! How are you??? returns ( ("Hello", "there"), ("How", "are", "you") )</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">space(int n)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return a string of n spaces</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">split(string str, string pat)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Split str around pat (pat is a regular expression)</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">map&lt;string,string&gt;</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">str_to_map(text[, delimiter1, delimiter2])</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Splits text into key-value pairs using two delimiters. Delimiter1 separates text into K-V pairs, and Delimiter2 splits each K-V pair. Default delimiters are ????for delimiter1 and ????for delimiter2.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">substr(string, int start) substring(string, int start)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the substring or slice of the byte array of A starting from start position till the end of string A e.g. substr(?�foobar?? 4) results in ?�bar??/td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">substr(string, int start, int len) substring(string, int start, int len)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the substring or slice of the byte array of A starting from start position with length len e.g. substr(?�foobar?? 4, 1) results in ?�b??/td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">translate(string input, string from, string to)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Translates the input string by replacing the characters present in the from string with the corresponding characters in the to string. This is similar to the translatefunction in PostgreSQL. If any of the parameters to this UDF are NULL, the result is NULL as well (available as of Hive 0.10.0)</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">trim(string A)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from trimming spaces from both ends of A e.g. trim(??foobar ?? results in ?�foobar??/td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">upper(string A) ucase(string A)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from converting all characters of A to upper case e.g. upper(?�fOoBaR?? results in ?�FOOBAR??/td>' +
            '</tr>' +
            '</tbody>' +
            '</table><h2 id="built-in-aggregate-functions-(udaf)" style="clear: both;font-size: 1.8em; font-weight: bold; margin: 1.275em 0px 0.85em;border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(230, 230, 230); line-height: 1.6;"><a name="built-in-aggregate-functions-(udaf)" href="#built-in-aggregate-functions-(udaf)" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>Built-in Aggregate Functions (UDAF)</h2><p style="margin-top: 0px;margin: 1em 0px; word-wrap: break-word;">The following are built-in aggregate functions are supported in Hive.</p><table style="padding: 0px; border-collapse: collapse; border-spacing: 0px; margin-bottom: 16px;background-color: rgb(250, 250, 250);">' +
            '<thead>' +
            '<tr>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Return Type</th>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Name(Signature)</th>' +
            '<th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Example</th>' +
            '</tr>' +
            '</thead>' +
            '<tbody>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bigint</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">count(*), count(expr), count(DISTINCT expr[, expr_.])</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">count(*) ??Returns the total number of retrieved rows, including rows containing NULL values; count(expr) ??Returns the number of rows for which the supplied expression is non-NULL; count(DISTINCT expr[, expr]) ??Returns the number of rows for which the supplied expression(s) are unique and non-NULL.</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sum(col), sum(DISTINCT col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the sum of the elements in the group or the sum of the distinct values of the column in the group</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">avg(col), avg(DISTINCT col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the average of the elements in the group or the average of the distinct values of the column in the group</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">min(col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the minimum of the column in the group</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">max(col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the maximum value of the column in the group</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">variance(col), var_pop(col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the variance of a numeric column in the group</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">var_samp(col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the unbiased sample variance of a numeric column in the group</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">stddev_pop(col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the standard deviation of a numeric column in the group</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">stddev_samp(col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the unbiased sample standard deviation of a numeric column in the group</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">covar_pop(col1, col2)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the population covariance of a pair of numeric columns in the group</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">covar_samp(col1, col2)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the sample covariance of a pair of a numeric columns in the group</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">corr(col1, col2)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the Pearson coefficient of correlation of a pair of a numeric columns in the group</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">percentile(BIGINT col, p)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the exact p<sup style="margin-top: 0px;margin-bottom: 0px;">th</sup> percentile of a column in the group (does not work with floating point types). p must be between 0 and 1. NOTE: A true percentile can only be computed for integer values. Use PERCENTILE_APPROX if your input is non-integral.</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">percentile(BIGINT col, array(p1 [, p2]??)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the exact percentiles p1, p2, ??of a column in the group (does not work with floating point types). pi must be between 0 and 1. NOTE: A true percentile can only be computed for integer values. Use PERCENTILE_APPROX if your input is non-integral.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">percentile_approx(DOUBLE col, p [, B])</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns an approximate p<sup style="margin-top: 0px;margin-bottom: 0px;">th</sup> percentile of a numeric column (including floating point types) in the group. The B parameter controls approximation accuracy at the cost of memory. Higher values yield better approximations, and the default is 10,000. When the number of distinct values in col is smaller than B, this gives an exact percentile value.</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">percentile_approx(DOUBLE col, array(p1 [, p2]?? [, B])</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Same as above, but accepts and returns an array of percentile values instead of a single one.</td>' +
            '</tr>' +
            '<tr>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">histogram_numeric(col, b)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Computes a histogram of a numeric column in the group using b non-uniformly spaced bins. The output is an array of size b of double-valued (x,y) coordinates that represent the bin centers and heights</td>' +
            '</tr>' +
            '<tr style="background-color: rgb(242, 242, 242);">' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">collect_set(col)</td>' +
            '<td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns a set of objects with duplicate elements eliminated</td>' +
            '</tr>' +
            '</tbody>' +
            '</table></div>' +
            '');
        return data;
    };

    Brightics.VA.Core.Dialogs.RefineSteps.StepDialog = StepDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AddColumnDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.call(this, parentId, options);
    }

    AddColumnDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype);
    AddColumnDialog.prototype.constructor = AddColumnDialog;

    AddColumnDialog.prototype.getTitle = function () {
        return 'Add Column';
    };

    AddColumnDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        $parent.append('' +
            '<div class="brtc-va-refine-addcolumn-newcolumn-container"></div>' +
            '<div class="brtc-va-refine-addcolumn-addbutton">+ Add New Column</div>');


        $parent.find('.brtc-va-refine-addcolumn-newcolumn-container').sortable({
            axis: 'y',
            helper: function (event, ui) {
                var $clone = $(ui).clone();
                $clone.css('position', 'absolute');
                return $clone.get(0);
            },
            containment: '.brtc-va-refine-addcolumn-newcolumn-container',
            handle: ".brtc-va-refine-addcolumn-newcolumn-sort",
            //stop 할때 remove 버튼 hide() 추가 : stepdialog에 구현 
            stop: function (event, ui) {
                //_this.sortableStopCallback.hideRemoveButton(_this, 'brtc-va-refine-addcolumn-newcolumn-item', 'brtc-va-refine-addcolumn-newcolumn-remove');
            }
        });
        $parent.find('.brtc-va-refine-addcolumn-newcolumn-container').disableSelection();

        // this.createNewColumnItem();

        this.render();

        var $addButton = $parent.find('.brtc-va-refine-addcolumn-addbutton').jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        var _this = this;
        $addButton.click(function () {
            _this.createNewColumnItem();
            _this.checkValidation();
        });
        $parent.perfectScrollbar();
        $parent.perfectScrollbar('update');
    };

    AddColumnDialog.prototype.createNewColumnItem = function (newColumn, value) {
        var _this = this;
        var $parent = this.$mainControl.find('.brtc-va-refine-addcolumn-newcolumn-container');
        var $item = $('' +
            '<div class="brtc-va-refine-addcolumn-newcolumn-item">' +
            '   <div class="brtc-va-refine-addcolumn-newcolumn-sort"><i class="fa fa-bars"></i></div>' +
            '   <input type="text" class="brtc-va-refine-addcolumn-newcolumn-name" valid-type="type1"/>' +
            '   <div class="brtc-va-refine-addcolumn-newcolumn-assignor">=</div>' +
            '   <textarea class="brtc-va-refine-addcolumn-newcolumn-value"></textarea>' +
            '   <div class="brtc-va-refine-addcolumn-newcolumn-remove"></div>' +
            '</div>');
        $parent.append($item);


        $item.find('.brtc-va-refine-addcolumn-newcolumn-name').jqxInput({
            theme: Brightics.VA.Env.Theme,
            placeHolder: 'Enter name',
            width: '122px',
            height: 27
        });
        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($item.find('.brtc-va-refine-addcolumn-newcolumn-name'));

        if (newColumn) {
            $item.find('.brtc-va-refine-addcolumn-newcolumn-name').val(newColumn);
        }

        var columnNameArray = $.map(this.options.columns, function (col, i) {
            return col.name;
        });
        var functionArray =
            [
                'ROUND()', 'MAX()', 'MIN()', 'SUM()', 'AVG()', 'OVER()', //Related to NUMBER
                'NVL()', 'CONCAT()', 'LPAD()', 'LTRIM()', 'RPAD()', 'RTRIM()', 'SUBSTR()', 'SUBSTRING()', //Related to STRING
                'FROM_UNIXTIME()', 'YEAR()', 'MONTH()', 'WEEKOFYEAR()' //Related to DATE
            ];
        var cm = CodeMirror.fromTextArea($item.find('.brtc-va-refine-addcolumn-newcolumn-value')[0], {
            mode: "text/x-sql",
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: false,
            matchBrackets: false,
            scrollbarStyle: "null",
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {list: [].concat(columnNameArray, functionArray)}
        });
        cm.setSize('calc(100% - 200px)', $item.find('.brtc-va-refine-addcolumn-newcolumn-name').height());
        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(cm);

        cm.on("beforeChange", function (instance, change) {
            var newtext = change.text.join("").replace(/\n/g, ""); // remove ALL \n !
            if (change.update) change.update(change.from, change.to, [newtext]);
            return true;
        });

        if (value) {
            cm.setValue(value);
        }
        $item.find('.brtc-va-refine-addcolumn-newcolumn-name').on('change', function (event) {
            _this.checkValidation();
        });
        cm.on('change', function (cMirror) {
            _this.checkValidation();
        });

        $item.find('.brtc-va-refine-addcolumn-newcolumn-remove').click(function () {
            $(this).closest('.brtc-va-refine-addcolumn-newcolumn-item').remove();
            _this.checkValidation();
        });

        //첫번째 item에 remove버튼 hide 기능 
        //this.sortableStopCallback.hideRemoveButton(this, 'brtc-va-refine-addcolumn-newcolumn-item', 'brtc-va-refine-addcolumn-newcolumn-remove');
    };

    AddColumnDialog.prototype.handleOkClicked = function () {

        if (this.problems.length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There is a problem with some values.');
        } else {
            var select = this.createSelect();
            var additionalQuery = '';

            this.buildFunctionUnit('Add Column', 'addColumnByRefine', select, additionalQuery);

            Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);
        }
    };

    AddColumnDialog.prototype.buildFunctionUnit = function (label, func, select, additionalQuery) {
        var fnUnit = this.DEFAULT_FN_UNIT;
        fnUnit.fid = this.options.fid ? this.options.fid : Brightics.VA.Core.Utils.IDGenerator.func.id();
        fnUnit.func = func;
        fnUnit.name = this.options.context === 'python' ? 'PythonScript' : 'SQLExecutor';
        fnUnit.inData = this.options.in;
        fnUnit.outData = this.options.out;
        fnUnit.param = {
            'select': select,
            'additional-query': additionalQuery
        };
        if (this.options.context === 'python') {
            fnUnit.param.script = this.buildScript(select, additionalQuery);
            fnUnit.param['out-table-alias'] = ['result'];
        }
        fnUnit.display = {
            'label': label
        };
        this.resultFnUnit = fnUnit;
    };

    AddColumnDialog.prototype.buildScript = function (select, additionalQuery) {
        var script = this.DEFAULT_SCRIPT;
        var strSelect = select.replace(/\n/g, '');
        var strAdditionalQuery = additionalQuery.replace(/\n/g, '');
        script = script.replace('${SELECT_SQL}', strSelect);
        script = script.replace('${ADDITIONAL_QUERY}', strAdditionalQuery);
        return script;
    };

    AddColumnDialog.prototype.createSelect = function () {
        var itemList = this.$mainControl.find('.brtc-va-refine-addcolumn-newcolumn-item');
        var select = '*';
        var cnt = 0;
        $.each(itemList, function (key, value) {
            if (cnt < itemList.length) {
                select += ', \n';
                cnt++;
            }
            var newColumn = $(itemList[key]).find('.brtc-va-refine-addcolumn-newcolumn-name').val();
            var cm = $(itemList[key]).find('.CodeMirror')[0].CodeMirror;
            var newValue = cm.getValue();
            select += newValue + ' as `' + newColumn + '`';
        });

        return select;
    };

    AddColumnDialog.prototype.render = function () {
        if (this.options.param) {
            var select = this.options.param.select;
            var res = select.split("\n");
            if (res[0].startsWith('*')) {
                res.splice(0, 1);
            }

            for (var i = 0; i < res.length; i++) {
                var pos = res[i].lastIndexOf(' as ');
                var newValue = res[i].substring(0, pos).trim();
                var newColumn = res[i].substring(pos + 4).trim();
                newColumn = newColumn.replace(/`/gi, '');
                if (newColumn.slice(-1) == ',') {
                    newColumn = newColumn.substring(0, newColumn.length - 1);
                }

                this.createNewColumnItem(newColumn, newValue);
            }
        } else {
            this.createNewColumnItem();
        }
        this.checkValidation();
    };

    AddColumnDialog.prototype.renderValidation = function () {
        var _this = this;
        $.each(this.problems, function (key, problem) {
            var itemList = _this.$mainControl.find('.brtc-va-refine-addcolumn-newcolumn-item');
            if (problem.code == 'BR-0033') {
                _this.createValidationContent($(itemList[problem.paramIndex]), problem);
            } else {
                _this.createValidationContent($(itemList[problem.paramIndex]), problem,
                    problem.param == 'New column name'//'Value'
                        ? $(itemList[problem.paramIndex]).find('.brtc-va-refine-addcolumn-newcolumn-name')
                        : $(itemList[problem.paramIndex]).find('.CodeMirror'));
            }
            // validation 전체에 margin-left
            _this.$mainControl.find('.brtc-va-refine-step-validation-tooltip').css({
                'width': '465px',
                'margin-left': '30px'
            });
        });
    };

    AddColumnDialog.prototype.checkValidation = function () {
        var _this = this;
        var itemList = this.$mainControl.find('.brtc-va-refine-addcolumn-newcolumn-item');

        this.removeValidation();

        var newColumnNames = [];
        $.each(itemList, function (key, value) {
            var newColumn = $(itemList[key]).find('.brtc-va-refine-addcolumn-newcolumn-name').val();
            var cm = $(itemList[key]).find('.CodeMirror')[0].CodeMirror;
            var newValue = cm.getValue();
            if (newColumn === '' && newValue === '') {
                _this.addProblem(_this.createProblem({
                    errorCode: 'BR-0033',
                    paramIndex: key,
                    param: 'New column name',
                    messageParam: ['New column name', 'Value']
                }));
            } else if (newColumn === '') {
                _this.addProblem(_this.createProblem({
                    errorCode: 'BR-0033',
                    paramIndex: key,
                    param: 'New column name',
                    messageParam: ['New column name']
                }));
            } else if ($.inArray(newColumn, newColumnNames) > -1) {
                var messageParam = "New column name(s) - '" + newColumn + "' already exist.";
                _this.addProblem(_this.createProblem({
                    errorCode: 'BR-0100',
                    paramIndex: key,
                    param: 'New column name',
                    messageParam: [messageParam]
                }));
            } else if ($.inArray(newColumn, $.map(_this.options.columns, function (column) {
                return column.name
            })) > -1) {
                var messageParam = "New column name(s) - '" + newColumn + "' already exist.";
                _this.addProblem(_this.createProblem({
                    errorCode: 'BR-0100',
                    paramIndex: key,
                    param: 'New column name',
                    messageParam: [messageParam]
                }));
            }
            else {
                if (newValue === '') {
                    _this.addProblem(_this.createProblem({
                        errorCode: 'BR-0033',
                        paramIndex: key,
                        param: 'Value',
                        messageParam: ['Value']
                    }));
                }
                newColumnNames.push(newColumn);
            }

        });
        this.renderValidation();
    };


    Brightics.VA.Core.Dialogs.RefineSteps.AddColumnDialog = AddColumnDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AdvancedFilterDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.call(this, parentId, options);
    }

    AdvancedFilterDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype);
    AdvancedFilterDialog.prototype.constructor = AdvancedFilterDialog;

    AdvancedFilterDialog.prototype.getTitle = function () {
        return 'Advanced Filter';
    };

    AdvancedFilterDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-refine-advanced-filter-container">' +
            '   <textarea class="brtc-va-refine-filter-conditioneditor"></textarea>' +
            '</div>');

        this.render($parent);
    };

    AdvancedFilterDialog.prototype.render = function ($parent) {
        var _this = this;
        var tables = {};
        for (var i = 0; i < this.options.columns.length; i++) {
            tables[this.options.columns[i].name] = [this.options.columns[i].name];
        }
        this.cm = CodeMirror.fromTextArea($parent.find('.brtc-va-refine-filter-conditioneditor')[0], {
            mode: 'text/x-sql',
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: true,
            matchBrackets: true,
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {
                'tables': tables
            }
        });
        this.cm.setSize('100%', 'calc(100% - 20px)');
        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.cm);

        if (this.options.param) {
            this.cm.setValue(this.options.param['additional-query']);
        } else {
            this.cm.setValue('WHERE ');
        }
        this.cmMarker = this.cm.markText({line: 0, ch: 0}, {line: 0, ch: 6}, {readOnly: true, inclusiveLeft:true});
        this.checkValidation();

        this.cm.on('change', function () {
            _this.checkValidation();
        });
    };

    AdvancedFilterDialog.prototype.getAdditionalQueryString = function () {
        var advancedFilterString = this.cm.getValue();
        return advancedFilterString;
    };

    AdvancedFilterDialog.prototype.handleOkClicked = function () {

        if (this.problems.length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please check the query statement.');
        } else {
            var select = '*';
            var additionalQuery = this.getAdditionalQueryString();
            this.buildFunctionUnit('Advanced Filter', 'advancedFilter', select, additionalQuery);
            Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);
        }
    };

    AdvancedFilterDialog.prototype.buildFunctionUnit = function (label, func, select, additionalQuery) {
        var fnUnit = this.DEFAULT_FN_UNIT;
        fnUnit.fid = this.options.fid ? this.options.fid : Brightics.VA.Core.Utils.IDGenerator.func.id();
        fnUnit.func = func;
        fnUnit.name = this.options.context === 'python' ? 'PythonScript' : 'SQLExecutor';
        fnUnit.inData = this.options.in;
        fnUnit.outData = this.options.out;
        fnUnit.param = {
            'select': select,
            'additional-query': additionalQuery
        };
        if (this.options.context === 'python') {
            fnUnit.param.script = this.buildScript(select, additionalQuery);
            fnUnit.param['out-table-alias'] = ['result'];
        }
        fnUnit.display = {
            'label': label
        };
        this.resultFnUnit = fnUnit;
    };

    AdvancedFilterDialog.prototype.buildScript = function (select, additionalQuery) {
        var script = this.DEFAULT_SCRIPT;
        var strSelect = select.replace(/\n/g, '');
        var strAdditionalQuery = additionalQuery.replace(/\n/g, '');
        script = script.replace('${SELECT_SQL}', strSelect);
        script = script.replace('${ADDITIONAL_QUERY}', strAdditionalQuery);
        return script;
    };

    AdvancedFilterDialog.prototype.checkValidation = function () {
        var _this = this;
        this.removeValidation();

        var whereRange = this.cmMarker.find();
        var lastLine = this.cm.getDoc().lastLine();
        var lastCh = this.cm.getDoc().getLine(lastLine).length;
        var whereValue = this.cm.getDoc().getRange(whereRange.to, {line: lastLine, ch: lastCh});
        if (whereValue === '') {
            _this.addProblem(_this.createProblem({
                errorCode: 'BR-0033',
                paramIndex: 0,
                param: 'Filter',
                messageParam: ['Filter statement']
            }));
        }

        this.renderValidation();
    };

    AdvancedFilterDialog.prototype.renderValidation = function () {
        var contents = this.$mainControl.find('.brtc-va-refine-advanced-filter-container');
        if (this.problems.length)
            this.createValidationContent($(contents), this.problems[0]);
    };


    Brightics.VA.Core.Dialogs.RefineSteps.AdvancedFilterDialog = AdvancedFilterDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ChangeValueDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.call(this, parentId, options);
    }

    ChangeValueDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype);
    ChangeValueDialog.prototype.constructor = ChangeValueDialog;

    ChangeValueDialog.prototype.getTitle = function () {
        return 'Change Value';
    };

    ChangeValueDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        $parent.append('' +
            '<div class="brtc-va-refine-changevalue-newcolumn-container"></div>' +
            '<div class="brtc-va-refine-changevalue-addbutton">+ Add New Column</div>');

        this.render();

        var $addButton = $parent.find('.brtc-va-refine-changevalue-addbutton').jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        $addButton.click(function () {
            _this.createNewChangeValueItem();
            _this.checkValidation();
        });

        $parent.perfectScrollbar();
        $parent.perfectScrollbar('update');
    };

    ChangeValueDialog.prototype.render = function () {
        if (this.options.param) {
            var select = this.options.param.select;
            var res = select.split(' \n');
            if (res[res.length - 1] == '') {
                res.splice(res.length - 1, 1);
            }
            for (var i = 0; i < res.length; i++) {
                if (res[i].slice(-1) == ',') {
                    res[i] = res[i].substring(0, res[i].length - 1);
                }
            }
            var columnNames = $.map(this.options.columns, function (column) {
                return column.name;
            });
            for (var i = 0; i < res.length; i++) {
                if (columnNames[i] !== res[i]) {
                    var pos = res[i].lastIndexOf(' as ');
                    if (pos > -1) {
                        var changedValue = res[i].substring(0, pos).trim();
                        var changedColumn = res[i].substring(pos + 4).trim();
                        changedColumn = changedColumn.replace(/`/gi, '');
                        this.createNewChangeValueItem({
                            name: changedColumn,
                            value: changedValue
                        });
                    }

                }

            }

        } else {
            this.createNewChangeValueItem();
        }
        this.checkValidation();
    };

    ChangeValueDialog.prototype.createNewChangeValueItem = function (option) {
        var _this = this;
        var $parent = this.$mainControl.find('.brtc-va-refine-changevalue-newcolumn-container');
        var $item = $('' +
            '<div class="brtc-va-refine-changevalue-newcolumn-item">' +
            '   <div class="brtc-va-refine-changevalue-newcolumn-name"></div>' +
            '   <div class="brtc-va-refine-changevalue-newcolumn-assignor">= </div>' +
            '   <textarea class="brtc-va-refine-changevalue-newcolumn-value"></textarea>' +
            '   <div class="brtc-va-refine-changevalue-newcolumn-remove"></div>' +
            '</div>');
        $parent.append($item);

        var columnNameArray = $.map(this.options.columns, function (col, i) {
            return col.name;
        });
        var functionArray =
            [
                'ROUND()', 'MAX()', 'MIN()', 'SUM()', 'AVG()', 'OVER()', //Related to NUMBER
                'NVL()', 'CONCAT()', 'LPAD()', 'LTRIM()', 'RPAD()', 'RTRIM()', 'SUBSTR()', 'SUBSTRING()', //Related to STRING
                'FROM_UNIXTIME()', 'YEAR()', 'MONTH()', 'WEEKOFYEAR()' //Related to DATE
            ];
        var cm = CodeMirror.fromTextArea($item.find('.brtc-va-refine-changevalue-newcolumn-value')[0], {
            mode: "brtc-control",
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: false,
            matchBrackets: true,
            scrollbarStyle: "null",
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {list: [].concat(columnNameArray, functionArray)}
        });

        cm.on("beforeChange", function (instance, change) {
            var newtext = change.text.join("").replace(/\n/g, ""); // remove ALL \n !
            if (change.update) change.update(change.from, change.to, [newtext]);
            return true;
        });

        cm.setSize('calc(100% - 190px)', '25px');
        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(cm);

        var $columnsComboBox = $item.find('.brtc-va-refine-changevalue-newcolumn-name');
        // ColumnList
        this.data = [];
        this.data = this.options.columns;
        var widgetOptions = {
            rowCount: 1,
            multiple: false,
            showOpener: 'click',
            removable: false,
            fromModal: true
        };


        var columnList = this.createColumnList($columnsComboBox, widgetOptions, 'brtc-va-editors-sheet-controls-width-3', {
            height: '25px',
            'padding-left': '4px'
        });
        columnList.setItems(this.data);
        columnList.columnSelector.$mainControl.attr('isDialog', true);
        $columnsComboBox.data('columnList', columnList);

        $item.find('.brtc-va-refine-changevalue-newcolumn-remove').click(function () {
            $(this).closest('.brtc-va-refine-changevalue-newcolumn-item').remove();
            _this.checkValidation();
        });

        columnList.onChange(function (event, data) {
            _this.checkValidation();
        });

        cm.on('change', function (cMirror) {
            _this.checkValidation();
        });

        if (option) {
            columnList.setSelectedItems([option.name]);
            cm.setValue(option.value);
        }

        //임시
        //columnlist empty unit  불필요 margin 삭제
        $columnsComboBox.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-empty').css({
            'width': '100%',
            'margin-left': '0px'
        });
        // "=" div 위치 조정
        $item.find('.brtc-va-refine-changevalue-newcolumn-assignor').css({
            'text-align': 'left',
            'margin-left': '4px',
            'width': '16px'
        });
        //첫번째 item에 remove버튼 hide 기능
        //this.sortableStopCallback.hideRemoveButton(this, 'brtc-va-refine-changevalue-newcolumn-item', 'brtc-va-refine-changevalue-newcolumn-remove');
    };

    ChangeValueDialog.prototype.getSelectString = function () {
        var parentItem = this.$mainControl.find('.brtc-va-refine-changevalue-newcolumn-item');
        var selectString = '';
        var select = '';
        this.columnNameArray = [];
        this.validationData = [];


        var _this = this, changeColumns = [], selectStrings = [];
        $.each(parentItem, function (key, value) {
            var column = $(parentItem[key]).find('.brtc-va-refine-changevalue-newcolumn-name').data('columnList').getSelectedItems()[0];
            _this.columnNameArray[key] = column;
            var cm = $(parentItem[key]).find('.CodeMirror')[0].CodeMirror;
            var value = cm.getValue();
            selectString = value + ' as `' + column + '`';
            // selectString += (key < parentItem.length - 1) ? (', \n') : (' \n');
            changeColumns.push(column);
            selectStrings.push(selectString);
            _this.validationData.push({
                index: key,
                column: column,
                value: value
            });
        });


        var columnList = $.map(this.data, function (column) {
            return column.name;
        });
        // var columnList = this.getSelectSchema();
        var selectColumns = '';
        for (var i in columnList) {
            var existColumn = false;
            for (var j in changeColumns) {
                if (columnList[i] === changeColumns[j]) {
                    selectColumns += selectStrings[j];
                    existColumn = true;
                    break;
                }
            }
            if (!existColumn) {
                selectColumns += '`' + columnList[i] + '`';
            }

            selectColumns += (i < columnList.length - 1) ? (', \n') : (' \n');
        }
        // select = selectColumns + selectString;

        return selectColumns;
    };

    ChangeValueDialog.prototype.getSelectSchema = function () {
        var selectColumnList = [];
        for (var i = 0; i < this.data.length; i++) {
            var cnt = 0;
            for (var j = 0; j < this.columnNameArray.length; j++) {
                if (this.data[i].name == this.columnNameArray[j]) {
                    break;
                } else {
                    cnt++;
                    if (cnt == this.columnNameArray.length) {
                        selectColumnList[i] = this.data[i].name;
                    }
                }
            }
        }
        return selectColumnList;
    };

    ChangeValueDialog.prototype.handleOkClicked = function () {
        // TODO
        if (this.problems.length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There is a problem with some values.');
        } else {
            var select = this.getSelectString();
            var additionalQuery = '';

            this.buildFunctionUnit('Change Value', 'changeValue', select, additionalQuery);
            Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);
        }
    };

    ChangeValueDialog.prototype.buildFunctionUnit = function (label, func, select, additionalQuery) {
        var fnUnit = this.DEFAULT_FN_UNIT;
        fnUnit.fid = this.options.fid ? this.options.fid : Brightics.VA.Core.Utils.IDGenerator.func.id();
        fnUnit.func = func;
        fnUnit.name = this.options.context === 'python' ? 'PythonScript' : 'SQLExecutor';
        fnUnit.inData = this.options.in;
        fnUnit.outData = this.options.out;
        fnUnit.param = {
            'select': select,
            'additional-query': additionalQuery
        };
        if (this.options.context === 'python') {
            fnUnit.param.script = this.buildScript(select, additionalQuery);
            fnUnit.param['out-table-alias'] = ['result'];
        }
        fnUnit.display = {
            'label': label
        };
        this.resultFnUnit = fnUnit;
    };

    ChangeValueDialog.prototype.buildScript = function (select, additionalQuery) {
        var script = this.DEFAULT_SCRIPT;
        var strSelect = select.replace(/\n/g, '');
        var strAdditionalQuery = additionalQuery.replace(/\n/g, '');
        script = script.replace('${SELECT_SQL}', strSelect);
        script = script.replace('${ADDITIONAL_QUERY}', strAdditionalQuery);
        return script;
    };


    ChangeValueDialog.prototype.renderValidation = function () {
        var _this = this;
        $.each(this.problems, function (key, problem) {
            var itemList = _this.$mainControl.find('.brtc-va-refine-changevalue-newcolumn-item');
            if (problem.code == 'BR-0033') {
                _this.createValidationContent($(itemList[problem.paramIndex]), problem);
            } else {
                _this.createValidationContent($(itemList[problem.paramIndex]), problem,
                    problem.param == 'Select column'//'Value'
                        ? $(itemList[problem.paramIndex]).find('.brtc-va-refine-changevalue-newcolumn-name')
                        : $(itemList[problem.paramIndex]).find('.CodeMirror'));
            }
            //임시
            // validation 전체에 margin-left
            _this.$mainControl.find('.brtc-va-refine-step-validation-tooltip').css('margin-left', '8px');

        });
    };

    ChangeValueDialog.prototype.checkValidation = function () {
        var _this = this;
        var itemList = this.$mainControl.find('.brtc-va-refine-changevalue-newcolumn-item');

        this.removeValidation();

        var selectedColumnNames = [];
        $.each(itemList, function (key, value) {
            var column = $(itemList[key]).find('.brtc-va-refine-changevalue-newcolumn-name').data('columnList').getSelectedItems()[0];

            var cm = $(itemList[key]).find('.CodeMirror')[0].CodeMirror;
            var value = cm.getValue();
            if (column === undefined && value === '') {
                _this.addProblem(_this.createProblem({
                    errorCode: 'BR-0033',
                    paramIndex: key,
                    param: 'Select column',
                    messageParam: ['Select column', 'Change value']
                }));
            } else if (column === undefined) {
                _this.addProblem(_this.createProblem({
                    errorCode: 'BR-0033',
                    paramIndex: key,
                    param: 'Select column',
                    messageParam: ['Select column']
                }));
            } else if (value === '') {
                _this.addProblem(_this.createProblem({
                    errorCode: 'BR-0033',
                    paramIndex: key,
                    param: 'Change value',
                    messageParam: ['Change value']
                }));
            }

            if (column) {
                if ($.inArray(column, selectedColumnNames) > -1) {
                    var messageParam = "Select column(s) - '"+ column + "' already exist.";
                    _this.addProblem(_this.createProblem({
                        errorCode: 'BR-0100',
                        paramIndex: key,
                        param: 'Select column',
                        messageParam: [messageParam]
                    }));
                }
                else {
                    selectedColumnNames.push(column);
                }
            }
        });
        this.renderValidation();
    };

    ChangeValueDialog.prototype.destroy = function () {
        this.destroyColumnSelector();
        this.$mainControl.dialog('destroy');
        if (typeof this.options.close == 'function') {
            this.options.close(this.dialogResult);
        }
    };

    Brightics.VA.Core.Dialogs.RefineSteps.ChangeValueDialog = ChangeValueDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function GroupByDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.call(this, parentId, options);
    }

    GroupByDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype);
    GroupByDialog.prototype.constructor = GroupByDialog;

    GroupByDialog.prototype.getTitle = function () {
        return 'Group-by';
    };

    GroupByDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-refine-groupby-container">' +
            '   <textarea class="brtc-va-refine-select-sqleditor"></textarea>' +
            '</div>');

        $parent.append('' +
            '<div class="brtc-va-refine-groupby-container">' +
            '   <textarea class="brtc-va-refine-groupby-sqleditor"></textarea>' +
            '</div>');

        this.render($parent);
    };

    GroupByDialog.prototype.render = function ($parent) {
        var _this = this;
        var tables = {};
        for (var i = 0; i < this.options.columns.length; i++) {
            tables[this.options.columns[i].name] = [this.options.columns[i].name];
        }
        this.selectCM = CodeMirror.fromTextArea($parent.find('.brtc-va-refine-select-sqleditor')[0], {
            mode: "text/x-sql",
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: true,
            matchBrackets: true,
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {
                'tables': tables
            }
        });
        this.selectCM.setSize('100%', '80%');
        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.selectCM);

        this.groupbyCM = CodeMirror.fromTextArea($parent.find('.brtc-va-refine-groupby-sqleditor')[0], {
            mode: "text/x-sql",
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: true,
            matchBrackets: true,
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {
                'tables': tables
            }
        });
        this.groupbyCM.setSize('100%', '80%');
        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.groupbyCM);

        if (this.options.param) {
            this.selectCM.setValue('SELECT ' + this.options.param['select']);
            this.groupbyCM.setValue(this.options.param['additional-query']);
        } else {
            this.selectCM.setValue('SELECT ');
            this.groupbyCM.setValue('GROUP BY ');
        }

        this.selectMarker = this.selectCM.markText({line: 0, ch: 0}, {line: 0, ch: 7}, {readOnly: true});
        this.groupByMarker = this.groupbyCM.markText({line: 0, ch: 0}, {line: 0, ch: 9}, {readOnly: true});

        this.checkValidation();

        this.selectCM.on('change', function (cMirror) {
            _this.checkValidation();
        });
        this.groupbyCM.on('change', function (cMirror) {
            _this.checkValidation();
        });
    };

    GroupByDialog.prototype.getAdditionalQueryString = function () {
        var groupByRange = this.groupByMarker.find();
        var lastLine = this.groupbyCM.getDoc().lastLine();
        var lastCh = this.groupbyCM.getDoc().getLine(lastLine).length;

        var groupByString = this.groupbyCM.getValue();
        return groupByString;
    };

    GroupByDialog.prototype.getSelectQueryString = function () {
        var selectRange = this.selectMarker.find();
        var lastLine = this.selectCM.getDoc().lastLine();
        var lastCh = this.selectCM.getDoc().getLine(lastLine).length;
        var selectValue = this.selectCM.getDoc().getRange(selectRange.to, {line: lastLine, ch: lastCh});

        var selectString = selectValue;
        return selectString;
    };

    GroupByDialog.prototype.handleOkClicked = function () {
        if (this.problems.length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please check the query statement.');
        } else {
            var select = this.getSelectQueryString();
            var additionalQuery = this.getAdditionalQueryString();

            this.buildFunctionUnit('Group By', 'groupBy', select, additionalQuery);
            Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);
        }
    };

    GroupByDialog.prototype.buildFunctionUnit = function (label, func, select, additionalQuery) {
        var fnUnit = this.DEFAULT_FN_UNIT;
        fnUnit.fid = this.options.fid ? this.options.fid : Brightics.VA.Core.Utils.IDGenerator.func.id();
        fnUnit.func = func;
        fnUnit.name = this.options.context === 'python' ? 'PythonScript' : 'SQLExecutor';
        fnUnit.inData = this.options.in;
        fnUnit.outData = this.options.out;
        fnUnit.param = {
            'select': select,
            'additional-query': additionalQuery
        };
        if (this.options.context === 'python') {
            fnUnit.param.script = this.buildScript(select, additionalQuery);
            fnUnit.param['out-table-alias'] = ['result'];
        }
        fnUnit.display = {
            'label': label
        };
        this.resultFnUnit = fnUnit;
    };

    GroupByDialog.prototype.buildScript = function (select, additionalQuery) {
        var script = this.DEFAULT_SCRIPT;
        var strSelect = select.replace(/\n/g, '');
        var strAdditionalQuery = additionalQuery.replace(/\n/g, '');
        script = script.replace('${SELECT_SQL}', strSelect);
        script = script.replace('${ADDITIONAL_QUERY}', strAdditionalQuery);
        return script;
    };

    GroupByDialog.prototype.checkValidation = function () {
        var _this = this;
        this.removeValidation();

        var selectRange = this.selectMarker.find();
        var lastLine1 = this.selectCM.getDoc().lastLine();
        var lastCh1 = this.selectCM.getDoc().getLine(lastLine1).length;
        var selectValue = this.selectCM.getDoc().getRange(selectRange.to, {line: lastLine1, ch: lastCh1});
        if (selectValue === '') {
            _this.addProblem(_this.createProblem({
                errorCode: 'BR-0033',
                paramIndex: 0,
                param: 'SELECT',
                messageParam: ['SELECT statement']
            }));
        }


        var groupByRange = this.groupByMarker.find();
        var lastLine = this.groupbyCM.getDoc().lastLine();
        var lastCh = this.groupbyCM.getDoc().getLine(lastLine).length;
        var groupbyValue = this.groupbyCM.getDoc().getRange(groupByRange.to, {line: lastLine, ch: lastCh});
        if (groupbyValue === '') {
            _this.addProblem(_this.createProblem({
                errorCode: 'BR-0033',
                paramIndex: 1,
                param: 'GROUP BY',
                messageParam: ['GROUP BY statement']
            }));
        }

        this.renderValidation();
    };

    GroupByDialog.prototype.renderValidation = function () {
        var _this = this;
        $.each(this.problems, function (key, problem) {
            var contents = _this.$mainControl.find('.brtc-va-refine-groupby-container');
            _this.createValidationContent($(contents[problem.paramIndex]), problem);
            //problem.param == 'SELECT'
            //? $(contents[problem.paramIndex]).find('.CodeMirror')
            //: $(contents[problem.paramIndex]).find('.CodeMirror'));
        });
    };

    Brightics.VA.Core.Dialogs.RefineSteps.GroupByDialog = GroupByDialog;

}).call(this);
/**
 * Created by sds on 2016-12-09.
 */

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function IndexColumnDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.call(this, parentId, options);
    }

    IndexColumnDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype);
    IndexColumnDialog.prototype.constructor = IndexColumnDialog;

    IndexColumnDialog.prototype.getTitle = function () {
        return 'Index Column';
    };

    IndexColumnDialog.prototype.createControls = function () {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.createControls.call(this);
        var jqxOpt = {
            height: 550,
            maxHeight: 550
        };
        this.$mainControl.dialog(jqxOpt);
    };
    IndexColumnDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        $parent.append('' +
            '<div class="brtc-va-refine-indexcolumn-column-contents">' +
            '   <div class="brtc-va-refine-indexcolumn-newcolumn-name-contents"><span>New Column Name</span><input type="text" style="margin-left: 83px; " class="brtc-va-refine-indexcolumn-newcolumn-name"/></div>' +
            '   <div class="brtc-va-refine-indexcolumn-newcolumn-lagvalue-contents"><span>Lag Value</span></div>' +
            '   <div style="width: 510px; height:130px; margin-top: 10px;"><div>Partition By</div>' +
            '       <div><div class="brtc-va-refine-indexcolumn-group-columns"></div></div>' +
            '   </div>' +
            '</div>' +
            '   <div style="margin-top: 10px;"><div style="margin-left: 10px; margin-bottom: 7px">Order By</div>' +
            '       <div class="brtc-va-refine-indexcolumn-newcolumn-container" style="margin-left: 3px;"></div>' +
            '       <div class="brtc-va-refine-indexcolumn-addbutton" >+ Add New Column</div>' +
            '</div>');

        // new column name
        $parent.find('.brtc-va-refine-indexcolumn-newcolumn-name').jqxInput({
            theme: Brightics.VA.Env.Theme,
            placeHolder: 'Enter name',
            width: 295
        });

        $parent.find('.brtc-va-refine-indexcolumn-newcolumn-name').on('change', function (event) {
            _this.checkValidation();
        });

        var $lagValue = $parent.find('.brtc-va-refine-indexcolumn-newcolumn-lagvalue-contents');
        this.$lagValueInput = new Brightics.VA.Core.Widget.Controls.NumericInput($lagValue, {
            numberType: 'int',
            min: undefined,
            max: undefined,
            minus: false,
            placeHolder: 'Enter value'
        });

        // partition by columns
        var $groupColumns = $parent.find('.brtc-va-refine-indexcolumn-group-columns');
        this.data = [];
        this.data = this.options.columns;
        var widgetOptions = {
            maxRowCount: 3,
            multiple: true,
            showOpener: 'click',
            removable: true,
            fromModal: true
        };
        var groupColumnsControl = this.createColumnList($groupColumns, widgetOptions, '', {
            width: '510px'
        });

        groupColumnsControl.setItems(this.data);
        $groupColumns.data('columnList', groupColumnsControl);

        // order by columns sort
        $parent.find('.brtc-va-refine-indexcolumn-newcolumn-container').sortable({
            axis: 'y',
            containment: '.brtc-va-refine-indexcolumn-newcolumn-container',
            helper: function (event, ui) {
                var $clone = $(ui).clone();
                $clone.css('position', 'absolute');
                return $clone.get(0);
            },
            handle: ".brtc-va-refine-indexcolumn-column-sort",
            //stop 할때 remove 버튼 hide() 추가 : stepdialog에 구현
            stop: function (event, ui) {
                // _this.sortableStopCallback.hideRemoveButton(_this, 'brtc-va-refine-indexcolumn-column-item', 'brtc-va-refine-indexcolumn-column-remove');
            }
        });
        $parent.find('.brtc-va-refine-indexcolumn-newcolumn-container').disableSelection();

        this.render();

        var $addButton = $parent.find('.brtc-va-refine-indexcolumn-addbutton').jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        $addButton.click(function () {
            _this.createNewSortItem();
            _this.checkValidation();
        });

        $parent.perfectScrollbar();
        $parent.perfectScrollbar('update');
    };

    IndexColumnDialog.prototype.render = function () {
        var groupColumns = this.$mainControl.find('.brtc-va-refine-indexcolumn-group-columns');
        var groupColumnList = $(groupColumns).data('columnList');

        if (this.options.param) {
            var select = this.options.param.select;

            var res = select.replace(/ \n/gi, '\n').split("\n");

            // lag value 없는 경우
            if (res[0].startsWith('*, ROW_NUMBER() OVER(')) {
                res.splice(0, 1);

                var groupList = [];
                // Get Group Column
                if (res[0] == 'PARTITION BY') {
                    res.splice(0, 1);

                    for (var i = 0; i < res.length; i++) {
                        if (res[i].startsWith('ORDER BY') || res[i].startsWith(') as ')) {
                            res.splice(0, i);
                            groupColumnList.setSelectedItems(groupList);
                            break;
                        }
                        groupList.push(res[i].replace(',', ''));
                    }
                }

                // Get Sort Column
                if (res[0] == 'ORDER BY') {
                    res.splice(0, 1);

                    for (var i = 0; i < res.length; i++) {
                        if (!res[i].startsWith(') as ')) {
                            var splitData = res[i].replace(',', '').split(' ');

                            var name = splitData[0].replace(' ', '');
                            var sortMode = splitData[1].replace(' ', '');

                            this.createNewSortItem({
                                'name': name,
                                'sort-mode': sortMode
                            });
                        } else {
                            res.splice(0, i);
                            break;
                        }
                    }
                }

                // Get New Column
                if (res[res.length - 1].startsWith(') as ')) {
                    var alias = res[res.length - 1].replace(') as ', '');
                    this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-name').val(alias);
                }
            } else if (res[0].startsWith('*, zeroIfNeg(ROW_NUMBER() OVER(')) { // lag value 있는 경우
                res.splice(0, 1);

                var groupList = [];
                // Get Group Column
                if (res[0] == 'PARTITION BY') {
                    res.splice(0, 1);

                    for (var i = 0; i < res.length; i++) {
                        if (res[i].startsWith('ORDER BY') || res[i].startsWith(') -')) {
                            res.splice(0, i);
                            groupColumnList.setSelectedItems(groupList);
                            break;
                        }
                        groupList.push(res[i].replace(',', ''));
                    }
                }

                // Get Sort Column
                if (res[0] == 'ORDER BY') {
                    res.splice(0, 1);

                    for (var i = 0; i < res.length; i++) {
                        if (!res[i].startsWith(') - ')) {
                            var splitData = res[i].replace(',', '').split(' ');

                            var name = splitData[0].replace(' ', '');
                            var sortMode = splitData[1].replace(' ', '');

                            this.createNewSortItem({
                                'name': name,
                                'sort-mode': sortMode
                            });
                        } else {
                            res.splice(0, i);
                            break;
                        }
                    }
                }

                // Get Lag Value
                if (res[0].startsWith(') - ')) {
                    var lagValue = res[0].replace(') - ', '');
                    this.$lagValueInput.setValue(lagValue);
                }

                // Get New Column
                if (res[res.length - 1].startsWith(') as ')) {
                    var alias = res[res.length - 1].trim().replace(') as ', '');
                    this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-name').val(alias);
                }
            }
        } else {
            this.createNewSortItem();
        }
        this.checkValidation();
    };

    IndexColumnDialog.prototype.createNewSortItem = function (selectedColumns) {
        var _this = this;
        var $parent = this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-container');

        var $item = $('' +
            '<div class="brtc-va-refine-indexcolumn-column-item">' +
            '   <div class="brtc-va-refine-indexcolumn-column-sort" style="cursor: pointer;"><i class="fa fa-bars"></i></div>' +
            '   <div class="brtc-va-refine-indexcolumn-column-name"></div>' +
            '   <div class="brtc-va-refine-indexcolumn-column-propertycontrol-button"><i class="fa fa-sort"></i></div>' +
            '   <div class="brtc-va-refine-indexcolumn-column-remove"></div>' +
            '</div>');
        $parent.append($item);

        var $columnsComboBox = $item.find('.brtc-va-refine-indexcolumn-column-name');
        // ColumnList
        var widgetOptions = {
            rowCount: 1,
            multiple: false,
            showOpener: 'click',
            removable: false,
            fromModal: true
        };
        var columnList = this.createColumnList($columnsComboBox, widgetOptions, 'brtc-va-editors-sheet-controls-width-10', {
            height: '25px',
            'padding-left': '4px'
        });
        columnList.setItems(this.options.columns);
        columnList.columnSelector.$mainControl.attr('isDialog', true);
        $item.data('columnList', columnList);

        var $toggleButton = $item.find('.brtc-va-refine-indexcolumn-column-propertycontrol-button');

        // Toggle Button
        this.createButton($toggleButton, {width: '19px', height: '19px'}, '', {float: 'left', 'margin-left': '3px'});
        $toggleButton.data('sort-mode', 'ASC');
        $toggleButton.on('click', function () {
            var selectedItem = columnList.getSelectedItems();
            var selectedColumn = $.grep(_this.options.columns, function (element, index) {
                return element.name === selectedItem[0];
            });
            if (selectedColumn) {
                if (selectedColumn.length > 0) {
                    var currentVal = $toggleButton.data('sort-mode');
                    if (currentVal === 'ASC') {
                        $toggleButton.data('sort-mode', 'DESC');
                    } else {
                        $toggleButton.data('sort-mode', 'ASC');
                    }
                    _this.updateSortModeIcon($toggleButton, columnList);
                }
            }
        });

        columnList.onChange(function (event, data) {
            _this.updateSortModeIcon($toggleButton, columnList);
            _this.checkValidation();
        });

        //delete button
        $item.find('.brtc-va-refine-indexcolumn-column-remove').click(function () {
            $(this).closest('.brtc-va-refine-indexcolumn-column-item').remove();
            _this.checkValidation();
        });

        if (selectedColumns) {
            columnList.setSelectedItems([selectedColumns.name]);

            $toggleButton.data('sort-mode', selectedColumns['sort-mode']);
            this.updateSortModeIcon($toggleButton, columnList);
        }

        //임시
        $item.find('.brtc-va-refine-indexcolumn-column-sort').css('margin-bottom', '5px');
        //첫번째 item에 remove버튼 hide 기능
        // this.sortableStopCallback.hideRemoveButton(this, 'brtc-va-refine-indexcolumn-column-item', 'brtc-va-refine-indexcolumn-column-remove');
    };

    IndexColumnDialog.prototype.handleOkClicked = function () {
        if (this.problems.length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There is a problem with some values.');
        } else {
            var select = this.createAdditionalQuery();
            var additionalQuery = '';

            this.createSQLExecutor('Index Column', 'indexColumnByRefine', select, additionalQuery);

            Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);
        }
    };

    IndexColumnDialog.prototype.createAdditionalQuery = function () {
        var additionalQuery = '';
        var orderByQuery = '';
        var partitionByQuery = '';

        var groupColumns = this.$mainControl.find('.brtc-va-refine-indexcolumn-group-columns');
        var groupColumnList = $(groupColumns).data('columnList');
        var selecetedGroupColumns = groupColumnList.getSelectedItems();

        if (selecetedGroupColumns.length) {
            partitionByQuery = 'PARTITION BY\n';
            $.each(groupColumnList.getSelectedItems(), function (idx, columnName) {
                partitionByQuery += columnName;
                partitionByQuery += (idx < selecetedGroupColumns.length - 1) ? (',\n') : ('\n');
            });
        }

        var $container = this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-container');
        var $target = $container.find('.brtc-va-refine-indexcolumn-column-item');
        if ($target.length > 0) {
            orderByQuery = 'ORDER BY\n';
        }
        $target.each(function (index, element) {
            var columnList = $(element).data('columnList');
            var sortModeButton = $(element).find('.brtc-va-refine-indexcolumn-column-propertycontrol-button');

            var selectedColumns = columnList.getSelectedItems();
            if (selectedColumns.length) {
                var sortMode = sortModeButton.data('sort-mode');

                orderByQuery += selectedColumns[0] + ' ' + sortMode;
                orderByQuery += (index < $target.length - 1) ? (',\n') : ('\n');
            } else {
                orderByQuery = '';
            }
        });

        var newColumn = this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-name').val();
        var lagValue = this.$lagValueInput.getValue();

        if (lagValue === '') {
            additionalQuery = '*, ROW_NUMBER() OVER(\n' + partitionByQuery + orderByQuery + ') as ' + newColumn;
        } else {
            additionalQuery = '*, zeroIfNeg(ROW_NUMBER() OVER(\n' + partitionByQuery + orderByQuery + ') - ' + lagValue + '\n) as ' + newColumn;
        }

        return additionalQuery;
    };

    IndexColumnDialog.prototype.renderValidation = function () {
        var _this = this;

        var $newColumnName = this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-name-contents');
        var $container = this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-container');
        var $target = $container.find('.brtc-va-refine-indexcolumn-column-item');

        $.each(_this.problems, function (key, problem) {
            if (problem.paramIndex == -1) {
                //_this.createValidationContent($($container), problem);
                // //임시
                // // 1개의 problem만 있으므로 무조건 하나의 brtc-va-refine-step-validation-tooltip 찾아서 css변경
                // $($container).find('.brtc-va-refine-step-validation-tooltip').css({
                //     'clear': '',
                //     'float': 'left',
                //     'margin-top': '0px'
                // });
            }
            else if (problem.param == 'New column name') {
                _this.createValidationContent($($newColumnName), problem)

            } else if (problem.param == 'Select column') {
                // _this.createValidationContent($($target[problem.paramIndex]), problem); //, $($target[problem.paramIndex]).find('.brtc-va-editors-sheet-controls-columnlist'));
                //임시
                // 1개의 problem만 있으므로 무조건 하나의 brtc-va-refine-step-validation-tooltip 찾아서 css변경
                $($target[problem.paramIndex]).find('.brtc-va-refine-step-validation-tooltip').css({
                    'clear': '',
                    'float': 'left',
                    'margin-top': '0px',
                    'margin-bottom': '10px',
                    'margin-left': '35px'
                });
            }
        });
    };

    IndexColumnDialog.prototype.checkValidation = function () {
        var _this = this;
        this.removeValidation();

        var newColumn = this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-name').val();
        var $container = this.$mainControl.find('.brtc-va-refine-indexcolumn-newcolumn-container');
        var $target = $container.find('.brtc-va-refine-indexcolumn-column-item');

        if (newColumn === '') {
            _this.addProblem(_this.createProblem({
                errorCode: 'BR-0033',
                param: 'New column name',
                messageParam: ['New Column Name']
            }));
        }
        else if (!(Brightics.VA.Core.Utils.InputValidator.isValid.columnNameType(newColumn))) {
            _this.addProblem(_this.createProblem({
                errorCode: 'BR-0045',
                param: 'New Column Name'
            }));
        }

        var selectedColumnNames = [];
        if ($target.length) {
            $target.each(function (index, element) {
                var columnList = $(element).data('columnList');
                var selectedColumns = columnList.getSelectedItems();
                if (selectedColumns.length) {
                    if ($.inArray(selectedColumns[0], selectedColumnNames) > -1) {
                        var messageParam = "Select column(s) - '"+ selectedColumns[0] + "' already exist.";
                        _this.addProblem(_this.createProblem({
                            errorCode: 'BR-0100',
                            paramIndex: index,
                            param: 'Select column',
                            messageParam: [messageParam]
                        }));
                    }
                    else {
                        selectedColumnNames.push(selectedColumns[0]);
                    }
                } else {
                    _this.addProblem(_this.createProblem({
                        errorCode: 'BR-0033',
                        paramIndex: index,
                        param: 'Select column',
                        messageParam: ['Select column']
                    }));
                }
            });
        }
        else {
            this.addProblem(_this.createProblem({
                errorCode: 'BR-0033',
                paramIndex: -1,
                param: 'Column',
                messageParam: ['Column']
            }));
        }

        this.renderValidation();
    };

    IndexColumnDialog.prototype.updateSortModeIcon = function ($sortButton, columnList) {
        var _this = this;
        var selectedItem = columnList.getSelectedItems();
        var selectedColumn = $.grep(_this.options.columns, function (element, index) {
            return element.name === selectedItem[0];
        });
        var sortMode = $sortButton.data('sort-mode');

        if (selectedColumn) {
            if (selectedColumn.length > 0) {
                var selectedColumnType = selectedColumn[0].type;

                $sortButton.find('i').removeClass();
                var className;
                if (selectedColumnType === 'string') {
                    className = 'fa fa-sort-alpha-' + sortMode.toLowerCase();
                    $sortButton.find('i').addClass(className);
                }
                else if (selectedColumnType === 'number' || selectedColumnType === 'date') {
                    className = 'fa fa-sort-numeric-' + sortMode.toLowerCase();
                    $sortButton.find('i').addClass(className);
                }
                else {
                    className = 'fa fa-sort';
                    $sortButton.find('i').addClass(className);
                }
            }
        }
    };

    IndexColumnDialog.prototype.destroy = function () {
        this.destroyColumnSelector();
        this.$mainControl.dialog('destroy');
        if (typeof this.options.close == 'function') {
            this.options.close(this.dialogResult);
        }
    };

    Brightics.VA.Core.Dialogs.RefineSteps.IndexColumnDialog = IndexColumnDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SelectColumnDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.call(this, parentId, options);
    }

    SelectColumnDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype);
    SelectColumnDialog.prototype.constructor = SelectColumnDialog;

    SelectColumnDialog.prototype.getTitle = function () {
        return 'Select Column';
    };

    SelectColumnDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main">' +
            // '   <div class="brtc-va-dialogs-header">' +'<div class="brtc-va-refine-step-header-help" title="Help"></div></div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />' +
            '       </div>' +
            '   </div>' +
            '</div>');

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        this.$mainControl.find('.brtc-va-refine-step-header-help').css('display', 'none');
        this.$mainControl.find('.brtc-va-refine-step-header-help').click(function () {
            var w = window.open('api/va/v2/help/function/sqlfunctionhelp', 'SQL Function Help');
            w.blur();
        });
    };


    SelectColumnDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        $parent.addClass('brtc-va-dataflow-refine-select-column-dialog');

        this.createAliasHelper($parent);

        $parent.append('' +
            '<div class="brtc-va-refine-selectcolumn-header">' +
            '   <div class="brtc-va-refine-selectcolumn-header-check"></div>' +
            '   <div class="brtc-va-refine-selectcolumn-header-column-sort"></div>' +
            '   <div class="brtc-va-refine-selectcolumn-header-name">Name</div>' +
            '   <div class="brtc-va-refine-selectcolumn-header-alias">New Name</div>' +
            '   <div class="brtc-va-refine-selectcolumn-column-alias-setting-wrapper"><div class="brtc-va-refine-selectcolumn-column-alias-setting-button"></div></div>' +
            '   <div class="brtc-va-refine-selectcolumn-column-alias-reset-wrapper"><div class="brtc-va-refine-selectcolumn-column-reset"></div></div>' +
            '   <div class="brtc-va-refine-selectcolumn-header-type">Type</div>' +
            '   <div class="brtc-va-refine-selectcolumn-column-type-reset-wrapper"><div class="brtc-va-refine-selectcolumn-column-reset"></div></div>' +
            //'   <div class="brtc-va-refine-selectcolumn-column-reset-all-wrapper"><div class="brtc-va-refine-selectcolumn-column-reset"></div></div>' +
            '</div>' +
            '<div class="brtc-va-refine-selectcolumn-contents"></div>');

        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: this.getTitle(),
            width: 600,
            height: 500,
            maxWidth: 600,
            maxHeight: 500,
            modal: true,
            resizable: false,
            close: this.destroy.bind(this)
        };
        this.$mainControl.dialog(jqxOpt);

        //헤더 체크박스
        this.$headerCheckBox = $($parent.find('.brtc-va-refine-selectcolumn-header-check'));
        this.$headerCheckBox.jqxCheckBox({
            theme: Brightics.VA.Env.Theme,
            width: 23,
            height: 27,
            checked: true
        });

        this.$headerCheckBox.on('checked', function (event) {
            _this.checkAllItems('check');
            _this.$okButton.jqxButton({ disabled: false });
        });
        this.$headerCheckBox.on('unchecked', function (event) {
            _this.checkAllItems('uncheck');
            _this.$okButton.jqxButton({ disabled: true });
        });

        this.render();

        $parent.find('.brtc-va-refine-selectcolumn-contents').sortable({
            axis: 'y',
            //scrollSensitivitiy: 100,
            helper: function (event, ui) {
                var $clone = $(ui).clone();
                $clone.css('position', 'absolute');
                return $clone.get(0);
            },
            //containment: '.brtc-va-refine-selectcolumn-contents',
            items: '.brtc-va-refine-selectcolumn-column-item',
            cancel: '.brtc-va-refine-selectcolumn-column-item.sort-disabled',
            handle: '.brtc-va-refine-selectcolumn-column-sort',
            update: function (event, ui) {
                _this.checkValidation();
            }
        }, "refreshPositions");
        $parent.find('.brtc-va-refine-selectcolumn-contents').disableSelection();
        $parent.perfectScrollbar();
        $parent.perfectScrollbar('update');

        var $aliasSettingButton = $('.brtc-va-refine-selectcolumn-column-alias-setting-button');
        $aliasSettingButton.click(function () {
            $('.brtc-va-refine-selectcolumn-alias-helper').toggleClass('setting-active');
            $(this).toggleClass('setting-active');
        });

        var $aliasResetButton = $('.brtc-va-refine-selectcolumn-column-alias-reset-wrapper .brtc-va-refine-selectcolumn-column-reset');
        $aliasResetButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    aliasInput.val(aliasInput.data('default-alias'));
                }
            });
        });

        var $typeResetButton = $('.brtc-va-refine-selectcolumn-column-type-reset-wrapper .brtc-va-refine-selectcolumn-column-reset');
        $typeResetButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var typeSelectBox = $(element).find('.brtc-va-refine-selectcolumn-column-type');
                    typeSelectBox.val(typeSelectBox.data('default-type'));
                }
            });
        });

        //var $allResetButton = $('.brtc-va-refine-selectcolumn-column-reset-all-wrapper .brtc-va-refine-selectcolumn-column-reset');
        //$allResetButton.click(function () {
        //    var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');
        //
        //    $items.each(function (index, element) {
        //        var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
        //        if (checkBox.val()) {
        //            var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
        //            var typeSelectBox = $(element).find('.brtc-va-refine-selectcolumn-column-type');
        //
        //            aliasInput.val(aliasInput.data('default-alias'));
        //            typeSelectBox.val(typeSelectBox.data('default-type'));
        //        }
        //    });
        //});

        this.checkValidation();
    };

    SelectColumnDialog.prototype.checkAllItems = function (checkStatus) {
        var itemList = this.$mainControl.find('.brtc-va-refine-selectcolumn-column-item');

        for (var i = 0; i < itemList.length; i++) {
            var checkBox = $(itemList[i]).find('.brtc-va-refine-selectcolumn-column-check');
            $(checkBox).jqxCheckBox(checkStatus);
        }
    };

    SelectColumnDialog.prototype.isUncheckedAllItems = function () {
        var itemList = this.$mainControl.find('.brtc-va-refine-selectcolumn-column-item');
        for (var i = 0; i < itemList.length; i++) {
            var checkBox = $(itemList[i]).find('.brtc-va-refine-selectcolumn-column-check');
            if ($(checkBox).jqxCheckBox('checked')) return;
        }
        this.$okButton.jqxButton({ disabled: true });
    };

    SelectColumnDialog.prototype.render = function () {
        var _this = this;
        if (this.options.param) {
            var select = this.options.param.select;

            var res = select.replace(/, \n/gi, '\n').split("\n");
            if (res[res.length - 1] == '') {
                res.splice(res.length - 1, 1);
            }

            var selectedName = [];
            var selectedColumns = [];
            for (var i = 0; i < res.length; i++) {
                var splitData;// = res[i].replace('cast(', '').replace(') as ', ' ').replace(' as ', ' ').split(' ');
                var name, type, alias;

                if (res[i].startsWith('cast(')) {
                    splitData = res[i].replace(/`/gi, '').replace('cast(', '').replace(') as ', ' ').replace(' as ', ' ').split(' ');
                    name = splitData[0].replace(' ', '');
                    type = splitData[1].replace(' ', '');
                    alias = splitData[2].replace(' ', '');
                }
                else {
                    splitData = res[i].replace(/`/gi, '').replace(' as ', ' ').split(' ');
                    name = splitData[0].replace(' ', '');
                    type = '';
                    alias = splitData[1].replace(' ', '');
                }

                selectedName.push(name);
                selectedColumns.push({
                    name: name,
                    alias: alias,
                    type: type
                });
            }

            for (var j = 0; j < selectedColumns.length; j++) {
                var options = {
                    checked: true,
                    name: selectedColumns[j].name,
                    alias: selectedColumns[j].alias,
                    type: selectedColumns[j].type
                };
                this.createColumnItem(options);
            }

            var columns = this.options.columns;
            var unselectedColumns = [];
            for (var k = 0; k < columns.length; k++) {
                if ($.inArray(columns[k].name, selectedName) == -1) {
                    unselectedColumns.push(columns[k]);
                }
            }

            for (var index in unselectedColumns) {
                var options = {
                    checked: false,
                    name: unselectedColumns[index].name,
                    alias: unselectedColumns[index].name,
                    type: _this.convertInternalTypeToHiveGrammar(unselectedColumns[index].internalType)
                };
                this.createColumnItem(options);
            }
        } else {
            var columns = this.options.columns;
            for (var index in columns) {
                this.createColumnItem({
                    checked: true,
                    name: columns[index].name,
                    alias: columns[index].name,
                    type: _this.convertInternalTypeToHiveGrammar(columns[index].internalType)
                });
            }
        }
    };

    SelectColumnDialog.prototype.convertInternalTypeToHiveGrammar = function (internalType) {
        var result = '';
        switch (internalType) {
            case 'String':
                result = 'string';
                break;
            case 'Integer':
                result = 'int';
                break;
            case 'Double':
                result = 'double';
                break;
            case 'Long':
                result = 'bigint';
                break;
            case 'Boolean':
                result = 'boolean';
                break;
        }
        return result;
    };

    SelectColumnDialog.prototype.createColumnItem = function (column) {
        var _this = this;
        var $parent = this.$mainControl.find('.brtc-va-refine-selectcolumn-contents');
        var $item = $('' +
            '<div class="brtc-va-refine-selectcolumn-column-item">' +
            '   <div class="brtc-va-refine-selectcolumn-column-check"></div>' +
            '   <div class="brtc-va-refine-selectcolumn-column-sort"><i class="fa fa-bars"></i></div>' +
            '   <input type="text" class="brtc-va-refine-selectcolumn-column-name" readonly="readonly"/>' +
            '   <input type="text" class="brtc-va-refine-selectcolumn-column-alias" valid-type="type1"/>' +
            '   <div class="brtc-va-refine-selectcolumn-column-type"></div>' +
            '   <div class="brtc-va-refine-selectcolumn-column-reset-wrapper"><div class="brtc-va-refine-selectcolumn-column-reset"></div></div>' +
            '</div>');
        $parent.append($item);

        $item.find('.brtc-va-refine-selectcolumn-column-check').jqxCheckBox({
            theme: Brightics.VA.Env.Theme,
            width: 23,
            height: 27,
            checked: column.checked
        });

        $item.find('.brtc-va-refine-selectcolumn-column-check').on('checked', function () {
            $item.removeClass('sort-disabled');
            $item.find('.brtc-va-refine-selectcolumn-column-sort').css({ 'opacity': '', 'cursor': 'pointer' });
            $item.find('.brtc-va-refine-selectcolumn-column-name').jqxInput({ disabled: false });
            $item.find('.brtc-va-refine-selectcolumn-column-alias').jqxInput({ disabled: false });
            $item.find('.brtc-va-refine-selectcolumn-column-type').jqxDropDownList({ disabled: false });
            $item.find('.brtc-va-refine-selectcolumn-column-reset').css({ 'opacity': '', 'cursor': 'pointer' });
            _this.checkValidation();

            _this.$okButton.jqxButton({ 'disabled': false });
        });

        $item.find('.brtc-va-refine-selectcolumn-column-check').on('unchecked', function () {
            $item.addClass('sort-disabled');
            $item.find('.brtc-va-refine-selectcolumn-column-sort').css({ 'opacity': '0.5', 'cursor': 'default' });
            $item.find('.brtc-va-refine-selectcolumn-column-name').jqxInput({ disabled: true });
            $item.find('.brtc-va-refine-selectcolumn-column-alias').jqxInput({ disabled: true });
            $item.find('.brtc-va-refine-selectcolumn-column-type').jqxDropDownList({ disabled: true });
            $item.find('.brtc-va-refine-selectcolumn-column-reset').css({ 'opacity': '0.5', 'cursor': 'default' });

            _this.isUncheckedAllItems();

            _this.checkValidation();
        });

        $item.find('.brtc-va-refine-selectcolumn-column-name').val(column.name);
        $item.find('.brtc-va-refine-selectcolumn-column-name').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: '172px',
            height: '27px'
        });
        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($item.find('.brtc-va-refine-selectcolumn-column-name'));
        $item.find('.brtc-va-refine-selectcolumn-column-name').on('change', function () {
            _this.checkValidation();
        });

        $item.find('.brtc-va-refine-selectcolumn-column-alias').data('default-alias', column.alias);
        $item.find('.brtc-va-refine-selectcolumn-column-alias').val(column.alias);
        $item.find('.brtc-va-refine-selectcolumn-column-alias').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: '182px',
            height: '27px'
        });
        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($item.find('.brtc-va-refine-selectcolumn-column-alias'));
        $item.find('.brtc-va-refine-selectcolumn-column-alias').on('change', function () {
            _this.checkValidation();
        });

        var source = [{ display: 'String', value: 'string' }, { display: 'Integer', value: 'int' }, {
            display: 'Double',
            value: 'double'
        }, { display: 'Long', value: 'bigint' }, { display: 'Boolean', value: 'boolean' }];
        $item.find('.brtc-va-refine-selectcolumn-column-type').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            source: source,
            width: 90,
            height: 25,
            animationType: 'none',
            openDelay: 0,
            displayMember: 'display',
            valueMember: 'value',
            autoDropDownHeight: true
        });

        // FIXME: 아래 두줄은 jQuery UI의 버그를 해결하기 위한 임시방편. 후에 jQuery UI를 업데이트하면 삭제해야함
        var itemId = $item.find('.brtc-va-refine-selectcolumn-column-type').attr('id');
        $('#listBox' + itemId).insertBefore($item.closest('.ui-dialog'));

        if (column.type) {
            $item.find('.brtc-va-refine-selectcolumn-column-type').data('default-type', column.type);
            $item.find('.brtc-va-refine-selectcolumn-column-type').val(column.type);
        }
        else {
            $item.find('.brtc-va-refine-selectcolumn-column-type').jqxDropDownList({ disabled: true });
        }

        $item.find('.brtc-va-refine-selectcolumn-column-reset').on('click', function () {
            if ($item.find('.brtc-va-refine-selectcolumn-column-check').val()) {
                $item.find('.brtc-va-refine-selectcolumn-column-type').val(column.type);
                $item.find('.brtc-va-refine-selectcolumn-column-alias').val(column.alias);
            }
        });

        if (column.checked) {
            $item.find('.brtc-va-refine-selectcolumn-column-sort').css({ 'opacity': '', 'cursor': 'pointer' });
            $item.find('.brtc-va-refine-selectcolumn-column-reset').css({ 'opacity': '', 'cursor': 'pointer' });
        }
        else {
            $item.addClass('sort-disabled');
            $item.find('.brtc-va-refine-selectcolumn-column-sort').css({ 'opacity': '0.5', 'cursor': 'default' });
            $item.find('.brtc-va-refine-selectcolumn-column-name').jqxInput({ disabled: true });
            $item.find('.brtc-va-refine-selectcolumn-column-alias').jqxInput({ disabled: true });
            $item.find('.brtc-va-refine-selectcolumn-column-type').jqxDropDownList({ disabled: true });
            $item.find('.brtc-va-refine-selectcolumn-column-reset').css({ 'opacity': '0.5', 'cursor': 'default' });
        }
    };

    SelectColumnDialog.prototype.createSelect = function () {
        var _this = this;
        var select = '';
        var $items = this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

        var checkedItems = [];
        $items.each(function (index, element) {
            var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
            if (checkBox.val()) {
                checkedItems.push(element);
            }
        });

        $(checkedItems).each(function (index, element) {
            var nameInput = $(element).find('.brtc-va-refine-selectcolumn-column-name');
            var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
            var typeSelectBox = $(element).find('.brtc-va-refine-selectcolumn-column-type');

            if (typeSelectBox.val()) {
                select += 'cast(`' + nameInput.val() + '` as ' + typeSelectBox.val() + ')' + ' as `' + aliasInput.val() + '`';
            }
            else {
                select += '`' + nameInput.val() + '` as `' + aliasInput.val() + '`';
            }
            select += (index < checkedItems.length - 1) ? (', \n') : (' \n');
        });

        return select;
    };


    SelectColumnDialog.prototype.handleOkClicked = function () {
        if (this.problems.length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There is a problem with some values.');
        } else {
            var select = this.createSelect();
            var additionalQuery = '';

            this.buildFunctionUnit('Select Column', 'selectColumn', select, additionalQuery);
            Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);
        }
    };

    SelectColumnDialog.prototype.buildFunctionUnit = function (label, func, select, additionalQuery) {
        var fnUnit = this.DEFAULT_FN_UNIT;
        fnUnit.fid = this.options.fid ? this.options.fid : Brightics.VA.Core.Utils.IDGenerator.func.id();
        fnUnit.func = func;
        fnUnit.name = this.options.context === 'python' ? 'PythonScript' : 'SQLExecutor';
        fnUnit.inData = this.options.in;
        fnUnit.outData = this.options.out;
        fnUnit.param = {
            'select': select,
            'additional-query': additionalQuery
        };
        if (this.options.context === 'python') {
            fnUnit.param.script = this.buildScript(select, additionalQuery);
            fnUnit.param['out-table-alias'] = ['result'];
        }
        fnUnit.display = {
            'label': label
        };
        this.resultFnUnit = fnUnit;
    };

    SelectColumnDialog.prototype.buildScript = function (select, additionalQuery) {
        var script = this.DEFAULT_SCRIPT;
        var strSelect = select.replace(/\n/g, '');
        var strAdditionalQuery = additionalQuery.replace(/\n/g, '');
        script = script.replace('${SELECT_SQL}', strSelect);
        script = script.replace('${ADDITIONAL_QUERY}', strAdditionalQuery);
        return script;
    };

    SelectColumnDialog.prototype.renderValidation = function () {
        var _this = this;
        var $items = this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

        $.each(this.problems, function (key, problem) {
            var $control;
            if (problem.param === 'Name') {
                $control = $($items[problem.paramIndex]).find('.brtc-va-refine-selectcolumn-column-name');
            } else if (problem.param === 'Alias') {
                $control = $($items[problem.paramIndex]).find('.brtc-va-refine-selectcolumn-column-alias');
            }
            _this.createValidationContent($($items[problem.paramIndex]), problem, $control);
            // validation 전체에 margin-left
            _this.$mainControl.find('.brtc-va-refine-step-validation-tooltip').css({
                'width': '465px',
                'margin-left': '45px'
            });
        });
    };

    SelectColumnDialog.prototype.checkValidation = function () {
        var _this = this;
        this.removeValidation();

        var columnNameArray = [];
        for (var index in _this.options.columns) {
            columnNameArray.push(_this.options.columns[index].name);
        }

        var $items = this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

        var aliasNames = [];
        var checkedFlag = false;
        $items.each(function (index, element) {
            var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
            if (checkBox.val()) {
                checkedFlag = true;
                var nameInput = $(element).find('.brtc-va-refine-selectcolumn-column-name');
                var name = nameInput.val();
                // _this.options.columns에 없는 column입니다.
                // if ($.inArray(name, columnNameArray) === -1) {
                //     _this.addProblem(_this.createProblem({
                //         errorCode: 'EX005',
                //         paramIndex: index,
                //         param: 'Name',
                //         messageParam: [name]
                //     }));
                // }
                if (name == '') {
                    _this.addProblem(_this.createProblem({
                        errorCode: 'BR-0033',
                        paramIndex: index,
                        param: 'Name',
                        messageParam: ['Name']
                    }));
                }

                var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                var alias = aliasInput.val();
                if (alias == '') {
                    _this.addProblem(_this.createProblem({
                        errorCode: 'BR-0033',
                        paramIndex: index,
                        param: 'Alias',
                        messageParam: ['Alias']
                    }));
                } else {
                    if ($.inArray(alias, aliasNames) > -1) {
                        var messageParam = "Alias - '" + alias + "' already exist.";
                        _this.addProblem(_this.createProblem({
                            errorCode: 'BR-0100',
                            paramIndex: index,
                            param: 'Alias',
                            messageParam: [messageParam]
                        }));
                    } else {
                        aliasNames.push(alias);
                    }
                }
            }
        });

        if (!checkedFlag) {
            this.addProblem(_this.createProblem({
                errorCode: 'BR-0001',
                paramIndex: -1,
                param: 'Column',
                messageParam: ['Column']
            }));
        }

        this.renderValidation();
    };

    SelectColumnDialog.prototype.createAliasHelper = function ($parent) {
        var _this = this;
        var $aliasHelper = $('' +
            '<div class="brtc-va-refine-selectcolumn-alias-helper">' +
            '   <div class="brtc-va-refine-selectcolumn-alias-helper-title">Alias Setting</div>' +
            '   <div class="brtc-va-refine-selectcolumn-upper-lower-button-container">' +
            '       <button class="brtc-va-refine-selectcolumn-column-uppercase-button">UPPERCASE</button>' +
            '       <button class="brtc-va-refine-selectcolumn-column-lowercase-button">lowercase</button>' +
            '       <button class="brtc-va-refine-selectcolumn-column-firstuppercase-button">Uppercase first letter</button>' +
            '   </div>' +
            '   <div class="brtc-va-refine-selectcolumn-fix-input-button-container">' +
            '       <input class="brtc-va-refine-selectcolumn-column-fix-input" type="text" placeholder="Pre, Suffix" valid-type="type1"/>' +
            '       <button class="brtc-va-refine-selectcolumn-column-prefix-button">Prefix</button>' +
            '       <button class="brtc-va-refine-selectcolumn-column-suffix-button">Suffix</button>' +
            '       <button class="brtc-va-refine-selectcolumn-column-prefix-index-button">Pre. Index</button>' +
            '       <button class="brtc-va-refine-selectcolumn-column-suffix-index-button">Suf. Index</button><br>' +
            '   </div>' +
            '   <div class="brtc-va-refine-selectcolumn-find-replace-button-container">' +
            '       <input class="brtc-va-refine-selectcolumn-column-find-input" type="text" placeholder="Find" valid-type="type1"/>' +
            '       <input class="brtc-va-refine-selectcolumn-column-replace-input" type="text" placeholder="Replace" valid-type="type1"/>' +
            '       <button class="brtc-va-refine-selectcolumn-column-replace-button">Replace</button>' +
            '   </div>' +
            '</div>');

        $parent.append($aliasHelper);

        var $fixInput = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-fix-input');
        var $findInput = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-find-input');
        var $replaceInput = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-replace-input');
        $fixInput.jqxInput({ theme: Brightics.VA.Env.Theme });
        $findInput.jqxInput({ theme: Brightics.VA.Env.Theme });
        $replaceInput.jqxInput({ theme: Brightics.VA.Env.Theme });
        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($fixInput);
        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($findInput);
        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($replaceInput);

        var $uppercaseButton = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-uppercase-button');
        var $lowercaseButton = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-lowercase-button');
        var $firstUppercaseButton = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-firstuppercase-button');
        var $prefixButton = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-prefix-button');
        var $suffixButton = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-suffix-button');
        var $prefixIndexButton = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-prefix-index-button');
        var $suffixIndexButton = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-suffix-index-button');
        var $replaceButton = $aliasHelper.find('.brtc-va-refine-selectcolumn-column-replace-button');
        $uppercaseButton.jqxButton({ theme: Brightics.VA.Env.Theme });
        $lowercaseButton.jqxButton({ theme: Brightics.VA.Env.Theme });
        $firstUppercaseButton.jqxButton({ theme: Brightics.VA.Env.Theme });
        $prefixButton.jqxButton({ theme: Brightics.VA.Env.Theme });
        $suffixButton.jqxButton({ theme: Brightics.VA.Env.Theme });
        $prefixIndexButton.jqxButton({ theme: Brightics.VA.Env.Theme });
        $suffixIndexButton.jqxButton({ theme: Brightics.VA.Env.Theme });
        $replaceButton.jqxButton({ theme: Brightics.VA.Env.Theme });

        $uppercaseButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    var aliasValue = aliasInput.val();
                    aliasInput.val(aliasValue.toUpperCase());
                }
            });
        });

        $lowercaseButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    var aliasValue = aliasInput.val();
                    aliasInput.val(aliasValue.toLowerCase());
                }
            });
        });

        $firstUppercaseButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    var aliasValue = aliasInput.val();
                    aliasInput.val(aliasValue.charAt(0).toUpperCase() + aliasValue.slice(1));
                }
            });
        });

        $prefixButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

            var prefix = $('.brtc-va-refine-selectcolumn-column-fix-input').val();

            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    var aliasValue = aliasInput.val();
                    aliasInput.val(prefix + aliasValue);
                }
            });
        });

        $suffixButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

            var suffix = $('.brtc-va-refine-selectcolumn-column-fix-input').val();

            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    var aliasValue = aliasInput.val();
                    aliasInput.val(aliasValue + suffix);
                }
            });
        });

        $prefixIndexButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');
            var count = 1;
            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    var aliasValue = aliasInput.val();
                    aliasInput.val((count++) + aliasValue);
                }
            });
        });

        $suffixIndexButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');
            var count = 1;
            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    var aliasValue = aliasInput.val();
                    aliasInput.val(aliasValue + (count++));
                }
            });
        });

        $replaceButton.click(function () {
            var $items = _this.$mainControl.find('.brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item');

            var findValue = $('.brtc-va-refine-selectcolumn-column-find-input').val();
            var replaceValue = $('.brtc-va-refine-selectcolumn-column-replace-input').val();

            $items.each(function (index, element) {
                var checkBox = $(element).find('.brtc-va-refine-selectcolumn-column-check');
                if (checkBox.val()) {
                    var aliasInput = $(element).find('.brtc-va-refine-selectcolumn-column-alias');
                    var aliasValue = aliasInput.val();
                    aliasInput.val(aliasValue.split(findValue).join('' + replaceValue));
                }
            });
        });
    };

    SelectColumnDialog.prototype.destroy = function () {
        this.destroyDropDownList();
        this.$mainControl.dialog('destroy');
        if (typeof this.options.close == 'function') {
            this.options.close(this.dialogResult);
        }
    };

    SelectColumnDialog.prototype.destroyDropDownList = function () {
        var $dropDownList = $('.brtc-va-refine-selectcolumn-column-type');
        if ($dropDownList.length > 0) {
            $dropDownList.jqxDropDownList('destroy');
        }
    };

    Brightics.VA.Core.Dialogs.RefineSteps.SelectColumnDialog = SelectColumnDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    function SimpleFilterDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.call(this, parentId, options);
    }

    SimpleFilterDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype);
    SimpleFilterDialog.prototype.constructor = SimpleFilterDialog;

    SimpleFilterDialog.prototype.getTitle = function () {
        return 'Simple Filter';
    };

    SimpleFilterDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('<div class="brtc-va-refine-simplefilter-contents"></div>');

        this.render();

        $parent.perfectScrollbar();
        $parent.perfectScrollbar('update');
    };

    SimpleFilterDialog.prototype.parseSql = function (sql) {
        var option = {};
        var firstBlankIndex = sql.indexOf(' ');
        option.name = sql.substring(0, firstBlankIndex).trim();

        var conditionAndValue = sql.substring(firstBlankIndex).trim();
        var secondBlankIndex = conditionAndValue.indexOf(' ');
        option.condition = conditionAndValue.substring(0, secondBlankIndex).trim();
        option.columnValue = conditionAndValue.substring(secondBlankIndex).trim();
        return option;
    };

    SimpleFilterDialog.prototype.render = function () {
        var firstOption;
        var secondOption;
        var type = 'and';

        if (this.options.param) {
            var additionalQuery = this.options.param['additional-query'];
            var filterSqls = additionalQuery.split(' \n');
            for (var i in filterSqls) {
                if (filterSqls[i].startsWith('WHERE')) {
                    var firstFilterSql = filterSqls[i].replace('WHERE ', '').trim();
                    firstOption = this.parseSql(firstFilterSql);
                    firstOption.name = firstOption.name.replace(/`/gi, '');
                } else {
                    type = filterSqls[i].startsWith('and') ? 'and' : 'or';
                    var secondFilterSql = filterSqls[i].replace(type, '').trim();
                    secondOption = this.parseSql(secondFilterSql);
                    secondOption.name = secondOption.name.replace(/`/gi, '');
                }
            }
        }

        this.createColumnItem(firstOption);
        this.createSimplefilterRadioButton({type: type});
        this.createColumnItem(secondOption);

        this.checkValidation();
    };

    SimpleFilterDialog.prototype.createSimplefilterRadioButton = function (option) {
        var $parent = this.$mainControl.find('.brtc-va-refine-simplefilter-contents');

        var $item = $('' +
            '<div class="brtc-va-dialogs-simplefilter-type">' +
            '   <div class="brtc-va-dialogs-simplefilter-type-and">And</div>' +
            '   <div class="brtc-va-dialogs-simplefilter-type-or">Or</div>' +
            '</div>');
        // $item.css('background-color', 'blue');
        $parent.append($item);

        $parent.find('.brtc-va-dialogs-simplefilter-type-and').jqxRadioButton({
            checked: (option.type == 'and'),
            theme: Brightics.VA.Env.Theme
        });

        $parent.find('.brtc-va-dialogs-simplefilter-type-or').jqxRadioButton({
            checked: (option.type == 'or'),
            theme: Brightics.VA.Env.Theme
        });

    };

    SimpleFilterDialog.prototype.createColumnItem = function (option) {
        var _this = this;
        var $parent = this.$mainControl.find('.brtc-va-refine-simplefilter-contents');
        var $item = $('' +
            '<div class="brtc-va-refine-simplefilter-column-item">' +
            '   <div class="brtc-va-refine-simplefilter-column-name"></div>' +
            '   <div class="brtc-va-refine-simplefilter-condition"></div>' +
            '   <input type="text" class="brtc-va-refine-simplefilter-column-value"/>' +
            '</div>');
        $parent.append($item);

        var $columnsComboBox = $item.find('.brtc-va-refine-simplefilter-column-name');
        // ColumnList
        this.data = [];
        this.data = this.options.columns;
        var widgetOptions = {
            rowCount: 1,
            multiple: false,
            showOpener: 'click',
            removable: false,
            fromModal: true
        };
        var columnList = this.createColumnList($columnsComboBox, widgetOptions, 'brtc-va-editors-sheet-controls-width-3', {
            height: '25px',
            'padding-left': '4px'
        });
        columnList.setItems(this.data);
        $columnsComboBox.data('columnList', columnList);

        var source = ['', '=', '<>', '>', '>=', '<', '<='];
        $item.find('.brtc-va-refine-simplefilter-condition').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            source: source,
            width: 150,
            //height: 25
        });

        var columnNameArray = $.map(this.options.columns, function (col, i) {
            return col.name;
        });

        var cm = CodeMirror.fromTextArea($item.find('.brtc-va-refine-simplefilter-column-value')[0], {
            mode: "brtc-control",
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: false,
            matchBrackets: true,
            scrollbarStyle: "null",
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {list: [].concat(columnNameArray, Brightics.VA.Env.SQLFunctions)}
        });

        cm.on("beforeChange", function (instance, change) {
            var newtext = change.text.join("").replace(/\n/g, ""); // remove ALL \n !
            if (change.update) change.update(change.from, change.to, [newtext]);
            return true;
        });

        cm.setSize('calc(100% - 310px)', '25px');
        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(cm);

        cm.on("beforeChange", function (instance, change) {
            var newtext = change.text.join("").replace(/\n/g, ""); // remove ALL \n !
            if (change.update) change.update(change.from, change.to, [newtext]);
            return true;
        });


        if (option) {
            columnList.setSelectedItems([option.name]);
            $item.find('.brtc-va-refine-simplefilter-condition').val(option.condition);
            cm.setValue(option.columnValue);
        }

        columnList.onChange(function (event, data) {
            _this.checkValidation();
        });

        $item.find('.brtc-va-refine-simplefilter-condition').on('change', function () {
            _this.checkValidation();
        });

        cm.on('change', function (cMirror) {
            _this.checkValidation();
        });

        //임시
        //columnlist empty unit  불필요 margin 삭제
        $columnsComboBox.find('.brtc-va-editors-sheet-controls-columnselector-columncontainer-element-empty').css({
            'width': '100%',
            'margin-left': '0px'
        });
    };

    SimpleFilterDialog.prototype.getAdditionalQueryString = function () {
        var parentItem = this.$mainControl.find('.brtc-va-refine-simplefilter-column-item');
        var whereString = 'WHERE ';
        var additionalQueryString = '';
        var type = this.getRadioButtonValue();

        var simpleFilterQuery = [];
        $.each(parentItem, function (key, value) {
            var column = $(parentItem[key]).find('.brtc-va-refine-simplefilter-column-name').data('columnList').getSelectedItems()[0];
            var operator, textValue;
            if (column !== undefined) {
                operator = $(parentItem[key]).find('.brtc-va-refine-simplefilter-condition').val();
                var cm = $(parentItem[key]).find('.CodeMirror')[0].CodeMirror;
                var textValue = cm.getValue();
                simpleFilterQuery[key] = '`'+ column + '` ' + operator + ' ' + textValue + ' ';
            }
        });

        if (simpleFilterQuery[1])
            additionalQueryString = whereString + simpleFilterQuery[0] + '\n' + type + ' ' + simpleFilterQuery[1];
        else
            additionalQueryString = whereString + simpleFilterQuery[0];

        return additionalQueryString;
    };

    SimpleFilterDialog.prototype.getRadioButtonValue = function () {
        var val = '';
        var andButton = this.$mainControl.find('.brtc-va-dialogs-simplefilter-type-and');
        var orButton = this.$mainControl.find('.brtc-va-dialogs-simplefilter-type-or');

        if (andButton.jqxRadioButton('checked')) {
            val = "and";
        }
        else if (orButton.jqxRadioButton('checked')) {
            val = "or";
        }

        return val;
    };

    SimpleFilterDialog.prototype.handleOkClicked = function () {
        if (this.problems.length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There is a problem with some values.');
        } else {
            var select = '*';
            var additionalQuery = this.getAdditionalQueryString();

            this.buildFunctionUnit('Simple Filter', 'simpleFilter', select, additionalQuery);
            Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);
        }
    };

    SimpleFilterDialog.prototype.buildFunctionUnit = function (label, func, select, additionalQuery) {
        var fnUnit = this.DEFAULT_FN_UNIT;
        fnUnit.fid = this.options.fid ? this.options.fid : Brightics.VA.Core.Utils.IDGenerator.func.id();
        fnUnit.func = func;
        fnUnit.name = this.options.context === 'python' ? 'PythonScript' : 'SQLExecutor';
        fnUnit.inData = this.options.in;
        fnUnit.outData = this.options.out;
        fnUnit.param = {
            'select': select,
            'additional-query': additionalQuery
        };
        if (this.options.context === 'python') {
            fnUnit.param.script = this.buildScript(select, additionalQuery);
            fnUnit.param['out-table-alias'] = ['result'];
        }
        fnUnit.display = {
            'label': label
        };
        this.resultFnUnit = fnUnit;
    };

    SimpleFilterDialog.prototype.buildScript = function (select, additionalQuery) {
        var script = this.DEFAULT_SCRIPT;
        var strSelect = select.replace(/\n/g, '');
        var strAdditionalQuery = additionalQuery.replace(/\n/g, '');
        script = script.replace('${SELECT_SQL}', strSelect);
        script = script.replace('${ADDITIONAL_QUERY}', strAdditionalQuery);
        return script;
    };


    SimpleFilterDialog.prototype.renderValidation = function () {
        // var _this = this;
        // var parentItem = this.$mainControl.find('.brtc-va-refine-simplefilter-column-item');

        // $.each(this.problems, function (key, problem) {
        //     _this.createValidationContent($(parentItem[problem.paramIndex]), problem);
        // });
        // var _this = this;
        // var $items = this.$mainControl.find('.brtc-va-refine-simplefilter-contents > .brtc-va-refine-simplefilter-column-item');

        // $.each(this.problems, function (key, problem) {
        //     _this.createValidationContent($($items[problem.paramIndex]), problem);
        //     //임시 
        //     // 1개의 problem만 있으므로 무조건 하나의 brtc-va-refine-step-validation-tooltip 찾아서 css변경
        //     $($items[problem.paramIndex]).find('.brtc-va-refine-step-validation-tooltip').css({
        //         'clear': '',
        //         'float': 'left',
        //         'margin-left': '8px'
        //     });
        // });
    };

    SimpleFilterDialog.prototype.checkValidation = function () {
        var _this = this;
        this.removeValidation();

        var parentItem = this.$mainControl.find('.brtc-va-refine-simplefilter-column-item');

        $.each(parentItem, function (key, value) {
            var column = $(parentItem[key]).find('.brtc-va-refine-simplefilter-column-name').data('columnList').getSelectedItems()[0];
            var operator, textValue;

            if (key == 0 && column == undefined) {
                _this.addProblem(_this.createProblem({
                    errorCode: 'BR-0033',
                    paramIndex: key,
                    param: 'Column',
                    messageParam: ['Column']
                }));
            }

            else if (key == 0 || (key == 1 && column != undefined)) {
                operator = $(parentItem[key]).find('.brtc-va-refine-simplefilter-condition').val();
                // textValue = $(parentItem[key]).find('.brtc-va-refine-simplefilter-column-value').val();
                var cm = $(parentItem[key]).find('.CodeMirror')[0].CodeMirror;
                textValue = cm.getValue();

                if (operator == '') {
                    _this.addProblem(_this.createProblem({
                        errorCode: 'BR-0033',
                        paramIndex: key,
                        param: 'Operator',
                        messageParam: ['Operator']
                    }));
                }
                else if (textValue == '') {
                    _this.addProblem(_this.createProblem({
                        errorCode: 'BR-0033',
                        paramIndex: key,
                        param: 'Value',
                        messageParam: ['Value']
                    }));
                }
            }
        });

        this.renderValidation();
    };

    SimpleFilterDialog.prototype.destroy = function () {
        this.destroyColumnSelector();
        this.destroyDropDownList();
        this.$mainControl.dialog('destroy');
        if (typeof this.options.close == 'function') {
            this.options.close(this.dialogResult);
        }
    };

    SimpleFilterDialog.prototype.destroyDropDownList = function () {
        var $dropDownList = $('.brtc-va-refine-simplefilter-condition');
        if ($dropDownList.length > 0) {
            $dropDownList.jqxDropDownList('destroy');
        }
    };

    Brightics.VA.Core.Dialogs.RefineSteps.SimpleFilterDialog = SimpleFilterDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SortDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.call(this, parentId, options);
    }

    SortDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype);
    SortDialog.prototype.constructor = SortDialog;

    SortDialog.prototype.getTitle = function () {
        return 'Sorter';
    };

    SortDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        $parent.append('' +
            '<div class="brtc-va-refine-sortcolumn-newcolumn-container"></div>' +
            '<div class="brtc-va-refine-sortcolumn-addbutton">+ Add New Column</div>');


        $parent.find('.brtc-va-refine-sortcolumn-newcolumn-container').sortable({
            axis: 'y',
            containment: '.brtc-va-refine-sortcolumn-newcolumn-container',
            helper: function (event, ui) {
                var $clone = $(ui).clone();
                $clone.css('position', 'absolute');
                return $clone.get(0);
            },
            handle: ".brtc-va-refine-sortcolumn-column-sort",
            //stop 할때 remove 버튼 hide() 추가 : stepdialog에 구현
            stop: function (event, ui) {
                //_this.sortableStopCallback.hideRemoveButton(_this,'brtc-va-refine-sortcolumn-column-item', 'brtc-va-refine-sortcolumn-column-remove');
            }
        });
        $parent.find('.brtc-va-refine-sortcolumn-newcolumn-container').disableSelection();

        this.render();

        var $addButton = $parent.find('.brtc-va-refine-sortcolumn-addbutton').jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        $addButton.click(function () {
            _this.createNewSortItem();
            _this.checkValidation();
        });

        $parent.perfectScrollbar();
        $parent.perfectScrollbar('update');
    };

    SortDialog.prototype.render = function () {
        if (this.options.param) {
            var additionalQuery = this.options.param['additional-query'];

            var res = additionalQuery.replace(/ \n/gi, '\n').split("\n");
            if (res[0].startsWith('ORDER BY')) {
                res.splice(0, 1);
            }
            if (res[res.length - 1] == '') {
                res.splice(res.length - 1, 1);
            }

            for (var i = 0; i < res.length; i++) {
                var splitData = res[i].replace(/`/gi, '').replace(',', '').split(' ');

                var name = splitData[0].replace(' ', '');
                var sortMode = splitData[1].replace(' ', '');

                this.createNewSortItem({
                    'name': name,
                    'sort-mode': sortMode
                });
            }
        } else {
            this.createNewSortItem();
        }
        this.checkValidation();
    };

    SortDialog.prototype.createNewSortItem = function (selectedColumns) {
        var _this = this;
        var $parent = this.$mainControl.find('.brtc-va-refine-sortcolumn-newcolumn-container');

        var $item = $('' +
            '<div class="brtc-va-refine-sortcolumn-column-item">' +
            '   <div class="brtc-va-refine-sortcolumn-column-sort" style="cursor: pointer;"><i class="fa fa-bars"></i></div>' +
            '   <div class="brtc-va-refine-sortcolumn-column-name"></div>' +
            '   <div class="brtc-va-refine-sortcolumn-column-propertycontrol-button"><i class="fa fa-sort"></i></div>' +
            '   <div class="brtc-va-refine-sortcolumn-column-remove"></div>' +
            '</div>');
        $parent.append($item);

        var $columnsComboBox = $item.find('.brtc-va-refine-sortcolumn-column-name');
        // ColumnList
        var widgetOptions = {
            rowCount: 1,
            multiple: false,
            showOpener: 'click',
            removable: false,
            fromModal: true
        };
        var columnList = this.createColumnList($columnsComboBox, widgetOptions, 'brtc-va-editors-sheet-controls-width-10', {
            height: '25px',
            'padding-left': '4px'
        });
        columnList.setItems(this.options.columns);
        $item.data('columnList', columnList);

        var $toggleButton = $item.find('.brtc-va-refine-sortcolumn-column-propertycontrol-button');

        // Toggle Button
        this.createButton($toggleButton, {width: '19px', height: '19px'}, '', {float: 'left', 'margin-left': '3px'});
        $toggleButton.data('sort-mode', 'ASC');
        $toggleButton.on('click', function () {
            var selectedItem = columnList.getSelectedItems();
            var selectedColumn = $.grep(_this.options.columns, function (element, index) {
                return element.name === selectedItem[0];
            });
            if (selectedColumn) {
                if (selectedColumn.length > 0) {
                    var currentVal = $toggleButton.data('sort-mode');
                    if (currentVal === 'ASC') {
                        $toggleButton.data('sort-mode', 'DESC');
                    } else {
                        $toggleButton.data('sort-mode', 'ASC');
                    }
                    _this.updateSortModeIcon($toggleButton, columnList);
                }
            }
        });

        columnList.onChange(function (event, data) {
            _this.updateSortModeIcon($toggleButton, columnList);
            _this.checkValidation();
        });

        //delete button
        $item.find('.brtc-va-refine-sortcolumn-column-remove').click(function () {
            $(this).closest('.brtc-va-refine-sortcolumn-column-item').remove();
            _this.checkValidation();
        });

        if (selectedColumns) {
            columnList.setSelectedItems([selectedColumns.name]);

            $toggleButton.data('sort-mode', selectedColumns['sort-mode']);
            this.updateSortModeIcon($toggleButton, columnList);
        }

        //임시 
        $item.find('.brtc-va-refine-sortcolumn-column-sort').css('margin-bottom', '5px');
        //첫번째 item에 remove버튼 hide 기능
        //this.sortableStopCallback.hideRemoveButton(this, 'brtc-va-refine-sortcolumn-column-item', 'brtc-va-refine-sortcolumn-column-remove');
    };

    SortDialog.prototype.createAdditionalQuery = function () {
        var additionalQuery = 'ORDER BY \n';
        var $container = this.$mainControl.find('.brtc-va-refine-sortcolumn-newcolumn-container');

        var $target = $container.find('.brtc-va-refine-sortcolumn-column-item');
        $target.each(function (index, element) {
            var columnList = $(element).data('columnList');
            var sortModeButton = $(element).find('.brtc-va-refine-sortcolumn-column-propertycontrol-button');

            var selectedColumns = columnList.getSelectedItems();
            if (selectedColumns.length) {
                var sortMode = sortModeButton.data('sort-mode');

                additionalQuery += '`' + selectedColumns[0] + '`' + ' ' + sortMode;
                additionalQuery += (index < $target.length - 1) ? (', \n') : (' \n');
            }
        });

        return additionalQuery;
    };

    SortDialog.prototype.handleOkClicked = function () {
        if (this.problems.length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There is a problem with some values.');
        } else {
            var select = '*';
            var additionalQuery = this.createAdditionalQuery();

            this.buildFunctionUnit('Sort', 'sortByRefine', select, additionalQuery);
            Brightics.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);
        }
    };

    SortDialog.prototype.buildFunctionUnit = function (label, func, select, additionalQuery) {
        var fnUnit = this.DEFAULT_FN_UNIT;
        fnUnit.fid = this.options.fid ? this.options.fid : Brightics.VA.Core.Utils.IDGenerator.func.id();
        fnUnit.func = func;
        fnUnit.name = this.options.context === 'python' ? 'PythonScript' : 'SQLExecutor';
        fnUnit.inData = this.options.in;
        fnUnit.outData = this.options.out;
        fnUnit.param = {
            'select': select,
            'additional-query': additionalQuery
        };
        if (this.options.context === 'python') {
            fnUnit.param.script = this.buildScript(select, additionalQuery);
            fnUnit.param['out-table-alias'] = ['result'];
        }
        fnUnit.display = {
            'label': label
        };
        this.resultFnUnit = fnUnit;
    };

    SortDialog.prototype.buildScript = function (select, additionalQuery) {
        var script = this.DEFAULT_SCRIPT;
        var strSelect = select.replace(/\n/g, '');
        var strAdditionalQuery = additionalQuery.replace(/\n/g, '');
        script = script.replace('${SELECT_SQL}', strSelect);
        script = script.replace('${ADDITIONAL_QUERY}', strAdditionalQuery);
        return script;
    };

    SortDialog.prototype.renderValidation = function () {
        var _this = this;

        var $container = this.$mainControl.find('.brtc-va-refine-sortcolumn-newcolumn-container');
        var $target = $container.find('.brtc-va-refine-sortcolumn-column-item');

        $.each(this.problems, function (key, problem) {
            if (problem.paramIndex == -1) {
                //_this.createValidationContent($($container), problem);
                // //임시 
                // // 1개의 problem만 있으므로 무조건 하나의 brtc-va-refine-step-validation-tooltip 찾아서 css변경
                // $($container).find('.brtc-va-refine-step-validation-tooltip').css({
                //     'clear': '',
                //     'float': 'left',
                //     'margin-top': '0px'
                // });
            }
            else {
                _this.createValidationContent($($target[problem.paramIndex]), problem); //, $($target[problem.paramIndex]).find('.brtc-va-editors-sheet-controls-columnlist'));
                //임시 
                // 1개의 problem만 있으므로 무조건 하나의 brtc-va-refine-step-validation-tooltip 찾아서 css변경
                $($target[problem.paramIndex]).find('.brtc-va-refine-step-validation-tooltip').css({
                    'clear': '',
                    'float': 'left',
                    'margin-top': '0px',
                    'margin-bottom': '10px',
                    'margin-left': '35px'
                });
            }

        });
    };

    SortDialog.prototype.checkValidation = function () {
        var _this = this;
        this.removeValidation();

        var $container = this.$mainControl.find('.brtc-va-refine-sortcolumn-newcolumn-container');
        var $target = $container.find('.brtc-va-refine-sortcolumn-column-item');

        var selectedColumnNames = [];
        if ($target.length) {
            $target.each(function (index, element) {
                var columnList = $(element).data('columnList');
                var selectedColumns = columnList.getSelectedItems();
                if (selectedColumns.length) {
                    if ($.inArray(selectedColumns[0], selectedColumnNames) > -1) {
                        var messageParam = "Select column(s) - '"+ selectedColumns[0] + "' already exist.";
                        _this.addProblem(_this.createProblem({
                            errorCode: 'BR-0100',
                            paramIndex: index,
                            param: 'Select column',
                            messageParam: [messageParam]
                        }));
                    }
                    else {
                        selectedColumnNames.push(selectedColumns[0]);
                    }
                } else {
                    _this.addProblem(_this.createProblem({
                        errorCode: 'BR-0033',
                        paramIndex: index,
                        param: 'Select column',
                        messageParam: ['Select column']
                    }));
                }
            });
        }
        else {
            this.addProblem(_this.createProblem({
                errorCode: 'BR-0033',
                paramIndex: -1,
                param: 'Column',
                messageParam: ['Column']
            }));
        }

        this.renderValidation();
    };

    SortDialog.prototype.updateSortModeIcon = function ($sortButton, columnList) {
        var _this = this;
        var selectedItem = columnList.getSelectedItems();
        var selectedColumn = $.grep(_this.options.columns, function (element, index) {
            return element.name === selectedItem[0];
        });
        var sortMode = $sortButton.data('sort-mode');

        if (selectedColumn) {
            if (selectedColumn.length > 0) {
                var selectedColumnType = selectedColumn[0].type;

                $sortButton.find('i').removeClass();
                var className;
                if (selectedColumnType === 'string') {
                    className = 'fa fa-sort-alpha-' + sortMode.toLowerCase();
                    $sortButton.find('i').addClass(className);
                }
                else if (selectedColumnType === 'number' || selectedColumnType === 'date') {
                    className = 'fa fa-sort-numeric-' + sortMode.toLowerCase();
                    $sortButton.find('i').addClass(className);
                }
                else {
                    className = 'fa fa-sort';
                    $sortButton.find('i').addClass(className);
                }
            }
        }
    };

    SortDialog.prototype.destroy = function () {
        this.destroyColumnSelector();
        this.$mainControl.dialog('destroy');
        if (typeof this.options.close == 'function') {
            this.options.close(this.dialogResult);
        }
    };

    Brightics.VA.Core.Dialogs.RefineSteps.SortDialog = SortDialog;

}).call(this);
/**
 * Created by gy84.bae on 2016-10-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ScriptEditorDialog(parentId, options) {
        this.dropdownLists = [];
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    ScriptEditorDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    ScriptEditorDialog.prototype.constructor = ScriptEditorDialog;

    ScriptEditorDialog.prototype.checkInfo = function () {
        var editor = Studio.getEditorContainer().getActiveModelEditor();
        editor.checkInfo();
    };

    ScriptEditorDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 1400;
        this.dialogOptions.height = 700;
        // this.dialogOptions.resizable = true;
        this.dialogOptions.maxWidth = 1400;
        this.dialogOptions.maxHeight = 700;
    };

    ScriptEditorDialog.prototype._getInTableLabel = function (index) {
    };

    ScriptEditorDialog.prototype._getInModelLabel = function (index) {
    };

    ScriptEditorDialog.prototype._getInImageLabel = function (index) {
    };


    ScriptEditorDialog.prototype.createInTableAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inTableList = this.FnUnitUtils.getInTable(this.options.fnUnit),
            inFunctionList = [];

        for (let i in inTableList) {
            var fn = model.getFnUnitByOutData(inTableList[i]);
            if (!_.isEmpty(fn)) inFunctionList.push(fn);
        }

        for (let i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = this._getInTableLabel(i);

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutTable(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };


    ScriptEditorDialog.prototype.createInModelAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inModelList = this.FnUnitUtils.getInModel(this.options.fnUnit),
            inFunctionList = [];

        for (let i in inModelList) {
            inFunctionList.push(model.getFnUnitByOutData(inModelList[i]));
        }

        for (let i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = this._getInModelLabel(i);

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutModel(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };


    ScriptEditorDialog.prototype.createInImageAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inImageList = this.FnUnitUtils.getInImage(this.options.fnUnit),
            inFunctionList = [];

        for (let i in inImageList) {
            inFunctionList.push(model.getFnUnitByOutData(inImageList[i]));
        }

        for (let i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = this._getInImageLabel(i);

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutImage(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };


    ScriptEditorDialog.prototype.createDialogContentsArea = function ($parent, useTable) {
        this.scriptEditorOptions = {
            statement: '',
            scriptType: '',
            mode: '',
            dataMap: {},
            fnUnit: {},
            additionalHint: [],
            maxLength: 999999,
            close: function (event) {
            }
        };

        $.extend(true, this.scriptEditorOptions, this.options);

        this.createLayout();
        this.renderInfoArea();
        this.renderEditorArea();
        this.renderResultArea();
        this.registerEvent();
    };

    ScriptEditorDialog.prototype.destroy = function () {
        this.dropdownLists.forEach((dropdownList) => {
            dropdownList.jqxDropDownList('destroy');
        })

        Brightics.VA.Dialogs.Dialog.prototype.destroy.call(this);
    };

    ScriptEditorDialog.prototype.createLayout = function () {
        this.$contentArea = this.$mainControl.find('.brtc-va-dialogs-contents');

        var scriptOnly = (this.options.scriptOnly) ? this.options.scriptOnly : false;
        var scriptType = (this.options.scriptType) ? this.options.scriptType : 'script';

        this.$editorArea = $('' +
            '<div class="brtc-va-dialogs-contents-statement" script-only="' + scriptOnly + '" script-type="' + scriptType + '">' +
            '   <textarea></textarea>' +
            '   <div class="brtc-va-dialogs-contents-statement-error">Up to ' + Brightics.VA.Core.Utils.CommonUtils.numberToStringWithComma(this.scriptEditorOptions.maxLength) + ' characters can be entered.</div>' +
            '</div>' +
            '');
        this.$errorArea = this.$editorArea.find('.brtc-va-dialogs-contents-statement-error');
        this.$infoArea = $('<div class="brtc-va-dialogs-contents-info" script-only="' + scriptOnly + '">');
        this.$contentArea.append(this.$editorArea).append(this.$infoArea);
        this.$infoArea.perfectScrollbar();

        var _this = this;
        this.$mainControl.on('resized', function (event) {
            _this.$infoArea.perfectScrollbar('update');
        });
    };

    ScriptEditorDialog.prototype.registerEvent = function () {
        this.$editorArea.find('textarea').bind('showOverflow', function () {
            $(this).siblings('.brtc-va-dialogs-contents-statement-error').show();
        });
        this.$editorArea.find('textarea').bind('hideOverflow', function () {
            $(this).siblings('.brtc-va-dialogs-contents-statement-error').hide();
        });
    };

    ScriptEditorDialog.prototype.renderEditorArea = function () {
        this.codeMirror = CodeMirror.fromTextArea(this.$editorArea.find('textarea')[0], {
            mode: this.scriptEditorOptions.mode,
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: true,
            matchBrackets: true,
            autofocus: false,
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {
                list: this.scriptEditorOptions.additionalHint
            }
        });

        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror);

        Brightics.VA.Core.Utils.WidgetUtils.setCodeMirrorMaxLength(this.codeMirror);

        this.setEditorStatement(this.options.statement);

        this.codeMirror.setSize('100%', '100%');
        this.codeMirror.setOption('maxLength', this.scriptEditorOptions.maxLength);
    };

    ScriptEditorDialog.prototype.renderResultArea = function ($parent) {

    };

    ScriptEditorDialog.prototype.setEditorStatement = function (statement) {
        this.codeMirror.setValue(statement);
        this.codeMirror.clearHistory();
    };

    ScriptEditorDialog.prototype.renderInfoArea = function () {

    };

    ScriptEditorDialog.prototype.handleOkClicked = function () {

        this.dialogResult = {
            OK: true,
            Cancel: false,
            queryStatement: this.codeMirror.getValue()
        };
        this.$mainControl.dialog('close');
    };

    // ScriptEditorDialog.prototype.createDropDownList = function ($parent, alias, isMandatory, tableId) {
    //     var _this = this;

    //     var $outTableInput = $('' +
    //         '<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable" tableId="' + tableId + '">' +
    //         '   <input class="brtc-va-dialogs-scalaeditor-alias-body-outtable-input" isMandatory=' + isMandatory + ' />' +
    //         '   <div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-remove""></div>' +
    //         '</div>' +
    //         '');

    //     var $input = $outTableInput.find('input');

    //     $parent.append($outTableInput);

    //     $input.jqxInput({
    //         placeHolder: "Enter out table alias",
    //         height: 25,
    //         width: '105px',
    //         theme: 'office'
    //     });
    //     $input.jqxInput('val', alias);

    //     if ($input.val() === '' || $input.val() == undefined) {
    //         $input.css('border-color', 'red');

    //     }

    //     $input.focus();

    //     $input.on('change', function () {
    //         if ($(this).val() == '') {
    //             $(this).css('border-color', 'red');
    //         } else {
    //             $(this).css('border-color', '#d4d4d4');
    //         }
    //     });

    //     $input.keydown(function (key) {
    //         if (key.keyCode == 13) {
    //             _this.createOutTableAlias(_this.$outTableAliasBody, false);
    //         }
    //     });

    //     if (isMandatory == true && alias == '') {
    //         $input.css('border-color', 'red');
    //     }

    //     var $removeButton = $outTableInput.find('.brtc-va-dialogs-scalaeditor-alias-body-outtable-remove');
    //     $removeButton.attr({
    //         'isMandatory': isMandatory
    //     });

    //     $removeButton.click(function () {
    //         var $target = $(this).closest('.brtc-va-dialogs-contents-statement-lastline-element-wrapper');
    //         if ($target.find('.brtc-va-dialogs-scalaeditor-alias-body-outtable').attr('tableId')) _this.removeSendFnunit($target.attr('tableId'));
    //         $target.remove();
    //         _this.$outTableAliasBody.perfectScrollbar('update');
    //     });

    //     return $input;
    // };

    ScriptEditorDialog.prototype.createDropDownList = function ($parent, alias, isMandatory, tableId) {
        var $outTableType = $('' +
            '<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-type" tableId="' + tableId + '">' +
            '</div>' +
            '');

        $parent.append($outTableType);

        var source = [
            {text: 'TABLE', value: 'table'},
            {text: 'MODEL', value: 'model'},
            {text: 'IMAGE', value: 'image'},
        ];

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '20px',
            source: source,
            displayMember: 'text',
            selectedIndex: 0,
            valueMember: 'value',
            dropDownHeight: 70
        };
        $outTableType.jqxDropDownList(options);

        this.dropdownLists.push($outTableType);
    };

    ScriptEditorDialog.prototype.createInput = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);

        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }

        if (!$control.attr('type')) $control.attr('type', 'text');
        if (!$control.attr('maxlength')) $control.attr('maxlength', '100');

        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxInput(options);
        var preValue = $control.val();
        $control.focus(function () {
            preValue = $control.val();
        });
        $('svg').on('mousedown', function () {
            var value = $control.val();
            if (value !== preValue && $control.is(":focus")) {
                $control.trigger("change");
            }
        });

        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($control);

    };

    ScriptEditorDialog.prototype.createRadioButton = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = 'brtc-va-editors-sheet-controls-radiobutton-default';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxRadioButton(options);
        return $control;
    };

    ScriptEditorDialog.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');
        $control.wrap($wrapper);
    };

    ScriptEditorDialog.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    ScriptEditorDialog.prototype.addCssToWrapper = function ($control, cssOptions) {
        if (cssOptions) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.css(cssOptions);
        }
    };

    Brightics.VA.Core.Dialogs.ScriptEditorDialog = ScriptEditorDialog;

}).call(this);
/**
 * Created by gy84.bae on 2016-10-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function FnUnitDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    FnUnitDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    FnUnitDialog.prototype.constructor = FnUnitDialog;

    FnUnitDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 600;
        this.dialogOptions.height = 800;
    };   

    FnUnitDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main">' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px"></div>' + 
            '       <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit"></div>' +
            '       <div class="brtc-va-dialogs-buttonbar"></div>' +
            '   </div>' +
            '</div>');

        this.$titleArea = this.$mainControl.find('.brtc-va-dialogs-title');
    };

    FnUnitDialog.prototype.initContents = function () {
        Brightics.VA.Dialogs.Dialog.prototype.initContents.call(this);

        this.createTitleArea();
    };

    FnUnitDialog.prototype.createTitleArea = function () {
        this.createLabel();
        this.createHelp();
        this.createContext();

        this.setLabel();
    };

    FnUnitDialog.prototype.createLabel = function () {
        this.$label = $('<div class="brtc-va-dialogs-title-label brtc-style-flex-1"></div>');

        this.$titleArea.append(this.$label);
    };

    FnUnitDialog.prototype.createHelp = function () {
        this.$help = $('' +
            '<div class="brtc-va-dialogs-title-help">' +
            '   <div class="brtc-va-editors-sheet-panels-propertiespanel-header-help" title="Help"></div>' +
            '</div>'
        );

        this.$titleArea.append(this.$help);

        this.createHelpPopover();
    };
    
    FnUnitDialog.prototype.createContext = function () {
        var _this = this;

        this.$contenxt = $('' +
            '<div class="brtc-va-dialogs-title-contenxt">' +
            '   <div class="brtc-va-editors-sheet-panels-propertiespanel-header-more-menu"></div>' +
            '</div>'
        );

        this.$titleArea.append(this.$contenxt);

        this.createPropertiesContextMenu();

        this.$contenxt.on('click', function (event) {
            var scrollTop = $(window).scrollTop();
            var scrollLeft = $(window).scrollLeft();
            var left = parseInt(event.clientX) + scrollLeft;

            var diffPosition = $(window).width() - event.clientX;
            if (diffPosition < 100) {
                left = left - 130;
            }
            var top = parseInt(event.clientY) + scrollTop;
            top += 5;

            _this.$ctxMenu.jqxMenu('open', left, top);
            $(window).on('resize', _this.ctxMenuCloseHandler);
        });
    };

    FnUnitDialog.prototype.setLabel = function (label) {
        var label = (label)? label : this.options.fnUnit.display.label;
        this.$label.text(label);
    };

    FnUnitDialog.prototype.createHelpPopover = function () {
        var _this = this;
        this.$help.click(function () {
            var operation = _this.getPrimaryOperation();
            var context = _this.getFunctionDef().defaultFnUnit.context || 'scala';
            if (_this.getFunctionDef().category === 'process') {
                context = 'common';
            }
            Brightics.VA.Core.Utils.ModelUtils.openFunctionReferencePopup('data', operation, context);
        });
    };

    FnUnitDialog.prototype.createPropertiesContextMenu = function () {
        var _this = this;
        var $ctxMenu = $('' +
            '<div class="brtc-va-editors-sheet-panels-propertiespanel-header-ctxmenu">' +
            '   <ul>' +
            '       <li action="rename">Edit</li>' +
            '   </ul>' +
            '</div>');

        this.$titleArea.append($ctxMenu);

        this.$ctxMenu = $ctxMenu.jqxMenu({
            theme: Brightics.VA.Env.Theme,
            width: '120px',
            height: '120px',
            autoOpenPopup: false,
            mode: 'popup',
            animationHideDuration: 0,
            animationShowDuration: 0
        });

        this.$ctxMenu.on('itemclick', function (event) {
            var $el = $(event.args);
            if ($el.attr('action') == 'rename') {
                var dialogOptions = {
                    title: 'Edit Function',
                    label: _this.options.fnUnit.display.label,
                    description: _this.options.fnUnit.display.description || '',
                    close: function (dialogResult) {
                        if (dialogResult.OK) {
                            _this.setLabel(dialogResult.label);
                            _this.options.fnUnit.display.label = dialogResult.label;
                            _this.options.fnUnit.display.description = dialogResult.description;
                        }
                    }
                };
                new Brightics.VA.Core.Dialogs.EditResourceDialog($(document.body), dialogOptions);
            }
        });


        this.ctxMenuCloseHandler = function () {
            _this.$ctxMenu.jqxMenu('close');
        };

        this.$ctxMenu.on('closed', function () {
            $(window).off('resize', _this.ctxMenuCloseHandler);
        });
    };

    FnUnitDialog.prototype.getPrimaryOperation = function () {
        var clazz = this.options.editor.getModel().type;
        return Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, this.options.fnUnit.func).defaultFnUnit.name;
    };

    FnUnitDialog.prototype.getFunctionDef = function () {
        var clazz = this.options.editor.getModel().type;
        return Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, this.options.fnUnit.func);
    };

    Brightics.VA.Core.Dialogs.FnUnitDialog = FnUnitDialog;

}).call(this);
/**
 * Created by SDS on 2017-05-30.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function AddScheduleDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    AddScheduleDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    AddScheduleDialog.prototype.constructor = AddScheduleDialog;

    AddScheduleDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 685;
        this.dialogOptions.height = 435;

        this.projectId = this.options.editorInput.getProjectId();
        this.fileId = this.options.editorInput.getFileId();
    };

    AddScheduleDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        $parent.append('' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Schedule Name</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-name-input" valid-type="type2" maxlength="80"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Cron Expression</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-cron-input" valid-type="cronType" maxlength="80"/>' +
            '   <div class="brtc-va-dialogs-schedule-cron-help"></div>' +
            '   <div class="brtc-va-dialogs-schedule-cron-checkbox">IMMEDIATE</div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Schedule Owner</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-owner-input brtc-style-text-overflow-ellipsis" valid-type="type1" maxlength="80"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Is Active</div>' +
            '   <div class="brtc-va-dialogs-schedule-active-selector"></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Dependency Schedule</div>' +
            '   <div class="brtc-va-dialogs-schedule-dependency-selector"></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row brtc-style-margin-top-5">' +
            '   <div class="brtc-va-dialogs-schedule-label">Model Version</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-model-version-input" />' +
            '   <input type="button" class="brtc-va-dialogs-model-version-load" value="Select Version"/>' +
            '</div>' +
            '');

        this.$scheduleNameInput = $parent.find('.brtc-va-dialogs-schedule-name-input').jqxInput({
            theme: Brightics.VA.Env.Theme
        });

        Utils.InputValidator.appendValidationCondition(this.$scheduleNameInput);
        Brightics.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout($parent.find('.brtc-va-dialogs-schedule-name-input'));

        this.$cronInput = $parent.find('.brtc-va-dialogs-schedule-cron-input').jqxInput({
            theme: Brightics.VA.Env.Theme
        });

        Utils.InputValidator.appendValidationCondition(this.$cronInput);

        $('.brtc-va-dialogs-schedule-cron-help').on('click', function () {
            window.open('cron-expression', 'Brightics Cron Expression Help');
        });

        this.$chkimmediate = $parent.find('.brtc-va-dialogs-schedule-cron-checkbox').jqxCheckBox({
            theme: Brightics.VA.Env.Theme
        });
        this.$chkimmediate.on('change', function (event) {
            if (event.args.checked == true) {
                _this.$cronInput.jqxInput({
                    disabled: true,
                    value: 'IMMEDIATE'
                });
            } else {
                _this.$cronInput.jqxInput({
                    disabled: false,
                    value: ''
                });
            }
        });

        this.$scheduleOwnerInput = $parent.find('.brtc-va-dialogs-schedule-owner-input').jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true,
            value: Brightics.VA.Env.Session.userId
        });

        this.$activeSelector = $parent.find('.brtc-va-dialogs-schedule-active-selector').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            source: ['Y', 'N'],
            selectedIndex: 0
        });

        this.$dependencySelector = $parent.find('.brtc-va-dialogs-schedule-dependency-selector').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            displayMember: 'scheduleName',
            valueMember: 'scheduleId',
            placeHolder: 'Please Choose:',
            dropDownHeight: 300
        });

        this.$modelVersionInput = $parent.find('.brtc-va-dialogs-schedule-model-version-input').jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true,
            placeHolder: 'Select version'
        });

        this.$loadVersionButton = $parent.find('.brtc-va-dialogs-model-version-load');
        this.$loadVersionButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: 120,
            height: 27
        });

        this.$loadVersionButton.on('click', function () {
            _this.openSelectVersionDialog();
        });

        var getDependencies = function () {
            var option = {
                url: 'api/admin/v2/schedules',
                type: 'GET',
                contentType: 'application/json; charset=utf-8'
            };
            $.ajax(option).done(function (data) {
                $.each(data, function (idx, schedule) {
                    data[idx].scheduleId = Utils.WidgetUtils.convertHTMLSpecialChar(schedule.scheduleId);
                });

                _this.$dependencySelector.jqxDropDownList({
                    source: data
                });

                _this.$dependencySelector.jqxDropDownList('insertAt', '', 0);
            }).fail(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            });
        };

        var promises = [];

        promises.push(new Promise(function (resolve, reject) {
            getDependencies();
        }));

        Promise.all(promises).catch(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(error);
        }).then(function () {
        });

        _this.initData();
    };

    AddScheduleDialog.prototype.openSelectVersionDialog = function () {
        var closeHandler = function (result) {
            if (result.OK) {
                var version = result.data;
                this.$modelVersionInput.val(version.getVersion());

                this.versionId = version.getVersionId();
                this.versionContents = version.getContents();
            }
        }.bind(this);

        new Brightics.VA.Core.Dialogs.SelectVersionDialog(this.$mainControl, {
            projectId: this.projectId,
            fileId: this.fileId,
            close: closeHandler
        });
    };

    AddScheduleDialog.prototype.initData = function ($parent) {
        var _this = this;
        _this.fileList = {};

        var ResourceManager = Studio.getResourceManager();
        ResourceManager.fetchProjects()
            .then(function (data) {
                $.each(data, function (idx, project) {
                    if (project.getProjectId() === _this.options.editorInput.getProjectId()) {
                        _this.projectLabel = project.getLabel();
                    }
                });

                _this.fileList[_this.options.editorInput.getProjectId()] = {};
                return ResourceManager.fetchFiles(_this.options.editorInput.getProjectId())
                    .then(function (data) {
                        $.each(data, function (idx, model) {
                            _this.fileList[_this.options.editorInput.getProjectId()][model.getFileId()] = model;
                        });
                        return true;
                    });
            })
            .catch(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            });
    };

    AddScheduleDialog.prototype.handleOkClicked = function () {
        var _this = this;

        if (_this.$scheduleNameInput.val() === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter schedule name.');
            $('.brtc-va-dialogs-schedule-name-input').focus();
            return;
        }

        if (_this.$modelVersionInput.val() === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please select model version.');
            return;
        }

        if (_.trim(_this.$cronInput.val()) === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter cron expression.');
            $('.brtc-va-dialogs-schedule-cron-input').focus();
            return;
        } else {
            if (!$('.brtc-va-dialogs-schedule-cron-checkbox').jqxCheckBox('checked')) {
                var regExp = new RegExp('^\\s*($|#|\\w+\\s*=|(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|\/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|\/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|\/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|\/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[01]?\\d|2[0-3])(?:(?:-|\/|\\,)(?:[01]?\\d|2[0-3]))?(?:,(?:[01]?\\d|2[0-3])(?:(?:-|\/|\\,)(?:[01]?\\d|2[0-3]))?)*)\\s+(\\?|\\*|(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|\/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?(?:,(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|\/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?)*)\\s+(\\?|\\*|(?:[1-9]|1[012])(?:(?:-|\/|\\,)(?:[1-9]|1[012]))?(?:L|W)?(?:,(?:[1-9]|1[012])(?:(?:-|\/|\\,)(?:[1-9]|1[012]))?(?:L|W)?)*|\\?|\\*|(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?(?:,(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?)*)\\s+(\\?|\\*|(?:[0-6])(?:(?:-|\/|\\,|#)(?:[0-6]))?(?:L)?(?:,(?:[0-6])(?:(?:-|\/|\\,|#)(?:[0-6]))?(?:L)?)*|\\?|\\*|(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?(?:,(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?)*)(|\\s)+(\\?|\\*|(?:|\\d{4})(?:(?:-|\/|\\,)(?:|\\d{4}))?(?:,(?:|\\d{4})(?:(?:-|\/|\\,)(?:|\\d{4}))?)*))$');
                if (!regExp.test(_this.$cronInput.val())) {
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Syntax error in cron expression.');
                    $('.brtc-va-dialogs-schedule-cron-input').focus();
                    return;
                }
            }
        }

        _this.modelDBContents = this.options.editorInput.getContents();

        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                Brightics.VA.Core.Utils.RunnableFactory
                    .createForFlow(_this.versionContents, undefined, undefined, dialogResult.args)
                    .then(function (runnable) {
                        var contents = _.merge(runnable, {duration: dialogResult.duration});
                        _.forIn(contents.models, function (model) {
                            _.forEach(model.functions, function (fnUnit) {
                                Brightics.VA.Core.Utils.ModelUtils.carvePersist(fnUnit, true);
                            });
                        });
                        // get out of here.
                        delete contents.report;
                        var scheduleInfo = {
                            scheduleId: Brightics.VA.Core.Utils.IDGenerator.schedule.id(),
                            scheduleName: _this.$scheduleNameInput.val(),
                            cronExpression: _this.$cronInput.val(),
                            scheduleOwner: Brightics.VA.Env.Session.userId,
                            scheduleType: 'JSON',
                            executeContents: JSON.stringify(contents),
                            fileId: _this.options.editorInput.getLabel(),
                            projectId: _this.projectLabel,
                            isActive: _this.$activeSelector.val(),
                            modifyUser: Brightics.VA.Env.Session.userId,
                            dependencyId: _this.$dependencySelector.val()
                        };

                        var opt = {
                            url: 'api/admin/v2/schedules',
                            type: 'POST',
                            contentType: 'application/json; charset=utf-8',
                            data: JSON.stringify(scheduleInfo),
                            blocking: true
                        };
                        $.ajax(opt).done(function () {
                            Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(_this);
                        }).fail(function (error) {
                            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
                        });
                    });
            }
        };

        if (Brightics.VA.SettingStorage.getValue('editor.variable.visible') === 'true' &&
                _this.modelDBContents.type === 'data' &&
                _this.modelDBContents.hasOwnProperty('variables')) {
            if (Object.keys(_this.modelDBContents.variables).length > 0) {
                new Brightics.VA.Core.Dialogs.RunDataDialog(_this.$parent, {
                    close: closeHandler,
                    analyticsModel: _this.modelDBContents
                });
            } else {
                closeHandler({OK: true});
            }
        } else {
            closeHandler({OK: true});
        }
    };

    AddScheduleDialog.prototype.destroy = function () {
        this.$activeSelector.jqxDropDownList('destroy');
        this.$dependencySelector.jqxDropDownList('destroy');

        Brightics.VA.Dialogs.Dialog.prototype.destroy.call(this);
    };

    Brightics.VA.Core.Dialogs.AddScheduleDialog = AddScheduleDialog;
}).call(this);

/**
 * Created by daewon.park on 2016-09-12.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AddToLibraryDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    AddToLibraryDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    AddToLibraryDialog.prototype.constructor = AddToLibraryDialog;

    AddToLibraryDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 400;
        this.dialogOptions.height = 300;
    };
    
    AddToLibraryDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-add2lib-library-label">Template</div>' +
            '<div class="brtc-va-dialogs-add2lib-library-selector"></div>' +
            '<div class="brtc-va-dialogs-add2lib-library-label">Name</div>' +
            '<input type="text" class="brtc-va-dialogs-add2lib-library-name-input" maxlength="80"/>' +
            '<div class="brtc-va-dialogs-add2lib-library-preview"></div>' +
            '');

        var source = {
            datatype: "json",
            datafields: [
                {name: 'id'},
                {name: 'label'}
            ],
            url: 'api/va/v2/ws/libraries',
            async: true
        };
        var dataAdapter = new $.jqx.dataAdapter(source);
        this.$librarySelector = $parent.find(".brtc-va-dialogs-add2lib-library-selector").jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            source: dataAdapter, selectedIndex: 0,
            displayMember: 'label', valueMember: 'id',
            width: 'calc(100% - 100px)',
            height: '25px'
        });

        this.$nameInput = $parent.find(".brtc-va-dialogs-add2lib-library-name-input").jqxInput({
            theme: Brightics.VA.Env.Theme,
            placeHolder: 'Enter name',
            width: 'calc(100% - 100px)',
            height: '25px'
        });
    };

    AddToLibraryDialog.prototype.setFocus = function () {
        this.$nameInput.focus();
    };

    AddToLibraryDialog.prototype.handleOkClicked = function () {
        var _this = this;
        if (this.$librarySelector.val() && this.$nameInput.val().trim()) {
            this.dialogResult.library = this.$librarySelector.val();
            this.dialogResult.label = this.$nameInput.val().trim();
            Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
        } else {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter template and name.', function () {
                // _this.$mainControl.jqxWindow('focus');
            });
        }
    };

    Brightics.VA.Core.Dialogs.AddToLibraryDialog = AddToLibraryDialog;

}).call(this);
/**
 * hyunseok.oh@samsung.com
 */

/* global _ */

(function () {
    'use strict';

    var Brightics = this.Brightics;
    var Utils = Brightics.VA.Core.Utils;
    var _super = Brightics.VA.Dialogs.Dialog.prototype;

    /**
     * @extends Dialog
     * @param {*} parentId
     * @param {Object} options
     */
    function AddVersionDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    AddVersionDialog.prototype = Object.create(_super);
    AddVersionDialog.prototype.constructor = AddVersionDialog;

    AddVersionDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);
        this.dialogOptions.width = 760;
        this.dialogOptions.height = 480;
        this.dialogOptions.maxHeight = 480;
        this.dialogOptions.title = 'Update Version';

        this.options.resourceManager = Studio.getResourceManager();
        this.options.file = this.options.resourceManager.getFile(this.options.projectId, this.options.fileId);
    };

    AddVersionDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-add-version-contents');
        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Update</div>' +
            '   <div class="brtc-va-dialogs-add-version-radio-group brtc-va-dialogs-row-flex-layout">' +
            '       <div class="brtc-va-dialogs-add-version-major-radio">Major Version (X.o)</div>' +
            '       <div class="brtc-va-dialogs-add-version-minor-radio">Minor Version (o.X)</div>' +
            '   </div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Name</div>' +
            '   <input type="text" class="brtc-va-dialogs-add-version-name-input brtc-style-flex-1" maxlength="80">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Description</div>' +
            '   <div class="brtc-va-dialogs-add-version-description-container" />' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Tags</div>' +
            '   <input type="text" class="brtc-va-dialogs-add-version-tags-input brtc-style-flex-1" maxlength="80">' +
            '</div>' +
            '');

        this.$mainRadiobox = $parent.find('.brtc-va-dialogs-add-version-major-radio');
        this.$subRadiobox = $parent.find('.brtc-va-dialogs-add-version-minor-radio');
        this.createVersionControl(this.$mainRadiobox, this.$subRadiobox);

        this.createNameControl($parent.find('.brtc-va-dialogs-add-version-name-input'));
        this.createTagsControl($parent.find('.brtc-va-dialogs-add-version-tags-input'));
        this.createDescriptionControl($parent.find('.brtc-va-dialogs-add-version-description-container'));
        this.$mainControl.dialog(this.dialogOptions);
        this.$tagsControl.focus();
    };

    AddVersionDialog.prototype.createNameControl = function ($control) {
        this.$nameControl = $control.jqxInput({
            disabled: 'true',
            theme: Brightics.VA.Env.Theme
        });

        this.$nameControl.val(this.options.file.getLabel());
    };

    AddVersionDialog.prototype.createTagsControl = function ($control) {
        this.$tagsControl = $control.jqxInput({
            placeHolder: 'Enter Tags',
            theme: Brightics.VA.Env.Theme
        });

        this.$tagsControl.val(this.options.tags);
    };

    AddVersionDialog.prototype.createDescriptionControl = function ($control) {
        var _this = this;
        var noteOption = {
            focus: false,
            height: 155,
            description: this.options.file.description,
            okButton: this.$okButton,
            maxLength: 2000,
            toolbar: this.options.toolbar
        };

        this.noteControl = Brightics.VA.Core.Widget.Factory.noteControl($control, noteOption);

        this.$mainControl.on('resizing', function (event) {
            _this.noteControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height() - 110);
        });
    };

    AddVersionDialog.prototype.createVersionControl = function ($major, $minor) {
        $major.jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            checked: false,
            groupName: 'update-version'
        });
        $minor.jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            checked: true,
            groupName: 'update-version'
        });
    };

    AddVersionDialog.prototype.handleOkClicked = function () {
        this.debounced = this.debounced || (_.debounce(function () {
            var currentCode = this.noteControl.getCode();
            if (currentCode === '<p><br></p>') currentCode = '';

            var file = Studio.getResourceManager().getFile(this.options.projectId, this.options.fileId);
            var fileName = file.getLabel();

            var version = new Brightics.VA.Vo.Version();
            version.setVersionId(Brightics.VA.Core.Utils.IDGenerator.version.id());
            version.setTags(this.$tagsControl.val());
            version.setLabel(fileName);
            version.setDescription(currentCode);
            version.setIsMajor(this.$mainRadiobox.jqxRadioButton('checked') ? true : false);
            this.options.resourceManager
                .addVersion(this.options.projectId, this.options.fileId, version)
                .then(_super.handleOkClicked.bind(this))
                .catch(this._onError.bind(this));
        }.bind(this), 300));

        this.debounced();
    };

    AddVersionDialog.prototype._onError = function (err) {
        Utils.WidgetUtils.openBadRequestErrorDialog(err);
        this.close();
    };

    Brightics.VA.Core.Dialogs.AddVersionDialog = AddVersionDialog;
}.call(this));

/**
 * Created by daewon.park on 2016-10-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AdvancedLoadSettingDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    AdvancedLoadSettingDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    AdvancedLoadSettingDialog.prototype.constructor = AdvancedLoadSettingDialog;

    AdvancedLoadSettingDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 600;
        this.dialogOptions.height = 500;
    };

    AdvancedLoadSettingDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Array Delimiter</div>' +
            '   <input type="text" class="brtc-va-dialogs-delimiter-input" param="array-delimiter" placeholder="Unicode #2" maxlength="80">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Key Value Delimiter</div>' +
            '   <input type="text" class="brtc-va-dialogs-delimiter-input" param="key-value-delimiter" placeholder="Unicode #3" maxlength="80">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Array Start String</div>' +
            '   <input type="text" class="brtc-va-dialogs-delimiter-input" param="array-start-string" placeholder="[" maxlength="80">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Array End String</div>' +
            '   <input type="text" class="brtc-va-dialogs-delimiter-input" param="array-end-string" placeholder="]" maxlength="80">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Map Start String</div>' +
            '   <input type="text" class="brtc-va-dialogs-delimiter-input" param="map-start-string" placeholder="{" maxlength="80">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Map End String</div>' +
            '   <input type="text" class="brtc-va-dialogs-delimiter-input" param="map-end-string" placeholder="}" maxlength="80">' +
            '</div>' +
            '');

        this.createInputControls($parent.find('.brtc-va-dialogs-delimiter-input'));
        this.fillInputControls($parent.find('.brtc-va-dialogs-delimiter-input'));

    };

    AdvancedLoadSettingDialog.prototype.createInputControls = function ($control) {
        $control.jqxInput({
            theme: Brightics.VA.Env.Theme
        });
    };

    AdvancedLoadSettingDialog.prototype.fillInputControls = function (inputControls) {
        var delimiters = this.options.delimiters;
        var defaultDelimiter = this.options.defaultDelimiter;
        var $inputControl, delimiter, inputValue;

        for (var i = 0; i < inputControls.length; i++) {
            $inputControl = $(inputControls[i]);
            delimiter = $inputControl.attr('param');
            inputValue = (delimiters[delimiter] === defaultDelimiter[delimiter]) ? '' : delimiters[delimiter];
            $inputControl.val(inputValue);
        }

    };

    AdvancedLoadSettingDialog.prototype.handleOkClicked = function () {
        var delimiters = {}, $inputControl;

        var inputControls = this.$mainControl.find('.brtc-va-dialogs-delimiter-input');

        for (var i = 0; i < inputControls.length; i++) {
            $inputControl = $(inputControls[i]);
            delimiters[$inputControl.attr('param')] = $inputControl.val();
        }
        this.dialogResult = {
            OK: true,
            Cancel: false,
            delimiters: delimiters
        };
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.AdvancedLoadSettingDialog = AdvancedLoadSettingDialog;

}).call(this);
/**
 * Created by SDS on 2016-10-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function CheckpointBrowserDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    CheckpointBrowserDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    CheckpointBrowserDialog.prototype.constructor = CheckpointBrowserDialog;

    CheckpointBrowserDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 600;
        this.dialogOptions.height = 250;
    };

    CheckpointBrowserDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout" style="flex-direction: column;">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-checkpoint-group"></div>' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-checkpoint-file"></div>' +
            '</div>');

        this.createCheckpointGroupControl($parent.find('.brtc-va-dialogs-checkpoint-group'));
        this.createCheckpointControl($parent.find('.brtc-va-dialogs-checkpoint-file'));

        this.init();
    };

    CheckpointBrowserDialog.prototype.init = function () {
        this.isRendered = false;

        this.splitedCheckpointPath = this.splitCheckpointFullPath(this.options.checkpointPath);

        this.getCheckPointGroupList();
    };

    CheckpointBrowserDialog.prototype.createCheckpointGroupControl = function ($parent) {
        var _this = this;

        var $checkpointGroupWrapper = $('' +
            '<div class="brtc-va-dialogs-checkpoint-group-wrapper" style="width:100%; margin-top: 10px;">' +
            '   <div class="brtc-va-dialogs-checkpoint-group-label" style="width:120px; float: left; font-weight: bold;">Checkpoint Group</div>' +
            '   <div class="brtc-va-dialogs-checkpoint-group-dropdownlist"></div>' +
            '</div>');

        $parent.append($checkpointGroupWrapper);

        this.$checkpointGroup = $checkpointGroupWrapper.find('.brtc-va-dialogs-checkpoint-group-dropdownlist');

        this.$checkpointGroup.jqxDropDownList({
            placeHolder: 'please choose',
            displayMember: 'name',
            valueMember: 'path',
            theme: Brightics.VA.Env.Theme,
            width: 'calc(100% - 125px)',
            height: '25px',
            openDelay: 0
        });

        _this.$checkpointGroup.on('change', function () {
            var selectedItem = _this.$checkpointGroup.jqxDropDownList('getSelectedItem');
            _this.dialogResult.checkpointPath = '';

            _this.getCheckPointList(selectedItem.label);
        });
    };

    CheckpointBrowserDialog.prototype.createCheckpointControl = function ($parent) {
        var _this = this;

        var $checkpointFileWrapper = $('' +
            '<div class="brtc-va-dialogs-checkpoint-file-wrapper" style="width:100%; margin-top: 10px;">' +
            '   <div class="brtc-va-dialogs-checkpoint-file-label" style="width:120px; float: left; font-weight: bold;">Checkpoint</div>' +
            '   <div class="brtc-va-dialogs-checkpoint-file-dropdownlist"></div>' +
            '</div>');

        $parent.append($checkpointFileWrapper);

        this.$checkpoint = $checkpointFileWrapper.find('.brtc-va-dialogs-checkpoint-file-dropdownlist');

        this.$checkpoint.jqxDropDownList({
            placeHolder: 'please choose',
            displayMember: 'name',
            valueMember: 'path',
            theme: Brightics.VA.Env.Theme,
            width: 'calc(100% - 125px)',
            height: '25px',
            openDelay: 0
        });

        _this.$checkpoint.on('change', function () {
            _this.dialogResult.checkpointPath = $(this).val();
        });
    };

    CheckpointBrowserDialog.prototype.getCheckPointGroupList = function (callback) {
        var _this = this;

        var userId = Brightics.VA.Env.Session.userId;
        var url = 'api/va/v2/dl/browse?path=/checkpoint/' + userId ;
        var opt = {
            url: url,
            type: 'GET',
            blocking: true,
            contentType: 'application/json; charset=utf-8'
        };
        $.ajax(opt).done(function(checkpointGroupData){
            var prefix = _this.splitedCheckpointPath.prefix,
                splitKey = _this.splitedCheckpointPath.splitKey,
                checkpointGroup = _this.splitedCheckpointPath.checkpointGroup;

            _this.$checkpointGroup.jqxDropDownList({source: checkpointGroupData});
            if (!_this.isRendered) _this.$checkpointGroup.val(prefix + splitKey + checkpointGroup);
        });
};

    CheckpointBrowserDialog.prototype.getCheckPointList = function (dirName) {
        var _this = this;

        var userId = Brightics.VA.Env.Session.userId;
        var url = 'api/va/v2/dl/browse?path=/checkpoint/' + userId  + '/' + dirName;
        var opt = {
            url: url,
            type: 'GET',
            blocking: false,
            contentType: 'application/json; charset=utf-8'
        };

        $.ajax(opt).done(function(data){
            _this.$checkpoint.jqxDropDownList('clear');
            _this.$checkpoint.jqxDropDownList({source: data});

            if (!_this.isRendered) {
                var prefix = _this.splitedCheckpointPath.prefix,
                    splitKey = _this.splitedCheckpointPath.splitKey,
                    checkpointGroup = _this.splitedCheckpointPath.checkpointGroup,
                    checkpoint = _this.splitedCheckpointPath.checkpoint;

                _this.$checkpoint.val(prefix + splitKey + checkpointGroup + '/' + checkpoint);

                _this.isRendered = true;
            }
        })
    };

    CheckpointBrowserDialog.prototype.splitCheckpointFullPath = function (fullPath) {
        var userId = Brightics.VA.Env.Session.userId,
            splitKey = userId + '/';

        var prefix = '', checkpointPathArr = [];

        if (fullPath) {
            var fullPathArr = fullPath.split(userId + '/');
            prefix = fullPathArr[0];
            checkpointPathArr = (fullPathArr[1]).split('/');
        }

        return {
            prefix: prefix,
            splitKey: splitKey,
            checkpointGroup: checkpointPathArr[0],
            checkpoint: checkpointPathArr[1]
        };
    };

    Brightics.VA.Core.Dialogs.CheckpointBrowserDialog = CheckpointBrowserDialog;

}).call(this);
/**
 * Created by jhoon80.park on 2016-04-06.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ClipboardDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    ClipboardDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    ClipboardDialog.prototype.constructor = ClipboardDialog;

    ClipboardDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-main-clipboard">' +
            '   <div class="brtc-va-dialogs-body">' +
            '   </div>' +
            '</div>');

        this.$mainControl.dialog(this.dialogOptions);
        this.$mainControl.parent().draggable("option", "containment", this.$mainControl.closest('.brtc-va-editor'));
    };

    ClipboardDialog.prototype._initOptions = function () {
        this.dialogOptions = {
            title: 'Function Clipboard',
            appendTo: this.$parent,
            position: {
                my: "left top",
                at: "left bottom",
                of: this.$parent.find('.brtc-style-s-editor-toolitem[item-type=clipboard]')
            },
            width: 400,
            height: 600,
            maxWidth: 400,
            maxHeight: 600,
            modal: false,
            resizable: false
        };
        this.destroyOnClose = true;
    };

    ClipboardDialog.prototype.initContents = function () {
        var $parent = this.$mainControl.find('.brtc-va-dialogs-body');
        this.$clipboardList = $('<div class="brtc-va-dialogs-body-clipboardlist brtc-style-full brtc-style-relative"></div>');
        $parent.append(this.$clipboardList);

        this.clipboardExplorer = new Brightics.VA.Core.Views.ClipboardExplorer(this.$clipboardList, {
            height: '100%',
            modelType: Brightics.VA.Implementation.DataFlow.Clazz,
            functionList: $.extend(true, [], this.options.functionList)
        });
        this.$clipboardList.perfectScrollbar();
    };

    ClipboardDialog.prototype.updateFunctionList = function (functionList) {
        this.clipboardExplorer.updateFunctionList(functionList);
        this.$clipboardList.perfectScrollbar('update');
    };
    ClipboardDialog.prototype.setEnable = function (enabled) {
        var $disableDim = this.$mainControl.find('.brtc-va-dialogs-body-disable');
        if (enabled === true && $disableDim.length > 0) {
            $disableDim.remove()
        } else if (enabled !== true && $disableDim.length === 0) {
            this.$mainControl.append('<div class="brtc-va-dialogs-body-disable"></div>')
        }
    };

    ClipboardDialog.prototype.isAlive = function () {
        return !!this.$mainControl;
    }

    Brightics.VA.Core.Dialogs.ClipboardDialog = ClipboardDialog;

}).call(this);
/* -----------------------------------------------------
 *  color-picker-dialog.js
 *  Created by hyunseok.oh@samsung.com on 2018-09-05.
 * ---------------------------------------------------- */

(function (root) {
    'use strict';
    var Brightics = root.Brightics;

    function ColorPickerDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
        var self = this;
        this._close = function (event) {
            if (event.target.classList.contains('ui-widget-overlay')) {
                self.close();
            }
        };
        $(window).on('mousedown', this._close);
        this.dialogResult.color = options.color;

        if (this.options.onClose) {
            this.options.close = (function (fn) {
                return function (dialogResult) {
                    if (dialogResult.color) fn(dialogResult.color);
                };
            }(this.options.onClose));
        }
    }

    ColorPickerDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    ColorPickerDialog.prototype.constructor = ColorPickerDialog;

    ColorPickerDialog.prototype.createDialogContentsArea = function ($parent) {
        this.$colorPicker = this.createColorPicker($parent);
    };

    ColorPickerDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);
        this.dialogOptions.height = 'auto';
        this.dialogOptions.width = 'auto';
        this.dialogOptions.title = 'Color Picker';
    };

    ColorPickerDialog.prototype.createColorPicker = function ($parent) {
        var self = this;
        var $el = $('<div></div>');

        $el.jqxColorPicker({
            height: 230,
            width: 275,
            colorMode: 'hue'
        });
        $el.jqxColorPicker('setColor', this.options.color);
        $parent.append($el);


        var toHex = function (v) {
            return v >= 10 ? String.fromCharCode((v - 10) + 'A'.charCodeAt(0)) : v.toString();
        };

        var hexColors = function (colors) {
            return '#' + ['r', 'g', 'b'].map(function (key) {
                var n = parseInt(colors[key], 10);
                return [parseInt(n / 16, 10), n % 16].map(toHex).join('');
            }).join('');
        };

        $el.bind('colorchange', function (e) {
            self.dialogResult.color = hexColors(e.args.color);
        });
        return $el;
    };

    ColorPickerDialog.prototype.createDialogButtonBar = function ($parent) {
        var self = this;
        this.$resetButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Reset" />');
        $parent.append(this.$resetButton);
        this.$resetButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$resetButton.click(function () {
            self.dialogResult.color = self.options.color;
            self.$colorPicker.jqxColorPicker('setColor', self.options.color);
        });
    };

    ColorPickerDialog.prototype.destroy = function () {
        Brightics.VA.Dialogs.Dialog.prototype.destroy.call(this);
        $(window).off('mousedown', this._close);
    };

    Brightics.VA.Dialogs.ColorPickerDialog = ColorPickerDialog;
/* eslint-disable no-invalid-this */
}(this));

/**
 * Created by daewon.park on 2016-10-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ConfirmWithOptionDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    ConfirmWithOptionDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    ConfirmWithOptionDialog.prototype.constructor = ConfirmWithOptionDialog;

    ConfirmWithOptionDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 450;
        this.dialogOptions.height = 250;
    };

    ConfirmWithOptionDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '    <span class="brtc-va-dialogs-body-content-icon"></span>' +
            '    <div class="brtc-va-dialogs-body-content-content-text"><span>' + _.escape(this.options.contentText) + '</span></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-option">' + _.escape(this.options.optionText) + '</div>' +
            '</div>' +
            '');

        this.createOptionControl($parent.find('.brtc-va-dialogs-contents-option'));
    };

    ConfirmWithOptionDialog.prototype.createOptionControl = function ($control) {
        this.$includeControl = $control.jqxCheckBox({
            theme: "office",
            height: 25,
            checked: true,
            boxSize: "17px"
        });
    };

    ConfirmWithOptionDialog.prototype.handleOkClicked = function () {
        this.dialogResult.OPTION = this.$includeControl.jqxCheckBox('val');
        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    Brightics.VA.Core.Dialogs.ConfirmWithOptionDialog = ConfirmWithOptionDialog;

}).call(this);
/* -----------------------------------------------------
 *  datasource-management-dialog.js
 *  Created by hyunseok.oh@samsung.com on 2018-10-16.
 * ---------------------------------------------------- */


/* global _ */
(function (root) {
    var Brightics = root.Brightics;
    function DatasourceManagementDialog(parentId, _options) {
        var options = _.extend({
            title: 'Datasource Management'
        }, _options);
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    DatasourceManagementDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    DatasourceManagementDialog.prototype.constructor = DatasourceManagementDialog;

    DatasourceManagementDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 800;
        this.dialogOptions.height = 600;
    };

    DatasourceManagementDialog.prototype.createDialogContentsArea = function ($parent) {
        this.datasourceManagementView = new Brightics.VA.Core.Views.DatasourceManagementView(
            $parent
        );

        return this.datasourceManagementView.getElement();
    };

    DatasourceManagementDialog.prototype.createDialogButtonBar = function ($parent) {
        Brightics.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this, $parent);
        this.$cancelButton.hide();
        this.$okButton.val('Close');
    };

    DatasourceManagementDialog.prototype.destroy = function (...args) {
        Brightics.VA.Dialogs.Dialog.prototype.destroy.call(this, ...args);
        if (this.datasourceManagementView) {
            this.datasourceManagementView.destroy();
            this.datasourceManagementView = null;
        }
    };

    Brightics.VA.Core.Dialogs.DatasourceManagementDialog = DatasourceManagementDialog;
/* eslint-disable no-invalid-this */
}(this));

/**
 * Created by SDS on 2016-08-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DBReaderSqlEditorDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.ScriptEditorDialog.call(this, parentId, options);
    }

    DBReaderSqlEditorDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.ScriptEditorDialog.prototype);
    DBReaderSqlEditorDialog.prototype.constructor = DBReaderSqlEditorDialog;

    DBReaderSqlEditorDialog.prototype.renderInfoArea = function () {

    };

    DBReaderSqlEditorDialog.prototype.setEditorStatement = function (statement) {
        this.codeMirror.setValue(statement);
        this.codeMirror.clearHistory();
        this.selectMarker = this.codeMirror.markText({line: 0, ch: 0}, {line: 0, ch: 7}, {
            readOnly: true,
            inclusiveLeft: true,
            atomic: true
        });
    };

    Brightics.VA.Core.Dialogs.DBReaderSqlEditorDialog = DBReaderSqlEditorDialog;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var SUMMER_NOTE_TOOLBAR = [
        ['style', ['bold', 'italic', 'underline', 'clear']],
        ['fontsize', ['fontsize']],
        ['color', ['color']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['table', ['table']],
        ['height', ['height']]
    ];

    function DeployModelDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);

        this.selectedVersion = '';
    }

    DeployModelDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    DeployModelDialog.prototype.constructor = DeployModelDialog;

    DeployModelDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 760;
        this.dialogOptions.height = 480; // 520
    };
    
    DeployModelDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-editresourcedialog-contents');

        $parent.append('' +
            '           <div class="brtc-va-dialogs-row-flex-layout">' +
            '             <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold" style="margin-right: 11px;">Target</div>' +
            '                   <div class="brtc-va-editors-sheet-controls-propertycontrol-input" maxlength="80"></div>' +
            '           </div>' +
            // '           <div class="brtc-va-dialogs-row-flex-layout">' +
            // '               <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Version</div>' +
            // '                   <input readonly type="text" class="brtc-va-dialogs-version-input" maxlength="40"/>' +
            // '                   <input type="button" value="Select Version" class="brtc-va-dialogs-select-verion-button" maxlength="40"/></div>' +
            '           <div class="brtc-va-dialogs-row-flex-layout">' +
            '               <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Name</div>' +
            '                   <input type="text" class="brtc-va-dialogs-editresourcedialog-name-input" maxlength="40"/></div>' +
            '           <div class="brtc-va-dialogs-row-flex-layout">' +
            '               <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Description</div>' +
            '               <div class="brtc-va-dialogs-editresourcedialog-description-container"></div>' +
            '           </div>' +
            '</div>');

        this.createTargetControl($parent.find('.brtc-va-editors-sheet-controls-propertycontrol-input'));
        // this.createSelectVersionControl($parent.find('.brtc-va-dialogs-version-input'),
        //     $parent.find('.brtc-va-dialogs-select-verion-button'));
        this.createNameControl($parent.find('.brtc-va-dialogs-editresourcedialog-name-input'));
        this.createDescriptionControl($parent.find('.brtc-va-dialogs-editresourcedialog-description-container'));
        this.$serverControl.focus();
    };

    DeployModelDialog.prototype.createTargetControl = function ($control) {
        var source =
        {
            datatype: 'json',
            datafields: [
                {name: 'datasourceName'},
                {name: 'datasourceType'}
            ],
            url: 'api/va/v2/ws/deploy/target',
            async: true
        };

        var dataAdapter = new $.jqx.dataAdapter(source);
        dataAdapter.dataBind(source);

        // Target ID setting
        this.$serverControl = $control.jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            width: '91%',
            placeHolder: 'Choose Target Server',
            selectedIndex: 2,
            source: dataAdapter,
            displayMember: 'datasourceName'
        });
    };

    DeployModelDialog.prototype.createSelectVersionControl = function ($input, $button) {
        this.$versionInput = $input.jqxInput({
            theme: Brightics.VA.Env.Theme,
            placeHolder: 'Select version'
        });
        this.$versionButton = $button.jqxButton({ theme: Brightics.VA.Env.Theme });

        var onSelectVersion = function (data) {
            this.$versionInput.val(data.getMajorVersion() + '.' + data.getMinorVersion());
            this.selectedVersion = data.getVersionId();
        }.bind(this);

        var openSelectVersionDialog = function () {
            var emitter = new Brightics.VA.EventEmitter();
            emitter.on('select', onSelectVersion);
            new Brightics.VA.Core.Dialogs.SelectVersionDialog(this.$mainControl, {
                projectId: this.options.projectId,
                fileId: this.options.fileId,
                emitter: emitter
            });
        }.bind(this);

        this.$versionButton.on('click', openSelectVersionDialog);
    };

    DeployModelDialog.prototype.createNameControl = function ($control) {
        this.$nameControl = $control.jqxInput({
            placeHolder: 'Enter name',
            theme: Brightics.VA.Env.Theme
        });
    };

    DeployModelDialog.prototype.createDescriptionControl = function ($control) {
        var _this = this;
        var noteOption = {
            focus: false,
            height: 188,
            okButton: this.$okButton,
            maxLength: 2000,
            toolbar: this.options.toolbar,
            callbacks: {
                onFocus: function () {
                    if(_this.$serverControl.jqxDropDownList('isOpened')) _this.$serverControl.jqxDropDownList('close');
                }
            }
        };

        this.noteControl = Brightics.VA.Core.Widget.Factory.noteControl($control, noteOption);

        this.$mainControl.on('resizing', function (event) {
            _this.noteControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height() - 110);
        });
    };

    DeployModelDialog.prototype.handleOkClicked = function () {
        if (this.$serverControl.val() == 'Choose Target Server') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please choose target server.');
            return;
        }

        if (this.$nameControl.val().trim() === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter name.');
            return;
        }

        // if (this.selectedVersion === '') {
        //     Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please select version.');
        //     return;
        // }

        this.dialogResult.server = this.$serverControl.val();
        this.dialogResult.name = this.$nameControl.val().trim();
        this.dialogResult.description = this.noteControl.getCode();
        // this.dialogResult.versionId = this.selectedVersion;

        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    Brightics.VA.Core.Dialogs.DeployModelDialog = DeployModelDialog;
}.call(this));

/**
 * Created by sungjin1.kim on 2017-11-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DetailDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    DetailDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    DetailDialog.prototype.constructor = DetailDialog;

    DetailDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 680;
        this.dialogOptions.height = 540;
        this.dialogOptions.keyboardCloseKey = '';
        this.dialogOptions.closeOnEscape = false;
    };

    DetailDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<textarea class="brtc-va-dialogs-launch-progress-logs" style="display: none"></textarea>'
        );
        this.detailText = CodeMirror.fromTextArea($parent.find('.brtc-va-dialogs-launch-progress-logs')[0], {
            mode: 'text/html',
            theme: 'default',
            lineNumbers: false,
            matchBrackets: true,
            autofocus: true,
            readOnly: true
        });
        this.detailText.setSize('100%', '100%');
        this.detailText.setValue(this.options.detailText);
        this.detailText.focus();

        $parent.css('height', 'calc(100% - 10px)');
    };

    DetailDialog.prototype.createDialogButtonBar = function ($parent) {
        $parent.hide();
    };

    Brightics.VA.Core.Dialogs.DetailDialog = DetailDialog;

}).call(this);
/**
 * Created by SDS on 2017-05-31.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function DetailScheduleDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    DetailScheduleDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    DetailScheduleDialog.prototype.constructor = DetailScheduleDialog;

    DetailScheduleDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 685;
        this.dialogOptions.height = 435;
    };

    DetailScheduleDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        var schedule = _this.options.schedule;
        $parent.append('' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Schedule Name</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-name-input" valid-type="type1" maxlength="80"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Cron Expression</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-cron-input" valid-type="type1" maxlength="80"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Schedule Owner</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-owner-input" valid-type="type1" maxlength="80"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Is Active</div>' +
            '   <div class="brtc-va-dialogs-schedule-active-selector"></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Dependency Schedule</div>' +
            '   <div class="brtc-va-dialogs-schedule-dependency-selector"></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row brtc-style-margin-top-5">' +
            '   <div class="brtc-va-dialogs-schedule-label">Model Version</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-model-version-input" />' +
            '</div>' +
            '');

        this.$scheduleNameInput = $parent.find(".brtc-va-dialogs-schedule-name-input").jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
        this.$scheduleNameInput.val(schedule.scheduleName);

        this.$cronInput = $parent.find(".brtc-va-dialogs-schedule-cron-input").jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
        this.$cronInput.val(schedule.cronExpression);

        this.$scheduleOwnerInput = $parent.find(".brtc-va-dialogs-schedule-owner-input").jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
        this.$scheduleOwnerInput.val(schedule.scheduleOwner);

        this.$activeSelector = $parent.find(".brtc-va-dialogs-schedule-active-selector").jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            source: ['Y', 'N'],
            disabled: true
        });
        this.$activeSelector.val(schedule.isActive);

        this.$dependencySelector = $parent.find(".brtc-va-dialogs-schedule-dependency-selector").jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            displayMember: 'scheduleName',
            valueMember: 'scheduleId',
            dropDownHeight: 300,
            disabled: true
        });

        this.$modelVersionInput = $parent.find(".brtc-va-dialogs-schedule-model-version-input").jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true,
            placeHolder: 'Select version'
        });

        var getDependencies = function (resolve, reject) {
            var option = {
                url: 'api/admin/v2/schedules',
                type: 'GET',
                contentType: 'application/json; charset=utf-8'
            };
            $.ajax(option).done(function (data) {
                $.each(data, function (idx, schedule) {
                    data[idx].scheduleId = Utils.WidgetUtils.convertHTMLSpecialChar(schedule.scheduleId);
                });

                _this.$dependencySelector.jqxDropDownList({
                    source: data
                });

                _this.$dependencySelector.jqxDropDownList('insertAt', '', 0);

                _this.$dependencySelector.val(schedule.dependencyId);
                resolve();
            }).fail(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                reject(err);
            });
        };

        var getModelVersions = Studio.getResourceManager().fetchVersions(
            this.options.editorInput.getProjectId(),
            this.options.editorInput.getFileId())
            .then(function (versions) {
                var versionText = '';
                var versionId = _this.getVersionInfo(JSON.parse(schedule.executeContents)).id;

                _.forEach(versions, function (version) {
                    if (versionId === version.getVersionId()) {
                        versionText = version.getVersion();
                    }
                });
                _this.$modelVersionInput.val(versionText);
                return true;
            });

        var promises = [];

        promises.push(new Promise(getDependencies));
        promises.push(getModelVersions);

        Promise.all(promises).catch(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(error);
        }).then(function () {
        });
    };

    DetailScheduleDialog.prototype.getVersionInfo = function (executeContents) {
        var models = executeContents.models;
        var versionId;

        for (var mid in models) {
            versionId = models[mid].version_id;
        }

        return {
            name: '',
            id: versionId
        };
    };

    DetailScheduleDialog.prototype.createDialogButtonBar = function ($parent) {
        this.$editButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-ok" value="Edit" />');
        $parent.append(this.$editButton);
        this.$editButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$editButton.click(this.handleEditClicked.bind(this));

        this.$deleteButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-delete" value="Delete" />');
        $parent.append(this.$deleteButton);
        this.$deleteButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$deleteButton.click(this.handleDeleteClicked.bind(this));

        this.$cancelButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />');
        $parent.append(this.$cancelButton);
        this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$cancelButton.click(this.handleCancelClicked.bind(this));
    };

    DetailScheduleDialog.prototype.handleEditClicked = function () {
        var _this = this;

        new Brightics.VA.Core.Dialogs.EditScheduleDialog(_this.$parent, {
            editorInput: _this.options.editorInput,
            schedule: _this.options.schedule,
            close: function (result) {
                if (result.OK) {
                    Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(_this);
                }
            },
            title: 'Edit Schedule'
        });
    };

    DetailScheduleDialog.prototype.refreshScheduleData = function () {
        var _this = this;

        $.ajax({
            url: 'api/admin/v2/schedules/' + _this.options.schedule.scheduleId,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            blocking: true
        }).done(function (data) {
            if (data.length > 0) {
                _this.$scheduleNameInput.val(data[0].scheduleName);
                _this.$cronInput.val(data[0].cronExpression);
                _this.$scheduleOwnerInput.val(data[0].scheduleOwner);
                _this.$activeSelector.val(data[0].isActive);

                _this.options.schedule = data[0];
            }
        }).fail(function (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        });
    };

    DetailScheduleDialog.prototype.handleDeleteClicked = function () {
        var _this = this;

        _this.createDeleteConfirmDialog();
    };

    DetailScheduleDialog.prototype.createDeleteConfirmDialog = function () {
        var _this = this;
        var schedule = _this.options.schedule;

        var closeHandler = function (dialogResult) {
            if (dialogResult.OK) {
                $.ajax({
                    url: 'api/admin/v2/schedules/' + schedule.scheduleId + '/delete',
                    type: 'POST',
                    data: JSON.stringify(schedule),
                    contentType: 'application/json; charset=utf-8',
                    blocking: true
                }).done(function () {
                    Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Schedule(s) ( ' + schedule.scheduleName + ' ) has been deleted.', function () {
                        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(_this);
                    });
                }).fail(function (err) {
                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                });
            }
        };

        Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog('Selected item(s) will be permanently deleted and cannot be recovered. Are you sure?', closeHandler);
    };

    Brightics.VA.Core.Dialogs.DetailScheduleDialog = DetailScheduleDialog;

}).call(this);
/**
 * hyunseok.oh@samsung.com
 * 2017-12-20
 */

/**
 * 의존모듈: jQuery, Dialog
 */

/* global _ */

(function () {
    'use strict';

    var Brightics = this.Brightics;
    var _super = Brightics.VA.Dialogs.Dialog.prototype;

    /**
     * @extends Dialog
     * @param {*} parentId
     * @param {Object} options
     */
    function DetailVersionDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    DetailVersionDialog.prototype = Object.create(_super);
    DetailVersionDialog.prototype.constructor = DetailVersionDialog;

    DetailVersionDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);
        this.dialogOptions.width = 760;
        this.dialogOptions.height = 440;
        this.dialogOptions.maxHeight = 440;
        this.dialogOptions.title = 'Version Detail';
    };

    DetailVersionDialog.prototype.createDialogContentsArea = function ($parent) {
        var html = [
            '<div class="brtc-va-dialogs-version-datail-contents">',
            '  <div class="brtc-va-dialogs-version-detail">',
            '  </div>',
            '</div>'
        ].join('\n');

        this.$self = $(html);
        $parent.append(this.$self);
        this.$detailBody = this.$self.find('.brtc-va-dialogs-version-detail');
        this.modelVersionDetail = new Brightics.VA.Core.Components.ModelVersionDetail({
            $el: this.$detailBody
        });

        this._refreshDetail();
        this.$mainControl.dialog(this.dialogOptions);
    };

    DetailVersionDialog.prototype.createDialogButtonBar = function ($parent) {
        _super.createDialogButtonBar.call(this, $parent);
        this.$okButton.val('Edit');
    };

    DetailVersionDialog.prototype.handleEditClicked = function () {
        this.openEditVersionDialog();
    };

    DetailVersionDialog.prototype.handleOkClicked = function () {
        this.handleEditClicked();
    };

    DetailVersionDialog.prototype._refreshDetail = function () {
        var updateModelVersionDetail = function (data) {
            this.modelVersionDetail.update(data);
        }.bind(this);

        Studio.getResourceManager().fetchVersion(
            this.options.projectId,
            this.options.fileId,
            this.options.versionId)
            .then(updateModelVersionDetail)
            .catch(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                this.$mainControl.dialog('close');
            }.bind(this));
    };

    DetailVersionDialog.prototype.openEditVersionDialog = function () {
        var onClose = function (result) {
            if (result.OK) this.dialogResult.edited = true;
        }.bind(this);

        new Brightics.VA.Core.Dialogs.EditVersionDialog(this.$mainControl, {
            projectId: this.options.projectId,
            fileId: this.options.fileId,
            versionId: this.options.versionId,
            onEditCallback: this._refreshDetail.bind(this),
            close: onClose
        });
    };

    Brightics.VA.Core.Dialogs.DetailVersionDialog = DetailVersionDialog;
    /* eslint-disable no-invalid-this */
}.call(this));

/**
 * Created by sds on 2018-10-26.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**************************************************************************
     *                                 FnUnit
     *************************************************************************/
    Brightics.VA.Core.Functions.Library.DialogPanelProperties = {};

}).call(this);
/**************************************************************************
 *                           Properties Panel
 *************************************************************************/
/**
 * Created by sds on 2018-02-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype;

    /**
     * @extends PropertiesPanel
     * @param parentId
     * @param options
     * @constructor
     */
    function DialogPanelProperties(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    DialogPanelProperties.prototype = Object.create(_super);
    DialogPanelProperties.prototype.constructor = DialogPanelProperties;

    DialogPanelProperties.prototype.createControls = function () {
        this.columnControlList = [];
        this.problemFactory = new Brightics.VA.Core.Validator.ProblemFactory();

        this.$mainControl = $('<div class="brtc-va-editors-sheet-panels-basepanel"/>');
        this.$parent.append(this.$mainControl);

        this.createContentsArea();

        this.$mainControl.addClass('dialog-properties');
        this.$contentsArea.addClass('dialog-properties');
    };

    DialogPanelProperties.prototype.createContentsAreaControls = function ($parent) {
    };

    DialogPanelProperties.prototype.fillControlValues = function () {
        this.options.fillControlValues();
    };

    DialogPanelProperties.prototype.getColumnData = function (controls) {
        return this.columnData;
    };

    DialogPanelProperties.prototype.registerColumnControl = function (controls) {
        this.columnControlList.push(controls);
    };

    DialogPanelProperties.prototype.renderValues = function () {
        this.options.renderValues();
    };

    DialogPanelProperties.prototype._initializePerfectScroll = function () {
        this.$contentsArea.perfectScrollbar();
    };

    DialogPanelProperties.prototype._updatePerfectScroll = function () {
        this.$contentsArea.perfectScrollbar('update');
    };

    DialogPanelProperties.prototype.renderProperties = function () {
    };



    DialogPanelProperties.prototype._renderDefaultControl = function (paramNm) {
        var _this = this;
        var controlSpec = this.options.controlSpec[paramNm];
        if (controlSpec && controlSpec.params) {
            controlSpec.params.forEach(function (propSpecObj) {
                _this._renderOptControl(_this.controls[paramNm][propSpecObj.attr]);
            });
        }
    };


    DialogPanelProperties.prototype._renderObjectArrayControl = function (paramNm) {
        var _this = this;
        var controlSpec = this.options.controlSpec[paramNm];
        if (controlSpec && controlSpec.params) {
            _this._renderOptControl(_this.controls[paramNm]);
        }
    };

    DialogPanelProperties.prototype._renderOptControl = function (target) {
        if (target) {
            target.renderControl();
        }
    };


    DialogPanelProperties.prototype.getParams = function () {
        var resultParam = {};

    };



    Brightics.VA.Core.Functions.Library.DialogPanelProperties.propertiesPanel = DialogPanelProperties;

}).call(this);
/**************************************************************************
 *                               Validator
 *************************************************************************/
/**
 * Created by sds on 2018-02-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DialogPanelValidator() {
        Brightics.VA.Core.Validator.SingleInputValidator.call(this);
    }

    DialogPanelValidator.prototype = Object.create(Brightics.VA.Core.Validator.SingleInputValidator.prototype);
    DialogPanelValidator.prototype.constructor = DialogPanelValidator;

    Brightics.VA.Core.Functions.Library.DialogPanelProperties.validator = DialogPanelValidator;

}).call(this);
/**
 * Created by daewon.park on 2016-10-27.
 */

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DuplicateModelDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    DuplicateModelDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    DuplicateModelDialog.prototype.constructor = DuplicateModelDialog;

    DuplicateModelDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 600;
        this.dialogOptions.height = 300;
    };

    DuplicateModelDialog.prototype.createDialogContentsArea = function ($parent) {
        var includeDataFlowMessage = 'Include the data flow(s) that belongs to the ';
        includeDataFlowMessage = includeDataFlowMessage +  (this.options.files[0].type === 'control' ? 'control flow.' : 'report.');
        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-duplicate-model-newname-label">New name</div>' +
            '   <input type="text" class="brtc-va-dialogs-duplicate-model-newname-input" maxlength="80">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-duplicate-model-targetproject-label">To project</div>' +
            '   <div class="brtc-va-dialogs-duplicate-model-targetproject-input"></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-duplicate-model-include-dataflow">' + includeDataFlowMessage + '</div>' +
            '</div>' +
            '');

        this.createNewNameControl($parent.find('.brtc-va-dialogs-duplicate-model-newname-input'));
        this.createTargetProjectControl($parent.find('.brtc-va-dialogs-duplicate-model-targetproject-input'));
        this.createOptionControl($parent.find('.brtc-va-dialogs-duplicate-model-include-dataflow'));
        this.$nameControl.focus();
    };

    DuplicateModelDialog.prototype.createOptionControl = function ($control) {
        this.$includeControl = $control.jqxCheckBox({
            theme: "office",
            height: 25,
            checked: true,
            boxSize: "17px"
        });
        if (this.options.files[0].type !== 'control' && this.options.files[0].type !== 'visual') {
            this.$includeControl.css('display', 'none');
        }
    };

    DuplicateModelDialog.prototype.createNewNameControl = function ($control) {
        this.$nameControl = $control.jqxInput({
            placeHolder: 'Enter name',
            theme: Brightics.VA.Env.Theme
        });
        if (this.options.files[0]) {
            this.$nameControl.val(this.options.files[0].getLabel() + '_copy');
        }
    };

    DuplicateModelDialog.prototype.createTargetProjectControl = function ($control) {
        var _this = this;

        var source = {
            datatype: 'json',
            datafields: [
                {name: 'id'},
                {name: 'label'}
            ],
            url: 'api/va/v2/ws/projects',
            async: true
        };
        var dataAdapter = new $.jqx.dataAdapter(source, {
            beforeLoadComplete: function (records) {
                for (var r in records) {
                    records[r].originLabel = records[r].label;
                    records[r].label = Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(records[r].label);
                }
            }
        });
        this.$targetProjectControl = $control.jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            placeHolder: 'Choose Project',
            source: dataAdapter,
            displayMember: 'label',
            valueMember: 'id',
            itemHeight: 30,
            dropDownWidth: 418
        });

        this.$targetProjectControl.on('bindingComplete', function () {
            if (_this.options.files[0]) {
                var $item = $control.jqxDropDownList('getItemByValue', _this.options.files[0].getProjectId());
                $control.jqxDropDownList('selectItem', $item);
            }
            var items = $control.jqxDropDownList('getItems');
            if (items.length > 4) {
                $control.jqxDropDownList('autoDropDownHeight', false);
                $control.jqxDropDownList('dropDownHeight', 120);
            }
        }).on('select', function (event) {
            var args = event.args;
            if (args && args.item) {
                $control.attr('title', args.item.originalItem.originLabel);
            }
        });


    };

    DuplicateModelDialog.prototype.searchDataFlowFile = function (projectId, functions, flowList) {
        var _this = this;

        for (var i in functions) {
            if (functions[i].param.functions) {
                _this.searchDataFlowFile(projectId, functions[i].param.functions, flowList);
            }

            var isDuplicateFlag = false;
            if (functions[i][FUNCTION_NAME] === 'DataFlow') {
                for (var j in flowList) {
                    if (functions[i].param.mid === flowList[j].mid) {
                        isDuplicateFlag = true;
                    }
                }
                if (!isDuplicateFlag) {
                    var dataFlowFile = Studio.getResourceManager().getFile(projectId, functions[i].param.mid);

                    if (dataFlowFile == undefined) {
                        return '"' + functions[i].display.label + '" dataflow was deleted or format is invalid in selected controlflow';
                    } else {
                        flowList.push(dataFlowFile.contents);
                    }
                }
            }
        }
    };

    DuplicateModelDialog.prototype.changeModelId = function (modelInfo, functions) {
        for (var i in functions) {
            if (functions[i].param.functions) {
                this.changeModelId(modelInfo, functions[i].param.functions);
            }

            if (modelInfo.oldMid === functions[i].param.mid) {
                functions[i].param.mid = modelInfo.newMid;
            }
        }
    };

    DuplicateModelDialog.prototype.handleOkClicked = function () {
        var _this = this;
        var newName = this.$nameControl.val().trim();
        if (newName.length > 80) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('"New Name" should be 80 characters or less.', function () {
                // _this.$mainControl.dialog('focus');
            });
            return false;
        } else if (!newName) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('"New Name" should not be empty or blank.', function () {
                // _this.$mainControl.dialog('focus');
            });
            return false;
        }

        if (this.options.files[0].type === 'control' && this.$includeControl.jqxCheckBox('checked')) {
            var flowList = [];
            var errorMessage = this.searchDataFlowFile(this.options.files[0].project_id, this.options.files[0].contents.functions, flowList);

            if (errorMessage) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(errorMessage, function () {
                });
                return false;
            }
        }

        var sourceProjectId = this.options.files[0].getProjectId();
        var targetProjectId = this.$targetProjectControl.val();
        var file = this.options.files[0];

        var doneCallback = function () {
            this.dialogResult.projectId = sourceProjectId;
            Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
        }.bind(this);

        var errCallback = function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        };

        var rs = Studio.getResourceService();
        rs.duplicateFile(file.getFileId(),
                sourceProjectId,
                targetProjectId,
                true,
                file.getLabel(),
                newName)
            .then(doneCallback)
            .catch(errCallback);
    };

    Brightics.VA.Core.Dialogs.DuplicateModelDialog = DuplicateModelDialog;
}).call(this);

/**
 * Created by daewon.park on 2016-11-08.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function EditDataSourceAliasDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    EditDataSourceAliasDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    EditDataSourceAliasDialog.prototype.constructor = EditDataSourceAliasDialog;

    EditDataSourceAliasDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 648;
        this.dialogOptions.height = 248;
    };

    EditDataSourceAliasDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-rename-name-label">Data Source Label: </div>' +
            '   <input type="text" class="brtc-va-dialogs-rename-name-input" maxlength="80">' +
            '</div>');

        this.createNameControl($parent.find('.brtc-va-dialogs-rename-name-input'));
    };

    EditDataSourceAliasDialog.prototype.createNameControl = function ($control) {
        this.$nameControl = $control.jqxInput({
            placeHolder: 'Enter a data source label.',
            theme: Brightics.VA.Env.Theme
        });
        if (this.options.name) {
            this.$nameControl.val(this.options.name);
        }
    };

    EditDataSourceAliasDialog.prototype.handleOkClicked = function () {
        var newName = this.$nameControl.val().trim();
        if (newName.length == 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter data source label.');
            return;
        }
        if (typeof this.options.validate === 'function') {
            var message = this.options.validate(newName);
            if (message) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(message);
                return;
            }
        }
        this.dialogResult.newName = newName;
        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    Brightics.VA.Core.Dialogs.EditDataSourceAliasDialog = EditDataSourceAliasDialog;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var SUMMER_NOTE_TOOLBAR = [
        ['style', ['bold', 'italic', 'underline', 'clear']],
        ['fontsize', ['fontsize']],
        ['color', ['color']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['table', ['table']],
        ['height', ['height']]
    ];

    function EditResourceDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    EditResourceDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    EditResourceDialog.prototype.constructor = EditResourceDialog;

    EditResourceDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 760;
        this.dialogOptions.height = 440;
    };

    EditResourceDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-editresourcedialog-contents');

        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Name</div>' +
            '   <input type="text" class="brtc-va-dialogs-editresourcedialog-name-input" maxlength="80">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Description</div>' +
            '   <div class="brtc-va-dialogs-editresourcedialog-description-container">' +
            '   </div>' +
            '</div>');

        this.createNameControl($parent.find('.brtc-va-dialogs-editresourcedialog-name-input'));
        this.createDescriptionControl($parent.find('.brtc-va-dialogs-editresourcedialog-description-container'));
        this.$nameControl.focus();
    };

    EditResourceDialog.prototype.createNameControl = function ($control) {
        this.$nameControl = $control.jqxInput({
            placeHolder: 'Enter name',
            theme: Brightics.VA.Env.Theme
        });

        this.$nameControl.val(this.options.label);
    };

    EditResourceDialog.prototype.createDescriptionControl = function ($control) {
        var _this = this;
        var noteOption = {
            focus: false,
            height: 188,
            description: this.options.description,
            okButton: this.$okButton,
            maxLength: 2000,
            toolbar: this.options.toolbar
        };

        this.noteControl = Brightics.VA.Core.Widget.Factory.noteControl($control, noteOption);

        this.$mainControl.on('resizing', function (event) {
            _this.noteControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height() - 110);
        });
    };

    EditResourceDialog.prototype.handleOkClicked = function () {
        if (this.$nameControl.val().trim() === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter name.');
            return;
        }

        if ($('<div>').append(this.noteControl.getCode()).text().length > 2000) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Description should be less than or equal to 2000 characters.');
            return;
        }

        this.dialogResult.label = this.$nameControl.val().trim();
        var currentCode = this.noteControl.getCode();
        if (currentCode === '<p><br></p>') currentCode = '';
        this.dialogResult.description = currentCode;

        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    Brightics.VA.Core.Dialogs.EditResourceDialog = EditResourceDialog;

}).call(this);
/**
 * Created by SDS on 2017-06-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function EditScheduleDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    EditScheduleDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    EditScheduleDialog.prototype.constructor = EditScheduleDialog;

    EditScheduleDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 685;
        this.dialogOptions.height = 435;
    };

    EditScheduleDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        var schedule = _this.options.schedule;

        $parent.append('' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Schedule Name</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-name-edit-input" valid-type="type2" maxlength="80"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Cron Expression</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-cron-edit-input" valid-type="cronType" maxlength="80"/>' +
            '   <div class="brtc-va-dialogs-schedule-cron-help"></div>' +
            '   <div class="brtc-va-dialogs-schedule-cron-checkbox">IMMEDIATE</div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Schedule Owner</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-owner-edit-input" valid-type="type1" maxlength="80"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Is Active</div>' +
            '   <div class="brtc-va-dialogs-schedule-active-edit-selector"></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row">' +
            '   <div class="brtc-va-dialogs-schedule-label">Dependency Schedule</div>' +
            '   <div class="brtc-va-dialogs-schedule-dependency-selector"></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-schedule-row brtc-style-margin-top-5">' +
            '   <div class="brtc-va-dialogs-schedule-label">Model Version</div>' +
            '   <input type="text" class="brtc-va-dialogs-schedule-model-version-input" />' +
            '   <input type="button" class="brtc-va-dialogs-model-version-load" value="Add Version"/>' +
            '</div>' +
            '');

        this.$scheduleNameInput = $parent.find(".brtc-va-dialogs-schedule-name-edit-input").jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
        this.$scheduleNameInput.val(schedule.scheduleName);

        Utils.InputValidator.appendValidationCondition(this.$scheduleNameInput);

        this.$cronInput = $parent.find(".brtc-va-dialogs-schedule-cron-edit-input").jqxInput({
            theme: Brightics.VA.Env.Theme
        });
        this.$cronInput.val(schedule.cronExpression);

        Utils.InputValidator.appendValidationCondition(this.$cronInput);

        $(".brtc-va-dialogs-schedule-cron-help").on('click', function () {
            window.open('cron-expression', 'Brightics Cron Expression Help');
        });

        this.$chkimmediate = $parent.find(".brtc-va-dialogs-schedule-cron-checkbox").jqxCheckBox({
            theme: Brightics.VA.Env.Theme
        });
        this.$chkimmediate.on('change', function (event) {
            if (event.args.checked == true) {
                _this.$cronInput.jqxInput({
                    disabled: true,
                    value: 'IMMEDIATE'
                });
            } else {
                _this.$cronInput.jqxInput({
                    disabled: false,
                    value: ''
                });
            }
        });

        if (schedule.cronExpression === 'IMMEDIATE') {
            this.$cronInput.jqxInput({disabled: true});
            this.$chkimmediate.jqxCheckBox({checked: true});
        }

        this.$scheduleOwnerInput = $parent.find(".brtc-va-dialogs-schedule-owner-edit-input").jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
        this.$scheduleOwnerInput.val(schedule.scheduleOwner);

        this.$activeSelector = $parent.find(".brtc-va-dialogs-schedule-active-edit-selector").jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            source: ['Y', 'N']
        });
        this.$activeSelector.val(schedule.isActive);

        this.$dependencySelector = $parent.find(".brtc-va-dialogs-schedule-dependency-selector").jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            displayMember: 'scheduleName',
            valueMember: 'scheduleId',
            dropDownHeight: 300
        });

        this.$modelVersionInput = $parent.find(".brtc-va-dialogs-schedule-model-version-input").jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true,
            placeHolder: 'Select version'
        });

        this.$loadVersionButton = $parent.find('.brtc-va-dialogs-model-version-load');
        this.$loadVersionButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: 120,
            height: 27
        });

        this.$loadVersionButton.on('click', function () {
            _this.openSelectVersionDialog();
        });


        var getDependencies = function (resolve, reject) {
            var option = {
                url: 'api/admin/v2/schedules',
                type: 'GET',
                contentType: 'application/json; charset=utf-8'
            };
            $.ajax(option).done(function (data) {
                $.each(data, function (idx, schedule) {
                    data[idx].scheduleId = Utils.WidgetUtils.convertHTMLSpecialChar(schedule.scheduleId);
                });

                _this.$dependencySelector.jqxDropDownList({
                    source: data
                });

                _this.$dependencySelector.jqxDropDownList('insertAt', '', 0);

                _this.$dependencySelector.val(schedule.dependencyId);
                resolve();
            }).fail(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                reject(err);
            });
        };

        var getModelVersions = Studio.getResourceManager().fetchVersions(
            this.options.editorInput.getProjectId(),
            this.options.editorInput.getFileId())
            .then(function (versions) {
                var versionText = '';
                var versionId = _this.getVersionInfo(JSON.parse(schedule.executeContents)).id;

                _.forEach(versions, function (version) {
                    if (versionId === version.getVersionId()) {
                        versionText = version.getVersion();
                    }
                });
                _this.$modelVersionInput.val(versionText);
                return true;
            });

        var promises = [];

        promises.push(new Promise(getDependencies));
        promises.push(getModelVersions);

        Promise.all(promises).catch(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(error);
        }).then(function () {
        });
    };

    EditScheduleDialog.prototype.getVersionInfo = function (executeContents) {
        var models = executeContents.models;
        var versionId;

        for (var mid in models) {
            versionId = models[mid].version_id;
        }

        return {
            name: '',
            id: versionId
        };
    };

    EditScheduleDialog.prototype.openSelectVersionDialog = function () {
        var closeHandler = function (result) {
            if (result.OK) {
                var version = result.data;
                this.$modelVersionInput.val(version.getVersion());

                this.versionId = version.getVersion();
                this.versionContents = version.getContents();
            }
        }.bind(this);

        new Brightics.VA.Core.Dialogs.SelectVersionDialog(this.$mainControl, {
            projectId: this.options.editorInput.getProjectId(),
            fileId: this.options.editorInput.getFileId(),
            close: closeHandler
        })
    };

    EditScheduleDialog.prototype.addFileVersion = function (model, versionId) {
        model.versionId = versionId;
    };

    EditScheduleDialog.prototype.handleOkClicked = function () {
        var _this = this;

        var schedule = _this.options.schedule;

        if (_.trim(_this.$scheduleNameInput.val()) === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter schedule name.');
            $(".brtc-va-dialogs-schedule-name-edit-input").focus();
            return;
        }

        if (_.trim(_this.$cronInput.val()) === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter cron expression.');
            $(".brtc-va-dialogs-schedule-cron-edit-input").focus();
            return;
        }
        else {
            if (!$(".brtc-va-dialogs-schedule-cron-checkbox").jqxCheckBox('checked')) {
                var regExp = new RegExp('^\\s*($|#|\\w+\\s*=|(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|\/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|\/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|\/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|\/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[01]?\\d|2[0-3])(?:(?:-|\/|\\,)(?:[01]?\\d|2[0-3]))?(?:,(?:[01]?\\d|2[0-3])(?:(?:-|\/|\\,)(?:[01]?\\d|2[0-3]))?)*)\\s+(\\?|\\*|(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|\/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?(?:,(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|\/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?)*)\\s+(\\?|\\*|(?:[1-9]|1[012])(?:(?:-|\/|\\,)(?:[1-9]|1[012]))?(?:L|W)?(?:,(?:[1-9]|1[012])(?:(?:-|\/|\\,)(?:[1-9]|1[012]))?(?:L|W)?)*|\\?|\\*|(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?(?:,(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?)*)\\s+(\\?|\\*|(?:[0-6])(?:(?:-|\/|\\,|#)(?:[0-6]))?(?:L)?(?:,(?:[0-6])(?:(?:-|\/|\\,|#)(?:[0-6]))?(?:L)?)*|\\?|\\*|(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?(?:,(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?)*)(|\\s)+(\\?|\\*|(?:|\\d{4})(?:(?:-|\/|\\,)(?:|\\d{4}))?(?:,(?:|\\d{4})(?:(?:-|\/|\\,)(?:|\\d{4}))?)*))$');
                if (!regExp.test(_this.$cronInput.val())) {
                    Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Cron expression syntax error.');
                    $(".brtc-va-dialogs-schedule-cron-edit-input").focus();
                    return;
                }
            }
        }

        var mid = schedule.mid;

        var contents = schedule.executeContents,
            reportContents,
            duration,
            args;

        if (this.versionContents) {
            contents = $.extend(true, {}, Brightics.VA.Core.Utils.ModelUtils.exportAsRunnableFile(this.versionContents, mid, args, true, duration));

            for (var i in contents.models) {

                _this.addFileVersion(contents.models[i], this.versionId);

                for (var j in contents.models[i].functions) {
                    var fnUnit = contents.models[i].functions[j];
                    Brightics.VA.Core.Utils.ModelUtils.carvePersist(fnUnit, true);
                }
            }

            if (typeof contents.reports !== 'undefined' && Object.keys(contents.reports).length > 0) {
                reportContents = $.extend(true, {}, contents.reports);
                delete contents.reports;
            }

            contents = JSON.stringify(contents);
        }

        var scheduleInfo = {
            scheduleId: schedule.scheduleId,
            scheduleName: _this.$scheduleNameInput.val(),
            cronExpression: _this.$cronInput.val(),
            scheduleOwner: _this.$scheduleOwnerInput.val(),
            scheduleType: "JSON",
            executeContents: contents,
            reportContents: typeof reportContents !== 'undefined' ? JSON.stringify(reportContents) : null,
            fileId: schedule.fileId,
            projectId: schedule.projectId,
            isActive: _this.$activeSelector.val(),
            modifyUser: Brightics.VA.Env.Session.userId,
            dependencyId: _this.$dependencySelector.val()
        };

        var opt = {
            url: 'api/admin/v2/schedules/' + schedule.scheduleId + '/update',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            blocking: true,
            data: JSON.stringify(scheduleInfo)
        };
        $.ajax(opt).done(function () {
            Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(_this);
        }).fail(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        });
    };

    EditScheduleDialog.prototype.destroy = function () {
        this.$activeSelector.jqxDropDownList('destroy');
        this.$dependencySelector.jqxDropDownList('destroy');

        Brightics.VA.Dialogs.Dialog.prototype.destroy.call(this);
    };

    Brightics.VA.Core.Dialogs.EditScheduleDialog = EditScheduleDialog;

}).call(this);

/* global _ */
(function () {
    var Brightics = this.Brightics;
    var _super = Brightics.VA.Dialogs.Dialog.prototype;

    /**
     * @extends Dialog
     * @param {*} parentId
     * @param {Object} options
     */
    function EditVersionDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    EditVersionDialog.prototype = Object.create(_super);
    EditVersionDialog.prototype.constructor = EditVersionDialog;

    EditVersionDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);
        this.dialogOptions.width = 760;
        this.dialogOptions.height = 440;
        this.dialogOptions.maxHeight = 440;
        this.dialogOptions.title = 'Edit Version';
    };

    EditVersionDialog.prototype.createDialogContentsArea = function ($parent) {
        var template = [
            '<div class="brtc-va-dialogs-edit-version-wrapper">',
            '<div class="brtc-va-dialogs-edit-version-body">',
            '  <div class="brtc-va-dialogs-edit-version-row">',
            '    <div class="brtc-va-dialogs-edit-version-label">Name</div>',
            '    <input type="text" class="brtc-va-dialogs-edit-version-name-input brtc-style-flex-1" maxlength="80"/>',
            '  </div>',
            '  <div class="brtc-va-dialogs-edit-version-row">',
            '    <div class="brtc-va-dialogs-edit-version-label">Description</div>',
            '    <div class="brtc-va-dialogs-edit-version-description-input">',
            '    </div>',
            '  </div>',
            '  <div class="brtc-va-dialogs-edit-version-row">',
            '    <div class="brtc-va-dialogs-edit-version-label">Tags</div>',
            '    <input type="text" class="brtc-va-dialogs-edit-version-tags-input brtc-style-flex-1" maxlength="80"/>',
            '  </div>',
            '</div>',
            '</div>'
        ].join('\n');

        $parent.append(template);
        this.createLabelControl($parent.find('.brtc-va-dialogs-edit-version-name-input'));
        this.createDescriptionControl($parent.find('.brtc-va-dialogs-edit-version-description-input'));
        this.createTagsControl($parent.find('.brtc-va-dialogs-edit-version-tags-input'));

        this._refreshContents();
        this.$mainControl.dialog(this.dialogOptions);
    };

    EditVersionDialog.prototype.createLabelControl = function ($control) {
        this.$labelInput = $control.jqxInput({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
    };

    EditVersionDialog.prototype.createDescriptionControl = function ($control) {
        var _this = this;
        var noteOption = {
            focus: false,
            height: 155,
            description: this.options.description,
            okButton: this.$okButton,
            maxLength: 2000,
            toolbar: this.options.toolbar
        };

        this.noteControl = Brightics.VA.Core.Widget.Factory.noteControl($control, noteOption);

        this.$mainControl.on('resizing', function (event) {
            _this.noteControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height() - 110);
        });
    };

    EditVersionDialog.prototype.createTagsControl = function ($control) {
        this.$tagsControl = $control.jqxInput({
            placeHolder: 'Enter Tags',
            theme: Brightics.VA.Env.Theme
        });
    };

    EditVersionDialog.prototype.createDialogButtonBar = function ($parent) {
        _super.createDialogButtonBar.call(this, $parent);
        this.$okButton.val('OK');
    };

    EditVersionDialog.prototype.handleCancelClicked = function () {
        Brightics.VA.Dialogs.Dialog.prototype.handleCancelClicked.call(this);
    };

    EditVersionDialog.prototype.handleOkClicked = function () {
        var doneCallback = function () {
            this.options.onEditCallback();
            _super.handleOkClicked.call(this);
        }.bind(this);

        this.debouncedUpdateFileVersion = this.debouncedUpdateFileVersion ||
            _.debounce(function () {
                var currentCode = this.noteControl.getCode();
                if (currentCode === '<p><br></p>') currentCode = '';

                this.data.setTags(this.$tagsControl.val());
                this.data.setDescription(currentCode);
                Studio.getResourceManager().updateVersion(
                    this.options.projectId,
                    this.options.fileId,
                    this.data)
                    .then(doneCallback)
                    .catch(this._onError.bind(this));
            }.bind(this));

        this.debouncedUpdateFileVersion();
    };

    EditVersionDialog.prototype._refreshContents = function () {
        Studio.getResourceManager().fetchVersion(
            this.options.projectId,
            this.options.fileId,
            this.options.versionId)
            .then(this._fillContents.bind(this))
            .catch(this._onError.bind(this));
    };

    EditVersionDialog.prototype._fillContents = function (data) {
        this.$labelInput.val(data.getLabel());
        this.noteControl.setValue(data.getDescription());
        this.$tagsControl.val(data.getTags());
        this.data = data;
        return true;
    };

    EditVersionDialog.prototype._onError = function (err) {
        Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.EditVersionDialog = EditVersionDialog;
}.call(this));

/**
 * Created by SDS on 2018-03-15.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    const IP_REGEX = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;

    function ExportDataSettingDialog(parentId, options) {
        this.results = $.extend(true, {}, options.param);
        this.DATA_PARAM = {
            'input-path': {label: 'Input Path', type: 'code', category: 'source', mandatory: true},
            'copy-to': {label: 'Export To', type: 'radio', category: 'target'},
            'ip': {label: 'IP', type: 'code', category: 'target', mandatory: true},
            'port': {label: 'Port', category: 'target', mandatory: true},
            'output-path': {label: 'Output Path', type: 'code', category: 'target', mandatory: true, placeholder: 'ex. /temp/data.csv'},
            'delimiter': {label: 'Delimiter', type: 'radio', category: 'target'},
            'header': {label: 'Header', type: 'radio', category: 'target'},
            'quote': {label: 'Quote', type: 'radio', category: 'target'},
            'array-delimiter': {label: 'Array Delimiter', type: 'radio', category: 'target'},
            'array-start-string': {label: 'Array Start', type: 'radio', category: 'target'},
            'array-end-string': {label: 'Array End', type: 'radio', category: 'target'},
            'key-value-delimiter': {label: 'Key Value', type: 'radio', category: 'target'},
            'map-start-string': {label: 'Map Start', type: 'radio', category: 'target'},
            'map-end-string': {label: 'Map End', type: 'radio', category: 'target'},
            'null-value': { label: 'Null Value', type: 'radio', category: 'target' },
            'datasource-name': {label: 'Datasource', type: 'dropDown', category: 'target', mandatory: true},
            'table-name': {label: 'Table Name', type: 'code', category: 'target', mandatory: true},
            'is-delete': {label: 'Overwrite', type: 'radio', category: 'target'},
            'is-append': {},
            'connection-timeout': {
                label: 'Connection Timeout(sec)',
                type: 'number',
                category: 'target',
                placeholder: 'Default: 600',
                max: 3000
            },
            'login-timeout': {
                label: 'Login Timeout(sec)', type: 'number', category: 'target',
                placeholder: 'Default: 600',
                max: 3000
            },
            'socket-timeout': {
                label: 'Socket Timeout(sec)', type: 'number', category: 'target',
                placeholder: 'Default: 600',
                max: 3000
            },
            'lock-timeout': {
                label: 'Lock Timeout(sec)', type: 'number', category: 'target',
                placeholder: 'Default: 600',
                max: 3000
            }
        };

        this.RADIO_DATA_PARAM = {
            'copy-to': [
                {label: 'Repository', value: 'alluxio'},
                {label: 'HDFS', value: 'hdfs'},
                {label: 'Relational DB', value: 'jdbc'}
            ],
            'delimiter': [
                {label: 'Comma', value: ','}, {label: 'Tab', value: '\t'},
                {label: 'Space', value: ' '}, {label: 'Colon', value: ':'},
                {label: 'Semicolon', value: ';'}, {label: 'Other', value: 'Other'}
            ],
            'header': [{label: 'True', value: 'true'}, {label: 'False', value: 'false'}],
            'quote': [
                {label: 'Double Quotation', value: '"'}, {label: 'Other', value: 'Other'}
            ],
            'array-delimiter': [
                {label: 'Colon', value: ':'}, {label: 'Other', value: 'Other'}
            ],
            'array-start-string': [
                {label: 'Left Square Bracket', value: '['}, {label: 'Other', value: 'Other'}
            ],
            'array-end-string': [
                {label: 'Right Square Bracket', value: ']'}, {label: 'Other', value: 'Other'}
            ],
            'key-value-delimiter': [
                {label: 'Equal', value: '='}, {label: 'Other', value: 'Other'}
            ],
            'map-start-string': [
                {label: 'Left Curly Bracket', value: '{'}, {label: 'Other', value: 'Other'}
            ],
            'map-end-string': [
                {label: 'Right Curly Bracket', value: '}'}, {label: 'Other', value: 'Other'}
            ],
            'null-value': [
                { label: 'Empty String', value: '' }, { label: 'Other', value: 'Other' }
            ],
            'is-delete': [{label: 'True', value: 'true'}, {label: 'False', value: 'false'}]
        };

        this.PARAM_VISIBLE = {
            'hdfs': ['copy-to', 'input-path', 'ip', 'port', 'output-path', 'delimiter', 'header', 'quote', 'array-delimiter', 'array-start-string', 'array-end-string', 'key-value-delimiter', 'map-start-string', 'map-end-string', 'null-value', 'is-delete'],
            'jdbc': ['copy-to', 'datasource-name', 'input-path', 'is-delete', 'table-name', 'connection-timeout', 'login-timeout', 'socket-timeout', 'lock-timeout', 'is-append'],
            'alluxio': ['copy-to', 'input-path', 'output-path', 'delimiter', 'header', 'quote', 'array-delimiter', 'array-start-string', 'array-end-string', 'key-value-delimiter', 'map-start-string', 'map-end-string', 'null-value', 'is-delete']
        };

        Brightics.VA.Core.Dialogs.FnUnitDialog.call(this, parentId, options);
    }

    ExportDataSettingDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.FnUnitDialog.prototype);
    ExportDataSettingDialog.prototype.constructor = ExportDataSettingDialog;

    ExportDataSettingDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-style-minus-40">' +
            '    <div class="brtc-va-dialogs-body">' +
            '        <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px brtc-style-padding-right-20"></div>' +
            '        <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit brtc-style-display-flex brtc-style-width-97-p"></div>' +
            '        <div class="brtc-va-dialogs-buttonbar brtc-style-padding-right-30"></div>' +
            '    </div>' +
            '</div>');

        this.$titleArea = this.$mainControl.find('.brtc-va-dialogs-title');
    };

    ExportDataSettingDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        this.$contentsAreaWrapper = $('' +
            '<div class="brtc-va-views-properties-pages import-setting-dialog brtc-style-width-full rtc-style-overflow-hidden">' +
            '   <div class="brtc-va-views-properties-pages-contents-area brtc-style-padding-right-10 brtc-style-relative brtc-style-full"></div>' +
            '</div>');
        this.$contentsAreaWrapper.css({
            width: this.options.width,
            height: this.options.height
        });
        $parent.append(this.$contentsAreaWrapper);
        this.$contentsArea = this.$contentsAreaWrapper.find('.brtc-va-views-properties-pages-contents-area');
        this.codeArgumentControlMap = {};

        this.addPropertyControl('Source', function ($parent) {
            _this.variableArea = $parent;
            _this.createCategoryControl($parent, 'source');
        });

        this.addPropertyControl('Target', function ($parent) {
            _this.variableArea = $parent;
            _this.createCategoryControl($parent, 'target');
        });

        this.setParamControlVisible(_this.results['copy-to']);
        this.renderValidation();
        this.$contentsAreaWrapper.find('.brtc-va-views-properties-pages-contents-area').perfectScrollbar();
    };

    ExportDataSettingDialog.prototype.renderValidation = function () {
        this.removeValidation();
    }

    ExportDataSettingDialog.prototype.removeValidation = function () {
        this.$mainControl.find('.brtc-va-editors-sheet-panels-validation-tooltip-wrapper').remove();
        this.$mainControl.find('.brtc-va-editors-sheet-controls-propertycontrol-label').removeClass('brtc-va-editors-sheet-controls-propertycontrol-label-error');
        this.$mainControl.find('.brtc-va-editor-sheet-panels-validation-error').removeClass('brtc-va-editor-sheet-panels-validation-error');
        this.$mainControl.find('.brtc-va-editors-sheet-panels-validation-tooltip-wrapper').remove();
    };

    ExportDataSettingDialog.prototype.createValidationContent = function ($parent, problemData, clearBoth) {
        var $problemContent = $('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">' +
            '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' +
            '   <div class="brtc-va-editors-sheet-panels-validation-tooltip">' + problemData.message + '</div>' +
            '</div>');
        $parent.append($problemContent);
        $parent.addClass('brtc-va-editor-sheet-panels-validation-error');
        if (clearBoth) $problemContent.css('clear', 'both');
        $problemContent.show();
    };

    ExportDataSettingDialog.prototype.addPropertyControl = function (label, callback, option) {
        var _this = this,
            $propertyControl = $('' +
                '<div class="brtc-va-views-properties-pages-controls-propertycontrol">' +
                '   <div class="brtc-va-views-properties-pages-controls-propertycontrol-label"></div>' +
                '   <div class="brtc-va-views-properties-pages-controls-propertycontrol-contents">' +
                '</div>');

        if (option) {
            if (option.mandatory) {
                label = '<div>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(label) +
                    '   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div>' +
                    '</div>';
            }
        }
        this.$contentsArea.append($propertyControl);

        $propertyControl.jqxExpander({
            theme: Brightics.VA.Env.Theme,
            arrowPosition: 'left',
            initContent: function () {
                if (typeof callback === 'function') {
                    callback.call(_this, $propertyControl.find(".brtc-va-views-properties-pages-controls-propertycontrol-contents"), option);
                }
            }
        });
        $propertyControl.jqxExpander('setHeaderContent', label);
        return $propertyControl;
    };

    ExportDataSettingDialog.prototype.createCategoryControl = function ($contents, category) {
        var keyList = Object.keys(this.DATA_PARAM);
        var $argsArea, key;
        for (var i = 0; i < keyList.length; i++) {
            key = keyList[i];
            if (this.DATA_PARAM[key].category !== category) continue;

            $argsArea = $('' +
                '<div class="control-row" control-type="' + key + '">' +
                '   <div class="column-1">' + this.DATA_PARAM[key].label + ': </div>' +
                '   <div class="column-2" />' +
                '</div>');
            $argsArea.find('.column-1').addClass(key);
            if (this.DATA_PARAM[key].mandatory) $argsArea.find('.column-1').addClass('mandatory');
            $contents.append($argsArea);

            var param = this.results;
            if (this.DATA_PARAM[key].type === 'radio') {
                this.createRadioArgumentControl($argsArea, key);
                this.setRadioControlValue(key, param[key] || '');
            } else if (this.DATA_PARAM[key].type === 'code') {
                this.createCodeArgumentControl($argsArea, key);
                this.setCodeControlValue(key, param[key] || '');
            } else if (this.DATA_PARAM[key].type === 'dropDown') {
                this.createDropDownArgumentControl($argsArea, key);
                this.setDropDownControlValue(key, param[key] || '');
            } else if (this.DATA_PARAM[key].type === 'number') {
                this.createNumberInputArgumentControl($argsArea, key);
                this.setNumberInputControlValue(key, param[key] || '');
            } else {
                this.createInputArgumentControl($argsArea, key);
                this.setInputControlValue(key, param[key] || '');
            }
        }
    };

    ExportDataSettingDialog.prototype.createRadioArgumentControl = function ($parent, key) {
        //painful
        var _this = this;
        var $control = $('<div class="brtc-va-views-properties-pages-controls-propertycontrol-button" param-key="' + key + '"/>');
        $parent.find('.column-2').append($control);

        for (var i = 0; i < this.RADIO_DATA_PARAM[key].length; i++) {
            var label = this.RADIO_DATA_PARAM[key][i].label,
                value = this.RADIO_DATA_PARAM[key][i].value;
            if (value === '"') {
                value = 'quot';
            }
            var $radioDiv = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton" param-value="' + value + '"/>');
            $control.append($radioDiv);

            if (value == 'Other') {
                $radioDiv.append('' +
                    '<div class="brtc-va-delimiter-input-wrapper">' +
                    '   <input type="text" class="brtc-va-delimiter-input"/>' +
                    '</div>');
                _this.createRadioButton($radioDiv, key);
                $radioDiv.find('.brtc-va-delimiter-input').jqxInput({
                    theme: Brightics.VA.Env.Theme,
                    width: 57,
                    height: 24
                });
                $radioDiv.find('.brtc-va-delimiter-input').on('change', function () {
                    _this.results[key] = $(this).val();
                    _this.renderValidation();
                });
            } else {
                $radioDiv.text(label);
                _this.createRadioButton($radioDiv, key);
            }

            $radioDiv.on('checked', function (event) {
                var $target = $(event.target);
                
                if ($target.attr('param-value') == 'quot') {
                    _this.results[key] = '"';
                } else {
                    _this.results[key] = $target.attr('param-value');
                }
                if ($target.attr('param-value') == 'Other') {
                    var $input = $target.find('.brtc-va-delimiter-input');
                    _this.results[key] = $input.val();
                }

                if (key === 'copy-from' || key === 'copy-to') {
                    _this.setParamControlVisible(_this.results[key]);
                    _this.$mainControl.find('.brtc-va-dialogs-contents').perfectScrollbar('update');
                }

                if ($target.closest('.brtc-va-views-properties-pages-controls-propertycontrol-button').attr('param-key') == 'is-delete') {
                    _this.setAppendControlVisible();
                } 
                _this.renderValidation();
            });
        }

        if (key === 'is-delete') {
            var $radioFalse = $control.find('.brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value=false]').parent();

            var $appendOption = $('' +
                '<div class="brtc-va-views-properties-pages-controls-append">Append</div>' +
                '');
            $radioFalse.append($appendOption);
            $radioFalse.addClass('brtc-style-display-flex');
            $radioFalse.addClass('brtc-va-editors-sheet-controls-width-8');
            $radioFalse.addClass('brtc-style-col-7');

            $radioFalse.find('.brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value=false]').addClass('brtc-style-col-4-important');

            this.createCheckBox($appendOption);
            $appendOption.val(this.results['is-append']);
            this.addClassToWrapper($appendOption, 'brtc-style-display-flex');
            this.addClassToWrapper($appendOption, 'brtc-style-line-height-25');
            $appendOption.parent().prepend($('<span>(&nbsp</span>'));
            $appendOption.parent().append($('<span>&nbsp)</span>'));
            $appendOption.parent().removeClass('brtc-va-editors-sheet-controls-wrapper');
            $appendOption.parent().attr('control-type', 'is-append');

            // $parent.find('.brtc-va-editors-sheet-controls-propertycontrol-radiobutton').on('checked', function () {
            //     var param = {}, $target = $(event.target);
            //     param[key] = $target.attr('param-value');

            //     if (key === 'is-delete') {
            //         _this.setAppendControlVisible();
            //     }
            // });

            $appendOption.on('change', function () {
                _this.results['is-append'] = $(this).val().toString();
            });
        }
    };

    ExportDataSettingDialog.prototype.setAppendControlVisible = function () {
        var $checkBox = this.$mainControl.find('.brtc-va-views-properties-pages-controls-append');
        $checkBox.jqxCheckBox(this.results['is-delete'] == 'true' ? 'disable' : 'enable');
    };

    ExportDataSettingDialog.prototype.setParamControlVisible = function (copyFromType) {
        var allControlList = Object.keys(this.DATA_PARAM);
        var visibleControlList = this.PARAM_VISIBLE[copyFromType];
        var controlTr;

        for (var i = 0; i < allControlList.length; i++) {
            controlTr = this.$mainControl.find('div[control-type=' + allControlList[i] + ']');
            if (visibleControlList.indexOf(allControlList[i]) >= 0) {
                controlTr.css('display', '');
            } else {
                controlTr.css('display', 'none');
            }

            controlTr.find('.CodeMirror').each(function (i, $el) {
                $el.CodeMirror.refresh();
            });
        }

        if (copyFromType === 'jdbc') {
            this.$mainControl.find('.column-type').removeClass('mandatory');
        } else {
            this.$mainControl.find('.column-type').addClass('mandatory');
        }
    };

    ExportDataSettingDialog.prototype.createCodeArgumentControl = function ($parent, key) {
        var _this = this;

        var $inputControl = $('<textarea  class="brtc-va-views-properties-pages-controls-propertycontrol-code-input" param-key="' + key + '"/>');
        $parent.find('.column-2').append($inputControl);
        var controlOptions = {
            verifier: key === 'column-type' ? new Brightics.VA.Core.Verifier() : new Brightics.VA.Core.Verifier.CFVariableVerifier(),
            mode: 'brtc-controlflow-variable',
            scrollbarStyle: 'null',
            placeholder: this.DATA_PARAM[key].placeholder || '',
            lineWrapping: false,
            lineNumbers: false,
            // viewportMargin: Infinity,
            extraKeys: {
                'Ctrl-Space': 'autocomplete',
                "Tab": false, // Let focus go to next control
                "Shift-Tab": false // Let focus go to previous control
            },
            showTrailingSpace: true,
            hintOptions: {
                paramKey: key,
                list: key === 'column-type' ? ['Int', 'Long', 'String', 'Double', 'Boolean'] : [] //, 'Array(Double)', 'Array(String)', 'Array(Byte)', 'Map(Int, Double)'] : []
            }
        };
        var codeMirror = _this.createCodeMirrorControl($inputControl, controlOptions);
        Brightics.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(codeMirror);
        codeMirror.on('blur', function (instance, event) {
            _this.results[key] = key == 'column-type' ? _this.splitStringToArrayWithTrim(instance.getValue()) : instance.getValue();
            _this.renderValidation();
        });
        this.codeArgumentControlMap[key] = codeMirror;
    };

    ExportDataSettingDialog.prototype.splitStringToArrayWithTrim = function (str) {
        var mapCheckValue = [];
        var valueList = str.split(',');
        valueList = $.map(valueList, function (val, i) {
            return val.trim();
        });

        for (var i = 0; i < valueList.length; i++) {
            if (valueList[i].indexOf('map') != -1) {
                var mapValue = valueList[i] + ',' + valueList[++i];
                mapCheckValue.push(mapValue);
            } else {
                mapCheckValue.push(valueList[i]);
            }
        }
        return mapCheckValue;
    };

    ExportDataSettingDialog.prototype.createDropDownArgumentControl = function ($parent, key) {
        var _this = this;
        var $control = $('<div class="brtc-va-views-properties-pages-controls-propertycontrol-dropdown" param-key="' + key + '"/>');
        $parent.find('.column-2').append($control);

        _this.createDropDownList($control, {});
        $control.on('change', function (event) {
            _this.results[key] = $(this).val();
            _this.renderValidation();
        });

        if (key === 'datasource-name') {
            var source = {
                datatype: 'json',
                datafields: [
                    { name: 'datasourceName', type: 'string' },
                    { name: 'datasourceType', type: 'string' }
                ],
                url: 'api/va/v2/datasources?type=RDB'
            };

            var dataAdapter = new $.jqx.dataAdapter(source, {
                loadComplete: function () {
                    $control.val(_this.results[key]);
                }
            });

            $control.jqxDropDownList({
                source: dataAdapter,
                displayMember: 'datasourceName',
                valueMember: 'datasourceName'
            })
        }
    };

    ExportDataSettingDialog.prototype.createNumberInputArgumentControl = function ($parent, key) {
        var _this = this;
        var $control = $('<div class="brtc-va-views-properties-pages-controls-propertycontrol-numberinput" param-key="' + key + '"/>');
        $parent.find('.column-2').append($control);
        var inputOption = { placeholder: this.DATA_PARAM[key].placeholder };
        if (this.DATA_PARAM[key].max) inputOption.max = this.DATA_PARAM[key].max;
        var input = _this.createNumberInput($control, inputOption);
        Brightics.VA.Core.Utils.WidgetUtils.putData($control, key, input);
        input.onChange(function (value) {
            _this.results[key] = value;
            _this.renderValidation();
        });
    };

    ExportDataSettingDialog.prototype.createInputArgumentControl = function ($parent, key) {
        var _this = this;
        var $control = $('<input type="text" class="brtc-va-views-properties-pages-controls-propertycontrol-input" param-key="' + key + '"/>');
        $parent.find('.column-2').append($control);
        _this.createInput($control, {});
        $control.on('change', function (event) {
            _this.results[key] = $(this).val();
            _this.renderValidation();
        });
    };

    ExportDataSettingDialog.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper controlflow"></div>');
        $control.wrap($wrapper);
    };

    ExportDataSettingDialog.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    ExportDataSettingDialog.prototype.createRadioButton = function ($control, groupName) {
        this.wrapControl($control);

        if (groupName === 'quote' || groupName === 'array-delimiter' || groupName === 'array-start-string' || groupName === 'array-end-string' || groupName === 'key-value-delimiter' || groupName === 'map-start-string' || groupName === 'map-end-string' || groupName === 'null-value') {
            this.addClassToWrapper($control, 'brtc-va-editors-control-controls-radiobutton-default brtc-va-editors-sheet-controls-width-6');
        } else {
            this.addClassToWrapper($control, 'brtc-va-editors-control-controls-radiobutton-default brtc-va-editors-sheet-controls-width-4');
        }

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '25px',
            groupName: groupName
        };
        $control.jqxRadioButton(options);
    };

    ExportDataSettingDialog.prototype.setRadioControlValue = function (key, value) {
        if (value === '"') {
            value = 'quot';
        }

        var $control = [];
        if (value != '\\') {
            $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-button[param-key="' + key + '"] ' +
                '.brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value="' + value + '"]');
        }

        if ($control.length == 0) {
            $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-button[param-key="' + key + '"] ' +
                '.brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value="Other"]');
            $control.jqxRadioButton({ checked: true });
            if (value === 'quot') {
                value = '"';
            }
            $control.find('.brtc-va-delimiter-input').jqxInput('val', value);
        } else {
            $control.jqxRadioButton({ checked: true });
        }
    };

    ExportDataSettingDialog.prototype.createCodeMirrorControl = function ($control, options) {
        this.wrapControl($control);
        $control.addClass('brtc-va-editors-sheet-controls-textareacontrol');
        return CodeMirror.fromTextArea($control[0], options);
    };

    ExportDataSettingDialog.prototype.setCodeControlValue = function (key, value) {
        var control = this.codeArgumentControlMap[key];
        var valueList = this.splitStringToArrayWithTrim(control.getValue());
        if (value.toString() !== valueList.toString()) {
            control.setValue(value.toString());
        }
    };

    ExportDataSettingDialog.prototype.createDropDownList = function ($control) {
        this.wrapControl($control);

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '25px'
        };
        $control.jqxDropDownList(options);
    };

    ExportDataSettingDialog.prototype.setDropDownControlValue = function (key, value) {
        var $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-dropdown[param-key="' + key + '"]');
        if ($control.val() !== value) {
            $control.val(value);
        }
    };

    ExportDataSettingDialog.prototype.createNumberInput = function ($control, option) {
        this.wrapControl($control);

        var options = {
            min: 0
        };
        $.extend(true, options, option);
        return new Brightics.VA.Core.Editors.Sheet.Controls.NumericInput($control, options);
    };

    ExportDataSettingDialog.prototype.setNumberInputControlValue = function (key, value) {
        var $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-numberinput[param-key="' + key + '"]');
        var input = Brightics.VA.Core.Utils.WidgetUtils.getData($control, key);
        input.setValue(value);
    };

    ExportDataSettingDialog.prototype.createInput = function ($control, option) {
        this.wrapControl($control);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px'
        };
        $.extend(true, options, option);

        $control.jqxInput(options);
    };

    ExportDataSettingDialog.prototype.setInputControlValue = function (key, value) {
        var $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-input[param-key="' + key + '"]');
        if ($control.val() !== value) {
            $control.val(value);
        }
    };

    ExportDataSettingDialog.prototype.handleOkClicked = function () {
        this.options.fnUnit.param = $.extend(true, {}, this.results);

        this.dialogResult = {
            OK: true,
            Cancel: false,
            results: {fnUnit: this.options.fnUnit}
        };
        this.$mainControl.dialog('close');
    };

    ExportDataSettingDialog.prototype.createCheckBox = function ($control) {
        this.wrapControl($control);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            disabled: true
        };
        $control.jqxCheckBox(options);
        return $control;
    };

    Brightics.VA.Core.Dialogs.ExportDataSettingDialog = ExportDataSettingDialog;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var INPUT_VARIABLES_LIMIT = 10;
    var OUTPUT_ALIAS_LIMIT = 10;

    function ExportToUDFDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    ExportToUDFDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    ExportToUDFDialog.prototype.constructor = ExportToUDFDialog;

    ExportToUDFDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 982;
        this.dialogOptions.height = 871;
        this.dialogOptions.keyboardCloseKey = '';
    };

    ExportToUDFDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-exporttoudfdialog-contents');

        this.$progress = $('' +
            '   <div class="brtc-va-progress">' +
            '       <div>' +
            '           <span class="brtc-va-progress-loading"/>' +
            '           <p>Testing...</p>' +
            '       </div>' +
            '</div>');
        $parent.append(this.$progress);
        this.$progress.hide();

        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold mandatory">UDF Name</div>' +
            '   <div class ="brtc-va-dialogs-exporttoudfdialog-name-container">' +
            '       <input type="text" class="brtc-va-dialogs-exporttoudfdialog-name-input brtc-s-style-dialogs-exporttoudfdialog-name-input" maxlength="80"  isMandatory="true" valid-type="type2">' +
            '       <input type="text" class="brtc-va-dialogs-exporttoudfdialog-name-version-input brtc-s-style-dialogs-exporttoudfdialog-name-version-input" maxlength="80" readonly>' +
            '   </div>' +

            // '   <input type="text" class="brtc-va-dialogs-exporttoudfdialog-version-input" maxlength="80"  isMandatory="true">' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Description</div>' +
            '   <div class="brtc-va-dialogs-exporttoudfdialog-description-container"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Input Variables</div>' +
            '   <div class="brtc-va-dialogs-exporttoudfdialog-input-variables-container"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold mandatory"  >Script</div>' +
            '   <div class="brtc-va-dialogs-exporttoudfdialog-script-container"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold mandatory">Out Alias</div>' +
            '   <div class="brtc-va-dialogs-exporttoudfdialog-out-alias-container"/>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Test Result</div>' +
            '   <div class="brtc-va-dialogs-exporttoudfdialog-test-result-container brtc-s-style-dialogs-exporttoudfdialog-test-result-container">' +
            '   </div>' +
            '</div>');

        this.createNameControl($parent.find('.brtc-va-dialogs-exporttoudfdialog-name-input'));
        this.createNameVersionControl($parent.find('.brtc-va-dialogs-exporttoudfdialog-name-version-input'));
        this.createDescriptionControl($parent.find('.brtc-va-dialogs-exporttoudfdialog-description-container'));
        this.createInputVariablesControl($parent.find('.brtc-va-dialogs-exporttoudfdialog-input-variables-container'));
        this.createScriptControl($parent.find('.brtc-va-dialogs-exporttoudfdialog-script-container'));
        this.createOutAlias($parent.find('.brtc-va-dialogs-exporttoudfdialog-out-alias-container'));
        this.createResultControl($parent.find('.brtc-va-dialogs-exporttoudfdialog-test-result-container'));


        $parent.perfectScrollbar();
        $parent.perfectScrollbar('update');
        this.renderUDFVersion();
        this.renderInOutValidation();
        this.$nameControl.focus();
    };

    ExportToUDFDialog.prototype.renderUDFVersion = function () {
        var _this = this;
        var option = {
            url: 'api/va/v2/ws/udfs?udfName=' + encodeURIComponent(this.$nameControl.val().trim()),
            type: 'GET',
            blocking: true,
            contentType: 'application/json; charset=utf-8'
        };
        $.ajax(option).done(function (result) {
            var nameAndVersion = _this.options.label + ' ver';
            if (result.length > 0) {
                _this.UDF_VERSION = (parseFloat(result[0].udf_version) + 0.1).toFixed(1);
                if (_this.options.version) {
                    nameAndVersion += parseFloat(_this.options.version).toFixed(1);
                } else {
                    nameAndVersion += parseFloat(result[0].udf_version).toFixed(1);
                }
            } else {
                _this.UDF_VERSION = '1.0';
                nameAndVersion += '1.0';
            }
            _this.$nameVersionControl.val(nameAndVersion);
            if (_this.options.type === 'save') {
                _this.$nameVersionControl.hide();
                _this.$nameControl.show();
            } else {
                _this.$nameVersionControl.show();
                _this.$nameVersionControl.jqxInput({disabled: true});
                _this.$nameControl.hide();
            }
        }).fail(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        });
    };

    ExportToUDFDialog.prototype.createNameControl = function ($control) {
        var _this = this;
        this.$nameControl = $control.jqxInput({
            placeHolder: 'Enter UDF name',
            theme: Brightics.VA.Env.Theme
        });
        Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(this.$nameControl);
        this.$nameControl.val(this.options.label);
        this.$nameControl.on('change', function () {
            _this.renderValidation(_this.$nameControl, '"UDF Name" is required.', false);
            _this.renderUDFVersion();
        });

        this.renderValidation(this.$nameControl, '"UDF Name" is required.', false);

    };

    ExportToUDFDialog.prototype.createNameVersionControl = function ($control) {
        this.$nameVersionControl = $control.jqxInput({
            theme: Brightics.VA.Env.Theme
        });
        this.$nameVersionControl.val(this.options.label);
        this.$nameVersionControl.hide();
    };

    ExportToUDFDialog.prototype.createDescriptionControl = function ($control) {
        var _this = this;
        var noteOption = {
            focus: false,
            height: 125,
            description: this.options.description,
            okButton: this.$okButton,
            maxLength: 2000
        };

        this.noteControl = Brightics.VA.Core.Widget.Factory.noteControl($control, noteOption);

        this.$mainControl.on('resizing', function (event) {
            _this.noteControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height() - 110);
        });
    };

    ExportToUDFDialog.prototype.createScriptControl = function ($control) {
        var _this = this;

        var aceOption = {
            mode: _this.options.fnUnit.func,
            commands: [],
            events: [],
            value: _this.options.fnUnit.param.script
        };

        this.scriptControl = Brightics.VA.Core.Widget.Factory.aceEditorControl($control, aceOption);
        this.scriptControl.getWrapperDiv().attr('isMandatory', true);
        /*this.$mainControl.on('resizing', function (event) {
         _this.scriptControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height() - 110);
         });*/
        /*this.scriptControl.getWrapperDiv().resizable({
         minHeight: 170,
         maxHeight: 400,
         handles: 's, se',
         resize: function (event, ui) {
         _this.scriptControl.getWrapperDiv().css('width', '100%');
         _this.scriptControl.resize();
         }
         });*/
        this.scriptControl.editor.on('blur', function () {
            _this.renderValidation(_this.scriptControl.getWrapperDiv(), '"Script" is required.', false, _this.scriptControl.getValue().trim());
        });
        this.renderValidation(_this.scriptControl.getWrapperDiv(), '"Script" is required.', false, _this.scriptControl.getValue().trim());
    };

    ExportToUDFDialog.prototype.createInputVariablesControl = function ($parent) {
        var _this = this;

        this.$InputVariablesLineArea = $('' +
            '<div class="brtc-va-dialogs-contents-statement-input-variables">' +
            '   <div class="brtc-va-dialogs-export-to-udf input-variable-empty">' +
            '       <div class="brtc-va-dialogs-contents-statement-input-variable-empty brtc-s-style-dialogs-contents-statement-input-variable-empty">' +
            '           <div>If you want to enter Input Variables, click to plus button.</div>' +
            '       </div>' +
            '   </div>' +
            '</div>');
        // var $footer = $('<div class="brtc-va-dialogs-contents-statement-input-variables-footer"></div>');

        // $parent.append(this.$InputVariablesLineArea).append($footer);
        $parent.append(this.$InputVariablesLineArea);
        this.emptyVariableArea = this.$InputVariablesLineArea.find('.input-variable-empty');

        var $addButton = $('<div class="brtc-va-dialogs-export-to-udf add-icon"></div>');
        $addButton.click(function () {
            _this.createInputVariable(true);
            _this.renderInOutValidation();
        });

        // $footer.append($addButton);
        this.$InputVariablesLineArea.find('.input-variable-empty').append($addButton);
        this.$InputVariablesLineArea.perfectScrollbar();
        this.$InputVariablesLineArea.perfectScrollbar('update');

        this.rednerInputVariables();

    };

    ExportToUDFDialog.prototype.rednerInputVariables = function () {
        // var inputs = this.options.fnUnit.param['input-variables'];
        var inputs = this.options.inputVariables;
        for (var i in inputs) {
            var $inputVariableControl = this.createInputVariable(true);
            $inputVariableControl.find('.input-variable-param-name').val(inputs[i].param_name);
            $inputVariableControl.find('.input-variable-type').val(inputs[i].arg_type);
            $inputVariableControl.find('.input-variable-param-description').val(inputs[i].description);
            this.$InputVariablesLineArea.perfectScrollbar('update');
        }
    };

    ExportToUDFDialog.prototype.createInputVariable = function (isMandatory) {
        this.emptyVariableArea.hide();
        var inputCnt = this.$InputVariablesLineArea.find('.input-variable').length;
        if (inputCnt >= INPUT_VARIABLES_LIMIT) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Up to 10 input variable can be added.');
            return;
        }
        return this.createInputs(this.$InputVariablesLineArea, '', isMandatory);
    };

    ExportToUDFDialog.prototype.createInputs = function ($parent, alias, isMandatory) {
        var _this = this;

        var $inputVariableControl = $('' +
            '<div class="brtc-va-dialogs-export-to-udf input-variable" >' +
            '   <div class="brtc-va-dialogs-export-to-udf input-variable-name"><input type="text" class="brtc-va-dialogs-export-to-udf input-variable-param-name"  maxlength="80"  valid-type="type1" isMandatory=' + isMandatory + ' /></div>' +
            '   <div class="brtc-va-dialogs-export-to-udf input-variable-type" maxlength="80"  isMandatory=' + isMandatory + ' />' +
            '   <div class="brtc-va-dialogs-export-to-udf input-variable-description"><input type="text" class="brtc-va-dialogs-export-to-udf input-variable-param-description" maxlength="400"/></div>' +
            '   <div class="brtc-va-dialogs-export-to-udf remove-icon" ></div>' +
            '   <div class="brtc-va-dialogs-export-to-udf add-icon" ></div>' +
            '</div>' +
            '');

        $parent.append($inputVariableControl);

        var $nameInput = $inputVariableControl.find('.input-variable-param-name');
        var $typeDropDownList = $inputVariableControl.find('.input-variable-type');
        var $descriptionInput = $inputVariableControl.find('.input-variable-param-description');
        var $addButton = $inputVariableControl.find('.add-icon');
        var $removeButton = $inputVariableControl.find('.remove-icon');

        $nameInput.jqxInput({
            placeHolder: "Enter name",
            theme: Brightics.VA.Env.Theme
        });
        Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($nameInput);
        $typeDropDownList.jqxDropDownList({
            placeHolder: "Enter argument type",
            autoDropDownHeight: true,
            source: ['string', 'double', 'int', 'expression'],
            theme: Brightics.VA.Env.Theme,
            height: '22px',
            width: '100px',
            selectedIndex: 0
        });
        $descriptionInput.jqxInput({
            placeHolder: "Enter description",
            theme: Brightics.VA.Env.Theme
        });
        $nameInput.jqxInput('val', alias);

        // $nameInput.focus();

        $nameInput.on('change', function () {
            _this.renderInOutValidation();
        });

        // $nameInput.keydown(function (key) {
        //     if (key.keyCode == 13) {
        //         _this.createInputVariable(true);
        //         _this.renderInOutValidation();
        //     }
        // });

        $removeButton.click(function () {
            $(this).closest('.brtc-va-dialogs-export-to-udf.input-variable').remove();
            var inputCnt = _this.$InputVariablesLineArea.find('.input-variable').length;
            if (inputCnt == 0) {
                _this.emptyVariableArea.show();
            }
            _this.renderInOutValidation();
            $parent.perfectScrollbar('update');
        });


        $addButton.click(function () {
            _this.createInputVariable(true);
            _this.renderInOutValidation();
        });
        $parent.perfectScrollbar('update');
        return $inputVariableControl;
    };

    ExportToUDFDialog.prototype.createOutAlias = function ($parent) {
        this.$outAliasArea = $('' +
            '<div class="brtc-va-dialogs-contents-statement-out-aliases">' +
            '</div>');
        $parent.append(this.$outAliasArea);

        this.$outAliasArea.perfectScrollbar();
        this.$outAliasArea.perfectScrollbar('update');

        this.rednerOutAliasControl();

    };

    ExportToUDFDialog.prototype.createOutTableAlias = function (isMandatory) {
        var outAliasCnt = this.$outAliasArea.find('.out-alias').length;
        if (outAliasCnt >= OUTPUT_ALIAS_LIMIT) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Up to 10 out alias can be added.');
            return;
        }

        return this.createOutAliasInput(this.$outAliasArea, '', isMandatory);

    };

    ExportToUDFDialog.prototype.createOutAliasInput = function ($parent, alias, isMandatory) {

        var _this = this;

        var $outAliasControl = $('' +
            '<div class="brtc-va-dialogs-export-to-udf out-alias" >' +
            '   <div class="brtc-va-dialogs-export-to-udf out-alias-name"><input type="text" class="brtc-va-dialogs-export-to-udf out-alias-param-name"  valid-type="type1" maxlength="80"  isMandatory=' + isMandatory + ' /></div>' +
            '   <div class="brtc-va-dialogs-export-to-udf out-alias-description"><input type="text" class="brtc-va-dialogs-export-to-udf out-alias-param-description" maxlength="400"  /></div>' +
            '   <div class="brtc-va-dialogs-export-to-udf remove-icon"></div>' +
            '   <div class="brtc-va-dialogs-export-to-udf add-icon" ></div>' +
            '</div>' +
            '');

        $parent.append($outAliasControl);

        var $outAliasName = $outAliasControl.find('.out-alias-param-name');
        var $outAliasDescription = $outAliasControl.find('.out-alias-param-description');
        var $removeButton = $outAliasControl.find('.remove-icon');
        var $addButton = $outAliasControl.find('.add-icon');

        $outAliasName.jqxInput({
            placeHolder: "Enter name",
            theme: 'office'
        });
        Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($outAliasName);
        $outAliasDescription.jqxInput({
            placeHolder: "Enter description",
            theme: 'office'
        });
        $outAliasName.jqxInput('val', alias);

        //$outAliasName.focus();

        $outAliasName.on('change', function () {
            _this.renderInOutValidation();
        });

        // $outAliasName.keydown(function (key) {
        //     if (key.keyCode == 13) {
        //         _this.createOutTableAlias(true);
        //         _this.renderInOutValidation();
        //     }
        // });

        $removeButton.click(function () {
            var outAliasCnt = _this.$outAliasArea.find('.out-alias').length;
            if (outAliasCnt > 1) {
                $(this).closest('.brtc-va-dialogs-export-to-udf.out-alias').remove();
                _this.renderInOutValidation();
                _this.refreshOutAliasFirstRowCss(_this.$outAliasArea);
                $parent.perfectScrollbar('update');
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There must be at least one out alias.');
                return;
            }
        });
        $addButton.click(function () {
            _this.createOutTableAlias(true);
            _this.renderInOutValidation();
        });
        $parent.perfectScrollbar('update');

        _this.refreshOutAliasFirstRowCss($parent);

        return $outAliasControl;
    };

    ExportToUDFDialog.prototype.refreshOutAliasFirstRowCss = function ($parent) {
        if ($parent.find('.brtc-va-dialogs-export-to-udf.out-alias').length == 1) {
            $parent.find('.brtc-va-dialogs-export-to-udf.out-alias').find('.out-alias-description').addClass('out-alias-desc-width-max');
            $parent.find('.brtc-va-dialogs-export-to-udf.out-alias').find('.remove-icon').hide();
            $parent.find('.brtc-va-dialogs-export-to-udf.out-alias').find('.add-icon').show();
            $parent.find('.brtc-va-dialogs-export-to-udf.out-alias').find('.add-icon').addClass('add-icon-margin-left-10');
        } else {
            $($parent.find('.brtc-va-dialogs-export-to-udf.out-alias')[0]).find('.out-alias-description').removeClass('out-alias-desc-width-max');
            $($parent.find('.brtc-va-dialogs-export-to-udf.out-alias')[0]).find('.remove-icon').show();
        }
    };

    ExportToUDFDialog.prototype.rednerOutAliasControl = function () {
        var outTableAlias = this.options.outputAlias;
        if (outTableAlias.length == 0) {
            this.createOutTableAlias(true);
        } else {
            for (var i in outTableAlias) {
                var $outAliasControl = this.createOutTableAlias(true);
                $outAliasControl.find('.out-alias-param-name').val(outTableAlias[i].param_name);
                $outAliasControl.find('.out-alias-param-description').val(outTableAlias[i].description);
            }
        }

    };
    ExportToUDFDialog.prototype.checkUDFName = function () {
        if (this.$nameControl.val().trim() === '') {
            return false;
        }
        return true;
    };

    ExportToUDFDialog.prototype.checkInputVariables = function () {
        var inputVariableControls = $.makeArray(this.$InputVariablesLineArea.find('.brtc-va-dialogs-export-to-udf.input-variable-param-name'));
        for (var i in inputVariableControls) {
            if ($(inputVariableControls[i]).val().trim() === '') {
                return false;
            }
            var blank_pattern = /[\s]/g;
            if (blank_pattern.test($(inputVariableControls[i]).val()) == true) {
                return false;
            }
        }
        return true;
    };

    ExportToUDFDialog.prototype.duplicateName = function ($controls, $secondControls) {
        var controls = $.makeArray($controls);
        if ($secondControls) {
            controls = controls.concat($.makeArray($secondControls));
        }
        var nameList = [];
        for (var i in controls) {
            if ($.inArray($(controls[i]).val().trim(), nameList) == -1) {
                nameList.push($(controls[i]).val().trim());
            } else {
                return true;
            }
        }
        return false;
    };

    ExportToUDFDialog.prototype.checkOutAlias = function () {
        var outTableAliasControls = $.makeArray(this.$outAliasArea.find('.brtc-va-dialogs-export-to-udf.out-alias-param-name'));
        for (var i in outTableAliasControls) {
            if ($(outTableAliasControls[i]).val().trim() === '') {
                return false;
            }
            var blank_pattern = /[\s]/g;
            if (blank_pattern.test($(outTableAliasControls[i]).val()) == true) {
                return false;
            }
        }
        return true;
    };

    ExportToUDFDialog.prototype.checkScript = function () {
        if (this.scriptControl.getValue().trim() === '') {
            return false;
        }
        return true;
    };

    ExportToUDFDialog.prototype.handleOkClicked = function () {
        var _this = this;

        if (!this.checkUDFName()) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('UDF name is empty or contains spaces.');
            return;
        }

        if (!this.checkInputVariables()) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Input variables are empty or contains spaces.');
            return;
        }

        if (!this.checkScript()) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Script is empty.');
            return;
        }
        var inputControls = this.$InputVariablesLineArea.find('.brtc-va-dialogs-export-to-udf.input-variable-param-name');
        var outControls = this.$outAliasArea.find('.brtc-va-dialogs-export-to-udf.out-alias-param-name');
        if (this.duplicateName(inputControls)) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There is a duplicate name in the input variable.');
            return;
        }
        if (!this.checkOutAlias()) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Out alias are empty or contains spaces.');
            return;
        }

        if (this.duplicateName(outControls)) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There are duplicate name in the out alias.');
            return;
        }
        if (this.duplicateName(inputControls, outControls)) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('There are duplicate name in the input variable and out alias.');
            return;
        }

        var option = {
            url: 'api/va/v2/ws/udfs?udfName=' + this.$nameControl.val().trim() + '&udfVersion=' + _this.UDF_VERSION.trim(),
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            blocking: true
        };
        $.ajax(option).done(function (result) {
            if (result.length == 0) {
                var udfNameVersion = _this.$nameControl.val().trim().replace(/\s/ig, '_') + '_' + _this.UDF_VERSION.replace(/\./ig, '_');
                _this.dialogResult.udf_id = Brightics.VA.Core.Utils.IDGenerator.udf.id(udfNameVersion);
            } else {
                _this.dialogResult.udf_id = result[0].udf_id;
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('This name already exists. Please raise your version.');
                return;
            }
            _this.dialogResult.udf_name = _this.$nameControl.val().trim();
            _this.dialogResult.udf_version = _this.UDF_VERSION.trim();
            _this.dialogResult.description = _this.noteControl.getCode();
            _this.dialogResult.contents = _this.scriptControl.getValue();
            _this.dialogResult.udfParams = _this.getUDFParams();
            _this.dialogResult.creator = Brightics.VA.Env.Session.userId;
            _this.dialogResult.in_table_count = _this.getInTableCnt();
            _this.dialogResult.out_table_count = _this.getOutTableAliaes().length;
            _this.dialogResult.status = 'public';
            _this.dialogResult.updater = Brightics.VA.Env.Session.userId;
            _this.dialogResult.name = _this.options.fnUnit.func == 'python' ? 'PythonScript' : 'ScalaScript';

            Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(_this);
            // if (_this.options.type === 'update') {
            //     Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Updated version. \n' + _this.dialogResult.udf_name + ' Ver.' + _this.dialogResult.udf_version);
            // } else {
            //     Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('The user-defined function(' + _this.dialogResult.udf_name + 'Ver.' + _this.dialogResult.udf_version + ') is registered.');
            // }
        }).fail(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        });

    };

    ExportToUDFDialog.prototype.getInTableCnt = function () {
        var script = this.scriptControl.getValue();
        var regex = this.options.fnUnit.func == 'python' ? /inputs\[(?:[0-9])\]/gm : /inputs\((?:[0-9])\)/gm, numberRegex = /[0-9]/gm,
            regexComment = /"(\\[\s\S]|[^"])*"|'(\\[\s\S]|[^'])*'|(--.*|\/\/.*|\/\*[\s\S]*?\*\/)/gm;
        var replaced = script.replace(regexComment, function (match, g1, g2, g3) {
            if (g1) return match;
            if (g2) return match;
            if (g3) return '';
        });
        var inputsList = replaced.match(regex);
        if (inputsList === null || inputsList.length == 0) {
            return 0;
        }
        var inputsNumberList = inputsList.join().match(numberRegex);
        var maxInputCount = Math.max.apply(null, inputsNumberList);
        return maxInputCount + 1;

    };

    ExportToUDFDialog.prototype.getUDFParams = function () {
        var inputVariables = this.$InputVariablesLineArea.find('.brtc-va-dialogs-export-to-udf.input-variable');
        var udfParams = [];
        $(inputVariables).each(function (index, inputVariable) {
            var paramName = $(inputVariable).find('.input-variable-param-name').jqxInput('val');
            var paramType = $(inputVariable).find('.input-variable-type').jqxDropDownList('val');
            var paramDescription = $(inputVariable).find('.input-variable-param-description').jqxInput('val');
            udfParams.push({
                param_name: paramName,
                arg_type: paramType,
                description: paramDescription,
                inout_type: 'IN',
                sequence: index + 1
            });
        });
        var outAliases = this.$outAliasArea.find('.brtc-va-dialogs-export-to-udf.out-alias');
        $(outAliases).each(function (index, outAlias) {
            var paramName = $(outAlias).find('.out-alias-param-name').jqxInput('val');
            var paramDescription = $(outAlias).find('.out-alias-param-description').jqxInput('val');
            udfParams.push({
                param_name: paramName,
                arg_type: '',
                description: paramDescription,
                inout_type: 'OUT',
                sequence: index + 1
            });
        });
        return udfParams;
    };

    ExportToUDFDialog.prototype.getOutTableAliaes = function () {
        var outAliases = this.$outAliasArea.find('.brtc-va-dialogs-export-to-udf.out-alias');
        var outTableAliases = [];
        $(outAliases).each(function (index, outAlias) {
            var paramName = $(outAlias).find('.out-alias-param-name').jqxInput('val');
            outTableAliases.push(paramName);
        });
        return outTableAliases;
    };

    ExportToUDFDialog.prototype.createDialogButtonBar = function ($parent) {
        Brightics.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this, $parent);
        if (this.options.type == 'save') {
            this.$okButton.val('Save');
        } else {
            this.$okButton.val('Update');
        }
    };

    ExportToUDFDialog.prototype.handleTestClicked = function () {
        var _this = this;

        if (!this.checkOutAlias()) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Out alias are empty or contains spaces.');
            return;
        }

        if (this.getInTableCnt() == 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('UDF test requires input data.');
            return;
        }

        var inputVariableParams = _this.getUDFParams().filter(function (udf) {
            return udf['inout_type'] === 'IN';
        });

        var dialogOptions = {
            title: 'Test Parameter',
            inputDataCnt: _this.getInTableCnt(),
            inputVariable: inputVariableParams,
            close: function (dialogResult) {
                if (dialogResult.OK) {

                    //Generation RunSpec
                    var model = _this.createModel(dialogResult.inputTables, dialogResult.inputVariables);

                    //Run
                    Brightics.VA.Core.DataQueryTemplate.removeCache(model.mid);

                    var runnable = {
                        main: 'mid',
                        models: { 'mid': model },
                        version: Brightics.VA.Env.CoreVersion
                    }

                    var checkTimer = function (jid) {
                        _this._checkProgress(jid).done(function (result) {
                            if (result.status == 'PROCESSING') {
                                _this.progress(true);
                                setTimeout(checkTimer.bind(_this, jid), 3000);
                            } else if (result.status == 'SUCCESS') {
                                _this.progress(false);
                                _this.refreshResult(model);
                            } else {
                                _this.progress(false, result.errorInfo[0].message);
                            }
                        }).fail(function (err) {
                            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                        });
                    };

                    var opt = {
                        url: 'api/va/v2/analytics/jobs/execute',
                        type: 'POST',
                        contentType: 'application/json; charset=utf-8',
                        data: JSON.stringify(runnable),
                        blocking: false //progress 함수가 이미 dim 처리 하고 있음.
                    };

                    $.ajax(opt).done(function (results) {
                        var _results = JSON.parse(results);
                        var jid = _results.result;
                        _this.progress(true);
                        setTimeout(checkTimer.bind(_this, jid), 3000);
                    }).fail(function (err) {
                        Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                    });
                }
            }
        };
        new Brightics.VA.Core.Dialogs.TestUDFParamDialog(_this.$mainControl, dialogOptions);
    };

    ExportToUDFDialog.prototype._checkProgress = function (jobId) {
        var option = {
            url: 'api/va/v2/analytics/jobs/' + jobId,
            type: 'GET',
            blocking: false //progress 함수가 이미 dim 처리 하고 있음.
        };
        return $.ajax(option);
    };

    ExportToUDFDialog.prototype.progress = function (status, message) {
        var _this = this;
        if (status) {
            this.$progress.show();
        } else {
            this.$progress.hide();
            _this.$okButton.jqxButton({disabled: status});
            _this.$cancelButton.jqxButton({disabled: status});
            if (message) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(message);
            }
        }
        _this.$okButton.jqxButton({disabled: status});
        _this.$cancelButton.jqxButton({disabled: status});
    };

    ExportToUDFDialog.prototype.refreshResult = function (model) {
        //Show Result
        var _this = this;

        for (var i in this.$resultPanelContent) {
            this.$resultPanelContent[i].remove();
        }
        var udfOutTables = model.functions[model.functions.length - 1][OUT_DATA];
        var udfOutPutAlias = model.functions[model.functions.length - 1].param['out-table-alias'];
        this.$resultPanelContent = {};
        this.$resultSheet = {};
        for (var i in udfOutTables) {
            Brightics.VA.Core.DataQueryTemplate.queryData(model.mid, udfOutTables[i], 0, 1000, function (data, tableId) {
                _this.createResultPanelContent(udfOutPutAlias[$.inArray(tableId, udfOutTables)], data, model);
                var top = _this.$mainControl.find('.brtc-va-dialogs-export-to-udf-result').position().top;
                _this.$mainControl.find('.brtc-va-dialogs-exporttoudfdialog-contents').animate({
                    scrollTop: top < 0 ? 0 : top
                }, 500);
            }, function (err, tableId) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            }, false);
        }
    };

    ExportToUDFDialog.prototype.createModel = function (inputTables, inputVariables) {
        var _this = this;
        var mid = Brightics.VA.Core.Utils.IDGenerator.model.id();

        var model = $.extend(true, {}, Brightics.VA.Implementation.DataFlow.defaultModel);
        model = $.extend(true, model, Brightics.VA.Default.model);
        model.mid = 'mid';
        model.entries = [];
        model.title = 'UDF Test';

        var tempUDFFnUnit = this.options.fnUnit.func == 'python' ? $.extend(true, {}, Brightics.VA.Core.Functions.Library.pythonScript.defaultFnUnit) : $.extend(true, {}, Brightics.VA.Core.Functions.Library.scalaScript.defaultFnUnit);
        tempUDFFnUnit.fid = Brightics.VA.Core.Utils.IDGenerator.func.id();
        tempUDFFnUnit.label = tempUDFFnUnit.display.label;
        tempUDFFnUnit.persist = true;
        tempUDFFnUnit['persist-mode'] = 'auto';
        tempUDFFnUnit.param['input-variables'] = [];

        for (var i in inputTables) {
            var outTable = Brightics.VA.Core.Utils.IDGenerator.table.id();
            var loadMainFid = Brightics.VA.Core.Utils.IDGenerator.func.id();
            var loadSubFid = Brightics.VA.Core.Utils.IDGenerator.func.id();
            var loadFnUnit = $.extend(true, {}, Brightics.VA.Core.Functions.Library.load.defaultFnUnit);
            loadFnUnit.fid = loadMainFid;
            loadFnUnit.label = loadFnUnit.display.label;
            loadFnUnit.persist = true;
            loadFnUnit['persist-mode'] = 'auto';
            loadFnUnit[OUT_DATA] = [outTable];
            loadFnUnit['param'].functions[0].fid = loadSubFid;
            loadFnUnit['param'].functions[0].label = loadFnUnit.display.label;
            loadFnUnit['param'].functions[0][OUT_DATA] = [outTable];
            loadFnUnit['param'].functions[0].param['df-names'] = [outTable];
            loadFnUnit['param'].functions[0].param['fs-paths'].push(inputTables[i].value);
            loadFnUnit['param'].functions[0].param['persist'] = true;

            var link = {
                kid: Brightics.VA.Core.Utils.IDGenerator.link.id(),
                'sourceFid': loadMainFid,
                'targetFid': tempUDFFnUnit.fid
            };

            model.links.push(link);
            model.functions.push(loadFnUnit);
            model.entries.push(loadMainFid);

            tempUDFFnUnit[IN_DATA].push(outTable);
        }
        //load가 없는 경우 UDF를 entries에 넣어준다.
        if (inputTables.length === 0) {
            model.entries.push(tempUDFFnUnit.fid);
        }

        for (var i in inputVariables) {
            var inputVariable = [];
            inputVariable.push(inputVariables[i].paramName);
            inputVariable.push(inputVariables[i].paramType);
            inputVariable.push(inputVariables[i].value);
            tempUDFFnUnit.param['input-variables'].push(inputVariable);
        }
        tempUDFFnUnit.param.script = _this.scriptControl.getValue();
        tempUDFFnUnit.param['out-table-alias'] = _this.getOutTableAliaes();
        tempUDFFnUnit.display.label = _this.$nameControl.val();
        tempUDFFnUnit.parent = function () {
            var parent = $.extend(true, {}, _this.options.fnUnit.parent());
            parent.functions = [tempUDFFnUnit];
            parent.links = [];
            return parent;
        };
        $.each(_this.getOutTableAliaes(), function () {
            tempUDFFnUnit[OUT_DATA].push(Brightics.VA.Core.Utils.IDGenerator.table.id())
        });

        model.functions.push(tempUDFFnUnit);
        return model;
    };

    ExportToUDFDialog.prototype._generateJobId = function (mainId) {
        return 'va_' + mainId + '_' + moment(Date.now()).format('YYYYMMDDHHmmssSSS');
    };

    ExportToUDFDialog.prototype.createResultControl = function ($parent) {
        var _this = this;
        var testResultPanel = $('' +
            '<div class="brtc-va-dialogs-export-to-udf-test-button-area brtc-s-style-dialogs-export-to-udf-test-button-area">' +
            '   <input type="button" class="brtc-va-dialogs-export-to-udf-test-button brtc-s-style-dialogs-export-to-udf-test-button" value="Test Run" />' +
            '</div>' +
            '<div class="brtc-va-dialogs-export-to-udf-result"></div>');
        testResultPanel.find('.brtc-va-dialogs-export-to-udf-test-button').click(function () {
            _this.handleTestClicked();
        });
        $parent.append(testResultPanel);


    };

    ExportToUDFDialog.prototype.createResultPanelContent = function (tableId, data, model) {
        this.$resultPanelContent[tableId] = $('' +
            '<div class="brtc-va-dialogs-export-to-udf-result-panel-content">' +
            '</div>');

        this.$mainControl.find('.brtc-va-dialogs-export-to-udf-result').append(this.$resultPanelContent[tableId]);
        this.$mainControl.find('.brtc-va-dialogs-export-to-udf-result').perfectScrollbar();
        this.$mainControl.find('.brtc-va-dialogs-export-to-udf-result').perfectScrollbar('update');

        this.createResultContents(this.$resultPanelContent[tableId], tableId, data, model);
    };

    ExportToUDFDialog.prototype.createResultContents = function ($parent, tableId, data, model) {

        this.$resultSheet[tableId] = $('' +
            '<div>' +
            '   <div class="brtc-va-dialogs-export-to-udf-result-panel-content-title">Out( ' + tableId + ' )</div>' +
            '   <div class="brtc-va-dialogs-export-to-udf-result-panel-content-chart-area"></div>' +
            '</div>');
        $parent.append(this.$resultSheet[tableId]);
        this.createResultGrid(tableId, data, model);
        this.$mainControl.find('.brtc-va-dialogs-export-to-udf-result').perfectScrollbar('update');

        //Adonis는 추후개발
        // this.createChartSettingControl(this.$resultSheet[tableId].find('.brtc-va-dialogs-export-to-udf-result-panel-content-chart-area'));
        // this.createWorksheet(tableId, data, model);
    };

    ExportToUDFDialog.prototype.createResultGrid = function (tableId, result, model) {
        var $spreadsheet = $('<div class="brtc-va-dialogs-export-to-udf-result-panel-spreadsheet"></div>');
        this.$resultSheet[tableId].find('.brtc-va-dialogs-export-to-udf-result-panel-content-chart-area').append($spreadsheet);

        var source = {
            localdata: result.data,
            datatype: 'array',
            datafields: $.map(result.columns, function (column, index) {
                return {
                    name: '__' + column.name,
                    type: column.type,
                    map: '' + index
                };
            })
        };

        var tableColumns = $.map(result.columns, function (column, index) {
            var col = {
                text: column.name,
                datafield: '__' + column.name,
                width: 80
            };
            if (column.type == 'date') {
                col.cellsformat = 'yyyy-MM-dd HH:mm:ss:fff';
            } else if (column.type == 'number') {
                col.cellsformat = 'd';
                col.cellsalign = 'right';
            } else if (column.type == 'string') {
                col.cellsrenderer = function (row, column, value) {
                    var styleText = 'overflow:hidden; text-overflow:ellipsis; padding-bottom:2px; margin-right: 2px; margin-left: 4px; margin-top: 4px;';

                    var cellValue = this.owner.source.records[row][column];

                    if (cellValue === undefined || cellValue === '' || cellValue === null) {
                        var _localdata = this.owner.source._source.localdata[row],
                            _datafields = this.owner.source._source.datafields,
                            _objIndex = 0;

                        for (var i in _datafields) {
                            if (_datafields[i].name === column) {
                                _objIndex = Number(_datafields[i].map);
                                break;
                            }
                        }

                        if (_localdata[_objIndex] === undefined) {
                            return '<div style="' + styleText + 'color: #ff3333">undefined</div>';
                        } else if (_localdata[_objIndex] === null) {
                            return '<div align="right" style="' + styleText + 'color: #ff3333">null</div>';
                        } else if (_localdata[_objIndex] === '') {
                            return '<div align="right" style="' + styleText + '"></div>';
                        }
                    } else {
                        return '<div style="' + styleText + '">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(value) + '</div>';
                    }
                }
            }
            return col;
        });
        tableColumns.unshift({
            text: 'No', sortable: false, menu: false, editable: false, groupable: false, draggable: false,
            datafield: '', width: 40,
            columntype: 'number',
            renderer: function (value) {
                return '<div class="brtc-va-refine-spreadsheet-rownum-column">' + value + '</div>';
            },
            cellsformat: 'd', cellsalign: 'right',
            cellclassname: 'brtc-va-refine-spreadsheet-rownum-cell',
            cellsrenderer: function (row, column, value) {
                return '<div align="right" style="margin:4px;">' + (value + 1) + '</div>';
            }
        });

        var dataAdapter = new $.jqx.dataAdapter(source);
        $spreadsheet.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '200',
            rowsheight: 25,
            source: dataAdapter,
            altrows: false,
            filterable: false,
            sortable: false,
            columnsresize: true,
            selectionmode: 'multiplecellsextended',
            columns: tableColumns
        });

        $spreadsheet.on("columnclick", function (event) {
            if (event.args.column.text == "No") {
                $(this).jqxGrid('autoresizecolumns');
            }
        });
    }
    ExportToUDFDialog.prototype.createWorksheet = function (tableId, data, model) {
        var dataSet = {data: [], columns: []};
        var _this = this;
        if (typeof data === 'object') dataSet = data || dataSet;

        var options = {
            worksheet: {
                layout: [],
                panel: [{
                    id: 'default-' + Date.now(),
                    chartOption: {
                        chart: {
                            type: 'table'
                        }
                    }
                }]
            }
        };

        var source = {
            dataType: 'lazy',
            lazyData: [{
                columns: function () {
                    return dataSet.columns;
                },
                data: function (prepare) {
                    setTimeout(function () {
                        prepare.done({
                            dataType: 'rawdata',
                            columns: dataSet.columns,
                            data: dataSet.data
                        });
                    }, 100);
                }
            }]
        };
        options.worksheet.panel[0].chartOption.source = source;

        options.worksheet.toolbar = {
            menu: {
                setting: {
                    click: function () {
                        var panel = this;
                        _this._handleChartSettings(panel);
                    }
                },
                duplicate: {},
                close: {}
            }
        };

        this.$resultSheet[tableId].find('.brtc-va-dialogs-export-to-udf-result-panel-content-chart-area').bchartsAdonis(options);

    };

    ExportToUDFDialog.prototype.createChartSettingControl = function ($parent) {
        var $dialog = $('' +
            '<div class="brtc-va-dialog brtc-va-chart-settings brtc-va-dialog-export-to-udf">' +
            '   <div class="brtc-va-dialog-header">' +
            '       <div class="brtc-va-dialog-title">Chart Settings</div>' +
            '       <div class="brtc-va-dialog-button" action="close"></div>' +
            '   </div>' +
            '   <div class="brtc-va-dialog-contents"></div>' +
            '</div>');
        $parent.append($dialog);
        $dialog.draggable({
            handle: $dialog.find('.brtc-va-dialog-header > .brtc-va-dialog-title'),
            containment: 'parent'
        });

        $dialog.find('.brtc-va-dialog-header > .brtc-va-dialog-button[action="close"]').click(function () {
            $(this).closest('.brtc-va-dialog.brtc-va-chart-settings').hide();
        });
        $dialog.hide();

        return $dialog;
    };

    ExportToUDFDialog.prototype._handleChartSettings = function (panel) {
        this._openChartSettingsDialog(panel);
        this.onSelectChart();
    };

    ExportToUDFDialog.prototype._openChartSettingsDialog = function (panel) {
        var _this = this;
        var $dialog = panel.$mainControl.closest('.brtc-va-dialogs-export-to-udf-result-panel-content-chart-area').find('.brtc-va-dialog.brtc-va-chart-settings');
        if ($dialog.is(':visible') === false) {
            var offset = panel.$mainControl.closest('.brtc-va-dialogs-export-to-udf-result-panel-content-chart-area').offset();
            // offset.right = offset.left + panel.$mainControl.outerWidth();
            offset.right = panel.$mainControl.closest('.brtc-va-dialogs-export-to-udf-result-panel-content-chart-area').outerWidth();
            offset.bottom = panel.$mainControl.closest('.brtc-va-dialogs-export-to-udf-result-panel-content-chart-area').outerHeight();
            // offset.bottom = panel.$mainControl.outerHeight();
            var width = $dialog.outerWidth();
            var height = $dialog.outerHeight();
            offset.top -= 40;
            if (offset.top + height > offset.bottom) {
                offset.top = offset.bottom - height;
            }
            offset.left = offset.right - width;
            $dialog.css({
                left: offset.left,
                top: offset.top,
                // 'z-index': _this.getHighestZindex()
            });

            $dialog.show();
        }
    };

    ExportToUDFDialog.prototype.getHighestZindex = function ($chartOptionPanel) {
        var jqxWindowList = $('body').children('.jqx-window');
        var maxIndex = 0, newIndex = 0;

        for (var jqxWindowIndex = 0; jqxWindowIndex < jqxWindowList.length; jqxWindowIndex++) {
            newIndex = parseInt($(jqxWindowList[jqxWindowIndex]).css('z-index')) || 0;
            if (newIndex > maxIndex) {
                maxIndex = newIndex;
            }
        }
        return maxIndex + 1;
    };

    ExportToUDFDialog.prototype._attachChartOptionPanelToDialog = function ($chartOptionPanel) {
        $chartOptionPanel.data('original-parent', $chartOptionPanel.parent());
        $chartOptionPanel.detach();

        var $dialog = this.$mainControl.find('.brtc-va-dialog.brtc-va-chart-settings');
        $dialog.find('.brtc-va-dialog-contents').append($chartOptionPanel);
    };

    ExportToUDFDialog.prototype.onSelectChart = function () {
        var $dialog = this.$mainControl.find('.brtc-va-dialog.brtc-va-chart-settings');
        if ($dialog.is(':visible')) {
            this.$chartOptionPanel = this.$mainControl.find('.bcharts-option-panel');
            if (this.$chartOptionPanel.length > 0) {
                // 내 하위에 ChartOptionPanel 이 있으므로 detach 후 이를 Dialog 에 attach 하자.
                // 1. 기존에 Dialog 에 붙어있는 ChartOptionPanel 을 원 부모에게 되돌려주자.
                this._detachChartOptionPanel();
                // 2. 이제 나의 ChartOptionPanel 을 Dialog 에 붙여주자.
                this._attachChartOptionPanelToDialog(this.$chartOptionPanel);
            }
        }
    };
    ExportToUDFDialog.prototype._detachChartOptionPanel = function () {
        var $dialog = this.$mainControl.find('.brtc-va-dialog.brtc-va-chart-settings');
        $dialog.find('.bcharts-option-panel').each(function (index, element) {
            var $chartOptionPanel = $(element);
            var $parent = $chartOptionPanel.data('original-parent');
            $chartOptionPanel.detach().appendTo($parent);
        });
    };

    ExportToUDFDialog.prototype._attachChartOptionPanelToDialog = function ($chartOptionPanel) {
        $chartOptionPanel.data('original-parent', $chartOptionPanel.parent());
        $chartOptionPanel.detach();

        var $dialog = this.$mainControl.find('.brtc-va-dialog.brtc-va-chart-settings');
        $dialog.find('.brtc-va-dialog-contents').append($chartOptionPanel);
    };

    ExportToUDFDialog.prototype.renderValidation = function (control, message, blankFlag, value) {
        var blank_pattern = /[\s]/g;
        var checkValue = value || control.val();
        control.parent().find('.brtc-va-editors-sheet-panels-validation-tooltip-wrapper').remove();
        if ((control.attr('isMandatory') == 'true' && checkValue == '') || ( blankFlag && blank_pattern.test(checkValue) == true)) {
            control.addClass('brtc-s-style-export-to-udf-validation-error');

            var validationErrorDiv = $('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">   ' +
                '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>   ' +
                '   <div class="brtc-va-editors-sheet-panels-validation-tooltip">' + message + '</div>' +
                '</div>');
            $(control).parent().append(validationErrorDiv)
        } else {
            control.removeClass('brtc-s-style-export-to-udf-validation-error');
        }
    };

    ExportToUDFDialog.prototype.renderInOutValidation = function () {
        var controls = $.makeArray(this.$InputVariablesLineArea.find('.brtc-va-dialogs-export-to-udf.input-variable-param-name'));
        if (this.$outAliasArea)
            controls = controls.concat($.makeArray(this.$outAliasArea.find('.brtc-va-dialogs-export-to-udf.out-alias-param-name')));

        var nameList = [];
        for (var i in controls) {
            $(controls[i]).removeClass('brtc-s-style-export-to-udf-validation-error');
            $(controls[i]).parent().parent().find('.brtc-va-editors-sheet-panels-validation-tooltip-wrapper').remove();
            $(controls[i]).parent().parent().removeClass('mb-25');
            var index = $.inArray($(controls[i]).val().trim(), $.map(nameList, function (item) {
                return item.value;
            }));

            var blank_pattern = /[\s]/g;
            var checkValue = $(controls[i]).val();

            if (index == -1) {
                if (($(controls[i]).attr('isMandatory') == 'true' && checkValue == '') || blank_pattern.test(checkValue) == true) {
                    $(controls[i]).addClass('brtc-s-style-export-to-udf-validation-error');
                    var validationErrorDiv = $('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">' +
                        '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' +
                        '   <div class="brtc-va-editors-sheet-panels-validation-tooltip">"Name" is required.</div>' +
                        '</div>');
                    $(controls[i]).parent().parent().append(validationErrorDiv);
                    $(controls[i]).parent().parent().addClass('mb-25');
                }
                nameList.push({index: i, value: $(controls[i]).val().trim()});
            } else {
                $(controls[index]).addClass('brtc-s-style-export-to-udf-validation-error');
                $(controls[i]).addClass('brtc-s-style-export-to-udf-validation-error');
                var message = '"' + $(controls[i]).val() + '" already used.';
                if ($(controls[i]).val() == '') {
                    message = 'Name is required.';
                }
                var validationErrorDiv = $('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">' +
                    '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>   ' +
                    '   <div class="brtc-va-editors-sheet-panels-validation-tooltip">' + message + '</div> ' +
                    '</div>');
                $(controls[i]).parent().parent().append(validationErrorDiv);
                $(controls[i]).parent().parent().addClass('mb-25');
            }
        }

    };

    Brightics.VA.Core.Dialogs.ExportToUDFDialog = ExportToUDFDialog;
}).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function FilePathDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    FilePathDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    FilePathDialog.prototype.constructor = FilePathDialog;


    FilePathDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this._configureDialogOption({
            theme: Brightics.VA.Env.Theme,
            title: 'Remote file path',
            width: 400,
            height: 250,
            modal: true,
            resizable: false
        });
    };


    FilePathDialog.prototype.createDialogContentsArea = function ($parent) {
        this.$input = $('<input type="text"/>');
        $parent.append(this.$input);

        this.$input.jqxInput({
            placeHolder: 'Enter name',
            theme: Brightics.VA.Env.Theme,
            width: 'calc(100% - 2px)',
            height: 25
        });
        this.$input.val(this.options.name);
        this.$input.jqxInput('selectAll');
        this.$input.jqxInput('focus');
    };

    FilePathDialog.prototype.handleOkClicked = function () {
        if(this.$input.val().trim() === ''){
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('File does not exist.', function () {
            });
            return;
        }
        this.dialogResult = {
            OK: true,
            Cancel: false,
            name: this.$input.val()
        };
        this.$mainControl.dialog('close');
    };

    FilePathDialog.prototype.handleCancelClicked = function () {
        this.dialogResult = {
            OK: false,
            Cancel: true,
        };
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.FilePathDialog = FilePathDialog;

}).call(this);
/**
 * Created by jhoon80.park on 2016-04-06.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function HistorySelector(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.retrieveParent();
        this.createControls();
        this.initContents();
        this.registerCommandListener();
    }

    HistorySelector.prototype.registerCommandListener = function () {
        var _this = this;
        this.commandListener = function (command, modelDiff) {
            _this.handleCommand(command, modelDiff);
        };
        this.options.editor.addCommandListener(this.commandListener);
        this.options.editor.addGoHistoryListener(this.commandListener);
    };

    HistorySelector.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    HistorySelector.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-main-history">' +
            '   <div class="brtc-va-dialogs-body">' +
            '   </div>' +
            '</div>');

        this.$mainControl.dialog({
            title: 'History',
            appendTo: this.$parent,
            position: { my: "left top", at: "left bottom", of: this.$parent.find('.brtc-style-s-editor-toolitem[item-type=history]') },
            width: 400,
            height: 600,
            maxWidth: 400,
            maxHeight: 600,
            modal: false,
            resizable: false
        });
        this.$mainControl.parent().draggable( "option", "containment", this.$parent );
    };

    HistorySelector.prototype.initContents = function () {
        this.createDialogContentsArea(this.$mainControl.find('.brtc-va-dialogs-body'));
    };

    HistorySelector.prototype.createDialogContentsArea = function ($parent) {
        this.$historyList = $('<div class="brtc-va-dialogs-body-historylist" style="padding-right: 0px; padding-top: 5px;"></div>');
        $parent.append(this.$historyList);

        var _this = this;

        this.options.source.unshift({
            name: 'Open',
            description: 'Init history'
        });

        $.each(this.options.source, function (index, history) {
            _this.addHistory(history);
        });

        this.setSelect();
        this.$historyList.perfectScrollbar();

    };

    HistorySelector.prototype.close = function () {
        this.$mainControl.dialog('close');
        this.options.editor.removeCommandListener(this.commandListener);
        this.options.editor.removeGoHistoryListener(this.commandListener);
        this.$mainControl.dialog('destroy');
    };

    HistorySelector.prototype.setSelect = function () {
        this.changeBackGround(this.options.stackIndex + 1);
    };

    HistorySelector.prototype.changeBackGround = function (commandIndex) {
        var histories = this.$historyList.find(".brtc-va-dialogs-body-historylist-history");
        $.each(histories, function (idx, hist) {
            if (idx > commandIndex) {
                $(hist).addClass("brtc-va-dialogs-body-historylist-history-gray");
                $(hist).removeClass("brtc-va-dialogs-body-historylist-history-highlight");
            } else if (idx < commandIndex) {
                $(hist).removeClass("brtc-va-dialogs-body-historylist-history-gray");
                $(hist).removeClass("brtc-va-dialogs-body-historylist-history-highlight");
            } else {
                $(hist).removeClass("brtc-va-dialogs-body-historylist-history-gray");
                $(hist).addClass("brtc-va-dialogs-body-historylist-history-highlight");
            }
        });
    };

    HistorySelector.prototype.handelselectedItem = function (selectedDiv) {
        var _this = this;

        var histories = _this.$historyList.find(".brtc-va-dialogs-body-historylist-history");
        var commandIndex = $.inArray(selectedDiv, histories);

        this.changeBackGround(commandIndex);

        var his = {};
        his.label = $(selectedDiv).text();
        his.index = commandIndex - 1;
        _this.handleSelect(his);
    };

    HistorySelector.prototype.handleCommand = function (command, modelDiff) {
        if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.GoHistoryCommand) {
            this.options.editor.save(command, modelDiff);
        } else if (command.event.type == 'EXECUTE') {
            var description;
            if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand ||
                command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand ||
                command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AddFnUnitParameterCommand ||
                command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveFnUnitParameterCommand ||
                command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReplaceFnUnitParamCommand) {
                description = command.getLabel() + " - " + command.options.fnUnit.display.label;
            } else {
                description = command.getLabel();
            }

            var histories = this.$historyList.find(".brtc-va-dialogs-body-historylist-history");
            if (this.options.editor.getCommandManager().index + 1 !== histories.length) {
                for (var j = this.options.editor.getCommandManager().index + 1; j < histories.length; j++) {
                    $(histories[j]).remove();
                }
            }
            this.addHistory({name: command.getLabel(), description: description});
            this.changeBackGround(this.options.editor.getCommandManager().index + 1);
            this.$historyList.scrollTop(this.$historyList.prop('scrollHeight'));
        } else if (command.event.type == 'UNDO' || command.event.type == 'REDO') {
            this.changeBackGround(this.options.editor.getCommandManager().index + 1);
        }
    };


    HistorySelector.prototype.addHistory = function (history) {

        var histories = this.$historyList.find(".brtc-va-dialogs-body-historylist-history"), _this = this;
        $.each(histories, function (idx, hist) {
            $(hist).removeClass("brtc-va-dialogs-body-historylist-history-highlight");
            $(hist).removeClass("brtc-va-dialogs-body-historylist-history-gray");
        });
        var $commandHistory = $('' +
            '<div class="brtc-va-dialogs-body-historylist-history">' +
            '   <div class="brtc-va-dialogs-body-history-icon"></div>' +
            '   <div class="brtc-va-dialogs-body-history-label">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(history.name) + '</div>' +
            '</div>');
        if (history.name) {
            if (history.name.indexOf('Create') == 0 || history.name.indexOf('Clone') == 0) {
                $commandHistory.find('.brtc-va-dialogs-body-history-icon').addClass('brtc-va-dialogs-body-history-create');
            }
            else if (history.name.indexOf('Remove') == 0) {
                $commandHistory.find('.brtc-va-dialogs-body-history-icon').addClass('brtc-va-dialogs-body-history-remove');
            }
            else if (history.name.indexOf('Create') == 0 || history.name.indexOf('Clone') == 0) {
                $commandHistory.find('.brtc-va-dialogs-body-history-icon').addClass('brtc-va-dialogs-body-history-open');
            }
            else {
                $commandHistory.find('.brtc-va-dialogs-body-history-icon').addClass('brtc-va-dialogs-body-history-edit');
            }
        }
        $commandHistory.on('click', function (event) {
            _this.handelselectedItem(this);
        });

        if (histories.length === 0) {
            this.$historyList.append($commandHistory);
        } else {
            $(histories[histories.length - 1]).after($commandHistory);
        }

    };

    HistorySelector.prototype.handleSelect = function (history) {
        this.dialogResult = {
            OK: true,
            Cancel: false,
            goHistory: {
                index: history.index,
                name: history.label,
                eventType: history.eventType
            }
        };

        if (typeof this.options.selectHistory == 'function') {
            this.options.selectHistory(this.dialogResult);
        }
    };


    Brightics.VA.Core.Dialogs.HistorySelector = HistorySelector;

}).call(this);
/**
 * Created by SDS on 2018-03-15.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    const IP_REGEX = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;

    function ImportDataSettingDialog(parentId, options) {
        this.results = $.extend(true, {}, options.param);
        this.DATA_PARAM = {
            'copy-from': { label: 'Import From', type: 'radio', category: 'source' },
            'input-path': { label: 'Input Path', type: 'code', category: 'source', mandatory: true, placeholder: 'ex. /temp/data.csv' },
            'ip': { label: 'IP', type: 'code', category: 'source', mandatory: true },
            'port': { label: 'Port', category: 'source', mandatory: true },
            'output-path': { label: 'Output Path', type: 'code', category: 'target', mandatory: true },
            'datasource-name': { label: 'Datasource', type: 'dropDown', category: 'source', mandatory: true },
            'table-name': { label: 'Table Name', type: 'code', category: 'source', mandatory: true },
            'column-type': {
                label: 'Column Type',
                type: 'code',
                category: 'source',
                placeholder: 'ex. Int, String, String'
            },
            'delimiter': { label: 'Delimiter', type: 'radio', category: 'source' },
            'quote': { label: 'Quote', type: 'radio', category: 'source' },
            'array-delimiter': { label: 'Array Delimiter', type: 'radio', category: 'source' },
            'array-start-string': { label: 'Array Start', type: 'radio', category: 'source' },
            'array-end-string': { label: 'Array End', type: 'radio', category: 'source' },
            'key-value-delimiter': { label: 'Key Value', type: 'radio', category: 'source' },
            'map-start-string': { label: 'Map Start', type: 'radio', category: 'source' },
            'map-end-string': { label: 'Map End', type: 'radio', category: 'source' },
            'null-value': { label: 'Null Value', type: 'radio', category: 'source' },
            'nan-value': { label: 'NaN Value', type: 'radio', category: 'source' },
            'is-delete': { label: 'Overwrite', type: 'radio', category: 'target' },
            'connection-timeout': {
                label: 'Connection Timeout(sec)',
                type: 'number',
                category: 'source',
                placeholder: 'Default: 600',
                max: 3000
            },
            'execution-timeout': {
                label: 'Execution Timeout(sec)', type: 'number', category: 'source',
                placeholder: 'Default: 600',
                max: 3000
            }
        };

        this.RADIO_DATA_PARAM = {
            'copy-from': [
                { label: 'Repository', value: 'alluxio' },
                { label: 'HDFS', value: 'hdfs' },
                { label: 'Relational DB', value: 'jdbc' }
            ],
            'delimiter': [
                { label: 'Comma', value: ',' }, { label: 'Tab', value: '\t' },
                { label: 'Space', value: ' ' }, { label: 'Colon', value: ':' },
                { label: 'Semicolon', value: ';' }, { label: 'Other', value: 'Other' }
            ],
            'quote': [
                { label: 'Double Quotation', value: '"' }, { label: 'Other', value: 'Other' }
            ],
            'array-delimiter': [
                { label: 'Colon', value: ':' }, { label: 'Other', value: 'Other' }
            ],
            'array-start-string': [
                { label: 'Left Square Bracket', value: '[' }, { label: 'Other', value: 'Other' }
            ],
            'array-end-string': [
                { label: 'Right Square Bracket', value: ']' }, { label: 'Other', value: 'Other' }
            ],
            'key-value-delimiter': [
                { label: 'Equal', value: '=' }, { label: 'Other', value: 'Other' }
            ],
            'map-start-string': [
                { label: 'Left Curly Bracket', value: '{' }, { label: 'Other', value: 'Other' }
            ],
            'map-end-string': [
                { label: 'Right Curly Bracket', value: '}' }, { label: 'Other', value: 'Other' }
            ],
            'null-value': [
                { label: 'Empty String', value: '' }, { label: 'Other', value: 'Other' }
            ],
            'nan-value': [
                { label: 'NaN', value: 'NaN' }, { label: 'Other', value: 'Other' }
            ],
            'is-delete': [{ label: 'True', value: 'true' }, { label: 'False', value: 'false' }]
        };

        this.PARAM_VISIBLE = {
            'hdfs': ['copy-from', 'column-type', 'input-path', 'ip', 'port', 'output-path', 'delimiter', 'quote', 'array-delimiter', 'array-start-string', 'array-end-string', 'key-value-delimiter', 'map-start-string', 'map-end-string', 'null-value', 'nan-value', 'is-delete'],
            'jdbc': ['copy-from', 'column-type', 'datasource-name', 'output-path', 'is-delete', 'table-name', 'connection-timeout', 'execution-timeout'],
            'alluxio': ['copy-from', 'column-type', 'input-path', 'output-path', 'delimiter', 'quote', 'array-delimiter', 'array-start-string', 'array-end-string', 'key-value-delimiter', 'map-start-string', 'map-end-string', 'null-value', 'nan-value', 'is-delete']
        };

        Brightics.VA.Core.Dialogs.FnUnitDialog.call(this, parentId, options);
    }

    ImportDataSettingDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.FnUnitDialog.prototype);
    ImportDataSettingDialog.prototype.constructor = ImportDataSettingDialog;

    ImportDataSettingDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-style-minus-40">' +
            '    <div class="brtc-va-dialogs-body">' +
            '        <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px brtc-style-padding-right-20"></div>' +
            '        <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit brtc-style-display-flex brtc-style-width-97-p"></div>' +
            '        <div class="brtc-va-dialogs-buttonbar brtc-style-padding-right-30"></div>' +
            '    </div>' +
            '</div>');

        this.$titleArea = this.$mainControl.find('.brtc-va-dialogs-title');
    };

    ImportDataSettingDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        this.$contentsAreaWrapper = $('' +
            '<div class="brtc-va-views-properties-pages import-setting-dialog brtc-style-width-full rtc-style-overflow-hidden">' +
            '   <div class="brtc-va-views-properties-pages-contents-area brtc-style-padding-right-10 brtc-style-relative brtc-style-full"></div>' +
            '</div>');
        this.$contentsAreaWrapper.css({
            width: this.options.width,
            height: this.options.height
        });
        $parent.append(this.$contentsAreaWrapper);
        this.$contentsArea = this.$contentsAreaWrapper.find('.brtc-va-views-properties-pages-contents-area');
        this.codeArgumentControlMap = {};

        this.addPropertyControl('Source', function ($parent) {
            _this.variableArea = $parent;
            _this.createCategoryControl($parent, 'source');
        });

        this.addPropertyControl('Target', function ($parent) {
            _this.variableArea = $parent;
            _this.createCategoryControl($parent, 'target');
        });

        this.setParamControlVisible(_this.results['copy-from']);
        this.renderValidation();

        this.$contentsAreaWrapper.find('.brtc-va-views-properties-pages-contents-area').perfectScrollbar();
    };

    ImportDataSettingDialog.prototype.renderValidation = function () {
        this.removeValidation();
    }

    ImportDataSettingDialog.prototype.createValidationContent = function ($parent, problemData, clearBoth) {
        var $problemContent = $('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">' +
            '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' +
            '   <div class="brtc-va-editors-sheet-panels-validation-tooltip">' + problemData.message + '</div>' +
            '</div>');
        $parent.append($problemContent);
        $parent.addClass('brtc-va-editor-sheet-panels-validation-error');
        if (clearBoth) $problemContent.css('clear', 'both');
        $problemContent.show();
    };

    ImportDataSettingDialog.prototype.removeValidation = function () {
        this.$mainControl.find('.brtc-va-editors-sheet-panels-validation-tooltip-wrapper').remove();
        this.$mainControl.find('.brtc-va-editors-sheet-controls-propertycontrol-label').removeClass('brtc-va-editors-sheet-controls-propertycontrol-label-error');
        this.$mainControl.find('.brtc-va-editor-sheet-panels-validation-error').removeClass('brtc-va-editor-sheet-panels-validation-error');
        this.$mainControl.find('.brtc-va-editors-sheet-panels-validation-tooltip-wrapper').remove();
    };

    ImportDataSettingDialog.prototype.addPropertyControl = function (label, callback, option) {
        var _this = this,
            $propertyControl = $('' +
                '<div class="brtc-va-views-properties-pages-controls-propertycontrol">' +
                '   <div class="brtc-va-views-properties-pages-controls-propertycontrol-label"></div>' +
                '   <div class="brtc-va-views-properties-pages-controls-propertycontrol-contents">' +
                '</div>');

        if (option) {
            if (option.mandatory) {
                label = '<div>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(label) +
                    '   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div>' +
                    '</div>';
            }
        }
        this.$contentsArea.append($propertyControl);

        $propertyControl.jqxExpander({
            theme: Brightics.VA.Env.Theme,
            arrowPosition: 'left',
            initContent: function () {
                if (typeof callback === 'function') {
                    callback.call(_this, $propertyControl.find(".brtc-va-views-properties-pages-controls-propertycontrol-contents"), option);
                }
            }
        });
        $propertyControl.jqxExpander('setHeaderContent', label);
        return $propertyControl;
    };

    ImportDataSettingDialog.prototype.createCategoryControl = function ($contents, category) {
        var keyList = Object.keys(this.DATA_PARAM);
        var $argsArea, key;
        for (var i = 0; i < keyList.length; i++) {
            key = keyList[i];
            if (this.DATA_PARAM[key].category !== category) continue;

            $argsArea = $('' +
                '<div class="control-row" control-type="' + key + '">' +
                '   <div class="column-1">' + this.DATA_PARAM[key].label + ': </div>' +
                '   <div class="column-2" />' +
                '</div>');
            $argsArea.find('.column-1').addClass(key);
            if (this.DATA_PARAM[key].mandatory) $argsArea.find('.column-1').addClass('mandatory');
            $contents.append($argsArea);

            var param = this.results;
            if (this.DATA_PARAM[key].type === 'radio') {
                this.createRadioArgumentControl($argsArea, key);
                this.setRadioControlValue(key, param[key] || '');
            } else if (this.DATA_PARAM[key].type === 'code') {
                this.createCodeArgumentControl($argsArea, key);
                this.setCodeControlValue(key, param[key] || '');
            } else if (this.DATA_PARAM[key].type === 'dropDown') {
                this.createDropDownArgumentControl($argsArea, key);
                this.setDropDownControlValue(key, param[key] || '');
            } else if (this.DATA_PARAM[key].type === 'number') {
                this.createNumberInputArgumentControl($argsArea, key);
                this.setNumberInputControlValue(key, param[key] || '');
            } else {
                this.createInputArgumentControl($argsArea, key);
                this.setInputControlValue(key, param[key] || '');
            }
        }
    };

    ImportDataSettingDialog.prototype.createRadioArgumentControl = function ($parent, key) {
        var _this = this;
        var $control = $('<div class="brtc-va-views-properties-pages-controls-propertycontrol-button" param-key="' + key + '"/>');
        $parent.find('.column-2').append($control);

        for (var i = 0; i < this.RADIO_DATA_PARAM[key].length; i++) {
            var label = this.RADIO_DATA_PARAM[key][i].label,
                value = this.RADIO_DATA_PARAM[key][i].value;
            if (value === '"') {
                value = 'quot';
            }
            var $radioDiv = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton" param-value="' + value + '"/>');
            $control.append($radioDiv);

            if (value == 'Other') {
                $radioDiv.append('' +
                    '<div class="brtc-va-delimiter-input-wrapper">' +
                    '   <input type="text" class="brtc-va-delimiter-input"/>' +
                    '</div>');
                _this.createRadioButton($radioDiv, key);
                $radioDiv.find('.brtc-va-delimiter-input').jqxInput({
                    theme: Brightics.VA.Env.Theme,
                    width: 57,
                    height: 24
                });
                $radioDiv.find('.brtc-va-delimiter-input').on('change', function () {
                    _this.results[key] = $(this).val();
                    _this.renderValidation();
                });
            } else {
                $radioDiv.text(label);
                _this.createRadioButton($radioDiv, key);
            }

            $radioDiv.on('checked', function (event) {
                var $target = $(event.target);
                if ($target.attr('param-value') == 'quot') {
                    _this.results[key] = '"';
                } else {
                    _this.results[key] = $target.attr('param-value');
                }
                if ($target.attr('param-value') == 'Other') {
                    var $input = $target.find('.brtc-va-delimiter-input');
                    _this.results[key] = $input.val();
                }

                if (key === 'copy-from' || key === 'copy-to') {
                    _this.setParamControlVisible(_this.results[key]);
                    _this.$mainControl.find('.brtc-va-dialogs-contents').perfectScrollbar('update');
                }
                _this.renderValidation();
            });
        }
    };

    ImportDataSettingDialog.prototype.setParamControlVisible = function (copyFromType) {
        var allControlList = Object.keys(this.DATA_PARAM);
        var visibleControlList = this.PARAM_VISIBLE[copyFromType];
        var controlTr;

        for (var i = 0; i < allControlList.length; i++) {
            controlTr = this.$mainControl.find('div[control-type=' + allControlList[i] + ']');
            if (visibleControlList.indexOf(allControlList[i]) >= 0) {
                controlTr.css('display', '');
            } else {
                controlTr.css('display', 'none');
            }

            controlTr.find('.CodeMirror').each(function (i, $el) {
                $el.CodeMirror.refresh();
            });
        }
    };

    ImportDataSettingDialog.prototype.createCodeArgumentControl = function ($parent, key) {
        var _this = this;

        var $inputControl = $('<textarea  class="brtc-va-views-properties-pages-controls-propertycontrol-code-input" param-key="' + key + '"/>');
        $parent.find('.column-2').append($inputControl);
        var controlOptions = {
            verifier: key === 'column-type' ? new Brightics.VA.Core.Verifier() : new Brightics.VA.Core.Verifier.CFVariableVerifier(),
            mode: 'brtc-controlflow-variable',
            scrollbarStyle: 'null',
            placeholder: this.DATA_PARAM[key].placeholder || '',
            lineWrapping: false,
            lineNumbers: false,
            // viewportMargin: Infinity,
            extraKeys: {
                'Ctrl-Space': 'autocomplete',
                "Tab": false, // Let focus go to next control
                "Shift-Tab": false // Let focus go to previous control
            },
            showTrailingSpace: true,
            hintOptions: {
                paramKey: key,
                list: key === 'column-type' ? ['Int', 'Long', 'String', 'Double', 'Boolean'] : [] //, 'Array(Double)', 'Array(String)', 'Array(Byte)', 'Map(Int, Double)'] : []
            }
        };
        var codeMirror = _this.createCodeMirrorControl($inputControl, controlOptions);
        Brightics.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(codeMirror);
        codeMirror.on('blur', function (instance, event) {
            _this.results[key] = key == 'column-type' ? _this.splitStringToArrayWithTrim(instance.getValue()) : instance.getValue();
            _this.renderValidation();
        });
        this.codeArgumentControlMap[key] = codeMirror;
    };

    ImportDataSettingDialog.prototype.splitStringToArrayWithTrim = function (str) {
        var mapCheckValue = [];
        var valueList = str.split(',');
        valueList = $.map(valueList, function (val, i) {
            return val.trim();
        });

        for (var i = 0; i < valueList.length; i++) {
            if (valueList[i].toLowerCase().indexOf('map') != -1) {
                var mapValue = valueList[i] + ',' + valueList[++i];
                mapCheckValue.push(mapValue);
            } else {
                mapCheckValue.push(valueList[i]);
            }
        }
        return mapCheckValue;
    };

    ImportDataSettingDialog.prototype.createDropDownArgumentControl = function ($parent, key) {
        var _this = this;
        var $control = $('<div class="brtc-va-views-properties-pages-controls-propertycontrol-dropdown" param-key="' + key + '"/>');
        $parent.find('.column-2').append($control);

        _this.createDropDownList($control, {});
        $control.on('change', function (event) {
            _this.results[key] = $(this).val();
            _this.renderValidation();
        });

        if (key === 'datasource-name') {
            var source = {
                datatype: 'json',
                datafields: [
                    { name: 'datasourceName', type: 'string' },
                    { name: 'datasourceType', type: 'string' }
                ],
                url: 'api/va/v2/datasources?type=RDB'
            };

            var dataAdapter = new $.jqx.dataAdapter(source, {
                loadComplete: function () {
                    $control.val(_this.results[key]);
                }
            });

            $control.jqxDropDownList({
                source: dataAdapter,
                displayMember: 'datasourceName',
                valueMember: 'datasourceName'
            })
        }
    };

    ImportDataSettingDialog.prototype.createNumberInputArgumentControl = function ($parent, key) {
        var _this = this;
        var $control = $('<div class="brtc-va-views-properties-pages-controls-propertycontrol-numberinput" param-key="' + key + '"/>');
        $parent.find('.column-2').append($control);
        var inputOption = { placeholder: this.DATA_PARAM[key].placeholder };
        if (this.DATA_PARAM[key].max) inputOption.max = this.DATA_PARAM[key].max;
        var input = _this.createNumberInput($control, inputOption);
        Brightics.VA.Core.Utils.WidgetUtils.putData($control, key, input);
        input.onChange(function (value) {
            _this.results[key] = value;
            _this.renderValidation();
        });
    };

    ImportDataSettingDialog.prototype.createInputArgumentControl = function ($parent, key) {
        var _this = this;
        var $control = $('<input type="text" class="brtc-va-views-properties-pages-controls-propertycontrol-input" param-key="' + key + '"/>');
        $parent.find('.column-2').append($control);
        _this.createInput($control, {});
        $control.on('change', function (event) {
            _this.results[key] = $(this).val();
            _this.renderValidation();
        });
    };

    ImportDataSettingDialog.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper controlflow"></div>');
        $control.wrap($wrapper);
    };

    ImportDataSettingDialog.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    ImportDataSettingDialog.prototype.createRadioButton = function ($control, groupName) {
        this.wrapControl($control);

        if (groupName === 'quote' || groupName === 'array-delimiter' || groupName === 'array-start-string' || groupName === 'array-end-string' || groupName === 'key-value-delimiter' || groupName === 'map-start-string' || groupName === 'map-end-string' || groupName === 'null-value' || groupName === 'nan-value') {
            this.addClassToWrapper($control, 'brtc-va-editors-control-controls-radiobutton-default brtc-va-editors-sheet-controls-width-6');
        } else {
            this.addClassToWrapper($control, 'brtc-va-editors-control-controls-radiobutton-default brtc-va-editors-sheet-controls-width-4');
        }

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '25px',
            groupName: groupName
        };
        $control.jqxRadioButton(options);
    };

    ImportDataSettingDialog.prototype.setRadioControlValue = function (key, value) {
        if (value === '"') {
            value = 'quot';
        }

        var $control = [];
        if (value != '\\') {
            $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-button[param-key="' + key + '"] ' +
                '.brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value="' + value + '"]');
        }

        if ($control.length == 0) {
            $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-button[param-key="' + key + '"] ' +
                '.brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value="Other"]');
            $control.jqxRadioButton({ checked: true });
            if (value === 'quot') {
                value = '"';
            }
            $control.find('.brtc-va-delimiter-input').jqxInput('val', value);
        } else {
            $control.jqxRadioButton({ checked: true });
        }
    };

    ImportDataSettingDialog.prototype.createCodeMirrorControl = function ($control, options) {
        this.wrapControl($control);
        $control.addClass('brtc-va-editors-sheet-controls-textareacontrol');
        return CodeMirror.fromTextArea($control[0], options);
    };

    ImportDataSettingDialog.prototype.setCodeControlValue = function (key, value) {
        var control = this.codeArgumentControlMap[key];
        var valueList = this.splitStringToArrayWithTrim(control.getValue());
        if (value.toString() !== valueList.toString()) {
            control.setValue(value.toString());
        }
    };

    ImportDataSettingDialog.prototype.createDropDownList = function ($control) {
        this.wrapControl($control);

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '25px'
        };
        $control.jqxDropDownList(options);
    };

    ImportDataSettingDialog.prototype.setDropDownControlValue = function (key, value) {
        var $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-dropdown[param-key="' + key + '"]');
        if ($control.val() !== value) {
            $control.val(value);
        }
    };

    ImportDataSettingDialog.prototype.createNumberInput = function ($control, option) {
        this.wrapControl($control);

        var options = {
            min: 0
        };
        $.extend(true, options, option);
        return new Brightics.VA.Core.Editors.Sheet.Controls.NumericInput($control, options);
    };

    ImportDataSettingDialog.prototype.setNumberInputControlValue = function (key, value) {
        var $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-numberinput[param-key="' + key + '"]');
        var input = Brightics.VA.Core.Utils.WidgetUtils.getData($control, key);
        input.setValue(value);
    };

    ImportDataSettingDialog.prototype.createInput = function ($control, option) {
        this.wrapControl($control);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px'
        };
        $.extend(true, options, option);

        $control.jqxInput(options);
    };

    ImportDataSettingDialog.prototype.setInputControlValue = function (key, value) {
        var $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-input[param-key="' + key + '"]');
        if ($control.val() !== value) {
            $control.val(value);
        }
    };

    ImportDataSettingDialog.prototype.handleOkClicked = function () {
        this.options.fnUnit.param = $.extend(true, {}, this.results);

        this.dialogResult = {
            OK: true,
            Cancel: false,
            results: {fnUnit: this.options.fnUnit}
        };
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.ImportDataSettingDialog = ImportDataSettingDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */

/* global _, Studio */

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function ImportDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.modelData = {};

        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    ImportDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ImportDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-newfiledialog import">' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents import">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK"/>' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel"/>' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        var _this = this;

        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: this.options.fileType === 'Report' ? 'Import Report' : 'Import Model',
            width: 778,
            height: 500,
            modal: true,
            resizable: false,
            close: function () {
                if (typeof _this.options.close === 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        };
        this.$mainControl.dialog(jqxOpt);
    };

    ImportDialog.prototype.initContents = function () {
        var _this = this;
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
        _this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$okButton.click(_this.performFinish.bind(_this));
        _this.$cancelButton.click(_this.handleCancelClicked.bind(_this));
    };

    ImportDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        $parent.append('' +
            '<div class="brtc-va-dialogs-newfiledialog-label import"></div>'
        );

        var $upload = $parent.find('.brtc-va-dialogs-newfiledialog-label.import');
        $upload.css({
            'width': '100%',
            'height': '100%',
            'overflow': 'hidden'
        });

        this.fileList = new Brightics.VA.Core.Widget.Controls.FileList($upload, {
            multiple: true
        });

        $upload.on('addFile', function (e, files, omitted) {
            _this.makeModelData(files, omitted);
        });
        $upload.on('removeFile', function (e, keys) {
            for (var i in keys) {
                delete _this.modelData[keys[i]];
            }
            _this.configureOkButton();
        });
    };

    ImportDialog.prototype.configureOkButton = function () {
        var gridKeys = Object.keys(this.fileList.getFiles());
        var modelKeys = Object.keys(this.modelData);

        if (gridKeys.length > 0) {
            if (gridKeys.length == modelKeys.length) {
                this.$okButton.jqxButton({disabled: false});
            } else {
                this.$okButton.jqxButton({disabled: true});
            }
        } else {
            this.$okButton.jqxButton({disabled: true});
        }
    };

    ImportDialog.prototype.makeModelData = function (files, omitted) {
        var _this = this;
        var promises = [];

        var promiseFunc = function (resolve, reject) {
            _this.handleLocalFileSelected(key, files[key], omitted, resolve);
        };

        for (var key in files) {
            var promise = new Promise(promiseFunc);
            promises.push(promise);
        }

        Promise.all(promises).then(function () {
            _this.configureOkButton();
        }, function (error) {
        });
    };

    ImportDialog.prototype.handleLocalFileSelected = function (fileKey, file, omitted, resolve) {
        var _this = this;

        var rt = {
            model: {},
            errorMessage: ''
        };

        try {
            var reader = new FileReader();
            if (!omitted[fileKey]) {
                reader.onloadend = function (evt) {
                    var modelData = {};
                    if (evt.target.readyState == FileReader.DONE) { // DONE == 2
                        try {
                            modelData = JSON.parse(evt.target.result);
                        }
                        catch (err) {
                            rt.errorMessage = 'Invalid Model(.json) File.';
                            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Invalid Model(.json) File.');
                        }
                        rt.errorMessage = _this.options.resourceManager.validateFile(modelData, _this.options.fileType);
                    } else {
                        rt.errorMessage = 'Invalid Model(.json) File.';
                    }
                    if (rt.errorMessage) {
                        _this.fileList.setDisableFile(fileKey, rt.errorMessage);
                        Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(rt.errorMessage);
                    } else {
                        _this.modelData[fileKey] = modelData;
                    }

                    resolve();
                };
                reader.readAsText(file);
            } else {
                rt.errorMessage = 'Omitted for duplicate.';
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(rt.errorMessage);
            }
        } catch (err) {
            rt.errorMessage = 'Only JSON file can be imported.';

            _this.fileList.setDisableFile(file.fileKey, rt.errorMessage);

            resolve();
        }
    };

    ImportDialog.prototype.createFileContents = function (mid, modelData) {
        var contents = Brightics.VA.Core.Utils.ModelUtils.cloneModel(modelData);
        contents.mid = mid;

        return contents;
    };

    ImportDialog.prototype.getFileNameByMid = function (mid) {
        var _this = this;
        var files = this.fileList.getFiles();
        return _.chain(files)
            .filter(function (file, key) {
                var model = _this.modelData[key];
                return model && model.mid === mid;
            })
            .map('name')
            .value();
    };

    ImportDialog.prototype.performFinish = function () {
        var _this = this;
        var doneCallback = function () {
            this.dialogResult = {
                OK: true,
                Cancel: false,
                selectedFiles: []
            };

            this.$mainControl.dialog('close');
        }.bind(this);

        var errorCallback = function (error) {
            error.responseJSON.errors[0].message +=
                ' (' + _this.getFileNameByMid(error.responseJSON.errors[0].mid).join(', ') + ')';
            delete error.responseJSON.errors[0].detailMessage;
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        };

        Studio.getResourceService()
            .importJSONs(_.toArray(this.modelData), this.options.project.getProjectId())
            .then(doneCallback)
            .catch(errorCallback);
    };

    ImportDialog.prototype.handleCancelClicked = function () {
        this.dialogResult.OK = false;
        this.dialogResult.Cancel = true;

        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.ImportDialog = ImportDialog;
}).call(this);

/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    const POSSIBLE_MODEL_TYPES = ['data', 'ETL'];

    function ImportProjectDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    ImportProjectDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ImportProjectDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-import-project">' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents"></div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK"/>' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel"/>' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        var _this = this;

        var dialogOption = {
            theme: Brightics.VA.Env.Theme,
            title: 'Import Project',
            width: 778,
            height: 500,
            modal: true,
            resizable: false,
            close: function () {
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        };
        this.$mainControl.dialog(dialogOption);
    };

    ImportProjectDialog.prototype.initContents = function () {
        var _this = this;
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$okButton.click(_this.performFinish.bind(_this));
        _this.$cancelButton.click(_this.handleCancelClicked.bind(_this));
    };

    ImportProjectDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-label select-file">Select File</div>' +
            '<div class="brtc-va-dialogs-select-file-control"></div>' +
            '<div class="brtc-va-dialogs-label name">Name</div>' +
            '<input type="text" class="brtc-va-dialogs-name-input" maxlength="80"/>' +
            '<div class="brtc-va-dialogs-label description">Description</div>' +
            '<div class="brtc-va-dialogs-description-container"></div>'
        );

        this.createSelectFileControl($parent.find('.brtc-va-dialogs-select-file-control'));
        this.createNameControl($parent.find('.brtc-va-dialogs-name-input'));
        this.createDescriptionControl($parent.find('.brtc-va-dialogs-description-container'));
    };

    ImportProjectDialog.prototype.createSelectFileControl = function ($parent) {
        var _this = this;

        $parent.append('' +
            '<div class="brtc-va-dialogs-dataupload-contents">' +
            '   <div class="brtc-va-dialogs-dataupload-contents-fileselectpage page import">' +
            '      <div class="fileselect">' +
            '          <div class="contents filename">' +
            '              <span class="nodata">Select file to upload</span>' +
            '          </div>' +
            '          <div class="header">' +
            '                  <input for="brtc-va-dialogs-dataupload-contents-fileselectpage-ex-filename open-model-button" type="button" id="fileselect-local" value="Find" />' +
            '                  <input type="file" id="brtc-va-dialogs-dataupload-contents-fileselectpage-ex-filename" name="fileToUpload" accept=".json">' +
            '          </div>' +
            '      </div>' +
            '   </div>' +
            '</div>'
        );

        this.$fileSelectPage = $parent.find('.brtc-va-dialogs-dataupload-contents-fileselectpage');
        var $btnLocal = this.$fileSelectPage.find('#fileselect-local');
        var fileSelect = this.$fileSelectPage.find('#brtc-va-dialogs-dataupload-contents-fileselectpage-ex-filename');

        $btnLocal.jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        $btnLocal.on('click', function () {
            fileSelect.click();
        });

        fileSelect.on('change', function (event) {
            _this.file = $(this)[0].files[0];
            _this.handleLocalFileSelected();
        });
        $btnLocal.focus();
        $btnLocal.attr('tabindex', '1');
        this.$fileSelectPage.find('.import-contents').perfectScrollbar();
    };

    ImportProjectDialog.prototype.createNameControl = function ($parent) {
        var _this = this;
        _this.$nameControl = $parent;
        _this.$nameControl.jqxInput({
            width: 618,
            height: 23,
            theme: Brightics.VA.Env.Theme
        });
        _this.$nameControl.attr('tabindex', '2');
    };

    ImportProjectDialog.prototype.createDescriptionControl = function ($control) {
        var _this = this;
        var noteOption = {
            focus: false,
            height: 208,
            description: '',
            okButton: this.$okButton,
            maxLength: 2000,
            toolbar: this.options.toolbar
        };

        this.noteControl = Brightics.VA.Core.Widget.Factory.noteControl($control, noteOption);
        $control.find('.note-editable.panel-body').attr('tabindex', '3');
        this.$mainControl.on('resizing', function (event) {
            _this.noteControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height() - 110);
        });
    };

    ImportProjectDialog.prototype.reset = function () {
        this.file = '';
        this.fileName = '';
        this.data = [];
        $('input[type=file]').val('');
    };

    ImportProjectDialog.prototype.isJsonFile = function (fileName) {
        var fileNameArr = this.fileName.split('.');
        return (fileNameArr[fileNameArr.length - 1] == 'json');
    };

    ImportProjectDialog.prototype.handleLocalFileSelected = function () {
        var _this = this;
        this.fileName = this.file.name;
        if (!window.FileReader) {
            this.fileName = $(this).val().split('/').pop().split('\\').pop();
        }

        var $fileName = this.$fileSelectPage.find('.filename');
        $fileName.empty();
        $fileName.append($('' +
            '<span class="brtc-va-icon brtc-va-dialogs-dataupload file"></span>' +
            '<span class="brtc-va-dialogs-dataupload file-name"></span>'));
        $fileName.find('.brtc-va-dialogs-dataupload.file-name').text(_this.fileName);
        $fileName.find('.brtc-va-dialogs-dataupload.file-name').attr('title', _this.fileName);


        var rs = Studio.getResourceService();

        if (this.isJsonFile(this.fileName)) {
            try {
                var reader = new FileReader();
                reader.onloadend = function (evt) {
                    _this.reset();
                    if (evt.target.readyState === FileReader.DONE) { // DONE == 2
                        try {
                            rs.validateExportedProjectSpec(JSON.parse(evt.target.result))
                                .then(function (res) {
                                    _this.data = res;
                                    _this.$nameControl.val(res.data.label || 'untitled');
                                    _this.noteControl.setValue(res.data.description || '');
                                })
                                .catch(function () {
                                    $fileName.empty();
                                    $fileName.append($('<span class="brtc-va-icon brtc-va-dialogs-dataupload error">File Type Error: Not a file that can be imported.</span>'));
                                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Invalid Project File.');
                                });
                        } catch (err) {
                            $fileName.empty();
                            $fileName.append($('<span class="brtc-va-icon brtc-va-dialogs-dataupload error">File Type Error : json type can be entered only.</span>'));
                            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Invalid Project(.json) File.');
                        }
                    } else {
                        _this.refresh();
                    }
                };
                reader.readAsText(this.file);
            } catch (err) {
                _this.refresh();
            }
        } else {
            $fileName.append($('<span class="brtc-va-icon brtc-va-dialogs-dataupload error">File Type Error : json type can be entered only.</span>'));
        }
    };

    ImportProjectDialog.prototype.refresh = function (status) {
        this.$fileSelectPage.find('.filename').empty();
    };

    ImportProjectDialog.prototype.performFinish = function () {
        var _this = this;

        if (this.$fileSelectPage.find('.nodata').length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please select file to upload.', function () {
                _this.$fileSelectPage.find('#fileselect-local').focus();
            });
            return;
        }
        if (this.$fileSelectPage.find('.brtc-va-icon.brtc-va-dialogs-dataupload.error').length > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please select valid model(.json) file.', function () {
                _this.$fileSelectPage.find('#fileselect-local').focus();
            });
            return;
        }
        if (_this.$nameControl.val().trim() === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter name.', function () {
                _this.$nameControl.focus();
            });
            return;
        }
        if ($('<div>').append(this.noteControl.getCode()).text().length > 2000) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Description should be less than or equal to 2000 characters.');
            return;
        }

        var label = _this.$nameControl.val();
        var description = _this.noteControl.getCode() === '' ? '' : _this.noteControl.getCode();

        var rs = Studio.getResourceService();
        _this.data.data.label = label;
        _this.data.data.description = description;
        rs.importProject(_this.data)
            .then(function (projectId) {
                _this.dialogResult = {
                    OK: true,
                    Cancel: false,
                    projectId: projectId
                };
                _this.$mainControl.dialog('close');
            })
            .catch(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            });
    };

    ImportProjectDialog.prototype.handleCancelClicked = function () {
        this.dialogResult.OK = false;
        this.dialogResult.Cancel = true;

        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.ImportProjectDialog = ImportProjectDialog;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function ImportUDFDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    ImportUDFDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    ImportUDFDialog.prototype.constructor = ImportUDFDialog;

    ImportUDFDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 760;
        this.dialogOptions.height = 300;
    };

    ImportUDFDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        $parent.addClass('brtc-va-dialogs-import-udf-contents');

        $parent.append('' +
            '<div class="fileselect">' +
            '       <div class="header">' +
            '           <span>File</span>' +
            '               <input for="brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename" type="button" id="fileselect-local" value="Local" />' +
            '               <input type="file" id="brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename" name="fileToUpload" accept=".json">' +
            '       </div>' +
            '       <div class="contents filename">' +
            '           <span class="nodata">Select file to upload</span>' +
            '       </div>' +
            '</div>');

        var $btnLocal = $parent.find('#fileselect-local');
        var fileSelect = $parent.find('#brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename');
        fileSelect.on('change', function (event) {
            var reader = new FileReader();
            var file = $(this)[0].files[0]
            reader.onloadend = function (event) {
                var data = {};
                data = JSON.parse(event.target.result);
                _this.data = data;
                var fileSize = file.size > 1024*1024 ?
                    parseFloat(Math.round(file.size/1024/1024 * 100) / 100).toFixed(2)+'MB' :
                    parseFloat(Math.round(file.size/1024 * 100) / 100).toFixed(2)+'KB';
                var fileName = $parent.find('.filename');
                fileName.empty();
                if(typeof _this.data === 'object' &&
                    _this.data.hasOwnProperty('script') &&
                    _this.data.hasOwnProperty('specJson') &&
                    _this.data.specJson.category === 'udf' &&
                    _this.data.script.content !== '' &&
                    _this.data.script.type !== '') {

                    fileName.append($('' +
                        '<span class="brtc-va-icon brtc-va-wizardpage-dataupload file"></span>' +
                        '<span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(file.name) + '</span>'));
                    _this.configureOkButton();
                }
                else {
                    _this.data = {specJson:{}};
                    fileName.append($('' +
                        '<span class="nodata">Select file to upload</span>'));
                    _this.configureOkButton();
                    Utils.WidgetUtils.openInformationDialog('Check your JSON file');
                }
            };
            reader.readAsText(file);
        });

        $btnLocal.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        $btnLocal.on('click', function () {
            fileSelect.click();
        });
    };

    ImportUDFDialog.prototype.handleOkClicked = function () {
        var funcId =  Utils.IDGenerator.uuid.id(16);
        var scriptId = 'udf' + '_script' + Utils.IDGenerator.uuid.id(16);
        var _this = this;
        this.data.id = funcId;
        this.data.specJson.scriptId = scriptId;
        var opt = {
            type: 'POST',
            url: 'api/va/v3/ws/udfs',
            data: JSON.stringify(this.data),
            contentType: 'application/json; charset=utf-8'
        };
        $.ajax(opt).done(function (data) {
            Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(_this);
        }).fail(function (err) {
            Brightics.VA.Dialogs.Dialog.prototype.handleCancelClicked.call(_this);
        });
    };

    ImportUDFDialog.prototype.configureOkButton = function () {
        if (JSON.stringify(this.data) === JSON.stringify({specJson:{}})) {
            this.$okButton.jqxButton({ disabled: true });
        } else {
            this.$okButton.jqxButton({ disabled: false });
        }
    };

    Brightics.VA.Core.Dialogs.ImportUDFDialog = ImportUDFDialog;

}).call(this);

/**
 * Created by daewon77.park on 2016-08-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function IndexDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);

        this.addListener();
    }

    IndexDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    IndexDialog.prototype.constructor = IndexDialog;

    IndexDialog.prototype.addListener = function () {
        var _this = this;
        this.commandListener = function (command) {
            _this.handleCommand(command);
        };

        this.options.editor.addCommandListener(this.commandListener);

        this.activeModelChangeListener = function () {
            _this.refresh();
        };

        this.options.editor.addActiveModelChangeListener(this.activeModelChangeListener);
    };

    IndexDialog.prototype.removeListener = function () {
        this.options.editor.removeCommandListener(this.commandListener);
        this.options.editor.removeActiveModelChangeListener(this.activeModelChangeListener);
    };

    IndexDialog.prototype.handleCommand = function (command) {
        if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand ||
            command instanceof Brightics.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand ||
            command instanceof Brightics.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand ||
            command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand ||
            command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand ||
            command instanceof Brightics.VA.Core.Editors.Diagram.Commands.AddFnUnitParameterCommand) {
            return;
        }

        this.refresh();
    };

    IndexDialog.prototype.getTitle = function () {
        return 'Index';
    };

    IndexDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-main-index">' +
            // '   <div class="brtc-va-dialogs-header">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.getTitle()) + '</div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents" style="padding-right: 20px;padding-left: 20px;">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '       </div>' +
            '   </div>' +
            '</div>');

        var opts = this._configureDialogOption({
            theme: Brightics.VA.Env.Theme,
            title: this.getTitle(),
            position: {
                my: "left top",
                at: "left bottom",
                of: this.$parent.find('.brtc-style-s-editor-toolitem[item-type=index]')
            },
            width: 400,
            height: 600,
            maxWidth: 400,
            maxHeight: 600,
            modal: false,
            resizable: false,
        });
        this.$mainControl.dialog(opts);
        this.$mainControl.parent().draggable("option", "containment", this.$parent);
        $('.ui-dialog-titlebar.ui-widget-header', $(this).parent()).css('width', 'calc(100% - 60px) !important');
    };

    IndexDialog.prototype.createDialogContentsArea = function ($parent) {
        var $container = $('<div class="brtc-va-dialogs-index-item-container"></div>');
        $parent.append($container);

        this.refresh();
        // this.createIndexItems($container);

        $parent.perfectScrollbar();
    };

    IndexDialog.prototype.createIndexItems = function ($container) {
        // function array copy : cause sort
        
        var functions = this.options.editor.getActiveModel().functions.slice();
        functions.sort(function (a, b) {
            var p1 = a.display.diagram.position;
            var p2 = b.display.diagram.position;
            if (p1.x < p2.x) {
                return -1;
            } else if (p1.x == p2.x) {
                if (p1.y < p2.y) {
                    return -1
                } else if (p1.y == p2.y) {
                    return 0;
                } else {
                    return 1;
                }
            } else {
                return 1;
            }
        });

        for (var i in functions) {
            var clazz = functions[i].parent().type;
            var funcDef = Brightics.VA.Core.Interface.Functions[clazz][functions[i].func];

            var $item = $('' +
                '<div class="brtc-va-dialogs-index-item">' +
                '   <div class="brtc-va-dialogs-index-item-label"></div>' +
                '   <div class="brtc-va-dialogs-index-item-func"></div>' +
                '</div>');
            $item.attr('id', functions[i].fid);
            $item.addClass('brtc-va-fnunit-category-' + funcDef.category);
            $item.find('.brtc-va-dialogs-index-item-label').attr('title', functions[i].display.label);
            $item.find('.brtc-va-dialogs-index-item-label').text(functions[i].display.label);
            $item.find('.brtc-va-dialogs-index-item-func').text(funcDef.defaultFnUnit.display.label);

            $container.append($item);
        }

        var _this = this;
        $container.find('.brtc-va-dialogs-index-item').click(function () {
            if ($(this).hasClass('brtc-va-dialogs-index-item-select')) {
                return;
            }

            $container.children().removeClass('brtc-va-dialogs-index-item-select');
            $(this).addClass('brtc-va-dialogs-index-item-select');
            _this.options.editor.selectFunction($(this).attr('id'));
        });
    };

    IndexDialog.prototype.createDialogButtonBar = function ($parent) {
        // do no create buttons
    };

    IndexDialog.prototype.destroy = function () {
        this.removeListener();

        Brightics.VA.Dialogs.Dialog.prototype.destroy.call(this);
    };

    IndexDialog.prototype.refresh = function () {
        var $container = this.$mainControl.find('.brtc-va-dialogs-index-item-container');
        $container.empty();

        this.createIndexItems($container);
        this.$mainControl.find('.brtc-va-dialogs-contents').perfectScrollbar('update');
    };

    Brightics.VA.Core.Dialogs.IndexDialog = IndexDialog;

}).call(this);
/**
 * Created by sungjin1.kim on 2017-11-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function InfoDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    InfoDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    InfoDialog.prototype.constructor = InfoDialog;

    InfoDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 655;
        this.dialogOptions.height = this.options.model ? 640 : 500;
    };

    InfoDialog.prototype.createDialogContentsArea = function ($parent) {
        var projectCreateTime = moment(this.options.project.getCreateTime()).format('YYYY-MM-DD HH:mm:ss');
        var $modelInfoDialog = $('' +
            '<div class="brtc-style-editors-model-info-tooltip brtc-va-editors-tooltip-modelinfo">' +
            '   <div class="date_area"/>' +
            '</div>');
        $parent.append($modelInfoDialog);

        if (this.options.model) {
            var modelCreateTime = moment(this.options.model.getCreateTime()).format('YYYY-MM-DD');
            var modelUpdateTime = moment(this.options.model.getUpdateTime()).format('YYYY-MM-DD');

            $modelInfoDialog.find('.date_area').append('' +
                '<p>' +
                '   <span>Updated on</span>' +
                '   <span class="value">' + modelUpdateTime + '</span>' +
                '   <span>by</span>' +
                '   <span class="value updater">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.model.getUpdater()) + '</span>' +
                '</p>' +
                '<p>' +
                '   <span>Created on</span>' +
                '   <span class="value">' + modelCreateTime + '</span>' +
                '   <span>by</span>' +
                '   <span class="value creator">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.model.getCreator()) + '</span>' +
                '</p>');
            $modelInfoDialog.find('.date_area .value.updater').attr('title', this.options.model.getUpdater());
            $modelInfoDialog.find('.date_area .value.creator').attr('title', this.options.model.getCreator());

            var description = this.options.model.getDescription() !== '<p><br /></p>' ? this.options.model.getDescription() : 'There is no description for this model.';
            $modelInfoDialog.find('.date_area').append('' +
                '<div class="model_description">' + description + '</div>');
            $modelInfoDialog.append('' +
                '   <div class="project_area">' +
                '       <p class="proj_title">Project</p>' +
                '       <p class="proj_name">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.project.getLabel()) + '</p>' +
                '       <p class="create">' +
                '           <span>Created on</span><span class="value">' + projectCreateTime + '</span>' +
                '           <span>by</span><span class="value creator">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.project.getCreator()) + '</span></p>' +
                '   </div>' +
                '');

            $modelInfoDialog.find('.proj_name').attr('title', this.options.project.getLabel());
            $modelInfoDialog.find('.project_area .value.creator').attr('title', this.options.project.getCreator());
        } else {
            $modelInfoDialog.find('.date_area').append('' +
                '<p>' +
                '   <span>Created on</span>' +
                '   <span class="value">' + projectCreateTime + '</span>' +
                '   <span>by</span>' +
                '   <span class="value creator">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.project.getCreator()) + '</span>' +
                '</p>');
            $modelInfoDialog.find('.date_area .value.creator').attr('title', this.options.project.getCreator());

            var description = this.options.project.getDescription() !== '<p><br /></p>' ? this.options.project.getDescription() : 'There is no description for this project.';
            $modelInfoDialog.find('.date_area').append('<div class="model_description">' + description + '</div>');
        }
        $modelInfoDialog.find('.model_description').perfectScrollbar();
    };

    InfoDialog.prototype.createDialogButtonBar = function ($parent) {

    };

    Brightics.VA.Core.Dialogs.InfoDialog = InfoDialog;

}).call(this);
/**
 * Created by gy84.bae on 2016-10-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function InputDataFrameEditorDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    InputDataFrameEditorDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    InputDataFrameEditorDialog.prototype.constructor = InputDataFrameEditorDialog;

    InputDataFrameEditorDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        this.PARAM_COLUMN_NAMES = 'column-names';
        this.PARAM_TYPE_ARRAY = 'column-types';
        this.PARAM_DATA_ARRAY = 'data-array';

        if (this.options.context) {
            this.PARAM_COLUMN_NAMES = 'col_names';
            this.PARAM_TYPE_ARRAY = 'type_array';
            this.PARAM_DATA_ARRAY = 'data_array';
        }

        this.$gridArea = $('' +
            '<div class="brtc-va-dialogs-contents-grid-area" style="width:100%; height:100%; box-sizing: border-box; padding-bottom:20px;">' +
            '   <div class="brtc-va-dialogs-contents-grid" style="width:100%; height:100%; box-sizing: border-box;"></div>' +
            '</div>');
        $parent.append(this.$gridArea);

        this.createGridArea(this.$gridArea.find('.brtc-va-dialogs-contents-grid'));
    };

    InputDataFrameEditorDialog.prototype.createGridArea = function ($parent) {
        var theme = Brightics.VA.Env.Theme;
        var numberrenderer = function (row, column, value) {
            if (value === 0) {
                return '<div style="text-align: center; margin-top: 5px;" title="Column Name">C</div>';
            }
            else {
                return '<div style="text-align: center; margin-top: 5px;">' + (value) + '</div>';
            }
        };
        var datafields = [];
        var columns = [];
        for (var i = 0; i < 26; i++) {
            var text = String.fromCharCode(65 + i);
            if (i == 0) {
                var cssclass = 'jqx-widget-header';
                if (theme != '') cssclass += ' jqx-widget-header-' + theme;
                columns[columns.length] = {
                    pinned: true,
                    exportable: false,
                    text: "",
                    columntype: 'number',
                    cellclassname: cssclass,
                    cellsrenderer: numberrenderer
                };
            }
            datafields[datafields.length] = {name: text};
            columns[columns.length] = {
                text: text, datafield: text, width: 60, align: 'center',
                cellsrenderer: function (row, datafield, value) {
                    var $cell = $('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');
                    $cell.attr('title', value);
                    $cell.text(value);
                    return $('<div>').append($cell.clone()).html();
                }
            };
        }
        var source = {
            unboundmode: true,
            totalrecords: 100,
            datafields: datafields,
            localdata: this.getFormattedLocalData()
        };
        var dataAdapter = new $.jqx.dataAdapter(source);

        this.grid = $parent.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '100%',
            rowsheight: 25,
            source: dataAdapter,
            editable: true,
            editmode: 'click',
            columnsresize: true,
            selectionmode: 'multiplecellsadvanced',
            columns: columns            
        });
    };

    InputDataFrameEditorDialog.prototype.getFormattedLocalData = function () {
        var _this = this;
        var localData = [];

        var columnNames = _this.options.fnUnit.param[_this.PARAM_COLUMN_NAMES];
        var dataArray = _this.options.fnUnit.param[_this.PARAM_DATA_ARRAY];

        if (columnNames.length > 0) {
            localData[0] = {};
            for (var i = 0; i < columnNames.length; i++) {
                localData[0][String.fromCharCode(i + 'A'.charCodeAt(0))] = columnNames[i];
            }

            for (var i = 0; i < dataArray.length; i++) {
                localData[(i + 1)] = {};
                for (var j = 0; j < dataArray[i].length; j++) {
                    localData[(i + 1)][String.fromCharCode(j + 'A'.charCodeAt(0))] = dataArray[i][j];
                }
            }
        }
        return localData;
    };

    InputDataFrameEditorDialog.prototype.handleOkClicked = function () {
        try {
            this.setRows(this.grid.jqxGrid('getrows'));
            this.setColumnNames(this.getRows());
            this.setDataArray(this.getRows());

            this.dialogResult[this.PARAM_COLUMN_NAMES] = this.getColumnNames();
            this.dialogResult[this.PARAM_DATA_ARRAY] = this.getDataArray();

            this.dialogResult.OK = true;
            this.dialogResult.Cancel = false;

            this.$mainControl.dialog('close');
        }
        catch (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(err.message);
        }
    };

    InputDataFrameEditorDialog.prototype.setRows = function (rows) {
        this.rows = rows;
    };

    InputDataFrameEditorDialog.prototype.getRows = function () {
        return this.rows;
    };

    InputDataFrameEditorDialog.prototype.setColumnNames = function (rows) {
        if (this.isValidColumnNames(rows[0])) {
            var columnNames = [];            
            for (var key = 'A'; key <= 'Z'; key = String.fromCharCode((key).charCodeAt(0) + 1)) {
                if (rows[0][key]) columnNames.push(rows[0][key]);
                else break;
            }
            this.columnNames = columnNames;
        }
        else {
            throw new Error(this.getValidationErrorMessage());
        }
    };

    InputDataFrameEditorDialog.prototype.getColumnNames = function () {
        return this.columnNames;
    };

    InputDataFrameEditorDialog.prototype.setDataArray = function (rows) {
        var dataArray = [];
        var lastRowIndex = -1;
        for (var i = 1; i < rows.length; i++) {
            dataArray[(i - 1)] = [];

            var lastKey = String.fromCharCode('A'.charCodeAt(0) + this.getColumnNames().length - 1);
            for (var key = 'A'; key <= lastKey; key = String.fromCharCode((key).charCodeAt(0) + 1)) {
                if (rows[i][key]) lastRowIndex = i;
                if (rows[i][key] === undefined) {
                    dataArray[(i - 1)].push('');
                }
                else if (rows[i][key] === null) {
                    dataArray[(i - 1)].push('');
                }
                else {
                    dataArray[(i - 1)].push(rows[i][key])
                }
            }
        }
        if (this.isValidDataArray(lastRowIndex)) {
            dataArray.splice(lastRowIndex, dataArray.length - lastRowIndex);
            this.dataArray = dataArray;
        } else {
            throw  new Error(this.getValidationErrorMessage());
        }
    };

    InputDataFrameEditorDialog.prototype.getDataArray = function () {
        return this.dataArray;
    };

    InputDataFrameEditorDialog.prototype.isValidDataArray = function (lastRowIndex) {
        var isValid = true;
        if (lastRowIndex === -1) {
            this.validationErrorMessage = 'There is no data. Please input data.';
            isValid = false;
        }
        return isValid;
    };

    InputDataFrameEditorDialog.prototype.isValidColumnNames = function (columnNameData) {
        var isValid = true;

        var isExists = this.isExistsColumns(columnNameData);
        if (!isExists) {
            this.validationErrorMessage = 'There is no column. Please input column names in the first row.';
            return false;
        }

        var emptyColumns = this.getInvalidEmptyColumns(columnNameData);
        if (emptyColumns.length) {
            this.validationErrorMessage = 'All column names should be given but the column names of ' + JSON.stringify(emptyColumns) + ' are not given. Please check the input.';
            return false;
        }

        var invalidColumns = this.getInvalidColumnNames(columnNameData);
        if (invalidColumns.length) {
            this.validationErrorMessage = "All column names should start with alphabet characters. You can use alphabet, number, and '_' only. Please check the input in " + JSON.stringify(invalidColumns) + ".";
            return false;
        }

        var duplicatedColumns = this.getDuplicatedColumnNames(columnNameData);
        if (duplicatedColumns.length) {
            this.validationErrorMessage = 'There are columns of the same name. Column names do not distinguish upper and lower cases. Please check the column names. ' + JSON.stringify(duplicatedColumns) + '.';
            return false;
        }

        return isValid;
    };

    InputDataFrameEditorDialog.prototype.isExistsColumns = function (columnNameData) {
        var isExists = false;
        for (var key = 'A'; key <= 'Z'; key = String.fromCharCode((key).charCodeAt(0) + 1)) {
            if (columnNameData[key]) {
                isExists = true;
                break;
            }
        }
        return isExists;
    };

    InputDataFrameEditorDialog.prototype.getInvalidEmptyColumns = function (columnNameData) {
        var isEmpty = false;

        var lastElementIndex = -1;
        var firstEmptyIndex = -1;

        var emptyColumns = [];
        
        for (var key = 'A'; key <= 'Z'; key = String.fromCharCode((key).charCodeAt(0) + 1)) {
            if (columnNameData[key]) {
                lastElementIndex = (key).charCodeAt(0) - 'A'.charCodeAt(0); //get ASCII code
            } else {
                if (!isEmpty) {
                    isEmpty = true;
                    firstEmptyIndex = (key).charCodeAt(0) - 'A'.charCodeAt(0); //get ASCII code
                }
                emptyColumns.push(key);
            }
        }
        
        emptyColumns = $.grep(emptyColumns, function (el, index) {
            return (((el).charCodeAt(0) - 'A'.charCodeAt(0)) < lastElementIndex);
        });
        return emptyColumns;
    };

    InputDataFrameEditorDialog.prototype.getInvalidColumnNames = function (columnNameData) {
        var invalidColumnNames = [];

        for (var key = 'A'; key <= 'Z'; key = String.fromCharCode((key).charCodeAt(0) + 1)) {
            var target = columnNameData[key];
            if (target) {
                var reg1 = new RegExp('^[가-힣a-zA-Z0-9_]+$');
                var reg2 = new RegExp('^[0-9]+');
                if (!reg1.test(target) || reg2.test(target)) {
                    invalidColumnNames.push(key);
                }
            }
        }
        return invalidColumnNames;
    };

    InputDataFrameEditorDialog.prototype.getDuplicatedColumnNames = function (columnNameData) {
        var duplicatedColumnNames = [];
        var hashMap = {};
        
        for (var key = 'A'; key <= 'Z'; key = String.fromCharCode((key).charCodeAt(0) + 1)) {
            var columnName = columnNameData[key];
            if (columnName) {
                var hasKey = columnName.toLowerCase();
                if (hashMap[hasKey]) {
                    hashMap[hasKey].push(key);
                }
                else {
                    hashMap[hasKey] = [key];
                }
            }
        }

        for (var columnKey in hashMap) {
            if (hashMap[columnKey].length > 1) {
                duplicatedColumnNames = hashMap[columnKey];
                break;
            }
        }
        return duplicatedColumnNames;
    };

    InputDataFrameEditorDialog.prototype.getValidationErrorMessage = function () {
        return this.validationErrorMessage;
    };

    Brightics.VA.Core.Dialogs.InputDataFrameEditorDialog = InputDataFrameEditorDialog;

}).call(this);
/**
 * Created by SDS on 2016-10-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function InputDataPathDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    InputDataPathDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    InputDataPathDialog.prototype.constructor = InputDataPathDialog;

    InputDataPathDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 700;
        this.dialogOptions.height = 700;
    };
    
    InputDataPathDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-repository-browser-contents');

        $parent.append('' +
            '<div class="brtc-va-dialogs-repository-browser-tree"></div>' +
            '<div class="brtc-va-dialogs-repository-browser-file-layout">' +
            '   <div class="brtc-va-dialogs-repository-browser-file-label">File Path</div>' +
            '   <div class="brtc-va-dialogs-repository-browser-file-input"><textarea></textarea></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-repository-browser-setting-option">' +
            '   <div class="brtc-va-dialogs-repository-browser-radio" value="static">Set a static file path for users repository.</div>' +
            '   <div class="brtc-va-dialogs-repository-browser-radio" value="dynamic">Set a dynamic file path for users repository.</div>' +
            '</div>' +

            '');

        this.createRepositoryTree($parent.find('.brtc-va-dialogs-repository-browser-tree'));
        this.createSettingOptionControl($parent.find('.brtc-va-dialogs-repository-browser-setting-option'));
        this.createFilePathControl($parent.find('.brtc-va-dialogs-repository-browser-file-input > textarea'));
    };

    InputDataPathDialog.prototype.createRepositoryTree = function ($control) {
        var _this = this;
        this.repositoryViewer = new Brightics.VA.Core.Controls.RepositoryViewer($control);
        this.repositoryViewer.$tree.on('select', function (event) {
            var path = _this.repositoryViewer.getSelectedPath();
            _this._setFilePath(path);
        });
    };

    InputDataPathDialog.prototype.createSettingOptionControl = function ($control) {
        var _this = this,
            $optionControl = $control.find('.brtc-va-dialogs-repository-browser-radio');
        this.$settingOptionGroup = $control;
        $optionControl.jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            groupName: 'repository-browser-setting-option'
        });

        $optionControl.on('checked', function () {
            var path = _this.repositoryViewer.getSelectedPath() || _this.options.filePath;
            _this._setFilePath(path);
        });

        if (this.options.filePath.match(/\/users\/\$\{sys.user\}\//g)) {
            this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio[value=dynamic]').jqxRadioButton('check');
        } else {
            this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio[value=static]').jqxRadioButton('check');
        }

        this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio').hide();
    };

    InputDataPathDialog.prototype.createFilePathControl = function ($control) {
        this.fileName = CodeMirror.fromTextArea($control[0], {
            mode: 'text',
            theme: 'default',
            indentWithTabs: false,
            smartIndent: false,
            lineNumbers: false,
            matchBrackets: true,
            scrollbarStyle: 'null',
            autofocus: false
        });
        this.fileName.on('beforeChange', function (instance, change) {
            var newtext = change.text.join('').replace(/\n/g, ''); // remove ALL \n
            change.update(change.from, change.to, [newtext]);
            return true;
        });
        this.fileName.setSize('100%', '100%');

        if (this.options.filePath) {
            this._setFilePath(this.options.filePath);
        }
        var additionalOption = {
            'valid-type': 'fileNameType',
            'valid-message-position': 'bottom'
        };
        Brightics.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.fileName, additionalOption);
    };

    InputDataPathDialog.prototype._setFilePath = function (path) {
        if (!path) return;

        var matched1 = path.match(/^\/brtc\/repo\/shared\/[^\/]*/);
        var matched2 = path.match(/^\/brtc\/repo\/users\/[^\/]+\/[^\/]*/);
        this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio').hide();

        if (matched1) {
            this.fileName.setValue(path);
            this.fileName.markText({line: 0, ch: 0}, {line: 0, ch: 18}, {
                readOnly: true,
                inclusiveLeft: true,
                css: 'color: #b4b4b4'
            });
        } else if (matched2) {
            this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio').show();
            var ch = 0,
                filePath = path;
            if (this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio[value=dynamic]').val()) {
                filePath = filePath.replace(/\/users\/\S*\//g, '/users/${sys.user}/');
            } else {
                filePath = filePath.replace(/\/users\/\$\{sys\.user\}\//g, '/users/' + Brightics.VA.Env.Session.userId + '/');
            }
            var segments = filePath.split('/');
            this.fileName.setValue(filePath);
            for (var i = 0; i < 5; i++) {
                ch += segments[i].length;
                ch++;
            }
            this.fileName.markText({line: 0, ch: 0}, {line: 0, ch: ch}, {
                readOnly: true,
                inclusiveLeft: true,
                css: 'color: #b4b4b4'
            });
        } else {
            filePath = path + '/';
            if (this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio[value=dynamic]').val()) {
                filePath = filePath.replace(/\/users\/\S*\//g, '/users/${sys.user}/');
            } else {
                filePath = filePath.replace(/\/users\/\$\{sys\.user\}\//g, '/users/' + Brightics.VA.Env.Session.userId + '/');
            }
            this.fileName.setValue(filePath);
            this.fileName.markText({line: 0, ch: 0}, {line: 0, ch: filePath.length + 1}, {
                readOnly: true,
                inclusiveLeft: true,
                css: 'color: #b4b4b4'
            });
        }
    };

    InputDataPathDialog.prototype.handleOkClicked = function () {
        var file = this.fileName.getValue().trim();
        if (file) {
            var matched1 = file.match(/^\/brtc\/repo\/shared\/[^\/]+$/);
            var matched2 = file.match(/^\/brtc\/repo\/users\/[^\/]+\/[^\/]+$/);
            var matched3 = file.match(/^\/brtc\/repo\/users\/\$\{sys\.user\}\/[^\/]+$/);

            //"."가 2개이상 연속되면 Error 발생
            var temp = "";
            var intCnt = 0;
            for (var i = 0; i < file.length; i++) {
                temp = file.charAt(i);
                if (temp == '.' || temp == '@' || temp == '/') {
                    if (temp == file.charAt(i + 1)) {
                        intCnt = intCnt + 1;
                    }
                }
            }
            if (intCnt > 0) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Invalid file path.');
                return;
            }
            if (matched1 || matched2 || matched3) {
                this.dialogResult.selectedFile = file;
                Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Invalid file path.');
            }
        } else {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('At least one file must be selected.');
        }
    };

    Brightics.VA.Core.Dialogs.InputDataPathDialog = InputDataPathDialog;

}).call(this);
/**
 * Created by daewon.park on 2016-09-21.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function InviteMemberDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    InviteMemberDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    InviteMemberDialog.prototype.constructor = InviteMemberDialog;

    InviteMemberDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 600;
        this.dialogOptions.height = 700;
        this.dialogOptions.maxWidth = 600;
        this.dialogOptions.maxHeight = 700;
        this.dialogOptions.create = function () {
            $('.ui-widget-content').css('border','none');
        }
    };

    InviteMemberDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-invite-member-contents');

        $parent.append('' +
            '<input type="search" class="brtc-va-dialogs-invite-member-search">' +
            '<div class="brtc-va-dialogs-invite-member-search-user-label"><span>Total</span><span>0</span></div>' +
            '<div class="brtc-va-dialogs-invite-member-search-user-grid"></div>' +
            '<div class="brtc-va-dialogs-invite-member-register-member-authority"></div>' +
            '<div class="brtc-va-dialogs-invite-member-register-member-remove"></div>' +
            '<div class="brtc-va-dialogs-invite-member-register-member-label"><span>Total</span><span>0</span></div>' +
            '<div class="brtc-va-dialogs-invite-member-register-member-grid"></div>' +
            '');

        this.createSearchControl($parent);
        this.createUserGrid($parent);
        this.createAuthorityCombo($parent);
        this.createRemoveMemberButton($parent);
        this.createMemberGrid($parent);
    };

    InviteMemberDialog.prototype.updateUserCount = function () {
        if (this.$userGrid) {
            var rows = this.$userGrid.jqxGrid('getrows');
            this.$mainControl.find('.brtc-va-dialogs-invite-member-search-user-label > span:nth-child(2)').text(rows.length);
        }
    };

    InviteMemberDialog.prototype.updateMemberCount = function () {
        if (this.$memberGrid) {
            var rows = this.$memberGrid.jqxGrid('getrows');
            this.$mainControl.find('.brtc-va-dialogs-invite-member-register-member-label > span:nth-child(2)').text(rows.length);
        }
    };

    InviteMemberDialog.prototype.createSearchControl = function ($parent) {
        var _this = this;
        this.$searchControl = $parent.find('.brtc-va-dialogs-invite-member-search').jqxInput({
            placeHolder: 'Search for Name, ID',
            theme: Brightics.VA.Env.Theme
        });
        this.$searchControl.keypress(function (event) {
            if (event.keyCode == 13) {
                _this.searchUser(_this.$searchControl.val());
            }
        });
        this.$searchControl.focus();
    };

    InviteMemberDialog.prototype.searchUser = function (pattern) {
        var source = this._createUserGridSource();
        this.$userGrid.jqxGrid('source', source);
    };

    InviteMemberDialog.prototype._createUserGridSource = function () {
        var source = {
            datatype: 'json',
            datafields: [
                {name: 'name', type: 'string'},
                {name: 'id', type: 'string'}
            ]
        };
        if (this.$searchControl.val().trim()) {
            source.url = 'api/admin/v2/users?pattern=' + encodeURIComponent(this.$searchControl.val());
        } else {
            source.localdata = [];
        }
        return new $.jqx.dataAdapter(source);
    };

    InviteMemberDialog.prototype.createUserGrid = function ($parent) {
        var _this = this;

        $parent.find('.brtc-va-dialogs-invite-member-search-user-grid').on('bindingcomplete', function () {
            _this.updateUserCount();
        });

        var source = this._createUserGridSource();
        this.$userGrid = $parent.find('.brtc-va-dialogs-invite-member-search-user-grid').jqxGrid({
            theme: Brightics.VA.Env.Theme,
            source: source,
            width: '100%',
            rowsheight: 25,
            height: 'calc(50% - 80px)',
            altrows: false,
            filterable: false,
            sortable: false,
            columnsresize: true,
            enabletooltips: true,
            columns: [
                {
                    text: 'Name', datafield: 'name', width: 240,
                    cellsrenderer: function (row, column, value) {
                        return '<div class="jqx-grid-cell-left-align" style="margin-top: 4px;">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(value) + '</div>';
                    }
                },
                {text: 'ID', datafield: 'id'}
            ]
        });
        this.$userGrid.on('rowclick', function (event) {
            var item = _this.$authorityCombo.jqxDropDownList('getSelectedItem');
            var role_id = item.value;
            var role_label = item.label;

            var args = event.args;
            var user = _this.$userGrid.jqxGrid('getrowdata', args.rowindex);
            var member = {
                user_name: user.name,
                user_id: user.id,
                role_id: role_id,
                role_label: role_label
            };
            var isSelected = false,
                isInvitedAlready = false;


            var rows = _this.$memberGrid.jqxGrid('getrows');
            for (var i in rows) {
                if (rows[i].user_id == user.id) {
                    isSelected = true;
                }
            }

            for (var i in _this.options.members) {
                if (_this.options.members[i].user_id == user.id) {
                    isInvitedAlready = true;
                }
            }

            if (!isSelected) {
                if (isInvitedAlready) {
                    Brightics.VA.Core.Utils.WidgetUtils.openWarningDialog(user.id + ' is invited already.', function () {
                    });
                } else {
                    _this.$memberGrid.jqxGrid('addrow', null, member);
                    _this.updateMemberCount();
                }

            }
        });
    };

    InviteMemberDialog.prototype.createRemoveMemberButton = function ($parent) {
        var _this = this;
        $parent.find('.brtc-va-dialogs-invite-member-register-member-remove').click(function () {
            var uids = [];
            var indexes = _this.$memberGrid.jqxGrid('getselectedrowindexes');
            for (var i in indexes) {
                var row = _this.$memberGrid.jqxGrid('getrowdata', indexes[i]);
                uids.push(row.uid);
            }
            _this.$memberGrid.jqxGrid('deleterow', uids);
            _this.updateMemberCount();
        });
    };

    InviteMemberDialog.prototype.createMemberGrid = function ($parent) {
        var _this = this;

        $parent.find('.brtc-va-dialogs-invite-member-register-member-grid').on('bindingcomplete', function () {
            _this.updateMemberCount();
        });

        var source = {
            datatype: 'local',
            datafields: [
                {name: 'user_name', type: 'string'},
                {name: 'user_id', type: 'string'},
                {name: 'role_id', type: 'string'},
                {name: 'role_label', type: 'string'}
            ],
            localdata: [],
            addrow: function (rowid, rowdata, position, commit) {
                commit(true);
            },
            deleterow: function (rowid, commit) {
                commit(true);
            }
        };
        var dataAdapter = new $.jqx.dataAdapter(source);
        this.$memberGrid = $parent.find('.brtc-va-dialogs-invite-member-register-member-grid').jqxGrid({
            theme: Brightics.VA.Env.Theme,
            source: dataAdapter,
            width: '100%',
            height: 'calc(50% - 80px)',
            rowsheight: 25,
            altrows: false,
            filterable: false,
            sortable: false,
            columnsresize: true,
            selectionmode: 'multiplerowsextended',
            enabletooltips: true,
            columns: [
                {
                    text: 'Name', datafield: 'user_name', width: 240,
                    cellsrenderer: function (row, column, value) {
                        return '<div class="jqx-grid-cell-left-align" style="margin-top: 4px;">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(value) + '</div>';
                    }
                },
                {text: 'ID', datafield: 'user_id', width: 240},
                {text: 'Authority', datafield: 'role_label'}
            ]
        });
    };

    InviteMemberDialog.prototype.createAuthorityCombo = function ($parent) {
        this.$authorityCombo = $parent.find('.brtc-va-dialogs-invite-member-register-member-authority').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            source: [
                {id: 'role_10002', label: 'as Organizer'},
                {id: 'role_10003', label: 'as Member'},
                {id: 'role_10004', label: 'as Reporter'}
            ],
            displayMember: 'label',
            valueMember: 'id',
            itemHeight: 29,
            dropDownWidth: 118,
            selectedIndex: 1
        });
    };

    InviteMemberDialog.prototype.handleOkClicked = function () {
        var _this = this;
        var rows = this.$memberGrid.jqxGrid('getrows');
        if (rows.length == 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('At least one member must be selected.');
        } else {
            var options = {
                members: []
            };
            for (var i in rows) {
                var member = rows[i];
                options.members.push({
                    user_id: member.user_id,
                    role_id: member.role_id
                });
            }
            var opt = {
                url: 'api/va/v2/ws/projects/' + _this.options.projectId + '/members/invite',
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                blocking: true,
                data: JSON.stringify(options)
            };
            $.ajax(opt).done(function (result) {
                Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Invited ' + result + ' members.', function () {
                    Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(_this);
                });
            }).fail(function (error) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
            });
        }
    };

    Brightics.VA.Core.Dialogs.InviteMemberDialog = InviteMemberDialog;

}).call(this);
/**
 * Created by daewon.park on 2016-09-25.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function LaunchProgressDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);

        this.terminated = false;
    }

    LaunchProgressDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    LaunchProgressDialog.prototype.constructor = LaunchProgressDialog;

    LaunchProgressDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 680;
        this.dialogOptions.height = 540;
        this.dialogOptions.keyboardCloseKey = '';
        this.dialogOptions.closeOnEscape = false;
        this.dialogOptions.create = function () {
            $('.ui-widget-content').css('border-color', '#d4d4d4');
            $('.ui-dialog-titlebar-close', $(this).parent()).hide();
        }
    };

    LaunchProgressDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        $parent.parent().parent().addClass('brtc-va-dialogs-launch-progress');
        $parent.addClass('brtc-va-dialogs-launch-progress-contents');

        $parent.append('' +
            '<div class="brtc-va-dialogs-launch-progress-label"><span>Starting...</span><span class="brtc-va-dialogs-launch-progress-elapsed"></span><span></span></div>' +
            '<div class="brtc-va-dialogs-launch-progress-progressbar"></div>' +
            '<div class="brtc-va-dialogs-launch-progress-tab">' +
            '   <ul>' +
            '       <li style="margin-left: 0; width: 80px">Status</li>' +
            '       <li style="width: 80px">Log</li>' +
            '   </ul>' +
            '   <div>' +
            '       <div>' +
            '           <div class="brtc-va-dialogs-launch-progress-processes">' +
            '           </div>' +
            '       </div>' +
            '       <div>' +
            '           <textarea class="brtc-va-dialogs-launch-progress-logs" style="display: none"></textarea>' +
            '       </div>' +
            '   </div>' +
            '</div>');

        this.$progressBar = $parent.find('.brtc-va-dialogs-launch-progress-progressbar').jqxProgressBar({
            theme: Brightics.VA.Env.Theme,
            value: 3,
            animationDuration: 0
        });

        this.$progressTab = $parent.find('.brtc-va-dialogs-launch-progress-tab').jqxRibbon({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 'calc(100% - 70px)',
            position: 'bottom',
            selectionMode: 'click',
            initContent: function (index) {
                if (index == 0) {
                    _this.$processScrollbar = $parent.find('.brtc-va-dialogs-launch-progress-processes').perfectScrollbar();
                } else if (index == 1) {
                    _this.logMirror = CodeMirror.fromTextArea($parent.find('.brtc-va-dialogs-launch-progress-logs')[0], {
                        mode: "text/html",
                        theme: "default",
                        lineNumbers: false,
                        matchBrackets: true,
                        autofocus: false,
                        readOnly: true
                    });
                    _this.logMirror.setSize('100%', '100%');
                }
            }
        }).addClass('brtc-va-dialogs-launch-progress-tab');

        this.$progressTab.jqxRibbon('hideAt', 1);

        setTimeout(this._renderTimer.bind(this), 500);

        this.createCloseOptionCheckBox($parent);
    };

    LaunchProgressDialog.prototype.createDialogButtonBar = function ($parent) {
        Brightics.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this, $parent);

        this.$okButton.val('Done');
        this.$okButton.css('display', 'none');

        this.$cancelButton.val('Stop Running');

        this.createDetailButton($parent);
        this.createDetailOptimizationButton($parent);
    };

    LaunchProgressDialog.prototype.createDetailButton = function ($parent) {
        var _this = this;
        this.$detailButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-detail" value="Detail" />');
        $parent.append(this.$detailButton);
        this.$detailButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        this.$detailButton.click(function () {
            var message = 'JOB ID: ' + _this.options.jobId;
            message += '\n' + (_this.errorDetailMessage || _this.errorMessage);
            new Brightics.VA.Core.Dialogs.DetailDialog(_this.$mainControl, {
                title: 'Detail Information',
                detailText: message
            });
        });
        this.$detailButton.hide();
    };

    LaunchProgressDialog.prototype.createDetailOptimizationButton = function ($parent) {
        var _this = this;
        this.$detailOptButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-detail" value="Detail Optimization" />');
        $parent.append(this.$detailOptButton);
        this.$detailOptButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$detailOptButton.click(function () {
            if (_this.optProgressDialog) {
                _this.optProgressDialog.render(_this.eventOriginalResponse);
            } else {
                _this.optProgressDialog = new Brightics.VA.Core.Dialogs.OptProgressDialog(null, {
                    data: _this.eventOriginalResponse,
                    close: function () {
                        _this.optProgressDialog = null;
                    }
                });
            }
        });
        this.$detailOptButton.hide();
    };

    LaunchProgressDialog.prototype._showDetailOptimizationButton = function (originalResponse) {
        var optimization = this._getOptimizationData(originalResponse);
        if (optimization) {
            this.eventOriginalResponse = originalResponse;
            this.$detailOptButton.show();
            if (this.optProgressDialog) {
                this.optProgressDialog.render(this.eventOriginalResponse);
            }
        }
    };

    LaunchProgressDialog.prototype._getOptimizationData = function (originalResponse) {
        if (originalResponse) {
            var processes = originalResponse.processes;
            if (!processes) return null;
            for (var i = processes.length - 1; i >= 0; i--) {
                var functions = processes[i].functions;
                for (var j = functions.length - 1; j >= 0; j--) {
                    var optimization = functions[j].optimization;
                    if (optimization) {
                        return optimization;
                    }
                }
            }
        }
        return null;
    };

    LaunchProgressDialog.prototype.createCloseOptionCheckBox = function ($parent) {
        this.$checkboxDiv = $('<div class = "brtc-va-dialogs-launch-progress-closeoption">Close the dialog after the process completes successfully.</div>');
        $parent.append(this.$checkboxDiv);

        this.$checkboxDiv.jqxCheckBox({
            theme: Brightics.VA.Env.Theme,
            checked: Brightics.VA.Env.Session.launchProgressAutoClose
        });
        this.$checkboxDiv.on('change', function (event) {
            var checked = event.args.checked;
            Brightics.VA.Env.Session.launchProgressAutoClose = checked;
        });
    };

    LaunchProgressDialog.prototype.progress = function (event) {
        var label;

        if (event.jid) this.options.jobId = event.jid;

        if (event.eventType == 'BEGIN-JOB') {
            this._beginJob(event.status, event.launchOptions.expectedUnitCount);
        } else if (event.eventType == 'END-JOB') {
            this._endJob(event.status, event.message, event.detailMessage);
        } else if (event.eventType == 'BEGIN-PROCESS') {
            label = event.label || '(default model)';
            this._beginProcess(event.pid, event.status, label, event.count);
        } else if (event.eventType == 'END-PROCESS') {
            this._endProcess(event.pid, event.status, event.begin, event.end);
        } else if (event.eventType == 'BEGIN-UNIT') {
            label = event.label || '(default function)';
            this._beginUnit(event.pid, event.fid, event.status, label, event.message);
        } else if (event.eventType == 'END-UNIT') {
            this._endUnit(event.pid, event.fid, event.status, event.begin, event.end, event.message);
        } else if (event.eventType == 'UPDATE-UNIT') {
            this._updateUnit(event.pid, event.fid, event.status, event.begin, event.end, event.message);
        } else if (event.eventType === 'PENDING-JOB') {
            this._pendingJob(event.status, event.message);
        }

        this.updateStatus(event);
        this._updateProgress(event);
        this._showDetailOptimizationButton(event.originalResponse);
    };

    LaunchProgressDialog.prototype.updateStatus = function (event) {
        var targetEventTypes = ['END-UNIT'];
        if (targetEventTypes.indexOf(event.eventType) > -1) {
            Studio.getEditorContainer().getActiveModelEditor().updateStatus(event);
        }
    };

    LaunchProgressDialog.prototype.handleCancelClicked = function () {
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        Studio.getJobExecutor().terminate(this.options.jobId);
    };

    LaunchProgressDialog.prototype._pendingJob = function (status, message) {
        var label = '0 process, 0 function completed... (' + message + ')';
        this.$mainControl.find('.brtc-va-dialogs-launch-progress-label > span:nth-child(1)').text(label);
        this.$mainControl.find('.brtc-va-dialogs-launch-progress-label > span:nth-child(1)').attr('title', label);
    };

    LaunchProgressDialog.prototype._updateProgress = function (event) {
        if (this.terminated && Brightics.VA.Env.Session.launchProgressAutoClose && event.status !== 'FAIL') return;

        this._updateProgressLabel(event);
        this._updateProgressBar(event);
    };

    LaunchProgressDialog.prototype._updateProgressLabel = function (event) {
        var completedProcesses = this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="SUCCESS"], .brtc-va-dialogs-launch-progress-proc[status="FAIL"]');
        var completedUnits = this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="SUCCESS"], .brtc-va-dialogs-launch-progress-func[status="FAIL"]');

        var label = completedProcesses.length + ' process, ' + completedUnits.length + ' function completed...';

        var pendingStatus = event.eventType === 'PENDING-JOB' ? event.message : '';
        if (this.errorMessage) {
            label = this.errorMessage;
        }
        this.$mainControl.find('.brtc-va-dialogs-launch-progress-label > span:nth-child(1)').text(label);
        this.$mainControl.find('.brtc-va-dialogs-launch-progress-label > span:nth-child(1)').attr('title', label);
        this.$mainControl.find('.brtc-va-dialogs-launch-progress-label > span:nth-child(3)').text(pendingStatus);
    };

    LaunchProgressDialog.prototype._updateProgressBar = function () {
        var value = 10, _this = this;
        var count = this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="SUCCESS"]').length;
        if (this.$mainControl.find('.brtc-va-dialogs-launch-progress-contents').attr('STATUS') == 'SUCCESS') {
            value = 100;
        }
        else {
            value = count * 85 / this.expectedUnitCount + 10;
            if (value > 95) {
                this.expectedUnitCount += 10;
                value = count * 85 / this.expectedUnitCount + 10;
            }
        }

        var _this = this;
        clearTimeout(this.updateTimeout);
        this.updateTimeout = setTimeout(function () {
            _this.$progressBar.jqxProgressBar({ value: value });
        }, 300);
    };

    LaunchProgressDialog.prototype._renderTimer = function () {
        var _this = this;

        if (this.$mainControl && this.$mainControl.find('.brtc-va-dialogs-launch-progress-elapsed').length) {
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-elapsed').each(function (index) {
                var beginTime = $(this).attr('begin');
                if (beginTime) {
                    beginTime = parseInt(beginTime);
                } else {
                    beginTime = Date.now();
                }
                var endTime = $(this).attr('end');
                if (endTime) {
                    endTime = parseInt(endTime);
                } else {
                    endTime = Date.now();
                }
                var elapsed = _this._elapsedString(endTime - beginTime);
                $(this).text('( ' + elapsed + ' )');
            });
        }

        if (this.terminated == false) {
            setTimeout(this._renderTimer.bind(this), 500);
        } else if (Brightics.VA.Env.Session.launchProgressAutoClose) {
            clearTimeout(this._renderTimer);
            return;
        }
    };

    LaunchProgressDialog.prototype._elapsedString = function (elapsed) {
        var diff = elapsed;
        var days = Math.floor(diff / (1000 * 60 * 60 * 24));
        diff -= days * (1000 * 60 * 60 * 24);
        var hours = Math.floor(diff / (1000 * 60 * 60));
        diff -= hours * (1000 * 60 * 60);
        var mins = Math.floor(diff / (1000 * 60));
        diff -= mins * (1000 * 60);
        var seconds = Math.floor(diff / (1000));
        diff -= seconds * (1000);

        var elapsedTime = '';
        if (days > 0) {
            elapsedTime = days + ' day ';
        }
        if (hours > 0) {
            elapsedTime += hours + ' hour ';
        }
        if (mins > 0) {
            elapsedTime += mins + ' min ';
        }
        if (seconds > 0) {
            elapsedTime += seconds + ' sec';
        }

        if (elapsedTime == '') elapsedTime = '1 sec';
        return elapsedTime;
    };

    LaunchProgressDialog.prototype._beginJob = function (status, expectedUnitCount) {
        this.expectedUnitCount = expectedUnitCount;

        this.$mainControl.find('.brtc-va-dialogs-launch-progress-contents').attr('STATUS', status);
        this.$mainControl.find('.brtc-va-dialogs-launch-progress-label .brtc-va-dialogs-launch-progress-elapsed').attr('begin', Date.now());
    };

    LaunchProgressDialog.prototype._endJob = function (status, message, detailMessage) {
        this.$mainControl.find('.brtc-va-dialogs-launch-progress-contents').attr('STATUS', status);
        this.$mainControl.find('.brtc-va-dialogs-launch-progress-label .brtc-va-dialogs-launch-progress-elapsed').attr('end', Date.now());
        this.$mainControl.find('.jqx-window-close-button-background').css('visibility', 'visible');
        this.$okButton.css('display', 'block');
        this.$cancelButton.css('display', 'none');
        if (status === 'FAIL') {
            this.errorMessage = message ? message : '';
            this.errorDetailMessage = detailMessage ? detailMessage : '';

            if (this.errorMessage.indexOf('SparkException:') == 0 ||
                this.errorMessage.indexOf('NoClassDefFoundError:') == 0) {

                this.errorMessage = 'Sorry! An unexpected error occurred. Please contact administrator.';

            } else if (this.errorMessage.indexOf('Exception:') == 0) {
                // if (this.errorMessage.indexOf('Exception: Proper conditional statement should be entered.') == 0) {
                //     this.errorMessage = 'Proper conditional statement should be entered.';
                // } else {
                this.errorMessage = 'Sorry! An unexpected error occurred. Please contact administrator.';//this.errorMessage.substring(10, this.errorMessage.length).trim();
                // }

            } else if (this.errorMessage.indexOf('AnalysisException:') == 0) {

                this.errorMessage = this.errorMessage.substring(18, this.errorMessage.length).trim();

            } else if (this.errorMessage.indexOf('InvalidInputException:') == 0) {

                this.errorMessage = 'Input path does not exist.';

            } else if (this.errorMessage.indexOf('FileNotFoundException:') == 0) {

                this.errorMessage = 'Data Source does not exist.';

            } else if (this.errorMessage == '{"result":"Cannot execute the flow. It contains invalid contents.","resultCode":1100}') {

                this.errorMessage = 'Cannot execute the flow. It contains invalid contents.';

            } else if (this.errorMessage == '\'condition\' is a required parameter.\n\'condition\' is a required parameter.') {

                this.errorMessage = '\'condition\' is a required parameter.';

            } else if (this.errorMessage.startsWith('/home/brightics/brightics/packages/brightics-agent/repo/BRIGHTICS/script') && this.errorMessage.indexOf('error: not found') > 0) {

                this.errorMessage = 'Script contains invalid contents.';
            } else if (this.errorMessage === "'in-table' is not of Array[String] type.") {
                this.errorMessage = 'Inputs is required.';

            } else if (this.errorMessage === "Error: Invalid tid ") {
                this.errorMessage = 'Inputs is required.';
            } else if (this.errorMessage == 'The size of \'fs-paths\' must be 1.') {
                this.errorMessage = '\'Input Path\' is a required parameter.';
            }

            this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="PROCESSING"] > .brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(status));
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="PROCESSING"]').attr('status', status);
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="PROCESSING"] > .brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(status));
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="PROCESSING"]').attr('status', status);

            this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="WAIT"] > .brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(status));
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="WAIT"]').attr('status', status);
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="WAIT"] > .brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(status));
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="WAIT"]').attr('status', status);
        } else if (status === 'ABORT') {
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="PROCESSING"] > .brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(status));
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="PROCESSING"]').attr('status', status);
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="PROCESSING"] > .brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(status));
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="PROCESSING"]').attr('status', status);

            this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="WAIT"] > .brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(status));
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="WAIT"]').attr('status', status);
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="WAIT"] > .brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(status));
            this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="WAIT"]').attr('status', status);
        } else if (status === 'SUCCESS') {
            if (this.$checkboxDiv.val() === true) this.handleOkClicked();
        }

        if (this.errorMessage) this.$detailButton.show();
        this.terminated = true;
    };

    LaunchProgressDialog.prototype._beginProcess = function (pid, status, label, count) {
        var $parent = this.$mainControl.find('.brtc-va-dialogs-launch-progress-processes');

        var $proc = $parent.find('.brtc-va-dialogs-launch-progress-proc[id=' + pid + ']');

        if ($proc.length == 0) {
            $proc = $('' +
                '<div class="brtc-va-dialogs-launch-progress-proc">' +
                '    <div class="brtc-va-dialogs-launch-progress-proc-icon">' +
                '        <div class="brtc-va-dialogs-launch-progress-icon"></div>' +
                '    </div>' +
                '    <div class="brtc-va-dialogs-launch-progress-proc-label"></div>' +
                '    <div class="brtc-va-dialogs-launch-progress-proc-status"></div>' +
                '    <div class="brtc-va-dialogs-launch-progress-elapsed brtc-va-dialogs-launch-progress-proc-elapsed"></div>' +
                '    <div class="brtc-va-dialogs-launch-progress-functions">' +
                '    </div>' +
                '</div>');
            $proc.attr('id', pid);
            $parent.append($proc);
            $proc.find('.brtc-va-dialogs-launch-progress-proc-elapsed').attr('begin', Date.now());
            $proc.find('.brtc-va-dialogs-launch-progress-proc-elapsed').removeAttr('end');
        }
        if ($proc.attr('status') === 'WAIT' && status === 'PROCESSING') $proc.find('.brtc-va-dialogs-launch-progress-proc-elapsed').attr('begin', Date.now());
        $proc.attr('status', status);

        var processLabel = count > 1 ? label + ' (' + count + ')' : label;
        $proc.find('.brtc-va-dialogs-launch-progress-proc-label').text(processLabel);
        $proc.find('.brtc-va-dialogs-launch-progress-proc-label').attr('title', processLabel);
        $proc.find('.brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(status));

        $proc.find('> .brtc-va-dialogs-launch-progress-functions').empty();
    };

    LaunchProgressDialog.prototype._endProcess = function (pid, status, begin, end) {
        var $proc = this.$mainControl.find('#' + pid + '.brtc-va-dialogs-launch-progress-proc');
        $proc.attr('status', status);
        $proc.find('.brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(status));
        $proc.find('.brtc-va-dialogs-launch-progress-proc-elapsed').attr('begin', begin);
        $proc.find('.brtc-va-dialogs-launch-progress-proc-elapsed').attr('end', end);
    };

    LaunchProgressDialog.prototype._beginUnit = function (pid, fid, status, label, message) {
        var $proc = this.$mainControl.find('#' + pid + '.brtc-va-dialogs-launch-progress-proc > .brtc-va-dialogs-launch-progress-functions');

        var $func = $proc.find('.brtc-va-dialogs-launch-progress-func[id=' + fid + ']');

        if ($func.length == 0) {
            $func = $('' +
                '<div class="brtc-va-dialogs-launch-progress-func">' +
                '    <div class="brtc-va-dialogs-launch-progress-func-icon">' +
                '        <div class="brtc-va-dialogs-launch-progress-icon"></div>' +
                '    </div>' +
                '    <div class="brtc-va-dialogs-launch-progress-func-label"></div>' +
                '    <div class="brtc-va-dialogs-launch-progress-func-loop"></div>' +
                '    <div class="brtc-va-dialogs-launch-progress-func-status"></div>' +
                '    <div class="brtc-va-dialogs-launch-progress-elapsed brtc-va-dialogs-launch-progress-func-elapsed"></div>' +
                '    </div>' +
                '</div>');
            $func.attr('id', fid);
            $proc.append($func);
            $func.find('.brtc-va-dialogs-launch-progress-func-elapsed').attr('begin', Date.now());
            $func.find('.brtc-va-dialogs-launch-progress-func-elapsed').removeAttr('end');
        }
        $func.attr('status', status);
        $func.find('.brtc-va-dialogs-launch-progress-func-label').text(label);
        if (message) {
            $func.find('.brtc-va-dialogs-launch-progress-func-loop').text(message);
            $func.find('.brtc-va-dialogs-launch-progress-func-loop').attr('title', message);
        }
        $func.find('.brtc-va-dialogs-launch-progress-func-label').attr('title', label);
        $func.find('.brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(status));


        // scroll to bottom
        this.$processScrollbar.scrollTop(this.$processScrollbar.prop('scrollHeight'));
        this.$processScrollbar.perfectScrollbar('update');
    };

    LaunchProgressDialog.prototype._endUnit = function (pid, fid, status, begin, end, message) {
        var $func = this.$mainControl.find('#' + pid + '.brtc-va-dialogs-launch-progress-proc #' + fid + '.brtc-va-dialogs-launch-progress-func');
        $func.attr('status', status);
        $func.find('.brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(status));
        if (message) {
            $func.find('.brtc-va-dialogs-launch-progress-func-loop').text(message);
            $func.find('.brtc-va-dialogs-launch-progress-func-loop').attr('title', message);
        }
        $func.find('.brtc-va-dialogs-launch-progress-func-elapsed').attr('begin', begin);
        $func.find('.brtc-va-dialogs-launch-progress-func-elapsed').attr('end', end);
    };

    LaunchProgressDialog.prototype._updateUnit = function (pid, fid, status, begin, end, message) {
        var $func = this.$mainControl.find('#' + pid + '.brtc-va-dialogs-launch-progress-proc #' + fid + '.brtc-va-dialogs-launch-progress-func');
        $func.attr('status', status);
        if (message) {
            $func.find('.brtc-va-dialogs-launch-progress-func-loop').text(message);
            $func.find('.brtc-va-dialogs-launch-progress-func-loop').attr('title', message);
        }
    };

    LaunchProgressDialog.prototype._statusLabel = function (status) {
        if (status.toLowerCase() == 'wait') return 'Wait';
        if (status.toLowerCase() == 'processing') return 'Running';
        if (status.toLowerCase() == 'success') return 'Success';
        if (status.toLowerCase() == 'fail') return 'Fail';
        if (status.toLowerCase() == 'abort') return 'Abort';
        return status;
    };

    Brightics.VA.Core.Dialogs.LaunchProgressDialog = LaunchProgressDialog;

}).call(this);
/**
 * Created by daewon.park on 2016-09-12.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function MemberManagementDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    MemberManagementDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    MemberManagementDialog.prototype.constructor = MemberManagementDialog;

    MemberManagementDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 700;
        this.dialogOptions.height = 600;
        this.dialogOptions.maxWidth = 700;
        this.dialogOptions.maxHeight = 600;
    };

    MemberManagementDialog.prototype.createSearchControl = function ($parent) {
        var _this = this;
        this.$searchControl = $parent.find('.brtc-va-dialogs-member-management-search').jqxInput({
            placeHolder: 'Search for Name, ID',
            theme: Brightics.VA.Env.Theme
        });

        this.$searchControl.keyup(function (event) {
            _this.applySearchFilter(_this.$searchControl.val().trim());
        });

        this.$searchControl.on('search', function () {
            _this.applySearchFilter(_this.$searchControl.val().trim());
        });
    };

    MemberManagementDialog.prototype.applySearchFilter = function (filterValue) {
        if (filterValue) {
            var orOperator = 1;

            var nameFilterGroup = new $.jqx.filter();
            var nameFilter = nameFilterGroup.createfilter('stringfilter', filterValue, 'contains');
            nameFilterGroup.addfilter(orOperator, nameFilter);

            var idFilterGroup = new $.jqx.filter();
            idFilterGroup.operator = 'or';
            var idFilter = nameFilterGroup.createfilter('stringfilter', filterValue, 'contains');
            idFilterGroup.addfilter(orOperator, idFilter);

            this.$memberGrid.jqxGrid('addfilter', 'user_name', nameFilterGroup);
            this.$memberGrid.jqxGrid('addfilter', 'user_id', idFilterGroup);

            this.$memberGrid.jqxGrid('applyfilters');
        } else {
            this.$memberGrid.jqxGrid('clearfilters');
        }

        this.$memberGrid.jqxGrid('clearselection');
    };

    MemberManagementDialog.prototype.createInviteButton = function ($parent) {
        var _this = this;

        this.$inviteButton = $parent.find('.brtc-va-dialogs-member-management-invite').jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$inviteButton.click(function () {
            new Brightics.VA.Core.Dialogs.InviteMemberDialog($parent, {
                members: _this.$memberGrid.jqxGrid('getrows'),
                projectId: _this.options.projectId,
                close: function () {
                    _this.$memberGrid.jqxGrid('updatebounddata');
                    _this.$memberGrid.jqxGrid('clearselection');
                },
                title: 'Invite Member'
            });
        });
    };

    MemberManagementDialog.prototype.createMemberGrid = function ($parent) {
        var source = {
            datatype: 'json',
            datafields: [
                {name: 'user_name', type: 'string'},
                {name: 'user_id', type: 'string'},
                {name: 'role_id', type: 'string'},
                {name: 'role_category', type: 'string'},
                {name: 'role_label', type: 'string'},
                {name: 'joined_time', type: 'date'}
            ],
            url: 'api/va/v2/ws/projects/' + this.options.projectId + '/members'
        };

        var dataAdapter = new $.jqx.dataAdapter(source);
        this.$memberGrid = $parent.find('.brtc-va-dialogs-member-management-grid').jqxGrid({
            theme: Brightics.VA.Env.Theme,
            source: dataAdapter,
            width: '100%',
            height: 'calc(100% - 160px)',
            altrows: false,
            filterable: false,
            sortable: false,
            columnsresize: true,
            columnsheight: 34,
            rowsheight: 34,
            selectionmode: 'checkbox',
            showfiltercolumnbackground: false,
            enabletooltips: true,
            columns: [
                {
                    text: 'Name', datafield: 'user_name', width: 120,
                    cellsrenderer: function (row, column, value) {
                        return '<div class="jqx-grid-cell-left-align" style="margin-top: 10px;">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(value) + '</div>';
                    }
                },
                {text: 'ID', datafield: 'user_id', width: 240},
                {text: 'Authority', datafield: 'role_label', width: 110},
                {text: 'Joined Date', datafield: 'joined_time', cellsformat: 'yyyy-MM-dd HH:mm'}
            ]
        });
    };

    MemberManagementDialog.prototype.createAuthorityCombo = function ($parent) {
        this.$authorityCombo = $parent.find('.brtc-va-dialogs-member-management-authority').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            source: [
                {id: 'role_10002', label: 'as Organizer'},
                {id: 'role_10003', label: 'as Member'},
                {id: 'role_10004', label: 'as Reporter'}
            ],
            displayMember: 'label',
            valueMember: 'id',
            itemHeight: 29,
            dropDownWidth: 118,
            selectedIndex: 1
        });
    };

    MemberManagementDialog.prototype.createApplyAuthorityButton = function ($parent) {
        var _this = this;
        var member;

        this.$applyButton = $parent.find('.brtc-va-dialogs-member-management-apply-authority').jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$applyButton.click(function () {
            var indexes = _this.$memberGrid.jqxGrid('getselectedrowindexes');
            if (indexes.length == 0) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('At least one member must be selected.');
            } else {
                if (indexes.length == 1) {
                    member = _this.$memberGrid.jqxGrid('getrowdata', indexes[0]);
                    if (member.role_id == 'role_10001') {
                        Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Can not change authority of owner.');
                        return;
                    }
                }
                var item = _this.$authorityCombo.jqxDropDownList('getSelectedItem');
                var role_id = item.value;
                var options = {
                    members: []
                };
                for (var i in indexes) {
                    member = _this.$memberGrid.jqxGrid('getrowdata', indexes[i]);
                    options.members.push({
                        user_id: member.user_id,
                        role_id: role_id
                    });
                }
                var opt = {
                    url: 'api/va/v2/ws/projects/' + _this.options.projectId + '/members/authority',
                    type: 'POST',
                    contentType: "application/json; charset=utf-8",
                    blocking: true,
                    data: JSON.stringify(options)
                };
                $.ajax(opt).done(function (result) {
                    Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Changed ' + result + ' member\'s authority.', function () {
                        _this.$memberGrid.jqxGrid('updatebounddata');
                        _this.$memberGrid.jqxGrid('clearselection');
                    });
                }).fail(function (error) {
                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
                });
            }
        });
    };

    MemberManagementDialog.prototype.createWithdrawButton = function ($parent) {
        var _this = this;
        var member;

        this.$withdrawButton = $parent.find('.brtc-va-dialogs-member-management-withdraw').jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$withdrawButton.click(function () {
            var indexes = _this.$memberGrid.jqxGrid('getselectedrowindexes');
            if (indexes.length == 0) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('At least one member must be selected.');
            } else {
                var self;
                for (var i in indexes) {
                    var row = _this.$memberGrid.jqxGrid('getrowdata', indexes[i]);
                    if (row.role_id == 'role_10001') {
                        Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Can not change authority of owner.');
                        return;
                    }

                    if (row.user_id == Brightics.VA.Env.Session.userId) {
                        self = true;
                    }
                }

                if (self) {
                    Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog('Are you sure you want to leave the project?', function (dialogResult) {
                        if (dialogResult.OK) {
                            _this.withdraw();
                        }
                    });
                } else {
                    Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog('Are you sure you want to withdraw the member(s)?', function (dialogResult) {
                        if (dialogResult.OK) {
                            _this.withdraw();
                        }
                    });
                }
            }
        });
    };

    MemberManagementDialog.prototype.withdraw = function () {
        var options = {
                members: []
            },
            _this = this,
            indexes = this.$memberGrid.jqxGrid('getselectedrowindexes');
        for (var i in indexes) {
            var member = this.$memberGrid.jqxGrid('getrowdata', indexes[i]);
            options.members.push({
                user_id: member.user_id,
                role_id: member.role_id
            });
        }
        var opt = {
            url: 'api/va/v2/ws/projects/' + _this.options.projectId + '/members/withdraw',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            blocking: true,
            data: JSON.stringify(options)
        };
        $.ajax(opt).done(function (result) {
            Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Withdraw ' + result + ' members.', function () {
                if (options.members.length == 1 && options.members[0].user_id == Brightics.VA.Env.Session.userId) {
                    _this.handleOkClicked();
                } else {
                    _this.$memberGrid.jqxGrid('updatebounddata');
                    _this.$memberGrid.jqxGrid('clearselection');
                }
            });
        }).fail(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        });
    };

    MemberManagementDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<input type="search" class="brtc-va-dialogs-member-management-search">' +
            '<input type="button" class="brtc-va-dialogs-member-management-invite" value="Invite Members">' +
            '<div class="brtc-va-dialogs-member-management-grid"></div>' +
            '<input type="button" class="brtc-va-dialogs-member-management-withdraw" value="Withdraw">' +
            '<input type="button" class="brtc-va-dialogs-member-management-apply-authority" value="Apply Authority">' +
            '<div class="brtc-va-dialogs-member-management-authority"></div>' +
            '');

        this.createSearchControl($parent);
        this.createInviteButton($parent);
        this.createMemberGrid($parent);
        this.createAuthorityCombo($parent);
        this.createApplyAuthorityButton($parent);
        this.createWithdrawButton($parent);
    };

    MemberManagementDialog.prototype.createDialogButtonBar = function ($parent) {
        Brightics.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this, $parent);

        this.$okButton.val('Close');
        this.$cancelButton.css({display: 'none'});
    };

    MemberManagementDialog.prototype.handleOkClicked = function () {
        var _this = this;

        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    Brightics.VA.Core.Dialogs.MemberManagementDialog = MemberManagementDialog;

}).call(this);
/* -----------------------------------------------------
 *  navigatordialog.js
 *  Created by hyunseok.oh@samsung.com on 2018-05-23.
 * ---------------------------------------------------- */

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function NavigatorDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);

        this.addListener();
    }

    NavigatorDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    NavigatorDialog.prototype.constructor = NavigatorDialog;

    NavigatorDialog.prototype.addListener = function () {
        var _this = this;
        this.activeModelChangeListener = function () {
            _this.options.getNavigatorData();
            _this.refresh();
        };

        this.options.editor.addActiveModelChangeListener(this.activeModelChangeListener);
    };

    NavigatorDialog.prototype.removeListener = function () {
        this.options.editor.removeActiveModelChangeListener(this.activeModelChangeListener);
    };

    NavigatorDialog.prototype.getTitle = function () {
        return 'Navigator';
    };

    NavigatorDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-main-navigator">' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents" style="padding-right: 20px;padding-left: 20px;">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '       </div>' +
            '   </div>' +
            '</div>');

        var opts = this._configureDialogOption({
            theme: Brightics.VA.Env.Theme,
            title: this.getTitle(),
            position: {
                my: "left top",
                at: "left bottom",
                of: this.$parent.find('.brtc-va-editors-modelinfo-toolbar-dotdotdot')
            },
            width: 400,
            height: 600,
            maxWidth: 400,
            maxHeight: 600,
            modal: false,
            resizable: false,
        });
        this.$mainControl.dialog(opts);
        this.$mainControl.parent().draggable("option", "containment", this.$parent);
        $('.ui-dialog-titlebar.ui-widget-header', $(this).parent()).css('width', 'calc(100% - 60px) !important');
    };

    NavigatorDialog.prototype.createDialogContentsArea = function ($parent) {
        var $container = $('<div class="brtc-va-dialogs-navigator-item-container"></div>');
        $parent.append($container);

        this.refresh();
        $parent.perfectScrollbar();
    };

    NavigatorDialog.prototype.createNavigatorItems = function ($container) {
        var _this = this;
        this.fnUnits = {};
        var data = this.options.getNavigatorData();
        if (data.length === 0) {
            this.close();
        }
        $container.empty();
        $container.append(data.map(function (el) {
            var fn = el.fnUnit;
            var fid = fn.fid;
            _this.fnUnits[fid] = el.fnUnit;
            var mid = el.mid;
            var clazz = 'data';
            var funcDef = Brightics.VA.Core.Interface.Functions[clazz][fn.func];

            var $item = $('' +
                '<div class="brtc-va-dialogs-index-item">' +
                '   <div class="brtc-va-dialogs-index-item-label"></div>' +
                '   <div class="brtc-va-dialogs-index-item-func"></div>' +
                '</div>');
            $item.attr('fid', fid);
            $item.attr('mid', mid);
            $item.addClass('brtc-va-fnunit-category-' + funcDef.category);
            $item.find('.brtc-va-dialogs-index-item-label').attr('title', fn.display.label);
            $item.find('.brtc-va-dialogs-index-item-label').text(fn.display.label);
            $item.find('.brtc-va-dialogs-index-item-func').text(funcDef.defaultFnUnit.display.label);
            return $item;
        }));

        $container.find('.brtc-va-dialogs-index-item').click(function () {
            /* eslint-disable no-invalid-this */
            var fid = $(this).attr('fid');
            var mid = $(this).attr('mid');
            var fnUnit = _this.fnUnits[fid];
            _this.options.navigate(mid, fnUnit);
            /* eslint-enable no-invalid-this */
        });
    };

    NavigatorDialog.prototype.createDialogButtonBar = function ($parent) {
        // do no create buttons
    };

    NavigatorDialog.prototype.destroy = function () {
        this.removeListener();

        Brightics.VA.Dialogs.Dialog.prototype.destroy.call(this);
    };

    NavigatorDialog.prototype.refresh = function () {
        var $container = this.$mainControl.find('.brtc-va-dialogs-navigator-item-container');
        $container.empty();
        this.createNavigatorItems($container);
        if (this.$mainControl) {
            var $contents = this.$mainControl.find('brtc-va-dialogs-contents');
            $contents.perfectScrollbar('update');
        }
    };

    Brightics.VA.Core.Dialogs.NavigatorDialog = NavigatorDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function NewFileDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    NewFileDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    NewFileDialog.prototype.constructor = NewFileDialog;

    NewFileDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 980;
        this.dialogOptions.height = 670;
    };

    NewFileDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-newfile-contents');
        $parent.parent().parent().find('.ui-dialog-titlebar.ui-widget-header').css('margin-left', '26px !important');

        this.createModelTypeListArea($parent);
        this.createModelInfoInputArea($parent);
    };

    NewFileDialog.prototype.createModelTypeListArea = function ($parent) {
        var _this = this;
        var $modelTypeList = $('<div class="brtc-va-dialogs-modeltype-list"></div>');
        var implementation = Brightics.VA.Implementation;
        for (var key in implementation) {
            if (_this.options.fileType === 'Report') {
                if (key !== 'Visual') continue;
            } else {
                if (key === 'Visual') continue;
            }
            $modelTypeList.append('' +
                '   <div class="brtc-va-dialogs-modeltype-list-item" model-type="' + implementation[key].Clazz + '">' +
                '       <div class="brtc-va-dialogs-modeltype-list-item-icon"></div>' +
                '       <div class="brtc-va-dialogs-modeltype-list-item-label" title="' + implementation[key].Label + '">' + implementation[key].Label + '</div>' +
                '   </div>');
        }

        $parent.append($modelTypeList);

        $parent.find('.brtc-va-dialogs-modeltype-list-item:first').addClass('brtc-va-dialogs-modeltype-list-item-selected');


        $parent.find('.brtc-va-dialogs-modeltype-list-item').click(function () {
            $(this).parent().find('.brtc-va-dialogs-modeltype-list-item-selected').removeClass('brtc-va-dialogs-modeltype-list-item-selected');
            $(this).addClass('brtc-va-dialogs-modeltype-list-item-selected');
            _this.renderModelList($(this).attr('model-type'));
        });
    };

    NewFileDialog.prototype.createModelInfoInputArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-newfiledialog-input-area">' +
            '   <div class="brtc-va-dialogs-newfiledialog-label">Name</div>' +
            '   <input type="text" class="brtc-va-dialogs-newfiledialog-name-input" maxlength="80"/>' +
            '   <div class="brtc-va-dialogs-newfiledialog-label">Description</div>' +
            '   <div class="brtc-va-dialogs-newfiledialog-description-container"></div>' +
            '   <div class="brtc-va-dialogs-newfiledialog-label">Template</div>' +
            '   <div class="brtc-va-dialogs-newfiledialog-template-list"></div>' +
            '</div>' +
            '');

        this.$nameControl = $parent.find('.brtc-va-dialogs-newfiledialog-name-input');
        this.$nameControl.jqxInput({
            theme: Brightics.VA.Env.Theme
        });
        this.$nameControl.focus();
        var modelType = $parent.find('.brtc-va-dialogs-modeltype-list-item').attr('model-type');

        this.createDescriptionControl($parent.find('.brtc-va-dialogs-newfiledialog-description-container'));
        this.createTemplate($parent.find('.brtc-va-dialogs-newfiledialog-template-list'), modelType);
    };

    NewFileDialog.prototype.renderModelList = function (modelType) {
        var $container = this.$mainControl.find('.brtc-va-dialogs-newfiledialog-template-list');
        var $parent = $container.parent();
        $container.remove();
        $parent.find('.brtc-va-dialogs-newfiledialog-name-input').focus();
        $parent.append('<div class="brtc-va-dialogs-newfiledialog-template-list"></div>');
        this.createTemplate($parent.find('.brtc-va-dialogs-newfiledialog-template-list'), modelType);
    };

    NewFileDialog.prototype.convertTemplateContents = function (contents) {
        var contents = contents;
        //fix me
        if (contents.type === 'deeplearning' && !_.isEmpty(contents.functions)) {
            var dlLoad;
            var output;

            _.forEach(contents.functions, function (fn) {
                if (fn.func === 'dlLoad') dlLoad = fn;
                if (fn.func === 'output') output = fn;
            });

            output.param['train_data'] = dlLoad.fid;
        } 
        return contents;
    };

    NewFileDialog.prototype.createTemplate = function ($parent, modelType) {
        var _this = this;

        _this.$templateContainer = $('<div class="brtc-va-dialogs-file-thumbnail-container"></div>');
        $parent.append(_this.$templateContainer);

        if (typeof modelType === 'undefined') {
            return;
        }

        var url = 'api/va/v2/studio/templates/' + modelType;
        var opt = {
            url: url,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            blocking: true
        };
        $.ajax(opt).done(function (files) {
            files.sort(function (a, b) {
                if (a.name === 'Default') return -1;
                if (b.name === 'Default') return 1;
                return a.name.localeCompare(b.name);
            });
            files.forEach(function (templateFile, fileIndex) {

                var templateNm = Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(templateFile.name);
                var $template = $('' +
                    '<div class="brtc-va-dialogs-file-thumbnail-unit">' +
                    '   <div class="brtc-va-dialogs-file-thumbnail name">' + templateNm + '</div>' +
                    '   <div class="brtc-va-dialogs-file-thumbnail image"/>' +
                    '   <div class="brtc-va-dialogs-file-thumbnail overlay">' + templateFile.description + '</div>' +
                    '</div>'
                );

                if (templateNm !== 'Default') {
                    // $template.find('.brtc-va-dialogs-file-thumbnail.overlay')
                    //     .css({top: (215 * Math.floor(fileIndex / 2) + 33) + 'px'});
                    $template.mouseover(function () {
                        $template.find('.brtc-va-dialogs-file-thumbnail.overlay')
                            .css({opacity: .6});
                    }).mouseout(function () {
                        $template.find('.brtc-va-dialogs-file-thumbnail.overlay')
                            .css({opacity: 0});
                    });
                }

                if (templateFile.thumbnail) $template.find('.brtc-va-dialogs-file-thumbnail.image').append($('<img src="' + templateFile.thumbnail + '" />'));

                if (fileIndex == 0) {
                    $template.addClass('brtc-va-dialogs-file-thumbnail-selected');
                }
                _this.$templateContainer.append($template);
                $template.data('contents', templateFile.contents);
            });

            _this.$templateContainer.find('.brtc-va-dialogs-file-thumbnail-unit').click(function (event) {
                _this.$templateContainer.find('.brtc-va-dialogs-file-thumbnail-selected').removeClass('brtc-va-dialogs-file-thumbnail-selected');
                $(this).addClass('brtc-va-dialogs-file-thumbnail-selected');
            });
        }).fail(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        });

        $parent.perfectScrollbar();
    };

    NewFileDialog.prototype.createDescriptionControl = function ($control) {
        var _this = this;
        var noteOption = {
            focus: false,
            height: 120,
            description: '',
            okButton: this.$okButton,
            maxLength: 2000,
            toolbar: this.options.toolbar
        };

        this.noteControl = Brightics.VA.Core.Widget.Factory.noteControl($control, noteOption);

        this.$mainControl.on('resizing', function (event) {
            _this.noteControl.setHeight(_this.$mainControl.find('.brtc-va-dialogs-contents').height() - 110);
        });
    };

    NewFileDialog.prototype.createFileContents = function (mid, label, description) {
        var $item = this.$templateContainer.find('.brtc-va-dialogs-file-thumbnail-selected');
        if ($item.length == 0) {
            $item = this.$templateContainer.find('.brtc-va-dialogs-file-thumbnail:nth-child(1)');
        }
        return this.convertTemplateContents(Brightics.VA.Core.Utils.ModelUtils
            .createFileContents($item.data('contents'), mid, label, description));
    };

    NewFileDialog.prototype.handleOkClicked = function () {
        var _this = this;

        var $fileName = this.$mainControl.find('.brtc-va-dialogs-newfiledialog-name-input');
        if ($fileName.val().trim() === '') {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter name.', function () {
                _this.$nameControl.focus();
            });
            return;
        }

        if ($(_this.noteControl.getCode()).text().length > 2000) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Description should be less than or equal to 2000 characters.');
            return;
        }

        var fileId = Brightics.VA.Core.Utils.IDGenerator.model.id();
        var description = _this.noteControl.getCode() === '' ? '' : _this.noteControl.getCode();
        
        var fileInfo = new Brightics.VA.Vo.File();
        fileInfo.setFileId(fileId);
        fileInfo.setProjectId(this.options.project.getProjectId());
        fileInfo.setLabel($fileName.val());
        fileInfo.setContents(_this.createFileContents(fileId, $fileName.val()));
        fileInfo.setDescription(description);
        fileInfo.setCreator(Brightics.VA.Env.Session.userId);

        Studio.getResourceManager().addFile(this.options.project.getProjectId(), fileInfo)
            .then(function (file) {
                _this.dialogResult = {
                    OK: true,
                    Cancel: false,
                    selectedFile: file
                };
                _this.$mainControl.dialog('close');
            })
            .catch(function (error) {
                console.error(error);
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
            });
    };

    Brightics.VA.Core.Dialogs.NewFileDialog = NewFileDialog;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function NoteDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.retrieveParent();
        this.createControls();
        this.createContents();
    }

    NoteDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    NoteDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-notedialog">' +
            // '   <div class="brtc-va-dialogs-header">Note</div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '           <div class="brtc-va-dialogs-notecontents">' +
            '           </div>' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="Save" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        // this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        var _this = this;

        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: 'Note',
            width: 1020,
            height: 690,
            maxWidth: 1020,
            maxHeight: 690,
            modal: true,
            resizable: false
        };
        this.$mainControl.dialog(jqxOpt);
    };

    NoteDialog.prototype.createContents = function () {
        var _this = this;
        _this.initContents(_this.$mainControl.find('.brtc-va-dialogs-notecontents'));
        _this.createNoteArea(_this.$mainControl.find('.brtc-va-dialogs-notecontents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$okButton.click(_this.handleOkClicked.bind(_this));
    };

    NoteDialog.prototype.initContents = function ($parent) {
        // $parent.append(this.options.contents);
    };

    NoteDialog.prototype.createNoteArea = function ($parent) {
        var noteOption = {
            height: 480,
            description: this.options.contents,
            okButton: this.$okButton,
            maxLength: 1000
        };

        this.note = Brightics.VA.Core.Widget.Factory.noteControl($parent, noteOption);

    };
    NoteDialog.prototype.handleOkClicked = function () {
        if (typeof this.options.save == 'function') {
            this.options.save(this.note.getCode());
        }
        this.$mainControl.dialog('close');
    };


    Brightics.VA.Core.Dialogs.NoteDialog = NoteDialog;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function NoticeDetailDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    NoticeDetailDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    NoticeDetailDialog.prototype.constructor = NoticeDetailDialog;

    NoticeDetailDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 760;
        this.dialogOptions.height = 440;
    };

    NoticeDetailDialog.prototype.createDialogContentsArea = function ($parent) {
        var $noticeDetailContent = $('' +
            '<div class="brtc-va-dialogs-row-flex-layout notice">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold notice">Title</div>' +
            '   <div class="brtc-va-dialogs-contents-input notice"></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold notice">Register Date</div>' +
            '   <div class="brtc-va-dialogs-contents-input-half notice">' + Brightics.VA.Core.Utils.CommonUtils.transferTimestampToDateString(new Date(this.options.noticeData.create_time)) + '</div>' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold notice">Creator</div>' +
            '   <div class="brtc-va-dialogs-contents-input-half notice creator">' + this.options.noticeData.creator + '</div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold notice">Content</div>' +
            '   <div class="brtc-va-dialogs-contents-textarea-wrapper notice" style="word-wrap:break-word; ">' +
            '       <div class="brtc-va-dialogs-contents-textarea notice"></div>' +
            '   </div>' +
            '</div>');

        $noticeDetailContent.find('.brtc-va-dialogs-contents-input.notice').attr('title', this.options.noticeData.title).text(this.options.noticeData.title);
        $noticeDetailContent.find('.brtc-va-dialogs-contents-input-half.notice.creator').attr('title', this.options.noticeData.creator);

        $parent.append($noticeDetailContent);

        $parent.find('.brtc-va-dialogs-contents-textarea.notice').html(this.options.noticeData.content);
        $('.brtc-va-dialogs-contents-textarea-wrapper.notice').perfectScrollbar();
    };

    NoticeDetailDialog.prototype.createDialogButtonBar = function ($parent) {
        var _this = this;

        this.$closeButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-close" value="Close" />');
        $parent.append(this.$closeButton);
        this.$closeButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        this.$closeButton.on('click', function (event) {
            _this.$mainControl.dialog('close');
            event.stopPropagation();
        });
    };

    Brightics.VA.Core.Dialogs.NoticeDetailDialog = NoticeDetailDialog;

}).call(this);
/**
 * Created by sds on 2018-02-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function OptDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    OptDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    OptDialog.prototype.constructor = OptDialog;

    OptDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 900;
        this.dialogOptions.height = 540;
        this.dialogOptions.keyboardCloseKey = '';
        this.dialogOptions.closeOnEscape = false;

        this.$elements = {};
        this.controls = {};
    };

    OptDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        this.$contentsArea = $parent;
        // this.options.method = 'dace',
        //     this.options.methodType = 'random';

        var url = 'api/va/v2/studio/optcontrol';
        var opt = {
            url: url,
            type: 'GET',
            data: {
                func: this.options.fnUnit.func,
                method: this.options.method
            },
            contentType: 'application/json; charset=utf-8',
            blocking: true
        };

        if (this.options.methodType) {
            opt.data.methodType = this.options.methodType;
        }

        $.ajax(opt).done(function (controlSpec) {
            var option = {
                controlSpec: controlSpec,
                fnUnit: _this.options.fnUnit,
                dataProxy: _this.options.dataProxy,
                modelEditor: _this.options.modelEditor,
                // hideIntableControl: true
            };
            _this.popupProperty = new Brightics.VA.Core.Functions.Library.optDialogBase.propertiesPanel($parent, option);
        });


    };

    OptDialog.prototype.handleOkClicked = function () {
        this.dialogResult.param = this.popupProperty.getParams();

        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    OptDialog.prototype.destroy = function () {
        this.popupProperty.destroy();
        this.$mainControl.dialog('destroy');
        this.$mainControl = undefined;
    };


    Brightics.VA.Core.Dialogs.OptDialog = OptDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function OptProgressDialog(parentId, options) {
        var editor = Studio.getEditorContainer().getActiveModelEditor();
        parentId = parentId || editor.$mainControl;
        options = options || {};
        options.title = 'Optimization Progress';
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    OptProgressDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    OptProgressDialog.prototype.constructor = OptProgressDialog;

    OptProgressDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 1000;
        this.dialogOptions.height = 600;
        this.dialogOptions.modal = false;
        this.dialogOptions.create = function () {
            $('.ui-widget-content').css('border-color', '#d4d4d4');
        }
    };

    OptProgressDialog.prototype.createDialogContentsArea = function ($parent) {
        var containerStyle = 'display: flex;';
        var $container =
            $('<div class="brtc-va-dialogs-opt-progress-container" style="' + containerStyle + '"></div>');
        $parent.append($container);

        this.createParameterArea($container);
        this.createObjectiveValueArea($container);

        if (this.options.data) {
            this.selectedIndex = 0;
            this.render(this.options.data);
        }
        $parent.perfectScrollbar();
    };

    OptProgressDialog.prototype.createParameterArea = function ($parent) {
        var areaStyle =
            'width: 50%;' +
            'height: 440px;' +
            'overflow: hidden;';
        var $parameterArea = $('<div style="' + areaStyle + '"></div>');
        $parent.append($parameterArea);

        this.createHistoryArea($parameterArea);
        this.createBestParamArea($parameterArea);
        this.createTabsArea($parameterArea);
    };

    OptProgressDialog.prototype.createHistoryArea = function ($parent) {
        this.$historyArea = $(
            '<div style="margin-bottom: 15px;">' +
            '   <div style="font-weight:bold;margin-bottom:3px;">History</div>' +
            '   <div class="brtc-opt-progress-dialog-history-grid"></div>' +
            '</div>');
        $parent.append(this.$historyArea);
    };

    OptProgressDialog.prototype.createBestParamArea = function ($parent) {
        this.$bestParamArea = $(
            '<div>' +
            '   <div style="font-weight:bold;margin-bottom:3px;">Best Parameter</div>' +
            '   <div class="brtc-opt-progress-dialog-best-param-grid"></div>' +
            '</div>');
        $parent.append(this.$bestParamArea);
    };

    OptProgressDialog.prototype.createTabsArea = function ($parent) {
        this.$tabsArea = $(
            '<div>' +
            '  <div class="brtc-opt-progress-dialog-tabs-wrapper" style="margin-top: 20px;">' +
            '  </div>' +
            '</div>');
        $parent.append(this.$tabsArea);
    }

    OptProgressDialog.prototype.createObjectiveValueArea = function ($parent) {
        var areaStyle =
            'width: 50%;' +
            'height: 440px;' +
            'overflow: hidden;';
        var $objectiveValueArea =
            $('<div style="' + areaStyle + '"></div>');
        $parent.append($objectiveValueArea);

        this.createObjectiveChartArea($objectiveValueArea);
    };

    OptProgressDialog.prototype.createObjectiveChartArea = function ($parent) {
        this.$chartArea = $(
            '<div>' +
            '   <div style="font-weight:bold;margin-bottom:3px;">Objective Value</div>' +
            '   <div class="brtc-opt-progress-dialog-chart-wrapper" style="width:470px;height:421px;"></div>' +
            '</div>');
        $parent.append(this.$chartArea);
    }

    OptProgressDialog.prototype.createDialogButtonBar = function ($parent) {
        this.$okButton = $(`
            <input type="button" class="brtc-va-dialogs-buttonbar-ok" 
            style="width:155px;" value="Apply Best Parameters" />`);
        $parent.append(this.$okButton);
        this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$okButton.click(this.handleOkClicked.bind(this));
    };

    OptProgressDialog.prototype.handleOkClicked = function () {
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getEditorInput().getContents();
        var commandManager = activeModelEditor.getCommandManager();

        var commands = new Brightics.VA.Core.CompoundCommand(this,
            { label: 'Apply best parameters' }
        );
        this.optimizationData = this.optimizationData || {};
        var bestParameters = this.optimizationData.bestParameter || [];
        // [[
        //      {
        //         "fid": "fy8mqd5apd2uj5gu",
        //         "name": "regularization",
        //         "value": "0.5"
        //      }
        // ]]

        if (bestParameters.length) {
            for (var i = 0; i < bestParameters[0].length; i++) {
                var bestParameter = bestParameters[0][i];
                var fid = bestParameter.fid;
                var name = bestParameter.name;
                var value = bestParameter.value;

                var fnUnit = contents.getFnUnitById(fid);
                if (!fnUnit) continue;

                var commandOption = {
                    fnUnit: fnUnit,
                    ref: { param: {} }
                };
                commandOption.ref.param[name] = value;
                var command =
                    new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(
                        this, commandOption
                    );
                commands.add(command);
            }
            commandManager.execute(commands);
        }
        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    OptProgressDialog.prototype.render = function (data) {
        var optimization = this.getOptimizationData(data);

        if (optimization) {
            this.optimizationData = optimization;
            this.optimizationFids = this.getOptimizationFids(optimization);
            if (this.$mainControl) {
                this.$mainControl.parent().show();
                this._render(optimization);
            }
        }
    };

    OptProgressDialog.prototype.getOptimizationData = function (originalData) {
        var processes = originalData.processes;
        if (!processes) return null;
        for (var i = processes.length - 1; i >= 0; i--) {
            var functions = processes[i].functions;
            for (var j = functions.length - 1; j >= 0; j--) {
                var optimization = functions[j].optimization;
                if (optimization) {
                    return optimization;
                }
            }
        }
        return null;
    };

    OptProgressDialog.prototype.getOptimizationFids = function (optimization) {
        var parameters = optimization.parameter;
        return _(parameters).flatten().map('fid').uniq().sortBy().value();
    };

    OptProgressDialog.prototype._render = function (optimization) {
        var parameter = optimization.parameter;
        var bestParameter = optimization.bestParameter;
        var objectiveValue = optimization.objective;

        this.renderHistory(parameter);
        this.renderBestParam(bestParameter);
        this.renderTabs(this.optimizationFids);
        this.renderObjectiveChart(objectiveValue);
    };

    OptProgressDialog.prototype.getFunctionLabel = function (fid) {
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getEditorInput().getContents();
        var fnUnit = contents.getFnUnitById(fid);
        var functionLabel = (fnUnit) ? (fnUnit.display.label) : ("");
        return functionLabel;
    };

    OptProgressDialog.prototype.renderTabs = function (tabFids) {
        var _this = this;
        var $targetWrapper = this.$tabsArea.find('.brtc-opt-progress-dialog-tabs-wrapper');
        if ($targetWrapper.find('li').length) {
            var originArray = $targetWrapper.find('li').toArray().map((e) => e.getAttribute('fid'));
            if (_.isEqual(originArray, tabFids)) {
                return;
            }
        }

        $targetWrapper.empty();
        var $target = $('<div class="brtc-opt-progress-dialog-tabs"></div>');
        $targetWrapper.append($target);

        $target.append('<ul></ul>');
        _.forEach(tabFids, function (value, index) {
            var functionLabel = _this.getFunctionLabel(value);
            var $li = $('<li></li>');
            $li.attr({ fid: value, title: functionLabel });
            $li.text(functionLabel);

            $target.find('ul').append($li);
            $target.append('<div></div>');
        });

        if (tabFids.length <= this.selectedIndex) {
            this.selectedIndex = 0;
        }
        $target.jqxTabs({
            theme: 'office',
            selectedItem: this.selectedIndex,
            width: 450,
            position: 'bottom',
            scrollPosition: 'both'
        });
        $target.on('selected', function (event) {
            var selectedTab = event.args.item;
            _this.selectedIndex = selectedTab;
            _this.renderHistory(_this.optimizationData.parameter);
            _this.renderBestParam(_this.optimizationData.bestParameter);
        });
    };

    OptProgressDialog.prototype.renderHistory = function (parameter) {
        var $target = this.$historyArea.find('.brtc-opt-progress-dialog-history-grid');

        var source = this.convertParameter(parameter);
        var dataAdapter = new $.jqx.dataAdapter(source);
        var columns = this.getColumns(source.datafields);

        this.historyGrid = $target.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: 450,
            height: 270,
            source: dataAdapter,
            columns: columns,
            columnsresize: true
        });
    };

    OptProgressDialog.prototype.renderBestParam = function (bestParameter) {
        var $target = this.$bestParamArea.find('.brtc-opt-progress-dialog-best-param-grid');

        var source = this.convertParameter(bestParameter);
        var dataAdapter = new $.jqx.dataAdapter(source);
        var columns = this.getColumns(source.datafields, true);

        this.bestParameterGrid = $target.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: 450,
            autoheight: true,
            source: dataAdapter,
            columns: columns,
            columnsresize: true
        });
    };

    OptProgressDialog.prototype.renderObjectiveChart = function (objectiveValue) {
        var $target = this.$chartArea.find('.brtc-opt-progress-dialog-chart-wrapper');

        if (!this.objectiveValue) {
            this.objectiveValue = objectiveValue;
        }

        var chartOptions = this.getChartOptions(objectiveValue);
        if (!this.chart) {
            $target.empty();
            this.chart = new Brightics.Chart.BCharts($target, chartOptions);
        } else {
            var refresh = false;
            if (this.objectiveValue.length != objectiveValue.length) {
                this.objectiveValue = objectiveValue;
                refresh = true;
            }

            if (refresh) {
                this.chart.setOptions(chartOptions);
            }
        }
    };

    OptProgressDialog.prototype.getChartOptions = function (objectiveValue) {
        var chartOptions = {
            "chart": {
                "border": "1px #000000 none",
                "background": "rgba(255, 255, 255,1)",
                "animationDuration": 1000,
                "type": "line"
            },
            "plotOptions": {
                "line": {
                    "marker": {
                        "symbolSize": 7,
                        "itemStyle": {
                            "normal": {
                                "opacity": 1
                            }
                        }
                    }
                }
            },
            "xAxis": [
                {
                    "selected": [
                        {
                            "value": "Index",
                            "name": "Index",
                            "type": "Integer"
                        }
                    ],
                    "title": {
                        "show": true,
                        "text": "",
                        "subtext": "",
                        "rotate": 0,
                        "textStyle": {
                            "color": "#000000",
                            "fontSize": 12,
                            "fontFamily": ""
                        },
                        "subtextStyle": {
                            "color": "#000000",
                            "fontSize": 12,
                            "fontFamily": ""
                        },
                        "left": "50%",
                        "bottom": "5px"
                    },
                    "axisTick": {
                        "show": true
                    },
                    "axisLabel": {
                        "show": true,
                        "rotate": 0,
                        "textStyle": {
                            "color": "#000000",
                            "fontSize": 12,
                            "fontFamily": ""
                        }
                    },
                    "zlevel": 1,
                    "axisType": null
                }
            ],
            "yAxis": [
                {
                    "selected": [
                        {
                            "value": "Objective",
                            "name": "Objective",
                            "type": "Double"
                        }
                    ],
                    "title": {
                        "show": false,
                        "text": "",
                        "subtext": "",
                        "rotate": -90,
                        "textStyle": {
                            "color": "#000000",
                            "fontSize": 12,
                            "fontFamily": ""
                        },
                        "subtextStyle": {
                            "color": "#000000",
                            "fontSize": 12,
                            "fontFamily": ""
                        },
                        "left": "8px",
                        "top": "50%"
                    },
                    "axisTick": {
                        "show": true
                    },
                    "axisLabel": {
                        "show": true,
                        "rotate": 0,
                        "textStyle": {
                            "color": "#000000",
                            "fontSize": 12,
                            "fontFamily": ""
                        }
                    },
                    "zlevel": 1,
                    "axisType": null
                }
            ]
        };

        chartOptions.source = {
            dataType: 'local',
            localData: [{
                dataType: 'rawdata',
                columns: [
                    { name: 'Index', 'type': 'number', internalType: 'Integer' },
                    { name: 'Objective', 'type': 'number', internalType: 'Double' }
                ],
                data: this.getConvertedObjectiveValue(objectiveValue)
            }]
        };

        chartOptions.toolbar = {
            type: 'custom', show: false
        };

        return chartOptions;
    };

    OptProgressDialog.prototype.getConvertedObjectiveValue = function (objectiveValue) {
        var data = [];
        for (var i = 0; i < objectiveValue.length; i++) {
            data.push([(Number(i) + 1), objectiveValue[i]]);
        }
        return data;
    };

    OptProgressDialog.prototype.convertParameter = function (parameter) {
        var targetFid = this.optimizationFids[this.selectedIndex];
        var datafieldsObj = {};
        var data = [];
        for (var i = 0; i < parameter.length; i++) {
            var fieldData = parameter[i];

            var dataObj = {};
            for (var j = 0; j < fieldData.length; j++) {
                if (fieldData[j].fid != targetFid) continue;
                var paramName = fieldData[j].name;
                var paramValue = fieldData[j].value;
                dataObj[paramName] = paramValue;
                if (!datafieldsObj[paramName] || datafieldsObj[paramName] === 'number') {
                    datafieldsObj[paramName] = ($.isNumeric(paramValue) == true) ? ('number') : ('string');
                }
            }
            data.push(dataObj);
        }

        var datafields = [];
        for (var param in datafieldsObj) {
            datafields.push({ name: param, type: datafieldsObj[param] });
        }

        return {
            localdata: data,
            datatype: "json",
            datafields: datafields
        };
    };

    OptProgressDialog.prototype.getColumns = function (datafields, empty) {
        var columns = (empty) ? ([]) : ([
            {
                text: '#', sortable: false, filterable: false, editable: false,
                groupable: false, draggable: false, resizable: false,
                datafield: '', columntype: 'number', width: 30,
                cellsrenderer: function (row, column, value) {
                    return "<div style='margin:4px;'>" + (value + 1) + "</div>";
                }
            }
        ]);

        for (var i in datafields) {
            columns.push({
                text: datafields[i].name,
                datafield: datafields[i].name
            });
        }
        return columns;
    };

    OptProgressDialog.prototype.hide = function () {
        this.$mainControl.parent().hide();
    };

    Brightics.VA.Core.Dialogs.OptProgressDialog = OptProgressDialog;

}).call(this);
/**
 * Created by sds on 2018-02-20.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Core.Dialogs.ScriptEditorDialog.prototype;

    function OptScriptEditorDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    OptScriptEditorDialog.prototype = Object.create(_super);
    OptScriptEditorDialog.prototype.constructor = OptScriptEditorDialog;

    OptScriptEditorDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);
        this.controls = {};
        this.columnControlList = [];
    };

    OptScriptEditorDialog.prototype.createLayout = function ($parent, useTable) {
        _super.createLayout.call(this);
        this.$controlWrapper = $('<div class="brtc-va-dialogs-controlwrapper">');
        this.$controlWrapper.css('display', 'flex');
        this.$infoArea.append(this.$controlWrapper);
    };

    OptScriptEditorDialog.prototype.renderInfoArea = function ($parent, useTable) {
        this.createColumnControls();
        this.fillControlValues();
    };


    OptScriptEditorDialog.prototype.createColumnControls = function ($parent) {
        var controlList = ['parameters', 'constraints-column', 'objectives-column'];
        for (var ctrlIdx = 0; ctrlIdx < controlList.length; ctrlIdx++) {
            var controlNm = controlList[ctrlIdx];
            var paramVal = (this.options.fnUnit.param[controlNm]) ? this.options.fnUnit.param[controlNm] : this.options.fnUnit.param[controlNm.replace('-column', '')];
            this.controls[controlNm] = new Brightics.VA.Core.Editors.Sheet.Controls.Optimization[controlNm](this, {
                value: paramVal
            })
        }
    };

    OptScriptEditorDialog.prototype.renderColumnControls = function ($parent) {
        var controlList = ['parameters', 'constraints-column', 'objectives-column'];
        for (var ctrlIdx = 0; ctrlIdx < controlList.length; ctrlIdx++) {
            this.controls[controlList[ctrlIdx]].renderControl();
        }
    };

    OptScriptEditorDialog.prototype.addPropertyControl = function (label, callback, option) {
        var _this = this;
        if (option.mandatory) label = '<div style="display:inline-block;">' + label + ' <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>';
        var $controlHeader = $('<div class="brtc-va-dialogs-scalaeditor-alias-header">' + label + '</div>');
        var $controlBody = $('<div class="brtc-va-dialogs-scalaeditor-alias-body space"></div>');
        $controlHeader.append($controlBody);
        this.$controlWrapper.append($controlHeader).append($controlBody);

        if (typeof callback === 'function') {
            callback.call(this, $controlBody);
        }

        return $controlBody;
    };

    OptScriptEditorDialog.prototype.createColumnList = function ($control, widgetOptions) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');
        $control.wrap($wrapper);

        var options = {
            placeHolder: 'No Columns',
            multiple: true,
            rowCount: 1,
            maxRowCount: 5,
            expand: false,
            sort: 'none',
            sortBy: 'name',
            showOpener: 'none',
            removable: false,
            defaultType: '-',
            changed: function (type, data) {

            },
            added: function () {

            },
            removed: function () {

            }
        };

        if (widgetOptions) {
            $.extend(options, widgetOptions);
        }

        return new Brightics.VA.Core.Editors.Sheet.Controls.ColumnList($control, options);
    };

    OptScriptEditorDialog.prototype.registerColumnControl = function ($control) {
        this.columnControlList.push($control);
    };

    OptScriptEditorDialog.prototype.fillControlValues = function () {
        var columns = [], _this = this;
        if (this.options.fnUnit[IN_DATA][0]) {
            this.options.dataProxy.requestSchema(this.options.fnUnit[IN_DATA][0],
                function (result) {
                    columns = result.columns;
                    if (_this.columnControlList) {
                        for (var controlIdx = 0; controlIdx < _this.columnControlList.length; controlIdx++) {
                            _this.columnControlList[controlIdx].setItems(columns);
                        }
                    }
                    _this.renderColumnControls();
                },
                function (result) {
                }
            );
        } else {
            _this.renderColumnControls();
        }
    };

    OptScriptEditorDialog.prototype.getTitle = function () {
        return 'Python';
    };


    Brightics.VA.Core.Dialogs.OptScriptEditorDialog = OptScriptEditorDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function OptSelectObjectiveDialog(parentId, options) {
        var _this = this;
        var editor = Studio.getEditorContainer().getActiveModelEditor();
        parentId = parentId || editor.$mainControl;
        options = options || {};
        options.title = 'Select Objective';

        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    OptSelectObjectiveDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    OptSelectObjectiveDialog.prototype.constructor = OptSelectObjectiveDialog;

    OptSelectObjectiveDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 607;
        this.dialogOptions.height = 800;
        this.dialogOptions.modal = true;
        this.dialogOptions.create = function () {
            $('.ui-widget-content').css('border-color', '#d4d4d4');
            //$('.ui-dialog-titlebar-close', $(this).parent()).hide();
        }
    };

    OptSelectObjectiveDialog.prototype.createDialogContentsArea = function ($parent) {
        var containerStyle = 'display: flex;';
        var $container =
            $(`<div class="brtc-va-dialogs-opt-select-objective-container" style="${containerStyle}"></div>`);
        $parent.append($container);

        this.createFunctionsArea($container);
        this.createObjectiveArea($container);

        $container.append(`
            <style>
                .brtc-va-dialogs-opt-select-objective-container div.jqx-expander-header {
                    font-family: Arial, helvetica, sans-serif;
                    font-size: 13px;
                    font-weight: bold;
                    margin-bottom: 5px;
                    border: none;
                    border-bottom-color: white;
                    background: #fff;
                }

                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-header-content-office {
                    margin-left: 19px !important;
                }

                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-arrow {
                    margin-top: 6px !important;
                }

                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-arrow-top-office {
                    background-image: url(/css/plugins/aui-package/images/office-icon-right.png);
                }

                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-arrow-bottom-office {
                    background-image: url(/css/plugins/aui-package/images/office-icon-down.png);
                }

                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-content {
                    border: none;
                    margin-bottom: 15px;
                }

                .brtc-opt-function-table-label:hover {
                    background-color: #f2f2f2;                    
                }

                .brtc-opt-function-table-label.selected {
                    background-color: #EFF1FD;
                    border-color: #626FDB;
                }

                .brtc-opt-function-table-label.selected:hover {
                    background-color: #EFF1FD;
                    border-color: #626FDB;
                }

                .brtc-opt-function-table-label {
                    user-select: text;
                    border: 1px solid white;
                    margin-right: 5px;
                    width: 265px;
                    font-size: 12px;
                    height: 35px;
                    line-height: 35px;
                    box-sizing: border-box;
                    padding: 0 10px 0 13px;
                    cursor: pointer;
                    margin-left: 27px;
                    text-overflow: ellipsis;
                    overflow: hidden;
                    white-space: nowrap;
                }

                .brtc-va-select-opt-objective-mandatory {
                    line-height: 5px;
                    margin-top: 3px;
                    color: #ee7379;
                }
            </style>
        `);

        $parent.perfectScrollbar();
    };

    OptSelectObjectiveDialog.prototype.createFunctionsArea = function ($parent) {
        var _this = this;
        var areaStyle = `
            width: 330px;
            height: 640px;
            overflow: hidden;
            box-sizing: border-box;
            padding-right: 15px;
            position: relative;
        `;
        var $area = $(`<div class="brtc-opt-select-" style="${areaStyle}"></div>`);
        $parent.append($area);

        var functionRowStyle = `
            border-bottom: solid 1px #f2f2f2;
        `;

        var functionSelectControlStyle = `
            box-sizing: border-box;
            width: 270px;
            height: 32px;
            line-height: 32px;
            font-size: 12px;            
            font-family: Arial, Dotum, Tahoma, sans-serif;
            font-weight: bold;            
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 8px;
            margin-left: 0;
            display: flex;
        `;

        var functionSelectControlLabelStyle = `       
            width: 223px;   
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        `;

        var tableLabelControlWrapperStyle = ``;

        var functions = this.options.functions;
        for (var i in functions) {
            (function (functions, i) {
                var $functionRow = $(`<div style="${functionRowStyle}"></div>`);
                $area.append($functionRow);

                var functionLabel = functions[i].display.label;
                var category = Brightics.VA.Core.Functions.Library[functions[i].func].category;
                category = category || 'io';
                var $functionSelectControl = $(`
                    <div class="brtc-va-jqx-expander-header-wrapper" style="margin-bottom: 0;">
                        <div class="brtc-va-fnunit-category-${category}" style="${functionSelectControlStyle}">
                            <div class="brtc-style-views-palette-fnunit-icon" style="margin-top: 5px;"></div>
                            <div class="brtc-opt-function-label" style="${functionSelectControlLabelStyle}"></div>
                        </div>
                    </div>
                `);
                $functionSelectControl.find('.brtc-opt-function-label').text(functionLabel);
                $functionSelectControl.attr('title', functionLabel);
                $functionRow.append($functionSelectControl);

                var $tableLabelControlWrapper = $(`<div style="${tableLabelControlWrapperStyle}"></div>`);
                $functionRow.append($tableLabelControlWrapper);

                var outData = functions[i]['outData'];
                for (var j in outData) {
                    (function (outData, j) {
                        var tableLabel = functionLabel + '-' + (Number(j) + 1);
                        var tableId = outData[j];
                        var $tableLabelControl = $(`
                            <div class="brtc-opt-function-table-label">
                                <i class="fa fa-table" aria-hidden="true"></i>
                                <span style="margin-left: 5px;"></span>
                            </div>
                        `);
                        if (_this.options.objective.tableName === tableId) {
                            $tableLabelControl.addClass('selected');
                        }
                        $tableLabelControl.find('span').text(tableLabel);
                        $tableLabelControl.attr('title', tableLabel);
                        $tableLabelControlWrapper.append($tableLabelControl);
                        $tableLabelControl.click(function () {
                            $area.find('.brtc-opt-function-table-label').removeClass('selected');
                            $(this).addClass('selected');
                            _this.options.objective.fid = functions[i].fid;
                            _this.options.objective.tableName = tableId;

                            _this.$functionLabelControl.text(functionLabel);
                            _this.$functionLabelControl.attr('title', functionLabel);
                            _this.$tableLabelControl.text(tableLabel);
                            _this.$tableLabelControl.attr('title', tableLabel);
                        });
                    })(outData, j);
                }

                $functionRow.jqxExpander({
                    theme: Brightics.VA.Env.Theme,
                    arrowPosition: 'left',
                    expanded: true
                });
            })(functions, i);
        }
        $area.perfectScrollbar();
    };

    OptSelectObjectiveDialog.prototype.createObjectiveArea = function ($parent) {
        var areaStyle = `
            width: 217px;
            height: 440px; 
            overflow: hidden;
        `;
        var $area = $(`<div style="${areaStyle}"></div>`);
        $parent.append($area);

        var controlsContainerStyle = `
            padding: 8px 10px 10px 10px;
            background-color: #f2f2f2;
        `;
        var $controlsContainer = $(`<div style="${controlsContainerStyle}"></div>`);
        $area.append($controlsContainer);

        this.createFunctionLabelControl($controlsContainer);
        this.createTableLabelControl($controlsContainer);
        this.createRowControl($controlsContainer);
        this.createColumnControl($controlsContainer);
        this.createSenseControl($controlsContainer);

        $area.append(`
            <style>
                .brtc-opt-model-sense-radio .jqx-radiobutton-default-office {
                    background-color: #ffffff;
                    border-radius: 100% !important;  
                }
            </style>
        `);
    };

    OptSelectObjectiveDialog.prototype.createFunctionLabelControl = function ($parent) {
        var _this = this;
        $parent.append(`
            <div style="margin: 0 0 4px 0;">
                Function
                <span class="brtc-va-select-opt-objective-mandatory">*</span>
            </div>`);

        var style = `
            width: 197px;
            height: 26px;
            font-family: Arial, helvetica, sans-serif;
            border: 1px solid #d4d4d4;
            line-height: 24px;
            padding-left: 10px;
            padding-right: 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            box-sizing: border-box;
            color: rgba(0, 0, 0, .8);
            cursor: default;
            background-color: #fff;
            opacity: .55;
        `;

        this.$functionLabelControl = $(`<div style="${style}"></div>`);

        var fid = this.options.objective.fid;
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getEditorInput().getContents();
        var fnUnit = contents.getFnUnitById(fid);

        if (fnUnit) {
            var functionLabel = fnUnit.display.label;
            this.$functionLabelControl.text(functionLabel);
            this.$functionLabelControl.attr('title', functionLabel);
        } else {
            this.options.objective.fid = "";
            this.$functionLabelControl.text('Select objective');
        }
        $parent.append(this.$functionLabelControl);
    };

    OptSelectObjectiveDialog.prototype.createTableLabelControl = function ($parent) {
        var _this = this;
        $parent.append(`
            <div style="margin: 10px 0 4px 0;">
                Table Name
                <span class="brtc-va-select-opt-objective-mandatory">*</span>
            </div>`);

        var style = `
            width: 197px;
            height: 26px;
            font-family: Arial, helvetica, sans-serif;
            border: 1px solid #d4d4d4;
            line-height: 24px;
            padding-left: 10px;
            padding-right: 10px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            box-sizing: border-box;
            color: rgba(0, 0, 0, .8);
            cursor: default;
            background-color: #fff;
            opacity: .55;
        `;
        this.$tableLabelControl = $(`<div style="${style}"></div>`);

        var fid = this.options.objective.fid;
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getEditorInput().getContents();
        var fnUnit = contents.getFnUnitById(fid);

        if (fnUnit) {
            var functionLabel = fnUnit.display.label;
            var tableId = this.options.objective.tableName;

            var outData = fnUnit['outData'];
            var tableLabel;
            for (var i in outData) {
                if (outData[i] === tableId) {
                    tableLabel = functionLabel + '-' + (Number(i) + 1);
                    break;
                }
            }
            this.$tableLabelControl.text(tableLabel);
            this.$tableLabelControl.attr('title', tableLabel);
        } else {
            this.options.objective.tableName = "";
            this.$tableLabelControl.text('Select objective');
        }
        $parent.append(this.$tableLabelControl);
    };

    OptSelectObjectiveDialog.prototype.createRowControl = function ($parent) {
        var _this = this;
        $parent.append(`
            <div style="margin: 10px 0 4px 0;">
                Row Number
                <span class="brtc-va-select-opt-objective-mandatory">*</span>
            </div>`);
        this.$rowControlWrapper = $('<div></div>');
        $parent.append(this.$rowControlWrapper);

        var widgetOptions = {
            numberType: 'int',
            min: 1,
            max: 9999,
            minus: false,
            placeholder: 'Enter row number'
        };

        this.$rowControl =
            new Brightics.VA.Core.Editors.Sheet.Controls.NumericInput(
                this.$rowControlWrapper, widgetOptions);
        var rowValue = this.options.objective.row;
        this.$rowControl.setValue(rowValue);

        this.$rowControl.onChange(function (value) {
            _this.options.objective.row = value;
        });
    };

    OptSelectObjectiveDialog.prototype.createColumnControl = function ($parent) {
        var _this = this;
        $parent.append(`
            <div style="margin: 10px 0 4px 0;">
                Column Name
                <span class="brtc-va-select-opt-objective-mandatory">*</span>
            </div>`);
        this.$columnControl = $('<input type="text"/>');
        $parent.append(this.$columnControl);
        this.$columnControl.jqxInput({
            placeHolder: 'Enter column name',
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 25
        });
        this.$columnControl.val(this.options.objective.column);

        this.$columnControl.on('change', function (event) {
            var value = $(this).val();
            _this.options.objective.column = value;
        });
    };

    OptSelectObjectiveDialog.prototype.createSenseControl = function ($parent) {
        var _this = this;
        $parent.append(`
            <div style="margin: 10px 0 4px 0;">
                Sense
                <span class="brtc-va-select-opt-objective-mandatory">*</span>
            </div>`);
        this.$senseMax = $(`<div class="brtc-opt-model-sense-radio" style="margin-top: 10px;">Maximize</div>`);
        this.$senseMin = $(`<div class="brtc-opt-model-sense-radio" style="margin-top: 10px;">Minimize</div>`);

        $parent.append(this.$senseMax);
        $parent.append(this.$senseMin);

        var maxFlag = (this.options.objective.sense.toLowerCase() === 'maximize');
        this.$senseMax.jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            checked: maxFlag
        });

        this.$senseMin.jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            checked: !maxFlag
        });

        this.$senseMax.on('change', function (event) {
            var checked = event.args.checked;
            if (checked) {
                _this.options.objective.sense = 'maximize';
            }
        });

        this.$senseMin.on('change', function (event) {
            var checked = event.args.checked;
            if (checked) {
                _this.options.objective.sense = 'minimize';
            }
        });
    };

    OptSelectObjectiveDialog.prototype.createDialogButtonBar = function ($parent) {
        // do no create buttons

        this.$okButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />');
        $parent.append(this.$okButton);
        this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$okButton.click(this.handleOkClicked.bind(this));

        this.$cancelButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />');
        $parent.append(this.$cancelButton);
        this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$cancelButton.click(this.handleCancelClicked.bind(this));
    };

    OptSelectObjectiveDialog.prototype.handleOkClicked = function () {
        if (typeof this.$mainControl === 'undefined') return;

        if (this.options.objective) {
            if (!(this.options.objective.fid
                && this.options.objective.tableName)) {
                return Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(
                    "Please select objective."
                );
            }

            if (!this.options.objective.row) {
                return Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(
                    "Please enter row number."
                );
            }

            if (!this.options.objective.column) {
                return Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(
                    "Please enter column name."
                );
            }
        }

        this.dialogResult.OK = true;
        this.dialogResult.Cancel = false;
        this.dialogResult.objective = $.extend(true, {}, this.options.objective);

        this.$mainControl.dialog('close');
    };

    OptSelectObjectiveDialog.prototype.render = function (data) {
        var optimization = this.getOptimizationData(data);

        if (optimization) {
            this.$mainControl.parent().show();
            this._render(optimization);
        }
    };

    OptSelectObjectiveDialog.prototype.getOptimizationData = function (originalData) {
        var processes = originalData.processes;
        if (!processes) return null;
        for (var i = processes.length - 1; i >= 0; i--) {
            var functions = processes[i].functions;
            for (var j = functions.length - 1; j >= 0; j--) {
                var optimization = functions[j].optimization;
                if (optimization) {
                    return optimization;
                }
            }
        }
        return null;
    };

    OptSelectObjectiveDialog.prototype._render = function (optimization) {
        var parameter = optimization.parameter;
        var bestParameter = optimization.bestParameter;
        var objectiveValue = optimization.objective;

        this.renderHistory(parameter);
        this.renderBestParam(bestParameter);
        this.renderObjectiveChart(objectiveValue);
    };

    OptSelectObjectiveDialog.prototype.renderHistory = function (parameter) {
        var $target = this.$historyArea.find('.brtc-opt-progress-dialog-history-grid');

        var source = this.convertParamter(parameter);
        var dataAdapter = new $.jqx.dataAdapter(source);
        var columns = this.getColumns(source.datafields);

        this.historyGrid = $target.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: 450,
            height: 322,
            source: dataAdapter,
            columns: columns,
            columnsresize: true
        });
    };

    OptSelectObjectiveDialog.prototype.renderBestParam = function (bestParameter) {
        var $target = this.$bestParamArea.find('.brtc-opt-progress-dialog-best-param-grid');

        var source = this.convertParamter(bestParameter);
        var dataAdapter = new $.jqx.dataAdapter(source);
        var columns = this.getColumns(source.datafields);

        this.bestParameterGrid = $target.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: 450,
            autoheight: true,
            source: dataAdapter,
            columns: columns,
            columnsresize: true
        });
    };

    OptSelectObjectiveDialog.prototype.renderObjectiveChart = function (objectiveValue) {
        var $target = this.$chartArea.find('.brtc-opt-progress-dialog-chart-wrapper');

        if (!this.objectiveValue) {
            this.objectiveValue = objectiveValue;
        }

        var chartOptions = this.getChartOptions(objectiveValue);
        if (!this.chart) {
            $target.empty();
            this.chart = new Brightics.Chart.BCharts($target, chartOptions);
        } else {
            var refresh = false;
            if (this.objectiveValue.length != objectiveValue.length) {
                this.objectiveValue = objectiveValue;
                refresh = true;
            }

            if (refresh) {
                this.chart.setOptions(chartOptions);
            }
        }
    };

    Brightics.VA.Core.Dialogs.OptSelectObjectiveDialog = OptSelectObjectiveDialog;

}).call(this);
/**
 * Created by sds on 2018-10-25.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var _super = Brightics.VA.Dialogs.Dialog.prototype;

    function PropertiesPanelDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    PropertiesPanelDialog.prototype = Object.create(_super);
    PropertiesPanelDialog.prototype.constructor = PropertiesPanelDialog;

    PropertiesPanelDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);

        this.dialogOptions.width = 600;
        this.dialogOptions.height = 540;
        this.dialogOptions.keyboardCloseKey = '';
        this.dialogOptions.closeOnEscape = false;

        this.controls = {};
    };

    PropertiesPanelDialog.prototype.createDialogContentsArea = function ($parent) {
        var option = {
            fnUnit: this.options.fnUnit,
            dataProxy: this.options.dataProxy,
            modelEditor: this.options.modelEditor,
            renderValues: this.renderValues.bind(this),
            fillControlValues: this.fillControlValues.bind(this)
        };
        this.popupProperty = new Brightics.VA.Core.Functions.Library.DialogPanelProperties.propertiesPanel($parent, option);
        this.createContentsAreaControls(this.popupProperty.$contentsArea);
        this.popupProperty.retrieveTableInfo(this.FnUnitUtils.getInTable(this.options.fnUnit));
        this.popupProperty._initializePerfectScroll();
    };

    PropertiesPanelDialog.prototype.fillControlValues = function () {

    };

    PropertiesPanelDialog.prototype.renderValues = function () {

    };

    PropertiesPanelDialog.prototype.handleOkClicked = function () {
        this.dialogResult.param = this.popupProperty.getParams();
        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    PropertiesPanelDialog.prototype.bindValidation = function (ctrlInfo) {
        // var _this = this;
        // if (typeof ctrlInfo.$target == 'undefined') {
        //     return;
        // }
        // if (ctrlInfo.mandatory || this.options.isMandatory) {
        //     this.checkValidation(ctrlInfo);
        //     ctrlInfo.$target.on('change', function (event) {
        //         _this.checkValidation(ctrlInfo)
        //     })
        // }
    };

    PropertiesPanelDialog.prototype.checkValidation = function (ctrlInfo) {
        this.removeValidation(ctrlInfo.$target);
        if (ctrlInfo.control &&
            (!ctrlInfo.control.getValue() || $.isEmptyObject(ctrlInfo.control.getValue()))) {
            var errObj = {
                $target: ctrlInfo.$target,
                message: this.popupProperty.problemFactory.makeMessage({
                    errorCode: 'BR-0033',
                    param: ctrlInfo.$target,
                    messageParam: [ctrlInfo.label]
                })
            };
            this.createValidationContent(errObj)
        }
    };

    PropertiesPanelDialog.prototype.createValidationContent = function (problemData) {
        var $problemContent = $('<div class="brtc-va-editors-sheet-validation-tooltip-wrapper-dialog">' +
            '   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ' +
            '   <div class="brtc-va-editors-sheet-validation-tooltip-dialog">' +
            Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(problemData.message) +
            '</div>' +
            '</div>');
        problemData.$target.append($problemContent);
        problemData.$target.addClass('brtc-va-editors-sheet-validation-error-dialog');
        $problemContent.show();
    };

    PropertiesPanelDialog.prototype.removeValidation = function ($target) {
        $target.find('.brtc-va-editors-sheet-validation-tooltip-wrapper-dialog').remove();
        $target.removeClass('brtc-va-editors-sheet-validation-error-dialog');
    };

    PropertiesPanelDialog.prototype.destroy = function () {
        this.popupProperty.destroy();
        this.$mainControl.dialog('destroy');
        this.$mainControl = undefined;
    };

    PropertiesPanelDialog.prototype.createInput = function ($parent, options) {
        var _this = this;

        var $elements = $('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-input"/>');
        $parent.append($elements);
        var jqxOptions = {
            placeHolder: 'Enter value'
        }
        if (options.widgetOption) {
            jqxOptions = $.extend(true, jqxOptions, options.widgetOption);
        }
        var addClass = (options.addClass) ? options.addClass : '';
        var addCSS = (options.addCSS) ? options.addCSS : '';

        var inputControl = _this.popupProperty.createInput($elements, jqxOptions, addClass, addCSS);


        inputControl.setValue = function (value) {
            $elements.val(value);
        };
        inputControl.getValue = function () {
            return $elements.val();
        };
        inputControl.setDisable = function () {
            this.jqxInput({disabled: true});
        };
        inputControl.setEnable = function () {
            this.jqxInput({disabled: false});
        };

        // this.bindValidation({
        //     $target: options.$parent,
        //     control: inputControl,
        //     mandatory: true,
        //     label: options.label
        // });

        return inputControl
    };

    PropertiesPanelDialog.prototype.createTextArea = function ($parent, options) {
        // var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-textarea"/>');
        // $parent.append($elements);

        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-textareacontrol"/>');
        var $elements = $('<textarea class="brtc-va-editors-sheet-controls-textarea"></textarea>');
        $wrapper.append($elements);
        $parent.append($wrapper);

        var jqxOptions = {
            placeholder: 'sepal_length + 1',
            extraKeys: {
                'Ctrl-Space': 'autocomplete',
                "Tab": false, // Let focus go to next control
                "Shift-Tab": false // Let focus go to previous control
            },
            autofocus: false,
            hintOptions: {list: []}
        };
        if (options.widgetOption) {
            jqxOptions = $.extend(true, jqxOptions, options.widgetOption);
        }
        var addClass = (options.addClass) ? options.addClass : ' ';
        $wrapper.addClass(addClass);

        //CodeMirror 생성 시 this.mainControl로 하고있어서 add class는 parent에 함.
        var control = this.popupProperty.createTextAreaControl($elements, jqxOptions);

        control.codeMirror.options.hintOptions.list = this.columnData.slice();
        control.codeMirror.setSize('100%', options.widgetOption.height);

        return control;
    };

    PropertiesPanelDialog.prototype.createDropDownList = function ($parent, options) {
        var _this = this;
        var source = (options && options.source) ? options.source : [];
        var jqxOptions = {
            source: source,
            selectedIndex: 0
        };
        if (options.widgetOption) {
            jqxOptions = $.extend(true, jqxOptions, options.widgetOption);
        }
        var addClass = (options.addClass) ? options.addClass : '';
        var addCSS = (options.addCSS) ? options.addCSS : '';

        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');
        $parent.append($elements);
        var control = _this.popupProperty.createDropDownList($elements, jqxOptions, addClass, addCSS);

        control.setValue = function (value) {
            if (typeof value != 'undefined') {
                this.jqxDropDownList('selectItem', value);
            }
        };
        control.getValue = function () {
            return this.jqxDropDownList('getSelectedItem').value;
        };
        control.setDisable = function () {
            this.jqxDropDownList({disabled: true});
        };
        control.setEnable = function () {
            this.jqxDropDownList({disabled: false});
        };


        return control;
    };

    PropertiesPanelDialog.prototype.createRadioButton = function ($parent, options) {
        var _this = this;
        var CONTROL_KEY = options.key;
        var source = options.source;
        var jqxOptions = {
            // disabled: options.disabled,
            groupName: CONTROL_KEY
        };

        if (options.widgetOption) {
            jqxOptions = $.extend(true, jqxOptions, options.widgetOption);
        }
        var addClass = (options.addClass) ? options.addClass : '';
        var addCSS = (options.addCSS) ? options.addCSS : '';

        var controlVal = function () {
            if (options.value && source.some(function (srcObj) {
                    return srcObj.value == options.value
                })) {
                return options.value;
            }
        }();
        var control = {}, $elements = {};
        source.forEach(function (srcObj) {
            $elements[CONTROL_KEY + '.' + srcObj.value] = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">' + srcObj.label + '</div>');
            $parent.append($elements[CONTROL_KEY + '.' + srcObj.value]);
            control[CONTROL_KEY + '.' + srcObj.value] = _this.popupProperty.createRadioButton($elements[CONTROL_KEY + '.' + srcObj.value], jqxOptions, addClass, addCSS);

            control[CONTROL_KEY + '.' + srcObj.value].on('checked', function (event) {
                controlVal = srcObj.value;
                // _this.configureControls($parent, options.attr, controlVal);
            });
        });

        control.getValue = function () {
            return controlVal;
        };
        control.setValue = function (value) {
            $elements[CONTROL_KEY + '.' + value].jqxRadioButton('check');
        };

        return control;
    };

    PropertiesPanelDialog.prototype.createCheckBox = function ($parent, options) {
        var $elements = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-checkbox"/>');
        $parent.append($elements);

        var _this = this;
        var jqxOptions = {
            width: 23,
            height: 27
        };
        if (options && options.widgetOption) {
            jqxOptions = $.extend(true, jqxOptions, options.widgetOption);
        }

        var control = this.popupProperty.createCheckBox($elements, jqxOptions);
        var controlVal;
        control.on('checked', options.checkedFunc);
        control.on('unchecked', options.uncheckedFunc);

        control.setValue = function (value) {
            if (value) {
                $elements.jqxCheckBox('check');
            } else {
                $elements.jqxCheckBox('uncheck');
            }
        };
        control.getValue = function () {
            return $elements.val();
        };
        return control;

    };

    PropertiesPanelDialog.prototype.createColumnList = function ($parent, options) {
        var $columnSelector = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-columnlist"/>');
        $parent.append($columnSelector);

        var _this = this;
        var jqxOptions = {
            maxRowCount: 3,
            multiple: true,
            changed: function () {
                _this.bindValidation({
                    mandatory: true,
                    $target: $columnSelector,
                    control: control,
                    label: 'Column'
                });
            }
        };
        if (options && options.widgetOption) {
            jqxOptions = $.extend(true, jqxOptions, options.widgetOption);
        }
        var addClass = (options.addClass) ? options.addClass : '';
        var control = this.popupProperty.createColumnList($columnSelector, jqxOptions, addClass);

        var columnData = this.popupProperty.getColumnData();
        control.setItems(columnData);


        control.setValue = function (value) {
            this.setSelectedItems(value);
            _this.bindValidation({
                mandatory: true,
                $target: $columnSelector,
                control: control,
                label: 'Column'
            });
        };
        control.getValue = function () {
            return this.getSelectedItems();
        };
        return control;
    };


    Brightics.VA.Core.Dialogs.PropertiesPanelDialog = PropertiesPanelDialog;

}).call(this);
/**
 * Created by gy84.bae on 2016-10-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function PythonEditorDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.ScriptEditorDialog.call(this, parentId, options);

        this.checkInfo();
    }

    PythonEditorDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.ScriptEditorDialog.prototype);
    PythonEditorDialog.prototype.constructor = PythonEditorDialog;

    PythonEditorDialog.prototype.renderInfoArea = function () {
        if (!this.options.scriptOnly || this.options.scriptOnly === false) {
            this.renderInputs(this.$infoArea);
            this.renderOutputs(this.$infoArea);
        }
    };

    PythonEditorDialog.prototype.createInTableAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inTableList = this.FnUnitUtils.getInTable(this.options.fnUnit),
            inFunctionList = [];

        for (var i in inTableList) {
            inFunctionList.push(model.getFnUnitByOutData(inTableList[i]));
        }

        for (var i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = 'inputs[' + i + ']';

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutTable(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };

    PythonEditorDialog.prototype.createInModelAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inModelList = this.FnUnitUtils.getInModel(this.options.fnUnit),
            inFunctionList = [];

        for (var i in inModelList) {
            inFunctionList.push(model.getFnUnitByOutData(inModelList[i]));
        }

        for (var i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = 'models[' + i + ']';

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutModel(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };

    PythonEditorDialog.prototype.createInImageAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inImageList = this.FnUnitUtils.getInImage(this.options.fnUnit),
            inFunctionList = [];

        for (var i in inImageList) {
            inFunctionList.push(model.getFnUnitByOutData(inImageList[i]));
        }

        for (var i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = 'images[' + i + ']';

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutImage(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };


    PythonEditorDialog.prototype.renderEditorArea = function () {
        var _this = this;

        this.sendFnunit = $.extend(true, {}, this.options.fnUnit);

        this.codeMirror = CodeMirror.fromTextArea(this.$editorArea.find('textarea')[0], {
            mode: this.scriptEditorOptions.mode,
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: true,
            matchBrackets: true,
            autofocus: false,
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {
                list: this.scriptEditorOptions.additionalHint
            }
        });

        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror);

        Brightics.VA.Core.Utils.WidgetUtils.setCodeMirrorMaxLength(this.codeMirror);

        this.setEditorStatement(this.options.statement);

        this.codeMirror.setSize('100%', '100%');
        this.codeMirror.setOption('maxLength', this.scriptEditorOptions.maxLength);
    };

    PythonEditorDialog.prototype.renderInputs = function ($parent) {
        this.$inputs = $('<div class="brtc-va-dialogs-scalaeditor-alias-in"></div>');

        $parent.append(this.$inputs);

        this.renderInTableAlias(this.$inputs);
        this.renderInModelAlias(this.$inputs);
        this.renderInImageAlias(this.$inputs);
    };

    PythonEditorDialog.prototype.renderInTableAlias = function ($parent) {
        var $inTableAlias = $('<div class="brtc-va-dialogs-scalaeditor-alias-in-table"></div>');

        $parent.append($inTableAlias);

        var $inTableAliasBody = this.addPropertyControl($inTableAlias, {label: 'In Table Variable'});

        this.createInTableAlias($inTableAliasBody);
        $inTableAliasBody.perfectScrollbar();
    };

    PythonEditorDialog.prototype.renderInModelAlias = function ($parent) {
        var $inModelAlias = $('<div class="brtc-va-dialogs-scalaeditor-alias-in-model"></div>');

        $parent.append($inModelAlias);

        var $inModelAliasBody = this.addPropertyControl($inModelAlias, {label: 'In Model Variable'});

        this.createInModelAlias($inModelAliasBody);
        $inModelAliasBody.perfectScrollbar();
    };

    PythonEditorDialog.prototype.renderInImageAlias = function ($parent) {
        var $inImageAlias = $('<div class="brtc-va-dialogs-scalaeditor-alias-in-image"></div>');

        $parent.append($inImageAlias);

        var $inImageAliasBody = this.addPropertyControl($inImageAlias, {label: 'In Image Variable'});

        this.createInImageAlias($inImageAliasBody);
        $inImageAliasBody.perfectScrollbar();
    };

    PythonEditorDialog.prototype.renderOutputs = function ($parent) {
        var _this = this;

        var $outputs = $('<div class="brtc-va-dialogs-scalaeditor-alias-out"></div>');

        $parent.append($outputs);

        this.$outputsBody = this.addPropertyControl($outputs, {label: 'Outputs'});
        this.$outputsBody.perfectScrollbar();

        this.$addButton = $('<input type="button" class= "brtc-va-editors-sheet-controls-propertycontrol-addbutton" value="+ Add Output"/>');
        $outputs.find('.brtc-va-dialogs-scalaeditor-alias-header').after(this.$addButton);
        this.$addButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 32
        });
        this.$addButton.click(function () {
            _this.createOutTableAlias(_this.$outputsBody, false);
            _this.$outputsBody.perfectScrollbar('update');
        });

        this.createOutput(_this.$outputsBody);
    };

    PythonEditorDialog.prototype.createOutput = function ($parent) {
        var _this = this;
        var outputs = this.FnUnitUtils.getOutputs(this.options.fnUnit);
        var i=0;
        _.forEach(outputs, function (tid, key) {
            var $optionalInput = _this.createOutTableAlias($parent, false, tid);
            var type = _this.FnUnitUtils.getTypeByTableId(_this.options.fnUnit, tid)
            $optionalInput.find('.alias input').val(key);
            $optionalInput.find('.type .brtc-va-dialogs-scalaeditor-alias-body-outtable-type').val(type);
        });

        $parent.perfectScrollbar();
    };

    PythonEditorDialog.prototype.createOutTableAlias = function ($parent, isMandatory, tableId) {
        var $aliasUnit = $('' +
            '<div class="brtc-va-dialogs-contents-statement-lastline-element-wrapper">' +
            '   <div class="brtc-va-dialogs-contents-statement-lastline-element-script alias"></div>' +
            '   <div class="brtc-va-dialogs-contents-statement-lastline-element-script-type type"></div>' +
            '</div>'
        );

        $parent.append($aliasUnit);

        this.createInput($aliasUnit.find('.brtc-va-dialogs-contents-statement-lastline-element-script'), '', isMandatory, tableId);
        this.createDropDownList($aliasUnit.find('.brtc-va-dialogs-contents-statement-lastline-element-script-type'), '', isMandatory, tableId);

        return $aliasUnit;
    };

    PythonEditorDialog.prototype.createInput = function ($parent, alias, isMandatory, tableId) {
        var _this = this;

        var $outTableInput = $('' +
            '<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable" tableId="' + tableId + '">' +
            '   <input class="brtc-va-dialogs-scalaeditor-alias-body-outtable-input" isMandatory=' + isMandatory + ' />' +
            '   <div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-remove""></div>' +
            '</div>' +
            '');

        var $input = $outTableInput.find('input');

        $parent.append($outTableInput);

        $input.jqxInput({
            placeHolder: "Enter alias",
            height: 32,
            width: '105px',
            theme: 'office'
        });
        $input.jqxInput('val', alias);

        if ($input.val() === '' || $input.val() == undefined) {
            $input.css('border-color', 'red');

        }

        $input.focus();

        $input.on('change', function () {
            if ($(this).val() == '') {
                $(this).css('border-color', 'red');
            } else {
                $(this).css('border-color', '#d4d4d4');
            }
        });

        $input.keydown(function (key) {
            if (key.keyCode == 13) {
                _this.createOutTableAlias(_this.$outputsBody, false);
            }
        });

        if (isMandatory == true && alias == '') {
            $input.css('border-color', 'red');
        }

        var $removeButton = $outTableInput.find('.brtc-va-dialogs-scalaeditor-alias-body-outtable-remove');
        $removeButton.attr({
            'isMandatory': isMandatory
        });

        $removeButton.click(function () {
            var $target = $(this).closest('.brtc-va-dialogs-contents-statement-lastline-element-wrapper');
            if ($target.find('.brtc-va-dialogs-scalaeditor-alias-body-outtable').attr('tableId')) _this.removeSendFnunit($target.attr('tableId'));
            $target.remove();
            _this.$outputsBody.perfectScrollbar('update');
        });

        return $input;
    };

    PythonEditorDialog.prototype.removeSendFnunit = function (tableId) {
        //????? 뭐지 send?
        // var tableIdIndex = this.FnUnitUtils.getOutTable(this.sendFnunit).indexOf(tableId);

        // this.sendFnunit[OUT_DATA].splice(tableIdIndex, 1);
        // this.sendFnunit.param['out-table-alias'].splice(tableIdIndex, 1);
    };

    PythonEditorDialog.prototype.addPropertyControl = function ($parent, options) {
        var _this = this;

        var label = options.label;
        if(options.mandatory) label = '<div style="display:inline-block;">' + label + ' <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>';
        var $controlHeader = $('<div class="brtc-va-dialogs-scalaeditor-alias-header">' + label + '</div>');
        var $controlBody = $('<div class="brtc-va-dialogs-scalaeditor-alias-body"></div>');

        $parent.append($controlHeader).append($controlBody);

        return $controlBody;
    };

    PythonEditorDialog.prototype.getTitle = function () {
        return 'Python';
    };

    PythonEditorDialog.prototype.createSendOutputs = function () {

    };

    PythonEditorDialog.prototype.handleOkClicked = function () {
        if (this.options.scriptOnly || this.options.scriptOnly === false) {
            this.dialogResult = {
                OK: true,
                Cancel: false,
                queryStatement: this.codeMirror.getValue()
            };
        } else {
            var aliasArr = this.$outputsBody.find('.brtc-va-dialogs-contents-statement-lastline-element-wrapper');

            this.sendFnunit['outputs'] = {};
            this.sendFnunit['meta'] = {
                'inputs': {'type': 'table', 'range':{'min':1, 'max':10}},
                'models': {'type': 'model', 'range':{'min':1, 'max':10}},
                'images': {'type': 'image', 'range':{'min':1, 'max':10}}
            };
            for (var i = 0; i < aliasArr.length; i++) {
                var alias = $(aliasArr[i]).find('.brtc-va-dialogs-scalaeditor-alias-body-outtable input').val();
                var type = $(aliasArr[i]).find('.brtc-va-dialogs-scalaeditor-alias-body-outtable-type').val();
                var tableId = $(aliasArr[i]).find('.brtc-va-dialogs-scalaeditor-alias-body-outtable').attr('tableId');
                if (tableId === 'undefined' || !tableId) tableId = Brightics.VA.Core.Utils.IDGenerator.table.id();

                this.sendFnunit['outputs'][alias] = tableId;
                this.sendFnunit['meta'][alias] = {type: type};
            }

            this.sendFnunit.param.script = this.codeMirror.getValue();
            this.dialogResult = {
                OK: true,
                Cancel: false,
                param: this.sendFnunit.param,
                outputs: this.sendFnunit.outputs,
                meta: this.sendFnunit.meta
            };
        }

        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.PythonEditorDialog = PythonEditorDialog;

}).call(this);
/**
 * Created by gy84.bae on 2016-10-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function REditorDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.ScriptEditorDialog.call(this, parentId, options);
    }

    REditorDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.ScriptEditorDialog.prototype);
    REditorDialog.prototype.constructor = REditorDialog;

    REditorDialog.prototype.renderInfoArea = function ($parent, useTable) {
        var _this = this;
        this.$trueControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">true</div>');
        this.$falseControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">false</div>');

        this.$infoArea.addClass('rscript');
        this.$infoArea.append('' +
            '<div class="brtc-va-dialogs-controls-propertycontrol-columnlist"/>' +
            '<div class="brtc-va-dialogs-controls-propertycontrol-groupbylist"/>' +
            '<div class="brtc-va-dialogs-controls-propertycontrol-stringasfactors"/>' +
            '<div class="brtc-va-dialogs-controls-propertycontrol-resultlist"/>' +
            '');

        this.$columns = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-columnlist');
        this.$groupby = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-groupbylist');
        this.$stringasfactors = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-stringasfactors');
        this.$resultNames = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-resultlist');


        this.addPropertyControl('Columns', function ($contents) {
            $contents.append(this.$columns);

            var widgetOptions = {
                multiple: true,
                maxRowCount: 3,
                sort: 'none',
                showOpener: 'button',
                changed: function (type, data) {
                    _this.selectedColumns = data.items;
                    _this.renderValidation();
                }
            };
            _this.columnsControl = _this.createColumnList(_this.$columns, widgetOptions);
        }, {mandatory: true});

        this.addPropertyControl('Group by', function ($contents) {
            $contents.append(this.$groupby);
            var widgetOptions = {
                multiple: true,
                maxRowCount: 3,
                sort: 'none',
                showOpener: 'button',
                changed: function (type, data) {
                    _this.selectedGroupby = data.items;
                    _this.renderValidation();
                }
            };
            _this.groupbyControl = _this.createColumnList(_this.$groupby, widgetOptions);
        }, {mandatory: false});

        this.addPropertyControl('Strings As Factors', function ($contents) {
            this.$stringasfactors.append(this.$trueControl).append(this.$falseControl);
            $contents.append(this.$stringasfactors);

            _this.createRadioButton(_this.$trueControl, {width: '80', groupName: 'Group'});
            _this.createRadioButton(_this.$falseControl, {width: '80', groupName: 'Group'});

            _this.$trueControl.on('checked', function () {
                _this.selectedFactors = 'true';
            });

            _this.$falseControl.on('checked', function () {
                _this.selectedFactors = 'false';
            });

        }, {mandatory: false});

        this.addPropertyControl('Result Columns', function ($contents) {
            $contents.append(this.$resultNames);
            _this.resultColumnsControl = _this.createResultNameList(_this.$resultNames)

        }, {mandatory: true});

        this.fillControlValues();
        this.renderValues();
    };

    REditorDialog.prototype.createResultNameList = function ($contents) {
        var resultColumnList = this.options.fnUnit.param['result-names'];

        if (resultColumnList === undefined) {
            this.createResultControlLayout(0, true, $contents);
        } else if (resultColumnList.length === 0) {
            this.createResultControlLayout(0, true, $contents);
        } else {
            for (var i = 0; i < resultColumnList.length; i++) {
                this.createResultControlLayout(i, true, $contents);
            }
        }
    };

    REditorDialog.prototype.createResultControlLayout = function (inputIndex, addable, $contents, focus) {
        var $parents = $contents;
        var _this = this;
        var deletable = false;
        var $inputContainer = $('<div class="brtc-va-rcontents-input-container"></div>');

        var $children = $parents.find('.brtc-va-rcontents-input-container');

        if ($children.length === 0 || !$children[inputIndex]) {
            $parents.append($inputContainer);
        } else {
            $($children[inputIndex]).after($inputContainer);
            deletable = true;
        }

        var $inputDiv = $('<div class="brtc-va-widget-contents-input-control-container"></div>');
        var $addDiv, $deleteDiv;

        $inputContainer.append($inputDiv);
        if (addable) {
            $addDiv = $('<div class="brtc-va-widget-contents-input-control-add"></div>');
            $inputContainer.append($addDiv);

            $addDiv.click(function (event) {
                _this.handleAddInputControlEvent($(this).closest('.brtc-va-rcontents-input-container'), $parents);
            })
        }
        if (inputIndex > 0 || deletable) {
            $deleteDiv = $('<div class="brtc-va-widget-contents-input-control-delete"></div>');
            $inputContainer.append($deleteDiv);

            $deleteDiv.click(function (event) {
                _this.handleDeleteButtonClick($(this).closest('.brtc-va-rcontents-input-container'));
            })
        }

        this.createInputControl($inputDiv, focus);
    };

    REditorDialog.prototype.handleAddInputControlEvent = function ($target, $contents, focus) {
        var index = $target.index();
        this.createResultControlLayout(index, true, $contents, focus);
        this.getInputValue();
        this.renderValidation();
    };

    REditorDialog.prototype.handleDeleteButtonClick = function ($target) {
        $target.remove();
        this.getInputValue();
        this.renderValidation();
    };

    REditorDialog.prototype.createInputControl = function ($parent, focus) {
        var _this = this;
        var $inputControl;

        $inputControl = $('<input type="text" class="brtc-va-widget-contents-input-control"/>');
        $parent.append($inputControl);
        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%'
        };
        $inputControl.jqxInput(options);

        if (!focus) {
            $inputControl.jqxInput('focus');
        }

        $inputControl.keydown(function (key) {
            if (key.keyCode == 13) {
                _this.handleAddInputControlEvent($inputControl.closest('.brtc-va-rcontents-input-container'), true);
                _this.getInputValue();
                _this.renderValidation();

            }
        });
        $inputControl.focusout(function (event) {
            _this.getInputValue();
            _this.renderValidation();
        });
    };

    REditorDialog.prototype.getInputValue = function () {
        var inputValue;
        var controls = this.$resultNames.find('.brtc-va-widget-contents-input-control');

        inputValue = [];
        for (var i = 0; i < controls.length; i++) {
            if ($(controls[i]).val()) {
                inputValue.push($(controls[i]).val());
            }
        }
        this.resultColumns = inputValue;
        //return inputValue;
    };

    REditorDialog.prototype.setInputValue = function (value) {
        var controls = this.$resultNames.find('.brtc-va-widget-contents-input-control');
        for (var i = 0; i < controls.length; i++) {
            $(controls[i]).val(value[i] || '');
        }
    };

    REditorDialog.prototype.fillControlValues = function () {
        var columnData = this.options.dataMap ? (this.options.fnUnit[IN_DATA][0] ? this.options.dataMap[this.options.fnUnit[IN_DATA][0]].columns : []) : [];
        var byteData = [];
        var data = [];
        $.each(columnData, function (index, value) {
            if (value.type === "byte[]") {
                byteData.push(value);
            } else {
                data.push(value);
            }
        });
        this.groupbyControl.setItems(data);
        this.columnsControl.setItems(byteData);
    };


    REditorDialog.prototype.renderValues = function () {
        var param = this.options.fnUnit.param;

        this.columnsControl.setSelectedItems(param.columns[0]);

        var paramGroupBy = this.options.fnUnit.param.groupby;
        if (paramGroupBy) {
            this.groupbyControl.setSelectedItems(paramGroupBy);
        } else {
            this.groupbyControl.setSelectedItems([]);
        }

        var paramFactors = this.options.fnUnit.param['strings-as-factors'];
        if (paramFactors === '') {
            this.$trueControl.jqxRadioButton('check');
        } else {
            if (paramFactors === 'true') this.$trueControl.jqxRadioButton({checked: true});
            if (paramFactors === 'false') this.$falseControl.jqxRadioButton({checked: true});
        }

        var paramResultColumn = this.options.fnUnit.param['result-names'];
        this.setInputValue(paramResultColumn);

        this.selectedColumns = param.columns[0];
        this.selectedGroupby = paramGroupBy;
        this.selectedFactors = paramFactors;
        this.resultColumns = paramResultColumn;
    };

    REditorDialog.prototype.renderValidation = function () {
        //this.selectedColumns = this.columnsControl.val();
        //this.selectedGroupby = this.groupbyControl.val();

        if (this.selectedColumns.length === 0) {
            this.createValidationContent(this.$columns.parent(), '"Columns" filed is required.', true)
        } else {
            this.removeValidation(this.$columns.parent().parent());
        }
        if (this.resultColumns.length === 0) {
            this.createValidationContent(this.$resultNames, '"Result Columns" filed is required.', true)
        }
        else {
            var isValid = true;
            for (var i in this.resultColumns) {
                if (!(Brightics.VA.Core.Utils.InputValidator.isValid.columnNameType(this.resultColumns[i]))) {
                    isValid = false;
                    break;
                }
            }
            if (isValid) {
                this.removeValidation(this.$resultNames);
            }
            else {
                this.createValidationContent(this.$resultNames, 'If the column name begins with _ or is only a number, it may be a problem in some functions later.', true);
            }
        }
    };

    REditorDialog.prototype.removeValidation = function ($parent) {
        $parent.find('.brtc-va-editors-sheet-panels-validation-tooltip').remove();
        $parent.find('.brtc-va-editors-sheet-controls-propertycontrol-label').removeClass('brtc-va-editors-sheet-controls-propertycontrol-label-error');
        $parent.find('.brtc-va-editor-sheet-panels-validation-error').removeClass('brtc-va-editor-sheet-panels-validation-error');
        $parent.find('.brtc-va-editors-sheet-panels-validation-tooltip').remove();
    };

    REditorDialog.prototype.createValidationContent = function ($parent, problemData, clearBoth) {
        var problemDiv = $parent.find('.brtc-va-editors-sheet-panels-validation-tooltip');
        if (problemDiv) {
            problemDiv.remove();
        }
        var $problemContent = $('<div class="brtc-va-editors-sheet-panels-validation-tooltip">' +
            '<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ' + problemData +
            '</div>');
        $parent.append($problemContent);
        $parent.addClass('brtc-va-editor-sheet-panels-validation-error');
        if (clearBoth) $problemContent.css('clear', 'both');
        var columnList = $parent.find('.brtc-va-editors-sheet-controls-columnselector');

        if (columnList.is('div')) {
            columnList.data().renderMissingColumns();
        }
        $problemContent.show();

    };

    REditorDialog.prototype.addPropertyControl = function (label, callback, option) {
        var _this = this,
            $propertyControl = $('' +
                '<div class="brtc-va-editors-sheet-controls-propertycontrol">' +
                '   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>' +
                '   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents">' +
                '</div>');

        if (option) {
            if (option.mandatory) {
                label = '<div>' + label +
                    '   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div>' +
                    '</div>';
            }
            _this.$infoArea.append($propertyControl);
        }
        else {
            _this.$infoArea.append($propertyControl);
        }

        $propertyControl.jqxExpander(
            {
                theme: Brightics.VA.Env.Theme,
                arrowPosition: "left",
                initContent: function () {
                    if (typeof  callback === 'function') {
                        callback.call(_this, $propertyControl.find(".brtc-va-editors-sheet-controls-propertycontrol-contents"), option);
                    }
                }
            });
        $propertyControl.jqxExpander('setHeaderContent', label);

        return $propertyControl;
    };

    REditorDialog.prototype.createColumnList = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            openerPosition: 'bottom',
            multiple: true,
            rowCount: 1,
            maxRowCount: 5,
            expand: false,
            sort: 'none',
            sortBy: 'name',
            showOpener: 'button',
            removable: true,
            defaultType: '-',
            changed: function (type, data) {

            },
            added: function () {

            },
            removed: function () {

            }
        };

        if (widgetOptions) {
            $.extend(options, widgetOptions);
        }

        var _columnList = new Brightics.VA.Core.Editors.Sheet.Controls.ColumnList($control, options);

        _columnList.columnSelector.$mainControl.attr('isDialog', true);
        return _columnList;
    };

    REditorDialog.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');
        $control.wrap($wrapper);
    };

    REditorDialog.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    REditorDialog.prototype.addCssToWrapper = function ($control, cssOptions) {
        if (cssOptions) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.css(cssOptions);
        }
    };

    REditorDialog.prototype.handleOkClicked = function () {

        this.dialogResult = {
            OK: true,
            Cancel: false,
            queryStatement: this.codeMirror.getValue(),
            columns: this.selectedColumns,
            groupbys: this.selectedGroupby,
            factors: this.selectedFactors,
            resultNames: this.resultColumns
        };
        this.$mainControl.dialog('close');
    };

    REditorDialog.prototype.getTitle = function () {
        return 'R';
    };

    Brightics.VA.Core.Dialogs.REditorDialog = REditorDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-07-28.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;
    var MAX_STEP_LENGTH = 20;
    var ADDITIONAL_STEP_LENGTH = 0;
    var REFINE_STEPS = {
        'addColumnByRefine': {clazz: 'AddColumnDialog', validator: 'AddColumnValidator'},
        'selectColumn': {clazz: 'SelectColumnDialog', validator: 'AddColumnValidator'},
        'changeValue': {clazz: 'ChangeValueDialog', validator: 'AddColumnValidator'},
        'groupBy': {clazz: 'GroupByDialog', validator: 'AddColumnValidator'},
        'simpleFilter': {clazz: 'SimpleFilterDialog', validator: 'AddColumnValidator'},
        'advancedFilter': {clazz: 'AdvancedFilterDialog', validator: 'AddColumnValidator'},
        'sortByRefine': {clazz: 'SortDialog', validator: 'AddColumnValidator'}
    };

    function RefineDialog(parentId, options) {
        ADDITIONAL_STEP_LENGTH = 0;
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true,
            param: {
                'functions': $.extend(true, [], options.fnUnit.param.functions)
            }
        };
        this.dialogResult.param.functions.splice(this.dialogResult.param.functions.length - 1, 1);
        this.retrieveParent();
        this.createControls();
        this.initContents();
        this.render();
    }

    RefineDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    RefineDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main">' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents brtc-va-dialogs-refine-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />' +
            '       </div>' +
            '   </div>' +
            '</div>');

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        var _this = this;
        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: 'Refine Data',
            width: 1024,
            height: 800,
            maxWidth: 1024,
            maxHeight: 800,
            modal: true,
            resizable: false,
            create: function () {
                $('.ui-dialog-titlebar-close', $(this).parent()).hide();
            },
            close: function () {
                _this.$mainControl.dialog('destroy');
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        };
        this.$mainControl.dialog(jqxOpt);
    };

    RefineDialog.prototype.initContents = function () {
        var _this = this;
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$okButton.click(_this.handleOkClicked.bind(_this));

        _this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$cancelButton.click(_this.handleCancelClicked.bind(_this));
    };

    RefineDialog.prototype.handleOkClicked = function () {
        var _this = this;
        var waringList = this.$mainControl.find('.brtc-va-refine-step-warning');
        if (waringList.length > 0) {
            var closeHandler = function (confirmResult) {
                if (confirmResult.OK) {
                    _this.dialogResult.OK = true;
                    _this.dialogResult.Cancel = false;
                    _this.$mainControl.dialog('close');
                }
            };
            var message = 'The steps you need to check exists. Do you want to continue?';
            Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog(message, closeHandler);
        } else {
            this.dialogResult.OK = true;
            this.dialogResult.Cancel = false;
            this.$mainControl.dialog('close');
        }

    };

    RefineDialog.prototype.handleCancelClicked = function () {
        var _this = this;
        _this.dialogResult.OK = false;
        _this.dialogResult.Cancel = true;
        this.$mainControl.dialog('close');
    };


    RefineDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-refine-toolbar-area">' +
            '   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-addcolumn">Add Column</div>' +
            '   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-changevalue">Change Value</div>' +
            '   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-selectcolumn">Select Column</div>' +
            '   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-simplefilter">Simple Filter</div>' +
            '   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-advancedfilter">Advanced Filter</div>' +
            '   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-sorter">Sorter</div>' +
            '   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-groupby">Group-by</div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-refine-left-area">' +
            '</div>' +
            '<div class="brtc-va-dialogs-refine-right-area">' +
            '   <div class="brtc-va-refine-step-container">' +
            '       <div class="brtc-va-refine-step-container-header">Applied Steps</div>' +
            '       <div class="brtc-va-refine-step-container-body">' +
            '       </div>' +
            '   </div>' +
            '</div>');

        $parent.find('.brtc-va-refine-step-container-body').perfectScrollbar();
        $parent.find('.brtc-va-refine-step-container-body').perfectScrollbar('update');

        var $openStep = $('' +
            '<div class="brtc-va-refine-step-open">' +
            '   <div class="brtc-va-refine-step-header-open">' +
            '       <div class="brtc-va-refine-step-label-open" id="open">Open</div>' +
            '   </div>' +
            '</div>'
        );
        $openStep.find('.brtc-va-refine-step-header-open').click(function () {
            _this.refreshData(-1);
        });

        $parent.find('.brtc-va-refine-step-container-body').append($openStep);
        $parent.find('.brtc-va-dialogs-refine-toolitem').jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        var _this = this;
        var checkMaxStepLength = function (callback) {
            if (ADDITIONAL_STEP_LENGTH >= MAX_STEP_LENGTH) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('The maximum number of steps that can be added to refine data is ' + MAX_STEP_LENGTH + '.');
                return;
            }
            callback();
        };
        $parent.find('.brtc-va-dialogs-refine-toolitem-addcolumn').on('click', function () {
            var callback = function () {
                var doneCallBack = function (result) {
                    var options = {
                        func: 'addColumnByRefine',
                        in: _this.getInput(),
                        out: [Brightics.VA.Core.Utils.IDGenerator.table.id()],
                        columns: $.extend(true, [], result),
                        close: _this.dialogClosed.bind(_this),
                        force: false,
                        context : _this.options.context
                    };
                    _this.openStepDialog(options);
                };
                _this.getSchema(doneCallBack);
            };
            checkMaxStepLength(callback);
        });
        $parent.find('.brtc-va-dialogs-refine-toolitem-changevalue').on('click', function () {
            var callback = function () {
                var doneCallBack = function (result) {
                    var options = {
                        func: 'changeValue',
                        in: _this.getInput(),
                        out: [Brightics.VA.Core.Utils.IDGenerator.table.id()],
                        columns: $.extend(true, [], result),
                        close: _this.dialogClosed.bind(_this),
                        force: false,
                        context : _this.options.context
                    };
                    _this.openStepDialog(options);
                };
                _this.getSchema(doneCallBack);
            };
            checkMaxStepLength(callback);
        });
        $parent.find('.brtc-va-dialogs-refine-toolitem-selectcolumn').on('click', function () {
            var callback = function () {
                var doneCallBack = function (result) {
                    var options = {
                        func: 'selectColumn',
                        in: _this.getInput(),
                        out: [Brightics.VA.Core.Utils.IDGenerator.table.id()],
                        columns: $.extend(true, [], result),
                        close: _this.dialogClosed.bind(_this),
                        force: false,
                        context : _this.options.context
                    };
                    _this.openStepDialog(options);
                };
                _this.getSchema(doneCallBack);
            };
            checkMaxStepLength(callback);
        });
        $parent.find('.brtc-va-dialogs-refine-toolitem-simplefilter').on('click', function () {
            var callback = function () {
                var doneCallBack = function (result) {
                    var options = {
                        func: 'simpleFilter',
                        in: _this.getInput(),
                        out: [Brightics.VA.Core.Utils.IDGenerator.table.id()],
                        columns: $.extend(true, [], result),
                        close: _this.dialogClosed.bind(_this),
                        force: false,
                        context : _this.options.context
                    };
                    _this.openStepDialog(options);
                };
                _this.getSchema(doneCallBack);
            };
            checkMaxStepLength(callback);
        });
        $parent.find('.brtc-va-dialogs-refine-toolitem-advancedfilter').on('click', function () {
            var callback = function () {
                var doneCallBack = function (result) {
                    var options = {
                        func: 'advancedFilter',
                        in: _this.getInput(),
                        out: [Brightics.VA.Core.Utils.IDGenerator.table.id()],
                        columns: $.extend(true, [], result),
                        close: _this.dialogClosed.bind(_this),
                        force: false,
                        context : _this.options.context
                    };
                    _this.openStepDialog(options);
                };
                _this.getSchema(doneCallBack);
            };
            checkMaxStepLength(callback);
        });
        $parent.find('.brtc-va-dialogs-refine-toolitem-sorter').on('click', function () {
            var callback = function () {
                var doneCallBack = function (result) {
                    var options = {
                        func: 'sortByRefine',
                        in: _this.getInput(),
                        out: [Brightics.VA.Core.Utils.IDGenerator.table.id()],
                        columns: $.extend(true, [], result),
                        close: _this.dialogClosed.bind(_this),
                        force: false,
                        context : _this.options.context
                    };
                    _this.openStepDialog(options);
                };
                _this.getSchema(doneCallBack);
            };
            checkMaxStepLength(callback);
        });
        $parent.find('.brtc-va-dialogs-refine-toolitem-groupby').on('click', function () {
            var callback = function () {
                var doneCallBack = function (result) {
                    var options = {
                        func: 'groupBy',
                        in: _this.getInput(),
                        out: [Brightics.VA.Core.Utils.IDGenerator.table.id()],
                        columns: $.extend(true, [], result),
                        close: _this.dialogClosed.bind(_this),
                        force: false,
                        context : _this.options.context
                    };
                    _this.openStepDialog(options);
                };
                _this.getSchema(doneCallBack);
            };
            checkMaxStepLength(callback);
        });

    };

    RefineDialog.prototype.fillSpreadsheet = function ($parent, table, force) {
        $parent.empty();
        var _this = this;
        var doneCallback = function (result) {
            _this.$spreadsheet = $('<div class="brtc-va-refine-spreadsheet"></div>');
            $parent.empty();
            $parent.append(_this.$spreadsheet);

            var source = {
                localdata: result.data,
                datatype: 'array',
                datafields: $.map(result.columns, function (column, index) {
                    return {
                        name: '__' + column.name,
                        type: column.type,
                        map: '' + index
                    };
                })
            };

            var tableColumns = $.map(result.columns, function (column, index) {
                var col = {
                    text: column.name,
                    datafield: '__' + column.name,
                    width: 80
                };
                if (column.type == 'date') {
                    col.cellsformat = 'yyyy-MM-dd HH:mm:ss:fff';
                } else if (column.type == 'number') {
                    col.cellsformat = 'd';
                    col.cellsalign = 'right';
                } else if (column.type == 'string') {
                    col.cellsrenderer = function (row, column, value) {
                        var styleText = 'overflow:hidden; text-overflow:ellipsis; padding-bottom:2px; margin-right: 2px; margin-left: 4px; margin-top: 4px;';

                        var cellValue = this.owner.source.records[row][column];

                        if (cellValue === undefined || cellValue === '' || cellValue === null) {
                            var _localdata = this.owner.source._source.localdata[row],
                                _datafields = this.owner.source._source.datafields,
                                _objIndex = 0;

                            for (var i in _datafields) {
                                if (_datafields[i].name === column) {
                                    _objIndex = Number(_datafields[i].map);
                                    break;
                                }
                            }

                            if (_localdata[_objIndex] === undefined) {
                                return '<div style="' + styleText + 'color: #ff3333">undefined</div>';
                            } else if (_localdata[_objIndex] === null) {
                                return '<div align="right" style="' + styleText + 'color: #ff3333">null</div>';
                            } else if (_localdata[_objIndex] === '') {
                                return '<div align="right" style="' + styleText + '"></div>';
                            }
                        } else {
                            return '<div style="' + styleText + '">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(value) + '</div>';
                        }
                    }
                }
                return col;
            });
            tableColumns.unshift({
                text: 'No', sortable: false, menu: false, editable: false, groupable: false, draggable: false,
                datafield: '', width: 40,
                columntype: 'number',
                renderer: function (value) {
                    return '<div class="brtc-va-refine-spreadsheet-rownum-column">' + value + '</div>';
                },
                cellsformat: 'd', cellsalign: 'right',
                cellclassname: 'brtc-va-refine-spreadsheet-rownum-cell',
                cellsrenderer: function (row, column, value) {
                    return '<div align="right" style="margin:4px;">' + (value + 1) + '</div>';
                }
            });

            var dataAdapter = new $.jqx.dataAdapter(source);
            _this.$spreadsheet.jqxGrid({
                theme: Brightics.VA.Env.Theme,
                width: '100%',
                height: '100%',
                rowsheight: 25,
                source: dataAdapter,
                altrows: false,
                filterable: false,
                sortable: false,
                columnsresize: true,
                selectionmode: 'multiplecellsextended',
                columns: tableColumns
            });

            _this.$spreadsheet.on("columnclick", function (event) {
                if (event.args.column.text == "No") {
                    $(this).jqxGrid('autoresizecolumns');
                }
            });
        };
        var failCallback = function (err) {
            _this.$spreadsheet = $('<div class="brtc-va-refine-spreadsheet"></div>');
            $parent.empty();
            $parent.append(_this.$spreadsheet);
            _this.$spreadsheet.jqxGrid({
                theme: Brightics.VA.Env.Theme,
                width: '100%',
                height: '100%',
                rowsheight: 25,
                altrows: false,
                filterable: false,
                sortable: false,
                columnsresize: true,
                selectionmode: 'multiplecellsextended'
            });
        };
        if (force) {
            this.options.dataProxy.requestDataForce(table, doneCallback, failCallback);
        } else {
            this.options.dataProxy.requestData(table, doneCallback, failCallback);
        }


    };

    RefineDialog.prototype.dialogClosed = function (dialogResult) {
        var _this = this;
        if (dialogResult.OK) {
            _this.callFunction(dialogResult.FnUnit, dialogResult.force);
        }
    };

    RefineDialog.prototype.addStep = function (result) {
        var _this = this;
        var hasFnUnit = true;
        $.each(_this.dialogResult.param.functions, function (key, fnUnit) {
            if (fnUnit.fid && fnUnit.fid == result.fid) {
                _this.dialogResult.param.functions[key] = $.extend(true, {}, result);
                hasFnUnit = false;
                return;
            }
        });
        if (hasFnUnit) {
            _this.appendFnUnit(result);
            _this.appendStep(result);
        }

    };

    RefineDialog.prototype.callFunction = function (fnUnit, force) {
        var _this = this;
        fnUnit.parent = function () {
            var parent = $.extend(true, {}, _this.options.fnUnit.parent());
            parent.functions = [fnUnit];
            parent.links = [];
            return parent;
        };

        var newFnUnit = $.extend(true, {}, fnUnit);
        newFnUnit.param['additional-query'] = fnUnit.param['additional-query'];
        _this.addStep(fnUnit);
        var index = $.inArray(fnUnit.fid, $.map(_this.dialogResult.param.functions, function (fnUnit) {
            return fnUnit.fid;
        }));

        var listener = {
            'success': function (res) {
                _this.refreshData(index, force);
                _this.renderWarningStep(index + 1);
            },
            'catch': function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(err);
                _this.refreshData(index, force);
                _this.renderWarningStep(index);
            }
        };
        Studio.getJobExecutor().launchUnit(newFnUnit, {}, {}, listener)
    };

    RefineDialog.prototype.getInput = function () {
        if (this.$mainControl.find('.brtc-va-refine-step').length == 0) {
            return this.options.fnUnit[IN_DATA];
        } else {
            return this.dialogResult.param.functions[this.dialogResult.param.functions.length - 1][OUT_DATA];
        }
    };

    RefineDialog.prototype.getSchema = function (doneCallback, index) {
        var _this = this;
        var columns = [];

        if (this.$mainControl.find('.brtc-va-refine-step').length == 0) {
            columns = _this.options.columns;
            doneCallback(columns);
        } else {
            if (typeof index !== 'undefined') {
                if (index == 0) {
                    columns = _this.options.columns;
                    doneCallback(columns);
                } else {
                    this.options.dataProxy.requestSchema(_this.dialogResult.param.functions[index - 1][OUT_DATA][0],
                        function (result) {
                            columns = result.columns;
                            doneCallback(columns);
                        }, function (err) {
                        });
                }
            } else {
                this.options.dataProxy.requestSchema(_this.dialogResult.param.functions[this.dialogResult.param.functions.length - 1][OUT_DATA][0],
                    function (result) {
                        columns = result.columns;
                        doneCallback(columns);
                    }, function (err) {
                    });
            }

        }
        return columns;
    };

    RefineDialog.prototype.appendFnUnit = function (result) {
        this.dialogResult.param.functions.push(result);
    };

    RefineDialog.prototype.render = function () {
        var _this = this;
        if (this.dialogResult.param.functions.length) {
            var subFnUnits = this.dialogResult.param.functions;
            $.each(subFnUnits, function (key, value) {
                _this.appendStep(subFnUnits[key]);
            });
        }
        if (this.options.stepIdx != undefined)
            this.refreshData(this.options.stepIdx);
        else
            this.refreshData();
    };

    RefineDialog.prototype.refreshData = function (index, force) {
        var functions = this.dialogResult.param.functions;
        var $parent = this.$mainControl.find('.brtc-va-dialogs-refine-left-area');

        if (typeof index != 'undefined') {
            if (functions.length == 0) {
                this.fillSpreadsheet($parent, this.options.fnUnit[IN_DATA][0], force);
            } else {
                this.fillSpreadsheet($parent, index !== -1 ? functions[index][OUT_DATA][0] : this.options.fnUnit[IN_DATA][0], force);
            }
        } else {
            if (functions.length == 0) {
                this.fillSpreadsheet($parent, this.options.fnUnit[IN_DATA][0], force);
            } else {
                if (functions[functions.length - 1].fid) {
                    this.fillSpreadsheet($parent, functions[functions.length - 1][OUT_DATA][0], force);
                }
                else {
                    this.fillSpreadsheet($parent, this.options.fnUnit[IN_DATA][0], force);
                }
            }
        }
        this.renderSelectionStep(index);


    };

    RefineDialog.prototype.appendStep = function (fnUnit) {
        var _this = this;
        var $step = $('' +
            '<div class="brtc-va-refine-step">' +
            '   <div class="brtc-va-refine-step-header">' +
            '       <div class="brtc-va-refine-step-label">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(fnUnit.display.label) +
            '       </div>' +
            '   </div>' +
            '   <div class="brtc-va-refine-step-remove-button"></div>' +
            '   <div class="brtc-va-refine-step-open-button"></div>' +
            '</div>'
        );
        $step.find('.brtc-va-refine-step-header').click(function () {
            var $target = $(this).parents('.brtc-va-refine-step');
            var targetIndex = $target.prevAll('.brtc-va-refine-step').length;
            _this.refreshData(targetIndex);
        });
        $step.find('.brtc-va-refine-step-open-button').click(function (event) {
            event.stopPropagation();

            var $target = $(this).parents('.brtc-va-refine-step');
            var targetIndex = $target.prevAll('.brtc-va-refine-step').length;
            var functionsArray = _this.dialogResult.param.functions;
            var fnUnit = functionsArray[targetIndex];
            var doneCallBack = function (result) {
                var options = {
                    func: fnUnit.func,
                    fid: fnUnit.fid,
                    in: fnUnit[IN_DATA],
                    out: fnUnit[OUT_DATA],
                    columns: $.extend(true, [], result),
                    close: _this.dialogClosed.bind(_this),
                    param: fnUnit.param,
                    force: true,
                    context : _this.options.context
                }
                _this.openStepDialog(options);
            };
            _this.getSchema(doneCallBack, targetIndex);

        });
        this.$mainControl.find('.brtc-va-refine-step-container-body').append($step);

        $step.find('.brtc-va-refine-step-remove-button').click(function (event) {
            event.stopPropagation();
            var $target = $(this).parents('.brtc-va-refine-step');
            var targetIndex = $target.prevAll('.brtc-va-refine-step').length;

            _this.removeStep($target);
            _this.removeFnUnit(targetIndex);
            _this.refreshData(targetIndex - 1);
            _this.renderWarningStep(targetIndex);
        });
        ADDITIONAL_STEP_LENGTH++;

    };

    RefineDialog.prototype.renderSelectionStep = function (index) {
        var steps = this.$mainControl.find('.brtc-va-refine-step-header');
        var openStep = this.$mainControl.find('.brtc-va-refine-step-header-open')[0];
        $(steps).removeClass('brtc-va-refine-step-select');
        $(openStep).removeClass('brtc-va-refine-step-select');
        if (typeof index !== 'undefined') {
            if (index === -1) {
                $(openStep).addClass('brtc-va-refine-step-select');
            } else {
                $(steps[index]).addClass('brtc-va-refine-step-select');
            }
        } else {
            $(this.$mainControl.find('.brtc-va-refine-step-header')).last().addClass('brtc-va-refine-step-select');
        }


    };

    RefineDialog.prototype.renderWarningStep = function (index) {
        var steps = this.$mainControl.find('.brtc-va-refine-step-header');
        $(steps).removeClass('brtc-va-refine-step-warning');
        for (var i = index; i < steps.length; i++) {
            $(steps[i]).addClass('brtc-va-refine-step-warning');
        }

    };

    RefineDialog.prototype.openStepDialog = function (options) {
        var clazz = REFINE_STEPS[options.func].clazz;
        new Brightics.VA.Core.Dialogs.RefineSteps[clazz](this.$mainControl, options);
    };

    RefineDialog.prototype.removeStep = function ($target) {
        $target.remove();
        ADDITIONAL_STEP_LENGTH--;
    };

    RefineDialog.prototype.removeFnUnit = function (index) {
        var functionsArray = this.dialogResult.param.functions;

        if (index != functionsArray.length - 1) {
            functionsArray[index + 1][IN_DATA] = $.extend(true, [], functionsArray[index][IN_DATA]);
        }
        functionsArray.splice(index, 1);
    };

    Brightics.VA.Core.Dialogs.RefineDialog = RefineDialog;

}).call(this);
/**
 * Created by daewon.park on 2016-11-08.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RenameDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    RenameDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    RenameDialog.prototype.constructor = RenameDialog;

    RenameDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 600;
        this.dialogOptions.height = 300;
    };

    RenameDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-row-flex-layout">' +
            '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-rename-name-label">Name</div>' +
            '   <input type="text" class="brtc-va-dialogs-rename-name-input" maxlength="80" valid-type="renamefileType">' +
            '</div>');

        this.createNameControl($parent.find('.brtc-va-dialogs-rename-name-input'));
    };

    RenameDialog.prototype.createNameControl = function ($control) {
        this.$nameControl = $control.jqxInput({
            placeHolder: 'Enter name',
            theme: Brightics.VA.Env.Theme
        });
        if (this.options.name) {
            this.$nameControl.val(this.options.name);
        }
        Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(this.$nameControl);
    };

    RenameDialog.prototype.handleOkClicked = function () {
        var newName = this.$nameControl.val().trim();
        if (newName.length == 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Please enter name.');
            return;
        }
        //"."가 2개이상 연속되면 Error 발생
        var temp = "";
        var intCnt = 0;
        for (var i = 0; i < newName.length; i++) {
            temp = newName.charAt(i);
            if (temp == '.') {
                if (temp == newName.charAt(i + 1)) {
                    intCnt = intCnt + 1;
                }
            }
        }
        if (intCnt > 0) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('[.] can not use it repeatedly.');
            return;
        }
        if (typeof this.options.validate === 'function') {
            var message = this.options.validate(newName);
            if (message) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(message);
                return;
            }
        }
        this.dialogResult.newName = newName;
        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    Brightics.VA.Core.Dialogs.RenameDialog = RenameDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RenameVariableDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    RenameVariableDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    RenameVariableDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-renamevariable">' +
            // '   <div class="brtc-va-dialogs-header">Rename</div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        var _this = this;

        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: 'Rename',
            width: 400,
            height: 200,
            modal: true,
            resizable: false,
            close: function () {
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        };
        this.$mainControl.dialog(jqxOpt);
    };

    RenameVariableDialog.prototype.initContents = function () {
        var _this = this;
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$okButton.click(_this.handleOkClicked.bind(_this));

        _this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
    };


    RenameVariableDialog.prototype.createDialogContentsArea = function ($parent) {
        this.$input = $('<textarea  class="brtc-va-widget-contents-input-control"/>');
        $parent.append(this.$input);

        var controlOptions = {
            verifier: new Brightics.VA.Core.Verifier.CFVariableVerifier(),
            scrollbarStyle: 'null',
            placeholder: '',
            lineWrapping: false,
            matchBrackets: false,
            hintOptions: {
                list: []
            }
        };
        this.expressionControl = new Brightics.VA.Core.Editors.Sheet.Controls.TextAreaControl(this.$input, controlOptions);

        this.expressionControl.codeMirror.setSize('100%', '26px');
        this.expressionControl.codeMirror.on("beforeChange", function (instance, changeObj) {
            var typedNewLine = changeObj.origin == '+input' && typeof changeObj.text == "object" && changeObj.text.join("") == "";
            if (typedNewLine) {
                instance.doc.setCursor(instance.getCursor());
                return changeObj.cancel();
            }

            var pastedNewLine = changeObj.origin == 'paste' && typeof changeObj.text == "object" && changeObj.text.length > 1;
            if (pastedNewLine) {
                var newText = changeObj.text.join(" ");
                return changeObj.update(null, null, [newText]);
            }
            return null;
        });
        this.expressionControl.codeMirror.setValue(this.options.name);
        this.expressionControl.codeMirror.markText(
            {line: 0, ch: 0},
            {line: 0, ch: 2},
            {
                readOnly: true,
                inclusiveLeft: true,
                atomic: true
            });
        this.expressionControl.codeMirror.markText(
            {line: 0, ch: this.options.name.length - 1},
            {line: 0, ch: this.options.name.length},
            {
                readOnly: true,
                inclusiveRight: true,
                atomic: true
            });
        // this.$input.jqxInput({
        //     placeHolder: 'Enter name',
        //     theme: Brightics.VA.Env.Theme,
        //     width: 'calc(100% - 2px)',
        //     height: 25
        // });
        // this.$input.val(this.options.name);
        // this.$input.jqxInput('selectAll');
        // this.$input.jqxInput('focus');
    };

    RenameVariableDialog.prototype.handleOkClicked = function () {
        if (this.expressionControl.getValue() === '${}') return;

        this.dialogResult = {
            OK: true,
            Cancel: false,
            name: this.expressionControl.getValue() //this.$input.val()
        };
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.RenameVariableDialog = RenameVariableDialog;

}).call(this);
/**
 * Created by SDS on 2016-10-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RepositoryBrowserDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    RepositoryBrowserDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    RepositoryBrowserDialog.prototype.constructor = RepositoryBrowserDialog;

    RepositoryBrowserDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 700;
        this.dialogOptions.height = 700;
    };

    RepositoryBrowserDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-repository-browser-contents');
        var path = this.options.title === 'Setting Input Path' ? 'Input Path' : 'Unload To';
        var path = this.options.pathLabel ? this.options.pathLabel : path;
        $parent.append('' +
            '<div class="brtc-va-dialogs-repository-browser-tree"></div>' +
            '<div class="brtc-va-dialogs-repository-browser-file-layout">' +
            '   <div class="brtc-va-dialogs-repository-browser-file-label">' + path  + '</div>' +
            '   <div class="brtc-va-dialogs-repository-browser-file-input"><textarea></textarea></div>' +
            '</div>' +
            '<div class="brtc-va-dialogs-repository-browser-setting-option">' +
            '   <div class="brtc-va-dialogs-repository-browser-radio" value="static">Set a static path for users repository.</div>' +
            '   <div class="brtc-va-dialogs-repository-browser-radio" value="dynamic">Set a dynamic path for users repository.</div>' +
            '</div>' +

            '');

        this.createRepositoryTree($parent.find('.brtc-va-dialogs-repository-browser-tree'));
        this.createSettingOptionControl($parent.find('.brtc-va-dialogs-repository-browser-setting-option'));
        this.createFilePathControl($parent.find('.brtc-va-dialogs-repository-browser-file-input > textarea'));
    };

    RepositoryBrowserDialog.prototype.createRepositoryTree = function ($control) {
        var _this = this;
        this.repositoryViewer = new Brightics.VA.Core.Controls.RepositoryViewer($control);
        this.repositoryViewer.$tree.on('select', function (event) {
            var path = _this.repositoryViewer.getSelectedPath();
            _this._setFilePath(path);
        });
    };

    RepositoryBrowserDialog.prototype.createSettingOptionControl = function ($control) {
        var _this = this,
            $optionControl = $control.find('.brtc-va-dialogs-repository-browser-radio');
        this.$settingOptionGroup = $control;
        $optionControl.jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            groupName: 'repository-browser-setting-option'
        });

        $optionControl.on('checked', function () {
            var path = _this.repositoryViewer.getSelectedPath() || _this.options.filePath;
            _this._setFilePath(path);
        });

        if (this.options.filePath.match(/\$\{\=sys.user\}\//g)) {
            this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio[value=dynamic]').jqxRadioButton('check');
        } else {
            this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio[value=static]').jqxRadioButton('check');
        }

        this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio').hide();
    };

    RepositoryBrowserDialog.prototype.createFilePathControl = function ($control) {
        this.fileName = CodeMirror.fromTextArea($control[0], {
            mode: 'text',
            theme: 'default',
            indentWithTabs: false,
            smartIndent: false,
            lineNumbers: false,
            matchBrackets: true,
            scrollbarStyle: 'null',
            autofocus: false
        });
        this.fileName.on('beforeChange', function (instance, change) {
            var newtext = change.text.join('').replace(/\n/g, ''); // remove ALL \n
            if (change.update) change.update(change.from, change.to, [newtext]);
            return true;
        });

        var _this = this;
        this.fileName.on('change', function (instance, change) {
            var value = instance.getValue();
            _this.$okButton.jqxButton({
                disabled:
                    (value === '/shared/'
                        || value === '/' + Brightics.VA.Env.Session.userId + '/'
                        || value === '/shared/upload/'
                        || value === '/' + Brightics.VA.Env.Session.userId + '/upload/'
                        || value === '/${=sys.user}/upload/')
            });
        });

        this.fileName.setSize('100%', '100%');

        if (this.options.filePath) {
            this._setFilePath(this.options.filePath);
        }
        var additionalOption = {
            'valid-type': 'fileNameType',
            'valid-message-position': 'bottom'
        };
        Brightics.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.fileName, additionalOption);
    };

    RepositoryBrowserDialog.prototype._setFilePath = function (path) {
        if (!path) return;

        var matched1 = path.match(/\/shared\/upload\/[^\/]*/);
        this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio').hide();

        if (matched1) {
            this.fileName.setValue(path);
            this.fileName.markText({line: 0, ch: 0}, {line: 0, ch: 15}, {
                readOnly: true,
                inclusiveLeft: true,
                css: 'color: #b4b4b4'
            });
        } else if (path.startsWith('/' + Brightics.VA.Env.Session.userId + '/upload/') || path.startsWith('/${=sys.user}/upload/')) {
            this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio').show();
            var ch = 0,
                filePath = path;
            if (this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio[value=dynamic]').val()) {
                filePath = filePath.replace(/\/\S*\/upload\//g, '/${=sys.user}/upload/');
            } else {
                filePath = filePath.replace(/\/\$\{\=sys\.user\}\/upload\//g, '/' + Brightics.VA.Env.Session.userId + '/upload/');
            }
            var segments = filePath.split('/');
            this.fileName.setValue(filePath);
            for (var i = 0; i < 3; i++) {
                ch += segments[i].length;
                ch++;
            }
            this.fileName.markText({line: 0, ch: 0}, {line: 0, ch: ch}, {
                readOnly: true,
                inclusiveLeft: true,
                css: 'color: #b4b4b4'
            });
        }
        else {
            filePath = path + '/';
            if (this.$settingOptionGroup.find('.brtc-va-dialogs-repository-browser-radio[value=dynamic]').val() && !filePath.startsWith('/shared/')) {
                filePath = filePath.replace(/\/\S*\/upload\//g, '/${=sys.user}/upload/');
            } else if (!filePath.startsWith('/shared/')) {
                filePath = filePath.replace(/\/\$\{\=sys\.user\}\/upload\//g, '/' + Brightics.VA.Env.Session.userId + '/upload/');
            }
            this.fileName.setValue(filePath);
            this.fileName.markText({line: 0, ch: 0}, {line: 0, ch: filePath.length + 1}, {
                readOnly: true,
                inclusiveLeft: true,
                css: 'color: #b4b4b4'
            });
        }
    };

    RepositoryBrowserDialog.prototype.handleOkClicked = function () {
        var file = this.fileName.getValue().trim();
        if (file) {
            if (this._isAvailablePath(file)) {
                this.dialogResult.selectedFile = file;
                Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Invalid path selected. It should start with \'/shared/upload/\' or \'/{USER_ID}/upload/\'.');
            }
        } else {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('At least one file must be selected.');
        }
    };

    RepositoryBrowserDialog.prototype.createDialogButtonBar = function ($parent) {
        if (this.dialogOptions.useButton === false) return;
        Brightics.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this, $parent);
    };

    RepositoryBrowserDialog.prototype._isAvailablePath = function (filePath) {
        var matched1 = filePath.match(/^\/shared\/upload\/[^\/]+$/);
        var matched2 = filePath.match(/[^\/]+\/upload\/[^\/]*/);
        var matched3 = filePath.match(/^\/\$\{\=sys\.user\}\/[^\/]+$/);

        //"."가 2개이상 연속되면 Error 발생
        var temp = "", intCnt = 0;
        for (var i = 0; i < filePath.length; i++) {
            temp = filePath.charAt(i);
            if (temp == '.' || temp == '@' || temp == '/') {
                if (temp == filePath.charAt(i + 1)) {
                    intCnt = intCnt + 1;
                }
            }
        }
        return (intCnt <= 0) || (matched1 || matched2 || matched3);
    };

    Brightics.VA.Core.Dialogs.RepositoryBrowserDialog = RepositoryBrowserDialog;

}).call(this);
/**
 * Created by gy84.bae on 2016-10-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RScriptEditorDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.ScriptEditorDialog.call(this, parentId, options);
    }

    RScriptEditorDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.ScriptEditorDialog.prototype);
    RScriptEditorDialog.prototype.constructor = RScriptEditorDialog;

    RScriptEditorDialog.prototype.renderInfoArea = function ($parent, useTable) {
        var _this = this;
        this.$trueControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">true</div>');
        this.$falseControl = $('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">false</div>');

        this.$infoArea.addClass('rscript');
        this.$infoArea.append('' +
            '<div class="brtc-va-dialogs-controls-propertycontrol-columnlist"/>' +
            '<input type="text" class="brtc-va-dialogs-controls-propertycontrol-inputdataframe" valid-type="type1"/>' +
            '<div class="brtc-va-dialogs-controls-propertycontrol-partitionbylist"/>' +
            '<div class="brtc-va-dialogs-controls-propertycontrol-outputdataframelist"/>' +
            '<div class="brtc-va-dialogs-controls-propertycontrol-stringasfactors"/>' +
            '<input type="text" class="brtc-va-dialogs-controls-propertycontrol-scripterrorcol" valid-type="type1"/>' +
            '<input type="text" class="brtc-va-dialogs-controls-propertycontrol-flattenerrorcol" valid-type="type1"/>' +
            '');

        this.$columns = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-columnlist');
        this.$inputDataframes = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-inputdataframe');
        this.$partitionby = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-partitionbylist');
        this.$outputDataframes = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-outputdataframelist');
        this.$stringasfactors = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-stringasfactors');
        this.$scripterrorcol = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-scripterrorcol');
        this.$flattenerrorcol = this.$infoArea.find('.brtc-va-dialogs-controls-propertycontrol-flattenerrorcol');

        this.addPropertyControl('Columns', function ($contents) {
            $contents.append(this.$columns);

            var widgetOptions = {
                multiple: true,
                maxRowCount: 3,
                sort: 'none',
                showOpener: 'button',
                changed: function (type, data) {
                    _this.selectedColumns = data.items;
                    _this.renderValidation();
                }
            };
            _this.columnsControl = _this.createColumnList(_this.$columns, widgetOptions);
        }, {mandatory: true});

        this.addPropertyControl('Input Dataframe', function ($contents) {
            $contents.append(_this.$inputDataframes);
            var jqxOptions = {
                placeHolder: 'Input Dataframe'
            };
            _this.createInput(_this.$inputDataframes, jqxOptions, 'brtc-va-editors-sheet-controls-width-12');

            _this.$inputDataframes.on('change', function (event) {
                _this.inputDataframe = $(this).val();
                _this.renderValidation();
            });
        }, {mandatory: true});

        this.addPropertyControl('Partition by', function ($contents) {
            $contents.append(this.$partitionby);
            var widgetOptions = {
                multiple: true,
                maxRowCount: 3,
                sort: 'none',
                showOpener: 'button',
                changed: function (type, data) {
                    _this.selectedGroupby = data.items;
                    _this.renderValidation();
                }
            };
            _this.groupbyControl = _this.createColumnList(_this.$partitionby, widgetOptions);
        }, {mandatory: false});

        this.addPropertyControl('Output Dataframe', function ($contents) {
            $contents.append(this.$outputDataframes);
            _this.outputDataframe = _this.createOutputDataframeList(_this.$outputDataframes)

        }, {mandatory: true});

        this.addPropertyControl('Strings As Factors', function ($contents) {
            this.$stringasfactors.append(this.$trueControl).append(this.$falseControl);
            $contents.append(this.$stringasfactors);

            _this.createRadioButton(_this.$trueControl, {width: '80', groupName: 'Group'});
            _this.createRadioButton(_this.$falseControl, {width: '80', groupName: 'Group'});

            _this.$trueControl.on('checked', function () {
                _this.selectedFactors = 'true';
            });

            _this.$falseControl.on('checked', function () {
                _this.selectedFactors = 'false';
            });

        }, {mandatory: false});

        this.addPropertyControl('Script Error Column', function ($contents) {
            $contents.append(_this.$scripterrorcol);
            var jqxOptions = {
                placeHolder: 'Script Error Column'
            };
            _this.createInput(_this.$scripterrorcol, jqxOptions, 'brtc-va-editors-sheet-controls-width-12');

            _this.$scripterrorcol.on('change', function (event) {
                _this.scriptErrorCol = $(this).val();
            });
        }, {mandatory: false});

        this.addPropertyControl('Flatten Error Column', function ($contents) {
            $contents.append(_this.$flattenerrorcol);
            var jqxOptions = {
                placeHolder: 'Flatten Error Column'
            };
            _this.createInput(_this.$flattenerrorcol, jqxOptions, 'brtc-va-editors-sheet-controls-width-12');

            _this.$flattenerrorcol.on('change', function (event) {
                _this.flattenErrorCol = $(this).val();
            });
        }, {mandatory: false});

        this.fillControlValues();
        this.renderValues();
    };

    RScriptEditorDialog.prototype.createOutputDataframeList = function ($contents) {
        var outputDataframeList = this.options.fnUnit.param['output-dataframe'];

        if (outputDataframeList === undefined) {
            this.createOutputControlLayout(0, true, $contents);
        } else if (outputDataframeList.length === 0) {
            this.createOutputControlLayout(0, true, $contents);
        } else {
            for (var i = 0; i < outputDataframeList.length; i++) {
                this.createOutputControlLayout(i, true, $contents);
            }
        }
    };

    RScriptEditorDialog.prototype.createOutputControlLayout = function (inputIndex, addable, $contents, focus) {
        var $parents = $contents;
        var _this = this;
        var deletable = false;
        var $inputContainer = $('<div class="brtc-va-rcontents-input-container"></div>');

        var $children = $parents.find('.brtc-va-rcontents-input-container');

        if ($children.length === 0 || !$children[inputIndex]) {
            $parents.append($inputContainer);
        } else {
            $($children[inputIndex]).after($inputContainer);
            deletable = true;
        }

        var $inputDiv = $('<div class="brtc-va-widget-contents-input-control-container"></div>');
        var $addDiv, $deleteDiv;

        $inputContainer.append($inputDiv);
        if (addable) {
            $addDiv = $('<div class="brtc-va-widget-contents-input-control-add"></div>');
            $inputContainer.append($addDiv);

            $addDiv.click(function (event) {
                _this.handleAddInputControlEvent($(this).closest('.brtc-va-rcontents-input-container'), $parents);
                _this.$infoArea.perfectScrollbar('update');
            })
        }
        if (inputIndex > 0 || deletable) {
            $deleteDiv = $('<div class="brtc-va-widget-contents-input-control-delete"></div>');
            $inputContainer.append($deleteDiv);

            $deleteDiv.click(function (event) {
                _this.handleDeleteButtonClick($(this).closest('.brtc-va-rcontents-input-container'));
                _this.$infoArea.perfectScrollbar('update');
            })
        }

        this.createInputControl($inputDiv, focus);
    };

    RScriptEditorDialog.prototype.handleAddInputControlEvent = function ($target, $contents, focus) {
        var index = $target.index();
        this.createOutputControlLayout(index, true, $contents, focus);
        this.getInputValue();
        this.renderValidation();
    };

    RScriptEditorDialog.prototype.handleDeleteButtonClick = function ($target) {
        $target.remove();
        this.getInputValue();
        this.renderValidation();
    };

    RScriptEditorDialog.prototype.createInputControl = function ($parent, focus) {
        var _this = this;
        var $inputControl;

        $inputControl = $('<input type="text" class="brtc-va-widget-contents-input-control"/>');
        $parent.append($inputControl);
        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%'
        };
        $inputControl.jqxInput(options);

        if (!focus) {
            $inputControl.jqxInput('focus');
        }

        $inputControl.keydown(function (key) {
            if (key.keyCode == 13) {
                _this.handleAddInputControlEvent($inputControl.closest('.brtc-va-rcontents-input-container'), true);
                _this.getInputValue();
                _this.renderValidation();

            }
        });
        $inputControl.focusout(function (event) {
            _this.getInputValue();
            _this.renderValidation();
        });
    };

    RScriptEditorDialog.prototype.createInput = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);

        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }

        if (!$control.attr('type'))$control.attr('type', 'text');
        if (!$control.attr('maxlength'))$control.attr('maxlength', '100');

        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            placeHolder: 'Enter value'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxInput(options);
        var preValue = $control.val();
        $control.focus(function () {
            preValue = $control.val();
        });
        $('svg').on('mousedown', function () {
            var value = $control.val();
            if (value !== preValue && $control.is(":focus")) {
                $control.trigger("change");
            }
        });

        var _this = this;
        $control.on('keydown', function (event) {
            clearTimeout(_this.keydownTimeout);
            _this.keydownTimeout = setTimeout(function () {
                if ($control.is(':focus')) {
                    $control.blur();
                    $control.focus();
                }
            }, 1000);
        });

        root.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition($control);
        return $control;
    };

    RScriptEditorDialog.prototype.getInputValue = function () {
        var inputValue;
        var controls = this.$outputDataframes.find('.brtc-va-widget-contents-input-control');

        inputValue = [];
        for (var i = 0; i < controls.length; i++) {
            if ($(controls[i]).val()) {
                inputValue.push($(controls[i]).val());
            }
        }
        this.outputDataframe = inputValue;
        //return inputValue;
    };

    RScriptEditorDialog.prototype.setInputValue = function (value) {
        var controls = this.$outputDataframes.find('.brtc-va-widget-contents-input-control');
        for (var i = 0; i < controls.length; i++) {
            $(controls[i]).val(value[i] || '');
        }
    };

    RScriptEditorDialog.prototype.fillControlValues = function () {
        var columnData = this.options.dataMap ? (this.options.fnUnit[IN_DATA][0] ? this.options.dataMap[this.options.fnUnit[IN_DATA][0]].columns : []) : [];
        var byteData = [];
        var data = [];
        $.each(columnData, function (index, value) {
            data.push(value);
        });
        this.groupbyControl.setItems(data);
        this.columnsControl.setItems(data);
    };


    RScriptEditorDialog.prototype.renderValues = function () {
        var param = this.options.fnUnit.param;

        this.columnsControl.setSelectedItems(param['input-cols']);

        var paramPartitionBy = this.options.fnUnit.param['partition-by'];
        if (paramPartitionBy) {
            this.groupbyControl.setSelectedItems(paramPartitionBy);
        } else {
            this.groupbyControl.setSelectedItems([]);
        }

        var paramFactors = this.options.fnUnit.param['strings-as-factors'];
        if (paramFactors === '') {
            this.$trueControl.jqxRadioButton('check');
        } else {
            if (paramFactors === 'true') this.$trueControl.jqxRadioButton({checked: true});
            if (paramFactors === 'false') this.$falseControl.jqxRadioButton({checked: true});
        }

        var paramResultColumn = this.options.fnUnit.param['output-dataframe'];
        this.setInputValue(paramResultColumn);

        this.selectedColumns = param['input-cols'];
        this.selectedGroupby = paramPartitionBy;
        this.selectedFactors = paramFactors;
        this.outputDataframe = paramResultColumn;

        var paramInputDataframe = this.options.fnUnit.param['input-dataframe'];
        this.inputDataframe = paramInputDataframe;
        this.$inputDataframes.val(paramInputDataframe);

        var paramScriptErrorCol = this.options.fnUnit.param['script-error-col'];
        this.scriptErrorCol = paramScriptErrorCol;
        this.$scripterrorcol.val(paramScriptErrorCol);

        var paramFlattenErrorCol = this.options.fnUnit.param['flatten-error-col'];
        this.flattenErrorCol = paramFlattenErrorCol;
        this.$flattenerrorcol.val(paramFlattenErrorCol);
    };

    RScriptEditorDialog.prototype.renderValidation = function () {
        //this.selectedColumns = this.columnsControl.val();
        //this.selectedGroupby = this.groupbyControl.val();

        if (!this.selectedColumns || this.selectedColumns.length === 0) {
            this.createValidationContent(this.$columns.parent(), '"Columns" field is required.', true);
        } else {
            this.removeValidation(this.$columns.parent().parent());
        }
        if (!this.inputDataframe) {
            this.createValidationContent(this.$inputDataframes.parent(), '"Input Dataframe" field is required.', true);
        } else {
            this.removeValidation(this.$inputDataframes.parent());
        }
        if (this.outputDataframe.length === 0) {
            this.createValidationContent(this.$outputDataframes, '"Output Dataframe" field is required.', true);
        }
        else {
            var isValid = true;
            for (var i in this.outputDataframe) {
                if (!(Brightics.VA.Core.Utils.InputValidator.isValid.columnNameType(this.outputDataframe[i]))) {
                    isValid = false;
                    break;
                }
            }
            if (isValid) {
                this.removeValidation(this.$outputDataframes);
            }
            else {
                this.createValidationContent(this.$outputDataframes, 'If the column name begins with _ or is only a number, it may be a problem in some functions later.', true);
            }
        }

    };

    RScriptEditorDialog.prototype.removeValidation = function ($parent) {
        $parent.find('.brtc-va-editors-sheet-panels-validation-tooltip').remove();
        $parent.find('.brtc-va-editors-sheet-controls-propertycontrol-label').removeClass('brtc-va-editors-sheet-controls-propertycontrol-label-error');
        $parent.find('.brtc-va-editor-sheet-panels-validation-error').removeClass('brtc-va-editor-sheet-panels-validation-error');
        $parent.find('.brtc-va-editors-sheet-panels-validation-tooltip').remove();
    };

    RScriptEditorDialog.prototype.createValidationContent = function ($parent, problemData, clearBoth) {
        var problemDiv = $parent.find('.brtc-va-editors-sheet-panels-validation-tooltip');
        if (problemDiv) {
            problemDiv.remove();
        }
        var $problemContent = $('<div class="brtc-va-editors-sheet-panels-validation-tooltip">' +
            '<i class="fa fa-exclamation-triangle" aria-hidden="true"></i> ' + problemData +
            '</div>');
        $parent.append($problemContent);
        $parent.addClass('brtc-va-editor-sheet-panels-validation-error');
        if (clearBoth) $problemContent.css('clear', 'both');
        var columnList = $parent.find('.brtc-va-editors-sheet-controls-columnselector');

        if (columnList.is('div')) {
            columnList.data().renderMissingColumns();
        }
        $problemContent.show();

    };

    RScriptEditorDialog.prototype.addPropertyControl = function (label, callback, option) {
        var _this = this,
            $propertyControl = $('' +
                '<div class="brtc-va-editors-sheet-controls-propertycontrol">' +
                '   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>' +
                '   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents">' +
                '</div>');

        if (option) {
            if (option.mandatory) {
                label = '<div>' + label +
                    '   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div>' +
                    '</div>';
            }
            _this.$infoArea.append($propertyControl);
        }
        else {
            _this.$infoArea.append($propertyControl);
        }

        $propertyControl.jqxExpander(
            {
                theme: Brightics.VA.Env.Theme,
                arrowPosition: "left",
                initContent: function () {
                    if (typeof  callback === 'function') {
                        callback.call(_this, $propertyControl.find(".brtc-va-editors-sheet-controls-propertycontrol-contents"), option);
                    }
                }
            });
        $propertyControl.jqxExpander('setHeaderContent', label);

        return $propertyControl;
    };

    RScriptEditorDialog.prototype.createColumnList = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            openerPosition: 'bottom',
            multiple: true,
            rowCount: 1,
            maxRowCount: 5,
            expand: false,
            sort: 'none',
            sortBy: 'name',
            showOpener: 'button',
            removable: true,
            defaultType: '-',
            changed: function (type, data) {

            },
            added: function () {

            },
            removed: function () {

            }
        };

        if (widgetOptions) {
            $.extend(options, widgetOptions);
        }

        var _columnList = new Brightics.VA.Core.Editors.Sheet.Controls.ColumnList($control, options);

        _columnList.columnSelector.$mainControl.attr('isDialog', true);
        return _columnList;
    };

    RScriptEditorDialog.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');
        $control.wrap($wrapper);
    };

    RScriptEditorDialog.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    RScriptEditorDialog.prototype.addCssToWrapper = function ($control, cssOptions) {
        if (cssOptions) {
            var $wrapper = $control.parent('.brtc-va-editors-sheet-controls-wrapper');
            if ($wrapper) $wrapper.css(cssOptions);
        }
    };

    RScriptEditorDialog.prototype.handleOkClicked = function () {

        this.dialogResult = {
            OK: true,
            Cancel: false,
            queryStatement: this.codeMirror.getValue(),
            columns: this.selectedColumns,
            partitionBy: this.selectedGroupby,
            factors: this.selectedFactors,
            inputDataframe: this.inputDataframe,
            outputDataframe: this.outputDataframe,
            scriptErrorCol: this.scriptErrorCol,
            flattenErrorCol: this.flattenErrorCol
        };
        this.$mainControl.dialog('close');
    };

    RScriptEditorDialog.prototype.getTitle = function () {
        return 'R';
    };

    Brightics.VA.Core.Dialogs.RScriptEditorDialog = RScriptEditorDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RunControlDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };

        this.analyticsModel = this.options.analyticsModel;

        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    RunControlDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    RunControlDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-run">' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);
        this.$contentsArea = this.$mainControl.find('.brtc-va-dialogs-contents');
        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');

        var _this = this;
        this.$mainControl.dialog({
            theme: Brightics.VA.Env.Theme,
            title: 'Variables',
            width: 450,
            height: 630,
            modal: true,
            resizable: false,
            draggable: true,
            close: function () {
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        });
    };

    RunControlDialog.prototype.initContents = function () {
        var _this = this;
        _this.$mainControl.find('.brtc-va-dialogs-contents').addClass('scrollable');

        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            disabled: false
        });
        _this.$okButton.click(_this.handleOkClicked.bind(_this));
    };

    RunControlDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this, variable, variableList = this.analyticsModel['variables'] || [];
        this.variableControlList = [];

        for (var i = 0; i < variableList.length; i++) {
            variable = {};
            variable[variableList[i].name] = {
                'type': 'literal',
                'value': variableList[i].value || '',
                'variable-type': variableList[i].type
            };
            var variableOption = {
                button: {
                    visible: false
                },
                variable: variable,
                label: variableList[i].name
            };
            this.variableControlList.push(Brightics.VA.Core.Widget.Factory.variableControl($parent, variableOption));
        }
        $parent.perfectScrollbar();
    };

    RunControlDialog.prototype.createVariablesList = function () {
        var variableList = {}, variableControl, controlValue;

        for (var i = 0; i < this.variableControlList.length; i++) {
            variableControl = this.variableControlList[i];
            controlValue = variableControl.getFormattedValue();
            variableList[controlValue.key] = controlValue.value;
        }
        return variableList;
    };

    RunControlDialog.prototype.handleOkClicked = function () {
        this.dialogResult = {
            OK: true,
            Cancel: false,
            'args': this.createVariablesList()
        };
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.RunControlDialog = RunControlDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RunDataDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };

        this.analyticsModel = this.options.analyticsModel;

        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    RunDataDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    RunDataDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-run">' +
            // '   <div class="brtc-va-dialogs-header">Variables</div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);
        this.$contentsArea = this.$mainControl.find('.brtc-va-dialogs-contents');
        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');

        var _this = this;
        this.$mainControl.dialog({
            theme: Brightics.VA.Env.Theme,
            title: 'Variables',
            width: 450,
            height: 630,
            modal: true,
            resizable: false,
            draggable: true,
            close: function () {
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        });
    };

    RunDataDialog.prototype.initContents = function () {
        var _this = this;
        _this.$mainControl.find('.brtc-va-dialogs-contents').addClass('scrollable');
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            disabled: false
        });
        _this.$okButton.click(_this.handleOkClicked.bind(_this));
    };


    RunDataDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this, variable, variableList = this.analyticsModel.variables || {};
        this.variableControlList = [];

        var variablesKeys = Object.keys(variableList);

        for (var i = 0; i < variablesKeys.length; i++) {
            variable = {};
            variable[variablesKeys[i]] = {
                // 'type': 'literal',
                'value': variableList[variablesKeys[i]].value || '',
                'variable-type': variableList[variablesKeys[i]].type || 'string'
            };
            var variableOption = {
                button: {
                    visible: false
                },
                variable: variable,
                label: variablesKeys[i]
            };
            this.variableControlList.push(Brightics.VA.Core.Widget.Factory.variableControl($parent, variableOption));
        }
        $parent.perfectScrollbar();
    };

    RunDataDialog.prototype.createVariablesList = function () {
        var variableList = {}, variableControl, controlValue;

        for (var i = 0; i < this.variableControlList.length; i++) {
            variableControl = this.variableControlList[i];
            controlValue = variableControl.getFormattedValue();
            variableList[controlValue.key] = controlValue.value;
        }
        return variableList;
    };

    RunDataDialog.prototype.handleOkClicked = function () {
        this.dialogResult = {
            OK: true,
            Cancel: false,
            'args': this.createVariablesList()
        };
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.RunDataDialog = RunDataDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RunRealTimeDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };

        this.analyticsModel = this.options.analyticsModel;

        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    RunRealTimeDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    RunRealTimeDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-run">' +
            // '   <div class="brtc-va-dialogs-header">Variables</div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);
        this.$contentsArea = this.$mainControl.find('.brtc-va-dialogs-contents');
        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');

        var _this = this;
        this.$mainControl.dialog({
            theme: Brightics.VA.Env.Theme,
            title: 'Variables',
            width: 450,
            height: 630,
            modal: true,
            resizable: false,
            draggable: true,
            close: function () {
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        });
    };

    RunRealTimeDialog.prototype.initContents = function () {
        var _this = this;
        _this.$mainControl.find('.brtc-va-dialogs-contents').addClass('scrollable');
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            disabled: false
        });
        _this.$okButton.click(_this.handleOkClicked.bind(_this));
    };


    RunRealTimeDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this, variable, variableList = this.analyticsModel['gv-def'] || {};
        this.variableControlList = [];
        this.duration = {};

        var durationValue = {};
        durationValue['Duration'] = {
            'type': 'literal',
            'value': '5',
            'variable-type': 'string'
        };
        var durationOption = {
            button: {
                visible: false
            },
            variable: durationValue
        };

        this.duration = Brightics.VA.Core.Widget.Factory.variableControl($parent, durationOption);

        for (var i = 0; i < Object.keys(variableList).length; i++) {
            variable = {};
            variable[Object.keys(variableList)[i]] = {
                'type': 'literal',
                'value': variableList[Object.keys(variableList)[i]]['value'] || '',
                'variable-type': variableList[Object.keys(variableList)[i]]['variable-type'] || 'string'
            };
            var variableOption = {
                button: {
                    visible: false
                },
                variable: variable
            };
            this.variableControlList.push(Brightics.VA.Core.Widget.Factory.variableControl($parent, variableOption));
        }
        $parent.perfectScrollbar();
    };

    RunRealTimeDialog.prototype.createVariablesList = function () {
        var variableList = {}, variableControl, controlValue;

        for (var i = 0; i < this.variableControlList.length; i++) {
            variableControl = this.variableControlList[i];
            controlValue = variableControl.getFormattedValue();

            var temp;
            if (controlValue['variable-type'] == 'array' && controlValue.value.length == 1) {
                temp = controlValue.value[0];
            } else {
                temp = controlValue.value;
            }

            if (temp) variableList[controlValue.key] = controlValue.value;
        }
        return variableList;
    };

    RunRealTimeDialog.prototype.handleOkClicked = function () {
        this.dialogResult = {
            OK: true,
            Cancel: false,
            'args': this.createVariablesList(),
            'duration': this.duration.getFormattedValue().value
        };
        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.RunRealTimeDialog = RunRealTimeDialog;

}).call(this);
/**
 * Created by gy84.bae on 2016-10-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ScalaEditorDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.ScriptEditorDialog.call(this, parentId, options);

        this.checkInfo();
    }

    ScalaEditorDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.ScriptEditorDialog.prototype);
    ScalaEditorDialog.prototype.constructor = ScalaEditorDialog;

    ScalaEditorDialog.prototype.renderInfoArea = function () {
        if (!this.options.scriptOnly || this.options.scriptOnly === false) {
            this.renderInputs(this.$infoArea);
            this.renderOutputs(this.$infoArea);
        }
    };

    ScalaEditorDialog.prototype.createInTableAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inTableList = this.FnUnitUtils.getInTable(this.options.fnUnit),
            inFunctionList = [];

        for (var i in inTableList) {
            inFunctionList.push(model.getFnUnitByOutData(inTableList[i]));
        }

        for (var i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = 'inputs(' + i + ')';

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutTable(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };

    ScalaEditorDialog.prototype.createInModelAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inModelList = this.FnUnitUtils.getInModel(this.options.fnUnit),
            inFunctionList = [];

        for (var i in inModelList) {
            inFunctionList.push(model.getFnUnitByOutData(inModelList[i]));
        }

        for (var i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = 'models(' + i + ')';

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutModel(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };

    ScalaEditorDialog.prototype.createInImageAlias = function ($parent) {
        var _this = this;
        var model = this.options.fnUnit.parent();

        var inImageList = this.FnUnitUtils.getInImage(this.options.fnUnit),
            inFunctionList = [];

        for (var i in inImageList) {
            inFunctionList.push(model.getFnUnitByOutData(inImageList[i]));
        }

        for (var i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label = 'images(' + i + ')';

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">' + label + '</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutImage(fnUnit)[0]);
            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function () {
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                //insert at current cursor
                var doc = _this.codeMirror.getDoc();
                var cursor = _this.codeMirror.getCursor();

                doc.replaceRange(addedText, cursor);
            });
        }
    };


    ScalaEditorDialog.prototype.renderEditorArea = function () {
        var _this = this;

        this.sendFnunit = $.extend(true, {}, this.options.fnUnit);

        this.codeMirror = CodeMirror.fromTextArea(this.$editorArea.find('textarea')[0], {
            mode: 'text/x-scala',
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: true,
            matchBrackets: true,
            autofocus: false,
            extraKeys: {"Ctrl-Space": "autocomplete"},
            hintOptions: {
                list: this.scriptEditorOptions.additionalHint
            }
        });

        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror);

        Brightics.VA.Core.Utils.WidgetUtils.setCodeMirrorMaxLength(this.codeMirror);

        this.setEditorStatement(this.options.statement);

        this.codeMirror.setSize('100%', '100%');
        this.codeMirror.setOption('maxLength', this.scriptEditorOptions.maxLength);
    };

    ScalaEditorDialog.prototype.renderInputs = function ($parent) {
        this.$inputs = $('<div class="brtc-va-dialogs-scalaeditor-alias-in"></div>');

        $parent.append(this.$inputs);

        this.renderInTableAlias(this.$inputs);
        this.renderInModelAlias(this.$inputs);
        // this.renderInImageAlias(this.$inputs);
    };

    ScalaEditorDialog.prototype.renderInTableAlias = function ($parent) {
        var $inTableAlias = $('<div class="brtc-va-dialogs-scalaeditor-alias-in-table"></div>');

        $parent.append($inTableAlias);

        var $inTableAliasBody = this.addPropertyControl($inTableAlias, {label: 'In Table Variable'});

        this.createInTableAlias($inTableAliasBody);
        $inTableAliasBody.perfectScrollbar();
    };

    ScalaEditorDialog.prototype.renderInModelAlias = function ($parent) {
        var $inModelAlias = $('<div class="brtc-va-dialogs-scalaeditor-alias-in-model"></div>');

        $parent.append($inModelAlias);

        var $inModelAliasBody = this.addPropertyControl($inModelAlias, {label: 'In Model Variable'});

        this.createInModelAlias($inModelAliasBody);
        $inModelAliasBody.perfectScrollbar();
    };

    ScalaEditorDialog.prototype.renderInImageAlias = function ($parent) {
        var $inImageAlias = $('<div class="brtc-va-dialogs-scalaeditor-alias-in-image"></div>');

        $parent.append($inImageAlias);

        var $inImageAliasBody = this.addPropertyControl($inImageAlias, {label: 'In Image Variable'});

        this.createInImageAlias($inImageAliasBody);
        $inImageAliasBody.perfectScrollbar();
    };

    ScalaEditorDialog.prototype.renderOutputs = function ($parent) {
        var _this = this;

        var $outputs = $('<div class="brtc-va-dialogs-scalaeditor-alias-out"></div>');

        $parent.append($outputs);

        this.$outputsBody = this.addPropertyControl($outputs, {label: 'Outputs'});
        this.$outputsBody.perfectScrollbar();

        this.$addButton = $('<input type="button" class= "brtc-va-editors-sheet-controls-propertycontrol-addbutton" value="+ Add Output"/>');
        $outputs.find('.brtc-va-dialogs-scalaeditor-alias-header').after(this.$addButton);
        this.$addButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 32
        });
        this.$addButton.click(function () {
            _this.createOutTableAlias(_this.$outputsBody, false);
            _this.$outputsBody.perfectScrollbar('update');
        });

        this.createOutput(_this.$outputsBody);
    };

    ScalaEditorDialog.prototype.createOutput = function ($parent) {
        var _this = this;
        var outputs = this.FnUnitUtils.getOutputs(this.options.fnUnit);
        var i=0;
        _.forEach(outputs, function (tid, key) {
            var $optionalInput = _this.createOutTableAlias($parent, false, tid);
            var type = _this.FnUnitUtils.getTypeByTableId(_this.options.fnUnit, tid)
            $optionalInput.find('.alias input').val(key);
            $optionalInput.find('.type .brtc-va-dialogs-scalaeditor-alias-body-outtable-type').val(type);
        });

        $parent.perfectScrollbar();
    };

    ScalaEditorDialog.prototype.createOutTableAlias = function ($parent, isMandatory, tableId) {
        var $aliasUnit = $('' +
            '<div class="brtc-va-dialogs-contents-statement-lastline-element-wrapper">' +
            '   <div class="brtc-va-dialogs-contents-statement-lastline-element-script alias"></div>' +
            '   <div class="brtc-va-dialogs-contents-statement-lastline-element-script-type type"></div>' +
            '</div>'
        );

        $parent.append($aliasUnit);

        this.createInput($aliasUnit.find('.brtc-va-dialogs-contents-statement-lastline-element-script'), '', isMandatory, tableId);
        this.createDropDownList($aliasUnit.find('.brtc-va-dialogs-contents-statement-lastline-element-script-type'), '', isMandatory, tableId);

        return $aliasUnit;
    };

    ScalaEditorDialog.prototype.createDropDownList = function ($parent, alias, isMandatory, tableId) {
        var $outTableType = $('' +
            '<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-type" tableId="' + tableId + '">' +
            '</div>' +
            '');

        $parent.append($outTableType);

        var source = [
            {text: 'TABLE', value: 'table'},
            {text: 'MODEL', value: 'model'}
        ];

        var options = {
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '20px',
            source: source,
            displayMember: 'text',
            selectedIndex: 0,
            valueMember: 'value',
            dropDownHeight: 50
        };
        $outTableType.jqxDropDownList(options);
    };

    ScalaEditorDialog.prototype.createInput = function ($parent, alias, isMandatory, tableId) {
        var _this = this;

        var $outTableInput = $('' +
            '<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable" tableId="' + tableId + '">' +
            '   <input class="brtc-va-dialogs-scalaeditor-alias-body-outtable-input" isMandatory=' + isMandatory + ' />' +
            '   <div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-remove""></div>' +
            '</div>' +
            '');

        var $input = $outTableInput.find('input');

        $parent.append($outTableInput);

        $input.jqxInput({
            placeHolder: "Enter alias",
            height: 32,
            width: '108px',
            theme: 'office'
        });
        $input.jqxInput('val', alias);

        if ($input.val() === '' || $input.val() == undefined) {
            $input.css('border-color', 'red');

        }

        $input.focus();

        $input.on('change', function () {
            if ($(this).val() == '') {
                $(this).css('border-color', 'red');
            } else {
                $(this).css('border-color', '#d4d4d4');
            }
        });

        $input.keydown(function (key) {
            if (key.keyCode == 13) {
                _this.createOutTableAlias(_this.$outputsBody, false);
            }
        });

        if (isMandatory == true && alias == '') {
            $input.css('border-color', 'red');
        }

        var $removeButton = $outTableInput.find('.brtc-va-dialogs-scalaeditor-alias-body-outtable-remove');
        $removeButton.attr({
            'isMandatory': isMandatory
        });

        $removeButton.click(function () {
            var $target = $(this).closest('.brtc-va-dialogs-contents-statement-lastline-element-wrapper');
            if ($target.find('.brtc-va-dialogs-scalaeditor-alias-body-outtable').attr('tableId')) _this.removeSendFnunit($target.attr('tableId'));
            $target.remove();
            _this.$outputsBody.perfectScrollbar('update');
        });

        return $input;
    };

    ScalaEditorDialog.prototype.removeSendFnunit = function (tableId) {
        //????? 뭐지 send?
        // var tableIdIndex = this.FnUnitUtils.getOutTable(this.sendFnunit).indexOf(tableId);

        // this.sendFnunit[OUT_DATA].splice(tableIdIndex, 1);
        // this.sendFnunit.param['out-table-alias'].splice(tableIdIndex, 1);
    };

    ScalaEditorDialog.prototype.addPropertyControl = function ($parent, options) {
        var _this = this;

        var label = options.label;
        if(options.mandatory) label = '<div style="display:inline-block;">' + label + ' <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>';
        var $controlHeader = $('<div class="brtc-va-dialogs-scalaeditor-alias-header">' + label + '</div>');
        var $controlBody = $('<div class="brtc-va-dialogs-scalaeditor-alias-body"></div>');
        $controlBody.css('height', '460px');

        $parent.append($controlHeader).append($controlBody);

        return $controlBody;
    };

    ScalaEditorDialog.prototype.getTitle = function () {
        return 'Scala';
    };

    ScalaEditorDialog.prototype.handleOkClicked = function () {
        if (this.options.scriptOnly || this.options.scriptOnly === false) {
            this.dialogResult = {
                OK: true,
                Cancel: false,
                queryStatement: this.codeMirror.getValue()
            };
        } else {
            var aliasArr = this.$outputsBody.find('.brtc-va-dialogs-contents-statement-lastline-element-wrapper');

            this.sendFnunit['outputs'] = {};
            this.sendFnunit['meta'] = {
                'inputs': {'type': 'table', 'range':{'min':1, 'max':10}},
                'models': {'type': 'model', 'range':{'min':1, 'max':10}}
            };
            for (var i = 0; i < aliasArr.length; i++) {
                var alias = $(aliasArr[i]).find('.brtc-va-dialogs-scalaeditor-alias-body-outtable input').val();
                var type = $(aliasArr[i]).find('.brtc-va-dialogs-scalaeditor-alias-body-outtable-type').val();
                var tableId = $(aliasArr[i]).find('.brtc-va-dialogs-scalaeditor-alias-body-outtable').attr('tableId');
                if (tableId === 'undefined' || !tableId) tableId = Brightics.VA.Core.Utils.IDGenerator.table.id();

                this.sendFnunit['outputs'][alias] = tableId;
                this.sendFnunit['meta'][alias] = {type: type};
            }

            this.sendFnunit.param.script = this.codeMirror.getValue();
            this.dialogResult = {
                OK: true,
                Cancel: false,
                param: this.sendFnunit.param,
                outputs: this.sendFnunit.outputs,
                meta: this.sendFnunit.meta
            };
        }

        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.ScalaEditorDialog = ScalaEditorDialog;

}).call(this);

/**
 * sungjin1.kim@samsung.com
 * 2018. 02. 08
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;
    var _super = Brightics.VA.Dialogs.Dialog.prototype;

    function ScheduleManagementDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    ScheduleManagementDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    ScheduleManagementDialog.prototype.constructor = ScheduleManagementDialog;

    ScheduleManagementDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);

        this.dialogOptions.width = 1200;
        this.dialogOptions.height = 'auto';
        this.dialogOptions.maxHeight = 'auto';
    };

    ScheduleManagementDialog.prototype.createDialogContentsArea = function ($parent) {
        var template = [
            '<div class="brtc-va-dialogs-schedule-management-header">',
            '   <input type="button" class="brtc-va-dialogs-schedule-management-delete" value="Delete">',
            '   <input type="button" class="brtc-va-dialogs-schedule-management-add" value="Add">',
            '</div>',
            '<div class="brtc-va-dialogs-schedule-management-body">',
            '</div>'
        ].join('\n');

        $parent.append(template);

        this.$addButton = $parent.find('.brtc-va-dialogs-schedule-management-add');
        this.$deleteButton = $parent.find('.brtc-va-dialogs-schedule-management-delete');
        this.$contentBody = $parent.find('.brtc-va-dialogs-schedule-management-body');

        var emitter = new Brightics.VA.EventEmitter();

        emitter.on('row-click', function (row) {
            this.openDetailScheduleDialog(row);
        }.bind(this));
        emitter.on('row-select', function (row) {
            this._refreshButtonStatus('row-select', row);
        }.bind(this));
        emitter.on('row-unselect', function (row) {
            this._refreshButtonStatus('row-unselect', row);
        }.bind(this));

        this.scheduleListComponent = new Brightics.VA.Core.Components.ScheduleList({
            $el: this.$contentBody,
            emitter: emitter
        });

        this.createDeleteButton(this.$deleteButton);
        this.createAddButton(this.$addButton);

        this._refreshScheduleList();
    };

    ScheduleManagementDialog.prototype.createDialogButtonBar = function ($parent) {
        Brightics.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this, $parent);

        this.$okButton.val('Close');
        this.$cancelButton.css({ display: 'none' });
    };

    ScheduleManagementDialog.prototype.createAddButton = function ($self) {
        $self.jqxButton({ theme: Brightics.VA.Env.Theme });
        $self.click(_.debounce(this.openAddScheduleDialog.bind(this)));
    };

    ScheduleManagementDialog.prototype.openAddScheduleDialog = function () {
        var closeHandler = function (result) {
            if (result.OK) this._refreshScheduleList(); // TODO scheduleDAO.addSchedule();
        }.bind(this);

        new Brightics.VA.Core.Dialogs.AddScheduleDialog(this.$mainControl, {
            editorInput: this.options.editorInput,
            close: closeHandler,
            title: 'Add Schedule'
        });
    };

    ScheduleManagementDialog.prototype.createDeleteButton = function ($self) {
        $self.jqxButton({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
        $self.click(_.debounce(this.openDeleteScheduleDialog.bind(this)));
    };

    ScheduleManagementDialog.prototype.openDeleteScheduleDialog = function (isSingle) {
        var closeHandler = function (result) {
            // TODO if(result.OK) this.scheduleDAO.deleteSchedules();
            if (result.OK) {
                var selectedRows = this.scheduleListComponent.getControl().getSelectedRows();
                var cnt = 0, schedules = [], _this = this;
                for (var i in selectedRows) {
                    $.ajax({
                        url: 'api/admin/v2/schedules/' + selectedRows[i].scheduleId + '/delete',
                        type: 'POST',
                        data: JSON.stringify(selectedRows[i]),
                        blocking: true,
                        contentType: 'application/json; charset=utf-8'
                    }).done(function (data) {
                        if (data.success) {
                            cnt++;
                        }
                        if (cnt === selectedRows.length) {
                            _this._refreshScheduleList();
                        }
                    }).fail(function (err) {
                        _this._onError(err);
                    });
                }
            }
        }.bind(this);

        Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog('Selected item(s) will be permanently deleted and cannot be recovered. Are you sure?', closeHandler);
    };

    ScheduleManagementDialog.prototype.openDetailScheduleDialog = function (schedule) {
        var closeHandler = function (result) {
            if (result.OK) this._refreshScheduleList();
        }.bind(this);

        new Brightics.VA.Core.Dialogs.DetailScheduleDialog(this.$mainControl, {
            editorInput: this.options.editorInput,
            schedule: schedule,
            close: closeHandler,
            title: 'Schedule Detail'
        });
    };

    ScheduleManagementDialog.prototype._refreshScheduleList = function () {
        // TODO scheduleDAO.getSchedules();
        var sendAjax = function (option, doneCallback, failCallback) {
            return new Promise(function (resolve, reject) {
                $.ajax(option)
                    .done(function (result) {
                        if (doneCallback && typeof doneCallback === 'function') {
                            doneCallback(result);
                        }
                        resolve(result);
                    }).fail(function (err) {
                        if (failCallback && typeof failCallback === 'function') {
                            failCallback(err);
                        }
                        reject(err);
                    });
            });
        };
        sendAjax({
            url: 'api/admin/v2/schedules',
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            blocking: true
        }).then(function (scheduleList) {
            var modelScheduleList = _.filter(scheduleList, function (schedule) {
                var scheduleContents = JSON.parse(schedule.executeContents);
                return scheduleContents.main === this.options.editorInput.getFileId();
            }.bind(this));

            modelScheduleList = _.map(modelScheduleList, function (schedule) {
                var contents = JSON.parse(schedule.executeContents);
                var versionId;
                var mid;

                for (var key in contents.models) {
                    versionId = contents.models[key].versionId;
                    mid = contents.models[key].mid;
                }
                schedule.versionId = versionId;
                schedule.mid = mid;
                return schedule;
            });

            this.scheduleListComponent.update(modelScheduleList);
        }.bind(this))
            .catch(this._onError.bind(this));
    };

    ScheduleManagementDialog.prototype._refreshButtonStatus = function (eventType, data) {
        var selectedRows = this.scheduleListComponent.getControl().getSelectedRows();
        this.$deleteButton.jqxButton({ disabled: selectedRows.length <= 0 });
    };

    ScheduleManagementDialog.prototype._onError = function (err) {
        Utils.WidgetUtils.openBadRequestErrorDialog(err);
    };

    ScheduleManagementDialog.prototype.destroy = function () {
        this.scheduleListComponent.destroy();
        _super.destroy.call(this);
    };

    Brightics.VA.Core.Dialogs.ScheduleManagementDialog = ScheduleManagementDialog;

/* eslint-disable no-invalid-this */
}).call(this);
/* eslint-disable no-invalid-this */

/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const STORAGE_NAME = 'info.script.show';

    function ScriptInfoDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    ScriptInfoDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    ScriptInfoDialog.prototype.constructor = ScriptInfoDialog;

    ScriptInfoDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 420;
        this.dialogOptions.height = 200;
    };

    ScriptInfoDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<span class="brtc-va-dialogs-body-content-icon" alert="warn"></span>' +
            '<p>Please be cautious with using scripts because they can cause serious problems to your system.</p>');
        $('.ui-dialog-titlebar.ui-widget-header').attr('style', 'border-bottom: none !important;');
    };

    ScriptInfoDialog.prototype.getPosition = function ($parent) {
    };

    ScriptInfoDialog.prototype.createDialogButtonBar = function ($parent) {
        var checkMessage = 'Do not ask me again';
        var $checkbox = $('<div>' + checkMessage + '</input>');

        $parent.append($checkbox);

        $checkbox.jqxCheckBox({
            theme: "office",
            width: 200,
            height: 25,
            checked: false,
            boxSize: "17px",
            animationShowDelay: 0,
            animationHideDelay: 0
        });

        $checkbox.on('click', function () {
            localStorage.setItem(STORAGE_NAME, !$(this).val());
        });
        $checkbox.css('float', 'left');

        this.$okButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />');
        $parent.append(this.$okButton);
        this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        this.$okButton.click(this.handleOkClicked.bind(this));
    };

    Brightics.VA.Core.Dialogs.ScriptInfoDialog = ScriptInfoDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function SelectUserDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    SelectUserDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SelectUserDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-newfiledialog">' +
            // '   <div class="brtc-va-dialogs-header">Select User</div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="Send" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        var _this = this;

        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: 'Select User',
            width: 600,
            height: 470,
            modal: true,
            resizable: false,
            close: function () {
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        };
        this.$mainControl.dialog(jqxOpt);
    };

    SelectUserDialog.prototype.initContents = function () {
        var _this = this;
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });
        _this.$okButton.click(_this.sendModelInformation.bind(_this));
    };


    SelectUserDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        $parent.append('' +
            '<div class="brtc-va-dialogs-contents-label-main">Name</div>' +
            '<input type="search" class="brtc-va-dialogs-selectuser-name-input" />' +
            '<div class="brtc-va-dialogs-selectuser-result-label">User</div>' +
            '<div class="brtc-va-dialogs-selectuser-result-list"></div>' +
            '');


        $parent.find('.brtc-va-dialogs-selectuser-name-input').jqxInput({
            placeHolder: 'Search User',
            theme: Brightics.VA.Env.Theme,
            height: '23px',
            width: '250px'
        });

        $parent.find('.brtc-va-dialogs-selectuser-result-list').perfectScrollbar();

        $parent.find('.brtc-va-dialogs-selectuser-name-input').focus();

        $parent.find('.brtc-va-dialogs-selectuser-name-input').keyup(function (event) {
            var name = event.target.value || '';
            name.trim();
            if (event.keyCode === 13 && name !== '') {
                _this.searchUserByName(name);
            }
        });
    };

    SelectUserDialog.prototype.searchUserByName = function (userName) {
        var _this = this;
        $.ajax({
            method: 'get',
            url: 'api/admin/v2/users?pattern=' + encodeURIComponent(userName) + '&name=true',
            blocking: true
        }).done(function (userList) {
            _this.reset();
            _this.fillUserList(userList);
        }).fail(function (err) {
        })
    };

    SelectUserDialog.prototype.reset = function () {
        var $userListContainer = this.$mainControl.find('.brtc-va-dialogs-selectuser-result-list');
        $userListContainer.empty();
        this.selectedUserId = '';
        this.$okButton.jqxButton({
            disabled: true
        });
    };

    SelectUserDialog.prototype.createUserListHeader = function () {
        var $userListContainer = this.$mainControl.find('.brtc-va-dialogs-selectuser-result-list');
        $userListContainer.append('<table class="brtc-va-dialogs-selectuser-table">' +
            '   <tr class="brtc-va-dialogs-selectuser-table-header">' +
            '       <th>name</th>' +
            '       <th>id</th>' +
            '       <th>email</th>' +
            '   </tr>' +
            '</table>');
    };

    SelectUserDialog.prototype.fillUserList = function (userList) {
        var $userListContainer = this.$mainControl.find('.brtc-va-dialogs-selectuser-result-list'), user, $userTable;

        if (userList.length === 0) {
            $userListContainer.text('Your search did not match any person.');
        } else {
            this.createUserListHeader();
            $userTable = $userListContainer.find('table');
            for (var i = 0; i < userList.length; i++) {
                user = userList[i];
                $userTable.append($('' +
                    '   <tr class="brtc-va-dialogs-selectuser-table-tr" userId="' + user.id + '">' +
                    '       <td>' + user.name + '</td>' +
                    '       <td>' + user.id + '</td>' +
                    '       <td>' + user.email + '</td>' +
                    '   </tr>'));
            }

            this.createUserSelectEvent($userTable);
        }
    };
    SelectUserDialog.prototype.createUserSelectEvent = function ($table) {
        var $userRows = $table.find('.brtc-va-dialogs-selectuser-table-tr'), $userRow, _this = this, $targetRow;
        for (var i = 0; i < $userRows.length; i++) {
            $userRow = $($userRows[i]);
            $userRow.click(function (event) {
                $userRows.removeClass('selected');
                $targetRow = $(event.target).closest('tr');

                $targetRow.addClass('selected');
                _this.selectedUserId = $targetRow.attr('userId');
                _this.$okButton.jqxButton({
                    disabled: false
                });

            })
        }
        this.openConfirmDialog();
    };

    SelectUserDialog.prototype.sendModelInformation = function () {
        var _this = this;
        var data = {
            sendId: Brightics.VA.Core.Utils.IDGenerator.send.id(),
            userId: this.selectedUserId,
            fromUserId: Brightics.VA.Env.Session.userId,
            sendMessage: '',
            projectId: this.options.projectId,
            fileId: this.options.fileId
        };
        $.ajax({
            url: 'api/v1/ws/send/file/create',
            type: 'POST',
            data: JSON.stringify(data),
            contentType: 'application/json; charset=utf-8',
            blocking: true
        }).done(function (data) {
            Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Success.', function () {
                _this.$mainControl.dialog('close');
            });
        });
    };

    Brightics.VA.Core.Dialogs.SelectUserDialog = SelectUserDialog;

}).call(this);
/**
 * hyunseok.oh@samsung.com
 * 2017. 12. 25.
 */

/**
 * 의존모듈: jQuery, Dialog
 */

(function () {
    'use strict';

    var Brightics = this.Brightics;
    var Utils = Brightics.VA.Core.Utils;
    var _super = Brightics.VA.Dialogs.Dialog.prototype;

    /**
     * @extends Dialog
     * @param {*} parentId
     * @param {Object} options
     */
    function SelectVersionDetailDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    SelectVersionDetailDialog.prototype = Object.create(_super);
    SelectVersionDetailDialog.prototype.constructor = SelectVersionDetailDialog;

    SelectVersionDetailDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);
        this.dialogOptions.width = 760;
        this.dialogOptions.height = 440;
        this.dialogOptions.maxHeight = 440;
        this.dialogOptions.title = 'Version Detail';
    };

    SelectVersionDetailDialog.prototype.createDialogContentsArea = function ($parent) {
        var html = [
            '<div class="brtc-va-dialogs-select-version-datail-contents">',
            '  <div class="brtc-va-dialogs-select-version-detail">',
            '  </div>',
            '</div>'
        ].join('\n');

        this.$self = $(html);
        $parent.append(this.$self);
        this.$detailBody = this.$self.find('.brtc-va-dialogs-select-version-detail');
        this.modelVersionDetail = new Brightics.VA.Core.Components.ModelVersionDetail({
            $el: this.$detailBody
        });

        this._refreshDetail();
    };

    SelectVersionDetailDialog.prototype.createDialogButtonBar = function ($parent) {
        _super.createDialogButtonBar.call(this, $parent);
        this.$okButton.val('Close');
        this.$cancelButton.css({ display: 'none' });
    };

    SelectVersionDetailDialog.prototype.handleOkClicked = function () {
        _super.handleOkClicked.call(this);
    };

    SelectVersionDetailDialog.prototype._refreshDetail = function () {
        var updateModelVersionDetail = function (data) {
            this.data = data;
            this.modelVersionDetail.update(data);
        }.bind(this);

        Studio.getResourceManager().fetchVersion(
            this.options.projectId,
            this.options.fileId,
            this.options.versionId)
            .then(updateModelVersionDetail)
            .catch(function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                this.$mainControl.dialog('close');
            }.bind(this));
    };

    Brightics.VA.Core.Dialogs.SelectVersionDetailDialog = SelectVersionDetailDialog;
/* eslint-disable no-invalid-this */
}.call(this));

/**
 * 2017-12-13
 * hyunseok.oh@samsung.com
 */

(function () {
    'use strict';

    var Brightics = this.Brightics;
    var _super = Brightics.VA.Dialogs.Dialog.prototype;

    /**
     * @extends Dialog
     * @param {*} parentId
     * @param {Object} options
     */
    function SelectVersionDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
        this.onSelect = options.onSelect;
        this.emitter = options.emitter;
    }

    SelectVersionDialog.prototype = Object.create(_super);
    SelectVersionDialog.prototype.constructor = SelectVersionDialog;

    SelectVersionDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);

        this.dialogOptions.title = 'Version List';
        this.dialogOptions.width = 1000;
        this.dialogOptions.height = 'auto';
        this.dialogOptions.maxHeight = 'auto';
    };

    SelectVersionDialog.prototype.createDialogContentsArea = function ($parent) {
        var html = [
            '<div class="brtc-va-dialogs-select-version-list-contents">',
            '  <div class="brtc-va-dialogs-select-version-list-body">',
            '  </div>',
            '</div>'
        ].join('\n');

        this.$self = $(html);
        $parent.append(this.$self);

        this.$contentBody = $parent.find('.brtc-va-dialogs-select-version-list-body');

        var emitter = new Brightics.VA.EventEmitter();
        emitter.on('select', function (fileVersion) {
            this.dialogResult.data = fileVersion;
            _super.handleOkClicked.call(this);
        }.bind(this));

        this.modelVersionListComponent =
            new Brightics.VA.Core.Components.ModelVersionListSelectable({
                $el: this.$contentBody,
                emitter: emitter,
                projectId: this.options.projectId,
                fileId: this.options.fileId
            });
    };

    SelectVersionDialog.prototype.createDialogButtonBar = function ($parent) {
        _super.createDialogButtonBar.call(this, $parent);
        this.$okButton.val('Close');
        this.$cancelButton.css({ display: 'none' });
    };

    Brightics.VA.Core.Dialogs.SelectVersionDialog = SelectVersionDialog;

/* eslint-disable no-invalid-this */
}.call(this));
/* eslint-disable no-invalid-this */

/**
 * Created by hs79.shin on 2016-10-07.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetPropertiesDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    SetPropertiesDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SetPropertiesDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main">' +
            // '   <div class="brtc-va-dialogs-header">Set Properties</div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents">' +
            '       </div>' +
            '       <div class="brtc-va-dialogs-buttonbar">' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
            '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />' +
            '       </div>' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
        this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

        var _this = this;

        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: 'Set Properties',
            width: 1024,
            height: 600,
            maxWidth: 1024,
            maxHeight: 600,
            modal: true,
            resizable: false,
            close: function () {
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        };
        this.$mainControl.dialog(jqxOpt);
    };

    SetPropertiesDialog.prototype.initContents = function () {
        var _this = this;
        _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));

        _this.$okButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        _this.$okButton.click(_this.performFinish.bind(_this));
        _this.$cancelButton.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
    };


    SetPropertiesDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        this.$columnGrid = $('<div class="brtc-va-dialog-spreadsheet style="width:98%; height:95%;"></div>');
        $parent.append(this.$columnGrid);

        var cellbeginedit = function (row, datafield, columntype, value) {
            var isBoolean = false;
            var selectedIndexes = _this.$columnGrid.jqxGrid('getselectedrowindexes');
            if (selectedIndexes.length > 0 && datafield != 'column') {
                for (var i in selectedIndexes) {
                    if (row == selectedIndexes[i]) {
                        isBoolean = true;
                    }
                }
            }
            return isBoolean;
        }

        this.$columnGrid.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: 'calc(100% - 2px)',
            height: '99%',
            rowsheight: 25,
            filterable: false,
            showfiltercolumnbackground: false,
            showfiltermenuitems: true,
            autoshowfiltericon: true,
            altrows: false,
            sortable: true,
            editable: true,
            showsortcolumnbackground: false,
            columnsresize: true,
            selectionmode: 'checkbox',
            columns: [{
                text: 'Column',
                datafield: 'column',
                width: '80',
                cellbeginedit: cellbeginedit
            }, {
                text: 'analyzer',
                datafield: 'analyzer',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'textbox'
            }, {
                text: 'boost',
                datafield: 'boost',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'numberinput',
                cellsalign: 'right',
                initeditor: function (row, cellvalue, editor) {
                    editor.jqxNumberInput({decimalDigits: 0});
                }
            }, {
                text: 'coerce',
                datafield: 'coerce',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'copyto',
                datafield: 'copyto',
                width: '80',
                cellbeginedit: cellbeginedit
            }, {
                text: 'docvalues',
                datafield: 'docvalues',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'dynamic',
                datafield: 'dynamic',
                width: '80',
                columntype: 'dropdownlist',
                cellbeginedit: cellbeginedit,
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'enabled',
                datafield: 'enabled',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'fielddata',
                datafield: 'fielddata',
                width: '80',
                cellbeginedit: cellbeginedit
            }, {
                text: 'format',
                datafield: 'format',
                width: '80',
                cellbeginedit: cellbeginedit
            }, {
                text: 'geohash',
                datafield: 'geohash',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'geohashPrefix',
                datafield: 'geohashprefix',
                width: '100',
                columntype: 'dropdownlist',
                cellbeginedit: cellbeginedit,
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'geohashPrecision',
                datafield: 'geohashprecision',
                width: '100',
                cellbeginedit: cellbeginedit,
                columntype: 'numberinput',
                cellsalign: 'right',
                initeditor: function (row, cellvalue, editor) {
                    editor.jqxNumberInput({decimalDigits: 0});
                }
            }, {
                text: 'ignoreAbove',
                datafield: 'ignoreabove',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'numberinput',
                cellsalign: 'right',
                initeditor: function (row, cellvalue, editor) {
                    editor.jqxNumberInput({decimalDigits: 0});
                }
            }, {
                ext: 'ignoreMalformed',
                datafield: 'ignoremalformed',
                width: '100',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'includeInAll',
                datafield: 'includeinall',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'index',
                datafield: 'index',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var dropdownList = ['', 'no', 'not_analyzed', 'analyzed'];
                    editor.jqxDropDownList({source: dropdownList});
                }
            }, {
                text: 'indexOptions',
                datafield: 'indexoptions',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var dropdownList = ['', 'docs', 'freqs', 'positions', 'offsets'];
                    editor.jqxDropDownList({source: dropdownList});
                }
            }, {
                text: 'latLon',
                datafield: 'latlon',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'fields',
                datafield: 'fields',
                width: '80',
                cellbeginedit: cellbeginedit
            }, {
                text: 'normsEnabled',
                datafield: 'normsenabled',
                width: '100',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'normsLoading',
                datafield: 'normsloading',
                width: '100'
            }, {
                text: 'nullValue',
                datafield: 'nullvalue',
                width: '80',
                cellbeginedit: cellbeginedit
            }, {
                text: 'positionIncrementGap',
                datafield: 'positionincrementgap',
                width: '130',
                cellbeginedit: cellbeginedit,
                columntype: 'numberinput',
                cellsalign: 'right',
                initeditor: function (row, cellvalue, editor) {
                    editor.jqxNumberInput({decimalDigits: 0});
                }
            }, {
                text: 'properties',
                datafield: 'properties',
                width: '80',
                cellbeginedit: cellbeginedit
            }, {
                text: 'searchanalyzer',
                datafield: 'searchanalyzer',
                width: '100',
                cellbeginedit: cellbeginedit
            }, {
                text: 'similarity',
                datafield: 'similarity',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'TF', 'IDF', 'BM25'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'store',
                datafield: 'store',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var isBoolean = ['', 'True', 'False'];
                    editor.jqxDropDownList({source: isBoolean});
                }
            }, {
                text: 'termvector',
                datafield: 'termvector',
                width: '80',
                cellbeginedit: cellbeginedit,
                columntype: 'dropdownlist',
                initeditor: function (row, cellvalue, editor, celltext, cellwidth, cellheight) {
                    var dropdownList = ['', 'no', 'yes', 'with_positions', 'with_offsets', 'with_positions_offsets'];
                    editor.jqxDropDownList({source: dropdownList});
                }
            }]
        });

        var columnsData = [];
        for (var i in this.options.columns) {
            var column = {};
            column.column = this.options.columns[i].name;

            for (var j in this.options.fnUnit.param['properties-colums']) {
                if (this.options.columns[i].name == this.options.fnUnit.param['properties-colums'][j]) {
                    column.analyzer = this.options.fnUnit.param['properties-analyzer'][j];
                    column.boost = this.options.fnUnit.param['properties-boost'][j];
                    column.coerce = this.options.fnUnit.param['properties-coerce'][j];
                    column.copyto = this.options.fnUnit.param['properties-copy-to'][j];
                    column.docvalues = this.options.fnUnit.param['properties-doc-values'][j];
                    column.dynamic = this.options.fnUnit.param['properties-dynamic'][j];
                    column.enabled = this.options.fnUnit.param['properties-enabled'][j];
                    column.fielddata = this.options.fnUnit.param['properties-fielddata'][j];
                    column.format = this.options.fnUnit.param['properties-format'][j];
                    column.geohash = this.options.fnUnit.param['properties-geohash'][j];
                    column.geohashprefix = this.options.fnUnit.param['properties-geohash-prefix'][j];
                    column.geohashprecision = this.options.fnUnit.param['properties-geohash-precision'][j];
                    column.ignoreabove = this.options.fnUnit.param['properties-ignore-above'][j];
                    column.ignoremalformed = this.options.fnUnit.param['properties-ignore-malformed'][j];
                    column.includeinall = this.options.fnUnit.param['properties-include-in-all'][j];
                    column.index = this.options.fnUnit.param['properties-index'][j];
                    column.indexoptions = this.options.fnUnit.param['properties-index-options'][j];
                    column.latlon = this.options.fnUnit.param['properties-lat-lon'][j];
                    column.fields = this.options.fnUnit.param['properties-fields'][j];
                    column.normsenabled = this.options.fnUnit.param['properties-norms-enabled'][j];
                    column.normsloading = this.options.fnUnit.param['properties-norms-loading'][j];
                    column.nullvalue = this.options.fnUnit.param['properties-null-value'][j];
                    column.positionincrementgap = this.options.fnUnit.param['properties-position-increment-gap'][j];
                    column.properties = this.options.fnUnit.param['properties-properties'][j];
                    column.searchanalyzer = this.options.fnUnit.param['properties-search-analyzer'][j];
                    column.similarity = this.options.fnUnit.param['properties-similarity'][j];
                    column.store = this.options.fnUnit.param['properties-store'][j];
                    column.termvector = this.options.fnUnit.param['properties-term-vector'][j];

                    _this.$columnGrid.jqxGrid('selectrow', parseInt(i));
                }
            }
            columnsData.push(column);
        }

        var source = {
            localdata: columnsData,
            datafields: [{
                name: 'column',
                type: 'string'
            }, {
                name: 'analyzer',
                type: 'string'
            }, {
                name: 'boost',
                type: 'string'
            }, {
                name: 'coerce',
                type: 'string'
            }, {
                name: 'copyto',
                type: 'string'
            }, {
                name: 'docvalues',
                type: 'string'
            }, {
                name: 'dynamic',
                type: 'string'
            }, {
                name: 'enabled',
                type: 'string'
            }, {
                name: 'fielddata',
                type: 'string'
            }, {
                name: 'format',
                type: 'string'
            }, {
                name: 'geohash',
                type: 'string'
            }, {
                name: 'geohashprefix',
                type: 'string'
            }, {
                name: 'geohashprecision',
                type: 'string'
            }, {
                name: 'ignoreabove',
                type: 'string'
            }, {
                name: 'ignoreMalformed',
                type: 'string'
            }, {
                name: 'includeinall',
                type: 'string'
            }, {
                name: 'index',
                type: 'string'
            }, {
                name: 'indexoptions',
                type: 'string'
            }, {
                name: 'latlon',
                type: 'string'
            }, {
                name: 'fields',
                type: 'string'
            }, {
                name: 'normsenabled',
                type: 'string'
            }, {
                name: 'normsloading',
                type: 'string'
            }, {
                name: 'nullvalue',
                type: 'string'
            }, {
                name: 'positionincrementgap',
                type: 'string'
            }, {
                name: 'properties',
                type: 'string'
            }, {
                name: 'searchanalyzer',
                type: 'string'
            }, {
                name: 'similarity',
                type: 'string'
            }, {
                name: 'store',
                type: 'string'
            }],
            datatype: "array"
        };

        var adapter = new $.jqx.dataAdapter(source);
        _this.$columnGrid.jqxGrid('source', adapter);
    };

    SetPropertiesDialog.prototype.performFinish = function () {
        var _this = this;

        var commandOption = {
            fnUnit: this.options.fnUnit,
            ref: {param: {}}
        };

        var selectedIndexes = _this.$columnGrid.jqxGrid('getselectedrowindexes');

        commandOption.ref.param['properties-colums'] = [];
        commandOption.ref.param['properties-analyzer'] = [];
        commandOption.ref.param['properties-boost'] = [];
        commandOption.ref.param['properties-coerce'] = [];
        commandOption.ref.param['properties-copy-to'] = [];
        commandOption.ref.param['properties-doc-values'] = [];
        commandOption.ref.param['properties-dynamic'] = [];
        commandOption.ref.param['properties-enabled'] = [];
        commandOption.ref.param['properties-fielddata'] = [];
        commandOption.ref.param['properties-format'] = [];
        commandOption.ref.param['properties-geohash'] = [];
        commandOption.ref.param['properties-geohash-prefix'] = [];
        commandOption.ref.param['properties-geohash-precision'] = [];
        commandOption.ref.param['properties-ignore-above'] = [];
        commandOption.ref.param['properties-ignore-malformed'] = [];
        commandOption.ref.param['properties-include-in-all'] = [];
        commandOption.ref.param['properties-index'] = [];
        commandOption.ref.param['properties-index-options'] = [];
        commandOption.ref.param['properties-lat-lon'] = [];
        commandOption.ref.param['properties-fields'] = [];
        commandOption.ref.param['properties-norms-enabled'] = [];
        commandOption.ref.param['properties-norms-loading'] = [];
        commandOption.ref.param['properties-null-value'] = [];
        commandOption.ref.param['properties-position-increment-gap'] = [];
        commandOption.ref.param['properties-properties'] = [];
        commandOption.ref.param['properties-search-analyzer'] = [];
        commandOption.ref.param['properties-similarity'] = [];
        commandOption.ref.param['properties-store'] = [];
        commandOption.ref.param['properties-term-vector'] = [];

        for (var i in selectedIndexes) {
            var data = _this.$columnGrid.jqxGrid('getrowdata', selectedIndexes[i])
            commandOption.ref.param['properties-colums'].push(data.column);
            if (data.analyzer) {
                commandOption.ref.param['properties-analyzer'].push(data.analyzer);
            } else {
                commandOption.ref.param['properties-analyzer'].push('');
            }
//
            if (data.boost) {
                commandOption.ref.param['properties-boost'].push(data.boost);
            } else {
                commandOption.ref.param['properties-boost'].push('');
            }

            if (data.coerce) {
                commandOption.ref.param['properties-coerce'].push(data.coerce);
            } else {
                commandOption.ref.param['properties-coerce'].push('');
            }

            if (data.copyto) {
                commandOption.ref.param['properties-copy-to'].push(data.copyto);
            } else {
                commandOption.ref.param['properties-copy-to'].push('');
            }

            if (data.docvalues) {
                commandOption.ref.param['properties-doc-values'].push(data.docvalues);
            } else {
                commandOption.ref.param['properties-doc-values'].push('');
            }

            if (data.dynamic) {
                commandOption.ref.param['properties-dynamic'].push(data.dynamic);
            } else {
                commandOption.ref.param['properties-dynamic'].push('');
            }

            if (data.enabled) {
                commandOption.ref.param['properties-enabled'].push(data.enabled);
            } else {
                commandOption.ref.param['properties-enabled'].push('');
            }

            if (data.fielddata) {
                commandOption.ref.param['properties-fielddata'].push(data.fielddata);
            } else {
                commandOption.ref.param['properties-fielddata'].push('');
            }

            if (data.format) {
                commandOption.ref.param['properties-format'].push(data.format);
            } else {
                commandOption.ref.param['properties-format'].push('');
            }

            if (data.geohash) {
                commandOption.ref.param['properties-geohash'].push(data.geohash);
            } else {
                commandOption.ref.param['properties-geohash'].push('');
            }

            if (data.geohashprefix) {
                commandOption.ref.param['properties-geohash-prefix'].push(data.geohashprefix);
            } else {
                commandOption.ref.param['properties-geohash-prefix'].push('');
            }

            if (data.geohashprecision) {
                commandOption.ref.param['properties-geohash-precision'].push(data.geohashprecision);
            } else {
                commandOption.ref.param['properties-geohash-precision'].push('');
            }

            if (data.ignoreabove) {
                commandOption.ref.param['properties-ignore-above'].push(data.ignoreabove);
            } else {
                commandOption.ref.param['properties-ignore-above'].push('');
            }

            if (data.ignoremalformed) {
                commandOption.ref.param['properties-ignore-malformed'].push(data.ignoremalformed);
            } else {
                commandOption.ref.param['properties-ignore-malformed'].push('');
            }

            if (data.includeinall) {
                commandOption.ref.param['properties-include-in-all'].push(data.includeinall);
            } else {
                commandOption.ref.param['properties-include-in-all'].push('');
            }

            if (data.index) {
                commandOption.ref.param['properties-index'].push(data.index);
            } else {
                commandOption.ref.param['properties-index'].push('');
            }

            if (data.indexoptions) {
                commandOption.ref.param['properties-index-options'].push(data.indexoptions);
            } else {
                commandOption.ref.param['properties-index-options'].push('');
            }

            if (data.latlon) {
                commandOption.ref.param['properties-lat-lon'].push(data.latlon);
            } else {
                commandOption.ref.param['properties-lat-lon'].push('');
            }

            if (data.fields) {
                commandOption.ref.param['properties-fields'].push(data.fields);
            } else {
                commandOption.ref.param['properties-fields'].push('');
            }

            if (data.normsenabled) {
                commandOption.ref.param['properties-norms-enabled'].push(data.normsenabled);
            } else {
                commandOption.ref.param['properties-norms-enabled'].push('');
            }

            if (data.normsloading) {
                commandOption.ref.param['properties-norms-loading'].push(data.normsloading);
            } else {
                commandOption.ref.param['properties-norms-loading'].push('');
            }

            if (data.nullvalue) {
                commandOption.ref.param['properties-null-value'].push(data.nullvalue);
            } else {
                commandOption.ref.param['properties-null-value'].push('');
            }

            if (data.positionincrementgap) {
                commandOption.ref.param['properties-position-increment-gap'].push(data.positionincrementgap);
            } else {
                commandOption.ref.param['properties-position-increment-gap'].push('');
            }

            if (data.properties) {
                commandOption.ref.param['properties-properties'].push(data.properties);
            } else {
                commandOption.ref.param['properties-properties'].push('');
            }

            if (data.searchanalyzer) {
                commandOption.ref.param['properties-search-analyzer'].push(data.searchanalyzer);
            } else {
                commandOption.ref.param['properties-search-analyzer'].push('');
            }

            if (data.similarity) {
                commandOption.ref.param['properties-similarity'].push(data.similarity);
            } else {
                commandOption.ref.param['properties-similarity'].push('');
            }

            if (data.store) {
                commandOption.ref.param['properties-store'].push(data.store);
            } else {
                commandOption.ref.param['properties-store'].push('');
            }

            if (data.termvector) {
                commandOption.ref.param['properties-term-vector'].push(data.termvector);
            } else {
                commandOption.ref.param['properties-term-vector'].push('');
            }
        }

        var command = new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this, commandOption);

        _this.dialogResult = {
            OK: true,
            Cancel: false,
            command: command
        };
        _this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.SetPropertiesDialog = SetPropertiesDialog;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    var CONST = {};
    CONST.MSG_PANEL_EMPTY = 'Select configuration element in the tree to edit its settings';
    CONST.MSG_MENU_EMPTY = 'Nothing to show';

    const settingKeyList = Object.keys(Brightics.VA.Setting.Registry);

    function SettingDialog(parentId, options) {
        Brightics.VA.SettingStorage.TEMP = {};
        this.settingPanelList = [];
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    SettingDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    SettingDialog.prototype.constructor = SettingDialog;

    SettingDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 780;
        this.dialogOptions.height = 500;
    };

    SettingDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('setting');
        var $content = $('' +
            '<div class="brtc-va-dialogs-menu setting"/>' +
            '<div class="brtc-va-dialogs-content setting"/>'
        );
        $parent.append($content);

        this.createSplitter($parent);
        this.createMenuArea($parent.find('.brtc-va-dialogs-menu'));
        this.createContentArea($parent.find('.brtc-va-dialogs-content'));
    };

    SettingDialog.prototype.createSplitter = function ($parent) {
        $parent.jqxSplitter({
            width: null,
            height: null,
            resizable: false,
            splitBarSize: 3,
            panels: [{size: 200, min: 200}, {min: 300}]
        });
    };

    SettingDialog.prototype.createMenuArea = function ($parent) {
        var $menuContents = $('' +
            '<div class ="brtc-va-dialogs-menu-filter"/>' +
            '<div class ="brtc-va-dialogs-menu-tree"/>'
        );
        $parent.append($menuContents);
        this.createFilterControl($parent.find('.brtc-va-dialogs-menu-filter'));
        this.createTreeControl($parent.find('.brtc-va-dialogs-menu-tree'));

    };

    SettingDialog.prototype.createTreeControl = function ($treeContents) {
        var _this = this;
        var hasRegistry = this._generateJSONObject();

        if (hasRegistry && hasRegistry.length > 0) {
            hasRegistry[0].selected = true;
            $treeContents.removeClass('brtc-va-dialogs-center');
            this.settingMenu = $treeContents.jqxTree({
                theme: Brightics.VA.Env.Theme,
                width: 200,
                source: hasRegistry
            });
        } else {
            // $treeContents.jqxTree('clear');
            this.settingMenu = null;
            $treeContents.addClass('brtc-va-dialogs-center');
            $treeContents.jqxTree({
                theme: Brightics.VA.Env.Theme,
                source: [{
                    label: CONST.MSG_MENU_EMPTY,
                    disabled: true
                }]
            })
        }
    };

    SettingDialog.prototype.createFilterControl = function ($parent) {
        var _this = this;

        var $filterInput = $('<input type="search" class="brtc-va-views-palette-filter-input searchinput"/>');
        $parent.append($filterInput);

        $filterInput.jqxInput({
            height: 29,
            theme: Brightics.VA.Env.Theme,
            placeHolder: 'Search Item'
        });
        var applyFilter = function (event) {
            var filterValue = event.target.value.toLowerCase();

            _this.filterArray = _this.getMatchedList(filterValue.trim());
            _this.filterSelectItem = true;


            _this.createTreeControl(_this.$mainControl.find('.brtc-va-dialogs-menu-tree'));
            if (_this.settingMenu) {
                //initialize selected item in tree
                _this.settingMenu.jqxTree('selectItem', null);
            }
            _this.createContentArea(_this.$mainControl.find('.brtc-va-dialogs-content'));

            //TODO: update scrollbar
            // _this.$mainControl.find('. {class_name}').perfectScrollbar('update');
        };
        $filterInput.keyup(function (event) {
            applyFilter(event);
        });

        $filterInput.on('search', function (event) {
            applyFilter(event);
        });
    };

    SettingDialog.prototype.getMatchedList = function (searchStr) {
        var _this = this;
        if (searchStr && searchStr !== '') {
            return $.grep(settingKeyList, function (settingObjKey) {
                return Brightics.VA.Setting.Registry[settingObjKey].Label.toLowerCase().indexOf(searchStr.toLowerCase()) > -1
            });
        } else {
            return null;
        }
    };

    SettingDialog.prototype._generateJSONObject = function (parentKey) {
        var _this = this;

        var contentsHTML = [], labelExists = false;
        var currentKeyList = settingKeyList.filter(function (optionKey) {
            if (parentKey) {
                return optionKey.startsWith(parentKey + Brightics.VA.Setting.CONST.KEY_DELIMITER)
                    && !(optionKey.replace(parentKey + '.', '').includes('.')); //filter 1 depth child
            } else {
                return !optionKey.includes(Brightics.VA.Setting.CONST.KEY_DELIMITER);
            }
        });
        if (currentKeyList && currentKeyList.length > 0) {
            var tempObj = {};
            currentKeyList.forEach(function (settingObj) {
                var optionList = Brightics.VA.Setting.Registry;
                var settingLabel = optionList[settingObj].Label;
                var settingKey = optionList[settingObj].Key;

                if (settingLabel && settingKey) {
                    tempObj = {
                        id: settingKey,
                        label: settingLabel,
                        items: _this._generateJSONObject(settingKey)
                    };
                    if (_this.filterArray) {
                        if (($.inArray(settingKey, _this.filterArray) > -1) || tempObj.items.length > 0) {
                            if (_this.filterSelectItem) {
                                tempObj.selected = true;
                                _this.filterSelectItem = false;
                            }
                            tempObj.expanded = true;
                            contentsHTML.push(tempObj);
                        }
                    } else {
                        contentsHTML.push(tempObj);
                    }
                }
            });
        }
        return contentsHTML;
    };


    SettingDialog.prototype.createContentArea = function ($parent) {
        var $contentsWrapper = $('' +
            '<div class = "brtc-va-dialogs-content-info setting"></div>' +
            '<div class = "brtc-va-dialogs-content-panel setting"></div>'
        );

        var _emptyContentArea = function () {
            $parent.addClass('brtc-va-dialogs-center');
            $parent.text(CONST.MSG_PANEL_EMPTY);
            $contentsWrapper.remove();
        };
        var _appendContentArea = function () {
            $parent.removeClass('brtc-va-dialogs-center');
            $parent.text('');
            $parent.append($contentsWrapper);
        };

        if (this.settingMenu) {
            var _this = this;
            var item = _this.settingMenu.jqxTree('getSelectedItem');
            if (!item) {
                _emptyContentArea();
            } else {
                _appendContentArea();
                _this._attachSettingPanel($parent, item);
            }

            this.settingMenu.on('select', function (event) {
                if (_this.settingMenu) {
                    if ($parent.text().length > 0) {
                        _appendContentArea();
                    }
                    var args = event.args;
                    var item = _this.settingMenu.jqxTree('getItem', args.element);
                    _this._attachSettingPanel($parent, item);
                }
            });
        } else {
            _emptyContentArea();
        }
    };

    SettingDialog.prototype._attachSettingPanel = function ($parent, selectedItem) {
        var findSettingInstance = this._getTreeParent(selectedItem, Brightics.VA.Setting.Registry);
        $parent.find('.brtc-va-dialogs-content-info').text(findSettingInstance.label);

        var $contentsPanel = $parent.find('.brtc-va-dialogs-content-panel');
        $contentsPanel.empty();

        var settingPanel = new Brightics.VA.Setting.Registry[selectedItem.id]($contentsPanel);
        $contentsPanel.perfectScrollbar();
        this.settingPanelList.push(settingPanel);
    };

    SettingDialog.prototype._getTreeParent = function (item, ref) {
        var resultStr = {label: item.label, objStr: item.id};
        var _this = this;
        if (item.parentElement) {
            var parentObj = _this._getTreeParent(_this.settingMenu.jqxTree('getItem', item.parentElement));
            resultStr.label = parentObj.label + ' > ' + resultStr.label;
        }
        return resultStr;
    };

    SettingDialog.prototype.handleOkClicked = function () {
        for (var i in this.settingPanelList) {
            this.settingPanelList[i].save();
        }
        Studio.getPreference().preferenceChanged(Object.keys(Brightics.VA.SettingStorage.TEMP || {}));
        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);
    };

    SettingDialog.prototype.destroy = function () {
        this.$mainControl.find('.brtc-va-dialogs-menu-tree').jqxTree('destroy');
        this.$mainControl.dialog('destroy');
        this.$mainControl = undefined;
    };

    Brightics.VA.Core.Dialogs.SettingDialog = SettingDialog;

}).call(this);
/**
 * Created by sungjin1.kim on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var PREFIX = '${';
    var SUFFIX = '}';

    function SettingVariableDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true,
            command: new Brightics.VA.Core.CompoundCommand(this, {})
        };

        this.analyticsModel = this.options.fnUnit.parent();
        this.mainModel = this.analyticsModel.getMainModel();
        if (this.options.param.index > -1 && this.options.fnUnit.param.functions) {
            this.options.fnUnit = this.options.fnUnit.param.functions[this.options.param.index];
        }
        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    SettingVariableDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SettingVariableDialog.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-setting-variable-dialogs-main">' +
            // '   <div class="brtc-va-dialogs-header"></div>' +
            '   <div class="brtc-va-dialogs-body">' +
            '       <div class="brtc-va-dialogs-contents" style="display: initial">' +
            '       </div>' +
            '   </div>' +
            '</div>');

        this.$parent.append(this.$mainControl);

        this.$mainControl.dialog({
            theme: Brightics.VA.Env.Theme,
            modal: false,
            width: 200,
            resizable: false,
            showAnimationDuration: 50,
            position: {my: "left top", at: "right top", of: this.$mainControl.parent()},
            open: function () {
                _this.$mainControl.parent().find('.ui-dialog-titlebar.ui-widget-header').remove()
            },
            close: function () {
                $(window).off('mousedown', _this.closeHandler);
                $(window).off('resize', _this.closeHandler);

                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
            }
        });

        this.closeHandler = function (event) {
            if (_this.$mainControl.has(event.target).length === 0 && _this.$mainControl.dialog('isOpen')) {
                _this.$mainControl.dialog('close');
            }
        };

        $(window).on('mousedown', this.closeHandler);
        $(window).on('resize', this.closeHandler);
    };

    SettingVariableDialog.prototype.initContents = function () {
        this.createDialogContentsArea(this.$mainControl.find('.brtc-va-dialogs-contents'));
    };


    SettingVariableDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;
        this.$contents = $(
            '<div class="brtc-va-setting-variable-dialogs-contents">' +
            '   <div class="brtc-va-global-variable-set element-wrapper">' +
            '       <div class="element">Set as variable</div>' +
            '       <hr>' +
            '   </div>' +
            '   <div class="brtc-va-global-variable-list element-wrapper">' +
            '   </div>' +
            '   <div class="brtc-va-global-variable-unset element-wrapper">' +
            '       <hr>' +
            '       <div class="element">Unset variable</div>' +
            '   </div>' +
            '</div>');
        $parent.append(this.$contents);

        this.createGlobalVariableList();
        this.bindSetGlobalVariable();
        this.bindUnsetGlobalVariable();
    };

    SettingVariableDialog.prototype.createGlobalVariableList = function () {
        var _this = this;
        this.variableList = Object.keys(this.getModel().variables);
        var variable = this.getModel().getVariable(this.options.fnUnit.fid, this.options.param.key);
        if (variable) {
            this.$contents.find('.brtc-va-global-variable-set').hide();
        }
        else {
            this.$contents.find('.brtc-va-global-variable-unset').hide();
        }

        for (var index in this.variableList) {
            var $variableElement = $('<div class="element">Set to ' + this.variableList[index] + '</div>');
            $variableElement.attr('title', this.variableList[index]);
            $variableElement.attr('type', this.getModel().variables[this.variableList[index]]['variable-type']);
            this.$contents.find('.brtc-va-global-variable-list.element-wrapper').append($variableElement);
            $variableElement.data('variable', this.variableList[index]);
            if (variable === this.variableList[index]) {
                $variableElement.addClass('set');
            }

            $variableElement.click(function () {
                _this.dialogResult.OK = true;
                _this.dialogResult.command.add(new Brightics.VA.Core.Editors.Diagram.Commands.BindVariableCommand(_this, {
                    fid: _this.options.fnUnit.fid,
                    paramKey: _this.options.param.key,
                    variable: $(this).data('variable'),
                    subFnUnitIndex: _this.options.param.index
                }));
                _this.$mainControl.dialog('close');
            });
        }

        this.$contents.find('.brtc-va-global-variable-list').perfectScrollbar();
    };
    
    SettingVariableDialog.prototype.bindSetGlobalVariable = function () {
        var _this = this;
        this.$contents.find('.brtc-va-global-variable-set').click(function () {
            var variableName = _this.options.param.label.toLowerCase().replace(/ /gi, '_');            
            var isArray = (_this.options.param.type.toLowerCase().indexOf('array') > -1);

            var variable = {
                name: variableName,
                type: (isArray) ? ('array[string]') : ('string'),
                value: (isArray) ? (['']) : ('')
            };
            var command = new Brightics.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand(_this, {
                name: variable.name,
                ref: {
                    type: variable.type,
                    value: variable.value
                },
                variable: variable
            });

            var modelEditorRef = Brightics.VA.Core.Utils.WidgetUtils.getModelEditorRef(_this.$parent);
            modelEditorRef.getCommandManager().execute(command);

            _this.dialogResult.OK = true;
            _this.dialogResult.command.add(new Brightics.VA.Core.Editors.Diagram.Commands.BindVariableCommand(_this, {
                fid: _this.options.fnUnit.fid,
                paramKey: _this.options.param.key,
                variable: variable.name,
                subFnUnitIndex: _this.options.param.index
            }));
            _this.$mainControl.dialog('close');
        });
    };

    SettingVariableDialog.prototype.bindUnsetGlobalVariable = function () {
        var _this = this;
        var variable = this.getModel().getVariable(this.options.fnUnit.fid, this.options.param.key);
        this.$contents.find('.brtc-va-global-variable-unset').click(function () {
            _this.dialogResult.command.add(new Brightics.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(_this, {
                fid: _this.options.fnUnit.fid,
                paramKey: _this.options.param.key,
                variable: variable,
                subFnUnitIndex: _this.options.param.index
            }));
            if (typeof _this.options.remove == 'function') {
                _this.options.remove(_this.dialogResult);
            }
            _this.$mainControl.dialog('close');
        });
    };

    SettingVariableDialog.prototype.getModel = function () {
        return this.mainModel;
    };

    Brightics.VA.Core.Dialogs.SettingVariableDialog = SettingVariableDialog;

}).call(this);
/**
 * Created by daewon77.park on 2016-08-27.
 */

/* global crel, Studio */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var className = {
        dataSelectorWrapper: [
            'brtc-va-editors-sheet-controls-dataselector-contents-wrapper',
            'brtc-va-dialogs-setvariable-dataselector-wrapper'
        ].join(' '),
        dataSelectorItem: 'brtc-va-editors-sheet-controls-dataselector-item'
    };

    function SetValueSettingDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.FnUnitDialog.call(this, parentId, options);
    }

    SetValueSettingDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.FnUnitDialog.prototype);
    SetValueSettingDialog.prototype.constructor = SetValueSettingDialog;

    SetValueSettingDialog.prototype.getTitle = function () {
        return this.options.title;
    };

    SetValueSettingDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-style-minus-40">' +
            '    <div class="brtc-va-dialogs-body">' +
            '        <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px brtc-style-padding-right-20"></div>' +
            '        <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit brtc-style-display-flex"></div>' +
            '        <div class="brtc-va-dialogs-buttonbar brtc-style-padding-right-30"></div>' +
            '    </div>' +
            '</div>');

        this.$titleArea = this.$mainControl.find('.brtc-va-dialogs-title');
    };

    SetValueSettingDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<div class="brtc-va-dialogs-control-function-body brtc-style-height-full brtc-style-flex-1"></div>' +
            '');

        this.$headerArea = $parent.find('.brtc-va-dialogs-control-function-header');
        this.$bodyArea = $parent.find('.brtc-va-dialogs-control-function-body');

        this.createVariablesControl();
        
        this.$bodyArea.perfectScrollbar({suppressScrollX: true});
    };

    SetValueSettingDialog.prototype.createDataControl = function () {
        var _this = this;

        this.$dataArea.append(''+
            '<div class="brtc-va-dialogs-data-selector"></div>' +
            '<div class="brtc-va-dialogs-data-viewer"></div>'
        );

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            autoDropDownHeight: true,
            enableBrowserBoundsDetection: true,
            width: 'calc(100% - 2px)',
            source: this.createIndataSource(),
            displayMember: 'label',
            valueMember: 'value'
        };

        var $el = this.$dataArea.find('.brtc-va-dialogs-data-selector');
        var $dataSourceWrapper = this.createDataSelector();
        $el.append($dataSourceWrapper);
        $dataSourceWrapper.perfectScrollbar();
    };

    SetValueSettingDialog.prototype.createDataSelectorItem = function (label, tid, type) {
        var $item = $(crel('div', {class: className.dataSelectorItem}));
        var $paletteItem =
            Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, type, 'data');
        var $fnUnitLabel = $paletteItem.find('.brtc-va-views-palette-fnunit-label');
        $fnUnitLabel.text(label);
        $paletteItem.addClass('item');
        $paletteItem.attr('tid', tid);
        $item.addClass('brtc-va-editors-setvalue-indata-item');
        return $item;
    };

    SetValueSettingDialog.prototype.createDataSelectorSource = function () {
        var activeModel = Studio.getEditorContainer().getActiveModelEditor().getActiveModel();
        var source = this.options.fnUnit.inData.map(function (tid) {
            var fnUnit = activeModel.getFnUnitByOutTable(tid);
            return {
                label: fnUnit.display.label,
                tid: tid,
                type: fnUnit.func
            }
        });
        return source;
    };

    SetValueSettingDialog.prototype.createDataSelector = function () {
        var _this = this;
        var $dataList = $(crel('div', {class: className.dataSelectorWrapper}));
        var source = this.createDataSelectorSource();
        var $selectedItem = '';
        var select = function ($item, tid) {
            if ($selectedItem) {
                $selectedItem.removeClass('selected');
            }
            $selectedItem = $item;
            $selectedItem.addClass('selected');
            _this.renderData(tid);
        };
        var $items = source.map(function (src) {
            var $item = _this.createDataSelectorItem(src.label, src.tid, src.type);
            $item.click(function () {
                select($item, src.tid);
            });
            return $item;
        });
        $dataList.append($items);
        if ($items.length > 0) {
            select($items[0]);
        }
        return $dataList;
    };

    SetValueSettingDialog.prototype.renderData = function (tid) {
        var $inContainer = this.$dataArea.find('.brtc-va-dialogs-data-viewer');
        $inContainer.empty();

        var clonedFnUnit = $.extend(true, {}, this.options.fnUnit);

        //how can i set tableIndexes???
        this.changeTableInfo(clonedFnUnit, tid);

        var mid = Studio.getEditorContainer().getActiveModelEditor().getActiveModel().mid;

        var inDataProxy = new Brightics.VA.Core.Editors.Sheet.DataProxy($inContainer, mid);
        inDataProxy.reset();
        
        this.panelFactory = Studio.getEditorContainer().getActiveModelEditor().getPanelFactory();
        this.inPanel = this.panelFactory.createInDataPanel($inContainer, {
            width: '100%',
            height: '100%',
            modelEditor: Studio.getEditorContainer().getActiveModelEditor(),
            fnUnit: clonedFnUnit,
            resizable: true,
            dataProxy: inDataProxy
        });
    };

    SetValueSettingDialog.prototype.changeTableInfo = function (clonedFnUnit, tid) {
        clonedFnUnit.inData = [tid];
        if (clonedFnUnit.display.sheet.in.partial[0].panel.length > 0) {
            clonedFnUnit.display.sheet.in.partial[0].panel[0].tableIndexes = [0];
        }
    };

    SetValueSettingDialog.prototype.createIndataSource = function () {
        var activeModel = Studio.getEditorContainer().getActiveModelEditor().getActiveModel();
        var source = this.options.fnUnit.inData.map(function (tid) {
            var fnUnit = activeModel.getFnUnitByOutTable(tid);
            return {
                label: fnUnit.display.label,
                tid: tid,
                type: fnUnit.func
            }
        });
        return source;
    };

    SetValueSettingDialog.prototype.createVariablesControl = function () {
        var _this = this;

        this.variableControl = new Brightics.VA.Core.Views.SetVariable(this.$bodyArea, {
            width: '100%',
            height: '100%',
            fnUnit: this.options.fnUnit,
            editor: this.options.editor,
            onAdd: function (variable) {
                _this.onAdd(variable);
            },
            onRemove: function (variable) {
                _this.onRemove(variable);
            },
            onChange: function (oldVariable, newVariable) {
                _this.onChange(oldVariable, newVariable);
            },
        });

        this.variableControl.$mainControl.find('input')
            .addClass('brtc-style-minus-20')
            .addClass('brtc-style-padding-right-20');

        this.variableControl.$mainControl.find('.brtc-va-tools-sidebar-variable-list')
            .addClass('brtc-style-padding-right-20');

        // Variable is different from SetValue Function spec
        // so i did it as a temporary
        var clonedVariables = [];
        for (var i in this.options.fnUnit.param.variables) {
            var variable = this.options.fnUnit.param.variables[i];

            clonedVariables.push({
                type: variable.type,
                name: variable.name,
                value: (variable.type === 'cell')? variable.param : variable.param.value
            });
        }

        this.variableControl.renderValues(clonedVariables);
    };

    SetValueSettingDialog.prototype.onRemove = function (variable) {
        var targetName = variable.name;
        var variables = this.options.fnUnit.param.variables;
        var newVariables = [];

        for (var i in variables) {
            if (variables[i].name === targetName) continue;
            newVariables.push(variables[i]);
        }

        this.options.fnUnit.param['variables'] = newVariables;
    };

    SetValueSettingDialog.prototype.onChange = function (oldVariable, newVariable) {
        var oldName = oldVariable.name;
        var variables = this.options.fnUnit.param.variables;
        
        var changedVariables = [];

        this.updateMode(newVariable);

        for (var i in variables) {
            if (variables[i].name === oldName) {
                changedVariables.push(newVariable);
                continue;
            }
            changedVariables.push(variables[i]);
        }

        this.options.fnUnit.param['variables'] = changedVariables;
    };

    SetValueSettingDialog.prototype.onAdd = function (variable) {
        var cloneVariable = $.extend(true, {}, variable);
        var cloneVariables = $.extend(true, [], this.options.fnUnit.param.variables);

        this.updateMode(cloneVariable);

        cloneVariables.push(cloneVariable);

        this.options.fnUnit.param['variables'] = cloneVariables;
    };

    SetValueSettingDialog.prototype.refresh = function () {
        var $container = this.$mainControl.find('.brtc-va-dialogs-index-item-container');
        $container.empty();

        this.$mainControl.perfectScrollbar('update');
    };

    SetValueSettingDialog.prototype.handleOkClicked = function () {
        this.dialogResult = {
            OK: true,
            Cancel: false,
            results: {fnUnit: this.options.fnUnit}
        };
        this.$mainControl.dialog('close');
    };

    SetValueSettingDialog.prototype.handleCancelClicked = function () {
        this.dialogResult = {
            OK: false,
            Cancel: true
        };

        this.$mainControl.dialog('close');
    };

    SetValueSettingDialog.prototype.updateMode = function (variable) {
        if (variable.type === 'cell') {
            variable.mode = 'cell';
        } else {
            variable.mode = 'value';
        }
    };

    Brightics.VA.Core.Dialogs.SetValueSettingDialog = SetValueSettingDialog;

}).call(this);
/**
 * Created by SDS on 2016-08-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SqlEditorDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.ScriptEditorDialog.call(this, parentId, options);
    }

    SqlEditorDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.ScriptEditorDialog.prototype);

    SqlEditorDialog.prototype.createLayout = function () {
        this.$contentArea = this.$mainControl.find('.brtc-va-dialogs-contents');

        var scriptOnly = (this.options.scriptOnly)? this.options.scriptOnly : false;

        this.$editorArea = $('' +
            '<div class="brtc-va-dialogs-contents-statement sql" script-only="'+ scriptOnly +'">' +
            '   <textarea></textarea>' +
            '   <div class="brtc-va-dialogs-contents-statement-error">Up to ' + Brightics.VA.Core.Utils.CommonUtils.numberToStringWithComma(this.scriptEditorOptions.maxLength) + ' characters can be entered.</div>' +
            '</div>' +
            '');
        this.$errorArea = this.$editorArea.find('.brtc-va-dialogs-contents-statement-error');
        this.$infoArea = $('<div class="brtc-va-dialogs-contents-info sql" script-only="'+ scriptOnly +'">');
        this.$resultArea = $('<div class="brtc-va-dialogs-result sql">');
        this.$contentArea.append(this.$editorArea).append(this.$infoArea).append(this.$resultArea);
        this.$infoArea.perfectScrollbar();

        var _this = this;
        this.$mainControl.on('resized', function (event) {
            _this.$infoArea.perfectScrollbar('update');
        });
    };

    SqlEditorDialog.prototype.renderInfoArea = function ($parent, useTable) {
        this.renderTableAlias(this.$infoArea);
    };

    SqlEditorDialog.prototype.createInTableAlias = function ($parent) {
        var _this = this;
        var model = this.FnUnitUtils.getParent(this.options.fnUnit)

        var inTableList = this.FnUnitUtils.getInTable(this.options.fnUnit),
            inFunctionList = [];

        for (let i in inTableList) {
            inFunctionList.push(model.getFnUnitByOutTable(inTableList[i]));
        }
        this.tableAlias = [];
        //실제 in-table 목록만큼 그린다.
        for (let i in inFunctionList) {
            var fnUnit = inFunctionList[i];

            var label =   '#{DF(' + i + ')}';
            this.tableAlias.push('#{DF(' + i + ')}');

            var $aliasElement = $('' +
                '<div class="brtc-va-dialogs-scalaeditor-alias-element">' +
                '   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">'+label+'</div>' +
                '</div>');

            var clazz = fnUnit.parent().type;
            var $item = $('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item"></div>'),
                $selectedItem = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);

            $selectedItem.find('.brtc-va-views-palette-fnunit-label')
                .text(fnUnit.display.label)
                .attr('variable', label);

            $item.attr('value', this.FnUnitUtils.getOutTable(this.options.fnUnit));

            $selectedItem.addClass('item');
            $aliasElement.append($item);

            $parent.append($aliasElement);

            $aliasElement.find('.brtc-va-views-palette-fnunit').click(function(){
                var addedText = $(this).find('.brtc-va-views-palette-fnunit-label').attr('variable');

                _this.codeMirror.setValue(_this.codeMirror.getValue()+' '+addedText);

                _this.selectMarker = _this.codeMirror.markText({line: 0, ch: 0}, {line: 0, ch: 7}, {
                    readOnly: true,
                    inclusiveLeft: true,
                    atomic: true
                });
            });
        }
    }

    SqlEditorDialog.prototype._getInTableLabel = function (index) {
        return `#{DF(${index})}`;
    };

    SqlEditorDialog.prototype.renderTableAlias = function ($parent) {
        var $inTableAlias = $('<div class="brtc-va-dialogs-reditor-alias-in"></div>');
        $parent.append($inTableAlias);
        var $inTableAliasBody = this.addPropertyControl('In Table Variable', $inTableAlias);
        this.createInTableAlias($inTableAliasBody);
    };

    SqlEditorDialog.prototype.addPropertyControl = function (label, $parent) {
        var $controlHeader = $('<div class="brtc-va-dialogs-reditor-alias-header">' + label + '</div>');
        var $controlBody = $('<div class="brtc-va-dialogs-reditor-alias-body"></div>');
        $parent.append($controlHeader).append($controlBody);
        return $controlBody;
    };

    SqlEditorDialog.prototype.setEditorStatement = function (statement) {
        this.codeMirror.setValue(statement);
        this.codeMirror.clearHistory();
        this.selectMarker = this.codeMirror.markText({line: 0, ch: 0}, {line: 0, ch: 7}, {
            readOnly: true,
            inclusiveLeft: true,
            atomic: true
        });
    };

    SqlEditorDialog.prototype.renderEditorArea = function () {
        var _this = this;
        this.codeMirror = CodeMirror.fromTextArea(this.$editorArea.find('textarea')[0], {
            mode: this.scriptEditorOptions.mode,
            theme: "default",
            indentWithTabs: true,
            smartIndent: true,
            lineNumbers: true,
            matchBrackets: true,
            autofocus: false,
            extraKeys: {
                "Ctrl-Space": "autocomplete",
                "Ctrl-Enter": function () {
                    _this.tempFnUnit = $.extend(true, {}, _this.options.fnUnit);
                    if (_this.tempFnUnit.func === 'queryExecutorPython') {
                        _this.tempFnUnit.outputs.out_table = _this.FnUnitUtils.getOutputs(_this.options.fnUnit).out_table;
                        _this.tempFnUnit.param.query = _this.codeMirror.getValue();
                    } else {
                        _this.tempFnUnit.outData = _this.FnUnitUtils.getOutputs(_this.options.fnUnit);
                        _this.tempFnUnit.param['full-query'] = _this.codeMirror.getValue();
                        _this.tempFnUnit.param['alias-names'] = _this.tableAlias;
                    }

                    Studio.getJobExecutor().launchUnit(_this.tempFnUnit, {}, {}, {
                        'catch': function _catch(err) {
                            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                        },
                        'success': function _success(res) {
                            _this.refreshResult();
                        }
                    });
                }
            },
            hintOptions: {
                list: this.scriptEditorOptions.additionalHint
            }
        });

        // hint를 close하기 위해 Esc 누르는 경우, dialog가 같이 close되는 것 방지.
        Brightics.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror);

        Brightics.VA.Core.Utils.WidgetUtils.setCodeMirrorMaxLength(this.codeMirror);

        this.setEditorStatement(this.options.statement);

        this.codeMirror.setSize('100%', '100%');
        this.codeMirror.setOption('maxLength', this.scriptEditorOptions.maxLength);
    };

    SqlEditorDialog.prototype.renderResultArea = function () {
        var _this = this;
        var testResultPanel = $('' +
            '<div class="brtc-va-dialogs-result-sql"></div>' +
            '<div class="brtc-va-dialogs-sql-test-button-area brtc-s-style-dialogs-sql-test-button-area">' +
            '   <input type="button" class="brtc-va-dialogs-sql-test-button brtc-s-style-dialogs-sql-test-button" value="Run" />' +
            '</div>');
        testResultPanel.find('.brtc-va-dialogs-sql-test-button').click(function () {
            _this.handleTestClicked();
        });
        this.$contentArea.find('.brtc-va-dialogs-result').append(testResultPanel);
    };

    SqlEditorDialog.prototype.handleTestClicked = function () {
        var _this = this;
        _this.tempFnUnit = $.extend(true, {}, _this.options.fnUnit);
        if (_this.tempFnUnit.func === 'queryExecutorPython' || _this.tempFnUnit.func === 'queryExecutorPython2') {
            _this.tempFnUnit.outputs.out_table = _this.FnUnitUtils.getOutputs(_this.options.fnUnit).out_table;
            _this.tempFnUnit.param.query = _this.codeMirror.getValue();
        } else {
            _this.tempFnUnit.outData = _this.FnUnitUtils.getOutputs(_this.options.fnUnit);
            _this.tempFnUnit.param['full-query'] = _this.codeMirror.getValue();
            _this.tempFnUnit.param['alias-names'] = _this.tableAlias;
        }

        Studio.getJobExecutor().launchUnit(_this.tempFnUnit, {}, {}, {
            'catch': function _catch(err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
            },
            'success': function _success(res) {
                _this.refreshResult(res);
            }
        });
    };

    SqlEditorDialog.prototype.refreshResult = function () {
        //Show Result
        var _this = this;

        for (var i in this.$resultPanelContent) {
            this.$resultPanelContent[i].remove();
        }

        this.$resultPanelContent = {};
        this.$resultSheet = {};

        var outTable = this.FnUnitUtils.getOutputs(_this.tempFnUnit);
        if (_this.tempFnUnit.func === 'queryExecutorPython' || _this.tempFnUnit.func === 'queryExecutorPython2') {
            outTable = outTable.out_table;
        } else {
            outTable = outTable[0];
        }
        Brightics.VA.Core.DataQueryTemplate.queryData(this.options.fnUnit.parent().mid, outTable, 0, 1000, function (data, tableId) {
            _this.createResultPanelContent(outTable, data);
        }, function (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        }, false);
    };

    SqlEditorDialog.prototype.createResultPanelContent = function (tableId, data) {
        this.$resultPanelContent[tableId] = $('' +
            '<div class="brtc-va-dialogs-result-sql-panel-content">' +
            '</div>');

        this.$mainControl.find('.brtc-va-dialogs-result-sql').append(this.$resultPanelContent[tableId]);

        this.createResultContents(this.$resultPanelContent[tableId], tableId, data);
    };

    SqlEditorDialog.prototype.createResultContents = function ($parent, tableId, data) {

        this.$resultSheet[tableId] = $('' +
            '<div>' +
            '   <div class="brtc-va-dialogs-result-sql-panel-content-chart-area"></div>' +
            '</div>');
        $parent.append(this.$resultSheet[tableId]);
        this.createResultGrid(tableId, data);
    };

    SqlEditorDialog.prototype.createResultGrid = function (tableId, result) {
        var $spreadsheet = $('<div class="brtc-va-dialogs-result-sql-panel-spreadsheet"></div>');
        this.$resultSheet[tableId].find('.brtc-va-dialogs-result-sql-panel-content-chart-area').append($spreadsheet);

        var source = {
            localdata: result.data,
            datatype: 'array',
            datafields: $.map(result.columns, function (column, index) {
                return {
                    name: '__' + column.name,
                    type: column.type,
                    map: '' + index
                };
            })
        };

        var tableColumns = $.map(result.columns, function (column, index) {
            var col = {
                text: column.name,
                datafield: '__' + column.name,
                width: 80
            };
            if (column.type === 'date') {
                col.cellsformat = 'yyyy-MM-dd HH:mm:ss:fff';
            } else if (column.type === 'number') {
                col.cellsformat = 'd';
                col.cellsalign = 'right';
            } else if (column.type === 'string') {
                col.cellsrenderer = function (row, column, value) {
                    var styleText = 'overflow:hidden; text-overflow:ellipsis; padding-bottom:2px; margin-right: 2px; margin-left: 4px; margin-top: 4px;';

                    var cellValue = this.owner.source.records[row][column];

                    if (cellValue === undefined || cellValue === '' || cellValue === null) {
                        var _localdata = this.owner.source._source.localdata[row],
                            _datafields = this.owner.source._source.datafields,
                            _objIndex = 0;

                        for (var i in _datafields) {
                            if (_datafields[i].name === column) {
                                _objIndex = Number(_datafields[i].map);
                                break;
                            }
                        }

                        if (_localdata[_objIndex] === undefined) {
                            return '<div style="' + styleText + 'color: #ff3333">undefined</div>';
                        } else if (_localdata[_objIndex] === null) {
                            return '<div align="right" style="' + styleText + 'color: #ff3333">null</div>';
                        } else if (_localdata[_objIndex] === '') {
                            return '<div align="right" style="' + styleText + '"></div>';
                        }
                    } else {
                        return '<div style="' + styleText + '">' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(value) + '</div>';
                    }

                    return undefined;
                }
            }
            return col;
        });
        tableColumns.unshift({
            text: 'No', sortable: false, menu: false, editable: false, groupable: false, draggable: false,
            datafield: '', width: 40,
            columntype: 'number',
            renderer: function (value) {
                return '<div class="brtc-va-refine-spreadsheet-rownum-column">' + value + '</div>';
            },
            cellsformat: 'd', cellsalign: 'right',
            cellclassname: 'brtc-va-refine-spreadsheet-rownum-cell',
            cellsrenderer: function (row, column, value) {
                return '<div align="right" style="margin:4px;">' + (value + 1) + '</div>';
            }
        });

        var dataAdapter = new $.jqx.dataAdapter(source);
        $spreadsheet.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '200',
            rowsheight: 25,
            source: dataAdapter,
            altrows: false,
            filterable: false,
            sortable: false,
            columnsresize: true,
            selectionmode: 'multiplecellsextended',
            columns: tableColumns
        });

        $spreadsheet.on("columnclick", function (event) {
            if (event.args.column.text === "No") {
                $(this).jqxGrid('autoresizecolumns');
            }
        });
    }

    SqlEditorDialog.prototype.destroy = function () {
        Brightics.VA.Dialogs.Dialog.prototype.destroy.call(this);
    };

    SqlEditorDialog.prototype.getTitle = function () {
        return 'SQL';
    };

    Brightics.VA.Core.Dialogs.SqlEditorDialog = SqlEditorDialog;

}).call(this);
/**
 * Created by SDS on 2017-08-27.
 */
(function () {
        'use strict';

        var root = this;
        var Brightics = root.Brightics;

        function SubFunctionDialog(parentId, options) {
            this.parentId = parentId;
            this.options = options;
            this.dialogResult = {
                OK: false,
                Cancel: true,
                param: {}
            };

            this.retrieveParent();
            this.createControls();
            this.renderValue();
        }

        SubFunctionDialog.prototype.retrieveParent = function () {
            this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
        };

        SubFunctionDialog.prototype.createControls = function () {
            this.$mainControl = $('' +
                '<div class="brtc-va-dialogs-main">' +
                '   <div class="brtc-va-dialogs-body">' +
                '       <div class="brtc-va-dialogs-contents brtc-va-dialogs-subfunction-contents">' +
                '       </div>' +
                '       <div class="brtc-va-dialogs-buttonbar">' +
                '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
                '           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />' +
                '       </div>' +
                '   </div>' +
                '</div>');
            this.$parent.append(this.$mainControl);

            this.$okButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-ok');
            this.$cancelButton = this.$mainControl.find('.brtc-va-dialogs-buttonbar-cancel');

            var _this = this;
            var jqxOpt = {
                theme: Brightics.VA.Env.Theme,
                title: 'Auto Sub Function',
                width: '800',
                height: '800',
                maxWidth: '800',
                maxHeight: '800',
                modal: true,
                resizable: false,
                create: function () {
                    _this.createDialogContentsArea(_this.$mainControl.find('.brtc-va-dialogs-contents'));
                    _this.$okButton.jqxButton({
                        theme: Brightics.VA.Env.Theme
                    });
                    _this.$okButton.click(_this.handleOkClicked.bind(_this));

                    _this.$cancelButton.jqxButton({
                        theme: Brightics.VA.Env.Theme
                    });
                    _this.$cancelButton.click(_this.handleCancelClicked.bind(_this));
                },
                close: function () {
                    if (typeof _this.options.close == 'function') {
                        _this.options.close(_this.dialogResult);
                    }
                }
            };

            this.$mainControl.dialog(jqxOpt);
            $('.ui-dialog-titlebar-close', $(this).parent()).hide();

        };

        SubFunctionDialog.prototype.renderValue = function () {
            for (var i = 0; i < this.options.subFunction.length; i++) {
                var functionName = this.options.subFunction[i];
                this.controlsArray[functionName] = {};
                for (var j = 0; j < this.options.subFunctionParam[functionName].length; j++) {
                    var name = this.options.subFunctionParam[functionName][j].name;
                    var controlType = this.options.subFunctionParam[functionName][j].controltype;
                    var opt = this.options.subFunctionParam[functionName][j].opt;

                    if (controlType === 'dropdown') {
                        var paramValue = this.options.fnUnit.param[functionName][name];

                        this.controlsArray[functionName][name] = [];
                        this.$elements[functionName][name].empty();
                        this.createControlArrRow(true, functionName, name, opt);

                        if (typeof(paramValue) != 'undefined') {
                            for (var k = 0; k < paramValue.length; k++) {
                                if (k >= 1) {
                                    this.createControlArrRow(false, functionName, name, opt);
                                }
                                this.controlsArray[functionName][name][k].val(paramValue[k]);
                            }
                        }
                    } else {
                        var paramValue = '';
                        for (var k in this.options.fnUnit.param[functionName][name]) {
                            paramValue = paramValue + this.options.fnUnit.param[functionName][name][k] + ',';
                        }

                        this.$elements[functionName][name].val(paramValue.substring(0, paramValue.length - 1) || '');
                    }
                }
            }
        }

        SubFunctionDialog.prototype.handleOkClicked = function () {
            this.dialogResult.param = this.getSubFunctionProperty();
            this.dialogResult.OK = true;
            this.dialogResult.Cancel = false;
            this.$mainControl.dialog('close');
        };

        SubFunctionDialog.prototype.handleCancelClicked = function () {
            var _this = this;
            _this.dialogResult.OK = false;
            _this.dialogResult.Cancel = true;
            this.$mainControl.dialog('close');
        };

        SubFunctionDialog.prototype.getSubFunctionProperty = function () {
            var param = {};

            for (var i = 0; i < this.options.subFunction.length; i++) {
                var functionName = this.options.subFunction[i];
                param[functionName] = {};
                for (var j = 0; j < this.options.subFunctionParam[functionName].length; j++) {
                    var name = this.options.subFunctionParam[functionName][j].name;
                    var controlType = this.options.subFunctionParam[functionName][j].controltype;

                    if (controlType === 'dropdown') {
                        for (var k = 0; k < this.controlsArray[functionName][name].length; k++) {
                            if (this.controlsArray[functionName][name][k].val() != '') {
                                param[functionName][name] = [];
                                param[functionName][name].push(this.controlsArray[functionName][name][k].val());
                            }
                        }
                    } else {
                        if (this.$elements[functionName][name].val() != '') {
                            param[functionName][name] = [];
                            var paramArr = this.$elements[functionName][name].val().split(',');
                            for (var k in paramArr) {
                                param[functionName][name].push(paramArr[k].trim());
                            }
                        }
                    }
                }
            }

            return param;
        };

        SubFunctionDialog.prototype.createDialogContentsArea = function ($parent) {
            var _this = this;
            $parent.append('' +
                '<div class="brtc-va-dialogs-subfunction-toolbar-area">' +
                '</div>' +
                '<div class="brtc-va-dialogs-subfunction-properties-area">' +
                '</div>');

            var $toolBarArea = $parent.find('.brtc-va-dialogs-subfunction-toolbar-area');

            for (var i = 0; i < this.options.subFunction.length; i++) {
                var functionName = this.options.subFunction[i];
                $toolBarArea.append('<div class="brtc-va-dialogs-subfunction-toolitem" function-name="' + functionName + '">' + functionName + '</div>');

                $toolBarArea.find('.brtc-va-dialogs-subfunction-toolitem[function-name="' + functionName + '"]').on('click', function () {
                    $parent.find('.brtc-va-dialogs-area').css('display', 'none');
                    $parent.find('.brtc-va-dialogs-area[function-name="' + event.target.innerText + '"]').css('display', 'block');
                });
            }

            $parent.find('.brtc-va-dialogs-subfunction-toolitem').jqxButton({
                theme: Brightics.VA.Env.Theme
            });

            this.$elements = {};
            this.controls = {};
            this.controlsArray = {};

            this.$propertiesArea = $parent.find('.brtc-va-dialogs-subfunction-properties-area');

            for (var i = 0; i < this.options.subFunction.length; i++) {
                _this.createSubFunctionContentsArea(this.$propertiesArea, this.options.subFunction[i]);
            }
        };

        SubFunctionDialog.prototype.createSubFunctionContentsArea = function ($parent, functionName) {
            $parent.append('' +
                '<div class="brtc-va-dialogs-area" function-name="' + functionName + '"/>' +
                '');

            this.$contentsArea = $parent.find('.brtc-va-dialogs-area');
            this.$elements[functionName] = {};
            this.controls[functionName] = {};

            for (var i = 0; i < this.options.subFunctionParam[functionName].length; i++) {
                var label = this.options.subFunctionParam[functionName][i].label,
                    name = this.options.subFunctionParam[functionName][i].name,
                    placeholder = this.options.subFunctionParam[functionName][i].placeholder,
                    controlType = this.options.subFunctionParam[functionName][i].controltype;

                if (controlType === 'dropdown') {
                    this.createDropDownControl(this.$contentsArea, functionName, label, name, {'placeHolder': placeholder});
                } else {
                    this.createInputControl(this.$contentsArea, functionName, label, name, {'placeHolder': placeholder});
                }
            }
            this.$contentsArea.css('display', 'none');
        };

        SubFunctionDialog.prototype.createInputControl = function ($parent, functionName, label, param, opt) {
            var _this = this;
            _this.$elements[functionName][param] = $('<input type="text" class="brtc-va-dialogs-controls-propertycontrol-input"/>');
            _this.addPropertyControl(label, function ($container) {
                $container.append(_this.$elements[functionName][param]);
                _this.controls[functionName][param] = _this.createInput(_this.$elements[functionName][param], opt);
            });
        };

        SubFunctionDialog.prototype.addPropertyControl = function (label, callback) {
            var _this = this,
                $propertyControl = $('' +
                    '<div class="brtc-va-dialogs-controls-propertycontrol">' +
                    '   <div class="brtc-va-dialogs-controls-propertycontrol-label"></div>' +
                    '   <div class="brtc-va-dialogs-controls-propertycontrol-contents">' +
                    '</div>');

            this.$contentsArea.append($propertyControl);

            $propertyControl.jqxExpander(
                {
                    theme: Brightics.VA.Env.Theme,
                    arrowPosition: "left",
                    initContent: function () {
                        if (typeof  callback === 'function') {
                            callback.call(_this, $propertyControl.find(".brtc-va-dialogs-controls-propertycontrol-contents"));
                        }
                    }
                });
            $propertyControl.jqxExpander('setHeaderContent', label);

            return $propertyControl;
        };

        SubFunctionDialog.prototype.createInput = function ($control, jqxOptions) {
            var options = {
                theme: Brightics.VA.Env.Theme,
                height: '25px',
                placeHolder: 'Enter value'
            };
            if (jqxOptions) {
                $.extend(options, jqxOptions);
            }
            $control.jqxInput(options);

            return $control;
        };

        SubFunctionDialog.prototype.createControlArrRow = function (isFirst, functionName, name, opt) {
            var _this = this;
            var $byControlRow = $('<div class="brtc-va-dialogs-property-row-container brtc-va-dialog-property-row-content"></div>');
            var $byControlCombo = $('<div class="brtc-va-dialogs-controls-propertycontrol-combobox"/>');
            var $byControlAddButton = $('<div class="brtc-va-dialogs-property-row-content-add-button"></div>');
            var $byControlRemoveButton = $('<div class="brtc-va-dialogs-property-row-content-remove-button"></div>');
            $byControlRow.append($byControlCombo);
            if (isFirst) {
                $byControlRow.append($byControlAddButton);
            }
            else {
                $byControlRow.append($byControlRemoveButton);
            }


            this.controlsArray[functionName][name].push($byControlCombo);
            this.$elements[functionName][name].append($byControlRow);

            _this.controls[functionName][name] = _this.createDropDownList($byControlCombo, opt, '', {
                'width': '90%',
                'float': 'left'
            });

            $byControlRemoveButton.click(function () {
                var targetRow = $byControlRemoveButton.parents('.brtc-va-dialogs-property-row-content');
                var targetIndex = targetRow.prevAll().length;
                _this.controlsArray[functionName][name].splice(targetIndex, 1);
                targetRow.remove();
            });

            $byControlRemoveButton.hover(function () {
                $(this).css({color: '#86BFA0'});
            }, function () {
                $(this).css({color: ''});
            });

            $byControlAddButton.click(function () {
                _this.createControlArrRow(false, functionName, name, opt);
            });

            $byControlAddButton.hover(function () {
                $(this).css({color: '#429366'});
            }, function () {
                $(this).css({color: ''});
            });
        };

        SubFunctionDialog.prototype.createDropDownControl = function ($parent, functionName, label, param) {
            var _this = this;
            _this.$elements[functionName][param] = $('<div class="brtc-va-dialogs-controls-propertycontrol-combobox"/>');
            _this.addPropertyControl(label, function ($container) {
                $container.append(_this.$elements[functionName][param]);
            });
        };

        SubFunctionDialog.prototype.createDropDownList = function ($control, jqxOptions) {
            var options = {
                theme: Brightics.VA.Env.Theme,
                width: '100%',
                height: '25px'
            };
            if (jqxOptions) {
                $.extend(options, jqxOptions);
            }
            $control.jqxDropDownList(options);
            return $control;
        };

        Brightics.VA.Core.Dialogs.SubFunctionDialog = SubFunctionDialog;

    }
).call(this);
/**
 * Created by daewon77.park on 2016-03-24.
 */

/* global _ */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SwitchFnUnitDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true,
        };
        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    SwitchFnUnitDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SwitchFnUnitDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-selectfnunit">' +
            '   <div class="brtc-va-dialogs-body brtc-va-dialogs-selectfnunit">' +
            '       <div class="brtc-va-dialogs-contents brtc-va-dialogs-selectfnunit" />' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        var _this = this;
        var jqxOpt = {
            theme: Brightics.VA.Env.Theme,
            title: 'Select Function',
            width: 800,
            height: 700,
            modal: true,
            resizable: false,
            close: function () {
                if (typeof _this.options.close === 'function') {
                    _this.options.close(_.merge({ position: _this.options.position },
                        _this.dialogResult));
                }
                _this.$mainControl.dialog('destroy');
                _this.$mainControl.remove();
            },
        };
        this.$mainControl.dialog(jqxOpt);
        $('button.ui-dialog-titlebar-close', $(this).parent()).css('right', '1em');
    };

    SwitchFnUnitDialog.prototype.initContents = function () {
        this.createDialogContentsArea(this.$mainControl.find('.brtc-va-dialogs-contents'));
        this._removeTitleBottomBorder();
    };

    SwitchFnUnitDialog.prototype._removeTitleBottomBorder = function () {
        this.$mainControl.prev().css('border', 'initial');
    };

    SwitchFnUnitDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<ul>' +
            '     <li>Search Functions</li>' +
            '     <li>All Functions</li>' +
            '</ul>' +
            '<div class="brtc-va-dialogs-selectfnunit-tab-searchfunctions"></div>' +
            '<div class="brtc-va-dialogs-selectfnunit-tab-allfunctions brtc-style-border-box"></div>'
        );

        this.tabControl = Brightics.VA.Core.Widget.Factory.tabControl($parent);

        var $search = $parent.find('.brtc-va-dialogs-selectfnunit-tab-searchfunctions');
        var $all = $parent.find('.brtc-va-dialogs-selectfnunit-tab-allfunctions');

        var option = {
            url: 'api/va/v2/studio/palette/' + this.options.modelType,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            blocking: true,
        };

        const getPalette = new Promise((resolve) => {
            return Promise.resolve($.ajax(option))
                .then((data) => resolve(data))
                .catch(() => resolve([]));
        });

        getPalette.then((data) => {
            this.createRecommendArea($search, data);
            this.createKeywordArea($search, data);
            this.createSearchResultArea($search, data);
            this.createAllFunctionsArea($all, data);
            
            $all.perfectScrollbar();
            this.$mainControl.find('.brtc-va-dialogs-selectfnunit-keyword-input').jqxInput('focus');
        });
    };

    SwitchFnUnitDialog.prototype.createAllFunctionsArea = function ($parent, data) {
        var _this = this;
        this.palette = new Brightics.VA.Core.Views.Palette($parent, {
            width: '100%',
            height: '100%',
            draggable: false,
            modelType: _this.options.modelType,
        });

        $parent.find('.brtc-va-views-palette-filter-input').hide();
        $parent.find('.brtc-va-views-palette-navigator').bind('DOMNodeInserted', function (event) {
            if ($(event.target).hasClass('brtc-va-views-palette-fnunit-list')) {
                $(event.target).find('.brtc-va-views-palette-fnunit').click(function (event) {
                    const $el = $(this); // eslint-disable-line no-invalid-this
                    var func = Brightics.VA.Core.Utils.WidgetUtils.getData($el, 'func');
                    _this.dialogResult = {
                        OK: true,
                        Cancel: false,
                        func: func,
                    };
                    _this.$mainControl.dialog('close');
                });
            }
        });

        var $palette = $parent.find('.brtc-va-views-palette');
        $palette.css('height', '100%');

        var $navigatorWrapper = $parent.find('.brtc-va-views-palette-navigator-wrapper');
        $navigatorWrapper.css({
            'height': 'calc(100% - 40px)',
            'position': 'relative',
        }).perfectScrollbar();
    };

    SwitchFnUnitDialog.prototype.createRecommendArea = function ($parent, data) {
        var _this = this;
        var $recommendArea = $('' +
                '<div class="brtc-va-dialogs-selectfnunit-recommend">' +
                '   <div class="sub-title">Recommendations&nbsp<Strong id="count">0</Strong></div>' +
                '   <div class="brtc-va-dialogs-selectfnunit-recommend-list"></div>' +
                '</div>');
        $parent.append($recommendArea);

        var $contents = $recommendArea.find('.brtc-va-dialogs-selectfnunit-recommend-list');

        const findItem = (d, f) => {
            for (let { functions } of d) {
                for (let fn of functions) {
                    if (fn.func === f) return fn.visible;
                }
            }
            return false;
        };

        $contents.append($('<div style="height: 65px; text-align: center; display: block; padding-top: 10px"><span>Recommend item does not exist.</span></div>'));
        if (this.options.preFnUnit) {
            $contents.empty();
            let list = Brightics.VA.Env.Recommend.Next.getList(this.options.preFnUnit.func,
                this.options.modelType);
            $.each(list, function (index, func) {
                if (func === 'load') return;
                else if (findItem(data, func)) {
                    _this.createItem($contents, func);
                }
            });
        } else {
            $contents.empty();
            let list = Brightics.VA.Env.Recommend.Next[this.options.modelType].default;
            $.each(list, function (index, func) {
                if (findItem(data, func)) _this.createItem($contents, func);
            });
        }

        var $count = $recommendArea.find('#count');
        var count = $contents.find('.brtc-va-dialogs-selectfnunit-item').length;
        $count.text(count);

        $contents.perfectScrollbar();
    };

    SwitchFnUnitDialog.prototype.createKeywordArea = function ($parent, data) {
        var _this = this;
        var $keywordArea = $('' +
                '<div class="brtc-va-dialogs-selectfnunit-keyword">' +
                '   <div class="sub-title">Search functions by the following keywords: </div>' +
                '   <div class="brtc-va-dialogs-selectfnunit-keyword-list"></div>' +
                '</div>');
        $parent.append($keywordArea);

        var $tagList = $keywordArea.find('.brtc-va-dialogs-selectfnunit-keyword-list');
        for (var key in Brightics.VA.Env.Tags[_this.options.modelType]) {
            var tag = Brightics.VA.Env.Tags[_this.options.modelType][key];
            if (tag !== 'Prescriptive') {
                var $tag = $('<div class="brtc-va-dialogs-selectfnunit-keyword-item">' + tag + '</div>');
                $tag.css('cursor', 'pointer');
                $tagList.append($tag);
            }
        }
        $tagList.find('.brtc-va-dialogs-selectfnunit-keyword-item').click(function (event) {
            const $el = $(this); // eslint-disable-line no-invalid-this
            if ($el.hasClass('selected')) $el.removeClass('selected');
            else $el.addClass('selected');

            _this.refreshResult();
        });

        $keywordArea.find('.brtc-va-dialogs-selectfnunit-keyword-list').slimscroll({
            height: 'calc(100% - 5px)',
        });
    };

    SwitchFnUnitDialog.prototype.createSearchResultArea = function ($parent, data) {
        var _this = this;
        var $searchResultArea = $('' +
                '<div class="brtc-va-dialogs-selectfnunit-searchresult">' +
                '   <div class="sub-title">' +
                '       <span>Any other keywords?</span>' +
                '       <input type="search" class="brtc-va-dialogs-selectfnunit-keyword-input" />' +
                '   </div>' +
                '   <div class="sub-title">Result&nbsp;<strong id="count">0</strong></div>' +
                '   <div class="brtc-va-dialogs-selectfnunit-searchresult-list"></div>' +
                '</div>');
        $parent.append($searchResultArea);
        var $result = $searchResultArea.find('.brtc-va-dialogs-selectfnunit-searchresult-list');
        const modelTypeMap = {
            data: 'DataFlow',
            deeplearning: 'DeepLearning',
            script: 'Script',
            control: 'ControlFlow',
        };

        const modelType = modelTypeMap[_this.options.modelType];

        var functions = Brightics.VA.Implementation[modelType].Functions;

        if (modelType !== 'Script') {
            for (let fn of Object.values(functions)) {
                if (!fn.defaultFnUnit) continue;

                var func = fn.defaultFnUnit.func;
                var category = fn.category;

                if (category === 'bigdata') continue;

                var exist = false;
                var obj = { func: func, visible: true };

                for (var c in data) {
                    if (data[c].key === category) {
                        for (var k in data[c].functions) {
                            var fnUnit = data[c].functions[k];
                            if (fnUnit.func === func) {
                                exist = true;
                                break;
                            }
                        }
                        if (!exist) data[c].functions.push(obj);
                    }
                }
            }
        }

        $.each(data, function (index, funcGroup) {
            $.each(funcGroup.functions, function (index, funcItem) {
                if (_this.options.preFnUnit && funcItem.func === 'load') return;
                else if (funcItem.visible) {
                    var _$item = _this.createItem($result, funcItem.func);
                    if (_$item) _$item.hide();
                }
            });
        });
        if (_this.options.modelType === Brightics.VA.Implementation.DataFlow.Clazz) {
            var udfOpt = {
                url: 'api/va/v3/ws/udfs',
                type: 'GET',
                blocking: false,
                contentType: 'application/json; charset=utf-8',
            };
            $.ajax(udfOpt).done(function (udfItems) {
                if (udfItems.length > 0) {
                    var udfPalette = {
                        label: 'UDF',
                        visible: true,
                        functions: [],
                    };
                    for (var i in udfItems) {
                        if (Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(_this.options.modelType, udfItems[i].udf_id).category === 'udf') {
                            udfPalette.functions.push({
                                func: udfItems[i].udf_id,
                                visible: true,
                            });
                        }
                    }
                    if (udfPalette.functions.length > 0) {
                        $.each(udfPalette.functions, function (index, funcItem) {
                            if (funcItem.visible) {
                                var _$item = _this.createItem($result, funcItem.func);
                                if (_$item) _$item.hide();
                            }
                        });
                    }
                }
            });
        }


        var $inputControl = $searchResultArea.find('.brtc-va-dialogs-selectfnunit-keyword-input');
        $inputControl.jqxInput({
            height: 29,
            width: 300,
            theme: Brightics.VA.Env.Theme,
            placeHolder: 'Search Item',
        });

        $inputControl.on('keyup search', function (event) {
            _this.refreshResult();
        });
        $result.perfectScrollbar();
    };

    SwitchFnUnitDialog.prototype.refreshResult = function () {
        var $result = this.$mainControl.find('.brtc-va-dialogs-selectfnunit-searchresult-list');
        var $inputControl = this.$mainControl.find('.brtc-va-dialogs-selectfnunit-keyword-input');
        var filterValue = $inputControl.jqxInput('val').toLowerCase();

        var selectedTags = $.map(this.$mainControl.find('.brtc-va-dialogs-selectfnunit-keyword-item.selected'), function (tag) {
            return $(tag).text();
        });

        if (filterValue) selectedTags.push(filterValue.trim());
        var items = $result.find('.brtc-va-dialogs-selectfnunit-item');

        var count = 0;
        $result.scrollTop(0);
        if (selectedTags.length > 0) {
            var list;

            if (this.options.modelType === 'deeplearning') {
                list = Brightics.VA.Implementation.DeepLearning
                    .Functions.Library.getListByTags(selectedTags);
            } else {
                list = Brightics.VA.Core.Functions.Library.getListByTags(selectedTags);
            }

            $.each(items, function (index, item) {
                var func = Brightics.VA.Core.Utils.WidgetUtils.getData($(item).find('.brtc-va-views-palette-fnunit'), 'func');
                var matched = $.inArray(func, list) > -1;
                if (matched) {
                    $(item).show();
                    count++;
                } else {
                    $(item).hide();
                }
            });
        } else {
            $.each(items, function (index, item) {
                $(item).hide();
            });
        }

        this.$mainControl.find('.brtc-va-dialogs-selectfnunit-searchresult #count').text(count);
        $result.perfectScrollbar('update');
    };


    SwitchFnUnitDialog.prototype.createItem = function ($parent, func) {
        var _this = this;
        var $item = $('<div class="brtc-va-dialogs-selectfnunit-item"></div>');
        var clazz = this.options.modelType;

        var $fnUnit = Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, func, clazz);
        var $description;
        try {
            var fnUnitDef = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, func);
            if (fnUnitDef.defaultFnUnit.func === 'unknownFunction') return;

            var description = fnUnitDef.description;
            $description = $('<div class="brtc-va-dialogs-selectfnunit-item-description">' +
                '<span></span>' +
                '</div>');
            $description.find('span').attr('title', description).text(description);
            $item.append($description);

            $fnUnit.click(function (event) {
                const $el = $(this); // eslint-disable-line no-invalid-this
                var func = Brightics.VA.Core.Utils.WidgetUtils.getData($el, 'func');
                _this.dialogResult = {
                    OK: true,
                    Cancel: false,
                    func: func,
                };
                _this.$mainControl.dialog('close');
            });
            $parent.append($item);
            return $item;
        } catch (e) {
            console.error(e);
        }
    };

    Brightics.VA.Core.Dialogs.SwitchFnUnitDialog = SwitchFnUnitDialog;
}).call(this); // eslint-disable-line no-invalid-this

/**
 * Created by daewon77.park on 2016-03-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function SwitchUnitDialog(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.retrieveParent();
        this.createControls();
        this.initContents();
    }

    SwitchUnitDialog.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SwitchUnitDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-va-dialogs-selectfnunit">' +
            '   <div class="brtc-va-dialogs-body brtc-va-dialogs-selectfnunit">' +
            '       <div class="brtc-va-dialogs-contents brtc-va-dialogs-selectfnunit" />' +
            '   </div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        var _this = this,
            jqxOpt = {
                theme: Brightics.VA.Env.Theme,
                title: 'Insert Unit',
                width: 780,
                height: 700,
                modal: true,
                resizable: false,
                close: function () {
                    if (typeof _this.options.close == 'function') {
                        _this.options.close(_this.dialogResult);
                    }
                    _this.$mainControl.dialog('destroy');
                    _this.$mainControl.remove();
                }
            };

        this.$mainControl.dialog(jqxOpt);
        this.$mainControl.parent().find('.brtc-va-dialogs-selectfnunit-tab-allfunctions').css('padding-left', '14px');
    };

    SwitchUnitDialog.prototype.initContents = function () {
        this.createDialogContentsArea(this.$mainControl.find('.brtc-va-dialogs-contents'));

        this._removeTitleBottomBorder();
    };

    SwitchUnitDialog.prototype._removeTitleBottomBorder = function () {
        this.$mainControl.prev().css('border', 'initial');
    };


    SwitchUnitDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.append('' +
            '<ul>' +
            '     <li>All Units</li>' +
            '</ul>' +
            '<div class="brtc-va-dialogs-selectfnunit-tab-allfunctions brtc-style-border-box"></div>'
        );

        $parent.jqxTabs({
            theme: Brightics.VA.Env.Theme,
            width: this.options.width || '100%',
            position: 'top',
            scrollable: false
        });

        var $all = $parent.find('.brtc-va-dialogs-selectfnunit-tab-allfunctions');
        this.createAllFunctionsArea($all);
        $all.perfectScrollbar();
        $parent.jqxTabs('focus');
        $parent.find('.jqx-tabs-titleContentWrapper').css('margin-top', '4.5px');
    };

    SwitchUnitDialog.prototype.createAllFunctionsArea = function ($parent) {
        var _this = this;

        var dataFlowGroup = {
            'label': 'DataFlow',
            'visible': true,
            'functions': []
        };

        for (var i in _this.options.dataFlowList) {
            dataFlowGroup.functions.push({
                'func': {
                    func: 'dataFlow',
                    category: 'DataFlow',
                    label: _this.options.dataFlowList[i].getLabel(),
                    mid: _this.options.dataFlowList[i].getFileId()
                },
                'label': _this.options.dataFlowList[i].getLabel(),
                'visible': true
            });
        }

        this.palette = new Brightics.VA.Core.Views.Palette($parent, {
            width: '100%',
            height: '100%',
            draggable: false,
            modelType: _this.options.modelType,
            additionalGroup: dataFlowGroup
        });

        $parent.find('.brtc-va-views-palette-filter-input').hide();
        $parent.find('.brtc-va-views-palette-navigator').bind('DOMNodeInserted', function (event) {
            if ($(event.target).hasClass('brtc-va-views-palette-fnunit-list')) {
                $(event.target).find('.brtc-va-views-palette-fnunit').click(function (event) {
                    var func = Brightics.VA.Core.Utils.WidgetUtils.getData($(this), 'func');
                    var unit = {};
                    if (func && func.category && func.category == 'DataFlow') {
                        unit.func = func.func;
                        unit.mid = func.mid;
                    } else {
                        unit.func = func;
                    }
                    _this.dialogResult = {
                        OK: true,
                        Cancel: false,
                        unit: unit
                    };
                    _this.$mainControl.dialog('close');
                })
            }
        });
    };

    Brightics.VA.Core.Dialogs.SwitchUnitDialog = SwitchUnitDialog;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function TestUDFParamDialog(parentId, options) {
        Brightics.VA.Dialogs.Dialog.call(this, parentId, options);
    }

    TestUDFParamDialog.prototype = Object.create(Brightics.VA.Dialogs.Dialog.prototype);
    TestUDFParamDialog.prototype.constructor = TestUDFParamDialog;

    TestUDFParamDialog.prototype._initOptions = function () {
        Brightics.VA.Dialogs.Dialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 500;
        this.dialogOptions.height = 500;
    };

    TestUDFParamDialog.prototype.createDialogContentsArea = function ($parent) {
        $parent.addClass('brtc-va-dialogs-test-udf-param-contents');

        $parent.append('<div class="brtc-va-dialogs-test-udf-param"></div>');


        this.createInputTableControl($parent.find('.brtc-va-dialogs-test-udf-param'));
        this.createInputVariablesControl($parent.find('.brtc-va-dialogs-test-udf-param'));

        $parent.perfectScrollbar();
        $parent.perfectScrollbar('update');
    };
    TestUDFParamDialog.prototype.createInputTableControl = function ($parent) {
        var _this = this;

        if (_this.options.inputDataCnt === 0) {
            return;
        }
        var $inputTableContainer = $('' +
            '<div class="brtc-va-dialogs-test-udf-param-input-tables-container">' +
            '    <div class="header">' +
            '        <span>Input Data</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '    </div>' +
            '</div>');

        this.inputFsPaths = [];
        var $dropDownListControl = {};
        for (var i = 0; i < _this.options.inputDataCnt; i++) {
            //create Input Data Control

            var $inputDataControl = $('' +
                '<div class="brtc-va-dialogs-test-udf-param-row-flex-layout" style="display: flex">' +
                '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold" style="width: 30%;">inputs(' + i + ')</div>' +
                '</div>');
            $dropDownListControl[i] = $('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-dropDownList" style="width: 70%;"/>');
            _this.createInput($dropDownListControl[i]);
            $dropDownListControl[i].prop('readonly', true);
            $inputDataControl.append($dropDownListControl[i]);
            $dropDownListControl[i].click(function () {
                var _that = this;
                var browser = new Brightics.VA.Core.Dialogs.RepositoryBrowserDialog(_this.$mainControl, {
                    filePath: $(_that).val(),
                    close: function (dialogResult) {
                        if (dialogResult.OK && dialogResult.selectedFile) {
                            _this.renderInput($(_that), [dialogResult.selectedFile]);
                        }
                    },
                    resizable: true,
                    title: 'Browse Repository'
                });
                browser.$settingOptionGroup.attr('setting', 'false');
            });
            this.inputFsPaths.push({index: i, control: $dropDownListControl[i], value: ''});

            $inputTableContainer.find('.contents').append($inputDataControl);
            $parent.append($inputTableContainer);
        }
    };

    TestUDFParamDialog.prototype.renderInput = function (control, val) {
        var currentVal = val[0] || '';
        control.val(currentVal);
        control.attr('title', currentVal);
        this.renderInputSchema(currentVal);
    };

    TestUDFParamDialog.prototype.createInputVariablesControl = function ($parent) {
        var _this = this;

        if (_this.options.inputVariable.length === 0) {
            return;
        }
        var $InputVariablesContainer = $('' +
            '<div class="brtc-va-dialogs-test-udf-param-input-variables-container">' +
            '    <div class="header">' +
            '        <span>Input Variable</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '    </div>' +
            '</div>');
        this.inputVariables = [];
        for (var i in _this.options.inputVariable) {
            //create Input Variable Control

            var $inputVariableControl = $('' +
                '<div class="brtc-va-dialogs-row-flex-layout">' +
                '   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold" style="width: 30%;">' + _this.options.inputVariable[i].param_name + '</div>' +
                '</div>');

            $parent.append($InputVariablesContainer);
            var $inputParamValueControl = '';

            if (_this.options.inputVariable[i].arg_type === 'int' || _this.options.inputVariable[i].arg_type === 'double' || _this.options.inputVariable[i].arg_type === 'long') {
                $inputParamValueControl = $('<div class="brtc-va-dialog-test-udf-param-input-param-value" style="width:70%;"/>');

                var widgetOptions = {
                    numberType: _this.options.inputVariable[i].arg_type, //int, double
                    placeholder: 'Enter value'
                };
                var numericInput = _this.createNumberInput($inputParamValueControl, widgetOptions, '', {width: '70%'});

                $inputVariableControl.append($inputParamValueControl);
                $InputVariablesContainer.find('.contents').append($inputVariableControl);

                this.inputVariables.push({
                    paramName: _this.options.inputVariable[i].param_name,
                    paramType: _this.options.inputVariable[i].arg_type,
                    control: numericInput,
                    value: ''
                });

            } else if (_this.options.inputVariable[i].arg_type === 'string') {
                $inputParamValueControl = $('<input type="text" class="brtc-va-dialog-test-udf-param-input-param-value"/>');
                var widgetOptions = {
                    placeHolder: 'Enter value',
                    width: '70%'
                };
                _this.createInput($inputParamValueControl, widgetOptions, '', {width: '70%'});

                $inputVariableControl.append($inputParamValueControl);
                $InputVariablesContainer.find('.contents').append($inputVariableControl);

                this.inputVariables.push({
                    paramName: _this.options.inputVariable[i].param_name,
                    paramType: _this.options.inputVariable[i].arg_type,
                    control: $inputParamValueControl,
                    value: ''
                });

            } else {
                $inputParamValueControl = $('<textarea class="brtc-va-dialog-test-udf-param-input-param-value"></textarea>');
                $inputVariableControl.append($inputParamValueControl);
                $InputVariablesContainer.find('.contents').append($inputVariableControl);
                var verifier = new Brightics.VA.Core.Verifier.SqlVerifier();
                var opt = {placeholder: 'Enter value. \n Ex)Array(\"a\", \"b\") \n Map(\"a\"->\"b\")'};
                opt.hintOptions = {list: []};
                opt.verifier = verifier;
                var codeMirrorControl = _this.createTextAreaControl($inputParamValueControl, opt, '', {width: "70%"});
                $inputParamValueControl.data('codeMirror', codeMirrorControl);
                codeMirrorControl.codeMirror.setSize('100%', '50px');


                this.inputVariables.push({
                    paramName: _this.options.inputVariable[i].param_name,
                    paramType: _this.options.inputVariable[i].arg_type,
                    control: codeMirrorControl,
                    value: ''
                })
            }
        }
        this.updateCodeMirrorHint();
    };

    TestUDFParamDialog.prototype.updateCodeMirrorHint = function () {
        this.hintList = [];
        this.hintList = $.extend(true, this.hintList, CodeMirror.hintWords['text/x-scala']);

        for (var i in this.columnList) {
            for (var j in this.columnList[i]) {
                this.hintList.push(this.columnList[i][j].name);
            }
        }
        for (var i in this.inputVariables) {
            if (this.inputVariables[i].paramType === 'expression') {
                this.inputVariables[i].control.codeMirror.options.hintOptions.list = this.hintList;
            }
        }
    };

    TestUDFParamDialog.prototype.handleOkClicked = function () {
        var _this = this;

        _this.dialogResult.inputTables = this.getInputTables();
        _this.dialogResult.inputVariables = this.getInputParams();
        Brightics.VA.Dialogs.Dialog.prototype.handleOkClicked.call(_this);

    };

    TestUDFParamDialog.prototype.getInputTables = function () {
        for (var i in this.inputFsPaths) {
            this.inputFsPaths[i].value = this.inputFsPaths[i].control.val();
        }
        return this.inputFsPaths;
    };

    TestUDFParamDialog.prototype.getInputParams = function () {
        for (var i in this.inputVariables) {
            if (this.inputVariables[i].paramType === 'int' || this.inputVariables[i].paramType === 'double' || this.inputVariables[i].paramType === 'long') {
                this.inputVariables[i].value = this.inputVariables[i].control.getValue();
            } else if (this.inputVariables[i].paramType === 'string') {
                this.inputVariables[i].value = this.inputVariables[i].control.val();
            } else {
                this.inputVariables[i].value = this.inputVariables[i].control.getValue();
            }
        }
        return this.inputVariables;
    };

    TestUDFParamDialog.prototype.createDialogButtonBar = function ($parent) {
        Brightics.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this, $parent);
        this.$okButton.val('RUN');
        this.$cancelButton.css({display: 'none'});
    };

    TestUDFParamDialog.prototype.wrapControl = function ($control) {
        var $wrapper = $('<div class="brtc-va-dialog-test-udf-param-controls-wrapper"></div>');
        $control.wrap($wrapper);
    };
    TestUDFParamDialog.prototype.addClassToWrapper = function ($control, className) {
        if (className) {
            var $wrapper = $control.parent('.brtc-va-dialog-test-udf-param-controls-wrapper');
            if ($wrapper) $wrapper.addClass(className);
        }
    };

    TestUDFParamDialog.prototype.addCssToWrapper = function ($control, cssOptions) {
        if (cssOptions) {
            var $wrapper = $control.parent('.brtc-va-dialog-test-udf-param-controls-wrapper');
            if ($wrapper) $wrapper.css(cssOptions);
        }
    };

    TestUDFParamDialog.prototype.createInput = function ($control, jqxOptions, className, additionalCss) {
        this.wrapControl($control);

        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }

        if (!$control.attr('type')) $control.attr('type', 'text');
        if (!$control.attr('maxlength')) $control.attr('maxlength', '100');

        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxInput(options);
        var preValue = $control.val();
        $control.focus(function () {
            preValue = $control.val();
        });
        $('svg').on('mousedown', function () {
            var value = $control.val();
            if (value !== preValue && $control.is(":focus")) {
                $control.trigger("change");
            }
        });
        return $control;
    };

    TestUDFParamDialog.prototype.createNumberInput = function ($control, widgetOptions, className, additionalCss) {
        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);

        return new Brightics.VA.Core.Editors.Sheet.Controls.NumericInput($control, widgetOptions);
    };


    TestUDFParamDialog.prototype.createTextAreaControl = function ($control, controlOptions, className, additionalCss) {

        this.wrapControl($control);
        var additionalClass = '';
        if (className) {
            additionalClass = additionalClass.concat(' ', className);
        }
        this.addClassToWrapper($control, additionalClass);
        this.addCssToWrapper($control, additionalCss);
        $control.addClass(additionalClass);
        if (additionalCss) $control.css(additionalCss);

        return new Brightics.VA.Core.Editors.Sheet.Controls.TextAreaControl($control, controlOptions);
    };

    TestUDFParamDialog.prototype.renderInputSchema = function (filePath) {
        this.columnList = {};
        var _this = this;
        Brightics.VA.RepositoryQueryTemplate.schema(filePath).done(function (columns) {
            _this.columnList[filePath] = columns.columns;
            $.each(_this.columnList[filePath], function (index, column) {
                typeof column['type'] === 'undefined' ? column['type'] = column['internalType'] : column['type'] = column['type'];

            });

            _this.updateCodeMirrorHint();
        }).fail(function (err) {

        });
    };

    Brightics.VA.Core.Dialogs.TestUDFParamDialog = TestUDFParamDialog;

}).call(this);
/**
 * Created by SDS on 2018-03-15.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var PARAM_TARGET = 'target';
    var PARAM_PATH = 'path';
    var PARAM_LINKED = 'linked'

    function UnloadModelSettingDialog(parentId, options) {
        Brightics.VA.Core.Dialogs.FnUnitDialog.call(this, parentId, options);
    }

    UnloadModelSettingDialog.prototype = Object.create(Brightics.VA.Core.Dialogs.FnUnitDialog.prototype);
    UnloadModelSettingDialog.prototype.constructor = UnloadModelSettingDialog;

    UnloadModelSettingDialog.prototype._initOptions = function () {
        Brightics.VA.Core.Dialogs.FnUnitDialog.prototype._initOptions.call(this);

        this.dialogOptions.width = 450;
        this.dialogOptions.height = 600;
    };

    UnloadModelSettingDialog.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-dialogs-main brtc-style-minus-40">' +
            '    <div class="brtc-va-dialogs-body">' +
            '        <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px brtc-style-padding-right-20"></div>' +
            '        <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit brtc-style-display-flex brtc-style-width-97-p"></div>' +
            '        <div class="brtc-va-dialogs-buttonbar brtc-style-padding-right-30"></div>' +
            '    </div>' +
            '</div>');

        this.$titleArea = this.$mainControl.find('.brtc-va-dialogs-title');
    };

    UnloadModelSettingDialog.prototype.createDialogContentsArea = function ($parent) {
        var _this = this;

        this.$contentsAreaWrapper = $('' +
            '<div class="brtc-va-views-properties-pages brtc-style-width-full rtc-style-overflow-hidden">' +
            '   <div class="contents brtc-style-padding-right-10 brtc-style-relative brtc-style-full"></div>' +
            '</div>');
        this.$contentsAreaWrapper.css({
            width: this.options.width,
            height: this.options.height,
            border: 'none'
        });
        $parent.append(this.$contentsAreaWrapper);
        this.$contentsArea = this.$contentsAreaWrapper.find('.contents');

        this.addPropertyControl('Target', function ($parent) {
            _this.createTargetControl($parent);
        });

        this.addPropertyControl('Path', function ($parent) {
            _this.createModelPathControl($parent);
        }).find('.brtc-va-views-properties-pages-controls-propertycontrol-contents').css({border: 'none'});
    };

    UnloadModelSettingDialog.prototype.createTargetControl = function ($parent) {
        this.$target = $parent;
        var FnUnitUtils = this.FnUnitUtils;
        var targetSource = FnUnitUtils.getPreviousFnUnits(this.options.fnUnit).map(function (fn) {
            return {
                label: FnUnitUtils.getLabel(fn),
                value: FnUnitUtils.getId(fn)
            }
        });

        this.createDropDownList($parent, {
            source: targetSource
        }).val(this.options.fnUnit.param[PARAM_TARGET]);
    };

    UnloadModelSettingDialog.prototype.createModelPathControl = function ($parent) {
        this.$path = $('<input type="text" class="brtc-va-views-properties-pages-controls-propertycontrol-input" />');
        $parent.append(this.$path);
        this.createInput(this.$path).val(this.options.fnUnit.param[PARAM_PATH]);
    };

    UnloadModelSettingDialog.prototype.addPropertyControl = function (label, callback, option) {
        var _this = this,
            $propertyControl = $('' +
                '<div class="brtc-va-views-properties-pages-controls-propertycontrol">' +
                '   <div class="brtc-va-views-properties-pages-controls-propertycontrol-label"></div>' +
                '   <div class="brtc-va-views-properties-pages-controls-propertycontrol-contents">' +
                '</div>');

        this.$contentsArea.append($propertyControl);

        $propertyControl.jqxExpander({
            theme: Brightics.VA.Env.Theme,
            arrowPosition: 'left',
            initContent: function () {
                if (typeof callback === 'function') {
                    callback.call(_this, $propertyControl.find(".brtc-va-views-properties-pages-controls-propertycontrol-contents"), option);
                }
            }
        });
        $propertyControl.jqxExpander('setHeaderContent', label);
        return $propertyControl;
    };

    UnloadModelSettingDialog.prototype.setDropDownControlValue = function (key, value) {
        var $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-dropdown[param-key="' + key + '"]');
        if ($control.val() !== value) {
            $control.val(value);
        }
    };

    UnloadModelSettingDialog.prototype.createInput = function ($control) {
        return $control.jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '30px'
        });
    };

    UnloadModelSettingDialog.prototype.createDropDownList = function ($control, options) {
        return $control.jqxDropDownList(_.extend({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: '25px'
        }, options));
    };

    UnloadModelSettingDialog.prototype.setInputControlValue = function (key, value) {
        var $control = this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-input[param-key="' + key + '"]');
        if ($control.val() !== value) {
            $control.val(value);
        }
    };

    UnloadModelSettingDialog.prototype.makeInputs = function (lfu) {
        var rt = {}
        var FnUnitUtils = this.FnUnitUtils;

        if (lfu) {
            _.forEach(FnUnitUtils.getOutData(lfu), function (d, i) {
                rt[d] = d;
            })
        }

        return rt;
    };

    UnloadModelSettingDialog.prototype.makeMeta = function (lfu) {
        var rt = {}
        var FnUnitUtils = this.FnUnitUtils;
        if (lfu) {
            _.forEach(FnUnitUtils.getOutData(lfu), function (d, i) {
                var type = FnUnitUtils.getTypeByTableId(lfu, d);
                rt[d] = {type: type};
            })
        }

        // Fix me : default
        rt.model = {type: 'model'}

        return rt;
    };

    UnloadModelSettingDialog.prototype.makeParam = function (lfu) {
        var rt = {};
        rt[PARAM_TARGET] = this.$target.val();
        rt[PARAM_PATH] = this.$path.val();

        if (lfu) {
            rt[PARAM_LINKED] = {
                name: lfu.name,
                param: lfu.param,
                outData: lfu.outData,
                outputs: lfu.outputs
            }
        }

        return rt;
    };

    UnloadModelSettingDialog.prototype.getFunctionByFid = function (fid) {
        return Studio.getActiveEditor().getFunctionByFid(fid);
    };

    UnloadModelSettingDialog.prototype.getTargetTable = function (fid) {
        var rt = {
            model: '',
            meta: ''
        };

        var fu = this.getFunctionByFid(fid);
        rt.model = this.FnUnitUtils.getTrainModel(fu);
        rt.meta = this.FnUnitUtils.getTrainMeta(fu);

        return rt;
    };

    UnloadModelSettingDialog.prototype.handleOkClicked = function () {
        var result = $.extend(true, {}, this.options.fnUnit);
        var lfu = this.getFunctionByFid(this.$target.val());
        result.param = this.makeParam(lfu);
        result.inputs = this.makeInputs(lfu);
        result.meta = _.extend(result.meta, this.makeMeta(lfu));

        this.dialogResult = {
            OK: true,
            Cancel: false,
            results: {fnUnit: result}
        };

        this.$mainControl.dialog('close');
    };

    Brightics.VA.Core.Dialogs.UnloadModelSettingDialog = UnloadModelSettingDialog;

}).call(this);
/*
 * 2017-12-13
 * hyunseok.oh@samsung.com
 */


/* global _ */

(function () {
    'use strict';

    var Brightics = this.Brightics;
    var Utils = Brightics.VA.Core.Utils;
    var _super = Brightics.VA.Dialogs.Dialog.prototype;

    /**
     * @extends Dialog
     * @param {*} parentId
     * @param {Object} options
     */
    function VersionManagementDialog(parentId, options) {
        _super.constructor.call(this, parentId, options);
    }

    VersionManagementDialog.prototype = Object.create(_super);
    VersionManagementDialog.prototype.constructor = VersionManagementDialog;

    VersionManagementDialog.prototype._initOptions = function () {
        _super._initOptions.call(this);

        this.dialogOptions.title = 'Version List';
        this.dialogOptions.width = 1000;
        this.dialogOptions.height = 'auto';
        this.dialogOptions.maxHeight = 'auto';
    };

    VersionManagementDialog.prototype.createDialogContentsArea = function ($parent) {
        var template = [
            '<div class="brtc-va-dialogs-version-management-contents">',
            '  <div class="brtc-va-dialogs-version-management-header">',
            '    <input type="button" class="brtc-va-dialogs-version-management-add" value="Update Version">',
            '  </div>',
            '  <div class="brtc-va-dialogs-version-management-body">',
            '  </div>',
            '</div>'
        ].join('\n');

        $parent.append(template);

        this.$addBtn = $parent.find('.brtc-va-dialogs-version-management-add');
        this.$contentBody = $parent.find('.brtc-va-dialogs-version-management-body');

        var emitter = new Brightics.VA.EventEmitter();
        emitter.on('load', _.debounce(function (fileVersion) {
            this.openLoadQuestionDialog(function (result) {
                if (result.OK) {
                    this.loadFileVersion(fileVersion.getFileId(), fileVersion.getVersionId());
                }
            }.bind(this));
        }.bind(this), 300));
        emitter.on('error', _.debounce(function (err) {
            this._onError(err);
        }.bind(this)));

        this.modelVersionListComponent = new Brightics.VA.Core.Components.ModelVersionListLoadable({
            $el: this.$contentBody,
            emitter: emitter,
            projectId: this.options.projectId,
            fileId: this.options.fileId
        });

        this.createAddButton(this.$addBtn);
    };

    VersionManagementDialog.prototype.createAddButton = function ($self) {
        $self.jqxButton({ theme: Brightics.VA.Env.Theme });
        $self.click(_.debounce(this.openAddVersionDialog.bind(this)));
    };

    VersionManagementDialog.prototype.openAddVersionDialog = function () {
        var closeHandler = function (result) {
            if (result.OK) this.modelVersionListComponent.refreshFileVersionList();
        }.bind(this);

        new Brightics.VA.Core.Dialogs.AddVersionDialog(this.$mainControl, {
            projectId: this.options.projectId,
            fileId: this.options.fileId,
            close: closeHandler
        });
    };

    VersionManagementDialog.prototype.openLoadQuestionDialog = function (callback) {
        var msg = 'Current model contents will be overwritten by this version and cannot be recovered. Are you sure?';
        Utils.WidgetUtils.openQuestionDialog(msg, callback);
    };

    VersionManagementDialog.prototype.createDialogButtonBar = function ($parent) {
        _super.createDialogButtonBar.call(this, $parent);
        this.$okButton.val('Close');
        this.$cancelButton.css({ display: 'none' });
    };

    VersionManagementDialog.prototype.loadFileVersion = function (fileId, versionId) {
        var openLoadingSuccessDialog = function () {
            return Utils.WidgetUtils.openInformationDialog('Loading success');
        };

        // TODO: 정리할 필요가 있을듯...it touches my mind...
        var closeEditor = function () {
            this.closedEditor = Studio.getEditorContainer().findEditorById(this.options.projectId, fileId);
            if (this.closedEditor) Studio.getLayoutManager().closeEditor(this.closedEditor.options.editorInput);
            return true;
        }.bind(this);

        var closeThisDialogWithSuccess = function () {
            this.dialogResult.loadingSuccess = false;
            return this.$mainControl.dialog('close');
        }.bind(this);

        var updateFileCache = function (updatedFiles) {
            this.updatedFiles = updatedFiles;
        }.bind(this);

        var refresh = function () {
            Studio.getLayoutManager().openEditor(this.updatedFiles);
            // if (this.closedEditor) {
            //     Studio.getLayoutManager().openEditor(this.updatedFiles);
            //     // this.options.editor.getModelLayoutManager().openActivity(this.options.fileId);
            // } else {
            //     Studio.getLayoutManager().refreshProjectViewer();
            // }
        }.bind(this);

        Studio.getResourceManager().loadVersion(this.options.projectId, fileId, versionId)
            .then(updateFileCache)
            .then(closeEditor)
            .then(openLoadingSuccessDialog)
            .then(closeThisDialogWithSuccess)
            .then(refresh)
            .catch(this._onError.bind(this));
    };

    VersionManagementDialog.prototype._onError = function (err) {
        Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        this.$mainControl.dialog('close');
    };

    VersionManagementDialog.prototype.destroy = function () {
        _super.destroy.call(this);
        this.modelVersionListComponent.destroy();
    };

    Brightics.VA.Core.Dialogs.VersionManagementDialog = VersionManagementDialog;
    /* eslint-disable no-invalid-this */
}.call(this));

/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function WizardPage(parentId, options) {
        this.parentId = parentId;
        this.options = $.extend({}, options || {
                showPreviousButton: true,
                showNextButton: true,
                showFinishButton: true
            });
        this.retrieveParent();
        this.createControls();
        this.initPermission();
    }

    WizardPage.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    WizardPage.prototype.initPermission = function () {
        this.permissions = [
            'data_upload_shared'
        ];

        this.checkPermission();
    };

    WizardPage.prototype.checkPermission = function () {
        Brightics.VA.Core.Utils.PermissionUtils.check(this.$mainControl, this.permissions);
    };

    WizardPage.prototype.init = function () {
        $(':focus').blur();
        this.options.wizard.$btnPrevious.removeClass('jqx-fill-state-hover').removeClass('jqx-fill-state-hover-office');
        this.options.wizard.$btnNext.removeClass('jqx-fill-state-hover').removeClass('jqx-fill-state-hover-office');
        this.options.wizard.$btnFinish.removeClass('jqx-fill-state-hover').removeClass('jqx-fill-state-hover-office');

        this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        this.options.wizard.$btnNext.jqxButton({disabled: false});
        this.options.wizard.$btnFinish.jqxButton({disabled: false});

        this.$mainControl.find('.preview').find('.contents').perfectScrollbar('update');
    };

    WizardPage.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-wizardpage">' +
            '   <div class="brtc-va-wizardpage-header"></div>' +
            '   <div class="brtc-va-wizardpage-content"></div>' +
            '</div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });
        this.$parent.append(this.$mainControl);

        this.$mainControl.addClass(this.options.class);

        this.$headerControl = this.$mainControl.find('.brtc-va-wizardpage-header');
        this.$headerControl.addClass(this.options.class);
        this.createHeaderArea(this.$headerControl);
        this.$contentsControl = this.$mainControl.find('.brtc-va-wizardpage-content');
        this.$contentsControl.addClass(this.options.class);
        this.createContentsArea(this.$contentsControl);
    };

    WizardPage.prototype.createHeaderArea = function ($parent) {
    };

    WizardPage.prototype.createContentsArea = function ($parent) {
    };

    WizardPage.prototype.show = function () {
        this.$mainControl.show();
    };

    WizardPage.prototype.hide = function () {
        this.$mainControl.hide();
    };

    WizardPage.prototype.doFinish = function (callback) {
        callback();

    };

    WizardPage.prototype.findActivatedInput = function (inputs) {
        for (var i in inputs) {
            if ($(inputs[i]).hasClass('jqx-fill-state-focus')) {
                return $(inputs[i]);
            }
        }
        return undefined;
    };

    WizardPage.prototype.destroy = function () {
    };

    Brightics.VA.Core.Wizards.Pages.WizardPage = WizardPage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DownloadLoadingPage(parentId, options) {
        this.options = options;
        this.options.class = 'downloadloadingpage';

        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);
    }

    DownloadLoadingPage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    DownloadLoadingPage.prototype.constructor = DownloadLoadingPage;

    DownloadLoadingPage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        //this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        //this.options.wizard.$btnFinish.jqxButton({disabled: true});
        //if (this.options.wizard.result.delimiter) // delimiters 있으면
        //    this.options.wizard.$btnNext.jqxButton({disabled: false});
        //else
        //    this.options.wizard.$btnNext.jqxButton({disabled: true});
        this.doFinish();
    };

    DownloadLoadingPage.prototype.createHeaderArea = function ($parent) {
        //$parent.addClass('brtc-va-wizardpage-dataupload');
        //this.$wizardHeader = $('' +
        //    '   <div class="step01">' +
        //    '       <span class="brtc-va-icon step disabled"></span>' +
        //    '       <p class="step disabled"><strong>01</strong> Select Data</p>' +
        //    '   </div>' +
        //    '   <div class="step02">' +
        //    '       <span class="brtc-va-icon step normal selected"></span>' +
        //    '       <p class="step normal selected"><strong>02</strong> Set Delimiter</p>' +
        //    '   </div>' +
        //    '   <div class="step03">' +
        //    '       <span class="brtc-va-icon step disabled"></span>' +
        //    '       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>' +
        //    '   </div>');
        //$parent.append(this.$wizardHeader);
    };

    DownloadLoadingPage.prototype.createContentsArea = function ($parent) {
        var loadingText = this.options.loadingText || 'Preparing...';
        $parent.append($('' +
            '<div class="brtc-va-loading-page-contents-area">' +
            '   <div class="brtc-va-loading-page-text-area">' +
            '       <div class="brtc-va-loading-page-text-wrapper">' +
            '           <span>' + loadingText + '</span>' +
            '       </div>' +
            '    </div>' +
            '    <div class="brtc-va-loading-page-spinner-area">' +
            '        <div class="brtc-va-loading-page-spinner-wrapper">' +
            '            <div class="brtc-va-loading-page-spin-icon">' +
            '               <div class="brtc-va-progress-loading"></div>' +
            '           </div>' +
            '        </div>' +
            '   </div>' +
            '</div>'));
    };

    DownloadLoadingPage.prototype.doFinish = function () {
        var _this = this;
        var downloader = Brightics.VA.Core.Utils.DownLoader;
        var options = this.options.wizard.options.downloaderOptions;

        var userId = options.userId;
        var mid = options.mid;
        var tid = this.options.wizard.result.tid;
        // var fileName = options.fileName;
        // input 파일명이 없으면 default 파일명 setting
        var fileName = this.options.wizard.result.fileName || options.fileName;
        var delimiters = this.options.wizard.result.delimiters;

        downloader.run(userId, mid, tid, fileName, delimiters, function () {
            _this.options.wizard.$mainControl.dialog('destroy');
        }, function (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err, function () {
                _this.options.wizard.$mainControl.dialog('destroy');
            });
        });
    };

    Brightics.VA.Core.Wizards.Pages.DownloadLoadingPage = DownloadLoadingPage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SelectAlluxioDataPage(parentId, options) {
        this.options = options;
        this.options.class = 'selectalluxiodatapage';

        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);

        this.options.wizard.registerEvent('changeData');
    }

    SelectAlluxioDataPage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SelectAlluxioDataPage.prototype.constructor = SelectAlluxioDataPage;

    SelectAlluxioDataPage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        this.options.wizard.$btnFinish.jqxButton({disabled: true});
        if (this.options.wizard.result.remotePath) // 파일 있으면
            this.options.wizard.$btnNext.jqxButton({disabled: false});
        else
            this.options.wizard.$btnNext.jqxButton({disabled: true});

        this.options.wizard.result.data = this.options.wizard.result.data || [];
    };

    SelectAlluxioDataPage.prototype.createHeaderArea = function ($parent) {
        $parent.addClass('brtc-va-wizardpage-dataupload');
        this.$wizardHeader = $('' +
            '   <div class="step01">' +
            '       <span class="brtc-va-icon step normal selected"></span>' +
            '       <p class="step normal selected"><strong>01</strong> Select Data</p>' +
            '   </div>' +
            '   <div class="step02">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>02</strong> Set Delimiter</p>' +
            '   </div>' +
            '   <div class="step03">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>' +
            '   </div>');
        $parent.append(this.$wizardHeader);
    };

    SelectAlluxioDataPage.prototype.createContentsArea = function ($parent) {
        $parent.addClass('brtc-va-wizardpage-dataupload');

        var _this = this;

        $parent.append($('' +
            '   <div class="fileselect">' +
            '       <div style="font-size: 13px; font-style: italic; margin-bottom: 20px;">Select data consisting of delimiter-separated values.</div>' +
            '       <div class="header">' +
            '           <span>File: </span>' +
            '               <input type="button" id="fileselect-remote" value="Remote" />' +
            '       </div>' +
            '       <div class="contents filename">' +
            '           <span class="nodata">Select file to upload</span>' +
            '       </div>' +
            '   </div>' +
            '   <div class="uploadtoselect">' +
            '       <div class="header">' +
            '           <span>Add to: </span>' +
            '       </div>' +
            '       <div class="contents">' +
            '           <div class="brtc-va-radio">' +
            '               <div class="brtc-va-radio-button" id="upload-to-shared-alluxio" value="shared">Shared</div>' +
            '           </div>' +
            '           <div class="brtc-va-radio">' +
            '               <div class="brtc-va-radio-button" id="upload-to-userid-alluxio" value="' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(Brightics.VA.Env.Session.userId) + '"><span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(Brightics.VA.Env.Session.userId) + '</span></div>' +
            '           </div>' +
            '       </div>' +
            '   </div>' +
            '   <div class="preview selectdata alluxio">' +
            '       <div class="header">' +
            '           <span>Data preview</span>' +
            '       </div>' +
            '       <div class="contents">' +
            '           <span class="nodata">no data</span>' +
            '       </div>' +
            '   </div>'));

        var $btnRemote = $parent.find('#fileselect-remote');

        $parent.find('#upload-to-shared-alluxio').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 25,
            width: 100,
            boxSize: '18px',
            groupName: 'alluxio'
        });
        $parent.find('#upload-to-userid-alluxio').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 25,
            width: 100,
            boxSize: '18px',
            groupName: 'alluxio'
        });

        $parent.find('.brtc-va-radio-button').on('checked', function (event) {
            _this.options.wizard.result.uploadTo = this.getAttribute('value');
        });

        $parent.find('#upload-to-userid-alluxio').jqxRadioButton('check');

        $btnRemote.jqxButton({
            theme: Brightics.VA.Env.Theme
        });
        $btnRemote.on('click', function (event) {
            _this.handleRemoteFileSelected(event);
        });
    };

    SelectAlluxioDataPage.prototype.handleRemoteFileSelected = function (event) {
        var _this = this;
        new Brightics.VA.Core.Dialogs.FilePathDialog($(event.target), {
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    var name = dialogResult.name,
                        $fileName = _this.$contentsControl.find('.filename');

                    $fileName.empty();
                    $fileName.append($('' +
                        '<span class="brtc-va-icon brtc-va-dialogs-dataupload file"></span>' +
                        '<span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(name) + '</span>'));
                    _this.reset();

                    $.ajax({
                        method: "GET",
                        url: 'api/va/v2/data/head?length=20&path=' + name,
                        blocking: true
                    }).done(function (res) {
                        _this.options.wizard.triggerEvent('changeData', true);
                        _this.updateFileSelectPreview(res);
                        _this.refreshButton(true);
                        _this.options.wizard.result.fileName = name.split('/').pop();
                        _this.options.wizard.result.remotePath = name;
                        _this.options.wizard.$btnNext.jqxButton({disabled: false});
                    }).fail(function (err) {
                        // alert(JSON.stringify(err));
                        Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('File does not exist.', function () {
                            _this.refreshButton();
                        });

                        _this.refreshButton();
                    });
                }
            }
        });
    };

    SelectAlluxioDataPage.prototype.updateFileSelectPreview = function (textContent) {
        var contentList = textContent.split('\n'),
            $contentArea = this.$contentsControl.find('.preview.selectdata.alluxio').find('.contents'),
            index = 0;

        this.options.wizard.result.data = [];
        for (var i = 0; i < Math.min(contentList.length, 20); i++) {
            if (!contentList[i].trim()) continue;

            $contentArea.find('.number-column').append($('<li>' + index + '</li>'));
            $contentArea.find('.data-column').append($('<li>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(contentList[i]) + '</li>'));

            this.options.wizard.result.data.push(contentList[i]);
            index++;
        }
        $contentArea.perfectScrollbar();
    };

    SelectAlluxioDataPage.prototype.reset = function () {
        var $preview = this.$parent.find('.preview').find('.contents');

        this.options.wizard.result.fileName = '';
        this.options.wizard.result.data = [];
        $('input[type=file]').val('');

        $preview.empty();
        $preview.append($('<ul class="number-column"></ul>'));
        $preview.append($('<ul class="data-column"></ul>'));
    };

    SelectAlluxioDataPage.prototype.refreshButton = function (status) {
        // this.options.wizard.$btnNext.jqxButton({disabled: !status});
        // this.options.wizard.$btnFinish.jqxButton({disabled: true});
    };

    Brightics.VA.Core.Wizards.Pages.SelectAlluxioDataPage = SelectAlluxioDataPage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SelectDelimiterPage(parentId, options) {
        this.options = options;
        this.options.class = 'selectdelimiterpage';

        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);

        var _this = this;
        this.options.wizard.registerEvent('changeDelimiter');
        this.options.wizard.addEventListener('changeData', function (event, eventData) {
            if (eventData) {
                _this.options.wizard.result.delimiter = undefined;
            }
        });
    }

    SelectDelimiterPage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SelectDelimiterPage.prototype.constructor = SelectDelimiterPage;

    SelectDelimiterPage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.delimiterMap = {
            comma: ',',
            tab: '\t',
            semicolon: ';',
            colon: ':',
            space: ' '
        };

        this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        this.options.wizard.$btnFinish.jqxButton({disabled: true});
        if (this.options.wizard.result.delimiter) // delimiters 있으면
            this.options.wizard.$btnNext.jqxButton({disabled: false});
        else
            this.options.wizard.$btnNext.jqxButton({disabled: true});

        if (this.options.wizard.result.delimiter === undefined) {
            this.$mainControl.find('.brtc-va-radio-button[value=comma]').val(true);
        } else {
            this.splitData(this.options.wizard.result.delimiter);
        }
    };

    SelectDelimiterPage.prototype.createHeaderArea = function ($parent) {
        $parent.addClass('brtc-va-wizardpage-dataupload');
        this.$wizardHeader = $('' +
            '   <div class="step01">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>01</strong> Select Data</p>' +
            '   </div>' +
            '   <div class="step02">' +
            '       <span class="brtc-va-icon step normal selected"></span>' +
            '       <p class="step normal selected"><strong>02</strong> Set Delimiter</p>' +
            '   </div>' +
            '   <div class="step03">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>' +
            '   </div>');
        $parent.append(this.$wizardHeader);
    };

    SelectDelimiterPage.prototype.createContentsArea = function ($parent) {
        var _this = this;
        $parent.append($('' +
            '<div class="delimiterselect brtc-va-column-delimiter">' +
            '   <div style="font-size: 13px; font-style: italic; margin-bottom: 20px;">Choose a delimiter for separating data.</div>' +
            '   <div class="header">' +
            '       <span>Delimiters: </span>' +
            '    </div>' +
            '    <div class="contents">' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-comma" value="comma" aria-checked="true">Comma</div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-tab" value="tab"><span>Tab</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-space" value="space"><span>Space</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-colon" value="colon"><span>Colon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>' +
            '        </div>' +
            '   </div>' +
            '</div>' +
            '<div class="column-preview selectdelimiter">' +
            '   <div class="header"><span class="column-row-length">0</span>Columns</div>' +
            '   <div class="contents">' +
            '       <div class="delimiter-table"></div>' +
            '   </div>' +
            '</div>'));

        $parent.find('.brtc-va-radio-button').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 25,
            width: 95,
            boxSize: '18px',
            groupName: 'delimiter'
        });

        $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: '70px',
            height: '24px'
        });

        $parent.find('.brtc-va-column-delimiter .jqx-radiobutton').on('change', function (event) {
            _this.options.wizard.triggerEvent('changeDelimiter', true);
            if (event.target.tagName == 'INPUT') {
                _this.options.wizard.result.delimiter = $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').val();
                _this.splitData(_this.options.wizard.result.delimiter);
            } else {
                var checked = event.args.checked;
                if (checked) {
                    var value = event.target.getAttribute('value');
                    if (value == 'other') {
                        _this.options.wizard.result.delimiter = $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').val();
                        _this.splitData(_this.options.wizard.result.delimiter);
                    } else {
                        _this.options.wizard.result.delimiter = _this.delimiterMap[value];
                        _this.splitData(_this.options.wizard.result.delimiter);
                    }
                }
            }
            if (_this.options.wizard.result.delimiter && _this.options.wizard.result.data.length > 1) {
                _this.options.wizard.$btnNext.jqxButton({disabled: false});
            } else {
                _this.options.wizard.$btnNext.jqxButton({disabled: true});
                return;
            }

            _this.options.wizard.$btnNext.jqxButton({disabled: false});
        });

        this.createColumnGrid();
    };

    SelectDelimiterPage.prototype.getColumnNameList = function () {
        var columnNameList = [];
        if (this.options.wizard.result.data[0])
            columnNameList = this.options.wizard.result.data[0].split(this.options.wizard.result.delimiter || ',');

        return columnNameList;
    };

    SelectDelimiterPage.prototype.splitData = function (value) {
        var columns = [];
        var data = [];
        if (this.options.wizard.result.data[0]) {
            columns = this.options.wizard.result.data[0].split(value || this.options.wizard.result.delimiter);
            if (this.options.wizard.result.data[1]) {
                data = this.options.wizard.result.data[1].split(value || this.options.wizard.result.delimiter);
            }
        }

        this.setColumnGridData(columns, data);
    };

    SelectDelimiterPage.prototype.createColumnGrid = function () {
        var $parent = this.$mainControl.find('.column-preview .contents .delimiter-table');
        var $grid = $('<div class="brtc-va-selectdelimiter-preview-column-grid"></div>');
        $parent.append($grid);

        var dataAdapter = this._getFormattedGridData([]);
        this.$grid = $grid.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: 619,
            height: 265,
            rowsheight: 25,
            source: dataAdapter,
            selectionmode: 'none',
            columnsresize: true,
            columns: [
                {
                    text: 'No.', sortable: false, filterable: false, editable: false,
                    groupable: false, draggable: false, resizable: false,
                    datafield: '', columntype: 'number', width: 50,
                    cellsrenderer: function (row, column, value) {
                        return '<div style="margin:4px;">' + (value + 1) + '</div>';
                    }
                },
                {
                    text: 'Column Name', datafield: 'column',
                    cellsrenderer: function (row, datafield, value) {
                        var $cell = $('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');
                        $cell.attr('title', value);
                        $cell.text(value);
                        return $('<div>').append($cell.clone()).html();
                    }
                },
                {
                    text: 'First Data', datafield: 'column-data',
                    cellsrenderer: function (row, datafield, value) {
                        var $cell = $('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');
                        $cell.attr('title', value);
                        $cell.text(value);
                        return $('<div>').append($cell.clone()).html();
                    }
                }
            ]
        });
    };

    SelectDelimiterPage.prototype.setColumnGridData = function (columns, data) {
        var dataAdapter = this._getFormattedGridData(columns, data);
        this.$grid.jqxGrid({
            source: dataAdapter
        });
        this.$mainControl.find('.column-row-length').text(columns.length);
    };

    SelectDelimiterPage.prototype._getFormattedGridData = function (columns, data) {
        var _data = [];
        for (var i = 0; i < columns.length; i++) {
            var row = {};
            row['column'] = columns[i];
            row['column-data'] = data[i];
            _data[i] = row;
        }
        var source = {
            localdata: _data,
            datatype: 'array',
            datafields: [
                {name: 'column', type: 'string'},
                {name: 'column-data', type: 'string'}
            ]
        };
        return new $.jqx.dataAdapter(source);
    };

    SelectDelimiterPage.prototype.destroy = function () {
        this.$grid.jqxGrid('destroy');
    };

    Brightics.VA.Core.Wizards.Pages.SelectDelimiterPage = SelectDelimiterPage;

}).call(this);
/**
 * Created by gy84.bae on 2016-11-09.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SelectExportDelimiterPage(parentId, options) {
        this.options = options;
        this.options.class = 'selectexportdelimiterpage';

        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);
    }

    SelectExportDelimiterPage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SelectExportDelimiterPage.prototype.constructor = SelectExportDelimiterPage;

    SelectExportDelimiterPage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.delimiterMap = {
            comma: ',',
            tab: '\t',
            semicolon: ';',
            colon: ':',
            space: ' '
        };

        this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        this.options.wizard.$btnFinish.jqxButton({disabled: true});
        if (this.options.wizard.result.delimiter) {
            // delimiters 있으면
            this.options.wizard.$btnNext.jqxButton({disabled: true});
            this.options.wizard.$btnFinish.jqxButton({disabled: false});
        }
        else {
            this.options.wizard.$btnFinish.jqxButton({disabled: true});
            this.options.wizard.$btnNext.jqxButton({disabled: true});
        }
    };

    SelectExportDelimiterPage.prototype.createHeaderArea = function ($parent) {
        //$parent.addClass('brtc-va-wizardpage-dataupload');
        //this.$wizardHeader = $('' +
        //    '   <div class="step01">' +
        //    '       <span class="brtc-va-icon step disabled"></span>' +
        //    '       <p class="step disabled"><strong>01</strong> Select Data</p>' +
        //    '   </div>' +
        //    '   <div class="step02">' +
        //    '       <span class="brtc-va-icon step normal selected"></span>' +
        //    '       <p class="step normal selected"><strong>02</strong> Set Delimiter</p>' +
        //    '   </div>' +
        //    '   <div class="step03">' +
        //    '       <span class="brtc-va-icon step disabled"></span>' +
        //    '       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>' +
        //    '   </div>');
        //$parent.append(this.$wizardHeader);
    };

    SelectExportDelimiterPage.prototype.createContentsArea = function ($parent) {

        //Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this, $parent);
        $parent.addClass('brtc-va-wizardpage-dataexport');
        var _this = this;
        this.$progress = $('' +
            '   <div class="brtc-va-progress">' +
            '       <div>' +
            '           <span class="brtc-va-progress-loading"/>' +
            '           <p>Exporting...</p>' +
            '       </div>' +
            '</div>');
        $parent.append(this.$progress);
        this.$progress.hide();


        $parent.append($('' +
            '<div class="fileselect">' +
            '   <div class="header">' +
            '       <span>Export File</span>' +
            '    </div>' +
            '       <div class="contents filename">' +
            '           <span class="nodata">Select file to upload</span>' +
            '       </div>' +
            '</div>' +

            //this.createColumnDelimiterArea($parent);
            //this.createArrayDateDelimiterArea($parent);
            //this.createKeyValueDataDelimiterArea($parent);

            '<div class="delimiterselect brtc-va-column-delimiter">' +
            '   <div class="header">' +
            '       <span>Delimiters</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-comma" value="comma">Comma</div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-tab" value="tab"><span>Tab</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-space" value="space"><span>Space</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-colon" value="colon"><span>Colon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>' +
            '        </div>' +
            '   </div>' +
            '</div>'));

        $parent.css({
            height: '400px'
        });


        $parent.find('.brtc-va-radio-button').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 28,
            width: 102,
            boxSize: '18px',
            groupName: 'delimiter'
        });
        //$parent.find('.brtc-va-column-delimiter .brtc-va-radio-button[value=comma]').jqxRadioButton('check');
        $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 77,
            height: 25
        });

        $parent.find('.brtc-va-column-delimiter .jqx-radiobutton').on('change', function (event) {
            if (event.target.tagName == 'INPUT') {
                _this.options.wizard.result.delimiter = $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').val();
            } else {
                var checked = event.args.checked;
                if (checked) {
                    var value = event.target.getAttribute('value');
                    if (value == 'other') {
                        _this.options.wizard.result.delimiter = $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').val();
                    }
                    else {
                        _this.options.wizard.result.delimiter = _this.delimiterMap[value];
                    }
                }
            }
            if (_this.options.wizard.result.delimiter) {
                _this.options.wizard.$btnFinish.jqxButton({disabled: false});
            } else {
                _this.options.wizard.$btnFinish.jqxButton({disabled: true});
            }
        });

        $parent.find('.brtc-va-column-delimiter .brtc-va-radio-button[value=other]').on('checked', function () {
            $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').jqxInput('focus');
        });


        _this.handleExportFileSelected();
    };

    SelectExportDelimiterPage.prototype.handleExportFileSelected = function () {
        var _this = this;

        var wizardOption = _this.options.wizard;

        var $fileName = this.$contentsControl.find('.filename');
        $fileName.empty();
        $fileName.append($('' +
            '<span class="brtc-va-icon brtc-va-wizardpage-dataupload file"></span>' +
            '<span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(wizardOption.options.name) + '</span>'));

    };

    SelectExportDelimiterPage.prototype.doFinish = function () {
        var _this = this;
        _this.progress(true, 'Exporting...');
        var downloader = Brightics.VA.Core.Utils.DownLoader;
        if (this.options.wizard.result.copyFrom === 'local') {
            var fileName = _this.options.wizard.options.name;
            var delimiter = _this.options.wizard.result.delimiter;
            var delimiters = {};
            delimiters.delimiter = delimiter;
            var path = _this.options.wizard.options.path;

            downloader.runStartWithExport(fileName, path, delimiters, function () {
                _this.progress(false);
            }, function (err) {
                Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err, function () {
                    _this.$parent.parent().dialog('destroy');
                });
            });
        }
    };

    SelectExportDelimiterPage.prototype.progress = function (status, label) {
        var _this = this;
        if (status) {
            this.$progress.show();
            this.options.wizard.$btnFinish.jqxButton({disabled: status});
        }
        else {
            this.$progress.hide();
            if (label) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(label, function () {
                    _this.$parent.parent().dialog('destroy');
                });
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Data Export preparation has been successfully completed. File Download will start.', function () {
                    _this.$parent.parent().dialog('destroy');
                });
            }
        }
        this.options.wizard.$btnPrevious.jqxButton({disabled: status});
    };

    Brightics.VA.Core.Wizards.Pages.SelectExportDelimiterPage = SelectExportDelimiterPage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const IP_REGEX = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;

    function SelectExportJdbcPage(parentId, options) {
        this.options = options;
        this.options.class = 'SelectExportJdbcPage';
        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);
    }

    SelectExportJdbcPage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SelectExportJdbcPage.prototype.constructor = SelectExportJdbcPage;

    SelectExportJdbcPage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        this.options.wizard.$btnFinish.jqxButton({disabled: true});

        this.$message.text('');
        this.options.wizard.result.data = this.options.wizard.result.data || [];
        this.options.wizard.result.columnType = this.options.wizard.result.columnType || {};
        this.options.wizard.result.jdbc = this.options.wizard.result.jdbc || {};

        if (this.$host.jqxInput('val') != '' && this.$port.jqxInput('val') != '' && this.$service.jqxInput('val') != ''
            && this.$username.jqxInput('val') != '' && this.$password.jqxInput('val') != '' && this.$tablename.jqxInput('val') != '')
            this.$contentsControl.find('.connect').jqxButton({disabled: false});
        else
            this.$contentsControl.find('.connect').jqxButton({disabled: true});
    };

    SelectExportJdbcPage.prototype.createHeaderArea = function ($parent) {
    };

    SelectExportJdbcPage.prototype.refreshConnectControl = function () {
        this.$message.text('');

        var host = this.$host.val(), port = this.$port.val();
        var $connect = this.$contentsControl.find('.connect');
        if (host != '' && port != ''
            && this.$service.jqxInput('val') != ''
            && this.$username.jqxInput('val') != ''
            && this.$password.jqxInput('val') != ''
            && this.$tablename.jqxInput('val') != '')
            $connect.jqxButton({disabled: !(IP_REGEX.test(host) && (Brightics.VA.Core.Utils.InputValidator.isValid.integerType(port) && port < 65535))});
        else
            $connect.jqxButton({disabled: true});
    };

    SelectExportJdbcPage.prototype.createContentsArea = function ($parent) {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this, $parent);
        var _this = this;

        this.$progress = $('' +
            '   <div class="brtc-va-progress">' +
            '       <div>' +
            '           <span class="brtc-va-progress-loading"/>' +
            '           <p>Exporting...</p>' +
            '       </div>' +
            '</div>');
        $parent.append(this.$progress);
        this.$progress.hide();

        $parent.append($('' +
            '   <div class="brtc-va-wizard-contents-property export-file-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label">Export File :</div>' +
            '       <div class="contents filename">' +

            '       </div>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property db-type-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">DB Type :</div>' +
            '       <div class="brtc-va-wizard-contents-property-input db-type" />' +
            '       <input type="button" class="connect" value="Connection Test"/>' +
            '       <div class="message-container"><span class="message"/></div>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Host :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input host" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Port :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input port" maxlength="5"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Service :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input service" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Username :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input username" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Password :</div>' +
            '       <input type="password" class="brtc-va-wizard-contents-property-input password" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Table Name :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input tablename" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property connection-timeout-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label">Connection :</div>' +
            '       <div  class="brtc-va-wizard-contents-property-input connection-timeout"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property login-timeout-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label">Login :</div>' +
            '       <div  class="brtc-va-wizard-contents-property-input login-timeout"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property socket-timeout-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label">Socket :</div>' +
            '       <div  class="brtc-va-wizard-contents-property-input socket-timeout"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property lock-timeout-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label">Lock :</div>' +
            '       <div  class="brtc-va-wizard-contents-property-input lock-timeout"/>' +
            '   </div>'));

        this.$dbtype = $parent.find(".db-type");
        this.$dbtype.jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            source: ["Postgre"],
            selectedIndex: 0
        });
        $parent.find(':text').jqxInput({
            theme: Brightics.VA.Env.Theme,
            maxLength: 30
        });
        $parent.find(':password').jqxInput({
            theme: Brightics.VA.Env.Theme,
            maxLength: 30
        });

        $parent.find('.connect').jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: 150,
            height: 27
        });

        $parent.jqxValidator({
            hintType: 'label',
            animationDuration: 10,
            closeOnClick: false,
            rules: [
                {
                    input: '.host',
                    message: '[0~255].[0~255].[0~255].[0~255]',
                    action: 'keyup',
                    rule: function (inputs, commit) {
                        var $target = _this.findActivatedInput(inputs);
                        return ($target) ? IP_REGEX.test($target.val()) : false;
                    }
                }, {
                    input: '.port',
                    message: '[0~65535]',
                    action: 'keyup',
                    rule: function (inputs, commit) {
                        var $target = _this.findActivatedInput(inputs);
                        return ($target) ? Brightics.VA.Core.Utils.InputValidator.isValid.integerType($target.val()) && $target.val() < 65536 : false;
                    }
                }
            ]
        });
        this.$host = $parent.find('.host');
        this.$port = $parent.find('.port');
        this.$service = $parent.find('.service');
        this.$username = $parent.find('.username');
        this.$password = $parent.find('.password');
        this.$connectionTimeout = new Brightics.VA.Core.Widget.Controls.NumericInput($parent.find('.connection-timeout'), {
            numberType: 'int',
            minus: false,
            placeholder: 'Timeout(sec) Default: 600',
            max: 3000
        });

        $parent.find('.connection-timeout').find('.brtc-va-widgets-controls-numericInput').addClass('widthfree');

        this.$loginTimeout = new Brightics.VA.Core.Widget.Controls.NumericInput($parent.find('.login-timeout'), {
            numberType: 'int',
            minus: false,
            placeholder: 'Timeout(sec) Default: 600',
            max: 3000
        });
        $parent.find('.login-timeout').find('.brtc-va-widgets-controls-numericInput').addClass('widthfree');

        this.$socketTimeout = new Brightics.VA.Core.Widget.Controls.NumericInput($parent.find('.socket-timeout'), {
            numberType: 'int',
            minus: false,
            placeholder: 'Timeout(sec) Default: 600',
            max: 3000
        });
        $parent.find('.socket-timeout').find('.brtc-va-widgets-controls-numericInput').addClass('widthfree');

        this.$lockTimeout = new Brightics.VA.Core.Widget.Controls.NumericInput($parent.find('.lock-timeout'), {
            numberType: 'int',
            minus: false,
            placeholder: 'Timeout(sec) Default: 600',
            max: 3000
        });
        $parent.find('.lock-timeout').find('.brtc-va-widgets-controls-numericInput').addClass('widthfree');

        this.$tablename = $parent.find('.tablename');
        this.$message = $parent.find('.message');

        $parent.find(':text').on('change', function () {
            _this.refreshConnectControl();
        });

        $parent.find(':password').on('change', function () {
            _this.refreshConnectControl();
        });

        $parent.find('.connect').on('click', function () {
            _this.refreshControlValues();

            $.ajax({
                type: 'GET',
                url: 'api/va/v2/rsa/publickey',
                blocking: true
            }).done(function (data) {
                var rsa = new RSAKey();
                _this.publicN = data.publicN;
                _this.publicE = data.publicE;
                rsa.setPublic(data.publicN, data.publicE);
                var encrypted_password = rsa.encrypt(_this.options.wizard.result.jdbc.password);

                var option = {
                    url: 'api/va/v2/datasources/external/query',
                    method: 'POST',
                    data: {
                        dbtype: _this.options.wizard.result.jdbc.dbtype,
                        host: _this.options.wizard.result.jdbc.host,
                        port: _this.options.wizard.result.jdbc.port,
                        service: _this.options.wizard.result.jdbc.service,
                        username: _this.options.wizard.result.jdbc.username,
                        password: encrypted_password
                    },
                    blocking: true
                };

                $.ajax(option).done(function (data) {
                    _this.$message.text('SUCCESS');
                    _this.options.wizard.$btnFinish.jqxButton({disabled: false});
                }).fail(function (err) {
                    _this.$message.text('FAILED');
                    _this.options.wizard.$btnFinish.jqxButton({disabled: true});
                });
            }).fail(function (err) {
                _this.$message.text('FAILED');
                _this.options.wizard.$btnFinish.jqxButton({disabled: true});
            });
        });

        _this.handleExportFileSelected();
    };

    SelectExportJdbcPage.prototype.doFinish = function (callback) {
        var _this = this;
        var rsa = new RSAKey();
        rsa.setPublic(_this.publicN, _this.publicE);
        var encrypted_password = rsa.encrypt(this.options.wizard.result.jdbc.password);
        _this.exportJDBCData(this.options);
    };

    SelectExportJdbcPage.prototype.createExportDataOption = function (path) {
        var _this = this;

        this.refreshControlValues();

        var jid = 'va_mexportdata_' + moment(Date.now()).format('YYYYMMDDHHmmssSSS');
        var fnUnit = {
            'fid': 'fexportdata',
            'func': 'exportData',
            'name': 'ExportData',
            'label': 'Export Data',
            'persist': true,
            'persist-mode': 'auto'
        };

        if (this.options.wizard.result.copyFrom === 'jdbc') {
            fnUnit.param = {
                'copy-to': 'jdbc',
                'ip': this.options.wizard.result.jdbc.host,
                'port': this.options.wizard.result.jdbc.port,
                'input-path': this.options.wizard.options.path,
                // 'output-path': outputPath + this.options.wizard.result.jdbc.tablename,
                'db-type': this.options.wizard.result.jdbc.dbtype.toLowerCase(),
                'username': this.options.wizard.result.jdbc.username,
                'password': this.options.wizard.result.jdbc.password,
                'db-name': this.options.wizard.result.jdbc.service,
                'table-name': this.options.wizard.result.jdbc.tablename,
                'connection-timeout': _this.options.wizard.result.jdbc.connectiontimeout.toString(),
                'login-timeout': _this.options.wizard.result.jdbc.logintimeout.toString(),
                'socket-timeout': _this.options.wizard.result.jdbc.sockettimeout.toString(),
                'lock-timeout': _this.options.wizard.result.jdbc.locktimeout.toString()
            }
        }
        //else {
        //    fnUnit.param = {
        //        'fs-type': 'alluxio',
        //        'copy-to': 'alluxio',
        //        'input-path': path.remotePath,
        //        'output-path': outputPath + path.fileName
        //    }
        //}

        return Brightics.VA.Core.Utils.RunnableFactory
            .createForDummy(fnUnit, jid, Brightics.VA.Env.Session.userId);
    };

    SelectExportJdbcPage.prototype.exportJDBCData = function (option) {
        var _this = this,
            options = this.createExportDataOption(option),
            checkTimer = function (jid) {
                _this._checkProgress(options.user, jid).done(function (result) {
                    if (result.status == 'PROCESSING') {
                        setTimeout(checkTimer.bind(_this, jid), 3000);
                    } else if (result.status == 'SUCCESS') {
                        _this.progress(false);
                    } else {
                        var messages = {
                            'errors': [
                                {
                                    'message': 'Failed to export data.',
                                    'code': 400
                                }
                            ]
                        };

                        if (result.responseJSON && result.responseJSON.errors) {
                            messages = result.responseJSON;
                            messages.errors[0].contentType = result.getResponseHeader('Content-Type');
                        } else if (result.errorInfo && result.errorInfo[0]) {
                            messages.errors[0].message = result.errorInfo[0].message;
                        }
                        _this.progress(false, messages);
                    }
                }).fail(function (err) {
                    Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err, function () {
                        _this.$parent.parent().dialog('destroy');
                    });
                });
            };

        var opt = {
            url: 'api/va/v2/analytics/jobs/execute',
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(options),
            blocking: false  //[Ajax Dim] progress함수에서 Dim 로직 수행하므로 false. 2017.08.01
        };

        $.ajax(opt).done(function (_res) {
            var res = JSON.parse(_res);
            _this.progress(true, 'Exporting... 30%');
            setTimeout(checkTimer.bind(_this, res.result), 1000);
        }).fail(function (err) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err, function () {
                _this.$parent.parent().dialog('destroy');
            });
        });
    };

    SelectExportJdbcPage.prototype._checkProgress = function (userId, jobId) {
        var option = {
            url: 'api/va/v2/analytics/jobs/' + jobId,
            type: 'GET',
            blocking: false  //[Ajax Dim] progress함수에서 Dim 로직 수행하므로 false. 2017.08.01
        };
        return $.ajax(option);
    };

    SelectExportJdbcPage.prototype.progress = function (status, label) {
        var _this = this;
        if (status) {
            this.$progress.show();
            this.options.wizard.$btnFinish.jqxButton({disabled: status});
        }
        else {
            this.$progress.hide();
            if (label) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(label, function () {
                    _this.$parent.parent().dialog('destroy');
                });
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Data Export has been successfully completed.', function () {
                    _this.$parent.parent().dialog('destroy');
                });
            }
        }
        this.options.wizard.$btnPrevious.jqxButton({disabled: status});
    };

    SelectExportJdbcPage.prototype.refreshControlValues = function () {
        this.options.wizard.result.jdbc.dbtype = this.$dbtype.jqxDropDownList('val');
        this.options.wizard.result.jdbc.host = this.$host.jqxInput('val');
        this.options.wizard.result.jdbc.port = this.$port.jqxInput('val');
        this.options.wizard.result.jdbc.service = this.$service.jqxInput('val');
        this.options.wizard.result.jdbc.username = this.$username.jqxInput('val');
        this.options.wizard.result.jdbc.password = this.$password.jqxInput('val');
        this.options.wizard.result.jdbc.connectiontimeout = this.$connectionTimeout.getValue() || '600';
        this.options.wizard.result.jdbc.logintimeout = this.$loginTimeout.getValue() || '600';
        this.options.wizard.result.jdbc.sockettimeout = this.$socketTimeout.getValue() || '600';
        this.options.wizard.result.jdbc.locktimeout = this.$lockTimeout.getValue() || '600';
        this.options.wizard.result.jdbc.tablename = this.$tablename.jqxInput('val');
    };

    SelectExportJdbcPage.prototype.handleExportFileSelected = function () {
        var _this = this;

        var wizardOption = _this.options.wizard;

        var $fileName = this.$contentsControl.find('.filename');
        $fileName.empty();
        $fileName.append($('' +
            '<span class="brtc-va-icon brtc-va-wizardpage-dataupload file"></span>' +
            '<span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(wizardOption.options.name) + '</span>'));

    };

    SelectExportJdbcPage.prototype.destroy = function () {
        this.$dbtype.jqxDropDownList('destroy');
    };


    Brightics.VA.Core.Wizards.Pages.SelectExportJdbcPage = SelectExportJdbcPage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SelectExportTypePage(parentId, options) {
        this.options = options;
        this.options.class = 'selectexporttypepage';

        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);
    }

    SelectExportTypePage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SelectExportTypePage.prototype.constructor = SelectExportTypePage;

    SelectExportTypePage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.options.wizard.result.copyFrom  = 'local';

        this.options.wizard.$btnFinish.jqxButton({disabled: true});
        this.options.wizard.$btnPrevious.jqxButton({disabled: true});
        this.options.wizard.$btnNext.jqxButton({disabled: false});
    };

    SelectExportTypePage.prototype.createHeaderArea = function ($parent) {
    };

    SelectExportTypePage.prototype.createContentsArea = function ($parent) {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this, $parent);
        var _this = this;

        this.$local = $('' +
            '<div class="selector" value="local">' +
            '   <span class="brtc-va-icon file"></span>' +
            '   <span class="brtc-va-label">Local</span>' +
            '</div>');

        this.$jdbc = $('' +
            '<div class="selector" value="jdbc">' +
            '   <span class="brtc-va-icon grid"></span>' +
            '   <span class="brtc-va-label">Relational Database</span>' +
            '</div>');

        $parent.append(this.$local);
        $parent.append(this.$jdbc);

        this.$local.jqxRadioButton({
            width: '100%',
            height: 50,
            theme: Brightics.VA.Env.Theme,
            groupName: "Group",
            checked: true
        });
        this.$jdbc.jqxRadioButton({
            width: '100%',
            height: 50,
            theme: Brightics.VA.Env.Theme,
            groupName: "Group"
        });

        $parent.find('.selector').on('checked', function () {
            _this.refreshSelection($(this).attr('value'));
        });

        $parent.perfectScrollbar();
    };

    SelectExportTypePage.prototype.refreshSelection = function (type) {
        this.options.wizard.result.copyFrom = type;
        this.options.wizard.$btnNext.jqxButton({disabled: false});
    };

    SelectExportTypePage.prototype.getParam = function () {
        return {
            copyFrom: _.isEqual(this.$local.val(), true)? 'local' : 'jdbc'
        }
    };

    Brightics.VA.Core.Wizards.Pages.SelectExportTypePage = SelectExportTypePage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const IP_REGEX = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;

    function SelectJdbcDataPage(parentId, options) {
        this.options = options;
        this.options.class = 'selectjdbcdatapage';
        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);

        this.options.wizard.registerEvent('changeData');
    }

    SelectJdbcDataPage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SelectJdbcDataPage.prototype.constructor = SelectJdbcDataPage;

    SelectJdbcDataPage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        this.options.wizard.$btnNext.jqxButton({disabled: false});
        this.options.wizard.$btnFinish.jqxButton({disabled: true});

        this.$message.text('');
        this.options.wizard.result.data = this.options.wizard.result.data || [];
        this.options.wizard.result.jdbc = this.options.wizard.result.jdbc || {};

        if (this.$host.jqxInput('val') != '' && this.$port.jqxInput('val') != '' && this.$service.jqxInput('val') != ''
            && this.$username.jqxInput('val') != '' && this.$password.jqxInput('val') != '' && this.$tablename.jqxInput('val') != '')
            this.$contentsControl.find('.connect').jqxButton({disabled: false});
        else
            this.$contentsControl.find('.connect').jqxButton({disabled: true});
    };

    SelectJdbcDataPage.prototype.createHeaderArea = function ($parent) {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.createHeaderArea.call(this, $parent);

        $parent.addClass('brtc-va-wizardpage-dataupload');
        this.$wizardHeader = $('' +
            '   <div class="step01">' +
            '       <span class="brtc-va-icon step normal selected"></span>' +
            '       <p class="step normal selected"><strong>01</strong> Select Data</p>' +
            '   </div>' +
            '   <div class="step02">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>02</strong> Set Delimiter</p>' +
            '   </div>' +
            '   <div class="step03">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>' +
            '   </div>');
        $parent.append(this.$wizardHeader);
    };

    SelectJdbcDataPage.prototype.refreshConnectControl = function () {
        this.$message.text('');
        this.options.wizard.$btnNext.jqxButton({disabled: true});

        var host = this.$host.val(), port = this.$port.val();
        var $connect = this.$contentsControl.find('.connect');
        if (host != '' && port != ''
            && this.$service.jqxInput('val') != ''
            && this.$username.jqxInput('val') != ''
            && this.$password.jqxInput('val') != ''
            && this.$tablename.jqxInput('val') != '')
            $connect.jqxButton({disabled: !(IP_REGEX.test(host) && (Brightics.VA.Core.Utils.InputValidator.isValid.integerType(port) && port < 65535))});
        else
            $connect.jqxButton({disabled: true});
    };

    SelectJdbcDataPage.prototype.createContentsArea = function ($parent) {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this, $parent);
        var _this = this;
        $parent.addClass('brtc-va-wizardpage-dataupload');
        $parent.append($('' +
            '   <div class="brtc-va-wizard-contents-property db-type-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">DB Type :</div>' +
            '       <div class="brtc-va-wizard-contents-property-input db-type" />' +
            '       <input type="button" class="connect" value="Connection Test" />' +
            '       <div class="message-container"><span class="message"/></div>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Host :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input host" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Port :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input port" maxlength="5"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Service :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input service" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Username :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input username" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Password :</div>' +
            '       <input type="password" class="brtc-va-wizard-contents-property-input password" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property">' +
            '       <div class="brtc-va-wizard-contents-property-label mandatory">Table Name :</div>' +
            '       <input type="text" class="brtc-va-wizard-contents-property-input tablename" maxlength="80"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property socket-timeout-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label">Socket :</div>' +
            '       <div  class="brtc-va-wizard-contents-property-input socket-timeout"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property lock-timeout-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label">Lock :</div>' +
            '       <div  class="brtc-va-wizard-contents-property-input lock-timeout"/>' +
            '   </div>' +
            '   <div class="brtc-va-wizard-contents-property upload-to-contents">' +
            '       <div class="brtc-va-wizard-contents-property-label">Add To :</div>' +
            '       <div class="brtc-va-radio">' +
            '           <div class="brtc-va-radio-button" id="upload-to-shared-jdbc" value="shared">Shared</div>' +
            '       </div>' +
            '       <div class="brtc-va-radio">' +
            '           <div class="brtc-va-radio-button" id="upload-to-userid-jdbc" value="' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(Brightics.VA.Env.Session.userId) + '"><span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(Brightics.VA.Env.Session.userId) + '</span></div>' +
            '       </div>' +
            '   </div>'));

        this.$dbtype = $parent.find('.db-type');
        this.$dbtype.jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            source: ["Postgre"],
            selectedIndex: 0
        });
        $parent.find(':text').jqxInput({
            theme: Brightics.VA.Env.Theme,
            maxLength: 30
        });
        $parent.find(':password').jqxInput({
            theme: Brightics.VA.Env.Theme,
            maxLength: 30
        });

        $parent.find('.connect').jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: 150,
            height: 27
        });

        $parent.find('#upload-to-shared-jdbc').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 25,
            width: 100,
            boxSize: '18px',
            groupName: 'jdbc'
        });
        $parent.find('#upload-to-userid-jdbc').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 25,
            width: 100,
            boxSize: '18px',
            groupName: 'jdbc',
            checked: true
        });

        $parent.find('.brtc-va-radio-button').on('checked', function (event) {
            _this.options.wizard.result.uploadTo = this.getAttribute('value');
        });

        $parent.jqxValidator({
            hintType: 'label',
            animationDuration: 10,
            closeOnClick: false,
            rules: [
                {
                    input: '.host',
                    message: '[0~255].[0~255].[0~255].[0~255]',
                    action: 'keyup',
                    rule: function (inputs, commit) {
                        var $target = _this.findActivatedInput(inputs);
                        return ($target)?  IP_REGEX.test($target.val()) : false;
                    }
                }, {
                    input: '.port',
                    message: '[0~65535]',
                    action: 'keyup',
                    rule: function (inputs, commit) {
                        var $target = _this.findActivatedInput(inputs);
                        return ($target)?  Brightics.VA.Core.Utils.InputValidator.isValid.integerType($target.val()) && $target.val() < 65536 : false;
                    }
                }
            ]
        });
        this.$host = $parent.find('.host');
        this.$port = $parent.find('.port');
        this.$service = $parent.find('.service');
        this.$username = $parent.find('.username');
        this.$password = $parent.find('.password');
        this.$socketTimeout = new Brightics.VA.Core.Widget.Controls.NumericInput($parent.find('.socket-timeout'), {
            numberType: 'int',
            minus: false,
            placeholder: 'Timeout(sec) Default: 600',
            max: 3000
        });
        $parent.find('.socket-timeout').find('.brtc-va-widgets-controls-numericInput').addClass('widthfree');

        this.$lockTimeout = new Brightics.VA.Core.Widget.Controls.NumericInput($parent.find('.lock-timeout'), {
            numberType: 'int',
            minus: false,
            placeholder: 'Timeout(sec) Default: 600',
            max: 3000
        });
        $parent.find('.lock-timeout').find('.brtc-va-widgets-controls-numericInput').addClass('widthfree');

        this.$tablename = $parent.find('.tablename');
        this.$message = $parent.find('.message');

        $parent.find(':text').on('change', function () {
            if (_this.$mainControl.is(':visible')) _this.refreshConnectControl();
        });

        $parent.find(':password').on('change', function () {
            if (_this.$mainControl.is(':visible')) _this.refreshConnectControl();
        });

        $parent.find('.connect').on('click', function () {
            _this.refreshControlValues();

            $.ajax({
                type: 'GET',
                url: 'api/va/v2/rsa/publickey',
                blocking: true
            }).done(function (data) {
                var rsa = new RSAKey();
                _this.publicN = data.publicN;
                _this.publicE = data.publicE;
                rsa.setPublic(data.publicN, data.publicE);
                var encrypted_password = rsa.encrypt(_this.options.wizard.result.jdbc.password);

                var option = {
                    url: 'api/va/v2/datasources/external/query',
                    method: 'POST',
                    data: {
                        dbtype: _this.options.wizard.result.jdbc.dbtype,
                        host: _this.options.wizard.result.jdbc.host,
                        port: _this.options.wizard.result.jdbc.port,
                        service: _this.options.wizard.result.jdbc.service,
                        username: _this.options.wizard.result.jdbc.username,
                        password: encrypted_password,
                        tablename: _this.options.wizard.result.jdbc.tablename
                    },
                    blocking: true
                };

                $.ajax(option).done(function (data) {
                    _this.$message.text('SUCCESS');
                    _this.options.wizard.$btnNext.jqxButton({disabled: false});
                }).fail(function (err) {
                    _this.$message.text('FAILED');
                    _this.options.wizard.$btnNext.jqxButton({disabled: true});
                    if (err.responseText.includes('does not exist')) {
                        Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Table does not exist.');
                    }
                });
            }).fail(function (err) {
                _this.$message.text('FAILED');
                _this.options.wizard.$btnNext.jqxButton({disabled: true});
            });
        });
    };

    SelectJdbcDataPage.prototype.doFinish = function (callback) {
        var _this = this;
        var rsa = new RSAKey();
        rsa.setPublic(_this.publicN, _this.publicE);
        var encrypted_password = rsa.encrypt(this.options.wizard.result.jdbc.password);

        this.refreshControlValues();

        $.ajax({
            url: 'api/va/v2/datasources/external/schema',
            method: 'POST',
            data: {
                dbtype: _this.options.wizard.result.jdbc.dbtype,
                host: this.options.wizard.result.jdbc.host,
                port: this.options.wizard.result.jdbc.port,
                service: this.options.wizard.result.jdbc.service,
                username: this.options.wizard.result.jdbc.username,
                password: encrypted_password,
                tablename: this.options.wizard.result.jdbc.tablename
            },
            blocking: true
        }).done(function (data) {
            try {
                _this.options.wizard.result.data = [];

                var columns = [];
                for (var i in data) {
                    columns.push(data[i]['column_name']);
                }
                _this.options.wizard.result.data.push(columns);

                $.ajax({
                    url: 'api/va/v2/datasources/external/query',
                    method: 'POST',
                    data: {
                        dbtype: _this.options.wizard.result.jdbc.dbtype,
                        host: _this.options.wizard.result.jdbc.host,
                        port: _this.options.wizard.result.jdbc.port,
                        service: _this.options.wizard.result.jdbc.service,
                        username: _this.options.wizard.result.jdbc.username,
                        password: encrypted_password,
                        tablename: _this.options.wizard.result.jdbc.tablename
                    },
                    blocking: true
                }).done(function (data) {
                    for (var j in data) {
                        var row = [];
                        for (var k = 0; k < Object.keys(data[j]).length; k++) {
                            row.push(data[j][columns[k]] || '');
                        }
                        _this.options.wizard.result.data.push(row);
                    }
                    _this.options.wizard.triggerEvent('changeData', true);
                    callback();
                }).fail(function (err) {
                    Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Table does not exist.', function () {
                        _this.options.wizard.$btnNext.jqxButton({disabled: true});
                    });
                });
            } catch (err) {
            }
        });
    };

    SelectJdbcDataPage.prototype.refreshControlValues = function () {
        this.options.wizard.result.jdbc.dbtype = this.$dbtype.jqxDropDownList('val');
        this.options.wizard.result.jdbc.host = this.$host.jqxInput('val');
        this.options.wizard.result.jdbc.port = this.$port.jqxInput('val');
        this.options.wizard.result.jdbc.service = this.$service.jqxInput('val');
        this.options.wizard.result.jdbc.username = this.$username.jqxInput('val');
        this.options.wizard.result.jdbc.password = this.$password.jqxInput('val');
        this.options.wizard.result.jdbc.sorckettimeout = this.$socketTimeout.getValue() || '600';
        this.options.wizard.result.jdbc.locktimeout = this.$lockTimeout.getValue() || '600';
        this.options.wizard.result.jdbc.tablename = this.$tablename.jqxInput('val');
    };

    SelectJdbcDataPage.prototype.destroy = function () {
        this.$dbtype.jqxDropDownList('destroy');
    };

    Brightics.VA.Core.Wizards.Pages.SelectJdbcDataPage = SelectJdbcDataPage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var LineNavigator = root.LineNavigator;

    function SelectLocalDataPage(parentId, options) {
        this.options = options;
        this.options.class = 'selectlocaldatapage';
        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);

        this.options.wizard.registerEvent('changeData');
    }

    SelectLocalDataPage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SelectLocalDataPage.prototype.constructor = SelectLocalDataPage;

    SelectLocalDataPage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        this.options.wizard.$btnFinish.jqxButton({disabled: true});
        if (this.options.wizard.result.fileName) // 파일 있으면
            if (!Brightics.VA.Core.Utils.InputValidator.isValid.type4(this.options.wizard.result.fileName)) {
                this.options.wizard.$btnNext.jqxButton({disabled: true});
            } else {
                this.options.wizard.$btnNext.jqxButton({disabled: false});
            }
        else
            this.options.wizard.$btnNext.jqxButton({disabled: true});

        this.options.wizard.result.data = this.options.wizard.result.data || [];
    };

    SelectLocalDataPage.prototype.createHeaderArea = function ($parent) {
        $parent.addClass('brtc-va-wizardpage-dataupload');
        this.$wizardHeader = $('' +
            '   <div class="step01">' +
            '       <span class="brtc-va-icon step normal selected"></span>' +
            '       <p class="step normal selected"><strong>01</strong> Select Data</p>' +
            '   </div>' +
            '   <div class="step02">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>02</strong> Set Delimiter</p>' +
            '   </div>' +
            '   <div class="step03">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>' +
            '   </div>');
        $parent.append(this.$wizardHeader);
    };

    SelectLocalDataPage.prototype.createContentsArea = function ($parent) {
        $parent.addClass('brtc-va-wizardpage-dataupload');

        var _this = this;
        this.options.wizard.result.uploadTo = 'shared';

        $parent.append($('' +
            '   <div class="fileselect">' +
            '       <div style="font-size: 13px; font-style: italic; margin-bottom: 20px;">Select data consisting of delimiter-separated values.</div>' +
            '       <div class="header">' +
            '           <span>File: </span>' +
            '               <input for="brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename" type="button" id="fileselect-local" value="Local" />' +
            '               <input type="file" id="brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename" name="fileToUpload" accept=".csv,.txt">' +
            '       </div>' +
            '       <div class="contents filename">' +
            '           <span class="nodata">Select file to upload</span>' +
            '       </div>' +
            '   </div>' +
            '   <div class="uploadtoselect">' +
            '       <div class="header">' +
            '           <span>Add to: </span>' +
            '       </div>' +
            '       <div class="contents">' +
            '           <div class="brtc-va-radio">' +
            '               <div class="brtc-va-radio-button" id="upload-to-shared-local" value="shared">Shared</div>' +
            '           </div>' +
            '           <div class="brtc-va-radio">' +
            '               <div class="brtc-va-radio-button" id="upload-to-userid-local" value="' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(Brightics.VA.Env.Session.userId) + '"><span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(Brightics.VA.Env.Session.userId) + '</span></div>' +
            '           </div>' +
            '       </div>' +
            '   </div>' +
            '   <div class="preview selectdata local">' +
            '       <div class="header">' +
            '           <span>Data preview</span>' +
            '       </div>' +
            '       <div class="contents">' +
            '           <span class="nodata">no data</span>' +
            '       </div>' +
            '   </div>'));

        var $btnLocal = $parent.find('#fileselect-local');
        var fileSelect = $parent.find('#brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename');


        $parent.find('#upload-to-shared-local').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 25,
            width: 100,
            boxSize: '18px',
            groupName: 'local'
        });
        $parent.find('#upload-to-userid-local').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 25,
            width: 200,
            boxSize: '18px',
            groupName: 'local',
            checked: true
        });

        $parent.find('.brtc-va-radio-button').on('checked', function (event) {
            _this.options.wizard.result.uploadTo = this.getAttribute('value');
        });

        $btnLocal.jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        $btnLocal.on('click', function () {
            fileSelect.click();
        });

        fileSelect.on('change', function (event) {
            if ($(this)[0] && $(this)[0].files[0]) {
                _this.options.wizard.triggerEvent('changeData', true);
                _this.options.wizard.result.file = $(this)[0].files[0];
    
                _this.options.wizard.result.fileName = _this.options.wizard.result.file.name;
                if (!window.FileReader) {
                    _this.options.wizard.result.fileName = $(this).val().split('/').pop().split('\\').pop();  // 파일명만 추출
                }
    
                if (!Brightics.VA.Core.Utils.InputValidator.isValid.type4(_this.options.wizard.result.fileName)) {
                    _this.alertInvalid();
                    _this.options.wizard.$btnNext.jqxButton({disabled: true});
                } else {
                    _this.handleLocalFileSelected(event);
                    _this.options.wizard.$btnNext.jqxButton({disabled: false});
                }
            } 
        });
    };

    SelectLocalDataPage.prototype.alertInvalid = function () {
        var $fileName = this.$contentsControl.find('.filename');
        $fileName.empty();

        var message = '※ File Name allows only the following characters: "a-z", "A-Z", "0-9", "_", ".".';

        $fileName.append($('' +
            '<span class="brtc-va-wizard-invalid-file-icon"></span>' +
            '<span class="brtc-va-wizard-invalid-file-name">' + message + '</span>'));
        this.reset();
        this.refreshButton();
    };

    SelectLocalDataPage.prototype.handleLocalFileSelected = function () {
        var _this = this;

        var $fileName = this.$contentsControl.find('.filename');
        $fileName.empty();
        $fileName.append($('' +
            '<span class="brtc-va-icon brtc-va-wizardpage-dataupload file"></span>' +
            '<span>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.wizard.result.fileName) + '</span>'));

        try {
            var chunkSize = (function (browserName) {
                if (browserName === 'Chrome') {
                    return 1024 * 1024 * 100; // 100MB
                } else {
                    return 1024 * 1024 * 16; // 16MB
                }
            }(Brightics.VA.Core.Utils.CommonUtils.getUserBrowserName()));
            var navigator = new LineNavigator(this.options.wizard.result.file, {
                chunkSize: chunkSize
            });
            navigator.readLines(0, 20, function (err, index, lines, isEof, progress) {
                _this.reset();
                _this.updateFileSelectPreview(lines);
            });
        } catch (err) {
            _this.refreshButton();
        }
    };

    SelectLocalDataPage.prototype.updateFileSelectPreview = function (lines) {
        var $contentArea = this.$contentsControl.find('.preview.selectdata.local').find('.contents');
        var index = 0;
        for (var i = 0; i < lines.length; i++) {
            if (!lines[i].trim()) continue;

            $contentArea.find('.number-column').append($('<li>' + (index + 1) + '</li>'));
            $contentArea.find('.data-column').append($('<li>' + Brightics.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(lines[i]) + '</li>'));

            if (index == 0 || index == 1) this.options.wizard.result.data.push(lines[i]);  //Column과 첫번째 데이터만 Data에 넣기
            index++;
        }
        this.$parent.find('.preview').find('.contents').perfectScrollbar();
    };

    SelectLocalDataPage.prototype.reset = function () {
        var $preview = this.$parent.find('.preview').find('.contents');

        this.options.wizard.result.data = [];
        $('input[type=file]').val('');

        $preview.empty();
        $preview.append($('<ul class="number-column"></ul>'));
        $preview.append($('<ul class="data-column"></ul>'));
    };

    SelectLocalDataPage.prototype.refreshButton = function (status) {
        // this.options.wizard.$btnNext.jqxButton({disabled: !status});
        // this.options.wizard.$btnFinish.jqxButton({disabled: true});
    };

    Brightics.VA.Core.Wizards.Pages.SelectLocalDataPage = SelectLocalDataPage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SelectUploadTypePage(parentId, options) {
        this.options = options;
        this.options.class = 'selectuploadtypepage';
        this.options.showNextButton = true;

        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);
    }

    SelectUploadTypePage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SelectUploadTypePage.prototype.constructor = SelectUploadTypePage;

    SelectUploadTypePage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.options.wizard.result.copyFrom  = 'local';

        this.options.wizard.$btnFinish.jqxButton({disabled: true});
        this.options.wizard.$btnPrevious.jqxButton({disabled: true});
        this.options.wizard.$btnNext.jqxButton({disabled: false});
    };

    SelectUploadTypePage.prototype.createHeaderArea = function ($parent) {
    };

    SelectUploadTypePage.prototype.createContentsArea = function ($parent) {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this, $parent);
        var _this = this;

        this.$local = $('' +
            '<div class="selector" value="local">' +
            '   <span class="brtc-va-icon file"></span>' +
            '   <span class="brtc-va-label">Local</span>' +
            '</div>');

        this.$alluxio = $('' +
            '<div class="selector" value="alluxio">' +
            '   <span class="brtc-va-icon file"></span>' +
            '   <span class="brtc-va-label">Remote</span>' +
            '</div>');

        this.$jdbc = $('' +
            '<div class="selector" value="jdbc">' +
            '   <span class="brtc-va-icon grid"></span>' +
            '   <span class="brtc-va-label">Relational Database</span>' +
            '</div>');
        
        $parent.append(this.$local);
        $parent.append(this.$alluxio);
        $parent.append(this.$jdbc);

        this.$local.jqxRadioButton({
            width: '100%',
            height: 50,
            theme: Brightics.VA.Env.Theme,
            groupName: "Group",
            checked: true
        });
        this.$alluxio.jqxRadioButton({
            width: '100%',
            height: 50,
            theme: Brightics.VA.Env.Theme,
            groupName: "Group"
        });
        this.$jdbc.jqxRadioButton({
            width: '100%',
            height: 50,
            theme: Brightics.VA.Env.Theme,
            groupName: "Group"
        });

        $parent.find('.selector').on('checked', function () {
            _this.refreshSelection($(this).attr('value'));
        });

        $parent.perfectScrollbar();
    };

    SelectUploadTypePage.prototype.refreshSelection = function (type) {
        this.options.wizard.result.copyFrom = type;
        this.options.wizard.$btnNext.jqxButton({disabled: false});
    };

    SelectUploadTypePage.prototype.getParam = function () {
        return {
            copyFrom: 
                _.isEqual(this.$local.val(), true)? 'local' : 
                _.isEqual(this.$alluxio.val(), true)? 'alluxio' : 'jdbc'
        }
    };

    Brightics.VA.Core.Wizards.Pages.SelectUploadTypePage = SelectUploadTypePage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */

/* global crel */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetColumnDataTypePage(parentId, options) {
        this.options = options;
        this.options.class = 'setcolumndatatypepage';
        this.columnType = {
            'double': 'Double',
            'string': 'String',
            'integer': 'Integer',
            'long': 'Long',
            'boolean': 'Boolean'
        };
        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);

        var _this = this;
        this.options.wizard.addEventListener('changeData', function (event, eventData) {
            if (eventData) {
                _this.options.wizard.result.columnName = [];
                _this.options.wizard.result.columnType = [];
                if (_this.$grid) {
                    _this.clearGridColumnSelection();
                    _this.clearSearchInput();
                    _this.removeGridColumnFilter();
                }
            }
        });

        this.options.wizard.addEventListener('changeDelimiter', function (event, eventData) {
            if (eventData) {
                _this.options.wizard.result.columnName = [];
                _this.options.wizard.result.columnType = [];
                if (_this.$grid) {
                    _this.clearGridColumnSelection();
                    _this.clearSearchInput();
                    _this.removeGridColumnFilter();
                }
            }
        });
    }

    SetColumnDataTypePage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SetColumnDataTypePage.prototype.constructor = SetColumnDataTypePage;

    SetColumnDataTypePage.prototype.createHeaderArea = function ($parent) {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.createHeaderArea.call(this, $parent);

        $parent.addClass('brtc-va-wizardpage-dataupload');
        $parent.append($('' +
            '   <div class="step01">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>01</strong> Select Data</p>' +
            '   </div>' +
            '   <div class="step02">' +
            '       <span class="brtc-va-icon step disabled"></span>' +
            '       <p class="step disabled"><strong>02</strong> Set Delimiter</p>' +
            '   </div>' +
            '   <div class="step03">' +
            '       <span class="brtc-va-icon step normal selected"></span>' +
            '       <p class="step normal selected"><strong>03</strong> Set Column Data Format</p>' +
            '   </div>'));
    };

    SetColumnDataTypePage.prototype.createContentsArea = function ($parent) {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this, $parent);

        this.createProgressSpinnerArea($parent);
        this.createChangeInputArea($parent);
        this.createGridArea($parent);
        this.createInvalidColumnNameDetailArea();
        this.createNotification();
    };

    SetColumnDataTypePage.prototype.createProgressSpinnerArea = function ($parent) {
        this.$progress = $('' +
            '   <div class="brtc-va-progress">' +
            '       <div>' +
            '           <span class="brtc-va-progress-loading"/>' +
            '           <p>Adding data...</p>' +
            '           <p class="brtc-va-progress-percent"></p>' +
            '       </div>' +
            '</div>');
        $parent.append(this.$progress);
        this.$progress.hide();
    };

    SetColumnDataTypePage.prototype.createChangeInputArea = function ($parent) {
        $parent.append($('' +
            '   <div style="font-size: 13px; font-style: italic; margin-bottom: 20px;">Select the column and apply your changes. After you complete the changes, click the "Finish" button to upload all the columns.</div>' +
            '   <div class="header">' +
            '       <span>Column name and type: </span>' +
            '    </div>' +
            '   <div class="brtc-va-change-input-area">' +
            '       <div class="contents">' +
            '           <div class="brtc-va-change-name-row">' +
            '               <div class="brtc-va-change-name-label-wrapper">' +
            '                  <div class="brtc-va-change-name-label">Name</div>' +
            '               </div>' +
            '               <div class="brtc-va-change-name-search-input-wrapper">' +
            '                   <input type="search" class="brtc-va-change-name-search-input" tabIndex="101"/>' +
            '               </div>' +
            '               <div class="brtc-va-change-name-find-input-wrapper">' +
            '                   <input type="text" class="brtc-va-change-name-find-input" tabIndex="102"/>' + //jqxGrid에 데이터가 생성될때 내부적으로 tabindex = "1", "2"를 만들기 때문에 훨씬 큰 수로 적용하였음. 2017. 09. 27
            '               </div>' +
            '               <div class="brtc-va-change-name-replace-input-wrapper">' +
            '                   <input type="text" class="brtc-va-change-name-replace-input" tabIndex="103"/>' +
            '               </div>' +
            '               <div class="brtc-va-change-name-replace-button-wrapper">' +
            '                   <input type="button" value="Replace" class="brtc-va-change-name-replace-button" tabIndex="104"/>' +
            '               </div>' +
            '           </div>' +
            '           <div class="brtc-va-change-type-row">' +
            '               <div class="brtc-va-change-type-label-wrapper">' +
            '                   <div class="brtc-va-change-type-label">Type</div>' +
            '               </div>' +
            '               <div class="brtc-va-change-type-search-input-wrapper">' +
            '                   <input type="search" class="brtc-va-change-type-search-input" tabIndex="105"/>' +
            '               </div>' +
            '               <div class="brtc-va-change-type-button-area">' +
            '                  <div class="brtc-va-button-wrapper">' +
            '                      <input type="button" class="brtc-va-change-button" value="String"/>' +
            '                   </div>' +
            '                   <div class="brtc-va-button-wrapper">' +
            '                       <input type="button" class="brtc-va-change-button" value="Double"/>' +
            '                   </div>' +
            '                   <div class="brtc-va-button-wrapper">' +
            '                       <input type="button" class="brtc-va-change-button" value="Integer"/>' +
            '                   </div>' +
            '                   <div class="brtc-va-button-wrapper">' +
            '                       <input type="button" class="brtc-va-change-button" value="Long"/>' +
            '                   </div>' +
            '                   <div class="brtc-va-button-wrapper">' +
            '                       <input type="button" class="brtc-va-change-button last" value="Boolean"/>' +
            '                   </div>' +
            '               </div>' +
            '           </div>' +
            '       </div>' +
            '   </div>'));
        this.createChangeNameArea($parent);
        this.createChangeTypeArea($parent);
    };

    /** Create Change Name Area **/
    SetColumnDataTypePage.prototype.createChangeNameArea = function ($parent) {
        this.createColumnSearchInput($parent);
        this.createColumnFindInput($parent);
        this.createColumnReplaceInput($parent);
        this.createColumnReplaceButton($parent);
    };

    SetColumnDataTypePage.prototype.createColumnSearchInput = function ($parent) {
        var _this = this;
        this.$columnSearchInput = $parent.find('.brtc-va-change-name-search-input');
        this.$columnSearchInput.jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 255,
            height: 28,
            placeHolder: 'Search Name'
        });

        this.$columnSearchInput.on('change', function (event) {
            if (event.args && event.args.type && event.args.type === 'keyboard') {
                _this.applyGridColumnNameFilter();
            }
        });
    };

    SetColumnDataTypePage.prototype.createColumnFindInput = function ($parent) {
        this.$columnFindInput = $parent.find('.brtc-va-change-name-find-input');
        this.$columnFindInput.jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 125,
            height: 28,
            placeHolder: 'Find'
        });
    };

    SetColumnDataTypePage.prototype.createColumnReplaceInput = function ($parent) {
        this.$columnReplaceInput = $parent.find('.brtc-va-change-name-replace-input');
        this.$columnReplaceInput.jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 125,
            height: 28,
            placeHolder: 'Replace'
        });
    };

    SetColumnDataTypePage.prototype.createColumnReplaceButton = function ($parent) {
        var _this = this;
        this.$columnReplaceButton = $parent.find('.brtc-va-change-name-replace-button');
        this.$columnReplaceButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: 60,
            height: 28
        });

        this.$columnReplaceButton.on('click', function (event) {
            _this.replaceColumnName();
        });
    };

    SetColumnDataTypePage.prototype.replaceColumnName = function () {
        var selectedrowindex = this.$grid.jqxGrid('getselectedrowindexes');
        // 선택한 것이 있는 경우
        if (selectedrowindex.length) {
            var findValue = this.$columnFindInput.val();
            var replaceValue = this.$columnReplaceInput.val();

            if (findValue) {
                var regexp = new RegExp(findValue, 'g');
                for (var i = 0; i < selectedrowindex.length; i++) {
                    if (selectedrowindex[i] >= 0) {
                        this.options.wizard.result.columnName[selectedrowindex[i]] = this.options.wizard.result.columnName[selectedrowindex[i]].replace(regexp, replaceValue);
                    }
                }
                // updaterow method보다 jqxGrid에 source를 다시 넣어버리는 것이 훨씬 빠르다.
                this.fillColumnGrid();
                this.checkColumnNameValidation();
                this.refreshGridColumnFilter();
                this.showSuccessNotification('Column names were updated successfully.');
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openWarningDialog('Please enter "Find" word.');
            }
        } else {
            Brightics.VA.Core.Utils.WidgetUtils.openWarningDialog('There is no selected column.');
        }
    };

    /** Create Change Type Area **/
    SetColumnDataTypePage.prototype.createChangeTypeArea = function ($parent) {
        this.createSearchTypeInput($parent);
        this.createChangeTypeButtons($parent);
    };

    SetColumnDataTypePage.prototype.createSearchTypeInput = function ($parent) {
        var _this = this;
        this.$typeSearchInput = $parent.find('.brtc-va-change-type-search-input');

        this.$typeSearchInput.jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 255,
            height: 28,
            placeHolder: 'Search Type'
        });

        this.$typeSearchInput.on('change', function (event) {
            if (event.args && event.args.type && event.args.type === 'keyboard') {
                _this.applyGridColumnTypeFilter();
            }
        });
    };

    SetColumnDataTypePage.prototype.createChangeTypeButtons = function ($parent) {
        var _this = this;
        this.$typeChangeButtons = $parent.find('.brtc-va-change-button');

        this.$typeChangeButtons.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: 60,
            height: 28
        });

        this.$typeChangeButtons.on('click', function (event) {
            _this.changeColumnType($(this).attr('value'));
        });
    };

    SetColumnDataTypePage.prototype.changeColumnType = function (value) {
        var selectedrowindex = this.$grid.jqxGrid('getselectedrowindexes');
        // 선택한 것이 있는 경우만
        if (selectedrowindex.length) {
            for (var i = 0; i < selectedrowindex.length; i++) {
                if (selectedrowindex[i] >= 0) {
                    this.options.wizard.result.columnType[selectedrowindex[i]] = value;
                }
            }
            // updaterow method보다 jqxGrid에 source를 다시 넣어버리는 것이 훨씬 빠르다.
            this.fillColumnGrid();
            this.refreshGridColumnFilter();
            this.showSuccessNotification('Column types were updated successfully.');
        } else {
            Brightics.VA.Core.Utils.WidgetUtils.openWarningDialog('There is no selected column.');
        }
    };

    SetColumnDataTypePage.prototype.clearSearchInput = function () {
        this.clearColumnSearchInput();
        this.clearFindInput();
        this.clearReplaceInput();
        this.clearTypeSearchInput();
    };

    SetColumnDataTypePage.prototype.clearColumnSearchInput = function () {
        this.$columnSearchInput.val('');
    };

    SetColumnDataTypePage.prototype.clearFindInput = function () {
        this.$columnFindInput.val('');
    };

    SetColumnDataTypePage.prototype.clearReplaceInput = function () {
        this.$columnReplaceInput.val('');
    };

    SetColumnDataTypePage.prototype.clearTypeSearchInput = function () {
        this.$typeSearchInput.val('');
    };

    /** Create Grid Area **/
    SetColumnDataTypePage.prototype.createGridArea = function ($parent) {
        $parent.append($('' +
            '   <div class="brtc-va-grid-area">' +
            '       <div class="contents">' +
            '           <div class="columns-table" tabIndex="-1"></div>' +
            '       </div>' +
            '       <div class="brtc-va-wizard-message-area">' +
            '           <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' +
            '           <div class="brtc-va-wizard-message-label"></div>' +
            '           <div class="brtc-va-wizard-message-show-detail">Detail</div>' +
            '       </div>' +
            '   </div>'));
        this.$messageArea = $parent.find('.brtc-va-wizard-message-area');
        this.$messageDetailArea = $parent.find('.brtc-va-wizard-message-show-detail');
        this.createColumnGrid($parent);
    };

    SetColumnDataTypePage.prototype.createColumnGrid = function ($parent) {
        var _this = this;
        this._invalidConlumnNameMap = {};
        var $grid = $('<div class="brtc-va-setcolumndatatype-preview-column-grid" tabIndex="-1"></div>');
        $parent.find('.columns-table').append($grid);

        var dataAdapter = this._getGridDataAdapter();
        this.dataAdapter = dataAdapter;
        this.$grid = $grid.jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: 619,
            height: 215,
            rowsheight: 25,
            source: this.dataAdapter,
            selectionmode: 'checkbox',
            filterable: false,
            editable: true,
            keyboardnavigation: false,
            columnsresize: true,
            columns: [
                {
                    text: 'No.', sortable: false, filterable: false, editable: false,
                    groupable: false, draggable: false, resizable: false,
                    datafield: '', columntype: 'number', width: 50,
                    cellsrenderer: function (row, column, value) {
                        return '<div style="margin:4px;">' + (row + 1) + '</div>';
                    }
                },
                {
                    text: 'Name', datafield: 'column-name', filtertype: 'input', editable: true, filterable: false,
                    cellsrenderer: function (row, datafield, value) {
                        var $cell = $('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');
                        $cell.attr('title', value);
                        $cell.text(value);
                        var invalidList = _this._invalidConlumnNameMap[row];
                        if (invalidList.length > 0) {
                            $cell.css('color', 'rgba(194, 6, 17, .65)');
                        } else {
                            $cell.css('color', '#000');
                        }
                        return $('<div>').append($cell.clone()).html();
                    }
                },
                {
                    text: 'Type',
                    datafield: 'column-type',
                    displayfield: 'column-type-dropdown',
                    columntype: 'dropdownlist',
                    filtertype: 'checkedlist',
                    filterable: false,
                    editable: true,
                    createeditor: function (row, value, editor) {
                        editor.jqxDropDownList({
                            source: _this._getDropDownAdapter(),
                            displayMember: 'label',
                            valueMember: 'value'
                        });
                        editor.css('margin-left', '1px');
                        editor.css('margin-top', '1px');
                        editor.css('height', (editor.height - 2) + 'px');
                    }
                },
                {
                    text: 'First Data', datafield: 'column-data', editable: false, filterable: false,
                    cellsrenderer: function (row, datafield, value) {
                        var $cell = $('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');
                        $cell.attr('title', value);
                        $cell.text(value);
                        return $('<div>').append($cell.clone()).html();
                    }
                },
                {
                    text: 'Error Message',
                    datafield: 'column-name-invalid',
                    editable: false,
                    filterable: false,
                    hidden: true,
                    cellsrenderer: function (row, datafield, value) {
                        if (_this._invalidConlumnNameMap[row].length === 0) return '';
                        var $cell = $('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');
                        $cell.attr('title', value);
                        $cell.text(_this._invalidConlumnNameMap[row].join(' '));
                        return $('<div>').append($cell.clone()).html();
                    }
                }
            ]
        });

        this.$grid.on('cellendedit', function (event) {
            var rowIndex = event.args.rowindex;
            if (event.args.datafield === 'column-name') {
                if (_this.options.wizard.result.columnName[rowIndex] != event.args.value) {
                    _this.options.wizard.result.columnName[rowIndex] = event.args.value;

                    _this._createCountOfColumnNameMap();
                    _this._setInvalidColumnNameMapByRow(rowIndex, event.args.value);

                    _this.$grid.jqxGrid({
                        source: _this._getGridDataAdapter()
                    });
                    setTimeout(function () {
                        _this.checkColumnNameValidation();
                        _this.refreshGridColumnFilter();
                        _this.showSuccessNotification('Column name was updated successfully.');
                    }, 300);
                }
            } else if (event.args.datafield === 'column-type') {
                if (_this.options.wizard.result.columnType[rowIndex] != event.args.value['value']) {
                    _this.options.wizard.result.columnType[rowIndex] = event.args.value['value'];
                    setTimeout(function () {
                        _this.refreshGridColumnFilter();
                        _this.showSuccessNotification('Column type was updated successfully.');
                    }, 300);
                }
            }
        });

        // 선택된 것 중 display되지 않는 것은 unselect 한다.
        this.$grid.on('filter', function (event) {
            var displayRows = _this.$grid.jqxGrid('getdisplayrows');
            if (displayRows.length) {
                var displayRowsHashMap = {};
                var displaySelectedRows = [];
                var selectedRowIndexes = $.extend(true, [], _this.$grid.jqxGrid('getselectedrowindexes'));

                // create HashMap: inArray 대신 hasOwnProperty로 비교하기 위해 HashMap 생성
                displayRows.forEach(function (element) {
                    displayRowsHashMap[element.uid] = true;
                });

                // get displaySelectedRows
                for (var i = 0; i < selectedRowIndexes.length; i++) {
                    // filter 적용 후 display된 row 중, selected 되어 있는 row만 displaySelectedRows에 push
                    if (displayRowsHashMap.hasOwnProperty(selectedRowIndexes[i])) {
                        displaySelectedRows.push(selectedRowIndexes[i]);
                    }
                }
                _this.$grid.jqxGrid({selectedrowindexes: displaySelectedRows});
            } else {
                _this.clearGridColumnSelection();
            }
            _this.$grid.jqxGrid('refreshdata');
        });

        // Tab을 계속 누르고 있으면 Grid가 자동으로 scroll 되어버려서
        // Grid 아래 부분이 이상하게 깨지는 버그 때문에 javascript 로직으로 처리하였음.
        // 다른 방법이 있으면 수정 필요.
        // 2017. 09. 27
        this.$grid.on('keydown', function (event) {
            // Tab (keyCode: 9)
            if (event.keyCode == 9) {
                // Grid에서 Tab이 입력되면 event 막기
                if ($(event.target).parents('.brtc-va-setcolumndatatype-preview-column-grid').length
                    || $(event.target).hasClass('brtc-va-setcolumndatatype-preview-column-grid')) {
                    event.preventDefault();
                    event.stopPropagation();
                }
            }
        });
    };

    /** init **/
    SetColumnDataTypePage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        this.options.wizard.$btnNext.jqxButton({disabled: true});
        this.options.wizard.$btnFinish.jqxButton({disabled: false});

        this.options.wizard.result.columnName = this.options.wizard.result.columnName || [];
        this.options.wizard.result.columnType = this.options.wizard.result.columnType || [];
        this.extractColumnName();
        this.checkColumnNameValidation();
        this.extractColumnType();
        this.fillColumnGrid();
    };

    SetColumnDataTypePage.prototype.extractColumnName = function () {
        if (this.options.wizard.result.columnName && this.options.wizard.result.columnName.length === 0 && this.options.wizard.result.data[0]) {
            var data = this.options.wizard.result.data;
            if (data[0] && data[0].length) {
                var columns;
                if ($.isArray(data[0])) {
                    columns = data[0];
                } else {
                    columns = data[0].split(this.options.wizard.result.delimiter || ',');
                }
                this.options.wizard.result.columnName = columns;
            }
        }
    };

    SetColumnDataTypePage.prototype.extractColumnType = function () {
        if (this.options.wizard.result.columnName && this.options.wizard.result.columnName.length !== 0) {
            var columns = this.options.wizard.result.columnName;
            var columnType = this.options.wizard.result.columnType;
            var data = this.options.wizard.result.data;
            this.dataArray = undefined;

            if ($.isArray(data[0])) {
                this.dataArray = data[1] || [];
            } else {
                this.dataArray = [];
                if (this.options.wizard.result.data[1]) {
                    this.dataArray = this.options.wizard.result.data[1].split(this.options.wizard.result.delimiter || ',');
                }
            }

            for (var i = 0; i < columns.length; i++) {
                if (columnType[i] === undefined) {
                    columnType[i] = this.columnType.string;
                    if (this.dataArray[i] && $.isNumeric(this.dataArray[i])) {
                        columnType[i] = this.columnType.double;
                    }
                }
            }
        }
    };

    SetColumnDataTypePage.prototype.fillColumnGrid = function () {
        var dataAdapter = this._getGridDataAdapter();
        this.$grid.jqxGrid({
            source: dataAdapter
        });
    };

    SetColumnDataTypePage.prototype._getGridDataAdapter = function () {
        var data = this._getGridData();
        var columnTypeAdapter = this._getDropDownAdapter();
        var source = {
            localdata: data,
            datatype: 'array',
            datafields: [
                {name: 'column-name', type: 'string'},
                {name: 'column-type', type: 'string'},
                {name: 'column-data', type: 'string'},
                {
                    name: 'column-type-dropdown',
                    value: 'column-type',
                    values: {source: columnTypeAdapter.records, value: 'value', name: 'label'}
                },
                {name: 'column-name-invalid', type: 'string'},
            ]
        };
        return new $.jqx.dataAdapter(source);
    };

    SetColumnDataTypePage.prototype._getGridData = function () {
        var data = [];
        var _this = this;
        if (this.dataArray && this.options.wizard.result.columnName && this.options.wizard.result.columnName.length !== 0) {
            var columns = this.options.wizard.result.columnName;
            var columnType = this.options.wizard.result.columnType;
            var dataArray = this.dataArray;

            this._createCountOfColumnNameMap();

            data = $.map(columns, function (columnName, index) {
                _this._setInvalidColumnNameMapByRow(index, columnName);
                return {
                    'column-name': columnName,
                    'column-type': columnType[index],
                    'column-data': dataArray[index],
                    'column-name-invalid': (_this._invalidConlumnNameMap[index].length > 0) ? _this._invalidConlumnNameMap[index] : ''
                }
            });
        }
        return data;
    };
    SetColumnDataTypePage.prototype._setInvalidColumnNameMapByRow = function (row, value) {

        this._invalidConlumnNameMap[row] = [];
        var invalidList = this._invalidConlumnNameMap[row];
        if (this._isColumnNameEmpty(value)) {
            invalidList.push('Column name cannot be empty.');
        } else {
            if (this._hasSpaceChar(value)) {
                invalidList.push('Column name cannot ues white space.');
            }
            if (this._hasInvalidChar(value)) {
                invalidList.push('You can use alphabet, number, and \'_\' only.');
            }
            if (this._isStartedNumber(value)) {
                invalidList.push('Column name should start with alphabet characters.');
            }
            if (this._hasDuplicatedColumnName(value)) {
                invalidList.push('Some columns have same name.');
            }
        }
    };

    SetColumnDataTypePage.prototype._createCountOfColumnNameMap = function () {
        this._countOfColumnNameMap = {};
        var columnNames = this.options.wizard.result.columnName;

        for (var i = 0; i < columnNames.length; i++) {
            this._countOfColumnNameMap[columnNames[i]] = this._countOfColumnNameMap[columnNames[i]] + 1 || 1;
        }
    };

    SetColumnDataTypePage.prototype._getDropDownAdapter = function () {
        var columnType = [
            {value: 'Double', label: 'Double'},
            {value: 'String', label: 'String'},
            {value: 'Integer', label: 'Integer'},
            {value: 'Long', label: 'Long'},
            {value: 'Boolean', label: 'Boolean'}
        ];
        var columnTypeSource = {
            datatype: 'array',
            datafields: [
                {name: 'label', type: 'string'},
                {name: 'value', type: 'string'}
            ],
            localdata: columnType
        };
        return new $.jqx.dataAdapter(columnTypeSource, {autoBind: true});
    };

    SetColumnDataTypePage.prototype.getColumnNameArray = function () {
        this.options.wizard.result.columnName = [];
        this.$grid.jqxGrid('removefilter', 'column-name');
        this.$grid.jqxGrid('removefilter', 'column-type');
        var rows = this.$grid.jqxGrid('getrows');
        for (var i = 0; i < rows.length; i++) {
            this.options.wizard.result.columnName.push((rows[i]['column-name']).trim());
        }
        return this.options.wizard.result.columnName;
    };

    SetColumnDataTypePage.prototype.getColumnTypeArray = function () {
        this.options.wizard.result.columnType = [];
        this.$grid.jqxGrid('removefilter', 'column-name');
        this.$grid.jqxGrid('removefilter', 'column-type');
        var rows = this.$grid.jqxGrid('getrows');
        for (var i = 0; i < rows.length; i++) {
            this.options.wizard.result.columnType.push(rows[i]['column-type']);
        }
        return this.options.wizard.result.columnType;
    };

    SetColumnDataTypePage.prototype.clearGridColumnSelection = function () {
        this.$grid.jqxGrid('clearselection');
    };

    SetColumnDataTypePage.prototype.refreshGridColumnFilter = function () {
        this.$grid.jqxGrid('applyfilters');
        this.$grid.jqxGrid('refresh');
    };

    SetColumnDataTypePage.prototype.removeGridColumnFilter = function () {
        this.removeGridColumnNameFilter();
        this.removeGridColumnTypeFilter();
    };

    SetColumnDataTypePage.prototype.removeGridColumnNameFilter = function () {
        var datafield = 'column-name';
        this.$grid.jqxGrid('removefilter', datafield);
    };

    SetColumnDataTypePage.prototype.removeGridColumnTypeFilter = function () {
        var datafield = 'column-type';
        this.$grid.jqxGrid('removefilter', datafield);
    };

    SetColumnDataTypePage.prototype.removeInvalidColumnNameFilter = function () {
        var datafield = 'column-name-invalid';
        this.$grid.jqxGrid('removefilter', datafield);
    };

    SetColumnDataTypePage.prototype.applyGridColumnNameFilter = function () {
        this.removeGridColumnNameFilter();
        var value = this.$contentsControl.find('.brtc-va-change-name-search-input').val();
        if (value) {
            var datafield = 'column-name';
            var filtergroup = this.getGridFilterGroup(value);
            this.$grid.jqxGrid('addfilter', datafield, filtergroup);
            this.$grid.jqxGrid('applyfilters');
        }
    };

    SetColumnDataTypePage.prototype.applyGridColumnTypeFilter = function () {
        this.removeGridColumnTypeFilter();
        var value = this.$contentsControl.find('.brtc-va-change-type-search-input').val();
        if (value) {
            var datafield = 'column-type';
            var filtergroup = this.getGridFilterGroup(value);
            this.$grid.jqxGrid('addfilter', datafield, filtergroup);
            this.$grid.jqxGrid('applyfilters');
        }
    };

    SetColumnDataTypePage.prototype.applyInvalidColumnNameFilter = function () {

        this.removeInvalidColumnNameFilter();

        this.dataAdapter = this._getGridDataAdapter();
        this.dataAdapter.dataBind();
        this.$grid.jqxGrid('updatebounddata');

        var datafield = 'column-name-invalid';
        var filtergroup = this.getGridEmptyFilterGroup();
        this.$grid.jqxGrid('addfilter', datafield, filtergroup);
        this.$grid.jqxGrid('applyfilters');
    };

    SetColumnDataTypePage.prototype.getGridEmptyFilterGroup = function () {
        var filtergroup = new $.jqx.filter();
        var filtertype = 'stringfilter';
        var filter_or_operator = 1;
        var filtervalue = '';
        var filtercondition = 'NOT_EMPTY';
        var filter = filtergroup.createfilter(filtertype, filtervalue, filtercondition);
        filtergroup.addfilter(filter_or_operator, filter);
        return filtergroup;
    };

    SetColumnDataTypePage.prototype.getGridFilterGroup = function (value) {
        var filtergroup = new $.jqx.filter();
        var filtertype = 'stringfilter';
        var filter_or_operator = 1;
        var filtervalue = value;
        var filtercondition = 'contains';
        var filter = filtergroup.createfilter(filtertype, filtervalue, filtercondition);
        filtergroup.addfilter(filter_or_operator, filter);
        return filtergroup;
    };

    SetColumnDataTypePage.prototype.handleError = function (err) {
        var _this = this;
        Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err, function () {
            _this.$progress.hide();
            _this.options.wizard.$btnFinish.jqxButton({disabled: false});
            _this.options.wizard.$btnPrevious.jqxButton({disabled: false});
        });
    };
    SetColumnDataTypePage.prototype.createInvalidColumnNameDetailArea = function () {
        var _this = this;
        this.$messageDetailArea.jqxCheckBox({
            theme: Brightics.VA.Env.Theme
        });
        this.$messageDetailArea.on('change', function (event) {
            if (event.args.checked) {
                _this.$grid.jqxGrid('hidecolumn', 'column-data');
                _this.$grid.jqxGrid('showcolumn', 'column-name-invalid');
                _this.applyInvalidColumnNameFilter();
            } else {
                _this.$grid.jqxGrid('hidecolumn', 'column-name-invalid');
                _this.$grid.jqxGrid('showcolumn', 'column-data');
                _this.removeInvalidColumnNameFilter();
            }

        });
    };


    SetColumnDataTypePage.prototype.checkColumnNameValidation = function () {
        this.validationMessage = '';
        this.$messageArea.hide();

        this.checkColumnEmpty();
        this.checkColumnNameEmpty();
        this.checkColumnNameCharacter();

        this._createCountOfColumnNameMap();
        this.checkDuplicatedColumnName();

        if (this.validationMessage) {
            this.$messageArea.find('.brtc-va-wizard-message-label').text(this.validationMessage);
            this.$messageArea.show();
        }
        return this.validationMessage;
    };

    SetColumnDataTypePage.prototype.checkColumnEmpty = function () {
        if (!this.validationMessage) {
            if (this.options.wizard.result.columnName.length === 0) {
                this.validationMessage = 'There is no column. Please check column.';
            }
        }
    };

    SetColumnDataTypePage.prototype._isColumnNameEmpty = function (str) {
        return !str;
    };

    SetColumnDataTypePage.prototype.checkColumnNameEmpty = function () {
        if (!this.validationMessage) {

            for (var i in this.options.wizard.result.columnName) {
                if (this._isColumnNameEmpty(this.options.wizard.result.columnName[i])) {
                    this.validationMessage = 'Column name cannot be empty. Please check column name.';
                    break;
                }
            }
        }
    };
    SetColumnDataTypePage.prototype._isInvalidChar = function (str) {
        var reg1 = new RegExp('^[가-힣a-zA-Z0-9_]+$');
        var reg2 = new RegExp('^[0-9]+');
        return (!reg1.test(str) || reg2.test(str));
    };

    SetColumnDataTypePage.prototype._hasSpaceChar = function (str) {
        var reg = new RegExp(' +');
        return reg.test(str);
    };
    SetColumnDataTypePage.prototype._hasInvalidChar = function (str) {
        var reg = new RegExp('^[가-힣a-zA-Z0-9_ ]+$');
        return (!reg.test(str));
    };
    SetColumnDataTypePage.prototype._isStartedNumber = function (str) {
        var reg = new RegExp('^[0-9]+');
        return (reg.test(str));
    };

    SetColumnDataTypePage.prototype.checkColumnNameCharacter = function () {
        if (!this.validationMessage) {

            for (var i in this.options.wizard.result.columnName) {
                if (this._isInvalidChar(this.options.wizard.result.columnName[i])) {
                    this.validationMessage = "All column names should start with alphabet characters. You can use alphabet, number, and '_' only.";
                    break;
                }
            }
        }
    };


    SetColumnDataTypePage.prototype._hasDuplicatedColumnName = function (str) {
        return this._countOfColumnNameMap[str] > 1;
    };

    SetColumnDataTypePage.prototype.checkDuplicatedColumnName = function () {
        if (!this.validationMessage) {
            for (var i in this.options.wizard.result.columnName) {
                if (this._hasDuplicatedColumnName(this.options.wizard.result.columnName[i])) {
                    this.validationMessage = 'Some columns have same name. Please column name.';
                    break;
                }
            }
        }
    };

    SetColumnDataTypePage.prototype.showSuccessNotification = function (message) {
        this.notification('success', message);
    };
    
    SetColumnDataTypePage.prototype.createNotification = function () {
        this.$notificationContainer =
            $(crel('div', {class: 'brtc-va-dialogs-notification-container'}));
        this.$notificationContent =
            $(crel('div', {class: 'brtc-va-dialogs-notification-content'}));
        this.$notification = $(
            crel('div', {class: 'brtc-va-dialogs-notification'},
                this.$notificationContent[0]
            )
        );
        this.$parent.append(this.$notificationContainer, this.$notification);
        this.$notification.jqxNotification({
            theme: Brightics.VA.Env.Theme,
            appendContainer: this.$notificationContainer,
            autoOpen: false,
            animationOpenDelay: 800,
            autoClose: true,
            autoCloseDelay: 3000,
            template: 'info'
        });
    };

    SetColumnDataTypePage.prototype.notification = function (template, message) {
        this.$notificationContainer.empty();
        this.$notificationContent.html(message);
        this.$notification.jqxNotification({template: template});
        this.$notification.jqxNotification('open');
    };

    SetColumnDataTypePage.prototype.doFinish = function () {
        var _this = this;
        var columnName = this.getColumnNameArray();
        var columnType = this.getColumnTypeArray();
        if (this.checkColumnNameValidation()) {
            Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(this.validationMessage, function () {
            });
            return;
        }

        _this.progress(true, 'Adding data...');
        this.path = '';
        if (_this.options.wizard.result.uploadTo === 'shared') {
            this.path = '/' + _this.options.wizard.result.uploadTo + '/upload/' + _this.options.wizard.result.fileName;
        } else {
            this.path = '/' + Brightics.VA.Env.Session.userId + '/upload/' + _this.options.wizard.result.fileName;
        }

        if (this.options.wizard.result.copyFrom === 'local') {

            var $pregressTextArea = this.$progress.find('.brtc-va-progress-percent');

            var formData = new FormData();
            formData.append('column-name', '["' + columnName.join('\",\"') + '"]');
            formData.append('column-type', '["' + columnType.join('\",\"') + '"]');
            formData.append('delimiter', '"' + _this.options.wizard.result.delimiter + '"');
            formData.append('path', this.path);
            formData.append('attach', this.options.wizard.result.file);

            $.ajax({
                url: 'api/va/v2/data/upload',
                type: 'POST',
                mimeType: 'multipart/form-data',
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                blocking: false, //progress 함수가 이미 dim 처리 하고 있음.
                xhr: function () {
                    var xhr = $.ajaxSettings.xhr();
                    xhr.upload.onprogress = function (evt) {
                        var percent = evt.loaded / evt.total * 100;
                        if (typeof percent === 'number') {
                            $pregressTextArea.text(percent.toFixed(1) + ' %');
                        }
                    };
                    return xhr;
                },
            }).done(function (res) {
                _this.progress(false);
            }).fail(function (err) {
                _this.handleError(err);
            });
        }

        if (this.options.wizard.result.copyFrom === 'alluxio') {
            var options = {
                'inputpath': this.options.wizard.result.remotePath,
                'path': this.path,
                'columnname': columnName,
                'columntype': columnType,
                'delimiter': this.options.wizard.result.delimiter
            };
            var opt = {
                url: 'api/va/v2/data/import',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(options),
                blocking: false //progress 함수가 이미 dim 처리 하고 있음.
            };

            $.ajax(opt).done(function () {
                _this.progress(false);
            }).fail(function (err) {
                _this.handleError(err);
            });
        }

        if (this.options.wizard.result.copyFrom === 'jdbc') {
            this.uploadFormattedAlluxio({});
        }
    };

    SetColumnDataTypePage.prototype.uploadFormattedAlluxio = function (option) {
        var _this = this;
        var options = this.createImportDataOption(option);
        var checkTimer = function (jid) {
            _this._checkProgress(options.user, jid).done(function (result) {
                if (result.status == 'PROCESSING') {
                    setTimeout(checkTimer.bind(_this, jid), 3000);
                } else if (result.status == 'SUCCESS') {
                    _this.progress(false);
                } else {
                    _this.progress(false, result.message || 'Failed to upload.');
                }
            }).fail(function (err) {
                _this.handleError(err);
            });
        };

        var opt = {
            url: 'api/va/v2/analytics/jobs/execute',
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(options),
            blocking: false //progress 함수가 이미 dim 처리 하고 있음.
        };

        $.ajax(opt).done(function (results) {
            var _results = JSON.parse(results);
            var jid = _results.result;
            setTimeout(checkTimer.bind(_this, jid), 3000);
        }).fail(function (err) {
            _this.handleError(err);
        });
    };

    SetColumnDataTypePage.prototype.createImportDataOption = function () {
        var outputPath = (this.options.wizard.result.uploadTo === 'shared') ? ('/shared/upload/') : ('/' + Brightics.VA.Env.Session.userId + '/upload/');
        var columnName = this.getColumnNameArray();
        var columnType = this.getColumnTypeArray();

        var jid = 'va_mimportdata_' + moment(Date.now()).format('YYYYMMDDHHmmssSSS');
        var fnUnit = {
            'fid': 'fimportdata',
            'func': 'importData',
            'name': 'ImportData',
            'label': 'Import Data',
            'persist': true,
            'persist-mode': 'auto'
        };

        fnUnit.param = {
            'copy-from': 'jdbc',
            'columns': columnName.join(','),
            'column-type': columnType,
            'ip': this.options.wizard.result.jdbc.host,
            'port': this.options.wizard.result.jdbc.port,
            'output-path': outputPath + this.options.wizard.result.jdbc.tablename,
            'db-type': this.options.wizard.result.jdbc.dbtype.toLowerCase(),
            'username': this.options.wizard.result.jdbc.username,
            'password': this.options.wizard.result.jdbc.password,
            'db-name': this.options.wizard.result.jdbc.service,
            'table-name': this.options.wizard.result.jdbc.tablename,
            'socket-timeout': this.options.wizard.result.jdbc.sorckettimeout,
            'lock-timeout': this.options.wizard.result.jdbc.locktimeout,
            'delimiter': '\u0001'
        };

        return Brightics.VA.Core.Utils.RunnableFactory.createForDummy(fnUnit, jid, Brightics.VA.Env.Session.userId);
    };

    SetColumnDataTypePage.prototype._checkProgress = function (userId, jobId) {
        var option = {
            url: 'api/va/v2/analytics/jobs/' + jobId,
            type: 'GET',
            blocking: false //progress 함수가 이미 dim 처리 하고 있음.
        };
        return $.ajax(option);
    };

    SetColumnDataTypePage.prototype.progress = function (status, label) {
        var _this = this;
        if (status) {
            this.$progress.show();
            this.options.wizard.$btnFinish.jqxButton({disabled: status});
        }
        else {
            this.$progress.hide();
            if (label) {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog(label, function () {
                    _this.options.wizard.$btnFinish.jqxButton({disabled: status});
                });
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Add data success!', function () {
                    _this.options.wizard.dialogResult.OK = true;
                    _this.options.wizard.dialogResult.Cancel = false;
                    _this.options.wizard.dialogResult.path = _this.path;
                    _this.$parent.parent().dialog('close');
                });
            }
        }
        this.options.wizard.$btnPrevious.jqxButton({disabled: status});
    };

    SetColumnDataTypePage.prototype.destroy = function () {
        var $dropDownList = this.$grid.find('.jqx-dropdownlist-state-normal');
        $dropDownList.each(function () {
            $(this).jqxDropDownList('destroy');
        });
        this.$grid.jqxGrid('destroy');
    };

    Brightics.VA.Core.Wizards.Pages.SetColumnDataTypePage = SetColumnDataTypePage;

}).call(this);

/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SetDownloadDelimiterPage(parentId, options) {
        this.options = options;
        this.options.class = 'setdownloaddelimiterpage';

        Brightics.VA.Core.Wizards.Pages.WizardPage.call(this, parentId, this.options);
    }

    SetDownloadDelimiterPage.prototype = Object.create(Brightics.VA.Core.Wizards.Pages.WizardPage.prototype);
    SetDownloadDelimiterPage.prototype.constructor = SetDownloadDelimiterPage;

    SetDownloadDelimiterPage.prototype.init = function () {
        Brightics.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this);

        this.options.wizard.result.delimiters = {
            delimiter: ',',
            'array-delimiter': ';',
            'key-value-delimiter': ':',
            'quote-delimiter': '"'
        };
        this.delimiterMap = {
            comma: ',',
            tab: '\t',
            semicolon: ';',
            colon: ':',
            space: ' '
        }
    };

    SetDownloadDelimiterPage.prototype.createHeaderArea = function ($parent) {

    };

    SetDownloadDelimiterPage.prototype.createContentsArea = function ($parent) {
        this.createTableSelectorArea($parent);
        this.createColumnDelimiterArea($parent);
        this.createFileNameArea($parent);
        //this.createQuoteDelimiterArea($parent);
        //this.createArrayDateDelimiterArea($parent);
        //this.createKeyValueDataDelimiterArea($parent);
    };

    SetDownloadDelimiterPage.prototype.createTableSelectorArea = function ($parent) {
        var _this = this;
        $parent.append($('' +
            '<div class="">' +
            '   <div class="header">' +
            '       <span>Table Selector</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '        <div class="table-selector">' +
            '        </div>' +
            '   </div>' +
            '</div>'));

        var tableSelector = $parent.find('.table-selector').jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            autoDropDownHeight: true,
            width: '611px',
            selectedIndex: 0,
            source: this.options.wizard.options.downloaderOptions.tableObjList
        });
        _this.options.wizard.result.tid = tableSelector.jqxDropDownList('getSelectedItem').value;

        $parent.find('.table-selector').on('change', function (event) {
            _this.options.wizard.result.tid = event.args.item.value;
        });
    };

    SetDownloadDelimiterPage.prototype.createFileNameArea = function ($parent) {
        var _this = this;
        $parent.append($('' +
            '<div class="">' +
            '   <div class="header">' +
            '       <span>File Name</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '        <div class="brtc-va-input-wrapper">' +
            '        <input type="text" class="brtc-va-input-file-name"  maxlength="80"/>' +
            '        </div>' +
            '   </div>' +
            '</div>'));

        $parent.find('.brtc-va-input-wrapper .brtc-va-input-file-name').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: '611px',
            height: 26,
            placeHolder : _this.options.wizard.options.downloaderOptions.fileName
        });

        $parent.find('.brtc-va-input-wrapper .brtc-va-input-file-name').on('change', function (event) {
            var fileName = $parent.find('.brtc-va-input-wrapper .brtc-va-input-file-name').val().trim();
            _this.options.wizard.result.fileName = fileName.replace(/\s/g, '_');
        });
    };

    SetDownloadDelimiterPage.prototype.createColumnDelimiterArea = function ($parent) {
        var _this = this;
        var oldValue; // column 이외의 delimiter 선택을 없애면서 생긴 delimiter 중복 방지를 위한 어거지 로직
        $parent.append($('' +
            '<div class="delimiterselect brtc-va-column-delimiter">' +
            '   <div class="header">' +
            '       <span>Column Delimiter</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-comma" value="comma">Comma</div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-tab" value="tab"><span>Tab</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-space" value="space"><span>Space</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-colon" value="colon"><span>Colon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input"  maxlength="80"/></div></div>' +
            '        </div>' +
            '   </div>' +
            '</div>'));

        $parent.find('.brtc-va-column-delimiter .brtc-va-radio-button').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 26,
            width: 103,
            boxSize: '18px',
            groupName: 'delimiter'
        });
        $parent.find('.brtc-va-column-delimiter .brtc-va-radio-button[value=comma]').jqxRadioButton('check');
        $parent.find('.brtc-va-column-delimiter .jqx-radiobutton').on('change', function (event) {
            if (_this.options.wizard.result.delimiters.delimiter && _this.options.wizard.result.delimiters.delimiter !== '') oldValue = _this.options.wizard.result.delimiters.delimiter; // column 이외의 delimiter 선택을 없애면서 생긴 delimiter 중복 방지를 위한 어거지 로직
            if (event.target.tagName == 'INPUT') {
                _this.options.wizard.result.delimiters.delimiter = $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').val();
            } else {
                var checked = event.args.checked;
                if (checked) {
                    var value = event.target.getAttribute('value');
                    if (value == 'other') {
                        _this.options.wizard.result.delimiters.delimiter = $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').val();
                    }
                    else {
                        _this.options.wizard.result.delimiters.delimiter = _this.delimiterMap[value];
                    }
                }
            }

            // column 이외의 delimiter 선택을 없애면서 생긴 delimiter 중복 방지를 위한 어거지 로직
            for (var key in _this.options.wizard.result.delimiters) {
                if(key === 'delimiter') continue;
                if(_this.options.wizard.result.delimiters[key] === _this.options.wizard.result.delimiters.delimiter) _this.options.wizard.result.delimiters[key] = oldValue;
            }
        });

        $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 73,
            height: 24
        });

        $parent.find('.brtc-va-column-delimiter .brtc-va-radio-button[value=other]').on('checked', function () {
            $parent.find('.brtc-va-column-delimiter .brtc-va-delimiter-input').jqxInput('focus');
        });
    };

    SetDownloadDelimiterPage.prototype.createArrayDateDelimiterArea = function ($parent) {
        var _this = this;
        $parent.append($('' +
            '<div class="delimiterselect brtc-va-array-delimiter">' +
            '   <div class="header">' +
            '       <span>Array Data Delimiter</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-comma" value="comma">Comma</div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-tab" value="tab"><span>Tab</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-space" value="space"><span>Space</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-colon" value="colon"><span>Colon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>' +
            '        </div>' +
            '   </div>' +
            '</div>'));

        $parent.find('.brtc-va-array-delimiter .brtc-va-radio-button').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 26,
            width: 103,
            boxSize: '18px',
            groupName: 'array-delimiter'
        });
        $parent.find('.brtc-va-array-delimiter .brtc-va-radio-button[value=semicolon]').jqxRadioButton('check');
        $parent.find('.brtc-va-array-delimiter .jqx-radiobutton').on('change', function (event) {
            if (event.target.tagName == 'INPUT') {
                _this.options.wizard.result.delimiters['array-delimiter'] = $parent.find('.brtc-va-array-delimiter .brtc-va-delimiter-input').val();
            }
            else {
                var checked = event.args.checked;
                if (checked) {
                    var value = event.target.getAttribute('value');
                    if (value == 'other') {
                        _this.options.wizard.result.delimiters['array-delimiter'] = $parent.find('.brtc-va-array-delimiter .brtc-va-delimiter-input').val();
                    }
                    else {
                        _this.options.wizard.result.delimiters['array-delimiter'] = _this.delimiterMap[value];
                    }
                }
            }
        });

        $parent.find('.brtc-va-array-delimiter .brtc-va-delimiter-input').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 73,
            height: 24
        });

        $parent.find('.brtc-va-array-delimiter .brtc-va-radio-button[value=other]').on('checked', function () {
            $parent.find('.brtc-va-array-delimiter .brtc-va-delimiter-input').jqxInput('focus');
        });
    };

    SetDownloadDelimiterPage.prototype.createKeyValueDataDelimiterArea = function ($parent) {
        var _this = this;
        $parent.append($('' +
            '<div class="delimiterselect brtc-va-key-value-delimiter">' +
            '   <div class="header">' +
            '       <span>Key Value Data Delimiter</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-comma" value="comma">Comma</div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-tab" value="tab"><span>Tab</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-space" value="space"><span>Space</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-colon" value="colon"><span>Colon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>' +
            '        </div>' +
            '   </div>' +
            '</div>'));

        $parent.find('.brtc-va-key-value-delimiter .brtc-va-radio-button').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 26,
            width: 103,
            boxSize: '18px',
            groupName: 'key-value-delimiter'
        });
        $parent.find('.brtc-va-key-value-delimiter .brtc-va-radio-button[value=colon]').jqxRadioButton('check');
        $parent.find('.brtc-va-key-value-delimiter .jqx-radiobutton').on('change', function (event) {
            if (event.target.tagName == 'INPUT') {
                _this.options.wizard.result.delimiters['key-value-delimiter'] = $parent.find('.brtc-va-key-value-delimiter .brtc-va-delimiter-input').val();
            }
            else {
                var checked = event.args.checked;
                if (checked) {
                    var value = event.target.getAttribute('value');
                    if (value == 'other') {
                        _this.options.wizard.result.delimiters['key-value-delimiter'] = $parent.find('.brtc-va-key-value-delimiter .brtc-va-delimiter-input').val();
                    }
                    else {
                        _this.options.wizard.result.delimiters['key-value-delimiter'] = _this.delimiterMap[value];
                    }
                }
            }
        });

        $parent.find('.brtc-va-key-value-delimiter .brtc-va-delimiter-input').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 73,
            height: 24
        });

        $parent.find('.brtc-va-key-value-delimiter .brtc-va-radio-button[value=other]').on('checked', function () {
            $parent.find('.brtc-va-key-value-delimiter .brtc-va-delimiter-input').jqxInput('focus');
        });
    };

    SetDownloadDelimiterPage.prototype.createQuoteDelimiterArea = function ($parent) {
        var _this = this;
        $parent.append($('' +
            '<div class="delimiterselect brtc-va-quote-delimiter">' +
            '   <div class="header">' +
            '       <span>Quote Delimiter</span>' +
            '    </div>' +
            '    <div class="contents">' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-comma" value="comma">Comma</div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-tab" value="tab"><span>Tab</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-space" value="space"><span>Space</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-colon" value="colon"><span>Colon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>' +
            '        </div>' +
            '        <div class="brtc-va-radio">' +
            '            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>' +
            '        </div>' +
            '   </div>' +
            '</div>'));

        $parent.find('.brtc-va-quote-delimiter .brtc-va-radio-button').jqxRadioButton({
            theme: Brightics.VA.Env.Theme,
            height: 26,
            width: 103,
            boxSize: '18px',
            groupName: 'quote-delimiter'
        });
        $parent.find('.brtc-va-quote-delimiter .brtc-va-radio-button[value=other]').jqxRadioButton('check');
        $parent.find('.brtc-va-quote-delimiter .jqx-radiobutton').on('change', function (event) {
            if (event.target.tagName == 'INPUT') {
                _this.options.wizard.result.delimiters['quote-delimiter'] = $parent.find('.brtc-va-quote-delimiter .brtc-va-delimiter-input').val();
            }
            else {
                var checked = event.args.checked;
                if (checked) {
                    var value = event.target.getAttribute('value');
                    if (value == 'other') {
                        _this.options.wizard.result.delimiters['quote-delimiter'] = $parent.find('.brtc-va-quote-delimiter .brtc-va-delimiter-input').val();
                    }
                    else {
                        _this.options.wizard.result.delimiters['quote-delimiter'] = _this.delimiterMap[value];
                    }
                }
            }
        });

        $parent.find('.brtc-va-quote-delimiter .brtc-va-delimiter-input').jqxInput({
            theme: Brightics.VA.Env.Theme,
            width: 73,
            height: 24,
            value: '"'
        });

        $parent.find('.brtc-va-quote-delimiter .brtc-va-radio-button[value=other]').on('checked', function () {
            $parent.find('.brtc-va-quote-delimiter .brtc-va-delimiter-input').jqxInput('focus');
        });
    };

    SetDownloadDelimiterPage.prototype.destroy = function () {
        this.$parent.find('.table-selector').jqxDropDownList('destroy');
    };

    Brightics.VA.Core.Wizards.Pages.SetDownloadDelimiterPage = SetDownloadDelimiterPage;

}).call(this);
/**
 * Created by SDS on 2016-09-01.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Wizard(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.pages = [];
        this.result = {};

        this.retrieveParent();
        this.createControls();
    }

    Wizard.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    Wizard.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('' +
            '<div class="brtc-va-wizard-main">' +
            // '   <div class="brtc-va-wizard-header">' + this.options.title + '</div>' +
            '   <div class="brtc-va-wizard-body">' +
            '</div>');
        this.$mainControl.css({
            width: this.options.width,
            height: this.options.height
        });

        this.$mainControl.dialog({
            theme: Brightics.VA.Env.Theme,
            title: this.options.title,
            width: 675,
            height: this.options.height || 620,
            maxHeight: this.options.maxHeight,
            modal: true,
            resizable: false,
            closeOnEscape: false,
            close: function () {
                if (typeof _this.options.close == 'function') {
                    _this.options.close(_this.dialogResult);
                }
                _this.close();
            },
            keyboardCloseKey: ''
        });

        this.$mainControl.addClass(this.options.class);
        this.$mainControl.attr('name', this.$mainControl.parent().find('span.ui-dialog-title').text());

        this.initContents();
        this.initPage();
        this.setFocus();
    };

    Wizard.prototype.close = function () {
        this.$mainControl.dialog('destroy');
        this.$mainControl.remove();
    };

    Wizard.prototype.initContents = function () {
        this.createContentsArea(this.$mainControl.find('.brtc-va-wizard-body'));
        this.createButtonArea(this.$mainControl.find('.brtc-va-wizard-body'));
    };

    Wizard.prototype.initPage = function () {
        if (this.pages.length > 0) {
            this.pages[0].show();
            this.currentPage = this.pages[0];
            this.currentPage.init();
            for (var i = 1; i < this.pages.length; i++) {
                this.pages[i].hide();
            }
        }
        this.initButton(this.currentPage);
    };

    Wizard.prototype.addPage = function (wizardPage) {
        this.pages.push(wizardPage);
    };

    Wizard.prototype.setFocus = function () {
        // Do Nothing
    };

    Wizard.prototype.createButtonArea = function ($parent) {
        var _this = this;
        this.$buttonArea = $('' +
            '<div class="brtc-va-wizard-buttonarea">' +
            '   <input type="button" class="finish" value="Finish"/>' +
            '   <input type="button" class="next" value="Next"/>' +
            '   <input type="button" class="previous" value="Previous"/>' +
            '</div>');
        $parent.append(this.$buttonArea);

        this.$buttonArea.find(':button').jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        this.$btnPrevious = this.$buttonArea.find('.previous');
        this.$btnPrevious.on('click', function () {
            _this.handlePrevious();
        });
        this.$btnPrevious.hide();

        this.$btnNext = this.$buttonArea.find('.next');
        this.$btnNext.on('click', function () {
            _this.handleNext();
        });
        this.$btnNext.hide();

        this.$btnFinish = this.$buttonArea.find('.finish');
        this.$btnFinish.on('click', function () {
            _this.handleFinish();
        });
        this.$btnFinish.hide();
    };

    Wizard.prototype.handlePrevious = function () {
        if (this.currentPage) {
            this.currentPage.hide();
            this.currentPage = this.getPreviousPage(this.currentPage);
            this.currentPage.show();
            this.currentPage.init();
            this.initButton(this.currentPage);
        }
    };

    Wizard.prototype.handleNext = function () {
        var _this = this;
        this.currentPage.doFinish(function () {
            if (_this.currentPage) {
                _this.currentPage.hide();
                _this.currentPage = _this.getNextPage(_this.currentPage);
                _this.currentPage.show();
                _this.currentPage.init();
                _this.initButton(_this.currentPage);
            }
        });
    };

    Wizard.prototype.handleFinish = function () {
    };

    Wizard.prototype.initButton = function (page) {
        var pageOptions = page ? page.options : {
            showPreviousButton: false,
            showNextButton: false,
            showFinishButton: false
        };
        pageOptions.showPreviousButton ? this.$btnPrevious.show() : this.$btnPrevious.hide();
        pageOptions.showNextButton ? this.$btnNext.show() : this.$btnNext.hide();
        pageOptions.showFinishButton ? this.$btnFinish.show() : this.$btnFinish.hide();
    };

    Wizard.prototype.getNextPage = function (currentPage) {
        var index = this.pages.indexOf(currentPage);
        if (index < this.pages.length - 1) {
            return this.pages[index + 1];
        } else {
            return null;
        }
    };

    Wizard.prototype.getPreviousPage = function (currentPage) {
        var index = this.pages.indexOf(currentPage);
        if (index > 0) {
            return this.pages[index - 1];
        } else {
            return null;
        }
    };

    Brightics.VA.Core.Wizards.Wizard = Wizard;

}).call(this);
/**
 * Created by SDS on 2016-06-02.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DataDownloadWizard(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.options.title = 'Data Download';
        this.options.class = 'datadownloadwizard';
        this.dialogResult = {
            OK: false,
            Cancel: true
        };

        Brightics.VA.Core.Wizards.Wizard.call(this, parentId, this.options);
    }

    DataDownloadWizard.prototype = Object.create(Brightics.VA.Core.Wizards.Wizard.prototype);
    DataDownloadWizard.prototype.constructor = DataDownloadWizard;

    DataDownloadWizard.prototype.createContentsArea = function ($parent) {
        $parent.css({'padding-left': '19px', 'padding-right': '19px'});
        this.setDownloadDelimiterPage = new Brightics.VA.Core.Wizards.Pages.SetDownloadDelimiterPage($parent, {
            wizard: this,
            showPreviousButton: false,
            showNextButton: false,
            showFinishButton: true
        });
        this.addPage(this.setDownloadDelimiterPage);
        this.downloadLoadingPage = new Brightics.VA.Core.Wizards.Pages.DownloadLoadingPage($parent, {
            wizard: this,
            showPreviousButton: false,
            showNextButton: false,
            showFinishButton: false,
            loadingText: 'Preparing...'
        });
        this.addPage(this.downloadLoadingPage);
    };

    DataDownloadWizard.prototype.getNextPage = function (currentPage) {
        if (currentPage === this.setDownloadDelimiterPage) {
            return this.downloadLoadingPage;
        }
        if (currentPage === this.downloadLoadingPage) return null;
    };

    DataDownloadWizard.prototype.getPreviousPage = function (currentPage) {
        if (currentPage === this.setDownloadDelimiterPage) return null;
        if (currentPage === this.downloadLoadingPage) return this.setDownloadDelimiterPage;
    };

    DataDownloadWizard.prototype.handleFinish = function () {
        var selectedDelimiters = this.setDownloadDelimiterPage.options.wizard.result.delimiters;
        var delimiter = selectedDelimiters.delimiter;
        var defaultFilename = this.setDownloadDelimiterPage.options.wizard.options.downloaderOptions.fileName;
        var inputFilename = this.setDownloadDelimiterPage.options.wizard.result.fileName;
        var fileName = inputFilename || defaultFilename;
        // var rgExp = /[~!@\#$%^&*\()\[\]\{\}\-=+'";:?`|\\/]/gi;
        var rgExp = /[~!@\#$%^&*\()\[\]\{\}=+'";:?`|\\/]/gi;  
        /*var arrayDelimiter = selectedDelimiters['array-delimiter'];
        var keyValueDelimiter = selectedDelimiters['key-value-delimiter'];
        var quoteDelimiter = selectedDelimiters['quote-delimiter'];*/

        if (!delimiter) {
            Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Delimiter should not be empty.');
        }
        /*else if ((delimiter == arrayDelimiter) || (delimiter == keyValueDelimiter) || (delimiter == quoteDelimiter) || (arrayDelimiter == keyValueDelimiter) || (arrayDelimiter == quoteDelimiter) || (keyValueDelimiter == quoteDelimiter)) {
            Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('Each delimiter must be different.');
        }*/
        else if (rgExp.test(fileName)) {
            Brightics.VA.Core.Utils.WidgetUtils.openInformationDialog('File names can not contain special characters.');          
        } 
        else {
            this.handleNext();
        }
    };

    DataDownloadWizard.prototype.close = function () {
        this.setDownloadDelimiterPage.destroy();
        Brightics.VA.Core.Wizards.Wizard.prototype.close.call(this);
    };

    Brightics.VA.Core.Wizards.DataDownloadWizard = DataDownloadWizard;

}).call(this);
/**
 * Created by SDS on 2016-06-02.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    const useSpark = root.useSpark === 'false' ? false : true;

    function DataExportWizard(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.options.title = 'Data Export';
        this.options.class = 'dataexportwizard';
        this.options.height = 640;
        this.options.maxHeight = 640;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };

        Brightics.VA.Core.Wizards.Wizard.call(this, parentId, this.options);
        if (!useSpark) this.handleNext();
    }

    DataExportWizard.prototype = Object.create(Brightics.VA.Core.Wizards.Wizard.prototype);
    DataExportWizard.prototype.constructor = DataExportWizard;

    DataExportWizard.prototype.createContentsArea = function ($parent) {
        $parent.css({'padding-left': '19px', 'padding-right': '19px'});
        this.selectExportTypePage = new Brightics.VA.Core.Wizards.Pages.SelectExportTypePage($parent, {
            wizard: this,
            showPreviousButton: true,
            showNextButton: true,
            showFinishButton: true
        });
        this.addPage(this.selectExportTypePage);
        //this.selectExportDataPage = new Brightics.VA.Core.Wizards.Pages.SelectExportDataPage($parent, {
        //    wizard: this,
        //    showPreviousButton: true,
        //    showNextButton: true,
        //    showFinishButton: true
        //});
        //this.addPage(this.selectExportDataPage);
        this.selectJdbcDataPage = new Brightics.VA.Core.Wizards.Pages.SelectExportJdbcPage($parent, {
            wizard: this,
            showPreviousButton: true,
            showNextButton: false,
            showFinishButton: true
        });
        this.addPage(this.selectJdbcDataPage);
        this.selectExportDelimiterPage = new Brightics.VA.Core.Wizards.Pages.SelectExportDelimiterPage($parent, {
            wizard: this,
            showPreviousButton: useSpark,
            showNextButton: false,
            showFinishButton: true
        });
        this.addPage(this.selectExportDelimiterPage);
    };

    DataExportWizard.prototype.getNextPage = function (currentPage) {
        if (currentPage === this.selectExportTypePage) {
            var copyFrom = this.selectExportTypePage.getParam()['copyFrom'];
            if (copyFrom === 'local') {
                return this.selectExportDelimiterPage;
            }
            if (copyFrom === 'jdbc') {
                return this.selectJdbcDataPage;
            }
        }
    };

    DataExportWizard.prototype.getPreviousPage = function (currentPage) {
        if (currentPage === this.selectExportTypePage) return null;
        if (currentPage === this.selectExportDelimiterPage) return this.selectExportTypePage;
        if (currentPage === this.selectJdbcDataPage) return this.selectExportTypePage;
    };

    DataExportWizard.prototype.handleFinish = function (currentPage) {
        this.handleNext();
    };

    DataExportWizard.prototype.close = function () {
        this.selectExportDelimiterPage.destroy();
        this.selectExportTypePage.destroy();
        this.selectJdbcDataPage.destroy();
        Brightics.VA.Core.Wizards.Wizard.prototype.close.call(this);
    };

    Brightics.VA.Core.Wizards.DataExportWizard = DataExportWizard;

}).call(this);
/**
 * Created by SDS on 2016-06-02.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    const useSpark = root.useSpark === 'false' ? false : true;

    function DataUploadWizard(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.options.title = 'Add Data';
        this.options.class = 'datauploadwizard';
        this.options.height = 600;
        this.dialogResult = {
            OK: false,
            Cancel: true
        };
        this.eventList = {};
        this.eventListener = {};

        Brightics.VA.Core.Wizards.Wizard.call(this, parentId, this.options);
        if (!useSpark) this.handleNext();
    }

    DataUploadWizard.prototype = Object.create(Brightics.VA.Core.Wizards.Wizard.prototype);
    DataUploadWizard.prototype.constructor = DataUploadWizard;

    DataUploadWizard.prototype.createContentsArea = function ($parent) {
        this.selectUploadTypePage = new Brightics.VA.Core.Wizards.Pages.SelectUploadTypePage($parent, {
            wizard: this,
            showPreviousButton: true,
            showNextButton: true,
            showFinishButton: true
        });
        this.addPage(this.selectUploadTypePage);
        this.selectLocalDataPage = new Brightics.VA.Core.Wizards.Pages.SelectLocalDataPage($parent, {
            wizard: this,
            showPreviousButton: useSpark,
            showNextButton: true,
            showFinishButton: true
        });
        this.addPage(this.selectLocalDataPage);
        this.selectAlluxioDataPage = new Brightics.VA.Core.Wizards.Pages.SelectAlluxioDataPage($parent, {
            wizard: this,
            showPreviousButton: true,
            showNextButton: true,
            showFinishButton: true
        });

        this.addPage(this.selectAlluxioDataPage);
        this.selectJdbcDataPage = new Brightics.VA.Core.Wizards.Pages.SelectJdbcDataPage($parent, {
            wizard: this,
            showPreviousButton: true,
            showNextButton: true,
            showFinishButton: true
        });
        this.addPage(this.selectJdbcDataPage);
        this.selectDelimiterPage = new Brightics.VA.Core.Wizards.Pages.SelectDelimiterPage($parent, {
            wizard: this,
            showPreviousButton: true,
            showNextButton: true,
            showFinishButton: true
        });
        this.addPage(this.selectDelimiterPage);
        this.setColumnDataTypePage = new Brightics.VA.Core.Wizards.Pages.SetColumnDataTypePage($parent, {
            wizard: this,
            showPreviousButton: true,
            showNextButton: true,
            showFinishButton: true
        });
        this.addPage(this.setColumnDataTypePage);
    };

    DataUploadWizard.prototype.getNextPage = function (currentPage) {
        if (currentPage === this.selectUploadTypePage) {
            var copyFrom = this.selectUploadTypePage.getParam()['copyFrom'];

            if (copyFrom === 'local') {
                return this.selectLocalDataPage;
            }
            if (copyFrom === 'alluxio') {
                return this.selectAlluxioDataPage;
            }
            if (copyFrom === 'jdbc') {
                return this.selectJdbcDataPage;
            }
        }
        if (currentPage === this.selectLocalDataPage) {
            return this.selectDelimiterPage;
        }
        if (currentPage === this.selectAlluxioDataPage) {
            return this.selectDelimiterPage;
        }
        if (currentPage === this.selectJdbcDataPage) {
            return this.setColumnDataTypePage;
        }
        if (currentPage === this.selectDelimiterPage) {
            return this.setColumnDataTypePage;
        }
        if (currentPage === this.setColumnDataTypePage) return null;
    };

    DataUploadWizard.prototype.getPreviousPage = function (currentPage) {
        if (currentPage === this.selectUploadTypePage) return null;
        if (currentPage === this.selectLocalDataPage) return this.selectUploadTypePage;
        if (currentPage === this.selectAlluxioDataPage) return this.selectUploadTypePage;
        if (currentPage === this.selectJdbcDataPage) return this.selectUploadTypePage;
        if (currentPage === this.selectDelimiterPage) {
            if (this.result.copyFrom === 'local') {
                return this.selectLocalDataPage;
            }
            if (this.result.copyFrom === 'alluxio') {
                return this.selectAlluxioDataPage;
            }
        }
        if (currentPage === this.setColumnDataTypePage) {
            if (this.result.copyFrom === 'local') {
                return this.selectDelimiterPage;
            }
            if (this.result.copyFrom === 'alluxio') {
                return this.selectDelimiterPage;
            }
            if (this.result.copyFrom === 'jdbc') {
                return this.selectJdbcDataPage;
            }
        }
    };

    DataUploadWizard.prototype.handleFinish = function () {
        this.setColumnDataTypePage.doFinish();
    };

    DataUploadWizard.prototype.registerEvent = function (eventId) {
        var _this = this;

        if (!this.eventList[eventId]) {
            this.$mainControl.on(eventId, function (event, eventData) {
                if (_this.eventListener[eventId]) {
                    for (var i in _this.eventListener[eventId]) {
                        if (_this.eventListener[eventId][i] && typeof _this.eventListener[eventId][i] === 'function') {
                            _this.eventListener[eventId][i](event, eventData);
                        }
                    }
                }
            });
            this.eventList[eventId] = true;
        }
    };

    DataUploadWizard.prototype.addEventListener = function (eventId, listenCallback) {
        if (!this.eventListener[eventId]) {
            this.eventListener[eventId] = [];
        }
        this.eventListener[eventId].push(listenCallback);
    };

    DataUploadWizard.prototype.triggerEvent = function (eventId, eventData) {
        this.$mainControl.trigger(eventId, [eventData]);
    };

    DataUploadWizard.prototype.close = function () {
        this.selectJdbcDataPage.destroy();
        this.selectAlluxioDataPage.destroy();
        this.selectDelimiterPage.destroy();
        this.selectLocalDataPage.destroy();
        this.selectUploadTypePage.destroy();
        this.setColumnDataTypePage.destroy();
        Brightics.VA.Core.Wizards.Wizard.prototype.close.call(this);
    };

    Brightics.VA.Core.Wizards.DataUploadWizard = DataUploadWizard;

}).call(this);
/**
 * Created by SDS on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;
    var CONST = {};
    var crel = brtc_require('crel');
    CONST.USER_INPT_ARR_DELIMETER = '[i]';

    root.Brightics.VA.Core.Utils.CommonUtils = {
        getUserBrowserName: function () {
            // Chrome 1+
            var isChrome = !!window.chrome && !!window.chrome.webstore;
            if (window.navigator.userAgent.indexOf('Chrome') >= 0) return 'Chrome';
            // if (isChrome) return 'Chrome';
            // Internet Explorer 6-11
            var isIE = /*@cc_on!@*/false || !!document.documentMode;
            if (isIE) return 'Internet Explorer';
            // Opera 8.0+
            var isOpera = (!!window.opr && !!opr.addons) || !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0;
            if (isOpera) return 'Opera';
            // Firefox 1.0+
            var isFirefox = typeof InstallTrigger !== 'undefined';
            if (isFirefox) return 'Firefox';
            // Safari 3.0+ "[object HTMLElementConstructor]"
            var isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0 || (function (p) {
                    return p.toString() === "[object SafariRemoteNotification]";
                })(!window['safari'] || safari.pushNotification);
            if (isSafari) return 'Safari';
        },
        downloadJsonFile: function (data, fileName) {
            var util = this;
            var browser = util.getUserBrowserName();

            var blobObject = new Blob([data], {type: 'text/json;charset=utf-8;'});
            if (browser === 'Internet Explorer') {
                window.navigator.msSaveBlob(blobObject, fileName + '.json'); // The user only has the option of clicking the Save button.
            } else {
                var fileUrl = URL.createObjectURL(blobObject);
                var anchor = document.createElement('a');
                anchor.setAttribute('href', fileUrl);
                anchor.setAttribute('download', fileName + '.json');

                // document.body.appendChild(anchor);
                anchor.click();
                URL.revokeObjectURL(fileUrl);

                // var ev = document.createEvent("MouseEvents");
                // ev.initMouseEvent("click", true, false, self, 0,0,0,0,0, false, false, false ,false, 0, null);

                // anchor.dispatchEvent(ev);
            }
        },
        numberToStringWithComma: function (number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        },
        getTimeDifferenceFromNow: function (date) {
            var oldDate = new Date(date),
                newDate = new Date();

            var diff = (newDate.getTime() - oldDate.getTime()) / (1000 * 60 * 60);

            return diff;
        },
        transferTimestampToDateString: function (timestampValue) {
            //yyyy-mm-dd HH:MM:SS
            var makeDateString = function (dateVal) {
                return (dateVal < 10) ? '0' + dateVal : dateVal;
            };

            return timestampValue.getFullYear() + '-' + makeDateString((timestampValue.getMonth() + 1)) + '-' + makeDateString(timestampValue.getDate()) + ' ' + makeDateString(timestampValue.getHours()) + ':' + makeDateString(timestampValue.getUTCMinutes()) + ':' + makeDateString(timestampValue.getUTCSeconds());

        },
        convertDataTypeForText: function (type, internalType) {
            // String, Integer, Double, Date,
            // Array(String), Array(Integer), Array(Double), Array(Date),
            // Map, XML
            //
            // => Array의 경우 다음과 같이 축약함
            // Array(S), Array(I), Array(Db), Array(Dt)

            if (type === undefined) {
                return '-';
            } else if (type.indexOf('[') !== -1) {
                var arrayType = internalType.replace('[]', '')
                var arrayTypeAbbreviation;
                switch (arrayType) {
                    case 'String' :
                        arrayTypeAbbreviation = 'S';
                        break;
                    case 'Integer' :
                        arrayTypeAbbreviation = 'I';
                        break;
                    case 'Long' :
                        arrayTypeAbbreviation = 'L';
                        break;
                    case 'Double' :
                        arrayTypeAbbreviation = 'Db';
                        break;
                    case 'Date' :
                        arrayTypeAbbreviation = 'Dt';
                        break;
                    case 'Boolean' :
                        arrayTypeAbbreviation = 'Bl';
                        break;
                    case 'Byte' :
                        arrayTypeAbbreviation = 'Bt';
                        break;
                    default:
                        arrayTypeAbbreviation = arrayType;
                }
                return 'Array(' + arrayTypeAbbreviation + ')';
            } else if (type === 'map') {
                return 'Map';
            } else {
                return internalType;
            }
        },
        convertDataTypeForTitle: function (type, internalType) {
            if (type === undefined) {
                return 'Undefined Type';
            } else if (type.indexOf('[') !== -1) {
                var arrayType = internalType.replace('[]', '');
                return 'Array(' + arrayType + ')'
            } else {
                return internalType;
            }
        },
        getTypes: function () {
            return [{
                type: 'number',
                internalType: 'Integer'
            }, {
                type: 'number',
                internalType: 'Long'
            }, {
                type: 'number',
                internalType: 'Double'
            }, {
                type: 'string',
                internalType: 'Boolean'
            }, {
                type: 'string',
                internalType: 'String'
            }, {
                type: 'number[]',
                internalType: 'Double[]'
            }, {
                type: 'number[]',
                internalType: 'Long[]'
            }, {
                type: 'string[]',
                internalType: 'Boolean[]'
            }, {
                type: 'string[]',
                internalType: 'String[]'
            }, {
                type: 'byte[]',
                internalType: 'Byte[]'
            }, {
                type: 'number[]',
                internalType: 'Double[]'
            }, {
                type: 'number[]',
                internalType: 'Long[]'
            }, {
                type: 'string[]',
                internalType: 'String[]'
            }, {
                type: 'byte[]',
                internalType: 'Byte[]'
            }, {
                type: 'map',
                internalType: 'Map(Integer,Double)'
            }, {
                type: 'map',
                internalType: 'Map(String,Double)'
            }, {
                type: 'map',
                internalType: 'Map(Integer,Double)'
            }, {
                type: 'map',
                internalType: 'Map(String,String)'
            }, {
                type: 'date',
                internalType: 'Date'
            }]
        },
        //Get object data using string
        //example)
        // input:  {
        //     inptStr: 'option.marker.markerSize',
        //     obj: Brightics.OptionCotainer
        // }
        // output: (instance of) Brightics.OptionCotainer.option.marker.markerSize
        fetchFromObject: function (inptStr, obj) {
            if (typeof inptStr === 'undefined' || typeof obj === 'undefined') {
                return;
            }
            try {
                var _index = inptStr.indexOf('.');
                var chkType = inptStr.slice(0, _index);
                var arrDelimeterIdx = chkType.indexOf(CONST.USER_INPT_ARR_DELIMETER);
                if (arrDelimeterIdx > -1) {
                    var rtnArr = [];
                    var arr = obj[inptStr.substring(0, arrDelimeterIdx)];
                    if (arr) {
                        for (var arrIdx = 0; arrIdx < arr.length; arrIdx++) {
                            var elemStr = inptStr.indexOf('.');
                            if (elemStr > -1) {
                                rtnArr.push(this.fetchFromObject(inptStr.substr(arrDelimeterIdx + 4), arr[arrIdx]));
                            }
                        }
                    }
                    return (rtnArr.length > 0) ? rtnArr : arr;
                } else {
                    // var _index = inptStr.indexOf('.');
                    if (_index > -1) {
                        return this.fetchFromObject(inptStr.substr(_index + 1), obj[inptStr.substring(0, _index)]);
                    }
                    return obj[inptStr];
                }
            } catch (e) {
                console.error(inptStr);
                console.error(e);
            }
        },
        isPC : function () {
            var pcChecker = ['win16', 'win32', 'win64', 'macintel', 'mac'];
            var isPC = true;

            if (pcChecker.indexOf(navigator.platform.toLowerCase()) < 0) {
                isPC = false;
            }

            return isPC;
        },
        byteCalculation: function (bytes) {
            var bytes = parseInt(bytes);
            var s = ['bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];
            var e = Math.floor(Math.log(bytes)/Math.log(1024));

            if(e == "-Infinity") return "0 "+s[0];
            else return (bytes/Math.pow(1024, Math.floor(e))).toFixed(2)+" "+s[e];
        },
        getQueryString: function (keyVal) {
            var queryString = _.map(keyVal, function (val, key) {
                return key + '=' + val;
            }).join('&');
            return queryString;
        },
        getObjByJsonPath: function (json, path) {
            var reducer = function(accumulator, value, index, array) {
                if (accumulator && accumulator[value]) accumulator = accumulator[value];
                else accumulator = undefined;

                return accumulator;
            }
            var initialJson = $.extend(true, {}, json);
            return (Array.isArray(path))? path.reduce(reducer, initialJson) : initialJson[path];
        },
        removeArrayElement: function (sourceArr, targetArr) {
            _.remove(sourceArr, function(source) {
                return (targetArr.indexOf(source) > -1);
            });
        },
        dim: function (_fn, _opt) {
            var opt = _opt || {};
            var $appendTo = $(opt.appendTo || document.body);

            var pr = Promise.resolve()
                .then(function () {
                    return typeof _fn === 'function' ? _fn() : _fn;
                });

            var $dim = $(
                crel('div', {class: 'brtc-dim'},
                    crel('div', {class: 'brtc-dim-text brtc-style-apper-1sendond'},
                        crel('i', {class: 'fa fa-spinner fa-pulse fa-5x fa-fw'})
                    )
                )
            );

            $appendTo.append($dim);

            return pr
                .then(function (arg) {
                    $dim.remove();
                    return arg;
                })
                .catch(function (err) {
                    $dim.remove();
                    throw err;
                });
        },
        progress: function (_fn, _opt) {
            var opt = _opt || {};
            var showPercent = _opt.showPercent || false;
            var msg = _opt.msg || '';
            var $appendTo = $(opt.appendTo || document.body);

            var pr = Promise.resolve()
                .then(function () {
                    return typeof _fn === 'function' ? _fn() : _fn;
                });

            var $progress = $(
                '   <div class="brtc-va-progress">' +
                '       <div>' +
                '           <span class="brtc-va-progress-loading"/>' +
                '           <p>' + msg + '</p>' +
                (showPercent ? '<p class="brtc-va-progress-percent"></p>' : '') +
                '       </div>' +
                '</div>'
            );
            $progress.css('top', '0');
            $progress.css('left', '0');

            $appendTo.append($progress);

            return pr
                .then(function (arg) {
                    $progress.remove();
                    return arg;
                })
                .catch(function (err) {
                    $progress.remove();
                    throw err;
                });
        }
    };
}).call(this);

/**
 * Created by SDS on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    root.Brightics.VA.Core.Utils.DownLoader = {
        run: function (userId, mid, table, fileName, delimiters, callback, failCallback) {
            var _this = this;
            var dataPath = '/' + userId + '/' + mid + '/' + table;
            _this.runStartWithExport(fileName, dataPath, delimiters, callback, failCallback);
        },
        runStartWithExport: function (fileName, inputPath, delimiters, callback, failCallback) {
            var _this = this;
            _this.export(fileName, inputPath, delimiters, callback, failCallback);
        },
        doDownload: function (dataPath, fileName, tempFile, callback, failCallback, additionalOpt) {
            this.download(dataPath, fileName).always(function () {
                var opt = {
                    url: 'api/v1/repo/alluxio/datas/' + tempFile + '/destroy',
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    blocking: false,
                    data: JSON.stringify({'type': 'tmp', 'data': tempFile})
                };
                $.extend(true, opt, additionalOpt);
                $.ajax(opt);
                opt = {
                    url: 'api/v1/repo/alluxio/datas/' + tempFile + '.csv/destroy',
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    blocking: false,
                    data: JSON.stringify({'type': 'tmp', 'data': tempFile + '.csv'})
                };
                $.extend(true, opt, additionalOpt);
                $.ajax(opt);
            }).done(function () {
                if (typeof callback == 'function') callback();
            }).fail(failCallback);
        },
        progress: function (userId, jobId, additionalOpt) {
            var rep = {
                fail: function (callback) {
                    this.failCallback = callback;
                    return this;
                },
                done: function (callback) {
                    this.doneCallback = callback;
                    return this;
                }
            };

            var checkStatus = function () {
                var opt = {
                    url: 'api/va/v2/analytics/jobs/' + jobId,
                    type: 'GET',
                    blocking: false
                };
                $.extend(true, opt, additionalOpt);
                $.ajax(opt).done(function (res) {
                    if (res.status === 'FAIL' || res.status === 'ABORT') {
                        var error = {
                            status: 400,
                            responseJSON: {
                                'errors': [
                                    {'code': 400, 'message': 'Failed to export data.'}
                                ]
                            }
                        };

                        try {
                            var params = Brightics.VA.Core.Utils.MessageUtils.getFunctionLabels('unload', res.errorInfo[0].parameter);
                            error.responseJSON.errors[0].message = Brightics.VA.Core.Utils.MessageUtils.getMessage(res.errorInfo[0].errorCode, params);

                            if (rep.failCallback) rep.failCallback(error);
                        } catch (err) {
                            if (rep.failCallback) rep.failCallback(error);
                        }
                    }
                    else if (res.status === 'SUCCESS') {
                        if (rep.doneCallback) rep.doneCallback();
                    }
                    else {
                        setTimeout(checkStatus, 3000);
                    }
                }).fail(function (err) {
                    if (rep.failCallback) rep.failCallback(err);
                });
            };
            setTimeout(checkStatus, 3000);

            return rep;
        },
        unload: function (userId, mid, inTable, outPath, delimiters, additionalOpt) {
            var _this = this;
            var rep = {
                fail: function (callback) {
                    this.failCallback = callback;
                    return this;
                },
                done: function (callback) {
                    this.doneCallback = callback;
                    return this;
                }
            };
            var jobId = 'va_' + Date.now();

            if (delimiters) {
                if (!delimiters.delimiter) delimiters.delimiter = ',';
                if (!delimiters['array-delimiter']) delimiters['array-delimiter'] = ';';
                if (!delimiters['key-value-delimiter']) delimiters['key-value-delimiter'] = ':';
                if (!delimiters['quote-delimiter']) delimiters['quote-delimiter'] = '"';
            } else {
                delimiters = {
                    delimiter: ',',
                    'array-delimiter': ';',
                    'key-value-delimiter': ':',
                    'quote-delimiter': '"'
                }
            }

            var option = {
                'user': userId,
                'jid': jobId,
                'main': mid,
                'args': {},
                'models': {}
            };
            option.models[mid] = {
                'mid': mid,
                'type': "data",
                'functions': [
                    {
                        'fid': 'f-unload',
                        'func': 'unload',
                        'inData': [inTable],
                        'name': 'OutData',
                        'param': {
                            'io-mode': 'write',
                            'fs-type': 'alluxiocsv',
                            'df-names': [inTable],
                            'fs-paths': [outPath],
                            'delimiter': delimiters.delimiter,
                            'array-delimiter': delimiters['array-delimiter'],
                            'key-value-delimiter': delimiters['key-value-delimiter'],
                            'quote': delimiters['quote-delimiter']
                        }
                    }
                ],
                'links': [],
                'entries': ['f-unload']
            };

            var opt = {
                url: 'api/va/v2/analytics/jobs',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(option),
                blocking: false
            };
            $.extend(true, opt, additionalOpt);
            $.ajax(opt).done(function () {

                _this.progress(userId, jobId).done(rep.doneCallback).fail(rep.failCallback);

            }).fail(function () {
                if (rep.failCallback) rep.failCallback();
            });

            return rep;
        },
        export: function (fileName, dataPath, delimiters, callback, failCallback, additionalOpt) {
            var fileName = fileName;
            var delimiter = delimiters.delimiter || ',';
            var path = dataPath;
            var opt = {
                url: 'api/va/v2/data/download',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({
                    // localFileName: fileName,
                    delimiter: delimiter,
                    remotePath: path,
                    filename: fileName
                }),
                blocking: false,
                timeout: 30 * 60 * 1000
            };
            $.extend(true, opt, additionalOpt);

            var encodedKey = encodeURIComponent(path);
            var encodedDelimiter = encodeURIComponent(delimiter);
            var encodedFilename = encodeURIComponent(fileName);

            $.ajax(opt).done(function (result) {
                // var blob = new Blob(sb, {type: 'text/csv'});
                if (window.navigator.msSaveBlob) {
                    Promise.resolve($.get('api/va/v2/data/download/files/?' +
                        Brightics.VA.Core.Utils.CommonUtils.getQueryString({
                            key: encodedKey,
                            delimiter: encodedDelimiter,
                            filename: encodedFilename
                        }))
                    )
                        .then(function (file) {
                            console.log(file);
                            window.navigator.msSaveBlob(new Blob([file]), fileName);
                        });
                } else {
                    var anchor = document.createElement('a');
                    anchor.setAttribute("href", encodeURI('api/va/v2/data/download/files/?key=' + encodeURIComponent(path) + '&delimiter=' + encodeURIComponent(delimiter) + '&filename=' + encodeURIComponent(fileName)));
                    anchor.setAttribute("download", fileName);
                    anchor.setAttribute('id', 'downloadfile');
                    anchor.setAttribute('target', '_blank');
                    $(anchor)[0].click();

                    setTimeout(function () {
                        $('#downloadfile').remove()
                    }, 10000);
                }

                callback();
            }).fail(function (error) {
                failCallback(error);
            });
        },
        download: function (remotePath, localFileName, additionalOpt) {
            var option = {
                'remotePath': remotePath,
                'localFileName': localFileName
            };
            var opt = {
                url: 'api/va/v2/data/download',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: false,
                data: JSON.stringify(option)
            };
            $.extend(true, opt, additionalOpt);
            return $.ajax(opt).done(function (result) {
                $('<object>', {
                    id: 'downloadfile',
                    data: 'api/va/v2/repo/download/files/' + result.file,
                    target: '_top',
                    type: "text/html", title: "Title"
                }).hide().appendTo('body');
                setTimeout(function () {
                    $('#downloadfile').remove()
                }, 10000);
            }).fail(function (err) {
                console.log(err)
            });
        }
    };

}).call(this);
/**
 * Created by SDS on 2016-01-28.
 */

/* global _ */
(function () {
    'use strict';
    var root = this;
    var Brightics = root.Brightics;
    root.Brightics.VA.Core.Utils.ExportUtils = {
        exportProject: function (projectId, doneCallback, failCallback) {
            _getProject(projectId, doneCallback, failCallback);
        }
    };

    function _getProject(projectId, doneCallback, failCallback) {
        ResourceManager.fetchProject(projectId)
            .then(function (project) {
                return ResourceManager.initProject(project);
            })
            .then(function () {
                var project = ResourceManager.getProject(projectId).toJSON();
                if (!project) return Promise.reject('there is no project');
                project.files = _.map(ResourceManager.getFiles(projectId), function (file) {
                    return file.toJSON();
                });
                return _getRelatedDataflowVersion(project)
                    .then(function (versions) {
                        project.versions = _.map(versions, function (version) {
                            return version.toJSON();
                        });
                        return project;
                    });
            })
            .then(function (project) {
                if (doneCallback && typeof doneCallback === 'function') {
                    doneCallback([project]);
                }
            })
            .catch(function (err) {
                failCallback(err);
            });
    }

    function _getRelatedDataflowVersion(project) {
        var cfModels = _.filter(project.files, function (file) {
            return file.type === 'control';
        });

        var promises = _.map(cfModels, function (model) {
            return Brightics.VA.Core.Utils.ModelUtils.createModelTree(project.id, model.contents);
        });

        return Promise.all(promises)
            .then(function mergeModelTree(versions) {
                return _.reduce(versions, _.merge, {});
            })
            .then(function (mergedModelTree) {
                var resultVersions = [];
                _.forOwn(mergedModelTree, function (node) {
                    _.forOwn(node.version, function (version) {
                        resultVersions.push(version);
                    });
                });
                return resultVersions;
            });
    }
}).call(this);

/**
 * hyunseok.oh@samsung.com
 * 2018-01-02
 *
 * 의존모듈 : jQuery
 */

(function () {
    'use strict';

    var root = this;

    root.Brightics.VA.Core.Utils.FileDao = (function () {
        var sendAjax = function (option, doneCallback, failCallback) {
            return new Promise(function (resolve, reject) {
                $.ajax(option)
                    .done(function (result) {
                        if (doneCallback && typeof doneCallback === 'function') {
                            if (result && result.length) {
                                doneCallback(result[0]);
                            } else if (result) {
                                doneCallback(result);
                            } else {
                                doneCallback(null);
                            }
                        }

                        if (result && result.length) {
                            resolve(result[0]);
                        } else if (result) {
                            resolve(result);
                        } else {
                            resolve(null);
                        }
                    }).fail(function (err) {
                        if (failCallback && typeof failCallback === 'function') {
                            failCallback(err);
                        }
                        reject(err);
                    });
            });
        };

        var getFile = function (projectId, fileId, doneCallback, failCallback) {
            var option = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files/' + fileId,
                type: 'GET',
                contentType: 'application/json; charset=utf-8'
            };
            return sendAjax(option, doneCallback, failCallback);
        };

        // public
        return {
            getFile: getFile
        };
    }());
}).call(this);

/**
 * hyunseok.oh@samsung.com
 * 2017-12-20
 *
 * 의존모듈 : jQuery
 */


/**
 * JSDoc 테스트 해보려고 넣어봤음
 */
(function () {
    'use strict';

    var root = this;
    var assert = function (exp) {
        if (!exp) throw new Error(exp);
    };
    // Utils 말고 다른데 있어야 할 것 같아요.
    root.Brightics.VA.Core.Utils.FileVersionDao = (function () {
        var sendAjax = function (option, doneCallback, failCallback) {
            // var ajaxRequest = $.ajax(option);
            // if (!doneCallback && !failCallback) {
            //     return Promise.resolve(ajaxRequest);
            // }
            return new Promise(function (resolve, reject) {
                $.ajax(option)
                    .done(function (result) {
                        if (doneCallback && typeof doneCallback === 'function') {
                            doneCallback(result);
                        }
                        resolve(result);
                    }).fail(function (err) {
                        if (failCallback && typeof failCallback === 'function') {
                            failCallback(err);
                        }
                        reject(err);
                    });
            });
        };

        /**
         * File Version 리스트 contents 없이 가져옴
         * @param {String} mid 파일(모델) ID
         * @param {function=} doneCallback
         * @param {function=} failCallback
         * @return {Promise<FileVersion[]>|undefined}
         */
        var getFileVersions = function (projectId, mid, doneCallback, failCallback) {
            var option = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files/' + mid + '/versions',
                type: 'GET',
                contentType: 'application/json; charset=utf-8'
            };
            return sendAjax(option, doneCallback, failCallback);
        };

        /**
         * File Version contents 없이 가져옴
         * @param {String} mid 파일(모델) ID
         * @param {String} versionId 파일 버젼 ID
         * @param {function=} doneCallback
         * @param {function=} failCallback
         * @return {Promise<FileVersion>|undefined}
         */
        var getFileVersion = function (projectId, mid, versionId, doneCallback, failCallback) {
            var option = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files/' + mid + '/versions/' + versionId,
                type: 'GET',
                contentType: 'application/json; charset=utf-8'
            };
            return sendAjax(option, doneCallback, failCallback);
        };

        var addFileVersion = function (projectId, mid, versionContents, doneCallback, failCallback) {
            var option = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files/' + mid + '/versions',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: false,
                data: JSON.stringify(versionContents)
            };
            return sendAjax(option, doneCallback, failCallback);
        };

        var addFileVersionSync = function (projectId, mid, versionContents, doneCallback, failCallback) {
            var option = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files/' + mid + '/versions',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: true,
                data: JSON.stringify(versionContents)
            };
            return sendAjax(option, doneCallback, failCallback);
        };

        var deleteFileVersion = function (projectId, mid, versionId, doneCallback, failCallback) {
            var option = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files/' + mid + '/versions/'+ versionId + '/delete',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: false
            };
            return sendAjax(option, doneCallback, failCallback);
        };

        var updateFileVersion = function (projectId, mid, versionId, versionContents,
                doneCallback, failCallback) {
            var option = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files/' + mid + '/versions/' + versionId + '/update',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: false,
                data: JSON.stringify(versionContents)
            };
            return sendAjax(option, doneCallback, failCallback);
        };

        var loadFileVersion = function (projectId, mid, versionId, doneCallback, failCallback) {
            var option = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files/' + mid + '/versions/'+ versionId + '/load',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: false
            };
            return sendAjax(option, doneCallback, failCallback);
        };

        // public
        return {
            getFileVersions: getFileVersions,
            getFileVersion: getFileVersion,
            addFileVersion: addFileVersion,
            addFileVersionSync: addFileVersionSync,
            deleteFileVersion: deleteFileVersion,
            updateFileVersion: updateFileVersion,
            loadFileVersion: loadFileVersion
        };
    }());
}).call(this);

/**
 * Created by ji_sung.park on 2017-05-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    const DUMMY_FNUNIT = {
        'func': 'dummy',
        'name': 'BigDataDummy',
        'inData': [],
        'outData': [],
        'param': {},
        'label': 'Big Data Dummy',
        'display': {
            'label': 'Big Data Dummy',
            'diagram': {
                'position': {
                    'x': 20,
                    'y': 10
                }
            },
            'sheet': {
                'out': [
                    {
                        'panel': [],
                        'layout': {}
                    }
                ]
            }
        },
        'mandatory': []
    };

    const BIG_DATA_LIMIT = 30000;
    function getBigDataTargetTid(contentUnit, dataSource) {
        if (typeof dataSource === 'string') {
            return contentUnit.id + dataSource;
        }
        return contentUnit.id + dataSource[OUT_DATA][0];
    }

    function isBigData(_opt) {
        var opt = _opt;
        var modelId = opt.modelId;
        var tableId = opt.tableId;
        var user = opt.user;
        var isPublish = opt.isPublish;

        var __assert = function (name, x) {
            if (typeof x === 'undefined') throw new Error(name + ' is required');
        };

        __assert('modelId', modelId);
        __assert('tableId', tableId);
        __assert('user', user);
        __assert('isPublish', isPublish);

        return new Promise(function (resolve, reject) {
            Brightics.VA.Core.DataQueryTemplate.queryTable(
                modelId,
                tableId,
                function (data, table) {
                    return resolve(data.count >= BIG_DATA_LIMIT);
                },
                function (data, table, err) {
                    return reject(err);
                },
                true,
                {
                    offset: 0,
                    limit: BIG_DATA_LIMIT,
                    user: user,
                    publish: isPublish
                }
            );
        });
    }

    Brightics.VA.Core.Utils.FullRenderingUtils = {
        getFnUnit: function (chartOptions) {
            var chartType = chartOptions.chart.type;
            var options = {
                chartOptions: chartOptions
            };

            var generator = Brightics.VA.Core.Utils.FnUnitGenerator[chartType] ?
                new Brightics.VA.Core.Utils.FnUnitGenerator[chartType](options) :
                new Brightics.VA.Core.Utils.FnUnitGenerator(options);
            return generator.generate();
        },
        convertToChartSource: function (renderingType, result) {
            var source = result;
            if (renderingType === 'bigDataBoxPlot' || renderingType === 'boxplot') {
                /**
                 *  xAxis ^ yAxis
                 *  setosa  ^ {box: "2.9, 3.2, 3.4, 3.6, 4.2", outliers; "2.3, 4.4"}
                 */
                for (var i in source.data) {
                    source.data[i][1].box = source.data[i][1].box.split(",").map(function (item) {
                        return parseFloat(item)
                    });
                    var outliers = source.data[i][1].outliers;
                    if (outliers != "") outliers = outliers.split(",").map(function (item) {
                        return parseFloat(item)
                    });
                    else outliers = [];
                }
            }
            source.dataType = 'chartdata';
            return source;
        },
        getRenderedData: function (
                fnUnit,
                modelLauncher,
                launchOptions,
                _successCallback,
                _failCallback,
                _jobIdCallback) {
            var _this = this;

            var EMPTY_DATA = {
                dataType: 'rawdata',
                columns: [],
                data: []
            };

            var toFunc = function (fn) {
                return fn && typeof fn === 'function' ? fn : function () { };
            };

            var successCallback = toFunc(_successCallback);
            var failCallback = toFunc(_failCallback);
            var jobIdCallback = toFunc(_jobIdCallback);

            var getQueryOption = function (limit) {
                return {
                    offset: 0,
                    limit: limit,
                    user: launchOptions.user,
                    publish: launchOptions.publish
                };
            };

            var modelId = launchOptions.mid || fnUnit.parent().mid;

            var queryOriginalTable = function (modelId, tableId) {
                Brightics.VA.Core.DataQueryTemplate.queryTable(
                    modelId,
                    tableId,
                    function (data, tableId) {
                        data.dataType = 'rawdata';
                        successCallback(data, tableId);
                    },
                    function (data, tableId, err) {
                        failCallback(data, tableId, err);
                    },
                    true,
                    getQueryOption(10000)
                );
            };

            var validateOptions = function (fnUnit, data) {
                var message = [];

                var chartType = fnUnit['func'].replace('bigData', '').toLowerCase();
                var param = fnUnit.param;
                if (chartType === 'line' || chartType === 'scatter' || chartType === 'bubble') {
                    if (param['xcolumn']) {
                        var type = '';
                        for (var i in data.columns) {
                            if (data.columns[i].name === param['xcolumn'][0][0]) type = data.columns[i].type;
                        }
                        //if(type === '' || type != 'number') message.push('X-axis has to be a number type column in this chart type.');
                    }
                    if (param['ycolumn']) {
                        var type = '';
                        for (var i in data.columns) {
                            if (data.columns[i].name === param['ycolumn'][0][0]) type = data.columns[i].type;
                        }
                        //if(type === '' || type != 'number') message.push('Y-axis has to be a number type column in this chart type.');
                    }
                    //if(param['aggregation'] != 'none') message.push('Aggregation of Y-axis except "none" is not supported yet.');
                }

                return message;
            };

            var tableId = fnUnit[IN_DATA];
            if (fnUnit.func === 'dummy') {
                queryOriginalTable(modelId, tableId);
            } else {
                Brightics.VA.Core.DataQueryTemplate.queryTable(
                    modelId,
                    tableId,
                    function (data, tableId) {
                        if (data.count >= 0 && data.count < BIG_DATA_LIMIT) {
                            data.dataType = 'rawdata';
                            successCallback(data, tableId);
                        } else {
                            // BIG
                            var getCachedData = new Promise(function (resolve, reject) {
                                try {
                                    if (launchOptions.publish) {
                                        Brightics.VA.Core.DataQueryTemplate.queryTable(
                                            modelId,
                                            getBigDataTargetTid(launchOptions.contentUnit.content, fnUnit[IN_DATA][0]),
                                            function (data, table) {
                                                return resolve([
                                                    data,
                                                    table
                                                ]);
                                            },
                                            function (data, table, err) {
                                                return reject(err);
                                            },
                                            true,
                                            getQueryOption(100000)
                                        );
                                    } else {
                                        return reject();
                                    }
                                } catch (e) {
                                    return reject(e);
                                }
                            });

                            getCachedData
                                .then(function (tmp) {
                                    var data = tmp[0];
                                    var table = tmp[1];
                                    var source = _this.convertToChartSource(fnUnit.func, data);
                                    successCallback(source, table);
                                })
                                .catch(function () {
                                    var listeners = {
                                        'success': function (res) {
                                            var outTable = fnUnit[OUT_DATA];
                                            Brightics.VA.Core.DataQueryTemplate.queryTable(
                                                modelId,
                                                outTable,
                                                function (data, tableId) {
                                                    var source = _this.convertToChartSource(fnUnit.func, data);
                                                    successCallback(source, tableId);
                                                },
                                                function (data, tableId, err) {
                                                    failCallback(data, tableId, err);
                                                },
                                                true,
                                                getQueryOption(100000)
                                            );

                                            jobIdCallback(res.result);
                                        },
                                        'fail': function (err) {
                                            failCallback(EMPTY_DATA, tableId, err);
                                        },
                                        'catch': function (err) {
                                            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
                                            failCallback(EMPTY_DATA, tableId, err);
                                        }
                                    };
                                    modelLauncher.launchUnit(Object.assign({}, fnUnit, {
                                        persist: true,
                                    }), {}, launchOptions, listeners);
                                });
                        }
                    }, function (data, tableId, err) {
                        failCallback(data, tableId, err);
                    },
                    true,
                    getQueryOption(BIG_DATA_LIMIT)
                );
            }
        },
        getBigDataTargetTid: getBigDataTargetTid,
        isBigData: isBigData
    };

}).call(this);
/**
 * Created by SDS on 2016-01-28.
 */

/* global _ */
(function () {
    'use strict';
    var root = this;
    var Brightics = root.Brightics;

    root.Brightics.VA.Core.Utils.ImportUtils = {
        importProject: function (label, description, data, doneCallback, failCallback) {
            if (data.length) {
                var projectId = Brightics.VA.Core.Utils.IDGenerator.project.id();
                var project = data[0];
                _createProject(projectId, label, description, function () {
                    project.versions = project.versions || [];
                    var old2newFileId = _getIdMap(project.files, project.versions);
                    _changeModelsId(project.files, project.versions, old2newFileId);
                    _cloneModelsAndVersions(project.files, project.versions);
                    _postVersions(projectId, project.versions)
                        .then(function (versionIdMap) {
                            _changeModelsVersionId(project.files, versionIdMap);
                            _createProjectModels(projectId, project.files, function () {
                                if (doneCallback && typeof doneCallback === 'function') {
                                    doneCallback(projectId);
                                }
                            }, failCallback);
                        })
                        .catch(function (err) {
                            failCallback(err);
                        });
                }, failCallback);
            } else {
                if (failCallback && typeof failCallback === 'function') failCallback('Invalid JSON Data.');
            }
        }
    };

    function _createProject(projectId, label, description, doneCallback, failCallback) {
        var project = new Brightics.VA.Vo.Project();
        project.setProjectId(projectId);
        project.setLabel(label || 'untitled');
        project.setDescription(description || '');
        project.setCreator(Brightics.VA.Env.Session.userId);

        ResourceManager.addProject(project)
            .then(function () {
                doneCallback();
            })
            .catch(function (err) {
                failCallback(err);
            });
    }

    function _createProjectModels(projectId, models, doneCallback, failCallback) {
        var promises = [];
        for (var i in models) {
            if (models[i].type === 'visual') continue;
            var model = models[i];
            var modelContents = Brightics.VA.Core.Utils.ModelUtils.cloneModel(model.contents);
            var file = new Brightics.VA.Vo.File();
            file.setFileId(model.id);
            file.setProjectId(projectId);
            file.setLabel(model.label);
            file.setDescription(model.description);
            file.setContents(modelContents);
            file.setCreator(Brightics.VA.Env.Session.userId);
            var promise = ResourceManager.addFile(projectId, file);
            promises.push(promise);
        }

        Promise.all(promises).then(function () {
            if (doneCallback && typeof doneCallback === 'function') doneCallback(projectId);
        }, function (error) {
            if (failCallback && typeof failCallback === 'function') failCallback(error);
        });
    }

    function _createCache(models) {
        var cacheMap = { midCache: {} };
        for (var i in models) {
            var model = models[i];
            cacheMap.midCache[model.id] = Brightics.VA.Core.Utils.IDGenerator.model.id();
        }
        return cacheMap;
    }

    function _changeModelsId(files, versions, idMap) {
        if (files) {
            _.forEach(files, function (file) {
                if (file.type === 'control') {
                    _changeInsertedDataFlowModelId(file.contents.functions, idMap);
                }
                var oldMid = file.id;
                file.id = idMap[oldMid];
                file.contents.mid = idMap[oldMid];
            });
        }

        if (versions) {
            _.forEach(versions, function (version) {
                if (version.type === 'control') {
                    _changeInsertedDataFlowModelId(version.contents.functions, idMap);
                }
                var oldMid = version.file_id;
                version.file_id = idMap[oldMid];
                version.contents.mid = idMap[oldMid];
            });
        }
    }


    function _changeInsertedDataFlowModelId(functions, midCache) {
        for (var i in functions) {
            _changeInsertedDataFlowModelId(functions[i].param.functions, midCache);
            if (functions[i].func === 'dataFlow') {
                var oldMid = functions[i].param.mid;
                functions[i].param.mid = midCache[oldMid] || 'DeletedDataFlow';
            }
        }
    }

    function _getIdMap(files, versions) {
        var idMap = {};
        var _getId = function (functions) {
            _.forEach(functions, function (fn) {
                if (fn.param.functions) _getId(fn.param.functions);
                if (fn.param.mid) {
                    idMap[fn.param.mid] = idMap[fn.param.mid] ||
                        Brightics.VA.Core.Utils.IDGenerator.model.id();
                }
            });
        };
        if (files) {
            _.forEach(files, function (file) {
                idMap[file.id] = idMap[file.id] || Brightics.VA.Core.Utils.IDGenerator.model.id();
                _getId(file.contents.functions);
            });
        }
        if (versions) {
            _.forEach(versions, function (version) {
                idMap[version.file_id] = idMap[version.file_id] ||
                    Brightics.VA.Core.Utils.IDGenerator.model.id();
                _getId(version.contents.functions);
            });
        }
        return idMap;
    }

    function _changeModelsVersionId(files, versionIdMap) {
        _.forEach(files, function (file) {
            _.forEach(file.contents.functions, function (fn) {
                if (fn[FUNCTION_NAME] === 'DataFlow') {
                    if (fn.param.version_id) {
                        fn.param.version_id = versionIdMap[fn.param.version_id];
                    }
                }
            });
        });
    }

    function _cloneModelsAndVersions(files, versions) {
        var modelTree = {};
        var insertFile = function (file) {
            modelTree[file.id] = modelTree[file.id] || { version: {} };
            modelTree[file.id].main = file.contents;
        };

        var insertVersion = function (version) {
            modelTree[version.file_id] = modelTree[version.file_id] || { version: {} };
            modelTree[version.file_id].version[version.version_id] = version.contents;
        };

        if (files) {
            _.forEach(files, insertFile);
        }
        if (versions) {
            _.forEach(versions, insertVersion);
        }
        var clonedTree = Brightics.VA.Core.Utils.ModelUtils.cloneModelsByTree(modelTree);
        if (files) {
            _.forEach(files, function (file) {
                file.contents = clonedTree[file.id].main;
            });
        }
        if (versions) {
            _.forEach(versions, function (version) {
                version.contents = clonedTree[version.file_id].version[version.version_id];
            });
        }
    }

    function _postVersions(projectId, versions) {
        var idMap = {};
        return Promise.all(_.map(versions, function (_version) {
            var version = new Brightics.VA.Vo.Version(_version);
            version.setIsManual(true);
            return Brightics.VA.Dao.VersionDao.addVersion(
                projectId,
                version.getFileId(),
                version)
                .then(function (newVersion) {
                    idMap[version.getVersionId()] = newVersion.getVersionId();
                });
            // return Brightics.VA.Core.Utils.FileVersionDao
            //     .addFileVersionSync(projectId,
            //         version.file_id,
            //         _.extend({ isManual: true }, version))
            //     .then(function (newVersion) {
            //         idMap[version.version_id] = newVersion.version_id;
            //     });
        })).then(function () {
            return idMap;
        });
    }
}).call(this);

/**
 * Created by SDS on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;

    // IE와 Chrome이 달라서 IE Event.key -> Chrome Event.key
    // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values
    var getKey = function (evt) {
        var map = {
            'Spacebar': ' ',
            'Up': 'ArrowUp',
            'Down': 'ArrowDown',
            'Left': 'ArrowLeft',
            'Right': 'ArrowRight'
        };
        return map[evt.key] || evt.key;
    };

    root.Brightics.VA.Core.Utils.InputValidator = {

        isDefaultKeyCode: function (keyEvent) {
            var keyCode = keyEvent.keyCode,
                isCtrlKey = keyEvent.ctrlKey;
            // Allow: backspace, delete, tab, escape, enter
            if ($.inArray(keyCode, [46, 8, 9, 27, 13, 110]) !== -1 ||
                // Allow: Ctrl + anythig
                (isCtrlKey) ||
                // Allow: Shift, Ctrl
                (keyCode === 16 || keyCode === 17) ||
                // Allow: home, end, left, right, down, up
                (keyCode >= 35 && keyCode <= 40)) {
                return true;
            } else {
                return false
            }
        },
        isNotInsertKeyCode: function (keyEvent) {
            var keyCode = keyEvent.keyCode,
                isCtrlKey = keyEvent.ctrlKey;
            // Allow: backspace, escape, delete, delete(Mozilla)
            if ($.inArray(keyCode, [8, 27, 46, 110]) !== -1 ||
                // Allow: Ctrl + 'a', 'c', 'x', 'z'
                (isCtrlKey && $.inArray(keyCode, [65, 67, 88, 90]) !== -1 ) ||
                // Allow: home, end, left, right, down, up
                (keyCode >= 35 && keyCode <= 40)) {
                return true;
            } else {
                return false
            }
        },
        isValid: {
            // true: 0-9, a-z, A-Z, _
            type1: function (str) {
                var reg = new RegExp('^[a-zA-Z0-9_]+$');
                return reg.test(str);
            },
            // true: 0-9, a-z, A-Z, _, space
            type2: function (str) {
                var reg = new RegExp('^[a-zA-Z0-9_\\s]+$');
                return reg.test(str);
            },
            // true: 0-9, a-z, A-Z, _, space, {, } ,$
            type3: function (str) {
                var reg = new RegExp('^[a-zA-Z0-9_{}\\$]+$');
                return reg.test(str);
            },
            // true: 0-9, a-z, A-Z, _, .
            type4: function (str) {
                var reg = new RegExp('^[a-zA-Z0-9_\\.]+$');
                return reg.test(str);
            },
            // true: start with _, 0-9
            type5: function (str) {
                var reg = new RegExp('^[0-9_]');
                return reg.test(str);
            },
            // true: only alphabet and space (User Name)
            type6: function (str) {
                var reg = new RegExp('^[a-zA-Z ]+$');
                return reg.test(str);
            },
            // true: not start with "0-9"
            columnNameType: function (str) {
                var reg = new RegExp('^[0-9]+');
                return !reg.test(str);
            },
            integerType: function (str) {
                var reg = new RegExp('^[0-9]+$');
                return reg.test(str);
            },
            startWithSpace: function (str) {
                var reg = new RegExp('^\\s');
                return reg.test(str);
            },
            endWithSpace: function (str) {
                var reg = new RegExp('\\s$');
                return reg.test(str);
            },
            cronType: function (str) {
                var reg = new RegExp('^[A-Z0-9-\?\*\/\,\# ]+$');
                return reg.test(str);
            },
            // true: . - ~ 만 허용
            rangeType: function (str) {
                var reg = new RegExp('^[0-9_\.\-\~]+$');
                return reg.test(str);
            },
            // true: 숫자 . ~ 만 허용
            featureEncodingRangeType: function (str) {
                var reg = new RegExp('^[0-9_\.\~]+$');
                return reg.test(str);
            },
            fileNameType: function (str) {
                var reg = new RegExp('^[a-zA-Z0-9_\.\/\@]+$');
                return reg.test(str);
            },
            renamefileType: function (str) {
                var reg = new RegExp('^[a-zA-Z0-9_\.]+$');
                return reg.test(str);
            }
        },
        replaceKoreanToEmpty: function (str) {
            return str.replace(/[ㄱ-ㅎㅏ-ㅣ가-힣]/g, '');
        },
        appendValidationCondition: function ($control) {
            var validator = this;
            if ($control.attr('valid-type')) {
                var validType = $control.attr('valid-type');

                $control.on('paste', function (e) {
                    var pastedString =
                        (e.originalEvent.clipboardData || window.clipboardData).getData('Text');

                    if (!validator.isValid[validType](pastedString)) {
                        e.preventDefault();
                        var message = '※ This pasted string is NOT allowed.';
                        Brightics.VA.Core.Widget.Factory.createFadeOutMessage($control, {message: message});
                    }
                });

                $control.keydown(function (e) {
                    if (validator.isDefaultKeyCode(e)) {
                        return;
                    }
                    var key = getKey(e);
                    // FIXME: IE에서 한영키가 안잡힘.
                    if (!validator.isValid[validType](key) && key === 'Process') {
                        var message = '※ Korean character is NOT allowed.';
                        Brightics.VA.Core.Widget.Factory.createFadeOutMessage($control, {message: message});

                        var replacedValue = validator.replaceKoreanToEmpty($control.val());

                        if (validator.replaceKoreanToEmptyTimeout) {
                            clearTimeout(validator.replaceKoreanToEmptyTimeout);
                        }
                        validator.replaceKoreanToEmptyTimeout = setTimeout(function () {
                            $control.val(replacedValue);
                        }, 100);


                    } else if (!validator.isValid[validType](key)) {
                        e.preventDefault();
                        var message = '※ This character( ' + key + ' ) is NOT allowed.';
                        Brightics.VA.Core.Widget.Factory.createFadeOutMessage($control, {message: message});
                    }

                })
            }

        }
    }

}).call(this);
/**
 * Created by SDS on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    root.Brightics.VA.Core.Utils.MessageUtils = {
        initMessage: function () {
            var _this = this;
            var opt = {
                url: 'api/va/v2/studio/message/en',
                type: 'GET',
                blocking: false
            };
            $.ajax(opt).done(function (res) {
                var messageMap = {};
                for (var i in res) {
                    messageMap[res[i].code] = {
                        message: res[i].message
                    }
                }
                _this.Message = messageMap;
            });
        },
        initFunctionLabel: function () {
            var _this = this;
            var opt = {
                url: 'api/va/v2/studio/functionlabel/en',
                type: 'GET',
                blocking: false
            };
            this.FunctionLabel = {};
            $.ajax(opt).done(function (res) {
                for (var i = 0; i < res.length; i++) {
                    var func = res[i];
                    _this.FunctionLabel[func.functionName] = _this.FunctionLabel[func.functionName] || {};
                    _this.FunctionLabel[func.functionName][func.parameter] = func.label;
                }
            });
        },
        getFunctionLabels: function (func, params) {
            var labels = [];
            for (var i in params) {
                if (this.FunctionLabel[func] && this.FunctionLabel[func][params[i]]) {
                    labels.push(this.FunctionLabel[func][params[i]]);
                } else {
                    if (params[i] === 'inData') {
                        labels.push('In Table');
                    } else {
                        labels.push(params[i]);
                    }
                }
            }
            return labels;
        },
        getFunctionLabel: function (func, param) {
            if (this.FunctionLabel[func] && this.FunctionLabel[func][param]) {
                return this.FunctionLabel[func][param];
            } else {
                return param;
            }
        },
        getMessage: function (code, params) {
            if (!this.Message || !this.Message[code]) return 'Please contact administrator! Error: ' + code;
            var message = this.Message[code].message;
            for (var i in params) {
                message = message.replace('%s', params[i]);
            }
            return message;
        },
        getReplacedParam: function (func, params) {
            if(func == 'evaluateRankingAlgorithm'){
                var replaceParamCodeList =  ["Precision", "NDCG", "K-Values"];
                params = replaceParamCodeList;
                return params;
            }
        },
        getFunctionLabelAll: function () {
            return this.FunctionLabel;
        }
    };

}).call(this);
/**
 * Created by SDS on 2016-01-28.
 */


/* global _, IN_DATA, OUT_DATA, FUNCTION_NAME */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var Dao = Brightics.VA.Dao;
    var ResourceManager = brtc_require('ResourceManager');
    var FnUnitUtils = brtc_require('FnUnitUtils');

    root.Brightics.VA.Core.Utils.ModelUtils = {
        extendParent: function (model, fnUnit) {
            fnUnit.parent = function () {
                return model;
            };

            if (fnUnit.param && fnUnit.param.functions) {
                for (var i in fnUnit.param.functions) {
                    if (typeof fnUnit.param.functions[i].fid !== 'undefined') {
                        this.extendParent(fnUnit, fnUnit.param.functions[i]);
                    }
                }
            }
        },
        extendMainFunc: function (mainModel, model) {
            var _this = this;
            model.getMainModel = function () {
                return mainModel;
            };
            model.isMainModel = function () {
                return this === this.getMainModel();
            };
            var subModels = Brightics.VA.Core.Utils.NestedFlowUtils
                .getChildModels(mainModel, model);
            _.forEach(subModels, _.partial(_this.extendMainFunc.bind(_this), mainModel, _));
        },
        extendModel: function (contents, doClone) {
            var _this = this;
            var model;
            var defaultModel = Brightics.VA.Core.Interface.DefaultModel[contents.type];

            if (defaultModel) {
                if (doClone) model = $.extend(true, {}, defaultModel, contents);
                else model = $.extend(true, contents, defaultModel);
                _.forIn(model.innerModels, function (subModel) {
                    _this.extendInnerModel(model, subModel);
                });
            } else {
                console.error('Create DefaultModel(' + contents.type + ')!');
                return;
            }

            model = $.extend(true, model, Brightics.VA.Default.model);
            for (var i in model.functions) {
                if (model.functions[i]) {
                    this.extendParent(model, model.functions[i]);
                    if (typeof model.functions[i]['persist-mode'] === 'undefined') {
                        model.functions[i]['persist-mode'] = 'auto';
                    }
                }
            }

            if (typeof model['persist-mode'] === 'undefined') {
                model['persist-mode'] = 'auto';
            }

            this.extendMainFunc(model, model);
            return model;
        },
        extendInnerModel: function (mainModel, contents, doClone) {
            var _this = this;
            var model;

            var defaultModel = Brightics.VA.Implementation.DataFlow.innerModel;
            if (defaultModel) {
                if (doClone) model = $.extend(true, {}, defaultModel, contents);
                else model = $.extend(true, contents, defaultModel);
            } else {
                console.error('Create DefaultModel(' + contents.type + ')!');
                return;
            }

            model = $.extend(true, model, Brightics.VA.Default.model);
            for (var i in model.functions) {
                if (model.functions[i]) {
                    this.extendParent(model, model.functions[i]);
                    if (typeof model.functions[i]['persist-mode'] === 'undefined') {
                        model.functions[i]['persist-mode'] = 'auto';
                    }
                }
            }

            if (typeof model['persist-mode'] === 'undefined') {
                model['persist-mode'] = 'auto';
            }

            this.extendMainFunc(mainModel, model);
            return model;
        },
        exportAsRunnablePromise: function (mainModel, model, withReport) {
            var projectId = ResourceManager
                .getFile(undefined, mainModel.mid).getProjectId();

            return Brightics.VA.Core.Utils.NestedFlowUtils
                .makeRunnable(projectId, model);
        },
        exportAsRunnable: function (contents, withReport) {
            var _this = this;
            var execModel = this.extendModel(contents, true);

            delete execModel.FUNC_ID_CHAR;
            delete execModel.FUNC_ID_LENGTH;
            delete execModel.preferences;
            delete execModel.problemList;
            delete execModel.sheets;
            if (typeof withReport === 'undefined' || !withReport) {
                delete execModel.report;
            }
            // delete execModel['gv-def'];

            execModel.entries = [];

            for (var j in execModel.functions) {
                var fnUnit = execModel.functions[j];
                var label = fnUnit.display.label || '';
                fnUnit.label = label;
                delete fnUnit.display;

                var previousList = fnUnit.parent().getPrevious(fnUnit.fid);
                if (previousList.length < 1) {
                    execModel.entries.push(fnUnit.fid);
                }
                this.carvePersist(fnUnit, true);
                this.deleteEmptyArray(fnUnit);

                if (fnUnit[FUNCTION_NAME] == 'Subflow' && fnUnit.param.functions.length > 0) {
                    if (!fnUnit.param.entries) {
                        fnUnit.param.entries = [fnUnit.param.functions[0].fid];
                    }

                    for (var k in fnUnit.param.functions) {
                        var subFnUnit = fnUnit.param.functions[k];
                        var label = fnUnit.label || '';
                        subFnUnit.label = label;
                        delete subFnUnit.display;
                    }
                }
            }

            if (execModel.innerModels) {
                execModel.innerModels = _.reduce(_.map(execModel.innerModels, function (m, key) {
                    var ret = {};
                    ret[key] = _this.exportAsRunnable(m);
                    return ret;
                }), _.merge, {});
            }
            return execModel;
        },

        previousFnUnitList: function (content, fid, functions) {
            var previousList = content.getPrevious(fid);
            for (var i in previousList) {
                if (functions.indexOf(previousList[i]) == -1) {
                    functions.push(previousList[i]);
                }
                this.previousFnUnitList(content, previousList[i], functions);
            }
        },

        previousLinks: function (content, fid, links) {
            for (var i in content.links) {
                var link = content.links[i];
                if (link[TARGET_FID] == fid) {
                    links.push(link);
                    this.previousLinks(content, link[SOURCE_FID], links);
                }
            }
        },

        exportAsRunnableForRealTime: function (contents, fnUnit, withReport) {
            var execModel = this.extendModel(contents, true);
            var functions = [];
            functions.push(fnUnit.fid);
            this.previousFnUnitList(execModel, fnUnit.fid, functions);

            var execFunctions = [];
            for (var k in execModel.functions) {
                for (var l in functions) {
                    if (functions[l] === execModel.functions[k].fid) {
                        execFunctions.push(execModel.functions[k]);
                    }
                }
            }
            var execLinks = [];

            this.previousLinks(execModel, fnUnit.fid, execLinks);

            execModel.functions = execFunctions;
            execModel.links = execLinks;

            delete execModel.FUNC_ID_CHAR;
            delete execModel.FUNC_ID_LENGTH;
            delete execModel.preferences;
            delete execModel.problemList;
            delete execModel.sheets;
            delete execModel.title;
            if (typeof withReport === 'undefined' || !withReport) {
                delete execModel.report;
            }
            // delete execModel['gv-def'];

            execModel.entries = [];
            for (var j in execModel.functions) {
                var fnUnit = execModel.functions[j];
                delete fnUnit.display;

                var previousList = fnUnit.parent().getPrevious(fnUnit.fid);
                if (previousList.length < 1) {
                    execModel.entries.push(fnUnit.fid);
                }

                this.deleteEmptyArray(fnUnit);

                if (fnUnit[FUNCTION_NAME] == 'Subflow' && fnUnit.param.functions.length > 0) {
                    if (!fnUnit.param.entries) {
                        fnUnit.param.entries = [fnUnit.param.functions[0].fid];
                    }

                    for (var k in fnUnit.param.functions) {
                        var subFnUnit = fnUnit.param.functions[k];
                        delete subFnUnit.display;
                    }
                }
            }
            return execModel;
        },
        getModelIds: function getModelIds(obj, searchKey, midList) {
            if ('object' != typeof (obj)) {
                return midList;
            } else {
                for (var key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        if (key === searchKey) {
                            midList.push(obj[key]);
                        }
                        getModelIds(obj[key], searchKey, midList);
                    }
                }
            }
            return midList;
        },
        getModelIdsWithVersion: function getModelIdsWithVersion(obj, searchKey, midList) {
            if ('object' != typeof (obj)) {
                return midList;
            } else {
                for (var key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        if (key === searchKey) {
                            var target = {};
                            target[key] = obj[key];
                            if (obj.hasOwnProperty('version_id')) target.version_id = obj.version_id;
                            midList.push(target);
                        }
                        getModelIdsWithVersion(obj[key], searchKey, midList);
                    }
                }
            }
            return midList;
        },
        exportAsRunnableFileByTree: function (projectId, contents, args) {
            return this.createModelTree(projectId, contents)
                .then(function (modelTree) {
                    return this._exportAsRunnableFileByTree(contents, modelTree, args);
                }.bind(this));
        },
        _exportAsRunnableFileByTree: function (contents, modelTree, args) {
            var runnable = this.exportAsRunnable(contents);

            var data = {
                user: 'input_user_id',
                jid: 'input_job_id',
                main: runnable.mid,
                args: args,
                models: {}
            };

            data.models[runnable.mid] = runnable;
            if (runnable.type === 'control') {
                var innerModels = this.getModelIdsWithVersion(runnable.functions, 'mid', []);
                _.forEach(innerModels, function (innerModel) {
                    var key = innerModel.version_id ?
                        innerModel.mid + '_' + innerModel.version_id :
                        innerModel.mid;

                    var innerContents = innerModel.version_id ?
                        modelTree[innerModel.mid].version[innerModel.version_id] :
                        modelTree[innerModel.mid].main;

                    data.models[key] = this.exportAsRunnable(innerContents.contents);
                }.bind(this));
            } else {
                /**
                 * 2016-11-15
                 * gv???�언??param�?variable??값이 ?�력?��? ?�는 것�? ??��
                 * sungjin1.kim
                 */
                for (var i in runnable.gv) {
                    var variable = runnable.gv[i];
                    for (var key in variable.param) {
                        if (args && !args[variable.param[key]]) {
                            delete variable.param[key];
                        }
                    }

                    if (Object.keys(variable.param).length < 1) {
                        runnable.gv.splice(i, 1);
                    }
                }
            }
            return data;
        },
        createModelTree: function (projectId, contents) {
            var modelTree = {};
            return Promise.all(this._createModelTree(projectId, contents, modelTree))
                .then(function () {
                    return modelTree;
                });
        },
        _createModelTree: function (projectId, contents, modelTree) {
            var functions = contents.functions;
            var getModel = function (projectId, fileId, versionId) {
                if (!versionId) return ResourceManager.fetchFile(projectId, fileId);
                return ResourceManager.fetchVersion(projectId, fileId, versionId);
            };

            var insertModel = function (flowContents, fileId, versionId) {
                modelTree[fileId] = modelTree[fileId] || {version: {}};
                if (!versionId) modelTree[fileId].main = flowContents;
                else modelTree[fileId].version[versionId] = flowContents;
                return true;
            };

            var promises = [];
            _.forEach(functions, function (fn) {
                if (fn.param.functions) {
                    promises.push(this._createModelTree(projectId, fn.param.functions, modelTree));
                }
                if (fn[FUNCTION_NAME] === 'DataFlow') {
                    promises.push(
                        getModel(projectId, fn.param.mid, fn.param.version_id)
                            .then(function (resource) {
                                if (typeof resource === 'undefined') {
                                    return Promise.reject('"' + fn.display.label + '" dataflow was deleted or format is invalid in selected control flow');
                                }
                                return insertModel(resource, fn.param.mid, fn.param.version_id);
                            })
                    );
                }
                if (typeof fn.param.modelId !== 'undefined') {
                    promises.push(
                        getModel(projectId, fn.param.modelId, fn.param.version_id)
                            .then(function (resource) {
                                if (typeof resource === 'undefined') {
                                    return Promise.reject('"' + fn.display.label + '" dataflow was deleted or format is invalid in selected report model');
                                }
                                return insertModel(resource, fn.param.modelId, fn.param.version_id);
                            })
                    );
                }
            }.bind(this));
            return _.flatten(promises);
        },
        flattenModelTree: function (flowTree, projectId) {
            var list = [];

            var sortByVersionDesc = function (a, b) {
                if (a.getMajorVersion() !== b.getMajorVersion()) {
                    return b.getMajorVersion() - a.getMajorVersoin();
                }
                return b.getMinorVersion() - a.getMinorVersion();
            };

            // file level
            _.forOwn(flowTree, function (file) {
                // version level
                var subList = [];
                var hasVersion = false;
                _.forOwn(file.version, function (version) {
                    subList.push(version);
                    hasVersion = true;
                });

                subList.sort(sortByVersionDesc);
                subList = _.map(subList, function (version) {
                    var contentsClone = _.cloneDeep(version.getContents());
                    contentsClone.versionTags = version.getTags();
                    contentsClone.versionDescription = version.getDescription();
                    contentsClone.majorVersion = version.getMajorVersion();
                    contentsClone.minorVersion = version.getMinorVersion();
                    return contentsClone;
                });
                if (!hasVersion) {
                    // file??file�??�어가????
                    subList.push(file.main.contents);
                } else {
                    // latest version??file�??�어가????
                    subList.push(_.omit(subList[0], [
                        'version_id',
                        'versionTags',
                        'versionDescription',
                        'majorVersion',
                        'minorVersion'
                    ]));
                    // _.last(subList).title = this.options.resourceManager
                    //     .getFile(projectId, subList[0].mid).label;
                }
                list.push(subList);
            });
            return _.flatten(list);
        },
        getModelArrayByTree: function (modelTree, file, projectId) {
            var modelArray = Brightics.VA.Core.Utils.ModelUtils
                .flattenModelTree(modelTree, projectId);
            modelArray.push(file.getContents());
            return modelArray;
        },
        exportAsRunnableFile: function (contents, modelList, args, withReport, duration) {
            var runnable = this.exportAsRunnable(contents, withReport);
            var report = {};
            if (typeof runnable.report !== 'undefined') {
                report = $.extend(true, {}, runnable.report);
                delete runnable.report;
            }

            var data = {
                main: runnable.mid,
                models: {},
                reports: {},
                version: Brightics.VA.Env.CoreVersion
            };

            if (duration)
                data.duration = duration;

            data.models[runnable.mid] = runnable;
            if (runnable.type === 'control') {
                var _this = this;
                var midList = this.getModelIds(runnable.functions, 'mid', []);
                $.each(midList, function (index, mid) {
                    for (var i in modelList) {
                        if (modelList[i].id == mid) {
                            data.models[mid] = _this.exportAsRunnable(modelList[i].contents, withReport);
                        }
                    }

                    if (data.models[mid]) {
                        if (withReport && (data.models[mid].report && data.models[mid].report.data.length > 0)) {
                            data.reports[mid] = $.extend(true, {}, data.models[mid].report);
                        }

                        delete data.models[mid].report;
                    }
                });
            } else {
                if (withReport && report.data.length > 0) {
                    data.reports[runnable.mid] = report;
                }

                for (var i in runnable.gv) {
                    var variable = runnable.gv[i];
                    for (var key in variable.param) {
                        if (args && !args[variable.param[key]]) {
                            delete variable.param[key];
                        }
                    }

                    if (Object.keys(variable.param).length < 1) {
                        runnable.gv.splice(i, 1);
                    }
                }
            }
            return data;
        },
        fileArrayToModelTree: function (jsonFiles) {
            var tree = {};
            var insertFile = function (file) {
                tree[file.mid] = tree[file.mid] || {};
                tree[file.mid].main = file;
            };
            var insertVersion = function (file) {
                tree[file.mid] = tree[file.mid] || {version: {}};
                tree[file.mid].version[file.version_id] = file;
            };
            _.forOwn(jsonFiles, function (_files) {
                var files = _files instanceof Array ? _files : [_files];
                _.forEach(files, function (file) {
                    if (file.version_id) {
                        insertVersion(file);
                    } else {
                        insertFile(file);
                    }
                });
            });
            return tree;
        },
        importModels: function (projectId, fileArray, doneCallback, errorCallback) {
            var old2newFileId = {};
            var old2newTableId = {};
            var fileId2fileName = {};

            var tree = this.cloneModelsByTree(this.fileArrayToModelTree(fileArray));
            _.forOwn(tree, function (node) {
                old2newFileId[node.main.mid] = Brightics.VA.Core.Utils.IDGenerator.model.id();
                fileId2fileName[node.main.mid] = node.main.title;
            });

            var changeFileId = function (node) {
                _.forOwn(node, function (child) {
                    if (child.param.functions) changeFileId(child.param.functions);
                    if (child.param.mid && old2newFileId[child.param.mid]) child.param.mid = old2newFileId[child.param.mid];
                    if (child.param.modelId && old2newFileId[child.param.modelId]) child.param.modelId = old2newFileId[child.param.modelId];
                    if (child.param.tableId && old2newTableId[child.param.tableId]) child.param.tableId = old2newTableId[child.param.tableId];
                });
            };

            var genReportPageId = function (node) {
                if (node.pages) {
                    _.forOwn(node.pages, function (page) {
                        page.id = Brightics.VA.Core.Utils.IDGenerator.report.id();
                    });
                }
            };


            var opt = {
                url: 'api/va/v2/ws/projects/' + projectId + '/files',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                blocking: true
            };

            var old2newVersionId = {};

            var versionPromises = [];
            _.forOwn(tree, function (node) {
                if (node.main) {
                    changeFileId(node.main.functions);
                }
                _.forOwn(node.version, function (version) {
                    var newVersionInfo = new Brightics.VA.Vo.Version()
                        .setFileId(old2newFileId[version.mid])
                        .setLabel(version.title)
                        .setTags(version.versionTags)
                        .setDescription(version.versionDescription)
                        .setIsManual(true)
                        .setType(version.type)
                        .setMajorVersion(version.majorVersion)
                        .setMinorVersion(version.minorVersion);

                    var versionContents = _.omit(version, [
                        'versionId',
                        'versionTags',
                        'versionDescription',
                        'majorVersion',
                        'minorVersion'
                    ]);
                    newVersionInfo.setContents(versionContents);

                    versionPromises.push(
                        Dao.VersionDao.addVersion(
                            projectId,
                            newVersionInfo.getFileId(),
                            newVersionInfo)
                            .then(function (ver) {
                                old2newVersionId[version.version_id] = ver.getVersionId();
                                return ver;
                            }));
                });
            });

            return Promise.all(versionPromises).then(function () {
                var filePromises = [];
                _.forOwn(tree, function (node) {
                    _.forEach(node.main.functions, function (fn) {
                        if (fn[FUNCTION_NAME] === 'DataFlow') {
                            if (fn.param.version_id) {
                                fn.param.version_id = old2newVersionId[fn.param.version_id];
                            }
                        }
                    });

                    var newFileInfo = new Brightics.VA.Vo.File()
                        .setFileId(old2newFileId[node.main.mid])
                        .setProjectId(projectId)
                        .setLabel(fileId2fileName[node.main.mid])
                        .setDescription('')
                        .setCreator(Brightics.VA.Env.Session.userId)
                        .setContents(node.main);

                    filePromises.push(ResourceManager.addFile(projectId, newFileInfo));
                });
                return Promise.all(filePromises)
                    .then(function (files) {
                        return _.map(files, function (file) {
                            return ResourceManager.fetchVersions(projectId, file.getFileId());
                        });
                    });
            });
        },
        makeEntries: function (fnUnit) {
            if (fnUnit[FUNCTION_NAME] == 'Subflow' && fnUnit.param.functions.length > 0) {
                if (!fnUnit.param.links) {
                    fnUnit.param.links = [];
                }
                if (!fnUnit.param.entries) {
                    fnUnit.param.entries = [];

                    // 2016-05-25 ?�점??Subflow ??sequential flow ?�기 ?�문??추후?�는 별로 처리???�??로직 추�??�야 ??
                    fnUnit.param.entries.push(fnUnit.param.functions[0].fid);
                }
                for (var i in fnUnit.param.functions) {
                    this.makeEntries(fnUnit.param.functions[i]);
                }
            }
        },
        isControlFunction: function (fnUnit, parent) {
            var clazz = parent ? parent.type : fnUnit.parent().type;
            return (clazz === 'data' &&
                ['If', 'ForLoop', 'WhileLoop'].indexOf(fnUnit[FUNCTION_NAME]) > -1);
        },
        isEmptyExpression: function (_exp) {
            var exp = _exp || '';
            return !_.trim(exp.substring(3, exp.length - 1));
        },
        deleteEmptyExpression: function (fnUnit, parent) {
            var param = fnUnit.param;
            if (fnUnit[FUNCTION_NAME] === 'ForLoop') {
                if (param.type === 'count') {
                    if (_.has(param.prop, 'start') && this.isEmptyExpression(param.prop.start)) {
                        delete param.prop.start;
                    }
                    if (_.has(param.prop, 'end') && this.isEmptyExpression(param.prop.end)) {
                        delete param.prop.end;
                    }
                } else if (param.type === 'collection') {
                    if (_.has(param.prop, 'collection') &&
                        this.isEmptyExpression(param.prop.collection)) {
                        delete param.prop.collection;
                    }
                }
            } else if (fnUnit[FUNCTION_NAME] === 'While') {
                if (param.type === 'while') {
                    if (_.has(param.prop, 'expression') &&
                        this.isEmptyExpression(param.prop.expression)) {
                        delete param.prop.expression;
                    }
                }
            }
        },
        isEmpty: function (val) {
            return _.isUndefined(val) ||
                _.isNull(val) ||
                _.isNaN(val) ||
                ((_.isString(val) || _.isArray(val)) && _.isEmpty(val));
        },
        deleteEmptyArray: function (fnUnit, parent) {
            if (!fnUnit.param) return;

            for (var key in fnUnit.param) {
                if (this.isControlFunction(fnUnit, parent)) {
                    // array는 아닌데 일단 지웁니다..
                    this.deleteEmptyExpression(fnUnit, parent);
                } else if (key == 'functions') {
                    for (var i in fnUnit.param.functions) {
                        this.deleteEmptyArray(fnUnit.param.functions[i], parent || fnUnit.parent());
                    }
                } else if (['boolean', 'number'].some(type => type === typeof fnUnit.param[key]) || fnUnit.param[key]) {
                    var tmpArray = fnUnit.param[key];
                    if (_.isArray(tmpArray)) {
                        if (tmpArray.length > 1) continue;
                        if (!this.isEmpty(tmpArray[0])) {
                            if (_.isArray(tmpArray[0])) {
                                if (tmpArray[0].length > 1) continue;
                                if (this.isEmpty(tmpArray[0][0])) delete fnUnit.param[key];
                            } else {
                                if (this.isEmpty(tmpArray[0])) delete fnUnit.param[key];
                            }
                        } else if (this.isEmpty(tmpArray[0])) {
                            var clazz = parent ? parent.type : fnUnit.parent().type;
                            if (Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func).mandatory
                                && $.inArray(key, Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func).mandatory) !== -1) {
                                continue;
                            }
                            delete fnUnit.param[key];
                        }
                    }
                } else {
                    var clazz = parent ? parent.type : fnUnit.parent().type;
                    if (Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func).mandatory &&
                        $.inArray(key, Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(clazz, fnUnit.func).mandatory) !== -1) continue;
                    delete fnUnit.param[key];
                }
            }
        },
        deleteDisplay: function (fnUnit) {
            var label = '';
            if (fnUnit.display && fnUnit.display.label) {
                label = fnUnit.display.label;
                // fnUnit.display = { label: fnUnit.display.label || fnUnit.func };
            }
            fnUnit.label = label;
            fnUnit.display = {label: label};
            if (fnUnit[FUNCTION_NAME] == 'Subflow') {
                var functions = fnUnit.param.functions;
                for (var i in functions) {
                    this.deleteDisplay(functions[i]);
                }
            }
        },
        getKeyMapFromModelTree: function (models) {
            var cacheMap = {
                fidCache: {},
                outputCache: {}
            };
            _.forOwn(models, function (node) {
                if (node.main) {
                    _createCachePersist(node.main.functions, cacheMap);
                }
                if (node.version) {
                    _.forOwn(node.version, function (version) {
                        _createCachePersist(version.functions, cacheMap);
                    });
                }
            });
            return cacheMap;
        },
        cloneModelsByTree: function (modelTree) {
            var cacheMap = this.getKeyMapFromModelTree(modelTree);
            var resultModelTree = {};

            var clone = function (model, cacheMap, newMid) {
                var resultModel = $.extend(true, {}, model);
                if (newMid && resultModel.mid) {
                    resultModel.mid = Brightics.VA.Core.Utils.IDGenerator.model.id();
                }
                resultModel = _setKeys(resultModel, cacheMap);
                return resultModel;
            };

            _.forOwn(modelTree, function (node, fileId) {
                resultModelTree[fileId] = {};
                if (node.main) {
                    resultModelTree[fileId].main = clone(node.main, cacheMap);
                }
                if (node.version) {
                    resultModelTree[fileId].version = {};
                    _.forOwn(node.version, function (version, versionId) {
                        resultModelTree[fileId].version[versionId] = clone(version, cacheMap);
                    });
                }
            });
            return resultModelTree;
        },
        cloneModel: function (model) {
            if (model.type === 'data') {
                return _cloneNestedFlow(this.extendModel(model));
            }
            var clonedModel = $.extend(true, {}, model);
            if (clonedModel.mid) {
                clonedModel.mid = Brightics.VA.Core.Utils.IDGenerator.model.id();
            }

            var cacheMap = _createCache(clonedModel.functions);
            clonedModel = _setKeys(clonedModel, cacheMap);

            return clonedModel;
        },
        cloneFnUnit: function (fnUnit) {
            var cacheMap = _createCacheByFnUnit(fnUnit);
            var clone = $.extend(true, {}, fnUnit);

            var fidCache = cacheMap.fidCache, outputCache = cacheMap.outputCache;

            clone.fid = fidCache[clone.fid];

            if (clone[IN_DATA]) {
                clone[IN_DATA] = [];
            }
            if (clone.func === 'unload') {
                clone.param['df-names'] = [];
            }
            clone = _setOutTable(clone, outputCache);
            clone.param = _setKeys(clone.param, cacheMap);

            return clone;
        },
        checkAndRemoveOptionalInputs: function (unit) {
            if (unit.inputs && unit.meta) {
                Object.keys(unit.inputs)
                    .filter(key => unit.inputs[key] === '' && unit.meta[key] && unit.meta[key].optional)
                    .forEach(key => delete unit.inputs[key])
            }
        },
        carvePersist: function (fnUnit, persist) {
            var persistMode = Brightics.VA.SettingStorage.DEFAULT_SETTINGS['common.persist.mode'];//Brightics.VA.SettingStorage.getValue('common.persist.mode');
            // var defaultPersist = Brightics.VA.Core.Functions.Library[fnUnit.func].defaultFnUnit.persist;
            var defaultPersist;

            if (!Brightics.VA.Core.Functions.Library[fnUnit.func]) {
                defaultPersist = persistMode;
            } else {
                defaultPersist = Brightics.VA.Core.Functions.Library[fnUnit.func].defaultFnUnit.persist;
            }

            var basePersist = fnUnit.parent()['persist-mode'];

            if (persistMode === 'user-mode') {
                if (fnUnit['persist-mode'] === 'true') {
                    fnUnit.persist = true;
                } else if (fnUnit['persist-mode'] === 'false') {
                    fnUnit.persist = false;
                } else {
                    if (basePersist === 'true') {
                        fnUnit.persist = true;
                    } else if (basePersist === 'false') {
                        fnUnit.persist = false;
                    } else { // auto
                        fnUnit.persist = true;
                    }
                }
            }
            if (persistMode === 'system-mode') {
                // do nothing
            }
            if (persistMode === 'performance-mode') {
                if (defaultPersist !== undefined) {
                    fnUnit.persist = defaultPersist;
                } else {
                    fnUnit.persist = false;
                }
            }
            if (persistMode === 'storage-mode') {
                if (defaultPersist !== undefined) {
                    fnUnit.persist = defaultPersist;
                } else {
                    fnUnit.persist = true;
                }
            }

            // subflow 마지막 함수는 persist = true 공통 적용
            if (fnUnit[FUNCTION_NAME] === 'Subflow' && fnUnit.param.functions.length > 0) {
                fnUnit.param.functions[fnUnit.param.functions.length - 1].persist = true; //fnUnit.persist;
            }
        },
        generateVersionText: function (version) {
            return version.major_version + '.' + version.minor_version;
        },
        openDocumentationPopup: function () {
            var online = Brightics.VA.SettingStorage.getValue('common.document.useonline');
            if (online === 'true') {
                var onlineUrl = Brightics.VA.SettingStorage.getValue('common.document.onlinedocurl');
                if (onlineUrl === '') onlineUrl = Brightics.VA.SettingStorage.getValue('common.document.onlinedocurl.default');
                var w = window.open(onlineUrl);
                w.blur();
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('Help document installed in Local does not exist.\nSet up on-line help service url or contact your administrator.\n(Settings > Preferences > Common > Use on-line help..)');
            }
        },
        openFunctionReferencePopup: function (type, operation, context) {
            var online = Brightics.VA.SettingStorage.getValue('common.document.useonline');
            var w, url;
            if (online === 'true') {
                var onlineUrl = Brightics.VA.SettingStorage.getValue('common.document.onlinedocurl');
                if (onlineUrl === '') onlineUrl = Brightics.VA.SettingStorage.getValue('common.document.onlinedocurl.default');
                onlineUrl = _.trimRight(onlineUrl, '/');
                try {
                    var lang = (navigator.language || navigator.userLanguage).toLowerCase();
                    var version = 'v' + (Brightics.VA.Env.CoreVersion || '3.0');
                    var fullUrl = [
                        onlineUrl,
                        lang,
                        'ai',
                        version,
                        'function_reference',
                        context || 'scala',
                        operation
                    ].join('/');
                    w = window.open(fullUrl);
                } catch (e) {
                    w = window.open(onlineUrl);
                }
            } else {
                url = 'api/va/v2/help/function';
                if (operation) url = url + '/' + operation;
                url = url + '?type=' + type + (context ? '&context=' + context : '');
                w = window.open(url, 'Brightics Help');
            }
            w.blur();
        },
        createCachePersist: function (functions, cacheMap) {
            return _createCachePersist(functions, cacheMap);
        },
        setKeys: function (model, cacheMap) {
            return _setKeys(model, cacheMap);
        },
        createFileContents: function (templateContents, mid, label, description) {
            var contents = $.extend(true, {}, templateContents);
            contents.mid = mid;
            if (label) contents.title = label;
            if (description) contents.description = description;

            var fidCache = {}, outputCache = {};
            var i, j, k, l, m, old, fnUnit, subFnUnit, fid, kid, linkUnit, subLinkUnit;

            // Create fidCache
            for (i in contents.functions) {
                fnUnit = contents.functions[i];
                fidCache[fnUnit.fid] = Brightics.VA.Core.Utils.IDGenerator.func.id();
                for (l in fnUnit[OUT_DATA]) {
                    outputCache[fnUnit[OUT_DATA][l]] = Brightics.VA.Core.Utils.IDGenerator.table.id();
                }

                if (fnUnit[FUNCTION_NAME] === 'Subflow') {
                    for (j in fnUnit.param.functions) {
                        subFnUnit = fnUnit.param.functions[j];
                        fidCache[subFnUnit.fid] = Brightics.VA.Core.Utils.IDGenerator.func.id();
                        for (m in subFnUnit[OUT_DATA]) {
                            outputCache[subFnUnit[OUT_DATA][m]] = Brightics.VA.Core.Utils.IDGenerator.table.id();
                        }
                    }
                }
            }

            for (i in contents.functions) {
                // Change FnUnit Fid
                fnUnit = contents.functions[i];
                fnUnit.fid = fidCache[fnUnit.fid];

                // Change FnUnit In-table
                for (j in fnUnit[IN_DATA]) {
                    fnUnit[IN_DATA][j] = outputCache[fnUnit[IN_DATA][j]];
                }

                // Change FnUnit Out-table
                for (j in fnUnit[OUT_DATA]) {
                    fnUnit[OUT_DATA][j] = outputCache[fnUnit[OUT_DATA][j]];
                }

                // Change df-names Parameter, when operation is 'unload'
                if (fnUnit.func === 'unload') {
                    for (j in fnUnit.param['df-names']) {
                        fnUnit.param['df-names'][j] = outputCache[fnUnit.param['df-names'][j]];
                    }
                }

                if (fnUnit[FUNCTION_NAME] === 'Subflow') {
                    // Change entries
                    for (j in fnUnit.param.entries) {
                        fnUnit.param.entries[j] = fidCache[fnUnit.param.entries[j]];
                    }

                    for (j in fnUnit.param.functions) {
                        // Change SubFnUnit Fid
                        subFnUnit = fnUnit.param.functions[j];
                        subFnUnit.fid = fidCache[subFnUnit.fid];

                        // Change SubFnUnit In-table
                        for (k in subFnUnit[IN_DATA]) {
                            subFnUnit[IN_DATA][k] = outputCache[subFnUnit[IN_DATA][k]];
                        }

                        // Change SubFnUnit Out-table
                        for (k in subFnUnit[OUT_DATA]) {
                            subFnUnit[OUT_DATA][k] = outputCache[subFnUnit[OUT_DATA][k]];
                        }

                        // Change df-names Parameter, when operation is 'load'
                        if (subFnUnit.func === 'load') {
                            for (k in subFnUnit.param['df-names']) {
                                subFnUnit.param['df-names'][k] = outputCache[subFnUnit.param['df-names'][k]];
                            }
                        }
                        if (subFnUnit.func == 'unload') {
                            for (k in subFnUnit.param['df-names']) {
                                subFnUnit.param['df-names'][k] = outputCache[subFnUnit.param['df-names'][k]];
                            }
                            var filePathId = '/brtc/repo/tmp/' + Brightics.VA.Core.Utils.IDGenerator.file.id();
                            subFnUnit.param['fs-paths'] = [filePathId];
                            if (fnUnit.param.functions[parseInt(j) + 1]) {
                                fnUnit.param.functions[parseInt(j) + 1].param['input-path'] = filePathId;
                                fnUnit.param.functions[parseInt(j) + 1].param['output-path'] = filePathId + '.csv';
                            }
                        }
                    }

                    // Change Subflow Links
                    for (j in fnUnit.param.links) {
                        subLinkUnit = fnUnit.param.links[j];
                        subLinkUnit.kid = Brightics.VA.Core.Utils.IDGenerator.link.id();
                        subLinkUnit[SOURCE_FID] = fidCache[subLinkUnit[SOURCE_FID]];
                        subLinkUnit[TARGET_FID] = fidCache[subLinkUnit[TARGET_FID]];
                    }
                }
            }

            // Change Model Links
            for (i in contents.links) {
                linkUnit = contents.links[i];
                linkUnit.kid = Brightics.VA.Core.Utils.IDGenerator.link.id();
                linkUnit[SOURCE_FID] = fidCache[linkUnit[SOURCE_FID]];
                linkUnit[TARGET_FID] = fidCache[linkUnit[TARGET_FID]];
            }

            if (contents.type === 'visual') {
                var reportPages = contents.report.pages;
                reportPages.push({
                    id: Brightics.VA.Core.Utils.IDGenerator.reportPage.id(),
                    contents: {}
                });
                for (i in reportPages) {
                    var _contents = reportPages[i].contents;

                    for (var j in _contents) {
                        if (_contents[j].dataSourceId && fidCache[_contents[j].dataSourceId]) {
                            _contents[j].dataSourceId = fidCache[_contents[j].dataSourceId];
                        }
                    }
                }
            }
            return contents;
        },
        initDefaultModelContents: function () {
            var _this = this;
            var modelType = 'data';
            var url = 'api/va/v2/studio/templates/' + modelType;
            var opt = {
                url: url,
                type: 'GET',
                contentType: 'application/json; charset=utf-8',
                blocking: true
            };

            $.ajax(opt).done(function (files) {
                var index = _.findIndex(files, function (file) {
                    return file.name === 'Default';
                });
                if (index > -1) {
                    _this.defaultModelContents = files[index].contents;
                }
            });
        },
        getDefaultModelContents: function () {
            return this.defaultModelContents;
        },
        createCacheNestedFlow: _createCacheNestedFlow,
        setKeyNestedFlow: _setKeyNestedFlow
    };


    function _createCache(functions) {
        var cacheMap = {fidCache: {}, outputCache: {}};
        for (var fnIndex in functions) {
            var fnUnit = functions[fnIndex];
            $.extend(true, cacheMap, _createCacheByFnUnit(fnUnit));
        }
        return cacheMap;
    }

    function _createCacheByFnUnit(fnUnit) {
        var cacheMap = {fidCache: {}, outputCache: {}};
        var fidCache = cacheMap.fidCache;
        var outputCache = cacheMap.outputCache;
        fidCache[fnUnit.fid] = Brightics.VA.Core.Utils.IDGenerator.func.id();
        for (var outTableIndex in fnUnit[OUT_DATA]) {
            outputCache[fnUnit[OUT_DATA][outTableIndex]] = Brightics.VA.Core.Utils.IDGenerator.table.id();
        }
        if (fnUnit.param.functions) $.extend(true, cacheMap, _createCache(fnUnit.param.functions));
        return cacheMap;
    }

    function _createCacheNestedFlow(mainModel, model, cacheMap) {
        var fidCache = cacheMap.fidCache;
        var tidCache = cacheMap.tidCache;
        var newTid = function () {
            return Brightics.VA.Core.Utils.IDGenerator.table.id();
        }
        var newFid = function () {
            return Brightics.VA.Core.Utils.IDGenerator.func.id();
        }
        var set = function (map, key, newKey) {
            map[key] = map[key] || newKey;
        };

        var recFn = function (fn) {
            set(fidCache, fn.fid, newFid());

            // _.forEach([IN_DATA, OUT_DATA], function (prop) {
            //     _.forEach(fn[prop], function (tid) {
            //         set(tidCache, tid, newTid());
            //     });
            // });

            _.forEach(FnUnitUtils.getAllData(fn), function (tid) {
                set(tidCache, tid, newTid());
            });


            if (fn.param.tableId) {
                set(tidCache, fn.param.tableId, newTid());
            }

            if (fn.param.functions) {
                _.forEach(fn.param.functions, function (innerFn) {
                    recFn(innerFn);
                });
            }
        };

        var recModel = function (model) {
            _.forEach([IN_DATA, OUT_DATA], function (prop) {
                _.forEach(model[prop], function (tid) {
                    set(tidCache, tid, newTid());
                });
            });

            _.forEach(model.functions, function (fn) {
                recFn(fn);
                var subModels = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(mainModel, fn);
                _.forEach(subModels, recModel);
            });
        };
        recModel(model);
        return cacheMap;
    }

    function _cloneNestedFlow(_mainModel) {
        var mainModel = _.cloneDeep(_mainModel);
        var midCache = {};
        var set = function (id) {
            midCache[id] = midCache[id] || Brightics.VA.Core.Utils.IDGenerator.model.id();
        };

        var get = function (id) {
            return midCache[id];
        };

        var recSet = function (model) {
            _.forEach(model.functions, function (fn) {
                if (fn[FUNCTION_NAME] === 'If') {
                    set(fn.param.if.mid);
                    _.forEach(fn.param.elseif, function (elseif) {
                        set(elseif.mid);
                    });
                    set(fn.param.else.mid);
                }

                if (fn[FUNCTION_NAME] === 'ForLoop' || fn[FUNCTION_NAME] === 'WhileLoop') {
                    set(fn.param.mid);
                }

                var subModels = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(mainModel, fn);
                _.forEach(subModels, recSet);
            });
        };

        _.forEach(mainModel.innerModels, function (model, key) {
            set(key);
        });

        var recGet = function (model) {
            _.forEach(model.functions, function (fn) {

                var subModels = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(mainModel, fn);
                _.forEach(subModels, recGet);

                if (fn[FUNCTION_NAME] === 'If') {
                    fn.param.if.mid = get(fn.param.if.mid);
                    _.forEach(fn.param.elseif, function (elseif) {
                        elseif.mid = get(elseif.mid);
                    });
                    fn.param.else.mid = get(fn.param.else.mid);
                }

                if (fn[FUNCTION_NAME] === 'ForLoop' || fn[FUNCTION_NAME] === 'WhileLoop') {
                    fn.param.mid = get(fn.param.mid);
                }
            });
        };

        recSet(mainModel);
        recGet(mainModel);

        mainModel.innerModels = _.reduce(_.map(mainModel.innerModels, function (model) {
            model.mid = get(model.mid);
            var ret = {};
            ret[model.mid] = model;
            return ret;
        }), _.merge, {});

        var cacheMap = {
            fidCache: {},
            tidCache: {}
        };

        _createCacheNestedFlow(mainModel, mainModel, cacheMap);
        _setKeyNestedFlow(mainModel, mainModel, cacheMap);

        return mainModel;
    }

    function _setKeyNestedFlow(mainModel, model, cacheMap) {
        var fidCache = cacheMap.fidCache;
        var tidCache = cacheMap.tidCache;
        var _substituteKeys = function (model) {
            _setInTable(model, tidCache);
            _setOutTable(model, tidCache);

            for (var fnIndex in model.functions) {
                var fnUnit = model.functions[fnIndex];
                fnUnit.fid = fidCache[fnUnit.fid];
                _setInTable(fnUnit, tidCache);
                _setOutTable(fnUnit, tidCache);
                _setDfNames(fnUnit, tidCache);
                _setEntries(fnUnit, fidCache);
                _setEtcSpec(fnUnit, tidCache, fidCache);
                _setReportParam(fnUnit, tidCache);

                if (model.type === 'deeplearning') {
                    _setOutputParam(fnUnit, fidCache);
                }

                if (fnUnit.param && fnUnit.param.functions) {
                    _substituteKeys(fnUnit.param, cacheMap);
                }
                var subModels = Brightics.VA.Core.Utils
                    .NestedFlowUtils.getSubModels(mainModel, fnUnit);
                _.forEach(subModels, _substituteKeys);
            }

            if (model.report) {
                _.forEach(model.report.data, function (reportData) {
                    if (reportData.originData && reportData.originData.data) {
                        reportData.originData.data.fid = fnUnit.fid;
                        _setReportTable(reportData, tidCache);
                    }
                });
                model.report = _setReportDatasource(model.report, fidCache);
            }
            _setLinks(model, fidCache);
        };
        _substituteKeys(model);

        _setGV(mainModel, fidCache);
        return mainModel;
    };

    function _createCachePersist(functions, cacheMap) {
        _.forEach(functions, function (fnUnit) {
            _createCachePersistByFnUnit(fnUnit, cacheMap);
        });
    }

    function _createCachePersistByFnUnit(fnUnit, cacheMap) {
        var fidCache = cacheMap.fidCache;
        var outputCache = cacheMap.outputCache;
        if (fnUnit.fid.startsWith('d')) {
            fidCache[fnUnit.fid] = fidCache[fnUnit.fid] || Brightics.VA.Core.Utils.IDGenerator.dataSource.id();
        } else {
            fidCache[fnUnit.fid] = fidCache[fnUnit.fid] || Brightics.VA.Core.Utils.IDGenerator.func.id();
        }
        _.forEach(fnUnit['outData'], function (tid) {
            outputCache[tid] = outputCache[tid] || Brightics.VA.Core.Utils.IDGenerator.table.id();
        });
        if (fnUnit.param.functions) _createCachePersist(fnUnit.param.functions, cacheMap);
    }

    function _setKeys(model, cacheMap) {
        var fidCache = cacheMap.fidCache;
        var outputCache = cacheMap.outputCache;

        for (var fnIndex in model.functions) {
            var fnUnit = model.functions[fnIndex];
            fnUnit.fid = fidCache[fnUnit.fid];
            fnUnit = _setInTable(fnUnit, outputCache);
            fnUnit = _setOutTable(fnUnit, outputCache);
            fnUnit = _setDfNames(fnUnit, outputCache);
            fnUnit = _setEntries(fnUnit, fidCache);
            fnUnit = _setEtcSpec(fnUnit, outputCache, fidCache);
            fnUnit = _setReportParam(fnUnit, outputCache);

            if (fnUnit.param && fnUnit.param.functions) {
                _setKeys(fnUnit.param, cacheMap);
            }

            if (model.type == 'deeplearning') {
                fnUnit = _setOutputParam(fnUnit, fidCache);
            }

        }
        if (model.report) {
            for (var index in model.report.data) {
                model.report.data[index].originData.data.fid = fnUnit.fid;
                model.report.data[index] = _setReportTable(model.report.data[index], outputCache);
            }
            model.report = _setReportDatasource(model.report, fidCache);

        }

        model = _setLinks(model, fidCache);
        model = _setGV(model, fidCache);
        return model;
    }

    function _setInTable(fnUnit, outputCache) {
        _.forEach(outputCache, function (newTid, oldTid) {
            FnUnitUtils.changeData(fnUnit, oldTid, newTid);
        });
        return fnUnit;
    }


    function _setOutTable(fnUnit, outputCache) {
        _.forEach(outputCache, function (newTid, oldTid) {
            FnUnitUtils.changeData(fnUnit, oldTid, newTid);
        });
        return fnUnit;
    }

    function _setDfNames(fnUnit, outputCache) {
        if (fnUnit.param && fnUnit.param['df-names']) {
            for (var dfNamesIndex in fnUnit.param['df-names']) {
                fnUnit.param['df-names'][dfNamesIndex] = outputCache[fnUnit.param['df-names'][dfNamesIndex]];
            }
        }
        return fnUnit;
    }

    function _setEntries(fnUnit, fidCache) {
        if (fnUnit.param && fnUnit.param.entries) {
            for (var entriesIndex in fnUnit.param.entries) {
                fnUnit.param.entries[entriesIndex] = fidCache[fnUnit.param.entries[entriesIndex]];
            }
        }
        return fnUnit;
    }

    function _setLinks(model, fidCache) {
        for (var i in model.links) {
            var linkUnit = model.links[i];
            var kid = Brightics.VA.Core.Utils.IDGenerator.link.id();
            linkUnit.kid = kid;
            linkUnit[SOURCE_FID] = fidCache[linkUnit[SOURCE_FID]];
            linkUnit[TARGET_FID] = fidCache[linkUnit[TARGET_FID]];
        }
        return model;
    }

    function _setGV(model, fidCache) {
        for (var i in model.variableRef) {
            var oldFid = model.variableRef[i].fid;
            model.variableRef[i].fid = fidCache[oldFid];
        }
        return model;
    }

    function _setEtcSpec(fnUnit, tidCache, fidCache) {
        if (fnUnit.func === 'outData' && fnUnit[FUNCTION_NAME] === 'Subflow') {
            for (var i in fnUnit.param.functions) {
                if (fnUnit.param.functions[i].func === 'exportData') {
                    var filePathId = '/brtc/repo/tmp/' + Brightics.VA.Core.Utils.IDGenerator.file.id();
                    fnUnit.param['fs-paths'] = [filePathId];
                    if (fnUnit.param.functions[i]) {
                        fnUnit.param.functions[i].param['input-path'] = filePathId;
                        fnUnit.param.functions[i].param['output-path'] = filePathId + '.csv';
                    }
                }
            }
        }
        if (fnUnit[FUNCTION_NAME] === 'DataViewer') {
            fnUnit.param.fid = fidCache[fnUnit.param.fid];
        }
        return fnUnit;
    }

    function _setOutputParam(fnUnit, fidCache) {
        var changedVariable = ['train_data', 'validation_data'];
        if (!fnUnit.param) {
            return fnUnit;
        }

        for (var paramIdx = 0; paramIdx < changedVariable.length; paramIdx++) {
            if (fnUnit.param[changedVariable[paramIdx]] && fidCache[fnUnit.param[changedVariable[paramIdx]]]) {
                fnUnit.param[changedVariable[paramIdx]] = fidCache[fnUnit.param[changedVariable[paramIdx]]];
            }
        }

        return fnUnit;
    }

    function _setReportTable(reportData, outputCache) {
        reportData.originData.data.table = outputCache[reportData.originData.data.table];
        return reportData;
    }


    function _setReportParam(fnUnit, outputCache) {
        if (fnUnit.param.tableId) {
            fnUnit.param.tableId = outputCache[fnUnit.param.tableId];
        }
        return fnUnit;
    }

    function _setReportDatasource(report, fidCache) {
        if (report.pages) {
            for (var index in report.pages) {
                var keys = Object.keys(report.pages[index].contents);
                for (var key in keys) {
                    report.pages[index].contents[keys[key]].dataSourceId = fidCache[report.pages[index].contents[keys[key]].dataSourceId];
                }
            }
        }
        return report;
    }

}).call(this);

/* -----------------------------------------------------
 *  nested-flow-utils.js
 *  Created by hyunseok.oh@samsung.com on 2018-03-21.
 * ---------------------------------------------------- */

/* global _, FUNCTION_NAME, SOURCE_FID, TARGET_FID, Studio, brtc_require, IN_DATA, OUT_DATA */
(function (root, _) {
    'use strict';
    var Brightics = root.Brightics;
    var Dao = brtc_require('Dao');

    var FILE = 'file';
    var VERSION = 'version';

    var CHANGE_IN_TABLE_PARAM_KEYS = ['df-names'];

    var getAdjacencyLists = function (model, fids) {
        var adjacencyLists = {};
        _.forEach(fids, function (fid) {
            adjacencyLists[fid] = getAdjacencyList(model, fid);
        });
        return adjacencyLists;
    };

    var getAdjacencyList = function (model, fid) {
        var links = _.filter(model.links, function (link) {
            return link[SOURCE_FID] === fid;
        });

        var list = _.map(links, function (link) {
            return link[TARGET_FID];
        });

        return list;
    };

    var getConditionMids = function (conditionFn) {
        var ret = [];
        if (conditionFn.param.if) ret.push(conditionFn.param.if.mid);
        if (conditionFn.param.elseif) {
            _.forEach(conditionFn.param.elseif, function (elif) {
                ret.push(elif.mid);
            });
        }
        ret.push(conditionFn.param.else.mid);
        return ret;
    };

    var getChildModels = function (_parentModel, model) {
        var models = [];
        var mainModel = _parentModel.getInnerModel ? _parentModel : _parentModel.getMainModel();
        _.forEach(model.functions, function (fn) {
            if (fn.func === 'if') {
                var mids = getConditionMids(fn);
                _.forEach(mids, function (mid) {
                    models.push(mainModel.getInnerModel(mid));
                });
            } else if (fn.func === 'forLoop' || fn.func === 'whileLoop') {
                models.push(mainModel.getInnerModel(fn.param.mid));
            }
        });
        return _.filter(models, _.negate(_.isUndefined));
    };

    var getAllSubModelsFromModel = function (mainModel, model) {
        var subModels = getChildModels(mainModel, model);
        return _.flatten(subModels.concat(
            _.map(subModels, _.partial(getAllSubModelsFromModel, mainModel))
        ));
    };

    var getAllSubModelsFromFnUnit = function (mainModel, fnUnit) {
        var subModels = getSubModels(mainModel, fnUnit);
        return _.flatten(subModels.concat(
            _.map(subModels, _.partial(getAllSubModelsFromModel, mainModel))
        ));
    };

    var _getKey = function (modelId, versionId) {
        return modelId + '_' + versionId;
    };

    var getChildFlowsMeta = function (model) {
        var models = getChildModels(model, model).concat(model);
        var ret = [];
        models.forEach(function (m) {
            m.functions.forEach(function (fn) {
                if (fn[FUNCTION_NAME] === 'Flow') {
                    var mid = fn.param.mid;
                    var versionId = fn.param.versionId;
                    if (mid && versionId) {
                        ret.push({
                            type: VERSION,
                            mid: mid,
                            versionId: versionId
                        });
                    } else if (mid) {
                        ret.push({
                            type: FILE,
                            mid: mid
                        });
                    }
                }
            });
        });
        return ret;
    };

    var getChildFlows = function (projectId, mainModel, withoutVersion) {
        var models = {};
        var visited = {};

        var traverseInto = function (__getKey) {
            return function (r) {
                if (!r) return;
                var nxtModel = r.getContents();
                models[__getKey(r)] = nxtModel;
                return rec(nxtModel, nxtModel);
            };
        };

        var traverseIntoVersion = traverseInto(function (v) {
            return _getKey(v.getFileId(), v.getVersionId());
        });

        var traverseIntoFile = traverseInto(function (f) {
            return f.getFileId();
        });

        var rec = function (main, model) {
            var ret = [];
            _.forEach(model.functions, function (fn) {
                var key;
                if (fn[FUNCTION_NAME] !== 'Flow') return;
                var mid = fn.param.mid;
                var vid = fn.param.versionId;
                if (mid && vid) {
                    if (!withoutVersion) {
                        key = _getKey(mid, vid);
                        if (!visited[key]) {
                            visited[key] = true;
                            ret.push(Dao.VersionDao.getVersion(projectId, mid, vid)
                                .then(traverseIntoVersion));
                        }
                    }
                } else if (mid) {
                    key = mid;
                    if (!visited[key]) {
                        visited[key] = true;
                        ret.push(Dao.FileDao.getFile(projectId, mid).then(traverseIntoFile));
                    }
                }
            });

            var subModels = getChildModels(main, model);
            _.forEach(subModels, function (mod) {
                ret.push(rec(main, mod));
            });
            return Promise.all(ret);
        };

        return rec(mainModel, mainModel).then(function () {
            var keys = _.keys(models);
            _.forIn(keys, function (key) {
                if (_.isUndefined(models[key])) models = _.omit(models, key);
            });
            return models;
        });
    };

    var getParentModel = function (mainModel, model) {
        if (_.has(model, 'innerModels')) {
            // main model;
            return model;
        }
        var rec = function (subModel) {
            var children = getChildModels(mainModel, subModel);
            for (var i = 0; i < children.length; i++) {
                if (children[i].mid === model.mid) {
                    return subModel;
                }
                var res = rec(children[i]);
                if (res) {
                    return res;
                }
            }
            return undefined;
        };

        return rec(mainModel);
    };

    var getParentModelByFid = function (mainModel, fid) {
        var rec = function (subModel) {
            var fns = subModel.functions;
            for (var i = 0; i < fns.length; i++) {
                var fn = fns[i];
                if (fn.fid === fid) {
                    return subModel;
                }
            }

            var models = getChildModels(mainModel, subModel);
            for (var j = 0; j < models.length; j++) {
                var res = rec(models[j]);
                if (res) {
                    return res;
                }
            }

            return undefined;
        };

        return rec(mainModel);
    };

    var getConnectedFnUnits = function (mainModel, fnUnit) {
        var parentModel = getParentModelByFid(mainModel, fnUnit.fid);
        var adj = getAdjacencyList(parentModel, fnUnit.fid);
        var res = [];
        var fns = parentModel.functions;
        for (var i = 0; i < fns.length; i++) {
            if (_.indexOf(adj, fns[i].fid) > -1) {
                res.push(fns[i]);
            }
        }
        return res;
    };

    var forEachConditionModels = function (mainModel, conditionFn, fn) {
        var modelIds = getConditionMids(conditionFn);
        _.forEach(modelIds, function (mid) {
            var model = mainModel.getInnerModel(mid);
            fn(model);
        });
    };

    var getLoopModels = function (mainModel, loopFn) {
        return [mainModel.getInnerModel(loopFn.param.mid)];
    };

    var getConditionModels = function (mainModel, conditionFn) {
        var models = [];
        forEachConditionModels(mainModel, conditionFn, function (model) {
            models.push(model);
        });
        return models;
    };

    var getSubModels = function (mainModel, fnUnit) {
        var ret = (function () {
            if (!fnUnit) return mainModel;
            if (fnUnit.func === 'forLoop' || fnUnit.func === 'whileLoop') {
                return getLoopModels(mainModel, fnUnit);
            } else if (fnUnit.func === 'if') {
                return getConditionModels(mainModel, fnUnit);
            }
            return [];
        }());

        return _.filter(ret, _.negate(_.isUndefined));
    };

    var calcNextFnUnitOutTableSize = function (mainModel, fnUnit, updatedModelId, diff) {
        var models = getSubModels(mainModel, fnUnit);
        var maxSize = 0;
        for (var i = 0; i < models.length; i++) {
            maxSize = parseInt(Math.max(maxSize,
                (models[i][OUT_DATA] ? models[i][OUT_DATA].length : 0) +
                (updatedModelId === models[i].mid ? diff : 0)));
        }
        return maxSize;
    };

    var createAdjustOutTableCommand = function (
            eventSource,
            mainModel,
            targetFnUnit,
            targetTableLength) {
        var commands = [];
        var curLength = targetFnUnit[OUT_DATA].length;

        while (curLength < targetTableLength) {
            commands.push(new Brightics.VA.Core.Editors.Diagram.Commands.AddOperationCommand(
                eventSource,
                {
                    target: targetFnUnit,
                    path: [OUT_DATA, curLength],
                    value: Brightics.VA.Core.Utils.IDGenerator.table.id()
                }));
            curLength++;
        }

        var filterTids = function (target) {
            return function (t) {
                return target !== t;
            };
        };

        while (curLength > targetTableLength) {
            curLength--;
            commands.push(new Brightics.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(
                eventSource,
                {
                    target: targetFnUnit,
                    path: [OUT_DATA, curLength]
                }));

            var tid = targetFnUnit[OUT_DATA][curLength];
            var connectedFnUnits = Brightics.VA.Core.Utils.NestedFlowUtils.getConnectedFnUnits(
                mainModel,
                targetFnUnit
            );

            for (var i = 0; i < connectedFnUnits.length; i++) {
                var fnUnit = connectedFnUnits[i];

                var newTable = _.filter(fnUnit[IN_DATA], filterTids(tid));

                commands.push(
                    new Brightics.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand(
                        eventSource,
                        {
                            fnUnit: fnUnit,
                            ref: {
                                'inData': newTable
                            }
                        }
                    )
                );

                var cmd = createSetFnUnitCommand(eventSource, fnUnit, newTable);
                if (cmd) {
                    commands.push(cmd);
                }
            }
        }
        return commands;
    };


    var createSetFnUnitCommand = function (eventSource, fnUnit, paramValue) {
        var isParamChanged = false;

        var commandOption = {
            fnUnit: fnUnit,
            ref: {
                param: {}
            }
        };

        var paramKeys = Object.keys(fnUnit.param);
        for (var i in paramKeys) {
            var key = paramKeys[i];
            if (CHANGE_IN_TABLE_PARAM_KEYS.indexOf(key) > -1) {
                isParamChanged = true;
                commandOption.ref.param[key] = paramValue;
            }
        }

        if (isParamChanged) {
            var setFnUnitCommand = new Brightics.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand(
                eventSource, commandOption);
            return setFnUnitCommand;
        }
    };

    var makeRunnable = function (projectId, mainModel) {
        // var options = _options || {};
        // var argsMap = options.args || {};
        return getChildFlows(projectId, mainModel)
            .then(function (models) {
                var newInnerModel = _.indexBy(getAllSubModelsFromModel(mainModel, mainModel), 'mid');
                // mainModels.innerModels = newInnerModel;
                var runnableMainModel = _.cloneDeep(mainModel);
                var runnableModels = _.cloneDeep(models);
                runnableMainModel.innerModels = newInnerModel;
                runnableModels = _.reduce(_.map(runnableModels, function (m, key) {
                    var ret = {};
                    ret[key] = Brightics.VA.Core.Utils.ModelUtils.exportAsRunnable(m);
                    return ret;
                }), _.merge, {});

                runnableModels[runnableMainModel.mid] = runnableMainModel;
                var runnable = {
                    main: runnableMainModel.mid,
                    models: runnableModels,
                    version: Brightics.VA.Env.CoreVersion
                };

                return runnable;
            }).catch(console.error);
    };

    var getNewActivityCommandOptions = function (fnUnit) {
        var ret = [];
        if (fnUnit[FUNCTION_NAME] === 'If') {
            ret.push({mid: fnUnit.param.if.mid, type: fnUnit.func, conditionType: 'if'});
            ret = ret.concat(_.map(fnUnit.param.elseif, function (elseif) {
                return {
                    mid: elseif.mid,
                    type: fnUnit.func,
                    conditionType: 'elseif'
                };
            }));
            ret.push({
                mid: fnUnit.param.else.mid,
                type: fnUnit.func,
                conditionType: 'else'
            });
        } else if (fnUnit[FUNCTION_NAME] === 'ForLoop' ||
            fnUnit[FUNCTION_NAME] === 'WhileLoop') {
            ret.push({
                mid: fnUnit.param.mid,
                type: fnUnit.func
            });
        }
        return ret;
    };

    var getFnUnitByCondition = function (mainModel, condition) {
        var rec = function (model) {
            return _.reduce(model.functions, function (prv, fn) {
                if (prv) return prv;
                if (condition(fn)) return fn;
                return rec(getSubModels(fn));
            }, _.noop() /* undefined */);
        };
        return rec(mainModel);
    };

    var isProcessFunction = function (fnUnit) {
        return ['SetValue', 'ImportData', 'ExportData'].indexOf(fnUnit[FUNCTION_NAME]) >= 0;
    };

    var getFlowGraph = function (projectId, mainModel, withModel) {
        var graph = {};
        var dfs = function (file, modelKey) {
            graph[modelKey] = {
                adj: [],
                version: file instanceof Brightics.VA.Vo.File ?
                    'Current' :
                    'v' + file.getVersion()
            };
            if (withModel) {
                graph[modelKey].model = file.getContents();
            }

            var children = getChildFlowsMeta(file.getContents()).reduce(function (acc, childInfo) {
                if (childInfo.type === FILE) {
                    acc[childInfo.mid] =
                        Studio.getResourceManager().getFile(projectId, childInfo.mid);
                } else {
                    acc[childInfo.mid + '_' + childInfo.versionId] =
                        Studio.getResourceManager()
                            .getVersion(projectId, childInfo.mid, childInfo.versionId);
                }
                return acc;
            }, {});

            _.forEach(children, function (child, key) {
                if (!graph[key]) {
                    dfs(child, key);
                }
                graph[modelKey].adj.push(key);
            });
        };
        dfs(Studio.getResourceManager().getFile(projectId, mainModel.mid), mainModel.mid);
        return graph;
    };

    var checkCycle = function (projectId, mainModel) {
        var visited = {};
        var graph = getFlowGraph(projectId, mainModel);
        var GRAY = -1;
        var BLACK = 1;
        var check = function (id) {
            visited[id] = GRAY;
            var hasCycle = _.any(graph[id].adj, function (child) {
                if (!visited[child] && check(child)) {
                    return true;
                }
                if (visited[child] === GRAY) {
                    return true;
                }
                return false;
            });
            visited[id] = BLACK;
            return hasCycle;
        };
        return check(mainModel.mid);
    };

    var getLocalOutline = function (mainModel, activeModel, activeFid) {
        var recFn = function (fn) {
            var ret = {
                type: 'fn',
                fn: fn,
                items: [],
                label: fn.display.label,
                selected: fn.fid === activeFid
            };

            if (fn[FUNCTION_NAME] === 'If') {
                var conditionsParam = [].concat(fn.param.if, fn.param.elseif, fn.param.else);
                ret.items = _.map(conditionsParam, function (param, index) {
                    var label = 'Else If';
                    if (index === 0) label = 'If';
                    if (index === conditionsParam.length - 1) label = 'Else';
                    return recModel(mainModel.getInnerModel(param.mid), label);
                });
            } else if (fn[FUNCTION_NAME] === 'ForLoop' || fn[FUNCTION_NAME] === 'WhileLoop') {
                ret.items = [recModel(mainModel.getInnerModel(fn.param.mid),
                    fn[FUNCTION_NAME] === 'ForLoop' ? 'For' : 'While')];
            }
            ret.active = _.any(_.map(ret.items, 'active'));
            return ret;
        };

        var recModel = function (model, label) {
            var items = model.functions.map(function (fn) {
                return recFn(fn);
            });

            return {
                type: 'model',
                model: model,
                items: items,
                active: model.mid === activeModel.mid || _.any(_.map(items, 'active')),
                label: label
            };
        };

        return recModel(mainModel, mainModel.title);
    };

    var getGlobalOutline = function (projectId, mainModel) {
        if (checkCycle(projectId, mainModel)) {
            throw new Error('This model contains cycle.');
        }

        var graph = getFlowGraph(projectId, mainModel, true);
        var rec = function (node) {
            return {
                id: node.model.mid,
                label: node.model.title + ' [' + node.version + ']',
                items: node.adj.map(function (nxtId) {
                    return rec(graph[nxtId]);
                })
            };
        };

        return rec(graph[mainModel.mid]);
    };

    Brightics.VA.Core.Utils.NestedFlowUtils = {
        getParentModel: getParentModel,
        getAdjacencyLists: getAdjacencyLists,
        getAdjacencyList: getAdjacencyList,
        getConnectedFnUnits: getConnectedFnUnits,
        getSubModels: getSubModels,
        createAdjustOutTableCommand: createAdjustOutTableCommand,
        calcNextFnUnitOutTableSize: calcNextFnUnitOutTableSize,
        getChildFlows: getChildFlows,
        getChildModels: getChildModels,
        makeRunnable: makeRunnable,
        getAllSubModelsFromModel: getAllSubModelsFromModel,
        getAllSubModelsFromFnUnit: getAllSubModelsFromFnUnit,
        getNewActivityCommandOptions: getNewActivityCommandOptions,
        getFnUnitByCondition: getFnUnitByCondition,
        isProcessFunction: isProcessFunction,
        checkCycle: checkCycle,
        getLocalOutline: getLocalOutline,
        getGlobalOutline: getGlobalOutline
    };

/* eslint-disable no-invalid-this */
}(this, _));

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    Brightics.OptModelManager = {
        isValidOptModel: function (optModel) {
            var isValidObjective = this.isValidObjective(optModel);
            var isValidOptFunctions = this.isValidOptFunctions(optModel);
            return (isValidObjective && isValidOptFunctions);
        },
        isValidObjective: function (optModel) {
            var isValidObjective = false;
            if (optModel && optModel.options && optModel.options.objective) {
                if (optModel.options.objective.fid &&
                    optModel.options.objective.tableName &&
                    optModel.options.objective.row &&
                    optModel.options.objective.column &&
                    optModel.options.objective.sense)
                    isValidObjective = true;
            }
            return isValidObjective;
        },
        isValidOptFunctions: function (optModel) {
            var isValidOptFunctions = false;
            if (optModel && optModel.optFunctions) {
                for (var i = 0; i < optModel.optFunctions.length; i++) {
                    if (optModel.optFunctions[i].optSelected === 'true') {
                        for (var key in optModel.optFunctions[i].optParam) {
                            if (optModel.optFunctions[i].optParam[key].optParamSelected === 'true') {
                                isValidOptFunctions = true;
                            }
                        }
                    }
                }
            }
            return isValidOptFunctions;
        },
        renderOptModels: function (diagramEditorPage) {
            var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
            if (!diagramEditorPage) {
                diagramEditorPage = activeModelEditor.diagramEditorPage;
            }
            if (!diagramEditorPage) return;

            var $paper = diagramEditorPage.$mainControl.find('.brtc-va-editors-diagram-diagrameditorpage-paper');
            $paper.find('.brtc-opt-model-box').remove();

            var contents = activeModelEditor.getEditorInput().getContents();
            var optModels = contents.optModels;
            if (optModels && Object.keys(optModels).length) {
                var functionPositionInfo = {};
                var scale = diagramEditorPage.options.scale;

                var functionElements = diagramEditorPage.graph.getElements();
                for (var i = 0; i < functionElements.length; i++) {
                    var fid = functionElements[i].attributes.fid;
                    var position = $.extend(true, {}, functionElements[i].attributes.position);
                    functionPositionInfo[fid] = position;
                }

                for (var optId in optModels) {
                    var optLabel = optModels[optId].label || "Optimization";
                    var optFunctions = optModels[optId].optFunctions;
                    var top, left, bottom, right;

                    var first = -1;
                    for (var i = 0; i < optFunctions.length; i++) {
                        if (functionPositionInfo[optFunctions[i].fid]) {
                            first = i;
                            break;
                        }
                    }

                    if (first == -1) {
                        // All functions were deleted in this OPT Model.
                        continue;
                    }

                    top = bottom = functionPositionInfo[optFunctions[first].fid].y;
                    left = right = functionPositionInfo[optFunctions[first].fid].x;
                    for (var f = 0; f < optFunctions.length; f++) {
                        var fid = optFunctions[f].fid;
                        if (functionPositionInfo[fid]) {
                            top = Math.min(top, functionPositionInfo[fid].y);
                            bottom = Math.max(bottom, functionPositionInfo[fid].y);
                            left = Math.min(left, functionPositionInfo[fid].x);
                            right = Math.max(right, functionPositionInfo[fid].x);
                        } else {
                            // Some functions were deleted in this OPT Model.
                        }
                    }

                    var boxTop = top * scale;
                    var boxLeft = left * scale + 3;
                    var boxWidth = (Brightics.VA.Env.Diagram.FIGURE_WIDTH + right - left) * scale - 5;
                    var boxHeight = (Brightics.VA.Env.Diagram.FIGURE_HEIGHT + bottom - top) * scale + 7;

                    var isValidOptModel = this.isValidOptModel(optModels[optId]);
                    var borderColor = (isValidOptModel) ? ('#626fdb') : ('#ea3539');
                    var $boundBox = $(`<div class="brtc-opt-model-box" style="
                        position: absolute;
                        display: block;
                        box-sizing: content-box;
                        margin-top: -1px;
                        margin-left: -5px;
                        padding-right: 7px;
                        pointer-events: none;
                        border: 1px solid ${borderColor};' +
                        "></div>`);
                    $paper.append($boundBox);
                    $boundBox.css({ top: boxTop, left: boxLeft, width: boxWidth, height: boxHeight });

                    var $optToolbar = $(`
                        <div class="brtc-opt-model-toolbar" style="
                            position: absolute;
                            left: -1px;
                            top: -20px;
                            padding: 1px 5px 0 5px;
                            border: 1px solid ${borderColor};
                            background: #fafbfc;
                            pointer-events: auto;
                            height: 17px;
                            line-height: 17px;
                            cursor: pointer;
                        ">
                            <div class="brtc-opt-model-label" style="
                                max-width: 187px;
                                overflow: hidden;
                                text-overflow: ellipsis;
                                white-space: nowrap;
                                font-size: 11px;
                                "></div>
                        </div>`);
                    $optToolbar.attr('opt-id', optId);
                    $optToolbar.find('.brtc-opt-model-label').attr('title', optLabel);
                    $optToolbar.find('.brtc-opt-model-label').text(optLabel);
                    $boundBox.append($optToolbar);
                    $optToolbar.click(function () {
                        var optId = $(this).attr('opt-id');
                        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
                        var sideBarManager = activeModelEditor.getSideBarManager();
                        var optSettingSideBar = sideBarManager.getSideBars()['optSetting'];
                        optSettingSideBar.show();
                        optSettingSideBar.createDetailView(optId);
                        optSettingSideBar.render(optId);
                    })
                }
            }
        },
        getOptModels: function (pid, mid) {
            var file = Studio.getResourceManager().getFile(pid, mid);
            var contents = file.getContents();
            if (contents.optModels) {
                var optModels = contents.optModels;
                return Object.values(optModels).sort(function compare(a, b) {
                    if (a['createTime'] < b['createTime']) {
                        return -1;
                    }
                    if (a['createTime'] > b['createTime']) {
                        return 1;
                    }
                    return 0;
                });
            }
            return [];
        },
        getOptModel: function (pid, mid, optId) {
            var file = Studio.getResourceManager().getFile(pid, mid);
            var contents = file.getContents();
            if (contents.optModels && contents.optModels[optId]) {
                var optModels = contents.optModels;
                return $.extend(true, {}, optModels[optId]);
            }
        },
        getTargetOptModelId: function (pid, mid, fid) {
            var file = Studio.getResourceManager().getFile(pid, mid);
            var contents = file.getContents();
            if (contents.optModels) {
                var optModels = contents.optModels;
                for (var id in optModels) {
                    if (optModels[id].optFunctions) {
                        var optFunctions = optModels[id].optFunctions;
                        for (var i = 0; i < optFunctions.length; i++) {
                            if (optFunctions[i].fid === fid) {
                                return id;
                            }
                        }
                    }
                }
            }
            return null;
        },
        createNewOptModelCommand: function (pid, mid, selectedFids, options) {
            var file = Studio.getResourceManager().getFile(pid, mid);
            var contents = file.getContents();
            var functions = [];
            var links = [];

            // Selected Functions
            var selectedFnUnitObject = {};
            for (var i = 0; i < selectedFids.length; i++) {
                var fid = selectedFids[i];
                var fnUnit = $.extend(true, {}, contents.getFnUnitById(fid));
                if (Object.keys(fnUnit).length === 0) {
                    continue;
                }
                selectedFnUnitObject[fid] = fnUnit;
                functions.push(fnUnit);
            }

            // Selected Links
            for (var i = 0; i < contents.links.length; i++) {
                var sourceFid = contents.links[i].sourceFid;
                var targetFid = contents.links[i].targetFid;
                if (selectedFnUnitObject[sourceFid] && selectedFnUnitObject[targetFid]) {
                    var link = $.extend(true, {}, contents.links[i]);
                    links.push(link);
                }
            }

            // Create New Opt Model
            var optModel = this.newOptModel(functions, links, options);

            // Execute New Opt Model Command
            return new Brightics.VA.Core.Editors.Diagram.Commands.NewOptModelCommand(this, {
                pid: pid,
                mid: mid,
                optModel: optModel
            });
        },
        createSetOptModelCommand: function (pid, mid, optId, optModel, target) {
            return new Brightics.VA.Core.Editors.Diagram.Commands.SetOptModelCommand(this, {
                pid: pid,
                mid: mid,
                optId: optId,
                optModel: optModel,
                target: target
            });
        },
        createRemoveOptModelCommand: function (pid, mid, optId) {
            return new Brightics.VA.Core.Editors.Diagram.Commands.RemoveOptModelCommand(this, {
                pid: pid,
                mid: mid,
                optId: optId
            });
        },
        newOptModel: function (functions, links, options) {
            var optFunctions = $.extend(true, [], functions);
            options = options || {};

            var mid = Brightics.VA.Core.Utils.IDGenerator.model.id();
            var fids = [];
            for (var i = 0; i < optFunctions.length; i++) {
                fids.push(optFunctions[i].fid);
                var functionName = optFunctions[i].name;

                delete optFunctions[i].display;
                delete optFunctions[i].func;
                delete optFunctions[i].name;
                delete optFunctions[i].inData;
                delete optFunctions[i].outData;
                delete optFunctions[i].param;
                delete optFunctions[i]['persist-mode'];

                var defaultSettings = Brightics.OptFunctions[functionName];
                if (defaultSettings) {
                    optFunctions[i]['optSelected'] = defaultSettings['optSelected'];
                    optFunctions[i]['optParam'] = $.extend(true, {}, defaultSettings['optParam']);
                } else {
                    optFunctions[i]['optSelected'] = "none";
                    optFunctions[i]['optParam'] = {};
                }
            }

            var getCurrentTime = function () {
                var time = new Date();
                var year = time.getFullYear();
                var month = (time.getMonth() < 9) ? ('0' + (time.getMonth() + 1)) : (time.getMonth() + 1);
                var date = (time.getDate() < 9) ? ('0' + time.getDate()) : (time.getDate());
                var hour = time.getHours();
                var minutes = time.getMinutes();
                var seconds = time.getSeconds();
                return [year, month, date, hour, minutes, seconds].join('');
            }

            return {
                "optId": mid,
                "hash": fids.sort().join('_'),
                "label": options.label || "OPT " + getCurrentTime(),
                "description": "description", //"<p><br /></p>",
                "createTime": new Date().getTime(),
                "creator": Brightics.VA.Env.Session.userId,
                "updateTime": new Date().getTime(),
                "updater": Brightics.VA.Env.Session.userId,
                "options": {
                    "activated": "true",
                    "useSavedModel": "false",
                    "method": "SOGA",
                    "maxIterations": "100",
                    "maxEvaluations": "20",
                    "constraints": [
                        // {
                        //     "fid": "fff",
                        //     "tableName": "asdssdfsdsbbbbb",
                        //     "row": "1",
                        //     "column": "2",
                        //     "type": "Equality",
                        //     "target": "0"
                        // }
                    ],
                    "objective": {
                        "fid": "",
                        "tableName": "",
                        "row": "1",
                        "column": "",
                        "sense": "maximize"
                    }
                },
                "optFunctions": optFunctions
            };
        },
        addOptModel: function (pid, mid, optModel) {
            var file = Studio.getResourceManager().getFile(pid, mid);
            var contents = file.getContents();
            if (!contents['optModels']) {
                contents['optModels'] = {};
            }
            contents['optModels'][optModel['optId']] = $.extend(true, {}, optModel);
        },
        setOptModel: function (pid, mid, optId, optModel) {
            var file = Studio.getResourceManager().getFile(pid, mid);
            var contents = file.getContents();

            if (contents['optModels'] && contents['optModels'][optId]) {
                var target = contents['optModels'][optId];
                for (var key in optModel) {
                    if (optModel[key].constructor == Array) {
                        target[key] = $.extend(true, [], optModel[key]);
                    }
                    else if (optModel[key].constructor == Object) {
                        target[key] = $.extend(true, {}, optModel[key]);
                    }
                    else {
                        target[key] = optModel[key];
                    }
                }
            }
        },
        removeOptModel: function (pid, mid, optId) {
            var file = Studio.getResourceManager().getFile(pid, mid);
            var contents = file.getContents();
            if (contents['optModels'] && contents['optModels'][optId]) {
                var ret = contents['optModels'][optId];
                delete contents['optModels'][optId];
                return ret;
            }
        },
        buildOptRunnable: function (orgRunnable) {
            /**
             * optRunnbale = {
             *    main: string
             *    models: {
             *       "modelid": {
             *           variables: {},
             *           functions: [],
             *           links: [],
             *           optModels: {
             *               "optid": {
             *                  optId: string,
             *                  hash: string,
             *                  label: string,
             *                  options: {
             *                      activated: "true,false,none",
             *                      method: string,
             *                      maxEvaluation: string,
             *                      objective: {
             *                         fid: string, tableName: string, 
             *                         row: '', column: '', sesnse: ''
             *                      },
             *                  },
             *                  optFunctions: [{ fid:'', optSelected:'', optParam:'' }],
             *                  functions: [],
             *                  links: [],
             *                  optSelected: {
             *                      "functionid": {
             *                          optParam: { 
             *                              "paramKey": {min: string, max: string, value: string} 
             *                          }
             *                      }
             *                  }
             *               }
             *           }
             *       }
             *    }
             *    version: number
             * }
             */

            var isRunnableOptModel = function (optModel, functionsObject) {
                var isRunnable = true;
                if (optModel.options.activated !== "true") {
                    isRunnable = false;
                }
                if (isRunnable) {
                    var optFunctions = optModel.optFunctions;
                    for (var i = 0; i < optFunctions.length; i++) {
                        if (!functionsObject[optFunctions[i].fid]) {
                            isRunnable = false;
                            break;
                        }
                    }
                }
                return isRunnable;
            };

            var getFunctionsObject = function (model) {
                var functionsObject = {};
                for (var i = 0; i < model.functions.length; i++) {
                    functionsObject[model.functions[i].fid] = model.functions[i];
                }
                return functionsObject;
            };

            var getRunnableOptModel = function (model) {
                var ret = {};
                var functionsObject = getFunctionsObject(model);
                var optModels = model.optModels;
                for (var optMid in optModels) {
                    if (optModels.hasOwnProperty(optMid)) {
                        var optModel = optModels[optMid];
                        if (isRunnableOptModel(optModel, functionsObject)) {
                            ret[optModel.optId] = $.extend(true, {}, optModel);
                        }
                    }
                }
                return convertOptFunctions(ret, functionsObject, model.links);
            };

            var convertOptFunctions = function (optModels, functionsObject, links) {
                for (var optMid in optModels) {
                    if (optModels.hasOwnProperty(optMid)) {
                        var optModel = optModels[optMid];
                        generateOptSelected(optModel);
                        generateFunctions(optModel, functionsObject);
                        generateLinks(optModel, links);
                        delete optModel.optFunctions;
                    }
                }
                return optModels;
            };

            var generateOptSelected = function (optModel) {
                optModel.optSelected = {};
                var optFunctions = optModel.optFunctions;
                for (var i = 0; i < optFunctions.length; i++) {
                    var fid = optFunctions[i].fid;
                    if (optFunctions[i].optSelected === "true") {
                        optModel.optSelected[fid] = {
                            "optParam": {}
                        };

                        for (var key in optFunctions[i].optParam) {
                            var optParam = optFunctions[i].optParam[key];
                            if (optParam.optParamSelected === "true") {
                                optModel.optSelected[fid].optParam[key]
                                    = $.extend(true, {}, optParam);
                                delete optModel.optSelected[fid].optParam[key].optParamSelected;
                            }
                        }
                    }
                }
            };

            var generateFunctions = function (optModel, functionsObject) {
                optModel.functions = [];
                var optFunctions = optModel.optFunctions;
                for (var i = 0; i < optFunctions.length; i++) {
                    var fid = optFunctions[i].fid;
                    optModel.functions.push($.extend(true, {}, functionsObject[fid]));
                }
            };

            var generateLinks = function (optModel, links) {
                optModel.links = [];
                for (var i = 0; i < links.length; i++) {
                    var sourceFid = links[i].sourceFid;
                    var targetFid = links[i].targetFid;

                    if (optModel.hash.indexOf(sourceFid) > -1
                        && optModel.hash.indexOf(targetFid) > -1) {
                        optModel.links.push($.extend(true, {}, links[i]));
                    }
                }
            };

            var adjustFunctions = function (model, optModels) {
                var newFunctions = [];
                for (var optMid in optModels) {
                    newFunctions.push({
                        "fid": optModels[optMid].optId,
                        "label": optModels[optMid].label,
                        "name": "Opt",
                        "param": {
                            "mid": optModels[optMid].optId,
                        }
                    });
                }

                for (var i = 0; i < newFunctions.length; i++) {
                    model.functions.push(newFunctions[i]);
                }
            };

            var adjustLinks = function (model, optModels) {
                var orgLinks = $.extend(true, [], model.links);
                var links = model.links;
                var functionsObject = getFunctionsObject(model);
                var deleteLinkIds = {};
                var isCreated = {};
                var isFirstFunction = {};

                for (var optMid in optModels) {
                    var optModel = optModels[optMid];

                    for (var i = 0; i < orgLinks.length; i++) {
                        var sourceFid = orgLinks[i].sourceFid;
                        var targetFid = orgLinks[i].targetFid;
                        isFirstFunction[targetFid] = false;

                        if (!(optModel.hash.indexOf(sourceFid) > -1)
                            && optModel.hash.indexOf(targetFid) > -1) {
                            deleteLinkIds[orgLinks[i].kid] = true;

                            if (!isCreated[sourceFid + '_' + optMid]) {
                                isCreated[sourceFid + '_' + optMid] = true;
                                links.push({
                                    'sourceFid': sourceFid,
                                    'targetFid': optMid
                                });
                            }
                            links.push({
                                'sourceFid': optMid,
                                'targetFid': targetFid
                            });
                        }
                    }

                    for (var fid in functionsObject) {
                        if (isFirstFunction[fid] !== false && optModel.hash.indexOf(fid) > -1) {
                            links.push({
                                'sourceFid': optMid,
                                'targetFid': fid
                            });
                        }
                    }
                }

                for (var i = links.length - 1; i >= 0; i--) {
                    if (deleteLinkIds[links[i].kid]) {
                        links.splice(i, 1);
                    }
                }
            }

            var runnable = $.extend(true, {}, orgRunnable);
            var models = runnable.models;
            for (var mid in models) {
                if (models.hasOwnProperty(mid)) {
                    var model = models[mid];
                    var optModels = getRunnableOptModel(model);
                    adjustLinks(model, optModels);
                    adjustFunctions(model, optModels);
                    model.optModels = $.extend(true, {}, optModels);
                }
            }
            return runnable;
        }
    };
}).call(this);

/**
 * Created by ji_sung.park on 2017-05-22.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    Brightics.VA.Core.Utils.PermissionUtils = {
        check: function ($target, permissions) {
            var _this = this;

            _.map(permissions, function (permission) {
                if (!_this.validate(permission)) _this[permission]($target);
            });
        },
        validate: function (permission) {            
            if (this[permission] && !this.hasPermission(permission)) return false;
            return true;
        },
        hasPermission: function (permission) {
            for (var i in Brightics.VA.Env.Session.permissions) {
                if (Brightics.VA.Env.Session.permissions[i].permission_id === permission) {
                    return true;
                }
            }   
            return false; 
        },
        'data_upload_shared': function ($target) {
            var checkUploadData = function ($target) {
                var selectors = [
                    '#upload-to-shared-local',
                    '#upload-to-shared-jdbc',
                    '#upload-to-shared-alluxio'
                ];

                _.map(selectors, function (selector) {
                    var targets = $target.find(selector);

                    if (targets.length > 0) {
                        _.map(targets, function (target) {
                            $(target).jqxRadioButton({disabled: true});
                        });
                    }
                });
            };
            checkUploadData($target);
        }
    };

}).call(this);
/**
 * Created by daewon.park on 2016-03-28.
 */
(function () {
    'use strict';

    var root = this;

    var showHelp = function (clazz) {
        var $el = $('body');

        var $popover = $('<div class="brtc-va-quickhelp-background"></div>');
        $popover.addClass(clazz);
        $el.append($popover);

        $popover.on('click', function () {
            $popover.remove();
        });
    };

    root.Brightics.VA.Core.Utils.QuickHelp = {
        showQuickModeling: function () {
            showHelp('brtc-va-quickhelp-quickdrawing');
        }
    };

}).call(this);
/**
 * Created by SDS on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;
    var mdConverter = window.markdownit && new window.markdownit();

    root.Brightics.VA.Core.Utils.RenderUtils = {
        md: function ($parent, mdText) {
            var $contents = $('<div class="brtc-va-md-content"></div>');
            $parent.append($contents);

            $contents.html(mdConverter.render(mdText));

            return $contents;
        },
        html: function ($parent, htmlText) {
            var $contents = $('<div class="brtc-va-html-content"></div>');
            $parent.append($contents);
            $contents.append(htmlText);

            return $contents;
        },
        image: function ($parent, imageText) {
            var $contents = $('<div class="brtc-va-image-content"></div>');
            var $imageTag = $('<img></img>');
            $parent.append($contents);
            $contents.append($imageTag);

            $imageTag.attr('src', imageText);

            return $contents;
        },
        chart: function ($target, options) {
            $target.bcharts(options);
        }
    }
}).call(this);
/**
 * Created by daewon.park on 2016-09-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    root.Brightics.VA.Core.Utils.RunnableFactory = {
        _create: function (jid, user) {       
            return {
                'main': '',
                'models': {},
                'version': Brightics.VA.Env.CoreVersion
            }
        },
        createForUnit: function (fnUnit, jid, user, args, options) {
            var type = fnUnit.parent().type || 'data';
            var runnableFactory = Brightics.VA.Core.Interface.RunnableFactory[type];
            if (runnableFactory) {
                return runnableFactory.createForUnit(fnUnit, jid, user, args, options);
            }
        },
        createForFlow: function (model, jid, user, args, options) {      
            var type = model.type;
            var runnableFactory = Brightics.VA.Core.Interface.RunnableFactory[type];
            if (runnableFactory) {
                return runnableFactory.createForFlow(model, jid, user, args, options);
            }
        },
        createForDummy: function (fnUnit, jid, user, args, options) {
            var execUnit = $.extend(true, {}, fnUnit);

            var model = {
                mid: 'mid',
                type: 'data',
                functions: [execUnit]
            };

            var runnable = {
                main: 'mid',
                models: { 'mid': model },
                version: Brightics.VA.Env.CoreVersion
            }
            return runnable;
        }
    };

}).call(this);
/* -----------------------------------------------------
 *  variable-utils.js
 *  Created by hyunseok.oh@samsung.com on 2018-06-26.
 * ---------------------------------------------------- */

/* global _ */
(function (root) {
    'use strict';

    var Brightics = root.Brightics;

    var wrap = function (str) {
        if (_.startsWith(str, '${=') && _.endsWith(str, '}')) {
            str = str.substring(3, str.length - 1);
        }

        return '${=' + str + '}';
    };

    var strip = function (str) {
        if (_.startsWith(str, '${=') && _.endsWith(str, '}')) {
            return str.substring(3, str.length - 1);
        }
        return str;
    };

    Brightics.VA.Core.Utils.VariableUtils = {
        wrap: wrap,
        strip: strip
    };

/* eslint-disable no-invalid-this */
}(this));

/* -----------------------------------------------------
 *  variableutils.js
 *  Created by hyunseok.oh@samsung.com on 2018-05-24.
 * ---------------------------------------------------- */


/* global _ */
(function () {
    'use strict';
    var root = this;
    var toNumber = function (val) {
        if (_.isNull(val) || _.isUndefined(val) || val === '') return 0;
        return Number(toString(Number(val)));
    };

    var toString = function (val) {
        if (_.isNull(val) || _.isUndefined(val) || val === '') return '';
        if (_.isNumber(val)) {
            if (_.isNaN(val) || _.isUndefined(val)) return '';
            return val.toString();
        }
        return val;
    };

    var isWrapped = function (val) {
        return _.startsWith(val, '${=') && _.endsWith(val, '}');
    };

    var strip = function (_val) {
        var val = _val || '';
        return isWrapped(val) ? val.substring(3, val.length - 1) : val;
    };

    var wrap = function (val) {
        return '${=' + val + '}';
    }

    var hasToWrap = function (type) {
        return ['calculation'].indexOf(type) >= 0;
    };

    var hasToStrip = hasToWrap;

    // brtc spec -> input value
    var setValueByType = function (type, val) {
        return hasToStrip(type) ? strip(val) : val;
    };

    // input value -> brtc spec
    var getValueByType = function (type, val) {

    };

    root.Brightics.VA.Core.Utils.VariableUtils = {
        convertValueByType: function (prvType, nxtType, val) {

        },
        toString: toString,
        toNumber: toNumber,
        strip: strip,
        wrap: wrap
    };

/* eslint-disable no-invalid-this */
}.call(this));

/**
 * Created by gy84.bae on 2016-09-02.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const SOCKET_TYPE = {
        "duplicate" : "alertDuplicate"
    };

    function WebSocketVA() {
        this.initWebSocket();
    }

    WebSocketVA.prototype.initWebSocket = function () {
        var _this = this;

        $.ajax({url: 'api/v1/websocket', type: 'GET', blocking: false}).done(function (result) {
            _this.createWebSocket(result.address);
        });
    };

    WebSocketVA.prototype.createWebSocket = function (address) {
        var _this = this;


        if (!('WebSocket' in window)) {
            console.log('no WebSocket');
        } else {

            try {
                var socket = _this.socket = new WebSocket(address + '/' + Brightics.VA.Env.Session.userId);
                socket.onopen = function () {
                    console.log("Socket has been opened!");
                    var socketSend = {
                        socketAPI: "checkDuplicate",
                        userId: Brightics.VA.Env.Session.userId
                    };
                    socket.send(JSON.toString(socketSend));
                };

                socket.onerror = function (error) {
                };

                socket.onmessage = function (message) {
                    try {
                        //로그아웃해
                        console.log(message);

                    } catch (e) {
                        console.log('This doesn\'t look like a valid JSON: ', message);
                        return;
                    }
                };

                socket.onclose = function () {
                    console.log('socket is closed.')
                }

            } catch (exception) {

            }
        }
    };
    WebSocketVA.prototype.send = function (message) {
        this.socket.send(message);
    };

    

    Brightics.VA.Core.WebSocketVA = WebSocketVA;

}).call(this);

/**
 * Created by SDS on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;

    root.Brightics.VA.Core.Utils.WidgetUtils = {
        ALPHABET: '23456789abcdefghijkmnpqrstuvwxyz',
        ID_LENGTH: 8,

        retrieveWidget: function (id) {
            return typeof (id) === 'string' ? $(id) : id;
        },
        putWorkspaceRef: function ($el, ref) {
            this.putData($el, 'brtc-va-workspace-body-area-ref', ref);
        },
        getWorkspaceRef: function ($el) {
            var $workspace = $el.closest('.brtc-va-workspace-body-area');
            return this.getData($workspace, 'brtc-va-workspace-body-area-ref');
        },
        putStudioRef: function ($el, ref) {
            this.putData($el, 'brtc-studio-ref', ref);
        },
        getStudioRef: function ($el) {
            var $studio = $('.brtc-va-studio');
            return this.getData($studio, 'brtc-studio-ref');
        },
        putUdfRef: function ($el, ref) {
            this.removeUdfRefData($el);
            this.putData($el, 'brtc-udf-ref', ref);
        },
        getUdfRef: function ($el) {
            return this.getData($el, 'brtc-udf-ref');
        },
        /**
         * @deprecated sungjin1.kim use putEditorRef
         */
        putModelEditorRef: function ($el, ref) {
            // this.putData($el, 'brtc-modeleditor-ref', ref);
            this.putEditorRef($el, ref);
        },
        /**
         * @deprecated sungjin1.kim use getEditorRef
         */
        getModelEditorRef: function ($el) {
            // var $editor = $el.closest('.brtc-va-editors-modeleditor');
            // return this.getData($editor, 'brtc-modeleditor-ref');
            return this.getEditorRef($el, 'brtc-va-editors-modeleditor');
        },
        /**
         * @deprecated sungjin1.kim use closestEditor
         */
        closestModelEditor: function ($el) {
            // return $el.closest('.brtc-va-editors-modeleditor');
            return this.closestEditor($el, 'brtc-va-editors-modeleditor');
        },
        putEditorRef: function ($el, ref) {
            this.putData($el, 'brtc-va-editor-ref', ref);
        },
        getEditorRef: function ($el, className) {
            var clazz = className || 'brtc-va-editor';
            var $editor = this.closestEditor($el, clazz);
            return this.getData($editor, 'brtc-va-editor-ref');
        },
        closestEditor: function ($el, className) {
            return $el.closest('.' + className);
        },
        putData: function ($el, key, value) {
            $el.data(key, value);
        },
        getData: function ($el, key) {
            return $el.data(key);
        },
        removeUdfRefData: function ($el) {
            $el.removeData('brtc-udf-ref');
        },
        isRightClick: function (event) {
            var evt = event || window.event;
            var rightClick;
            if (evt.which) {
                rightClick = (evt.which == 3);
            }
            else if (evt.button) {
                rightClick = (evt.button == 2);
            }
            return rightClick || $.jqx.mobile.isTouchDevice();
        },
        getRightClick: function (event) {
            if (Brightics.VA.Core.Utils.WidgetUtils.isRightClick(event)) {
                var scrollTop = $(window).scrollTop();
                var scrollLeft = $(window).scrollLeft();
                return {
                    x: parseInt(event.clientX) + scrollLeft,
                    y: parseInt(event.clientY) + scrollTop
                };
            }
        },
        createPaletteItem: function ($parent, func, clazz) {

            var $paletteContent = $('<div class="brtc-va-views-palette-fnunit-content">');
            var $fnUnitControl = $('' +
                '<div class="brtc-va-views-palette-fnunit brtc-style-views-palette-fnunit brtc-va-studio-dm-draggable">' +
                '   <div class="brtc-va-views-palette-fnunit-icon brtc-style-views-palette-fnunit-icon"></div>' +
                '   <div class="brtc-va-views-palette-fnunit-label brtc-style-views-palette-fnunit-label"></div>' +
                '</div>');
            $paletteContent.append($fnUnitControl);

            var label, category;
            var deprecated = false;
            var impleWidgetUtils = Brightics.VA.Core.Interface.WidgetUtils[clazz];
            if (impleWidgetUtils && impleWidgetUtils.createPaletteItem) {
                var paletteItem = impleWidgetUtils.createPaletteItem(func);
                label = paletteItem.label;
                category = paletteItem.category;
            } else {
                var displayLabel = '';
                var displayCategory = '';
                var context = 'scala';
                if (typeof Brightics.VA.Core.Interface.Functions[clazz][func] === 'undefined') {
                    displayLabel = 'none';
                    displayCategory = 'none';
                } else {
                    displayLabel = Brightics.VA.Core.Interface.Functions[clazz][func].defaultFnUnit.display.label;
                    displayCategory = Brightics.VA.Core.Interface.Functions[clazz][func].category;
                    deprecated = deprecated || Brightics.VA.Core.Interface.Functions[clazz][func].deprecated;
                    context = Brightics.VA.Core.Interface.Functions[clazz][func].defaultFnUnit.context || context;
                }
                // label = Brightics.VA.Core.Interface.Functions[clazz][func].defaultFnUnit.display.label;
                // category = 'brtc-va-fnunit-category-' +Brightics.VA.Core.Interface.Functions[clazz][func].category ;
                label = displayLabel;
                category = 'brtc-va-fnunit-category-' + displayCategory;

            }

            $fnUnitControl.attr('title', label);
            if (displayCategory !== 'udf') {
                $fnUnitControl.attr('context', context)
                                .attr('category', displayCategory);
            }
            $fnUnitControl.find('.brtc-va-views-palette-fnunit-label').text(label);
            if (deprecated) {
                label += '\nDeprecated: ' + Brightics.VA.Core.Interface
                    .Functions[clazz][func]['deprecated-message'];
            }
            $fnUnitControl.attr('title', label);

            if (deprecated) $fnUnitControl.addClass('deprecated');
            $fnUnitControl.addClass(category);

            $parent.append($paletteContent);
            this.putData($fnUnitControl, 'func', func);

            return $fnUnitControl;
        },
        createPaletteUDFItem: function ($parent, func, clazz, closeHandler) {

            var $paletteContent = $('<div class="brtc-va-views-palette-fnunit-content">');
            var $fnUnitControl = $('' +
                '<div class="brtc-va-views-palette-fnunit brtc-style-views-palette-fnunit brtc-va-studio-dm-draggable">' +
                '   <div class="brtc-va-views-palette-fnunit-icon brtc-style-views-palette-fnunit-icon"></div>' +
                '   <div class="brtc-va-views-palette-fnunit-label brtc-style-views-palette-fnunit-label"></div>' +
                '   <div class="brtc-va-views-palette-fnunit-remove-icon brtc-style-views-palette-fnunit-remove-icon" title="Delete"></div>' +
                '</div>');
            $paletteContent.append($fnUnitControl);

            var label, category;
            var deprecated = false;
            var impleWidgetUtils = Brightics.VA.Core.Interface.WidgetUtils[clazz];
            if (impleWidgetUtils && impleWidgetUtils.createPaletteItem) {
                var paletteItem = impleWidgetUtils.createPaletteItem(func);
                label = paletteItem.label;
                category = paletteItem.category;
            } else {
                var displayLabel = '';
                var displayCategory = '';
                var context = 'scala';
                if (typeof Brightics.VA.Core.Interface.Functions[clazz][func] === 'undefined') {
                    displayLabel = 'none';
                    displayCategory = 'none';
                } else {
                    displayLabel = Brightics.VA.Core.Interface.Functions[clazz][func].defaultFnUnit.display.label;
                    displayCategory = Brightics.VA.Core.Interface.Functions[clazz][func].category;
                    deprecated = deprecated || Brightics.VA.Core.Interface.Functions[clazz][func].deprecated;
                    context = Brightics.VA.Core.Interface.Functions[clazz][func].defaultFnUnit.context;
                }
                label = displayLabel;
                category = 'brtc-va-fnunit-category-' + displayCategory;
            }
            $fnUnitControl.attr('title', label);
            if (displayCategory !== 'udf') $fnUnitControl.attr('context', context);
            $fnUnitControl.find('.brtc-va-views-palette-fnunit-label').text(label);
            if (deprecated) {
                label += '\nDeprecated: ' + Brightics.VA.Core.Interface
                    .Functions[clazz][func]['deprecated-message'];
            }
            $fnUnitControl.attr('title', label);

            $fnUnitControl.find('.brtc-va-views-palette-fnunit-remove-icon').on('click', function () {
                var options = {
                    contentText: 'These items will be permanently deleted and cannot be recovered. Are you sure?',
                    close: closeHandler,
                    isCancel: true
                };
                Brightics.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog($parent, options);
            });

            $fnUnitControl.find('.brtc-va-views-palette-fnunit-remove-icon').hide();
            $fnUnitControl.mouseover(function (event) {
                if (false && Brightics.VA.Env.Session.userId !== creator) {
                    $(this).find('.brtc-va-views-palette-fnunit-remove-icon').hide();
                } else {
                    $(this).find('.brtc-va-views-palette-fnunit-remove-icon').show();
                }
            });
            $fnUnitControl.mouseout(function (event) {
                $(this).find('.brtc-va-views-palette-fnunit-remove-icon').hide();
            });

            if (deprecated) $fnUnitControl.addClass('deprecated');
            $fnUnitControl.addClass(category);

            $parent.append($paletteContent);
            this.putData($fnUnitControl, 'func', func);

            return $fnUnitControl;
        },
        createPaletteBox: function (options) {
            var $paletteContent = $('<div class="brtc-va-views-palette-fnunit-content">');
            var $fnUnitControl = $('' +
                '<div class="brtc-va-views-palette-box-fnunit brtc-va-studio-dm-draggable">' +
                '   <div class="brtc-va-views-palette-fnunit-icon brtc-style-views-palette-fnunit-icon"></div>' +
                '   <div class="brtc-va-views-palette-fnunit-label brtc-style-views-palette-fnunit-label"></div>' +
                '</div>');
            $paletteContent.append($fnUnitControl);

            var label, category;
            var impleWidgetUtils = Brightics.VA.Core.Interface.WidgetUtils['data'];
            if (impleWidgetUtils && impleWidgetUtils.createPaletteItem) {
                var paletteItem = impleWidgetUtils.createPaletteItem(options.func);
                category = paletteItem.category;
            } else {
                var displayCategory = '';
                var context = 'scala';
                if (typeof Brightics.VA.Core.Interface.Functions['data'][options.func] === 'undefined') {
                    displayCategory = 'none';
                } else {
                    displayCategory = Brightics.VA.Core.Interface.Functions['data'][options.func].category;
                    context = Brightics.VA.Core.Interface.Functions['data'][options.func].defaultFnUnit.context;
                }
                category = 'brtc-va-fnunit-category-' + displayCategory;
            }

            $fnUnitControl.attr('title', options.label);
            
            $fnUnitControl.find('.brtc-va-views-palette-fnunit-icon').attr('context', context || 'scala');
            $fnUnitControl.find('.brtc-va-views-palette-fnunit-label').text(options.label);

            $fnUnitControl.addClass(category);
            this.putData($fnUnitControl, 'func', options.func);

            return $fnUnitControl;
        },
        createTableItem: function ($parent, options) {
            var $content = $('<div class="brtc-va-views-table-content">');
            var $tableControl = $('' +
                '<div class="brtc-style-views-table brtc-va-studio-dm-draggable">' +
                '   <div class="brtc-style-views-table-icon">' + (options.type).substring(0, 1) + '</div>' +
                '   <div class="brtc-style-views-table-label"></div>' +
                '</div>');
            $content.append($tableControl);

            $tableControl.attr('title', options.label);
            $tableControl.find('.brtc-style-views-table-label').text(options.label);

            $parent.append($content);

            return $tableControl;
        },
        createKeyItem: function (options) {
            var faClasses = {
                table: 'fa fa-table',
                model: 'fa fa-table',
                image: 'fa fa-table'
            }

            var $content = $('<div class="brtc-va-views-key-content">');
            var $key = $('' +
                '<div class="brtc-style-views-key">' +
                '   <div class="brtc-style-views-key-icon"><i></i></div>' +
                '   <div class="brtc-style-views-key-label"></div>' +
                '</div>');
            $content.append($key);

            $key.attr('title', options.label);
            $key.find('.brtc-style-views-key-icon').attr(options.type);
            $key.find('.brtc-style-views-key-label').text(options.label);
            $key.find('i').addClass(faClasses[options.type]);

            return $content;
        },
        createDialogContentsArea: function ($parent, option) {
            var content = $('' +
                '<div class="brtc-va-dialogs-body-content">' +
                '    <span class="brtc-va-dialogs-body-content-icon"></span>' +
                '    <div class="brtc-va-dialogs-body-content-content-text"><span></span></div>' +
                '</div>');
            $parent.append(content);

            content.find('.brtc-va-dialogs-body-content-icon').attr('alert', option.type);
            content.find('.brtc-va-dialogs-body-content-content-text span').text(option.contentText);
            // content.find('.brtc-va-dialogs-body-content-content-text').parent().parent().css('padding-bottom', '10px');
            // content.find('.brtc-va-dialogs-body-content-content-text').parent().parent().css('padding-right', '0');

            content.find('.brtc-va-dialogs-body-content-content-text').attr('title', option.contentText);
            if (content.find('.brtc-va-dialogs-body-content-content-text').innerHeight() > 30) {
                content.find('.brtc-va-dialogs-body-content-content-text').css('line-height', '15px');
            }
        },
        openConfirmDialog: function (message, closeCallback) {
            this.createCommonConfirmDialog($('body'), {
                type: 'info',
                isCancel: true,
                contentText: message,
                close: closeCallback
            });
        },
        openConfirmWithOptionDialog: function (title, message, optionMessage, closeCallback) {
            this.createCommonConfirmWithOptionDialog($('body'), {
                title: title,
                type: 'info',
                isCancel: true,
                contentText: message,
                optionText: optionMessage,
                close: closeCallback
            });
        },
        checkAgentStatus: function () {
            var option = {
                url: 'api/va/v2/analytics/agentuser/status',
                blocking: false,
                type: 'GET'
            };
            return $.ajax(option);
        },
        createProgressDialog: function ($parent, options) {
            var dialogResult = {
                OK: false,
                Cancel: true
            };

            var mainControl = $('' +
                '<div class="brtc-va-dialogs-main">' +
                '   <div class="brtc-va-dialogs-body">' +
                '       <div class="brtc-va-progress">' +
                '           <div style="padding-left: 120px;"><span class="brtc-va-progress-loading"></span></div>' +
                '       </div>' +
                '       <div class="brtc-va-dialogs-contents">' +
                '           <span class="brtc-va-dialogs-body-content-icon" alert="info"></span>' +
                '           <div class="brtc-va-dialogs-body-content-content-text">Please try again later.</div>' +
                '       </div>' +
                '       <div class="brtc-va-dialogs-buttonbar">' +
                '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
                '       </div>' +
                '   </div>' +
                '</div>');
            $parent.append(mainControl);

            mainControl.find('.brtc-va-dialogs-body-content-content-text').css('display', 'none');
            mainControl.find('.brtc-va-dialogs-body-content-icon').css('display', 'none');

            var okButton;
            okButton = mainControl.find('.brtc-va-dialogs-buttonbar-ok');
            okButton.css('display', 'none');
            var jqxOpt = {
                theme: Brightics.VA.Env.Theme,
                width: 400,
                height: 280,
                title: options.title,
                modal: true,
                resizable: false,
                showCloseButton: false,
                open: function () {
                    okButton.jqxButton({
                        theme: Brightics.VA.Env.Theme
                    });
                    okButton.click(function () {
                        dialogResult = {
                            OK: true,
                            Cancel: false
                        };
                        mainControl.dialog('close');
                    });
                },
                close: function () {
                    mainControl.dialog('destroy');
                    mainControl.remove();

                    if (typeof options.close == 'function') {
                        options.close(dialogResult);
                    }
                },
                focus: function () {
                },
                keyboardCloseKey: ''
            };
            mainControl.dialog(jqxOpt);
            mainControl.attr('name', jqxOpt.title);
            return mainControl;
        },
        getBadRequestErrorMessage: function (err) {
            if (err.status == 400) {
                var responseJSON = err.responseJSON;
                if (!responseJSON) {
                    try {
                        responseJSON = JSON.parse(err.responseText);
                    } catch (ex) {
                        console.error(ex);
                    }
                }
                if (responseJSON && (responseJSON.errors[0].code === 'BR-3203')) {
                    return 'Sorry! The workspace is not available. Please contact administrator.';
                }
            }
        },
        openBadRequestErrorDialog: function (err, closeCallback) {
            if (err.status !== 400) {
                if (typeof closeCallback === 'function') {
                    closeCallback({
                        OK: false,
                        Cancel: true
                    });
                }
                return;
            }

            var responseJSON = err.responseJSON;
            if (!responseJSON) {
                try {
                    var messageJSON = JSON.parse(err.responseText);
                    responseJSON = messageJSON;
                } catch (err) {
                    responseJSON = {
                        'errors': [
                            {
                                'message': 'Sorry! An unexpected error occurred. Please contact administrator.',
                                'code': 400,
                                'detailMessage': err.responseText,
                                'detailContentType': 'application/json'
                            }
                        ]
                    };
                }
            }
            if (responseJSON && responseJSON.errors[0].code === 'BR-3203') {
                var _this = this;
                var progressBar = this.createProgressDialog($('body'), {
                    title: 'Preparing workspace...',
                    close: closeCallback
                });

                var clock = 0;
                var checkTimer = function () {
                    var showTryAgainMessage = function () {
                        progressBar.find('.brtc-va-progress').css('display', 'none');
                        progressBar.find('.brtc-va-dialogs-body-content-content-text').css('display', 'block');
                        progressBar.find('.brtc-va-dialogs-body-content-icon').css('display', 'block');
                        progressBar.find('.brtc-va-dialogs-buttonbar-ok').css('display', 'block');
                    };

                    clock++;
                    _this.checkAgentStatus().done(function (status) {
                        if (status === 'STOP') {
                            if (clock > 30) { // 60초
                                clearTimeout(_this.timer);
                                showTryAgainMessage();
                            } else {
                                clearTimeout(_this.timer);
                                _this.timer = setTimeout(checkTimer, 2000);
                            }
                        } else {
                            clearTimeout(_this.timer);
                            showTryAgainMessage();
                        }
                    }).fail(function (err) {
                        clearTimeout(_this.timer);
                        showTryAgainMessage();
                    });
                };
                clearTimeout(_this.timer);
                _this.timer = setTimeout(checkTimer, 2000);
            } else if (responseJSON && responseJSON.errors) {
                this.openErrorDialog(responseJSON, closeCallback);
            } else {
                this.openErrorDialog('Sorry! An unexpected error occurred. Please contact administrator.', closeCallback);
            }
        },
        openErrorDialog: function (err, closeCallback) {
            var message, detailMessage, detailContentType;
            if (typeof err === 'string') message = this.codeToMessage(err);
            else if (err.errors && Array.isArray(err.errors)) {
                message = err.errors[0].message;
                if (!message) {
                    message = 'Sorry! An unexpected error occurred. Please contact administrator.';
                }
                if (message.indexOf('SparkException:') == 0 ||
                    message.indexOf('NoClassDefFoundError:') == 0) {
                    message = 'Sorry! An unexpected error occurred. Please contact administrator.';
                } else if (message.indexOf('Exception:') == 0) {
                    message = message.substring(10, msg.length).trim();
                } else if (message.indexOf('AnalysisException:') == 0) {
                    message = message.substring(18, msg.length).trim();
                } else if (message.indexOf('InvalidInputException:') == 0) {
                    message = 'Input path does not exist.';
                }
                if (message.indexOf('Not allowed condition') > -1) {
                    message = 'Can not update. Check schedule status.';
                }

                if (err.errors[0].detailMessage) detailMessage = err.errors[0].detailMessage;
                if (err.errors[0].contentType) detailContentType = err.errors[0].contentType;
            }

            var _this = this;
            clearTimeout(this.openError);
            this.openError = setTimeout(function () {
                _this.createCommonConfirmDialog($('body'), {
                    type: 'error',
                    isCancel: false,
                    contentText: message,
                    close: closeCallback,
                    detailText: detailMessage,
                    detailContentType: detailContentType
                });
            }, 500);
        },
        openInformationDialog: function (message, closeCallback) {
            this.createCommonConfirmDialog($('body'), {
                type: 'info',
                isCancel: false,
                contentText: message,
                close: closeCallback
            });
        },
        openQuestionDialog: function (message, closeCallback) {
            this.createCommonConfirmDialog($('body'), {
                type: 'info',
                okLabel: 'Yes',
                cancelLabel: 'No',
                isCancel: true,
                contentText: message,
                close: closeCallback
            });
        },
        openWarningDialog: function (message, closeCallback) {
            var _this = this;
            clearTimeout(this.openWarning);
            this.openWarning = setTimeout(function () {
                _this.createCommonConfirmDialog($('body'), {
                    type: 'warn',
                    isCancel: false,
                    contentText: message,
                    close: closeCallback
                });
            }, 500);
        },
        createCommonConfirmDialog: function ($parent, options) {
            var dialogResult = {
                OK: false,
                Cancel: true
            };
            var mainControl = $('' +
                '<div class="brtc-va-dialogs-main">' +
                '   <div class="brtc-va-dialogs-body">' +
                '       <div class="brtc-va-dialogs-contents" style="padding-right: 0 !important; padding-bottom: 10px !important;">' +
                '       </div>' +
                '       <div class="brtc-va-dialogs-buttonbar">' +
                '           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />' +
                '       </div>' +
                '   </div>' +
                '</div>');

            $parent.append(mainControl);
            var okButton, cancelButton, detailButton;
            okButton = mainControl.find('.brtc-va-dialogs-buttonbar-ok');
            if (options.okLabel) {
                okButton.val(options.okLabel);
            }

            if (options.isCancel) {
                cancelButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />');
                mainControl.find('.brtc-va-dialogs-buttonbar').append(cancelButton);

                if (options.cancelLabel) {
                    cancelButton.val(options.cancelLabel);
                }
            }

            if (options.detailText) {
                detailButton = $('<input type="button" class="brtc-va-dialogs-buttonbar-detail" value="Detail" />');
                mainControl.find('.brtc-va-dialogs-buttonbar').append(detailButton);
            }

            var _this = this;
            var jqxOpt = {
                theme: Brightics.VA.Env.Theme,
                width: 400,
                height: 210,
                modal: true,
                resizable: false,
                cancelButton: cancelButton,
                open: function () {
                    $('.ui-dialog-titlebar.ui-widget-header').attr('style', 'border-bottom: none !important;');
                    $('button.ui-dialog-titlebar-close').css('top', '30px !important');

                    _this.createDialogContentsArea(mainControl.find('.brtc-va-dialogs-contents'), options);
                    okButton.jqxButton({
                        theme: Brightics.VA.Env.Theme
                    });
                    okButton.click(function () {
                        dialogResult = {
                            OK: true,
                            Cancel: false
                        };
                        mainControl.dialog('close');
                    });
                    if (options.isCancel) {
                        cancelButton.jqxButton({
                            theme: Brightics.VA.Env.Theme
                        });
                        cancelButton.click(function () {
                            dialogResult = {
                                OK: false,
                                Cancel: true
                            };
                            mainControl.dialog('close');
                        });
                    }

                    if (options.detailText) {
                        detailButton.jqxButton({
                            theme: Brightics.VA.Env.Theme
                        });
                        detailButton.click(function () {
                            if (options.detailContentType && options.detailContentType.startsWith('text/html')) {
                                var params = [
                                    'width=800',
                                    'height=600',
                                    'menubar=no',
                                    'status=no',
                                    'toolbar=no',
                                    'location=no'
                                ];
                                var w = window.open('/detail-popup', 'Detail Information', params.join(','));
                                w.document.write(options.detailText);
                            } else {
                                new Brightics.VA.Core.Dialogs.DetailDialog(mainControl, {
                                    title: 'Detail Information',
                                    detailText: options.detailText
                                });
                            }
                        });
                    }
                },
                close: function () {
                    mainControl.dialog('destroy');
                    mainControl.remove();

                    if (typeof options.close == 'function') {
                        options.close(dialogResult);
                    }
                },
                focus: function () {
                    mainControl.focus();
                }
            };

            mainControl.dialog(jqxOpt);
            mainControl.find('.brtc-va-dialogs-main').css('padding-left', '5px');
            mainControl.attr('name', jqxOpt.title);

            return mainControl;
        },
        createCommonConfirmWithOptionDialog: function ($parent, options) {
            new Brightics.VA.Core.Dialogs.ConfirmWithOptionDialog($parent, options);
        },
        codeToMessage: function (err) {
            /*
             * {
             *   "errors" = [ {
             *       "message": "This is first error message.",
             *       "code": 401
             *     }, {
             *       "message": "This is second error message.",
             *       "code": 402
             *     } ]
             * }
             */
            var msg;
            if (err && Array.isArray(err.errors)) {
                var message = '';
                for (var i in err.errors) {
                    msg = err.errors[i].message;
                    if (!msg) {
                        msg = 'Sorry! An unexpected error occurred. Please contact administrator.';
                    }
                    if (msg.indexOf('SparkException:') == 0 ||
                        msg.indexOf('NoClassDefFoundError:') == 0) {
                        msg = 'Sorry! An unexpected error occurred. Please contact administrator.';
                    } else if (msg.indexOf('Exception:') == 0) {
                        msg = msg.substring(10, msg.length).trim();
                    } else if (msg.indexOf('AnalysisException:') == 0) {
                        msg = msg.substring(18, msg.length).trim();
                    } else if (msg.indexOf('InvalidInputException:') == 0) {
                        msg = 'Input path does not exist.';
                    }
                    if (msg.indexOf('Not allowed condition') > -1) {
                        msg = 'Can not update. Check schedule status.';
                    }

                    message += msg + '\n';
                }
                return message;
            } else if (typeof err === 'string') {
                msg = err;
                if (msg.indexOf('SparkException:') == 0 ||
                    msg.indexOf('NoClassDefFoundError:') == 0) {
                    msg = 'Sorry! An unexpected error occurred. Please contact administrator.';
                } else if (msg.indexOf('Exception:') == 0) {
                    msg = msg.substring(10, msg.length).trim();
                } else if (msg.indexOf('AnalysisException:') == 0) {
                    msg = msg.substring(18, msg.length).trim();
                } else if (msg.indexOf('InvalidInputException:') == 0) {
                    msg = 'Input path does not exist.';
                }
                return msg;
            } else {
                return err;
            }
        },
        convertHTMLSpecialChar: function (str) {
            if (str) {
                str = str.replace(/&/g, '&amp;');
                str = str.replace(/</g, '&lt;');
                str = str.replace(/>/g, '&gt;');
                str = str.replace(/"/g, '&quot;');
                str = str.replace(/\s/g, '&nbsp;');
                return str;
            }
            return str;
        },
        adjustCodeMirrorEsc: function (codeMirror) {
            // CodeMirror Hint가 close 될 때, "endCompletion" Event가 CodeMirror로 signal된다.
            // Esc Key로 close되는 경우에는 StopPropagation 하여 Dialog가 함께 close 되는 것 방지.
            codeMirror.on('endCompletion', function (cm) {
                if ((window.event instanceof KeyboardEvent) && (window.event.type == 'keydown') && (window.event.key == 'Escape')) {
                    window.event.stopPropagation();
                }
            });
        },
        setValidatorToCodeMirror: function (options) {
            var validator = {};
            validator.type = (typeof options === 'undefined') ? '' : options['valid-type'];
            validator.isValid = function (inputString) {
                var isValid;
                if (validator.type) {
                    isValid = Brightics.VA.Core.Utils.InputValidator.isValid[validator.type](inputString);
                } else {
                    isValid = true;
                }
                return isValid;
            };
            return validator;
        },
        changeCodeMirrorLineToSingle: function (codeMirror, additionalOption) {
            var widgetUtil = this;
            var validator = widgetUtil.setValidatorToCodeMirror(additionalOption);

            codeMirror.on('beforeChange', function (instance, changeObj) {
                var newtext = changeObj.text.join("").replace(/\n/g, ""); // remove ALL \n !
                changeObj.update(changeObj.from, changeObj.to, [newtext]);

                var typedNewLine = changeObj.origin == '+input' && typeof changeObj.text == "object" && changeObj.text.join(" ") == "";
                var typedNewString = (changeObj.origin === 'setValue' || changeObj.origin === '+delete') ? undefined : changeObj.text.join("") || '';
                var isValid = validator.isValid(typedNewString);
                if (!isValid) {
                    typedNewString = (typedNewString.length > 10) ? typedNewString.substring(0, 9) + '...' : typedNewString;
                    typedNewString = typedNewString === '\t' ? 'Tab' : typedNewString === '' ? 'Enter' : typedNewString;
                    var message = '※ This character( ' + typedNewString + ' ) is NOT allowed.';
                    Brightics.VA.Core.Widget.Factory.createFadeOutMessage($(instance.display.lineDiv).closest('.CodeMirror'), {
                        message: message,
                        position: additionalOption['valid-message-position']
                    });
                }
                if (typedNewLine || !isValid) {
                    instance.doc.setCursor(instance.getCursor());
                    return changeObj.cancel();
                }
                // var typedNewLine = changeObj.origin == '+input' && typeof changeObj.text == "object" && changeObj.text.join("") == "";
                // if (typedNewLine) return changeObj.cancel();

                var pastedNewLine = changeObj.origin == 'paste' && typeof changeObj.text == "object" && changeObj.text.length > 1;
                if (pastedNewLine) {
                    var newText = changeObj.text.join(" ");
                    return changeObj.update(null, null, [newText]);
                }
                return null;
            });
            codeMirror.setSize('100%', '27px');
        },
        setCodeMirrorMaxLength: function (codeMirror) {
            codeMirror.on('beforeChange', function (cm, change) {
                    var maxLength = cm.getOption('maxLength');
                    if (maxLength && change.update) {
                        var str = change.text.join('\n');
                        var delta = str.length - (cm.indexFromPos(change.to) - cm.indexFromPos(change.from));
                        if (delta <= 0) {
                            $(cm.getTextArea()).trigger('hideOverflow');
                            return true;
                        }

                        delta = cm.getValue().length + delta - maxLength;
                        if (delta > 0) {
                            $(cm.getTextArea()).trigger('showOverflow');
                            str = str.substr(0, str.length - delta);
                            change.update(change.from, change.to, str.split('\n'));
                        }
                    }
                    return true;
                }
            );
        },
        createUDFItem: function ($parent, udf, clazz, closeHandler, openDialogHandler) {
            var _this = this;

            // var $paletteContent = $('<div class="brtc-va-views-udf-fnunit-content">');
            var $paletteContent = $('<div class="brtc-va-views-udf-fnunit-content ' + 'brtc-va-views-udf-type-' + udf.type + '">');
            var $fnUnitControl = $('' +
                '<div class="brtc-va-views-udf-fnunit brtc-style-views-udf-fnunit brtc-va-studio-dm-draggable">' +
                '   <div class="brtc-va-views-udf-fnunit-icon"></div>' +
                '   <div class="brtc-va-views-udf-fnunit-label"></div>' +
                '   <div class="brtc-va-views-udf-fnunit-version"></div>' +
                // '   <div class="brtc-va-views-udf-fnunit-open-icon brtc-style-udf-fnunit-open-icon" title="Update"></div>' +
                '   <div class="brtc-va-views-udf-fnunit-remove-icon brtc-style-udf-fnunit-remove-icon" title="Delete"></div>' +
                '</div>');
            $paletteContent.append($fnUnitControl);

            var label, category;
            var impleWidgetUtils = Brightics.VA.Core.Interface.WidgetUtils[clazz];
            if (impleWidgetUtils && impleWidgetUtils.createPaletteItem) {
                var paletteItem = impleWidgetUtils.createPaletteItem(udf.id);
                label = paletteItem.label;
                category = paletteItem.category;
            } else {

                var displayLabel = '';
                var displayCategory = '';
                var displayVersion = '';
                if (typeof Brightics.VA.Core.Interface.Functions[clazz][udf.id] === 'undefined' || true) {
                    displayLabel = udf.label ;
                    displayVersion = ' ver' + udf.version;
                    displayCategory = 'udf';
                } else {
                    displayLabel = Brightics.VA.Core.Interface.Functions[clazz][udf.id].defaultFnUnit.display.label;
                    displayCategory = Brightics.VA.Core.Interface.Functions[clazz][udf.id].category;
                }
                label = displayLabel;
                category = 'brtc-va-fnunit-category-' + displayCategory;
            }

            $fnUnitControl.find('.brtc-va-views-udf-fnunit-open-icon').hide();
            $fnUnitControl.find('.brtc-va-views-udf-fnunit-remove-icon').hide();

            $fnUnitControl.attr('title', label);
            $fnUnitControl.find('.brtc-va-views-udf-fnunit-label').text(label);
            $fnUnitControl.find('.brtc-va-views-udf-fnunit-version').text(displayVersion);

            $fnUnitControl.find('.brtc-va-views-udf-fnunit-open-icon').on('click', function () {
                openDialogHandler();
            });

            $fnUnitControl.mouseover(function (event) {
                $(this).find('.brtc-va-views-udf-fnunit-open-icon').show();
                if (false && Brightics.VA.Env.Session.userId !== udf.creator) {
                    $(this).find('.brtc-va-views-udf-fnunit-remove-icon').hide();
                } else {
                    $(this).find('.brtc-va-views-udf-fnunit-remove-icon').show();
                }
            });
            $fnUnitControl.mouseout(function (event) {
                $(this).find('.brtc-va-views-udf-fnunit-open-icon').hide();
                $(this).find('.brtc-va-views-udf-fnunit-remove-icon').hide();
            });

            $fnUnitControl.find('.brtc-va-views-udf-fnunit-remove-icon').on('click', function () {
                var options = {
                    contentText: 'These items will be permanently deleted and cannot be recovered. Are you sure?',
                    close: closeHandler,
                    isCancel: true
                };
                Brightics.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog($parent, options);
            });


            $fnUnitControl.addClass(category);

            $parent.append($paletteContent);
            this.putData($fnUnitControl, 'udf', udf);

            return $fnUnitControl;
        },
        getFunctionLibrary: function (clazz, func) {
            if (typeof Brightics.VA.Core.Interface.Functions[clazz][func] === 'undefined') {
                return Brightics.VA.Core.Interface.Functions[clazz].unknownFunction;
            } else {
                return Brightics.VA.Core.Interface.Functions[clazz][func];
            }
        },
        createPrivatePolicy: function ($parent) {
            var $privatePolicy = $('' +
                '<div class="brtc-va-widget-utils-private-policy-division">' +
                '   <span class="brtc-va-widget-utils-private-policy-span">Private Policy</span>' +
                '</div>');
            $parent.append($privatePolicy);

            $privatePolicy.click(function () {
                window.open('/private-policy', 'Brightics Private Policy');
            });

            var $projectList = $parent.find('.brtc-va-workspace-project-list');
            if ($projectList && $projectList.length) $projectList.css('height', 'calc(100% - 98px)');  //private policy text 공간을 위해
        },
        updateGridSource: function ($grid, source) {
            var adapter = new $.jqx.dataAdapter(source);
            $grid.jqxGrid('source', adapter);
            $grid.jqxGrid('clearfilters');
            $grid.jqxGrid('clearselection');

            this.updatePageButton($grid);
        },
        updatePageButton: function ($grid) {
            var paginginformation = $grid.jqxGrid('getpaginginformation');

            var $first = $grid.find('.jqx-grid-pager div[type=button][title=first]'),
                $previous = $grid.find('.jqx-grid-pager div[type=button][title=previous]'),
                $last = $grid.find('.jqx-grid-pager div[type=button][title=last]'),
                $next = $grid.find('.jqx-grid-pager div[type=button][title=next]');

            if (paginginformation.pagenum === 0) {
                $first.css('opacity', '.3').jqxButton({disabled: true});
                $previous.css('opacity', '.3').jqxButton({disabled: true});
            } else {
                $first.css('opacity', '1').jqxButton({disabled: false});
                $previous.css('opacity', '1').jqxButton({disabled: false});
            }

            if (paginginformation.pagescount === 0 || paginginformation.pagenum === paginginformation.pagescount - 1) {
                $last.css('opacity', '.3').jqxButton({disabled: true});
                $next.css('opacity', '.3').jqxButton({disabled: true});
            } else {
                $last.css('opacity', '1').jqxButton({disabled: false});
                $next.css('opacity', '1').jqxButton({disabled: false});
            }
        },
        debounce: function (fn, ms) {
            return _.debounce(fn, ms, {maxWait: ms});
        },
        setTrimInputControlOnFocusout: function ($control) {
            $control.focusout(function (e) {
                var inputString = $control.val();
                var isValid = Brightics.VA.Core.Utils.InputValidator.isValid;
                if (isValid.startWithSpace(inputString) || isValid.endWithSpace(inputString)) {
                    $control.val(inputString.trim());
                    Brightics.VA.Core.Widget.Factory.createFadeOutMessage($control, {
                        message: 'This input value is trimmed.',
                        position: 'bottom'
                    });
                }
            });

        },
        convertInequalitySign: function (str) {
            if (str) {
                str = str.replace(/<=/g, '\u2264');
                str = str.replace(/>=/g, '\u2265');
                return str;
            }
            return str;
        },
        destroyJqxControl: function ($target) {
            var $jqxElements = $target.find('.jqx-widget');
            $jqxElements.each(function () {
                var elementData = $(this).data();
                if (elementData.jqxWidget) {
                    var jqxWidgetName = elementData.jqxWidget.widgetName;
                    if (typeof $(this)[jqxWidgetName] === 'function') {
                        $(this)[jqxWidgetName]('destroy');
                    }
                }
            });
        }
    };


}).call(this);

/**
 * Created by ng1123.kim on 2016-03-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function AceEditorControl(parentId, options) {
        this.parentId = parentId;
        this.options = this.setOptions(options);


        this.retrieveParent();
        this.createControls();
        this.createEditorCommands();
        this.registerEventListener();
        this.setValue(this.options.value);
        this.navigateFileEnd();
    }

    AceEditorControl.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };


    AceEditorControl.prototype.setOptions = function (options) {
        var defaultOption = {};
        return $.extend(true, defaultOption, options)

    };

    AceEditorControl.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-widget-ace-editor-control"></div>' +
            '');
        this.$parent.append(this.$mainControl);

        this.editor = ace.edit(this.$mainControl[0]);
        if(this.options.mode){
            this.editor.session.setMode('ace/mode/' + this.options.mode);
        }
        this.editor.setTheme('ace/theme/eclipse');

        var editorOptions = {
            enableBasicAutocompletion: true,
            enableSnippets: true,
            enableLiveAutocompletion: true,
            minLines: 10,
            maxLines: 10
        };

        if(this.options.editorOptions){
            $.extend(true, editorOptions, this.options.editorOptions);
        }

        this.editor.setOptions(editorOptions);
        this.editor.setShowPrintMargin(false);
        this.editor.$blockScrolling = Infinity;

        /*this.$mainControl.resizable({
            minHeight: 150,
            handles: 's, se'
        });*/
    };
    AceEditorControl.prototype.getWrapperDiv = function () {
        return this.$mainControl;
    };

    AceEditorControl.prototype.createEditorCommands = function () {
        for (var i in this.options.commands) {
            this.editor.commands.addCommand(this.options.commands[i]);
        }
    };

    AceEditorControl.prototype.registerEventListener = function () {
        for (var i in this.options.events) {
            this.editor.addEventListener(this.options.events[i].name, this.options.events[i].event)
        }
    };

    AceEditorControl.prototype.setValue = function (value) {
        this.editor.setValue(value);
    };

    AceEditorControl.prototype.getValue = function () {
        return this.editor.getValue();
    };

    AceEditorControl.prototype.getEditor = function () {
        return this.editor;
    };


    AceEditorControl.prototype.resize = function () {
        this.editor.resize();
    };

    AceEditorControl.prototype.navigateFileEnd = function () {
        return this.editor.navigateFileEnd();
    };

    AceEditorControl.prototype.getCursorPosition = function () {
        return this.editor.getCursorPosition();
    };

    AceEditorControl.prototype.getSession = function () {
        return this.editor.session;
    };
    AceEditorControl.prototype.insert = function (value) {
        this.editor.insert(value);
    };

    AceEditorControl.prototype.focus = function () {
        this.editor.focus();
    };

    AceEditorControl.prototype.setHeight = function (height) {
        this.$mainControl.css('height', height);
    };

    AceEditorControl.prototype.destroy = function () {
        this.editor.destroy();
        this.$mainControl.remove();
    };

    Brightics.VA.Core.Widget.Controls.AceEditorControl = AceEditorControl;

}).call(this);
/**
 * Created by daewon.park on 2016-02-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     *  options = {
     *  button: {
     *      visible: true,      //default : true
     *      disabled: false,     //default : false
     *      checked: true       //default : true
     *  },
     *  variable :{"$gv2": { "type": "literal", "value": ['a','b','c'], 'variable-type': 'array' } }
     *
     */

    var defaultOptions = {
        button: {
            visible: true,
            disabled: false,
            checked: true,
            on: {label: 'ON', value: 'on'},
            off: {label: 'OFF', value: 'off'}
        }
    };

    function ArgumentControl(parentId, options) {
        this.parentId = parentId;
        this.initOptions(options);
        this.retrieveParent();
        this.createControls();
        this.setInputValue();
    }

    ArgumentControl.prototype.initOptions = function (options) {
        this.options = $.extend(true, {}, defaultOptions, options);

        this.variableKey = Object.keys(this.options.variable)[0];
        this.inputType = this.options.variable[this.variableKey]['type'];
        this.variableType = this.options.variable[this.variableKey]['variable-type'];
        this.variableValue = this.options.variable[this.variableKey]['value'];
    };

    ArgumentControl.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ArgumentControl.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('' +
            '<div class="brtc-va-widget-container">' +
            '   <div class ="brtc-va-widget-remove" />' +
            '   <div class="brtc-va-widget-header">' +
            '       <div class="brtc-va-widget-label">' + this.variableKey + '</div>' +
            '       <div class="brtc-va-widget-type-button-area"><div class="brtc-va-widget-type-switch-button"></div></div>' +
            '   </div>' +
            '   <div class="brtc-va-widget-contents"><div class="brtc-va-widget-contents-input-container-wrapper"></div></div>' +
            '</div>');
        this.$parent.append(this.$mainControl);
        this.$mainControl.find('.brtc-va-widget-label').addClass(this.variableType);
        if (this.options.mandatory) this.$mainControl.find('.brtc-va-widget-label').addClass('mandatory');

        this.createTypeButtonControl();
        this.createContentsArea();

        this.$mainControl.find('.brtc-va-widget-remove').on('click', function () {
            if (typeof _this.options.onRemoveCallback === 'function') {
                _this.options.onRemoveCallback(_this.createFormattedValue());
                _this.$mainControl.remove();
            }
        });

        if (this.variableType === 'calculation') {
            this.$mainControl.find('.brtc-va-widget-type-button-area').hide();
            this.$mainControl.find('.brtc-va-widget-contents-input-control-container').addClass('read-only');
        }
    };

    ArgumentControl.prototype.createTypeButtonControl = function () {
        var _this = this;
        this.$btnArea = this.$mainControl.find('.brtc-va-widget-type-switch-button');
        if (!this.options.button.visible) return;
        var onLabel = this.options.button.on.label,
            onValue = this.options.button.on.value;

        var offLabel, offValue;
        if (this.isArrayValue()) {
            offLabel = 'Variable';
            offValue = 'expression';
        } else {
            offLabel = this.options.button.off.label;
            offValue = this.options.button.off.value;
        }

        this.$btnArea.jqxSwitchButton({
            height: '100%',
            width: '100px',
            thumbSize: '15%',
            onLabel: onLabel,
            offLabel: offLabel,
            checked: this.setSwitchButtonChecked()
        });

        this.inputType = this.$btnArea.val() ? onValue : offValue;

        this.$btnArea.on('change', function (event) {
            _this.variableValue = _this.getInputValue();
            _this.inputType = _this.$btnArea.val() ? onValue : offValue;
            _this.$contentsArea.empty();
            _this.createContentsArea();
            _this.setInputValue();
            _this.triggerChangeInputValue(true);
        });
    };

    ArgumentControl.prototype.setSwitchButtonChecked = function () {
        var buttonChecked, onValue = this.options.button.on.value;
        var offValue;
        if (this.isArrayValue()) offValue = 'expression';
        else offValue = this.options.button.off.value;

        if (this.inputType === onValue) {
            buttonChecked = true;
        } else if (this.inputType === offValue) {
            buttonChecked = false
        } else {
            this.inputType = this.options.button.checked ? onValue : offValue;
            buttonChecked = this.options.button.checked;
        }
        return buttonChecked;
    };

    ArgumentControl.prototype.isArrayValue = function () {
        return this.variableType === 'array' && this.options.button.visible;
    };

    ArgumentControl.prototype.createContentsArea = function () {
        this.$contentsArea = this.$mainControl.find('.brtc-va-widget-contents-input-container-wrapper');
        if (this.isArrayValue()) {
            if (this.inputType !== 'expression') this.createArrayInputControl();
            else {
                this.$contentsArea.append($('' +
                    '<div class="brtc-va-widget-contents-input-container">' +
                    '   <div class="brtc-va-widget-contents-input-control-container"></div>' +
                    '</div>'));
                this.createCodeInputControl(this.$contentsArea.find('.brtc-va-widget-contents-input-control-container'));
            }
        } else {
            this.createSingleInputControl();
        }
    };

    ArgumentControl.prototype.createArrayInputControl = function () {
        if (this.variableValue.length === 0) {
            this.createInputControlLayout(0, this.isArrayValue());
        } else {
            if (this.variableValue instanceof Array) {
                for (var i = 0; i < this.variableValue.length; i++) {
                    this.createInputControlLayout(i, this.isArrayValue());
                }
            } else {
                this.createInputControlLayout(0, this.isArrayValue());
            }
        }
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar();
    };

    ArgumentControl.prototype.createSingleInputControl = function () {
        this.createInputControlLayout(0, false);
    };

    ArgumentControl.prototype.createInputControlLayout = function (inputIndex, addable, focus) {
        var $parents = this.$contentsArea;
        var _this = this;
        var deletable = false;
        var $inputContainer = $('<div class="brtc-va-widget-contents-input-container"></div>');

        var $children = $parents.find('.brtc-va-widget-contents-input-container');

        if ($children.length === 0 || !$children[inputIndex]) {
            $parents.append($inputContainer);
        } else {
            $($children[inputIndex]).after($inputContainer);
            deletable = true;
        }

        var $inputDiv = $('<div class="brtc-va-widget-contents-input-control-container"></div>');
        var $addDiv, $deleteDiv;

        $inputContainer.append($inputDiv);

        if (inputIndex > 0 || deletable) {
            $deleteDiv = $('<div class="brtc-va-widget-contents-input-control-delete"></div>');
            $inputContainer.append($deleteDiv);

            $deleteDiv.click(function (event) {
                _this.handleDeleteButtonClick($(this).closest('.brtc-va-widget-contents-input-container'));
            })
        }

        if (addable) {
            $addDiv = $('<div class="brtc-va-widget-contents-input-control-add"></div>');
            $inputContainer.append($addDiv);

            $addDiv.click(function (event) {
                _this.handleAddInputControlEvent($(this).closest('.brtc-va-widget-contents-input-container'));
            })
        }

        if (this.isArrayValue())this.createInputControl($inputDiv, focus);
        else this.createCodeInputControl($inputDiv, focus);
    };

    ArgumentControl.prototype.createInputControl = function ($parent, focus) {
        var _this = this;
        var $inputControl = $('<input type="text" class="brtc-va-widget-contents-input-control"/>');
        $parent.append($inputControl);
        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%',
            placeHolder: 'Enter value'
        };
        $inputControl.jqxInput(options);
        if (focus) $inputControl.jqxInput('focus');

        $inputControl.keydown(function (key) {
            if (key.keyCode == 13) {
                if (_this.isArrayValue()) {
                    _this.handleAddInputControlEvent($inputControl.closest('.brtc-va-widget-contents-input-container'), true);
                }
            }
        });
        $inputControl.focusout(function (event) {
            _this.triggerChangeInputValue();
        });
    };

    ArgumentControl.prototype.createCodeInputControl = function ($parent, focus) {
        var _this = this;
        var $inputControl = $('<textarea  class="brtc-va-widget-contents-input-control"/>');
        $parent.append($inputControl);
        var controlOptions = {
            mode: 'brtc-control',
            scrollbarStyle: 'null',
            placeholder: !this.options.button.visible ? 'Enter variable\tex. ${Variable1}' : this.inputType == 'calculation' ? 'Enter expression\tex. ${Variable1}+${Variable2}' : 'Enter value\tex. 1',
            lineWrapping: false,
            matchBrackets: false,
            extraKeys: {
                'Ctrl-Space': 'autocomplete',
                "Tab": false, // Let focus go to next control
                "Shift-Tab": false // Let focus go to previous control
            },
            showTrailingSpace: true,
            hintOptions: {
                list: []
            },
            readOnly: this.variableType === 'calculation'
        };

        this.codeMirror = CodeMirror.fromTextArea($inputControl[0], controlOptions);
        var additionalOption = {
            'valid-message-position': this.options['valid-message-position'],
            'valid-type': this.options.button.visible ? ((this.isArrayValue && this.inputType === 'expression') ? 'type3' : '') : 'type3'
        };
        Brightics.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.codeMirror, additionalOption);
        this.codeMirror.on('blur', function (instance, event) {
            _this.triggerChangeInputValue();
        });
    };

    ArgumentControl.prototype.handleAddInputControlEvent = function ($target, focus) {
        var index = $target.index();
        this.createInputControlLayout(index, true, focus);
        this.triggerChangeInputValue();
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar('update');
        var parents = this.$mainControl.parents('.ps-container');
        if (parents && parents.length) parents.perfectScrollbar('update');
    };

    ArgumentControl.prototype.handleDeleteButtonClick = function ($target) {
        $target.remove();
        this.triggerChangeInputValue();
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar('update');
        var parents = this.$mainControl.parents('.ps-container');
        if (parents && parents.length) parents.perfectScrollbar('update');
    };

    ArgumentControl.prototype.triggerChangeInputValue = function (forced) {
        if (typeof this.options.onChangeCallback === 'function') {
            var _this = this;
            var value = _this.getInputValue();
            if (JSON.stringify(value) !== JSON.stringify(_this.variableValue) || forced) {
                _this.variableValue = value;
                _this.options.onChangeCallback(_this.createFormattedValue());
            }
        }
    };

    ArgumentControl.prototype.createFormattedValue = function () {
        return {
            'key': this.variableKey,
            'type': this.inputType,
            'variable-type': this.variableType,
            "value": this.variableValue
        };
    };

    ArgumentControl.prototype.getFormattedValue = function () {
        return {
            'key': this.variableKey,
            'type': this.inputType,
            'variable-type': this.variableType,
            "value": this.getInputValue()
        };
    };

    ArgumentControl.prototype.getInputValue = function () {
        var inputValue;
        var controls = this.$contentsArea.find('.brtc-va-widget-contents-input-control');

        if (this.isArrayValue() && this.inputType !== 'expression') {
            inputValue = [];
            for (var i = 0; i < controls.length; i++) {
                inputValue.push($(controls[i]).val());
            }
        } else {
            inputValue = this.codeMirror.getValue();
        }
        return inputValue;
    };

    ArgumentControl.prototype.setVariableType = function (variableType) {
        this.variableType = variableType;
        this.$contentsArea.empty();
        this.createContentsArea();
    };

    ArgumentControl.prototype.setInputValue = function (value) {
        if (typeof value !== 'undefined') this.variableValue = value;

        var controls = this.$contentsArea.find('.brtc-va-widget-contents-input-control');
        if (this.isArrayValue() && this.inputType !== 'expression') {
            if (!Array.isArray(this.variableValue)) {
                $(controls[0]).val(this.variableValue || '');
            } else {
                var i;
                if (controls.length > this.variableValue.length) {
                    for (i = 0; i < controls.length; i++) {
                        if (this.variableValue[i] === undefined) {
                            $(controls[i]).parents('.brtc-va-widget-contents-input-container').remove();
                        } else {
                            $(controls[i]).val(this.variableValue[i] || '');
                        }
                    }
                } else {
                    for (i = controls.length; i < this.variableValue.length; i++) {
                        this.createInputControlLayout(i, true);
                    }
                    controls = this.$contentsArea.find('.brtc-va-widget-contents-input-control');
                    for (i = 0; i < controls.length; i++) {
                        $(controls[i]).val(this.variableValue[i] || '');
                    }
                }
            }
        } else {
            if (Array.isArray(this.variableValue)) {
                this.codeMirror.setValue(this.variableValue[0]);
            } else {
                this.codeMirror.setValue(this.variableValue);
            }
        }
    };

    ArgumentControl.prototype.setRemovable = function (removable) {
        this.options.removable = removable;

        if (removable) this.$mainControl.find('.brtc-va-widget-remove').addClass('removable');
        else this.$mainControl.find('.brtc-va-widget-remove').removeClass('removable');
    };


    ArgumentControl.prototype.getOptions = function () {
        return this.options;
    };

    root.Brightics.VA.Core.Widget.Controls.ArgumentControl = ArgumentControl;

}).call(this);
/**
 * Created by daewon.park on 2016-02-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    /**
     *  options = {
     *  type: 'number' or 'string'
     *
     */
    function ArrayInputControl(parentId, options) {
        this.parentId = parentId;
        this.initOptions(options);
        this.retrieveParent();
        this.createControls();
    }

    ArrayInputControl.prototype.initOptions = function (options) {
        this.options = options;
        this._isNumberType = this.options.type === 'number' ? true : false;
    };

    ArrayInputControl.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ArrayInputControl.prototype.createControls = function () {
        this.$mainControl = $('' +
            '<div class="brtc-va-widget-container">' +
            '   <div class="brtc-va-widget-contents"><div class="brtc-va-widget-contents-input-container-wrapper"></div></div>' +
            '</div>');
        this.$parent.append(this.$mainControl);

        this.$contentsArea = this.$mainControl.find('.brtc-va-widget-contents-input-container-wrapper');
        this.createArrayInputControl(this.$contentsArea);
    };


    ArrayInputControl.prototype.createArrayInputControl = function () {
        this.createInputControlLayout(0);
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar();
    };

    ArrayInputControl.prototype.createInputControlLayout = function (inputIndex) {
        var $parents = this.$contentsArea;
        var _this = this;
        var deletable = false;
        var $inputContainer = $('<div class="brtc-va-widget-contents-input-container"></div>');

        var $children = $parents.find('.brtc-va-widget-contents-input-container');

        if ($children.length === 0 || !$children[inputIndex]) {
            $parents.append($inputContainer);
        } else {
            $($children[inputIndex]).after($inputContainer);
            deletable = true;
        }

        var $inputDiv = $('<div class="brtc-va-widget-contents-input-control-container"></div>');
        var $addDiv, $deleteDiv;

        $inputContainer.append($inputDiv);

        if (inputIndex > 0 || deletable) {
            $deleteDiv = $('<div class="brtc-va-widget-contents-input-control-delete"></div>');
            $inputContainer.append($deleteDiv);

            $deleteDiv.click(function (event) {
                _this.handleDeleteButtonClick($(this).closest('.brtc-va-widget-contents-input-container'));
            })
        }

        $addDiv = $('<div class="brtc-va-widget-contents-input-control-add"></div>');
        $inputContainer.append($addDiv);

        $addDiv.click(function (event) {
            _this.handleAddInputControlEvent($(this).closest('.brtc-va-widget-contents-input-container'));
        });

        if (this._isNumberType) {
            this.createNumericInputControl($inputDiv);
        } else {
            this.createInputControl($inputDiv);
        }
    };

    ArrayInputControl.prototype.createNumericInputControl = function ($parent) {
        var _this = this;
        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%',
            numberType: 'double',
            placeHolder: 'Enter value',
            className: ['brtc-va-widget-contents-array-input-control']
        };
        var input = new Brightics.VA.Core.Widget.Controls.NumericInput($parent, options);
        input.onChange(function () {
            _this.triggerChangeInputValue();
        });
    };

    ArrayInputControl.prototype.createInputControl = function ($parent) {
        var _this = this;
        var $inputControl = $('<input type="text" class="brtc-va-widget-contents-array-input-control"/>');
        $parent.append($inputControl);
        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%',
            placeHolder: 'Enter value'
        };
        $inputControl.jqxInput(options);

        $inputControl.focusout(function (event) {
            _this.triggerChangeInputValue();
        });
    };


    ArrayInputControl.prototype.handleAddInputControlEvent = function ($target) {
        var index = $target.index();
        this.createInputControlLayout(index);
        this.triggerChangeInputValue();
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar('update');
        var parents = this.$mainControl.parents('.ps-container');
        if (parents && parents.length) parents.perfectScrollbar('update');
    };

    ArrayInputControl.prototype.handleDeleteButtonClick = function ($target) {
        $target.remove();
        this.triggerChangeInputValue();
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar('update');
        var parents = this.$mainControl.parents('.ps-container');
        if (parents && parents.length) parents.perfectScrollbar('update');
    };

    ArrayInputControl.prototype.triggerChangeInputValue = function (forced) {
        if (typeof this.options.onChangeCallback === 'function') {
            var _this = this;
            var value = _this.getInputValue();
            if (JSON.stringify(value) !== JSON.stringify(_this._preValue) || forced) {
                _this.options.onChangeCallback(value);
                _this._preValue = value;
            }
        }
    };


    ArrayInputControl.prototype.getInputValue = function () {
        var inputValue;
        var controls = this.$contentsArea.find('.brtc-va-widget-contents-array-input-control');

        inputValue = [];
        inputValue.length = controls.length;
        for (var i = 0; i < controls.length; i++) {
            var x = this.getValueByType($(controls[i]).val());
            inputValue[i] = x;
        }
        return inputValue;
    };

    ArrayInputControl.prototype.setValue = function (values) {
        this._preValue = values;
        var controls = this.$contentsArea.find('.brtc-va-widget-contents-array-input-control');
        var i;
        if (controls.length > values.length) {
            for (i = 0; i < controls.length; i++) {
                if (typeof values[i] !== 'undefined') {
                    $(controls[i]).val(this.getValueByType(values[i]));
                }
                if (i >= values.length && values.length !== 0) {
                    $(controls[i]).closest('.brtc-va-widget-contents-input-container').remove();
                }
            }
        } else {
            for (i = controls.length; i < values.length; i++) {
                this.createInputControlLayout(i, true);
            }
            controls = this.$contentsArea.find('.brtc-va-widget-contents-array-input-control');
            for (i = 0; i < controls.length; i++) {
                $(controls[i]).val(this.getValueByType(values[i]));
            }
        }
    };

    ArrayInputControl.prototype.toString = function (val) {
        if (_.isNull(val) || _.isUndefined(val) || val === '') return '';
        if (_.isNumber(val)) {
            if (_.isNaN(val) || _.isUndefined(val)) return '';
            return val.toString();
        }
        return val;
    };

    ArrayInputControl.prototype.toNumber = function (val) {
        if (_.isNull(val) || _.isUndefined(val) || val === '') return null;
        return Number(this.toString(Number(val)));
    };

    ArrayInputControl.prototype.getValueByType = function (val) {
        if (this._isNumberType) return this.toNumber(val);
        return this.toString(val);
    };

    root.Brightics.VA.Core.Widget.Controls.ArrayInputControl = ArrayInputControl;
}).call(this);

/**
 * Created by ng1123.kim on 2016-11-24.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function FadeOutMessage($parent, options) {
        this.$parent = $parent;
        this.options = options;

        var offset = this.getParentOffset();
        var size = this.getParentSize();

        this.removePreMessageBox();
        this.createMessageBox(offset, size);
        this.notifyMessage();
    }

    FadeOutMessage.prototype.getParentOffset = function () {
        return this.$parent.offset();
    };
    FadeOutMessage.prototype.getParentSize = function () {
        return {
            width: this.$parent.width(),
            height: this.$parent.height()
        };
    };

    FadeOutMessage.prototype.removePreMessageBox = function () {
        var preMessageBox = $('body').children('.brtc-va-widget-messagebox-container');
        if (preMessageBox.length > 0) {
            preMessageBox.remove();
        }
    };

    FadeOutMessage.prototype.removeMessageBoxTimeout = function () {
        var _this = this;

        setTimeout(function () {
            var messageBox = $('body').children('.brtc-va-widget-messagebox-container');
            var massages = messageBox.find('div');
            if (massages.length > 0) {
                _this.removeMessageBoxTimeout();
            } else {
                messageBox.remove();
            }
        }, 1000);

    };


    FadeOutMessage.prototype.createMessageBox = function (offset, size) {
        this.$messageBox = $('<div class="brtc-va-widget-messagebox-container"></div>');
        $('body').append(this.$messageBox);
        this.messageBoxWidth = this.$messageBox.width();

        /*var offset = this.getMessageBoxOffset(offset, size);

        this.$messageBox.css({
            'top': offset.top,
            'left': offset.left
        });*/


        this.removeMessageBoxTimeout();
    };

    FadeOutMessage.prototype.getMessageBoxOffset = function (offset, size) {
        var messageBoxOffset = {}, position = this.options.position;
        if (position === 'bottom') {
            messageBoxOffset = {
                'top': offset.top + size.height + 10,
                'left': offset.left
            };
        } else if (position === 'left') {
            messageBoxOffset = {
                'top': offset.top,
                'left': offset.left - this.messageBoxWidth - 10
            };
        } else {
            messageBoxOffset = {
                'top': offset.top,
                'left': offset.left + size.width + 10
            };
        }
        return messageBoxOffset;
    };


    FadeOutMessage.prototype.notifyMessage = function () {
        var $message = $('<div>' + this.options.message + '</div>');
        $message.jqxNotification({
            width: "100%",
            appendContainer: this.$messageBox,
            opacity: 0.9,
            autoClose: true,
            autoOpen: true,
            template: "info",
            theme: 'office'
        });
    };

    Brightics.VA.Core.Widget.Controls.FadeOutMessage = FadeOutMessage;

}).call(this);
/**
 * Created by ty0314.kim on 2016-01-27.
 */

(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function FileList(parentId, options) {
        this.parentId = parentId;

        this.defaultOptions = {
            multiple: true,
            fileType: ['json']
        };

        this.options = $.extend(true, this.defaultOptions, options);
        this.files = {};

        this.retrieveParent();
        this.createControls();
    }

    FileList.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    FileList.prototype.createControls = function () {
        var _this = this;

        this.$mainControl = $('' +
            '<div class="brtc-va-widget-controls-fileList">' +
            '   <div class="brtc-va-widget-controls-fileList-toolbar"></div>' +
            '   <div class="brtc-va-widget-controls-fileList-list-wrapper">' +
            '       <div class="brtc-va-widget-controls-fileList-list"></div>' +
            '   </div>' +
            '</div>' +
            '');

        this.$toolbarArea = this.$mainControl.find('.brtc-va-widget-controls-fileList-toolbar');
        this.$listArea = this.$mainControl.find('.brtc-va-widget-controls-fileList-list');
        this.$mainControl.find('.brtc-va-widget-controls-fileList-list-wrapper').perfectScrollbar();

        this.$parent.append(this.$mainControl);

        this.renderToolbarArea(this.$toolbarArea);
        this.renderListArea(this.$listArea);
    };

    FileList.prototype.renderToolbarArea = function ($parent) {
        this.createSumArea($parent);
        this.createDeleteFileButton($parent);
        this.createSelectFileButton($parent);
    };

    FileList.prototype.renderListArea = function ($parent) {
        var _this = this;
        $parent.append($('<div class="brtc-va-dialogs-publish-management-grid"></div>'));

        var source = {
            localdata: [],
            datafields: [
                {name: 'name', type: 'string'},
                {name: 'size', type: 'string'},
                {name: 'lastModifiedDate', type: 'date'},
                {name: 'lastModified', type: 'timestamp'},
                {name: 'type', type: 'string'},
                {name: 'webkitRelativePath', type: 'string'},
                {name: 'fileKey', type: 'string'}
            ],
            datatype: "json"
        };

        var adapter = new $.jqx.dataAdapter(source);

        this.$fileListGrid = $parent.find('.brtc-va-dialogs-publish-management-grid').jqxGrid({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 'calc(100% - 45px)',
            altrows: false,
            filterable: false,
            source: adapter,
            sortable: false,
            columnsresize: true,
            selectionmode: 'checkbox',
            showfiltercolumnbackground: false,
            rowsheight: 53,
            columns: [
                {
                    text: 'Name',
                    datafield: 'name',
                    align: 'center',
                    cellclassname: 'brtc-grid-cell',
                    cellsrenderer: _this.renderer,
                    renderer: _this.gridV2Renderer,
                    width: '50%'
                },
                {
                    text: 'Size',
                    datafield: 'size',
                    align: 'center',
                    cellclassname: 'brtc-grid-cell',
                    cellsrenderer: _this.fileSizeRenderer,
                    renderer: _this.gridV2Renderer,
                    width: 80
                },
                {
                    text: 'Last Modified Date',
                    datafield: 'lastModifiedDate',
                    align: 'center',
                    cellclassname: 'brtc-grid-cell',
                    renderer: _this.gridV2Renderer,
                    cellsalign: 'center',
                    cellsformat: 'yyyy-MM-dd h:mm:ss'
                },
                {
                    text: 'fileKey',
                    datafield: 'fileKey',
                    hidden: true
                },
                {
                    text: 'lastModified',
                    datafield: 'lastModified',
                    hidden: true
                },
                {
                    text: 'type',
                    datafield: 'type',
                    hidden: true
                },
                {
                    text: 'webkitRelativePath',
                    datafield: 'webkitRelativePath',
                    hidden: true
                }
            ]
        });

        this.setGridStyleV2(this.$fileListGrid);

        var selectCallback = function () {
            var selectedIndexes = _this.$fileListGrid.jqxGrid('getselectedrowindexes');
            if (selectedIndexes.length > 0) {
                _this.$deleteButton.jqxButton({disabled: false});
                _this.$deleteButton.css('cursor', 'pointer');
            } else {
                _this.$deleteButton.jqxButton({disabled: true});
                _this.$deleteButton.css('cursor', 'default');
            }
        };

        this.$fileListGrid.on('rowselect', selectCallback.bind(_this));
        this.$fileListGrid.on('rowunselect', selectCallback.bind(_this));
    };

    FileList.prototype.fileSizeRenderer = function (row, column, value) {
        var styleText = '' +
            'float: right;' +
            'height:53px;' +
            'line-height:53px;' +
            'text-overflow: ellipsis;' +
            'white-space: nowrap;' +
            'overflow: hidden;' +
            'width: calc(100% - 15px); ';

        var size = '1.00 KB';
        if (value > 1024) size = Brightics.VA.Core.Utils.CommonUtils.byteCalculation(value);

        return '<div index="'+ row +'" style="'+ styleText +'">'+ size +'</div>';
    };

    FileList.prototype.renderer = function (row, column, value, tag, options, rowData) {
        var _this = this;

        var titleText = '';
        var styleText = '' +
            'float: left;' +
            'margin-left: 15px;' +
            'height:53px;' +
            'line-height:53px;' +
            'text-overflow: ellipsis;' +
            'white-space: nowrap;' +
            'overflow: hidden;' +
            'width: calc(100% - 15px); ';

        if (rowData.errorMessage)  {
            styleText += 'color:red;';
            titleText = rowData.errorMessage;
        } else {
            titleText = value;
        }

        return '<div title="'+ titleText +'" fileKey="'+ rowData.fileKey +'" index="'+ row +'" style="'+ styleText +'">'+ value +'</div>';
    };

    FileList.prototype.gridV2Renderer = function (value) {
        return '<div style="opacity:0.8; font-family: Arial; font-size: 16px; font-weight: bold; text-align: center; color: rgba(0, 0, 0, 0.8);">' + value + '</div>';
    };

    FileList.prototype.setGridStyleV2 = function ($grid) {
        $grid.addClass('GridStyleV2');

        $grid.css({
            'height': 'calc(100% - 35px) !important',
            'margin-top': '15px !important',
            'margin-bottom': '20px !important'
        });

        this.$mainControl.find('input[type=button]').width(100);
    };

    FileList.prototype.createSumArea = function ($parent) {
        this.$sumArea = $('' +
            '<div class="brtc-va-widget-controls-fileList-toolbar-sum">' +
            '   <span>Total<strong class="brtc-va-widget-controls-fileList-toolbar-sum-count">0</strong></span>' +
            '</div>');
        $parent.append(this.$sumArea);
    };

    FileList.prototype.createSelectFileButton = function ($parent) {
        var _this = this;

        var $selectFileButtonWrapper = $('' +
            '<div class="brtc-va-widget-controls-fileList-toolbar-selectfile">' +
            '   <input for="brtc-va-widget-controls-fileList-toolbar-selectfile-button" type="button" id="fileselect-local" value="Select File" />' +
            '   <input type="file" id="brtc-va-widget-controls-fileList-toolbar-selectfile-file" name="fileToUpload" accept=".json">' +
            '</div>');

        $parent.append($selectFileButtonWrapper);

        var $btnLocal = $selectFileButtonWrapper.find('#fileselect-local');
        var $fileSelect = $selectFileButtonWrapper.find('#brtc-va-widget-controls-fileList-toolbar-selectfile-file');

        if (this.options.multiple) $fileSelect.attr('multiple', true);
        $fileSelect.hide();

        $btnLocal.jqxButton({
            theme: Brightics.VA.Env.Theme
        });

        $btnLocal.on('click', function () {
            $fileSelect.click();
        });

        $fileSelect.on('input', function (event) {
            var files = $(this)[0].files;

            if (_this.isJsonFile(files)) {
                var keyFiles = _this.addFileKey(files);
                var omitted = _this.renderFiles(keyFiles);
                _this.$parent.trigger('addFile', [keyFiles, omitted]);
            } else {
                Brightics.VA.Core.Utils.WidgetUtils.openErrorDialog('.json file can be imported only');
            }
            $fileSelect.val(null);
        });
    };

    FileList.prototype.setTotalCount = function () {
        this.$sumArea.find('.brtc-va-widget-controls-fileList-toolbar-sum-count').text(this.$fileListGrid.jqxGrid('getRows').length);
    };

    FileList.prototype.addFileKey = function (files) {
        var newFiles = {};

        for (var i=0; i<files.length; i++) {
            var fileKey = Brightics.VA.Core.Utils.IDGenerator.importedFile.id();
            newFiles[fileKey] = files[i];
        }
        return newFiles;
    };

    FileList.prototype.createDeleteFileButton = function ($parent) {
        var _this = this;

        var $deleteFileButtonWrapper = $('' +
            '<div class="brtc-va-widget-controls-fileList-toolbar-deletefile">' +
            '   <input class="brtc-va-widget-controls-fileList-toolbar-deletefile-button" type="button" value="Delete File" />' +
            '</div>');

        $parent.append($deleteFileButtonWrapper);

        this.$deleteButton = $deleteFileButtonWrapper.find('.brtc-va-widget-controls-fileList-toolbar-deletefile-button');

        this.$deleteButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            disabled: true
        });

        this.$deleteButton.on('click', function () {
            var removedFileKeys = [];

            var selectedIndexes = _this.$fileListGrid.jqxGrid('getselectedrowindexes').sort(function (a, b) {
                return a - b;
            });
            
            for (var i=selectedIndexes.length-1; i>=0; i--) {
                var data = _this.$fileListGrid.jqxGrid('getrowdata', selectedIndexes[i]);

                removedFileKeys.push(data.fileKey);
                delete _this.files[data.fileKey];

                var id = _this.$fileListGrid.jqxGrid('getrowid', selectedIndexes[i]);
                _this.$fileListGrid.jqxGrid('deleterow', id);

            }
            _this.$parent.trigger('removeFile', [removedFileKeys]);

            _this.setTotalCount();

            _this.$deleteButton.jqxButton({disabled: true});
        });
    };

    FileList.prototype.makeGridSource = function (fileKey, file) {
        var gridSources = [];

        var addedFile = $.extend(true, {}, file);

        addedFile.fileKey = fileKey;
        this.files[fileKey] = addedFile;
        gridSources.push(addedFile);

        return gridSources;
    };

    FileList.prototype.equal = function (file1, file2) {
        return file1.name === file2.name &&
            file1.size === file2.size &&
            file1.lastModified === file2.lastModified;
    };

    FileList.prototype.renderFiles = function (files) {
        var omitted = {};
        for (var key in files) {
            var duplicated = false;
            for (var f in this.files) {
                if (this.equal(this.files[f], files[key])) {
                    omitted[key] = true;
                    duplicated = true;
                    break;
                }
            }
            if (!duplicated) {
                this.$fileListGrid.jqxGrid('addrow', null, this.makeGridSource(key, files[key]));
            }
        }

        this.setTotalCount();
        return omitted;
    };

    FileList.prototype.isJsonFile = function (files) {
        for (var i=0; i<files.length; i++) {
            var fileNameArr = files[i].name.split('.');
            if (this.options.fileType.indexOf(fileNameArr[fileNameArr.length - 1]) < 0) {
                return false;
            }
        }
        return true;
    };

    FileList.prototype.getFiles = function () {
        return this.files;
    };

    FileList.prototype.setDisableFile = function (key, message) {
        var rowId = -1;
        var rows = this.$fileListGrid.jqxGrid('getRows');
        var newRow;

        for (var i in rows) {
            if (rows[i].fileKey === key) {
                rowId = i;
                newRow = rows[i];
                newRow.errorMessage = message;
                break;
            }
        }

        this.$fileListGrid.jqxGrid('updaterow', rowId, newRow);
    };

    Brightics.VA.Core.Widget.Controls.FileList = FileList;

}).call(this);

/**
 * Created by ty0314.kim on 2016-01-27.
 */

(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function ItemList(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.options.selectedItems = [];
        this.options.selectedIndexes = [];
        this.options.changedItems = {};
        this.options.items = [];
        this.eventListeners = {};
        this.sortOptions = {};


        this._initEventListeners();
        this.retrieveParent();
        this.createControls();
        this._setSortFunction();
    }

    ItemList.prototype._setSortFunction = function () {
        var _this = this;

        this.compareFunctionGenerator = function (comp, getter) {
            getter = getter || (function (x) {
                return x;
            });
            return function (a, b) {
                return comp(getter(a), getter(b));
            };
        };

        var comp = function (a, b) {
            return String(a).localeCompare(String(b));
        };

        var getter = (function (that) {
            return function (x) {
                return that.options.items[x].item;
            }
        }(this));

        this.sortOptions = {
            comp: comp,
            getter: getter,
            sortOnIndex: _this.compareFunctionGenerator(comp, getter),
            sortOnValue: _this.compareFunctionGenerator(comp)
        };
    };

    ItemList.prototype._initEventListeners = function () {
        this.eventListeners = {
            'selectAll': this._handleSelectAll.bind(this),
            'unselectAll': this._handleUnselectAll.bind(this),
            'select': this._handleSelect.bind(this),
            'unselect': this._handleUnselect.bind(this),
            'close': this._handleClose.bind(this)
        };
    };

    ItemList.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ItemList.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('' +
            '<div class="brtc-va-widget-controls-itemlist">' +
            '   <div class="brtc-va-widget-controls-itemlist-selectbutton-wrapper">' +
            '       <span class="brtc-va-widget-controls-itemlist-selectcounter counter">0</span>' +
            '       <span class="brtc-va-widget-controls-itemlist-selectcounter">items selected</span>' +
            '       <button class="brtc-va-widget-controls-itemlist-clearbutton">Clear</button>' +
            '       <button class="brtc-va-widget-controls-itemlist-selectbutton">Select</button>' +
            '   </div>' +
            '   <div class="brtc-va-widget-controls-itemlist-control" />' +
            '');
        this.$parent.append(this.$mainControl);

        this.$selectButton = this.$mainControl.find('.brtc-va-widget-controls-itemlist-selectbutton');
        this.$selectButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            height: 25
        });

        this.$selectButton.on('click', function () {
            _this.openItemSelector();
        });

        this.$clearButton = this.$mainControl.find('.brtc-va-widget-controls-itemlist-clearbutton');
        this.$clearButton.jqxButton({
            theme: Brightics.VA.Env.Theme,
            height: 25
        });

        this.$clearButton.on('click', function () {
            _this.clearSelectedItems();
        });

        this.$itemControl = this.$mainControl.find('.brtc-va-widget-controls-itemlist-control');
        this.createItemListControl(this.$itemControl);
        this.createItemSelector();
    };

    ItemList.prototype.createItemListControl = function ($parent) {
        var _this = this;

        var rendergridrows = function (params) {
            var data = {};
            for (var i = params.startindex; i < params.endindex && i < _this.options.selectedItems.length; ++i) {
                data[i] = {item: _this.options.selectedItems[i]};
            }
            return data;
        };

        var columnrenderer = function (row, column, cellvalue) {
            if (row < _this.options.selectedItems.length) {
                return '' +
                    '<div class="brtc-va-widget-controls-itemselector-itemcontainer-element" row-index="' + row + '">' +
                    // '   <span class="brtc-va-widget-controls-itemselector-itemcontainer-element-type"></span>' +
                    '   <span class="brtc-va-widget-controls-itemselector-itemcontainer-element-name" title="' + cellvalue + '">' + cellvalue + '</span>' +
                    '   <span class="brtc-va-widget-controls-itemselector-itemcontainer-element-remove"></span>' +
                    '</div>';
            }
        };

        var source = {
            localdata: this.options.selectedItems,
            datatype: "array",
            beforeprocessing: function () {
                source.totalrecords = _this.options.selectedItems.length;
            }
        };

        var dataAdapter = new $.jqx.dataAdapter(source);

        $($parent).jqxGrid({
            width: _this.options.width || '100%',
            theme: Brightics.VA.Env.Theme,
            height: _this.options.height || 120,
            virtualmode: true,
            pageable: false,
            source: dataAdapter,
            rendergridrows: rendergridrows,
            selectionmode: 'none',
            showheader: false,
            rowsheight: 20,
            columns: [{
                text: 'Item',
                datafield: 'item',
                cellsrenderer: columnrenderer,
                width: '100%',
                cellsalign: 'left'
            }]
        });

        $($parent).jqxGrid('localizestrings', {
            emptydatastring: ' '
        });
    };

    ItemList.prototype.createItemSelector = function () {
        var _this = this;
        this.options.multiple = true;
        this.options.fromModal = true;
        this.itemSelector = new Brightics.VA.Core.Widget.Controls.ItemSelector(this.$mainControl, {
            multiple: _this.options.multiple,
            fromModal: _this.options.fromModal,
            limit: _this.options.limit,
            showDesc: _this.options.showDesc,
            changed: function (event, data) {
                if (_this.eventListeners[event] && typeof _this.eventListeners[event] === 'function') {
                    _this.eventListeners[event](data);
                }
            }
        });
    };

    ItemList.prototype._getUniqueItems = function (items, key) {
        var checked = {};
        var arr = [];
        for (var i = 0; i < items.length; ++i) {
            var item = typeof key === 'undefined' ? items[i] : items[i][key];
            if (typeof checked[item] === 'undefined') {
                checked[item] = true;
                arr.push(items[i]);
            }
        }
        return arr;
    };

    ItemList.prototype.setItems = function (items) {
        //get unique elements
        this.options.items = this._getUniqueItems(items, 'item');
        this.itemSelector.setSortOptions(this.sortOptions);
        this.itemSelector.setSource(this.options.items);
    };

    ItemList.prototype.setSelectedItems = function (items) {
        var uniqueItems = this._getUniqueItems(items || []);
        this.options.selectedItems = $.extend(true, [], uniqueItems);
        this.options.selectedItems.sort(this.compareFunctionGenerator(this.sortOptions.comp, function (x) {
            return x.item;
        }));
        this.options.selectedIndexes = this.itemSelector.calcSelectedIndexes(this.options.selectedItems);
        this.refreshControl();
    };

    ItemList.prototype.getSelectedItems = function () {
        return this.options.selectedItems;
    };

    ItemList.prototype.refreshControl = function () {
        var _this = this;
        this.$itemControl.jqxGrid('updatebounddata');

        this.$mainControl.find('.brtc-va-widget-controls-itemlist-selectcounter.counter').text(this.options.selectedItems.length);
        this.$itemControl.find('.jqx-grid-cell').mouseover(function (event) {
            $(this).find('.brtc-va-widget-controls-itemselector-itemcontainer-element-remove').show();
            var clickHandler = function () {
                var index = $(this).closest('.brtc-va-widget-controls-itemselector-itemcontainer-element').attr('row-index');
                _this.removeItem(index);
                _this.refreshControl();
            };
            $(this).find('.brtc-va-widget-controls-itemselector-itemcontainer-element-remove').unbind('click');
            $(this).find('.brtc-va-widget-controls-itemselector-itemcontainer-element-remove').bind('click', clickHandler);
        });
        this.$itemControl.find('.jqx-grid-cell').mouseout(function (event) {
            $(this).find('.brtc-va-widget-controls-itemselector-itemcontainer-element-remove').hide();
        });
    };

    ItemList.prototype.clearSelectedItems = function () {
        this.itemSelector.clearSelectedItems();
        this.setSelectedItems([]);
        this.options.changed('clear', {items: []});
    };

    ItemList.prototype.removeItem = function (index) {
        var unSelectItemName = this.options.selectedItems[index];
        var idx = this.options.selectedIndexes[index];
        this.options.selectedItems.splice(index, 1);
        this.options.selectedIndexes.splice(index, 1);
        this.itemSelector.unselectRow(idx);
        this.options.changed('removed', {
            added: [],
            removed: [unSelectItemName],
            items: this.options.selectedItems
        });
    };

    ItemList.prototype.openItemSelector = function () {
        /*var position = this.getSelectorPosition();*/
        this.itemSelector.open(this.$clearButton, this.options.selectedItems, this.options.selectedIndexes);
    };

    ItemList.prototype.getSelectorPosition = function () {
        var position = {
            left: 0,
            top: 0
        };

        position.left = this.$mainControl.offset().left + this.$mainControl.width() + 5;
        position.top = this.$mainControl.offset().top;

        var browserHeight = document.all ? document.body.clientHeight : window.innerHeight,
            itemSelectorHeight = this.itemSelector.getHeight();

        if (browserHeight - itemSelectorHeight - 10 < position.top) {
            position.top = browserHeight - itemSelectorHeight - 10;
        }
        return position;
    };

    ItemList.prototype.isLimited = function (add) {
        if (this.options.limit < this.options.selectedItems.length + (add || 0)) {
            Brightics.VA.Core.Utils.WidgetUtils.openWarningDialog('You are only allowed to select ' + this.options.limit + ' items.');
            this.itemSelector.close();
            return true;
        }
        return false;
    };

    ItemList.prototype.processing = function (status) {
        this.itemSelector._processing(status);
    };

    ItemList.prototype._updateChangedItemOrDelete = function (type, key) {
        //type = 'select' or 'unselect'
        if (typeof this.options.changedItems[key] !== 'undefined' &&
            this.options.changedItems[key] !== type) {
            delete this.options.changedItems[key];
        } else {
            this.options.changedItems[key] = type;
        }
    };

    ItemList.prototype._handleSelectAll = function (data) {
        var newSelected = [];

        var l = 0;
        var r = 0;
        //newSelected = paramSelected - (curSelected intersection  paramSelected)
        while (l < this.options.selectedIndexes.length &&
        r < data.length && !this.isLimited(newSelected.length + 1)) {
            if (this.options.selectedIndexes[l] < data[r].id) {
                l++;
            } else if (this.options.selectedIndexes[l] > data[r].id) {
                this._updateChangedItemOrDelete('select', data[r].value);
                newSelected.push(data[r]);
                r++;
            } else {
                l++;
                r++;
            }
        }
        while (r < data.length && !this.isLimited(newSelected.length + 1)) {
            this._updateChangedItemOrDelete('select', data[r].value);
            newSelected.push(data[r]);
            r++;
        }
        //

        var nextSelectedIndexes = [];
        var nextSelectedItems = [];
        l = 0;
        r = 0;
        //nextSelected = curSelected union newSelected
        while (l < this.options.selectedIndexes.length && r < newSelected.length) {
            if (this.options.selectedIndexes[l] < newSelected[r].id) {
                nextSelectedIndexes.push(this.options.selectedIndexes[l]);
                nextSelectedItems.push(this.options.selectedItems[l]);
                l++;
            } else if (this.options.selectedIndexes[l] > newSelected[r].id) {
                nextSelectedIndexes.push(newSelected[r].id);
                nextSelectedItems.push(newSelected[r].value);
                r++;
            } else {
                nextSelectedIndexes.push(this.options.selectedIndexes[l]);
                nextSelectedItems.push(this.options.selectedItems[l]);
                l++;
                r++;
            }
        }

        while (l < this.options.selectedIndexes.length) {
            nextSelectedIndexes.push(this.options.selectedIndexes[l]);
            nextSelectedItems.push(this.options.selectedItems[l]);
            l++;
        }

        while (r < newSelected.length) {
            nextSelectedIndexes.push(newSelected[r].id);
            nextSelectedItems.push(newSelected[r].value);
            r++;
        }

        this.options.selectedIndexes = nextSelectedIndexes;
        this.options.selectedItems = nextSelectedItems;
        this.refreshControl();
    };

    ItemList.prototype._handleUnselectAll = function (data) {
        var nextSelectedIndexes = [];
        var nextSelectedItems = [];
        var l = 0;
        var r = 0;

        while (l < this.options.selectedItems.length && r < data.length) {
            if (this.options.selectedIndexes[l] < data[r].id) {
                nextSelectedIndexes.push(this.options.selectedIndexes[l]);
                nextSelectedItems.push(this.options.selectedItems[l]);
                l++;
            } else if (this.options.selectedIndexes[l] > data[r].id) {
                r++;
            } else {
                this._updateChangedItemOrDelete('unselect', data[r].value);
                l++;
                r++;
            }
        }

        while (l < this.options.selectedItems.length) {
            nextSelectedIndexes.push(this.options.selectedIndexes[l]);
            nextSelectedItems.push(this.options.selectedItems[l]);
            l++;
        }

        this.options.selectedIndexes = nextSelectedIndexes;
        this.options.selectedItems = nextSelectedItems;
        this.refreshControl();
    };

    ItemList.prototype._handleSelect = function (data) {
        if (this.isLimited(1)) return;

        var pos = 0;
        while (pos < this.options.selectedItems.length && this.options.selectedIndexes[pos] < data.id) {
            ++pos;
        }

        if (pos < this.options.selectedItems.length && this.options.selectedIndexes[pos] === data.id) return;

        this.options.selectedIndexes.splice(pos, 0, data.id);
        this.options.selectedItems.splice(pos, 0, data.value);
        this._updateChangedItemOrDelete('select', data.value);
        this.refreshControl();
    };

    ItemList.prototype._handleUnselect = function (data) {
        var pos = this.options.selectedIndexes.indexOf(data.id);
        if (pos !== -1) {
            this.options.selectedItems.splice(pos, 1);
            this.options.selectedIndexes.splice(pos, 1);
            this._updateChangedItemOrDelete('unselect', data.value);
            this.refreshControl();
        }
    };

    ItemList.prototype._handleClose = function (data) {
        var added = [], removed = [];
        for (var key in this.options.changedItems) {
            if (this.options.changedItems[key] === 'select') {
                added.push(key);
            } else {
                removed.push(key);
            }
        }
        if (added.length > 0 || removed.length > 0) {
            this.options.changed('change', {
                added: added,
                removed: removed,
                items: this.options.selectedItems
            });
        }
        this.options.changedItems = {};
    };

    Brightics.VA.Core.Widget.Controls.ItemList = ItemList;

}).call(this);

/**
 * Created by jhoon80.kim on 2016-01-27.
 */
(function () {
    "use strict";

    var root = this;
    var Brightics = root.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    function ItemSelector(parentId, options) {
        this.parentId = parentId;
        this.options = options;
        this.sortOptions = {};

        this.initOptions();
        this.retrieveParent();
        this.createControl();
    }

    ItemSelector.prototype.initOptions = function () {
        var defaultOptions = {
            source: [],
            width: 290,
            height: 320,
            resizable: true,
            fromModal: false,
            limit: 99999999,
            showDesc: false
        };

        this.options = $.extend(true, defaultOptions, this.options);
    };

    ItemSelector.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ItemSelector.prototype.createControl = function () {
        var _this = this;

        this.$mainControl = $('' +
            '<div class="brtc-va-widget-controls-itemselector">' +
            '   <div class="brtc-va-widget-controls-itemselector-header" />' +
            '   <div class="brtc-va-widget-controls-itemselector-content brtc-style-full brtc-style-display-flex brtc-style-flex-direction-column" />' +
            '</div>'
        );
        this.$parent.append(this.$mainControl);

        var $contentControl = this.$mainControl.find('.brtc-va-widget-controls-itemselector-content');

        this.createFilter($contentControl);
        this.createSelectButton($contentControl);
        this.createItemContainer($contentControl);

        this.closeHandler = function (event) {
            if (_this.$mainControl.closest('.ui-dialog').has(event.target).length === 0) {
                _this.$mainControl.dialog('close');
            }
        };

        var jqxOptions = {
            theme: Brightics.VA.Env.Theme,
            width: this.options.width,
            height: this.options.height,
            resizable: true,
            title: 'Select Items',
            autoOpen: false,
            modal: false,
            showAnimationDuration: 50,
            minHeight: 285,
            minWidth: 307,
            zIndex: this.getHighestZindex(),
            close: function () {
                if (!_this.options.fromModal) {
                    $('.jqx-window-modal').remove();
                }
                $(window).off('mousedown', _this.closeHandler);
                _this.options.changed('close', []);
            }
        };
        this.$mainControl.dialog(jqxOptions);
        this.$mainControl.siblings('.ui-dialog-titlebar.ui-widget-header').addClass('brtc-style-itemselector');
        this.$mainControl.css('z-index', this.getHighestZindex());

    };

    ItemSelector.prototype.createFilter = function ($parent) {
        var _this = this;
        var $container = $('<div class="brtc-va-widget-controls-itemselector-filter-container"></div>');
        $parent.append($container);

        this.$filterControl = $('<input type="search" placeholder="Search Item" />');
        $container.append(this.$filterControl);

        this.$filterControl.jqxInput({
            theme: Brightics.VA.Env.Theme,
            placeHolder: "Search Item",
            height: 31,
            minLength: 1
        });

        this.$filterControl.on('keyup search', function (event) {
            _this.$itemControl.jqxGrid('clearfilters');
            var filterType = 'stringfilter';
            var filterGroup = new $.jqx.filter();

            var filter_or_operator = 1;
            var filter = filterGroup.createfilter(filterType, event.target.value, 'contains');
            filterGroup.addfilter(filter_or_operator, filter);
            _this.$itemControl.jqxGrid('addfilter', 'item', filterGroup);
            _this.$itemControl.jqxGrid('applyfilters');
        });
    };

    ItemSelector.prototype.createSelectButton = function ($parent) {
        var _this = this;

        var $wrapper = $('<div class="brtc-item-check-box-wrapper"></div>');
        $parent.append($wrapper);

        this.$selectAllButton = $('<input type="button" value="Select All" style="width: 100%; float:left; margin-left: 0px;"/>');
        this.$clearAllButton = $('<input type="button" value="Unselect All" style="width: 100%; float:left; margin-left: 2px; margin-bottom: 2px;"/>');
        $wrapper.append(this.$selectAllButton);
        $wrapper.append(this.$clearAllButton);

        this.$selectAllButton.jqxButton({
            height: 23,
            width: 134,
            Theme: Brightics.VA.Env.Theme
        });

        this.$clearAllButton.jqxButton({
            height: 23,
            width: 134,
            Theme: Brightics.VA.Env.Theme
        });

        this.$selectAllButton.on('click', function () {
            _this.selectedAll();
        });

        this.$clearAllButton.on('click', function () {
            _this._processing(true);
            _this.unSelectedAll();
            _this._processing(false);
        });
    };

    ItemSelector.prototype.createItemContainer = function ($parent) {
        var _this = this,
            $gridWrapper = $('' +
                '<div class="brtc-va-progress">' +
                '     <span class="brtc-va-progress-loading"></span>' +
                '</div>' +
                '<div class="brtc-va-widget-controls-itemselector-itemcontainer-wrapper brtc-style-flex-1">' +
                '   <div class="brtc-va-widget-controls-itemselector-itemcontrol brtc-style-border-box"></div>' +
                '</div>');
        $parent.append($gridWrapper);
        var columnrenderer = function (row, column, cellvalue) {
            return '' +
                '<div class="brtc-va-widget-controls-itemselector-itemcontainer-element" row-index="' + row + '">' +
                // '   <span class="brtc-va-widget-controls-itemselector-itemcontainer-element-type"></span>' +
                '   <span class="brtc-va-widget-controls-itemselector-itemcontainer-element-name" title="' + cellvalue + '">' + cellvalue + '</span>' +
                '</div>';
        };

        this.$progress = $parent.find('.brtc-va-progress');
        this.$progress.hide();

        this.$itemControl = $gridWrapper.find('.brtc-va-widget-controls-itemselector-itemcontrol');
        var columns = [{
            text: 'Item',
            datafield: 'item',
            cellsrenderer: columnrenderer,
            // width: '100%',
            minwidth: 120,
            cellsalign: 'left'
        }];

        if (this.options.showDesc) {
            // columns[0].width = '100%';
            columns[0].minwidth = 90;
            columns.push({
                text: 'Description',
                datafield: 'description',
                cellsrenderer: columnrenderer,
                width: 110,
                minwidth: 90,
                maxwidth: 110,
                cellsalign: 'left'
            })
        }

        this.$itemControl.jqxGrid({
            width: '100%',
            theme: Brightics.VA.Env.Theme,
            height: '100%',
            pageable: false,
            selectionmode: 'checkbox',
            showheader: false,
            rowsheight: 20,
            columns: columns
        });

        this.$itemControl.on('rowselect', function (event) {
            if (!_this.systemEvent) {
                var index = event.args.rowindex;
                _this.options.changed('select', {
                    id: _this.invPos[index],
                    value: _this.options.source[index].item
                });
            }
        });

        this.$itemControl.on('rowunselect', function (event) {
            if (!_this.systemEvent) {
                var index = event.args.rowindex;
                _this.options.changed('unselect', {
                    id: _this.invPos[index],
                    value: _this.options.source[index].item
                });
            }
        });
    };

    ItemSelector.prototype.selectedAll = function () {
        var _this = this;
        this.systemEvent = true;

        var rows = this.$itemControl.jqxGrid('getrows');

        this.chkCnt++;
        var newSelectedRowIndexes = rows.map(function (row) {
            var index = typeof row.dataindex !== 'undefined' ? row.dataindex : row.boundindex;
            _this.chk[index] = _this.chkCnt;
            return index;
        });

        var filteredSelectedRowPos = this.pos.filter(function (position) {
            return _this.chk[position] === _this.chkCnt;
        });

        var curSelectedRowIndexes = this._getSelectedRowIndexes();
        var newSelectedRows = filteredSelectedRowPos.map(function (position) {
            return {
                id: _this.invPos[position],
                value: _this.options.source[position].item
            };
        });

        this.$itemControl.jqxGrid({selectedrowindexes: this._union(curSelectedRowIndexes, newSelectedRowIndexes)});
        this.$itemControl.jqxGrid('refresh');
        this.options.changed('selectAll', newSelectedRows);

        this.systemEvent = false;
    };

    ItemSelector.prototype.unSelectedAll = function () {
        var _this = this;
        this.systemEvent = true;


        var rows = this.$itemControl.jqxGrid('getrows');

        this.chkCnt++;
        var newUnselectedRowIndexes = rows.map(function (row) {
            var index = typeof row.dataindex !== 'undefined' ? row.dataindex : row.boundindex;
            _this.chk[index] = _this.chkCnt;
            return index;
        });

        var filteredUnselectedRowPos = this.pos.filter(function (position) {
            return _this.chk[position] === _this.chkCnt;
        });

        var newUnselectedRows = filteredUnselectedRowPos.map(function (position) {
            return {
                id: _this.invPos[position],
                value: _this.options.source[position].item
            };
        });

        var curSelectedRowIndexes = this._getSelectedRowIndexes();

        this.$itemControl.jqxGrid({selectedrowindexes: this._difference(curSelectedRowIndexes, newUnselectedRowIndexes)});
        this.$itemControl.jqxGrid('refresh');
        this.options.changed('unselectAll', newUnselectedRows);

        this.systemEvent = false;
    };

    ItemSelector.prototype._getSelectedRowIndexes = function () {
        return this._countingSort(this.$itemControl.jqxGrid('getselectedrowindexes'), this.options.source.length);
    };

    ItemSelector.prototype._preCalculation = function (source) {
        var _this = this;

        //pos[x] = y, invPos[y] = x;
        this.pos = [];
        this.invPos = [];
        this.chk = [];
        this.chkCnt = 0;
        var n = source.length;

        for (var i = 0; i < n; ++i) {
            this.pos.push(i);
            this.invPos.push(-1);
            this.chk.push(-1);
        }

        this.pos.sort(this.sortOptions.sortOnIndex);

        this.pos.forEach(function (y, x) {
            _this.invPos[y] = x;
        });
    };

    ItemSelector.prototype.setSource = function (source) {
        this.options.source = source;
        this._preCalculation(source);
        var datafields = [{
            name: 'item',
            type: 'string'
        }];
        if (this.options.showDesc) {
            datafields.push({
                name: 'description',
                type: 'string'
            })
        }
        var sourceForAdapter = {
            localdata: this.options.source,
            datatype: "array",
            datafields: datafields
        };
        var dataAdapter = new $.jqx.dataAdapter(sourceForAdapter);
        this.$itemControl.jqxGrid({source: dataAdapter});
    };

    ItemSelector.prototype.getSource = function () {
        return this.options.source;
    };

    ItemSelector.prototype.calcSelectedIndexes = function (selectedItems) {
        var _this = this;
        var selectedIndexes = [];
        var l = 0;
        var r = 0;

        while (l < selectedItems.length && r < this.pos.length) {
            var a = selectedItems[l];
            var b = this.options.source[this.pos[r]].item;
            var res = this.sortOptions.comp(a, b);

            if (res < 0) { //a < b
                l++;
            } else if (res > 0) { //a > b
                r++;
            } else {
                selectedIndexes.push(r);
                l++;
                r++;
            }
        }
        return selectedIndexes;
    };

    ItemSelector.prototype.setSelectedItems = function (selectedData, selectedIndexes) {
        var _this = this;
        this._processing(true);
        this.systemEvent = true;

        var filteredSelectedIndexes = selectedIndexes.filter(function (index) {
            return index < _this.options.source.length;
        });

        this.chkCnt++;
        var originalSelectedIndexes = filteredSelectedIndexes.map(function (index) {
            return _this.pos[index];
        });

        originalSelectedIndexes.forEach(function (index) {
            _this.chk[index] = _this.chkCnt;
        });

        originalSelectedIndexes = this._countingSort(originalSelectedIndexes, this.options.source.length);

        this.$itemControl.jqxGrid({selectedrowindexes: originalSelectedIndexes});
        this.$itemControl.jqxGrid('refresh');
        this.systemEvent = false;
        this._processing(false);
    };

    ItemSelector.prototype._countingSort = function (arr, n) {
        var count = [];

        for (var i = 0; i < n; ++i) {
            count.push(-1);
        }

        arr.forEach(function (index) {
            count[index] = index;
        });

        var ret = count.filter(function (val, idx) {
            return val === idx;
        });

        return ret;
    };

    ItemSelector.prototype._processing = function (status) {
        if (status) {
            $(window).off('mousedown', this.closeHandler);
            this.$progress.show();
        } else {
            $(window).on('mousedown', this.closeHandler);
            this.$progress.hide();
        }
    };

    ItemSelector.prototype.open = function (position, selectedItems, selectedIndexes) {
        this.selectEventFlag = false;
        this.systemEvent = true;
        this.$itemControl.jqxGrid('clearselection');
        this.systemEvent = false;

        this.$mainControl.dialog({
            position: {
                my: 'left top',
                at: 'right+5, top',
                of: position
            }
        });

        this.$mainControl.dialog('open');
        // this.$mainControl.dialog('focus');
        this.$mainControl.css('z-index', this.getHighestZindex());
        $(window).on('mousedown', this.closeHandler);
        var datafields = [{
            name: 'item',
            type: 'string'
        }];
        if (this.options.showDesc) {
            datafields.push({
                name: 'description',
                type: 'string'
            })
        }
        var source = {
            localdata: this.options.source,
            datatype: "array",
            datafields: datafields
        };
        var dataAdapter = new $.jqx.dataAdapter(source);
        this.$itemControl.jqxGrid({source: dataAdapter});
        this.setSelectedItems(selectedItems, selectedIndexes);
    };

    ItemSelector.prototype.close = function () {
        this.$mainControl.dialog('close');
    };

    ItemSelector.prototype.getHighestZindex = function () {
        var jqxWindowList = $('body').children('.jqx-window');
        var maxIndex = 0, newIndex = 0;

        //fixme: jqxWindow관???스 ?리 ?요
        for (var jqxWindowIndex = 0; jqxWindowIndex < jqxWindowList.length; jqxWindowIndex++) {
            newIndex = parseInt($(jqxWindowList[jqxWindowIndex]).css('z-index')) || 0;
            if (newIndex > maxIndex) {
                maxIndex = newIndex;
            }
        }
        return maxIndex + 1;
    };

    ItemSelector.prototype.getHeight = function () {
        return this.$mainControl.height();
    };

    ItemSelector.prototype.clear = function () {
        this.systemEvent = true;
        for (var i = 0; i < this.options.source.length; ++i) {
            this.$itemControl.jqxGrid({selectedrowindexes: []});
        }
        this.systemEvent = false;
    };

    ItemSelector.prototype.clearSelectedItems = function () {
        this.$itemControl.jqxGrid({selectedrowindexes: []});
    };

    ItemSelector.prototype.unselectRow = function (index) {
        this.$itemControl.jqxGrid('unselectrow', this.pos[index]);
    };

    ItemSelector.prototype._union = function (a, b) {
        //set operation. a union b.
        var l = 0;
        var r = 0;
        var ret = [];

        while (l < a.length && r < b.length) {
            if (a[l] < b[r]) {
                ret.push(a[l]);
                l++;
            } else if (a[l] > b[r]) {
                ret.push(b[r]);
                r++;
            } else {
                ret.push(a[l]);
                l++;
                r++;
            }
        }

        while (l < a.length) {
            ret.push(a[l]);
            l++;
        }

        while (r < b.length) {
            ret.push(b[r]);
            r++;
        }

        return ret;
    };

    ItemSelector.prototype._difference = function (a, b) {
        //set operation. a - b.
        var l = 0;
        var r = 0;
        var ret = [];

        while (l < a.length && r < b.length) {
            if (a[l] < b[r]) {
                ret.push(a[l]);
                l++;
            } else if (a[l] > b[r]) {
                r++;
            } else {
                l++;
                r++;
            }
        }

        while (l < a.length) {
            ret.push(a[l]);
            l++;
        }

        return ret;
    };

    ItemSelector.prototype.setSortOptions = function (options) {
        this.sortOptions = options;
    };

    Brightics.VA.Core.Widget.Controls.ItemSelector = ItemSelector;

}).call(this);

/**
 * Created by ng1123.kim on 2016-03-23.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    const SUMMER_NOTE_TOOLBAR = [
        ['style', ['bold', 'italic', 'underline', 'clear']],
        ['fontsize', ['fontsize']],
        ['color', ['color']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['table', ['table']],
        ['height', ['height']]
    ];

    function NoteControl(parentId, options) {
        this.parentId = parentId;
        this.options = this.setOptions(options);

        this.retrieveParent();
        this.createControls();
        this.createEvents();
    }

    NoteControl.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };


    NoteControl.prototype.setOptions = function (options) {
        var defaultOption = {};
        return $.extend(true, defaultOption, options)

    };

    NoteControl.prototype.createControls = function () {
        var description = this.options.description || '';
        this.$mainControl = $('<div class="brtc-va-widget-note-control">' + description + '</div>');
        this.$parent.append(this.$mainControl);

        if (!!document.createRange) {
            try {
                document.getSelection().removeAllRanges();
            } catch (e) {
                document.getSelection().addRange(document.createRange()); // IE bug
            }
        }

        this.$mainControl.summernote({
            focus: typeof this.options.focus != 'undefined' ? this.options.focus : true,
            toolbar: this.options.toolbar || SUMMER_NOTE_TOOLBAR,
            //chrome이 10px미만 폰트 지원하지않아서 override함. 2017-06-21 minkyung.kim
            fontSizes: FONT_SIZES,
            popover: {},
            height: this.options.height - 24,
            disableDragAndDrop: true,
            maximumImageFileSize: 1,
            callbacks: $.extend(true, {}, this.options.callbacks)
        });
    };


    NoteControl.prototype.createEvents = function () {
        this.setRestrictCondition();

        var inDialog = this.$mainControl.closest('.ui-dialog').length > 0;
        if (inDialog) this._setStopPropagationMouseDown();
    };

    NoteControl.prototype.setRestrictCondition = function () {
        if (this.options.maxLength) {
            this.createMessageArea();
            this.createLengthRestriction();
            this.createInputRestriction();
        }
    };

    NoteControl.prototype._setStopPropagationMouseDown = function () {
        this.$parent.mousedown(function (event) {
            event.stopPropagation();
        })
    };
    NoteControl.prototype.createMessageArea = function () {
        var _this = this;
        this.$messageArea = $('<div class="brtc-va-widget-note-message"></div>');
        this.$parent.append(this.$messageArea);

        this.$messageArea.text(this.$parent.find('.note-editable').text().length + ' / ' + _this.options.maxLength + ' characters');
    };

    NoteControl.prototype.deleteImageElement = function () {
        this.$parent.find('.note-editing-area img').remove();
    };

    NoteControl.prototype.deleteHrefAttribute = function () {
        this.$parent.find('.note-editing-area a').removeAttr('href');
    };


    NoteControl.prototype.createLengthRestriction = function () {
        var _this = this;
        this.$mainControl.on('summernote.change', function (we, e) {
            _this.deleteImageElement();
            _this.deleteHrefAttribute();

            var textLength = _this.$parent.find('.note-editable').text().length;
            _this.$messageArea.text(textLength + ' / ' + _this.options.maxLength + ' characters');

            if (textLength > _this.options.maxLength) {
                _this.setOkbuttonCondition(true);
                _this.$messageArea.addClass('error');
            } else {
                _this.setOkbuttonCondition(false);
                _this.$messageArea.removeClass('error');
            }
        });
    };

    NoteControl.prototype.createInputRestriction = function () {
        var _this = this;
        this.$mainControl.on('summernote.keydown', function (we, e) {
            var textLength = _this.$parent.find('.note-editable').text().length;
            if (textLength > _this.options.maxLength) {
                if (!Brightics.VA.Core.Utils.InputValidator.isNotInsertKeyCode(e)) {
                    e.preventDefault();
                }
            }
        });
    };

    NoteControl.prototype.setOkbuttonCondition = function (able) {
        if (this.options.okButton) {
            this.options.okButton.jqxButton({
                disabled: able
            });
        }
    };

    // @Deprecated: please use getValue method
    NoteControl.prototype.getCode = function () {
        return this.getValue();
    };

    // @Deprecated: please use setValue method
    NoteControl.prototype.setCode = function (html) {
        this.setValue(html);
    };

    NoteControl.prototype.focus = function () {
        this.$mainControl.summernote('focus');
    };

    NoteControl.prototype.isEmpty = function () {
        return this.$mainControl.summernote('isEmpty');
    };

    NoteControl.prototype.setHeight = function (height) {
        this.$parent.find('.note-editable.panel-body').css({
            height: height
        });
    };

    NoteControl.prototype.getValue = function () {
        return this.$mainControl.summernote('code');
    };

    NoteControl.prototype.setValue = function (html) {
        this.$mainControl.summernote('focus');
        this.$mainControl.summernote('code', html || '');
    };

    NoteControl.prototype.clear = function () {
        this.$mainControl.summernote('focus');
        this.$mainControl.summernote('reset');
    };

    NoteControl.prototype.destroy = function () {
        this.$mainControl.summernote('destroy');
    };

    Brightics.VA.Core.Widget.Controls.NoteControl = NoteControl;

}).call(this);
/**
 * Created by ng1123.kim on 2016-03-23.
 */
(function () {
    'use strict';

    var root = this; //
    var Brightics = root.Brightics;

    function NumericInput(parentId, options) {
        this.parentId = parentId;
        this.options = this.setOptions(options);
        this.value = "";

        this.retrieveParent();
        this.createControls();
        this.createFocusEvent();
        return this;
    }

    NumericInput.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    NumericInput.prototype.setOptions = function (options) {
        const INTEGER_MAX = '1073741824';  // 2^30
        const INTEGER_MIN = '-1073741824';
        // todo : 추후 double 정책 설정 후 결정
        const DOUBLE_MAX = '1073741824';
        const DOUBLE_MIN = '-1073741824';

        var defaultOption = {
            numberType: 'int', // int, double
            min: undefined,
            max: undefined,
            minus: true,
            placeholder: 'Enter value',
            enterCallback: function () {

            }
        };

        var inputOption = $.extend(true, defaultOption, options);

        // 최대, 최소값 설정
        if (inputOption.numberType == 'int') {
            inputOption.max = (inputOption.max) ? (inputOption.max) : (INTEGER_MAX);
            inputOption.min = (inputOption.min) ? (inputOption.min) : (INTEGER_MIN);
        }
        else if (inputOption.numberType == 'double') {
            inputOption.max = (inputOption.max) ? (inputOption.max) : (DOUBLE_MAX);
            inputOption.min = (inputOption.min) ? (inputOption.min) : (DOUBLE_MIN);
        }

        return inputOption;
    };

    NumericInput.prototype.createControls = function () {
        var className = [
            'brtc-va-editors-sheet-controls-numericInput'
        ].concat(this.options.className || []).join(' ');

        this.$mainControl = $('<input type="text" class="' + className + '" contenteditable>');


        this.$mainControl.attr('placeholder', this.options.placeholder);

        this.$parent.append(this.$mainControl);

        this.addKeyEventListener();
    };

    NumericInput.prototype.setValue = function (val) {
        this.$mainControl.val(val);
    };

    NumericInput.prototype.getValue = function () {
        return this.$mainControl.val();
    };

    NumericInput.prototype.setDisabled = function (disabled) {
        return this.$mainControl.prop("disabled", disabled);
    };

    NumericInput.prototype.onChange = function (callback) {
        this.callback = callback;
    };

    NumericInput.prototype.parseToNumber = function (value) {
        if (value === '') return value;
        else return (isNaN(value)) ? '' : Number(value);
    };


    NumericInput.prototype.createFocusEvent = function () {
        var _this = this;
        this.$mainControl.focus(function () {
            _this.preValue = _this.parseToNumber(_this.$mainControl.val());

        });
        this._OnNumericInputFocusOut = function () {
            var v = _this.$mainControl.val();

            if (+v || _this.isZero(v)) { // convert to number success, let it be
                //                      "1000"  "10.9"  "1,000.9"   "011"   "10c"   "$10"
                //+str, str*1, str-0    1000    10.9    NaN         11      NaN     NaN

                if (typeof _this.options.min !== 'undefined') {
                    if (+v < +_this.options.min) {
                        _this.$mainControl.val(_this.options.min);
                    }
                }
                if (typeof _this.options.max !== 'undefined') {
                    if (+v > +_this.options.max) {
                        _this.$mainControl.val(_this.options.max);
                    }
                }
            } else if (v === '' && _this.options.mandatory && typeof _this.options.min !== 'undefined') {
                _this.$mainControl.val(_this.options.min);
            }
        };
        this.$mainControl.focusout(function () {
            _this._OnNumericInputFocusOut();
            var value = _this.parseToNumber(_this.$mainControl.val());
            _this.$mainControl.val(value);
            if ((value !== _this.preValue && typeof _this.callback === 'function') || _this.options.checkValueChanged) {
                _this.callback(_this.$mainControl.val());
            }
        });
        $('svg').on('mousedown', function () {
            var value = _this.parseToNumber(_this.$mainControl.val());
            _this.$mainControl.val(value);
            if (value !== _this.preValue && typeof _this.callback === 'function' && _this.$mainControl.is(":focus")) {
                _this.callback(_this.$mainControl.val());
            }
        });
    };

    NumericInput.prototype.getControl = function () {
        return this.$mainControl;
    };

    NumericInput.prototype.addKeyEventListener = function () {
        var _this = this;

        this._OnNumericInputKeyDown = function (e) {
            //!important : 20150613 - max 값 처리에서 callback 실행이 되지 않는 버그가 있어서 주석 처리하였음. ex) max가 설정되어 있을 때 0을 계속입력하면 callback 실행이 되지 않음.
            //_this.preValue = _this.$mainControl.val();

            var key = e.which || e.keyCode; // http://keycode.info/

            if (key === 13) {
                _this.options.enterCallback(_this.getControl());
                e.preventDefault();
                return false;
            }

            if (!e.shiftKey && !e.altKey && !e.ctrlKey &&
                // alphabet
                key >= 65 && key <= 90 ||
                // spacebar
                key == 32 ||
                // enter
                key == 13
            ) {
                e.preventDefault();
                return false;
            }

            if (!e.shiftKey && !e.altKey && !e.ctrlKey &&
                // numbers
                key >= 48 && key <= 57 ||
                // Numeric keypad
                key >= 96 && key <= 105 ||
                // Allow: Ctrl+A
                (e.keyCode == 65 && e.ctrlKey === true) ||
                // Allow: Ctrl+C
                (key == 67 && e.ctrlKey === true) ||
                // Allow: Ctrl+X
                (key == 88 && e.ctrlKey === true) ||

                // Allow: home, end, left, right
                (key >= 35 && key <= 39) ||
                // Backspace and Tab and Enter
                key == 8 || key == 9 || key == 13 ||
                // Del and Ins
                key == 46 || key == 45) {
                return true;
            }


            var v = _this.$mainControl.val(); // v can be null, in case textbox is number and does not valid
            if (
                //  minus, dash
            key == 109 || key == 189) {

                // if already has -, ignore the new one
                if (v[0] === '-' || !_this.options.minus
                ) {
                    return false;
                } else {
                    return true;
                }
            }

            if (!e.shiftKey && !e.altKey && !e.ctrlKey &&
                // comma, period and dot on keypad
                key == 190 || key == 188 || key == 110) {
                // already having comma, period, dot
                if (/[\.,]/.test(v) || _this.options.numberType === 'int') {
                    return false;
                } else {
                    return true;
                }
            }

            return false;
        };

        this.$mainControl.keydown(this._OnNumericInputKeyDown);

        this._OnNumericInputKeyUp = function (e) {
            var v = _this.$mainControl.val();

            /*if (+v || _this.isZero(v)) { // convert to number success, let it be
                //                      "1000"  "10.9"  "1,000.9"   "011"   "10c"   "$10"
                //+str, str*1, str-0    1000    10.9    NaN         11      NaN     NaN

                if (typeof _this.options.min !== 'undefined') {
                    if (+v < +_this.options.min) {
                        _this.$mainControl.val(_this.options.min);
                    }
                }
                if (typeof _this.options.max !== 'undefined') {
                    if (+v > +_this.options.max) {
                        _this.$mainControl.val(_this.options.max);
                    }
                }
            } else */
            if (v) {
                // refine the value
                v = (v[0] === '-' ? '-' : '') + v.replace(/[^0-9\.]/g, ''); // this replace also remove the -, we add it again if needed
                v = v.replace(/\.(?=(.*)\.)+/g, '');  // remove all dot that have other dot following. After this processing, only the last dot is kept.

                _this.$mainControl.val(v); // update value only if we changed it
            } /*else if (v === '' && _this.options.mandatory && typeof _this.options.min !== 'undefined') {
                _this.$mainControl.val(_this.options.min);
            }*/
        };

        this.$mainControl.keyup(this._OnNumericInputKeyUp);
    };

    NumericInput.prototype.isZero = function (val) {
        return val != null && val != "" && +val === 0; // +undefined -> NaN, +NaN -> NaN
    };

    NumericInput.prototype.focus = function () {
        this.$mainControl.focus();
    };

    Brightics.VA.Core.Widget.Controls.NumericInput = NumericInput;

}).call(this);
/**
 * Created by ji_sung.park on 2017-07-18.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function TabControl(parentId, options) {
        this.parentId = parentId;
        this.options = options;

        this.retrieveParent();
        this.init();
    }

    TabControl.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    TabControl.prototype.init = function () {
        var _this = this;

        this.$tabHeaderWrapper = this.$parent.children('ul');
        this.$tabHeaders = this.$tabHeaderWrapper.children('li');
        this.$tabContents = this.$parent.children('div');

        this.$tabHeaderWrapper.addClass('brtc-style-tab-header-wrapper');
        this.$tabHeaders.addClass('brtc-va-tab-header').addClass('brtc-style-tab-header');
        this.$tabContents.addClass('brtc-style-tab');

        for(var i in this.$tabHeaders) {
            var $header = this.$tabHeaders.eq(i);
            var text = $header.text();
            var titleWrapper = '<div class="brtc-va-tab-header-titlewrapper brtc-style-tab-header-titlewrapper"></div>';
            $header.html(titleWrapper);
            $header.find('.brtc-va-tab-header-titlewrapper').text(text);
        }

        this.$tabHeaders.eq(0).addClass('selected');
        this.$tabContents.eq(0).addClass('selected');

        this.$tabHeaders.on('click', function(event){
            var index = _this.$tabHeaders.index(this);

            _this.$tabHeaders.removeClass('selected');
            $(this).addClass('selected');

            _this.$tabContents.removeClass('selected');
            _this.$tabContents.eq(index).addClass('selected');

            _this.$parent.trigger('selected', [index]);

            if( $('body').hasClass('scroll-always') && index == 1){
                _this.$parent.find('.brtc-va-dialogs-selectfnunit-tab-allfunctions').perfectScrollbar('update');
            }
        });
    };

    TabControl.prototype.select = function (index) {
        this.$tabHeaders.removeClass('selected');

        $(this.$tabHeaders[index || 0]).addClass('selected');

        this.$tabContents.removeClass('selected');
        this.$tabContents.eq(index).addClass('selected');

        if( $('body').hasClass('scroll-always') && index == 1){
            this.$parent.find('.brtc-va-dialogs-selectfnunit-tab-allfunctions').perfectScrollbar('update');
        }
    };

    Brightics.VA.Core.Widget.Controls.TabControl = TabControl;

}).call(this);
/**
 * Created by daewon.park on 2016-02-19.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    var LITERAL_TYPE = ['number', 'string', 'array[string]', 'array[number]'];
    var EXPRESSION_TYPE = ['calculation'];
    var ARRAY_TYPE = ['array[string]', 'array[number]'];
    var NUMBER_TYPE = ['number', 'array[number]'];

    /**
     *  options = {
     *  variable :{"$gv2": { "type": "literal", "value": ['a','b','c'], 'variable-type': 'array' } }
     */

    var FnUnitUtils = brtc_require('FnUnitUtils');

    function VariableControl(parentId, options) {
        this.parentId = parentId;
        this.initOptions(options);
        this.retrieveParent();
        this.createControls();
        this.setInputValue();
    }

    VariableControl.prototype.initOptions = function (options) {
        this.options = $.extend(true, {}, options);

        this.variableKey = Object.keys(this.options.variable)[0];
        this.variableType = this.options.variable[this.variableKey]['variable-type'];
        this.inputType = this.getInputType(this.variableType);
        this.variableValue = this.options.variable[this.variableKey]['value'];
    };

    VariableControl.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    VariableControl.prototype.createControls = function () {
        var _this = this;
        this.$mainControl = $('' +
            '<div class="brtc-va-widget-container">' +
            '   <div class ="brtc-va-widget-remove" />' +
            '   <div class="brtc-va-widget-label" />' +
            '   <div class="brtc-va-widget-header" />' +
            // '       <div class="brtc-va-widget-label">' + this.variableKey + '</div>' +
            '   <div class="brtc-va-widget-contents"><div class="brtc-va-widget-contents-input-container-wrapper"></div></div>' +
            '</div>');
        this.$parent.append(this.$mainControl);


        this._renderLabel();
        this.createContentsArea();

        this.$mainControl.find('.brtc-va-widget-remove').on('click', function () {
            if (typeof _this.options.onRemoveCallback === 'function') {
                _this.options.onRemoveCallback(_this.createFormattedValue());
                _this.$mainControl.remove();
            }
        });
    };

    VariableControl.prototype._renderLabel = function () {
        let $label = this.$mainControl.find('.brtc-va-widget-label');

        if (this.options.label) {
            if (this.options.mandatory) $label.addClass('mandatory');
            this.variableType = this.variableType || '';
            var variableType = this.variableType.indexOf("array") >= 0 ? "array" : this.variableType;
            $label.addClass(variableType);
            $label.text(this.options.label);
            $label.show();
        } else {
            $label.hide();
        }
    };

    VariableControl.prototype.isArrayValue = function () {
        return ARRAY_TYPE.indexOf(this.variableType) > -1;
    };

    VariableControl.prototype.isCellValue = function () {
        return (this.variableType === 'cell') ? true : false;
    };

    VariableControl.prototype.createContentsArea = function () {
        this.$contentsArea = this.$mainControl.find('.brtc-va-widget-contents-input-container-wrapper');
        let $header = this.$mainControl.find('.brtc-va-widget-header');
        $header.hide();

        if (this.isCellValue()) {
            this.createCellInputControl();
        } else if (this.isArrayValue()) {
            $header.show();
            this.createArrayInputControl();
        } else {
            this.createSingleInputControl();
        }
    };

    VariableControl.prototype.createCellInputControl = function () {
        this.createCellControlLayout();
    };

    VariableControl.prototype._createArrayInputHeaderArea = function () {
        if (this.$arrayInputHeader) {
            this.$arrayInputHeader.remove();
        }

        this.$arrayInputHeader = $(`
            <div class="brtc-va-widget-contents-array-input-header-area">
                <div class="brtc-va-widget-contents-array-header-button" current-edit-type="control">Bulk edit</div>
            </div>`);
        let $button = this.$arrayInputHeader.find(".brtc-va-widget-contents-array-header-button");

        let $header = this.$mainControl.find('.brtc-va-widget-header');
        $header.append(this.$arrayInputHeader);

        $button.click(() => {
            if ($button.attr("current-edit-type") === "control") {
                this._changeControlToBulk();
                this._changeArrayInputHeaderButton("bulk");

            } else if ($button.attr("current-edit-type") === "bulk") {

                this._changeBulkToControl();
                this._changeArrayInputHeaderButton("control");

            }
            this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar('update');
        });

    };

    VariableControl.prototype._changeArrayInputHeaderButton = function (buttonType) {
        let $button = this.$arrayInputHeader.find(".brtc-va-widget-contents-array-header-button");
        if (buttonType === "bulk") {
            $button.attr("current-edit-type", "bulk");
            $button.text("Apply");
            this.$mainControl.find('.brtc-va-widget-contents').scrollTop(0);
        } else if (buttonType === "control") {
            $button.attr("current-edit-type", "control");
            $button.text("Bulk edit");
        }

    };


    VariableControl.prototype._isBulkType = function () {
        let $button = this.$arrayInputHeader.find(".brtc-va-widget-contents-array-header-button");
        return ($button.attr("current-edit-type") === "bulk");
    };


    VariableControl.prototype._changeControlToBulk = function () {
        let arrayValue = this.getInputValue();
        this.$contentsArea.empty();
        this._bulkAceEditorControl = Brightics.VA.Core.Widget.Factory.aceEditorControl(this.$contentsArea, {
            value: arrayValue.join('\n'),
            // mode: 'text',
            editorOptions: {
                enableBasicAutocompletion: false,
                enableSnippets: false,
                enableLiveAutocompletion: false
            }
        });

        let editorSession = this._bulkAceEditorControl.getSession();
        editorSession.setOption('indentedSoftWrap', false);
        editorSession.setUseWrapMode(true);
        editorSession.setWrapLimitRange();
    };

    VariableControl.prototype._changeBulkToControl = function () {
        let value = this._getBulkListValue();
        this.setInputValue(value);
        this.triggerChangeInputValue(true);
        this._destroyBulkAceEditor()
    };


    VariableControl.prototype._destroyBulkAceEditor = function () {
        if (this._bulkAceEditorControl) {
            this._bulkAceEditorControl.destroy();
            this._bulkAceEditorControl = undefined;
        }
    };

    VariableControl.prototype.createArrayInputControl = function () {
        this._createArrayInputHeaderArea();

        if (!this.variableValue || this.variableValue.length === 0) {
            this.createInputControlLayout(0, this.isArrayValue());
        } else {
            if (this.variableValue instanceof Array) {
                for (var i = 0; i < this.variableValue.length; i++) {
                    this.createInputControlLayout(i, this.isArrayValue());
                }
            } else {
                this.createInputControlLayout(0, this.isArrayValue());
            }
        }
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar();
    };

    VariableControl.prototype.createSingleInputControl = function () {
        this.createInputControlLayout(0, false);
    };

    VariableControl.prototype.createCellControlLayout = function () {
        var $parents = this.$contentsArea;
        var _this = this;

        var $inputContainer = $('' +
            '<div class="brtc-va-widget-contents-input-container brtc-style-flex-direction-column brtc-style-height-auto brtc-style-align-items-flex-start">' +
            '   <div class="data-area brtc-style-display-flex brtc-style-col-12 brtc-style-margin-top-5">' +
            '       <div class="brtc-style-width-100 brtc-style-line-height-30">Input Data</div>' +
            '   </div>' +
            '   <div class="row-area brtc-style-display-flex brtc-style-col-12 brtc-style-margin-top-5">' +
            '       <div class="brtc-style-width-100 brtc-style-line-height-30">Row Index</div>' +
            '   </div>' +
            '   <div class="column-area brtc-style-display-flex brtc-style-col-12 brtc-style-margin-top-5">' +
            '       <div class="brtc-style-width-100 brtc-style-line-height-30">Column Name</div>' +
            '   </div>' +
            '</div>'
        );

        $parents.append($inputContainer);

        var $dataDiv = $('<div class="brtc-style-width-minus-100"></div>');
        var $rowDiv = $('<div class="brtc-style-width-minus-100"></div>');
        var $columnDiv = $('<div class="brtc-style-width-minus-100"></div>');

        var $dataArea = $inputContainer.find('.data-area');
        var $rowArea = $inputContainer.find('.row-area');
        var $columnArea = $inputContainer.find('.column-area');

        $dataArea.append($dataDiv);
        $rowArea.append($rowDiv);
        $columnArea.append($columnDiv);

        this.createCellControl($dataDiv, $rowDiv, $columnDiv);
    };

    VariableControl.prototype.createInputControlLayout = function (inputIndex, addable, focus) {
        var $parents = this.$contentsArea;
        var _this = this;
        var deletable = false;
        var $inputContainer = $('<div class="brtc-va-widget-contents-input-container"></div>');

        var $children = $parents.find('.brtc-va-widget-contents-input-container');

        if ($children.length === 0 || !$children[inputIndex]) {
            $parents.append($inputContainer);
        } else {
            $($children[inputIndex]).after($inputContainer);
            deletable = true;
        }

        var $inputDiv = $('<div class="brtc-va-widget-contents-input-control-container"></div>');
        var $addDiv, $deleteDiv;

        $inputContainer.append($inputDiv);

        if (inputIndex > 0 || deletable) {
            $deleteDiv = $('<div class="brtc-va-widget-contents-input-control-delete"></div>');
            $inputContainer.append($deleteDiv);

            $deleteDiv.click(function (event) {
                _this.handleDeleteButtonClick($(this).closest('.brtc-va-widget-contents-input-container'));
            })
        }

        if (addable) {
            $addDiv = $('<div class="brtc-va-widget-contents-input-control-add"></div>');
            $inputContainer.append($addDiv);

            $addDiv.click(function (event) {
                _this.handleAddInputControlEvent($(this).closest('.brtc-va-widget-contents-input-container'));
            })
        }

        if (this.isArrayValue()) {
            if (this.isNumericType()) {
                this.createNumericInputControl($inputDiv, focus);
            } else {
                this.createInputControl($inputDiv, focus);
            }
        } else {
            if (this.isNumericType()) {
                this.createNumericInputControl($inputDiv, focus);
            } else {
                this.createCodeInputControl($inputDiv, focus);
            }
        }
    };

    VariableControl.prototype.createNumericInputControl = function ($parent, focus) {
        var _this = this;
        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%',
            numberType: 'double',
            placeHolder: 'Enter value',
            className: ['brtc-va-widget-contents-input-control'],
            enterCallback: function ($mainControl) {
                if (this.isArrayValue()) {
                    this.handleAddInputControlEvent($mainControl.closest(
                        '.brtc-va-widget-contents-input-container'
                    ), true);
                }
            }.bind(this)
        };
        var input = new Brightics.VA.Core.Widget.Controls.NumericInput($parent, options);
        input.onChange(function () {
            _this.triggerChangeInputValue(false);
        });

        if (focus) input.focus();
    };

    VariableControl.prototype.createDropDownList = function ($control, jqxOptions) {

        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            autoDropDownHeight: true,
            enableBrowserBoundsDetection: true,
            width: 'calc(100% - 100px)'
        };
        if (jqxOptions) {
            $.extend(options, jqxOptions);
        }
        $control.jqxDropDownList(options);
    };

    VariableControl.prototype.createIndataSource = function () {
        var activeModel = Studio.getEditorContainer().getActiveModelEditor().getActiveModel();
        var source = FnUnitUtils.getInTable(this.options.fnUnit).map(function (tid) {
            var fnUnit = activeModel.getFnUnitByOutTable(tid);
            return {
                label: fnUnit.display.label,
                tid: tid,
                type: fnUnit.func
            }
        });
        return source;
    };

    VariableControl.prototype.createCellControl = function ($data, $row, $column) {
        var _this = this;

        this.$data = $data;

        this.createDropDownList($data, {
            source: this.createIndataSource(),
            displayMember: 'label',
            valueMember: 'tid'
        });

        $data.change(function () {
            _this.triggerChangeCellValue();
        });

        var rowOptions = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%',
            numberType: 'int',
            minus: false,
            placeholder: '(0 < value)',
            className: ['brtc-va-widget-contents-input-control']
        };
        this.rowInput = new Brightics.VA.Core.Widget.Controls.NumericInput($row, rowOptions);
        this.rowInput.onChange(function () {
            _this.triggerChangeCellValue();
        });

        this.rowInput.focus();

        this.$columnControl = $('<input type="text" class="brtc-va-widget-contents-input-control"/>');
        $column.append(this.$columnControl);
        var inputOptions = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%',
            placeHolder: 'Enter value'
        };
        this.$columnControl.jqxInput(inputOptions);

        this.$columnControl.focusout(function (event) {
            _this.triggerChangeCellValue();
        });
    };

    VariableControl.prototype.createInputControl = function ($parent, focus) {
        var _this = this;
        var $inputControl = $('<input type="text" class="brtc-va-widget-contents-input-control"/>');
        $parent.append($inputControl);
        var options = {
            theme: Brightics.VA.Env.Theme,
            height: '25px',
            width: '100%',
            placeHolder: 'Enter value'
        };
        $inputControl.jqxInput(options);

        if (focus) $inputControl.jqxInput('focus');

        $inputControl.keydown(function (key) {
            if (key.keyCode == 13) {
                if (_this.isArrayValue()) {
                    _this.handleAddInputControlEvent($inputControl.closest('.brtc-va-widget-contents-input-container'), true);
                }
            }
        });
        $inputControl.focusout(function (event) {
            _this.triggerChangeInputValue(false);
        });
    };

    VariableControl.prototype.createCodeInputControl = function ($parent, focus) {
        var _this = this;
        var $inputControl = $('<textarea  class="brtc-va-widget-contents-input-control"/>');
        $parent.append($inputControl);
        var controlOptions = {
            mode: this.isLiteralType(this.variableType) ? 'brtc-system-variable' : 'brtc-control',
            scrollbarStyle: 'null',
            placeholder: this.isLiteralType(this.variableType) ? 'Enter value' : 'Enter expression',
            lineWrapping: false,
            matchBrackets: false,
            extraKeys: {
                'Ctrl-Space': 'autocomplete',
                "Tab": false, // Let focus go to next control
                "Shift-Tab": false // Let focus go to previous control
            },
            showTrailingSpace: true,
            hintOptions: {
                list: this.variableType == 'literal' ? ['${sys.user}', '${sys.date}'] : []
            }
        };

        this.codeMirror = CodeMirror.fromTextArea($inputControl[0], controlOptions);
        var additionalOption = {
            'valid-message-position': this.options['valid-message-position']
        };
        Brightics.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.codeMirror, additionalOption);
        this.codeMirror.on('blur', function (instance, event) {
            _this.triggerChangeInputValue(false);
        });
    };

    VariableControl.prototype.handleAddInputControlEvent = function ($target, focus) {
        var index = $target.index();
        this.createInputControlLayout(index, true, focus);
        this.triggerChangeInputValue();
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar('update');
        var parents = this.$mainControl.parents('.ps-container');
        if (parents && parents.length) parents.perfectScrollbar('update');
    };

    VariableControl.prototype.handleDeleteButtonClick = function ($target) {
        $target.remove();
        this.triggerChangeInputValue();
        this.$mainControl.find('.brtc-va-widget-contents').perfectScrollbar('update');
        var parents = this.$mainControl.parents('.ps-container');
        if (parents && parents.length) parents.perfectScrollbar('update');
    };

    VariableControl.prototype.triggerChangeInputValue = function (forced) {
        if (typeof this.options.onChangeCallback === 'function') {
            var _this = this;
            var value = _this.getInputValue();
            if (JSON.stringify(value) !== JSON.stringify(_this.variableValue) || forced) {
                _this.variableValue = value;
                _this.options.onChangeCallback(_this.createFormattedValue());
            }
        }
    };

    VariableControl.prototype.triggerChangeCellValue = function (forced) {
        if (typeof this.options.onChangeCallback === 'function') {
            var _this = this;
            var value = {
                inData: this.$data.val(),
                rowIndex: this.rowInput.getValue(),
                column: this.$columnControl.val()
            };

            if (JSON.stringify(value) !== JSON.stringify(_this.variableValue) || forced) {
                _this.variableValue = value;
                _this.options.onChangeCallback(_this.createFormattedCellValue());
            }
        }
    };

    VariableControl.prototype.createFormattedCellValue = function () {
        return {
            'key': this.variableKey,
            'type': this.inputType,
            'variable-type': this.variableType,
            "value": this.variableValue
        };
    };

    VariableControl.prototype.createFormattedValue = function () {
        return {
            'key': this.variableKey,
            'type': this.inputType,
            'variable-type': this.variableType,
            "value": this.isLiteralType(this.variableType) ? this.variableValue :
                Brightics.VA.Core.Utils.VariableUtils.wrap(this.variableValue)
        };
    };

    VariableControl.prototype.getFormattedValue = function () {
        return {
            'key': this.variableKey,
            'type': this.inputType,
            'variable-type': this.variableType,
            "value": (this.variableType === 'calculation') ?
                Brightics.VA.Core.Utils.VariableUtils.wrap(this.getInputValue()) : this.getInputValue()
        };
    };
    VariableControl.prototype._getBulkListValue = function () {
        let bulkListValue = [];
        let bulkValue = this._bulkAceEditorControl.getValue();
        if (bulkValue) {
            bulkValue.split('\n').forEach((x) => {
                bulkListValue.push(this.getValueByType(x))
            });
        }


        if (bulkListValue.length === 0) {
            if (this.isNumericType()) {
                bulkListValue = [0];
            } else {
                bulkListValue = [""];
            }
        }
        return bulkListValue;
    };


    VariableControl.prototype.getInputValue = function () {
        var inputValue;
        var controls = this.$contentsArea.find('.brtc-va-widget-contents-input-control');

        if (this.isArrayValue()) {
            inputValue = [];
            inputValue.length = controls.length;
            for (var i = 0; i < controls.length; i++) {
                var x = this.getValueByType($(controls[i]).val());
                inputValue[i] = x;
            }
        } else {
            inputValue = this.isNumericType() ?
                this.getValueByType(controls.val()) :
                this.getValueByType(this.codeMirror.getValue());
        }
        return inputValue;
    };

    VariableControl.prototype.setVariableType = function (variableType) {
        this.variableType = variableType;
        this.$contentsArea.empty();
        this.createContentsArea();
    };

    VariableControl.prototype.setInputValue = function (value) {
        if (typeof value !== 'undefined') this.variableValue = value;

        var controls = this.$contentsArea.find('.brtc-va-widget-contents-input-control');
        if (this.isCellValue()) {
            this.rowInput.setValue(this.variableValue.rowIndex);
            this.$columnControl.val(this.variableValue.column);
            this.$data.val(this.variableValue.inData);
        } else if (this.isArrayValue()) {
            var i;
            if (controls.length > this.variableValue.length) {
                for (i = 0; i < controls.length; i++) {
                    if (typeof this.variableValue[i] === 'undefined') {
                        $(controls[i]).parents('.brtc-va-widget-contents-input-container').remove();
                    } else {
                        $(controls[i]).val(this.getValueByType(this.variableValue[i]));
                    }
                }
            } else {
                for (i = controls.length; i < this.variableValue.length; i++) {
                    this.createInputControlLayout(i, true);
                }
                controls = this.$contentsArea.find('.brtc-va-widget-contents-input-control');
                for (i = 0; i < controls.length; i++) {
                    $(controls[i]).val(this.getValueByType(this.variableValue[i]));
                }
            }
            this._destroyBulkAceEditor();
            this._changeArrayInputHeaderButton("control");
        } else {
            if (Array.isArray(this.variableValue)) {
                if (this.isNumericType()) {
                    controls.val(this.getValueByType(this.variableValue[0]));
                } else {
                    this.codeMirror.setValue(this.getValueByType(this.variableValue[0]));
                }
            } else {
                if (this.isNumericType()) {
                    controls.val(this.getValueByType(this.variableValue));
                } else {
                    this.codeMirror.setValue(this.getValueByType(this.variableValue));
                }
            }
        }
    };

    VariableControl.prototype.setRemovable = function (removable) {
        this.options.removable = removable;

        if (removable) this.$mainControl.find('.brtc-va-widget-remove').addClass('removable');
        else this.$mainControl.find('.brtc-va-widget-remove').removeClass('removable');
    };


    VariableControl.prototype.getOptions = function () {
        return this.options;
    };

    VariableControl.prototype.isLiteralType = function (varType) {
        return LITERAL_TYPE.indexOf(varType) > -1;
    };

    VariableControl.prototype.getInputType = function (varType) {
        if (this.isLiteralType(varType)) return 'literal';
        return 'expression';
    };

    VariableControl.prototype.isNumericType = function () {
        return NUMBER_TYPE.indexOf(this.variableType) > -1;
    };

    VariableControl.prototype.toString = function (val) {
        if (_.isNull(val) || _.isUndefined(val) || val === '') return '';
        if (_.isNumber(val)) {
            if (_.isNaN(val) || _.isUndefined(val)) return '';
            return val.toString();
        }
        return val;
    };

    VariableControl.prototype.toNumber = function (val) {
        if (_.isNull(val) || _.isUndefined(val) || val === '') return 0;
        return Number(this.toString(Number(val)));
    };

    VariableControl.prototype.getValueByType = function (val) {
        if (this.isNumericType()) return this.toNumber(val);
        if (this.isLiteralType(this.variableType)) return this.toString(val);
        // expression
        return Brightics.VA.Core.Utils.VariableUtils.strip(val);
    };

    root.Brightics.VA.Core.Widget.Controls.VariableControl = VariableControl;
}).call(this);

/**
 * Created by SDS on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;

    root.Brightics.VA.Core.Widget.Configurator = {
        setCodeMirrorConfiguration: function () {
            CodeMirror.defineMode('brtc-default', function (config) {
                return CodeMirror.simpleMode(config, {start: []});
            });

            var CFConditionVerifier = new Brightics.VA.Core.Verifier.CFConditionVerifier();
            CodeMirror.defineMode(CFConditionVerifier.getRuleMode(), function (config) {
                return CodeMirror.simpleMode(config, {start: CFConditionVerifier.getSyntaxRule()});
            });

            var CFVariableVerifier = new Brightics.VA.Core.Verifier.CFVariableVerifier();
            CodeMirror.defineMode(CFVariableVerifier.getRuleMode(), function (config) {
                return CodeMirror.simpleMode(config, {start: CFVariableVerifier.getSyntaxRule()});
            });

            var ConditionVerifier = new Brightics.VA.Core.Verifier.ConditionVerifier();
            CodeMirror.defineMode(ConditionVerifier.getRuleMode(), function (config) {
                return CodeMirror.simpleMode(config, {start: ConditionVerifier.getSyntaxRule()});
            });

            var NumericalFormulaVerifier = new Brightics.VA.Core.Verifier.NumericalFormulaVerifier();
            CodeMirror.defineMode(NumericalFormulaVerifier.getRuleMode(), function (config) {
                return CodeMirror.simpleMode(config, {start: NumericalFormulaVerifier.getSyntaxRule()});
            });

            var SystemVariableVerifier = new Brightics.VA.Core.Verifier.SystemVariableVerifier();
            CodeMirror.defineMode(SystemVariableVerifier.getRuleMode(), function (config) {
                return CodeMirror.simpleMode(config, {start: SystemVariableVerifier.getSyntaxRule()});
            });

            CodeMirror.commands.autocomplete = function (cm) {
                var doc = cm.getDoc();
                var POS = doc.getCursor();
                var mode = CodeMirror.innerMode(cm.getMode(), cm.getTokenAt(POS).state).mode.name;

                if (mode == 'sql') { //html depends on xml
                    CodeMirror.showHint(cm, CodeMirror.hint.sql);
                    // CodeMirror.showHint(cm, CodeMirror.hint['sql-custom']);
                } else if (mode == 'clike') {

                    CodeMirror.showHint(cm, CodeMirror.hint['scala-custom']);
                } else if (mode == 'brtc-default'
                    || mode == 'brtc-controlflow-variable'
                    || mode == 'brtc-control'
                    || mode == 'brtc-va-numerical-formula-rule'
                    || mode == 'r') {
                    CodeMirror.showHint(cm, CodeMirror.hint['brtc-custom']);
                } else {
                    CodeMirror.showHint(cm, CodeMirror.hint.anyword);
                }
                // } else if (mode == 'javascript') {
                //     CodeMirror.showHint(cm, CodeMirror.hint.javascript);
                // } else if (mode == 'css') {
                //     CodeMirror.showHint(cm, CodeMirror.hint.css);
                // } else if (mode == 'xml') {
                //     CodeMirror.showHint(cm, CodeMirror.hint.html);
            };
        }
    }
}).call(this);
/**
 * Created by SDS on 2016-01-28.
 */
(function () {
    'use strict';

    var root = this;

    root.Brightics.VA.Core.Widget.Factory = {
        variableControl: function (parentId, options) {
            return new root.Brightics.VA.Core.Widget.Controls.VariableControl(parentId, options);
        },
        arrayInputControl: function (parentId, options) {
            return new root.Brightics.VA.Core.Widget.Controls.ArrayInputControl(parentId, options);
        },
        argumentControl: function (parentId, options) {
            return new root.Brightics.VA.Core.Widget.Controls.ArgumentControl(parentId, options);
        },
        createFadeOutMessage: function ($control, options) {
            new root.Brightics.VA.Core.Widget.Controls.FadeOutMessage($control, options);
        },
        noteControl: function ($control, options) {
            return new root.Brightics.VA.Core.Widget.Controls.NoteControl($control, options);
        },
        numericInputControl: function (parentId, options) {
            return new root.Brightics.VA.Core.Widget.Controls.NumericInput(parentId, options);
        },
        aceEditorControl: function ($control, options) {
            return new root.Brightics.VA.Core.Widget.Controls.AceEditorControl($control, options);
        },
        tabControl: function ($control, options) {
            return new root.Brightics.VA.Core.Widget.Controls.TabControl($control, options);
        },


        colorPickerControl: function ($control, options) {
            return new root.Brightics.VA.Core.Widget.Controls.ColorPickerControl($control, options);
        },
        opacityControl: function ($control, options) {
            return new root.Brightics.VA.Core.Widget.Controls.OpacityControl($control, options);
        },
        borderControl: function ($control, options) {
            return new root.Brightics.VA.Core.Widget.Controls.BorderControl($control, options);
        }
    };

}).call(this);
/**
 * Created by sds on 2017-10-27.
 */

/* global Studio */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ClipboardManager() {
        this.clipboardCache = [];
        this.visualCache = {};
    }

    ClipboardManager.prototype.addFunctionToClipboard = function (functionTemplate) {
        functionTemplate.uid = Date.now();
        this.clipboardCache.push(functionTemplate);
        this.openClipboardDialog(false);
    };

    ClipboardManager.prototype.addVisualObjects = function (vos) {
        var activeEditor = Studio.getActiveEditor();
        activeEditor.handleOnCopy();
        _.extend(this.visualCache, vos);
    };

    ClipboardManager.prototype.getVisualObjects = function (modelId) {
        return this.visualCache[modelId];
    };

    ClipboardManager.prototype.getParent = function () {
        var activeEditor = Studio.getActiveEditor();

        return activeEditor.getMainArea();
    };

    ClipboardManager.prototype.openClipboardDialog = function (_reopen) {
        var reopen = _.isUndefined(_reopen) ? true : _reopen;
        var $parent = this.getParent();

        if (!this.clipboardDialog) {
            this.clipboardDialog = new Brightics.VA.Core.Dialogs.ClipboardDialog($parent, {
                functionList: this.clipboardCache
            });
            return;
        }
        if (reopen) {
            this.clipboardDialog.close();
            this.clipboardDialog = new Brightics.VA.Core.Dialogs.ClipboardDialog($parent, {
                functionList: this.clipboardCache
            });
        } else {
            if (this.clipboardDialog.isAlive()) {
                this.clipboardDialog.updateFunctionList(this.clipboardCache);
            } else {
                this.clipboardDialog = new Brightics.VA.Core.Dialogs.ClipboardDialog($parent, {
                    functionList: this.clipboardCache
                });
            }
        }
    };

    ClipboardManager.prototype.setEditorType = function (type) {
        if (this.clipboardDialog && this.clipboardDialog.isAlive()) {
            this.clipboardDialog.setEnable(Brightics.VA.Core.Interface.Clipboard[type])
        }
    };


    Brightics.VA.Core.Tools.Manager.ClipboardManager = ClipboardManager;

}).call(this);

/**
 * Created by sds on 2017-07-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function EditorLayoutManager($target) {
        this.$target = $target;
    }

    EditorLayoutManager.prototype.setWidth = function (width) {
        if (width) this.$target.width(width);
    };

    EditorLayoutManager.prototype.setHeight = function (height) {
        if (height) this.$target.width(height);
    };

    EditorLayoutManager.prototype.setMarginLeft = function (margin) {
        return this.$target.css('margin-left', margin);
    };

    EditorLayoutManager.prototype.getWidth = function () {
        return this.$target.width();
    };

    EditorLayoutManager.prototype.getHeight = function () {
        return this.$target.height();
    };

    EditorLayoutManager.prototype.getPaddingLeft = function () {
        return Number(this.$target.css('padding-left').replace('px', ''));
    };

    EditorLayoutManager.prototype.getPaddingRight = function () {
        return Number(this.$target.css('padding-right').replace('px', ''));
    };

    Brightics.VA.Core.Tools.Manager.EditorLayoutManager = EditorLayoutManager;

}).call(this);
/**
 * Created by sds on 2017-07-17.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SideBarManager(editor) {
        this.editor = editor;

        this.retrieveParent();
        this.init();
        this.createSideBarArea();
        this.createControls();
    }

    SideBarManager.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.editor.getMainArea());
    };

    SideBarManager.prototype.init = function () {
        this.configureLayout();
        this.attachTabBarWrapperToLayout();
        this.sideBar = {};
    };

    SideBarManager.prototype.configureLayout = function () {
    };

    SideBarManager.prototype.attachTabBarWrapperToLayout = function (params) {
        var _this = this;
        this.$leftTabBarWrapper = this.editor.getLeftTabBarArea();
        this.$rightTabBarWrapper = this.editor.getRightTabBarArea();
        _.forIn(this.layout, function (lo) {
            _.assign(lo, {
                $tabBarWrapper: lo.position == 'left' ?
                    _this.$leftTabBarWrapper : _this.$rightTabBarWrapper
            });
        });
    };

    SideBarManager.prototype.createSideBarArea = function () {
        for (var sideBar in this.layout) {
            var $sideBar = $('' +
                '<div class="brtc-va-studio-sidebar" name="' + sideBar + '">' +
                '   <div class="brtc-va-studio-sidebar-area" name="' + sideBar + '" style="display: none"></div>' +
                '</div>');
            $sideBar.find('.brtc-va-studio-sidebar-area').addClass(this.layout[sideBar].position);

            this.$parent.append($sideBar);
        }
    };

    SideBarManager.prototype.createControls = function () {
    };

    SideBarManager.prototype.expandStatusChange = function (sideBarName, isShow) {
        if (isShow) {
            this.sideBar[sideBarName].show();
        } else {
            this.sideBar[sideBarName].hide();
        }

        var showSideBar = this.sideBar[sideBarName];
        var position = showSideBar.getLayout().position;
        _.forIn(this.sideBar, function (sb) {
            if (sb.getLayout().position === position && sb !== showSideBar) {
                sb.hide();
            }
        });
        showSideBar.show();

        this.fireExpandStatusChanged();
    };

    SideBarManager.prototype.fireExpandStatusChanged = function (sideBarName, isShow) {
        if (isShow) {
            // sidebar를 open할 때 다른 sidebar는 close하는 로직
            for (var key in this.sideBar) {
                var target = this.sideBar[key];
                var isVisible = target.options.visible;
                var isSamePosition = false;
                if (this.sideBar[sideBarName]) {
                    isSamePosition = (this.sideBar[sideBarName].options.position === target.options.position)
                }
                if (key !== sideBarName && isVisible && isSamePosition) {
                    target.hide();
                }
            }
        }
        this.editor.getModelLayoutManager().handleExpandStatusChanged();
    };

    SideBarManager.prototype.onActivated = function () {
        if (this.sideBar) {
            _.forIn(this.sideBar, function (sb) {
                if (sb.onActivated && typeof sb.onActivated === 'function') {
                    sb.onActivated();
                }
            });
        }
    };

    SideBarManager.prototype.onFnUnitSelect = function (fnUnit) {
        if (this.sideBar) {
            _.forIn(this.sideBar, function (sb) {
                sb.onFnUnitSelect(fnUnit);
            });
        }
    };

    SideBarManager.prototype.onModelChange = function (command) {
        if (this.sideBar) {
            _.forIn(this.sideBar, function (sb) {
                sb.onModelChange(command);
            });
        }
    };

    SideBarManager.prototype.destroy = function () {
        if (this.sideBar) {
            _.forIn(this.sideBar, function (sb) {
                sb.destroy();
            });
        }
    };

    SideBarManager.prototype.openAll = function () {
        if (this.sideBar) {
            for (var key in this.sideBar) {
                this.expandStatusChange(key, true);
                this.sideBar[key].onModelChange();
            }
        }
    };

    SideBarManager.prototype.closeAll = function () {
        if (this.sideBar) {
            for (var key in this.sideBar) {
                this.expandStatusChange(key, false);
                this.sideBar[key].onModelChange();
            }
        }
    };

    SideBarManager.prototype.getSideBars = function () {
        return this.sideBar;
    };

    SideBarManager.prototype.getEditor = function () {
        return this.editor;
    };

    SideBarManager.prototype.getLeftSideBarWidth = function () {
        for (var key in this.sideBar) {
            var options = this.sideBar[key].options;
            if (options.visible === true && options.position === 'left') {
                return options.width;
            }
        }

        return this.editor.getLeftTabBarArea().height();
        // return 0;
    };

    SideBarManager.prototype.getRightSideBarWidth = function () {
        for (var key in this.sideBar) {
            var options = this.sideBar[key].options;
            if (options.visible === true && options.position === 'right') {
                return options.width;
            }
        }

        return this.editor.getRightTabBarArea().height();
        // return 0;
    };

    SideBarManager.prototype.isOpen = function (position) {
        for (var key in this.sideBar) {
            var options = this.sideBar[key].options;
            if (options.visible === true && options.position == position) return true;
        }

        return false;
    };

    SideBarManager.prototype.refresh = function () {
    };

    SideBarManager.prototype.updateStatus = function () {
    };

    Brightics.VA.Core.Tools.Manager.SideBarManager = SideBarManager;
}).call(this);

/**
 * Created by SDS on 2016-09-05.
 */

/* global crel */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function SideBar(parentId, options) {
        this.options = options;
        this.parentId = parentId;
        this.FnUnitUtils = brtc_require('FnUnitUtils');
        
        _retrieveParent.bind(this)();

        this.init();
        this.createControls();
        this.createExpander();
        // this.createDescription();
        this.initPreferenceTarget();
    }

    var _retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    SideBar.prototype.init = function () {
        this.preferenceTarget = {
            scroll: {}
        };

        this.configureSize();
    };

    SideBar.prototype.createControls = function () {
        this.createHeader();
        this.createContent();
    };

    SideBar.prototype.createExpander = function () {
        var _this = this;

        this.$expandButton = $('<div class="brtc-va-studio-sidebar-expand"></div>');
        this.$expandButton.addClass(this.options.position);

        var label = this.options['description-label'] || this.options.label;
        this.$descriptionButton = $('<div class="brtc-va-studio-sidebar-description">' + label + '</div>');
        this.$descriptionButton.addClass(this.options.position);

        var $temp = $('<div class="brtc-va-studio-sidebar-expander"></div>');
        // $temp.append(this.$expandButton);
        $temp.append(this.$descriptionButton);

        this.options.$tabBarWrapper.append($temp);
        $temp.click(function (event) {
            if (_this.options.visible) _this.hide();
            else _this.show();

            if ($('body').hasClass('scroll-always')) {
                _this.$parent.find('.brtc-va-studio-sidebar-area').find('.ps-container').perfectScrollbar('update');
            }
        });

        if (this.options.visible) this.show();
    };

    SideBar.prototype.createDescription = function () {
        // var _this = this;
        //
        // var label = this.options['description-label'] || this.options.label;
        // this.$descriptionButton = $('<div class="brtc-va-studio-sidebar-description">' + label + '</div>');
        // this.$descriptionButton.addClass(this.options.position);
        // this.options.$tabBarWrapper.append(this.$descriptionButton);
        // this.$descriptionButton.click(function (event) {
        //     _this.show();
        // });
    };

    SideBar.prototype.expandStatusChanged = function (isExpanded) {
        this.refreshCodeMirrorControl();
    };

    SideBar.prototype.refreshCodeMirrorControl = function () {
        this.$parent.find('.CodeMirror').each(function (i, $el) {
            $el.CodeMirror.refresh();
        });
    };

    SideBar.prototype.selectionChanged = function (selection) {
    };

    SideBar.prototype.destroy = function (editor) {
    };

    SideBar.prototype.hide = function () {
        this.options.visible = false;
        this.$parent.find('.brtc-va-studio-sidebar-area').hide();
        // this.$expandButton.show();
        this.$descriptionButton.css('background-color', '#FFFFFF');
        this.$descriptionButton.css('color', '#4C4C4C');
        this.$descriptionButton.parent().css('outline', '1px solid #dbdde2');
        // this.$descriptionButton.css('width', '140px');
        this.expandStatusChanged(false);
    };

    SideBar.prototype.show = function () {
        this.options.visible = true;
        this.$parent.find('.brtc-va-studio-sidebar-area').show();
        // this.$expandButton.hide();
        this.$descriptionButton.css('background-color', '#4B505E');
        this.$descriptionButton.css('color', '#FFFFFF');
        this.$descriptionButton.parent().css('outline', '1px solid rgb(75, 80, 94)');
        // this.$descriptionButton.css('width', '178px');
        this.expandStatusChanged(true);
    };

    SideBar.prototype.expandStatusChanged = function (isExpand) {
        this.applyPreferenceSettings(isExpand);
        this.fireExpandStatusChanged(isExpand);
        this.resizeAceEditors();
        this.refreshCodeMirrorControl();
        $(window).trigger('resize'); // 일부 jqWidget 레이아웃 깨짐 방지
        this.refreshjqxTabs();
        this.refreshTabs();
    };

    SideBar.prototype.applyPreferenceSettings = function (isExpand) {
        this.applyScrollSetting(isExpand);
    };

    SideBar.prototype.fireExpandStatusChanged = function (isExpand) {
        this.options.manager.fireExpandStatusChanged(this.options.id, isExpand);
    };

    SideBar.prototype.applyScrollSetting = function (isExpand) {
        var _this = this;

        if (!$.isEmptyObject(this.preferenceTarget['scroll'])) {
            if ($('body').hasClass('scroll-always')) {
                this.preferenceTarget['scroll'].perfectScrollbar('update');
            }
        }
    };

    SideBar.prototype.resizeAceEditors = function () {
        this.$parent.find('.ace_editor').each(function (i, $el) {
            $el.env.editor.resize();
        });
    };

    SideBar.prototype.refreshCodeMirrorControl = function () {
        this.$parent.find('.CodeMirror').each(function (i, $el) {
            $el.CodeMirror.refresh();
        });
    };

    SideBar.prototype.refreshjqxTabs = function () {
        var tabs = this.$parent.find('.jqx-tabs');
        if (tabs.length > 0) tabs.jqxTabs('render');
    };

    SideBar.prototype.refreshTabs = function () {
        if (this.$mainControl) {
            var tabs = this.$mainControl.find('.brtc-va-tab-header');
            if (tabs.length > 0) {
                if (tabs.filter('.selected:visible').length === 0) {
                    tabs.filter(':visible').eq(0).click();
                }
            }
        }
    };

    SideBar.prototype.appendTemplate = function (options) {
        console.error('if you want to use Library, Must implement appendTemplate Method');
    };

    SideBar.prototype.configureSize = function () {
        this.$parent.find('.brtc-va-studio-sidebar-area')
            .width(this.options.width - 20);
    };

    SideBar.prototype.createHeader = function () {
        var _this = this;
        var headerText = this.options.label; //.toUpperCase();

        this.$headerControl = $(
            crel('div', {class: 'brtc-va-studio-sidebar-header-wrapper'},
                crel('div', {class: 'brtc-va-studio-sidebar-collapse ' + this.options.position}),
                crel('dlv', {class: 'brtc-va-tools-sidebar-header'}, headerText)
            )
        );

        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$headerControl);
        this.$headerControl.find('.brtc-va-studio-sidebar-collapse').click(function () {
            _this.hide();
        });
    };

    SideBar.prototype.udfChanged = function (selection) {
    };

    SideBar.prototype.templateChanged = function (selection) {
    };

    SideBar.prototype.onActivated = function () {
    };

    SideBar.prototype.onFnUnitSelect = function (fnUnit) {
    };

    SideBar.prototype.onModelChange = function () {
    };

    SideBar.prototype.initPreferenceTarget = function () {
    };

    SideBar.prototype.destroy = function () {
    };

    SideBar.prototype.getEditor = function () {
        return this.options.manager.getEditor();
    };

    SideBar.prototype.getLayout = function () {
        return this.options;
    };

    Brightics.VA.Core.Tools.SideBar = SideBar;

}).call(this);

/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DataBoxSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    DataBoxSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    DataBoxSideBar.prototype.constructor = DataBoxSideBar;

    DataBoxSideBar.prototype.createContent = function () {
        this.$modelSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar visual">' +
            '</div>');

        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);

        this.dataSourceExplorer = new Brightics.VA.Implementation.Visual.Views.DataSourceExplorer(this.$modelSideBar, {
            width: '100%',
            height: '100%',
            editor: this.getEditor()
        });
    };

    DataBoxSideBar.prototype.destroy = function (editor) {
        this.dataSourceExplorer.destroy(editor);
    };

    DataBoxSideBar.prototype.configureSize = function () {
        this.$parent.find('.brtc-va-studio-sidebar-area').width(this.options.width);
    };

    DataBoxSideBar.prototype.selectionChanged = function (selection) {
    };

    DataBoxSideBar.prototype.onActivated = function () {
        this.dataSourceExplorer.editorChanged(this.getEditor());
    };

    DataBoxSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.$modelSideBar.find('.bcharts-ds-panel');
    };

    Brightics.VA.Core.Tools.SideBar.DataBoxSideBar = DataBoxSideBar;
}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function DeepLearningPaletteSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    DeepLearningPaletteSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    DeepLearningPaletteSideBar.prototype.constructor = DeepLearningPaletteSideBar;

    DeepLearningPaletteSideBar.prototype.createContent = function () {
        var _this = this;

        this.$modelSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar deeplearning">' +
            '   <ul>' +
            '       <li>Function</li>' +
            '       <li>Parameters</li>' +
            '   </ul>' +
            '   <div class="brtc-va-tools-sidebar-functiontab" />' +
            '   <div class="brtc-va-tools-sidebar-parameterstab" />' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);

        this.tabControl = Brightics.VA.Core.Widget.Factory.tabControl(this.$modelSideBar);

        var $deepLearningPaletteArea = this.$modelSideBar.find('.brtc-va-tools-sidebar-functiontab');
        this.deepLearningPalette = new Brightics.VA.Core.Views.DeepLearningPalette($deepLearningPaletteArea, {
            width: '100%',
            height: '100%',
            draggable: true,
            modelType: Brightics.VA.Implementation.DeepLearning.Clazz
        });

        var $parametersArea = this.$modelSideBar.find('.brtc-va-tools-sidebar-parameterstab');
        this.parametersControl = new Brightics.VA.Core.Views.Parameters($parametersArea, {
            height: '100%',
            modelType: Brightics.VA.Implementation.DeepLearning.Clazz,
            modelContents: this.getEditor().getModel()
        });

        this.$modelSideBar.on('selected', function (event, index) {
            var selectedIdx = index;
            if (selectedIdx === 1) {
                _this.parametersControl.activate();
            }
        });

        var activeEditor = Studio.getEditorContainer().getActiveModelEditor();
        this.parametersControl.editorChanged(activeEditor);
    };

    DeepLearningPaletteSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.tabControl.$tabContents.find('.brtc-va-views-palette-navigator-wrapper');
    };

    Brightics.VA.Core.Tools.SideBar.DeepLearningPaletteSideBar = DeepLearningPaletteSideBar;
}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ETLPaletteSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    ETLPaletteSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    ETLPaletteSideBar.prototype.constructor = ETLPaletteSideBar;

    ETLPaletteSideBar.prototype.createContent = function () {
        var _this = this;

        this.$etlSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar etlflow">' +
            '   <ul>' +
            '       <li>Function</li>' +
            '       <li>Template</li>' +
            '   </ul>' +
            '   <div class="brtc-va-tools-sidebar-palettetab" />' +
            '   <div class="brtc-va-tools-sidebar-librarytab"></div>' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$etlSideBar);

        this.tabControl = Brightics.VA.Core.Widget.Factory.tabControl(this.$etlSideBar);

        var $paletteArea = this.$etlSideBar.find('.brtc-va-tools-sidebar-palettetab');
        this.etlFlowPalette = new Brightics.VA.Core.Views.Palette($paletteArea, {
            width: '100%',
            height: '100%',
            draggable: true,
            modelType: Brightics.VA.Implementation.ETLFlow.Clazz
        });

        var $libraryArea = this.$etlSideBar.find('.brtc-va-tools-sidebar-librarytab');
        this.etlLibraryExplorer = new Brightics.VA.Core.Views.LibraryExplorer($libraryArea, {
            height: '100%',
            modelType: Brightics.VA.Implementation.ETLFlow.Clazz
        });

        this.$etlSideBar.on('selected', function(event, index) {
            if(index == 1) _this.etlLibraryExplorer.activate();
        });
    };

    ETLPaletteSideBar.prototype.appendTemplate = function (options) {
        this.etlLibraryExplorer.appendTemplate(options);
    };

    ETLPaletteSideBar.prototype.udfChanged = function (selection) {
        this.etlFlowPalette.udfChanged();
    };

    ETLPaletteSideBar.prototype.templateChanged = function (selection) {
        this.etlLibraryExplorer.templateChanged();
    };

    ETLPaletteSideBar.prototype.onActivated = function () {
        this.etlLibraryExplorer.refresh();
    };

    ETLPaletteSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.tabControl.$tabContents.find('.brtc-va-views-palette-navigator-wrapper');
    };

    ETLPaletteSideBar.prototype.destroy = function () {
        this.etlFlowPalette.destroy();
        this.etlLibraryExplorer.destroy();
    };

    Brightics.VA.Core.Tools.SideBar.ETLPaletteSideBar = ETLPaletteSideBar;
}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function FuncPropertiesSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    FuncPropertiesSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    FuncPropertiesSideBar.prototype.constructor = FuncPropertiesSideBar;

    FuncPropertiesSideBar.prototype.createContent = function () {
        this.$FuncPropertiesSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar deeplearning">' +
            '   <div class="brtc-va-tools-sidebar-funcpropertytab" />' +
            '</div>');

        this.initWidth();

        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$FuncPropertiesSideBar);

        this.$funcPropertiesArea = this.$FuncPropertiesSideBar.find('.brtc-va-tools-sidebar-funcpropertytab');
        this.funcProperties = new Brightics.VA.Core.Views.FuncProperties(this.$funcPropertiesArea, {
            width: '100%',
            height: '100%',
            panelFactory: this.getEditor().getPanelFactory(),
            modelType: Brightics.VA.Implementation.DeepLearning.Clazz
        });
    };

    FuncPropertiesSideBar.prototype.initWidth = function () {
        this.$FuncPropertiesSideBar.width(this.options.width - 40);
    };

    FuncPropertiesSideBar.prototype.selectionChanged = function (fnUnit) {
        if (fnUnit.length === 1) {
            this.show();
        }
        this.funcProperties.selectionChanged(fnUnit);
        this.preferenceTarget['scroll'].perfectScrollbar('update');
    };

    FuncPropertiesSideBar.prototype.empty = function () {
        this.funcProperties.empty();
    };

    FuncPropertiesSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.$funcPropertiesArea.find('.brtc-va-editors-sheet-panels-basepanel-contents-area');
    };

    Brightics.VA.Core.Tools.SideBar.FuncPropertiesSideBar = FuncPropertiesSideBar;
}).call(this);
/* -----------------------------------------------------
 *  input-table-sidebar.js
 *  Created by hyunseok.oh@samsung.com on 2018-03-22.
 * ---------------------------------------------------- */

/* global _, crel, IN_DATA, OUT_DATA */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var KeyItems = brtc_require('KeyItems');

    var ADD_RETURN_TABLE_OP = 'Add Input Data';
    var CHANGE_RETURN_TABLE_OP = 'Change Input Data';
    var REMOVE_RETURN_TABLE_OP = 'Remove Input Data';

    var className = {
        sideBarArea: 'brtc-va-studio-sidebar-area',
        toolsSideBar: 'brtc-va-tools-sidebar',
        styleSideBar: 'brtc-style-sidebar',
        sSideBar: 'brtc-stype-s-sidebar',
        header: [
            'brtc-style-s-font-size-13',
            'brtc-style-s-font-weight-bold',
            'brtc-style-s-font-faminly-arial',
            'brtc-style-margin-top-10',
            'brtc-style-margin-bottom-10',
            'brtc-style-padding-right-30'
        ].join(' '),
        selectedTableWrapper: [
            'brtc-va-tools-sidebar-selected-table',
            'brtc-va-editors-sheet-controls-dataselector-contents',
            'brtc-style-display-flex',
            'brtc-style-flex-direction-column'
        ].join(' '),
        selectedTableDataContainer: [
            'brtc-va-editors-sheet-controls-dataselector-contents-wrapper',
            'brtc-va-editors-sheet-controls-dataselector-item-container',
            'brtc-style-relative'
        ].join(' '),
        notSelectedItemContainer: [
            'brtc-va-editors-sheet-controls-dataselector-contents-wrapper',
            'brtc-va-editors-sheet-controls-dataselector-item-container',
            'brtc-style-relative'
        ].join(' '),
        emptyContainer: [
            'brtc-va-editors-sheet-controls-dataselector-empty-wrapper',
            'brtc-style-height-60px',
            'brtc-style-padding-right-20'
        ].join(' '),
        emptyContents: 'brtc-va-editors-sheet-controls-dataselector-empty-contents',
        inTableListWrapper: [
            'brtc-va-tools-sidebar-out-table-list-wrapper',
            'brtc-va-editors-sheet-controls-dataselector-contents-wrapper'
        ].join(' '),
        inTableListItemWrapper: 'brtc-va-tools-sidebbar-out-table-list-item-wrapper',
        dataSelectorItem: [
            'brtc-va-editors-sheet-controls-dataselector-item',
            'brtc-style-flex-start',
            'brtc-style-padding-left-20'
        ].join(' '),
        refresh: ['bcharts-ds-refresh-button', 'brtc-style-float-right'].join(' ')
    };

    function InputTableSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    InputTableSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    InputTableSideBar.prototype.constructor = InputTableSideBar;

    InputTableSideBar.prototype.createContent = function () {
        var _this = this;

        var outerClassName = [
            className.toolsSideBar,
            className.styleSideBar,
            className.sSideBar,
            'brtc-style-display-flex',
            'brtc-style-flex-direction-column'
        ].join(' ');

        var itemContainer = crel('div', {class: className.selectedTableDataContainer});

        var notSelectedItemContainer = crel('div', {class: className.notSelectedItemContainer});

        this.$itemContainerAndAddableWrapper = $(
            crel('div',  {class: 'brtc-style-relative brtc-style-padding-right-20'}, itemContainer)
        );

        var selectedTableWrapper = crel('div', {class: className.selectedTableWrapper},
            crel('div', {class: className.header}, 'Selected Data'),
            this.$itemContainerAndAddableWrapper[0]
        );

        var inTableListWrapper = crel('div', {class: className.inTableListWrapper},
            crel('div', {class: className.header}, 'In Data List'),
            notSelectedItemContainer
        );
        this.$inTableListWrapper = $(inTableListWrapper);

        this.$modelSideBar = $(
            crel('div', {class: outerClassName},
                selectedTableWrapper,
                inTableListWrapper
            )
        );

        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);
        this.$itemContainer = $(itemContainer);

        this.$notSelectedItemContainer = $(notSelectedItemContainer);
        this.$inTableContainer = $(inTableListWrapper);
        this.$itemContainer.on('sortstop', function (evt, ui) {
            var tableList = _this.getSelectedTableIds();
            _this.changeSelectedTableOrder(tableList);
        });

        this.$itemContainer.sortable({
            axis: 'y',
            cancel: '.empty',
            helper: 'clone',
            appendTo: this.$modelSideBar
        });

        this.$itemContainerAndAddableWrapper.append(this.createAddableArea());
        this.$itemContainerAndAddableWrapper.perfectScrollbar();
        this.refresh();
    };

    InputTableSideBar.prototype.onActivated = function () {
        this.refresh();
    };

    InputTableSideBar.prototype.onFnUnitSelect = function (fnUnit) {
    };

    InputTableSideBar.prototype.initPreferenceTarget = function () {
    };

    InputTableSideBar.prototype.destroy = function () {
    };

    InputTableSideBar.prototype.getFnUnitByTableId = function (tableId) {
        var _this = this;

        var mainModel = this.getEditor().getModel();
        var rec = function (model) {
            var fns = model.functions;
            for (var i = 0; i < fns.length; i++) {
                var fn = fns[i];
                if (_.indexOf(_this.FnUnitUtils.getOutData(fn), tableId) > -1) return fn;
                var subModels = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(mainModel, fn);
                for (var j = 0; j < subModels.length; j++) {
                    var subModel = subModels[j];
                    var x = rec(subModel);
                    if (x) {
                        return x;
                    }
                }
            }
            return undefined;
        };
        return rec(mainModel);
    };

    InputTableSideBar.prototype.getModelByTableId = function (tableId) {
        var mainModel = this.getEditor().getModel();
        var rec = function (model) {
            var fns = model.functions;
            for (var i = 0; i < fns.length; i++) {
                var fn = fns[i];
                if (_.indexOf(fn[OUT_DATA], tableId) > -1) return fn;
                var subModels = Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(mainModel, fn);
                for (var j = 0; j < subModels.length; j++) {
                    var subModel = subModels[j];
                    var x = rec(subModel);
                    if (x) {
                        return x;
                    }
                }
            }
            return undefined;
        };
        return rec(mainModel);
    };

    InputTableSideBar.prototype.getActiveModel = function () {
        return this.getEditor().getActiveModel();
    };

    // activeFnUnit -> 프로퍼티 패널에 뜨고 있는 fnUnit
    InputTableSideBar.prototype.getActiveFnUnit = function () {
        return this.getEditor().getActiveFnUnitOnProp();
    };

    InputTableSideBar.prototype.onModelChange = function () {
        this.refresh();
    };

    InputTableSideBar.prototype.getModelInData = function () {
        return this.getActiveModel()[IN_DATA];
    };

    InputTableSideBar.prototype.createSelectedTableElements = function (tableIds) {
        var _this = this;
        var ret = [];
        _.forEach(tableIds, function (tableId) {
            var fnUnit = _this.getFnUnitByTableId(tableId);
            if (fnUnit) {
                ret.push(_this.createSelectedItem(fnUnit, tableId));
            }
        });
        return ret;
    };

    InputTableSideBar.prototype.createNotSelectedTableElements = function (tableIds) {
        if (this.isNestedFlow()) return;

        var _this = this;
        var ret = [];
        _.forEach(tableIds, function (tableId) {
            var fnUnit = _this.getFnUnitByTableId(tableId);
            if (fnUnit) {
                ret.push(_this.createNotSelectedItem(fnUnit, tableId));
            }
        });

        if (ret.length === 0) ret.push(_this.createEmptyItem());
        return ret;
    };

    InputTableSideBar.prototype.createEmptyItem = function () {
        var $item = $(
            crel('div', {class: className.emptyContainer},
                crel('div', {class: className.emptyContents}, 'Create a function that loads data from functions in the I/O category, and set some of them to Input Data.')
            )
        );
        return $item;
    };


    InputTableSideBar.prototype.createSelectedItem = function (fnUnit, tableId) {
        var $item = this.isNestedFlow() ? this.createItemForNested(fnUnit, tableId) : this.createItem(fnUnit, tableId);
        return this.isNestedFlow() ? this.wrapSelectedItemForNested($item) : this.wrapSelectedItem($item);
    };

    InputTableSideBar.prototype.createNotSelectedItem = function (fnUnit, tableId) {
        var $item = this.createItem(fnUnit, tableId).css('cursor', 'move');
        return this.wrapNotSelectedItem($item);
    };

    InputTableSideBar.prototype.createKeyItem = function (options) {
        var fnUnit = options.fnUnit;
        var tableId = options.tableId;
        var type = options.type;

        var $item = $(crel('div', {class: className.dataSelectorItem}));
        var label = this.getTableItemLabel(fnUnit, tableId);

        var $keyItem = Brightics.VA.Core.Utils.WidgetUtils.createKeyItem({label: label, type:type});
        
        $item.append($keyItem);

        $item.attr('tid', tableId);
        $item.attr('fid', fnUnit.fid);
        // var index = fnUnit[OUT_DATA].indexOf(tableId);
        var index = this.FnUnitUtils.getOutData(fnUnit).indexOf(tableId);
        $item.attr('index', index);
        $keyItem.addClass('item');
        return $item;
    };

    InputTableSideBar.prototype.wrapSelectedItemForNested = function ($item) {
        var _this = this;
        var $itemWrapper = $(crel('div', {
            class: 'brtc-style-flex-center brtc-style-relative'
        }));

        var tid = $item.attr('tid');
        var fid = $item.attr('fid');

        $itemWrapper.append($item);

        this.attachDragEventListenerForNested($item.find('.brtc-va-studio-dm-draggable'));
        return $itemWrapper;
    };

    InputTableSideBar.prototype.wrapSelectedItem = function ($item) {
        var _this = this;
        var $itemWrapper = $(crel('div', {
            class: 'brtc-style-flex-center brtc-style-relative'
        }));

        var $removeButton = $(crel('span', {
            class: 'brtc-style-editor-content-remove-button'
        }));

        var tid = $item.attr('tid');
        var fid = $item.attr('fid');

        $removeButton.click(function () {
            _this.removeSelectedTable(tid, fid);
            $itemWrapper.remove();
        });

        $itemWrapper.append($item);
        $itemWrapper.append($removeButton);

        this.attachDropEventListener($itemWrapper, 'replace');
        return $itemWrapper;
    };

    InputTableSideBar.prototype.wrapNotSelectedItem = function ($item) {
        this.attachDragEventListener($item);
        var $itemWrapper = $(crel('div', {
            class: 'brtc-style-flex-center brtc-style-relative',
            style: 'padding-right: 20px'
        }));

        $itemWrapper.append($item);

        return $itemWrapper;
    };

    InputTableSideBar.prototype.attachDropEventListener = function ($item, mode) {
        var _this = this;
        $item.droppable({
            accept: '.brtc-style-controls-inputselector-box-wrapper.input-table',
            activate: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                $dropTarget.addClass('brtc-style-droppable-active');
            },
            deactivate: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                $dropTarget.removeClass('brtc-style-droppable-active');
                $dropTarget.removeClass('brtc-style-droppable-hover');
            },
            over: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                $dropTarget.addClass('brtc-style-droppable-hover');
            },
            out: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                $dropTarget.removeClass('brtc-style-droppable-hover');
            },
            drop: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                var $source = ui.draggable;
                $dropTarget.removeClass('brtc-style-droppable-active');
                $dropTarget.removeClass('brtc-style-droppable-hover');

                if (mode === 'replace') {
                    _this.replaceSelectedTable($source, $(this));
                } else if (mode === 'add') {
                    _this.addSelectedTable($source);
                }
            }
        });
    };

    InputTableSideBar.prototype.replaceSelectedTable = function ($from, $to) {
        var fromTableId = $from.attr('tid');
        var toTableId = this.getDropFuncTarget($to).attr('tid');
        var toTableIndex = _.indexOf(this.getModelInData(), toTableId);

        var command = this.createModelInDataUpdateCommand(
            this.getTargetModel(),
            [IN_DATA, toTableIndex],
            fromTableId);

        command.add(this.createSetSkipPropertyByTid(fromTableId, true));
        command.add(this.createSetSkipPropertyByTid(toTableId, false));

        this.getEditor().getCommandManager().execute(command);
        this.refresh();
    };

    InputTableSideBar.prototype.refresh = function () {
        if (this.isNestedFlow()) {
            this.createNestedFlowInputDataControls();
            this.$modelSideBar.find('.brtc-va-editors-sheet-controls-empty-fnunit').hide();
            this.$inTableListWrapper.hide();
            this.$itemContainer.sortable('disable');
            this.$itemContainerAndAddableWrapper.perfectScrollbar();
            this.$itemContainerAndAddableWrapper.perfectScrollbar('update');
            this.$notSelectedItemContainer.perfectScrollbar();
            this.$notSelectedItemContainer.perfectScrollbar('update');
            this.$modelSideBar.addClass('inner-flow');
        } else {
            this.createModelInputDataControls();
            this.$modelSideBar.find('.brtc-va-editors-sheet-controls-empty-fnunit').show();
            this.$inTableListWrapper.show();
            this.$itemContainer.sortable('enable');
            this.$itemContainerAndAddableWrapper.perfectScrollbar();
            this.$itemContainerAndAddableWrapper.perfectScrollbar('update');
            this.$notSelectedItemContainer.perfectScrollbar();
            this.$notSelectedItemContainer.perfectScrollbar('update');
            this.$modelSideBar.removeClass('inner-flow');
        }
    };

    InputTableSideBar.prototype.createNestedFlowInputDataControls = function () {
        this.createTableLink(this.getModelInData());
    };

    InputTableSideBar.prototype.createModelInputDataControls = function () {
        this.$selectedItems = this.createSelectedTableElements(this.getModelInData());
        this.$notSelectedItems = this.createNotSelectedTableElements(this.getInFunctions());

        this.$itemContainer.empty();
        this.$notSelectedItemContainer.empty();

        this.$itemContainer.append(this.$selectedItems);
        this.$notSelectedItemContainer.append(this.$notSelectedItems);
    };

    InputTableSideBar.prototype.createTableLink = function (tableList) {
        var _this = this;

        var activeModel = _this.getActiveModel();
        var mainModel = activeModel.getMainModel();
        var parentModel = Brightics.VA.Core.Utils.NestedFlowUtils.getParentModel(mainModel, activeModel);

        var body = {links: []};

        for (var i in tableList) {
            body.links.push({
                source: '/' + Brightics.VA.Env.Session.userId + '/' + parentModel.mid + '/' + tableList[i],
                alias: '/' + Brightics.VA.Env.Session.userId + '/' + activeModel.mid + '/' + tableList[i]
            });
        }

        var opt = {
            url: 'api/va/v2/data/link/create',
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(body),
            blocking: true
        };

        console.log(body);

        $.ajax(opt).done(function (link) {
            _this.$selectedItems = _this.createSelectedTableElements(_this.getModelInData());
            _this.$itemContainer.empty();
            _this.$notSelectedItemContainer.empty();

            _this.$itemContainer.append(_this.$selectedItems);
        }).fail(function (error) {
            Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(error);
        });
    };

    InputTableSideBar.prototype.getTableItemLabel = function (fnUnit, tableId) {
        var outputs = this.FnUnitUtils.getOutputsToObject(fnUnit);
        return outputs[tableId];
    };

    InputTableSideBar.prototype.createItemForNested = function (fnUnit, tableId) {
        var clazz = 'data';
        var $item = $(crel('div', {class: className.dataSelectorItem}));
        var $paletteItem =
            Brightics.VA.Core.Utils.WidgetUtils.createPaletteItem($item, fnUnit.func, clazz);
        var $fnUnitLabel = $paletteItem.find('.brtc-va-views-palette-fnunit-label');
        // $fnUnitLabel.text(this.getTableItemLabel(fnUnit, tableId));
        $fnUnitLabel.text(this.FnUnitUtils.getLabel(fnUnit));
        $paletteItem.addClass('item');

        Brightics.VA.Core.Utils.WidgetUtils.putData($paletteItem, 'template', fnUnit);
        return $item;
    };

    InputTableSideBar.prototype.createItem = function (fnUnit, tableId) {
        var outputs = this.FnUnitUtils.getOutputsToObject(fnUnit);
        var tableId = tableId;
        var type = this.FnUnitUtils.getTypeByTableId(fnUnit, tableId);
        var func = this.FnUnitUtils.getFunc(fnUnit);
        var label = this.FnUnitUtils.getLabel(fnUnit);

        var $item = KeyItems.create({
            key: outputs[tableId],
            tableId: tableId,
            type: type,
            func: func,
            label: label
        });

        $item.attr('tid',tableId);
        $item.addClass('input-table');

        return $item;
    };

    InputTableSideBar.prototype.getActiveModel = function () {
        return this.getEditor().getActiveModel();
    };

    InputTableSideBar.prototype.createModelInDataUpdateCommand = function (model, path, data) {
        var command = new Brightics.VA.Core.CompoundCommand(this, {
            label: CHANGE_RETURN_TABLE_OP
        });
        command.add(new Brightics.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand(this, {
            target: model,
            path: path,
            value: data
        }));
        return command;
    };

    InputTableSideBar.prototype.createModelInDataAddCommand = function (model, path, data) {
        var command = new Brightics.VA.Core.CompoundCommand(this, {
            label: ADD_RETURN_TABLE_OP
        });

        // FIXME: 스펙 없어서 임시로 넣은 로직
        if (!model[IN_DATA]) {
            command.add(new Brightics.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this, {
                target: model,
                path: [IN_DATA],
                value: []
            }));
        }

        command.add(new Brightics.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this, {
            target: model,
            path: path,
            value: data
        }));

        return command;
    };

    InputTableSideBar.prototype.createModelInDataRemoveCommand = function (model, path) {
        var command = new Brightics.VA.Core.CompoundCommand(this, {
            label: REMOVE_RETURN_TABLE_OP
        });

        command.add(new Brightics.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(this, {
            target: model,
            path: path
        }));

        return command;
    };

    InputTableSideBar.prototype.createAddableArea = function () {
        if (!this.$addableArea) {
            var $el = $(
                crel('div', {class: 'brtc-style-flex-center brtc-va-editors-sheet-controls-empty-fnunit'},
                    crel('div', {class: 'brtc-style-controls-dataselector-empty-fnunit'},
                        crel('div', 'Drop Data')
                    )
                )
            );
            $el.addClass('empty');
            this.attachDropEventListener($el, 'add');
            this.$addableArea = $el;
        }
        return this.$addableArea;
    };

    InputTableSideBar.prototype.isAcceptable = function (fn) {
        return _.isEqual(this.FnUnitUtils.getCategory(fn), 'io') 
            && !this.FnUnitUtils.hasInput(fn)
            && this.FnUnitUtils.hasOutput(fn)
            && this.FnUnitUtils.hasTable(fn);
    };

    InputTableSideBar.prototype.getInFunctions = function () {
        var _this = this;

        var ret = [];
        var mainModel = this.getEditor().getModel();
        var model = this.getEditor().getActiveModel();
        var fns = _.filter(model.functions, function (fn) {
            return _this.isAcceptable(fn);
        });
        _.forEach(fns, function (fn) {
            var outData = _this.FnUnitUtils.getOutData(fn);
            ret.push(_.filter(outData, function (tableId) {
                return _.indexOf(mainModel[IN_DATA], tableId) === -1;
            }));
        });

        return _.flatten(ret);
    };

    InputTableSideBar.prototype.attachDragEventListenerForNested = function ($item) {
        var _this = this;
        $item.draggable({
            appendTo: 'body',
            scroll: false,
            cursor: 'move',
            cursorAt: {left: 5, top: 5},
            helper: function (event) {
                var $helper = $(this).clone();
                $helper.css({'z-index': 5100});

                var activeModel = _this.getActiveModel();
                var mainModel = activeModel.getMainModel();
                var parentModel = Brightics.VA.Core.Utils.NestedFlowUtils.getParentModel(mainModel, activeModel);

                var funcType = Brightics.VA.Core.Utils.WidgetUtils.getData($item, 'template');
                var fnUnit = Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary('data', 'dataViewer').defaultFnUnit;
                fnUnit.display.label = funcType.display.label;
                fnUnit.outData = _this.FnUnitUtils.getOutTable(funcType);
                fnUnit.fid = Brightics.VA.Core.Utils.IDGenerator.func.id();
                fnUnit.display.diagram.position.x = 20;
                fnUnit.display.diagram.position.y = 10;

                fnUnit.param.mid = parentModel.mid;
                fnUnit.param.fid = funcType.fid;

                console.log(fnUnit);
                var template = {
                    functions: [fnUnit],
                    links: []
                };
                Brightics.VA.Core.Utils.WidgetUtils.putData($helper, 'template', $.extend(true, {}, template));
                Brightics.VA.Core.Utils.WidgetUtils.putData($helper, 'source', _this);
                return $helper;
            },
            start: function (event, ui) {
                $('.brtc-va-studio').addClass('brtc-va-studio-dragging');

                $(this).draggable('option', 'cursorAt', {
                    left: Math.floor(ui.helper.width() / 2),
                    top: Math.floor(ui.helper.height() / 2)
                });
            },
            drag: function (event, ui) {
                ui.helper.trigger('feedback', [{clientX: event.clientX, clientY: event.clientY}]);
            },
            stop: function (event, ui) {
                $('.brtc-va-studio').removeClass('brtc-va-studio-dragging');
            }
        });
    };

    InputTableSideBar.prototype.attachDragEventListener = function ($item) {
        $item.draggable({
            helper: function () {
                var $helper = $(this).clone();
                var width = $(this).width();
                $helper.css({
                    'z-index': 5100,
                    'width': width,
                    'height': '65px',
                    // 'line-height': '30px',
                    'overflow': 'hidden',
                    'white-space': 'nowrap',
                    'text-overflow': 'ellipsis'
                });
                return $helper;
            },
            appendTo: 'body'
        });
        return $item;
    };

    InputTableSideBar.prototype.createSetSkipPropertyByTid = function (tid, value) {
        var fnUnit = this.getFnUnitByTableId(tid);
        if (!fnUnit) return;
        var command = new Brightics.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand(this, {
            target: fnUnit,
            path: ['skip'],
            value: value
        });
        return command;
    };

    InputTableSideBar.prototype.addSelectedTable = function ($source) {
        var fromTableId = $source.attr('tid');
        var index = this.getModelInData().length;
        var command = this.createModelInDataAddCommand(
            this.getTargetModel(),
            [IN_DATA, index],
            fromTableId);
        command.add(this.createSetSkipPropertyByTid(fromTableId, true));
        this.getEditor().getCommandManager().execute(command);
    };

    InputTableSideBar.prototype.removeSelectedTable = function (tid, fid) {
        var index = _.indexOf(this.getModelInData(), tid);
        var command = this.createModelInDataRemoveCommand(this.getTargetModel(), [IN_DATA, index]);
        command.add(this.createSetSkipPropertyByTid(tid, false));
        this.getEditor().getCommandManager().execute(command);
    };

    InputTableSideBar.prototype.getTargetModel = function () {
        return this.getEditor().getModel();
    };

    InputTableSideBar.prototype.getSelectedTableIds = function () {
        return _.map(this.$itemContainer.children(), function (item) {
            var tid = $(item).find('.' + className.dataSelectorItem).attr('tid');
            return tid;
        });
    };

    InputTableSideBar.prototype.changeSelectedTableOrder = function (tableList) {
        var model = this.getTargetModel();
        var changed = tableList.length !== model[IN_DATA].length;
        if (!changed) {
            for (var i = 0; i < model[IN_DATA].length; i++) {
                if (tableList[i] !== model[IN_DATA][i]) {
                    changed = true;
                    break;
                }
            }
        }

        if (changed) {
            var command = this.createModelInDataUpdateCommand(model, [IN_DATA], tableList);
            this.getEditor().getCommandManager().execute(command);
        }
    };

    InputTableSideBar.prototype.getDropFuncTarget = function ($itemWrapper) {
        var ret = $itemWrapper.find('.' + className.dataSelectorItem);
        if (ret.length) return ret;
        return $itemWrapper;
    };

    InputTableSideBar.prototype.isNestedFlow = function () {
        var activeFnUnit = this.getEditor().getActiveFnUnit();
        return activeFnUnit &&
            (activeFnUnit.func === 'if' ||
            activeFnUnit.func === 'forLoop' ||
            activeFnUnit.func === 'whileLoop');
    };

    Brightics.VA.Core.Tools.SideBar.InputTableSideBar = InputTableSideBar;
    /* eslint-disable no-invalid-this */
}).call(this);

/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ObjectAndPropertiesSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    ObjectAndPropertiesSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    ObjectAndPropertiesSideBar.prototype.constructor = ObjectAndPropertiesSideBar;

    ObjectAndPropertiesSideBar.prototype.createContent = function () {
        var _this = this;

        this.$modelSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar visual">' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);

        this.optionPanelManager = new Brightics.VA.Implementation.Visual.Views.OptionPanelManager(this.$modelSideBar, {
            width: '100%',
            height: '100%',
            editor: this.getEditor()
        });

    };

    ObjectAndPropertiesSideBar.prototype.selectionChanged = function (selection) {
        if (this.getEditor().getModelClazz() == Brightics.VA.Implementation.Visual.Clazz) {
            this.optionPanelManager.selectionChanged(selection);
        }
    };

    ObjectAndPropertiesSideBar.prototype.destroy = function (editor) {
        this.optionPanelManager.destroy(editor);
    };

    ObjectAndPropertiesSideBar.prototype.configureSize = function () {
        this.$parent.find('.brtc-va-studio-sidebar-area').width(this.options.width);
    };

    ObjectAndPropertiesSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.$modelSideBar.find('.bcharts-ds-panel');
    };

    Brightics.VA.Core.Tools.SideBar.ObjectAndPropertiesSideBar = ObjectAndPropertiesSideBar;
}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */

(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function OptSettingSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    OptSettingSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    OptSettingSideBar.prototype.constructor = OptSettingSideBar;

    OptSettingSideBar.prototype.createContent = function () {
        var _this = this;

        this.commandListener = function (command) {
            _this.handleCommand(command);
        };
        this.options.manager.editor.addCommandListener(this.commandListener);
        this.options.manager.editor.addGoHistoryListener(this.commandListener);

        var unbindButtonStyle = `
            width: 100%;
            height: 30px;
            background-color: #6c79e9;
            color: #fff;
            text-align: center;
            line-height: 30px;
            margin: 10px 0;
            cursor: pointer;
        `;

        var contentsWrapperStyle = `
            overflow: hidden;
            height: 100%;
            position: relative;
            padding-right: 20px;
        `;

        var contentsWrapperDivStyle = `
            width: 100%;
            height: auto;
            margin-bottom: 10px;
        `;

        this.$modelSideBar = $(`
            <div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar dataflow optsidebar">
               <div class="brtc-va-tools-sidebar-contents-wrapper" style="${contentsWrapperStyle}">
                   <div style="${contentsWrapperDivStyle}">
                       <div class="brtc-opt-model-dropdownlist"></div>
                       <div class="brtc-opt-model-delete-button" style="${unbindButtonStyle}">
                       Unbind OPT</div>
                       <div class="brtc-opt-model-detail-view"></div>
                   </div>
               </div>
            </div>`);
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);
        this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar();

        this.createOptModelDropDownList();
        this.createOptModelDeleteButton();

        this.createDetailView();
        this.render();
    };

    OptSettingSideBar.prototype.createOptModelDropDownList = function () {
        var _this = this;
        var source = this._getDropDownListSource();

        this.$dropdownList = this.$modelSideBar.find('.brtc-opt-model-dropdownlist');
        this.$dropdownList.jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            source: source,
            selectedIndex: 0,
            checkboxes: false,
            width: 325,
            height: 25,
            openDelay: 0,
            closeDelay: 0,
            autoDropDownHeight: true,
            displayMember: 'text',
            valueMember: 'value'
        });

        this.$dropdownList.on('select', function (event) {
            var args = event.args;
            if (args) {
                var item = args.item;
                var value = item.value;
                if (args.type === "mouse" || args.type === "keyboard") {
                    _this.createDetailView(value);
                    _this.render(value);
                }
            }
        });
    };

    OptSettingSideBar.prototype._getDropDownListSource = function () {
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var pid = activeModelEditor.getEditorInput().getProjectId();
        var mid = activeModelEditor.getEditorInput().getFileId();
        var optModels = Brightics.OptModelManager.getOptModels(pid, mid);
        var source = [];
        if (optModels[0]) {
            for (var i = 0; i < optModels.length; i++) {
                source.push({
                    'text': optModels[i].label,
                    'value': optModels[i]['optId']
                })
            }
        }
        return source;
    };

    OptSettingSideBar.prototype.createOptModelDeleteButton = function () {
        var _this = this;
        this.$optModelDeleteButton = this.$modelSideBar.find('.brtc-opt-model-delete-button');
        this.$optModelDeleteButton.click(function () {
            var message = 'Are you sure you want to unbind this optimization model?';
            Brightics.VA.Core.Utils.WidgetUtils.openConfirmDialog(message, function (dialogResult) {
                if (dialogResult.OK) {
                    var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
                    var pid = activeModelEditor.getEditorInput().getProjectId();
                    var mid = activeModelEditor.getEditorInput().getFileId();
                    var optId = _this.$dropdownList.val();
                    if (optId && Brightics.OptModelManager.getOptModel(pid, mid, optId)) {
                        var commandManager = activeModelEditor.getCommandManager();
                        var command = Brightics.OptModelManager.createRemoveOptModelCommand(pid, mid, optId);
                        commandManager.execute(command);
                    }
                }
            });
        });
    };

    OptSettingSideBar.prototype.createDetailView = function (optId) {
        this.$detailView = this.$modelSideBar.find(".brtc-opt-model-detail-view");
        this.$detailView.empty();

        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var pid = activeModelEditor.getEditorInput().getProjectId();
        var mid = activeModelEditor.getEditorInput().getFileId();

        if (!optId) {
            var models = Brightics.OptModelManager.getOptModels(pid, mid);
            if (models[0]) {
                optId = models[0]['optId'];
            }
        }

        this.optModel = Brightics.OptModelManager.getOptModel(pid, mid, optId);
        if (this.optModel) {
            this.createDetailViewControls(this.$detailView);
        } else {
            this.resetDropDownList();
        }
    };

    OptSettingSideBar.prototype.createDetailViewControls = function ($parent) {
        this.$controls = {
            'options': {
                'objective': {
                    'functionLabel': null,
                    'tableLabel': null,
                    'row': null,
                    'column': null,
                    'sense': null
                },
                'maxEvaluations': null,
                'method': null
            }
        };

        var controlsStyle = `
            margin-bottom:30px;
        `;
        var $controls = $(`<div style="${controlsStyle}"></div>`);
        this.$detailViewControls = $controls;

        $parent.append($controls);
        $controls.append(`
            <style>
                .brtc-opt-model-detail-view .jqx-expander-header-content-office {
                    margin-left: 0 !important;
                }

                .brtc-va-tools-sidebar .brtc-opt-model-selected-function-controls-area div.jqx-expander-header-expanded {
                    border: none;
                }

                .brtc-va-tools-sidebar .brtc-opt-model-selected-function-controls-area .jqx-expander-arrow {
                    margin-top: 6px !important;
                }

                .brtc-va-tools-sidebar .brtc-opt-model-selected-function-controls-area div.jqx-expander-content {
                    margin-bottom: 0;
                }
                    
                .brtc-opt-model-selected-function-controls-area .jqx-expander-arrow-top-office {
                    background-image: url(/css/plugins/aui-package/images/office-icon-right.png);
                }
                
                .brtc-opt-model-selected-function-controls-area .jqx-expander-arrow-bottom-office {
                    background-image: url(/css/plugins/aui-package/images/office-icon-down.png);
                }

                .brtc-opt-param-label-row .jqx-checkbox-default-office {
                    margin-right: 5px;
                    margin-left: 0;
                }

                .brtc-opt-objective-data {
                    width: 235px;
                    height: 26px;
                    font-family: Arial, helvetica, sans-serif;
                    border: 1px solid #d4d4d4;
                    line-height: 24px;
                    padding-left: 10px;
                    padding-right: 10px;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    white-space: nowrap;
                    box-sizing: border-box;
                    color: rgba(0, 0, 0, .8);
                    cursor: default;
                    background-color: #fff;
                    opacity: .55;
                }

                .brtc-opt-function-select-button {
                    display: inline-block;
                    box-sizing: border-box;
                    text-align: center;
                    cursor: pointer;
                    float: left;
                    font-weight: normal;
                    font-size: 12px;

                    width: 55px;
                    height: 24px;

                    border: 1px solid #656eea;

                    background-color: #fff;
                    color: #656eea;
                }

                .brtc-opt-function-select-button.selected {
                    background-color: #656eea;
                    color: #FFFFFF;
                }

                .brtc-opt-function-select-button + .brtc-opt-function-select-button {
                    border-left: none;
                }
            </style>
        `);

        // TODO
        // this.createLabelControl($controls);
        // this.createDescriptionControl($controls);
        // this.createContinueControl($controls);
        this.createObjectiveControl($controls);
        this.createSelectedFunctionsControl($controls);
        this.createAdvancedSettingControl($controls);
    };

    OptSettingSideBar.prototype.createLabelControl = function ($parent) {
        var _this = this;
        var $area = $('<div></div>');
        $parent.append($area);

        var $title = $('<div style="margin-bottom: 3px;">Label</div>');
        $area.append($title);

        var $control = $('<input type="text"/>');
        $area.append($control);
        $control.jqxInput({
            placeHolder: 'Enter label',
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 25
        });
        $control.val(this.optModel.label);

        $control.on('change', function (event) {
            var args = event.args;
            if (args && args.type != null) {
                var value = $(this).val();
                _this.executeSetOptModelCommand({
                    label: value
                });
            }
        });
    };

    OptSettingSideBar.prototype.createDescriptionControl = function ($parent) {
        var _this = this;
        var $area = $('<div></div>');
        $parent.append($area);

        var $title = $('<div style="margin: 7px 0 3px 0;">Description</div>');
        $area.append($title);

        var $control = $('<input type="text"/>');
        $area.append($control);
        $control.jqxInput({
            placeHolder: 'Enter description',
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 25
        });
        $control.val(this.optModel.description);

        $control.on('change', function (event) {
            var args = event.args;
            if (args && args.type != null) {
                var value = $(this).val();
                _this.executeSetOptModelCommand({
                    description: value
                });
            }
        });
    };

    OptSettingSideBar.prototype.createContinueControl = function ($parent) {
        var _this = this;
        var $area = $('<div></div>');
        $parent.append($area);

        var controlStyle =
            'margin-top: 11px;';
        var $control = $(`<div style="${controlStyle}">Continue from saved model</div>`);
        $area.append($control);
        $control.jqxCheckBox({
            theme: Brightics.VA.Env.Theme
        });
        var useSavedModel = (this.optModel.options.useSavedModel === "true");
        $control.jqxCheckBox('val', useSavedModel);

        $control.on('change', function (event) {
            var checked = event.args.checked;
            var useSavedModel = (checked) ? ("true") : ("false");
            if (_this.optModel.options.useSavedModel != useSavedModel) {
                _this.optModel.options.useSavedModel = useSavedModel;

                _this.executeSetOptModelCommand({
                    options: _this.optModel.options
                }, { key: 'useSavedModel' });
            }
        });
    };

    OptSettingSideBar.prototype.createObjectiveControl = function ($parent) {
        var _this = this;
        var $area = $('<div></div>');
        $parent.append($area);

        var titleStyle = `
            font-weight: bold;
            height: 17px;
            line-height: 17px;
            margin-left: 0;
        `;
        var $title = $(`<div style="${titleStyle}">Objective</div>`);
        $area.append($title);

        var $controls = $('<div style="padding-top:8px;"></div>');
        $area.append($controls);

        this.createSelectObjectiveButton($controls);

        var controlsContainerStyle = `
            margin-top: 10px;
            margin-bottom: 10px;
        `;
        var $controlsContainer = $(`<div style="${controlsContainerStyle}"></div>`);
        $controls.append($controlsContainer);

        this.createFunctionLabelControl($controlsContainer);
        this.createTableLabelControl($controlsContainer);
        this.createRowControl($controlsContainer);
        this.createColumnControl($controlsContainer);
        this.createSenseControl($controlsContainer);

        $area.jqxExpander({
            theme: Brightics.VA.Env.Theme,
            arrowPosition: 'right',
            expanded: true
        });
        $area.on('expanded', function () {
            _this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar('update');
        });
        $area.on('collapsed', function () {
            _this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar('update');
        });
    };

    OptSettingSideBar.prototype.createSelectObjectiveButton = function ($parent) {
        var _this = this;
        var $button = $('<input type="button" value="+ Select Objective"/>');
        $parent.append($button);

        $button.jqxButton({
            theme: Brightics.VA.Env.Theme,
            width: '100%',
            height: 30
        });

        $button.on('click', this.openOptSelectObjectiveDialog.bind(_this));

        this.$selectObjectiveButton = $button;
    };

    OptSettingSideBar.prototype.openOptSelectObjectiveDialog = function (event) {
        var _this = this;
        new Brightics.VA.Core.Dialogs.OptSelectObjectiveDialog(_this, {
            functions: _this.getFunctionsInfo(),
            objective: $.extend(true, {}, _this.optModel.options.objective),
            close: function (dialogResult) {
                if (dialogResult.OK) {
                    _this.optModel.options.objective = dialogResult.objective;
                    _this.executeSetOptModelCommand({
                        options: _this.optModel.options
                    }, { key: 'objective' });
                }
            }
        });
    };

    OptSettingSideBar.prototype.appendObjectiveParamRow = function ($parent, label) {
        var labelRowStyle = `
            display: flex;
            margin-bottom: 5px;
        `;
        var $labelRow = $(`<div style="${labelRowStyle}"></div>`);
        $parent.append($labelRow);

        var labelStyle = `
            margin: 0 0 4px 0;
            width: 95px;
            line-height: 22px;
        `;
        var $label = $(`<div style="${labelStyle}">${label}</div>`);
        $labelRow.append($label);

        var $labelControl = $(`<div class="brtc-opt-objective-data"></div>`);
        $labelRow.append($labelControl);

        return $labelControl;
    };

    OptSettingSideBar.prototype.createFunctionLabelControl = function ($parent) {
        this.$controls.options.objective.functionLabel =
            this.appendObjectiveParamRow($parent, 'Function');
    };

    OptSettingSideBar.prototype.createTableLabelControl = function ($parent) {
        this.$controls.options.objective.tableLabel =
            this.appendObjectiveParamRow($parent, 'Table Name');
    };

    OptSettingSideBar.prototype.createRowControl = function ($parent) {
        this.$controls.options.objective.row =
            this.appendObjectiveParamRow($parent, 'Row Number');
    };

    OptSettingSideBar.prototype.createColumnControl = function ($parent) {
        this.$controls.options.objective.column =
            this.appendObjectiveParamRow($parent, 'Column Name');
    };

    OptSettingSideBar.prototype.createSenseControl = function ($parent) {
        this.$controls.options.objective.sense =
            this.appendObjectiveParamRow($parent, 'Sense');
    };

    OptSettingSideBar.prototype.createSelectedFunctionsControl = function ($parent) {
        var _this = this;
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getEditorInput().getContents();

        this.$controls.optFunctions = {};
        if (this.$functionsArea) {
            this.$functionsArea.remove();
        }

        var $area = $('<div></div>');
        $parent.append($area);
        this.$functionsArea = $area;

        var titleStyle = `
            font-weight: bold;
            height: 17px;
            line-height: 17px;
            margin-left: 0;
        `;
        var $title = $(`<div style="${titleStyle}">Parameters</div>`);
        $area.append($title);

        var $controls = $(`
            <div class="brtc-opt-model-selected-function-controls-area" style="padding-top:8px;">
            </div>`);
        $area.append($controls);

        var optFunctions = this.optModel.optFunctions;
        for (var i = 0; i < optFunctions.length; i++) {
            if (optFunctions[i].optSelected === 'none') continue;
            var originalFuction = contents.getFnUnitById(optFunctions[i].fid);            
            if (!originalFuction || !originalFuction.display) continue;
            if (!Brightics.VA.Core.Functions.Library[originalFuction.func]) continue;

            (function (optFunctions, i) {
                var fid = optFunctions[i].fid;
                var functionControlWrapperStyle = `
                    margin-bottom: 0;
                `;
                var $functionControlWrapper = $(`<div style="${functionControlWrapperStyle}"></div>`);
                $functionControlWrapper.attr('fid', fid);
                $controls.append($functionControlWrapper);

                var $functionInfoRow = $('<div style="display:flex;"></div>');
                $functionControlWrapper.append($functionInfoRow);

                var originalFuction = contents.getFnUnitById(fid);                
                var functionLabel = originalFuction.display.label;
                var functionCategory = Brightics.VA.Core.Functions.Library[originalFuction.func].category;
                _this.createFunctionLabel($functionInfoRow, functionLabel, fid, functionCategory);
                _this.createFunctionSelectControl($functionInfoRow, optFunctions, i);

                var paramInfoWrapperStyle = `
                    padding-top: 10px;
                `;
                var $paramInfoWrapper = $(`<div style="${paramInfoWrapperStyle}"></div>`);
                $functionControlWrapper.append($paramInfoWrapper);
                var optParam = optFunctions[i].optParam;
                for (var param in optParam) {
                    (function (optParam, param) {
                        var paramControlStyle = `                            
                            margin-bottom: 10px;
                            margin-left: 18px;
                        `;
                        var $paramControl = $(`<div style="${paramControlStyle}"></div>`);
                        $paramControl.attr('fid', fid);
                        $paramInfoWrapper.append($paramControl);

                        var rowStyle = `
                            display: flex;
                            margin-bottom: 4px;
                        `;
                        var $paramLabelRow = $(`<div class="brtc-opt-param-label-row" style="${rowStyle}"></div>`);
                        $paramControl.append($paramLabelRow);

                        _this.createParamSelectControl($paramLabelRow, i, fid, param);
                        _this.createParamLabel($paramLabelRow, param);

                        var containerStyle = `
                            padding: 10px 10px 5px 10px;
                            background-color: #f2f2f2;
                        `
                        var $div = $(`<div style="${containerStyle}"></div>`);
                        $paramControl.append($div)

                        _this.createParamTypeControl($div, fid, param);
                        _this.createParamInitValueControl($div, fid, param);

                        if (optParam[param].type === 'DISCRETE_RANGE'
                            || optParam[param].type === 'CONTINUOUS') {
                            _this.createParamMinControl($div, fid, param);
                            _this.createParamMaxControl($div, fid, param);
                        } else {
                            // case: DISCRETE_SET_INTEGER, DISCRETE_SET_STRING
                            _this.createParamSetControl($div, fid, param);
                        }

                    })(optParam, param);
                }
                $functionControlWrapper.jqxExpander({
                    theme: Brightics.VA.Env.Theme,
                    arrowPosition: 'left',
                    expanded: false
                });
                $functionControlWrapper.on('expanded', function () {
                    _this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar('update');
                });
                $functionControlWrapper.on('collapsed', function () {
                    _this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar('update');
                });
            })(optFunctions, i);
        }

        $area.jqxExpander({
            theme: Brightics.VA.Env.Theme,
            arrowPosition: 'right',
            expanded: true
        });
        $area.on('expanded', function () {
            _this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar('update');
        });
        $area.on('collapsed', function () {
            _this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar('update');
        });
    };

    OptSettingSideBar.prototype.createFunctionLabel = function ($parent, label, fid, category) {
        category = category || 'io';

        var labelStyle = `
            box-sizing: border-box;
            width: 190px;
            height: 32px;
            line-height: 32px;
            font-size: 12px;            
            font-family: Arial, Dotum, Tahoma, sans-serif;
            font-weight: bold;            
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 8px;
            margin-left: 16px;
            display: flex;
        `;

        var labelStyle2 = `       
            width: 223px;   
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        `;

        var $functionLabel = $(`
            <div class="brtc-va-fnunit-category-${category}" style="${labelStyle}">
                <div class="brtc-style-views-palette-fnunit-icon" style="margin-top: 5px;"></div>
                <div class="brtc-opt-function-label" style="${labelStyle2}"></div>
            </div>
        `);

        $functionLabel.find('.brtc-opt-function-label').text(label);
        $functionLabel.attr('title', label);
        $parent.append($functionLabel);
    };

    OptSettingSideBar.prototype.createFunctionSelectControl = function ($parent, optFunctions, i) {
        var _this = this;
        var functionSelectedStyle = `
            width: 110px;
            margin-top: 5px;
        `;

        var $optSelectedControl = $(`
            <div style="${functionSelectedStyle}">
                <button class="brtc-opt-function-select-button" value="true">Use</button>
                <button class="brtc-opt-function-select-button" value="false">Unuse</button>
            </div>`);
        $parent.append($optSelectedControl);

        var fid = optFunctions[i].fid;

        this.$controls.optFunctions[fid] =
            this.$controls.optFunctions[fid] ||
            {
                'optSelected': null,
                'optParam': {}
            };

        this.$controls.optFunctions[fid].optSelected = $optSelectedControl;

        $optSelectedControl.find('button').click(function (event) {
            var _optSelected = $(this).attr('value');

            var target = _this.optModel.optFunctions[i];
            if (target.optSelected != _optSelected) {
                target.optSelected = _optSelected;
                _this.executeSetOptModelCommand({
                    optFunctions: _this.optModel.optFunctions
                }, { fid: fid, key: 'optSelected' });
            }
            event.stopPropagation();
        });
    };

    OptSettingSideBar.prototype.createParamLabel = function ($parent, param) {
        var paramLabelStyle = `
            text-transform: capitalize;
            margin-right: 3px;
            padding-top: 2px;
            width: 100%;
        `;
        var $paramLabel = $(`<div style="${paramLabelStyle}"></div>`);
        $paramLabel.text(param.replace(/-/g, ' '));
        $parent.append($paramLabel);
    };

    OptSettingSideBar.prototype.createParamSelectControl = function ($parent, index, fid, param) {
        var _this = this;
        var paramSelectStyle = ``;
        var $paramSelectControl = $(`<div style="${paramSelectStyle}"></div>`);
        $parent.append($paramSelectControl);

        this.$controls.optFunctions[fid].optParam[param] =
            this.$controls.optFunctions[fid].optParam[param] ||
            {
                'optParamSelected': null
            };

        this.$controls.optFunctions[fid].optParam[param].optParamSelected =
            $paramSelectControl.jqxCheckBox({
                theme: Brightics.VA.Env.Theme
            });

        $paramSelectControl.click(function (event) {
            event.stopPropagation();
        });

        $paramSelectControl.on('change', function (event) {
            var checked = event.args.checked;
            var _paramSelected = (checked) ? ("true") : ("false");

            var target = _this.optModel.optFunctions[index].optParam[param];
            if (target.optParamSelected != _paramSelected) {
                target.optParamSelected = _paramSelected;
                _this.executeSetOptModelCommand({
                    optFunctions: _this.optModel.optFunctions
                }, { fid: fid, param: param, key: 'optParamSelected' });
            }
        });
    };

    OptSettingSideBar.prototype.appendFunctionParamRow = function ($parent, label, placeholder, disabled) {
        var $div = $(`<div style="display: flex; margin-bottom: 5px;"></div>`);
        $parent.append($div);

        var labelStyle = `
            height: 25px;
            line-height: 25px;
            width: 75px;
        `;
        var $label = $(`<div style="${labelStyle}">${label}</div>`);
        $div.append($label);

        var $control = $(`<input type="text"/>`);
        $div.append($control);

        $control.jqxInput({
            placeHolder: placeholder,
            theme: Brightics.VA.Env.Theme,
            width: 214,
            height: 25,
            disabled: disabled
        });
        return $control;
    };

    OptSettingSideBar.prototype.createParamTypeControl = function ($parent, fid, param) {
        var $control = this.appendFunctionParamRow($parent, 'Type', 'Enter type', true);
        this.$controls.optFunctions[fid].optParam[param].type = $control;
    };

    OptSettingSideBar.prototype.createParamInitValueControl = function ($parent, fid, param) {
        var _this = this;
        var $control = this.appendFunctionParamRow($parent, 'Initial Value', 'Enter initial value');
        $control.on('change', function (event) {
            var args = event.args;
            if (args && args.type != null) {
                var value = $(this).val();
                for (var i in _this.optModel.optFunctions) {
                    if (_this.optModel.optFunctions[i].fid === fid) {
                        _this.optModel.optFunctions[i].optParam[param].value = value;
                        break;
                    }
                }
                _this.executeSetOptModelCommand({
                    optFunctions: _this.optModel.optFunctions
                }, { fid: fid, param: param, key: 'value' });
            }
        });

        this.$controls.optFunctions[fid].optParam[param].value = $control;
    };

    OptSettingSideBar.prototype.createParamMinControl = function ($parent, fid, param) {
        var _this = this;
        var $control = this.appendFunctionParamRow($parent, 'Min', 'Enter min');
        $control.on('change', function (event) {
            var args = event.args;
            if (args && args.type != null) {
                var value = $(this).val();
                for (var i in _this.optModel.optFunctions) {
                    if (_this.optModel.optFunctions[i].fid === fid) {
                        _this.optModel.optFunctions[i].optParam[param].min = value;
                        break;
                    }
                }
                _this.executeSetOptModelCommand({
                    optFunctions: _this.optModel.optFunctions
                }, { fid: fid, param: param, key: 'min' });
            }
        });

        this.$controls.optFunctions[fid].optParam[param].min = $control;
    };

    OptSettingSideBar.prototype.createParamMaxControl = function ($parent, fid, param) {
        var _this = this;
        var $control = this.appendFunctionParamRow($parent, 'Max', 'Enter max');
        $control.on('change', function (event) {
            var args = event.args;
            if (args && args.type != null) {
                var value = $(this).val();
                for (var i in _this.optModel.optFunctions) {
                    if (_this.optModel.optFunctions[i].fid === fid) {
                        _this.optModel.optFunctions[i].optParam[param].max = value;
                        break;
                    }
                }
                _this.executeSetOptModelCommand({
                    optFunctions: _this.optModel.optFunctions
                }, { fid: fid, param: param, key: 'max' });
            }
        });

        this.$controls.optFunctions[fid].optParam[param].max = $control;
    };

    OptSettingSideBar.prototype.createParamSetControl = function ($parent, fid, param) {
        var _this = this;
        var $control = this.appendFunctionParamRow($parent, 'Value Set', 'Enter value set');
        $control.on('change', function (event) {
            var args = event.args;
            if (args && args.type != null) {
                var value = $(this).val();
                var set = value.split(',').map(function (a) {
                    return a.replace(/ /g, '')
                });
                for (var i in _this.optModel.optFunctions) {
                    if (_this.optModel.optFunctions[i].fid === fid) {
                        _this.optModel.optFunctions[i].optParam[param].set = set;
                        break;
                    }
                }
                _this.executeSetOptModelCommand({
                    optFunctions: _this.optModel.optFunctions
                }, { fid: fid, param: param, key: 'set' });
            }
        });

        this.$controls.optFunctions[fid].optParam[param].set = $control;
    };

    OptSettingSideBar.prototype.createAdvancedSettingControl = function ($parent) {
        var _this = this;
        var $area = $('<div></div>');
        $parent.append($area);

        var titleStyle = `
            font-weight: bold;
            height: 17px;
            line-height: 17px;
            margin-left: 0;
        `;
        var $title = $(`<div style="${titleStyle}">Advanced Settings</div>`);
        $area.append($title);

        var $controls = $('<div style="padding-top:8px; margin-bottom: 80px;"></div>');
        $area.append($controls);

        this.createMethodControl($controls);
        this.createMaxEvaluationsControl($controls);

        $area.jqxExpander({
            theme: Brightics.VA.Env.Theme,
            arrowPosition: 'right',
            expanded: false
        });
        $area.on('expanded', function () {
            _this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar('update');
        });
        $area.on('collapsed', function () {
            _this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper').perfectScrollbar('update');
        });
    };

    OptSettingSideBar.prototype.createMethodControl = function ($parent) {
        var _this = this;
        $parent.append('<div style="margin: 3px 0 4px 0;">Method</div>');
        var $methodControl = $('<div style="width:"></div>');
        $parent.append($methodControl);

        var source = [
            { 'text': 'Soga', 'value': 'SOGA' },
            { 'text': 'Coliny Cobyla', 'value': 'COLINY_COBYLA' },
            { 'text': 'Coliny Direct', 'value': 'COLINY_DIRECT' },
            { 'text': 'Conmin MFD', 'value': 'CONMIN_MFD' },            
            { 'text': 'Mesh Adaptive Search', 'value': 'MESH_ADAPTIVE_SEARCH' }
        ];

        this.$controls.options.method = $methodControl.jqxDropDownList({
            theme: Brightics.VA.Env.Theme,
            source: source,
            checkboxes: false,
            width: 325,
            height: 25,
            openDelay: 0,
            closeDelay: 0,
            autoDropDownHeight: true,
            displayMember: 'text',
            valueMember: 'value'
        });

        $methodControl.on('select', function (event) {
            var args = event.args;
            if (args) {
                var item = args.item;
                var value = item.value;
                if (args.type === 'mouse' || args.type === 'keyboard') {
                    _this.optModel.options.method = value;
                    _this.executeSetOptModelCommand({
                        options: _this.optModel.options
                    }, { key: 'method' });
                }
            }
        });
    };

    OptSettingSideBar.prototype.createMaxEvaluationsControl = function ($parent) {
        var _this = this;
        $parent.append('<div style="margin: 10px 0 4px 0;">Max Evaluations</div>');
        var $maxEvaluationsControl = $('<div></div>');
        $parent.append($maxEvaluationsControl);

        var widgetOptions = {
            numberType: 'int',
            min: 1,
            max: 9999,
            minus: false,
            placeholder: 'Enter max evaluations'
        };

        this.$controls.options.maxEvaluations =
            new Brightics.VA.Core.Editors.Sheet.Controls.NumericInput(
                $maxEvaluationsControl, widgetOptions);

        this.$controls.options.maxEvaluations.onChange(function (value) {
            _this.optModel.options.maxEvaluations = value;
            _this.executeSetOptModelCommand({
                options: _this.optModel.options
            }, { key: 'maxEvaluations' });
        });
    };

    OptSettingSideBar.prototype.render = function (optId) {
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var pid = activeModelEditor.getEditorInput().getProjectId();
        var mid = activeModelEditor.getEditorInput().getFileId();

        if (!optId) {
            var models = Brightics.OptModelManager.getOptModels(pid, mid);
            if (models[0]) {
                optId = models[0]['optId'];
            }
        }

        this.optModel = Brightics.OptModelManager.getOptModel(pid, mid, optId);
        if (this.optModel) {
            this.resetDropDownList();
            this.renderOptModelDropDownList(optId);
            this.renderDetailViewControls();
            this.renderValidation();
        }
    };

    OptSettingSideBar.prototype.renderOptModelDropDownList = function (optId) {
        this.$dropdownList.val(optId);
    };

    OptSettingSideBar.prototype.renderDetailViewControls = function () {
        var optModel = this.optModel;
        this.$detailViewControls.attr('opt-id', optModel['optId']);

        this.renderObjectiveControl();
        this.renderSelectedFunctionsControl();
        this.renderAdvancedSettingControl();
    };

    OptSettingSideBar.prototype.renderObjectiveControl = function () {
        this.renderFunctionLabelControl();
        this.renderTableLabelControl();
        this.renderRowControl();
        this.renderColumnControl();
        this.renderSenseControl();
    };

    OptSettingSideBar.prototype.renderObjectiveParamRow = function ($control, data, placeholder) {
        if (data) {
            $control.text(data);
            $control.attr('title', data);
        } else {
            $control.text(placeholder);
        }
    };

    OptSettingSideBar.prototype.renderFunctionLabelControl = function () {
        var fid = this.optModel.options.objective.fid;
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getEditorInput().getContents();
        var fnUnit = contents.getFnUnitById(fid);
        var functionLabel = (fnUnit) ? (fnUnit.display.label) : ("");
        var $control = this.$controls.options.objective.functionLabel;
        this.renderObjectiveParamRow($control, functionLabel, '');
    };

    OptSettingSideBar.prototype.renderTableLabelControl = function () {
        var fid = this.optModel.options.objective.fid;
        var tableId = this.optModel.options.objective.tableName;
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getEditorInput().getContents();
        var fnUnit = contents.getFnUnitById(fid);
        var functionLabel = (fnUnit) ? (fnUnit.display.label) : ("");
        var tableLabel;
        if (fnUnit) {
            var outData = fnUnit['outData'];
            for (var i in outData) {
                if (outData[i] === tableId) {
                    tableLabel = functionLabel + '-' + (Number(i) + 1);
                    break;
                }
            }
        }
        var $control = this.$controls.options.objective.tableLabel;
        this.renderObjectiveParamRow($control, tableLabel, '');
    };

    OptSettingSideBar.prototype.renderRowControl = function () {
        var data = this.optModel.options.objective.row;
        var $control = this.$controls.options.objective.row;
        this.renderObjectiveParamRow($control, data, '');
    };

    OptSettingSideBar.prototype.renderColumnControl = function () {
        var data = this.optModel.options.objective.column;
        var $control = this.$controls.options.objective.column;
        this.renderObjectiveParamRow($control, data, '');
    };

    OptSettingSideBar.prototype.renderSenseControl = function () {
        var sense = this.optModel.options.objective.sense;
        var data = sense.charAt(0).toUpperCase() + sense.slice(1);
        var $control = this.$controls.options.objective.sense;
        this.renderObjectiveParamRow($control, data, '');
    };

    OptSettingSideBar.prototype.renderSelectedFunctionsControl = function () {
        var _this = this;
        var optFunctions = this.optModel.optFunctions;
        for (var i = 0; i < optFunctions.length; i++) {
            if (optFunctions[i].optSelected === 'none') continue;
            (function (optFunctions, i) {
                var optFunction = optFunctions[i];
                _this.renderFunctionSelectControl(optFunction);

                var optParam = optFunction.optParam;
                for (var param in optParam) {
                    (function (param) {
                        _this.renderParamSelectControl(optFunction, param);
                        _this.renderParamTypeControl(optFunction, param);
                        _this.renderParamInitValueControl(optFunction, param);

                        var type = optFunction.optParam[param].type;
                        if (type === 'DISCRETE_RANGE' || type === 'CONTINUOUS') {
                            _this.renderParamMinControl(optFunction, param);
                            _this.renderParamMaxControl(optFunction, param);
                        } else {
                            // type == 'DISCRETE_SET_INTEGER', 'DISCRETE_SET_STRING'
                            _this.renderParamSetControl(optFunction, param);
                        }
                    })(param);
                }
            })(optFunctions, i);
        }
    };

    OptSettingSideBar.prototype.renderFunctionSelectControl = function (optFunction) {
        var fid = optFunction.fid;
        var data = optFunction.optSelected;

        if (this.$controls.optFunctions[fid]) {
            var $control = this.$controls.optFunctions[fid].optSelected;
            $control.find('button').removeClass('selected');
            $control.find(`button[value=${data}]`).addClass('selected');
        }
    };

    OptSettingSideBar.prototype.renderParamSelectControl = function (optFunction, param) {
        var fid = optFunction.fid;
        var data = (optFunction.optParam[param].optParamSelected === "true");

        if (this.$controls.optFunctions[fid]) {
            var $control = this.$controls.optFunctions[fid].optParam[param].optParamSelected;
            $control.jqxCheckBox('val', data);
        }
    };

    OptSettingSideBar.prototype.renderFunctionParamControl = function (fid, param, key, data) {
        if (this.$controls.optFunctions[fid]) {
            var $control = this.$controls.optFunctions[fid].optParam[param][key];
            $control.val(data);
        }
    };

    OptSettingSideBar.prototype.renderParamTypeControl = function (optFunction, param) {
        var fid = optFunction.fid;
        var data = optFunction.optParam[param].type.replace(/_/g, ' ');
        this.renderFunctionParamControl(fid, param, 'type', data);
    };

    OptSettingSideBar.prototype.renderParamInitValueControl = function (optFunction, param) {
        var fid = optFunction.fid;
        var data = optFunction.optParam[param].value;
        this.renderFunctionParamControl(fid, param, 'value', data);
    };

    OptSettingSideBar.prototype.renderParamMinControl = function (optFunction, param) {
        var fid = optFunction.fid;
        var data = optFunction.optParam[param].min;
        this.renderFunctionParamControl(fid, param, 'min', data);
    };

    OptSettingSideBar.prototype.renderParamMaxControl = function (optFunction, param) {
        var fid = optFunction.fid;
        var data = optFunction.optParam[param].max;
        this.renderFunctionParamControl(fid, param, 'max', data);
    };

    OptSettingSideBar.prototype.renderParamSetControl = function (optFunction, param) {
        var fid = optFunction.fid;
        var setValue = optFunction.optParam[param].set;
        var data = ($.isArray(setValue)) ? (setValue.toString()) : (setValue);
        this.renderFunctionParamControl(fid, param, 'set', data);
    };

    OptSettingSideBar.prototype.renderAdvancedSettingControl = function () {
        this.renderMethodControl();
        this.renderMaxEvaluationsControl();
    };

    OptSettingSideBar.prototype.renderMethodControl = function () {
        var data = this.optModel.options.method;
        this.$controls.options.method.val(data);
    };

    OptSettingSideBar.prototype.renderMaxEvaluationsControl = function () {
        var data = this.optModel.options.maxEvaluations;
        this.$controls.options.maxEvaluations.setValue(data);
    };

    OptSettingSideBar.prototype.renderValidation = function () {
        var optModel = this.optModel;
        this.renderObjectiveValidation(optModel);
        this.renderOptFunctionsValidation(optModel);
    };

    OptSettingSideBar.prototype.renderObjectiveValidation = function (optModel) {
        var isValidObject = Brightics.OptModelManager.isValidObjective(optModel);
        var borderColor = '#d4d4d4';
        if (!isValidObject) {
            borderColor = '#ea3539';
        }
        this.$selectObjectiveButton.css('border-color', borderColor);
    };

    OptSettingSideBar.prototype.renderOptFunctionsValidation = function () {
        for (var fid in this.$controls.optFunctions) {
            for (var key in this.$controls.optFunctions[fid].optParam) {
                for (var userInput in this.$controls.optFunctions[fid].optParam[key]) {
                    var $control = this.$controls.optFunctions[fid].optParam[key][userInput];
                    if ($control) {
                        if ($control.val()) {
                            // hide validation
                            $control.css('border-color', '#d4d4d4');
                        } else {
                            $control.css('border-color', '#ea3539');
                            // show validation
                        }
                    }
                }
            }
        }
    };

    OptSettingSideBar.prototype.getFunctionsInfo = function () {
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getEditorInput().getContents();

        var optFunctions = this.optModel.optFunctions;
        var functionsInfo = [];
        for (var i = 0; i < optFunctions.length; i++) {
            var fid = optFunctions[i].fid;
            var fnUnit = contents.getFnUnitById(fid);
            functionsInfo.push($.extend(true, {}, fnUnit));
        }
        return functionsInfo;
    };

    OptSettingSideBar.prototype.resetDropDownList = function () {
        this.$dropdownList.jqxDropDownList('clear');
        this.$dropdownList.jqxDropDownList('clearSelection');
        this.$dropdownList.jqxDropDownList({ source: this._getDropDownListSource() });
    };

    OptSettingSideBar.prototype.handleCommand = function (command) {
        if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.GoHistoryCommand) {
            for (var i in command.options.commands) {
                this.handleCommand(command.options.commands[i]);
            }
        }
        else if (command instanceof Brightics.VA.Core.CompoundCommand) this.handleCompoundCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.NewOptModelCommand) this.handleNewOptModelCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.SetOptModelCommand) this.handleSetOptModelCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RemoveOptModelCommand) this.handleRemoveOptModelCommand(command);
        else if (command instanceof Brightics.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand) this.handleRenameFnUnitCommand(command);
    };

    OptSettingSideBar.prototype.handleCompoundCommand = function (command) {
        var i;
        if (command.event.type == 'REDO' || command.event.type == 'EXECUTE') {
            for (i in command.commandList) {
                this.handleCommand(command.commandList[i]);
            }
        } else if (command.event.type == 'UNDO') {
            for (i = command.commandList.length - 1; i > -1; i--) {
                this.handleCommand(command.commandList[i]);
            }
        }
    };

    OptSettingSideBar.prototype.handleNewOptModelCommand = function (command) {
        if (command.event.type === 'UNDO') {
            this.createDetailView();
            this.render();
        } else {
            this.show();

            var optId = command.options.optModel['optId'];
            this.createDetailView(optId);
            this.render(optId);
        }
    };

    OptSettingSideBar.prototype.handleSetOptModelCommand = function (command) {
        this.show();

        var optId = command.options.optId;
        if (this.optModel.optId != optId) {
            this.createDetailView(optId);
        }
        this.render(optId);
    };

    OptSettingSideBar.prototype.handleRemoveOptModelCommand = function (command) {
        if (command.event.type === 'UNDO') {
            this.show();

            var optId = command.options.optId;
            this.createDetailView(optId);
            this.render(optId);
        } else {
            this.createDetailView();
            this.render();
        }
    };

    OptSettingSideBar.prototype.handleRenameFnUnitCommand = function (command) {
        var targetFid = command.options.fid;
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var contents = activeModelEditor.getActiveModel();
        var fnUnit = contents.getFnUnitById(targetFid);
        var functionLabel = fnUnit.display.label;

        if (this.$controls && this.$controls.optFunctions[targetFid]) {
            var $target = this.$controls.optFunctions[targetFid].optSelected.prev();
            $target.attr('title', functionLabel);
            $target.find('.brtc-opt-function-label').text(functionLabel);
        }

        if (this.optModel && this.optModel.options.objective.fid == targetFid) {
            this.renderFunctionLabelControl();
            this.renderTableLabelControl();
        }
    };

    OptSettingSideBar.prototype.executeSetOptModelCommand = function (options, target) {
        var activeModelEditor = Studio.getEditorContainer().getActiveModelEditor();
        var pid = activeModelEditor.getEditorInput().getProjectId();
        var mid = activeModelEditor.getEditorInput().getFileId();
        var optId = this.$dropdownList.val();

        if (optId && Brightics.OptModelManager.getOptModel(pid, mid, optId)) {
            var commandManager = activeModelEditor.getCommandManager();
            var command = Brightics.OptModelManager.createSetOptModelCommand(pid, mid, optId, options, target);
            commandManager.execute(command);
        }
    };

    OptSettingSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.$modelSideBar.find('.brtc-va-tools-sidebar-contents-wrapper');
    };

    OptSettingSideBar.prototype.destroy = function () {
        //Brightics.VA.Core.Utils.WidgetUtils.destroyJqxControl(this.propertyControls[target])
    };

    Brightics.VA.Core.Tools.SideBar.OptSettingSideBar = OptSettingSideBar;

}).call(this);
/* -----------------------------------------------------
 *  outline-sidebar.js
 *  Created by hyunseok.oh@samsung.com on 2018-07-11.
 * ---------------------------------------------------- */

(function (root) {
    'use strict';
    var Brightics = root.Brightics;

    function OutlineSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    OutlineSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    OutlineSideBar.prototype.constructor = OutlineSideBar;


    OutlineSideBar.prototype.createContent = function () {
        var _this = this;

        this.$modelSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar dataflow">' +
            // '   <ul>' +
            // '       <li>Local</li>' +
            // '       <li>Global</li>' +
            // '   </ul>' +
            '   <div class="brtc-va-tools-sidebar-outline brtc-va-tools-sidebar-local-outline selected"></div>' +
            '   <div class="brtc-va-tools-sidebar-outline brtc-va-tools-sidebar-global-outline"></div>' +
            '</div>');

        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);

        // this.tabControl = Brightics.VA.Core.Widget.Factory.tabControl(this.$modelSideBar);

        var $localOutlineArea = this.$modelSideBar.find('.brtc-va-tools-sidebar-local-outline');
        // var $globalOutlineArea = this.$modelSideBar.find('.brtc-va-tools-sidebar-global-outline');

        var projectId = this.getEditor().getEditorInput().getProjectId();
        var model = this.getEditor().getModel();

        this.localOutline = new Brightics.VA.Core.Views.LocalOutline({
            $parent: $localOutlineArea,
            projectId: projectId,
            model: model,
            editor: this.getEditor()
        });

        // this.globalOutline = new Brightics.VA.Core.Views.GlobalOutline({
        //     $parent: $globalOutlineArea,
        //     projectId: projectId,
        //     model: model
        // });
    };

    OutlineSideBar.prototype.onModelChange = function (command) {
        this.localOutline.refresh('all');
        // this.globalOutline.refresh();
    };

    OutlineSideBar.prototype.onFnUnitSelect = function (fnUnit) {
        this.localOutline.refresh('underline', fnUnit ? fnUnit.fid : undefined);
    };

    OutlineSideBar.prototype.refresh = function () {
        this.localOutline.refresh('all');
    };

    OutlineSideBar.prototype.updateStatus = function (event) {
        this.localOutline.refresh('status', {fid: event.fid, status: event.status});
    };

    Brightics.VA.Core.Tools.SideBar.OutlineSideBar = OutlineSideBar;
/* eslint-disable no-invalid-this */
}(this));

/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function PaletteSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    PaletteSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    PaletteSideBar.prototype.constructor = PaletteSideBar;

    PaletteSideBar.prototype.createContent = function () {
        var _this = this;

        this.$modelSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar dataflow">' +
            '   <ul>' +
            '       <li>Function</li>' +
            '       <li>Template</li>' +
            '       <li>Data</li>' +
            '   </ul>' +
            '   <div class="brtc-va-tools-sidebar-palettetab" />' +
            '   <div class="brtc-va-tools-sidebar-librarytab"></div>' +
            '   <div class="brtc-va-tools-sidebar-datatab" />' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);

        this.tabControl = Brightics.VA.Core.Widget.Factory.tabControl(this.$modelSideBar);

        var $paletteArea = this.$modelSideBar.find('.brtc-va-tools-sidebar-palettetab');
        this.dataFlowPalette = new Brightics.VA.Core.Views.Palette($paletteArea, {
            width: '100%',
            height: '100%',
            draggable: true,
            modelType: Brightics.VA.Implementation.DataFlow.Clazz,
            editor: this.getEditor()
        });

        var $libraryArea = this.$modelSideBar.find('.brtc-va-tools-sidebar-librarytab');
        this.libraryExplorer = new Brightics.VA.Core.Views.LibraryExplorer($libraryArea, {
            height: '100%',
            modelType: Brightics.VA.Implementation.DataFlow.Clazz,
            editor: this.getEditor()
        });

        var $dataArea = this.$modelSideBar.find('.brtc-va-tools-sidebar-datatab');
        this.dataExplorer = new Brightics.VA.Core.Views.DataExplorer($dataArea, {
            height: '100%',
            editor: this.getEditor()
        });

        this.$modelSideBar.on('selected', function (event, index) {
            var selectedIdx = index;
            if (selectedIdx === 1) {
                _this.libraryExplorer.activate();
            } else if (selectedIdx === 2) {
                _this.dataExplorer.render();
            }
        });
    };

    PaletteSideBar.prototype.appendTemplate = function (options) {
        this.libraryExplorer.appendTemplate(options);
    };

    PaletteSideBar.prototype.udfChanged = function (selection) {
        this.dataFlowPalette.udfChanged();
    };

    PaletteSideBar.prototype.templateChanged = function (selection) {
        this.libraryExplorer.templateChanged();
    };

    PaletteSideBar.prototype.onActivated = function () {
        this.libraryExplorer.refresh();
        this.dataFlowPalette.udfChanged();
    };

    PaletteSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.tabControl.$tabContents.find('.brtc-va-views-palette-navigator-wrapper');
    };

    PaletteSideBar.prototype.destroy = function () {
        this.dataFlowPalette.destroy();
        this.libraryExplorer.destroy();
        this.dataExplorer.destroy();
    };

    Brightics.VA.Core.Tools.SideBar.PaletteSideBar = PaletteSideBar;
}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function PropertiesSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    PropertiesSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    PropertiesSideBar.prototype.constructor = PropertiesSideBar;

    PropertiesSideBar.prototype.createContent = function () {
        this.$controlSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar controlflow">' +
            '   <div class="brtc-va-tools-sidebar-propertytab brtc-style-tab" />' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$controlSideBar);

        var $propertyArea = this.$controlSideBar.find('.brtc-va-tools-sidebar-propertytab');
        this.controlEditorProperties = new Brightics.VA.Implementation.ControlFlow.Views.Properties($propertyArea, {
            width: '100%',
            height: '100%'
        });
        this.controlEditorProperties.editorChanged(this.getEditor());
    };

    PropertiesSideBar.prototype.selectionChanged = function (selection) {
        if (this.controlEditorProperties.activeEditor 
            && this.controlEditorProperties.activeEditor.getModel().type == Brightics.VA.Implementation.ControlFlow.Clazz) {
            if (selection instanceof Object && selection.func) {
                for (var fnUnit in Brightics.VA.Implementation.ControlFlow.Functions) {
                    if (fnUnit == selection.func) this.controlEditorProperties.selectionChanged(selection);
                }
            } else if (typeof selection === 'undefined') this.controlEditorProperties.selectionChanged();
        }

        this.applyPreferenceSettings(true);
    };

    PropertiesSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.$controlSideBar.find('.brtc-va-views-properties');
    };

    PropertiesSideBar.prototype.render = function () {
        this.controlEditorProperties.render();
    };

    Brightics.VA.Core.Tools.SideBar.PropertiesSideBar = PropertiesSideBar;
}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function RealTimePaletteSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    RealTimePaletteSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    RealTimePaletteSideBar.prototype.constructor = RealTimePaletteSideBar;

    RealTimePaletteSideBar.prototype.createContent = function () {
        this.$realtimeSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar realtime">' +
            '   <div class="brtc-va-tools-sidebar-palettetab brtc-style-tab" />' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$realtimeSideBar);

        var $paletteArea = this.$realtimeSideBar.find('.brtc-va-tools-sidebar-palettetab');
        this.realtimePalette = new Brightics.VA.Core.Views.Palette($paletteArea, {
            width: '100%',
            height: '100%',
            draggable: true,
            modelType: 'realtime'
        });
    };

    Brightics.VA.Core.Tools.SideBar.RealTimePaletteSideBar = RealTimePaletteSideBar;
}).call(this);
/* -----------------------------------------------------
 *  return-table-sidebar.js
 *  Created by hyunseok.oh@samsung.com on 2018-03-13.
 * ---------------------------------------------------- */

/* global _, OUT_DATA, crel */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;
    var KeyItems = brtc_require('KeyItems');

    var ADD_RETURN_TABLE_OP = 'Add Return Data';
    var CHANGE_RETURN_TABLE_OP = 'Change Return Data';
    var REMOVE_RETURN_TABLE_OP = 'Remove Return Data';

    var className = {
        sideBarArea: 'brtc-va-studio-sidebar-area',
        toolsSideBar: 'brtc-va-tools-sidebar',
        styleSideBar: 'brtc-style-sidebar',
        sSideBar: 'brtc-stype-s-sidebar',
        header: [
            'brtc-style-s-font-size-13',
            'brtc-style-s-font-weight-bold',
            'brtc-style-s-font-faminly-arial',
            'brtc-style-margin-top-10',
            'brtc-style-margin-bottom-10'
        ].join(' '),
        selectedTableWrapper: [
            'brtc-va-editors-sheet-controls-dataselector-contents',
            'brtc-style-display-flex',
            'brtc-style-flex-direction-column'
        ].join(' '),
        selectedTableDataContainer: [
            'brtc-va-editors-sheet-controls-dataselector-contents-wrapper',
            'brtc-style-relative'
        ].join(' '),
        notSelectedItemContainer: [
            'brtc-va-editors-sheet-controls-dataselector-contents-wrapper',
            'brtc-style-full',
            'brtc-style-relative'
        ].join(' '),
        emptyContainer: [
            'brtc-va-editors-sheet-controls-dataselector-empty-wrapper',
            'brtc-style-height-60px',
            'brtc-style-padding-right-20'
        ].join(' '),
        emptyContents: 'brtc-va-editors-sheet-controls-dataselector-empty-contents',
        outTableListWrapper: 'brtc-va-tools-sidebar-out-table-list-wrapper',
        outTableListItemWrapper: 'brtc-va-tools-sidebar-out-table-list-item-wrapper',
        dataSelectorItem: [
            'brtc-va-editors-sheet-controls-dataselector-item',
            'brtc-style-flex-start',
            'brtc-style-padding-right-20'
        ].join(' ')
    };

    function ReturnTableSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    ReturnTableSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    ReturnTableSideBar.prototype.constructor = ReturnTableSideBar;

    ReturnTableSideBar.prototype.createContent = function () {
        var _this = this;

        var outerClassName = [
            className.toolsSideBar,
            className.styleSideBar,
            className.sSideBar,
            'brtc-style-display-flex',
            'brtc-style-flex-direction-column'
        ].join(' ');

        var itemContainer = crel('div', {class: className.selectedTableDataContainer});

        this.$selectedTableAndAddableWrapper = $(
            crel('div', {class: 'brtc-style-relative  brtc-style-padding-right-20'}, itemContainer)
        );

        var notSelectedItemContainer =
            crel('div', {class: className.notSelectedItemContainer});

        var selectedTableWrapper = crel('div',
            {class: className.selectedTableWrapper, style: 'height: 47%;'},
            crel('div', {class: className.header}, 'Selected Data'),
            this.$selectedTableAndAddableWrapper[0]
            // itemContainer
        );

        var outTableListWrapper = crel('div', {class: className.outTableListWrapper},
            crel('div', {class: className.header}, 'Out Data List'),
            notSelectedItemContainer
        );

        this.$modelSideBar = $(
            crel('div', {class: outerClassName},
                selectedTableWrapper,
                outTableListWrapper
            )
        );

        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);
        this.$itemContainer = $(itemContainer);

        this.$notSelectedItemContainer = $(notSelectedItemContainer);
        this.$outTableContainer = $(outTableListWrapper);
        this.$itemContainer.on('sortstop', function (evt, ui) {
            var tableList = _this.getSelectedTableIds();
            _this.changeSelectedTableOrder(tableList);
        });

        this.$itemContainer.sortable({
            axis: 'y',
            cancel: '.empty'
        });

        this.$selectedTableAndAddableWrapper.append(this.createAddableArea());
        // $(selectedTableWrapper).append(this.createAddableArea());

        this.$notSelectedItemContainer = $(notSelectedItemContainer);
        this.scroll();
        this.refresh();
    };

    ReturnTableSideBar.prototype.scroll = function () {
        this.$notSelectedItemContainer.perfectScrollbar();
        this.$notSelectedItemContainer.perfectScrollbar('update');
        this.$selectedTableAndAddableWrapper.perfectScrollbar();
        this.$selectedTableAndAddableWrapper.perfectScrollbar('update');
    };

    // TODO: 데이터가 있다고 가정하고 만들어보자
    ReturnTableSideBar.prototype.onActivated = function () {
        // 데이터와 화면 동기화
        this.refresh();
        this.renderNotSelectedItems();
    };

    ReturnTableSideBar.prototype.onFnUnitSelect = function (fnUnit) {
        this.renderNotSelectedItems();
    };

    ReturnTableSideBar.prototype.initPreferenceTarget = function () {
        // this.preferenceTarget['scroll'] = this.tabControl.$tabContents.find('.brtc-va-views-palette-navigator-wrapper');
    };

    ReturnTableSideBar.prototype.destroy = function () {
        // this.dataFlowPalette.destroy();
        // this.libraryExplorer.destroy();
        // this.dataExplorer.destroy();
    };

    ReturnTableSideBar.prototype.attachDragEventListener = function ($item) {
        $item.draggable({
            helper: function () {
                var $helper = $(this).clone();
                var width = $(this).width();
                $helper.css({
                    'z-index': 5100,
                    'width': width,
                    'height': '65px',
                    'overflow': 'hidden',
                    'white-space': 'nowrap',
                    'text-overflow': 'ellipsis'
                });
                return $helper;
            },
            appendTo: 'body'
        });
        return $item;
    };

    ReturnTableSideBar.prototype.attachDropEventListener = function ($item, mode) {
        var _this = this;
        $item.droppable({
            accept: '.brtc-style-controls-inputselector-box-wrapper.return-table',
            activate: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                $dropTarget.addClass('brtc-style-droppable-active');
            },
            deactivate: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                $dropTarget.removeClass('brtc-style-droppable-active');
                $dropTarget.removeClass('brtc-style-droppable-hover');
            },
            over: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                $dropTarget.addClass('brtc-style-droppable-hover');
            },
            out: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                $dropTarget.removeClass('brtc-style-droppable-hover');
            },
            drop: function (event, ui) {
                var $dropTarget = $(this).find('.brtc-style-controls-dataselector-empty-fnunit');
                var $source = ui.draggable;
                $dropTarget.removeClass('brtc-style-droppable-active');
                $dropTarget.removeClass('brtc-style-droppable-hover');

                if (mode === 'replace') {
                    _this.replaceSelectedTable($source, $(this));
                } else if (mode === 'add') {
                    _this.addSelectedTable($source);
                }
            }
        });
    };

    ReturnTableSideBar.prototype.getDropFuncTarget = function ($itemWrapper) {
        // var ret = $itemWrapper.find('.' + className.dataSelectorItem);
        var ret = $itemWrapper.find('.brtc-style-controls-inputselector-box-wrapper');
        if (ret.length) return ret;
        return $itemWrapper;
    };

    ReturnTableSideBar.prototype.changeSelectedTableOrder = function (tableList) {
        var model = this.getActiveModel();
        var changed = tableList.length !== model[OUT_DATA].length;
        if (!changed) {
            for (var i = 0; i < model[OUT_DATA].length; i++) {
                if (tableList[i] !== model[OUT_DATA][i]) {
                    changed = true;
                    break;
                }
            }
        }

        if (changed) {
            var command = this.createModelOutDataUpdateCommand(model, [OUT_DATA], tableList);
            this.getEditor().getCommandManager().execute(command);
        }
    };

    ReturnTableSideBar.prototype.createModelOutDataUpdateCommand = function (model, path, data) {
        var command = new Brightics.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand(this, {
            target: model,
            path: path,
            value: data,
            label: CHANGE_RETURN_TABLE_OP
        });

        return command;
    };

    ReturnTableSideBar.prototype.createModelOutDataAddCommand = function (model, path, data) {
        var command = new Brightics.VA.Core.CompoundCommand(this, {
            label: ADD_RETURN_TABLE_OP
        });

        // FIXME: 스펙 없어서 임시로 넣은 로직
        if (!model[OUT_DATA]) {
            command.add(new Brightics.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this, {
                target: model,
                path: [OUT_DATA],
                value: []
            }));
        }

        command.add(new Brightics.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this, {
            target: model,
            path: path,
            value: data
        }));

        if (this.isNestedFlow()) {
            var nextTableSize = Brightics.VA.Core.Utils.NestedFlowUtils.calcNextFnUnitOutTableSize(
                this.getEditor().getModel(),
                this.getEditor().getActiveFnUnit(),
                model.mid,
                1
            );
            command.add(this.createAdjustOutTableCommand(nextTableSize));
        }

        return command;
    };

    ReturnTableSideBar.prototype.createModelOutDataRemoveCommand = function (model, path) {
        var command = new Brightics.VA.Core.CompoundCommand(this, {
            label: REMOVE_RETURN_TABLE_OP
        });

        command.add(new Brightics.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(this, {
            target: model,
            path: path
        }));

        if (this.isNestedFlow()) {
            var nextTableSize = Brightics.VA.Core.Utils.NestedFlowUtils.calcNextFnUnitOutTableSize(
                this.getEditor().getModel(),
                this.getEditor().getActiveFnUnit(),
                model.mid,
                -1
            );
            command.add(this.createAdjustOutTableCommand(nextTableSize));
        }

        return command;
    };

    ReturnTableSideBar.prototype.addSelectedTable = function ($source) {
        var fromTableId = $source.attr('tid');
        var index = this.getModelOutData().length;
        var command = this.createModelOutDataAddCommand(
            this.getActiveModel(),
            [OUT_DATA, index],
            fromTableId);
        this.getEditor().getCommandManager().execute(command);
    };

    ReturnTableSideBar.prototype.removeSelectedTable = function (tid, fid) {
        var index = _.indexOf(this.getModelOutData(), tid);
        var command =
            this.createModelOutDataRemoveCommand(this.getActiveModel(), [OUT_DATA, index]);
        this.getEditor().getCommandManager().execute(command);
    };

    ReturnTableSideBar.prototype.replaceSelectedTable = function ($from, $to) {
        var activeModel = this.getActiveModel();
        var fromTableId = $from.attr('tid');

        var toTableIndex = _.indexOf(this.getModelOutData(), this.getDropFuncTarget($to).attr('tid'));
        var command = this.createModelOutDataUpdateCommand(
            activeModel,
            [OUT_DATA, toTableIndex],
            fromTableId);
        this.getEditor().getCommandManager().execute(command);
        this.renderNotSelectedItems();
    };

    ReturnTableSideBar.prototype.createItem = function (fnUnit, tableId) {
        var outputs = this.FnUnitUtils.getOutputsToObject(fnUnit);
        var tableId = tableId;
        var type = this.FnUnitUtils.getTypeByTableId(fnUnit, tableId);
        var func = this.FnUnitUtils.getFunc(fnUnit);
        var label = this.FnUnitUtils.getLabel(fnUnit);

        var $item = KeyItems.create({
            key: outputs[tableId],
            tableId: tableId,
            type: type,
            func: func,
            label: label
        });

        $item.attr('tid', tableId);
        $item.addClass('return-table');

        return $item;
    };

    ReturnTableSideBar.prototype.createKeyItem = function (options) {
        var fnUnit = options.fnUnit;
        var tableId = options.tableId;
        var type = options.type;

        var $item = $(crel('div', {class: className.dataSelectorItem}));
        var label = this.getTableItemLabel(fnUnit, tableId);

        var $keyItem = Brightics.VA.Core.Utils.WidgetUtils.createKeyItem({label: label, type: type});

        $item.append($keyItem);

        $item.attr('tid', tableId);
        $item.attr('fid', fnUnit.fid);
        // var index = fnUnit[OUT_DATA].indexOf(tableId);
        var index = this.FnUnitUtils.getOutTable(fnUnit).indexOf(tableId);
        $item.attr('index', index);
        $keyItem.addClass('item');
        return $item;
    };

    ReturnTableSideBar.prototype.createEmptyItem = function () {
        var $item = $(
            crel('div', {class: className.emptyContainer},
                crel('div', {class: className.emptyContents}, 'Select a function in the diagram that contains the data you want to set as return data.')
            )
        );
        return $item;
    };

    ReturnTableSideBar.prototype.getFnUnitByTableId = function (tableId) {
        var functions = this.getActiveModel().functions;
        for (var i = 0; i < functions.length; i++) {
            var fnUnit = functions[i];
            if (_.indexOf(this.FnUnitUtils.getOutTable(fnUnit), tableId) > -1) return fnUnit;
            // if (_.indexOf(fnUnit[OUT_DATA], tableId) > -1) return fnUnit;
        }
        return undefined;
    };

    ReturnTableSideBar.prototype.getTableItemLabel = function (fnUnit, tableId) {
        var outputs = this.FnUnitUtils.getOutputsToObject(fnUnit);
        return outputs[tableId];
    };

    ReturnTableSideBar.prototype.createSelectedTableElements = function (tableIds) {
        var _this = this;
        var ret = [];
        _.forEach(tableIds, function (tableId) {
            var fnUnit = _this.getFnUnitByTableId(tableId);
            if (fnUnit) {
                ret.push(_this.createSelectedItem(fnUnit, tableId));
            }
        });
        return ret;
    };

    ReturnTableSideBar.prototype.createSelectedItem = function (fnUnit, tableId) {
        var outputs = this.FnUnitUtils.getOutputsToObject(fnUnit);
        var tableId = tableId;
        var type = this.FnUnitUtils.getTypeByTableId(fnUnit, tableId);
        var func = this.FnUnitUtils.getFunc(fnUnit);
        var label = this.FnUnitUtils.getLabel(fnUnit);

        var $item = KeyItems.create({
            key: outputs[tableId],
            tableId: tableId,
            type: type,
            func: func,
            label: label
        });

        $item.attr('tid', tableId);

        return this.wrapSelectedItem($item);
    };

    ReturnTableSideBar.prototype.createNotSelectedItem = function (fnUnit, tableId) {
        // var $item = this.createItem(fnUnit, tableId);
        // var $item = this.createKeyItem({
        //     fnUnit: fnUnit,
        //     tableId: tableId,
        //     type: this.FnUnitUtils.getTypeByTableId(fnUnit, tableId)
        // });
        var $item = this.createItem(fnUnit, tableId).css('cursor', 'move');
        return this.wrapNotSelectedItem($item);
    };

    ReturnTableSideBar.prototype.renderEmpty = function () {
        var $item = this.createEmptyItem();
        this.$notSelectedItemContainer.append($item);
    };

    ReturnTableSideBar.prototype.wrapSelectedItem = function ($item) {
        var _this = this;
        var $itemWrapper = $(crel('div', {
            class: 'brtc-style-flex-center brtc-style-relative'
        }));

        var $removeButton = $(crel('span', {
            class: 'brtc-style-editor-content-remove-button'
        }));

        var tid = $item.attr('tid');
        var fid = $item.attr('fid');

        $removeButton.click(function () {
            _this.removeSelectedTable(tid, fid);
            $itemWrapper.remove();
        });

        $itemWrapper.append($item);
        $itemWrapper.append($removeButton);

        this.attachDropEventListener($itemWrapper, 'replace');
        return $itemWrapper;
    };

    ReturnTableSideBar.prototype.wrapNotSelectedItem = function ($item) {
        this.attachDragEventListener($item);
        var $itemWrapper = $(crel('div', {
            class: 'brtc-style-flex-center brtc-style-relative',
            style: 'padding-right: 20px'
        }));

        $itemWrapper.append($item);

        return $itemWrapper;
    };

    ReturnTableSideBar.prototype.getActiveModel = function () {
        return this.getEditor().getActiveModel();
    };

    // activeFnUnit -> 프로퍼티 패널에 뜨고 있는 fnUnit
    ReturnTableSideBar.prototype.getActiveFnUnit = function () {
        return this.getEditor().getActiveFnUnitOnProp();
    };

    ReturnTableSideBar.prototype.renderNotSelectedItems = function () {
        var _this = this;
        var selectedTable = this.getModelOutData();
        var fnUnit = this.getActiveFnUnit();

        this.$notSelectedItemContainer.empty();

        if (fnUnit) {
            // var notSelectedTables = _.filter(fnUnit[OUT_DATA], function (tableId) {
            var notSelectedTables = _.filter(this.FnUnitUtils.getOutTable(fnUnit), function (tableId) {
                return _.indexOf(selectedTable, tableId) === -1;
            });

            _.forEach(notSelectedTables, function (tableId) {
                _this.$notSelectedItemContainer.append(
                    _this.createNotSelectedItem(fnUnit, tableId));
            });
        } else {
            this.renderEmpty();
        }
    };

    ReturnTableSideBar.prototype.getSelectedTableIds = function () {
        return _.map(this.$itemContainer.children(), function (item) {
            // var tid = $(item).find('.' + className.dataSelectorItem).attr('tid');
            var tid = $(item).find('.brtc-style-controls-inputselector-box-wrapper').attr('tid');
            return tid;
        });
    };

    ReturnTableSideBar.prototype.getModelOutData = function () {
        return this.getActiveModel()[OUT_DATA];
    };

    ReturnTableSideBar.prototype.createAddableArea = function () {
        var $el = $(
            crel('div', {class: 'brtc-style-flex-center brtc-va-editors-sheet-controls-empty-fnunit'},
                crel('div', {class: 'brtc-style-controls-dataselector-empty-fnunit'},
                    crel('div', 'Drop Data')
                )
            )
        );
        $el.addClass('empty');
        this.attachDropEventListener($el, 'add');
        return $el;
    };

    ReturnTableSideBar.prototype.onModelChange = function () {
        this.refresh();
        this.renderNotSelectedItems();
    };

    ReturnTableSideBar.prototype.refresh = function () {
        this.$selectedItems = this.createSelectedTableElements(this.getModelOutData());
        this.$itemContainer.empty();
        this.$itemContainer.append(this.$selectedItems);

        this.renderNotSelectedItems();
        this.scroll();
    };

    ReturnTableSideBar.prototype.createAdjustOutTableCommand = function (nextTableLength) {
        // 최대값 따라서 바꿔준다.
        return Brightics.VA.Core.Utils.NestedFlowUtils.createAdjustOutTableCommand(
            this,
            this.getEditor().getModel(),
            this.getEditor().getActiveFnUnit(),
            nextTableLength
        );
    };

    ReturnTableSideBar.prototype.isNestedFlow = function () {
        var activeFnUnit = this.getEditor().getActiveFnUnit();
        return activeFnUnit &&
            (activeFnUnit.func === 'if' ||
                activeFnUnit.func === 'forLoop' ||
                activeFnUnit.func === 'whileLoop');
    };

    Brightics.VA.Core.Tools.SideBar.ReturnTableSideBar = ReturnTableSideBar;
    /* eslint-disable no-invalid-this */
}).call(this);

/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ScriptPaletteSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    ScriptPaletteSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    ScriptPaletteSideBar.prototype.constructor = ScriptPaletteSideBar;

    ScriptPaletteSideBar.prototype.createContent = function () {
        var _this = this;

        this.$mainControl = $('' +
            '<div class="brtc-va-tools-sidebar script brtc-style-sidebar brtc-style-s-sidebar">' +
            '   <ul>' +
            '       <li class="tab-header-function">Function</li>' +
            '       <li class="tab-header-data">Data</li>' +
            '       <li class="tab-header-udf">UDF</li>' +
            '   </ul>' +
            '   <div class="brtc-va-core-views-palette" />' +
            '   <div class="brtc-va-implementation-script-views-datasourcelist" />' +
            '   <div class="brtc-va-implementation-script-views-udflist" />' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$mainControl);

        this.tabControl = Brightics.VA.Core.Widget.Factory.tabControl(this.$mainControl);

        var $functionSideBar = this.$mainControl.find('.brtc-va-core-views-palette');
        this.functionListView = new Brightics.VA.Implementation.Script.Views.FunctionList($functionSideBar, {
            // width: '100px',  //follow child style
            height: 'calc(100% - 30px)',
            draggable: true,
            modelType: Brightics.VA.Implementation.Script.Clazz
        });

        var $dataSourceSideBar = this.$mainControl.find('.brtc-va-implementation-script-views-datasourcelist');
        this.dataSourceListView = new Brightics.VA.Implementation.Script.Views.DataSourceList($dataSourceSideBar, {
            width: '100%',
            height: 'calc(100% - 20px)',
            projectId: this.getEditor().options.editorInput.data.project_id
        });

        var $udfSideBar = this.$mainControl.find('.brtc-va-implementation-script-views-udflist');
        this.udfListView = new Brightics.VA.Implementation.Script.Views.UDFViewer($udfSideBar, {
            width: '100%',
            height: 'calc(100% - 30px)',
            modelType: Brightics.VA.Implementation.Script.Clazz,
            editor: this.getEditor()
        });
    };

    ScriptPaletteSideBar.prototype.selectionChanged = function (selection) {
    };

    ScriptPaletteSideBar.prototype.udfChanged = function (selection) {
        this.udfListView.udfChanged();
    };

    ScriptPaletteSideBar.prototype.onActivated = function () {
        if (this.dataSourceListView) {
            this.dataSourceListView.refresh();
        }
        if (this.udfListView) {
            this.udfListView.udfChanged();
        }
    }

    ScriptPaletteSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.tabControl.$tabContents.find('.brtc-va-views-palette-navigator-wrapper');
    };

    Brightics.VA.Core.Tools.SideBar.ScriptPaletteSideBar = ScriptPaletteSideBar;

}).call(this);

/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ScriptSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    ScriptSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    ScriptSideBar.prototype.constructor = ScriptSideBar;

    ScriptSideBar.prototype.createContent = function (status, editor) {
        this.$mainControl = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar script">' +
            '   <div class="brtc-va-tools-sidebar-script brtc-style-tab" />' +
            '   </div>' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$mainControl);

        var $scriptSideBar = this.$mainControl.find('.brtc-va-tools-sidebar-script');
        this.scriptUnitListView = new Brightics.VA.Implementation.Script.Views.ScriptUnitList($scriptSideBar, {
            width: '100%',
            height: 'calc(100% - 30px)',
            editor: this.getEditor()
        });
    };

    ScriptSideBar.prototype.selectionChanged = function (selection) {
        if (this.scriptUnitListView.activeEditor && this.scriptUnitListView.activeEditor.getModel().type == Brightics.VA.Implementation.Script.Clazz) {
            this.scriptUnitListView.selectionChanged(selection);
        }
    };

    ScriptSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.$mainControl.find('.brtc-style-list-area');
    };

    Brightics.VA.Core.Tools.SideBar.ScriptSideBar = ScriptSideBar;

}).call(this);
/**
 * Created by SDS on 2016-09-05.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function VariablesSideBar(parentId, options) {
        Brightics.VA.Core.Tools.SideBar.call(this, parentId, options);
    }

    VariablesSideBar.prototype = Object.create(Brightics.VA.Core.Tools.SideBar.prototype);
    VariablesSideBar.prototype.constructor = VariablesSideBar;

    VariablesSideBar.prototype.createContent = function () {
        this.$modelSideBar = $('' +
            '<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar dataflow">' +
            '   <div class="brtc-va-tools-sidebar-variabletab brtc-style-tab" />' +
            '</div>');
        this.$parent.find('.brtc-va-studio-sidebar-area').append(this.$modelSideBar);

        this.$variableArea = this.$modelSideBar.find('.brtc-va-tools-sidebar-variabletab');
        this.dataEditorVariable = new Brightics.VA.Core.Views.Variable(this.$variableArea, {
            width: '100%',
            height: 'calc(100% - 30px)',
            editor: this.getEditor()
        });
    };

    VariablesSideBar.prototype.initPreferenceTarget = function () {
        this.preferenceTarget['scroll'] = this.$variableArea.find('.brtc-va-tools-sidebar-variable-list');
    };

    VariablesSideBar.prototype.destroy = function () {
        this.dataEditorVariable.destroy();
    };

    Brightics.VA.Core.Tools.SideBar.VariablesSideBar = VariablesSideBar;

}).call(this);
/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ModelSelector(parentId, options) {
        this.parentId = parentId;
        this.options = options || {};
        this.retrieveParent();
        this.createControls();
    }

    ModelSelector.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ModelSelector.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-tools-modelselector"></div>');
        this.$parent.append(this.$mainControl);

        this.$mainControl.css({
            width: '100%',
            height: '100%'
        });

        this.createModelControl();
    };

    ModelSelector.prototype.createModelControl = function () {
        var _this = this;

        this.$modelArea = $('<div class="brtc-va-tools-modelselector-model"></div>');
        this.$mainControl.append(this.$modelArea);

        var source = [];

        if (this.options.projectId) {
            var models = this.getModels(this.options.projectId);

            _.map(models, function (model) {
                if (model.getType() === (_this.options.type || 'data')) {
                    source.push({
                        text: model.getLabel(),
                        value:  model.getFileId()
                    })
                }
            });
        }
        
        this.createDropdownList(this.$modelArea, {
            placeHolder: 'Report',
            source: source,
            disabled: this.options.disabled
        });

        this.$modelArea.val(this.options.modelId);
    };

    ModelSelector.prototype.createDropdownList = function ($target, options) {
        var _this = this;
        
        var defaultOptions = {
            theme: Brightics.VA.Env.Theme,
            enableBrowserBoundsDetection: true,
            animationType: 'none',
            width: '100%',
            height: '25px',
            openDelay: 0,
            dropDownHeight: 120,
            disabled: this.options.disabled,
            displayMember: 'text',
            valueMember: 'value'
        };

        $.extend(true, defaultOptions, options);
        
        $target.jqxDropDownList(defaultOptions);

        $target.change(function () {
            var modelId = $(this).val();

            if (_this.options.onChange) _this.options.onChange(modelId);
        });
    };

    ModelSelector.prototype.getModels = function (projectId) {
        return Studio.getResourceManager().getFiles(projectId);
    };

    ModelSelector.prototype.getModelId = function () {
        return this.$modelArea.val();
    };

    ModelSelector.prototype.setSource = function (source) {
        return this.$modelArea.jqxDropDownList('source', source);
    };

    Brightics.VA.Core.Tools.ModelSelector = ModelSelector;

}).call(this);

/**
 * Created by daewon.park on 2016-01-27.
 */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function ProjectSelector(parentId, options) {
        this.parentId = parentId;
        this.options = options || {};
        this.retrieveParent();
        this.createControls();
    }

    ProjectSelector.prototype.retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    ProjectSelector.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-tools-projectselector"></div>');
        this.$parent.append(this.$mainControl);

        this.$mainControl.css({
            width: '100%',
            height: '100%'
        });

        this.createProjectControl();
    };

    ProjectSelector.prototype.createProjectControl = function () {
        var _this = this;

        this.$projectArea = $('<div class="brtc-va-tools-projectselector-project"></div>');
        this.$mainControl.append(this.$projectArea);

        var source = [];

        var projects = this.getProjects();

        _.map(projects, function (project) {
            source.push({
                text: project.getLabel(),
                value:  project.getProjectId()
            })
        });

        this.createDropdownList(this.$projectArea, {
            placeHolder: 'Project',
            source: source,
            disabled: this.options.disabled
        });

        this.$projectArea.val(this.options.projectId);
    };

    ProjectSelector.prototype.createDropdownList = function ($target, options) {
        var _this = this;

        var defaultOptions = {
            theme: Brightics.VA.Env.Theme,
            enableBrowserBoundsDetection: true,
            animationType: 'none',
            width: '100%',
            height: '25px',
            openDelay: 0,
            dropDownHeight: 120,
            disabled: this.options.disabled,
            displayMember: 'text',
            valueMember: 'value'
        };

        $.extend(true, defaultOptions, options);
        
        $target.jqxDropDownList(defaultOptions);

        $target.change(function () {
            var projectId = $(this).val();

            if (_this.options.onChange) _this.options.onChange(projectId);
        });
    };

    ProjectSelector.prototype.getProjects = function () {
        return Studio.getResourceManager().getProjects();
    };

    ProjectSelector.prototype.getProjectId = function () {
        return this.$projectArea.val();
    };

    ProjectSelector.prototype.setSource = function (source) {
        return this.$projectArea.jqxDropDownList('source', source);
    };

    Brightics.VA.Core.Tools.ProjectSelector = ProjectSelector;

}).call(this);

/**
 * Created by SDS on 2016-09-05.
 */

/* global crel */
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function Tab(parentId, options) {
        this.options = options;
        this.parentId = parentId;

        _retrieveParent.bind(this)();

        this.createControls();
    }

    var _retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    Tab.prototype.init = function () {
        this.renderedIndexes = [];
    };

    Tab.prototype.destroy = function () {
        if(this.pages){
            this.pages.destroy();
        }
    };

    Tab.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-tools-tab"></div>');

        this.$pageArea = $('<div class="brtc-va-tools-tab-pages"></div>');
        this.$navigatorArea = $('<div class="brtc-va-tools-tab-navigator"></div>');

        this.$parent.append(this.$mainControl);
        this.$mainControl.append(this.$pageArea).append(this.$navigatorArea);

        this.createPages(this.$pageArea);
        this.createNavigator(this.$navigatorArea);

        this.select(0); 
    };

    Tab.prototype.createPages = function ($parent) {
        this.pages = new Brightics.VA.Core.Tools.TabPage($parent, {
            pages: this.options.pages
        });
    };

    Tab.prototype.createNavigator = function ($parent) {
        var _this = this;

        var labels = _.map(this.options.pages, function (page) {
            return page.label;
        })
        this.navigator = new Brightics.VA.Core.Tools.TabNavigator($parent, {
            elements: labels,
            onClick: function (index) {
                _this.select(index);
            }
        });
    };

    Tab.prototype.select = function (index) {
        this.navigator.select(index);
        this.pages.select(index);
    };

    Brightics.VA.Core.Tools.Tab = Tab;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function TabNavigator(parentId, options) {
        this.options = options;
        this.parentId = parentId;

        _retrieveParent.bind(this)();

        this.createControls();
    }

    var _retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    TabNavigator.prototype.init = function () {
        this.selectedIndex = 0;
    };

    TabNavigator.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-tools-tab-navigator-wrapper"></div>');

        this.$parent.append(this.$mainControl);

        this.createNavigator();
    };

    TabNavigator.prototype.createNavigator = function () {
        var _this = this;

        for (var i in this.options.elements) {
            var $navigator = $('<div class="brtc-va-tools-tab-navigator-element"></div>');
            $navigator.text(this.options.elements[i]);
            $navigator.attr('tabIndex', i);
            $navigator.click(function () {
                var tabIndex = $(this).attr('tabIndex');
                _this.select(tabIndex);
            });

            this.$mainControl.append($navigator);
        }
    };

    TabNavigator.prototype.select = function (index) {
        if (this.getSelectedIndex() != index) {
            this.active(index);
            this.options.onClick(index);
        }
    };

    TabNavigator.prototype.active = function (index) {
        this.setSelectedIndex(index);
        
        this.$mainControl.find('.brtc-va-tools-tab-navigator-element').removeClass('selected');
        this.$mainControl.find('.brtc-va-tools-tab-navigator-element[tabIndex=' + index + ']').addClass('selected');
    };

    TabNavigator.prototype.getSelectedIndex = function () {
        return this.selectedIndex;
    };

    TabNavigator.prototype.setSelectedIndex = function (index) {
        this.selectedIndex = index;
    };

    Brightics.VA.Core.Tools.TabNavigator = TabNavigator;

}).call(this);
(function () {
    'use strict';

    var root = this;
    var Brightics = root.Brightics;

    function TabPage(parentId, options) {
        this.options = options;
        this.parentId = parentId;

        _retrieveParent.bind(this)();

        this.init();
        this.createControls();
    }

    var _retrieveParent = function () {
        this.$parent = Brightics.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);
    };

    TabPage.prototype.init = function () {
        this.pages = [];
    };

    TabPage.prototype.destroy = function () {
        for(var i = 0; i<this.pages.length; i++){
            this.options.pages[i].destroy(this.pages[i]);
        }
    };

    TabPage.prototype.createControls = function () {
        this.$mainControl = $('<div class="brtc-va-tools-tab-pages-wrapper"></div>');

        this.$parent.append(this.$mainControl);

        this.createPages();
    };

    TabPage.prototype.createPages = function () {
        for (var i in this.options.pages) {
            var $page = $('<div class="brtc-va-tools-tab-page" isRendered="false"></div>');
            $page.attr('tabIndex', i);
            this.pages.push($page);

            this.$mainControl.append($page);
        }
    };

    TabPage.prototype.select = function (index) {
        var renderedIndexes = this.getRenderedIndexes();

        this.active(index);
        if (renderedIndexes.indexOf(index) < 0) {
            this.render(index);
        }
    };

    TabPage.prototype.render = function (index) {
        var renderer = this.options.pages[index].renderer;
        // var type = this.options.pages[index].label;
        // type = (type === 'table')? 'outData' : type;
        var $page = this.pages[index];
        $page.attr('isRendered', 'true');

        renderer(this.pages[index], this.options.pages[index].type);
        // renderer(this.pages[index]);
    };

    TabPage.prototype.active = function (index) {
        this.$mainControl.find('.brtc-va-tools-tab-page').hide();
        
        var $page = this.pages[index];
        $page.show();
    };

    TabPage.prototype.getRenderedIndexes = function () {
        var indexes = [];
        for (var i=0; i<this.pages.length; i++) {
            var $page = this.pages[i];
            if ($page.attr('isRendered') === 'true') indexes.push(i);
        }

        return indexes;
    };

    Brightics.VA.Core.Tools.TabPage = TabPage;

}).call(this);
/**
 * hyunseok.oh@samsung.com
 * 2017. 12. 25
 */

/* global */
(function () {
    'use strict';
    var Brightics = this.Brightics;

    function ModelVersionDetail(opt) {
        this.$el = opt.$el;
        var html = [
            '<div class="brtc-va-version-detail-body">',
            '   <div class="brtc-va-version-detail-row">',
            '      <div class="brtc-va-version-detail-label">Name</div>',
            '      <input readonly type="text" class="brtc-va-version-detail-label-input brtc-style-flex-1" maxlength="80"/>',
            '   </div>',
            '   <div class="brtc-va-version-detail-row">',
            '      <div class="brtc-va-version-detail-label">Description</div>',
            '      <div readonly class="brtc-va-version-detail-description-input brtc-style-flex-1">',
            '      </div>',
            '   </div>',
            '   <div class="brtc-va-version-detail-row">',
            '      <div class="brtc-va-version-detail-label">Tags</div>',
            '      <input readonly type="text" class="brtc-va-version-detail-tags-input brtc-style-flex-1" maxlength="80"/>',
            '   </div>',
            '</div>'
        ].join('\n');

        this.$self = $(html);
        this.$el.append(this.$self);
        this._init();
    }

    ModelVersionDetail.prototype._init = function () {
        this.$labelInput = this.$self.find('.brtc-va-version-detail-label-input')
            .jqxInput({theme: Brightics.VA.Env.Theme, disabled: true});
        this.$tagsInput = this.$self.find('.brtc-va-version-detail-tags-input')
            .jqxInput({theme: Brightics.VA.Env.Theme, disabled: true});
        this.$descriptionInput = this.$self.find('.brtc-va-version-detail-description-input');
        this.$descriptionInput.perfectScrollbar();
    };

    ModelVersionDetail.prototype._render = function () {
        this.$labelInput.val(this.data.getLabel());
        this.$tagsInput.val(this.data.getTags());
        this.$descriptionInput.html(this.data.getDescription());
        this.$descriptionInput.perfectScrollbar('update');
    };

    ModelVersionDetail.prototype.update = function (data) {
        this.data = data;
        this._render();
    };

    Brightics.VA.Core.Components.ModelVersionDetail = ModelVersionDetail;
/* eslint-disable no-invalid-this */
}.call(this));

/**
 * hyunseok.oh@samsung.com
 * 2017. 12. 25
 */

/* global _ */
(function () {
    'use strict';
    var Brightics = this.Brightics;
    var Utils = Brightics.VA.Core.Utils;

    /**
     * 주의: ModelVersionList안에서 Version Data를 직접 바꾸지 않도록 해야 함 (카피해서 쓰기)
     */
    function ModelVersionList(opt) {
        this.$el = opt.$el;
        this.onItemClick = opt.onItemClick;
        this.$self = $('<div class="brtc-va-version-list-grid"></div>');
        this.emitter = opt.emitter;
        this.columnOptions = [
            {
                name: 'Version',
                key: 'version',
                type: 'string',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 100
            },
            {
                name: 'Name',
                key: 'label',
                type: 'string',
                headerAlign: 'center',
                dataAlign: 'left',
                width: 'auto'
            },
            {
                name: 'Tags',
                key: 'tags',
                type: 'string',
                headerAlign: 'center',
                dataAlign: 'left',
                width: 'auto'
            },
            {
                name: 'Create Time',
                key: 'create_time',
                type: 'date',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 150
            },
            {
                name: 'Update Time',
                key: 'update_time',
                type: 'date',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 150
            }
        ];

        this.listOptions = {
            height: '400px'
        };

        this._initOptions();
        this.baseList = this._createList(this.$self);
        this.$el.append(this.$self);
        this.data = [];

        this.projectId = opt.projectId;
        this.fileId = opt.fileId;

        this.refreshFileVersionList();
    }

    ModelVersionList.prototype.update = function (_data) {
        this.data = _.clone(_data);

        this.data.sort(function (a, b) {
            return b.compareToByVersion(a);
        });

        this.baseList.update(_.map(this.data, function (version) {
            return {
                version: version.getVersion(),
                label: version.getLabel(),
                tags: version.getTags(),
                update_time: version.getUpdateTime(),
                create_time: version.getCreateTime()
            };
        }));

        // this.data = _.map(this.data, function (val) {
        //     val.version = val.major_version + '.' + val.minor_version;
        //     return val;
        // });

        // this.baseList.update(this.data);
    };

    ModelVersionList.prototype._initOptions = function () {
    };

    ModelVersionList.prototype._createList = function ($parent) {
        return new Brightics.VA.Controls.ControlFactory.createListControl($parent, {
            width: '100%',
            height: 'calc(100% - 35px)',
            columns: this.columnOptions,
            listOptions: this.listOptions
        })
            .on('cell-click', _.debounce(function (evt) {
                var data = this.data[evt.index];
                this.openDetailVersionDialog(data.getFileId(), data.getVersionId());
            }.bind(this), 300))
            .render();
    };

    ModelVersionList.prototype.openDetailVersionDialog = function (fileId, versionId) {
        var closeHandler = function (result) {
            // if (result.loadingSuccess) this.$mainControl.dialog('close');
            if (result.edited) this.refreshFileVersionList();
        }.bind(this);

        new Brightics.VA.Core.Dialogs.DetailVersionDialog(this.$mainControl, {
            projectId: this.projectId,
            fileId: fileId,
            versionId: versionId,
            close: closeHandler
        });
    };

    ModelVersionList.prototype.refreshFileVersionList = function () {
        Studio.getResourceManager().fetchVersions(this.projectId, this.fileId)
            .then(function (fileVersions) {
                this.update(fileVersions);
            }.bind(this))
            .catch(this._onError.bind(this));
    };

    ModelVersionList.prototype._onError = function (err) {
        Brightics.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(err);
        this.emitter.emit('error', err);
    };

    ModelVersionList.prototype.getControl = function () {
        return this.baseList;
    };

    ModelVersionList.prototype.destroy = function () {
        this.baseList.destroy();
    };

    Brightics.VA.Core.Components.ModelVersionList = ModelVersionList;
    /* eslint-disable no-invalid-this */
}.call(this));

/* -----------------------------------------------------
 *  modelversionlistloadable.js
 *  Created by hyunseok.oh@samsung.com on 2018-01-03.
 * ----------------------------------------------------*/

(function () {
    'use strict';
    var Brightics = this.Brightics;
    var _super = Brightics.VA.Core.Components.ModelVersionList.prototype;

    var CLASS_BUTTON = 'brtc-va-base-list-button';

    function ModelVersionListLoadable(opt) {
        _super.constructor.call(this, opt);
    }

    ModelVersionListLoadable.prototype = Object.create(_super);
    ModelVersionListLoadable.prototype.constructor = ModelVersionListLoadable;

    ModelVersionListLoadable.prototype._initOptions = function () {
        var emitter = this.emitter;
        var _this = this;
        var columnOptions = [
            {
                name: 'Load',
                key: 'load',
                dataRenderer: function (index, value) {
                    var $elem = $('<div>Load</div>');
                    $elem.on('mousedown', function (event) {
                        
                        emitter.emit('load', _this.data[event.index]);
                        // emitter.emit('load', event.data);
                        event.stopPropagation();
                        
                        return false;
                    });
                    $elem.addClass(CLASS_BUTTON);
                    return $elem;
                }
            }
        ];
        this.columnOptions = this.columnOptions.concat(columnOptions);
    };

    Brightics.VA.Core.Components.ModelVersionListLoadable = ModelVersionListLoadable;
/* eslint-disable no-invalid-this */
}.call(this));

/**
 * hyunseok.oh@samsung.com
 * 2018. 01. 03
 */

(function () {
    'use strict';
    var Brightics = this.Brightics;
    var _super = Brightics.VA.Core.Components.ModelVersionList.prototype;

    var CLASS_BUTTON = 'brtc-va-base-list-button';

    function ModelVersionListSelectable(opt) {
        _super.constructor.call(this, opt);
    }

    ModelVersionListSelectable.prototype = Object.create(_super);
    ModelVersionListSelectable.prototype.constructor = ModelVersionListSelectable;

    ModelVersionListSelectable.prototype._initOptions = function () {
        var emitter = this.emitter;
        var _this = this;
        var columnOptions = [
            {
                name: 'Select',
                key: 'select',
                dataRenderer: function (index, value) {
                    var $elem = $('<div>Select</div>');
                    $elem.on('mousedown', function (event) {
                        event.stopPropagation();
                        emitter.emit('select', _this.data[event.index]);
                        // emitter.emit('select', event.data);
                        return false;
                    });
                    $elem.addClass(CLASS_BUTTON);
                    return $elem;
                }
            }
        ];
        this.columnOptions = this.columnOptions.concat(columnOptions);
    };

    ModelVersionListSelectable.prototype.openDetailVersionDialog = function (fileId, versionId) {
        new Brightics.VA.Core.Dialogs.SelectVersionDetailDialog(this.$mainControl, {
            projectId: this.projectId,
            fileId: fileId,
            versionId: versionId
        });
    };

    Brightics.VA.Core.Components.ModelVersionListSelectable = ModelVersionListSelectable;
    /* eslint-disable no-invalid-this */
}.call(this));

/**
 * sungjin1.kim@samsung.com
 * 2018. 02. 08
 */

/* global _ */
(function () {
    'use strict';
    var Brightics = this.Brightics;

    /**
     * 주의: ScheduleList안에서 Schedule Data를 직접 바꾸지 않도록 해야 함 (카피해서 쓰기)
     */
    function ScheduleList(opt) {
        this.$el = opt.$el;
        this.onItemClick = opt.onItemClick;
        this.$self = $('<div class="brtc-va-schedule-list-grid"></div>');
        this.emitter = opt.emitter;

        this.columnOptions = [
            {
                name: 'Schedule Name',
                key: 'scheduleName',
                type: 'string',
                headerAlign: 'center',
                dataAlign: 'left',
                width: 'auto'
            },
            {
                name: 'Cron Expression',
                key: 'cronExpression',
                type: 'string',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 'auto'
            },
            {
                name: 'Start Time',
                key: 'scheduleStartTime',
                type: 'date',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 150
            },
            {
                name: 'End Time',
                key: 'scheduleEndTime',
                type: 'date',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 150
            },
            {
                name: 'Next Time',
                key: 'scheduleNextTime',
                type: 'date',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 150
            },
            {
                name: 'Schedule Owner',
                key: 'scheduleOwner',
                type: 'string',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 'auto'
            },
            {
                name: 'Is Active',
                key: 'isActive',
                type: 'string',
                headerAlign: 'center',
                dataAlign: 'center',
                width: 90
            }
        ];

        this._initOptions();
        this.baseList = this._createList(this.$self);
        this.$el.append(this.$self);
        this.data = [];
    }

    ScheduleList.prototype.update = function (_data) {
        this.data = _.clone(_data);
        this.data.sort(function (a, b) {
            return b.create_time - a.crete_time;
        });
        this.baseList.update(this.data);
    };

    ScheduleList.prototype._initOptions = function () {
    };

    ScheduleList.prototype._createList = function ($parent) {
        return new Brightics.VA.Controls.ControlFactory.createListControl($parent, {
            width: '100%',
            height: 'calc(100% - 35px)',
            columns: this.columnOptions,
            selectable: true
        })
            .on('cell-click', _.debounce(function (evt) {
                this.emitter.emit('row-click', evt.data);
            }.bind(this), 300))
            .on('row-select', _.debounce(function (evt) {
                this.emitter.emit('row-select', evt.data);
            }.bind(this), 300))
            .on('row-unselect', _.debounce(function (evt) {
                this.emitter.emit('row-unselect', evt.data);
            }.bind(this), 300))
            .render();
    };

    ScheduleList.prototype.getControl = function () {
        return this.baseList;
    };

    ScheduleList.prototype.destroy = function () {
        this.baseList.destroy();
    };

    Brightics.VA.Core.Components.ScheduleList = ScheduleList;
    /* eslint-disable no-invalid-this */
}.call(this));

/**
 * Created by jmk09.jung on 2018-02-13.
 */
(function () {
    'use strict';

    var root = this;

    root.Brightics.VA.Extentsion = {
        // 다 감싸야함  //지금은 싸그리 다 있지만 모델별로? 프로젝트별로?
        getActiveEditor: function () {
            return Studio.getEditorContainer().getActiveModelEditor();
        },
        openClipboard: function () {
            Studio.getClipboardManager().openClipboard();
        },
        openFunctionhelp: function () {
            var w = window.open('api/va/v2/help/function?type=data', 'Brightics Help');
            w.blur();
        },
        openHistoryDialog: function (e) {
            var activeEditor = this.getActiveEditor();

            activeEditor.getModelLayoutManager().handleOpenHistoryDialog(e);
        },
        openIndexDialog: function (e) {
            var activeEditor = this.getActiveEditor();

            activeEditor.getModelLayoutManager().handleOpenIndexDialog(e);
        },
        openScheduleManagementDialog: function () {
            var activeEditor = this.getActiveEditor();

            activeEditor.getModelLayoutManager().handleOpenScheduleManagementDialog();
        },
        redo: function () {
            var activeEditor = this.getActiveEditor();

            activeEditor.getCommandManager().redo();
        },
        undo: function () {
            var activeEditor = this.getActiveEditor();

            activeEditor.getCommandManager().undo();
        },
        setLastSelectedScale: function (scale) {
            var activeEditor = this.getActiveEditor();

            activeEditor.options.lastSelectedScale = scale;
        },
        getLastSelectedScale: function () {
            var activeEditor = this.getActiveEditor();

            return activeEditor.options.lastSelectedScale;
        },
        changeScale: function (scale) {
            var activeEditor = this.getActiveEditor();

            activeEditor.getModelLayoutManager().handleChangeScale(scale);
        },
        changeTooltipEnabled: function (enable) {
            var activeEditor = this.getActiveEditor();

            activeEditor.getModelLayoutManager().handleChangeTooltipEnabled(enable);
        },
        sidebarExpandStatusChanged: function (sidebarName, isExpand) {
            var activeEditor = this.getActiveEditor();

            activeEditor.getSideBarManager().expandStatusChanged(sidebarName, isExpand);
        }
    }
}).call(this);