/*   Brightics VA Build 190718 */!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports;}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o});},i.n=function(t){var e=t&&t.__esModule?function(){return t.default;}:function(){return t;};return i.d(e,"a",e),e;},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e);},i.p="",i(i.s=29);}([function(t,e,i){"use strict";i.d(e,"a",function(){return o;});var o=function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t;};},function(t,e,i){"use strict";i.d(e,"a",function(){return n;});var o=i(31);function n(t){}i.n(o)()(n.prototype);},function(t,e,i){"use strict";i.d(e,"a",function(){return n;}),i.d(e,"b",function(){return r;}),i.d(e,"c",function(){return a;});var o=function o(t){return Promise.resolve($.ajax(t));},n=function n(t){return o({type:"GET",url:t});},r=function r(t,e){var i={type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",url:t};return o(i);},a=function a(t,e){var i={type:"POST",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",url:t,async:!1};return o(i);};},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CORE_VERSION="3.6";},function(t,e,i){"use strict";i.d(e,"a",function(){return n;});var o=i(1);function n(t,e){o.a.call(this),this.$el=t,this.options=e;}n.prototype=Object.create(o.a.prototype),n.prototype.constructor=n,n.prototype.getParent=function(){return this.$el;},n.prototype.getOptions=function(){return this.options;},n.prototype.render=function(){throw new Error("not implemented");},n.prototype.destroy=function(){};},function(t,e,i){"use strict";var o=i(39)();t.exports=function(t){return t!==o&&null!==t;};},function(t,e,i){"use strict";i.d(e,"a",function(){return a;});var o=i(16),n=i(7),r=i(0);function a(t){this.data=t||{},this.data.update_time&&(this.data.update_time=new Date(moment(this.data.update_time).format())),this.data.create_time&&(this.data.create_time=new Date(moment(this.data.create_time).format())),this.data.contents?(Object(o.a)(this.data),Object(o.c)(this.data.contents)):this.data.contents={};}Object(r.a)(a,n.a),a.prototype.getFileId=function(){return this.data.id;},a.prototype.setFileId=function(t){return this.data.id=t,this.data.contents.mid=t,this;},a.prototype.getDescription=function(){return this.data.description;},a.prototype.setDescription=function(t){return this.data.description=t,this;},a.prototype.getType=function(){return this.data.type;},a.prototype.setType=function(t){return this.data.type=t,this;},a.prototype.getEventKey=function(){return this.data.event_key;},a.prototype.setEventKey=function(t){return this.data.event_key=t,this;},a.prototype.getLabel=function(){return this.data.label;},a.prototype.setLabel=function(t){return this.data.label=t,this.data.contents.title=t,this;},a.prototype.getProjectId=function(){return this.data.project_id;},a.prototype.setProjectId=function(t){return this.data.project_id=t,this;},a.prototype.getUpdateTime=function(){return new Date(this.data.update_time);},a.prototype.setUpdateTime=function(t){return this.data.update_time=t,this;},a.prototype.getCreateTime=function(){return new Date(this.data.create_time);},a.prototype.setCreateTime=function(t){return this.data.create_time=t,this;},a.prototype.getUpdater=function(){return this.data.updater;},a.prototype.setUpdater=function(t){return this.data.updater=t,this;},a.prototype.getCreator=function(){return this.data.creator;},a.prototype.setCreator=function(t){return this.data.creator=t,this;},a.prototype.getFromVersion=function(){return this.data.from_version;},a.prototype.setFromVersion=function(t){return this.data.from_version=t,this;},a.prototype.getModelImage=function(){return this.data.model_image;},a.prototype.setModelImage=function(t){return this.data.model_image=t,this;},a.prototype.setContents=function(t){return this.data.contents=t,this.data.contents.title=this.data.label,Object(o.a)(this.data),Object(o.c)(this.data.contents),this;},a.prototype.getContents=function(t){return this.data.contents;},a.prototype.toJSON=function(){return this.data;},a.prototype.getHashCode=function(){return this.getFileId();},a.prototype.equals=function(t){return this.getFileId()==t.getFileId()&&this.getEventKey()==t.getEventKey()&&Number(this.getUpdateTime())==Number(t.getUpdateTime());},a.prototype.getResourceName=function(){return"file";},a.prototype.getInnerModels=function(){return this.data.contents.innerModels;},a.prototype.getInnerModel=function(t){if(this.data.contents.innerModels)return this.data.contents.innerModels[t];},a.prototype.getParam=function(){return this.data.contents.param;},a.prototype.setParam=function(t,e){this.data.contents.param[t]=e;};},function(t,e,i){"use strict";function o(){}i.d(e,"a",function(){return o;}),o.prototype.equals=function(t){throw new Error("not implemented");},o.prototype.getHashCode=function(){throw new Error("not implemented");},o.prototype.toJSON=function(){throw new Error("not implemented");},o.prototype.getResourceName=function(){throw new Error("not implemented");};},function(t,e,i){"use strict";function o(){this.map={},this.chk={};}i.d(e,"a",function(){return o;}),o.prototype.set=function(t,e){this.map[t]=e,this.chk[t]=!0;},o.prototype.get=function(t){return this.map[t];},o.prototype.remove=function(t){var e=this.map[t];return this.chk[t]=!1,delete this.map[t],e;},o.prototype.has=function(t){return this.chk[t];},o.prototype.toArray=function(){return _.toArray(this.map);},o.prototype.toJSON=function(){return this.map;};},function(t,e,i){"use strict";i.d(e,"b",function(){return o;}),i.d(e,"a",function(){return n;});var o=function o(t){return _.reduce(t,function(t,e){return t.then(function(t){return e(t);});},Promise.resolve());},n=function n(t){return Promise.all(_.map(t,function(t){return t();}));};},function(t,e,i){"use strict";var o=i(18),n=i(6),r=i(20),a=i(62);i.d(e,"c",function(){return o.a;}),i.d(e,"a",function(){return n.a;}),i.d(e,"d",function(){return r.a;}),i.d(e,"b",function(){return a.a;});},function(t,e,i){"use strict";i.d(e,"a",function(){return n;});var o=i(4);function n(t,e){o.a.call(this,t,e);}n.prototype=Object.create(o.a.prototype),n.prototype.constructor=n,n.prototype.update=function(t){throw new Error("not implemented");};},function(t,e,i){"use strict";i.d(e,"a",function(){return n;});var o=i(11);function n(t,e){o.a.call(this,t,e),this.listeners={},this.jqxOptions=this._brtcOptions2jqxOptions(this.options),this.keyIndex=0;}n.prototype=Object.create(o.a.prototype),n.prototype.constructor=n,n.prototype.update=function(t){this.source.localdata=t,this.$content.jqxGrid("updatebounddata"),this.options.selectable&&this.$content.jqxGrid("clearselection");},n.prototype.render=function(){return this.$template=$(['<div class="brtc-va-base-list">','  <div class="brtc-va-base-list-wrapper">','    <div class="brtc-va-base-list-content">',"    </div>","  </div>","</div>"].join("\n")),this.$wrapper=this.$template.find(".brtc-va-base-list-wrapper"),this.$wrapper.perfectScrollbar(),this.$content=this.$template.find(".brtc-va-base-list-content"),this._registerAllListeners(this.listeners),this.$content.jqxGrid(this.jqxOptions),this.$el.empty(),this.$el.append(this.$template),this._initEventListeners(),this;},n.prototype.destroy=function(){this.$content.jqxGrid("destroy");},n.prototype._brtcOptions2jqxOptions=function(t){var e={theme:"office"};return e.sortable=t.sortable||!1,e.selectionmode=t.selectable?"checkbox":"none",e.columnsresize=!1,e.filterable=!1,e.altrows=!1,e.showfiltercolumnbackground=!1,e.rowsheight=t.rowsHeight||53,e.columnsheight=t.rowsHeight||53,e.enabletooltips=!0,e.width=t.width||"auto",e.height=t.height||"auto",this.source=this._getSource(t.columns),e.source=new $.jqx.dataAdapter(this.source),t.data&&t.data.length&&(e.source.localdata=t.data),e.columns=this._getJqxGridColumnsOption(t.columns),e;},n.prototype._getSource=function(t){var e={localdata:[],datatype:"array"};return e.datafileds=_.map(t,function(t){return{name:t.key,type:t.type||"string"};}),e;},n.prototype._getJqxGridColumnsOption=function(t){var e={cellclassname:"brtc-va-base-list-grid-cell",renderer:this._getDefaultHeaderRenderer()};return _.map(t,function(t){if(t.key){var i={text:t.name,datafield:t.key,width:t.width||"auto",align:t.headerAlign||"center",cellsalign:t.dataAlign||"center",cellsrenderer:t.dataRenderer?this._getGenerativeRenderer(t.dataAlign,t.dataRenderer):this._getDefaultDataRenderer(t.type,t.dataAlign)};return _.extend({},e,i);}}.bind(this));},n.prototype._getDefaultHeaderRenderer=function(){return function(t){return'<div class="brtc-va-base-list-column-header">'+_.escape(t)+"</div>";};},n.prototype._getDefaultDataRenderer=function(t,e){var i=[this._getAlignClass(e)].join(" ");return function(e,o,n){return this._wrap("<div>"+_.escape(this._format(n,t))+"</div>",i);}.bind(this);},n.prototype._getAlignClass=function(t){return{left:"brtc-va-base-list-grid-cell-flex-left",center:"brtc-va-base-list-grid-cell-flex-center",right:"brtc-va-base-list-grid-cell-flex-right"}[t||"center"];},n.prototype._getGenerativeRenderer=function(t,e){var i=[this._getAlignClass(t)].join(" ");return function(t,o,n){var r=e(t,n);return this._wrap(this._getHtmlWithEventHandler(r,t),i);}.bind(this);},n.prototype._getHtmlWithEventHandler=function(t,e){var i=this.source.localdata[e],o=e,n=function(t){var e=$._data(t,"events");_.forOwn(e,function(e,n){var r=this._genHandlerKey();this.listeners[n]=this.listeners[n]||{},this.listeners[n][r]={fn:function fn(t){_.forEach(e,function(e){e.handler(t);});},data:i,index:o},t.setAttribute(n+"__key__",r);}.bind(this));}.bind(this),r=function r(t){var e=t.children;n(t),_.forEach(e,function(t){n(t),r(t);});};return r(t[0]),t[0].outerHTML;},n.prototype._wrap=function(t,e){return['<div class="'+e+'">',t,"</div>"].join("");},n.prototype._format=function(t,e){var i=t||"";return"date"==(e||"string")&&i?moment(i).format("YYYY-MM-DD HH:mm:ss"):i;},n.prototype._genHandlerKey=function(){return parseInt(++this.keyIndex);},n.prototype._initEventListeners=function(t){this.$content.on("cellclick",function(t){return(!t.args.originalEvent||!t.args.originalEvent.cancel)&&"_checkboxcolumn"!=t.args.datafield&&(this.emit("cell-click",{data:this.source.localdata[t.args.rowindex],index:t.args.rowindex}),!0);}.bind(this)),this.$content.on("rowselect",function(t){return(!t.args.originalEvent||!t.args.originalEvent.cancel)&&(this.emit("row-select",{data:this.source.localdata[t.args.rowindex],index:t.args.rowindex}),!0);}.bind(this)),this.$content.on("rowunselect",function(t){return(!t.args.originalEvent||!t.args.originalEvent.cancel)&&(this.emit("row-unselect",{data:this.source.localdata[t.args.rowindex],index:t.args.rowindex}),!0);}.bind(this));},n.prototype._registerAllListeners=function(t){var e=this.$content;_.forEach(["mousedown","click","change","dblclick","keydown","keyup"],function(i){e.on(i,function(e){e.preventDefault(),e.stopPropagation();var o=i+"__key__",n=(e.originalEvent||e.args.originalEvent).target.getAttribute(o);return t[i]&&t[i][n]&&(e.cancel=!0,e.data=t[i][n].data,e.index=t[i][n].index,t[i][n].fn(e)),!1;});});},n.prototype.getSelectedRows=function(){var t=this.$content.jqxGrid("getselectedrowindexes");return _.map(t,function(t){return this.source.localdata[t];}.bind(this));};},function(t,e,i){"use strict";i.d(e,"a",function(){return n;});var o=i(4);function n(t,e){o.a.call(this,t,e);}n.prototype=Object.create(o.a.prototype),n.prototype.constructor=n,n.prototype.setItems=function(t){throw new Error("not implemented");},n.prototype.getItems=function(){throw new Error("not implemented");},n.prototype.getSelectedItem=function(){throw new Error("not implemented");},n.prototype.isSelected=function(){throw new Error("not implemented");},n.prototype.isOpened=function(){throw new Error("not implemented");},n.prototype.open=function(){throw new Error("not implemented");},n.prototype.close=function(){throw new Error("not implemented");},n.prototype.enable=function(){throw new Error("not implemented");},n.prototype.disable=function(){throw new Error("not implemented");};},function(t,e,i){"use strict";i.d(e,"a",function(){return n;});var o=i(13);function n(t,e){o.a.call(this,t,e),this.jqxOptions=this._brtcOptions2jqxOptions(e),this._initEventListener();}n.prototype=Object.create(o.a.prototype),n.prototype.constructor=n,n.prototype._initEventListener=function(){this.$el.on("open",function(t){this.emit("open",t);}.bind(this)),this.$el.on("close",function(t){this.emit("close",t);}.bind(this)),this.$el.on("select",function(t){this.emit("select",t);}.bind(this));},n.prototype._getAutoDropDownHeight=function(t){return!(t.itemHeight*t.source.length>t.dropDownHeight);},n.prototype._brtcOptions2jqxOptions=function(t){var e={theme:"office"};return e.width=t.width||"100%",e.itemHeight=t.itemHeight||30,e.height=e.itemHeight,e.dropDownHeight=t.height||300,this.renderer=this._getRenderer(t.renderer),e.placeHolder=void 0!==t.placeHolder?t.placeHolder:"choose",this.data=t.data||[],e.source=this._getRenderedData(this.data),e.autoDropDownHeight=this._getAutoDropDownHeight(e),e;},n.prototype._getRenderer=function(t){return t||function(t){return t;};},n.prototype._getRenderedData=function(t){return _.map(t,this.renderer);},n.prototype.render=function(){return this.$el.jqxDropDownList(this.jqxOptions),this;},n.prototype.setItems=function(t){return this.data=t,this.jqxOptions.source=this._getRenderedData(this.data),this.jqxOptions.autoDropDownHeight=this._getAutoDropDownHeight(this.jqxOptions),this.$el.jqxDropDownList({source:this.jqxOptions.source}),this;},n.prototype.getItems=function(){return this.data;},n.prototype.getSelectedItem=function(){if(!this.isSelected())throw new Error("not selected");return this.data[this.$el.jqxDropDownList("selectedIndex")];},n.prototype.isSelected=function(){return this.$el.jqxDropDownList("selectedIndex")>-1;},n.prototype.isOpened=function(){return this.$el.jqxDropDownList("isOpened");},n.prototype.open=function(){return this.$el.jqxDropDownList("open"),this;},n.prototype.close=function(){return this.$el.jqxDropDownList("close"),this;},n.prototype.enable=function(){return this.$el.jqxDropDownList({disabled:!1}),this;},n.prototype.disable=function(){return this.$el.jqxDropDownList({disabled:!0}),this;},n.prototype.focus=function(){return this.$el.jqxDropDownList("focus"),this;};},function(t,e,i){"use strict";i.d(e,"a",function(){return f;});var o=i(2),n=i(6),r=i(49),a=i.n(r);var _ref=_,s=_ref.map,l=_ref.compact,c=_ref.first,d=_ref.flow,p=function p(t){try{return new n.a(t);}catch(t){return void console.warn("Some files are ignored.");}},u=function u(t){return l(s(t,p));},h=d(c,p);var f={getFiles:function getFiles(t){var e="api/va/v2/ws/projects/"+t+"/files";return Object(o.a)(e).then(u);},getFile:function getFile(t,e){var i="api/va/v2/ws/projects/"+t+"/files/"+e;return Object(o.a)(i).then(function(t){return t.length?h(t):null;});},addFile:function addFile(t,e){var i="api/va/v2/ws/projects/"+t+"/files";return Object(o.b)(i,e.toJSON());},updateFile:function updateFile(t,e){var i="api/va/v2/ws/projects/"+t+"/files/"+e.getFileId()+"/update";return Object(o.b)(i,e.toJSON()).then(h);},updateFileSync:function updateFileSync(t,e){var i="api/va/v2/ws/projects/"+t+"/files/"+e.getFileId()+"/update";return Object(o.c)(i,e.toJSON()).then(h);},deleteFile:function deleteFile(t,e){var i="api/va/v2/ws/projects/"+t+"/files/"+e+"/delete";return Object(o.b)(i);},saveFileSync:function saveFileSync(t,e,i){var n="api/va/v2/ws/projects/"+t+"/files/"+e.getFileId()+"/save",r=function(t){return JSON.parse(JSON.stringify(t));}(e.getContents()),s=Object.assign(_.omit(e.toJSON(),"contents"),{modelDiff:i,hash:a()(r,{respectFunctionProperties:!1,respectFunctionNames:!1,respectType:!1})});return Object(o.c)(n,s).then(c);}};},function(t,e,i){"use strict";i.d(e,"a",function(){return o;}),i.d(e,"b",function(){return n;}),i.d(e,"c",function(){return a;});var o=function o(t){t.contents=Brightics.VA.Core.Utils.ModelUtils.extendModel(t.contents);var e=Object.keys(Brightics.VA.Core.Interface.Clazz);void 0!==t&&e.indexOf(t.contents.type)<0||(t.contents.title=t.label,t.contents.mid=t.id,t.contents.adjustLinks());},n=function n(t){t.contents=Brightics.VA.Core.Utils.ModelUtils.extendModel(t.contents);var e=Object.keys(Brightics.VA.Core.Interface.Clazz);"undefined"!=typeof file&&e.indexOf(t.contents.type)<0||(t.contents.title=t.label,t.contents.mid=t.file_id,t.contents.version_id=t.version_id,t.contents.adjustLinks());},r=0,a=function a(t){r=r||new Brightics.VA.Core.Tools.ModelMigrator.Executor();try{r.migrate(t);}catch(t){throw console.error(t),new Error("Migration failed.");}};},function(t,e,i){"use strict";i.d(e,"a",function(){return s;});var o=i(2),n=i(18),r=function r(t){return new n.a(t);},a=function a(t){return _.map(t,r);},s={getProjects:function getProjects(){return Object(o.a)("api/va/v2/ws/projects").then(a);},getProject:function getProject(t){var e="api/va/v2/ws/projects/"+t;return Object(o.a)(e).then(function(t){return r(t[0]);});},addProject:function addProject(t){return Object(o.b)("api/va/v2/ws/projects",t.toJSON()).then(r);},updateProject:function updateProject(t){var e="api/va/v2/ws/projects/"+t.getProjectId()+"/update";return Object(o.b)(e,t.toJSON()).then(r);},deleteProject:function deleteProject(t){var e="api/va/v2/ws/projects/"+t+"/delete";return Object(o.b)(e);}};},function(t,e,i){"use strict";i.d(e,"a",function(){return r;});var o=i(7),n=i(0);function r(t){this.data=t||{};}Object(n.a)(r,o.a),r.prototype.getProjectId=function(){return this.data.id;},r.prototype.setProjectId=function(t){return this.data.id=t,this;},r.prototype.getLabel=function(){return this.data.label;},r.prototype.setLabel=function(t){return this.data.label=t,this;},r.prototype.getUpdateTime=function(){return new Date(moment(this.data.update_time).format());},r.prototype.setUpdateTime=function(t){return this.data.update_time=t,this;},r.prototype.getCreateTime=function(){return new Date(moment(this.data.create_time).format());},r.prototype.setCreateTime=function(t){return this.data.create_time=t,this;},r.prototype.getCreator=function(){return this.data.creator;},r.prototype.setCreator=function(t){return this.data.creator=t,this;},r.prototype.getUpdater=function(){return this.data.updater;},r.prototype.setUpdater=function(t){return this.data.updater=t,this;},r.prototype.getDescription=function(){return this.data.description;},r.prototype.setDescription=function(t){return this.data.description=t,this;},r.prototype.getModelCount=function(){return parseInt(this.data.model_count);},r.prototype.setModelCount=function(t){return this.data.model_count=t,this;},r.prototype.getReportCount=function(){return parseInt(this.data.report_count);},r.prototype.setReportCount=function(t){return this.data.report_count=t,this;},r.prototype.getTag=function(){return this.data.tag;},r.prototype.setTag=function(t){return this.data.tag=t,this;},r.prototype.getType=function(){return this.data.type;},r.prototype.setType=function(t){return this.data.type=t,this;},r.prototype.toJSON=function(){return this.data;},r.prototype.equals=function(t){return this.getProjectId()==t.getProjectId()&&Number(this.getUpdateTime())==Number(t.getUpdateTime());},r.prototype.getHashCode=function(){return this.getProjectId();},r.prototype.getResourceName=function(){return"project";};},function(t,e,i){"use strict";i.d(e,"a",function(){return l;});var o=i(2),n=i(6),r=i(20),a=function a(t){return new r.a(t);},s=function s(t){return _.map(t,a);},l={getVersions:function getVersions(t,e){var i="api/va/v2/ws/projects/"+t+"/files/"+e+"/versions";return Object(o.a)(i).then(s);},getVersion:function getVersion(t,e,i){var n="api/va/v2/ws/projects/"+t+"/files/"+e+"/versions/"+i;return Object(o.a)(n).then(a);},addVersion:function addVersion(t,e,i){var n="api/va/v2/ws/projects/"+t+"/files/"+e+"/versions";return Object(o.b)(n,i.toJSON(!0)).then(a);},updateVersion:function updateVersion(t,e,i){var n="api/va/v2/ws/projects/"+t+"/files/"+e+"/versions/"+i.getVersionId()+"/update";return Object(o.b)(n,i);},loadVersion:function loadVersion(t,e,i){var r="api/va/v2/ws/projects/"+t+"/files/"+e+"/versions/"+i+"/load";return Object(o.b)(r).then(function(t){if(t.length)return e=t[0],new n.a(e);var e;});},getVersionsForced:function getVersionsForced(t,e,i,o){var n={type:"GET",blocking:!0,async:!1,url:"api/va/v2/ws/projects/"+t+"/files/"+e+"/versions",contentType:"application/json; charset=utf-8"};return $.ajax(n).done(function(t){if(i&&"function"==typeof i)return i(s(t));}).fail(function(t){if(o&&"function"==typeof o)return o(t);});},getVersionForced:function getVersionForced(t,e,i,o,n){var r={type:"GET",blocking:!0,async:!1,url:"api/va/v2/ws/projects/"+t+"/files/"+e+"/versions/"+i,contentType:"application/json; charset=utf-8"};return $.ajax(r).done(function(t){if(o&&"function"==typeof o)return o(a(t));}).fail(function(t){if(n&&"function"==typeof n)return n(t);});}};},function(t,e,i){"use strict";i.d(e,"a",function(){return a;});var o=i(7),n=i(0),r=i(16);function a(t){this.data=t||{},this.data.contents?(Object(r.b)(this.data),Object(r.c)(this.data.contents)):this.data.contents={};}Object(n.a)(a,o.a),a.prototype.getVersionId=function(){return this.data.version_id;},a.prototype.setVersionId=function(t){return this.data.version_id=t,this.data.contents.version_id=t,this;},a.prototype.getLabel=function(){return this.data.label;},a.prototype.setLabel=function(t){return this.data.label=t,this.data.contents.title=t,this;},a.prototype.getDescription=function(){return this.data.description;},a.prototype.setDescription=function(t){return this.data.description=t,this;},a.prototype.getFileId=function(){return this.data.file_id;},a.prototype.setFileId=function(t){return this.data.file_id=t,this.data.contents.mid=t,this;},a.prototype.getMajorVersion=function(){return this.data.major_version;},a.prototype.setMajorVersion=function(t){return this.data.major_version=t,this;},a.prototype.getMinorVersion=function(){return this.data.minor_version;},a.prototype.setMinorVersion=function(t){return this.data.minor_version=t,this;},a.prototype.getVersion=function(){return this.data.major_version+"."+this.data.minor_version;},a.prototype.getType=function(){return this.data.type;},a.prototype.setType=function(t){return this.data.type=t,this;},a.prototype.getTags=function(){return this.data.tags;},a.prototype.setTags=function(t){return this.data.tags=t,this;},a.prototype.getModelImage=function(){return this.data.model_image;},a.prototype.setModelImage=function(t){return this.data.image=t,this;},a.prototype.getUpdateTime=function(){return new Date(moment(this.data.update_time).format());},a.prototype.setUpdateTime=function(t){return this.data.update_time=t,this;},a.prototype.getUpdater=function(){return this.data.updater;},a.prototype.setUpdater=function(t){return this.data.updater=t,this;},a.prototype.getCreateTime=function(){return new Date(moment(this.data.create_time).format());},a.prototype.setCreateTime=function(t){return this.data.create_time=t,this;},a.prototype.getCreator=function(){return this.data.creator;},a.prototype.setCreator=function(t){return this.data.creator=t,this;},a.prototype.getContents=function(){return this.data.contents;},a.prototype.setContents=function(t){return this.data.contents=t,Object(r.b)(this.data),Object(r.c)(this.data.contents),this;},a.prototype.toJSON=function(t){return t?this.data:_.omit(this.data,["isManual","isMajor"]);},a.prototype.setIsMajor=function(t){return this.data.isMajor=t,this;},a.prototype.setIsManual=function(t){return this.data.isManual=t,this;},a.prototype.compareToByVersion=function(t){return this.getMajorVersion()!==t.getMajorVersion()?this.getMajorVersion()-t.getMajorVersion():this.getMinorVersion()-t.getMinorVersion();},a.prototype.equals=function(t){return this.getVersionId()===t.getVersionId()&&Number(this.getUpdateTime())===Number(t.getUpdateTime());},a.prototype.getHashCode=function(){return this.getVersionId();},a.prototype.getResourceName=function(){return"version";};},function(t,e,i){"use strict";var o=i(8),n=i(22),r=i(23);i.d(e,"a",function(){return o.a;}),i.d(e,"b",function(){return n.a;}),i.d(e,"c",function(){return r.a;});},function(t,e,i){"use strict";i.d(e,"a",function(){return a;});var o=i(23),n=i(1),r=i(0);function a(){this.__root=new o.a();}Object(r.a)(a,n.a),a.prototype.getRootNode=function(){return this.__root;},a.prototype.getProjectNode=function(t){return this.__root.go(t);},a.prototype.getProjectNodeBruteForce=function(t){return this.getRootNode().findChildNodeBruteForce(t);},a.prototype.getProjectNodeByFileId=function(t){return this.getProjectNodeBruteForce(function(e){return e.hasChild(t);});},a.prototype.getFileNode=function(t,e){return t?this.getProjectNode(t).go(e):(console.warn("NO PROJECT ID"),this.getProjectNodeByFileId(e).go(e));},a.prototype.getVersionNode=function(t,e,i){return this.getFileNode(t,e).go(i);},a.prototype.getProjectMap=function(){return this.getRootNode().getChildrenMap();},a.prototype.getProjectArray=function(){return this.getRootNode().getChildren();},a.prototype.getFileMap=function(t){return this.getProjectNode(t).getChildrenMap();},a.prototype.getFileArray=function(t){return this.getProjectNode(t).getChildren();},a.prototype.getVersionMap=function(t,e){return this.getFileNode(t,e).getChildrenMap();},a.prototype.getVersionArray=function(t,e){return this.getFileNode(t,e).getChildren();},a.prototype.getProjects=function(){try{return this.getRootNode().getChildren();}catch(t){return;}},a.prototype.getProject=function(t){var e=this.getProjectNode(t);if(e)return e.getData();},a.prototype.getFiles=function(t){try{return this.getProjectNode(t).getChildren();}catch(t){return;}},a.prototype.getFile=function(t,e){try{return this.getFileNode(t,e).getData();}catch(t){return;}},a.prototype.getVersions=function(t,e){try{return this.getFileNode(t,e).getChildren();}catch(t){return;}},a.prototype.getVersion=function(t,e,i){try{return this.getVersionNode(t,e,i).getData();}catch(t){return;}},a.prototype.updateProject=function(t){return this.getProjectNode(t.getProjectId()).setData(t);},a.prototype.updateFile=function(t,e){return this.getFileNode(t,e.getFileId()).setData(e);},a.prototype.updateVersion=function(t,e,i){return this.getVersionNode(t,e,i.getVersionId()).setData(i);},a.prototype.addProject=function(t){return this.getRootNode().addChild(t.getProjectId(),t);},a.prototype.addFile=function(t,e){return this.getProjectNode(t).addChild(e.getFileId(),e);},a.prototype.addVersion=function(t,e,i){return this.getFileNode(t,e).addChild(i.getVersionId(),i);},a.prototype.deleteProject=function(t){return this.getRootNode().deleteChild(t).getData();},a.prototype.deleteFile=function(t,e){return this.getProjectNode(t).deleteChild(e).getData();},a.prototype.deleteVersion=function(t,e,i){return this.getFileNode(t,e).deleteChild(i).getData();};},function(t,e,i){"use strict";i.d(e,"a",function(){return a;});var o=i(8),n=i(1),r=i(0);function a(t,e){n.a.call(this),this.key=t,this.data=e,this.__parentNode=this,this.__childrenNodes=[],this.__childrenMap=new o.a();}Object(r.a)(a,n.a),a.prototype.hasChild=function(t){return this.__childrenMap.has(t);},a.prototype.setData=function(t){return this.data=t,this;},a.prototype.getData=function(){return this.data;},a.prototype.getKey=function(){return this.key;},a.prototype.setParent=function(t){this.__patrentNode=t;},a.prototype.getParent=function(){return this.__parentNode;},a.prototype.addChild=function(t,e){if(this.__childrenMap.has(t))return this.__childrenMap.get(t).setData(e);var i=new a(t,e);return i.setParent(this),this.__childrenMap.set(t,i),this.__childrenNodes.push(i),i;},a.prototype.deleteChild=function(t){var e=this.__childrenMap.remove(t);return _.remove(this.__childrenNodes,function(e){return e.getKey()==t;}),e;},a.prototype.updateChild=function(t,e){return this.__childrenMap.get(t).setData(e);},a.prototype.getChildren=function(){return _.map(this.__childrenNodes,function(t){return t.getData();});},a.prototype.getChildrenNodes=function(){return this.__childrenNodes;},a.prototype.getChildrenMap=function(){return _.forIn(this.__childrenMap.toJSON(),function(t){return t.getData();});},a.prototype.go=function(t){return this.__childrenMap.get(t);},a.prototype.getChild=function(t){return this.__childrenMap.get(t);},a.prototype.findChildNodeBruteForce=function(t){var e=_.findIndex(this.__childrenNodes,function(e){return t(e);});return e>-1?this.__childrenNodes[e]:null;};},function(t,e,i){"use strict";i.d(e,"a",function(){return g;});var o=i(1),n=i(17),r=i(15),a=i(19),s=i(0),l=i(21),c=i(22),d=i(51),p=i(58),u={ADD:"project:add",CHANGE:"project:change",DELETE:"project:delete"},h={ADD:"file:add",CHANGE:"file:change",DELETE:"file:delete"},f={ADD:"version:add",CHANGE:"version:change",DELETE:"version:delete"};function m(){o.a.call(this),this.projectTree=new c.a();}Object(s.a)(m,o.a),m.prototype.initProject=function(t){var e=this;return this.fetchFiles(t.getProjectId()).then(function(t){return Promise.all(_.map(t,e.initFile.bind(e)));});},m.prototype.initFile=function(t){return this.fetchVersions(t.getProjectId(),t.getFileId());},m.prototype._getResourceDiff=function(t,e){var i=_.compact(_.flatten(t)),o=new l.a(),n=[];return Object(d.a)(i,function(t){o.set(t.getHashCode(),t);}),Object(d.a)(e,function(t){var e=t.getHashCode();o.has(e)?(o.get(e).equals(t)||n.push({type:"change",data:t}),o.remove(e)):n.push({type:"add",data:t});}),Object(d.a)(o.toArray(),function(t){n.push({type:"delete",data:t});}),n;},m.prototype._syncProject=function(t){var e=this;Object(d.a)(t,function(t){var i=t.data;"add"==t.type&&e._addProject(i),"change"==t.type&&e._updateProject(i),"delete"==t.type&&e._deleteProject(i.getProjectId());});},m.prototype._syncFile=function(t){var e=this;Object(d.a)(t,function(t){var i=t.data;"add"==t.type&&e._addFile(i.getProjectId(),i),"change"==t.type&&e._updateFile(i.getProjectId(),i),"delete"==t.type&&e._deleteProject(i.getProjectId(),i.getFileId());});},m.prototype._syncVersion=function(t){var e=this;Object(d.a)(t,function(t){var i=t.data,o=e.projectTree.getProjectNodeByFileId(i.getFileId()).getData().getProjectId();"add"==t.type&&e._addVersion(o,i.getFileId(),i),"change"==t.type&&e._updateVersion(o,i.getFileId(),i);});},m.prototype._updateProject=function(t){this.projectTree.updateProject(t),this.emit(u.CHANGE,t);},m.prototype._addProject=function(t){this.projectTree.addProject(t),this.emit(u.ADD,t);},m.prototype._deleteProject=function(t){var e=this.projectTree.deleteProject(t);return this.emit(u.DELETE,e),e;},m.prototype._updateFile=function(t,e){return this.projectTree.updateFile(t,e),this.emit(h.CHANGE,e),e;},m.prototype._addFile=function(t,e){return this.projectTree.addFile(t,e),this.emit(h.ADD,e),e;},m.prototype._deleteFile=function(t,e){var i=this.projectTree.deleteFile(t,e);return this.emit(h.DELETE,i),i;},m.prototype._updateVersion=function(t,e,i){return this.projectTree.updateVersion(t,e,i),this.emit(f.CHANGE,i),i;},m.prototype._addVersion=function(t,e,i){return this.projectTree.addVersion(t,e,i),this.emit(f.ADD,i),i;},m.prototype._deleteVersion=function(t,e,i){var o=this.projectTree.addVersion(t,e,i);return this.emit(f.DELETE,o),o;},m.prototype.fetchProject=function(t){var e=this;return n.a.getProject(t).then(function(i){var o=e.projectTree.getProject(t);return e._syncProject(e._getResourceDiff([o],[i])),i;}).catch(function(t){throw console.error(t),new Error("failed to fetch project");});},m.prototype.fetchProjects=function(){var t=this;return n.a.getProjects().then(function(e){var i=t.projectTree.getProjects();return t._syncProject(t._getResourceDiff([i],e)),e;}).catch(function(t){throw new Error("failed to fetch projects");});},m.prototype.fetchFiles=function(t){var e=this;return r.a.getFiles(t).then(function(i){var o=e.projectTree.getFiles(t);return e._syncFile(e._getResourceDiff([o],i)),i;});},m.prototype.fetchFile=function(t,e){var i=this;return r.a.getFile(t,e).then(function(o){var n=i.projectTree.getFile(t,e);return i._syncFile(i._getResourceDiff([n],[o])),o;}).catch(function(t){throw new Error("filed to fetch file");});},m.prototype.fetchVersions=function(t,e){var i=this;return a.a.getVersions(t,e).then(function(t){var o=i.projectTree.getProjectNodeByFileId(e).getData().getProjectId(),n=i.projectTree.getVersions(o,e);return i._syncVersion(i._getResourceDiff([n],t)),t;}).catch(function(t){throw new Error("failed to fetch versions");});},m.prototype.fetchVersion=function(t,e,i){var o=this;return a.a.getVersion(t,e,i).then(function(n){var r=o.projectTree.getVersion(t,e,i);return o._syncVersion(o._getResourceDiff([r],[n])),n;}).catch(function(t){throw new Error("filed to fetch version");});},m.prototype.build=function(){var t=this;return this.fetchProjects().then(function(e){return Promise.all(_.map(e,t.initProject.bind(t)));});},m.prototype.getProjects=function(){return this.projectTree.getProjects();},m.prototype.getProject=function(t){return this.projectTree.getProject(t);},m.prototype.addProject=function(t){var e=this;return n.a.addProject(t).then(function(){return e._addProject(t),t;}).catch(function(t){throw console.error(t),t;});},m.prototype.updateProject=function(t){var e=this;return n.a.updateProject(t).then(function(){return e._updateProject(t),t;}).catch(function(t){throw console.error(t),t;});},m.prototype.deleteProject=function(t){var e=this;return n.a.deleteProject(t).then(function(){return e._deleteProject(t);}).catch(function(t){throw console.error(t),t;});},m.prototype.getFiles=function(t){return this.projectTree.getFiles(t);},m.prototype.getFilesByModelType=function(t,e){return _.filter(this.getFiles(t),function(t){return t.getContents().type==e;});},m.prototype.getFile=function(t,e){return this.projectTree.getFile(t,e);},m.prototype.addFile=function(t,e){var i=this;return r.a.addFile(t,e).then(function(){return i._addFile(t,e),e;}).catch(function(t){throw console.error(t),t;});},m.prototype.updateFile=function(t,e){var i=this;return this.lastQuery=this.lastQuery||Promise.resolve(),this.lastQuery=this.lastQuery.then(function(){return new Promise(function(o,n){r.a.updateFileSync(t,e).then(function(n){e.setEventKey(n.getEventKey()),e.setUpdateTime(n.getUpdateTime()),i._updateFile(t,e),o([null,e]);}).catch(function(t){console.error(t),o([t,e]);});});}),this.lastQuery;},m.prototype.saveFile=function(t,e,i){var _this=this;return this.lastQuery=this.lastQuery||Promise.resolve(),this.lastQuery=this.lastQuery.then(function(){return r.a.saveFileSync(t,e,i).then(function(i){if(i){var _o=i.event_key,_n=i.update_time;return e.setEventKey(_o),e.setUpdateTime(_n),_this._updateFile(t,e),e;}return new Promise(function(i){r.a.updateFileSync(t,e).then(function(o){e.setEventKey(o.getEventKey()),e.setUpdateTime(o.getUpdateTime()),_this._updateFile(t,e),i([null,e]);}).catch(function(t){console.error(t),i([t,e]);});});}).catch(function(t){throw console.error(t),t;});}),this.lastQuery;},m.prototype.deleteFile=function(t,e){var i=this;return r.a.deleteFile(t,e).then(function(){return i._deleteFile(t,e);}).catch(function(t){throw console.error(t),t;});},m.prototype.getVersions=function(t,e){return this.projectTree.getVersions(t,e);},m.prototype.getVersion=function(t,e,i){return this.projectTree.getVersion(t,e,i);},m.prototype.addVersion=function(t,e,i){var o=this;return a.a.addVersion(t,e,i).then(function(i){return o._addVersion(t,e,i),i;}).catch(function(t){throw console.error(t),t;});},m.prototype.updateVersion=function(t,e,i){var o=this;return a.a.updateVersion(t,e,i).then(function(){return o._updateVersion(t,e,i),i;}).catch(function(t){throw console.error(t),t;});},m.prototype.loadVersion=function(t,e,i){var o=this;return a.a.loadVersion(t,e,i).then(function(e){return o._updateFile(t,e),e;}).catch(function(t){throw console.error(t),t;});},m.prototype.validateFile=function(t,e){return p.a.validate(t,e);};var g=new m();},function(t,e,i){"use strict";i.d(e,"a",function(){return d;});var o=i(1),n=i(0);var r="table",a="model",s="image",l={"1.0":{in:{data:"inData"},out:{data:"outData"}},3.5:{in:{data:"inData"},out:{data:"outData"}},3.6:{in:{data:"inputs"},out:{data:"outputs"}}};function c(){o.a.call(this);}Object(n.a)(c,o.a),c.prototype.getMeta=function(t){return t.meta?t.meta:void 0;},c.prototype.getVersion=function(t){return t.version?t.version:"1.0";},c.prototype._getVersionPath=function(t){var e=this.getVersion(t);return l[e];},c.prototype._getPath=function(t,e,i){var o=this._getVersionPath(t);return Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(o,[e,i]);},c.prototype.getInputs=function(t){var e=this._getPath(t,"in","data");return Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(t,e);},c.prototype.getOutputs=function(t){var e=this._getPath(t,"out","data");return Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(t,e);},c.prototype.getInputsToObject=function(t){if(!t)return{};var e={},i=this.getInputs(t);if(this.hasMeta(t))for(var o in i){e[i[o]]=o;}else{var n=this.getLabel(t);for(var r in i){e[i[r]]="["+r+"]"+n;}}return e;},c.prototype.getOutputsToObject=function(t){if(!t)return{};var e={},i=this.getOutputs(t);if(this.hasMeta(t))for(var o in i){if(Array.isArray(i[o]))for(var n in i[o]){e[i[o][n]]=o;}else e[i[o]]=o;}else{var r=this.getLabel(t);for(var n in i){e[i[n]]="["+n+"]"+r;}}return e;},c.prototype.getInData=function(t,e){var i=[],o=this.getMeta(t),n=this.getInputs(t);if(o)for(var a in n){n[a]&&(e?o[a].type===e&&(i=i.concat(n[a])):i=i.concat(n[a]));}else e?e===r&&(i=n):i=n;return i;},c.prototype.getOutData=function(t,e){var i=[],o=this.getMeta(t),n=this.getOutputs(t);if(o)for(var a in n){n[a]&&(e?o[a].type===e&&(i=i.concat(n[a])):i=i.concat(n[a]));}else e?e===r&&(i=n):i=n;return i;},c.prototype._getData=function(t){var e=function e(t){return _.isUndefined(t)?[]:_.isString(t)?[t]:_.isArray(t)?t.map(function(t){return e(t);}):Object.values(t).map(function(t){return e(t);});};return _.compact(_.flattenDeep([e(t.inputs||[]),e(t.outputs||[])]));},c.prototype.getAllData=function(t){return _.union(this.getInData(t),this.getOutData(t),this._getData(t));},c.prototype.getData=function(t,e){return"in"===e?this.getInData(t):this.getOutData(t);},c.prototype.getInputTypes=function(t){var e=this.getMeta(t);if(!e)return[r];var i=[],o=this.getInputs(t);for(var n in o){i.indexOf(e[n].type)<0&&i.push(e[n].type);}return i;},c.prototype.getOutputTypes=function(t){var e=this.getMeta(t);if(!e)return[r];var i=[],o=this.getOutputs(t);for(var n in o){i.indexOf(e[n].type)<0&&i.push(e[n].type);}return i;},c.prototype.getTypes=function(t,e){return"in"===e?this.getInputTypes(t):this.getOutputTypes(t);},c.prototype.getKeyByTableId=function(t,e){if(!t)return"";if(!this.getMeta(t))return"";var i=_.assign({},this.getInputs(t),this.getOutputs(t));for(var o in i){if(i[o].indexOf(e)>-1)return o;}},c.prototype.getTypeByTableId=function(t,e){if(!t)return"";var i=this.getMeta(t);if(!i)return r;var o=_.assign({},this.getInputs(t),this.getOutputs(t));for(var n in o){if(o[n].indexOf(e)>-1)return i[n].type;}return"";},c.prototype.getTypeByKey=function(t,e){if(!t)return"";var i=this.getMeta(t);return i?i[e].type:r;},c.prototype.getInTable=function(t){var e=[],i=this.getMeta(t);if(i){var o=this.getInputs(t);for(var n in o){o[n]&&i[n].type===r&&o[n]&&(e=e.concat(o[n]));}}else e=t[IN_DATA];return e;},c.prototype.getInTableByKeys=function(t,e){var i=[],o=this.getMeta(t);if(o){var n,a=this.getInputs(t);for(var _t=0;_t<e.length;_t++){a[n=e[_t]]&&o[n].type===r&&a[n]&&(i=i.concat(a[n]));}}return i;},c.prototype.getOutTable=function(t){var e=[],i=this.getMeta(t);if(i){var o=this.getOutputs(t);for(var n in o){o[n]&&i[n].type===r&&o[n]&&(e=e.concat(o[n]));}}else e=t[OUT_DATA];return e;},c.prototype.getInModel=function(t){var e=[],i=this.getMeta(t);if(i){var o=this.getInputs(t);for(var n in o){o[n]&&i[n].type===a&&o[n]&&(e=e.concat(o[n]));}}else;return e;},c.prototype.getOutModel=function(t){var e=[],i=this.getMeta(t);if(i){var o=this.getOutputs(t);for(var n in o){o[n]&&i[n].type===a&&o[n]&&(e=e.concat(o[n]));}}else;return e;},c.prototype.getInImage=function(t){var e=[],i=this.getMeta(t);if(i){var o=this.getInputs(t);for(var n in o){o[n]&&i[n].type===s&&o[n]&&(e=e.concat(o[n]));}}else;return e;},c.prototype.getOutImage=function(t){var e=[],i=this.getMeta(t);if(i){var o=this.getOutputs(t);for(var n in o){o[n]&&i[n].type===s&&o[n]&&(e=e.concat(o[n]));}}else;return e;},c.prototype.getPreviousFnUnits=function(t){var e=this,i=[],o=this.getParent(t),n=o.getPrevious(t.fid);return _.forEach(n,function(t){var n=o.getFnUnitById(t),r=e.isProcessFunction(n)?o.getAllPreviousFnUnits(n.fid):[n];i=_.union(i,r);}),i;},c.prototype.getLinkedTable=function(t){var e=this,i=[],o=this.getPreviousFnUnits(t);return _.forEach(o,function(t){i=i.concat(e.getOutTable(t));}),i;},c.prototype.getTable=function(t,e){return"in"===e?this.getInTable(t):this.getOutTable(t);},c.prototype.getModel=function(t,e){return"in"===e?this.getInModel(t):this.getOutModel(t);},c.prototype.getImage=function(t,e){return"in"===e?this.getInImage(t):this.getOutImage(t);},c.prototype.hasMeta=function(t){return!!t.meta;},c.prototype.hasInput=function(t){var e=this._getPath(t,"in","data");return!!Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(t,e);},c.prototype.hasOutput=function(t){var e=this._getPath(t,"out","data");return!!Brightics.VA.Core.Utils.CommonUtils.getObjByJsonPath(t,e);},c.prototype.getInRange=function(t){var e={},i=this.getMeta(t);if(i){var o=this.getInputs(t);for(var n in o){var a=i[n].type;e[a]||(e[a]={min:0,max:0}),i[n].range?(e[a].min+=i[n].range.min,e[a].max+=i[n].range.max):(e[a].min+=1,e[a].max+=1);}}else{var s=Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",t.func);e[r]=s["in-range"];}return e;},c.prototype.getOutRange=function(t){var e={},i=this.getMeta(t);if(i){var o=this.getOutputs(t);for(var n in o){var a=i[n].type;e[a]||(e[a]={min:1,max:1}),i[n].range&&(e[a].min=i[n].range.min,e[a].max=i[n].range.max);}}else{var s=Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",t.func);e[r]=s["out-range"];}return e;},c.prototype.getTotalInRangeCount=function(t){var e={min:0,max:0},i=this.getInRange(t);for(var o in i){e.min+=i[o].min,e.max+=i[o].max;}return e;},c.prototype.getTotalOutRangeCount=function(t){var e={min:0,max:0},i=this.getOutRange(t);for(var o in i){e.min+=i[o].min,e.max+=i[o].max;}return e;},c.prototype.getKeyByType=function(t,e,i){var o=this.getMeta(t);if(o){var n="in"===i?this.getInputs(t):this.getOutputs(t);for(var r in n){if(o[r].type===e)return r;}}},c.prototype.isProcessFunction=function(t){return["SetValue","ImportData","ExportData"].indexOf(t[FUNCTION_NAME])>=0;},c.prototype.isSkip=function(t){return t.skip&&_.isEqual(t.skip,!0);},c.prototype.getDefinition=function(t,e){return Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary(t,e);},c.prototype.isExist=function(t,e){var i=this.getOutData(t),o=this.getInData(e);return _.forEach(i,function(t){_.forEach(o,function(e){if(t===e)return!0;});}),!1;},c.prototype.isConnectable=function(t,e){var i=this.getDefinition("data",t.func),o=this.getDefinition("data",e.func);if(i["connectable-functions"]){if(i["connectable-functions"].indexOf(e.func)<0)return!1;}else if(o["acceptable-functions"]&&o["acceptable-functions"].indexOf(t.func)<0)return!1;var n=this.getOutputTypes(t),r=this.getInputTypes(e),a=0;for(var s in n){var l=n[s];r.indexOf(l)>-1&&a++;}if(0===a)return!1;var c=this.getInRange(e),d=0;for(var p in c){var u=c[p].max;this.getInData(e,p).length<u&&d++;}return 0!==d;},c.prototype.connect=function(t,e){var i=this.getOutData(t),o=this.getInputTypes(e),n={table:[],model:[],image:[]};for(var r in i){var a=i[r];n[s=this.getTypeByTableId(t,a)].push(a);}for(var s in n){0!==n[s].length&&o.indexOf(s)>-1&&this.addInData(e,s,n[s]);}},c.prototype.disconnect=function(t,e){var i=this.getOutData(t),o={table:[],model:[],image:[]};for(var n in i){var r=i[n];o[a=this.getTypeByTableId(t,r)].push(r);}for(var a in o){0!==o[a].length&&this.removeInData(e,a,o[a]);}},c.prototype.addInData=function(t,e,i){var o=this;if(0!==i.length)if(e===r){if(this.getMeta(t)){var n=this.getInputs(t);_.forEach(n,function(n,r){_.isArray(n)&&_.isEqual(e,o.getTypeByKey(t,r))?t.inputs[r]=_.union([],n,i):_.isEmpty(n)&&_.isEqual(e,o.getTypeByKey(t,r))&&_.isEmpty(o.getKeyByTableId(t,i[0]))&&(t.inputs[r]=i[0]);});}else t[IN_DATA].push(i[0]);}else if("model"===e){n=this.getInputs(t);_.forEach(n,function(n,r){_.isArray(n)&&_.isEqual(e,o.getTypeByKey(t,r))?t.inputs[r]=_.union([],n,i):_.isEmpty(n)&&_.isEqual(e,o.getTypeByKey(t,r))&&_.isEmpty(o.getKeyByTableId(t,i[0]))&&(t.inputs[r]=i[0]);});}else if("image"===e){n=this.getInputs(t);_.forEach(n,function(n,r){_.isArray(n)&&_.isEqual(e,o.getTypeByKey(t,r))?t.inputs[r]=_.union([],n,i):_.isEmpty(n)&&_.isEqual(e,o.getTypeByKey(t,r))&&_.isEmpty(o.getKeyByTableId(t,i[0]))&&(t.inputs[r]=i[0]);});}},c.prototype.removeInData=function(t,e,i){if(0!==i.length){i=Array.isArray(i)?i:[i];this.getMeta(t)?_.forEach(this.getInputs(t),function(e,o){_.forEach(i,function(i){_.isArray(e)&&_.indexOf(e,i)>-1?(_.remove(e,function(t){return t==i;}),t.inputs[o]=e):_.isEqual(e,i)&&(t.inputs[o]="");});}):Brightics.VA.Core.Utils.CommonUtils.removeArrayElement(t[IN_DATA],i);}},c.prototype.createOutData=function(t,e){var i=this.getDefinition("data",e),o=$.extend(!0,{},i.defaultFnUnit),n={};if(o.meta)for(var r in n.outputs=o.outputs,n.outputs){Array.isArray(n.outputs[r])?n.outputs[r].push(Brightics.VA.Core.Utils.IDGenerator.table.id()):n.outputs[r]=Brightics.VA.Core.Utils.IDGenerator.table.id();}else{n[OUT_DATA]=o[OUT_DATA];for(var a=i["out-range"],s=0;s<a.min;s++){n[OUT_DATA].push(Brightics.VA.Core.Utils.IDGenerator.table.id());}}return n;},c.prototype.wrapInputs=function(t){return Array.isArray(t)?{inData:t}:{inputs:t};},c.prototype.clearInData=function(t){if(this.hasInput(t))if(this.getMeta(t))for(var e in t.inputs){var i=Array.isArray(t.inputs[e])?[]:"";t.inputs[e]=i;}else t[IN_DATA]=[];},c.prototype.isArray=function(t){return Array.isArray(t);},c.prototype.getFunc=function(t){return t?t.func:"";},c.prototype.getName=function(t){return t?t.name:"";},c.prototype.getLabel=function(t){return t?t.display.label:"";},c.prototype.getId=function(t){return t?t.fid:"";},c.prototype.getParam=function(t){return t?t.param:{};},c.prototype.getKeyLabel=function(t,e){var i=this.getMeta(t);return _.isEmpty(i)?"":i[e].label?i[e].label:e;},c.prototype.getCategory=function(t){return this.getDefinition("data",t.func).category;},c.prototype.getContext=function(t){return t.context||"scala";},c.prototype.isFlexibleFunction=function(t){return"control"===this.getCategory(t)||"script"===this.getCategory(t)||"rowAppend"===this.getFunc(t);},c.prototype.inputChangable=function(t){return"script"!==this.getCategory(t)&&"rowAppend"!==this.getFunc(t);},c.prototype.getDataPanel=function(t,e){var i=Brightics.VA.Core.Editors.Sheet.Panels.DataPanel;if("out"===e){var o=this.getFunc(t);i=Brightics.VA.Implementation.DataFlow.Functions[o]&&Brightics.VA.Implementation.DataFlow.Functions[o].DataPanel||i;}return i;},c.prototype.getParent=function(t){return"function"==typeof t.parent?t.parent():Studio.getEditorContainer().getActiveModelEditor().getActiveModel();},c.prototype.hasTable=function(t){return this.getTypes(t).indexOf(r)>-1;},c.prototype.changeData=function(t,e,i){if(this.hasMeta(t)){var o=this.getInputs(t),n=this.getOutputs(t);_.forEach(o,function(o,n){_.isEqual(o,e)&&(t.inputs[n]=i);}),_.forEach(n,function(o,n){_.isEqual(o,e)&&(t.outputs[n]=i);});var r=function r(t){return _.isString(t)?_.isEqual(t,e)?i:t:_.isArray(t)?t.map(function(t){return r(t);}):_.isObject(t)?_.zipObject(Object.entries(t).map(function(t){var e=t[0],i=t[1];return[e,r(i)];})):void 0;};t.inputs&&(t.inputs=r(t.inputs)),t.outputs&&(t.outputs=r(t.outputs));}else _.forEach(t.inData,function(o,n){_.isEqual(o,e)&&(t.inData[n]=i);}),_.forEach(t.outData,function(o,n){_.isEqual(o,e)&&(t.outData[n]=i);});},c.prototype.isDustNode=function(t){return["brightics"].indexOf(this.getCategory(t))>-1;},c.prototype.isBluffNode=function(t){return!(t.inData||t.outData||t.inputs||t.outputs);},c.prototype.isInputtable=function(t){return this.getTotalInRangeCount(t).min>0||this.isBluffNode(t);},c.prototype.isOutputtable=function(t){return!Brightics.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",t.func)["out-node"];},c.prototype.isSkippable=function(t){return this.isBluffNode(t)||this.isProcessFunction(t);},c.prototype.isAvailable=function(t){var e=this.getFunc(t);return!_.isUndefined(Brightics.VA.Core.Interface.Functions.data[e]);};var d=new c();},function(t,e,i){"use strict";var o=function o(t){for(var e,i=t||16,o="",n=0;n<i;n++){o+=(e="23456789abcdefghjkmnpqrstuvwxyz").charAt(Math.floor(Math.random()*e.length));}return o;},n={project:{id:function id(){return"p"+o(15);}},model:{id:function id(){return"m"+o(15);}},control:{id:function id(){return"c"+o(15);}},func:{id:function id(){return"f"+o(15);}},table:{id:function id(){return"t"+o(15);}},link:{id:function id(){return"k"+o(15);}},template:{id:function id(){return"t"+o(15);}},notice:{id:function id(){return"n"+o(15);}},send:{id:function id(){return"s"+o(39);}},report:{id:function id(t){return"r"+o(t||8);}},schedule:{id:function id(){return"j"+o(15);}},file:{id:function id(){return"f"+o(8);}},reportPage:{id:function id(){return"rp"+o(14);}},reportContent:{id:function id(){return"rc"+o(14);}},dataSource:{id:function id(){return"ds"+o(14);}},udf:{id:function id(t){return"udf_"+t+"_"+o(8);}},uuid:{id:function id(t){return o(t);}},importedFile:{id:function id(t){return"importedFile_"+o(8);}},version:{id:function id(t){return"v"+o(t||15);}}};t.exports=n;},function(t,e,i){"use strict";i.d(e,"a",function(){return n;});var o=i(3);function n(t,e){this.project={},this.children=[],t&&(this.project=t),e&&e instanceof Array&&(this.children=this.children.concat(e));}n.prototype.toJSON=function(){return{type:"project",data:this.project.toJSON(),children:_.map(this.children,function(t){return{type:t.getResourceName(),data:t.toJSON()};}),version:this.getCoreVersion()};},n.prototype.setProject=function(t){return this.project=t,this;},n.prototype.addFile=function(t){return this.children.add(t),this;},n.prototype.addFiles=function(t){return this.children=this.children.concat(t),this;},n.prototype.getProject=function(){return this.project;},n.prototype.getFiles=function(){return this.children;},n.prototype.getCoreVersion=function(){return o.CORE_VERSION;};},function(t,e,i){"use strict";i.d(e,"a",function(){return n;});var o=i(3);function n(t){this.data=[],t&&(t instanceof Array?this.data=this.data.concat(t):this.data.push(t));}n.prototype.toJSON=function(){return{type:"files",data:_.map(this.data,function(t){return{type:t.getResourceName(),data:t.toJSON(!0)};}),version:this.getCoreVersion()};},n.prototype.addFile=function(t){return this.data.push(t),this;},n.prototype.addFiles=function(t){return this.data=this.data.concat(t),this;},n.prototype.getFiles=function(){return this.data;},n.prototype.getCoreVersion=function(){return o.CORE_VERSION;};},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(30),n=i(48),r=i(21),a=i(24),s=i(25),l=i(59),c=i(60),d=i(61),p=i(1),u=i(10),h=i(0),f=i(26),m=i.n(f),g=i(63),v=i(9),b=i(66),y=i(67),C=i.n(y),x=i(68),A=i(69),$=i(70),w=i(3);window.__module__=window.__module__||{},window.brtc_require=function(t){return window.__module__[t];};var D=function D(t,e){window.__module__[t]=window.__module__[t]||{},window.__module__[t]=e;};D("DataStructures",{HashMap:r.a,ProjectTree:r.b,TreeNode:r.c}),D("Dao",{ProjectDao:n.c,FileDao:n.b,VersionDao:n.d,DatasourceDao:n.a}),D("Controls",o.a),D("ResourceManager",a.a),D("FnUnitUtils",s.a),D("FnUnitInputs",l.a),D("StatusBoard",d.a),D("KeyItems",c.a),D("Vo",{Project:u.c,File:u.a,Version:u.d,PROP_KEY:u.b}),_.forIn(u.b,function(t,e){window[e]=t;}),D("EventEmitter",p.a),D("ClassUtils",{inherits:h.a}),D("IDGenerator",m.a),D("ResourceService",g.a),D("PromiseUtils",{serial:v.b,parallel:v.a}),D("ObjectUtils",{get:b.b,updateProp:b.d,addProp:b.a,removeProp:b.c}),D("_",_),window.crel=C.a,D("crel",C.a),D("TabChannel",x.a),D("DATA_TYPES",A.a),D("modelDiff",$.a),D("ENV",w);},function(t,e,i){"use strict";i.d(e,"a",function(){return c;});var o=i(11),n=i(12),r=i(13),a=i(14),s=i(4),l=i(47),c={Wrapper:{ListWrapper:o.a,JqxListWrapper:n.a,DropdownWrapper:r.a,JqxDropdownWrapper:a.a},Base:s.a,ControlFactory:l.a};},function(t,e,i){"use strict";var o,n,r,a,s,l,c,d=i(32),p=i(46),u=Function.prototype.apply,h=Function.prototype.call,f=Object.create,m=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,b={configurable:!0,enumerable:!1,writable:!0};n=function n(t,e){var _i,n;return p(e),n=this,o.call(this,t,_i=function i(){r.call(n,t,_i),u.call(e,this,arguments);}),_i.__eeOnceListener__=e,this;},s={on:o=function o(t,e){var i;return p(e),v.call(this,"__ee__")?i=this.__ee__:(i=b.value=f(null),m(this,"__ee__",b),b.value=null),i[t]?"object"==typeof i[t]?i[t].push(e):i[t]=[i[t],e]:i[t]=e,this;},once:n,off:r=function r(t,e){var i,o,n,r;if(p(e),!v.call(this,"__ee__"))return this;if(!(i=this.__ee__)[t])return this;if("object"==typeof(o=i[t]))for(r=0;n=o[r];++r){n!==e&&n.__eeOnceListener__!==e||(2===o.length?i[t]=o[r?0:1]:o.splice(r,1));}else o!==e&&o.__eeOnceListener__!==e||delete i[t];return this;},emit:a=function a(t){var e,i,o,n,r;if(v.call(this,"__ee__")&&(n=this.__ee__[t]))if("object"==typeof n){for(i=arguments.length,r=new Array(i-1),e=1;e<i;++e){r[e-1]=arguments[e];}for(n=n.slice(),e=0;o=n[e];++e){u.call(o,this,r);}}else switch(arguments.length){case 1:h.call(n,this);break;case 2:h.call(n,this,arguments[1]);break;case 3:h.call(n,this,arguments[1],arguments[2]);break;default:for(i=arguments.length,r=new Array(i-1),e=1;e<i;++e){r[e-1]=arguments[e];}u.call(n,this,r);}}},l={on:d(o),once:d(n),off:d(r),emit:d(a)},c=g({},l),t.exports=e=function e(t){return null==t?f(c):g(Object(t),l);},e.methods=s;},function(t,e,i){"use strict";var o=i(33),n=i(41),r=i(42),a=i(43);(t.exports=function(t,e){var i,r,s,l,c;return arguments.length<2||"string"!=typeof t?(l=e,e=t,t=null):l=arguments[2],null==t?(i=s=!0,r=!1):(i=a.call(t,"c"),r=a.call(t,"e"),s=a.call(t,"w")),c={value:e,configurable:i,enumerable:r,writable:s},l?o(n(l),c):c;}).gs=function(t,e,i){var s,l,c,d;return"string"!=typeof t?(c=i,i=e,e=t,t=null):c=arguments[3],null==e?e=void 0:r(e)?null==i?i=void 0:r(i)||(c=i,i=void 0):(c=e,e=i=void 0),null==t?(s=!0,l=!1):(s=a.call(t,"c"),l=a.call(t,"e")),d={get:e,set:i,configurable:s,enumerable:l},c?o(n(c),d):d;};},function(t,e,i){"use strict";t.exports=i(34)()?Object.assign:i(35);},function(t,e,i){"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy");};},function(t,e,i){"use strict";var o=i(36),n=i(40),r=Math.max;t.exports=function(t,e){var i,a,s,l=r(arguments.length,2);for(t=Object(n(t)),s=function s(o){try{t[o]=e[o];}catch(t){i||(i=t);}},a=1;a<l;++a){e=arguments[a],o(e).forEach(s);}if(void 0!==i)throw i;return t;};},function(t,e,i){"use strict";t.exports=i(37)()?Object.keys:i(38);},function(t,e,i){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0;}catch(t){return!1;}};},function(t,e,i){"use strict";var o=i(5),n=Object.keys;t.exports=function(t){return n(o(t)?Object(t):t);};},function(t,e,i){"use strict";t.exports=function(){};},function(t,e,i){"use strict";var o=i(5);t.exports=function(t){if(!o(t))throw new TypeError("Cannot use null or undefined");return t;};},function(t,e,i){"use strict";var o=i(5),n=Array.prototype.forEach,r=Object.create;t.exports=function(t){var e=r(null);return n.call(arguments,function(t){o(t)&&function(t,e){var i;for(i in t){e[i]=t[i];}}(Object(t),e);}),e;};},function(t,e,i){"use strict";t.exports=function(t){return"function"==typeof t;};},function(t,e,i){"use strict";t.exports=i(44)()?String.prototype.contains:i(45);},function(t,e,i){"use strict";var o="razdwatrzy";t.exports=function(){return"function"==typeof o.contains&&!0===o.contains("dwa")&&!1===o.contains("foo");};},function(t,e,i){"use strict";var o=String.prototype.indexOf;t.exports=function(t){return o.call(this,t,arguments[1])>-1;};},function(t,e,i){"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t;};},function(t,e,i){"use strict";i.d(e,"a",function(){return r;});var o=i(12),n=i(14),r={createListControl:function createListControl(t,e){return new o.a(t,e);},createDropdownControl:function createDropdownControl(t,e){return new n.a(t,e);}};},function(t,e,i){"use strict";var o=i(15),n=i(17),r=i(19),a=i(50);i.d(e,"b",function(){return o.a;}),i.d(e,"c",function(){return n.a;}),i.d(e,"d",function(){return r.a;}),i.d(e,"a",function(){return a.a;});},function(t,e,i){var o,n;n=function n(){return function t(e,i,n){function r(s,l){if(!i[s]){if(!e[s]){if(!l&&"function"==typeof o&&o)return o(s,!0);if(a)return a(s,!0);throw new Error("Cannot find module '"+s+"'");}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return r(i||t);},c,c.exports,t,e,i,n);}return i[s].exports;}for(var a="function"==typeof o&&o,s=0;s<n.length;s++){r(n[s]);}return r;}({1:[function(t,e,i){(function(o,n,r,a,s,l,c,d,p){"use strict";function u(t,e){return function(t,e){var i;if(void 0===(i="passthrough"!==e.algorithm?v.createHash(e.algorithm):new g()).write&&(i.write=i.update,i.end=i.update),m(e,i).dispatch(t),i.update||i.end(""),i.digest)return i.digest("buffer"===e.encoding?void 0:e.encoding);var o=i.read();return"buffer"===e.encoding?o:o.toString(e.encoding);}(t,e=h(t,e));}function h(t,e){if((e=e||{}).algorithm=e.algorithm||"sha1",e.encoding=e.encoding||"hex",e.excludeValues=!!e.excludeValues,e.algorithm=e.algorithm.toLowerCase(),e.encoding=e.encoding.toLowerCase(),e.ignoreUnknown=!0===e.ignoreUnknown,e.respectType=!1!==e.respectType,e.respectFunctionNames=!1!==e.respectFunctionNames,e.respectFunctionProperties=!1!==e.respectFunctionProperties,e.unorderedArrays=!0===e.unorderedArrays,e.unorderedSets=!1!==e.unorderedSets,e.unorderedObjects=!1!==e.unorderedObjects,e.replacer=e.replacer||void 0,e.excludeKeys=e.excludeKeys||void 0,void 0===t)throw new Error("Object argument required.");for(var i=0;i<b.length;++i){b[i].toLowerCase()===e.algorithm.toLowerCase()&&(e.algorithm=b[i]);}if(-1===b.indexOf(e.algorithm))throw new Error('Algorithm "'+e.algorithm+'"  not supported. supported values: '+b.join(", "));if(-1===y.indexOf(e.encoding)&&"passthrough"!==e.algorithm)throw new Error('Encoding "'+e.encoding+'"  not supported. supported values: '+y.join(", "));return e;}function f(t){if("function"!=typeof t)return!1;return null!=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(t));}function m(t,e,i){i=i||[];var o=function o(t){return e.update?e.update(t,"utf8"):e.write(t,"utf8");};return{dispatch:function dispatch(e){t.replacer&&(e=t.replacer(e));var i=typeof e;return null===e&&(i="null"),this["_"+i](e);},_object:function _object(e){var n=Object.prototype.toString.call(e),a=/\[object (.*)\]/i.exec(n);a=(a=a?a[1]:"unknown:["+n+"]").toLowerCase();var s;if((s=i.indexOf(e))>=0)return this.dispatch("[CIRCULAR:"+s+"]");if(i.push(e),void 0!==r&&r.isBuffer&&r.isBuffer(e))return o("buffer:"),o(e);if("object"===a||"function"===a){var l=Object.keys(e);t.unorderedObjects&&(l=l.sort()),!1===t.respectType||f(e)||l.splice(0,0,"prototype","__proto__","constructor"),t.excludeKeys&&(l=l.filter(function(e){return!t.excludeKeys(e);})),o("object:"+l.length+":");var c=this;return l.forEach(function(i){c.dispatch(i),o(":"),t.excludeValues||c.dispatch(e[i]),o(",");});}if(!this["_"+a]){if(t.ignoreUnknown)return o("["+a+"]");throw new Error('Unknown object type "'+a+'"');}this["_"+a](e);},_array:function _array(e,n){n=void 0!==n?n:!1!==t.unorderedArrays;var r=this;if(o("array:"+e.length+":"),!n||e.length<=1)return e.forEach(function(t){return r.dispatch(t);});var a=[],s=e.map(function(e){var o=new g(),n=i.slice();return m(t,o,n).dispatch(e),a=a.concat(n.slice(i.length)),o.read().toString();});return i=i.concat(a),s.sort(),this._array(s,!1);},_date:function _date(t){return o("date:"+t.toJSON());},_symbol:function _symbol(t){return o("symbol:"+t.toString());},_error:function _error(t){return o("error:"+t.toString());},_boolean:function _boolean(t){return o("bool:"+t.toString());},_string:function _string(t){o("string:"+t.length+":"),o(t.toString());},_function:function _function(e){o("fn:"),f(e)?this.dispatch("[native]"):this.dispatch(e.toString()),!1!==t.respectFunctionNames&&this.dispatch("function-name:"+String(e.name)),t.respectFunctionProperties&&this._object(e);},_number:function _number(t){return o("number:"+t.toString());},_xml:function _xml(t){return o("xml:"+t.toString());},_null:function _null(){return o("Null");},_undefined:function _undefined(){return o("Undefined");},_regexp:function _regexp(t){return o("regex:"+t.toString());},_uint8array:function _uint8array(t){return o("uint8array:"),this.dispatch(Array.prototype.slice.call(t));},_uint8clampedarray:function _uint8clampedarray(t){return o("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(t));},_int8array:function _int8array(t){return o("uint8array:"),this.dispatch(Array.prototype.slice.call(t));},_uint16array:function _uint16array(t){return o("uint16array:"),this.dispatch(Array.prototype.slice.call(t));},_int16array:function _int16array(t){return o("uint16array:"),this.dispatch(Array.prototype.slice.call(t));},_uint32array:function _uint32array(t){return o("uint32array:"),this.dispatch(Array.prototype.slice.call(t));},_int32array:function _int32array(t){return o("uint32array:"),this.dispatch(Array.prototype.slice.call(t));},_float32array:function _float32array(t){return o("float32array:"),this.dispatch(Array.prototype.slice.call(t));},_float64array:function _float64array(t){return o("float64array:"),this.dispatch(Array.prototype.slice.call(t));},_arraybuffer:function _arraybuffer(t){return o("arraybuffer:"),this.dispatch(new Uint8Array(t));},_url:function _url(t){return o("url:"+t.toString());},_map:function _map(e){o("map:");var i=Array.from(e);return this._array(i,!1!==t.unorderedSets);},_set:function _set(e){o("set:");var i=Array.from(e);return this._array(i,!1!==t.unorderedSets);},_blob:function _blob(){if(t.ignoreUnknown)return o("[blob]");throw Error('Hashing Blob objects is currently not supported\n(see https://github.com/puleos/object-hash/issues/26)\nUse "options.replacer" or "options.ignoreUnknown"\n');},_domwindow:function _domwindow(){return o("domwindow");},_process:function _process(){return o("process");},_timer:function _timer(){return o("timer");},_pipe:function _pipe(){return o("pipe");},_tcp:function _tcp(){return o("tcp");},_udp:function _udp(){return o("udp");},_tty:function _tty(){return o("tty");},_statwatcher:function _statwatcher(){return o("statwatcher");},_securecontext:function _securecontext(){return o("securecontext");},_connection:function _connection(){return o("connection");},_zlib:function _zlib(){return o("zlib");},_context:function _context(){return o("context");},_nodescript:function _nodescript(){return o("nodescript");},_httpparser:function _httpparser(){return o("httpparser");},_dataview:function _dataview(){return o("dataview");},_signal:function _signal(){return o("signal");},_fsevent:function _fsevent(){return o("fsevent");},_tlswrap:function _tlswrap(){return o("tlswrap");}};}function g(){return{buf:"",write:function write(t){this.buf+=t;},end:function end(t){this.buf+=t;},read:function read(){return this.buf;}};}var v=t("crypto");(i=e.exports=u).sha1=function(t){return u(t);},i.keys=function(t){return u(t,{excludeValues:!0,algorithm:"sha1",encoding:"hex"});},i.MD5=function(t){return u(t,{algorithm:"md5",encoding:"hex"});},i.keysMD5=function(t){return u(t,{algorithm:"md5",encoding:"hex",excludeValues:!0});};var b=v.getHashes?v.getHashes().slice():["sha1","md5"];b.push("passthrough");var y=["buffer","hex","binary","base64"];i.writeToStream=function(t,e,i){return void 0===i&&(i=e,e={}),m(e=h(t,e),i).dispatch(t);};}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_e8180ef5.js","/");},{buffer:3,crypto:5,lYpoI2:10}],2:[function(t,e,i){(function(t,e,o,n,r,a,s,l,c){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(t){"use strict";function e(t){var e=t.charCodeAt(0);return e===o||e===l?62:e===n||e===c?63:e<r?-1:e<r+10?e-r+26+26:e<s+26?e-s:e<a+26?e-a+26:void 0;}var i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="+".charCodeAt(0),n="/".charCodeAt(0),r="0".charCodeAt(0),a="a".charCodeAt(0),s="A".charCodeAt(0),l="-".charCodeAt(0),c="_".charCodeAt(0);t.toByteArray=function(t){function o(t){c[p++]=t;}var n,r,a,s,l,c;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var d=t.length;l="="===t.charAt(d-2)?2:"="===t.charAt(d-1)?1:0,c=new i(3*t.length/4-l),a=l>0?t.length-4:t.length;var p=0;for(n=0,r=0;n<a;n+=4,r+=3){o((16711680&(s=e(t.charAt(n))<<18|e(t.charAt(n+1))<<12|e(t.charAt(n+2))<<6|e(t.charAt(n+3))))>>16),o((65280&s)>>8),o(255&s);}return 2===l?o(255&(s=e(t.charAt(n))<<2|e(t.charAt(n+1))>>4)):1===l&&(o((s=e(t.charAt(n))<<10|e(t.charAt(n+1))<<4|e(t.charAt(n+2))>>2)>>8&255),o(255&s)),c;},t.fromByteArray=function(t){function e(t){return d.charAt(t);}function i(t){return e(t>>18&63)+e(t>>12&63)+e(t>>6&63)+e(63&t);}var o,n,r,a=t.length%3,s="";for(o=0,r=t.length-a;o<r;o+=3){s+=i(n=(t[o]<<16)+(t[o+1]<<8)+t[o+2]);}switch(a){case 1:s+=e((n=t[t.length-1])>>2),s+=e(n<<4&63),s+="==";break;case 2:s+=e((n=(t[t.length-2]<<8)+t[t.length-1])>>10),s+=e(n>>4&63),s+=e(n<<2&63),s+="=";}return s;};}(void 0===i?this.base64js={}:i);}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib");},{buffer:3,lYpoI2:10}],3:[function(t,e,i){(function(e,o,n,r,a,s,l,c,d){function n(t,e,i){if(!(this instanceof n))return new n(t,e,i);var o,r,a,s=typeof t;if("base64"===e&&"string"===s)for(t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"");}(t);t.length%4!=0;){t+="=";}if("number"===s)o=E(t);else if("string"===s)o=n.byteLength(t,e);else{if("object"!==s)throw new Error("First argument needs to be a number, array or string.");o=E(t.length);}if(n._useTypedArrays?r=n._augment(new Uint8Array(o)):((r=this).length=o,r._isBuffer=!0),n._useTypedArrays&&"number"==typeof t.byteLength)r._set(t);else if(function(t){return U(t)||n.isBuffer(t)||t&&"object"==typeof t&&"number"==typeof t.length;}(t))for(a=0;a<o;a++){n.isBuffer(t)?r[a]=t.readUInt8(a):r[a]=t[a];}else if("string"===s)r.write(t,0,e);else if("number"===s&&!n._useTypedArrays&&!i)for(a=0;a<o;a++){r[a]=0;}return r;}function p(t,e,i,o){i=Number(i)||0;var r=t.length-i;o?(o=Number(o))>r&&(o=r):o=r;var a=e.length;L(a%2==0,"Invalid hex string"),o>a/2&&(o=a/2);for(var s=0;s<o;s++){var l=parseInt(e.substr(2*s,2),16);L(!isNaN(l),"Invalid hex string"),t[i+s]=l;}return n._charsWritten=2*s,s;}function u(t,e,i,o){return n._charsWritten=M(k(e),t,i,o);}function h(t,e,i,o){return n._charsWritten=M(function(t){for(var e=[],i=0;i<t.length;i++){e.push(255&t.charCodeAt(i));}return e;}(e),t,i,o);}function f(t,e,i,o){return n._charsWritten=M(O(e),t,i,o);}function m(t,e,i,o){return n._charsWritten=M(function(t){for(var e,i,o,n=[],r=0;r<t.length;r++){e=t.charCodeAt(r),i=e>>8,o=e%256,n.push(o),n.push(i);}return n;}(e),t,i,o);}function g(t,e,i){var o="";i=Math.min(t.length,i);for(var n=e;n<i;n++){o+=String.fromCharCode(t[n]);}return o;}function v(t,e,i,o){o||(L("boolean"==typeof i,"missing or invalid endian"),L(null!=e,"missing offset"),L(e+1<t.length,"Trying to read beyond buffer length"));var n,r=t.length;if(!(e>=r))return i?(n=t[e],e+1<r&&(n|=t[e+1]<<8)):(n=t[e]<<8,e+1<r&&(n|=t[e+1])),n;}function b(t,e,i,o){o||(L("boolean"==typeof i,"missing or invalid endian"),L(null!=e,"missing offset"),L(e+3<t.length,"Trying to read beyond buffer length"));var n,r=t.length;if(!(e>=r))return i?(e+2<r&&(n=t[e+2]<<16),e+1<r&&(n|=t[e+1]<<8),n|=t[e],e+3<r&&(n+=t[e+3]<<24>>>0)):(e+1<r&&(n=t[e+1]<<16),e+2<r&&(n|=t[e+2]<<8),e+3<r&&(n|=t[e+3]),n+=t[e]<<24>>>0),n;}function y(t,e,i,o){if(o||(L("boolean"==typeof i,"missing or invalid endian"),L(null!=e,"missing offset"),L(e+1<t.length,"Trying to read beyond buffer length")),!(e>=t.length)){var n=v(t,e,i,!0);return 32768&n?-1*(65535-n+1):n;}}function C(t,e,i,o){if(o||(L("boolean"==typeof i,"missing or invalid endian"),L(null!=e,"missing offset"),L(e+3<t.length,"Trying to read beyond buffer length")),!(e>=t.length)){var n=b(t,e,i,!0);return 2147483648&n?-1*(4294967295-n+1):n;}}function x(t,e,i,o){return o||(L("boolean"==typeof i,"missing or invalid endian"),L(e+3<t.length,"Trying to read beyond buffer length")),N.read(t,e,i,23,4);}function A(t,e,i,o){return o||(L("boolean"==typeof i,"missing or invalid endian"),L(e+7<t.length,"Trying to read beyond buffer length")),N.read(t,e,i,52,8);}function $(t,e,i,o,n){n||(L(null!=e,"missing value"),L("boolean"==typeof o,"missing or invalid endian"),L(null!=i,"missing offset"),L(i+1<t.length,"trying to write beyond buffer length"),P(e,65535));var r=t.length;if(!(i>=r))for(var a=0,s=Math.min(r-i,2);a<s;a++){t[i+a]=(e&255<<8*(o?a:1-a))>>>8*(o?a:1-a);}}function w(t,e,i,o,n){n||(L(null!=e,"missing value"),L("boolean"==typeof o,"missing or invalid endian"),L(null!=i,"missing offset"),L(i+3<t.length,"trying to write beyond buffer length"),P(e,4294967295));var r=t.length;if(!(i>=r))for(var a=0,s=Math.min(r-i,4);a<s;a++){t[i+a]=e>>>8*(o?a:3-a)&255;}}function D(t,e,i,o,n){n||(L(null!=e,"missing value"),L("boolean"==typeof o,"missing or invalid endian"),L(null!=i,"missing offset"),L(i+1<t.length,"Trying to write beyond buffer length"),B(e,32767,-32768)),i>=t.length||$(t,e>=0?e:65535+e+1,i,o,n);}function I(t,e,i,o,n){n||(L(null!=e,"missing value"),L("boolean"==typeof o,"missing or invalid endian"),L(null!=i,"missing offset"),L(i+3<t.length,"Trying to write beyond buffer length"),B(e,2147483647,-2147483648)),i>=t.length||w(t,e>=0?e:4294967295+e+1,i,o,n);}function V(t,e,i,o,n){n||(L(null!=e,"missing value"),L("boolean"==typeof o,"missing or invalid endian"),L(null!=i,"missing offset"),L(i+3<t.length,"Trying to write beyond buffer length"),j(e,3.4028234663852886e38,-3.4028234663852886e38)),i>=t.length||N.write(t,e,i,o,23,4);}function T(t,e,i,o,n){n||(L(null!=e,"missing value"),L("boolean"==typeof o,"missing or invalid endian"),L(null!=i,"missing offset"),L(i+7<t.length,"Trying to write beyond buffer length"),j(e,1.7976931348623157e308,-1.7976931348623157e308)),i>=t.length||N.write(t,e,i,o,52,8);}function S(t,e,i){return"number"!=typeof t?i:(t=~~t)>=e?e:t>=0?t:(t+=e)>=0?t:0;}function E(t){return(t=~~Math.ceil(+t))<0?0:t;}function U(t){return(Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t);})(t);}function _(t){return t<16?"0"+t.toString(16):t.toString(16);}function k(t){for(var e=[],i=0;i<t.length;i++){var o=t.charCodeAt(i);if(o<=127)e.push(t.charCodeAt(i));else{var n=i;o>=55296&&o<=57343&&i++;for(var r=encodeURIComponent(t.slice(n,i+1)).substr(1).split("%"),a=0;a<r.length;a++){e.push(parseInt(r[a],16));}}}return e;}function O(t){return R.toByteArray(t);}function M(t,e,i,o){for(var n=0;n<o&&!(n+i>=e.length||n>=t.length);n++){e[n+i]=t[n];}return n;}function F(t){try{return decodeURIComponent(t);}catch(t){return String.fromCharCode(65533);}}function P(t,e){L("number"==typeof t,"cannot write a non-number as a number"),L(t>=0,"specified a negative value for writing an unsigned value"),L(t<=e,"value is larger than maximum value for type"),L(Math.floor(t)===t,"value has a fractional component");}function B(t,e,i){L("number"==typeof t,"cannot write a non-number as a number"),L(t<=e,"value larger than maximum allowed value"),L(t>=i,"value smaller than minimum allowed value"),L(Math.floor(t)===t,"value has a fractional component");}function j(t,e,i){L("number"==typeof t,"cannot write a non-number as a number"),L(t<=e,"value larger than maximum allowed value"),L(t>=i,"value smaller than minimum allowed value");}function L(t,e){if(!t)throw new Error(e||"Failed assertion");}var R=t("base64-js"),N=t("ieee754");i.Buffer=n,i.SlowBuffer=n,i.INSPECT_MAX_BYTES=50,n.poolSize=8192,n._useTypedArrays=function(){try{var t=new ArrayBuffer(0),e=new Uint8Array(t);return e.foo=function(){return 42;},42===e.foo()&&"function"==typeof e.subarray;}catch(t){return!1;}}(),n.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1;}},n.isBuffer=function(t){return!(null==t||!t._isBuffer);},n.byteLength=function(t,e){var i;switch(t+="",e||"utf8"){case"hex":i=t.length/2;break;case"utf8":case"utf-8":i=k(t).length;break;case"ascii":case"binary":case"raw":i=t.length;break;case"base64":i=O(t).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=2*t.length;break;default:throw new Error("Unknown encoding");}return i;},n.concat=function(t,e){if(L(U(t),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===t.length)return new n(0);if(1===t.length)return t[0];var i;if("number"!=typeof e)for(e=0,i=0;i<t.length;i++){e+=t[i].length;}var o=new n(e),r=0;for(i=0;i<t.length;i++){var a=t[i];a.copy(o,r),r+=a.length;}return o;},n.prototype.write=function(t,e,i,o){if(isFinite(e))isFinite(i)||(o=i,i=void 0);else{var n=o;o=e,e=i,i=n;}e=Number(e)||0;var r,a=this.length-e;switch(i?(i=Number(i))>a&&(i=a):i=a,o=String(o||"utf8").toLowerCase()){case"hex":r=p(this,t,e,i);break;case"utf8":case"utf-8":r=u(this,t,e,i);break;case"ascii":r=h(this,t,e,i);break;case"binary":r=function(t,e,i,o){return h(t,e,i,o);}(this,t,e,i);break;case"base64":r=f(this,t,e,i);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=m(this,t,e,i);break;default:throw new Error("Unknown encoding");}return r;},n.prototype.toString=function(t,e,i){var o,n=this;if(t=String(t||"utf8").toLowerCase(),e=Number(e)||0,(i=void 0!==i?Number(i):i=n.length)===e)return"";switch(t){case"hex":o=function(t,e,i){var o=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>o)&&(i=o);for(var n="",r=e;r<i;r++){n+=_(t[r]);}return n;}(n,e,i);break;case"utf8":case"utf-8":o=function(t,e,i){var o="",n="";i=Math.min(t.length,i);for(var r=e;r<i;r++){t[r]<=127?(o+=F(n)+String.fromCharCode(t[r]),n=""):n+="%"+t[r].toString(16);}return o+F(n);}(n,e,i);break;case"ascii":o=g(n,e,i);break;case"binary":o=function(t,e,i){return g(t,e,i);}(n,e,i);break;case"base64":o=function(t,e,i){return 0===e&&i===t.length?R.fromByteArray(t):R.fromByteArray(t.slice(e,i));}(n,e,i);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":o=function(t,e,i){for(var o=t.slice(e,i),n="",r=0;r<o.length;r+=2){n+=String.fromCharCode(o[r]+256*o[r+1]);}return n;}(n,e,i);break;default:throw new Error("Unknown encoding");}return o;},n.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)};},n.prototype.copy=function(t,e,i,o){var r=this;if(i||(i=0),o||0===o||(o=this.length),e||(e=0),o!==i&&0!==t.length&&0!==r.length){L(o>=i,"sourceEnd < sourceStart"),L(e>=0&&e<t.length,"targetStart out of bounds"),L(i>=0&&i<r.length,"sourceStart out of bounds"),L(o>=0&&o<=r.length,"sourceEnd out of bounds"),o>this.length&&(o=this.length),t.length-e<o-i&&(o=t.length-e+i);var a=o-i;if(a<100||!n._useTypedArrays)for(var s=0;s<a;s++){t[s+e]=this[s+i];}else t._set(this.subarray(i,i+a),e);}},n.prototype.slice=function(t,e){var i=this.length;if(t=S(t,i,0),e=S(e,i,i),n._useTypedArrays)return n._augment(this.subarray(t,e));for(var o=e-t,r=new n(o,void 0,!0),a=0;a<o;a++){r[a]=this[a+t];}return r;},n.prototype.get=function(t){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(t);},n.prototype.set=function(t,e){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(t,e);},n.prototype.readUInt8=function(t,e){if(e||(L(null!=t,"missing offset"),L(t<this.length,"Trying to read beyond buffer length")),!(t>=this.length))return this[t];},n.prototype.readUInt16LE=function(t,e){return v(this,t,!0,e);},n.prototype.readUInt16BE=function(t,e){return v(this,t,!1,e);},n.prototype.readUInt32LE=function(t,e){return b(this,t,!0,e);},n.prototype.readUInt32BE=function(t,e){return b(this,t,!1,e);},n.prototype.readInt8=function(t,e){if(e||(L(null!=t,"missing offset"),L(t<this.length,"Trying to read beyond buffer length")),!(t>=this.length))return 128&this[t]?-1*(255-this[t]+1):this[t];},n.prototype.readInt16LE=function(t,e){return y(this,t,!0,e);},n.prototype.readInt16BE=function(t,e){return y(this,t,!1,e);},n.prototype.readInt32LE=function(t,e){return C(this,t,!0,e);},n.prototype.readInt32BE=function(t,e){return C(this,t,!1,e);},n.prototype.readFloatLE=function(t,e){return x(this,t,!0,e);},n.prototype.readFloatBE=function(t,e){return x(this,t,!1,e);},n.prototype.readDoubleLE=function(t,e){return A(this,t,!0,e);},n.prototype.readDoubleBE=function(t,e){return A(this,t,!1,e);},n.prototype.writeUInt8=function(t,e,i){i||(L(null!=t,"missing value"),L(null!=e,"missing offset"),L(e<this.length,"trying to write beyond buffer length"),P(t,255)),e>=this.length||(this[e]=t);},n.prototype.writeUInt16LE=function(t,e,i){$(this,t,e,!0,i);},n.prototype.writeUInt16BE=function(t,e,i){$(this,t,e,!1,i);},n.prototype.writeUInt32LE=function(t,e,i){w(this,t,e,!0,i);},n.prototype.writeUInt32BE=function(t,e,i){w(this,t,e,!1,i);},n.prototype.writeInt8=function(t,e,i){i||(L(null!=t,"missing value"),L(null!=e,"missing offset"),L(e<this.length,"Trying to write beyond buffer length"),B(t,127,-128)),e>=this.length||(t>=0?this.writeUInt8(t,e,i):this.writeUInt8(255+t+1,e,i));},n.prototype.writeInt16LE=function(t,e,i){D(this,t,e,!0,i);},n.prototype.writeInt16BE=function(t,e,i){D(this,t,e,!1,i);},n.prototype.writeInt32LE=function(t,e,i){I(this,t,e,!0,i);},n.prototype.writeInt32BE=function(t,e,i){I(this,t,e,!1,i);},n.prototype.writeFloatLE=function(t,e,i){V(this,t,e,!0,i);},n.prototype.writeFloatBE=function(t,e,i){V(this,t,e,!1,i);},n.prototype.writeDoubleLE=function(t,e,i){T(this,t,e,!0,i);},n.prototype.writeDoubleBE=function(t,e,i){T(this,t,e,!1,i);},n.prototype.fill=function(t,e,i){if(t||(t=0),e||(e=0),i||(i=this.length),"string"==typeof t&&(t=t.charCodeAt(0)),L("number"==typeof t&&!isNaN(t),"value is not a number"),L(i>=e,"end < start"),i!==e&&0!==this.length){L(e>=0&&e<this.length,"start out of bounds"),L(i>=0&&i<=this.length,"end out of bounds");for(var o=e;o<i;o++){this[o]=t;}}},n.prototype.inspect=function(){for(var t=[],e=this.length,o=0;o<e;o++){if(t[o]=_(this[o]),o===i.INSPECT_MAX_BYTES){t[o+1]="...";break;}}return"<Buffer "+t.join(" ")+">";},n.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(n._useTypedArrays)return new n(this).buffer;for(var t=new Uint8Array(this.length),e=0,i=t.length;e<i;e+=1){t[e]=this[e];}return t.buffer;}throw new Error("Buffer.toArrayBuffer not supported in this browser");};var q=n.prototype;n._augment=function(t){return t._isBuffer=!0,t._get=t.get,t._set=t.set,t.get=q.get,t.set=q.set,t.write=q.write,t.toString=q.toString,t.toLocaleString=q.toString,t.toJSON=q.toJSON,t.copy=q.copy,t.slice=q.slice,t.readUInt8=q.readUInt8,t.readUInt16LE=q.readUInt16LE,t.readUInt16BE=q.readUInt16BE,t.readUInt32LE=q.readUInt32LE,t.readUInt32BE=q.readUInt32BE,t.readInt8=q.readInt8,t.readInt16LE=q.readInt16LE,t.readInt16BE=q.readInt16BE,t.readInt32LE=q.readInt32LE,t.readInt32BE=q.readInt32BE,t.readFloatLE=q.readFloatLE,t.readFloatBE=q.readFloatBE,t.readDoubleLE=q.readDoubleLE,t.readDoubleBE=q.readDoubleBE,t.writeUInt8=q.writeUInt8,t.writeUInt16LE=q.writeUInt16LE,t.writeUInt16BE=q.writeUInt16BE,t.writeUInt32LE=q.writeUInt32LE,t.writeUInt32BE=q.writeUInt32BE,t.writeInt8=q.writeInt8,t.writeInt16LE=q.writeInt16LE,t.writeInt16BE=q.writeInt16BE,t.writeInt32LE=q.writeInt32LE,t.writeInt32BE=q.writeInt32BE,t.writeFloatLE=q.writeFloatLE,t.writeFloatBE=q.writeFloatBE,t.writeDoubleLE=q.writeDoubleLE,t.writeDoubleBE=q.writeDoubleBE,t.fill=q.fill,t.inspect=q.inspect,t.toArrayBuffer=q.toArrayBuffer,t;};}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer");},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(t,e,i){(function(i,o,n,r,a,s,l,c,d){n=t("buffer").Buffer;var p=4,u=new n(p);u.fill(0);var h=8;e.exports={hash:function hash(t,e,i,o){return n.isBuffer(t)||(t=new n(t)),function(t,e,i){for(var o=new n(e),r=i?o.writeInt32BE:o.writeInt32LE,a=0;a<t.length;a++){r.call(o,t[a],4*a,!0);}return o;}(e(function(t,e){if(t.length%p!=0){var i=t.length+(p-t.length%p);t=n.concat([t,u],i);}for(var o=[],r=e?t.readInt32BE:t.readInt32LE,a=0;a<t.length;a+=p){o.push(r.call(t,a));}return o;}(t,o),t.length*h),i,o);}};}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify");},{buffer:3,lYpoI2:10}],5:[function(t,e,i){(function(e,o,n,r,a,s,l,c,d){function p(t,e){var i=g[t=t||"sha1"],o=[];return i||u("algorithm:",t,"is not yet supported"),{update:function update(t){return n.isBuffer(t)||(t=new n(t)),o.push(t),t.length,this;},digest:function digest(t){var r=n.concat(o),a=e?function(t,e,i){n.isBuffer(e)||(e=new n(e)),n.isBuffer(i)||(i=new n(i)),e.length>v?e=t(e):e.length<v&&(e=n.concat([e,b],v));for(var o=new n(v),r=new n(v),a=0;a<v;a++){o[a]=54^e[a],r[a]=92^e[a];}var s=t(n.concat([o,i]));return t(n.concat([r,s]));}(i,e,r):i(r);return o=null,t?a.toString(t):a;}};}function u(){var t=[].slice.call(arguments).join(" ");throw new Error([t,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join("\n"));}n=t("buffer").Buffer;var h=t("./sha"),f=t("./sha256"),m=t("./rng"),g={sha1:h,sha256:f,md5:t("./md5")},v=64,b=new n(v);b.fill(0),i.createHash=function(t){return p(t);},i.createHmac=function(t,e){return p(t,e);},i.randomBytes=function(t,e){if(!e||!e.call)return new n(m(t));try{e.call(this,void 0,new n(m(t)));}catch(t){e(t);}},function(t,e){for(var i in t){e(t[i],i);}}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(t){i[t]=function(){u("sorry,",t,"is not implemented yet");};});}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify");},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(t,e,i){(function(i,o,n,r,a,s,l,c,d){function p(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;for(var i=1732584193,o=-271733879,n=-1732584194,r=271733878,a=0;a<t.length;a+=16){var s=i,l=o,c=n,d=r;i=h(i,o,n,r,t[a+0],7,-680876936),r=h(r,i,o,n,t[a+1],12,-389564586),n=h(n,r,i,o,t[a+2],17,606105819),o=h(o,n,r,i,t[a+3],22,-1044525330),i=h(i,o,n,r,t[a+4],7,-176418897),r=h(r,i,o,n,t[a+5],12,1200080426),n=h(n,r,i,o,t[a+6],17,-1473231341),o=h(o,n,r,i,t[a+7],22,-45705983),i=h(i,o,n,r,t[a+8],7,1770035416),r=h(r,i,o,n,t[a+9],12,-1958414417),n=h(n,r,i,o,t[a+10],17,-42063),o=h(o,n,r,i,t[a+11],22,-1990404162),i=h(i,o,n,r,t[a+12],7,1804603682),r=h(r,i,o,n,t[a+13],12,-40341101),n=h(n,r,i,o,t[a+14],17,-1502002290),i=f(i,o=h(o,n,r,i,t[a+15],22,1236535329),n,r,t[a+1],5,-165796510),r=f(r,i,o,n,t[a+6],9,-1069501632),n=f(n,r,i,o,t[a+11],14,643717713),o=f(o,n,r,i,t[a+0],20,-373897302),i=f(i,o,n,r,t[a+5],5,-701558691),r=f(r,i,o,n,t[a+10],9,38016083),n=f(n,r,i,o,t[a+15],14,-660478335),o=f(o,n,r,i,t[a+4],20,-405537848),i=f(i,o,n,r,t[a+9],5,568446438),r=f(r,i,o,n,t[a+14],9,-1019803690),n=f(n,r,i,o,t[a+3],14,-187363961),o=f(o,n,r,i,t[a+8],20,1163531501),i=f(i,o,n,r,t[a+13],5,-1444681467),r=f(r,i,o,n,t[a+2],9,-51403784),n=f(n,r,i,o,t[a+7],14,1735328473),i=m(i,o=f(o,n,r,i,t[a+12],20,-1926607734),n,r,t[a+5],4,-378558),r=m(r,i,o,n,t[a+8],11,-2022574463),n=m(n,r,i,o,t[a+11],16,1839030562),o=m(o,n,r,i,t[a+14],23,-35309556),i=m(i,o,n,r,t[a+1],4,-1530992060),r=m(r,i,o,n,t[a+4],11,1272893353),n=m(n,r,i,o,t[a+7],16,-155497632),o=m(o,n,r,i,t[a+10],23,-1094730640),i=m(i,o,n,r,t[a+13],4,681279174),r=m(r,i,o,n,t[a+0],11,-358537222),n=m(n,r,i,o,t[a+3],16,-722521979),o=m(o,n,r,i,t[a+6],23,76029189),i=m(i,o,n,r,t[a+9],4,-640364487),r=m(r,i,o,n,t[a+12],11,-421815835),n=m(n,r,i,o,t[a+15],16,530742520),i=g(i,o=m(o,n,r,i,t[a+2],23,-995338651),n,r,t[a+0],6,-198630844),r=g(r,i,o,n,t[a+7],10,1126891415),n=g(n,r,i,o,t[a+14],15,-1416354905),o=g(o,n,r,i,t[a+5],21,-57434055),i=g(i,o,n,r,t[a+12],6,1700485571),r=g(r,i,o,n,t[a+3],10,-1894986606),n=g(n,r,i,o,t[a+10],15,-1051523),o=g(o,n,r,i,t[a+1],21,-2054922799),i=g(i,o,n,r,t[a+8],6,1873313359),r=g(r,i,o,n,t[a+15],10,-30611744),n=g(n,r,i,o,t[a+6],15,-1560198380),o=g(o,n,r,i,t[a+13],21,1309151649),i=g(i,o,n,r,t[a+4],6,-145523070),r=g(r,i,o,n,t[a+11],10,-1120210379),n=g(n,r,i,o,t[a+2],15,718787259),o=g(o,n,r,i,t[a+9],21,-343485551),i=v(i,s),o=v(o,l),n=v(n,c),r=v(r,d);}return Array(i,o,n,r);}function u(t,e,i,o,n,r){return v(function(t,e){return t<<e|t>>>32-e;}(v(v(e,t),v(o,r)),n),i);}function h(t,e,i,o,n,r,a){return u(e&i|~e&o,t,e,n,r,a);}function f(t,e,i,o,n,r,a){return u(e&o|i&~o,t,e,n,r,a);}function m(t,e,i,o,n,r,a){return u(e^i^o,t,e,n,r,a);}function g(t,e,i,o,n,r,a){return u(i^(e|~o),t,e,n,r,a);}function v(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i;}var b=t("./helpers");e.exports=function(t){return b.hash(t,p,16);};}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify");},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(t,e,i){(function(t,i,o,n,r,a,s,l,c){!function(){var t,i;t=function t(_t2){for(var e,i=new Array(_t2),o=0;o<_t2;o++){0==(3&o)&&(e=4294967296*Math.random()),i[o]=e>>>((3&o)<<3)&255;}return i;},this.crypto&&crypto.getRandomValues&&(i=function i(t){var e=new Uint8Array(t);return crypto.getRandomValues(e),e;}),e.exports=i||t;}();}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify");},{buffer:3,lYpoI2:10}],8:[function(t,e,i){(function(i,o,n,r,a,s,l,c,d){function p(t,e){t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var i=Array(80),o=1732584193,n=-271733879,r=-1732584194,a=271733878,s=-1009589776,l=0;l<t.length;l+=16){for(var c=o,d=n,p=r,g=a,v=s,b=0;b<80;b++){i[b]=b<16?t[l+b]:m(i[b-3]^i[b-8]^i[b-14]^i[b-16],1);var y=f(f(m(o,5),u(b,n,r,a)),f(f(s,i[b]),h(b)));s=a,a=r,r=m(n,30),n=o,o=y;}o=f(o,c),n=f(n,d),r=f(r,p),a=f(a,g),s=f(s,v);}return Array(o,n,r,a,s);}function u(t,e,i,o){return t<20?e&i|~e&o:t<40?e^i^o:t<60?e&i|e&o|i&o:e^i^o;}function h(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514;}function f(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i;}function m(t,e){return t<<e|t>>>32-e;}var g=t("./helpers");e.exports=function(t){return g.hash(t,p,20,!0);};}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify");},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(t,e,i){(function(i,o,n,r,a,s,l,c,d){var p=t("./helpers"),u=function u(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i;},h=function h(t,e){return t>>>e|t<<32-e;},f=function f(t,e){return t>>>e;},m=function m(t,e,i){return t&e^~t&i;},g=function g(t,e,i){return t&e^t&i^e&i;},v=function v(t){return h(t,2)^h(t,13)^h(t,22);},b=function b(t){return h(t,6)^h(t,11)^h(t,25);},y=function y(t){return h(t,7)^h(t,18)^f(t,3);},C=function C(t){return h(t,17)^h(t,19)^f(t,10);},x=function x(t,e){var i,o,n,r,a,s,l,c,d,p,h=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),f=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),x=new Array(64);t[e>>5]|=128<<24-e%32,t[15+(e+64>>9<<4)]=e;for(var A=0;A<t.length;A+=16){i=f[0],o=f[1],n=f[2],r=f[3],a=f[4],s=f[5],l=f[6],c=f[7];for(var $=0;$<64;$++){x[$]=$<16?t[$+A]:u(u(u(C(x[$-2]),x[$-7]),y(x[$-15])),x[$-16]),d=u(u(u(u(c,b(a)),m(a,s,l)),h[$]),x[$]),p=u(v(i),g(i,o,n)),c=l,l=s,s=a,a=u(r,d),r=n,n=o,o=i,i=u(d,p);}f[0]=u(i,f[0]),f[1]=u(o,f[1]),f[2]=u(n,f[2]),f[3]=u(r,f[3]),f[4]=u(a,f[4]),f[5]=u(s,f[5]),f[6]=u(l,f[6]),f[7]=u(c,f[7]);}return f;};e.exports=function(t){return p.hash(t,x,32,!0);};}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify");},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(t,e,i){(function(t,i,o,n,r,a,s,l,c){function d(){}(t=e.exports={}).nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t);};if(e){var i=[];return window.addEventListener("message",function(t){var e=t.source;(e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),i.length>0)&&i.shift()();},!0),function(t){i.push(t),window.postMessage("process-tick","*");};}return function(t){setTimeout(t,0);};}(),t.title="browser",t.browser=!0,t.env={},t.argv=[],t.on=d,t.addListener=d,t.once=d,t.off=d,t.removeListener=d,t.removeAllListeners=d,t.emit=d,t.binding=function(t){throw new Error("process.binding is not supported");},t.cwd=function(){return"/";},t.chdir=function(t){throw new Error("process.chdir is not supported");};}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process");},{buffer:3,lYpoI2:10}],11:[function(t,e,i){(function(t,e,o,n,r,a,s,l,c){i.read=function(t,e,i,o,n){var r,a,s=8*n-o-1,l=(1<<s)-1,c=l>>1,d=-7,p=i?n-1:0,u=i?-1:1,h=t[e+p];for(p+=u,r=h&(1<<-d)-1,h>>=-d,d+=s;d>0;r=256*r+t[e+p],p+=u,d-=8){;}for(a=r&(1<<-d)-1,r>>=-d,d+=o;d>0;a=256*a+t[e+p],p+=u,d-=8){;}if(0===r)r=1-c;else{if(r===l)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,o),r-=c;}return(h?-1:1)*a*Math.pow(2,r-o);},i.write=function(t,e,i,o,n,r){var a,s,l,c=8*r-n-1,d=(1<<c)-1,p=d>>1,u=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,h=o?0:r-1,f=o?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=d):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+p>=1?u/l:u*Math.pow(2,1-p))*l>=2&&(a++,l/=2),a+p>=d?(s=0,a=d):a+p>=1?(s=(e*l-1)*Math.pow(2,n),a+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,n),a=0));n>=8;t[i+h]=255&s,h+=f,s/=256,n-=8){;}for(a=a<<n|s,c+=n;c>0;t[i+h]=255&a,h+=f,a/=256,c-=8){;}t[i+h-f]|=128*m;};}).call(this,t("lYpoI2"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754");},{buffer:3,lYpoI2:10}]},{},[1])(1);},t.exports=n();},function(t,e,i){"use strict";i.d(e,"a",function(){return r;});var o=i(2),n=function n(t){var e="api/admin/v2/s3/"+t;return Object(o.a)(e);},r={DB:{getDbTypes:function getDbTypes(){return Object(o.a)("api/admin/v2/datasources/dbtype");},getDatasources:function getDatasources(){return Object(o.a)("api/admin/v2/datasources");},getDatasource:function getDatasource(t){var e="api/admin/v2/datasources/"+t;return Object(o.a)(e);},addDatasource:function addDatasource(t){var e="api/admin/v2/datasources/"+t.datasourceName;return Object(o.b)(e,t);},updateDatasource:function updateDatasource(t){var e="api/admin/v2/datasources/"+t.datasourceName+"/update";return Object(o.b)(e,t);},deleteDatasource:function deleteDatasource(t){var e="api/admin/v2/datasources/"+t+"/delete";return Object(o.b)(e);}},Cloud:{getS3s:function getS3s(){return Object(o.a)("api/admin/v2/s3");},getS3:n,addS3:function addS3(t){var e="api/admin/v2/s3/"+t.datasourceName;return n(t.datasourceName).then(function(i){if(i)throw{errors:[{code:500,message:"Datasource name already exists."}]};return Object(o.b)(e,t);});},updateS3:function updateS3(t){var e="api/admin/v2/s3/"+t.datasourceName+"/update";return Object(o.b)(e,t);},deleteS3:function deleteS3(t){var e="api/admin/v2/s3/"+t+"/delete";return Object(o.b)(e);}}};},function(t,e,i){"use strict";i(0),i(2),i(9);var o=i(52);i.d(e,"a",function(){return o.a;});},function(t,e,i){"use strict";i(53),i(54);var o=i(55);i(56),i(57);i.d(e,"a",function(){return o.a;});},function(t,e,i){"use strict";},function(t,e,i){"use strict";},function(t,e,i){"use strict";i.d(e,"a",function(){return o;});var o=function o(t,e){return _.forEach(t,e);};},function(t,e,i){"use strict";},function(t,e,i){"use strict";},function(t,e,i){"use strict";function o(){this.validateVersion={3.5:this.validateVersion3_5,3.6:this.validateVersion3_5};}i.d(e,"a",function(){return n;}),o.prototype.getValidateFunction=function(t){var e=this.validateVersion[t];return e||this.validateLegacy;},o.prototype.validate=function(t,e){return this.getValidateFunction(t.version)(t,e);},o.prototype.validateLegacy=function(t,e){var i="Invalid Model File.",o="",n=["data","control","visual","deeplearning"];"Report"===e&&(i="Invalid Report File.");try{if(t instanceof Array){var r=[];for(var a in t){if(void 0===t[a].mid||-1===n.indexOf(t[a].type)){o=i;break;}"visual"===t[a].type&&r.push(t[a]);}"Report"===e&&0===r.length?o=i:"Model"===e&&r.length>0&&(o=i);}else void 0===t.mid?o=t.jid?"Runnable Model File.":i:"Report"===e&&"visual"!==t.type||"Model"===e&&"visual"===t.type?o=i:-1===n.indexOf(t.type)&&(o=i);return o;}catch(t){return"Invalid Model(.json) File.";}},o.prototype.validateVersion3_5=function(t,e){var i="";return t.main&&t.models?i="Runnable Model File.":0===t.data.length?i="Invalid Model File.":"project"===t.type&&(i="Project File."),i;};var n=new o();},function(t,e,i){"use strict";i.d(e,"a",function(){return a;});var o=i(25);var n={duplicate:function duplicate(t){return'"'+t+'" is already exist';},index:function index(){return"Should be filled previous element first";},empty:function empty(){return'can not switch to "Empty"';}};function r(){}r.prototype.render=function(t){return this.empty(t),this.init(t),this.createLayout(t),this.createInputs(t),this.bindEvents(t),this;},r.prototype.init=function(t){o.a.hasMeta(t.fnUnit)?this.DATA_TYPE="object":this.DATA_TYPE="array";},r.prototype.getPrevFnUnitByTableId=function(t,e){var i=o.a.getPreviousFnUnits(t);for(var n in i){var r=i[n];if(o.a.getOutData(r).indexOf(e)>-1)return r;}},r.prototype.empty=function(t){t.appendTo.empty();},r.prototype.createLayout=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-input-list">   <div class="brtc-va-editors-sheet-controls-input-list-content"/></div>');e.attr("autoArrange",t.autoArrange||!1);var i=$('<div class="brtc-va-editors-sheet-controls-input-list-container"></div>');e.append(i),t.appendTo.append(e);},r.prototype.createInputs=function(t){var e=this,i=o.a.getInputs(t.fnUnit);if(o.a.hasMeta(t.fnUnit))_.forEach(i,function(i,n){var r={type:o.a.getTypeByKey(t.fnUnit,n),tableId:i,key:n,fnUnit:t.fnUnit,appendTo:t.appendTo,emptyLabel:t.emptyLabel,readOnly:t.readOnly,autoArrange:!1};e.createInputUnit(r);});else{var n=o.a.getInRange(t.fnUnit).table.max;o.a.isFlexibleFunction(t.fnUnit)&&(n=o.a.getInTable(t.fnUnit).length);for(var r=0;r<n;r++){var a={type:"table",tableId:i[r],key:"["+r+"]"+o.a.getLabel(t.fnUnit),fnUnit:t.fnUnit,appendTo:t.appendTo,emptyLabel:t.emptyLabel,readOnly:t.readOnly,autoArrange:!0};e.createInputUnit(a);}}},r.prototype.enableDragEvent=function(t){var e=t.hasClass("brtc-style-controls-inputselector-box-wrapper")?t:t.closest(".brtc-style-controls-inputselector-box-wrapper");this.isDraggable(e)&&e.draggable("enable");},r.prototype.disableDragEvent=function(t){var e=t.hasClass("brtc-style-controls-inputselector-box-wrapper")?t:t.closest(".brtc-style-controls-inputselector-box-wrapper");this.isDraggable(e)&&e.draggable("disable");},r.prototype.isDraggable=function(t){return(t.hasClass("brtc-style-controls-inputselector-box-wrapper")?t:t.closest(".brtc-style-controls-inputselector-box-wrapper")).hasClass("ui-draggable");},r.prototype.createInputUnit=function(t){var e=t.key,i=t.tableId,n=t.type,r=t.fnUnit,a=this.getPrevFnUnitByInTableId(r,i),s=t.readOnly,l=t.autoArrange,c=this.createBox({appendTo:t.appendTo,label:e,type:n});!t.readOnly&&_.isEqual(this.DATA_TYPE,"array")&&(this.createDragEvent(t.appendTo,c),i?this.enableDragEvent(c):this.disableDragEvent(c)),"array"!==this.DATA_TYPE||s||c.css("cursor","move"),c.attr("key",e),c.attr("type",n),c.attr("table-id",i);var d=c.find(".brtc-style-controls-inputselector-box-contents"),p=d.find(".brtc-style-controls-inputselector-box-contents-figure"),u=d.find(".brtc-style-controls-inputselector-box-contents-remove"),h=d.find(".brtc-style-controls-inputselector-box-key");t.appendTo.find(".brtc-va-editors-sheet-controls-input-list-container").append(c),d.append(f);var f=this.createEmptyItem({parent:p,type:n,label:t.emptyLabel,readOnly:s}),m=this.createFuncItem({label:o.a.getLabel(a),func:o.a.getFunc(a),type:o.a.getTypeByTableId(a,i),tableId:i}),g=o.a.getOutputsToObject(a),v=this.createKeyItem({key:g[i],type:n}),b=this.createRemoveButton({autoArrange:l});return p.append(m),h.append(v),s||u.append(b),s||this.createDropEvent(c),i?(f.hide(),m.show(),v.show(),b.show()):(f.show(),m.hide(),v.hide(),b.hide()),this.registerRemoveEvent(b),c;},r.prototype.getPrevFnUnitByInTableId=function(t,e){if(t){var i=o.a.getPreviousFnUnits(t);for(var n in i){var r=o.a.getOutData(i[n]);if(r&&r.indexOf(e)>-1)return i[n];}}},r.prototype.createBox=function(t){return this.createBoxWrapper(t.label,t.type);},r.prototype.createDragEvent=function(t,e){e.draggable({helper:"clone",appendTo:t,start:function start(t,i){e.css("opacity",".3"),i.helper.css({width:"220px",border:"none"}),i.helper.find(".brtc-style-controls-inputselector-box-title").hide();},stop:function stop(t,i){e.css("opacity","1");}});},r.prototype.createBoxWrapper=function(t,e){var i=$('<div class="brtc-style-controls-inputselector-box-wrapper"></div>'),o=$('<div class="brtc-style-controls-inputselector-box-title brtc-style-ellipsis"><div class="icon"></div><div class="brtc-label"></div></div>'),n=$('<div class="brtc-style-controls-inputselector-box-contents"><div class="brtc-style-controls-inputselector-box-contents-figure"></div><div class="brtc-style-controls-inputselector-box-contents-remove"></div></div>'),r=$('<div class="brtc-style-controls-inputselector-box-key"></div>');return i.append(o).append(n),n.append(r),o.find(".icon").attr("type",e),o.find(".brtc-label").text(t),i;},r.prototype.createFuncItem=function(t){var e=t.label,i=t.func,o=t.type,n=t.tableId,r=$('<div class="brtc-va-editors-sheet-controls-inputselector-item"></div>'),a=Brightics.VA.Core.Utils.WidgetUtils.createPaletteBox({func:i,label:e});return r.append(a),a.find(".brtc-va-views-palette-fnunit-label").addClass("brtc-style-ellipsis"),a.find(".brtc-va-views-palette-fnunit-label").text(e),r.attr("table-id",n),r.attr("type",o),a.find(".brtc-va-views-palette-fnunit-label").text(e),a.attr("title",e),a.addClass("item"),r;},r.prototype.createKeyItem=function(t){var e=$('<div class="brtc-style-controls-inputselector-box-key-wrapper"></div>'),i=$('<div class="brtc-style-controls-inputselector-box-key-type"></div>'),o=$('<div class="brtc-style-ellipsis brtc-style-controls-inputselector-box-key-label"></div>');return e.append(i).append(o),o.text(t.key),o.attr("title",t.key),i.append(this.createTypeIcon(t.type)),e;},r.prototype.createTypeIcon=function(t){return $('<div class="brtc-style-controls-inputselector-box-key-type-icon"></div>').attr("type",t);},r.prototype.createEmptyItem=function(t){var e=t.label||"Drop Data",i=t.parent,o=t.type,n=t.readOnly,r=$('<div class="brtc-va-fnunit-input-empty">   <div>'+e+"</div></div>");return i.append(r),n||this.createDropEvent(r,o),r;},r.prototype.getDropFuncTarget=function(t){return t.find(".brtc-style-controls-inputselector-box-contents");},r.prototype.getDroppableCssSelector=function(){return[".brtc-va-fnunit-input-empty",".brtc-va-editors-sheet-controls-inputselector-item",".brtc-va-tools-sidebar-variable-remove",".brtc-style-controls-inputselector-box-key-wrapper"].join(",");},r.prototype.addActivateClass=function(t){t.find(this.getDroppableCssSelector()).addClass("brtc-style-droppable-active");},r.prototype.removeActivateClass=function(t){t.find(this.getDroppableCssSelector()).removeClass("brtc-style-droppable-active");},r.prototype.addHoverClass=function(t){t.find(this.getDroppableCssSelector()).addClass("brtc-style-droppable-hover");},r.prototype.removeHoverClass=function(t){t.find(this.getDroppableCssSelector()).removeClass("brtc-style-droppable-hover");},r.prototype.createDropEvent=function(t){var e=this,i=t.attr("type");t.droppable({accept:".brtc-va-controls-datatree-li-table[type="+i+"] .ui-draggable, .brtc-style-controls-inputselector-box-wrapper",activate:function activate(t,i){e.addActivateClass($(this));},deactivate:function deactivate(t,i){e.removeActivateClass($(this)),e.removeHoverClass($(this));},over:function over(t,i){e.addHoverClass($(this));},out:function out(t,i){e.removeHoverClass($(this));},drop:function drop(t,i){var o=i.draggable,r=e.getMainArea($(this)),a=o.text(),s=e.validate(o,$(this));_.isEmpty(s)?(e.removeActivateClass($(this)),e.removeHoverClass($(this)),e.switchData(o,$(this)),e.handleChange($(this))):e.handleError(r,n[s.type](a));}});},r.prototype.validate=function(t,e){return this.checkDuplicated(t,e)?{type:"duplicate"}:this.checkIndex(t,e)?{type:"index"}:this.checkEmpty(t,e)?{type:"empty"}:void 0;},r.prototype.checkDuplicated=function(t,e){var i=this.getInputs(this.getMainArea(e)),o=t.closest("li").attr("table-id");for(var n in i){if(_.isEqual(i[n],o))return!0;}return!1;},r.prototype.checkIndex=function(t,e){if("object"===this.DATA_TYPE)return!1;var i=e.prev();return!(_.isEmpty(i)||!this.isEmptyBox(i));},r.prototype.checkEmpty=function(t,e){return!t.hasClass("jqx-tree-item")&&!(!this.isEmptyBox(t)&&!this.isEmptyBox(e));},r.prototype.switchData=function(t,e){if(t.hasClass("brtc-style-controls-inputselector-box-wrapper")){var i=t.closest(".brtc-style-controls-inputselector-box-wrapper").find(".brtc-style-controls-inputselector-box-contents"),o=i.clone(),n=e.closest(".brtc-style-controls-inputselector-box-wrapper").find(".brtc-style-controls-inputselector-box-contents"),r=n.clone();return n.replaceWith(o),i.replaceWith(r),this.registerRemoveEvent(o.find(".brtc-va-tools-sidebar-variable-remove")),this.registerRemoveEvent(r.find(".brtc-va-tools-sidebar-variable-remove")),this.isEmptyBox(o)?this.disableDragEvent(o):this.enableDragEvent(o),this.isEmptyBox(r)?this.disableDragEvent(r):this.enableDragEvent(r),r;}var a=t.closest("li").attr("key"),s=t.closest("li").attr("label"),l=t.closest("li").attr("type"),c=t.closest("li").attr("func"),d=t.closest("li").attr("table-id"),p=this.createFuncItem({label:s,func:c,type:l,tableId:d}),u=this.createKeyItem({key:a,type:l}),h=e.closest(".brtc-style-controls-inputselector-box-wrapper"),f=h.find(".brtc-style-controls-inputselector-box-contents"),m=f.find(".brtc-va-editors-sheet-controls-inputselector-item"),g=f.find(".brtc-style-controls-inputselector-box-key-wrapper"),v=f.find(".brtc-va-fnunit-input-empty"),b=f.find(".brtc-va-tools-sidebar-variable-remove");v.hide(),e.show(),g.show(),b.show(),this.registerRemoveEvent(b),m.replaceWith(p),g.replaceWith(u),this.enableDragEvent(p),this.createDropEvent(h);},r.prototype.createRemoveButton=function(t){return $('<span class="brtc-va-tools-sidebar-variable-remove"></span>');},r.prototype.registerRemoveEvent=function(t){var e=this;t.off("click"),t.click(function(){var t=e.getMainArea($(this)),i=$(this).closest(".brtc-style-controls-inputselector-box-wrapper"),o=i.find(".brtc-va-editors-sheet-controls-inputselector-item"),n=i.find(".brtc-style-controls-inputselector-box-key-wrapper"),r=i.find(".brtc-va-fnunit-input-empty");i.find(".brtc-va-tools-sidebar-variable-remove").hide(),n.hide(),o.hide(),r.show(),e.disableDragEvent(i),"true"===t.attr("autoArrange")&&e.autoArrange(i),e.handleRemove(t);});},r.prototype.autoArrange=function(t){var e=t.next();if(!_.isEmpty(e)&&!this.isEmptyBox(e)){var i=this.switchData(e,t);this.autoArrange(i);}},r.prototype.isEmptyBox=function(t){return(t.hasClass("brtc-style-controls-inputselector-box-wrapper")?t:t.closest(".brtc-style-controls-inputselector-box-wrapper")).find(".brtc-va-fnunit-input-empty").is(":visible");},r.prototype.handleChange=function(t){this.getMainArea(t).trigger("change",[this.getInputs(t)]);},r.prototype.handleRemove=function(t){this.getMainArea(t).trigger("change",[this.getInputs(t)]);},r.prototype.handleError=function(t,e){this.getMainArea(t).trigger("error",[e]);},r.prototype.getPreviousFnUnits=function(t){var e=[],i=t.parent(),n=i.getPrevious(o.a.getId(t));return _.forEach(n,function(t){e.push(i.getFnUnitById(t));}),e;},r.prototype.getMainArea=function(t){return t.closest(".brtc-va-editors-sheet-controls-input-list")||t;},r.prototype.getInputs=function(t){var e=this.getMainArea(t).find(".brtc-style-controls-inputselector-box-wrapper"),i={};return _.forEach(e,function(t){var e=$(t),o=e.find(".brtc-va-editors-sheet-controls-inputselector-item"),n=e.attr("key"),r=o.is(":visible")?o.attr("table-id"):"";i[n]=r;}),i;},r.prototype.destroyDragEvent=function(t){t.on("dragstop",function(e,i){t.hasClass("ui-draggable")&&i.helper.attr("table-id")!==e.target.getAttribute("table-id")&&t.draggable("destroy");});},r.prototype.bindEvents=function(t){var e=t.appendTo.find(".brtc-va-editors-sheet-controls-input-list");"function"==typeof t.onClick&&e.bind("click",t.onClick),"function"==typeof t.onChange&&e.bind("change",t.onChange),"function"==typeof t.onError&&e.bind("error",t.onError);};var a=new r();},function(t,e,i){"use strict";function o(){}i.d(e,"a",function(){return n;}),o.prototype.create=function(t){return this.createUnit(t);},o.prototype.createUnit=function(t){var e=t.key,i=t.tableId,o=t.type,n=t.label,r=t.func,a=this.createBox(e);a.attr("key",e),a.attr("type",o),a.attr("label",n),a.attr("func",r),a.attr("table-id",i);var s=a.find(".brtc-style-controls-inputselector-box-contents"),l=s.find(".brtc-style-controls-inputselector-box-contents-figure"),c=s.find(".brtc-style-controls-inputselector-box-key"),d=this.createFuncItem({label:n,func:r,type:o,tableId:i}),p=this.createKeyItem({key:e,type:o});this.createRemoveButton();return l.append(d),c.append(p),a;},o.prototype.bindEvents=function(t,e){"function"==typeof e.onClick&&t.bind("click",e.onClick),"function"==typeof e.onChange&&t.bind("change",e.onChange),"function"==typeof e.onRemove&&t.bind("remove",e.onRemove);},o.prototype.getPrevFnUnitByInTableId=function(t,e){if(t){var i=FnUnitUtils.getPreviousFnUnits(t);for(var o in i){var n=FnUnitUtils.getOutData(i[o]);if(n&&n.indexOf(e)>-1)return i[o];}}},o.prototype.createBox=function(t){return this.createBoxWrapper(t);},o.prototype.createBoxWrapper=function(t){var e=$('<div class="brtc-style-controls-inputselector-box-wrapper"></div>');e.css("width","100%"),e.css("height","55px");var i=$('<div class="brtc-style-controls-inputselector-box-contents"><div class="brtc-style-controls-inputselector-box-contents-figure"></div><div class="brtc-style-controls-inputselector-box-contents-remove"></div></div>'),o=$('<div class="brtc-style-controls-inputselector-box-key"></div>');return e.append(i),i.append(o),e;},o.prototype.createFuncItem=function(t){var e=t.label,i=t.func,o=t.type,n=t.tableId,r=$('<div class="brtc-va-editors-sheet-controls-inputselector-item"></div>'),a=Brightics.VA.Core.Utils.WidgetUtils.createPaletteBox({func:i,label:e});return r.append(a),a.find(".brtc-va-views-palette-fnunit-label").text(e),r.attr("table-id",n),r.attr("type",o),a.find(".brtc-va-views-palette-fnunit-label").text(e),a.attr("title",e),a.addClass("item"),r;},o.prototype.createKeyItem=function(t){var e=$('<div class="brtc-style-controls-inputselector-box-key-wrapper"></div>'),i=$('<div class="brtc-style-controls-inputselector-box-key-type"></div>'),o=$('<div class="brtc-style-controls-inputselector-box-key-label"></div>');return e.append(i).append(o),o.text(t.key),i.append(this.createTypeIcon()),e;},o.prototype.createTypeIcon=function(){return $('<div class="brtc-style-controls-inputselector-box-key-type-icon" type="table"></div>');},o.prototype.createEmptyItem=function(t){var e=t.label||"Drop Data",i=t.parent,o=t.type,n=t.readOnly,r=$('<div class="brtc-va-fnunit-input-empty">   <div>'+e+"</div></div>");return i.append(r),n||this.createDropEvent(r,o),r;},o.prototype.getDropFuncTarget=function(t){return 1==t.find(".brtc-va-views-palette-fnunit").length?t.find(".brtc-va-views-palette-fnunit"):t;},o.prototype.createDropEvent=function(t){var e=this;t.droppable({accept:".key-items-draggable",activate:function activate(t,i){e.getDropFuncTarget($(this)).addClass("brtc-style-droppable-active");},deactivate:function deactivate(t,i){var o=e.getDropFuncTarget($(this));o.removeClass("brtc-style-droppable-active"),o.removeClass("brtc-style-droppable-hover");},over:function over(t,i){e.getDropFuncTarget($(this)).addClass("brtc-style-droppable-hover");},out:function out(t,i){e.getDropFuncTarget($(this)).removeClass("brtc-style-droppable-hover");},drop:function drop(t,i){var o=i.draggable,n=e.getDropFuncTarget($(this)),r=e.getMainArea($(this));n.removeClass("brtc-style-droppable-active"),n.removeClass("brtc-style-droppable-hover"),e.switchData(o,$(this));var a=e.getItems(r);r.trigger("change",[a]);}});},o.prototype.switchData=function(t,e){var i=t.closest("li").attr("key"),o=t.closest("li").attr("label"),n=t.closest("li").attr("type"),r=t.closest("li").attr("func"),a=t.closest("li").attr("table-id"),s=this.createFuncItem({label:o,func:r,type:n,tableId:a}),l=this.createKeyItem({key:i,type:n}),c=(e.hasClass("brtc-style-controls-inputselector-empty-fnunit"),e.closest(".brtc-style-controls-inputselector-box-wrapper")),d=c.find(".brtc-style-controls-inputselector-box-contents"),p=d.find(".brtc-va-editors-sheet-controls-inputselector-item"),u=d.find(".brtc-style-controls-inputselector-box-key-wrapper"),h=d.find(".brtc-va-fnunit-input-empty"),f=d.find(".brtc-va-tools-sidebar-variable-remove");h.hide(),e.show(),u.show(),f.show(),p.replaceWith(s),u.replaceWith(l),this.createDropEvent(c);},o.prototype.createRemoveButton=function(){var t=this,e=$('<span class="brtc-va-tools-sidebar-variable-remove"></span>');return e.click(function(){var e=$(this).closest(".brtc-style-controls-inputselector-box-wrapper"),i=e.find(".brtc-va-editors-sheet-controls-inputselector-item"),o=e.find(".brtc-style-controls-inputselector-box-key-wrapper"),n=e.find(".brtc-va-fnunit-input-empty");e.find(".brtc-va-tools-sidebar-variable-remove").hide(),o.hide(),i.hide(),n.show(),t.handleRemove($(this));}),e;},o.prototype.handleRemove=function(t){this.getMainArea(t).trigger("change",[this.getItems(t)]);},o.prototype.getPreviousFnUnits=function(t){var e=[],i=t.parent(),o=i.getPrevious(FnUnitUtils.getId(t));return _.forEach(o,function(t){e.push(i.getFnUnitById(t));}),e;},o.prototype.getMainArea=function(t){return t.closest(".brtc-va-editors-sheet-controls-input-list")||t;},o.prototype.getItems=function(t){var e=this.getMainArea(t).find(".brtc-style-controls-inputselector-box-wrapper"),i={};return _.forEach(e,function(t){var e=$(t),o=e.find(".brtc-va-editors-sheet-controls-inputselector-item"),n=e.attr("key"),r=o.is(":visible")?o.attr("table-id"):"";i[n]=r;}),i;},o.prototype.destroyDragEvent=function(t){t.on("dragstop",function(e,i){t.hasClass("ui-draggable")&&i.helper.attr("table-id")!==e.target.getAttribute("table-id")&&t.draggable("destroy");});};var n=new o();},function(t,e,i){"use strict";function o(){this.init();}i.d(e,"a",function(){return n;}),o.prototype.init=function(){this.board={};},o.prototype.add=function(t,e,i){this.board[t]={status:e,message:i};},o.prototype.remove=function(t){delete this.board[t];},o.prototype.get=function(t){return this.board[t];},o.prototype.refresh=function(){this.init();},o.prototype.show=function(t,e){this.get(t)&&e.attr("title",this.get(t).message);};var n=new o();},function(t,e,i){"use strict";i.d(e,"a",function(){return o;});var o={IN_DATA:"inData",OUT_DATA:"outData",INPUTS:"inputs",OUTPUTS:"outputs",FUNCTIONS:"functions",TYPE:"type",TITLE:"title",PARAMETER:"param",MODEL_ID:"mid",INNER_MODELS:"innerModels",PERSIST_MODE:"persist-mode",SOURCE_FID:"sourceFid",TARGET_FID:"targetFid",FUNCTION_NAME:"name",FONT_SIZES:["10","11","12","14","16","18","24","36","48","64"]};},function(t,e,i){"use strict";var o=i(64);i.d(e,"a",function(){return o.a;});},function(t,e,i){"use strict";i.d(e,"a",function(){return m;});var o=i(10),n=i(24),r=i(8),a=i(9),s=i(27),l=i(28),c=i(65),d=i(26),p=i.n(d),u=i(3);var h={},f=[o.c,o.a,o.d];_.forEach(f,function(t){h[t.prototype.getResourceName()]={_constructor:t};});var m=new(/*#__PURE__*/function(){function _class(){}var _proto=_class.prototype;_proto.exportProject=function exportProject(t){var _this2=this;return n.a.fetchProject(t).then(function(e){return n.a.fetchFiles(t).then(function(e){return _this2._collectResources(e,t,!0);}).then(function(t){return _this2._exportProjectFromResources(e,t);});}).catch(function(t){console.error(t);});};_proto._collectResources=function _collectResources(t,e,i){var _this3=this;var o=_.isArray(t)?t:[t];return Promise.all(_.map(o,function(t){return i?_this3._getDependentResources(t,e):[t];})).then(function(t){return _this3._makeUnique(_.flatten(t));}).then(function(t){return _this3._appendMissedFiles(t,e);});};_proto.exportJSON=function exportJSON(t,e,i){return n.a.fetchFile(e,t).then(_.bind(this._collectResources,this,_,e,i)).then(_.bind(this._exportFilesFromResources,this)).catch(console.error);};_proto.exportJSONs=function exportJSONs(t,e,i){return Promise.all(_.map(t,_.bind(this.exportJSON,this,_,e,i))).catch(console.error);};_proto._exportFilesFromResources=function _exportFilesFromResources(t,e){return new l.a(t).toJSON();};_proto._exportProjectFromResources=function _exportProjectFromResources(t,e){return new s.a(t,e).toJSON();};_proto._appendMissedFiles=function _appendMissedFiles(t,e){return this._getMissedFile(t,e).then(function(e){return t.concat(e);});};_proto._traverseParamFunctions=function _traverseParamFunctions(t,e){var _this4=this;_.forEach(t,function(t){t.param.functions&&_this4._traverseParamFunctions(t.param.functions,e),e(t);});};_proto._getDependentResources=function _getDependentResources(t,e){var i=t.getContents(),o=new r.a(),a=function a(t){return Promise.all(_.map(t.functions,function(t){if("Flow"===t[FUNCTION_NAME]){if(t.param.mid&&t.param.versionId){if(!o.has(t.param.versionId))return n.a.fetchVersion(e,t.param.mid,t.param.versionId).then(function(e){return o.set(t.param.versionId,e),s(e);}).catch(_.noop);}else if(t.param.mid&&!o.has(t.param.mid))return n.a.fetchFile(e,t.param.mid).then(function(e){return o.set(t.param.mid,e),s(e);}).catch(_.noop);}else if("loadFromStaging"===t.func&&t.param.modelId&&!o.has(t.param.model))return n.a.fetchFile(e,t.param.modelId).then(function(e){return o.set(t.param.modelId,e),s(e);}).catch(_.noop);var r=Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(i,t);return Promise.all(_.map(r,a));}));},s=function s(t){var e=t.getContents();return a(e);};return s(t).then(function(){return _.compact(o.toArray()).concat([t]);});};_proto._makeUnique=function _makeUnique(t){var e=new r.a();return _.forEach(t,function(t){e.set(t.getHashCode(),t);}),e.toArray();};_proto._getMissedFile=function _getMissedFile(t,e){var i=new r.a();_.forEach(t,function(t){t instanceof o.a&&i.set(t.getFileId(),t);});var a=new r.a();return _.forEach(t,function(t){t instanceof o.d&&!i.has(t.getFileId())&&!a.has(t.getFileId())&&a.set(t.getFileId(),t.getFileId());}),Promise.all(_.map(a.toArray(),function(t){return n.a.fetchFile(e,t);}));};_proto._jsons2resource=function _jsons2resource(t){return _.map(t,function(t){return new(0,h[t.type]._constructor)(t.data);});};_proto._importResources=function _importResources(t,e){this._changePrevKeys(t);var i=this._collectVersionId(t),r=this._collectModelId(t);this._remapProjectId(t,e),this._remapFileAndVersionId(t,r,i);var s=[],l=[];_.forEach(t,function(t){if(t instanceof o.c)throw new Error("unexpected data");t instanceof o.a&&s.push(function(){return n.a.addFile(e,t);}),t instanceof o.d&&(t.setIsManual(!0),l.push(function(){return n.a.addVersion(e,t.getFileId(),t);}));});var c=function c(t){return function(){return Object(a.a)(t);};};return Object(a.b)([c([]),c(s),c(l)]);};_proto.checkPreviousFileSpec=function checkPreviousFileSpec(t){var e=!0;return"project"===t.type&&(e=!1),_.has(t,"version")&&(e=!1),e;};_proto.importJSONs=function importJSONs(t,e){var _this5=this;return function(t){return Promise.all(_.map(t,function(t){return"files"!==t.type?_this5.checkPreviousFileSpec(t)?c.a.convertFilesSpec(t,t.version):Promise.reject(new Error("invalid export file spec")):t.version!==u.CORE_VERSION?c.a.convertFilesSpec(t,t.version):t;}));}(t).then(function(t){return _.map(t,function(t){return _this5._jsons2resource(t.data);});}).then(_.flatten).then(this._makeUnique.bind(this)).then(function(t){return _this5._importResources(t,e);});};_proto.importJSON=function importJSON(t,e){return this.importJSONs([t],e);};_proto._collectVersionId=function _collectVersionId(t){var e=new r.a();return _.forEach(t,function(t){t instanceof o.d&&(e.has(t.getVersionId())||e.set(t.getVersionId(),p.a.version.id()));}),e;};_proto._collectModelId=function _collectModelId(t){var e=new r.a(),i=function i(t){e.has(t)||e.set(t,p.a.model.id());};return _.forEach(t,function(t){(t instanceof o.a||t instanceof o.d)&&(i(t.getFileId()),_.forIn(t.getContents().functions,function(t){t.param&&t.param.modelId&&i(t.param.modelId);}),_.forIn(t.getContents().innerModels,function(t){i(t.mid);}));}),e;};_proto._remapProjectId=function _remapProjectId(t,e){_.forEach(t,function(t){t instanceof o.a&&t.setProjectId(e);});};_proto._remapFileAndVersionId=function _remapFileAndVersionId(t,e,i){var n=function n(t,o){_.forEach(o.functions,function(o){"Flow"===o[FUNCTION_NAME]&&(o.param.mid&&(o.param.mid=e.get(o.param.mid)||o.param.mid),o.param.versionId&&(o.param.versionId=i.get(o.param.versionId)||o.param.versionId)),"DataViewer"===o[FUNCTION_NAME]&&(o.param.mid=e.get(o.param.mid)),"If"===o[FUNCTION_NAME]&&(o.param.if.mid=e.get(o.param.if.mid)||o.param.if.mid,_.forEach(o.param.elseif,function(t){t.mid=e.get(t.mid)||t.mid;}),o.param.else.mid=e.get(o.param.else.mid)||o.param.else.mid),"ForLoop"!==o[FUNCTION_NAME]&&"WhileLoop"!==o[FUNCTION_NAME]||(o.param.mid=e.get(o.param.mid)||o.param.mid);var r=Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(t,o);_.forEach(r,_.partial(n,t,_));});};_.forEach(t,function(t){if(t instanceof o.a||t instanceof o.d){t.setFileId(e.get(t.getFileId())),t.getContents().mid=t.getFileId(),t instanceof o.d&&(t.setVersionId(i.get(t.getVersionId())),t.getContents().version_id=t.getVersionId()),t instanceof o.a&&"visual"===t.getType()&&_.forEach(t.getContents().functions,function(t){t.param.modelId&&(t.param.modelId=e.get(t.param.modelId));});var _r=t.getContents(),_a=_.reduce(_.map(_r.innerModels,function(t,i){var o={};return t.mid=e.get(i)||i,o[t.mid]=t,o;}),_.merge,{});_r.innerModels=_a,n(_r,_r);}});};_proto._changePrevKeys=function _changePrevKeys(t){var e={fidCache:{},tidCache:{}};_.forEach(t,function(t){if(t instanceof o.a||t instanceof o.d){var _i2=t.getContents();Brightics.VA.Core.Utils.ModelUtils.createCacheNestedFlow(_i2,_i2,e);}}),_.forEach(t,function(t){if(t instanceof o.a||t instanceof o.d){var _i3=t.getContents(),_o2=Brightics.VA.Core.Utils.ModelUtils.setKeyNestedFlow(_i3,_i3,e);t.setContents(_o2);}});};_proto.preprocessProjectJson=function preprocessProjectJson(t){return"project"===t.type&&t.version===u.CORE_VERSION?Promise.resolve(t):c.a.convertProjectSpec(t,t.version);};_proto.importProject=function importProject(t){return this.preprocessProjectJson(t).then(function(t){var _this6=this;var e=new o.c(t.data),i=p.a.project.id();e.setProjectId(i);var r=this._jsons2resource(t.children);return n.a.addProject(e).then(function(){return n.a.fetchProject(i);}).then(function(t){return _this6._importResources(r,i);}).then(function(){return i;}).catch(function(t){console.error(t);});}.bind(this));};_proto.validateExportedProjectSpec=function validateExportedProjectSpec(t){try{return this.preprocessProjectJson(t);}catch(t){return Promise.reject(t);}};_proto.duplicateFile=function duplicateFile(t,e,i,o,n,r){var _this7=this;return this.exportJSON(t,e,o).then(function(e){var o=_.cloneDeep(e);return function(e){e.data=_.map(e.data,function(e){return"file"===e.type&&e.data.id===t?e.data.label=r:e.data.label+="_"+n,e;});}(o),_this7.importJSON(o,i);}).catch(function(t){console.error(t);});};_proto.calcTableIdLinks=function calcTableIdLinks(t){var e=[],i=function i(t,o){_.forEach(o.functions,function(n){"DataViewer"===n[FUNCTION_NAME]&&_.forEach(n[OUT_DATA],function(t){e.push({source:["",Brightics.VA.Env.Session.userId,n.param.mid,n[OUT_DATA]].join("/"),alias:["",Brightics.VA.Env.Session.userId,o.mid,n[OUT_DATA]].join("/")});});var r=Brightics.VA.Core.Utils.NestedFlowUtils.getSubModels(t,n);_.forEach(r,_.partial(i,t,_));});};return _.forEach(t,function(t){if(t instanceof o.a||t instanceof o.d){var _e=t.getContents();i(_e,_e);}}),e;};return _class;}())();},function(t,e,i){"use strict";i.d(e,"a",function(){return a;});var o=i(10),n=i(28),r=i(27);var a=function(){var t=function t(_t3,e){var i=$.ajax({url:"api/va/v2/convert/store",type:"POST",data:JSON.stringify({contents:_t3,version:e}),contentType:"application/json; charset=utf-8"});return Promise.resolve(i).then(function(t){return t.contents;}).catch(function(e){throw e.responseJSON.errors[0].mid=_t3.mid,e;});},e=function e(t){return new o.a(t);},i=function i(t){return new o.d(t);};return{convertFilesSpec:function convertFilesSpec(r,a){var s=function s(t){return t.data.map(_.property("data"));},l=a?s(r).map(_.property("contents")):_.isArray(r)?r:[r];return Promise.all(_.map(l,function(e){return t(e,a);})).then(function(t){var l=a?function(t){return _.zip(s(r),t).map(function(_ref2){var t=_ref2[0],o=_ref2[1];return(o.version_id?i:e)(Object.assign({},t,{contents:o}));});}:function(t){return t.map(function(t){return(t.version_id?function(t){var e=new o.d().setVersionId(t.version_id).setFileId(t.mid).setLabel(t.title).setTags(t.versionTags).setDescription(t.versionDescription).setType(t.type).setMajorVersion(_.has(t,"majorVersion")?t.majorVersion:t.major_version).setMinorVersion(_.has(t,"minorVersion")?t.minorVersion:t.minor_version).setCreator(Brightics.VA.Env.Session.userId).setIsManual(!0);return e.setContents(_.omit(t,["versionId","versionTags","versionDescription","majorVersion","minorVersion"])),e;}:function(t){return new o.a().setFileId(t.mid).setLabel(t.title).setDescription("").setCreator(Brightics.VA.Env.Session.userId).setContents(t);})(t);});};return new n.a(l(t)).toJSON();});},convertProjectSpec:function convertProjectSpec(n,a){var _ref3=function(){if(!a){var _t4=function _t4(t){return _.merge({contents:{gv:[]}},t);};return[n[0].files.map(_t4),n[0].versions.map(_t4),new o.c(_.omit(n[0],["files","versions"]))];}var _$partition$map=_.partition(n.children,_.matchesProperty("type","file")).map(function(t){return t.map(_.property("data"));}),t=_$partition$map[0],e=_$partition$map[1];return[t,e,new o.c(n.data)];}(),s=_ref3[0],l=_ref3[1],c=_ref3[2],d=function d(e){return function(i){return(o=i,t(o.contents,a).then(function(t){return _.assign({},o,{contents:t});})).then(e);var o;};};return Promise.all([].concat(_.map(s,d(e)),_.map(l,d(i)))).then(function(t){return new r.a(c,t).toJSON();});}};}();},function(t,e,i){"use strict";i.d(e,"b",function(){return o;}),i.d(e,"d",function(){return r;}),i.d(e,"a",function(){return a;}),i.d(e,"c",function(){return s;});var o=function o(t,e){return e instanceof Array?function(t,e){try{for(var i=-1,o=e.length,n=t;++i<o;){n=n[e[i]];}return n;}catch(t){return;}}(t,e):t[e];},n=function n(t){return _.clone(t);},r=function r(t,e,i){for(var o=t,r=-1,a=e.length;++r<a-1;){o=o[e[r]];}var s=n(o[e[e.length-1]]);return o[e[e.length-1]]=n(i),s;},a=function a(t,e,i){for(var o=t,r=-1,a=e.length;++r<a-1;){o=o[e[r]];}Array.isArray(o)?o.splice(e[e.length-1],0,i):o[e[e.length-1]]=n(i);},s=function s(t,e){for(var i=t,o=-1,r=e.length;++o<r-1;){i=i[e[o]];}var a=n(i[e[e.length-1]]);return Array.isArray(i)?i.splice(e[e.length-1],1):delete i[e[e.length-1]],a;};},function(t,e,i){var o;o=function o(){var t="function",e="object",i="textContent",o="setAttribute",n="attrMap",r="isNode",a="isElement",s=typeof document===e?document:{},l=function l(t,e){return typeof t===e;},c=typeof Node===t?function(t){return t instanceof Node;}:function(t){return t&&l(t,e)&&"nodeType"in t&&l(t.ownerDocument,e);},d=function d(t){return t instanceof Array;},p=function p(t,e){d(e)?e.map(function(e){p(t,e);}):(u[r](e)||(e=s.createTextNode(e)),t.appendChild(e));};function u(){var c,h=arguments,f=h[0],m=h[1],g=2,v=h.length,b=u[n];if(f=u[a](f)?f:s.createElement(f),1===v)return f;if((!l(m,e)||u[r](m)||d(m))&&(--g,m=null),v-g==1&&l(h[g],"string")&&void 0!==f[i])f[i]=h[g];else for(;g<v;++g){if(null!=(c=h[g]))if(d(c))for(var y=0;y<c.length;++y){p(f,c[y]);}else p(f,c);}for(var C in m){if(b[C]){var x=b[C];typeof x===t?x(f,m[C]):f[o](x,m[C]);}else l(m[C],t)?f[C]=m[C]:f[o](C,m[C]);}return f;}return u[n]={},u[a]=function(t){return u[r](t)&&1===t.nodeType;},u[r]=c,"undefined"!=typeof Proxy&&(u.proxy=new Proxy(u,{get:function get(t,e){return!(e in u)&&(u[e]=u.bind(null,e)),u[e];}})),u;},t.exports=o();},function(t,e,i){"use strict";e.a=n;var o=i(1);function n(t){var e;this.ee=new o.a(),this.connectionKey=t,window.addEventListener("storage",(e=this.ee,function(t){var i=t.key,o=JSON.parse(t.newValue)||{};e.emit(i,o);}));}n.prototype.request=function(t,e,i){var o=this,n=(i||{}).timeout||5e3;return new Promise(function(i,r){var a=Date.now(),s="req_"+a,l=function l(e){e.connectionKey===o.connectionKey&&e.requestKey===s&&(i(e.value),o.off(t,l));};o.on(t,l),setTimeout(function(){r(new Error("TIMEOUT")),o.off(t,l);},n),o.emit(t,{timestamp:a,requestKey:"req_"+a,connectionKey:o.connectionKey,value:e,timeout:n});});},n.prototype.setConnectionKey=function(t){this.connectionKey=t;},n.prototype.getConnectionKey=function(){return this.connectionKey;},n.prototype.listen=function(t,e){var i=this;i.on(t,function(o){if(o.connectionKey===i.connectionKey){var n=Date.now();n-o.timestamp>=o.timeout||i.emit(t,_.assign({},o,{value:e(o),timestamp:n,responseKey:"res_"+n}));}});},n.prototype.on=function(t,e){this.ee.on("_TAB_CH_"+t,e);},n.prototype.off=function(t,e){this.ee.off("_TAB_CH_"+t,e);},n.prototype.emit=function(t,e){localStorage.setItem("_TAB_CH_"+t,JSON.stringify(e));};},function(t,e,i){"use strict";i.d(e,"a",function(){return o;});var o={integertype:{type:"number",internalType:"Integer"},longtype:{type:"number",internalType:"Long"},doubletype:{type:"number",internalType:"Double"},booleantype:{type:"string",internalType:"Boolean"},stringtype:{type:"string",internalType:"String"},"arraytype(doubletype)":{type:"number[]",internalType:"Double[]"},"arraytype(longtype)":{type:"number[]",internalType:"Long[]"},"arraytype(booleantype)":{type:"string[]",internalType:"Boolean[]"},"arraytype(stringtype)":{type:"string[]",internalType:"String[]"},"arraytype(bytetype)":{type:"byte[]",internalType:"Byte[]"},"arraytype(doubletype,true)":{type:"number[]",internalType:"Double[]"},"arraytype(longtype,true)":{type:"number[]",internalType:"Long[]"},"arraytype(stringtype,true)":{type:"string[]",internalType:"String[]"},"arraytype(bytetype,true)":{type:"byte[]",internalType:"Byte[]"},"maptype(integertype,doubletype)":{type:"map",internalType:"Map(Integer,Double)"},"maptype(stringtype,doubletype)":{type:"map",internalType:"Map(String,Double)"},"maptype(integertype,doubletype,true)":{type:"map",internalType:"Map(Integer,Double)"},"maptype(stringtype,doubletype,true)":{type:"map",internalType:"Map(String,Double)"},"maptype(stringtype,stringtype,true)":{type:"map",internalType:"Map(String,String)"},timestamptype:{type:"date",internalType:"Date"},timestamp:{type:"date",internalType:"Date"},date:{type:"date",internalType:"Date"},string:{type:"string",internalType:"String"},double:{type:"number",internalType:"Double"},boolean:{type:"string",internalType:"Boolean"},long:{type:"number",internalType:"Long"},int:{type:"number",internalType:"Integer"},integer:{type:"number",internalType:"Integer"},"array(string)":{type:"string[]",internalType:"String[]"},"array(double)":{type:"number[]",internalType:"Double[]"},"array(long)":{type:"number[]",internalType:"Long[]"},"array(int)":{type:"number[]",internalType:"Integer[]"},"array(integer)":{type:"number[]",internalType:"Integer[]"},"map(integer,double)":{type:"map",internalType:"Map(Integer,Double)"},"map(string,double)":{type:"map",internalType:"Map(String,Double)"},"map(int,double)":{type:"map",internalType:"Map(Integer,Double)"},tinyint:{type:"byte",internalType:"Byte"},float:{type:"number",internalType:"Float"},bigint:{type:"number",internalType:"Long"},smallint:{type:"short",internalType:"Short"},"array<string>":{type:"string[]",internalType:"String[]"},"array<double>":{type:"number[]",internalType:"Double[]"},"array<long>":{type:"number[]",internalType:"Long[]"},"array<int>":{type:"number[]",internalType:"Integer[]"},"array<integer>":{type:"number[]",internalType:"Integer[]"},"array<tinyint>":{type:"byte[]",internalType:"Byte[]"},"map<integer,double>":{type:"map",internalType:"Map(Integer,Double)"},"map<string,double>":{type:"map",internalType:"Map(String,Double)"},"map<int,double>":{type:"map",internalType:"Map(Integer,Double)"}};},function(t,e,i){"use strict";e.a=function(t,e){return r(a(t),a(e));};var o="__brtc__model__sync__";function n(t,e){var i={};return i[t]=e,i;}function r(t,e){var _ref4;if(t===e)return{};var i=_.isArray(t),a=_.isArray(e);if(i&&a)return function(t,e){var i=Math.max(t.length,e.length);return _.range(i).reduce(function(i,a){var _n2,_n3;if(!_.has(t,a))return _.merge(i,n(a,(_n2={},_n2[o]=!0,_n2.action="add",_n2.val=e[a],_n2)));if(!_.has(e,a))return _.merge(i,n(a,(_n3={},_n3[o]=!0,_n3.action="remove",_n3)));var s=r(t[a],e[a]);return _.isObject(s)&&_.isEmpty(s)?i:_.merge(i,n(a,s));},{});}(t,e);if(i||a||!_.isObject(t)||!_.isObject(e))return _ref4={},_ref4[o]=!0,_ref4.action="update",_ref4.val=e,_ref4;var s=_.union(_.keys(t),_.keys(e));return _.reduce(s,function(i,a){var _n4,_n5;if(!_.has(t,a))return _.merge(i,n(a,(_n4={},_n4[o]=!0,_n4.action="add",_n4.val=e[a],_n4)));if(!_.has(e,a))return _.merge(i,n(a,(_n5={},_n5[o]=!0,_n5.action="remove",_n5)));var s=r(t[a],e[a]);return _.isObject(s)&&_.isEmpty(s)?i:_.merge(i,n(a,s));},{});}function a(t){return _.reduce(t,function(t,e,i){return _.isFunction(e)?t:(t[i]=e,t);},{});}}]),function(){"use strict";var t=window.__module__;this.Brightics=this.Brightics||{};var e=this.Brightics,i=brtc_require("FnUnitUtils"),o=brtc_require("ENV");$.extend(!0,this.Brightics,{VA:{Core:{Interface:{Clazz:{},Label:{},Editor:{},ModelLayoutManager:{},Toolbar:{},SideBarManager:{},RightSideBarAdapter:{},LeftSideBarAdapter:{},Validator:{},Launcher:{},LauncherDialog:{},Functions:{},WidgetUtils:{},DefaultModel:{},ProjectContextMenuList:{},Clipboard:{},RunnableFactory:{},AddonFunctionUtil:{}},Components:{Base:{}},Controls:{},Default:{},Dialogs:{FunctionProperties:{},RefineSteps:{}},Editors:{Diagram:{Commands:{ControlEditor:{}}},Sheet:{Controls:{Optimization:{}},Commands:{},Panels:{Properties:{}}}},Functions:{Library:{}},Shapes:{},Tools:{MenuBar:{},Adapter:{},Manager:{},ModelMigrator:{Executor:{},RuleList:{}}},Utils:{},Views:{Pages:{}},Widget:{Controls:{}},Wizards:{Pages:{}},Validator:{},AddonFunctionManager:{}},Implementation:{},Window:{Utils:{}},Controls:t.Controls,Dao:t.Dao,DataStructures:t.DataStructures,Default:{},Dialogs:{},Setting:{Registry:{},Implement:{}},Env:{Session:{},Recommend:{}},Utils:{},Views:{},Workspace:{},Log:{},EventEmitter:t.EventEmitter,ClassUtils:t.ClassUtils,Vo:t.Vo},Admin:{},COMMUNITY:{}}),this.Brightics.VA.Core.Utils.IDGenerator=t.IDGenerator,this.Brightics.VA.Env.Theme="office",this.Brightics.VA.Env.CoreVersion=o.CORE_VERSION,this.Brightics.VA.Env.Diagram={PAPER_MARGIN_TOP:20,PAPER_MARGIN_LEFT:20,FIGURE_WIDTH:195,FIGURE_HEIGHT:60,GAP_WIDTH:55,GAP_HEIGHT:40},this.Brightics.VA.Env.DiagramInit={PAPER_MARGIN_TOP:20,PAPER_MARGIN_LEFT:20,FIGURE_WIDTH:195,FIGURE_HEIGHT:60,GAP_WIDTH:55,GAP_HEIGHT:20},this.Brightics.VA.Env.Multiplicity={Zero:"0",geZero:"0..*",One:"1",geOne:"1..*"},this.Brightics.VA.Env.Recommend.NextChart={load:["table","scatter"],associationRule:["table","network"],bigDataScatter:["scatter","table"],bigDataLine:["line","table"],bigDataBoxPlot:["boxplot","table"],bigDataColumn:["column","table"],bigDataBar:["bar","table"]},this.Brightics.VA.Env.Recommend.Next={data:{default:["load","createTable","brightics.function.io$load13889","brightics.function.io$read_csv97059"],mdReplaceNumber:["mdReplaceString","imputeNumberTypeFillColumn","numericalVariableDerivation"],mdReplaceString:["mdReplaceNumber","imputeStringTypeFillColumn"],numericalVariableDerivation:["conditionalUpdate","conditionalDerivation"],conditionalDerivation:["conditionalUpdate"],conditionFilter:["minmaxFilter","lengthFilter","stringFilter"],lengthFilter:["stringFilter","conditionFilter","minmaxFilter"],minmaxFilter:["conditionFilter","stringFilter","lengthFilter"],stringFilter:["lengthFilter","conditionFilter","minmaxFilter"],imputeNumberTypeFillColumn:["mdReplaceNumber","numericalVariableDerivation"],imputeRemoveLine:["mdReplaceNumber","mdReplaceString"],imputeStringTypeFillColumn:["mdReplaceString"],join:["imputeRemoveLine","imputeNumberTypeFillColumn","imputeStringTypeFillColumn"],changeColumnName:["capitalizeColName"],frequency:["join"],frequencyMat:["join"],statisticSummary:["join"],capitalizeColName:["changeColumnName"],linearRegressionTrain:["linearRegressionPredict"],linearRegressionPredict:["regressionEvaluation"],logisticRegressionTrain:["logisticRegressionPredict"],logisticRegressionPredict:["binaryClassEvaluation"],movingAverage:["ewma"],pivot:["imputeRemoveLine","imputeNumberTypeFillColumn","imputeStringTypeFillColumn"],hierarchicalClustering:["hierarchicalClusteringPostProcess"],timeSeriesTranspose:["timeSeriesDistance"],quantileDiscretizer:["typeCast"],reorganizeTable:["changeColumnName","capitalizeColName"]},realtime:{default:["streamingRead"]},etl:{default:["erdTSum","fabData","ept"]},deeplearning:{default:["dlLoad","conv2D","maxPooling2D"]},getList:function getList(t,e){return this[e||"data"][t]||[];}},this.Brightics.VA.Env.Tags={data:["Trend","Timeseries","Transform","Sort","Preprocessing","Add Column","Filter","Remove","Missing Value","Statistics","Prescriptive"],realtime:["I/O","Clustering","Filter","Preprocessing","Prescriptive","Trend","Transform"],etl:[]},this.Brightics.VA.Default.model={addProblems:function addProblems(t){t&&this.problemList.indexOf(t)<0&&(this.problemList=this.problemList.concat(t));},getProblemsByFid:function getProblemsByFid(t){var e=[];for(var i in this.problemList){this.problemList[i]&&this.problemList[i].fid===t&&e.push(this.problemList[i]);}return e;},getProblemsByMid:function getProblemsByMid(t){var e=[];for(var i in this.problemList){this.problemList[i]&&this.problemList[i].mid===t&&e.push(this.problemList[i]);}return e;},newFnUnit:function newFnUnit(t){var o=e.VA.Core.Utils.WidgetUtils.getFunctionLibrary(this.type,t),n={fid:e.VA.Core.Utils.IDGenerator.func.id()};if("ifElse"===t)n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{functions:[{fid:e.VA.Core.Utils.IDGenerator.func.id()},{fid:e.VA.Core.Utils.IDGenerator.func.id()}]}};else if("outData"===t){var r=e.VA.Core.Utils.IDGenerator.func.id(),a=e.VA.Core.Utils.IDGenerator.func.id(),s="/brtc/repo/tmp/"+e.VA.Core.Utils.IDGenerator.file.id();n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{functions:[{fid:r,param:{"fs-paths":[s]}},{fid:a,param:{"input-path":s,"output-path":s+".csv"}}],links:[{kid:e.VA.Core.Utils.IDGenerator.link.id(),sourceFid:r,targetFid:a}]}};}else"refine"===t?n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{functions:[{fid:e.VA.Core.Utils.IDGenerator.func.id()}]}}:"dbReader"===t?n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{functions:[{fid:e.VA.Core.Utils.IDGenerator.func.id()}]}}:"load"===t?n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{functions:[{fid:e.VA.Core.Utils.IDGenerator.func.id()}]}}:"Subflow"===o.defaultFnUnit[FUNCTION_NAME]?n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{functions:[{fid:e.VA.Core.Utils.IDGenerator.func.id()}]}}:"if"===t?n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{if:$.extend(!0,o.defaultFnUnit.param.if,{mid:e.VA.Core.Utils.IDGenerator.model.id()}),elseif:[],else:$.extend(!0,o.defaultFnUnit.param.else,{mid:e.VA.Core.Utils.IDGenerator.model.id()})}}:"forLoop"===t?n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{mid:e.VA.Core.Utils.IDGenerator.model.id(),type:"count",prop:{start:"${=}",end:"${=}","index-variable":""}}}:"whileLoop"===t&&(n={fid:e.VA.Core.Utils.IDGenerator.func.id(),param:{mid:e.VA.Core.Utils.IDGenerator.model.id(),type:"while",prop:{expression:"${=}","index-variable":""}}});if(o.defaultFnUnit.outputs||o.defaultFnUnit.outData){var l=i.createOutData(this.type,t);$.extend(n,l),"refine"===t?(n.param.functions[0][OUT_DATA]=n[OUT_DATA],n.param.entries=[n.param.functions[0].fid]):"dbReader"===t?(n.param.functions[0][OUT_DATA]=n[OUT_DATA],n.param.functions[0].param={"df-names":[n[OUT_DATA][0]]}):"load"===t?(n.param.functions[0][OUT_DATA]=n[OUT_DATA],n.param.functions[0].param={"df-names":[n[OUT_DATA][0]]},n.param.entries=[n.param.functions[0].fid]):"Subflow"===o.defaultFnUnit[FUNCTION_NAME]&&(n.param.functions[0][OUT_DATA]=n[OUT_DATA],n.param.entries=[n.param.functions[0].fid]);}return $.extend(!0,{"persist-mode":"auto"},o.defaultFnUnit,n);},addFnUnit:function addFnUnit(t,e){var i=this;t.parent=function(){return i;},void 0!==e&&e>-1?i.functions.splice(e,0,t):i.functions.push(t);},removeFnUnit:function removeFnUnit(t){var e=-1;for(var i in this.functions){var o=this.functions[i];if(o.fid==t){e=i,delete o.parent;break;}}if(e>-1){var n=this.functions[e];return this.functions.splice(e,1),n;}},getFnUnitById:function getFnUnitById(t){for(var e in this.functions){var i=this.functions[e];if(i.fid==t)return i;}},getFnUnitNameById:function getFnUnitNameById(t,e){e=e||this.functions;for(var i in e){var o=e[i];if(o.param&&o.param.functions){var n=this.getFnUnitNameById(t,o.param.functions);if(n)return o.func+"."+n;}if(o.fid==t)return o.func;}},existsFnUnit:function existsFnUnit(t){for(var e in this.functions){var i=this.functions[e];if(i.fid==t)return i;if("Subflow"==i[FUNCTION_NAME])for(var o in i.param.functions){if(i.param.functions[o].fid==t)return i;}}},getFnUnitByOutTable:function getFnUnitByOutTable(t){for(var e in this.functions){var o=this.functions[e],n=i.getOutTable(o);if($.inArray(t,n)>-1)return o;}},getFnUnitByOutData:function getFnUnitByOutData(t){for(var e in this.functions){var o=this.functions[e],n=i.getOutData(o);if($.inArray(t,n)>-1)return o;}},getLinkUnitById:function getLinkUnitById(t){for(var e in this.links){var i=this.links[e];if(i.kid==t)return i;}},getRoots:function getRoots(t){var e=[],i=this.getPrevious(t);if(0==i.length)e.push(t);else for(var o in i){e=e.concat(this.getRoots(i[o]));}return e;},getParents:function getParents(t){var e=[];for(var i in this.links){var o=this.links[i];o[TARGET_FID]==t&&(e.push(o[SOURCE_FID]),e=e.concat(this.getParents(o[SOURCE_FID])));}return e;},getPrevious:function getPrevious(t){var e=[];for(var i in this.links){var o=this.links[i];o[TARGET_FID]==t&&e.push(o[SOURCE_FID]);}return e;},getPreFnUnitByCondition:function getPreFnUnitByCondition(t,e){var i=this.getPrevious(t);for(var o in i){var n=this.getFnUnitById(i[o]);if(e(n))return n;}},getNext:function getNext(t){var e=[];for(var i in this.links){var o=this.links[i];o[SOURCE_FID]==t&&e.push(o[TARGET_FID]);}return e;},getLeafs:function getLeafs(){var t=[];for(var e in this.functions){var i=this.functions[e];0===this.getNext(i.fid).length&&t.push(i.fid);}return t;},getConnectedLinkUnits:function getConnectedLinkUnits(t){var e=[];for(var i in this.links){var o=this.links[i];o[SOURCE_FID]!=t&&o[TARGET_FID]!=t||e.push(o);}return e;},getParamValue:function getParamValue(t,e){return this.getFnUnitById(t).param[e];},adjustLinks:function adjustLinks(){var t,e=[];for(t in this.functions){this.functions[t]&&e.push(this.functions[t].fid);}var i=[];for(t in this.links){var o=this.links[t];(e.indexOf(o[SOURCE_FID]||o["source-fid"])<0||e.indexOf(o[TARGET_FID]||o["target-fid"])<0)&&i.push(o);}for(t in i){this.links.splice(this.links.indexOf(i[t]),1);}},getAllPreviousFnUnitIds:function getAllPreviousFnUnitIds(t){var i=this.getPrevious(t),o=this;return _.unique(i.reduce(function(t,i){var n=o.getFnUnitById(i);if(e.VA.Core.Utils.NestedFlowUtils.isProcessFunction(n)){var r=o.getAllPreviousFnUnitIds(i);return t.concat(r);}return t.concat(i);},[]));},getAllNextFnUnitIds:function getAllNextFnUnitIds(t){var i=this.getNext(t),o=this;return _.unique(i.reduce(function(t,i){var n=o.getFnUnitById(i);if(e.VA.Core.Utils.NestedFlowUtils.isProcessFunction(n)){var r=o.getAllNextFnUnitIds(i);return t.concat(r);}return t.concat(i);},[]));},getAllPreviousFnUnits:function getAllPreviousFnUnits(t){var e=this;return this.getAllPreviousFnUnitIds(t).map(function(t){return e.getFnUnitById(t);});},getAllNextFnUnits:function getAllNextFnUnits(t){var e=this;return this.getAllNextFnUnitIds(t).map(function(t){return e.getFnUnitById(t);});},getLinkSourceFnUnits:function getLinkSourceFnUnits(t){var i=this,o=this.getFnUnitById(t);if(e.VA.Core.Utils.NestedFlowUtils.isProcessFunction(o)){var n=this.getPrevious(t);return _.unique(n.reduce(function(t,e){return t.concat(i.getLinkSourceFnUnits(e));},[o]),"fid");}return[o];},getLinkTargetFnUnits:function getLinkTargetFnUnits(t){var i=this,o=this.getFnUnitById(t);if(e.VA.Core.Utils.NestedFlowUtils.isProcessFunction(o)){var n=this.getNext(t);return _.unique(n.reduce(function(t,e){return t.concat(i.getLinkTargetFnUnits(e));},[o]),"fid");}return[o];}},this.Brightics.VA.Default.analyticsModel={type:"data",sheets:[],param:{},functions:[],links:[],preferences:{},problemList:[],report:{title:"Report",data:[]},inVariableList:function inVariableList(t){return _.findIndex(this.variableRef,function(e){return e.fid===t;});},getVariable:function getVariable(t,e){var i=this.inVariableList(t);if(i>-1)return this.variableRef[i].param[e];},getVariables:function getVariables(t){var e=this.inVariableList(t);if(e>-1)return this.variableRef[e].param;},getParameters:function getParameters(){return this.param;},getParameter:function getParameter(t){return this.param[t];},setParameter:function setParameter(t,e){this.param[t]=e;},addVariableDef:function addVariableDef(t,e){this.variables[t]=$.extend({},e);},removeVariableDef:function removeVariableDef(t){delete this.variables[t];},setVariableDef:function setVariableDef(t,e){this.variables[t]&&(this.variables[t]=$.extend({},e));},addVariable:function addVariable(t,e,i){var o=this.inVariableList(t);if(o>-1)this.variableRef[o].param[e]=i;else{var n={fid:t,param:{}};n.param[e]=i,this.variableRef.push(n);}},setVariable:function setVariable(t,e,i){var o=this.inVariableList(t);o>-1&&this.variableRef[o].param[e]&&(this.variableRef[o].param[e]=i);},removeVariable:function removeVariable(t,e){var i=this.inVariableList(t);i>-1&&(delete this.variableRef[i].param[e],0===Object.keys(this.variableRef[i].param).length&&this.variableRef.splice(i,1));}},this.Brightics.VA.Utils.CookieUtil={setCookie:function setCookie(t,e,i){var o="";if(i){var n=new Date();n.setTime(n.getTime()+24*i*60*60*1e3),o="expires="+n.toUTCString();}document.cookie=t+"="+e+"; "+o;},getCookie:function getCookie(t){for(var e=t+"=",i=document.cookie.split(";"),o=0;o<i.length;o++){for(var n=i[o];" "==n.charAt(0);){n=n.substring(1);}if(0==n.indexOf(e))return n.substring(e.length,n.length);}}},this.Brightics.VA.Env.SQLFunctions=["ROUND()","MAX()","MIN()","SUM()","AVG()","OVER()","NVL()","CONCAT()","LPAD()","LTRIM()","RPAD()","RTRIM()","SUBSTR()","SUBSTRING()","FROM_UNIXTIME()","YEAR()","MONTH()","WEEKOFYEAR()"],this.Brightics.VA.Env.PersistFalseFunctions=[];}.call(this),function(){"use strict";var t=this.Brightics;var e={trace:0,debug:1,info:2,warn:3,error:4};function i(t){this.funcName=t;}i.prototype.sendLog=function(i,o,n){var r=$.extend(!0,{funcNm:this.funcName,level:i||"error",message:o},n),a={url:"api/va/log4js",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(r)},s=t.VA.Env.Session.logLevel.toLowerCase();e[s]<=e[i]&&$.ajax(a);},i.prototype.trace=function(t,e){this.sendLog("trace",t,e),console.log("["+this.funcName+"] TRACE: "+t);},i.prototype.debug=function(t,e){this.sendLog("debug",t,e),console.log("["+this.funcName+"] DEBUG: "+t);},i.prototype.info=function(t,e){this.sendLog("info",t,e),console.log("["+this.funcName+"] INFO: "+t);},i.prototype.warn=function(t,e){this.sendLog("warn",t,e),console.log("["+this.funcName+"] WRAN: "+t);},i.prototype.error=function(t,e){this.sendLog("error",t,e),console.log("["+this.funcName+"] ERROR: "+t);},t.VA.Log=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.event={source:t,type:""},this.options=e&&$.extend({undoable:!0},e)||{undoable:!0},this.old={},this.FnUnitUtils=brtc_require("FnUnitUtils");}e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){},e.prototype.undo=function(){},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.command";},e.prototype.getLabel=function(){return this.options.label||"";},e.prototype.getMainModel=function(){return this.options.mainModel;},e.prototype.getTargetModel=function(){return this.options.analyticsModel;},t.VA.Core.Command=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.type=this.options.type||"none-interval",this.commandList=this.commandList||[];}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.add=function(e){e instanceof t.VA.Core.Command?(this.commandList.push(e),$.extend(!0,this.options,e.options)):_.isArray(e)&&_.forEach(e,function(e){e instanceof t.VA.Core.Command&&(this.commandList.push(e),$.extend(!0,this.options,e.options));}.bind(this));},e.prototype.canUndo=function(){return!(void 0===this.commandList||0===this.commandList.length);},e.prototype.canRedo=function(){return!(void 0===this.commandList||0===this.commandList.length);},e.prototype.execute=function(){var t=this;if("interval"===this.options.type){var e=this.commandList.length-1;this.commandList[e].options.type=this.options.type,this.commandList[e].options.analyticsModel=this.options.analyticsModel,this.commandList[e].options.mainModel=this.options.mainModel,this.commandList[e].execute();}else $.each(this.commandList,function(e,i){i.event.type=t.event.type,i.options.type=t.options.type,i.options.analyticsModel=t.options.analyticsModel,i.options.mainModel=t.options.mainModel,i.execute();});},e.prototype.undo=function(){if("interval"===this.options.type)this.commandList[0].options.type=this.options.type,this.commandList[0].undo();else for(var t=this.commandList.length-1;t>=0;t--){var e=this.commandList[t];e.event.type=this.event.type,e.options.type=this.options.type,e.undo();}},e.prototype.redo=function(){var t=this;if("interval"===this.options.type){var e=this.commandList.length-1;this.commandList[e].options.type=this.options.type,this.commandList[e].redo();}else $.each(this.commandList,function(e,i){i.event.type=t.event.type,i.options.type=t.options.type,i.redo();});},e.prototype.getId=function(){return this.options.id?this.options.id:this.commandList[0].getId();},e.prototype.getLabel=function(){return this.options.label?this.options.label:this.commandList[0].getLabel();},t.VA.Core.CompoundCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=new t.VA.Log("CommandManager"),i=brtc_require("modelDiff");function o(t,e){this.index=-1,this.stack=[],this.listeners=[],this.historyListener=[],this.isExecuting=!1,this.analyticsModel=t||{},this.interval=1e3,this.init(e);}o.prototype.init=function(t){t&&(this.editor=t,this.mainModel=t.getModel());},o.prototype.canUndo=function(e){return!this.isExecuting&&(void 0===e&&(e=this.stack[this.index]),e instanceof t.VA.Core.Command&&-1!==this.index&&e.canUndo());},o.prototype.canRedo=function(e){return!this.isExecuting&&(void 0===e&&(e=this.stack[this.index+1]),e instanceof t.VA.Core.Command&&this.index+1<this.stack.length&&e.canRedo());},o.prototype.notifyListeners=function(t,e){for(var _i4=0;_i4<this.listeners.length;_i4++){try{this.listeners[_i4](t,e);}catch(t){throw t;}}},o.prototype.registerCallback=function(t){"function"==typeof t&&this.listeners.push(t);},o.prototype.registerCallbackLeft=function(t){"function"==typeof t&&this.listeners.splice(0,0,t);},o.prototype.unRegisterCallback=function(t){if("function"==typeof t){var e=this.listeners.indexOf(t);e>-1&&this.listeners.splice(e,1);}},o.prototype.execute=function(t){if(t)return this._execute(t);},o.prototype.setActiveModel=function(t){var e=this.editor.getActiveModel();t.options.analyticsModel=e||this.analyticsModel;},o.prototype._execute=function(i){try{return e.trace("Execute Command START..."),i.event.type="EXECUTE",this.setActiveModel(i),i.options.mainModel=this.mainModel,this.check(),"data"==i.options.mainModel.type&&(i.options.editorContext={mid:this.editor.getActiveModel().mid,fnUnit:this.editor.getActiveFnUnit()}),!1!==i.execute()&&i.options.undoable?(this.index+1!==this.stack.length&&this.stack.splice(this.index+1,this.stack.length-this.index-1),this.stack.push(i),this.index++,this.notifyListeners(i,this.getModelDiff()),e.debug("Command Executed: '"+this._getCommandName(i)+"'"),e.trace("Execute Command END..."),!0):!1;}catch(o){e.error("Failed to execute command: "+this._getCommandName(i)),e.error(JSON.stringify(i.options)),e.error(o.stack);return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Failed to save last operation. Back up the data from the last operation, then reopen the editor and try again."),!1;}},o.prototype.undo=function(t){var e=this.stack[this.index],i=!!t||_.isUndefined(t);return this.canUndo(e)&&(e.event.type="UNDO",i&&this.check(),e.undo(),this.index--,i&&this.notifyListeners(e,this.getModelDiff())),e;},o.prototype.redo=function(t){var e=this.stack[this.index+1],i=!!t||_.isUndefined(t);return this.canRedo(e)&&(e.event.type="REDO",i&&this.check(),e.redo(),this.index++,i&&this.notifyListeners(e,this.getModelDiff())),e;},o.prototype.getStacks=function(){return this.stack;},o.prototype.go=function(e){var i=[];if(this.check(),parseInt(e.index)<this.index)for(var o=this.index;o>parseInt(e.index);o--){i.push(this.undo(!1)),o===parseInt(e.index+1)&&this.notifyRefresh(new t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand(this.stack[e.index]?{options:this.stack[e.index].options,commands:i}:{options:{},commands:i}),this.getModelDiff());}else if(parseInt(e.index)>this.index)for(var n=this.index;n<parseInt(e.index);n++){i.push(this.redo(!1)),n+1===parseInt(e.index)&&this.notifyRefresh(new t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand(this.stack[e.index]?{options:this.stack[e.index].options,commands:i}:{options:{},commands:i}),this.getModelDiff());}},o.prototype.notifyRefresh=function(t,e){for(var i=0;i<this.historyListener.length;i++){this.historyListener[i](t,e);}},o.prototype.registerGoHistoryCallback=function(t){"function"==typeof t&&this.historyListener.push(t);},o.prototype.registerGoHistoryCallbackLeft=function(t){"function"==typeof t&&this.historyListener.splice(0,0,t);},o.prototype.unRegisterGoHistoryCallback=function(t){if("function"==typeof t){var e=this.historyListener.indexOf(t);e>-1&&this.historyListener.splice(e,1);}},o.prototype._getCommandName=function(e){var i=e.getId()||e.constructor.name;return e instanceof t.VA.Core.CompoundCommand&&e.commandList.forEach(function(t){i+=t.getId()||t.constructor.name+" ";}),i||"";},o.prototype.getIndex=function(){return this.index;},o.prototype.check=function(){this.clonedModel=_.cloneDeep(this.mainModel);},o.prototype.getModelDiff=function(){var t=i(this.clonedModel,this.mainModel);return this.clonedModel=null,t;},t.VA.Core.CommandManager=o;}.call(this),function(){"use strict";var t=this.Brightics;var e="status",i="success",o="abort",n="fail",r="catch",a="ready",s="pending";function l(t){this.eventTypes=[e,i,o,n,r,a,s],this.initListeners(),this.setListeners(t||{});}l.prototype.initListeners=function(){this.listeners={},this.eventTypes.forEach(function(t){this.listeners[t]=[];}.bind(this));},l.prototype.setListeners=function(t){this.eventTypes.forEach(function(e){var i=t[e],o=this.listeners[e];i&&($.isArray(i)?i.forEach(function(t){"function"==typeof t&&o.push(t);}):"function"==typeof i&&o.push(i));}.bind(this));},l.prototype.getProcessingUnit=function(t){return t&&(this.processingUnit=t),this;},l.prototype._fire=function(t,e,i){this.listeners[t].forEach(function(t){"function"==typeof t&&t(e,i);});},l.prototype._fireStatus=function(t,i){this._fire(e,t,i);},l.prototype._fireSuccess=function(t,e){this._fire(i,t,e);},l.prototype._fireFail=function(t,e){this._fire(n,t,e);},l.prototype._fireAbort=function(t,e){this._fire(o,t,e);},l.prototype._fireCatch=function(t,e){this._fire(r,t,e);},l.prototype._firePending=function(t,e){this._fire(s,t,e);},t.VA.Core.JobDelegator=l;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.JobDelegator.call(this,e),this.runnable=null,this._abort=!1;}e.prototype=Object.create(t.VA.Core.JobDelegator.prototype),e.prototype.constructor=e,e.prototype._start=function(t){var e={url:"api/va/v2/analytics/jobs",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1,data:JSON.stringify(t)};return $.ajax(e);},e.prototype._stop=function(t){var e={url:"api/va/v2/analytics/jobs/"+this.runnable.jid+"/delete",type:"POST",blocking:!1,contentType:"application/json; charset=utf-8"};if(t){var i={type:t};e.data=JSON.stringify(i);}return $.ajax(e);},e.prototype._check=function(t){var e={url:"api/va/v2/analytics/jobs/"+t,type:"GET",blocking:!1};return $.ajax(e);},e.prototype._scheduleCheckStatus=function(t){var e=this,i=function i(){e._check(t).done(function(t){e._abort?e._fireAbort({jobId:e.runnable.jid,end:Date.now(),status:"ABORT",message:"Job aborted by user"}):"FAIL"===t.status?e._fireFail(t):"SUCCESS"===t.status?e._fireSuccess(t):"WAIT"===t.status?(e._firePending(t),setTimeout(i,500)):(e._fireStatus(t),setTimeout(i,500));}).fail(e._fireCatch.bind(e));};setTimeout(i,500);},e.prototype.start=function(t){var e=this;this.runnable=t,this._start(t).done(function(){e._scheduleCheckStatus(t.jid);}).fail(e._fireCatch.bind(e));},e.prototype.stop=function(t){this._stop(t),this._abort=!0;},t.VA.Core.Job=e;}.call(this),function(){"use strict";var t=this.Brightics;brtc_require("FnUnitUtils");function e(){this.jobScheduler={};}e.prototype._generateJobId=function(t){return"va_"+t+"_"+moment(Date.now()).format("YYYYMMDDHHmmssSSS");},e.prototype.launchUnit=function(t,e,i,o){console.error("must implement Function launchUnit");},e.prototype.launchModel=function(t,e,i,o){console.error("must implement Function launchModel");},e.prototype._launch=function(t,e,i,o){console.error("must implement Function _launch");},e.prototype._extendListeners=function(t,e){var i=t;for(var o in e){var n=e[o];n&&($.isArray(n)?n.forEach(function(t){i[o]||(i[o]=[]),i[o].push(t);}):"function"==typeof n&&(i[o]||(i[o]=[]),i[o].push(n)));}},e.prototype.terminate=function(t){var e=this.jobScheduler[t];e&&(e.stop(),delete this.jobScheduler[t]);},e.prototype._getPendingMessage=function(t){return t.pendingStatus||"Pending";},e.prototype._getProcessingMessage=function(e){var i=["BR-0021","BR-0022","BR-0023","BR-0024","BR-0025","BR-0026"];if(e.errorInfo){var o=this._getFailedFuncId(e),n=[];for(var r in e.errorInfo){var a=e.errorInfo[r];if(a.errorCode){var s=Studio.getEditorContainer().getActiveModelEditor().getModel().getFnUnitNameById(o),l=t.VA.Core.Utils.MessageUtils.getFunctionLabels(s,e.errorInfo[r].parameter);if(n.push(t.VA.Core.Utils.MessageUtils.getMessage(e.errorInfo[r].errorCode,l)),e.errorInfo[r].detailMessage&&n.push(e.errorInfo[r].detailMessage),$.inArray(e.errorInfo[r].errorCode,i)>-1){var c=[];return c.push(t.VA.Core.Utils.MessageUtils.getMessage(e.errorInfo[r].errorCode,l)),c.join("\n");}}else a.message&&n.push(a.message);}return n.join("\n");}return e.message||"";},e.prototype._getProcessingDetailMessage=function(t){if(t.errorInfo){var e=[];for(var i in t.errorInfo){var o=t.errorInfo[i];o.detailMessage&&e.push(o.detailMessage);}return e.join("\n");}return t.detailMessage||"";},e.prototype._getFailedFuncId=function(t){var e=t.processes;for(var i in e){var o=e[i].functions;for(var n in o){if("FAIL"===o[n].status)return o[n].fid;}}},e.prototype._fireEvents=function(t){var e={"BEGIN-JOB":0,"PENDING-JOB":1,"BEGIN-PROCESS":2,"BEGIN-UNIT":3,"END-UNIT":4,"END-PROCESS":5,"END-JOB":6};for(var i in t.sort(function(t,i){var o=e[t.eventType]-e[i.eventType];return 0==o?t.begin-i.begin:o;}),t){Studio.getInstance().fireDebugEvent(t[i]);}},t.VA.Core.ModelLauncher=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");function i(){this.jobScheduler={},this.createControls();}i.prototype.createControls=function(){for(var e in this.launchers={},t.VA.Core.Interface.Launcher){this.launchers[e]=new t.VA.Core.Interface.Launcher[e]();}},i.prototype.terminate=function(t,e){if(e&&this.launchers[e])this.launchers[e].terminate(t);else for(var i in this.launchers){this.launchers[i].terminate(t);}},i.prototype.prepareLaunch=function(){Studio.getEditorContainer().getActiveModelEditor().prepareLaunch();},i.prototype.launchModel=function(e,i,o,n){try{var r={catch:[function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);}]};this._extendListeners(r,n),this.launchers[e.type].launchModel(e,i,o,n);}catch(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog("Cannot execute the flow. It contains invalid contents.");}},i.prototype.launchUnit=function(i,o,n,r){var a=i.parent().getMainModel(),s=this,l=(o=o||{},n=n||{},a.type),c=e.getOutTable(i);for(var d in c){t.VA.Core.DataQueryTemplate.removeCache(a.mid,c[d]);}var p=/\$\{=(?:[a-zA-z_])(?:[a-zA-Z0-9_]*)\}/,u=/"(\\[\s\S]|[^"])*"|'(\\[\s\S]|[^'])*'|(--.*|\/\/.*|\/\*[\s\S]*?\*\/)/gm,h=!1;for(var f in i.param){var m=("string"==typeof i.param[f]?i.param[f]:JSON.stringify(i.param[f])).replace(u,function(t,e,i,o){return e?t:i?t:o?"":void 0;}),g=p.exec(m);if(g&&g.length>0&&-1===["${=true}","${=false}"].indexOf(g[0])){h=!0;break;}}var v={catch:[function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);}]};this._extendListeners(v,r);var b=function b(t){var e=t?t.args:o;s.launchers[l].launchUnit(i,e,n,v);},y={close:function close(t){t.OK&&b(t);},analyticsModel:a};if(!h&&a.variableRef&&a.variableRef.length)for(var C in a.variableRef){var x=a.variableRef[C].fid;if(x===i.fid){h=!0;break;}if("Subflow"===i[FUNCTION_NAME])for(var A in i.param.functions){if(x===i.param.functions[A].fid){h=!0;break;}}if(h)break;}if(h){var $=Studio.getEditorContainer().getActiveModelEditor().getMainArea();if(a.variables&&Object.keys(a.variables).length>0){if("realtime"===l){if("true"===t.VA.SettingStorage.getValue("editor.variable.visible"))new t.VA.Core.Dialogs.RunRealTimeDialog($,y);else{var w={};for(var f in a.variables){D=(I=a.variables[f]).type.indexOf("array")>-1&&1==I.value.length?I.value[0]:I.value,_.isUndefined(D)||(w[f]=I.value);}b({OK:!0,args:w});}}else if("etl"===l)new t.VA.Implementation.ETLFlow.Dialogs.LaunchProgressDialog($,y);else if("true"===t.VA.SettingStorage.getValue("editor.variable.visible"))new t.VA.Core.Dialogs.RunDataDialog($,y);else{w={};for(var f in a.variables){var D,I=a.variables[f];D=_.isArray(I.value)&&1===I.value.length?I.value[0]:I.value,_.isUndefined(D)||(w[f]=I.value);}b({OK:!0,args:w});}}else setTimeout(function(){t.VA.Core.Utils.WidgetUtils.openErrorDialog("Variables are required to run the function.");},100);}else b();},i.prototype.stopCheckModel=function(){this.launchers.deeplearning.stopCheckModel();},i.prototype._extendListeners=function(t,e){var i=t;for(var o in e){var n=e[o];n&&($.isArray(n)?n.forEach(function(t){i[o]||(i[o]=[]),i[o].push(t);}):"function"==typeof n&&(i[o]||(i[o]=[]),i[o].push(n)));}},t.VA.Core.ModelLauncherManager=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){for(var e in this.cache={},this.labelMap={},this.subflowMap={},this.launchOptions=t,this.launchOptions.originalModels){var i=this.launchOptions.originalModels[e];this.labelMap[i.mid]=i.title,this._scanFunctions(i.mid,i);}}e.prototype._scanFunctions=function(t,e,i){for(var o in e.functions){var n=e.functions[o],r=t+"_"+n.fid;if(this.labelMap[r]=n.display.label,"Subflow"==n[FUNCTION_NAME]&&n.param.functions.length>0){var a={fid:n.fid,first:n.param.functions[0].fid,last:n.param.functions[n.param.functions.length-1].fid};for(var s in n.param.functions){var l=n.param.functions[s];this.subflowMap[t+"_"+l.fid]=a;}}else n.param.functions&&this._scanFunctions(t,n.param,n.fid);}},e.prototype.createUnitEvent=function(t,e,i,o){var n,r=[];return(n=this._createUnitStartEvent(t,e,i,o))&&r.push(n),(n=this._createUnitEndEvent(t,e,i,o))&&r.push(n),r;},e.prototype._createUnitStartEvent=function(t,e,i,o){if(this.cache[t]&&!(i.fid.indexOf("internal_function")>-1)){var n,r=i.fid,a=this.subflowMap[e+"_"+i.fid];if(n=a?r=a.fid:r+"@"+o,"WAIT"!==i.status&&!this.cache[t][n]){var s={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:r,status:"PROCESSING",label:this.labelMap[e+"_"+r],begin:i.begin,message:i.message,sequence:o};return i.fid.indexOf("read_alluxio_pagination")>-1?s.label="(read)":i.fid.indexOf("write_alluxio_pagination")>-1&&(s.label="(write)"),this.cache[t][n]={event:s},s;}if(this.cache[t][n]&&(this.cache[t][n].event.begin!=i.begin||"SUCCESS"==this.cache[t][n].event.status)){s={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:r,status:"PROCESSING",label:this.labelMap[e+"_"+r],begin:i.begin,message:i.message,sequence:o};return i.fid.indexOf("read_alluxio_pagination")>-1?s.label="(read)":i.fid.indexOf("write_alluxio_pagination")>-1&&(s.label="(write)"),this.cache[t][n]={event:s},s;}if(this.cache[t][n]&&(this.cache[t][n].event.begin!=i.begin||"PROCESSING"==this.cache[t][n].event.status)){s={eventType:"UPDATE-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:r,status:"PROCESSING",label:this.labelMap[e+"_"+r],begin:i.begin,message:i.message,sequence:o};return i.fid.indexOf("read_alluxio_pagination")>-1?s.label="(read)":i.fid.indexOf("write_alluxio_pagination")>-1&&(s.label="(write)"),this.cache[t][n]={event:s},s;}if(this.cache[t][n]&&(this.cache[t][n].event.begin!=i.begin||"SUCCESS"==this.cache[t][n].event.status)){s={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:r,status:"PROCESSING",label:this.labelMap[e+"_"+r],begin:i.begin,sequence:o};return i.fid.indexOf("read_alluxio_pagination")>-1?s.label="(read)":i.fid.indexOf("write_alluxio_pagination")>-1&&(s.label="(write)"),this.cache[t][n]={event:s},s;}if(this.cache[t][n]&&(this.cache[t][n].event.begin!=i.begin||"SUCCESS"==this.cache[t][n].event.status)){s={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:r,status:"PROCESSING",label:this.labelMap[e+"_"+r],begin:i.begin,sequence:o};return i.fid.indexOf("read_alluxio_pagination")>-1?s.label="(read)":i.fid.indexOf("write_alluxio_pagination")>-1&&(s.label="(write)"),this.cache[t][n]={event:s},s;}}},e.prototype._createUnitEndEvent=function(t,e,i,o){var n,r=i.fid,a=this.subflowMap[e+"_"+i.fid];if(n=a?r=a.fid:r+"@"+o,this.cache[t]&&this.cache[t][n]&&"PROCESSING"==this.cache[t][n].event.status&&this.cache[t][n].event.status!=i.status)return this.cache[t][n].event.status=i.status,{eventType:"END-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:r,status:i.status,label:this.labelMap[e+"_"+r],begin:i.begin,end:i.end,message:i.message,sequence:o};},e.prototype.createProcessEvent=function(t,e,i,o,n,r){var a,s=[];return(a=this._createProcessStartEvent(t,e,i,r,n))&&s.push(a),(a=this._createProcessEndEvent(t,e,i,o,n))&&s.push(a),s;},e.prototype._createProcessStartEvent=function(t,e,i,o,n){if(!(e.indexOf("internal_process")>-1||this.cache[t]&&this.cache[t].begin===i&&"0"==o)){var r={eventType:"BEGIN-PROCESS",launchOptions:this.launchOptions,pid:t,mid:e,label:this.labelMap[e],status:n,begin:i,count:1};return this.cache[t]={mid:r.mid,status:r.status,begin:r.begin},r;}},e.prototype._createProcessEndEvent=function(t,e,i,o,n){if(this.cache[t]&&this.cache[t].begin===i&&this.cache[t].status!==n)return{eventType:"END-PROCESS",launchOptions:this.launchOptions,pid:t,mid:e,label:this.labelMap[e],status:n,begin:i,end:o};},t.VA.Core.EventDetector=e;}.call(this),function(){"use strict";this.Brightics.VA.Core.Functions.Library={getListByTags:function getListByTags(t){var e=[];for(var i in this){var o=!1,n=this[i].tags;if(n)$.grep(n,function(e){var i=!1;for(var o in t){e.toLowerCase().indexOf(t[o].toLowerCase())>-1&&(i=!0);}return i;}).length>0&&(o=!0,e.push(i));if(!o&&this[i]&&this[i].defaultFnUnit&&this[i].defaultFnUnit.display&&this[i].defaultFnUnit.display.label){var r=this[i].defaultFnUnit.display.label;for(var a in t){if(r.toLowerCase().indexOf(t[a].toLowerCase())>-1){e.push(i);break;}}}}return e;},getFunction:function getFunction(t){return $.extend(!0,{},this[t]);},extendFunctions:function extendFunctions(t){for(var e={},i={},o=0;o<t.length;o++){i[t[o]]=this[t[o]],$.extend(!0,e,i);}return e;},addFunction:function addFunction(t,e){this[t]=e;},getFunctionViewer:function getFunctionViewer(t,e){var i=[];return Brightics.VA.Core.Functions.Viewer[t]?i=Brightics.VA.Core.Functions.Viewer[t][e]:i.push("data"),i;}};}.call(this),function(){"use strict";this.Brightics.VA.Core.Functions.Viewer={kmeans2:{in:["data"],out:["data","model","image"]},sort:{in:["data","model"],out:["data","model","image","html"]},load:{out:["data"]},load2:{out:["model"]}};}.call(this),function(){"use strict";this.Brightics.OptFunctions={ALSRecommend:{optSelected:"true",optParam:{"topn-number":{min:1,max:5,value:3,type:"DISCRETE_RANGE",optParamSelected:"true"}}},AutoFeatureSelection:{optSelected:"true",optParam:{"max-num-features":{min:1,max:5,value:3,type:"DISCRETE_RANGE",optParamSelected:"true"}}},AutoRandomForestTrainForClassification:{optSelected:"true",optParam:{"max-bins":{set:[2,4,8,32,128],value:32,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"max-depth":{set:[1,5,10,30],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"min-info-gain":{min:0,max:1,value:0,type:"CONTINUOUS",optParamSelected:"true"},"min-instances-per-node":{set:[1,3,5,7,10],value:1,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-folds":{set:[3,5,9],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-trees":{set:[20,50,100],value:50,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"sub-sampling-rate":{min:.01,max:1,value:1,type:"CONTINUOUS",optParamSelected:"true"},"train-ratio":{min:0,max:1,value:.75,type:"CONTINUOUS",optParamSelected:"true"}}},AutoRandomForestTrainForRegression:{optSelected:"true",optParam:{"max-bins":{set:[2,4,8,32,128],value:32,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"max-depth":{set:[1,5,10,30],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"min-info-gain":{min:0,max:1,value:0,type:"CONTINUOUS",optParamSelected:"true"},"min-instances-per-node":{set:[1,3,5,7,10],value:1,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-folds":{set:[3,5,9],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-trees":{set:[20,50,100],value:50,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"sub-sampling-rate":{min:.01,max:1,value:1,type:"CONTINUOUS",optParamSelected:"true"},"train-ratio":{min:0,max:1,value:.75,type:"CONTINUOUS",optParamSelected:"true"}}},ArimaTrain:{optSelected:"true",optParam:{p:{min:0,max:5,value:1,type:"DISCRETE_RANGE",optParamSelected:"true"},d:{min:0,max:2,value:0,type:"DISCRETE_RANGE",optParamSelected:"true"},q:{min:0,max:5,value:1,type:"DISCRETE_RANGE",optParamSelected:"true"}}},ARX:{optSelected:"true",optParam:{xMaxLag:{min:0,max:5,value:1,type:"DISCRETE_RANGE",optParamSelected:"true"},yMaxLag:{min:0,max:5,value:1,type:"DISCRETE_RANGE",optParamSelected:"true"}}},Binarizer:{optSelected:"true",optParam:{Threshold:{min:-10,max:10,value:0,type:"CONTINUOUS",optParamSelected:"true"}}},ChiSqSelection:{optSelected:"true",optParam:{numFolds:{set:[3,5,9],value:9,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},trainRatio:{min:0,max:1,value:.75,type:"CONTINUOUS",optParamSelected:"true"}}},DecisionTreeTrain:{optSelected:"true",optParam:{"max-bins":{set:[2,4,8,32,128],value:32,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"max-depth":{set:[1,5,10,30],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"}}},Ewma:{optSelected:"true",optParam:{number:{set:[2,4,6,8,10],value:4,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},ratio:{min:.1,max:.9,value:.5,type:"CONTINUOUS",optParamSelected:"true"}}},HoltWintersTrain:{optSelected:"true",optParam:{period:{set:[4,5,7,30,52,168],value:4,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"model-type":{set:["additive","multiplicative"],type:"DISCRETE_SET_STRING",optParamSelected:"true"}}},GaussianMixtureTrain:{optSelected:"true",optParam:{"num-clusters":{min:1,max:5,value:3,type:"DISCRETE_RANGE",optParamSelected:"true"}}},IndependentFilter:{optSelected:"true",optParam:{threshold:{min:0,max:10,value:1e-6,type:"CONTINUOUS",optParamSelected:"true"}}},KMeans:{optSelected:"true",optParam:{clusters:{set:[2,3,4,5,8,10],value:3,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"}}},LinearRegressionTrain:{optSelected:"true",optParam:{regularization:{min:0,max:1,value:.01,type:"CONTINUOUS",optParamSelected:"true"},types:{min:0,max:1,value:0,type:"CONTINUOUS",optParamSelected:"true"}}},LogisticRegressionTrain:{optSelected:"true",optParam:{regularization:{min:0,max:1,value:.01,type:"CONTINUOUS",optParamSelected:"true"},types:{min:0,max:1,value:0,type:"CONTINUOUS",optParamSelected:"true"}}},MahalanobisDistanceOutlierDetection:{optSelected:"true",optParam:{"sampling-rate":{min:0,max:1,value:1,type:"CONTINUOUS",optParamSelected:"true"}}},MovingAverage:{optSelected:"true",optParam:{number:{set:[3,5,7,11,20],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"}}},NaiveBayesTrain:{optSelected:"true",optParam:{lambda:{min:0,max:10,value:1,type:"CONTINUOUS",optParamSelected:"true"}}},NGram:{optSelected:"true",optParam:{number:{min:1,max:8,value:3,type:"DISCRETE_RANGE",optParamSelected:"true"}}},OneVsRestLRClassifierTrain:{optSelected:"true",optParam:{"reg-param":{min:0,max:1,value:.01,type:"CONTINUOUS",optParamSelected:"true"}}},OutlierRemoval:{optSelected:"true",optParam:{method:{set:["carling","tuckey"],type:"DISCRETE_SET_STRING",optParamSelected:"true"},multiplier:{min:.1,max:3,type:"CONTINUOUS",optParamSelected:"true"}}},PolynomialRegressionTrain:{optSelected:"true",optParam:{regularization:{min:0,max:1,value:.01,type:"CONTINUOUS",optParamSelected:"true"},types:{min:0,max:1,value:0,type:"CONTINUOUS",optParamSelected:"true"}}},PowerIterationClustering:{optSelected:"true",optParam:{"n-clusters":{set:[2,3,4,5,8,10],value:3,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"}}},RandomForestClassificationTrain:{optSelected:"true",optParam:{"max-bins":{set:[2,4,8,32,128],value:32,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"max-depth":{set:[1,5,10,30],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"min-info-gain":{min:0,max:1,value:0,type:"CONTINUOUS",optParamSelected:"true"},"min-instances-per-node":{set:[1,3,5,7,10],value:1,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-folds":{set:[3,5,9],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-trees":{set:[20,50,100],value:50,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"sub-sampling-rate":{min:.01,max:1,value:1,type:"CONTINUOUS",optParamSelected:"true"},"train-ratio":{min:0,max:1,value:.75,type:"CONTINUOUS",optParamSelected:"true"}}},RandomForestRegressionTrain:{optSelected:"true",optParam:{"max-bins":{set:[2,4,8,32,128],value:32,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"max-depth":{set:[1,5,10,30],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"min-info-gain":{min:0,max:1,value:0,type:"CONTINUOUS",optParamSelected:"true"},"min-instances-per-node":{set:[1,5,10],value:1,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-folds":{set:[3,5,9],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-trees":{set:[20,50,100],value:50,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"sub-sampling-rate":{min:.01,max:1,value:1,type:"CONTINUOUS",optParamSelected:"true"},"train-ratio":{min:0,max:1,value:.75,type:"CONTINUOUS",optParamSelected:"true"}}},RandomForestTrain:{optSelected:"true",optParam:{"num-classes":{set:[2,4,16],value:2,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"num-trees":{set:[3,15,30],value:3,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"max-depth":{set:[5,10,20],value:5,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"max-bins":{set:[2,4,8,32,128],value:32,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"}}},TimeSeriesDecomposition:{optSelected:"true",optParam:{period:{set:[4,5,7,30,52,168],value:4,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},"model-type":{set:["additive","multiplicative"],type:"DISCRETE_SET_STRING",optParamSelected:"true"}}},"brightics.function.regression$xgb_regression_train":{optSelected:"true",optParam:{max_depth:{set:[3,5,10],value:3,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},n_estimators:{set:[50,100,200],value:100,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"}}},"brightics.function.classification$xgb_classification_train":{optSelected:"true",optParam:{max_depth:{set:[3,5,10],value:3,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"},n_estimators:{set:[50,100,200],value:100,type:"DISCRETE_SET_INTEGER",optParamSelected:"true"}}}};}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.DataQueryTemplate={schemaCache:{},cache:{},requested:{},addCache:function addCache(t,e,i){var o=t+"_"+e;this.schemaCache[o]=i;},removeCache:function removeCache(t,e){if(e){var i=t+"_"+e;delete this.cache[i],delete this.schemaCache[i];}else{var o=[];for(var n in this.cache){0==n.indexOf(t+"_")&&o.push(n);}for(var r in o){delete this.cache[o[r]];}for(var n in o=[],this.schemaCache){0==n.indexOf(t+"_")&&o.push(n);}for(var r in o){delete this.schemaCache[o[r]];}}},isCached:function isCached(t,e){var i=t+"_"+e;return this.cache[i];},clearCache:function clearCache(){this.cache={},this.schemaCache={};},queryTable:function queryTable(t,e,i,o,n,r){var a=t+"_"+e;r=r||{};!0!==n&&this.cache[a]?i(this.cache[a],e):r.publish?(r.destination="publish",this.queryData(t,e,r.offset||0,r.limit||1e3,i,o,r)):this.queryData(t,e,r.offset||0,r.limit||1e3,i,o,r);},queryTableForReport:function queryTableForReport(t,e,i,o,n){var r=t+"_"+e;!0!==n&&this.cache[r]?i(this.cache[r],e):this.queryData(t,e,0,1e3,i,o,"/report");},fetchMore:function fetchMore(t,e,i,o,n){var r=1e3,a=t+"_"+e;r=this.cache[a]&&this.cache[a].columns&&this.cache[a].data?this.cache[a].data.length+i:i,this.queryData(t,e,0,r,o,n);},queryData:function queryData(e,i,o,n,r,a,s){var l=this,c=e+"_"+i,d=s||{};this.requested[c]||(this.requested[c]=[]),this.requested[c].push({done:r,fail:a});var p=d.user||t.VA.Env.Session.userId,u=(d.destination||"api/va/v2/data")+"/staging/query?user="+p+"&mid="+e+"&tab="+i+"&offset="+o+"&limit="+n;$.get(u).done(function(t){l.addCache(e,i,t),l.requested[c].shift().done(t,i);}).fail(function(t){l.removeCache(e,i);l.requested[c].shift().fail({columns:[],data:[],count:0},i,t);});},getSchemaAsync:function getSchemaAsync(e,i,o,n,r){var a=this,s=(r||{}).user||t.VA.Env.Session.userId,l="api/va/v2/data/staging/query?"+t.VA.Core.Utils.CommonUtils.getQueryString({user:s,mid:e,tab:i,offset:0,limit:1});$.get(l).done(function(t){return a.addCache(e,i,t),o(t.columns);}).fail(function(t){return a.removeCache(e,i),n([],i,t);});},getSchema:function getSchema(t,e){var i=t+"_"+e;return this.schemaCache[i]&&void 0!==e?this.schemaCache[i].columns:void 0;},querySchema:function querySchema(t,e,i,o,n){this.queryTable(t,e,i,o,n);},getSchemaFromData:function getSchemaFromData(t,e){return console.warn("This method is deprecated"),this.getData(t,e);},getData:function getData(t,e){var i=t+"_"+e;return this.schemaCache[i]&&void 0!==e?this.schemaCache[i].data:void 0;},getTable:function getTable(t,e){var i=t+"_"+e;return this.schemaCache[i]&&void 0!==e?this.schemaCache[i]:void 0;}};}.call(this),function(){"use strict";this.Brightics.VA.RepositoryQueryTemplate={pathCache:{},schemaCache:{},getFiles:function getFiles(t){return this.pathCache[t];},getColumns:function getColumns(t){return this.schemaCache[t];},browse:function browse(t,e,i){var o=this,n={url:"api/va/v2/data/browse",type:"GET",blocking:!1,contentType:"application/json; charset=utf-8"};return $.extend(!0,n,i),$.ajax(n).done(function(e){o.pathCache[t]=e.sort(function(t,e){return t.path.localeCompare(e.path);});});},schema:function schema(t,e,i){var o=this,n={url:"api/va/v2/data/schema?key="+t+"&rescan="+(e||!0),type:"GET",blocking:!1,contentType:"application/json; charset=utf-8"};return $.extend(!0,n,i),$.ajax(n).done(function(e){o.schemaCache[t]=e.columns;});},move:function move(t,e,i){var o={url:"api/va/v2/data/move",type:"POST",blocking:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify({source:t,destination:e})};return $.extend(!0,o,i),$.ajax(o);},copy:function copy(t,e,i){var o={url:"api/va/v2/data/copy",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0,data:JSON.stringify({source:t,destination:e})};return $.extend(!0,o,i),$.ajax(o);},delete:function _delete(t,e){var i={url:"api/va/v2/data/delete",type:"POST",blocking:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify({path:t})};return $.extend(!0,i,e),$.ajax(i);}};}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.GarbageCollector={list:{},clearAlluxio:function clearAlluxio(){for(var e in this.list){var i={url:this.list[e],type:"POST",contentType:"application/json; charset=utf-8",blocking:!1,data:JSON.stringify({user:t.VA.Env.Session.userId})};$.ajax(i).done(function(t){}).fail(function(t){});}this.clearList();},addList:function addList(t,e){var i=t+"_"+e,o=this.getPath(t,e);this.list[i]=o;},removeList:function removeList(t,e){var i=t+"_"+e;delete this.list[i];},clearList:function clearList(){this.list={};},getPath:function getPath(t,e){return"api/v1/repo/alluxio/functions/"+t+"/"+e+"/destroy";},immediatelyClearData:function immediatelyClearData(e,i){var o={user:t.VA.Env.Session.userId};if(e&&e.length>0)for(var n in o.mids={},e){i&&i.length>0?o.mids[e[n]]=i:o.mids[e[n]]=[];}var r={url:"api/va/v2/datasources/staging/remove",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1,data:JSON.stringify(o)};$.ajax(r).done(function(t){}).fail(function(t){});}};}.call(this),function(){"use strict";var t=this.Brightics;function e(){}t.VA.ClassUtils.inherits(e,t.VA.EventEmitter),e.prototype.registerEditorTab=function(t){this.editorTab=t;},e.prototype.registerProjectViewer=function(t){this.projectViewer=t;},e.prototype.initLayout=function(){this.editorTab.hideNewEditorButton(),this.editorTab.unselectAll(),this.projectViewer.show();},e.prototype.openEditor=function(t){this.projectViewer.hide(),this.editorTab.showNewEditorButton(),this.editorTab.openTab(t)&&(Studio.getEditorContainer().openEditor(t),Studio.getClipboardManager().setEditorType(t.getType()));},e.prototype.closeEditor=function(t){var e=this.editorTab.closeTab(t);Studio.getEditorContainer().closeEditor(t),e&&Studio.getEditorContainer().openEditor(e);},e.prototype.showProjectViewer=function(){this.editorTab.hideNewEditorButton(),this.editorTab.unselectAll(),this.projectViewer.fillProjectList(),this.projectViewer.show();},e.prototype.refreshProjectViewer=function(){this.projectViewer.fillProjectList();},e.prototype.showProjectViewerPopup=function(){this.projectViewer.showPopup();},e.prototype.hideProjectViewer=function(){this.projectViewer.hide();},e.prototype.handleProjectDelete=function(t){var e=Studio.getEditorContainer().findEditorsByProjectId(t.getProjectId());for(var i in e){this.closeEditor(e[i].options.editorInput);}},e.prototype.handleProjectChange=function(t){var e=Studio.getEditorContainer().findEditorsByProjectId(t.getProjectId());for(var i in e){e[i].getModelLayoutManager().refreshModelInfo();}},e.prototype.handleFileDelete=function(t){var e=Studio.getEditorContainer().findEditorById(t.getProjectId(),t.getFileId());e&&this.closeEditor(e.options.editorInput);},e.prototype.handleFileChange=function(t){var e=Studio.getEditorContainer().findEditorById(t.getProjectId(),t.getFileId());e&&(e.options.editorInput=t,this.editorTab.updateTab(e.options.editorInput),e.getModelLayoutManager().refreshModelInfo());},"undefined"!=typeof module&&(module.exports=e),"undefined"!=typeof window&&(t.VA.LayoutManager=e);}.call(this),function(){"use strict";var t=this.Brightics;function e(){for(var e in this._functionInterfaceMap={},t.VA.Core.Interface.Functions){this._functionInterfaceMap[e]=t.VA.Core.Interface.Functions[e];}}e.prototype.init=function(t){var e=this,i=!1;$.ajax({url:"api/va/v3/ws/udfs",type:"GET",blocking:!1}).done(function(o){var n,r=o;for(var a in r){(n=r[a]).modelType||"data",e._addFunction(n);}i&&t&&t(),i=!0;});$.ajax({url:"api/va/v3/ws/functions",type:"GET",blocking:!1}).done(function(o){var n,r=o;for(var a in r){(n={}).id=r[a].func,n.modelType="data",n.contents=r[a],e._addFunction(n);}i&&t&&t(),i=!0;});},e.prototype._addFunction=function(e){var i=e.modelType||"data";this._functionInterfaceMap[i]&&t.VA.Core.Interface.AddonFunctionUtil[i]&&t.VA.Core.Interface.AddonFunctionUtil[i].addFunction(e);},t.VA.Core.AddonFunctionManager=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils"),i={destroyOnClose:!1,position:{my:"center",at:"center",of:window},appendTo:"body",modal:!0,resizable:!1,draggable:!0,width:600,height:500,maxWidth:600,maxHeight:500};function o(t,i){this.parentId=t,this.options=i,this.destroyOnClose=!1!==this.options.destroyOnClose,this.dialogResult={OK:!1,Cancel:!0},this.FnUnitUtils=e,this.retrieveParent(),this._initOptions(),this.createControls(),this.setAttrName(),this.initContents(),this.bindEventHandler();}o.prototype._initOptions=function(){this.dialogOptions=$.extend(!0,{},i,this.options);},o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},o.prototype.getTitle=function(){return this.dialogOptions.title;},o.prototype.getPosition=function(){return this.dialogOptions.position;},o.prototype.setAttrName=function(){this.$mainControl.attr("name",this.getTitle());},o.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">       </div>   </div></div>');},o.prototype.initContents=function(){this.$mainControl.dialog(this.dialogOptions),this.createDialogButtonBar(this.$mainControl.find(".brtc-va-dialogs-buttonbar")),this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.dialogOptions.title||this.$parent.find(".ui-dialog-titlebar.ui-widget-header").attr("style","border-bottom: none !important;");},o.prototype.bindEventHandler=function(){var t=this;this.$mainControl.on("dialogclose",function(e){e.stopPropagation(),"function"==typeof t.options.close&&t.options.close(t.dialogResult),!1!==t.destroyOnClose&&t.destroy();});},o.prototype._setStopPropagationHandler=function(){this.$mainControl.closest(".ui-dialog").on("click",function(t){t.stopPropagation();}),this.$mainControl.closest(".ui-dialog").on("mousedown",function(t){t.stopPropagation();}),this.dialogOptions.modal&&$(".ui-widget-overlay").on("click",function(t){t.stopPropagation();});},o.prototype.setFocus=function(){this.$mainControl.focus();},o.prototype.close=function(){this.$mainControl&&this.$mainControl.dialog("isOpen")&&this.$mainControl.dialog("close");},o.prototype.open=function(){this.$mainControl&&this.$mainControl.dialog("open");},o.prototype.createDialogButtonBar=function(e){this.$okButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />'),e.append(this.$okButton),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.handleOkClicked.bind(this)),this.$cancelButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />'),e.append(this.$cancelButton),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme}),this.$cancelButton.click(this.handleCancelClicked.bind(this));},o.prototype.destroy=function(){this.$mainControl.dialog("destroy"),this.$mainControl=void 0;},o.prototype.createDialogContentsArea=function(t){},o.prototype.handleOkClicked=function(){void 0!==this.$mainControl&&(this.dialogResult.OK=!0,this.dialogResult.Cancel=!1,this.$mainControl.dialog("close"));},o.prototype.handleCancelClicked=function(){this.dialogResult.OK=!1,this.dialogResult.Cancel=!0,this.$mainControl.dialog("close");},o.prototype.createEmptyControl=function(t){this.$mainControl.empty(),this.$mainControl.css({"text-align":"center","line-height":this.dialogOptions.height-this.getHeaderHeight()+"px"}).text(t);},o.prototype.getHeader=function(){return this.$parent.find(".ui-dialog-titlebar.ui-widget-header");},o.prototype.getHeaderHeight=function(){return 60;},o.prototype._configureDialogOption=function(t){return $.extend(!0,this.dialogOptions,t);},o.prototype.setStyle=function(t){this.$mainControl.css(t);},o.prototype.modifyCloseButton=function(t,e){var i=this.getHeader();i.find("button.ui-dialog-titlebar-close").hide(),i.append(t),i.click(e);},t.VA.Dialogs.Dialog=o;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t){this.editorInput=t,this.reportData=t.getContents().report.data||[];}function i(t,e){return t+"-"+e;}function o(t){var e="Title",i=t.title.fnUnitLabel;return null!=i&&(e="["+i+"] "),void 0!==t.title.panelTitle&&(e+=t.title.panelTitle),e;}function n(t){this.$controlArea=t;}e.prototype.addReportData=function(t){var e=this;return new Promise(function(i,o){if(function(t){return t.options.id&&t.options.chartOption&&t.data.mid&&t.data.table;}(t)){var n=e.reportData.push(e.formattedData(t));e.editorInput.getContents().report={data:e.reportData},i(n-1);}else o("Data are not correct");});},e.prototype.openDialog=function(e,i){var o=this;e.dialog({theme:t.VA.Env.Theme,width:950,maxWidth:950,minWidth:950,height:800,minHeight:400,maxHeight:1200,modal:!0,resizable:!1,open:function open(){o.initReportViewer(e),o.render();},keyboardCloseKey:""}),this.$reportWindow.on("close",function(){i(),e.dialog("destroy");});},e.prototype.formattedData=function(t){return{id:t.options.id+"-"+t.options.chartOption.chart.type,type:"Chart",originData:t};},e.prototype.removeReportData=function(t,e){var o=i(t,e);for(var n in this.reportData){if(this.reportData[n].id===o)return void this.removeReportDataByIndex(n);}},e.prototype.initReportViewer=function(t){this.$reportWindow=t,this.initReportWindowToolbar(),this.initReportWindowBody();},e.prototype.initReportWindowToolbar=function(){var t=this;this.$reportWindowBody=this.$reportWindow.find(".brtc-va-editors-modeleditor-report-window-body");var e=$('<div class="brtc-va-editors-modeleditor-report-window-head-tools-container"></div>');this.$reportWindowBody.prepend(e);var i=$('<div class="brtc-va-editors-modeleditor-report-window-head-tools brtc-va-editors-modeleditor-report-window-head-tools-share fa fa-share-alt" title="Publish"></div>'),o=$('<div class="brtc-va-editors-modeleditor-report-window-head-tools brtc-va-editors-modeleditor-report-window-head-tools-add" title="Click to add text"></div>'),n=$('<div class="brtc-va-editors-modeleditor-report-window-head-tools brtc-va-editors-modeleditor-report-window-head-tools-report-all" title="Download Report Image"></div>'),r=$('<div class="brtc-va-editors-modeleditor-report-window-head-tools brtc-va-editors-modeleditor-report-window-head-tools-report-each" title="Download Report Each Element Image"></div>');e.append(n),e.append(r),e.append(o),e.append(i),n.on("click",function(){t.downloadAll();}),r.on("click",function(){t.downloadEachAll();}),i.on("click",function(){t.publishReport();}),o.on("click",function(){t.addReportTextBox();});},e.prototype.publishReport=function(){var e=this;if(this.editorInput.getContents().report.id)this.showPublishInfo();else{this.editorInput.getContents().report.id=t.VA.Core.Utils.IDGenerator.report.id(60);var i={url:"/report",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({reportId:this.editorInput.getContents().report.id,userId:t.VA.Env.Session.userId,modelId:this.editorInput.id,projectId:this.editorInput.getProjectId()})};$.ajax(i).done(function(){e.showPublishInfo();});}},e.prototype.showPublishInfo=function(){var e=this;$.ajax({url:"/report/publishsite",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(i){var o={title:"Publish Information"};o.window={theme:t.VA.Env.Theme,width:"600px",height:"150px",maxWidth:"600px",maxHeight:"150px",modal:!0,resizable:!1,cancelButton:e.$cancelButton,open:function open(){e.createDialogContentsArea($(this.element).find(".brtc-va-dialogs-contents"),i);}},new t.VA.Core.Dialogs.Dialog(e.$reportWindowBody,o);});},e.prototype.createDialogContentsArea=function(e,i){var o="http://"+i.ip+":"+i.port+"/report?report="+this.editorInput.getContents().report.id;e.append('<div style="width:100%">   <div style="width:10%;float: left">url: </div>   <div style="width:70%;float: left"><input class="brtc-va-widget-contents-input-control" value="'+o+'" readonly></div>   <div style="width:20%;float: left;display: flex;justify-content: center;"><button class="brtc-va-copy-clipboard-button" type="button"">Copy</button></div></div>');var n=e.find(".brtc-va-copy-clipboard-button");n.jqxButton({theme:t.VA.Env.Theme}),n.on("click",function(){window.prompt("Copy to clipboard: Ctrl+C",o);});},e.prototype.initReportWindowBody=function(){this.$reportWindowBody.perfectScrollbar(),this.$reportContentsArea=$('<div class="brtc-va-editors-modeleditor-report-contents-area"></div>'),this.$reportContainer=this.$reportWindow.find(".brtc-va-editors-modeleditor-report-element-container"),this.$reportContainer.append(this.$reportContentsArea),this.pageHandler=new n(this.$reportContentsArea),this.$processingWindow=$('<div><div>Processing ...</div><div><div class="brtc-va-progress"><div><span class="brtc-va-progress-loading"></div></div></div>'),this.$reportContainer.append(this.$processingWindow),$(this.$processingWindow).dialog({width:300,height:200,theme:t.VA.Env.Theme,showCloseButton:!1,autoOpen:!1,modal:!0,resizable:!1,keyboardCloseKey:""});},e.prototype.addReportTextBox=function(){var e=this.reportData.push({id:t.VA.Core.Utils.IDGenerator.report.id()+"-Text",type:"Text",originData:""});this.renderIndexData(e-1);},e.prototype.render=function(){var t=this;$(this.$reportWindow).on("open",function(){t.showProcessingWindow();}),this.clearReport(),this.setReportContentsAreaSize();var e=[];for(var i in e.push(new Promise(function(e,i){$(t.$processingWindow).on("open",function(){e();});})),this.reportData){var o=this.renderIndexData(i);e.push(o);}Promise.all(e).then(function(){t.hideProcessingWindow(),t.convertReportLayout();},function(e){t.hideProcessingWindow();});},e.prototype.renderIndexData=function(t){if(this.reportData[t]){var e=this.renderReportElementBox(this.reportData[t],t);return this.attachReportElementBoxHeaderItems(this.reportData[t],e.elementBox),e.promise;}},e.prototype.clearReport=function(){this.$reportContentsArea.empty();},e.prototype.setReportContentsAreaSize=function(){var t=this.reportData,e=0;this.relativeContentsIndexList=[];for(var i=0;i<t.length;i++){t[i].position?e=Math.max(e,t[i].position.top+t[i].size.height+5):this.relativeContentsIndexList.push(i);}var o=300*this.relativeContentsIndexList.length;this.$reportContentsArea.css("height",e+o);},e.prototype.containsData=function(t,e){var o=i(t,e);for(var n in this.reportData){if(this.reportData[n].id===o)return!0;}return!1;},e.prototype.renderReportElementBox=function(t,e){return"Chart"===t.type?this.renderReportChartBox(t,e):"Text"===t.type?this.renderReportTextBox(t,e):void 0;},e.prototype.renderReportChartBox=function(e,i){var n=$('<div class="brtc-va-editors-modeleditor-report-element" content-type="'+e.type+'">   <div class="brtc-va-editors-modeleditor-report-element-head">       <div class="brtc-va-editors-modeleditor-report-element-head-label" title="'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o(e.originData))+'">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o(e.originData))+'</div>   </div>   <div class="brtc-va-editors-modeleditor-report-element-body"></div></div>');this.$reportContentsArea.append(n),this.setContentsSizeAndPosition(n,e.size,e.position,i),this.setResizable(n),this.setDraggable(n);var r=e.originData.data.table||e.originData.data.fid,a=!1;if(this.editorInput.getContents().mid&&!this.editorInput.getContents().getFnUnitByOutTable(r)){var s=n.find(".brtc-va-editors-modeleditor-report-element-head-label");s.text("Function has been removed."),s.addClass("function-removed"),a=!0;}var l=new Promise(function(i,o){var r;(r=e.originData.data,new Promise(function(e,i){t.VA.Core.DataQueryTemplate.queryTable(r.mid,r.table||r.fid,function(t){e(t);},function(t){i(t);});})).then(function(t){var o=$.extend({},e.originData.options.chartOption,t);a&&(o.columns=[],o.data=[]),n.find(".brtc-va-editors-modeleditor-report-element-body").BrighticsChart(o),i();},function(t){o(t);});});return{elementBox:n,promise:l};},e.prototype.setContentsSizeAndPosition=function(t,e,i,o){if(e&&i)t.css({position:"absolute",top:i.top,left:i.left,width:e.width,height:e.height});else{var n=this.$reportContentsArea.height(),r=this.relativeContentsIndexList.length,a=this.relativeContentsIndexList.indexOf(parseInt(o));t.css({position:"absolute",top:n-300*(r-a),left:15,width:900,height:290});}},e.prototype.setNewContentsSizeAndPosition=function(t,e){var i=this.$reportContentsArea.height(),o=i;this.pageHandler.increasePageHeight(290),t.css({position:"absolute",top:i,left:15,width:300,height:290}),e.position={top:o,left:15},e.size={width:300,height:290};},e.prototype.renderReportTextBox=function(t,e){var i=$('<div class="brtc-va-editors-modeleditor-report-element" content-type="'+t.type+'">   <div class="brtc-va-editors-modeleditor-report-element-head">       <div class="brtc-va-editors-modeleditor-report-element-head-label"></div>   </div>   <div class="brtc-va-editors-modeleditor-report-element-body">       <div class="brtc-va-editors-modeleditor-report-element-body-contents"></div>   </div></div>');this.$reportContentsArea.append(i),this.setContentsSizeAndPosition(i,t.size,t.position),this.setResizable(i),this.setDraggable(i);var o=i.find("textarea.brtc-va-editors-modeleditor-report-element-body-textarea");return o.val(t.originData),o.on("blur",function(){t.originData=$(this).val().trim();}),i.find(".brtc-va-editors-modeleditor-report-element-body-contents").append(t.originData),{elementBox:i,promise:Promise.resolve()};},e.prototype.setResizable=function(t){var e=this;t.resizable({autoHide:!0,stop:function stop(i,o){var n=o.element.index(),r=o.position,a={width:o.element.outerWidth(),height:o.element.outerHeight()};a=e.configureContentSize(t,r,a),e.setPositionToReportDataByIndex(n,r,a);},resize:function resize(t,i){var o=i.position,n=(i.element.outerWidth(),i.element.outerHeight()),r=o.top+n;e.pageHandler.handlePageHeight(r);},minHeight:80,minWidth:150});},e.prototype.setDraggable=function(t){var e=this;t.draggable({handle:e.$reportContentsArea.find(".brtc-va-editors-modeleditor-report-element-head"),stop:function stop(i,o){var n=o.helper.index(),r=o.position,a={width:o.helper.outerWidth(),height:o.helper.outerHeight()};r=e.configureContentPosition(t,r,a),e.setPositionToReportDataByIndex(n,r,a);},drag:function drag(t,i){var o=i.position.top+i.helper.height();e.pageHandler.handlePageHeight(o+10);}});},e.prototype.configureContentSize=function(t,e,i){var o=e.left+i.width,n=this.$reportContentsArea.width();return o>n&&(t.width(n-e.left),i.width=n-e.left),i;},e.prototype.configureContentPosition=function(t,e,i){var o=e.left+i.width,n=this.$reportContentsArea.width();return e.top<5&&(e.top=5),e.left<5&&(e.left=5),o>n&&(e.left=e.left-(o-n)),t.css({top:e.top,left:e.left}),e;},e.prototype.attachReportElementBoxHeaderItems=function(e,i){var o=this,n=i.find(".brtc-va-editors-modeleditor-report-element-head");if("Text"===e.type){var r=$('<div class="brtc-va-editors-modeleditor-report-element-toolbar brtc-va-editors-modeleditor-report-element-toolbar-edit"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></div>');n.append(r),r.click(function(){var i=$(this).parents(".brtc-va-editors-modeleditor-report-element"),o=i.find(".brtc-va-editors-modeleditor-report-element-body-contents"),n={contents:o.html(),save:function save(t){e.originData=t,i.attr("content-type","Text"),o.empty(),o.append(t);}};new t.VA.Core.Dialogs.NoteDialog($(this).closest(".brtc-va-editors-modeleditor-report-element-body"),n);}),e.position||this.setNewContentsSizeAndPosition(i,e);}var a=$('<div class="brtc-va-editors-modeleditor-report-element-toolbar brtc-va-editors-modeleditor-report-element-toolbar-remove"></div>');n.append(a),a.click(function(){var e=$(this).parents(".brtc-va-editors-modeleditor-report-element").index();t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Are you sure you want to delete this graph?",function(t){t.OK&&o.removeReportDataByIndex(e);});});},e.prototype.removeReportDataByIndex=function(t){if(t>-1){var e=this.$reportContentsArea.find(".brtc-va-editors-modeleditor-report-element");e.length>t&&e[t].remove(),this.reportData.splice(t,1);}},e.prototype.setPositionToReportDataByIndex=function(t,e,i){this.reportData[t].size=i,this.reportData[t].position=e;},e.prototype.showProcessingWindow=function(){$(this.$processingWindow).dialog("open");},e.prototype.hideProcessingWindow=function(){$(this.$processingWindow).dialog("close");},e.prototype.convertReportLayout=function(){var t=this.$reportContentsArea.find(".brtc-va-editors-modeleditor-report-element");this.pageHandler.setHeight(this.$reportContentsArea.height());for(var e=t.length-1;e>=0;e--){this.convertRelativeToAbsolute(e,$(t[e]));}this.relativeContentsIndexList=[];},e.prototype.convertRelativeToAbsolute=function(t,e){var i,o,n;n=e.position(),i=e.outerHeight(),o=e.outerWidth(),e.css({position:"absolute",width:o,height:i,left:n.left,top:n.top}),this.setPositionToReportDataByIndex(t,n,{width:o,height:i});},e.prototype.downloadAll=function(){this.showProcessingWindow(),this.changeReportCss(!1),html2canvas(this.$reportContainer,{onrendered:function onrendered(t){var e=t.toDataURL("image/png"),i=$("<a>").attr("href",e).attr("download","report.png").appendTo("body");i[0].click(),i.remove();}}),this.changeReportCss(!0),this.hideProcessingWindow();},e.prototype.downloadEachAll=function(){var t=this;this.showProcessingWindow(),this.changeReportCss(!1);var e=this.$reportContentsArea.find(".brtc-va-editors-modeleditor-report-element"),i=0;!function o(){i<e.length?html2canvas(e[i],{onrendered:function onrendered(t){var e=t.toDataURL("image/png"),n=$("<a>").attr("href",e).attr("download","report"+i+".png").appendTo("body");n[0].click(),n.remove(),i++,o();}}):(t.changeReportCss(!0),t.hideProcessingWindow());}();},e.prototype.changeReportCss=function(t){t?(this.$reportWindowBody.perfectScrollbar(),this.$reportWindowBody.css({height:this.reportWindowBodyHeight}),this.$reportWindow.css({height:this.reportWindowHeight,"max-height":this.reportWindowMaxHeight})):(this.$reportWindowBody.perfectScrollbar("destroy"),this.reportWindowBodyHeight=this.$reportWindowBody.css("height"),this.$reportWindowBody.css({height:"auto"}),this.reportWindowHeight=this.$reportWindow.css("height"),this.reportWindowMaxHeight=this.$reportWindow.css("max-height"),this.$reportWindow.css({"max-height":"",height:"auto"}));},n.prototype.setHeight=function(t){this.$controlArea.height(t);},n.prototype.increasePageHeight=function(t){t=t||50;var e=this.$controlArea.height()||0;this.$controlArea.height(e+t);},n.prototype.handlePageHeight=function(t){t+10>this.$controlArea.height()&&this.$controlArea.height(t+10);},t.VA.Core.ReportManager=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.contents=e,this.reportData=e.report.data||[],this.$parent=t,this.initReport();}function i(t){var e="Title",i=t.title.fnUnitLabel;return null!=i&&(e="["+i+"] "),void 0!==t.title.panelTitle&&(e+=t.title.panelTitle),e;}function o(t){this.$controlArea=t;}e.prototype.initReport=function(){this.initReportViewer(),this.render();},e.prototype.formattedData=function(t){return{id:t.options.id+"-"+t.options.chartOption.chart.type,type:"Chart",originData:t};},e.prototype.removeReportData=function(t,e){var i=t+"-"+e;for(var o in this.reportData){if(this.reportData[o].id===i)return void this.removeReportDataByIndex(o);}},e.prototype.initReportViewer=function(){this.$reportWindow=this.$parent,this.initReportWindowBody();},e.prototype.initReportWindowBody=function(){this.$reportContentsArea=$('<div class="brtc-va-editors-modeleditor-report-contents-area"></div>'),this.$reportWindow.append(this.$reportContentsArea),this.pageHandler=new o(this.$reportContentsArea),this.$processingWindow=$('<div><div>Processing ...</div><div><div class="brtc-va-progress"><div><span class="brtc-va-progress-loading"></div></div></div>'),this.$parent.append(this.$processingWindow),$(this.$processingWindow).dialog({width:300,height:200,theme:t.VA.Env.Theme,showCloseButton:!1,autoOpen:!1,modal:!0,resizable:!1,keyboardCloseKey:""});},e.prototype.addReportTextBox=function(){var e=this.reportData.push({id:t.VA.Core.Utils.IDGenerator.report.id()+"-Text",type:"Text",originData:""});this.renderIndexData(e-1);},e.prototype.render=function(){var t=this;t.showProcessingWindow(),this.clearReport(),this.setReportContentsAreaSize();var e=[];for(var i in e.push(new Promise(function(t,e){t();})),this.reportData){var o=this.renderIndexData(i);e.push(o);}Promise.all(e).then(function(){t.hideProcessingWindow(),t.convertReportLayout();},function(e){t.hideProcessingWindow();});},e.prototype.renderIndexData=function(t){if(this.reportData[t]){var e=this.renderReportElementBox(this.reportData[t],t);return this.attachReportElementBoxHeaderItems(this.reportData[t],e.elementBox),e.promise;}},e.prototype.clearReport=function(){this.$reportContentsArea.empty();},e.prototype.setReportContentsAreaSize=function(){var t=this.reportData,e=0;this.relativeContentsIndexList=[];for(var i=0;i<t.length;i++){t[i].position?e=Math.max(e,t[i].position.top+t[i].size.height+5):this.relativeContentsIndexList.push(i);}var o=300*this.relativeContentsIndexList.length;this.$reportContentsArea.css("height",e+o);},e.prototype.renderReportElementBox=function(t,e){return"Chart"===t.type?this.renderReportChartBox(t,e):"Text"===t.type?this.renderReportTextBox(t,e):void 0;},e.prototype.renderReportChartBox=function(e,o){var n=$('<div class="brtc-va-editors-modeleditor-report-element" content-type="'+e.type+'">   <div class="brtc-va-editors-modeleditor-report-element-head">       <div class="brtc-va-editors-modeleditor-report-element-head-label" title="'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i(e.originData))+'">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i(e.originData))+'</div>   </div>   <div class="brtc-va-editors-modeleditor-report-element-body"></div></div>');this.$reportContentsArea.append(n),this.setContentsSizeAndPosition(n,e.size,e.position,o),this.setResizable(n),this.setDraggable(n);var r=e.originData.data.table||e.originData.data.fid,a=!1;if(this.contents.mid&&!this.getFnUnitByOutTable(r)){var s=n.find(".brtc-va-editors-modeleditor-report-element-head-label");s.text("Function has been removed."),s.addClass("function-removed"),a=!0;}var l=new Promise(function(i,o){var r;(r=e.originData.data,new Promise(function(e,i){t.VA.Core.DataQueryTemplate.queryTableForReport(r.mid,r.table||r.fid,function(t){e(t);},function(t){i(t);});})).then(function(t){var o=$.extend({},e.originData.options.chartOption,t);a&&(o.columns=[],o.data=[]),n.find(".brtc-va-editors-modeleditor-report-element-body").BrighticsChart(o),i();},function(t){o(t);});});return{elementBox:n,promise:l};},e.prototype.setContentsSizeAndPosition=function(t,e,i,o){if(e&&i)t.css({position:"absolute",top:i.top,left:i.left,width:e.width,height:e.height});else{var n=this.$reportContentsArea.height(),r=this.relativeContentsIndexList.length,a=this.relativeContentsIndexList.indexOf(parseInt(o));t.css({position:"absolute",top:n-300*(r-a),left:15,width:900,height:290});}},e.prototype.setNewContentsSizeAndPosition=function(t,e){var i=this.$reportContentsArea.height(),o=i;this.pageHandler.increasePageHeight(290),t.css({position:"absolute",top:i,left:15,width:300,height:290}),e.position={top:o,left:15},e.size={width:300,height:290};},e.prototype.renderReportTextBox=function(t,e){var i=$('<div class="brtc-va-editors-modeleditor-report-element" content-type="'+t.type+'">   <div class="brtc-va-editors-modeleditor-report-element-head">       <div class="brtc-va-editors-modeleditor-report-element-head-label"></div>   </div>   <div class="brtc-va-editors-modeleditor-report-element-body">       <div class="brtc-va-editors-modeleditor-report-element-body-contents"></div>   </div></div>');this.$reportContentsArea.append(i),this.setContentsSizeAndPosition(i,t.size,t.position),this.setResizable(i),this.setDraggable(i);var o=i.find("textarea.brtc-va-editors-modeleditor-report-element-body-textarea");return o.val(t.originData),o.on("blur",function(){t.originData=$(this).val().trim();}),i.find(".brtc-va-editors-modeleditor-report-element-body-contents").append(t.originData),{elementBox:i,promise:Promise.resolve()};},e.prototype.setResizable=function(t){},e.prototype.setDraggable=function(t){},e.prototype.configureContentSize=function(t,e,i){var o=e.left+i.width,n=this.$reportContentsArea.width();return o>n&&(t.width(n-e.left),i.width=n-e.left),i;},e.prototype.configureContentPosition=function(t,e,i){var o=e.left+i.width,n=this.$reportContentsArea.width();return e.top<5&&(e.top=5),e.left<5&&(e.left=5),o>n&&(e.left=e.left-(o-n)),t.css({top:e.top,left:e.left}),e;},e.prototype.attachReportElementBoxHeaderItems=function(e,i){var o=this,n=i.find(".brtc-va-editors-modeleditor-report-element-head");if("Text"===e.type){var r=$('<div class="brtc-va-editors-modeleditor-report-element-toolbar brtc-va-editors-modeleditor-report-element-toolbar-edit"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></div>');n.append(r),r.click(function(){var i=$(this).parents(".brtc-va-editors-modeleditor-report-element"),o=i.find(".brtc-va-editors-modeleditor-report-element-body-contents"),n={contents:o.html(),save:function save(t){e.originData=t,i.attr("content-type","Text"),o.empty(),o.append(t);}};new t.VA.Core.Dialogs.NoteDialog($(this).closest(".brtc-va-editors-modeleditor-report-element-body"),n);}),e.position||this.setNewContentsSizeAndPosition(i,e);}var a=$('<div class="brtc-va-editors-modeleditor-report-element-toolbar brtc-va-editors-modeleditor-report-element-toolbar-remove"></div>');n.append(a),a.click(function(){var e=$(this).parents(".brtc-va-editors-modeleditor-report-element").index();t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Are you sure you want to delete this graph?",function(t){t.OK&&o.removeReportDataByIndex(e);});});},e.prototype.removeReportDataByIndex=function(t){if(t>-1){var e=this.$reportContentsArea.find(".brtc-va-editors-modeleditor-report-element");e.length>t&&e[t].remove(),this.reportData.splice(t,1);}},e.prototype.setPositionToReportDataByIndex=function(t,e,i){this.reportData[t].size=i,this.reportData[t].position=e;},e.prototype.showProcessingWindow=function(){$(this.$processingWindow).dialog("open");},e.prototype.hideProcessingWindow=function(){$(this.$processingWindow).dialog("close");},e.prototype.convertReportLayout=function(){var t=this.$reportContentsArea.find(".brtc-va-editors-modeleditor-report-element");this.pageHandler.setHeight(this.$reportContentsArea.height());for(var e=t.length-1;e>=0;e--){this.convertRelativeToAbsolute(e,$(t[e]));}this.relativeContentsIndexList=[];},e.prototype.convertRelativeToAbsolute=function(t,e){var i,o,n;n=e.position(),i=e.outerHeight(),o=e.outerWidth(),e.css({position:"absolute",width:o,height:i,left:n.left,top:n.top}),this.setPositionToReportDataByIndex(t,n,{width:o,height:i});},e.prototype.changeReportCss=function(t){},e.prototype.getFnUnitByOutTable=function(t){for(var e in this.contents.functions){var i=this.contents.functions[e];if($.inArray(t,i[OUT_DATA])>-1)return i;}},o.prototype.setHeight=function(t){this.$controlArea.height(t);},o.prototype.increasePageHeight=function(t){t=t||50;var e=this.$controlArea.height()||0;this.$controlArea.height(e+t);},o.prototype.handlePageHeight=function(t){t+10>this.$controlArea.height()&&this.$controlArea.height(t+10);},t.VA.Core.ReportStandAlone=e;}.call(this),function(){"use strict";var t=this.Brightics,e=window.__module__;new t.VA.Log("Studio");function i(e,i){this.parentId=e,this.options=i||{},t.VA.Env.Session.userId=i.userId,t.VA.Env.Session.permissions=i.permissions,t.VA.Env.Session.logLevel=i.logLevel,i.isPublish||!1||(t.VA.Core.Utils.ModelUtils.initDefaultModelContents(),this.getResourceManager().build().then(function(){o.bind(this)(),n.bind(this)(),r.bind(this)(),a.bind(this)(),s.bind(this)(),l.bind(this)(),c.bind(this)(),d.bind(this)();}.bind(this)).catch(function(t){throw console.error(t),t;}));}var o=function o(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},n=function n(){var e=this,i=$.map(t.VA.Env.Session.permissions||[],function(t,e){return t.permission_id;});$("body").attr("perm",i.join(" ")),"true"!==t.VA.SettingStorage.getValue("common.scroll.indicate.mouseover")?$("body").addClass("scroll-always"):$("body").removeClass("scroll-always"),$(window).on("beforeunload",function(t){return"Are you sure you want to leave?";}),$(window).on("unload",function(){e.options.immediatelyClearData&&t.VA.Core.GarbageCollector.immediatelyClearData();}),$(document).bind("contextmenu",function(t){return!1;});},r=function r(){var e=this;this.$mainControl=$(crel("div",{class:"brtc-va-studio"},crel("div",{class:"brtc-va-studio-top-area"}),crel("dlv",{class:"brtc-va-studio-body-area"},crel("div",{class:"brtc-va-studio-editor-area"})),crel("dlv",{class:"brtc-va-workspace-body-area"}),crel("dlv",{class:"brtc-va-studio-bottom-area"}))),this.$parent.append(this.$mainControl);var i=this.$mainControl.find(".brtc-va-studio-top-area");this.menuBar=new t.VA.Core.Tools.MenuBar(i,{width:"100%",height:"100%",selectedProject:this.options.selectedProject});var o=this.$mainControl.find(".brtc-va-studio-bottom-area");this.statusBar=new t.VA.Core.Tools.StatusBar(o,{height:"100%"});var n=this.$mainControl.find(".brtc-va-studio-editor-area");this.editorContainer=new t.VA.Core.Editors.EditorContainer(n,{width:"100%",height:"100%"});var r=this.$mainControl.find(".brtc-va-workspace-body-area");this.projectViewer=new t.VA.Workspace.ProjectViewer(r,{resourceManager:e.getResourceManager(),selectedProject:e.options.selectedProject,close:function close(t){if(e.setChartContentAddedReport([]),t.selectedProject&&t.selectedFiles.length>0){var i=e.getResourceManager().getFile(t.selectedProject,t.selectedFiles[0]);e.getLayoutManager().openEditor(i);}else e.getLayoutManager().hideProjectViewer();}}),this.getResourceManager().on("project:delete",this.getLayoutManager().handleProjectDelete.bind(this.getLayoutManager())),this.getResourceManager().on("project:change",this.getLayoutManager().handleProjectChange.bind(this.getLayoutManager())),this.getResourceManager().on("file:delete",this.getLayoutManager().handleFileDelete.bind(this.getLayoutManager())),this.getResourceManager().on("file:change",this.getLayoutManager().handleFileChange.bind(this.getLayoutManager())),this.getLayoutManager().registerProjectViewer(this.projectViewer),this.getLayoutManager().registerEditorTab(this.menuBar.editorTab),this.getLayoutManager().initLayout();},a=function a(){this.$mainControl.bind("debug",function(e,i){var o,n,r;if("BEGIN-UNIT"==i.eventType){var a=i.launchOptions.originalModels;for(var s in a){if(o=(r=a[s]).getFnUnitById(i.fid))for(var l in o[OUT_DATA]){n=o[OUT_DATA][l],t.VA.Core.DataQueryTemplate.removeCache(r.mid,n);}}}});},s=function s(){t.VA.Core.Widget.Configurator.setCodeMirrorConfiguration();},l=function l(){t.VA.Core.Utils.MessageUtils.initMessage(),t.VA.Core.Utils.MessageUtils.initFunctionLabel();},c=function c(){this.getPreference().init();},d=function d(){this.addonFunctionManager=new t.VA.Core.AddonFunctionManager(),this.addonFunctionManager.init();};i.prototype.getValidator=function(){for(var e in this.validator=this.validator||{},t.VA.Core.Interface.Validator){var i=t.VA.Core.Interface.Validator[e];this.validator[e]=new i({studio:this});}return this.validator;},i.prototype.getResourceManager=function(){return e.ResourceManager;},i.prototype.getResourceService=function(){return e.ResourceService;},i.prototype.getSession=function(){return t.VA.Env.Session;},i.prototype.getLayoutManager=function(){return this.layoutManager=this.layoutManager||new t.VA.LayoutManager(),this.layoutManager;},i.prototype.getPreference=function(){return this.preference=this.preference||new t.VA.Preference(),this.preference;},i.prototype.getJobExecutor=function(){return this.modelLauncherManager=this.modelLauncherManager||new t.VA.Core.ModelLauncherManager(this),this.modelLauncherManager;},i.prototype.getEditorContainer=function(){return this.editorContainer;},i.prototype.getActiveEditor=function(){return this.getEditorContainer().getActiveModelEditor();},i.prototype.getClipboardManager=function(){return this.clipboardManager=this.clipboardManager||new t.VA.Core.Tools.Manager.ClipboardManager(),this.clipboardManager;},i.prototype.addDebugListener=function(t){this.$mainControl.bind("debug",t);},i.prototype.fireDebugEvent=function(t){this.$mainControl.trigger("debug",[t]);},i.prototype.removeDebugListener=function(t){this.$mainControl.unbind("debug",t);},i.prototype.addResourceChangedListener=function(t){this.$mainControl.bind("resourceChanged",t);},i.prototype.removeResourceChangedListener=function(t){this.$mainControl.unbind("resourceChanged",t);},i.prototype.onCommand=function(t){this.doValidate(t.options.analyticsModel);},i.prototype.addProblemListener=function(t){this.$mainControl.bind("onProblem",t);},i.prototype.fireProblemEvent=function(t,e){this.$mainControl.trigger("onProblem",[t,e]);},i.prototype.removeProblemListener=function(t){this.$mainControl.unbind("onProblem",t);},i.prototype.doValidate=function(t,e){},i.prototype.reloadResource=function(t){(function(t){this.addonFunctionManager.init(t);}).bind(this)(t);},i.prototype.setChartContentAddedReport=function(t){this.projectViewer.setChartContentAddedReport(t);},i.prototype.getControl=function(){return this.$mainControl;},t.VA.Studio=i;}.call(this),function(){"use strict";this.Brightics.VA.Core.Shapes.DiagramPaper=joint.dia.Paper.extend({initialize:function initialize(){joint.dia.Paper.prototype.initialize.apply(this,arguments);}});}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Shapes.FnUnitFigure=joint.shapes.basic.Generic.extend({markup:'<g class="brtc-va-rotatable">   <g class="brtc-va-scalable">       <rect class="brtc-va-bounds"/>       <rect class="brtc-va-outer"/>       <image class="brtc-va-icon"/>       <text class="brtc-va-label"/>       <text class="brtc-va-last-runtime"/>       <circle class="brtc-va-inner"/>       <circle class="brtc-va-tooltip"/>       <image class="brtc-va-tooltip-icon"/>       <title/>   </g></g>',resource:{scala:{classification:{fill:"#E45A00",image:"css/va/images/func-classification-20-scala.png","selected-image":"css/va/images/func-classification-w-20.png"},evaluation:{fill:"#E45A00",image:"css/va/images/func-evaluation-20-scala.png","selected-image":"css/va/images/func-evaluation-w-20.png"},extraction:{fill:"#E45A00",image:"css/va/images/func-extraction-20-scala.png","selected-image":"css/va/images/func-extraction-w-20.png"},io:{fill:"#E45A00",image:"css/va/images/func-io-20-scala.png","selected-image":"css/va/images/func-io-w-20.png"},brightics:{opacity:"0.3","stroke-dasharray":"2,5",fill:"green",image:"css/va/images/func-script-20-scala.png","selected-image":"css/va/images/func-script-w-20.png"},control:{fill:"#36968B",image:"css/va/images/func-control-20.png","selected-image":"css/va/images/func-control-w-20.png"},process:{fill:"#9966FF",image:"css/va/images/func-process-20.png","selected-image":"css/va/images/func-process-w-20.png"},manipulation:{fill:"#E45A00",image:"css/va/images/func-manipulation-20-scala.png","selected-image":"css/va/images/func-manipulation-w-20.png"},regression:{fill:"#E45A00",image:"css/va/images/func-regression-20-scala.png","selected-image":"css/va/images/func-regression-w-20.png"},statistics:{fill:"#E45A00",image:"css/va/images/func-statistics-20-scala.png","selected-image":"css/va/images/func-statistics-w-20.png"},transform:{fill:"#E45A00",image:"css/va/images/func-transform-20-scala.png","selected-image":"css/va/images/func-transform-w-20.png"},script:{fill:"#E45A00",image:"css/va/images/func-script-20-scala.png","selected-image":"css/va/images/func-script-w-20.png"},streaming:{fill:"#E45A00",image:"css/va/images/func-streaming-20.png","selected-image":"css/va/images/func-streaming-w-20.png"},deeplearning:{fill:"#E45A00",image:"css/va/images/func-deeplearning-20-scala.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},bigdata:{fill:"#E45A00",image:"css/va/images/func-bigdata-20.png","selected-image":"css/va/images/func-bigdata-w-20.png"},udf:{fill:"#E45A00",image:"css/va/images/func-udf-normal.png","selected-image":"css/va/images/func-udf-select.png"},clustering:{fill:"#E45A00",image:"css/va/images/func-clustering-20-scala.png","selected-image":"css/va/images/func-clustering-w-20.png"},recommendation:{fill:"#E45A00",image:"css/va/images/func-recommendation-20-scala.png","selected-image":"css/va/images/func-recommendation-w-20.png"},timeseries:{fill:"#E45A00",image:"css/va/images/func-timeseries-20-scala.png","selected-image":"css/va/images/func-timeseries-w-20.png"},autonomousanalytics:{fill:"#E45A00",image:"css/va/images/func-autonomousanalytics-20-scala.png","selected-image":"css/va/images/func-autonomousanalytics-w-20.png"},opt:{fill:"#E45A00",image:"css/va/images/func-opt-20-scala.png","selected-image":"css/va/images/func-opt-w-20.png"},ad:{fill:"#E45A00",image:"css/va/images/func-ad-20-scala.png","selected-image":"css/va/images/func-ad-w-20.png"},unknown:{fill:"red",image:"css/va/images/func-unknown-20.png","selected-image":"css/va/images/func-unknown-w-20.png"},"core-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"convolutional-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"pooling-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},application:{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"recurrent-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"merge-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"normalization-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"advanced-activations-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},textanalytics:{fill:"#E45A00",image:"css/va/images/func-textanalytics-20.png","selected-image":"css/va/images/func-textanalytics-w-20.png"}},python:{classification:{fill:"#366E9D",image:"css/va/images/func-classification-20-python.png","selected-image":"css/va/images/func-classification-w-20.png"},evaluation:{fill:"#366E9D",image:"css/va/images/func-evaluation-20-python.png","selected-image":"css/va/images/func-evaluation-w-20.png"},extraction:{fill:"#366E9D",image:"css/va/images/func-extraction-20-python.png","selected-image":"css/va/images/func-extraction-w-20.png"},io:{fill:"#366E9D",image:"css/va/images/func-io-20-python.png","selected-image":"css/va/images/func-io-w-20.png"},brightics:{opacity:"0.3","stroke-dasharray":"2,5",fill:"green",image:"css/va/images/func-script-20-python.png","selected-image":"css/va/images/func-script-w-20.png"},control:{fill:"#36968B",image:"css/va/images/func-control-20.png","selected-image":"css/va/images/func-control-w-20.png"},process:{fill:"#9966FF",image:"css/va/images/func-process-20.png","selected-image":"css/va/images/func-process-w-20.png"},manipulation:{fill:"#366E9D",image:"css/va/images/func-manipulation-20-python.png","selected-image":"css/va/images/func-manipulation-w-20.png"},regression:{fill:"#366E9D",image:"css/va/images/func-regression-20-python.png","selected-image":"css/va/images/func-regression-w-20.png"},statistics:{fill:"#366E9D",image:"css/va/images/func-statistics-20-python.png","selected-image":"css/va/images/func-statistics-w-20.png"},transform:{fill:"#366E9D",image:"css/va/images/func-transform-20-python.png","selected-image":"css/va/images/func-transform-w-20.png"},script:{fill:"#366E9D",image:"css/va/images/func-script-20-python.png","selected-image":"css/va/images/func-script-w-20.png"},streaming:{fill:"#366E9D",image:"css/va/images/func-streaming-20-python.png","selected-image":"css/va/images/func-streaming-w-20.png"},deeplearning:{fill:"#366E9D",image:"css/va/images/func-deeplearning-20-python.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},bigdata:{fill:"#366E9D",image:"css/va/images/func-bigdata-20.png","selected-image":"css/va/images/func-bigdata-w-20.png"},udf:{fill:"#366E9D",image:"css/va/images/func-udf-normal.png","selected-image":"css/va/images/func-udf-select.png"},clustering:{fill:"#366E9D",image:"css/va/images/func-clustering-20-python.png","selected-image":"css/va/images/func-clustering-w-20.png"},recommendation:{fill:"#366E9D",image:"css/va/images/func-recommendation-20-python.png","selected-image":"css/va/images/func-recommendation-w-20.png"},timeseries:{fill:"#366E9D",image:"css/va/images/func-timeseries-20-python.png","selected-image":"css/va/images/func-timeseries-w-20.png"},autonomousanalytics:{fill:"#366E9D",image:"css/va/images/func-autonomousanalytics-20-python.png","selected-image":"css/va/images/func-autonomousanalytics-w-20.png"},opt:{fill:"#366E9D",image:"css/va/images/func-opt-20-python.png","selected-image":"css/va/images/func-opt-w-20.png"},ad:{fill:"#366E9D",image:"css/va/images/func-ad-20-python.png","selected-image":"css/va/images/func-ad-w-20.png"},unknown:{fill:"red",image:"css/va/images/func-unknown-20.png","selected-image":"css/va/images/func-unknown-w-20.png"},"core-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"convolutional-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"pooling-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},application:{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"recurrent-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},"advanced-activations-layer":{fill:"#4CB87D",image:"css/va/images/func-deeplearning-20.png","selected-image":"css/va/images/func-deeplearning-w-20.png"},textanalytics:{fill:"#366E9D",image:"css/va/images/func-textanalytics-20-python.png","selected-image":"css/va/images/func-textanalytics-w-20.png"}},sql:{udf:{fill:"#d771eb",image:"css/va/images/func-udf-normal.png","selected-image":"css/va/images/func-udf-select.png"}}},getColor:function getColor(){var t=this.attributes.attrs.category,e=this.attributes.attrs.context;return(this.resource[e][t]||this.resource[e].io).fill;},select:function select(){var t=this.attributes.attrs.category,e=this.attributes.attrs.context,i=this.resource[e][t]||this.resource[e].io;t&&i&&i.fill&&(this.attr(".brtc-va-outer/opacity",i.opacity||1),this.attr(".brtc-va-outer/fill",i.fill),this.attr(".brtc-va-inner/stroke",i.fill),this.attr(".brtc-va-icon/xlink:href",i["selected-image"])),this.attributes.attrs.deprecated&&(this.attr(".brtc-va-outer/fill",this.attributes.colorSet.DEPRECATED),this.attr(".brtc-va-inner/stroke",this.attributes.colorSet.DEPRECATED)),this.attr(".brtc-va-label/fill","#FFFFFF");},unselect:function unselect(){var t=this.attributes.attrs.category,e=this.attributes.attrs.context,i=["unknown","brightics"],o=this.resource[e][t]||this.resource[e].io;this.attr(".brtc-va-outer/opacity",o.opacity||1),this.attr(".brtc-va-outer/fill",i.indexOf(t)>-1?o.fill:"#FFFFFF"),this.attr(".brtc-va-inner/stroke",i.indexOf(t)>-1?o.fill:"#FFFFFF"),this.attr(".brtc-va-label/fill",i.indexOf(t)>-1?"#FFFFFF":"#667185"),this.attributes.attrs.deprecated&&(this.attr(".brtc-va-outer/fill",this.attributes.colorSet.DEPRECATED),this.attr(".brtc-va-inner/stroke",this.attributes.colorSet.DEPRECATED)),t&&o&&o.image&&this.attr(".brtc-va-icon/xlink:href",o.image);},changeScale:function changeScale(t){this.label(this.originalLabel,t);},label:function label(e,i){if(e){this.originalLabel=e;var o,n=i||1,r=e;n<.7?(r=e.replace(/\s/g,""),o=(r=joint.util.breakText(r,{width:(t.VA.Env.Diagram.FIGURE_WIDTH-80)*n},{"font-size":12*n,"font-family":"Arial, Dotum, Tahoma, sans-serif","font-weight":"bold"})).split("\n"),r=(r=o.length>1?o[0]+"...":o[0]).replace(/\u0006/g," "),this.attr("text.brtc-va-label/text",r),this.attr("text.brtc-va-label/ref",".brtc-va-outer"),this.attr("text.brtc-va-label/ref-x",50),this.attr("text.brtc-va-label/ref-y",27),this.attr("text.brtc-va-label/y-alignment","middle")):((o=(r=joint.util.breakText(r,{width:(t.VA.Env.Diagram.FIGURE_WIDTH-80)*n},{"font-size":12*n,"font-family":"Arial, Dotum, Tahoma, sans-serif","font-weight":"bold"})).split("\n")).length>2&&(r=o[0]+"\n"+o[1]+"..."),this.attr("text.brtc-va-label/text",r),this.attr("text.brtc-va-label/ref",".brtc-va-outer"),this.attr("text.brtc-va-label/ref-x",50),this.attr("text.brtc-va-label/ref-y",25),this.attr("text.brtc-va-label/y-alignment","middle"));}else console.log("label is undefined !!!");},lastRuntime:function lastRuntime(t){this.attr("text.brtc-va-last-runtime/text",t);},resetRuntime:function resetRuntime(){this.attr("text.brtc-va-last-runtime/text","- -:- -:- -.- - -");},tooltip:function tooltip(t){},category:function category(t){var e=t.category,i=t.defaultFnUnit.context||"scala";this.attr("category",e),this.attr("context",i);var o=this.resource[i][e]?this.resource[i][e].image:this.resource[i].io.image;"unknown"===e?(this.attr(".brtc-va-outer/fill",this.resource[i][e].fill),this.attr(".brtc-va-inner/stroke",this.resource[i][e].fill),this.attr(".brtc-va-icon/xlink:href",this.resource[i][e]["selected-image"]),this.attr(".brtc-va-label/fill","#FFFFFF")):"brightics"===e?(this.attr(".brtc-va-outer/fill",this.resource[i][e].fill),this.attr(".brtc-va-outer/opacity",this.resource[i][e].opacity)):this.attr(".brtc-va-icon/xlink:href",o);},updateStatus:function updateStatus(t){this.attr(".brtc-va-inner/fill",this.attributes.colorSet[t]),"FAIL"===t&&this.showError(),"SUCCESS"===t&&this.hideError();},refresh:function refresh(){this.attr(".brtc-va-outer/stroke",this.attributes.colorSet.READY),this.attr(".brtc-va-inner/fill",this.attributes.colorSet.READY);},showError:function showError(){this.attr(".brtc-va-outer/stroke",this.attributes.colorSet.FAIL);},hideError:function hideError(){this.attr(".brtc-va-outer/stroke",this.attributes.colorSet.READY);},showToolTipIcon:function showToolTipIcon(){this.attr(".brtc-va-tooltip/display","block"),this.attr(".brtc-va-tooltip-icon/display","block");},hideToolTipIcon:function hideToolTipIcon(){this.attr(".brtc-va-tooltip/display","none"),this.attr(".brtc-va-tooltip-icon/display","none");},setOnShade:function setOnShade(){this.attr("text.brtc-va-label/opacity",".25"),this.attr(".brtc-va-icon/opacity",".25");},setOffShade:function setOffShade(){this.attr("text.brtc-va-label/opacity","1"),this.attr(".brtc-va-icon/opacity","1");},setCursorType:function setCursorType(t){this.attr(".brtc-va-scalable/cursor",t);},setDeprecated:function setDeprecated(t){this.attr("deprecated",!0),this.attr("title/text","Deprecated: "+t),this.attr(".brtc-va-label/text-decoration","line-through"),this.attr(".brtc-va-outer/fill",this.attributes.colorSet.DEPRECATED),this.attr(".brtc-va-inner/stroke",this.attributes.colorSet.DEPRECATED);},defaults:joint.util.deepSupplement({inPorts:["in1","in2"],outPorts:["out"],type:"brtc.va.shapes.FnUnit",attrs:{".brtc-va-bounds":{fill:"#DFDFEF","fill-opacity":0,width:t.VA.Env.Diagram.FIGURE_WIDTH,height:t.VA.Env.Diagram.FIGURE_HEIGHT},".brtc-va-outer":{fill:"#FFFFFF",ref:".brtc-va-bounds","ref-y":6,width:t.VA.Env.Diagram.FIGURE_WIDTH-5,height:t.VA.Env.Diagram.FIGURE_HEIGHT-12,rx:(t.VA.Env.Diagram.FIGURE_HEIGHT-12)/2,ry:(t.VA.Env.Diagram.FIGURE_HEIGHT-12)/2},".brtc-va-icon":{width:16,height:16,"xlink:href":"css/va/images/func-io-20.png",ref:".brtc-va-outer","ref-x":25,"ref-y":16},".brtc-va-label":{fill:"#667185",text:"",ref:".brtc-va-outer","ref-x":50,"ref-y":(t.VA.Env.Diagram.FIGURE_HEIGHT-8)/2,"y-alignment":"middle","font-size":"12px","font-family":"Arial, Dotum, Tahoma, sans-serif","font-weight":"bold"},".brtc-va-last-runtime":{fill:"#667185",text:"- -:- -:- -.- - -",ref:".brtc-va-outer","ref-x":120,"ref-y":50,"font-size":10,"font-family":"Arial, Dotum, Tahoma, sans-serif","font-weight":"normal"},".brtc-va-inner":{fill:"#E5E9EF",ref:".brtc-va-bounds","ref-x":t.VA.Env.Diagram.FIGURE_WIDTH-6,"ref-y":t.VA.Env.Diagram.FIGURE_HEIGHT/2,"stroke-width":2,stroke:"#FFFFFF",r:5},".brtc-va-tooltip":{fill:"#FFFFFF",ref:".brtc-va-bounds","ref-x":8,"ref-y":t.VA.Env.Diagram.FIGURE_HEIGHT/2-15,"stroke-width":2,stroke:"#E5E9EF",r:10,display:"none"},".brtc-va-tooltip-icon":{width:18,height:18,"xlink:href":"css/va/images/func-memo-18x18.png",ref:".brtc-va-tooltip","ref-x":1,"ref-y":1,display:"none"}}},joint.shapes.basic.Generic.prototype.defaults)});}.call(this),function(){"use strict";this.Brightics.VA.Core.Shapes.LinkFigure=joint.dia.Link.extend({showRemoveButton:function showRemoveButton(){this.attr(".link-tools/display","block"),this.attr(".marker-arrowheads/display","block"),this.attr(".connection/stroke-width","4"),this.attr(".connection/style","stroke: #656EEA"),this.attr(".marker-target/style","stroke: #656EEA; fill: #656EEA");},hideRemoveButton:function hideRemoveButton(){this.attr(".link-tools/display","none"),this.attr(".marker-arrowheads/display","none"),this.attr(".connection/stroke-width","2"),this.attr(".connection/style","stroke: #9FA7A2"),this.attr(".marker-target/style","stroke: #9FA7A2; fill: #9FA7A2");},defaults:joint.util.deepSupplement({type:"brtc.va.shapes.Link",router:{name:"metro"},connector:{name:"rounded"},attrs:{".connection":{stroke:"#9FA7A2","stroke-width":2},".marker-target":{fill:"#9FA7A2",stroke:"#9FA7A2",d:"M 8 0 L 0 4 L 8 8 z"},".marker-arrowhead":{fill:"#9FA7A2",stroke:"#9FA7A2",d:"M-8,0a8,8 0 1,0 16,0a8,8 0 1,0 -16,0"},".link-tools":{display:"none"},".marker-arrowheads":{display:"none"}}})});}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e||{},this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-menubar">   <div class="brtc-va-tools-menubar-left-area">       <div class="brtc-va-tools-menubar-logo"></div>   </div>   <div class="brtc-va-tools-menubar-center-area"></div>   <div class="brtc-va-tools-menubar-right-area">       <div class="brtc-va-tools-menubar-doc" title="Documentation">           <i class="fa fa-file-text-o"></i>       </div>       <div class="brtc-va-tools-menubar-notice" title="Notice">           <div class="brtc-va-tools-menubar-notice-default"></div>           <div class="brtc-va-tools-menubar-notice-new"></div>       </div>       <div class="brtc-va-tools-menubar-setting" title="Settings"></div>       <div class="brtc-va-tools-menubar-myprofile" title="Profile"></div>       <div class="brtc-va-tools-menubar-logout" title="Logout">Logout</div>   </div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.createLogoButton(),this.createEditorHeader(),this.createSideBarButton(),this.createManagementButton(),this.createMyProfileButton(),this.createLogoutButton(),this.createHelpButton(),this.createNoticeButton(),this.invisibleMenuForPermissions();},e.prototype.createLogoButton=function(){this.$mainControl.find(".brtc-va-tools-menubar-logo").on("click",function(){Studio.getLayoutManager().showProjectViewer();});},e.prototype.createEditorHeader=function(){var e=this.$mainControl.find(".brtc-va-tools-menubar-center-area");this.editorTab=new t.VA.Core.Views.EditorTab(e);},e.prototype._getEditorInput=function(t,e){return Studio.getResourceManager().getFile(t,e);},e.prototype.createSideBarButton=function(){var t=this;this.$mainControl.find(".brtc-va-tools-menubar-sidebar").click(function(){$(this).toggleClass("brtc-va-tools-menubar-toggle-on");var e=$(this).hasClass("brtc-va-tools-menubar-toggle-on");t.$mainControl.trigger("showSideBar",[e]);});},e.prototype.createManagementButton=function(){var e=this;this.$mainControl.find(".brtc-va-tools-menubar-setting").click(function(i){new t.VA.Core.Tools.MenuBar.SettingContainerDialog(e.$mainControl,{title:"Settings",close:function close(t){}});});},e.prototype.createMyProfileButton=function(){var e=this;this.$mainControl.find(".brtc-va-tools-menubar-myprofile").click(function(i){i.stopPropagation(),$(".brtc-va-tools-menubar-myprofile-detail-container").length?$(window).click():($(window).click(),$.ajax({type:"GET",url:"api/va/v2/users/my",contentType:"application/json; charset=utf-8",blocking:!0,success:function success(i){var o={};o.id=i[0].id,o.name=i[0].name,o.email=i[0].email,new t.VA.Core.Tools.MenuBar.ProfileContainer(e.$mainControl,o).render();}}));});},e.prototype.createLogoutButton=function(){var e=this;this.$mainControl.find(".brtc-va-tools-menubar-logout").click(function(){var i={contentText:"Are you sure you want to logout?",close:function close(e){e.OK&&($(window).unbind("beforeunload"),t.VA.Core.GarbageCollector.clearAlluxio(),window.location.href="auth/"+t.VA.Env.Session.userId+"/logout",sessionStorage&&sessionStorage.clear());},isCancel:!0};t.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(e.$mainControl,i);});},e.prototype.createHelpButton=function(){this.$mainControl.find(".brtc-va-tools-menubar-doc").click(function(e){t.VA.Core.Utils.ModelUtils.openDocumentationPopup();});},e.prototype.createNoticeButton=function(){var e=this;$.ajax({url:"api/admin/v2/notices",type:"GET",blocking:!1,contentType:"application/json; charset=utf-8"}).done(function(i){var o=$(".brtc-va-tools-menubar-notice-new");for(var n in i){t.VA.Core.Utils.CommonUtils.getTimeDifferenceFromNow(i[n].update_time)<24&&o.show();break;}e.$mainControl.find(".brtc-va-tools-menubar-notice").click(function(o){new t.VA.Core.Tools.MenuBar.NoticeContainerDialog(e.$mainControl,{data:i,title:"Notice",close:function close(t){$(this).dialog("destroy"),$(this).remove();}});});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},e.prototype.invisibleMenuForPermissions=function(){var e=!0,i=!0,o=!0;for(var n in t.VA.Env.Session.permissions){"perm_invisible_logout"===t.VA.Env.Session.permissions[n].permission_id?e=!1:"perm_invisible_profile_setting"===t.VA.Env.Session.permissions[n].permission_id?i=!1:"perm_invisible_setting"===t.VA.Env.Session.permissions[n].permission_id&&(o=!1);}i?this.$mainControl.find(".brtc-va-tools-menubar-myprofile").show():this.$mainControl.find(".brtc-va-tools-menubar-myprofile").hide(),e?this.$mainControl.find(".brtc-va-tools-menubar-logout").show():this.$mainControl.find(".brtc-va-tools-menubar-logout").hide(),o?this.$mainControl.find(".brtc-va-tools-menubar-setting").show():this.$mainControl.find(".brtc-va-tools-menubar-setting").hide();},t.VA.Core.Tools.MenuBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-statusbar">   <div class="brtc-va-tools-statusbar-logo"></div>   <div class="brtc-va-tools-statusbar-copyright">       Copyright <i class="fa fa-copyright"></i> 2016 Samsung SDS, All Rights Reserved.   </div>   <div class="brtc-va-tools-statusbar-right-area">   </div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl);},t.VA.Core.Tools.StatusBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e||{},this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-subtoolbar">   <div class="brtc-va-tools-subtoolbar-left-arrow-area"></div>   <div class="brtc-va-tools-subtoolbar-center-area"></div>   <div class="brtc-va-tools-subtoolbar-right-arrow-area"></div>   <div class="brtc-va-tools-subtoolbar-add-button-area"></div></div>'),console.log("SubToolBar.prototype.createControls");},e.prototype.openActivity=function(t){console.log("SubToolBar.prototype.openActivity");},e.prototype.closeActivity=function(){console.log("SubToolBar.prototype.closeActivity");},t.VA.Core.Tools.SubToolBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=500,this.dialogOptions.height=600,this.dialogOptions.position={my:"right top",at:"right top+50",of:window};},e.prototype.createDialogContentsArea=function(e){this.$mainControl=$('<div class="brtc-va-tools-menubar-notice-container" />'),e.append(this.$mainControl);var i=$('<div class="brtc-va-tools-menubar-notice-box empty">Loading...</div>');this.$mainControl.append(i);this.getNoticeData(function(e){for(var o in e){$(".brtc-va-tools-menubar-notice-box.empty").remove();var n=new Date(e[o].create_time),r=t.VA.Core.Utils.CommonUtils.transferTimestampToDateString(n),a=$('   <div class="brtc-va-tools-menubar-notice-box">       <div class="brtc-va-tools-menubar-notice-box-header">           <div class="brtc-va-tools-menubar-notice-box-header-new"></div>           <div class="brtc-va-tools-menubar-notice-box-header-title"></div>       </div>       <div class="brtc-va-tools-menubar-notice-box-body">           <div class="brtc-va-tools-menubar-notice-box-body-content"></div>       </div>       <div class="brtc-va-tools-menubar-notice-box-footer border-bottom">           <div class="brtc-va-tools-menubar-notice-box-footer-date">'+r+'</div>           <div class="brtc-va-tools-menubar-notice-box-footer-link-img"></div>           <div class="brtc-va-tools-menubar-notice-box-footer-link" index="'+o+'"><u>more</u></div>       </div>   </div>');a.find(".brtc-va-tools-menubar-notice-box-header-title").text(e[o].title),a.find(".brtc-va-tools-menubar-notice-box-body-content").html(e[o].content?e[o].content:""),this.$mainControl.append(a),a.find(".brtc-va-tools-menubar-notice-box-footer-link").click(function(){var i=e[$(this).attr("index")];new t.VA.Core.Dialogs.NoticeDetailDialog($(this).closest(".brtc-va-editors-modeleditor-report-element-body"),{noticeData:i,title:"Notice Detail"});});var s=a.find(".brtc-va-tools-menubar-notice-box-header-new");if(t.VA.Core.Utils.CommonUtils.getTimeDifferenceFromNow(e[o].update_time)<24?s.show():s.hide(),2==o)break;}0===e.length&&i.text("No Notice.");}.bind(this));},e.prototype.getNoticeData=function(e){$.ajax({url:"api/admin/v2/notices",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}).done(function(t){e(t);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},e.prototype.createDialogButtonBar=function(){},t.VA.Core.Tools.MenuBar.NoticeContainerDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.setDefaultSetting();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.setDefaultSetting=function(){this.options||(this.options={},this.options.id=Studio.getSession().userId,this.options.name="",this.options.email="");},e.prototype.render=function(){this.createControls(),this.bindCloseHandler();},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-menubar-myprofile-detail-container">   <div class="profile-close-button"></div>   <div class="profile-datail-picture-area">       <div class="profile-datail-picture"></div>   </div>   <div class="profile-datail-info-area">       <div class="profile-datail-info-text-area">           <span class="profile-datail-name" title="'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.name)+'">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.name)+'</span>           <span>(</span><span class="profile-datail-id" title="'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.id)+'">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.id)+'</span><span>)</span>           <span class="profile-datail-email" title="'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.email)+'">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.email)+'</span></div>       <div class="profile-datail-info-setting-area">           <span class="profile-datail-info-settings">Profile Settings</span>       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$mainControl.find(".profile-datail-info-settings").click(function(t){t.stopPropagation(),window.open("profile"),$(window).click();});},e.prototype.bindCloseHandler=function(){function t(){$(".profile-close-button").click();}this.$mainControl.click(function(t){t.stopPropagation();}),$(window).on("click",t),this.$mainControl.find(".profile-close-button").click(function(){$(".brtc-va-tools-menubar-myprofile-detail-container").remove(),$(window).off("click",t);});},e.prototype.getOptions=function(){return this.options;},t.VA.Core.Tools.MenuBar.ProfileContainer=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=500,this.dialogOptions.height=380,this.dialogOptions.position={my:"right top",at:"right top+50",of:window};},e.prototype.createDialogContentsArea=function(e){var i=this,o=$('<div class="brtc-va-tools-menubar-setting-container">   <div class="setting-box"/></div>');e.append(o),this._createSettingSection({title:"Management",funcTitle:"Go to Management page",clickFunc:function clickFunc(){window.open("ng1123/user","Brightics Management").blur();}}),this._createSettingSection({title:"Preferences",funcTitle:"Open the Preferences window",clickFunc:function clickFunc(){new t.VA.Core.Dialogs.SettingDialog(i.$parent,{title:"Preferences"});}}),this._createSettingSection({title:"Readme",funcTitle:"About Brightics",clickFunc:function clickFunc(){window.open("readme","Brightics Visual Analytics").blur();}});},e.prototype._createSettingSection=function(e){var i=$('       <div class="section">           <p class="section-title"></p>           <div class="function">               <p class="func-title"></p>               <div class="brtc-va-tools-menubar-setting-container-link">Go</div>           </div>       </div>');this.$mainControl.find(".setting-box").append(i),i.find(".section-title").text(e.title),i.find(".func-title").text(e.funcTitle);var o=i.find(".brtc-va-tools-menubar-setting-container-link");o.jqxButton({theme:t.VA.Env.Theme}),o.on("click",e.clickFunc);},e.prototype.createDialogButtonBar=function(){},t.VA.Core.Tools.MenuBar.SettingContainerDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){void 0!==t&&(t.in&&t.in.length>0?(this.sliceChartOpion(t.in),t.in=this.migrateSheetOption(t.in)):t.in&&t.in.full&&0==t.in.full.length&&(t.in.full=[{panel:[],layout:{}}]),t.out&&t.out.length>0?(this.sliceChartOpion(t.out),t.out=this.migrateSheetOption(t.out)):t.out&&t.out.full&&0==t.out.full.length&&(t.out.full=[{panel:[],layout:{}}]),this.doMigrationSource(t));},e.prototype.doMigrationSource=function(t){for(var e in t){for(var i in t[e]){var o=t[e][i];for(var n in o){var r=o[n].panel;for(var a in r){r[a]&&r[a].chartOption&&(r[a].chartOption.source&&r[a].chartOption.source.localData&&(r[a].chartOption.source.localData=[]),r[a].chartOption.source&&r[a].chartOption.source.lazyData&&(r[a].chartOption.source.lazyData=[]));}}}}},e.prototype.sliceChartOpion=function(t){var e=this;void 0!==t&&0!==t.length&&t.forEach(function(t){t.panel&&t.panel.length>0&&t.panel.forEach(function(t){t&&e.doMigration(t.chartOption);});});},e.prototype.doMigration=function(t){void 0!==t&&void 0!==t.chart&&void 0!==t.chart.type&&void 0!==t.xAxis&&t.xAxis.constructor!==Array&&(this.doMigrationAxis(t,"xAxis"),this.doMigrationAxis(t,"yAxis"),this.doMigrationAxis(t,"colorBy"),this.configurePreVersionOptions(t));},e.prototype.doMigrationAxis=function(t,e){t[e].constructor===Object&&(t[e]=[t[e]]);},e.prototype.configurePreVersionOptions=function(t){this.changePreVersionChartToTable(t),this.configurePreVersionChartOptions(t),this.deletePreVersionChartOptions(t);},e.prototype.changePreVersionChartToTable=function(t){["treediagram","mcc","dendrogram","treemap","correlation-matrix"].indexOf(t.chart.type)>=0&&(t.chart={type:"table"});},e.prototype.configurePreVersionChartOptions=function(t){"heatmap"===t.chart.type&&(t.plotOptions={heatmap:{valueBy:[t.valueBy]}}),"pie"===t.chart.type&&(t.plotOptions={pie:{sizeBy:[t.sizeBy]}}),"network"===t.chart.type&&(t.plotOptions={network:{fromColumn:[t.fromCol],toColumn:[t.toCol]}}),"roc"===t.chart.type&&(t.chart.type="roccurve");},e.prototype.deletePreVersionChartOptions=function(t){var e=["stripLines","trendLines","groupBy","lineBy","valueBy","sizeBy","shapeBy","fromCol","toCol","conditionCol","nodeLabelCol","edgeLabelCol","parentCol","childCol","valueCol","clusterCol","clusterGroupCol","heightCol","typeCol","columnFormatters"];for(var i in e){delete t[e[i]];}},e.prototype.migrateSheetOption=function(t){return{partial:t,full:[{panel:[],layout:{}}]};},t.VA.Core.Tools.ChartMigrator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){this.options=e||{},this.ruleList={},this.addRule(),this.chartMigrator=new t.VA.Core.Tools.ChartMigrator();}e.prototype.addRule=function(){for(var e in t.VA.Core.Tools.ModelMigrator.RuleList){this.ruleList[e]=new t.VA.Core.Tools.ModelMigrator.RuleList[e]();}},e.prototype.migrate=function(t){if(this._doModelMigration(t),void 0!==t.functions)for(var e=0;e<t.functions.length;e++){var i=t.functions[e];i&&(this._doFunctionMigration(i),"Subflow"===i[FUNCTION_NAME]&&this.migrate(i.param));}},e.prototype._doModelMigration=function(t){var e,i=this;if("control"==t.type)for(var o in e=t.variables){"string"!=e[o].type&&"number"!=e[o].type||(e[o].type="literal");}else if("data"==t.type||"realtime"==t.type)for(var o in t[IN_DATA]=t[IN_DATA]||[],t[OUT_DATA]=t[OUT_DATA]||[],_.forIn(t.innerModels,function(t){i.migrate(t);}),e=(t=this._migrateDiagram(t))["gv-def"]){"string"!=e[o]["variable-type"]&&"number"!=e[o]["variable-type"]||(e[o]["variable-type"]="literal");}else"visual"==t.type&&(void 0===t.report.display&&(t.report.display={}),t.report.display["page-type"]||(t.report.display["page-type"]="a4-vertical",t.report.display.height="1125",t.report.display.width="795"));var n=function n(t){return{type:t.type,value:"calculation"===t.type&&_.isArray(t.value)?t.value[0]:t.value};};if("data"===t.type){t.variables=function(t){return _.reduce(_.keys(t),function(e,i){var o=t[i];return _.merge({},e,_.set({},i,n(o)));},{});}(t.variables);var r=[t].concat(_.toArray(t.innerModels));_.forEach(r,function(t){t.functions=_.map(t.functions,function(t){return"Flow"===t[FUNCTION_NAME]?_.merge({},_.omit(t,"param.variables"),_.set({},"param.variables",_.mapValues(t.param.variables,n))):t;});});}},e.prototype._migrateDiagram=function(e){if(void 0===e.diagram||e.diagram!=t.VA.Env.Diagram){try{var i,o,n;for(i in e.functions){n=(o=e.functions[i]).display.diagram.position,o.display.diagram.position=this._configureDiagramPosition(n,e.diagram);}}catch(t){for(var r=0;r<e.functions.length;r++){e.functions[r].display=e.functions[r].display||{},e.functions[r].display.diagram=e.functions[r].display.diagram||{},e.functions[r].display.diagram.position=this._getPositionByIndex(r+1,1);}}e.diagram=$.extend(!0,{},t.VA.Env.Diagram);}return e;},e.prototype._getPositionByIndex=function(e,i){var o=t.VA.Env.Diagram;return{x:o.PAPER_MARGIN_LEFT+e*(o.FIGURE_WIDTH+o.GAP_WIDTH),y:o.PAPER_MARGIN_TOP+i*(o.FIGURE_HEIGHT+o.GAP_HEIGHT)};},e.prototype._configureDiagramPosition=function(e,i){i=i||t.VA.Env.DiagramInit;var o=(e.x-i.PAPER_MARGIN_LEFT)/(i.FIGURE_WIDTH+i.GAP_WIDTH),n=(e.y-i.PAPER_MARGIN_TOP)/(i.FIGURE_HEIGHT+i.GAP_HEIGHT);return this._getPositionByIndex(o,n);},e.prototype._doFunctionMigration=function(e){if(e.display&&e.display.sheet&&this.chartMigrator.migrate(e.display.sheet),void 0!==e.parent&&void 0!==e.parent().type){var i=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(e.parent().type,e.func);i&&"udf"===i.category&&this.ruleList.udf.migrate(e);}_.indexOf(["Flow","If","ForLoop","WhileLoop"],e[FUNCTION_NAME])>-1&&(e[IN_DATA]=e[IN_DATA]||[],e[OUT_DATA]=e[OUT_DATA]||[],e.display.sheet=e.display.sheet||{in:{partial:[{panel:[],layout:{}}],full:[{panel:[],layout:{}}]},out:{partial:[{panel:[],layout:{}}],full:[{panel:[],layout:{}}]}});var o=this.ruleList[e.func];o&&o.migrate(e);},t.VA.Core.Tools.ModelMigrator.Executor=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["reg-param"]&&(e["reg-param"]=e["reg-parm"]||""),delete e["reg-parm"];},t.VA.Core.Tools.ModelMigrator.RuleList.alsTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.flag&&(e.flag="true");},t.VA.Core.Tools.ModelMigrator.RuleList.anova=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){delete t.param.groupby;},t.VA.Core.Tools.ModelMigrator.RuleList.arimaPredict=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.intercept&&(e.intercept="true"),delete e.groupby;},t.VA.Core.Tools.ModelMigrator.RuleList.arimaTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;1==Array.isArray(e.column[0])&&(e.column=e.column[0]);},t.VA.Core.Tools.ModelMigrator.RuleList.associationRule=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){delete t.param.groupby,t.display.label="Auto Arima Predict"===t.display.label?"Auto ARIMA Predict":t.display.label;},t.VA.Core.Tools.ModelMigrator.RuleList.autoArimaPredict=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(e){var i=e.param;void 0===i.columns&&(i.columns=i.column||[[]]),void 0===i.maxP&&(i.maxP=""),void 0===i.maxD&&(i.maxD=""),void 0===i.maxQ&&(i.maxQ=""),delete i.column,delete i.tolerance,delete i.iteration,delete i.groupby,e.display.label="Auto Arima Train"===e.display.label?"Auto ARIMA Train":e.display.label,1==e.outData.length&&e.outData.push(t.VA.Core.Utils.IDGenerator.table.id());},t.VA.Core.Tools.ModelMigrator.RuleList.autoArimaTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="random");},t.VA.Core.Tools.ModelMigrator.RuleList.autoClassificationTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){"Auto Correlation"===t.display.label&&(t.display.label="AutoCorrelation");},t.VA.Core.Tools.ModelMigrator.RuleList.autoCorrelation=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="grid");},t.VA.Core.Tools.ModelMigrator.RuleList.decisionTreeClassificationTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="grid");},t.VA.Core.Tools.ModelMigrator.RuleList.decisionTreeRegressionTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["max-num-features"]&&(e["max-num-features"]=e["num-top-features"]),delete e["method-arr"],delete e["num-top-features"],delete e["on-exhaustive"];},t.VA.Core.Tools.ModelMigrator.RuleList.autoFeatureSelection=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="grid");},t.VA.Core.Tools.ModelMigrator.RuleList.gBTClassificationTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="grid");},t.VA.Core.Tools.ModelMigrator.RuleList.gBTRegressionTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;Array.isArray(e["label-col"])&&(e["label-col"]=e["label-col"][0]),void 0===e["search-method"]&&(e["search-method"]="random"),t[OUT_DATA].length<5&&this.changeOutTable(t);},e.prototype.changeOutTable=function(e){e.param;var i=e[OUT_DATA],o=[];for(o.unshift(i.pop()),o.unshift(i.pop()),o.unshift(t.VA.Core.Utils.IDGenerator.table.id()),o.unshift(t.VA.Core.Utils.IDGenerator.table.id());i.length>0;){o.unshift(i.pop());}e[OUT_DATA]=o;},t.VA.Core.Tools.ModelMigrator.RuleList.autoLinearRegressionTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="random");},t.VA.Core.Tools.ModelMigrator.RuleList.autoLogisticRegressionTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="grid");},t.VA.Core.Tools.ModelMigrator.RuleList.randomForestClassificationTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="grid");},t.VA.Core.Tools.ModelMigrator.RuleList.randomForestRegressionTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["search-method"]&&(e["search-method"]="random");},t.VA.Core.Tools.ModelMigrator.RuleList.autoRegressionTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;0==Array.isArray(e.xcolumn[0])&&(e.xcolumn=[e.xcolumn]),0==Array.isArray(e.ycolumn[0])&&(e.ycolumn=[e.ycolumn]),delete e["x-step"],delete e["y-step"],delete e["line-by"];},t.VA.Core.Tools.ModelMigrator.RuleList.bigDataLine=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;0==Array.isArray(e.xcolumn[0])&&(e.xcolumn=[e.xcolumn]),0==Array.isArray(e.ycolumn[0])&&(e.ycolumn=[e.ycolumn]),delete e["x-step"],delete e["y-step"];},t.VA.Core.Tools.ModelMigrator.RuleList.bigDataScatter=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){t.func="bigDataScatter",t.name="BigDataScatter";var e=t.param;void 0===e["color-by"]&&(e["color-by"]=[]);},t.VA.Core.Tools.ModelMigrator.RuleList.chart=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.strides&&(e.strides=["1","1"]),void 0===e.padding&&(e.padding="valid");},t.VA.Core.Tools.ModelMigrator.RuleList.conv2D=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;delete e.iteration,delete e.rate;},t.VA.Core.Tools.ModelMigrator.RuleList.correlation=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["row-total-col"]&&(e["row-total-col"]=e["row-total-name"]),void 0===e["col-total-row"]&&(e["col-total-row"]=e["col-total-name"]),delete e["row-total-name"],delete e["col-total-name"];},t.VA.Core.Tools.ModelMigrator.RuleList.crossTable=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(e){var i=e.param;void 0===i["min-max-cut"]&&(i["min-max-cut"]="false"),1==e.outData.length&&e.outData.push(t.VA.Core.Utils.IDGenerator.table.id());},t.VA.Core.Tools.ModelMigrator.RuleList.dataNormalization=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){t.param.loadType||(t.param.loadType="CSV"),t.param.input_path||(t.param.input_path="");},t.VA.Core.Tools.ModelMigrator.RuleList.dlLoad=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){t.inData||(t.inData=[]);},t.VA.Core.Tools.ModelMigrator.RuleList.dlPredict=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param,i=t.etlparam;void 0===e.site&&(e.site=i.site||""),void 0===e.by&&(e.by=i.condition.by||""),void 0===e.datasource&&(e.datasource="EDS CHIP BIN");},t.VA.Core.Tools.ModelMigrator.RuleList.edsChipbin=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param,i=t.etlparam;void 0===e.site&&(e.site=i.site||""),void 0===e.by&&(e.by=i.condition.by||""),void 0===e.datasource&&(e.datasource="EDS CHIP MEASURE");},t.VA.Core.Tools.ModelMigrator.RuleList.edsChipMeasure=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param,i=t.etlparam;void 0===e.site&&(e.site=i.site||""),void 0===e.by&&(e.by=i.condition.by||""),void 0===e.datasource&&(e.datasource="EDS WAFER");},t.VA.Core.Tools.ModelMigrator.RuleList.edsWafer=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param,i=t.etlparam;void 0===e.site&&(e.site=i.site||""),void 0===e.by&&(e.by=i.condition.by||""),void 0===e.datasource&&(e.datasource="EPT");},t.VA.Core.Tools.ModelMigrator.RuleList.ept=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param,i=t.etlparam;void 0===e.site&&(e.site=i.site||""),void 0===e.by&&(e.by=i.condition.by||""),void 0===e.datasource&&(e.datasource="ERDTSUM");},t.VA.Core.Tools.ModelMigrator.RuleList.erdTSum=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param,i=t.etlparam;void 0===e.site&&(e.site=i.site||""),void 0===e.by&&(e.by=i.condition.by||""),void 0===e.datasource&&(e.datasource="FAB");},t.VA.Core.Tools.ModelMigrator.RuleList.fabData=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param,i=t.etlparam;void 0===e.site&&(e.site=i.site||""),void 0===e.by&&(e.by=i.condition.by||""),void 0===e.datasource&&(e.datasource="FABMSR");},t.VA.Core.Tools.ModelMigrator.RuleList.fabmsr=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.columns&&(e.columns=[[]]);},t.VA.Core.Tools.ModelMigrator.RuleList.gaussianMixturePredict=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.columns&&(e.columns=[[]]);},t.VA.Core.Tools.ModelMigrator.RuleList.gaussianMixtureTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){"GLMforLogisticRegression"===t.name&&(t.name="GLMTrainforLogisticRegression"),"GLM For Logistic Regression"===t.display.label&&(t.display.label="GLM Train For Logistic Regression");},t.VA.Core.Tools.ModelMigrator.RuleList.glmForLogisticRegression=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){"GLM"===t.name&&(t.name="GLMTrain"),"GLM"===t.display.label&&(t.display.label="GLM Train");},t.VA.Core.Tools.ModelMigrator.RuleList.glm=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["key-col"]&&(e["key-col"]=""),delete e["hold-columns"];},t.VA.Core.Tools.ModelMigrator.RuleList.hierarchicalClustering=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;delete e.column,delete e.groupby;},t.VA.Core.Tools.ModelMigrator.RuleList.holtWintersPredict=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(e){1==e.outData.length&&e.outData.push(t.VA.Core.Utils.IDGenerator.table.id());var i=e.param;void 0===i.columns&&(i.columns=i.column||[[]]),delete i.column,delete i.groupby;},t.VA.Core.Tools.ModelMigrator.RuleList.holtWintersTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){t.func="inputDataFrame"===t.func?"createTable":t.func,t.name="InputDataFrame"===t.name?"CreateTable":t.name,t.display.label="Input Data Frame"===t.display.label?"Create Table":t.display.label;},t.VA.Core.Tools.ModelMigrator.RuleList.inputDataFrame=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.mode&&(e.mode="");},t.VA.Core.Tools.ModelMigrator.RuleList.isotonicRegressionTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){delete t.param["features-name"];},t.VA.Core.Tools.ModelMigrator.RuleList.kmeans=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(e){1==e.outData.length&&(e.outData.push(t.VA.Core.Utils.IDGenerator.table.id()),e.outData.push(t.VA.Core.Utils.IDGenerator.table.id())),e[OUT_DATA].length<4&&this.changeOutTable(e);},e.prototype.changeOutTable=function(e){e[OUT_DATA].push(t.VA.Core.Utils.IDGenerator.table.id());},t.VA.Core.Tools.ModelMigrator.RuleList.linearRegressionTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.strides&&(e.strides=[]),void 0===e.padding&&(e.padding="valid");},t.VA.Core.Tools.ModelMigrator.RuleList.maxPooling2D=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.groupby&&(e.groupby=[]);},t.VA.Core.Tools.ModelMigrator.RuleList.multiclassClassificationEvaluation=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){delete t.param["out-col-name"];},t.VA.Core.Tools.ModelMigrator.RuleList.naiveBayesPredict=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["reg-param"]&&(e["reg-param"]=e["reg-parm"]||""),delete e["reg-parm"];},t.VA.Core.Tools.ModelMigrator.RuleList.oneVsRestLRClassifierTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(e){2==e.outData.length&&e.outData.push(t.VA.Core.Utils.IDGenerator.table.id());},t.VA.Core.Tools.ModelMigrator.RuleList.pca=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["column-labels"]&&(e["column-labels"]=[e["column-label"]]||[],delete e["column-label"]);},t.VA.Core.Tools.ModelMigrator.RuleList.pivot=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["hold-columns"]&&(e["hold-columns"]=[[]]),delete e.degree;},t.VA.Core.Tools.ModelMigrator.RuleList.polynomialExpansion=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(e){var i=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",e.func),o=$.extend(!0,{},i.defaultFnUnit);if(e.meta){var n=e.inputs;_.forEach(n,function(t,i){_.isArray(o.inputs[i])&&!_.isArray(t)&&(e.inputs[i]=[t]);});}else{i=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",e.func),o=$.extend(!0,{},i.defaultFnUnit);e.meta=o.meta,e.version=o.version,e.context=o.context,e.inputs=o.inputs,e.inputs.inputs=e[IN_DATA],e.outputs=o.outputs,_.forEach(e.param["out-table-alias"],function(t,i){e.outputs[t]=e.outData[i],e.meta[t]={type:"table"};}),delete e.inData,delete e.outData;}},t.VA.Core.Tools.ModelMigrator.RuleList.pythonScript=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.computeQ&&(e.computeQ="false");},t.VA.Core.Tools.ModelMigrator.RuleList.qrDecomposition=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.computeQ&&(e.computeQ="false");},t.VA.Core.Tools.ModelMigrator.RuleList.qrDecomposition=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.method&&(e.method="fraction"),void 0===e.value&&(e.value="0.5"),void 0===e.seed&&(e.seed=""),void 0===e.shuffle&&(e.shuffle="false"),delete e.fraction,delete e.number,delete e.model,delete e.accuracy;},t.VA.Core.Tools.ModelMigrator.RuleList.randomSampling=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(e){var i=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",e.func),o=$.extend(!0,{},i.defaultFnUnit);if(e.meta){var n=e.inputs;_.forEach(n,function(t,i){_.isArray(o.inputs[i])&&!_.isArray(t)&&(e.inputs[i]=[t]);});}else{i=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",e.func),o=$.extend(!0,{},i.defaultFnUnit);e.meta=o.meta,e.version=o.version,e.context=o.context,e.inputs=o.inputs,e.inputs.inputs=e[IN_DATA],e.outputs=o.outputs,_.forEach(e.param["out-table-alias"],function(t,i){e.outputs[t]=e.outData[i],e.meta[t]={type:"table"};}),delete e.inData,delete e.outData;}},t.VA.Core.Tools.ModelMigrator.RuleList.scalaScript=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.seed&&(e.seed=""),void 0===e.ordering&&(e.ordering="false");},t.VA.Core.Tools.ModelMigrator.RuleList.splitData=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["percentile-amounts"]&&(e["percentile-amounts"]=[]),void 0===e["trimmed-mean-amounts"]&&(e["trimmed-mean-amounts"]=[]);},t.VA.Core.Tools.ModelMigrator.RuleList.statisticDerivation=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["percentile-amounts"]&&(e["percentile-amounts"]=[]),void 0===e["trimmed-mean-amounts"]&&(e["trimmed-mean-amounts"]=[]);},t.VA.Core.Tools.ModelMigrator.RuleList.statisticSummary=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;delete e.accuracy,delete e.groups;},t.VA.Core.Tools.ModelMigrator.RuleList.stratifiedSampling=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e.column&&(e.column=e.columns||[[]]),delete e.columns;},t.VA.Core.Tools.ModelMigrator.RuleList.stringSplit=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(e){3==e.outData.length&&e.outData.push(t.VA.Core.Utils.IDGenerator.table.id());},t.VA.Core.Tools.ModelMigrator.RuleList.svd=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["hold-columns"]&&(e["hold-columns"]=[]);},t.VA.Core.Tools.ModelMigrator.RuleList.sVMRBFPredict=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;void 0===e["reg-param"]&&(e["reg-param"]=e["reg-parm"]||""),delete e["reg-parm"];},t.VA.Core.Tools.ModelMigrator.RuleList.svmTrain=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){t.display.label="Time Series Autonomous"===t.display.label?"Autonomous Time Series":t.display.label,t.outData.length>2&&t.outData.splice(2,t.outData.length-2);var e=t.param;void 0===e.score&&(e.score="trainRank");},t.VA.Core.Tools.ModelMigrator.RuleList.timeSeriesAnalysis=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){var e=t.param;1==Array.isArray(e.column[0])&&(e.column=e.column[0]);},t.VA.Core.Tools.ModelMigrator.RuleList.timeSeriesDecomposition=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){void 0===t.display.sheet.in&&(t.display.sheet.in={partial:[{panel:[],layout:{}}],full:[{panel:[],layout:{}}]}),void 0===t.display.sheet.out?t.display.sheet.out={partial:[{panel:[],layout:{}}],full:[{panel:[],layout:{}}]}:void 0===t.display.sheet.out.partial&&(t.display.sheet.out={partial:[{panel:[],layout:{}}],full:[{panel:[],layout:{}}]});},t.VA.Core.Tools.ModelMigrator.RuleList.transpose=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){}e.prototype.migrate=function(t){void 0===t.display.sheet.in&&(t.display.sheet.in={partial:[{panel:[],layout:{}}],full:[{panel:[],layout:{}}]});},t.VA.Core.Tools.ModelMigrator.RuleList.udf=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){this.initVerifier();}e.prototype.initVerifier=function(){},e.prototype.getRule=function(){return this.rule;},e.prototype.getRuleMode=function(){return this.rule?this.rule.id:void 0;},e.prototype.getSyntaxRule=function(){return this.rule?this.rule.syntaxRule:void 0;},e.prototype.getVerifyRule=function(){return this.rule?this.rule.verifyRule:void 0;},e.prototype.verify=function(t){},e.prototype.getTokenData=function(t){for(var e=0,i=[];e<t.length;){var o=!1;for(var n in this.rule.syntaxRule){var r=this.rule.syntaxRule[n].regex.exec(t.toString().substring(e));if(r&&0==r.index){i.push({token:this.rule.syntaxRule[n].token,matched:r[0],offset:e,length:r[0].length}),e+=r[0].length,o=!0;break;}}!1===o&&e++;}return i;},t.VA.Core.Verifier=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Verifier.call(this);}e.prototype=Object.create(t.VA.Core.Verifier.prototype),e.prototype.constructor=e,e.prototype.initVerifier=function(){this.rule={id:"brtc-control",syntaxRule:[{regex:/"(?:[^\\]|\\.)*?"/,token:"string"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/and|or/,token:"func"},{regex:/true|false|null|undefined/,token:"atom"},{regex:/\$\{(?:[a-zA-z_])(?:[a-zA-Z0-9_]*)\}/,token:"variable"},{regex:/\$\{(sys\.user|sys\.date)\}/g,token:"variable"},{regex:/\+|\-|\*|div|mod|=|!=|<=?|>=?/,token:"operator"},{regex:/[\{\[\(]/,token:"open-bracket",indent:!0},{regex:/[\}\]\)]/,token:"close-bracket",dedent:!0}],verifyRule:null};},e.prototype.verify=function(t){var e=[],i=this.getTokenData(t),o=this.checkUntokenizedString(t,i);if(o.length)e.push({type:"Invalid Syntax",message:"There is syntax error in this expression",data:$.extend(!0,[],o)});else{var n=this.checkOperatorPosition(i);n.length&&e.push({type:"Invalid Operator Position",message:"There is syntax error in this expression",data:$.extend(!0,[],n)});var r=this.checkOperandType(i);r.length&&e.push({type:"Invalid Operand Type",message:"There is syntax error in this expression",data:$.extend(!0,[],r)}),0!=this.checkBracketStack(i)&&e.push({type:"Invalid Bracket Stack",message:"There is syntax error in this expression"});}return e;},e.prototype.checkUntokenizedString=function(t,e){var i=[];0==e.length?i.push({"untokenized-data":t,startOffset:0,endOffset:t.toString().length,"left-token-index":void 0,"right-token-index":void 0}):0!=e[0].offset&&i.push({"untokenized-data":t.toString().substring(0,e[0].offset),startOffset:0,endOffset:e[0].offset,"left-token-index":void 0,"right-token-index":0});for(var o=0;o<e.length;o++){var n,r,a,s=e[o].offset+e[o].length;o==e.length-1?(n=t.toString().length,r=o,a=void 0):(n=e[o+1].offset,r=o,a=o+1);var l=t.toString().substring(s,n);""!==l.trim()&&i.push({"untokenized-data":l,startOffset:s,endOffset:n,"left-token-index":r,"right-token-index":a});}return i;},e.prototype.checkOperatorPosition=function(t){var e=[];return"func"!==t[0].token&&"operator"!==t[0].token||e.push({index:0,target:t[0]}),"func"!==t[t.length-1].token&&"operator"!==t[t.length-1].token||e.push({index:t.length-1,target:t[t.length-1]}),e;},e.prototype.checkOperandType=function(t){for(var e=[],i=1;i<t.length-1;i++){"func"!==t[i].token&&"operator"!==t[i].token||"func"!==t[i-1].token&&"operator"!==t[i-1].token&&"open-bracket"!==t[i-1].token&&"func"!==t[i+1].token&&"operator"!==t[i+1].token&&"close-bracket"!==t[i+1].token||e.push({index:i,target:t[i]});}return e;},e.prototype.checkBracketStack=function(t){for(var e=0,i=0;i<t.length;i++){"open-bracket"===t[i].token&&e++,"close-bracket"===t[i].token&&e--;}return e;},e.prototype.getTokenData=function(t){for(var e=0,i=[];e<t.length;){var o=!1;for(var n in this.rule.syntaxRule){var r=this.rule.syntaxRule[n].regex.exec(t.toString().substring(e));if(r&&0==r.index){i.push({token:this.rule.syntaxRule[n].token,matched:r[0],offset:e,length:r[0].length}),e+=r[0].length,o=!0;break;}}!1===o&&e++;}return i;},t.VA.Core.Verifier.CFConditionVerifier=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Verifier.call(this);}e.prototype=Object.create(t.VA.Core.Verifier.prototype),e.prototype.constructor=e,e.prototype.initVerifier=function(){this.rule={id:"brtc-controlflow-variable",syntaxRule:[{regex:/\$\{(?:[a-zA-Z0-9_]*)\}/,token:"variable"}],verifyRule:null};},e.prototype.verify=function(t){var e=this.getTokenData(t),i=[];return 0!=e.length&&0==e[0].offset&&t.length==e[0].length||i.push({type:"Invalid Syntax",message:"There is syntax error in this expression"}),i;},e.prototype.getTokenData=function(t){for(var e=0,i=[];e<t.length;){var o=!1;for(var n in this.rule.syntaxRule){var r=this.rule.syntaxRule[n].regex.exec(t.toString().substring(e));if(r&&0==r.index){i.push({token:this.rule.syntaxRule[n].token,matched:r[0],offset:e,length:r[0].length}),e+=r[0].length,o=!0;break;}}!1===o&&e++;}return i;},t.VA.Core.Verifier.CFVariableVerifier=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Verifier.call(this);}e.prototype=Object.create(t.VA.Core.Verifier.prototype),e.prototype.constructor=e,e.prototype.initVerifier=function(){this.rule={id:"brtc-va-condition-rule",syntaxRule:[{regex:/\[(?:[^\"\[\]\(\)])*?\]/,token:"column"},{regex:/true|false|null|undefined/,token:"atom"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/[-+\/*=<>!]+/,token:"operator"},{regex:/([A-z])\w+/,token:"string"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0}],verifyRule:null};},e.prototype.getTokenData=function(t){for(var e=0,i=this.rule.syntaxRule,o=[];e<t.length;){var n=!1;for(var r in i){var a=i[r].regex.exec(t.substring(e));if(a&&0==a.index){o.push(a[0]),e+=a[0].length,n=!0;break;}}!1===n&&e++;}return o;},e.prototype.verify=function(t){return null;},t.VA.Core.Verifier.ConditionVerifier=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Verifier.call(this);}e.prototype=Object.create(t.VA.Core.Verifier.prototype),e.prototype.constructor=e,e.prototype.initVerifier=function(){this.rule={id:"brtc-va-numerical-formula-rule",syntaxRule:[{regex:/"(?:[^\\]|\\.)*?"/,token:"string"},{regex:/\[(?:[^\"\[\]\(\)])*?\]/,token:"column"},{regex:/true|false|null|undefined/,token:"atom"},{regex:/0x[a-f\d]+|[-+]?(?:\.\d+|\d+\.?\d*)(?:e[-+]?\d+)?/i,token:"number"},{regex:/(?:pow|exp|log10|log2|ln|sin|cos|tan|asin|acos|atan|sinh|cosh|tanh|degrees|radians|round|floor|ceil|sqrt|abs)\b/,token:"func"},{regex:/[-+\/*%]+/,token:"operator"},{regex:/[\{\[\(]/,indent:!0},{regex:/[\}\]\)]/,dedent:!0}],verifyRule:null};},e.prototype.verify=function(t){var e=this.getTokenData(t),i=[];return 0!=e.length&&0==e[0].offset||i.push({type:"Invalid Syntax",message:"There is syntax error in this expression"}),i;},e.prototype.getTokenData=function(t){for(var e=0,i=[];e<t.length;){var o=!1;for(var n in this.rule.syntaxRule){var r=this.rule.syntaxRule[n].regex.exec(t.substring(e));if(r&&0==r.index){i.push({token:this.rule.syntaxRule[n].token,matched:r[0],offset:e,length:r[0].length}),e+=r[0].length,o=!0;break;}}!1===o&&e++;}return i;},t.VA.Core.Verifier.NumericalFormulaVerifier=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Verifier.call(this);}e.prototype=Object.create(t.VA.Core.Verifier.prototype),e.prototype.constructor=e,e.prototype.initVerifier=function(){this.rule={id:"text/x-scala",syntaxRule:"default",verifyRule:"default"};},e.prototype.verify=function(t){return null;},t.VA.Core.Verifier.ScalaVerifier=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Verifier.call(this);}e.prototype=Object.create(t.VA.Core.Verifier.prototype),e.prototype.constructor=e,e.prototype.initVerifier=function(){this.rule={id:"sql",syntaxRule:"default",verifyRule:"default"};},e.prototype.verify=function(t){return null;},t.VA.Core.Verifier.SqlVerifier=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Verifier.call(this);}e.prototype=Object.create(t.VA.Core.Verifier.prototype),e.prototype.constructor=e,e.prototype.initVerifier=function(){this.rule={id:"brtc-system-variable",syntaxRule:[{regex:/\$\{(?:[a-zA-z_])(?:[a-zA-Z0-9_]*)\}/,token:"no-variable"},{regex:/\$\{(sys\.user|sys\.date)\}/g,token:"variable"}],verifyRule:null};},e.prototype.verify=function(t){return[];},t.VA.Core.Verifier.SystemVariableVerifier=e;}.call(this),function(){"use strict";var t=this.Brightics;var e={func:"dummy",name:"BigDataDummy",inData:[],outData:[],param:{},label:"Big Data Dummy",display:{label:"Big Data Dummy",diagram:{position:{x:20,y:10}},sheet:{out:[{panel:[],layout:{}}]}},mandatory:[]},i={scatter:"bigDataScatter",line:"bigDataLine",area:"bigDataLine","area-stacked":"bigDataColumn","area-stacked-100":"bigDataColumn",roccurve:"bigDataLine",pie:"bigDataPie",column:"bigDataColumn","column-stacked":"bigDataColumn","column-stacked-100":"bigDataColumn",bar:"bigDataColumn","bar-stacked":"bigDataColumn","bar-stacked-100":"bigDataColumn",histogram:"bigDataHistogram",boxplot:"bigDataBoxPlot",bubble:"bigDataBubble",card:"bigDataCard",heatmap:"bigDataHeatmap","heatmap-matrix":"bigDataHeatmapMatrix",treemap:"bigDataTreemap",donut:"bigDataPie"};function o(t){this.options=t||{};}o.prototype.initFnUnit=function(){var o=this.options.chartOptions.chart.type,n=i[o],r=t.VA.Core.Functions.Library.getFunction(n).defaultFnUnit;r||(r=$.extend(!0,{},e)),r.fid=t.VA.Core.Utils.IDGenerator.func.id(),this.fnUnit=r;},o.prototype.inputParams=function(){},o.prototype.setColorByParam=function(){var t=this.options.chartOptions,e=this.fnUnit.param;if(t.colorBy&&t.colorBy[0]&&t.colorBy[0].selected)for(var i in t.colorBy[0].selected){t.colorBy[0].selected[i]&&t.colorBy[0].selected[i].name&&(_.isEmpty(e["color-by"])&&(e["color-by"]=[]),e["color-by"].push(t.colorBy[0].selected[i].name));}},o.prototype.setAggregationParam=function(){var t=this.fnUnit.param,e=this.aggregation;e&&""!=e?("average"==e&&(e="avg"),"unique_count"==e&&(e="ucount"),t.aggregation=e):delete t.aggregation;},o.prototype.generate=function(){return this.initFnUnit(),this.inputParams(),$.extend(!0,{},this.fnUnit);},t.VA.Core.Utils.FnUnitGenerator=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setColorByParam();},t.VA.Core.Utils.FnUnitGenerator.area=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setStackByParam();},e.prototype.setStackByParam=function(){var t=this.options.chartOptions.plotOptions.area,e=this.fnUnit.param;if(t.stackBy&&t.stackBy[0]&&t.stackBy[0].selected)for(var i in t.stackBy[0].selected){t.stackBy[0].selected[i]&&t.stackBy[0].selected[i].name&&e["color-by"].push(t.stackBy[0].selected[i].name);}else e["color-by"]=[];},t.VA.Core.Utils.FnUnitGenerator["area-stacked-100"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setStackByParam();},e.prototype.setStackByParam=function(){var t=this.options.chartOptions.plotOptions.area,e=this.fnUnit.param;if(t.stackBy&&t.stackBy[0]&&t.stackBy[0].selected)for(var i in t.stackBy[0].selected){t.stackBy[0].selected[i]&&t.stackBy[0].selected[i].name&&e["color-by"].push(t.stackBy[0].selected[i].name);}else e["color-by"]=[];},t.VA.Core.Utils.FnUnitGenerator["area-stacked"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]],this.aggregation=e.xAxis[0].selected[0].aggregation),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]]),this.setAggregationParam(),this.setColorByParam();},t.VA.Core.Utils.FnUnitGenerator.bar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]],this.aggregation=e.xAxis[0].selected[0].aggregation),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]]),this.setAggregationParam(),this.setStackByParam();},e.prototype.setStackByParam=function(){var t=this.options.chartOptions.plotOptions.bar,e=this.fnUnit.param;if(t.stackBy&&t.stackBy[0]&&t.stackBy[0].selected)for(var i in t.stackBy[0].selected){t.stackBy[0].selected[i]&&t.stackBy[0].selected[i].name&&e["color-by"].push(t.stackBy[0].selected[i].name);}else e["color-by"]=[];},t.VA.Core.Utils.FnUnitGenerator["bar-stacked"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]],this.aggregation=e.xAxis[0].selected[0].aggregation),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]]),this.setAggregationParam(),this.setStackByParam();},e.prototype.setStackByParam=function(){var t=this.options.chartOptions.plotOptions.bar,e=this.fnUnit.param;if(t.stackBy&&t.stackBy[0]&&t.stackBy[0].selected)for(var i in t.stackBy[0].selected){t.stackBy[0].selected[i]&&t.stackBy[0].selected[i].name&&e["color-by"].push(t.stackBy[0].selected[i].name);}else e["color-by"]=[];},t.VA.Core.Utils.FnUnitGenerator["bar-stacked-100"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]]);},t.VA.Core.Utils.FnUnitGenerator.boxplot=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]]),this.setColorByParam(),this.setSizeByParam();},e.prototype.setSizeByParam=function(){var t=this.options.chartOptions.plotOptions.bubble,e=this.fnUnit.param;if(t.sizeBy&&t.sizeBy[0]&&t.sizeBy[0].selected)for(var i in t.sizeBy[0].selected){t.sizeBy[0].selected[i]&&t.sizeBy[0].selected[i].name&&(e["size-by"].push(t.sizeBy[0].selected[i].name),e.aggregation=t.sizeBy[0].selected[0].aggregation);}else e["size-by"]=[];},t.VA.Core.Utils.FnUnitGenerator.bubble=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.plotOptions.card&&e.plotOptions.card.valueBy&&e.plotOptions.card.valueBy[0]&&e.plotOptions.card.valueBy[0].selected[0]&&(t.value=[[e.plotOptions.card.valueBy[0].selected[0].name]],this.aggregation=e.plotOptions.card.valueBy[0].selected[0].aggregation),this.setAggregationParam();},t.VA.Core.Utils.FnUnitGenerator.card=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setColorByParam();},t.VA.Core.Utils.FnUnitGenerator.column=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setStackByParam();},e.prototype.setStackByParam=function(){var t=this.options.chartOptions.plotOptions.column,e=this.fnUnit.param;if(t.stackBy&&t.stackBy[0]&&t.stackBy[0].selected)for(var i in t.stackBy[0].selected){t.stackBy[0].selected[i]&&t.stackBy[0].selected[i].name&&e["color-by"].push(t.stackBy[0].selected[i].name);}},t.VA.Core.Utils.FnUnitGenerator["column-stacked-100"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setStackByParam();},e.prototype.setStackByParam=function(){var t=this.options.chartOptions.plotOptions.column,e=this.fnUnit.param;if(t.stackBy&&t.stackBy[0]&&t.stackBy[0].selected)for(var i in t.stackBy[0].selected){t.stackBy[0].selected[i]&&t.stackBy[0].selected[i].name&&e["color-by"].push(t.stackBy[0].selected[i].name);}},t.VA.Core.Utils.FnUnitGenerator["column-stacked"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.plotOptions.donut&&e.plotOptions.donut.sizeBy&&e.plotOptions.donut.sizeBy[0]&&e.plotOptions.donut.sizeBy[0].selected[0]?(t["size-by"]=[e.plotOptions.donut.sizeBy[0].selected[0].name],this.aggregation=e.plotOptions.donut.sizeBy[0].selected[0].aggregation):t["size-by"]=[[]],this.setAggregationParam(),this.setColorByParam();},t.VA.Core.Utils.FnUnitGenerator.donut=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]]),this.setValueByParam(),this.setAggregationParam();},e.prototype.setValueByParam=function(){var t=this.options.chartOptions.plotOptions.heatmap,e=this.fnUnit.param;if(t.valueBy&&t.valueBy[0]&&t.valueBy[0].selected)for(var i in t.valueBy[0].selected){t.valueBy[0].selected[i]&&t.valueBy[0].selected[i].name&&(e["value-by"].push(t.valueBy[0].selected[i].name),this.aggregation=t.valueBy[0].selected[0].aggregation);}else e["value-by"]=[];},t.VA.Core.Utils.FnUnitGenerator.heatmap=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;if(this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected)for(var i in t.xcolumn=[],e.xAxis[0].selected){e.xAxis[0].selected[i]&&e.xAxis[0].selected[i].name&&t.xcolumn.push([e.xAxis[0].selected[i].name]);}e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[e.yAxis[0].selected[0].name]]);},t.VA.Core.Utils.FnUnitGenerator["heatmap-matrix"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.column=this.options.chartOptions.xAxis[0].selected[0].name);},t.VA.Core.Utils.FnUnitGenerator.histogram=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setColorByParam();},t.VA.Core.Utils.FnUnitGenerator.line=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.plotOptions.pie&&e.plotOptions.pie.sizeBy&&e.plotOptions.pie.sizeBy[0]&&e.plotOptions.pie.sizeBy[0].selected[0]?(t["size-by"]=[e.plotOptions.pie.sizeBy[0].selected[0].name],this.aggregation=e.plotOptions.pie.sizeBy[0].selected[0].aggregation):t["size-by"]=[[]],this.setAggregationParam(),this.setColorByParam();},t.VA.Core.Utils.FnUnitGenerator.pie=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setColorByParam();},t.VA.Core.Utils.FnUnitGenerator.roccurve=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;this.aggregation="",e.xAxis&&e.xAxis[0]&&e.xAxis[0].selected&&e.xAxis[0].selected[0]&&(t.xcolumn=[[this.options.chartOptions.xAxis[0].selected[0].name]]),e.yAxis&&e.yAxis[0]&&e.yAxis[0].selected&&e.yAxis[0].selected[0]&&(t.ycolumn=[[this.options.chartOptions.yAxis[0].selected[0].name]],this.aggregation=e.yAxis[0].selected[0].aggregation),this.setAggregationParam(),this.setColorByParam();},t.VA.Core.Utils.FnUnitGenerator.scatter=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Utils.FnUnitGenerator.call(this,e);}e.prototype=Object.create(t.VA.Core.Utils.FnUnitGenerator.prototype),e.prototype.constructor=e,e.prototype.inputParams=function(){var t=this.fnUnit.param,e=this.options.chartOptions;if(this.aggregation="",e.plotOptions.treemap&&e.plotOptions.treemap.hierarchyCol&&e.plotOptions.treemap.hierarchyCol[0])for(var i in t.hierarchy=[],e.plotOptions.treemap.hierarchyCol[0].selected){e.plotOptions.treemap.hierarchyCol[0].selected[i]&&e.plotOptions.treemap.hierarchyCol[0].selected[i].name&&t.hierarchy.push([e.plotOptions.treemap.hierarchyCol[0].selected[i].name]);}e.plotOptions.treemap&&e.plotOptions.treemap.sizeBy&&e.plotOptions.treemap.sizeBy[0]&&e.plotOptions.treemap.sizeBy[0].selected[0]&&(t["size-by"]=[e.plotOptions.treemap.sizeBy[0].selected[0].name],this.aggregation=e.plotOptions.treemap.sizeBy[0].selected[0].aggregation),this.setAggregationParam();},t.VA.Core.Utils.FnUnitGenerator.treemap=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.options=t||{},this.FnUnitUtils=brtc_require("FnUnitUtils"),this.init();}e.prototype.init=function(){this.problemFactory=new t.VA.Core.Validator.ProblemFactory(),this.rule=[],this.initRules();},e.prototype.validate=function(t,e){var i=[];for(var o in this.options.model=e,this.problemFactory.mid=e.mid,this.rule){var n=this.rule[o].bind(this)(t);n&&(i=i.concat(n));}return i;},e.prototype.isEmptyForObject=function(t){return 0==Object.keys(t);},e.prototype.isEmptyForArray=function(t){return!t[0]||(t[0].constructor==Array?!t[0][0]:!t[0]);},e.prototype.isEmptyForString=function(t){return!t;},e.prototype.isConnectedWithPrev=function(t,e){var i=1;return e&&(i=e),t.parent().getPrevious(t.fid).length===i;},e.prototype.initRules=function(){},e.prototype.addRule=function(t){t&&this.rule.push(t);},e.prototype.isUndefinedForArray=function(t){return void 0===t[0]||t[0].constructor==Array&&void 0===t[0][0];},e.prototype.checkLinkIsConnected=function(e){if(this.FnUnitUtils.hasMeta(e)){if(!this.FnUnitUtils.hasInput(e))return;var i=this.FnUnitUtils.getInputs(e);for(var o in i){_.isEmpty(i[o])&&(n={errorCode:"BR-0059",messageParam:["Inputs",this.FnUnitUtils.getTotalInRangeCount(e).min]});}if(!_.isEmpty(n))return this.problemFactory.createProblem(n,e);}else{if(!this.FnUnitUtils.getInTable(e))return;var n,r=e.parent().type,a=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(r,e.func)["in-range"],s=this.FnUnitUtils.getInTable(e).length;if(a.min===a.max&&a.min!=s?n={errorCode:"BR-0059",messageParam:["Inputs",a.min]}:a.min!==a.max&&(s<a.min?n={errorCode:"BR-0024",messageParam:["Inputs",a.min]}:s>a.max&&(n={errorCode:"BR-0022",messageParam:["Inputs",a.max]})),n)return this.problemFactory.createProblem(n,e);}},e.prototype.inputLinkRule=function(){this.addRule(function(t){var e={errorCode:"EL001",messageParam:[t.display.label]};if(!this._hasPrevious(t))return this.problemFactory.createProblem(e,t);});},e.prototype.emptyColumnsRule=function(t,e){this.addRule(function(i){var o={errorCode:"BR-0033",param:t,messageParam:[e]};if(this.isEmptyForArray(i.param[t]))return this.problemFactory.createProblem(o,i);});},e.prototype.notExistColumnRule=function(e){this.addRule(function(i){var o=t.VA.Core.DataQueryTemplate.getSchema(i.parent().mid,this.FnUnitUtils.getInTable(i));if(void 0!==o){var n={errorCode:"EI001",param:e,messageParam:[]},r=[],a=i.param[e][0];if(0!==a.length){for(var s in a){var l=a[s],c=!1;for(var d in o){if(o[d].name==l){c=!0;break;}}c||r.push("["+l+"]");}return r.length>0?(n.messageParam=[r],this.problemFactory.createProblem(n,i)):void 0;}}});},e.prototype.invalidColumnTypeRule=function(e,i,o){this.addRule(function(n){var r={errorCode:"ET002",param:e,messageParam:[o]},a=[],s=t.VA.Core.DataQueryTemplate.getSchema(n.parent().mid,this.FnUnitUtils.getInTable(n)),l=n.param[e][0];if(0!==l.length){for(var c in l){var d=!1;if(void 0===s)return;for(var p in s){if(l[c]===s[p].name&&i===s[p].type){d=!0;break;}}d||a.push(this.problemFactory.createProblem(r,n));}return a;}});},e.prototype.emptyProblemMessage=function(t,e,i,o){var n={errorCode:"BR-0033",param:e,messageParam:[o||e]};if(this.isEmptyForString(i))return this.problemFactory.createProblem(n,t);},e.prototype.emptyNumberRule=function(t,e){var i=this;this.addRule(function(o){i.emptyProblemMessage(o,t,e);});},e.prototype.emptyStringRule=function(t,e){var i=this;this.addRule(function(o){i.emptyProblemMessage(o,t,e);});},e.prototype.emptyComboBoxRule=function(t,e){var i=this;this.addRule(function(o){i.emptyProblemMessage(o,t,e);});},e.prototype.equalColumnInDataRule=function(e,i){this.addRule(function(o){var n={errorCode:"EE007",param:e,messageParam:[i]},r=[],a=t.VA.Core.DataQueryTemplate.getSchema(o.parent().mid,this.FnUnitUtils.getInTable(o)),s=o.param[e][0];if(0!==s.length){for(var l in s){var c=!1;for(var d in a){if(s[l]===a[d].name){c=!0;break;}}c||r.push(this.problemFactory.createProblem(n,o));}return r;}});},e.prototype.addNewColumnNameRule=function(e){var i=this;this.addRule(function(o){if(i._hasPrevious(o)){if(!o.param[e])return;var n={errorCode:"BR-0045",param:e,messageParam:[o.param[e]]};if(o.param[e].constructor==Array){var r=[];for(var a in o.param[e]){o.param[e][a]&&(t.VA.Core.Utils.InputValidator.isValid.columnNameType(o.param[e][a])||(n.paramIndex=a,r.push(this.problemFactory.createProblem(n,o))));}return r;}if(!t.VA.Core.Utils.InputValidator.isValid.columnNameType(o.param[e]))return this.problemFactory.createProblem(n,o);}});},e.prototype.addBaseGroupByRule=function(e,i,o){e&&(o=o||"groupby",this.addRule(function(n){if(void 0!==t.VA.Core.DataQueryTemplate.getSchema(n.parent().mid,this.FnUnitUtils.getInTable(n)[0])){var r,a=[],s=n.param[o];if(n.param[e].constructor===Array){if((r=n.param[e][0])&&r.length)for(var l in s){r.indexOf(s[l])>-1&&a.push(s[l]);}}else if(n.param[e].constructor===String&&(r=n.param[e]))for(var c in s){r===s[c]&&a.push(s[c]);}if(a.length){var d={errorCode:"BR-0057",param:o};return 1==a.length?d.messageParam=[a[0],i,"Group By"]:d.messageParam=[JSON.stringify(a),i,"Group By"],this.problemFactory.createProblem(d,n);}}}));},e.prototype._isEmptyArray=function(t){return!t[0];},e.prototype._isEmptyString=function(t){return!t;},e.prototype._hasPrevious=function(t){return 0!==t.parent().getPrevious(t.fid).length;},e.prototype._hasIntables=function(t){return!!(this.FnUnitUtils.getInTable(t)&&this.FnUnitUtils.getInTable(t).length>0);},e.prototype._checkStringIsEmpty=function(t,e,i){if(this._isEmptyString(i))return this.problemFactory.createProblem(t,e);},e.prototype._checkArrayIsEmpty=function(t,e,i){if(!i||this._isEmptyArray(i))return this.problemFactory.createProblem(t,e);},e.prototype._checkArrayIsCompact=function(t,e,i,o,n){if(!i||!Array.isArray(i)||!i.every(function(t){return"String"===n?!!t:!_.isNull(t)&&!_.isUndefined(t);}))return this.problemFactory.createProblem(t,e);},e.prototype.getArrayConflicted=function(t){for(var e=[],i=1;i<arguments.length;i++){$.isArray(arguments[i])&&(e=e.concat(arguments[i]));}return $.unique(e),$.grep(t,function(t,i){return""!==t&&-1!==$.inArray(t,e);});},e.prototype.createProblemForConflicted=function(t,e,i,o,n){var r;if($.isArray(t)&&t.length)return r=1==t.length?{errorCode:"BR-0057",param:e,messageParam:[t[0],i,o]}:{errorCode:"BR-0057",param:e,messageParam:[JSON.stringify(t),i,o]},this.problemFactory.createProblem(r,n);},t.VA.Core.Validator.BaseValidator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Validator.BaseValidator.call(this);}e.prototype=Object.create(t.VA.Core.Validator.BaseValidator.prototype),e.prototype.constructor=e,e.prototype.initRules=function(){this.addLinkRule(),this.addInTableRule();},e.prototype.addLinkRule=function(){var t=this;this.addRule(function(e){return t.checkLinkIsConnected(e);});},e.prototype.addInTableRule=function(){var t=this;this.addRule(function(e){return t.checkInTableIsEmpty(e);});},e.prototype.checkInTableIsEmpty=function(t){var e={errorCode:"BR-0138",messageParam:[]},i=t.parent().getFnUnitById(t.parent().getPrevious(t.fid)[0]);if(this._hasIntables(t))return this._getSchema(t)&&0!==this._getSchema(t).length?void 0:(e.messageParam.push(i.display.label),this.problemFactory.createProblem(e,t));},e.prototype.checkColumnIsEmpty=function(t,e,i,o,n){if(this._hasSchema(t)){var r=!0;if(JSON.stringify(i,function(t,e){if(!("string"==typeof e&&e.length>0))return e;r=!1;}),r){var a={errorCode:"BR-0033",param:e,messageParam:[o],paramIndex:n};return this.problemFactory.createProblem(a,t);}}},e.prototype.checkColumnExists=function(t,e,i,o){if(this._hasSchema(t,o)){var n=[];if(JSON.stringify(i,function(t,e){if(!("string"==typeof e&&e.length>0))return e;n.push(e);}),0!=n.length){var r=this._getSchema(t,o||0),a=$.map(r,function(t){return t.name;}),s=[];for(var l in n){$.inArray(n[l],a)<0&&s.push(n[l]);}if(s.length>0){var c={errorCode:"BR-0001",param:e,messageParam:[s.join(", ")]};return this.problemFactory.createProblem(c,t);}}}},e.prototype.checkColumnType=function(t,e,i,o,n){if(this._hasSchema(t)){var r=[];if(JSON.stringify(i,function(t,e){if(!("string"==typeof e&&e.length>0))return e;r.push(e);}),0!=r.length){var a=Array.isArray(o)?o:[o],s=this._getSchema(t,n||0),l=[];for(var c in r){$.each(s,function(t,e){if(r[c]==e.name&&$.inArray(e.type,a)<0&&$.inArray(e.internalType,a)<0)return l.push(r[c]),!1;});}if(l.length>0){var d={errorCode:"BR-0002",param:e,messageParam:[l.join(", "),o]};return this.problemFactory.createProblem(d,t);}}}},e.prototype.checkSingleNumberArray=function(t,e,i,o){var n=this._getSchema(t,o||0),r=0,a={errorCode:"ET006",param:e,messageParam:[]};for(var s in i){for(var l in n){if(i[s]===n[l].name&&"number[]"===n[l].type.toLowerCase()){r++;break;}}}if(r>1)return this.problemFactory.createProblem(a,t);},e.prototype.checkSingleColumnType=function(t,e,i,o,n){var r=this._getSchema(t,n||0),a={errorCode:"ET009",param:e,messageParam:[o.join(", ")]},s=i.length,l=0;for(var c in i){for(var d in r){if(i[c]===r[d].name){var p=!1;for(var u in o){if(r[d].type===o[u]||r[d].internalType===o[u]){l++,p=!0;break;}}if(p)break;}}}if(s>1&&0!=l)return this.problemFactory.createProblem(a,t);},e.prototype.checkNumberArray=function(t,e,i,o){var n=this._getSchema(t,o||0),r=0,a=0,s={errorCode:"ET005",param:e,messageParam:[]};for(var l in i){for(var c in n){if(i[l]===n[c].name){if("number"===n[c].type.toLowerCase()){r++;break;}if("number[]"===n[c].type.toLowerCase()){a++;break;}}}}if(r*a>0)return this.problemFactory.createProblem(s,t);},e.prototype.checkNewColumnName=function(e,i,o){if(this._hasSchema(e)&&o){var n={errorCode:"BR-0045",param:i,messageParam:[]};return t.VA.Core.Utils.InputValidator.isValid.columnNameType(o)?void 0:this.problemFactory.createProblem(n,e);}},e.prototype._getSchema=function(e,i){var o=t.VA.Core.DataQueryTemplate.getSchema(e.parent().mid,this.FnUnitUtils.getInTable(e)[i||0]);return o&&0===o.length&&(o=void 0),o;},e.prototype._hasSchema=function(t,e){return this._getSchema(t,e);},t.VA.Core.Validator.SingleInputValidator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Validator.SingleInputValidator.call(this);}e.prototype=Object.create(t.VA.Core.Validator.SingleInputValidator.prototype),e.prototype.constructor=e,e.prototype.initRules=function(){t.VA.Core.Validator.SingleInputValidator.prototype.initRules.call(this);},e.prototype.checkInTableIsEmpty=function(t,e){var i={errorCode:"BR-0138",messageParam:[[]]};if(e=void 0===e||"number"!=typeof e?2:e,this.FnUnitUtils.getInTable(t).length===e){for(var o,n=0;n<e;n++){o=t.parent().getFnUnitByOutTable(this.FnUnitUtils.getInTable(t)[n]),this._getSchema(t,n)||i.messageParam[0].push("["+o.display.label+"]");}return i.messageParam[0].length>0?this.problemFactory.createProblem(i,t):void 0;}},e.prototype._hasSchema=function(t){return this._getSchema(t,0)&&this._getSchema(t,1);},t.VA.Core.Validator.PairInputValidator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Validator.SingleInputValidator.call(this);}e.prototype=Object.create(t.VA.Core.Validator.SingleInputValidator.prototype),e.prototype.constructor=e,e.prototype.initRules=function(){t.VA.Core.Validator.SingleInputValidator.prototype.initRules.call(this);},e.prototype.checkInTableIsEmpty=function(e){var i={errorCode:"BR-0138",messageParam:[[]]},o=e.parent().getPrevious(e.fid),n=e.parent().type,r=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(n,e.func)["in-range"],a=e.parent().getPrevious(e.fid);if(!(a.length>r.max||a.length<r.min)){for(var s=0;s<o.length;s++){var l=e.parent().getFnUnitById(o[s]);this._getSchema(e,s)||i.messageParam[0].push("["+l.display.label+"]");}return i.messageParam[0].length>0?this.problemFactory.createProblem(i,e):void 0;}},t.VA.Core.Validator.MultiInputValidator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){this.initRule();}e.prototype.initRule=function(){this.rule={EE001:{level:"error",message:'"[0]" field is required.'},EE002:{level:"error",message:'Please check out [1]th value of "[0]".'},EE003:{level:"error",message:"Please check out [1] row [2]th value of [[0]]."},EE004:{level:"error",message:'Must be valid "[0]"'},EE005:{level:"error",message:'One of the "[0]" and "[1]" fields are required.'},EE006:{level:"error",message:'One or more "[0]" tables are required.'},EE007:{level:"error",message:'Must be different "[0]" from columnName of In-Data'},EE009:{level:"error",message:"More than [0] [1] values is required."},EE010:{level:"error",message:'"[0]", "[1]" are required.'},EE011:{level:"error",message:'This column "[0]" already exists in other parameter.'},EE012:{level:"error",message:"The number of columns must be two."},EE013:{level:"error",message:'This column "[0]" duplicates the selection in Columns above.'},EE014:{level:"error",message:'This column "[0]" is not allowed.'},EC001:{level:"error",message:"[0] must greater than or equals to [1]"},EC002:{level:"error",message:'"[0]" must be less than "[1]".'},EC003:{level:"error",message:'"[0]" must be greater than "[1]"'},EL001:{level:"error",message:"Link connection is required."},EL002:{level:"error",message:'"[0]" requires two in-tables.'},EL003:{level:"error",message:'"[0]" must be equal to "[1]".'},EL004:{level:"error",message:"The column is invalid in [[0]]."},EL006:{level:"error",message:'"[0]" is required more than two link connections.'},EL007:{level:"error",message:'"[0]" is required more than three link connections.'},EL008:{level:"error",message:'"[0]" is required three link connections.'},ET001:{level:"error",message:'"[0]" contains invalid characters.'},ET002:{level:"error",message:"[[0]] type is invalid."},ET003:{level:"error",message:"[0] type is invalid."},ET004:{level:"error",message:"[0] is invalid operator."},ET005:{level:"error",message:"number only or number[] only."},ET006:{level:"error",message:"only one number[] type column is allowed."},ET007:{level:"error",message:"only one string type column is allowed."},ET008:{level:"error",message:"only one column is allowed."},ET009:{level:"error",message:"Only one column is allowed if column type is one of ([0])."},ER001:{level:"error",message:"[0]"},EX001:{level:"error",message:"[[0]] does not exist."},EX002:{level:"error",message:'"[0]" does not exist.'},EX003:{level:"error",message:'"[0]" already exists.'},EX004:{level:"error",message:'"[0]" already exists in previous.'},EX005:{level:"error",message:'"[0]" does not exist in previous.'},WI001:{level:"warning",message:"Input from [0] does not exist."},WI002:{level:"warning",message:"Input from [[0]] does not exist."},EN001:{level:"error",message:"If the column name begins with _ or is only a number, it may be a problem in some functions later."},ED001:{level:"error",message:'"[0]" column is already chosen for "[1]" parameter.'},ED002:{level:"error",message:'[[0]] column is already chosen for "[1]" parameter.'},ED003:{level:"error",message:"[0] Change Name field is no changed."},ED004:{level:"error",message:'[0] columns are already chosen for "[1]" parameter.'},EP001:{level:"error",message:'"[0]" must start with "/shared/upload" or "/{userid}/upload".'},EP002:{level:"error",message:'"[0]" can not start with "/shared/upload" or "/{userid}/upload".'},EF001:{level:"error",message:"This UDF[[0]] is not available."},EF002:{level:"error",message:"This function[[0]] is not available."},"BR-0113":{level:"error",message:"Data Flow does not exist."},EI001:{level:"error",message:"Model does not exist."},EI002:{level:"warning",message:"Model specification is changed."}};},e.prototype.createProblem=function(t,e){if(t)return t.messageParam=this._createMessageParam(e,t.messageParam),{mid:this.mid,fid:e.fid,param:t.param,paramIndex:t.paramIndex,code:t.errorCode,message:this.makeMessage(t),mode:t.mode};},e.prototype._createMessageParam=function(e,i){if(e&&"function"==typeof e.parent&&"function"==typeof e.parent().getFnUnitNameById){var o=e.parent().getFnUnitNameById(e.fid);return t.VA.Core.Utils.MessageUtils.getFunctionLabels(o,i);}return i;},e.prototype.makeMessage=function(e){if(this.rule[e.errorCode])return this._createMessage(e);var i=t.VA.Core.Utils.MessageUtils.getMessage(e.errorCode,e.messageParam);return i||void 0;},e.prototype._createMessage=function(t){console.warn("This Error Code["+t.errorCode+"] should be deprecated");var e=this.rule[t.errorCode].message;for(var i in t.messageParam){var o=t.messageParam[i];if(e.indexOf("%s")<0){var n="["+i+"]";"number"==typeof o&&(o=String(o)),e=e.replace(n,o);}else e=e.replace("%s",o);}return e;},t.VA.Core.Validator.ProblemFactory=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,o){this.parentId=e,this.options=o,i.bind(this)(),this.init(),this.createControls.bind(this)(),this.modelLayoutManager=new t.VA.Core.Interface.ModelLayoutManager[this.options.clazz](this),this.sideBarManager=new t.VA.Core.Interface.SideBarManager[this.options.clazz](this),this.modelLayoutManager.initEditorSelectionChangeListener(),this.modelLayoutManager.adjustLayout();}var i=function i(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);};e.prototype.init=function(){this.StatusBoard=brtc_require("StatusBoard");},e.prototype.checkInfo=function(){_.isEqual(localStorage.getItem("info.script.show"),"false")||this.openScriptInfoDialog();},e.prototype.openScriptInfoDialog=function(){new t.VA.Core.Dialogs.ScriptInfoDialog(this.$mainControl,{type:"warn",modal:!0,isCancel:!1});},e.prototype.createControls=function(){console.error("createControls must be implemented");},e.prototype.save=function(e,i){var o,n=this,r=this.options.editorInput;r.setUpdater(t.VA.Env.Session.userId),delete r.getContents().problemList,((o=i)?Studio.getResourceManager().saveFile(r.getProjectId(),r,o):Studio.getResourceManager().updateFile(r.getProjectId(),r)).catch(function(e){var i=n.getPrimaryErrorCode(e);32031==i&&Studio.getLayoutManager().closeEditor(r),t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e,function(){32031==i&&Studio.getResourceManager().fetchFile(r.getProjectId(),r.getFileId()).then(function(t){Studio.getInstance().reloadResource(function(){Studio.getLayoutManager().openEditor(t);});}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});});});},e.prototype.getPrimaryErrorCode=function(t){var e=t.responseJSON;if(e&&e.errors&&e.errors.length>0)return e.errors[0].code;},e.prototype.initEditorSelectionChangeListener=function(){var t=this;this.$mainControl.bind("editorSelectionChanged",function(e,i){t.getModelLayoutManager().handleEditorSelectionChange(i);});},e.prototype.initUDFChangeListener=function(){},e.prototype.fireUDFChanged=function(t){},e.prototype.setSelection=function(t){},e.prototype.addToLibrary=function(t){},e.prototype.addToClipboard=function(t){},e.prototype.resize=function(){},e.prototype.createToolbar=function(){t.VA.Core.Interface.Toolbar[this.options.clazz]&&"function"==typeof t.VA.Core.Interface.Toolbar[this.options.clazz]&&(this.toolbar=new t.VA.Core.Interface.Toolbar[this.options.clazz](this.$mainControl.find(".brtc-style-editor-toolbar-area"),{editor:this}));},e.prototype.destroy=function(){console.error("destroy must be implemented.");},e.prototype.getToolbar=function(){return this.toolbar;},e.prototype.getModelLayoutManager=function(){return this.modelLayoutManager;},e.prototype.getSideBarManager=function(){return this.sideBarManager;},e.prototype.getMainArea=function(){console.error("getMainArea must be implemented.");},e.prototype.getHeaderArea=function(){console.error("getHeaderArea must be implemented.");},e.prototype.getLeftTabBarArea=function(){console.error("getLeftTabBarArea must be implemented.");},e.prototype.getRightTabBarArea=function(){console.error("getRightTabBarArea must be implemented.");},e.prototype.preProcess=function(){return Promise.resolve();},e.prototype.registerCommandCallback=function(){this.getCommandManager().registerCallback(Studio.getInstance().onCommand.bind(Studio.getInstance())),this.getCommandManager().registerCallback(this.save.bind(this));},e.prototype.getCommandManager=function(){return this.commandManager=this.commandManager||new t.VA.Core.CommandManager(this.options.editorInput.getContents(),this),this.commandManager;},e.prototype.addCommandListener=function(t){this.getCommandManager().registerCallback(t);},e.prototype.removeCommandListener=function(t){this.getCommandManager().unRegisterCallback(t);},e.prototype.addGoHistoryListener=function(t){this.getCommandManager().registerGoHistoryCallback(t);},e.prototype.removeGoHistoryListener=function(t){this.getCommandManager().unRegisterGoHistoryCallback(t);},e.prototype.getModelClazz=function(){return this.options.clazz;},e.prototype.getEditorInput=function(){return this.options.editorInput;},e.prototype.getModel=function(){return this.options.editorInput.getContents();},e.prototype.getActiveModel=function(){return this.getModel();},e.prototype.updateStatus=function(){},e.prototype.openSidebar=function(){this.sideBarManager&&this.sideBarManager.openAll();},t.VA.Core.Editors.Editor=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls(),this.registerDebugListener();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.registerDebugListener=function(){var e=this;Studio.getInstance().addDebugListener(function(i,o){var n=o.launchOptions.clazz;if("BEGIN-JOB"==o.eventType){var r=t.VA.Core.Interface.LauncherDialog[n]||t.VA.Core.Dialogs.LaunchProgressDialog;e.launchProgressDialog=new r(e.$mainControl,{jobId:o.launchOptions.runnable.jid,close:function close(t){e.launchProgressDialog=null;},title:"Run Progress"});}var a=e.getActiveModelEditor();e.launchProgressDialog&&e.launchProgressDialog.progress(o),"deeplearning"===n&&a.dialog&&a.dialog.run&&a.dialog.run.progress(o);});},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-editorcontainer"></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl);},e.prototype.closeEditor=function(e){for(var i=this.$mainControl.find(".brtc-va-editor-wrapper"),o=0;o<i.length;o++){var n=t.VA.Core.Utils.WidgetUtils.getEditorRef(i.eq(o).children());if(n.options.editorInput.getFileId()==e.getFileId())return n.$ctxMenu&&n.$ctxMenu.jqxMenu("destroy"),n.sideBarManager&&n.sideBarManager.destroy(),n.destroy(),void i.eq(o).remove();}},e.prototype.openEditor=function(e){var i=$(".brtc-va-studio-top-area").find(".brtc-va-tools-menubar-center-area");"none"==i.find(".brtc-va-tools-menubar-editor-tab.newmodel").css("display")&&i.find(".brtc-va-tools-menubar-editor-tab.newmodel").css("display","block");for(var o,n=this.$mainControl.find(".brtc-va-editor-wrapper"),r=0;r<n.length;r++){if((o=t.VA.Core.Utils.WidgetUtils.getEditorRef(n.eq(r).children())).options.editorInput.getFileId()==e.getFileId())return n.removeClass("selected"),n.eq(r).addClass("selected"),n.eq(r).trigger("selected"),o;}var a=$('<div class="brtc-va-editor-wrapper"></div>');n.removeClass("selected"),a.addClass("selected"),this.$mainControl.append(a);var s=e.getContents().type||"data";return o=new(0,t.VA.Core.Interface.Editor[s])(a,{width:"100%",height:"100%",editorInput:e,clazz:s}),a.on("selected",function(){var e=t.VA.Core.Utils.WidgetUtils.getEditorRef(a.children());e&&e.onActivated&&e.onActivated();}),Studio.getInstance().doValidate(e.getContents()),o;},e.prototype.getActiveModelEditor=function(){var e=this.$mainControl.find(".brtc-va-editor-wrapper.selected").children();return t.VA.Core.Utils.WidgetUtils.getEditorRef(e);},e.prototype.getEditors=function(){for(var e=[],i=this.$mainControl.find(".brtc-va-editor-wrapper"),o=0;o<i.length;o++){var n=t.VA.Core.Utils.WidgetUtils.getEditorRef(i.eq(o).children());e.push(n);}return e;},e.prototype.findEditorsByProjectId=function(e){for(var i=[],o=this.$mainControl.find(".brtc-va-editor-wrapper"),n=0;n<o.length;n++){var r=t.VA.Core.Utils.WidgetUtils.getEditorRef(o.eq(n).children());r.options.editorInput.getProjectId()==e&&i.push(r);}return i;},e.prototype.findEditorById=function(e,i){for(var o=this.$mainControl.find(".brtc-va-editor-wrapper"),n=0;n<o.length;n++){var r=t.VA.Core.Utils.WidgetUtils.getEditorRef(o.eq(n).children());if(r.options.editorInput.getProjectId()==e&&r.options.editorInput.getFileId()==i)return r;}},t.VA.Core.Editors.EditorContainer=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){},t.VA.Core.Editors.EditorPage=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");function i(e,i){t.VA.Core.Editors.Editor.call(this,e,i),this.activeModelChangeListeners=[],this.initModelLayoutManager(),this.registerCommandCallback();}i.prototype=Object.create(t.VA.Core.Editors.Editor.prototype),i.prototype.constructor=i,i.prototype.init=function(){t.VA.Core.Editors.Editor.prototype.init.call(this),this.setActiveModel(this.getModel().mid);},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-modeleditor brtc-va-editor">   <div class="brtc-style-editor-toolbar-area brtc-style-s-editor-toolbar-area"></div>   <div class="brtc-va-editors-modeleditor-header"></div>   <div class="brtc-va-editors-side-tab-bar brtc-va-editors-left-tab-bar"></div>   <div class="brtc-va-editors-side-tab-bar brtc-va-editors-right-tab-bar"></div>   <div class="brtc-va-editors-modeleditor-splitter">      <div class="brtc-va-editors-modeleditor-diagram"></div>      <div class="brtc-va-editors-modeleditor-sheet"></div>   </div>   <div class="brtc-va-editors-modeleditor-notification-container"></div>   <div class="brtc-va-editors-modeleditor-notification">       <div class="brtc-va-editors-modeleditor-notification-content"></div>   </div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.initEditorState(),t.VA.Core.Utils.WidgetUtils.putModelEditorRef(this.$mainControl,this),this.createEditorSplitter(),this.createHeader(),this.getHeaderArea().hide(),this.createDiagramEditorPage(),this.createDiagramEditorWrapper(),this.createToolbar(),this.createSheetEditorPage(),this.createNotification(),this.createChartSettingDialog();},i.prototype.initModelLayoutManager=function(){this.modelLayoutManager.registerConditionHeader(this.conditionHeader),this.modelLayoutManager.registerLoopHeader(this.loopHeader);},i.prototype.createDiagramEditorPage=function(){var e=this.getDiagramEditorPageArea();this.diagramEditorPage=new t.VA.Implementation.DataFlow.Editors.Diagram.EditorPage(e,{width:"100%",height:"100%",editor:this}),this._createEventListener();},i.prototype.getColorSet=function(){return{READY:"#E5E9EF",DEPRECATED:"#D3D3D3",PROCESSING:"blue",SUCCESS:"#58bd7c",FAIL:"red"};},i.prototype.updateStatus=function(t){this.addStatus(t),this.diagramEditorPage.updateStatus(t),this.sideBarManager.updateStatus(t);},i.prototype.getDiagramEditorPage=function(){return this.diagramEditorPage;},i.prototype.createSheetEditorPage=function(){var e=this.getSheetEditorPageArea();this.sheetEditorPage=new t.VA.Core.Editors.Sheet.SheetEditorPage(e,{width:"100%",height:"100%",panelFactory:this.getPanelFactory()});},i.prototype.getSheetEditorPage=function(){return this.sheetEditorPage;},i.prototype._createEventListener=function(){var t=this.$mainControl.find(".brtc-va-editors-modeleditor-diagram");this._createFnUnitSelectEventListener(t),this._createFnUnitDoubleClickEventListener(t),this._createFnUnitMoveEventListener(t);},i.prototype._createFnUnitSelectEventListener=function(t){var i=this;t.bind("fnUnit:select",function(t,o){var n=$.map(o,function(t,e){return i.getActiveModel().getFnUnitById(t);});if(i.getEditorState("move-mode-enabled")||1!==n.length)i.resetSheetEditorPage();else{if(e.isDustNode(n[0]))return;if(!e.isAvailable(n[0])){return void i.notification("error","This function is not available.");}e.isProcessFunction(n[0])?(i.resetSheetEditorPage(),i.openPopupDialog(n[0])):(i.$editorSplitter.jqxSplitter("expand"),i.renderSheetEditorPage(n));}});},i.prototype._createFnUnitMoveEventListener=function(t){var e=this;t.bind("fnUnit:move",function(){e.resetSheetEditorPage();});},i.prototype.getFunctionDef=function(e){var i=this.getModel().type;return t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(i,e.func);},i.prototype._createFnUnitDoubleClickEventListener=function(t){var e=this;t.bind("fnUnit:dbclick",function(t,i){if(!e.getEditorState("move-mode-enabled")){var o=$.map(i,function(t,i){return e.getActiveModel().getFnUnitById(t);});if(1===o.length)if("If"===o[0][FUNCTION_NAME]||"ForLoop"===o[0][FUNCTION_NAME]||"WhileLoop"===o[0][FUNCTION_NAME]){var n="If"==o[0][FUNCTION_NAME]?o[0].param.if.mid:o[0].param.mid;e.modelLayoutManager.openActivity(n,o[0]);}else e.resetSheetEditorPage();}});},i.prototype.destroy=function(){this.modelLayoutManager.destroy();},i.prototype.createChartSettingDialog=function(){var t=$('<div class="brtc-va-dialog brtc-va-chart-settings">   <div class="brtc-va-dialog-header">       <div class="brtc-va-dialog-title">Chart Settings</div>       <div class="brtc-va-dialog-button" action="close"></div>   </div>   <div class="brtc-va-dialog-contents"></div></div>');return this.$mainControl.append(t),t.draggable({handle:t.find(".brtc-va-dialog-header > .brtc-va-dialog-title"),containment:"parent"}),t.find('.brtc-va-dialog-header > .brtc-va-dialog-button[action="close"]').click(function(){$(this).closest(".brtc-va-dialog.brtc-va-chart-settings").hide();}),t.hide(),t;},i.prototype.showChartSettingDialog=function(){this.$mainControl.children(".brtc-va-dialog.brtc-va-chart-settings").show();},i.prototype.hideChartSettingDialog=function(){this.$mainControl.children(".brtc-va-dialog.brtc-va-chart-settings").hide();},i.prototype.createNotification=function(){var e=this.$mainControl.children(".brtc-va-editors-modeleditor-notification-container");this.$notification=this.$mainControl.children(".brtc-va-editors-modeleditor-notification"),this.$notification.jqxNotification({theme:t.VA.Env.Theme,appendContainer:e,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:3e3,template:"info"});},i.prototype.notification=function(t,e){this.$mainControl.children(".brtc-va-editors-modeleditor-notification-container").html(""),this.$notification.find(".brtc-va-editors-modeleditor-notification-content").html(e),this.$notification.jqxNotification({template:t}),this.$notification.jqxNotification("open");},i.prototype.getDiagramEditorPageArea=function(){return this.$mainControl.find(".brtc-va-editors-modeleditor-diagram");},i.prototype.getSheetEditorPageArea=function(){return this.$mainControl.find(".brtc-va-editors-modeleditor-sheet");},i.prototype.createEditorSplitter=function(){var e=this;e.$editorSplitter=e.$mainControl.find(".brtc-va-editors-modeleditor-splitter"),e.expandedSize=180,e.$editorSplitter.jqxSplitter({theme:t.VA.Env.Theme,width:"100%",height:"calc(100% - 40px)",orientation:"horizontal",panels:[{size:e.expandedSize,min:90,collapsible:!1},{min:400,collapsible:!0,collapsed:!0}],splitBarSize:8}),e.$editorSplitter.on("resize",function(t){t.args&&t.args.panels&&(t.args.panels[0].size==t.args.panels[0].min||(e.expandedSize=t.args.panels[0].size),e.getModelLayoutManager().handleFitToContent());});},i.prototype.onActivated=function(){$(window).trigger("resize"),this.getModelLayoutManager().handleOnActivate();},i.prototype.callFunction=function(t){return Studio.getInstance().callFunction(this.getModel(),t);},i.prototype.handleDebugEvent=function(t){t.event;},i.prototype.selectFunction=function(t){this.getModelLayoutManager().handleSelectFunction(t);},i.prototype.showFunctionProperty=function(t){if(t){var i=this.getActiveModel().getFnUnitById(t);i&&(e.isProcessFunction(i)?(this.openPopupDiaog(i),this.renderSheetEditorPage([i])):this.selectFunction(t));}},i.prototype.getMainArea=function(){return this.$mainControl;},i.prototype.getHeaderArea=function(){return this.$mainControl.find(".brtc-va-editors-modeleditor-header");},i.prototype.getLeftTabBarArea=function(){return this.$mainControl.find(".brtc-va-editors-left-tab-bar");},i.prototype.getRightTabBarArea=function(){return this.$mainControl.find(".brtc-va-editors-right-tab-bar");},i.prototype.createHeader=function(){var e=this.getHeaderArea(),i=t.VA.Implementation.DataFlow.Editors.Header;this.loopHeader=new i.LoopHeader(e),this.conditionHeader=new i.ConditionHeader(e);},i.prototype.createDiagramEditorWrapper=function(){var e=t.VA.Implementation.DataFlow.Editors.Diagram.DiagramEditorWrapper;this.diagramEditorWrapper=new e(null,{conditionHeader:this.conditionHeader,loopHeader:this.loopHeader,editor:this});},i.prototype.renderSheetEditorPage=function(t){this.sheetEditorPage.render(t),this.setActiveFnUnitOnProp(t[0]),1===t.length&&this.getDiagramEditorPage().ensureCenterByFnUnit(t[0]);},i.prototype.resetSheetEditorPage=function(){this.$editorSplitter.jqxSplitter("collapse"),this.sheetEditorPage.render(),this.hideChartSettingDialog(),this.setActiveFnUnitOnProp();},i.prototype.getReportManager=function(){return this.reportManager=this.reportManager||new t.VA.Core.ReportManager(this.getEditorInput()),this.reportManager;},i.prototype.getPanelFactory=function(){return this.panelFactory=this.panelFactory||new t.VA.Core.Editors.Sheet.PanelFactory(),this.panelFactory;},i.prototype.getActiveModel=function(){return this.activeModel;},i.prototype.getModelByMid=function(t){return t==this.getModel().mid?this.getModel():this.getModel().getInnerModel(t);},i.prototype.getFunctionByFid=function(t){var e=this.getModel().getFnUnitById(t);if(e)return e;var i=this.getModel().getInnerModels();for(var o in i){if(e=i[o].getFnUnitById(t))return e;}},i.prototype.setActiveModel=function(t){this.activeModel=this.getModelByMid(t),this.handleActiveModelChange(this.activeModel);},i.prototype.getActiveFnUnit=function(){return this.getModelLayoutManager().getFnUnit();},i.prototype.getActiveFnUnitOnProp=function(){return this.activeFnUnitOnProp;},i.prototype.getDiagramArea=function(){return this.$editorSplitter;},i.prototype.setActiveFnUnitOnProp=function(t){this.activeFnUnitOnProp=t,this.getSideBarManager().onFnUnitSelect(t);},i.prototype.setHistorySelector=function(t){this.historySelector=t;},i.prototype.getDiagramEditorWrapper=function(){return this.diagramEditorWrapper;},i.prototype.addActiveModelChangeListener=function(t){this.activeModelChangeListeners.push(t);},i.prototype.removeActiveModelChangeListener=function(t){this.activeModelChangeListeners=_.remove(this.activeModelChangeListeners,t);},i.prototype.handleActiveModelChange=function(t){_.forEach(this.activeModelChangeListeners,function(e){_.isFunction(e)&&e(t);});},i.prototype.openPopupDialog=function(i){if(!e.isBluffNode(i)){var o=$.extend(!0,{},i),n=i.func,r=this;new(0,t.VA.Core.Dialogs[{setValue:"SetValueSettingDialog",import:"ImportDataSettingDialog",export:"ExportDataSettingDialog"}[n]])(this.getDiagramEditorPage(),{event:event,editor:this,fnUnit:o,param:o.param,title:"Setting Configuration",close:function close(t){t.OK&&t.results&&r.createSetDialogFnUnitCommand(t.results.fnUnit,i);}});}},i.prototype.createSetDialogFnUnitCommand=function(e,i){var o=new t.VA.Core.CompoundCommand(this,{label:"Change a Function"}),n=new t.VA.Core.Editors.Diagram.Commands.SetDialogFnUnitCommand(this,{fnUnit:i,ref:{param:e.param}}),r=new t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this,{fid:e.fid,name:e.display.label,description:e.display.description});o.add(n),o.add(r),this.getCommandManager().execute(o);},i.prototype.getEditorState=function(t){if(_.has(this.editorState,t))return this.editorState[t];throw new Error("invalid editor state");},i.prototype.setEditorState=function(t,e){if(!_.has(this.editorState,t))throw new Error("invalid editor state");this.editorState[t]=e,_.has(this.handleEditorStateChange,t)&&this.handleEditorStateChange[t](e);},i.prototype.initEditorState=function(){var t=this;this.editorState={"tooltip-enabled":!1,"move-mode-enabled":!1,"readonly-figure-selected":!1},this.handleEditorStateChange={"move-mode-enabled":function moveModeEnabled(e){e?(t.resetSheetEditorPage(),t.$mainControl.addClass("brtc-va-editors-move-mode-enabled")):t.$mainControl.removeClass("brtc-va-editors-move-mode-enabled");}};},i.prototype.changeEditorContext=function(t,e){this.modelLayoutManager.openActivity(t,e);},i.prototype.prepareLaunch=function(){this.StatusBoard.refresh();},i.prototype.addStatus=function(t){if("FAIL"===t.status){var e=t.fid,i=t.originalResponse.errorInfo[0].message;this.StatusBoard.add(e,t.status,i);}else if("SUCCESS"===t.status){e=t.fid;this.StatusBoard.add(e,t.status,"");}},i.prototype.getStatus=function(t){return this.StatusBoard.get(t);},i.prototype.showStatus=function(t,e){this.StatusBoard.show(t,e);},t.VA.Core.Editors.ModelEditor=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.editor=t,this.init();}e.prototype.init=function(){this.$editor=this.editor.getMainArea();},e.prototype.getEditor=function(){return this.editor;},e.prototype.getSideBarManager=function(){return this.editor.getSideBarManager();},e.prototype.getToolbar=function(){return this.editor.getToolbar();},e.prototype.setWidth=function(t){t&&this.$editor.width(t);},e.prototype.setHeight=function(t){t&&this.$editor.height(t);},e.prototype.setMarginLeft=function(t){return this.$editor.css("margin-left",t);},e.prototype.getWidth=function(){return this.$editor.width();},e.prototype.getHeight=function(){return this.$editor.height();},e.prototype.getPaddingLeft=function(){return Number(this.$editor.css("padding-left").replace("px",""));},e.prototype.getPaddingRight=function(){return Number(this.$editor.css("padding-right").replace("px",""));},e.prototype.getMainArea=function(){return this.editor.getMainArea();},e.prototype.getLeftTabBarArea=function(){return this.editor.getLeftTabBarArea();},e.prototype.getRightTabBarArea=function(){return this.editor.getRightTabBarArea();},e.prototype.handleEditorSelectionChange=function(t){for(var e in this.editorSelectionChangeListener){this.editorSelectionChangeListener[e].selectionChanged(t);}},e.prototype.initEditorSelectionChangeListener=function(){var t=this;for(var e in this.editor.$mainControl.bind("editorSelectionChanged",function(e,i){t.handleEditorSelectionChange(i);}),this.editorSelectionChangeListener=[],this.editor.getSideBarManager().getSideBars()){this.editorSelectionChangeListener.push(this.editor.getSideBarManager().getSideBars()[e]);}},e.prototype.initTemplateChangeListener=function(){},e.prototype.handleOnActivate=function(){this.getSideBarManager().onActivated();},e.prototype.handleUDFChanged=function(t){},e.prototype.handleTemplateChanged=function(t){},e.prototype.handleExpandStatusChanged=function(){var t=this.getSideBarManager();if(t){var e=this.getSplitter(),i=(this.getSideBarManager().layout,0),o=this.editor.getLeftTabBarArea().height();i=t.getLeftSideBarWidth()+t.getRightSideBarWidth();t.isOpen("left")&&(i+=o),t.isOpen("right")&&(i+=o);var n=t.isOpen("left")?t.getLeftSideBarWidth()+o:o;e.css("width","calc(100% - "+i+"px)").css("margin-left",n);}},e.prototype.destroy=function(){},e.prototype.getFnUnit=function(){return this.fnUnit||void 0;},e.prototype.refreshModelInfo=function(){var t=this.getEditor().getActiveModel(),e=this.getFnUnit(),i=t?t.mid:void 0,o=e?e.fid:void 0;this.getToolbar().navigator.buildNavigator(i,o);},e.prototype.getSplitter=function(){return this.editor.getMainArea().find(".brtc-va-editors-modeleditor-splitter");},e.prototype.adjustLayout=function(){this.setDiagramHeight(),this.setEditorWidth();},e.prototype.setDiagramHeight=function(){},e.prototype.setEditorWidth=function(){var t=this.getSplitter(),e=(this.getSideBarManager().getSideBars(),this.editor.getLeftTabBarArea());t.css("margin-left",e.height()).css("width","calc(100% - "+2*e.height()+"px)");},t.VA.Core.Editors.ModelLayoutManager=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils"),i="default",o={id:"in-left",group:"in:l",args:{},markup:'<circle class="fnunit-port" r="0"/>'},n={id:"out-right",group:"out:r",args:{},markup:'<circle class="fnunit-port" r="0"/>'};function r(e,o){this.MAX_FUNC_COUNT=t.VA.SettingStorage.getValue("editor.maxfuncnum"),this.MAX_FUNC_MESSAGE="You can only add up to "+this.MAX_FUNC_COUNT+".",this.parentId=e,this.options=o,this.options.scale=this.options.scale||1,this.opacity4transition={duration:1e3,timingFunction:joint.util.timing.inout,valueFunction:function valueFunction(t,e){return function(t){return Math.max(.2,e+t);};}},this.translateProblems={},this._highlightedViews=[],this._selectedLink,this.behaviorMode=i,this.toolItems={},this.retrieveParent(),this.createControls(),this.registerDebugListener(),this.render(),this.registerCommandEventListener(),this.registerGoHistoryEventListener(),this.registerKeyListener(),this.prvFnUnitSelectTrigger={};var n=this.graph.getElements();if(n.length>0){var r=n[0];for(var a in n){r.attributes.position.x>n[a].attributes.position.x&&(r=n[a]);}this.ensureCenter(r);}this.updateMiniMapWindow(),t.OptModelManager.renderOptModels(this);}r.prototype.findError=function(t){var e=this,i=[],o=[],n=[];return t&&(n=t.constructor==Array?t:[t],$.each(n,function(t,n){var r=e.getFigureByFnUnitId(n.fid);$.inArray(n.fid,i)<0&&r&&(i.push(n.fid),o.push(r));})),o;},r.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},r.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-diagram-diagrameditorpage brtc-style-editor-editorpage"></div>'),this.$parent.append(this.$mainControl);var t=$('<div class="brtc-va-editors-diagram-diagrameditorpage-paper"></div>');this.$mainControl.append(t),this.createMainPanel(),this.createDiagramPaper(),this.$createCue=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create">    <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label-wrapper">        <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue">           <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label">Click</div>           <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label">to add Function</div>       </div>       <div class="brtc-va-editors-diagram-diagrameditorpage-function-cue-create-icon"></div>    </div></div>'),this.$selectedBounds=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected"></div>'),this.$toolTip=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip"></div>'),this.$toolbar=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-toolbar"></div>'),this.$guideBox=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-guidebox"></div>'),this.$guideMessageBox=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-guidemessage"></div>'),this.$dragSelection=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-drag-selection"></div>'),t.append(this.$createCue),t.append(this.$selectedBounds),t.append(this.$toolTip),t.append(this.$toolbar),t.append(this.$guideBox),t.append(this.$guideMessageBox),t.append(this.$dragSelection),this.createFnUnitToolbar(),this.createMultiSelectionToolbar(),this.createCue(),this._createMiniMapControl(),this.changeScale(this.options.scale),this.cellPointer={};},r.prototype._createMiniMapControl=function(){this.minimap=new t.VA.Core.Editors.Diagram.MinimapBoat(this.$parent.parent(".brtc-va-editors-modeleditor-splitter"),{diagramEditorPage:this});},r.prototype.createExpressionControl=function(){this.expression&&this.expression.destroy(),this.options.editor.getActiveModel().isMainModel()||(this.expression=new t.VA.Core.Editors.Diagram.ExpressionBoat(this.$parent.parent(".brtc-va-editors-modeleditor-splitter"),{editor:this.options.editor,resizable:!1}));},r.prototype.getFunctionsLength=function(){return this.getModel().functions.length;},r.prototype.createMainPanel=function(){var t=this;this.$mainControl.perfectScrollbar(),this.$mainControl.scroll(function(){t.updateMiniMapWindow();}),this.$mainControl.hover(function(){t.fitToContent();},function(){t.fitToContent();}),this.$mainControl.mouseleave(function(){t.switchFnUnitDialog||t.$createCue.css("display","none");});},r.prototype.ensureCenter=function(e){var i=e;if(i){var o=this.$mainControl.width(),n=this.$mainControl.height(),r=(this.$mainControl.scrollLeft(),this.$mainControl.scrollTop(),i.attributes.position.x*this.options.scale),a=i.attributes.position.y*this.options.scale,s=(r/o|0)*o+r%o-o/2+t.VA.Env.Diagram.FIGURE_WIDTH*this.options.scale/2,l=(a/n|0)*n+a%n-n/2+t.VA.Env.Diagram.FIGURE_HEIGHT*this.options.scale/2;this.$mainControl.animate({scrollLeft:s,scrollTop:l},500);}},r.prototype.ensureVisible=function(t){if(t){var e=this.$mainControl.width(),i=this.$mainControl.height(),o=this.$mainControl.scrollLeft(),n=this.$mainControl.scrollTop(),r=t.attributes.position.x*this.options.scale,a=t.attributes.position.y*this.options.scale;o>r&&this.$mainControl.scrollLeft(r-10),n>a&&this.$mainControl.scrollTop(a-10),o+e<r+109&&this.$mainControl.scrollLeft(r-e+110),n+i<a+44&&this.$mainControl.scrollTop(n+a-i+45);}},r.prototype.createDiagramPaper=function(){var i,o=this;this.$paperElement=this.$mainControl.find(".brtc-va-editors-diagram-diagrameditorpage-paper"),this.graph=new joint.dia.Graph(),this.paper=new joint.dia.Paper({el:this.$paperElement,width:this.options.width,height:this.options.height,model:this.graph,snapLinks:!0,linkPinning:!0,gridSize:10,theme:"none",interactive:function interactive(t){return t.model instanceof joint.dia.Link?{vertexAdd:!1}:!o.cellPointer||"link"!==o.cellPointer.state;},validateConnection:function validateConnection(n,r,a,s,l,c){var d,p,u,h,f=o.getModel().type;d=n.model,p=a.model;var m=!0;return d&&p&&(u=o.getFnUnitById(d.attributes.fid),h=o.getFnUnitById(p.attributes.fid)),u&&h&&((i=i||o._getConnectableFids(d.attributes.fid)).indexOf(p.attributes.fid)<0?m=!1:(t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(f,u.func),t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(f,h.func))),m=e.isConnectable(u,h),i=void 0,m;},linkView:joint.dia.LinkView.extend({options:_.defaults({shortLinkLength:45},joint.dia.LinkView.prototype.options),updateToolsPosition:function updateToolsPosition(){if(!this._V.linkTools)return this;var t="",e=this.options.linkToolsOffset,i=this.getConnectionLength();if(!Number.isNaN(i)){i<75&&(t="scale(.5)",e*=.7);var o=this.getPointAtLength(e);if(this._toolCache.attr("transform","translate("+o.x+", "+o.y+") scale(.8)"),this.options.doubleLinkTools&&i>=this.options.longLinkLength){var n=this.options.doubleLinkToolsOffset||e;o=this.getPointAtLength(i-n),this._tool2Cache.attr("transform","translate("+o.x+", "+o.y+") "+t),this._tool2Cache.attr("visibility","visible");}else this.options.doubleLinkTools&&this._tool2Cache.attr("visibility","hidden");}return this;}})}),this.paper.on("cell:pointerdown",this.handleCellPointerDown.bind(this)),this.paper.on("cell:pointerup",this.handleCellPointerUp.bind(this)),this.paper.on("cell:mouseover",this.handleCellMouseOver.bind(this)),this.paper.on("cell:mouseout",this.handleCellMouseOut.bind(this)),this.paper.on("blank:pointerdown",this.handleBlankPointerDown.bind(this)),this.$paperElement.mousemove(this.handleBlankPointerMove.bind(this)),this.$paperElement.mouseleave(this.handleBlankMouseLeave.bind(this)),this.$paperElement.mouseenter(this.handleBlankMouseEnter.bind(this));var n=this.handleBlankPointerUp.bind(this);Studio.getInstance().getControl().on("mouseup",n),this.boundHandleBlankPointerUp=n,this.graph.on("change:position",this.handleGraphChangePosition.bind(this)),this.graph.on("add",this.handleGraphAdd.bind(this)),this.graph.on("remove",this.handleGraphRemove.bind(this)),this.makeDroppable();},r.prototype.changeScale=function(e){if(this.options.scale=e,.8!=this.options.scale||this.$paperElement.hasClass("brtc-va-editors-diagram-diagrameditorpage-paper-scale-normal")){if(.6!=this.options.scale||this.$paperElement.hasClass("brtc-va-editors-diagram-diagrameditorpage-paper-scale-small")){if(1!=this.options.scale)return;this.$paperElement.removeClass("brtc-va-editors-diagram-diagrameditorpage-paper-scale-small"),this.$paperElement.removeClass("brtc-va-editors-diagram-diagrameditorpage-paper-scale-normal"),this.paper.scale(this.options.scale);}else this.$paperElement.removeClass("brtc-va-editors-diagram-diagrameditorpage-paper-scale-normal"),this.$paperElement.addClass("brtc-va-editors-diagram-diagrameditorpage-paper-scale-small"),this.paper.scale(this.options.scale);}else this.$paperElement.removeClass("brtc-va-editors-diagram-diagrameditorpage-paper-scale-small"),this.$paperElement.addClass("brtc-va-editors-diagram-diagrameditorpage-paper-scale-normal"),this.paper.scale(this.options.scale);var i=this.graph.getElements();for(var o in i){i[o].changeScale(this.options.scale);}this.showSelectionBounds();var n=this.getSelectedFigures();n.length>0?this.ensureCenter(n[0]):i.length>0&&this.ensureCenter(i[0]),this.updateMiniMapWindow(),t.OptModelManager.renderOptModels();},r.prototype.changeTooltipEnabled=function(t){this.getEditor().setEditorState("tooltip-enabled",t);},r.prototype.makeDroppable=function(){var i=this;i.$mainControl.closest(".brtc-va-editor").droppable({accept:".ui-dialog",drop:function drop(t,e){$.ui.ddmanager.droppables.default.forEach(function(t){t.isover=!1;});}}),i.$mainControl.droppable({accept:".brtc-va-studio-dm-draggable",activate:function activate(t,e){i.fitToContent();},deactivate:function deactivate(t,e){"visible"==e.helper.css("visibility")&&i.fitToContent();},over:function over(e,o){var n,r,a,s;i.hideSelectionBounds(),o.helper.css("visibility","hidden"),o.helper.bind("feedback",function(t,e){var o=i.paper.clientToLocalPoint({x:e.clientX,y:e.clientY});for(var s in i.dropContents.functions){n=i.dropFigures[s],r=o.x-50+i.dropContents.functions[s].display.diagram.position.x,a=o.y-30+i.dropContents.functions[s].display.diagram.position.y,n.position(r,a);}i.showGuideBox(i.dropFigures[0]);});var l=t.VA.Core.Utils.WidgetUtils.getData(o.helper,"template"),c=t.VA.Core.Utils.WidgetUtils.getData(o.helper,"source"),d=i.paper.clientToLocalPoint({x:e.clientX,y:e.clientY});for(s in c instanceof t.VA.Core.Views.Palette?(i.dropContents={functions:[],links:[],isPalette:!0},i.dropContents.functions.push(i.getModel().newFnUnit(l.functions[0].func))):i.dropContents=l,i.dropFigures=[],i.dropContents.functions){(n=i.createFnUnitFigure(i.dropContents.functions[s])).attributes.dummy=!0,i.dropFigures.push(n);}for(s in i.graph.addCells(i.dropFigures),i.dropContents.functions){n=i.dropFigures[s],r=d.x-50+i.dropContents.functions[s].display.diagram.position.x,a=d.y-30+i.dropContents.functions[s].display.diagram.position.y,n.position(r,a);}for(s in i.dropLinks=[],i.dropContents.links){var p=i.createLinkFigure(i.dropContents.links[s]);p&&i.dropLinks.push(p);}i.graph.addCells(i.dropLinks),$.each(i.dropLinks,function(t,e){e.toBack();});},out:function out(t,e){for(var o in e.helper.css("visibility","visible"),e.helper.unbind("feedback"),i.dropFigures){i.dropFigures[o].remove();}i.dropContents=null,i.dropFigures=[],i.dropLinks=[],i.hideGuideBox(),i.hideGuideMessage(),i.hideTools(!0),i.showSelectionBounds(),i.$parent.trigger("mouseleave");},drop:function drop(o,n){var r,a=[];if(i.hideGuideBox(),i.guideMessage)for(r in i.hideGuideMessage(),i.dropFigures){i.dropFigures[r].remove();}else if(i.getFunctionsLength()+i.dropFigures.length>i.MAX_FUNC_COUNT){for(r in i.hideGuideMessage(),i.dropFigures){i.dropFigures[r].remove();}t.VA.Core.Utils.WidgetUtils.openErrorDialog(i.MAX_FUNC_MESSAGE);}else if(i.dropFigures.length>0){var s=!1;for(r in i.dropFigures){var l=i.calcGuidePosition(i.dropFigures[r]);i.dropFigures[r].position(l.x,l.y),i.dropFigures[r].attributes.dummy=!1;}1===i.dropFigures.length&&"true"===t.VA.SettingStorage.getValue("editor.diagram.autoconnect")?a=i.connectSmartly(i.dropFigures[r]):s=!0,i.showTools(i.dropFigures[0]);var c=new t.VA.Core.CompoundCommand(i,{label:"Create a Function"});for(r in i.dropFigures){!0!==s&&e.clearInData(i.dropContents.functions[r]),c.add(i.createNewFnUnitCommand(i.dropFigures[r],i.dropContents.functions[r],i.dropContents.isPalette?void 0:i.dropContents)),c.add(i.createSetFnUnitPositionCommand(i.dropFigures[r],i.dropFigures[r].attributes.position.x,i.dropFigures[r].attributes.position.y));}for(r in i.dropLinks){c.add(i.createConnectFnUnitCommand(i.dropLinks[r],s));}for(r in a){c.add(i.createConnectFnUnitCommand(a[r]));}i.fireCommand(c),i._rerouteLink();}i.dropContents=null,i.dropFigures=[],i.dropLinks=[],i.showSelectionBounds();}});},r.prototype.handleGraphChangePosition=function(t){var e=this;if(e.$createCue.css("display","none"),e.cellPointer.figure==t){var i=e.getSelectedFigures();if("Down"===e.cellPointer.state&&i.forEach(function(t){t.toFront({deep:!0});}),"Down"==e.cellPointer.state||"Drag"==e.cellPointer.state){e.cellPointer.state="Drag",e.$parent.trigger("fnUnit:move");var o=t.previousAttributes().position,n=t.attributes.position;$.each(i,function(e,i){if(i!==t){var r=i.attributes.position.x+(n.x-o.x),a=i.attributes.position.y+(n.y-o.y);i.position(r,a);}});}$.each(i,function(t,i){e.updateSelectionBox(i),e.updateErrorBox(i);}),e.hideTools(!0),e.updateToolsPosition(t);}else e.updateSelectionBox(t),e.updateErrorBox(t);e.updateGuideBox(t),e.hideGuideMessage();var r=e.validateTranslate([t]);for(var a in r){e.showGuideMessage(e.graph.getCell(a),r[a]);}e.fitToContent();},r.prototype.handleGraphAdd=function(t){},r.prototype.handleGraphRemove=function(t,e,i){if(delete this.translateProblems[t.cid],"brtc.va.shapes.Link"===t.attributes.type&&!0===i.ui){var o=t;t.graph=this.graph;var n=this.createDisconnectFnUnitCommand(o);this.fireCommand(n),this.notification("success","The connection was removed.");}},r.prototype._rerouteLink=function(){var t=this;t.rerouteLinkTask&&clearTimeout(t.rerouteLinkTask),t.rerouteLinkTask=function(){var e=t.graph.getLinks();for(var i in e){t.paper.findViewByModel(e[i]).update();}},setTimeout(t.rerouteLinkTask,1e3);},r.prototype._clearSelectedLink=function(){this._selectedLink&&(this._selectedLink.hideRemoveButton(),this._selectedLink=void 0);},r.prototype._handleLinkCellPointerDown=function(e,i,o,n){if(!this._isConnectableCell(e.model))return this._setBehaviorModeToDefault(),void this._handleDefaultCellPointerDown(e,i,o,n);var r=this._fromCell,a=e.model,s=t.VA.Core.Utils.IDGenerator.link.id(),l=this._createLinkFigure(s,r,a);this.graph.addCells([l]),this.paper.findViewByModel(l).update();var c=this.createConnectFnUnitCommand(l);this.fireCommand(c)?l.set("target",{id:e.model.id,port:"in-left"}):(l.remove(),this.notification("warning","No connection could be made.")),e.unhighlight(),this._setBehaviorModeToDefault();},r.prototype._handleDefaultCellPointerDown=function(e,i,o,n){this.cellPointer={};var r=this;if(e.model instanceof t.VA.Core.Shapes.FnUnitFigure){setTimeout(function(){r._clearSelectedLink();},100);var a=e.model;this.cellPointer.state="Down",this.cellPointer.figure=a,this.getSelectedFigureIds().indexOf(a.cid)<0&&this.showSelectionBox([a],!1),this.hideSelectionBounds(),this.showGuideBox(a);}else if(e.model instanceof t.VA.Core.Shapes.LinkFigure){var s=this.getSelectedFigureIds();for(var l in s){var c=this.graph.getCell(s[l]);c&&c.unselect();}setTimeout(function(){r._triggerClickOrDoubleClickEvent(s),r.hideSelectionBounds();},100),e.model.toFront();var d=e.model;if(this._selectedLink&&d.cid!==this._selectedLink.cid&&d.hideRemoveButton(),d.attributes.action="","marker-arrowhead"==i.target.getAttribute("class"))d.attributes.action="arrowhead-move";else if("connection-wrap"==i.target.getAttribute("class"))this._clearSelectedLink(),this._selectedLink=e.model,d.showRemoveButton();else try{e.model.toFront();}catch(t){}}},r.prototype.handleCellPointerDown=function(t,e,i,o){"link"===this.behaviorMode?this._handleLinkCellPointerDown(t,e,i,o):this._handleDefaultCellPointerDown(t,e,i,o);},r.prototype.handleCellPointerUp=function(e,i,o,n){var r,a,s=this;if(s.hideGuideBox(),e.model instanceof t.VA.Core.Shapes.FnUnitFigure){var l=e.model;if("Down"==s.cellPointer.state&&s.showSelectionBox([l],!0),s.cellPointer.state="Up",s.guideMessage)s.hideGuideMessage(),a=s.getSelectedFigures(),$.each(a,function(t,e){s._revertPosition(e);});else{var c=s.calcGuidePosition(l);l.position(c.x,c.y),s.showTools(l),r=s.getFnUnitById(l.attributes.fid);var d=new t.VA.Core.CompoundCommand(s,{label:"Change Position"}),p=r.display.diagram.position,u=c;a=s.getSelectedFigures(),$.each(a,function(t,e){var i=s.getFnUnitById(e.attributes.fid),o=i.display.diagram.position.x+(u.x-p.x),n=i.display.diagram.position.y+(u.y-p.y);e.position(o,n),i.display.diagram.position.x==o&&i.display.diagram.position.y==n||d.add(s.createSetFnUnitPositionCommand(e,o,n));}),s.fireCommand(d),1==a.length&&setTimeout(function(){s.ensureCenter(l);},100);}s._rerouteLink(),s.showSelectionBounds(),s.changeCursor(e.model,"pointer");}else if(e.model instanceof t.VA.Core.Shapes.LinkFigure){var h=e.model;if("arrowhead-move"===h.attributes.action){var f=s.validateConnect([h]);if(f)s.notification("warning",f),s._revertLink(h);else{var m=this.createReconnectFnUnitCommand(h);this.fireCommand(m),this._clearSelectedLink();}}}},r.prototype.handleCellMouseOver=function(t,e){if("link"===this.behaviorMode)for(var i=0;i<this._connectableFigures.length;i++){this._connectableFigures[i].cid===t.model.cid&&t.highlight();}else"block"!=this.$dragSelection.css("display")&&"Drag"!=this.cellPointer.state&&(this.showTools(t.model),this.showToolTip(t.model));},r.prototype.handleCellMouseOut=function(t,e){t.model!==this._fromCell&&t.unhighlight(),this.hideTools(),this.hideToolTip();},r.prototype.handleBlankPointerDown=function(t,e,i){if(0===t.button&&(this.$dragSelection.css({display:"block",width:0,height:0}),this.$dragSelection.attr("start-x",e*this.options.scale),this.$dragSelection.attr("start-y",i*this.options.scale)),"link"===this.behaviorMode?this._setBehaviorModeToDefault():this._clearSelectedLink(),"hidden"==this.getEditor().getSheetEditorPageArea().css("visibility")){var o=this,n=this.getSelectedFigureIds();for(var r in n){var a=this.graph.getCell(n[r]);a&&a.unselect();}setTimeout(function(){o._triggerClickOrDoubleClickEvent(n),o.hideSelectionBox();},100);}},r.prototype.handleBlankPointerMove=function(e,i,o){var n=this,r=this.$paperElement.offset();i=e.pageX-r.left,o=e.pageY-r.top;if("block"==this.$dragSelection.css("display")){var a=this.$dragSelection.attr("start-x"),s=this.$dragSelection.attr("start-y");this.$dragSelection.css({left:Math.min(i,a),top:Math.min(o,s),width:Math.abs(i-a),height:Math.abs(o-s)}),setTimeout(function(){n._triggerClickOrDoubleClickEvent([]);},100);}if("none"==this.$dragSelection.css("display")&&"none"==this.$tools.css("display")&&"none"==this.$guideBox.css("display")&&o>=30){var l=i,c=o,d=this.GAP_WIDTH||t.VA.Env.Diagram.GAP_WIDTH,p=this.GAP_HEIGHT||t.VA.Env.Diagram.GAP_HEIGHT,u=t.VA.Env.Diagram.FIGURE_WIDTH+d,h=t.VA.Env.Diagram.FIGURE_HEIGHT+p,f=l%Number.parseInt(u*this.options.scale),m=c%Number.parseInt(h*this.options.scale);if(l-=f,l+=Number.parseInt(t.VA.Env.Diagram.PAPER_MARGIN_LEFT*this.options.scale),c-=m,c+=Number.parseInt(t.VA.Env.Diagram.PAPER_MARGIN_TOP*this.options.scale),0==this.graph.findModelsFromPoint({x:l/this.options.scale,y:c/this.options.scale}).length){this.$createCue.attr("mousedown",!1),this.$createCue.css({display:"flex",left:l,top:c});var g="true"!==t.VA.SettingStorage.getValue("editor.function.add.doubleclick")?"Click":"Double-Click";this.$createCue.find(".brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label").first().text(g);}}},r.prototype.handleBlankPointerUp=function(t,e,i){var o=this;if("block"==this.$dragSelection.css("display")){var n=this.$dragSelection.width(),r=this.$dragSelection.height();if(n>10&&r>10){var a=this.$dragSelection.position(),s=new g.rect(a.left/this.options.scale,a.top/this.options.scale,n/this.options.scale,r/this.options.scale),l=this.graph.findModelsInArea(s);l.length>0&&(this.showSelectionBox(l),1==l.length&&setTimeout(function(){o.ensureCenter(l[0]);},100));}this.$dragSelection.css({display:"none"});}},r.prototype.configureSelectionBounds=function(t){this.$multiTools.toggleClass("single-selected",1===t.length);},r.prototype.showSelectionBounds=function(){var e,i=this.getSelectedFigures(),o=!1;if(i.length>0){for(var n in i){o=o||this.isReadOnlyFigure(i[n]),e?(e.top=Math.min(e.top,i[n].attributes.position.y),e.left=Math.min(e.left,i[n].attributes.position.x),e.bottom=Math.max(e.bottom,i[n].attributes.position.y+t.VA.Env.Diagram.FIGURE_HEIGHT),e.right=Math.max(e.right,i[n].attributes.position.x+t.VA.Env.Diagram.FIGURE_WIDTH)):e={top:i[n].attributes.position.y,left:i[n].attributes.position.x,bottom:i[n].attributes.position.y+t.VA.Env.Diagram.FIGURE_HEIGHT,right:i[n].attributes.position.x+t.VA.Env.Diagram.FIGURE_WIDTH};}var r=e.top*this.options.scale,a=e.left*this.options.scale+3,s=(e.right-e.left)*this.options.scale-5,l=(e.bottom-e.top)*this.options.scale;t.VA.Implementation.DataFlow&&this.getModel().type===t.VA.Implementation.DataFlow.Clazz&&(l+=7),this.$selectedBounds.css({display:"block",top:r,left:a,width:s,height:l});}else this.$selectedBounds.css({display:"none"});this.getEditor().setEditorState("readonly-figure-selected",o),this.$multiTools.toggleClass("readonly-figure-selected",o);},r.prototype.hideSelectionBounds=function(){this.$selectedBounds&&this.$selectedBounds.hide();},r.prototype.showSelectionBox=function(e,i){var o,n=this,r=this.getSelectedFigureIds(),a=[];for(o in this.$paperElement.children(".brtc-va-editors-diagram-diagrameditorpage-function-selected").remove(),e){if(e[o]instanceof t.VA.Core.Shapes.FnUnitFigure){var s=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-selected"></div>');s.attr("cid",e[o].cid),s.css({top:e[o].attributes.position.y-1,left:e[o].attributes.position.x-2}),this.$paperElement.prepend(s),a.push(e[o].attributes.fid);}}var l=this.getSelectedFigureIds();for(o in r){var c=this.graph.getCell(r[o]);c&&c.unselect();}for(o in e){e[o].select();}(1==i||0!=i&&JSON.stringify(r)!==JSON.stringify(l))&&setTimeout(function(){n._triggerClickOrDoubleClickEvent(a);},100),this.configureSelectionBounds(e),this.showSelectionBounds();},r.prototype.updateSelectionBox=function(e){e instanceof t.VA.Core.Shapes.FnUnitFigure&&this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected[cid="'+e.cid+'"]').css({top:e.attributes.position.y-3,left:e.attributes.position.x-3});},r.prototype.hideSelectionBox=function(t){var e=this.getSelectedFigureIds();t?(t.unselect(),this.$paperElement.children('.brtc-va-editors-diagram-diagrameditorpage-function-selected[cid="'+t.cid+'"]').remove()):this.$paperElement.children(".brtc-va-editors-diagram-diagrameditorpage-function-selected").remove();var i=this.getSelectedFigureIds();if(JSON.stringify(e)!==JSON.stringify(i)){var o,n=[];for(o in i){var r=i[o];n.push(this.graph.getCell(r).attributes.fid);}for(o in e){var a=this.graph.getCell(e[o]);a&&a.unselect();}for(o in i){this.graph.getCell(i[o]).select();}var s=this;setTimeout(function(){s._triggerClickOrDoubleClickEvent(n);},100);}this.showSelectionBounds();},r.prototype._triggerClickOrDoubleClickEvent=function(t){var e=this,i=function i(t,e){t[e]&&(t[e]=void 0,delete t[e]);};1==t.length?this.prvFnUnitSelectTrigger[t[0]]?(this.$parent.trigger("fnUnit:dbclick",[t]),clearTimeout(e.prvFnUnitSelectTrigger[t[0]]),i(this.prvFnUnitSelectTrigger,t[0])):this.prvFnUnitSelectTrigger[t[0]]=setTimeout(function(){e.$parent.trigger("fnUnit:select",[t]),clearTimeout(e.prvFnUnitSelectTrigger[t[0]]),i(e.prvFnUnitSelectTrigger,t[0]);},200):this.$parent.trigger("fnUnit:select",[t]);},r.prototype.showErrorBox=function(e){for(var i in e){e[i]instanceof t.VA.Core.Shapes.FnUnitFigure&&e[i].showError();}},r.prototype.updateErrorBox=function(t){},r.prototype.hideErrorBox=function(){var t=this.graph.getElements();for(var e in t){t[e].hideError();}},r.prototype.createToolTip=function(){this.$validationTooltip=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools-validation-tooltip"></div>'),this.$tools.append(this.$validationTooltip),this.$validationTooltip.css("display","none");},r.prototype.showValidationToolTip=function(t){for(var e in this.$validationTooltip.empty(),this.problems){if(this.problems[e].fid===t.attributes.fid){var i=$('<div class="brtc-va-editors-diagram-diagrameditorpage-validation-problem"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> '+this.problems[e].message+"</div>");this.$validationTooltip.append(i);}}this.$validationTooltip.css("display","block");},r.prototype.hideValidationToolTip=function(){this.$validationTooltip&&this.$validationTooltip.css("display","none");},r.prototype.validateTranslate=function(t){for(var e in t){var i,o=t[e];!1===this.checkOverPosition(o)?i="Can not move over other function.":!1===this.checkOutRangePosition(o)&&(i="Can not move out of range."),i?this.translateProblems[o.cid]=i:delete this.translateProblems[o.cid];}return this.translateProblems;},r.prototype.validateConnect=function(t){for(var e in t){var i=t[e];if(!1===this.checkConnectedLink(i))return"No connection could be made.";if(!1===this.checkLoopLink(i))return"No connection could be made because connection loop.";if(!1===this.checkAlreadyExistLink(i))return"No connection could be made because connection already exists.";if(!1===this.checkAlreadyExistLinkByTableId(i))return"No connection could be made because connection already exists.";}},r.prototype.notification=function(e,i){t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl).notification(e,i);},r.prototype.createCue=function(){var e=this,i=function i(_i5){if(_i5.OK){var o=e.getModel().newFnUnit(_i5.func),n=_i5.position;o.display.diagram.position=e.calcGuideLocation(n.left/e.options.scale,n.top/e.options.scale);var r=e.createFnUnitFigure(o);e.graph.addCells([r]);var a=new t.VA.Core.CompoundCommand(e,{label:"Create a Function"}),s=[];if("true"===t.VA.SettingStorage.getValue("editor.diagram.autoconnect")&&(s=e.connectSmartly(r)),s.length>0)for(var l in a.add(e.createNewFnUnitCommand(r,o)),s){a.add(e.createConnectFnUnitCommand(s[l]));}else a.add(e.createNewFnUnitCommand(r,o));e.fireCommand(a),e.$createCue.css({display:"none"}),e.showSelectionBox([r]);}e.switchFnUnitDialog=null;};this.getFunctionsLength()||this.$createCue.css({display:"flex",left:"19.5px",top:"27px"}),this.$createCue.find(".brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label-wrapper").mousedown(function(t){e.$createCue.attr("mousedown",!0);var i=e.paper.snapToGrid({x:t.clientX,y:t.clientY});e.$dragSelection.css({display:"block",width:0,height:0}),e.$dragSelection.attr("start-x",i.x*e.options.scale),e.$dragSelection.attr("start-y",i.y*e.options.scale);}),this.$createCue.find(".brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label-wrapper").mouseup(function(o){"true"!==t.VA.SettingStorage.getValue("editor.function.add.doubleclick")&&"false"!==e.$createCue.attr("mousedown")&&(e.MAX_FUNC_COUNT=t.VA.SettingStorage.getValue("editor.maxfuncnum"),e.MAX_FUNC_MESSAGE="You can only add up to "+e.MAX_FUNC_COUNT+".",e.getFunctionsLength()+1>e.MAX_FUNC_COUNT?t.VA.Core.Utils.WidgetUtils.openErrorDialog(e.MAX_FUNC_MESSAGE):e.switchFnUnitDialog=new t.VA.Core.Dialogs.SwitchFnUnitDialog($(o.target),{modelType:e.getModel().type,close:i,position:e.$createCue.position()}));}),this.$createCue.find(".brtc-va-editors-diagram-diagrameditorpage-function-cue-create-label-wrapper").dblclick(function(o){"true"===t.VA.SettingStorage.getValue("editor.function.add.doubleclick")&&(e.getFunctionsLength()+1>e.MAX_FUNC_COUNT?t.VA.Core.Utils.WidgetUtils.openErrorDialog(e.MAX_FUNC_MESSAGE):e.switchFnUnitDialog=new t.VA.Core.Dialogs.SwitchFnUnitDialog($(o.target),{modelType:e.getModel().type,close:i,position:e.$createCue.position()}));});},r.prototype.createFnUnitToolbar=function(){var t=this;this.$tools=this.$mainControl.find(".brtc-va-editors-diagram-diagrameditorpage-function-toolbar"),this.$tools.hover(function(){t.clearHideToolsTimer();},function(){t.hideTools(!1);}),this.createRemoveToolItem(),this.createClearLinkToolItem(),this.createShiftLeftToolItem(),this.createShiftRightToolItem(),this.createSwitchToolItem(),this.createStartRunToolItem(),this.createCloneAndConnectToolItem(),this.createConnectToolItem(),this.createCloneToolItem(),this.createEnterToolItem(),this.createPopupToolItem();},r.prototype.createEnterToolItem=function(){var t=this,e=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-enter" title="Step Into"></div>');this.$tools.append(e),e.click(function(){var e=t.$tools.attr("cid"),i=t.graph.getCell(e);t.hideTools(!0),t.$parent.trigger("fnUnit:dbclick",[[i.attributes.fid]]);}),this.toolItems.enter=e;},r.prototype.createPopupToolItem=function(){var e=this,i=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-popup" title="Popup"></div>');this.$tools.append(i),i.click(function(i){var o=e.$tools.attr("cid"),n=e.graph.getCell(o);e.hideTools(!0);var r,a=e.getFnUnitById(n.attributes.fid),s=$.extend(!0,{},a),l=a.func,c=$(i.target).offset(),d={x:c.left-402+26,y:c.top-10+40};switch(l){case"setValue":r=t.VA.Core.Dialogs.SetValueSettingDialog;break;case"import":r=t.VA.Core.Dialogs.ImportDataSettingDialog;break;case"export":r=t.VA.Core.Dialogs.ExportDataSettingDialog;}new r(e.$mainControl,{event:i,editor:e.getEditor(),fnUnit:s,param:s.param,position:d,title:"Setting Configuration",close:function close(t){t.OK&&t.results&&e.createSetDialogFnUnitCommand(t.results.fnUnit,a);}});}),this.toolItems.popup=i;},r.prototype.createSetDialogFnUnitCommand=function(e,i){var o=new t.VA.Core.CompoundCommand(this,{label:"Change a Function"}),n=new t.VA.Core.Editors.Diagram.Commands.SetDialogFnUnitCommand(this,{fnUnit:i,ref:{param:e.param}}),r=new t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this,{fid:e.fid,name:e.display.label,description:e.display.description});o.add(n),o.add(r);var a=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);a&&a.getCommandManager().execute(o);},r.prototype.createConfigurationCommand=function(e,i){var o={fnUnit:i,ref:{param:e}},n=new t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this,o),r=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);r&&r.getCommandManager().execute(n);},r.prototype.createRemoveToolItem=function(){var t=this,e=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-remove" title="Remove"></div>');this.$tools.append(e),e.click(function(){var e=t.$tools.attr("cid"),i=t.graph.getCell(e);t.removeFnUnitFigure(i),t.hideTools(!0);}),this.toolItems.remove=e;},r.prototype.createClearLinkToolItem=function(){var t=this,e=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-clearlink"><i class="fa fa-chain-broken"></i></div>');this.$tools.append(e),e.click(function(){var e=t.$tools.attr("cid"),i=t.graph.getCell(e);t.removeFnUnitLink(i);}),this.toolItems.clearLink=e;},r.prototype.createShiftLeftToolItem=function(){var t=this,e=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-shiftleft brtc-style-flex-center"><i class="fa fa-angle-double-left fa-lg"></i></div>');this.$tools.append(e),e.click(function(){var e=t.$tools.attr("cid"),i=t.graph.getCell(e),o=t.createShiftLeftCommand(i);!1===t.fireCommand(o)?t.notification("warning",o.message):t.hideSelectionBounds();}),this.toolItems.shiftLeft=e;},r.prototype.createShiftRightToolItem=function(){var t=this,e=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-shiftright brtc-style-flex-center"><i class="fa fa-angle-double-right fa-lg"></i></div>');this.$tools.append(e),e.click(function(){var e=t.$tools.attr("cid"),i=t.graph.getCell(e),o=t.createShiftRightCommand(i);t.fireCommand(o),t.hideSelectionBounds();}),this.toolItems.shiftRight=e;},r.prototype.createSwitchToolItem=function(){var e=this,i=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-switch" title="Change Function"></div>');this.$tools.append(i),i.click(function(i){var o=e.$tools.attr("cid"),n=e.graph.getCell(o),r=e.getModel().getPrevious(n.attributes.fid);e.switchFnUnitDialog=new t.VA.Core.Dialogs.SwitchFnUnitDialog($(i.target),{preFnUnit:e.getFnUnitById(r[0]),modelType:e.getModel().type,close:function close(t){if(t.OK){var i=e.$tools.attr("cid"),o=e.graph.getCell(i),n=e.getFnUnitById(o.attributes.fid);if(n.func!==t.func){var r=e.getModel().newFnUnit(t.func);r.display.diagram.position=$.extend({},n.display.diagram.position);var a=e.createSwitchFnUnitCommand(o,r,n);a.event.source=this,e.fireCommand(a);}}e.switchFnUnitDialog=null;}});}),this.toolItems.switch=i;},r.prototype.createStartRunToolItem=function(){},r.prototype.createCloneAndConnectToolItem=function(){var e=this,i=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-cloneandconnect"><i class="fa fa-random"></i></div>');this.$tools.append(i),i.click(function(){e.notification("info","Click and drag to clone and connect function in one go");}),i.draggable({appendTo:e.$paperElement,helper:function helper(t){return $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools-clone-helper"></div>');},start:function start(i,o){var n=e.$tools.attr("cid"),r=e.graph.getCell(n),a=r.clone();a.category=r.category,a.unselect(),e.duplicatedFnUnit=t.VA.Core.Utils.ModelUtils.cloneFnUnit(e.getFnUnitById(a.attributes.fid)),a.attributes.dummy=!0,a.attributes.fid=e.duplicatedFnUnit.fid;var s=o.position.left-r.attributes.position.x,l=o.position.top-r.attributes.position.y;if(a.translate(s,l),e.graph.addCells([a]),a.toFront({deep:!0}),o.helper.attr("cid",a.cid),e.showGuideBox(a),a.attributes.inputtable){var c={kid:t.VA.Core.Utils.IDGenerator.link.id(),sourceFid:r.attributes.fid,targetFid:a.attributes.fid},d=e.createLinkFigure(c);d&&(e.graph.addCells([d]),d.toBack(),o.helper.attr("link-cid",d.cid));}},drag:function drag(t,i){var o=i.helper.attr("cid"),n=e.graph.getCell(o),r=i.position.left-n.attributes.position.x,a=i.position.top-n.attributes.position.y;n.translate(r,a);},stop:function stop(i,o){var n,r,a,s;if(e.guideMessage)e.hideGuideBox(),e.hideGuideMessage(),n=o.helper.attr("cid"),(a=o.helper.attr("link-cid"))&&e.graph.getCell(a).remove(),e.graph.getCell(n).remove();else{n=o.helper.attr("cid"),r=e.graph.getCell(n);var l=o.position.left-r.attributes.position.x,c=o.position.top-r.attributes.position.y;r.translate(l,c);var d=e.calcGuidePosition(r);r.attributes.dummy=!1,r.position(d.x,d.y),e.hideGuideBox();var p=new t.VA.Core.CompoundCommand(e,{label:"Clone and Connect"});p.add(e.createNewFnUnitCommand(r,e.duplicatedFnUnit)),p.add(e.createSetFnUnitPositionCommand(r,d.x,d.y)),(a=o.helper.attr("link-cid"))&&(s=e.graph.getCell(a),p.add(e.createConnectFnUnitCommand(s))),e.fireCommand(p);e.switchFnUnitDialog=new t.VA.Core.Dialogs.SwitchFnUnitDialog(o.helper,{preFnUnit:e.duplicatedFnUnit,modelType:e.getModel().type,close:function close(t){if(t.OK){var i=e.duplicatedFnUnit;if(i.func!==t.func){var o=e.getModel().newFnUnit(t.func);o.display.diagram.position=$.extend({},i.display.diagram.position);var n=e.createSwitchFnUnitCommand(r,o,i);n.event.source=this,e.fireCommand(n);}}e.switchFnUnitDialog=null;}});}}}),this.toolItems.cloneAndConnect=i;},r.prototype.setConnectToolItemVisible=function(t){var e=this.$tools.find(".brtc-va-editors-diagram-diagrameditorpage-function-tools-connect");t?e.css("display","block"):e.css("display","none");},r.prototype._findConnectableFigures=function(t){var e,i=[],o=this,n=this._getConnectableFids(t.attributes.fid);t.attributes.connectableFunctions&&(n=n.filter(function(e){var i=o.getFnUnitById(e);return t.attributes.connectableFunctions.indexOf(i.func)>=0;}));var r=[],a=this.graph.getConnectedLinks(t);for(var s in a){r.push(a[s].getTargetElement().cid);}for(var s in n){e=this.getFigureByFnUnitId(n[s]),t.attributes.connectableFunctions?r.indexOf(e.cid)<0&&(i.push(e),e.setCursorType("pointer")):e.attributes.inputtable&&r.indexOf(e.cid)<0&&(i.push(e),e.setCursorType("pointer"));}return i;},r.prototype._setBehaviorModeToLink=function(){var e=this;this.behaviorMode="link";var i=this.graph.getElements();for(var o in i){i[o]instanceof t.VA.Core.Shapes.FnUnitFigure&&(this._isConnectableCell(i[o])||i[o].setOnShade());}setTimeout(function(){e._clearSelectedLink(),e.hideSelectionBox();},100);},r.prototype._setBehaviorModeToDefault=function(){this.behaviorMode=i;var e=this.graph.getElements();for(var o in e){e[o]instanceof t.VA.Core.Shapes.FnUnitFigure&&(e[o].setOffShade(),e[o].setCursorType("inherit"));}this._connectableFigures=[],this._unhighlightAll();},r.prototype._isConnectableCell=function(t){var e=!1;for(var i in this._connectableFigures){if(this._connectableFigures[i]===t){e=!0;break;}}return e;},r.prototype.createConnectToolItem=function(){var e,i,o=this,n=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-connect" title="Connect"></div>');this.$tools.append(n),n.click(function(){o.cellPointer={},o.cellPointer.state="link";var t=o.$tools.attr("cid");e=o.graph.getCell(t);var i=o.paper.findViewByModel(e);o._highlightedViews.push(i),i.highlight(),o._connectableFigures=o._findConnectableFigures(e),o._fromCell=e,o._setBehaviorModeToLink();}),n.draggable({appendTo:o.$paperElement,helper:function helper(t){return $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools-link-helper"></div>');},start:function start(n,r){var a=o.$tools.attr("cid");e=o.graph.getCell(a);var s=t.VA.Core.Utils.IDGenerator.link.id();i=o._createLinkFigure(s,e,{x:r.position.left/o.options.scale,y:r.position.top/o.options.scale}),o.graph.addCells([i]),r.helper.attr("cid",i.cid);},drag:function drag(t,n){n.helper.attr("cid");var r=o.graph.findModelsFromPoint({x:n.position.left/o.options.scale,y:n.position.top/o.options.scale});o._unhighlightAll();var a=e;if(r.length>0&&o._isConnectableFnUnit(a,r[0])){i.set("target",{id:r[0].id,port:"in-left"}),o.paper.findViewByModel(i).update();var s=o.paper.findViewByModel(r[0]);o._highlightedViews.push(s),s.highlight();}else i.set("target",{x:n.position.left/o.options.scale,y:n.position.top/o.options.scale}),o.paper.findViewByModel(i).update();},stop:function stop(t,e){o._unhighlightAll();e.helper.attr("cid");var n=o.graph.findModelsFromPoint({x:e.position.left/o.options.scale,y:e.position.top/o.options.scale});if(n.length>0){if(i.attributes.source.id==n[0].id)i.remove(),o.notification("warning","No connection could be made because connection loop.");else{var r=o.validateConnect([i]);if(r)o.notification("warning",r),i.remove();else{var a=o.createConnectFnUnitCommand(i);o.fireCommand(a)?(i.set("target",{id:n[0].id,port:"in-left"}),o.paper.findViewByModel(i).update()):(i.remove(),o.notification("warning","No connection could be made because connection already exists."));}}}else i.remove(),o.notification("warning","No connection could be made.");},scope:"tasks"}),this.toolItems.connect=n;},r.prototype._isConnectableFnUnit=function(t,e){var i=!1,o=t.attributes.connectableFunctions,n=e.attributes.acceptableFunctions;if(o){for(var r=this.getFnUnitById(e.attributes.fid),a=0;a<o.length;a++){if(o[a]===r.func){i=!0;break;}}}else if(n){var s=this.getFnUnitById(t.attributes.fid);i=_.indexOf(n,s.func)>=0;}else e.attributes.inputtable&&(i=!0);return i;},r.prototype._unhighlightAll=function(){for(var t=0;t<this._highlightedViews.length;t++){this._highlightedViews[t].unhighlight();}this._highlightedViews=[];},r.prototype.createCloneToolItem=function(){var i=this,o=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools brtc-va-editors-diagram-diagrameditorpage-function-tools-clone" title="Duplicate"></div>');this.$tools.append(o),o.click(function(){i.notification("info","Click and drag to clone function");}),o.draggable({appendTo:i.$paperElement,helper:function helper(t){return $('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tools-clone-helper"></div>');},start:function start(o,n){var r=i.$tools.attr("cid"),a=i.graph.getCell(r),s=a.clone();s.unselect(),s.resetRuntime();var l={functions:[_.cloneDeep(i.getFnUnitById(s.attributes.fid))],links:[],innerModels:{},type:"data"};l.innerModels=i._collectInnerModels(i.getEditor().getModel(),l);var c=t.VA.Core.Utils.ModelUtils.cloneModel(l);i.duplicatedFnUnit=c.functions[0],e.clearInData(i.duplicatedFnUnit),i.duplicatedDummyModel=c,s.attributes.dummy=!0,s.attributes.fid=i.duplicatedFnUnit.fid;var d=n.position.left/i.options.scale-a.attributes.position.x,p=n.position.top/i.options.scale-a.attributes.position.y;s.translate(d,p),i.graph.addCells([s]),s.toFront({deep:!0}),n.helper.attr("cid",s.cid),i.showGuideBox(s);},drag:function drag(t,e){var o=e.helper.attr("cid"),n=i.graph.getCell(o),r=e.position.left/i.options.scale-n.attributes.position.x,a=e.position.top/i.options.scale-n.attributes.position.y;n.translate(r,a);},stop:function stop(e,o){var n,r;if(i.guideMessage)i.hideGuideBox(),i.hideGuideMessage(),n=o.helper.attr("cid"),i.graph.getCell(n).remove();else if(i.getFunctionsLength()+1>i.MAX_FUNC_COUNT)i.hideGuideBox(),i.hideGuideMessage(),n=o.helper.attr("cid"),i.graph.getCell(n).remove(),t.VA.Core.Utils.WidgetUtils.openErrorDialog(i.MAX_FUNC_MESSAGE);else{n=o.helper.attr("cid"),r=i.graph.getCell(n);var a=o.position.left/i.options.scale-r.attributes.position.x,s=o.position.top/i.options.scale-r.attributes.position.y;r.translate(a,s),i.hideGuideBox();var l=i.calcGuidePosition(r);r.position(l.x,l.y),r.attributes.dummy=!1;var c=[];"true"===t.VA.SettingStorage.getValue("editor.diagram.autoconnect")&&(c=i.connectSmartly(r));var d=new t.VA.Core.CompoundCommand(i,{label:"Clone a Function"});for(var p in d.add(i.createNewFnUnitCommand(r,i.duplicatedFnUnit,i.duplicatedDummyModel)),d.add(i.createSetFnUnitPositionCommand(r,l.x,l.y)),c){d.add(i.createConnectFnUnitCommand(c[p]));}i.fireCommand(d),i.showSelectionBox([r]);}}}),this.toolItems.duplicate=o;},r.prototype.createMultiSelectionToolbar=function(){var e=this;this.$multiTools=this.$mainControl.find(".brtc-va-editors-diagram-diagrameditorpage-function-multiselected"),this.$multiTools.append('<div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-toolbar">   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-remove" title="Remove"></div>   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-add-library" title="Add to Template"></div>   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-run" title="Run"></div>   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-add-clipboard" title="Add to Clipboard"></div>   <div class="brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-bind-functions" title="Bind for OPT"></div></div>'),this.$multiTools.find(".brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-remove").click(function(){var t=e.getSelectedFigures();e.removeFnUnitFigures(t);}),this.$multiTools.find(".brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-add-library").click(function(){if(!e.getEditor().getEditorState("readonly-figure-selected")){var i=e.makeTemplate.call(e);t.VA.Core.Utils.WidgetUtils.getModelEditorRef(e.$mainControl).addToLibrary(i);}}),this.$multiTools.find(".brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-add-clipboard").click(function(){if(!e.getEditor().getEditorState("readonly-figure-selected")){var i=e.makeTemplate.call(e);t.VA.Core.Utils.WidgetUtils.getModelEditorRef(e.$mainControl).addToFunctionClipboard(i);}}),this.$multiTools.find(".brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-run").click(function(){var i,o,n,r=e.getModel(),a=$.extend(!0,{},r);a.functions=[];var s=e.getSelectedFigures(),l=[];for(var c in s){o=s[c],i=$.extend(!0,{},e.getFnUnitById(o.attributes.fid)),a.addFnUnit(i),l.push(i.fid);}var d=[];for(var p in a.links){n=a.links[p],(l.indexOf(n[SOURCE_FID])<0||l.indexOf(n[TARGET_FID])<0)&&d.push(n);}for(var u in d){a.links.splice(a.links.indexOf(d[u]),1);}var h=function h(e){e.OK&&(t.VA.Core.DataQueryTemplate.removeCache(a.mid),Studio.getJobExecutor().launchModel(a,e.args));};if("true"===t.VA.SettingStorage.getValue("editor.variable.visible")&&Object.keys(e.getEditor().getModel().variables).length>0)new t.VA.Core.Dialogs.RunDataDialog($(this),{close:h,analyticsModel:e.getEditor().getModel()});else{var f={};for(var m in e.getEditor().getModel().variables){var g,v=e.getEditor().getModel().variables[m];g=_.isArray(v.value)&&1===v.value.length?v.value[0]:v.value,_.isUndefined(g)||(f[m]=v.value);}h({OK:!0,args:f});}}),this.$multiTools.find(".brtc-va-editors-diagram-diagrameditorpage-function-multiselected-tools-bind-functions").click(function(){var i=e.getEditor().getEditorInput().getProjectId(),o=e.getEditor().getEditorInput().getFileId();if(o!=e.getEditor().activeModel.mid)return t.VA.Core.Utils.WidgetUtils.openErrorDialog("OPT models cannot be made in inner models.");var n=function(t){for(var e=[],i=0;i<t.length;i++){e.push(t[i].attributes.fid);}return e;}(e.getSelectedFigures()),r=n.sort().join("_"),a=e.getEditor().activeModel.optModels;for(var s in a){if(a[s].hash==r)return t.VA.Core.Utils.WidgetUtils.openErrorDialog("This OPT model already exists.");}var l=t.OptModelManager.createNewOptModelCommand(i,o,n);e.fireCommand(l);});},r.prototype._collectInnerModels=function(e,i){return _.reduce(_.map(t.VA.Core.Utils.NestedFlowUtils.getAllSubModelsFromModel(e,i),function(t){var e={};return e[t.mid]=t,e;}),_.merge,{});},r.prototype.makeTemplate=function(){var i,o,n={functions:[],links:[],innerModels:{},type:"data"},r=this.getEditor().getModel(),a=this.getSelectedFigures(),s=Number.MAX_VALUE,l=Number.MAX_VALUE,c=[];for(i in a){var d=this.getFnUnitById(a[i].attributes.fid);s=Math.min(s,d.display.diagram.position.x),l=Math.min(l,d.display.diagram.position.y),n.functions.push($.extend(!0,{},d));var p=this.graph.getConnectedLinks(a[i]);for(o in p){c.indexOf(p[o].attributes.kid)<0&&c.push(p[o].attributes.kid);}}for(i in n.functions){n.functions[i].display.diagram.position.x-=s,n.functions[i].display.diagram.position.y-=l;}for(i in c){var u=this.getLinkUnitById(c[i]),h=0;for(o in n.functions){if(n.functions[o].fid==u[SOURCE_FID]&&h++,n.functions[o].fid==u[TARGET_FID]&&h++,2==h)break;}2==h&&n.links.push($.extend(!0,{},u));}n.functions.sort(function(t,e){return t.display.diagram.position.x==e.display.diagram.position.x?t.display.diagram.position.y-e.display.diagram.position.y:t.display.diagram.position.x-e.display.diagram.position.x;}),n.innerModels=this._collectInnerModels(r,n);var f=t.VA.Core.Utils.NestedFlowUtils.isProcessFunction,m=_.negate(f);return function(i,o){var n=o.reduce(function(t,e){return _.merge(t,_.set({},e,!0));},{}),r=function r(t,e){return _.set({},t,e);},a=_.partial(_.has,n),s=_.partial(_.filter,_,a),l=[];i.functions=i.functions.map(function(o){if(m(o)&&o[IN_DATA]){var n=_.reject(_.map(o[IN_DATA],function(t,e){return a(t)?-1:e;},_.partial(_.isEqual,-1))),c=function c(t){return _.reject(t,function(t,e){return _.indexOf(n,e)>=0;});},d=_.map(t.VA.Core.Utils.NestedFlowUtils.getSubModels(i,o),IN_DATA);_.forEach(d,function(t){t[IN_DATA]=c(t[IN_DATA]);}),o[IN_DATA]=c(o[IN_DATA]);}else if(f(o)){var p=_.clone(o),u=_.clone(s(o[IN_DATA])),h=_.clone(s(o[OUT_DATA]));return _.merge({},_.omit(p,[IN_DATA,OUT_DATA]),r(IN_DATA,u),r(OUT_DATA,h));}return l=_.union(l,e.getOutData(o)),o;}),i.functions=i.functions.map(function(t){if(m(t)&&e.hasInput(t)&&e.hasMeta(t)){var i=e.getInData(t);for(var o in i){var n=i[o],r=e.getTypeByTableId(t,n);_.indexOf(l,n)<0&&e.removeInData(t,r,n);}}return t;});}(n=t.VA.Core.Utils.ModelUtils.extendModel(n,!0),_.flatten(_.map(_.filter(n.functions,m),OUT_DATA))),n;},r.prototype.createNewFnUnitCommand=function(e,i,o){e.attributes.fid=i.fid;var n=this,r=[];"DataViewer"!==i[FUNCTION_NAME]&&i.skip&&(i.skip=!1),r.push(new t.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand(this,{fnUnit:i}));var a=function(t){var e=[];return"if"===t.func?(e.push({mid:t.param.if.mid,type:t.func,conditionType:"if"}),(e=e.concat(_.map(t.param.elseif,function(e){return{mid:e.mid,type:t.func,conditionType:"elseif"};}))).push({mid:t.param.else.mid,type:t.func,conditionType:"else"})):"forLoop"!==t.func&&"whileLoop"!==t.func||e.push({mid:t.param.mid,type:t.func}),e;}(i);return r=r.concat(_.flatten(_.map(a,function(e){var i=function(){if(o){var i=o.getInnerModel(e.mid),n=t.VA.Core.Utils.NestedFlowUtils.getAllSubModelsFromModel(o,i).concat(i);return i[IN_DATA]=[],_.map(n,function(t){return{contents:t,mid:t.mid};});}return[e];}();return _.map(i,function(e){return new t.VA.Core.Editors.Diagram.Commands.NewActivityCommand(n,e);});})));},r.prototype.getActivityModels=function(e){var i=t.VA.Core.Utils.NestedFlowUtils.getSubModels(this.getEditor().getModel(),e);return _.map(i,function(t){return t.mid;});},r.prototype.createRemoveFnUnitCommand=function(e){var i=new t.VA.Core.CompoundCommand(this),o=this.getFnUnitById(e.attributes.fid),n=this.getActivityModels(o);return _.map(n,function(e){i.add(new t.VA.Core.Editors.Diagram.Commands.RemoveActivityCommand(this,{mid:e}));}.bind(this)),i.add(new t.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand(this,{fid:e.attributes.fid})),i;},r.prototype.createSetFnUnitPositionCommand=function(e,i,o){return new t.VA.Core.Editors.Diagram.Commands.SetFnUnitPositionCommand(this,{fid:e.attributes.fid,position:{x:i,y:o}});},r.prototype.createShiftLeftCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.ShiftLeftCommand(this,{fid:e.attributes.fid});},r.prototype.createShiftRightCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.ShiftRightCommand(this,{fid:e.attributes.fid});},r.prototype.createSwitchFnUnitCommand=function(e,i,o){return new t.VA.Core.Editors.Diagram.Commands.SwitchFnUnitCommand(this,{modelType:this.getModel().type,fid:e.attributes.fid,fnUnit:i,prvFnUnit:o});},r.prototype.createConnectFnUnitCommand=function(e,i){var o=new t.VA.Core.CompoundCommand(this,{label:"Connect a Function"}),n={kid:e.attributes.kid,sourceFid:e.getSourceElement().attributes.fid,targetFid:e.getTargetElement().attributes.fid};!0===i&&(n.isMaintainIntable=i),o.add(new t.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand(this,n));n={kid:e.attributes.kid,sourceFid:e.getSourceElement().attributes.fid,targetFid:e.getTargetElement().attributes.fid};return!0===i&&(n.isMaintainIntable=i),o;},r.prototype.createDisconnectFnUnitCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand(this,{kid:e.attributes.kid,sourceFid:e.getSourceElement().attributes.fid,targetFid:e.getTargetElement().attributes.fid});},r.prototype.createReconnectFnUnitCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this,{kid:e.attributes.kid,sourceFid:e.getSourceElement().attributes.fid,targetFid:e.getTargetElement().attributes.fid});},r.prototype.fireCommand=function(e){return(e.constructor!==t.VA.Core.CompoundCommand||0!==e.commandList.length)&&t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl).getCommandManager().execute(e);},r.prototype.registerDebugListener=function(){var t=this;this.debugListener=function(e,i){t.$mainControl.closest(".brtc-va-editor-wrapper").hasClass("selected")&&i.mid==t.getModel().mid&&("BEGIN-PROCESS"==i.eventType&&"unit"!==i.launchOptions.mode?t.hideSelectionBox():"BEGIN-UNIT"==i.eventType?t.getFigureByFnUnitId(i.fid):"END-UNIT"==i.eventType&&t.renderCompletedFnUnit(i));},Studio.getInstance().addDebugListener(this.debugListener);},r.prototype.registerCommandEventListener=function(){t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl).addCommandListener(this.onCommand.bind(this));},r.prototype.onCommand=function(e){"link"===this.behaviorMode?this._setBehaviorModeToDefault():this._clearSelectedLink(),e instanceof t.VA.Core.Editors.Diagram.Commands.AppendNewFnUnitCommand?this.onAppendNewFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.PrependNewFnUnitCommand?this.onPrependNewFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand?this.onNewFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand?this.onRemoveFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand?this.onConnectFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand?this.onDisconnectFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand?this.onReconnectFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand?this.onSetFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand?this.onSetFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand?this.onSetFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand?this.onSetFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.AddFnUnitParameterCommand?this.onSetFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveFnUnitParameterCommand?this.onSetFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ReplaceFnUnitParamCommand?this.onSetFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitPositionCommand?this.onSetFnUnitPositionCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ShiftLeftCommand?this.onShiftCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ShiftRightCommand?this.onShiftCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand?this.onRenameFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetDialogFnUnitCommand?this.onSetDialogFnUnitCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.NewOptModelCommand?this.onNewOptModelCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetOptModelCommand?this.onSetOptModelCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveOptModelCommand?this.onRemoveOptModelCommand(e):e instanceof t.VA.Core.CompoundCommand&&this.onCompoundCommand(e),this.hideGuideMessage();},r.prototype.onCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type)for(e in t.commandList){this.onCommand(t.commandList[e]);}else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--){this.onCommand(t.commandList[e]);}},r.prototype.onAppendNewFnUnitCommand=function(t){if(this.onCompoundCommand(t),"EXECUTE"==t.event.type){var e=this.getFigureByFnUnitId(t.options.fnUnit.fid);this.showSelectionBox([e]);}},r.prototype.onPrependNewFnUnitCommand=function(t){if(this.onCompoundCommand(t),"EXECUTE"==t.event.type){var e=this.getFigureByFnUnitId(t.options.fnUnit.fid);this.showSelectionBox([e]);}},r.prototype.onNewFnUnitCommand=function(t){var e,i;"REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this?(i=t.options.fnUnit,e=this.createFnUnitFigure(i),this.graph.addCells([e]),this.ensureVisible(e),"EXECUTE"==t.event.type&&this.showSelectionBox([e])):"UNDO"==t.event.type&&(i=t.options.fnUnit,e=this.getFigureByFnUnitId(i.fid),this._removeFigure(e));},r.prototype.onRemoveFnUnitCommand=function(e){var i,o;"REDO"==e.event.type||"EXECUTE"==e.event.type&&e.event.source!==this?(i=this.getFigureByFnUnitId(e.options.fid),this._removeFigure(i)):"UNDO"==e.event.type&&(o=this.getFnUnitById(e.options.fid),i=this.createFnUnitFigure(o),this.graph.addCells([i]),this.fitToContent(),this.ensureVisible(i)),setTimeout(function(){t.OptModelManager.renderOptModels();},600);},r.prototype.onConnectFnUnitCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this){var i=this.getLinkUnitById(t.options.kid);(e=this.createLinkFigure(i))&&(this.graph.addCells([e]),e.toBack());}else"UNDO"==t.event.type&&(e=this.getLinkFigureByLinkUnitId(t.options.kid),this._removeLink(e));},r.prototype.onDisconnectFnUnitCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this)e=this.getLinkFigureByLinkUnitId(t.options.kid),this._removeLink(e);else if("UNDO"==t.event.type){var i=this.getLinkUnitById(t.options.kid);(e=this.createLinkFigure(i))&&(this.graph.addCells([e]),e.toBack());}},r.prototype.onReconnectFnUnitCommand=function(t){var e,i,o,n;("REDO"==t.event.type||"UNDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this)&&(i=this.getModel().getLinkUnitById(t.options.kid),o=this.getFigureByFnUnitId(i[SOURCE_FID]),n=this.getFigureByFnUnitId(i[TARGET_FID]),(e=this.getLinkFigureByLinkUnitId(i.kid)).set("source",{id:o.id,port:"out-right"}),e.set("target",{id:n.id,port:"in-left"}));},r.prototype.onSetFnUnitCommand=function(t){var e;"REDO"!=t.event.type&&"UNDO"!=t.event.type||(e=this.getFigureByFnUnitId(t.options.fnUnit.fid))&&this.showSelectionBox([e]);},r.prototype.onSetDialogFnUnitCommand=function(t){"REDO"==t.event.type||t.event.type;},r.prototype.onNewOptModelCommand=function(e){t.OptModelManager.renderOptModels();},r.prototype.onSetOptModelCommand=function(e){t.OptModelManager.renderOptModels();},r.prototype.onRemoveOptModelCommand=function(e){t.OptModelManager.renderOptModels();},r.prototype.onSetFnUnitPositionCommand=function(e){var i,o;("REDO"==e.event.type||"UNDO"==e.event.type||"EXECUTE"==e.event.type&&e.event.source!==this)&&(i=this.getFigureByFnUnitId(e.options.fid),(o=this.getFnUnitById(e.options.fid))&&i.position(o.display.diagram.position.x,o.display.diagram.position.y),this._rerouteLink(),this.hideSelectionBounds(),this.showSelectionBounds()),t.OptModelManager.renderOptModels();},r.prototype.onShiftCommand=function(e){var i,o,n;for(var r in e.options.changed){i=e.options.changed[r],n=this.getFnUnitById(i),o=this.getFigureByFnUnitId(i),n&&o&&o.position(n.display.diagram.position.x,n.display.diagram.position.y);}this.hideTools(!0),t.OptModelManager.renderOptModels();},r.prototype.onRenameFnUnitCommand=function(t){var e=this.getFigureByFnUnitId(t.options.fid),i=this.getFnUnitById(t.options.fid);i&&(e.label(i.display.label,this.options.scale),this._hasDescription(i)?e.showToolTipIcon():e.hideToolTipIcon());},r.prototype.getFnUnitById=function(t){return this.getModel().getFnUnitById(t);},r.prototype.getLinkUnitById=function(t){return this.getModel().getLinkUnitById(t);},r.prototype.getFigureByFnUnitId=function(t){var e=this.graph.getElements();for(var i in e){if(e[i].attributes.fid===t)return e[i];}},r.prototype.getLinkFigureByLinkUnitId=function(t){var e=this.graph.getLinks();for(var i in e){if(e[i].attributes.kid===t)return e[i];}},r.prototype.getSelectedFigures=function(){var t=this;return this.$paperElement.children(".brtc-va-editors-diagram-diagrameditorpage-function-selected").map(function(){var e=$(this).attr("cid");return t.graph.getCell(e);}).toArray();},r.prototype.getSelectedFigureIds=function(){var t=[];return this.$paperElement.children(".brtc-va-editors-diagram-diagrameditorpage-function-selected").each(function(e,i){t.push($(this).attr("cid"));}),t.sort(),t;},r.prototype.selectFunction=function(t){var e=this;"link"===e.behaviorMode&&e._setBehaviorModeToDefault();var i=this.getFigureByFnUnitId(t);this.showSelectionBox([i]),setTimeout(function(){e.ensureCenter(i);},100);},r.prototype.isReadOnlyFigure=function(t){return"brightics"===t.attributes.attrs.category;},r.prototype.calcGuidePosition=function(t){return this.calcGuideLocation(t.attributes.position.x,t.attributes.position.y);},r.prototype.calcGuideLocation=function(e,i){var o=this.GAP_WIDTH||t.VA.Env.Diagram.GAP_WIDTH,n=this.GAP_HEIGHT||t.VA.Env.Diagram.GAP_HEIGHT,r=t.VA.Env.Diagram.FIGURE_WIDTH+o,a=t.VA.Env.Diagram.FIGURE_HEIGHT+n,s=e-t.VA.Env.Diagram.PAPER_MARGIN_LEFT,l=Math.floor(s/r)*r;s=s>l+r/2?l+r:l,s+=t.VA.Env.Diagram.PAPER_MARGIN_LEFT;var c=i-t.VA.Env.Diagram.PAPER_MARGIN_TOP,d=Math.floor(c/a)*a;return c=c>d+a/2?d+a:d,{x:s,y:c+=t.VA.Env.Diagram.PAPER_MARGIN_TOP};},r.prototype.showGuideBox=function(t){var e=this.calcGuidePosition(t);this.$guideBox.css({top:e.y*this.options.scale,left:e.x*this.options.scale,display:"block"});},r.prototype.updateGuideBox=function(t){var e=this.calcGuidePosition(t);this.$guideBox.css({top:e.y*this.options.scale,left:e.x*this.options.scale});},r.prototype.hideGuideBox=function(){this.$guideBox&&this.$guideBox.hide();},r.prototype.showGuideMessage=function(e,i){var o=e.attributes.position.x,n=e.attributes.position.y+t.VA.Env.Diagram.FIGURE_HEIGHT;this.guideMessage=i,this.$guideMessageBox.text(i),this.$guideMessageBox.css({top:Math.max(0,n*this.options.scale),left:Math.max(0,o*this.options.scale),display:"block"});},r.prototype.hideGuideMessage=function(){this.guideMessage=null,this.$guideMessageBox&&this.$guideMessageBox.hide();},r.prototype.renderStartedFnUnit=function(t){this.ensureCenter(t);},r.prototype.renderCompletedFnUnit=function(t){var e=this.getFigureByFnUnitId(t.fid),i=t.end?new Date(parseInt(t.end)):Date.now();e&&e.lastRuntime(i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+"."+i.getMilliseconds());var o=$.extend(!0,{},t);delete o.launchOptions,delete o.originalResponse,window.sessionStorage&&sessionStorage.setItem(o.fid,JSON.stringify(o));},r.prototype.render=function(t){var e,i=t||this.getModel();for(e in this.$paperElement.children(".brtc-va-editors-diagram-diagrameditorpage-function-selected").remove(),this.graph.clear(),i.functions){var o=i.functions[e],n=this.createFnUnitFigure(o);if(this.graph.addCells([n]),sessionStorage){var r=JSON.parse(sessionStorage.getItem(o.fid)||"{}");if(r&&r.end){var a=new Date(parseInt(r.end));n.lastRuntime(a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"."+a.getMilliseconds());}}}for(e in i.links){var s=i.links[e],l=this.createLinkFigure(s);l&&this.graph.addCells([l]);}var c=this.graph.getLinks();$.each(c,function(t,e){e.toBack();}),this.fitToContent(),this.hideErrorBox(),this.showErrorBox(this.findError());},r.prototype.onActivated=function(){var t=this.graph.getLinks();$.each(t,function(t,e){e.remove();});var e=this;setTimeout(function(){for(var i in e.getModel().links){var o=e.getModel().links[i],n=e.createLinkFigure(o);n&&e.graph.addCells([n]);}t=e.graph.getLinks(),$.each(t,function(t,e){e.toBack();});},400);},r.prototype.getPaperSize=function(){var t={},e=this.graph.getBBox(this.graph.getElements());return e?(t.width=e.x+e.width+900,t.width=t.width+(900-t.width%900),t.width=Math.max(t.width,this.$mainControl.width()),t.height=e.y+e.height+50,t.height=t.height+(50-t.height%50),t.height=Math.max(t.height,this.$mainControl.height()-4)):(t.width=this.$mainControl.width(),t.height=this.$mainControl.height()-4),t;},r.prototype.fitToContent=function(){var t=this.getPaperSize(),e=t.width,i=t.height;this.paper.setDimensions(e,i),this.updateMiniMapWindow(),this.$mainControl.perfectScrollbar("update");},r.prototype.updateMiniMapWindow=function(){this.minimap.updateMiniMapWindow();},r.prototype.disableAllFnUnitFigure=function(){var e=this.graph.getCells();for(var i in e){e[i]instanceof t.VA.Core.Shapes.LinkFigure?this.disableLink(e[i]):e[i]instanceof t.VA.Core.Shapes.FnUnitFigure&&this.disableFnUnit(e[i]);}},r.prototype.enableAllFnUnitFigure=function(){var e=this.graph.getCells();for(var i in e){e[i]instanceof t.VA.Core.Shapes.LinkFigure?this.enableLink(e[i]):e[i]instanceof t.VA.Core.Shapes.FnUnitFigure&&this.enableFnUnit(e[i]);}},r.prototype.enableFnUnit=function(t){t.transition("attrs/rect/opacity",.2,this.opacity4transition),t.transition("attrs/circle/opacity",.2,this.opacity4transition),t.transition("attrs/text/opacity",.2,this.opacity4transition),t.attr("text/font-weight","bold");},r.prototype.disableFnUnit=function(t){t.attr("rect/opacity",.2),t.attr("circle/opacity",.2),t.attr("text/opacity",.2),t.attr("text/font-weight","");},r.prototype.enableLink=function(t){t.transition("attrs/path/opacity",.2,this.opacity4transition);},r.prototype.disableLink=function(t){t.attr("path/opacity",.1);},r.prototype.checkInputtable=function(t){return e.getTotalInRangeCount(t).min>0||e.isBluffNode(t);},r.prototype.createFnUnitFigure=function(i){var r=this.getModel().type,a=new t.VA.Core.Shapes.FnUnitFigure({colorSet:this.options.editor.getColorSet(),position:i.display.diagram.position,size:{width:t.VA.Env.Diagram.FIGURE_WIDTH,height:t.VA.Env.Diagram.FIGURE_HEIGHT},fid:i.fid,inputtable:e.isInputtable(i),outputtable:e.isOutputtable(i),connectableFunctions:t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(r,i.func)["connectable-functions"],acceptableFunctions:t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(r,i.func)["acceptable-functions"],ports:{groups:{"in:l":{position:{name:"left"},attrs:{".fnunit-port":{stroke:"red"}}},"out:r":{position:{name:"right"},attrs:{".fnunit-port":{stroke:"blue"}}}},items:[o,n]}});a.label(i.display.label,this.options.scale),a.attr({".brtc-va-rotatable":{fid:i.fid}});var s=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(r,i.func);return s&&(a.category(s),s.deprecated&&a.setDeprecated(s["deprecated-message"])),this._hasDescription(i)?a.showToolTipIcon():a.hideToolTipIcon(),a;},r.prototype._hasDescription=function(t){return t.display.description&&""!==t.display.description&&t.display.description&&"<p><br></p>"!==t.display.description;},r.prototype.createLinkFigure=function(e){var i=this.getFigureByFnUnitId(e[SOURCE_FID]),o=this.getFigureByFnUnitId(e[TARGET_FID]);if(i&&o){var n=new t.VA.Core.Shapes.LinkFigure({kid:e.kid,source:{id:i.id,port:"out-right"},target:{id:o.id,port:"in-left"}});return n.on("change",function(t,e){e.ui&&t.attributes.target.id&&!t.attributes.target.port&&t.set("target",{id:t.attributes.target.id,port:"in-left"}),e.ui&&t.attributes.source.id&&!t.attributes.source.port&&t.set("source",{id:t.attributes.source.id,port:"out-right"});}),n;}},r.prototype._createLinkFigure=function(e,i,o){var n={kid:e,source:{id:i.id,port:"out-right"},target:{id:o.id,port:"in-left"}};i.x&&i.y&&(n.source={x:i.x,y:i.y}),o.x&&o.y&&(n.target={x:o.x,y:o.y});var r=new t.VA.Core.Shapes.LinkFigure(n);return r.on("change:source",function(){}),r.on("change:target",function(){}),r;},r.prototype.updateToolsPosition=function(e){var i=e.attributes.position;i&&e instanceof t.VA.Core.Shapes.FnUnitFigure&&e.attributes.fid&&this.$tools.css({top:i.y*this.options.scale,left:i.x*this.options.scale});},r.prototype.showTools=function(e){var i=this,o=e.attributes.position;o&&e instanceof t.VA.Core.Shapes.FnUnitFigure&&!e.attributes.dummy&&(this.clearHideToolsTimer(),this.clearShowToolsTimer(),this.showToolsTimer=setTimeout(function(){var t=e.attributes.fid,n=i.options.editor.getActiveModel().getFnUnitById(t);n&&(i.$tools.attr("has-model",i.hasModel(e.attributes.attrs.category,n)),i.$tools.attr("cid",e.cid),i.$tools.attr("category",e.attributes.attrs.category),i.$tools.attr("select","#FFFFFF"!=e.attributes.attrs[".brtc-va-outer"].fill),i.$tools.css({top:o.y*i.options.scale,left:o.x*i.options.scale,display:"block"}));},50)),this.setConnectToolItemVisible(e.attributes.outputtable);},r.prototype.clearShowToolsTimer=function(){this.showToolsTimer&&(clearTimeout(this.showToolsTimer),this.showToolsTimer=null);},r.prototype.hideTools=function(e){if(this.$tools)if(e)t.OptModelManager.renderOptModels(i),this.$tools.hide();else{this.clearShowToolsTimer(),this.clearHideToolsTimer();var i=this;this.hideToolsTimer=setTimeout(function(){t.OptModelManager.renderOptModels(i),i.$tools.hide();},200);}},r.prototype.clearHideToolsTimer=function(){this.hideToolsTimer&&(clearTimeout(this.hideToolsTimer),this.hideToolsTimer=null);},r.prototype.showToolTip=function(e){var i,o=this,n=this.getModel().type,r=e.attributes.position;if(r&&e instanceof t.VA.Core.Shapes.FnUnitFigure&&!e.attributes.dummy&&this.getEditor().getEditorState("tooltip-enabled")){var a=o.getFnUnitById(e.attributes.fid),s=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(n,a.func);i=e.getColor(),o.$toolTip.empty();var l=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header-func">   <label class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header-func-label" style="background-color:'+i+'"></label></div>');"udf"===s.category?l.find(".brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header-func-label").text("UDF"):l.find(".brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header-func-label").text(s.defaultFnUnit.display.label),o.$toolTip.append(l);var c,d,p,u=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-header"><p></p></div>');u.find("p").text(a.display.label),o.$toolTip.append(u),o.$toolTip.addClass("brtc-va-editors-visible"),o.$toolTip.css({top:(r.y+t.VA.Env.Diagram.FIGURE_HEIGHT)*o.options.scale,left:r.x*o.options.scale}),o._hasDescription(a)?(c=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents-container"></div>'),d=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents">'+a.display.description+"</div>"),p=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents-edit"></div>'),o.$toolTip.append(c),c.append(d),c.append(p),d.perfectScrollbar()):(c=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents-empty-container"></div>'),p=$('<div class="brtc-va-editors-diagram-diagrameditorpage-function-tooltip-contents-edit"></div>'),o.$toolTip.append(c),c.append(p),c.append(p)),p.click(function(e){var i={title:"Edit Function",label:a.display.label,description:a.display.description||"",close:function close(t){t.OK&&o.doEditFunction(a.fid,t.label,t.description);}};new t.VA.Core.Dialogs.EditResourceDialog(o.$mainControl,i);});}},r.prototype.hideToolTip=function(){this.$toolTip&&this.$toolTip.removeClass("brtc-va-editors-visible");},r.prototype.doEditFunction=function(e,i,o){var n=new t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this,{fid:e,name:i,description:o});this.fireCommand(n);},r.prototype.removeFnUnitFigure=function(e){var i=Studio.getEditorContainer().getActiveModelEditor(),o=i.getEditorInput().getProjectId(),n=i.getEditorInput().getFileId(),r=this.getFnUnitById(e.attributes.fid),a=r.display.label;this.notification("success","The function ["+a+"] was removed.");var s=new t.VA.Core.CompoundCommand(this,{label:"Remove a Function"});for(var l in r.param){var c=r.parent().getVariable(r.fid,l);c&&s.add(new t.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(this,{fid:r.fid,paramKey:l,variable:c}));}var d=this.graph.getConnectedLinks(e);for(var p in d){this._removeLink(d[p]),s.add(this.createDisconnectFnUnitCommand(d[p]));}this._removeFigure(e),s.add(this.createRemoveFnUnitCommand(e)),s.add(this.createRemoveConnectedOutDataCommand([e]));var u=t.OptModelManager.getTargetOptModelId(o,n,r.fid);u&&s.add(t.OptModelManager.createRemoveOptModelCommand(o,n,u)),this.fireCommand(s);},r.prototype.removeFnUnitFigures=function(e){var i,o,n,r=Studio.getEditorContainer().getActiveModelEditor(),a=r.getEditorInput().getProjectId(),s=r.getEditorInput().getFileId(),l=new t.VA.Core.CompoundCommand(this,{label:"Remove functions"}),c=[],d=[],p=[];for(o in e){i=this.getFnUnitById(e[o].attributes.fid),c.push(i);var u=this.graph.getConnectedLinks(e[o]);for(n in u){p.indexOf(u[n].attributes.kid)<0&&(p.push(u[n].attributes.kid),d.push(u[n]));}}for(o in d){this._removeLink(d[o]),l.add(this.createDisconnectFnUnitCommand(d[o]));}var h={};for(o in e){e[o].remove(),l.add(this.createRemoveFnUnitCommand(e[o]));var f=c[o].parent().getVariables(c[o].fid);for(var m in f){l.add(new t.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(this,{fid:c[o].fid,paramKey:m,variable:f[m]}));}var g=t.OptModelManager.getTargetOptModelId(a,s,c[o].fid);g&&(h[g]=!0);}for(var v in h){l.add(t.OptModelManager.createRemoveOptModelCommand(a,s,v));}l.add(this.createRemoveConnectedOutDataCommand(e)),this.hideSelectionBox(),this.hideTools(!0),this.notification("success",e.length+" functions were removed."),this.fireCommand(l);},r.prototype.removeFnUnitLink=function(e){var i=this.graph.getConnectedLinks(e);if(i.length>0){var o=this.getFnUnitById(e.attributes.fid).display.label;this.notification("success","All associated connections to ["+o+"] was removed.");var n=new t.VA.Core.CompoundCommand(this,{});for(var r in i){this._removeLink(i[r]),n.add(this.createDisconnectFnUnitCommand(i[r]));}this.fireCommand(n);}else this.notification("info","Already removed all the associated connections to the function");},r.prototype._removeFigure=function(t){if(t){var e={duration:200,timingFunction:joint.util.timing.inout,valueFunction:function valueFunction(t,e){return function(t){return 1-(e+t);};}};t.on("transition:end",function(){t.remove();}),t.transition("attrs/rect.outer/opacity",.2,e),t.transition("attrs/text/opacity",.2,e),t.attributes.dummy=!0,this.hideSelectionBox(t),t.cid==this.$tools.attr("cid")&&this.hideTools(!0);}},r.prototype._revertPosition=function(t){var e=this.getFnUnitById(t.attributes.fid).display.diagram.position,i=t.position();e.x==i.x&&e.y==i.y||t.position(e.x,e.y);},r.prototype._revertLink=function(t){var e=this.getLinkUnitById(t.attributes.kid),i=this.getFigureByFnUnitId(e[SOURCE_FID]),o=this.getFigureByFnUnitId(e[TARGET_FID]);t.set("source",{id:i.id,port:"out-right"}),t.set("target",{id:o.id,port:"in-left"});},r.prototype._removeLink=function(t){if(t){var e={duration:200,timingFunction:joint.util.timing.inout,valueFunction:function valueFunction(t,e){return function(t){return 1-(e+t);};}};t.on("transition:end",function(){t.remove();}),t.transition("attrs/path/opacity",.2,e);}},r.prototype.connectSmartly=function(e){var i,o,n,r=[],a=e.attributes.position.x,s=e.attributes.position.y,l=this.GAP_WIDTH||t.VA.Env.Diagram.GAP_WIDTH,c=(this.GAP_HEIGHT||t.VA.Env.Diagram.GAP_HEIGHT,this.graph.findModelsFromPoint({x:a-l,y:s})),d=this.graph.findModelsFromPoint({x:a+t.VA.Env.Diagram.FIGURE_WIDTH+l,y:s});0===this.graph.getConnectedLinks(e,{inbound:!0}).length&&c.length>0&&!c[0].attributes.connectableFunctions&&e.attributes.inputtable&&c[0].attributes.outputtable&&c[0].attributes.position.y==s&&(i={kid:t.VA.Core.Utils.IDGenerator.link.id(),sourceFid:c[0].attributes.fid,targetFid:e.attributes.fid},(o=this.createLinkFigure(i))&&(this.graph.addCells([o]),o.toBack(),r.push(o)));var p=this.graph.getConnectedLinks(e,{outbound:!0});return!e.attributes.connectableFunctions&&0===p.length&&d.length>0&&d[0].attributes.inputtable&&e.attributes.outputtable&&d[0].attributes.position.y==s&&(i={kid:t.VA.Core.Utils.IDGenerator.link.id(),sourceFid:e.attributes.fid,targetFid:d[0].attributes.fid},(n=this.createLinkFigure(i))&&(this.graph.addCells([n]),n.toBack(),r.push(n))),r;},r.prototype.checkOverPosition=function(t){var e=this.calcGuidePosition(t),i=this.graph.findModelsFromPoint(e);for(var o in i){if(i[o]!=t&&i[o].position().x==e.x&&i[o].position().y==e.y)return!1;}return!0;},r.prototype.checkPreviousPosition=function(t){var e=this.calcGuidePosition(t),i=this.graph.getConnectedLinks(t,{inbound:!0});for(var o in i){if(i[o].getSourceElement().position().x>=e.x)return!1;}return!0;},r.prototype.checkNextPosition=function(t){var e=this.calcGuidePosition(t),i=this.graph.getConnectedLinks(t,{outbound:!0});for(var o in i){if(i[o].getTargetElement().position().x<=e.x)return!1;}return!0;},r.prototype.checkOutRangePosition=function(t){var e=this.calcGuidePosition(t);return e.x>0&&e.y>0;},r.prototype.checkConnectedLink=function(t){return null!=t.getSourceElement()&&null!=t.getTargetElement();},r.prototype.checkLoopLink=function(t){var e=t.getSourceElement().attributes.fid,i=t.getTargetElement().attributes.fid;return this._getConnectableFids(e).indexOf(i)>=0;},r.prototype._getConnectableFids=function(e){var i=this,o=this.options.editor.getActiveModel().links,n=[];this.options.editor.getActiveModel().functions.forEach(function(t){n.push(t.fid);});var r,a={},s=n.length,l=o.length;for(r=0;r<s;r++){a[n[r]]=[];}for(r=0;r<l;r++){a[o[r].targetFid].push(o[r].sourceFid);}var c={},d=function d(t){c[t]=!0;for(var e=0;e<a[t].length;e++){var i=a[t][e];c[i]||d(i);}};d(e);var p=[];for(r=0;r<s;r++){c[n[r]]||p.push(n[r]);}var u=this.getFnUnitById(e);return p=p.filter(function(e){var o=i.getFnUnitById(e),n=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",o.func);return!n["acceptable-functions"]||n["acceptable-functions"].indexOf(u.func)>=0;});},r.prototype.checkLinkPosition=function(t){var e=t.getSourceElement(),i=t.getTargetElement();if("function"==typeof e.position&&"function"==typeof i.position){var o=e.position();return i.position().x>o.x;}return!0;},r.prototype.checkAlreadyExistLink=function(t){for(var e=t.getSourceElement().attributes.fid,i=t.getTargetElement().attributes.fid,o=this.getModel().links,n=0;n<o.length;n++){if(o[n][SOURCE_FID]===e&&o[n][TARGET_FID]===i)return!1;}return!0;},r.prototype.checkAlreadyExistLinkByTableId=function(t){var i=t.getSourceElement().attributes.fid,o=t.getTargetElement().attributes.fid,n=this.getFnUnitById(i),r=this.getFnUnitById(o),a=e.getOutData(n),s=e.getInData(r);for(var l in a){if(s&&s.indexOf(a[l])>-1)return!1;}return!0;},r.prototype.registerGoHistoryEventListener=function(){var e=this,i=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);this.onGoHistoryCommand=function(t){e.hideSelectionBox(),e.render();var i=[],o=[];for(var n in e.problems){void 0===i[e.problems[n].fid]&&(i.push(e.problems[n].fid),o.push(e.getFigureByFnUnitId(e.problems[n].fid)));}e.hideErrorBox(),e.showErrorBox(o);},i.addGoHistoryListener(this.onGoHistoryCommand);},r.prototype.updateStatus=function(t){var e=this.getFigureByFnUnitId(t.fid);e&&e.updateStatus(t.status);},r.prototype.destroy=function(){Studio.getInstance().removeProblemListener(this.problemsListener),Studio.getInstance().removeDebugListener(this.debugListener),this.boundHandleBlankPointerUp&&Studio.getInstance().getControl().off("mouseup",this.boundHandleBlankPointerUp);},r.prototype.registerKeyListener=function(){},r.prototype._addTemplate=function(t){this.$copyTemplate.css({top:this.mouseY,left:this.mouseX,position:"absolute",width:$(window).data("function-clipboard-width"),height:$(window).data("function-clipboard-height"),background:"transparent",border:"none",padding:"none",margin:"none"}),this.$copyTemplate.find(".brtc-va-views-library-template-preview").empty();var e=this.$copyTemplate.find(".brtc-va-views-library-template-preview");e.css("background","transparent");var i,o=new joint.dia.Graph(),n=new joint.dia.Paper({el:e,width:"100%",height:"100%",model:o,interactive:!1,theme:"none"});for(i in n.$el.css("pointer-events","none"),n.scale(1),t.functions){var r=this._createFnUnitFigure(t.functions[i]);o.addCells([r]);}for(i in t.links){var a=this._createLinkFigureCopy(o,t.links[i]);o.addCells([a]);}var s=o.getLinks();return $.each(s,function(t,e){e.toBack();}),this._draggableTemplate(this.$copyTemplate,t),this.$copyTemplate;},r.prototype._draggableTemplate=function(t,e){$(".brtc-va-studio").addClass("brtc-va-studio-dragging");},r.prototype._createFnUnitFigure=function(e){e.display.diagram.position.x+=t.VA.Env.Diagram.PAPER_MARGIN_LEFT,e.display.diagram.position.y+=t.VA.Env.Diagram.PAPER_MARGIN_TOP;var i=new t.VA.Core.Shapes.FnUnitFigure({position:e.display.diagram.position,size:{width:t.VA.Env.Diagram.FIGURE_WIDTH,height:t.VA.Env.Diagram.FIGURE_HEIGHT},fid:e.fid,ports:{groups:{"in:l":{position:{name:"left"},attrs:{".fnunit-port":{stroke:"red"}}},"out:r":{position:{name:"right"},attrs:{".fnunit-port":{stroke:"blue"}}}},items:[o,n]}});i.label(e.display.label,1);this.options.editor.getModelType();var r=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data",e.func);return r&&(i.tooltip(e.display.label+" ("+r.defaultFnUnit.display.label+")"),i.category(r)),i;},r.prototype._createLinkFigureCopy=function(e,i){var o=this.getFigureByFnUnitIdCopy(e,i[SOURCE_FID]),n=this.getFigureByFnUnitIdCopy(e,i[TARGET_FID]);return new t.VA.Core.Shapes.LinkFigure({kid:i.kid,source:{id:o.id,port:"out-right"},target:{id:n.id,port:"in-left"}});},r.prototype.getFigureByFnUnitIdCopy=function(t,e){var i=t.getElements();for(var o in i){if(i[o].attributes.fid===e)return i[o];}},r.prototype.setModel=function(t){this.render(),this.hideAdditionalItems();},r.prototype.hideAdditionalItems=function(t){this.hideValidationToolTip(),this.hideSelectionBounds(),this.hideErrorBox(),this.hideGuideBox(),this.hideGuideMessage(),this.hideTools(!0),this.hideToolTip();},r.prototype.createNewActivityCommand=function(e){var i=t.VA.Core.Utils.NestedFlowUtils.getNewActivityCommandOptions(e);return _.map(i,function(e){return new t.VA.Core.Editors.Diagram.Commands.NewActivityCommand(this,e);}.bind(this));},r.prototype.createRemoveConnectedOutDataCommand=function(i){var o=this,n=[],r=[],a=this.getEditor().getActiveModel();_.forEach(i,function(t){for(var i=o.getFnUnitById(t.attributes.fid),n=e.getOutData(i),s=0;n&&s<n.length;s++){var l=_.indexOf(a[OUT_DATA],n[s]);l>-1&&r.push(l);}}),r.sort(function(t,e){return e-t;});for(var s=0;s<r.length;s++){n.push(new t.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(this,{target:a,path:[OUT_DATA,r[s]]}));}if(this.isNestedFlow()){var l=t.VA.Core.Utils.NestedFlowUtils.calcNextFnUnitOutTableSize(this.getEditor().getModel(),this.getEditor().getActiveFnUnit(),a.mid,-r.length);n.push(t.VA.Core.Utils.NestedFlowUtils.createAdjustOutTableCommand(this,this.getEditor().getModel(),this.getEditor().getActiveFnUnit(),l));}return _.flatten(n);},r.prototype.getEditorInput=function(){return this.getEditor().getEditorInput();},r.prototype.getEditor=function(){return this.options.editor;},r.prototype.getModel=function(){return this.options.editor.getActiveModel();},r.prototype.isNestedFlow=function(){var t=this.getEditor().getActiveFnUnit();return t&&("if"===t.func||"forLoop"===t.func||"whileLoop"===t.func);},r.prototype.getOptions=function(){return this.options;},r.prototype.hasModel=function(t,e){return["process","control"].indexOf(t)>-1&&"Flow"!==e[FUNCTION_NAME];},r.prototype.handleBlankMouseLeave=function(t){},r.prototype.handleBlankMouseEnter=function(t){},r.prototype.changeCursor=function(t,e){var i=V(this.paper.findViewByModel(t).el);["brtc-style-cursor-pointer","brtc-style-cursor-move"].forEach(function(t){i.removeClass(t,!1);}),"pointer"===e?i.addClass("brtc-style-cursor-pointer",!0):"move"===e&&i.addClass("brtc-style-cursor-move",!0);},r.prototype.ensureCenterByFnUnit=function(t){var e=this.getFigureByFnUnitId(t.fid);this.ensureCenter(e);},r.prototype.refresh=function(){var t=this.graph.getElements();for(var e in t){t[e].refresh();}},t.VA.Core.Editors.Diagram.DiagramEditorPage=r;}.call(this),function(){"use strict";var t=this.Brightics,e=this.__module__.ObjectUtils;function i(e,i){t.VA.Core.Command.call(this,e,i);}i.prototype=Object.create(t.VA.Core.Command.prototype),i.prototype.constructor=i,i.prototype.canUndo=function(){return!0;},i.prototype.canRedo=function(){return!0;},i.prototype.execute=function(){this.setValue(this.options.path,this.options.value);},i.prototype.undo=function(){this.removeValue(this.options.path);},i.prototype.redo=function(){this.execute();},i.prototype.getId=function(){return"brightics.va.editors.diagram.commands.addoperationcommand";},i.prototype.getLabel=function(){return this.options.label;},i.prototype.setValue=function(t,i){var o=this.options.fnUnit||this.options.target;e.addProp(o,t,i);},i.prototype.removeValue=function(t){var i=this.options.fnUnit||this.options.target;e.removeProp(i,t);},t.VA.Core.Editors.Diagram.Commands.AddOperationCommand=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.old.param=$.extend(!0,{},this.options.fnUnit.param),$.extend(!0,this.options.fnUnit.param,this.options.ref.param);},e.prototype.undo=function(){for(var t in this.options.fnUnit.param){delete this.options.fnUnit.param[t];}$.extend(!0,this.options.fnUnit.param,this.old.param);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.addfnunitparametercommand";},e.prototype.getLabel=function(){return"Change FnUnit Properties";},t.VA.Core.Editors.Diagram.Commands.AddFnUnitParameterCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.options.activeModel.innerModels;this.options.activeModel.links.push(this.linkUnit);var e=this.options.activeModel.getFnUnitById(this.options[SOURCE_FID]),i=this.options.activeModel.getFnUnitById(this.options[TARGET_FID]);if(e[OUT_DATA].length>0&&i.hasOwnProperty("inData")){var o=i.parent().type,n=t.VA.Core.Interface.Functions[o][i.func]["in-range"].max;i[IN_DATA]&&i[IN_DATA].length<n&&!0!==this.options.isMaintainIntable&&i[IN_DATA].push(e[OUT_DATA][0]),"unload"===i.func&&(i.param["df-names"]=i[IN_DATA]),"Subflow"===i[FUNCTION_NAME]&&(i.param.functions[0][IN_DATA]=$.extend(!0,[],i[IN_DATA]),"unload"===i.param.functions[0].func&&(i.param.functions[0].param["df-names"]=i[IN_DATA]));}},e.prototype.undo=function(){},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.addInnerModelCommand";},e.prototype.getLabel=function(){return"Add InnerModel";},t.VA.Core.Editors.Diagram.Commands.AddInnerModelCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.getMainModel().addVariableDef(this.options.name,this.options.ref);},e.prototype.undo=function(){this.getMainModel().removeVariableDef(this.options.name);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.addvariabledefcommand";},e.prototype.getLabel=function(){return"Add Variable";},t.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.CompoundCommand.call(this,e,i);}e.prototype=Object.create(t.VA.Core.CompoundCommand.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.commandList=[];var e=this.options.analyticsModel.getFnUnitById(this.options.selectedId),i=new t.VA.Core.Editors.Diagram.Commands.ShiftRightCommand(this.event.source,{fid:e.fid});this.add(i);var o=new t.VA.Core.Editors.Diagram.Commands.SetFnUnitPositionCommand(this.event.source,{fid:e.fid,position:{x:e.display.diagram.position.x,y:e.display.diagram.position.y}});this.add(o),this.options.fnUnit.display.diagram.position.x=e.display.diagram.position.x+150,this.options.fnUnit.display.diagram.position.y=e.display.diagram.position.y;var n,r=new t.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand(this.event.source,{fnUnit:this.options.fnUnit});for(var a in this.add(r),this.options.analyticsModel.links){var s=this.options.analyticsModel.links[a];s[SOURCE_FID]==this.options.selectedId&&(n=new t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this.event.source,{kid:s.kid,sourceFid:this.options.fnUnit.fid,targetFid:s[TARGET_FID]}),this.add(n));}n=new t.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand(this.event.source,{kid:t.VA.Core.Utils.IDGenerator.func.id(),sourceFid:this.options.selectedId,targetFid:this.options.fnUnit.fid}),this.add(n),t.VA.Core.CompoundCommand.prototype.execute.call(this);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.appendnewfnunitcommand";},e.prototype.getLabel=function(){return"Append a new Function";},t.VA.Core.Editors.Diagram.Commands.AppendNewFnUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){var t=this.getMainModel().getVariable(this.options.fid,this.options.paramKey);t?(this.old.variable=t,this.getMainModel().setVariable(this.options.fid,this.options.paramKey,this.options.variable)):this.getMainModel().addVariable(this.options.fid,this.options.paramKey,this.options.variable);},e.prototype.undo=function(){this.old.variable?this.getMainModel().setVariable(this.options.fid,this.options.paramKey,this.old.variable):this.getMainModel().removeVariable(this.options.fid,this.options.paramKey);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.bindvariablecommand";},e.prototype.getLabel=function(){return"Bind Variable";},t.VA.Core.Editors.Diagram.Commands.BindVariableCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.old.panel={},this.old.panel.tableIndexes=this.options.panel.tableIndexes||[0],this.options.panel.tableIndexes=this.options.ref.panel.tableIndexes;},e.prototype.undo=function(){this.options.panel.tableIndexes=this.old.panel.tableIndexes;},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.changedatasourcecommand";},e.prototype.getLabel=function(){return"Change Chart Data Source";},t.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Change FnUnit Inputs Properties";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.old=$.extend(!0,{},this.FnUnitUtils.getInputs(this.options.fnUnit)),this.options.fnUnit.inputs=this.options.ref.inputs;},e.prototype.undo=function(){this.options.fnUnit.inputs=this.old;},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.changeinputscommand";},t.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils"),i=this.__module__.ObjectUtils;function o(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Change FnUnit In-Table Properties";}o.prototype=Object.create(t.VA.Core.Command.prototype),o.prototype.constructor=o,o.prototype.execute=function(){if(this.old=$.extend(!0,[],e.getInputs(this.options.fnUnit)),e.getMeta(this.options.fnUnit)){var t=e.getKeyByType(this.options.fnUnit,"table","in");this.options.fnUnit.inputs[t]=this.options.ref[0]||"";}else this.options.fnUnit[IN_DATA]=this.options.ref;"Subflow"===this.options.fnUnit[FUNCTION_NAME]?this.options.fnUnit.param.functions[0][IN_DATA]=$.extend(!0,[],this.options.fnUnit[IN_DATA]):"If"!==this.options.fnUnit[FUNCTION_NAME]&&"ForLoop"!==this.options.fnUnit[FUNCTION_NAME]&&"WhileLoop"!==this.options.fnUnit[FUNCTION_NAME]||this.processInnerModel();},o.prototype.undo=function(){if(e.getMeta(this.options.fnUnit)){var t=e.getKeyByType(this.options.fnUnit,"table","in");this.options.fnUnit.inputs[t]=this.old[t];}else this.options.fnUnit[IN_DATA]=this.old;e.getInData(this.options.fnUnit)&&"Subflow"===this.options.fnUnit[FUNCTION_NAME]?this.options.fnUnit.param.functions[0][IN_DATA]=$.extend(!0,[],this.options.fnUnit[IN_DATA]):"If"!==this.options.fnUnit[FUNCTION_NAME]&&"ForLoop"!==this.options.fnUnit[FUNCTION_NAME]&&"WhileLoop"!==this.options.fnUnit[FUNCTION_NAME]||this.cancelInnerModel();},o.prototype.getId=function(){return"brightics.va.editors.diagram.commands.changeintablecommand";},o.prototype.processInnerModel=function(){var o,n,r,a=this.options.mainModel,s=this.options.fnUnit,l=t.VA.Core.Utils.NestedFlowUtils.getSubModels(a,s);for(this.ops=[],this.oldByMid={},o=0;o<l.length;o++){var c=l[o],d=c.functions;for(this.oldByMid[c.mid]=_.clone(c[IN_DATA]),c[IN_DATA]=e.getInData(s),n=0;n<d.length;n++){var p=d[n];if(e.getInData(p))for(r=e.getInData(p).length-1;r>=0;r--){var u=e.getInData(p)[r];-1===_.indexOf(e.getInData(s),u)&&this.ops.push({fnUnit:p,path:[IN_DATA,r],old:u});}}}for(o=0;o<this.ops.length;o++){var h=this.ops[o];i.removeProp(h.fnUnit,h.path),"Subflow"===h.fnUnit[FUNCTION_NAME]&&(h.fnUnit.param.functions[0][IN_DATA]=$.extend(!0,[],h.fnUnit[IN_DATA]));}},o.prototype.cancelInnerModel=function(){for(var t=this.ops.length-1;t>=0;--t){var e=this.ops[t];i.addProp(e.fnUnit,e.path,e.old),"Subflow"===e.fnUnit[FUNCTION_NAME]&&(e.fnUnit.param.functions[0][IN_DATA]=$.extend(!0,[],e.fnUnit[IN_DATA]));}var o=this;_.forIn(this.oldByMid,function(t,e){var i=o.getMainModel().getInnerModel(e);i&&(i[IN_DATA]=_.clone(t));});},t.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.findTypeChangedData=function(){var t=[],e=Object.keys(this.old.outputs),i=this.options.ref.outputs,o=this.FnUnitUtils.getMeta(this.options.fnUnit),n=this.options.ref.meta;return _.forEach(e,function(e){var r=o[e].type;r!=(n[e]?n[e].type:r)&&t.push(i[e]);}),t;},e.prototype.findDeletedData=function(){var t=this,e=Object.keys(this.old.outputs),i=Object.keys(this.options.ref.outputs);return _.difference(e,i).map(function(e){return t.old.outputs[e];});},e.prototype.findAddedData=function(){var t=this,e=Object.keys(this.old.outputs),i=Object.keys(this.options.ref.outputs);return _.difference(i,e).map(function(e){return t.options.ref.outputs[e];});},e.prototype.execute=function(){var t=this;this.old.outputs=$.extend(!0,{},this.options.fnUnit.outputs);var e=this.findAddedData(),i=this.findDeletedData(),o=this.findTypeChangedData();this.options.fnUnit.outputs=this.options.ref.outputs,this.options.fnUnit.meta=this.options.ref.meta;var n=this.options.analyticsModel.getNext(this.options.fnUnit.fid),r=[];_.forEach(e,function(e){_.forEach(n,function(i){var o=t.options.analyticsModel.getFnUnitById(i);if(t.FnUnitUtils.getInData(o).indexOf(e)<0){t.FnUnitUtils.hasMeta(o)?r.push({fid:o.fid,inputs:_.extend({},o.inputs)}):r.push({fid:o.fid,inData:_.extend([],o[IN_DATA])});var n=t.FnUnitUtils.getTypeByTableId(t.options.fnUnit,e);t.FnUnitUtils.addInData(o,n,[e]);}});}),_.forEach(i,function(e){_.forEach(n,function(i){var o=t.options.analyticsModel.getFnUnitById(i);if(t.FnUnitUtils.getInData(o).indexOf(e)>-1){t.FnUnitUtils.hasMeta(o)?r.push({fid:o.fid,inputs:_.extend({},o.inputs)}):r.push({fid:o.fid,inData:_.extend([],o[IN_DATA])});var n=t.FnUnitUtils.getTypeByTableId(o,e);t.FnUnitUtils.removeInData(o,n,e);}});}),_.forEach(o,function(e){_.forEach(n,function(i){var o=t.options.analyticsModel.getFnUnitById(i),n=t.FnUnitUtils.getInData(o),a=t.FnUnitUtils.getTypeByTableId(t.options.fnUnit,e),s=t.FnUnitUtils.getTypeByTableId(o,e);n.indexOf(e)>-1&&a!=s&&(t.FnUnitUtils.hasMeta(o)?r.push({fid:o.fid,inputs:_.extend({},o.inputs)}):r.push({fid:o.fid,inData:_.extend([],o[IN_DATA])}),t.FnUnitUtils.removeInData(o,s,e));});}),this.old.changedNextFnUnit=_.extend([],r);},e.prototype.undo=function(){this.options.fnUnit.outputs=this.old.outputs;var t=this.options.analyticsModel.getNext(this.options.fnUnit.fid);for(var e in t){for(var i in this.old.changedNextFnUnit){var o=this.old.changedNextFnUnit[i],n=this.options.analyticsModel.getFnUnitById(t[e]);if(n.fid===o.fid){this.FnUnitUtils.hasMeta(n)?n.inputs=o.inputs:n[IN_DATA]=o[IN_DATA];break;}}}},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.changeoutputscommand";},e.prototype.getLabel=function(){return"Delete Output";},t.VA.Core.Editors.Diagram.Commands.ChangeOutputsCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.old[OUT_DATA]=$.extend(!0,[],this.options.fnUnit[OUT_DATA]);var t=[];for(var e in this.options.fnUnit[OUT_DATA]){-1==this.options.ref[OUT_DATA].indexOf(this.options.fnUnit[OUT_DATA][e])&&t.push(this.options.fnUnit[OUT_DATA][e]);}var i=this.options.analyticsModel.getNext(this.options.fnUnit.fid),o=[];for(var e in t){for(var n in i){var r=this.options.analyticsModel.getFnUnitById(i[n]),a=t[e],s=this.FnUnitUtils.getInTable(r);if($.inArray(a,s)>-1)-1==o.map(function(t){return t.fid;}).indexOf(r.fid)&&(this.FnUnitUtils.hasMeta(r)?o.push({fid:r.fid,inputs:r.inputs}):o.push({fid:r.fid,inData:r[IN_DATA]}));}}for(var e in this.old.changedNextFnUnit=$.extend(!0,[],o),this.options.fnUnit[OUT_DATA]=this.options.ref[OUT_DATA],t){a=t[e];for(var n in i){r=this.options.analyticsModel.getFnUnitById(i[n]),s=this.FnUnitUtils.getInTable(r);$.inArray(a,s)>-1&&this.FnUnitUtils.removeInData(r,"table",a);}}},e.prototype.undo=function(){this.options.fnUnit[OUT_DATA]=this.old[OUT_DATA];var t=this.options.analyticsModel.getNext(this.options.fnUnit.fid);for(var e in t){for(var i in this.old.changedNextFnUnit){var o=this.old.changedNextFnUnit[i],n=this.options.analyticsModel.getFnUnitById(t[e]);if(n.fid===o.fid){this.FnUnitUtils.hasMeta(n)?n.inputs=o.inputs:n[IN_DATA]=o[IN_DATA];break;}}}},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.deleteouttablecommand";},e.prototype.getLabel=function(){return"Delete Output";},t.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=(brtc_require("FnUnitUtils"),["If","ForLoop","WhileLoop"]);function i(e,i){t.VA.Core.Command.call(this,e,i);}i.prototype=Object.create(t.VA.Core.Command.prototype),i.prototype.constructor=i,i.prototype.canUndo=function(){return!0;},i.prototype.canRedo=function(){return!0;},i.prototype.execute=function(){var t;for(t in this.options.analyticsModel.links){if(this.options.analyticsModel.links[t][SOURCE_FID]===this.options[SOURCE_FID]&&this.options.analyticsModel.links[t][TARGET_FID]===this.options[TARGET_FID])return!1;}this.linkUnit={kid:this.options.kid,sourceFid:this.options[SOURCE_FID],targetFid:this.options[TARGET_FID]},this.options.analyticsModel.links.push(this.linkUnit);var i=this.getSourceUnits(this.options[SOURCE_FID]),o=this.getTargetUnits(this.options[TARGET_FID]),n=this,r=!0;if(_.forEach(o,function(t){_.forEach(i,function(i){var o=n.FnUnitUtils.getOutData(i),a=n.FnUnitUtils.getInData(t);if(!(!n.FnUnitUtils.isProcessFunction(i)&&o&&o.length>0&&n.FnUnitUtils.hasInput(t))||n.FnUnitUtils.isExist(i,t))return!0;var s=n.FnUnitUtils.getTotalInRangeCount(t).max;if(n.FnUnitUtils.isProcessFunction(t)){if(_.difference(o,a).length+a.length>s)return void(r=!1);n.FnUnitUtils.connect(i,t);}else if(a&&n.FnUnitUtils.isConnectable(i,t)&&!0!==n.options.isMaintainIntable&&(n.FnUnitUtils.connect(i,t),_.find(e,_.matches(t[FUNCTION_NAME])))){var l=o[0];n.addTidsInnerModel(t,[l]);}"unload"===t.func&&(t.param["df-names"]=t[IN_DATA]),"Subflow"===t[FUNCTION_NAME]&&(t.param.functions[0][IN_DATA]=$.extend(!0,[],t[IN_DATA]),"unload"===t.param.functions[0].func&&(t.param.functions[0].param["df-names"]=t[IN_DATA]));});}),!r)return!1;},i.prototype.undo=function(){var t=this.options.analyticsModel.links;t.splice(t.indexOf(this.linkUnit),1);var i=this.getSourceUnits(this.options[SOURCE_FID]),o=this.getTargetUnits(this.options[TARGET_FID]),n=this;_.forEach(o,function(t){_.forEach(i,function(i){var o=n.FnUnitUtils.getOutData(i),r=n.FnUnitUtils.getInData(t);if(o&&o.length>0&&!n.FnUnitUtils.isProcessFunction(i)){var a=r;a&&!0!==n.options.isMaintainIntable&&(n.FnUnitUtils.disconnect(i,t),"Subflow"===t[FUNCTION_NAME]?(t.param.functions[0][IN_DATA]=$.extend(!0,[],a),"unload"===t.param.functions[0].func&&(t.param.functions[0].param["df-names"]=a)):"OutData"===t[FUNCTION_NAME]&&(t.param["df-names"]=$.extend(!0,[],a))),_.find(e,_.matches(t[FUNCTION_NAME]))&&n.removeTidsInnerModel(i,t);}});});},i.prototype.redo=function(){this.execute();},i.prototype.getId=function(){return"brightics.va.editors.diagram.commands.connectfnunitcommand";},i.prototype.getLabel=function(){return"Connect a function";},i.prototype.addTidsInnerModel=function(e,i){var o=t.VA.Core.Utils.NestedFlowUtils.getSubModels(this.getMainModel(),e);_.forEach(i,function(t){_.forEach(o,function(e){-1===_.indexOf(e[IN_DATA],t)&&e[IN_DATA].push(t);});});},i.prototype.removeTidsInnerModel=function(e,i){var o=this,n=this.FnUnitUtils.getOutData(e),r=t.VA.Core.Utils.NestedFlowUtils.getSubModels(this.getMainModel(),i);_.forEach(n,function(t){o.hasToRemove(e,i,t)&&_.forEach(r,function(e){var i=_.indexOf(e[IN_DATA],t);i>-1&&e[IN_DATA].splice(i,1);});});},i.prototype.getSourceUnits=function(t){return this.getTargetModel().getLinkSourceFnUnits(t);},i.prototype.getTargetUnits=function(t){return this.getTargetModel().getLinkTargetFnUnits(t);},i.prototype.hasToRemove=function(t,e,i){var o=this,n=this.getTargetModel().getLinkSourceFnUnits(e.fid);return _.every(n,function(e){return o.FnUnitUtils.isProcessFunction(e)||e.fid===t.fid||-1===_.indexOf(o.FnUnitUtils.getOutData(e),i);});},t.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand=i;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils"),i=["If","ForLoop","WhileLoop"];function o(e,i){t.VA.Core.Command.call(this,e,i),this.old={};}o.prototype=Object.create(t.VA.Core.Command.prototype),o.prototype.constructor=o,o.prototype.canUndo=function(){return!0;},o.prototype.canRedo=function(){return!0;},o.prototype.execute=function(){var t;this.old.linkUnit=this.options.analyticsModel.getLinkUnitById(this.options.kid);var o=this.options.analyticsModel.links;o.splice(o.indexOf(this.old.linkUnit),1);var n=this.getSourceUnits(this.old.linkUnit[SOURCE_FID]),r=this.getTargetUnits(this.old.linkUnit[TARGET_FID]);this.old["target-fnunit-in-table"]={},this.old["additional-in-table"]={};var a=this;_.forEach(r,function(o){_.forEach(n,function(n){if(!e.isProcessFunction(n)&&(_.find(i,_.matches(o[FUNCTION_NAME]))&&a.processInnerModel(n,o),e.getInData(o))){for(t in e.getOutData(n)){if(a.hasToRemove(n,o,e.getOutData(n)[t])){var r=e.getInData(o).indexOf(e.getOutData(n)[t]);if(r>-1){var s=e.wrapInputs(e.getInputs(o));a.old["target-fnunit-in-table"][o.fid]=a.old["target-fnunit-in-table"][o.fid]||$.extend(!0,{},s),e.disconnect(n,o),"unload"!==o.func||o.context||o.param["df-names"].splice(r,1);}}}"Subflow"===o[FUNCTION_NAME]?(o.param.functions[0][IN_DATA]=$.extend(!0,[],o[IN_DATA]),"unload"===o.param.functions[0].func&&(o.param.functions[0].param["df-names"]=o[IN_DATA])):"OutData"===o[FUNCTION_NAME]&&(o.param["df-names"]=$.extend(!0,[],o[IN_DATA]));}});});},o.prototype.undo=function(){this.options.analyticsModel.links.push(this.old.linkUnit);var t=this,i=this.getTargetUnits(this.old.linkUnit[TARGET_FID]);_.forEach(i,function(i){e.getInData(i)&&(t.old["additional-in-table"][i.fid]&&t.old["additional-in-table"][i.fid].length,t.old["target-fnunit-in-table"][i.fid]&&$.extend(!0,i,t.old["target-fnunit-in-table"][i.fid]),"Subflow"===i[FUNCTION_NAME]?(i.param.functions[0][IN_DATA]=$.extend(!0,[],i[IN_DATA]),"unload"===i.param.functions[0].func&&(i.param.functions[0].param["df-names"]=i[IN_DATA])):"OutData"===i[FUNCTION_NAME]&&(i.param["df-names"]=$.extend(!0,[],i[IN_DATA])));}),this.removedTables&&this.cancelProcessInnerModel();},o.prototype.redo=function(){this.execute();},o.prototype.getId=function(){return"brightics.va.editors.diagram.commands.disconnectfnunitcommand";},o.prototype.getLabel=function(){return"Disconnect a function";},o.prototype.processInnerModel=function(i,o){var n,r,a=this.options.mainModel,s=t.VA.Core.Utils.NestedFlowUtils.getSubModels(a,o);for(this.removedTables=this.removedTables||{},n=0;n<s.length;n++){var l=s[n];for(this.removedTables[l.mid]=this.removedTables[l.mid]||[],r=l[IN_DATA].length-1;r>=0;--r){_.indexOf(e.getOutData(i),l[IN_DATA][r])>-1&&this.hasToRemove(i,o,l[IN_DATA][r])&&(this.removedTables[l.mid].push({index:r,id:l[IN_DATA][r]}),l[IN_DATA].splice(r,1));}}},o.prototype.cancelProcessInnerModel=function(){var t,e=this;_.forIn(this.removedTables,function(i,o){var n=e.getMainModel().getInnerModel(o);if(n)for(t=i.length-1;t>=0;--t){n[IN_DATA].splice(i[t].index,0,i[t].id);}});},o.prototype.getSourceUnits=function(t){return this.getTargetModel().getLinkSourceFnUnits(t);},o.prototype.getTargetUnits=function(t){return this.getTargetModel().getLinkTargetFnUnits(t);},o.prototype.hasToRemove=function(t,i,o){var n=this.getTargetModel().getLinkSourceFnUnits(i.fid);return _.every(n,function(i){return e.isProcessFunction(i)||i.fid===t.fid||-1===_.indexOf(e.getOutData(i),o);});},t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.options=$.extend({},t.options),this.options.commands=t.commands;}e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.gohistorycommand";},e.prototype.getLabel=function(){return"Go History";},t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){var e=this,i=function(i){return i?t.VA.Core.Utils.ModelUtils.extendInnerModel(e.getMainModel(),i,!0):t.VA.Core.Utils.ModelUtils.extendInnerModel(e.getMainModel(),t.VA.Core.Utils.ModelUtils.getDefaultModelContents(),!0);}(this.options.contents);i.mid=this.options.mid,this.options.mainModel.addInnerModel(i);},e.prototype.undo=function(){this.options.mainModel.removeInnerModelRecursion(this.options.mid);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.newactivitycommand";},e.prototype.getLabel=function(){return"New Activity Command";},t.VA.Core.Editors.Diagram.Commands.NewActivityCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.options.panel.push(this.options.panelOption);},e.prototype.undo=function(){this.options.panel.splice(this.options.panel.indexOf(this.options.panelOption),1);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.newchartcommand";},e.prototype.getLabel=function(){return"Clone a Chart";},t.VA.Core.Editors.Diagram.Commands.NewChartCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Create a Function";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.options.analyticsModel.addFnUnit(this.options.fnUnit);},e.prototype.undo=function(){this.options.analyticsModel.removeFnUnit(this.options.fnUnit.fid);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.newfnunitcommand";},t.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Create a OPT model";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var e=this.options.pid,i=this.options.mid,o=this.options.optModel;t.OptModelManager.addOptModel(e,i,o);},e.prototype.undo=function(){var e=this.options.pid,i=this.options.mid,o=this.options.optModel.optId;t.OptModelManager.removeOptModel(e,i,o);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.newoptmodelcommand";},t.VA.Core.Editors.Diagram.Commands.NewOptModelCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){var e=this;this.old[OUT_DATA]=$.extend(!0,[],this.options.fnUnit[OUT_DATA]);var i=_.difference(this.options.fnUnit[OUT_DATA],this.options.ref[OUT_DATA]),o=_.difference(this.options.ref[OUT_DATA],this.options.fnUnit[OUT_DATA]);this.options.fnUnit[OUT_DATA]=this.options.ref[OUT_DATA];var n=_.unique(this.getTargetModel().getNext(this.options.fnUnit.fid).reduce(function(t,i){return t.concat(e.getTargetModel().getLinkTargetFnUnits(i));},[]),"fid");this.oldFnUnitInData={},this.oldModelOutData=_.clone(e.getTargetModel()[OUT_DATA]),n.forEach(function(n){var r=n.parent().type,a=t.VA.Core.Interface.Functions[r][n.func]["in-range"].max;n[IN_DATA]&&(e.oldFnUnitInData[n.fid]=_.clone(n[IN_DATA]),n[IN_DATA]=_.chain(n[IN_DATA]).difference(i).concat(o).take(a).value());}),this.getTargetModel()[OUT_DATA]=_.difference(this.getTargetModel()[OUT_DATA],i);},e.prototype.undo=function(){var t=this;this.options.fnUnit[OUT_DATA]=this.old[OUT_DATA],_.forIn(t.oldFnUnitInData,function(e,i){t.getTargetModel().getFnUnitById(i)[IN_DATA]=e;}),this.getTargetModel()[OUT_DATA]=this.oldModelOutData;},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.newouttablecommand";},e.prototype.getLabel=function(){return"New Out Data";},t.VA.Core.Editors.Diagram.Commands.NewOutTableCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.CompoundCommand.call(this,e,i);}e.prototype=Object.create(t.VA.Core.CompoundCommand.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.commandList=[];var e=this.options.analyticsModel.getFnUnitById(this.options.selectedId),i=new t.VA.Core.Editors.Diagram.Commands.ShiftRightCommand(this.event.source,{fid:e.fid});this.add(i),this.options.fnUnit.display.diagram.position.x=e.display.diagram.position.x,this.options.fnUnit.display.diagram.position.y=e.display.diagram.position.y;var o,n=new t.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand(this.event.source,{fnUnit:this.options.fnUnit});for(var r in this.add(n),this.options.analyticsModel.links){var a=this.options.analyticsModel.links[r];if(a[TARGET_FID]==this.options.selectedId){o=new t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this.event.source,{kid:a.kid,sourceFid:a[SOURCE_FID],targetFid:this.options.fnUnit.fid}),this.add(o);break;}}o=new t.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand(this.event.source,{kid:t.VA.Core.Utils.IDGenerator.link.id(),sourceFid:this.options.fnUnit.fid,targetFid:this.options.selectedId}),this.add(o),t.VA.Core.CompoundCommand.prototype.execute.call(this);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.prependnewfnunitcommand";},e.prototype.getLabel=function(){return"Append a new Function";},t.VA.Core.Editors.Diagram.Commands.PrependNewFnUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils"),i=this.__module__.ObjectUtils;function o(e,i){t.VA.Core.Command.call(this,e,i),this.old={};}o.prototype=Object.create(t.VA.Core.Command.prototype),o.prototype.constructor=o,o.prototype.canUndo=function(){return!0;},o.prototype.canRedo=function(){return!0;},o.prototype.execute=function(){var t,i=this.options.analyticsModel.getLinkUnitById(this.options.kid);this.old[SOURCE_FID]=i[SOURCE_FID],this.old[TARGET_FID]=i[TARGET_FID];var o=this.options.analyticsModel.getFnUnitById(i[SOURCE_FID]),n=this.options.analyticsModel.getFnUnitById(i[TARGET_FID]);n.parent().type;if(this.old["target-fnunit-in-table"]=[],this.old["additional-in-table"]=[],"If"!==n[FUNCTION_NAME]&&"ForLoop"!==n[FUNCTION_NAME]&&"WhileLoop"!==n[FUNCTION_NAME]||this.processInnerModel(o,n),e.hasInput(n)&&e.hasOutput(o)){for(t in e.getOutData(o)){e.getInData(n).indexOf(e.getOutData(o)[t])>-1&&this.old["target-fnunit-in-table"].push(e.getOutData(o)[t]);}e.disconnect(o,n),"Subflow"===n[FUNCTION_NAME]?(n.param.functions[0][IN_DATA]=$.extend(!0,[],n[IN_DATA]),"unload"===n.param.functions[0].func&&(n.param.functions[0].param["df-names"]=n[IN_DATA])):"OutData"===n[FUNCTION_NAME]&&(n.param["df-names"]=$.extend(!0,[],n[IN_DATA]));}i[SOURCE_FID]=this.options[SOURCE_FID],i[TARGET_FID]=this.options[TARGET_FID],o=this.options.analyticsModel.getFnUnitById(i[SOURCE_FID]),n=this.options.analyticsModel.getFnUnitById(i[TARGET_FID]),e.hasOutput(o)&&e.getOutData(o).length>0&&e.hasInput(n)&&(e.connect(o,n),"unload"!==n.func||n.context||(n.param["df-names"]=n[IN_DATA]),"Subflow"===n[FUNCTION_NAME]&&(n.param.functions[0][IN_DATA]=$.extend(!0,[],n[IN_DATA]),"unload"===n.param.functions[0].func&&(n.param.functions[0].param["df-names"]=n[IN_DATA])));},o.prototype.undo=function(){var i,o=this.options.analyticsModel.getLinkUnitById(this.options.kid),n=this.options.analyticsModel.getFnUnitById(o[SOURCE_FID]),r=this.options.analyticsModel.getFnUnitById(o[TARGET_FID]);if(e.hasOutput(n)&&e.getOutData(n).length>0){var a=e.getInData(r);if(a)for(i in e.getOutData(n)){var s=a.indexOf(e.getOutData(n)[i]);s>-1&&a.splice(s,1);}"Subflow"===r[FUNCTION_NAME]?(r.param.functions[0][IN_DATA]=$.extend(!0,[],a),"unload"===r.param.functions[0].func&&(r.param.functions[0].param["df-names"]=a)):"OutData"===r[FUNCTION_NAME]&&(r.param["df-names"]=$.extend(!0,[],a));}if(o[SOURCE_FID]=this.old[SOURCE_FID],o[TARGET_FID]=this.old[TARGET_FID],n=this.options.analyticsModel.getFnUnitById(o[SOURCE_FID]),r=this.options.analyticsModel.getFnUnitById(o[TARGET_FID]),e.hasInput(r)){var l=r.parent().type,c="";for(i in e.hasMeta(r)||(c=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(l,r.func)["in-range"].max),this.old["target-fnunit-in-table"]){if("*"===c)r[IN_DATA].push(this.old["target-fnunit-in-table"][i]);else{var d=e.getTypeByTableId(n,this.old["target-fnunit-in-table"][i]);e.addInData(r,d,[this.old["target-fnunit-in-table"][i]]);}}"Subflow"===r[FUNCTION_NAME]?(r.param.functions[0][IN_DATA]=$.extend(!0,[],r[IN_DATA]),"unload"===r.param.functions[0].func&&(r.param.functions[0].param["df-names"]=r[IN_DATA])):"OutData"===r[FUNCTION_NAME]&&(r.param["df-names"]=$.extend(!0,[],r[IN_DATA]));}this.ops&&this.cancelProcessInnerModel(n,r);},o.prototype.redo=function(){this.execute();},o.prototype.getId=function(){return"brightics.va.editors.diagram.commands.reconnectfnunitcommand";},o.prototype.getLabel=function(){return"Reconnect a function";},o.prototype.processInnerModel=function(e,o){var n,r,a,s=this.options.mainModel,l=t.VA.Core.Utils.NestedFlowUtils.getSubModels(s,o);this.ops=[];var c=function c(t,e){return e-t;};for(n=0;n<l.length;n++){var d=l[n].functions;for(r=0;r<d.length;r++){var p=d[r],u=[];if(p[IN_DATA]){for(a=0;a<e[OUT_DATA].length;a++){var h=_.indexOf(p[IN_DATA],e[OUT_DATA][a]);h>=0&&u.push(h);}u.sort(c);var f=[];for(a=0;a<u.length;a++){f.push(p[IN_DATA][u[a]]);}this.ops.push({fnUnit:p,indices:u,olds:f}),"Subflow"===o[FUNCTION_NAME]?(o.param.functions[0][IN_DATA]=$.extend(!0,[],o[IN_DATA]),"unload"===o.param.functions[0].func&&(o.param.functions[0].param["df-names"]=o[IN_DATA])):"OutData"===o[FUNCTION_NAME]&&(o.param["df-names"]=$.extend(!0,[],o[IN_DATA]));}}}for(n=0;n<this.ops.length;n++){var m=this.ops[n].fnUnit;for(r=0;r<this.ops[n].indices.length;r++){var g=[IN_DATA,this.ops[n].indices[r]];i.removeProp(m,g),"Subflow"===m[FUNCTION_NAME]?(m.param.functions[0][IN_DATA]=$.extend(!0,[],m[IN_DATA]),"unload"===m.param.functions[0].func&&(m.param.functions[0].param["df-names"]=m[IN_DATA])):"OutData"===m[FUNCTION_NAME]&&(m.param["df-names"]=$.extend(!0,[],m[IN_DATA]));}}},o.prototype.cancelProcessInnerModel=function(t,e){var o,n;for(o=0;o<this.ops.length;o++){var r=this.ops[o].fnUnit;for(n=this.ops[o].indices.length;n>=0;n--){var a=[IN_DATA,this.ops[o].indices[n]];i.addProp(r,a,this.ops[o].olds[n]),"Subflow"===r[FUNCTION_NAME]?(r.param.functions[0][IN_DATA]=$.extend(!0,[],r[IN_DATA]),"unload"===r.param.functions[0].func&&(r.param.functions[0].param["df-names"]=r[IN_DATA])):"OutData"===r[FUNCTION_NAME]&&(r.param["df-names"]=$.extend(!0,[],r[IN_DATA]));}}},t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.old=this.options.mainModel.removeInnerModelRecursion(this.options.mid);},e.prototype.undo=function(){_.forEach(this.old,_.bind(this.options.mainModel.addInnerModel,this.options.mainModel));},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.removeactivitycommand";},e.prototype.getLabel=function(){return"New Activity Command";},t.VA.Core.Editors.Diagram.Commands.RemoveActivityCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=this.__module__.ObjectUtils;function i(e,i){t.VA.Core.Command.call(this,e,i);}i.prototype=Object.create(t.VA.Core.Command.prototype),i.prototype.constructor=i,i.prototype.canUndo=function(){return!0;},i.prototype.canRedo=function(){return!0;},i.prototype.execute=function(){this.removeValue(this.options.path);},i.prototype.undo=function(){this.setValue(this.options.path,this.old);},i.prototype.redo=function(){this.execute();},i.prototype.getId=function(){return"brightics.va.editors.diagram.commands.removeoperationcommand";},i.prototype.getLabel=function(){return this.options.label;},i.prototype.copy=function(t){return _.clone(t);},i.prototype.setValue=function(t,i){var o=this.options.fnUnit||this.options.target;e.addProp(o,t,i);},i.prototype.removeValue=function(t){var i=this.options.fnUnit||this.options.target;this.old=e.removeProp(i,t);},t.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.old={};}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.options.old.index=this.options.panel.indexOf(this.options.panelOption),this.options.panel.splice(this.options.old.index,1);},e.prototype.undo=function(){this.options.panel.splice(this.options.old.index,0,this.options.panelOption);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.removechartcommand";},e.prototype.getLabel=function(){return"Close a Chart";},t.VA.Core.Editors.Diagram.Commands.RemoveChartCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=this.__module__.ObjectUtils;function i(e,i){t.VA.Core.Command.call(this,e,i),this.old={};}i.prototype=Object.create(t.VA.Core.Command.prototype),i.prototype.constructor=i,i.prototype.canUndo=function(){return!0;},i.prototype.canRedo=function(){return!0;},i.prototype.execute=function(){this.processMainModelInput(),this.old.fnUnit=this.options.analyticsModel.removeFnUnit(this.options.fid),t.VA.Core.GarbageCollector.addList(this.options.analyticsModel.mid,this.options.fid);},i.prototype.undo=function(){this.options.analyticsModel.addFnUnit(this.old.fnUnit),t.VA.Core.GarbageCollector.removeList(this.options.analyticsModel.mid,this.options.fid),this.cancelMainModelInput();},i.prototype.redo=function(){this.execute();},i.prototype.getId=function(){return"brightics.va.editors.diagram.commands.removefnunitcommand";},i.prototype.getLabel=function(){return"Remove a Function";},i.prototype.processMainModelInput=function(){var t,i=this.options.analyticsModel.getFnUnitById(this.options.fid),o=this.options.mainModel;if(this.ops=[],o[IN_DATA]){for(t=o[IN_DATA].length-1;t>=0;--t){var n=i[OUT_DATA];if(n)_.indexOf(n,o[IN_DATA][t])>-1&&this.ops.push({path:[t],old:o[IN_DATA][t]});}for(t=0;t<this.ops.length;t++){var r=this.ops[t];e.removeProp(o[IN_DATA],r.path);}}},i.prototype.cancelMainModelInput=function(){var t=this.options.mainModel;if(t[IN_DATA])for(var i=this.ops.length-1;i>=0;--i){var o=this.ops[i];e.addProp(t[IN_DATA],o.path,o.old);}},t.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){for(var t in this.old.param=$.extend(!0,{},this.options.fnUnit.param),this.options.ref.param){delete this.options.fnUnit.param[t];}},e.prototype.undo=function(){for(var t in this.options.fnUnit.param){delete this.options.fnUnit.param[t];}$.extend(!0,this.options.fnUnit.param,this.old.param);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.removefnunitparametercommand";},e.prototype.getLabel=function(){return"Change FnUnit Properties";},t.VA.Core.Editors.Diagram.Commands.RemoveFnUnitParameterCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Remove a OPT model";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var e=this.options.pid,i=this.options.mid,o=this.options.optId;this.old.optModel=t.OptModelManager.removeOptModel(e,i,o);},e.prototype.undo=function(){var e=this.options.pid,i=this.options.mid,o=this.old.optModel;t.OptModelManager.addOptModel(e,i,o);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.removeoptmodelcommand";},t.VA.Core.Editors.Diagram.Commands.RemoveOptModelCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){var t=this.getMainModel();this.options.old=t.variables[this.options.name],t.removeVariableDef(this.options.name);},e.prototype.undo=function(){this.getMainModel().addVariableDef(this.options.name,this.options.old);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.removevariabledefcommand";},e.prototype.getLabel=function(){return"Remove Variable";},t.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Edit function";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var t=this.options.analyticsModel.getFnUnitById(this.options.fid);this.old.name=t.display.label,this.old.description=t.display.description,t.display.label=this.options.name,t.display.description=this.options.description;},e.prototype.undo=function(){var t=this.options.analyticsModel.getFnUnitById(this.options.fid);t.display.label=this.old.name,t.display.description=this.old.description||"";},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.renamefnunitcommand";},t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){for(var t in this.oldFnUnit=$.extend({},this.options.fnUnit),this.options.ref){this.options.ref[t].constructor==Array?this.options.fnUnit[t]=$.extend(!0,[],this.options.ref[t]):this.options.ref[t].constructor==Object?this.options.fnUnit[t]=$.extend(!0,{},this.options.ref[t]):this.options.fnUnit[t]=this.options.ref[t];}},e.prototype.undo=function(){for(var t in this.options.fnUnit){delete this.options.fnUnit[t];}$.extend(this.options.fnUnit,this.oldFnUnit);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.replacefnunitparamcommand";},e.prototype.getLabel=function(){return"Replace FnUnit Properties";},t.VA.Core.Editors.Diagram.Commands.ReplaceFnUnitParamCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype._assignArray=function(t,e){for(var i in e){$.isPlainObject(e[i])?this._assignArray(t[i],e[i]):$.isArray(e[i])&&(t[i]=$.extend(!0,[],e[i]));}},e.prototype.execute=function(){for(var t in this.old.chartOption={},this.options.ref.chartOption){this.options.panelOption.chartOption[t]?this.old.chartOption[t]=JSON.parse(JSON.stringify(this.options.panelOption.chartOption[t])):this.old.chartOption[t]=null,this.options.panelOption.chartOption[t]=JSON.parse(JSON.stringify(this.options.ref.chartOption[t]));}},e.prototype.undo=function(){for(var t in this.old.chartOption){this.old.chartOption[t]?this.options.panelOption.chartOption[t]=JSON.parse(JSON.stringify(this.old.chartOption[t])):this.options.panelOption.chartOption[t]=null;}},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setcontentspanelcommand";},e.prototype.getLabel=function(){return"Change Chart Options";},t.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){for(var t in this.options.oldLayout=$.extend(!0,{},this.options.layout),this.options.layout){delete this.options.layout[t];}$.extend(!0,this.options.layout,this.options.newLayout);},e.prototype.undo=function(){for(var t in this.options.layout){delete this.options.layout[t];}$.extend(!0,this.options.layout,this.options.oldLayout);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setdataworksheetlayoutcommand";},e.prototype.getLabel=function(){return"Change Layout";},t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.options.oldPanel=$.extend(!0,{},this.options.panel);for(var t=0;t<this.options.panel.length;t++){delete this.options.panel[t];}$.extend(!0,this.options.panel,this.options.newPanel);},e.prototype.undo=function(){for(var t=0;t<this.options.panel.length;t++){delete this.options.panel[t];}$.extend(!0,this.options.panel,this.options.oldPanel);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.SetDataWorksheetPanelCommand";},e.prototype.getLabel=function(){return"Change Panel";},t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetPanelCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Change FnUnit Properties";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){for(var t in this.old.param=$.extend(!0,{},this.options.fnUnit.param),this.options.ref.param){this.copy(this.options.fnUnit.param,this.options.ref.param,t);}},e.prototype.copy=function(t,e,i){e[i].constructor==Array?t[i]=$.extend(!0,[],e[i]):e[i].constructor==Object?t[i]=$.extend(!0,{},e[i]):t[i]=e[i];},e.prototype.undo=function(){for(var t in this.options.fnUnit.param){delete this.options.fnUnit.param[t];}$.extend(!0,this.options.fnUnit.param,this.old.param);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setdialogfnUnitcommand";},t.VA.Core.Editors.Diagram.Commands.SetDialogFnUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Change FnUnit Properties";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){for(var t in this.old=$.extend(!0,{},this.options.fnUnit),this.options.ref){if("param"===t)for(var e in this.options.ref.param){this.copy(this.options.fnUnit.param,this.options.ref.param,e);}else this.copy(this.options.fnUnit,this.options.ref,t);}this.options.fnUnit[IN_DATA]&&"Subflow"===this.options.fnUnit[FUNCTION_NAME]&&(this.options.fnUnit.param.functions[0][IN_DATA]=$.extend(!0,[],this.options.fnUnit[IN_DATA]));},e.prototype.copy=function(t,e,i){e[i].constructor==Array?t[i]=$.extend(!0,[],e[i]):e[i].constructor==Object?t[i]=$.extend(!0,{},e[i]):t[i]=e[i];},e.prototype.undo=function(){for(var t in this.options.fnUnit){delete this.options.fnUnit[t];}$.extend(!0,this.options.fnUnit,this.old),this.options.fnUnit[IN_DATA]&&"Subflow"===this.options.fnUnit[FUNCTION_NAME]&&(this.options.fnUnit.param.functions[0][IN_DATA]=$.extend(!0,[],this.options.fnUnit[IN_DATA]));},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setfnunitcommand";},t.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Change FnUnit Properties";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){for(var t in this.old["dex-param"]=$.extend(!0,{},this.options.fnUnit["dex-param"]),this.options.ref["dex-param"]){this.copy(this.options.fnUnit["dex-param"],this.options.ref["dex-param"],t);}this._buildQuery();},e.prototype.copy=function(t,e,i){e[i].constructor==Array?t[i]=$.extend(!0,[],e[i]):e[i].constructor==Object?t[i]=$.extend(!0,{},e[i]):t[i]=e[i];},e.prototype.undo=function(){for(var t in this.options.fnUnit["dex-param"]){delete this.options.fnUnit["dex-param"][t];}$.extend(!0,this.options.fnUnit["dex-param"],this.old["dex-param"]),this._buildQuery();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setfnunitparametervaluecommand";},e.prototype._buildQuery=function(){var e=t.VA.Core.Functions.Library[this.options.fnUnit.func]["base-sql"];for(var i in this.options.fnUnit["dex-param"]){var o=this.options.fnUnit["dex-param"][i],n=i.replace("$","\\$").replace("{","\\{").replace("}","\\}");"string"==typeof o?e=e.replace(new RegExp(n,"gi"),"'"+o+"'"):"number"==typeof o?e=e.replace(new RegExp(n,"gi"),o):$.isArray(o)||(e=e.replace(new RegExp(n,"gi"),"''"));}this.options.fnUnit.param.sql=e;},t.VA.Core.Editors.Diagram.Commands.SetFnUnitDexParameterValueCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Change FnUnit Properties";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){for(var t in this.old.param=$.extend(!0,{},this.options.fnUnit.param),this.options.ref.param){this.copy(this.options.fnUnit.param,this.options.ref.param,t);}},e.prototype.copy=function(t,e,i){e[i].constructor==Array?t[i]=$.extend(!0,[],e[i]):e[i].constructor==Object?t[i]=$.extend(!0,{},e[i]):t[i]=e[i];},e.prototype.undo=function(){for(var t in this.options.fnUnit.param){delete this.options.fnUnit.param[t];}$.extend(!0,this.options.fnUnit.param,this.old.param);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setfnunitparametervaluecommand";},t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.old={};}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){var t=this.options.analyticsModel.getFnUnitById(this.options.fid);this.old.position={x:t.display.diagram.position.x,y:t.display.diagram.position.y},t.display.diagram.position.x=this.options.position.x,t.display.diagram.position.y=this.options.position.y;},e.prototype.undo=function(){var t=this.options.analyticsModel.getFnUnitById(this.options.fid);t.display.diagram.position.x=this.old.position.x,t.display.diagram.position.y=this.old.position.y;},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setfnunitpositioncommand";},e.prototype.getLabel=function(){return"Change Position";},t.VA.Core.Editors.Diagram.Commands.SetFnUnitPositionCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Change FnUnit Properties";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){for(var t in this.old["input-variables"]=$.extend(!0,{},this.options.fnUnit.param["input-variables"]),this.options.ref.param["input-variables"]){this.copy(this.options.fnUnit.param["input-variables"],this.options.ref.param["input-variables"],t);}},e.prototype.copy=function(t,e,i){e[i].constructor==Array?t[i]=$.extend(!0,[],e[i]):e[i].constructor==Object?t[i]=$.extend(!0,{},e[i]):t[i]=e[i];},e.prototype.undo=function(){for(var t in this.options.fnUnit.param["input-variables"]){delete this.options.fnUnit.param["input-variables"][t];}$.extend(!0,this.options.fnUnit.param["input-variables"],this.old["input-variables"]);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.SetUDFFnUnitParameterValueCommand";},t.VA.Core.Editors.Diagram.Commands.SetUDFFnUnitParameterValueCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Change FnUnit Properties";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.old.param=$.extend(!0,{},this.options.fnUnit.param),this.options.fnUnit.param=this.options.ref.param;},e.prototype.undo=function(){this.options.fnUnit.param=this.old.param;},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setoptfnunitparametervaluecommand";},t.VA.Core.Editors.Diagram.Commands.SetOptFnUnitParameterValueCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Set a OPT model";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var e=this.options.pid,i=this.options.mid,o=this.options.optId;this.old=$.extend(!0,{},t.OptModelManager.getOptModel(e,i,o));var n=this.options.optModel;t.OptModelManager.setOptModel(e,i,o,n);},e.prototype.undo=function(){var e=this.options.pid,i=this.options.mid,o=this.options.optId,n=$.extend(!0,{},this.old);t.OptModelManager.setOptModel(e,i,o,n);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.setoptmodelcommand";},t.VA.Core.Editors.Diagram.Commands.SetOptModelCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.changed=[],this.old={};}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.old={},this.options.changed=[];var t=this.options.analyticsModel.getFnUnitById(this.options.fid);if(!1===this.shiftLeft(t))return this.old={},this.options.changed=[],!1;},e.prototype.canShift=function(e){var i;for(i in this.options.analyticsModel.functions){var o=this.options.analyticsModel.functions[i];if(o.fid!=e.fid&&o.display.diagram.position.x==e.display.diagram.position.x-(t.VA.Env.Diagram.FIGURE_WIDTH+t.VA.Env.Diagram.GAP_WIDTH)&&o.display.diagram.position.y==e.display.diagram.position.y)return!1;}var n=this.options.analyticsModel.getPrevious(e.fid);for(i in n){if(this.options.analyticsModel.getFnUnitById(n[i]).display.diagram.position.x==e.display.diagram.position.x-(t.VA.Env.Diagram.FIGURE_WIDTH+t.VA.Env.Diagram.GAP_WIDTH))return!1;}return!0;},e.prototype.shiftLeft=function(e){if(this.old[e.fid]);else{if(e.display.diagram.position.x-(t.VA.Env.Diagram.FIGURE_WIDTH+t.VA.Env.Diagram.GAP_WIDTH)<t.VA.Env.Diagram.PAPER_MARGIN_LEFT)return this.message="Unable to shift further left.",!1;if(!1===this.canShift(e))return this.message="Unable to shift left.",!1;this.options.changed.push(e.fid),this.old[e.fid]={x:e.display.diagram.position.x,y:e.display.diagram.position.y},e.display.diagram.position.x-=t.VA.Env.Diagram.FIGURE_WIDTH+t.VA.Env.Diagram.GAP_WIDTH;var i=this.options.analyticsModel.getNext(e.fid);for(var o in i){var n=this.options.analyticsModel.getFnUnitById(i[o]);this.shiftLeft(n);}}return!0;},e.prototype.undo=function(){for(var t in this.old){var e=this.options.analyticsModel.getFnUnitById(t);e.display.diagram.position.x=this.old[t].x,e.display.diagram.position.y=this.old[t].y;}},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.shiftleftcommand";},e.prototype.getLabel=function(){return"Shift Left";},t.VA.Core.Editors.Diagram.Commands.ShiftLeftCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.changed=[],this.old={};}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.old={},this.options.changed=[];var t=this.options.analyticsModel.getFnUnitById(this.options.fid);this.shiftRight(t),this.options.changed.reverse();},e.prototype.shiftRight=function(e){if(this.old[e.fid]);else{var i,o;for(i in this.options.changed.push(e.fid),this.old[e.fid]={x:e.display.diagram.position.x,y:e.display.diagram.position.y},e.display.diagram.position.x+=t.VA.Env.Diagram.FIGURE_WIDTH+t.VA.Env.Diagram.GAP_WIDTH,this.options.analyticsModel.functions){(o=this.options.analyticsModel.functions[i]).display.diagram.position.x==e.display.diagram.position.x&&o.display.diagram.position.y==e.display.diagram.position.y&&this.shiftRight(o);}var n=this.options.analyticsModel.getNext(e.fid);for(i in n){(o=this.options.analyticsModel.getFnUnitById(n[i])).display.diagram.position.x==e.display.diagram.position.x&&this.shiftRight(o);}}},e.prototype.undo=function(){for(var t in this.old){var e=this.options.analyticsModel.getFnUnitById(t);e.display.diagram.position.x=this.old[t].x,e.display.diagram.position.y=this.old[t].y;}},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.shiftrightcommand";},e.prototype.getLabel=function(){return"Shift Right";},t.VA.Core.Editors.Diagram.Commands.ShiftRightCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.old={};}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.options.old.type=this.options.panelOption.chartOption.chart.type,this.options.panelOption.chartOption.chart.type=this.options.type;},e.prototype.undo=function(){this.options.panelOption.chartOption.chart.type=this.options.old.type;},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.switchchartcommand";},e.prototype.getLabel=function(){return"Switch a Chart Type";},t.VA.Core.Editors.Diagram.Commands.SwitchChartCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");function i(e,i){t.VA.Core.CompoundCommand.call(this,e,i);}i.prototype=Object.create(t.VA.Core.CompoundCommand.prototype),i.prototype.constructor=i,i.prototype.execute=function(){var i=this;this.commandList=[],this.add(new t.VA.Core.Editors.Diagram.Commands.NewFnUnitCommand(this.event.source,{fnUnit:this.options.fnUnit}));var o,n=t.VA.Core.Utils.NestedFlowUtils.getNewActivityCommandOptions(this.options.fnUnit);_.isEmpty(n)||this.add(_.map(n,function(e){return new t.VA.Core.Editors.Diagram.Commands.NewActivityCommand(i.event.source,e);}));t.VA.Core.Interface.Functions[this.options.modelType][this.options.fnUnit.func];for(var r in this.options.analyticsModel.links){var a=this.options.analyticsModel.links[r];a[SOURCE_FID]==this.options.fid&&(o=e.hasOutput(this.options.fnUnit)?new t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this.event.source,{kid:a.kid,sourceFid:this.options.fnUnit.fid,targetFid:a[TARGET_FID]}):new t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand(this.event.source,{kid:a.kid,sourceFid:this.options.fnUnit.fid,targetFid:a[TARGET_FID]}),this.add(o)),a[TARGET_FID]==this.options.fid&&(o=e.hasInput(this.options.fnUnit)?new t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand(this.event.source,{kid:a.kid,sourceFid:a[SOURCE_FID],targetFid:this.options.fnUnit.fid}):new t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand(this.event.source,{kid:a.kid,sourceFid:a[SOURCE_FID],targetFid:this.options.fnUnit.fid}),this.add(o));}var s=t.VA.Core.Utils.NestedFlowUtils.getSubModels(this.getTargetModel(),this.options.prvFnUnit);_.isEmpty(s)||this.add(_.map(s,function(e){return new t.VA.Core.Editors.Diagram.Commands.RemoveActivityCommand(i.event.source,{mid:e.mid});})),this.add(new t.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand(this.event.source,{fid:this.options.fid})),t.VA.Core.CompoundCommand.prototype.execute.call(this);},i.prototype.getId=function(){return"brightics.va.editors.diagram.commands.switchfnunitcommand";},i.prototype.getLabel=function(){return"Switch a Function";},t.VA.Core.Editors.Diagram.Commands.SwitchFnUnitCommand=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.getMainModel().removeVariable(this.options.fid,this.options.paramKey);},e.prototype.undo=function(){this.getMainModel().addVariable(this.options.fid,this.options.paramKey,this.options.variable);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.unbindvariablecommand";},e.prototype.getLabel=function(){return"Unbind Variable";},t.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.old={};}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){var t,e,i,o,n,r=this;t=r.options,e=r.getTargetModel(),i=function i(t){r.path=t,r.old=_.cloneDeep(_.get(r.getTargetModel(),t)),_.set(r.getTargetModel(),t,r.options.value);},o=_.once(i),n=["functions"],_.forEach(e.functions,function(e,i){e.fid===t.fid&&(n=n.concat([i,"display","sheet"]),_.forIn(_.get(e,"display.sheet"),function(e,i){_.forIn(e,function(e,r){var a=_.findIndex(e[0].panel,function(e){return e.id===t.cid;});if(void 0!==e[0].panel[a])return n=n.concat([i,r,0,"panel",a,"multiChartOption"]),o(n);});}));});},e.prototype.undo=function(){_.set(self.getTargetModel(),self.path,self.old);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.updatemultichartoptioncommand";},e.prototype.getLabel=function(){return"Update Multi Chart Option";},t.VA.Core.Editors.Diagram.Commands.UpdateMultiChartOptionCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=this.__module__.ObjectUtils;function i(e,i){t.VA.Core.Command.call(this,e,i);}i.prototype=Object.create(t.VA.Core.Command.prototype),i.prototype.constructor=i,i.prototype.canUndo=function(){return!0;},i.prototype.canRedo=function(){return!0;},i.prototype.execute=function(){this.setValue(this.options.path,this.options.value,!0);},i.prototype.undo=function(){this.setValue(this.options.path,this.old,!1);},i.prototype.redo=function(){this.execute();},i.prototype.getId=function(){return"brightics.va.editors.diagram.commands.updateoperationcommand";},i.prototype.getLabel=function(){return this.options.label;},i.prototype.setValue=function(t,i,o){var n=this.options.fnUnit||this.options.target;o?this.old=e.updateProp(n,t,i):e.updateProp(n,t,i);},t.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.options.old={},this.options.old[this.options.name]=this.options.analyticsModel.getParameter(this.options.name),this.options.analyticsModel.setParameter(this.options.name,this.options.ref);},e.prototype.undo=function(){var t=Object.keys(this.options.old)[0];this.options.analyticsModel.setParameter(t,this.options.old[t]);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.UpdateParameterCommand";},e.prototype.getLabel=function(){return"Update Parameters";},t.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.canUndo=function(){return!0;},e.prototype.canRedo=function(){return!0;},e.prototype.execute=function(){this.options.old=this.getMainModel().getVariable(this.options.fid,this.options.paramKey),this.getMainModel().setVariable(this.options.fid,this.options.paramKey,this.options.ref);},e.prototype.undo=function(){this.getMainModel().setVariable(this.options.fid,this.options.paramKey,this.options.old);},e.prototype.redo=function(){this.execute();},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.updatevariablecommand";},e.prototype.getLabel=function(){return"Update Variable";},t.VA.Core.Editors.Diagram.Commands.UpdateVariableCommand=e;}.call(this),function(){"use strict";var t=this.Brightics,e=["array[string]","array[number]"],i=["number","array[number]"];function o(e,i){t.VA.Core.Command.call(this,e,i);}o.prototype=Object.create(t.VA.Core.Command.prototype),o.prototype.constructor=o,o.prototype.canUndo=function(){return!0;},o.prototype.canRedo=function(){return!0;},o.prototype.execute=function(){var t=this.getMainModel();if(this.options.old=_.cloneDeep(t.variables[this.options.name]),this.options.name===this.options.newName){if(this.options.old.type!==this.options.ref.type){var e=this.getValueByType(this.options.old.type,this.options.ref.type,this.options.ref.value);e=this.typeCast(e,this.options.ref.type),this.options.ref.value=e,this.options.ref.type=this.options.ref.type;}t.setVariableDef(this.options.name,this.options.ref);}else t.removeVariableDef(this.options.name),t.addVariableDef(this.options.newName,this.options.old);},o.prototype.undo=function(){var t=this.getMainModel();this.options.name===this.options.newName?t.setVariableDef(this.options.name,this.options.old):(t.addVariableDef(this.options.name,this.options.old),t.removeVariableDef(this.options.newName));},o.prototype.redo=function(){this.execute();},o.prototype.getId=function(){return"brightics.va.editors.diagram.commands.updatevariabledefcommand";},o.prototype.getLabel=function(){return"Update Variable";},o.prototype.isArrayType=function(t){return e.indexOf(t)>-1;},o.prototype.isNumeric=function(t){return i.indexOf(t)>-1;},o.prototype.getValueByType=function(t,e,i){return this.isArrayType(t)&&!this.isArrayType(e)?i[0]:!this.isArrayType(t)&&this.isArrayType(e)?[i]:i;},o.prototype.typeCast=function(t,e){var i=t;return i=this.isNumeric(e)?this.isArrayType(e)?_.map(i,this.toNumber.bind(this)):this.toNumber(i):this.isArrayType(e)?_.map(i,this.toString.bind(this)):this.toString(i);},o.prototype.toString=function(t){return _.isNull(t)||_.isUndefined(t)||""===t?"":_.isNumber(t)?_.isNaN(t)||_.isUndefined(t)?"":t.toString():t;},o.prototype.toNumber=function(t){return _.isNull(t)||_.isUndefined(t)||""===t?0:Number(this.toString(Number(t)));},t.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.options.analyticsModel.variables.push(this.options.variable);},e.prototype.undo=function(){this.options.analyticsModel.variables.splice(this.options.analyticsModel.variables.length-1,1);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.controleditor.addvariablecommand";},e.prototype.getLabel=function(){return"Add Control Flow Variable";},t.VA.Core.Editors.Diagram.Commands.ControlEditor.AddVariableCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var t=this.options.newParent.param?this.options.newParent.param.functions:this.options.newParent.functions,e=this.options.oldParent.param?this.options.oldParent.param.functions:this.options.oldParent.functions;this.options.oldIndex=e.indexOf(this.options.unit),e.splice(this.options.oldIndex,1),-1!==this.options.newIndex?t.splice(this.options.newIndex,0,this.options.unit):(t.push(this.options.unit),this.options.newIndex=t.indexOf(this.options.unit));},e.prototype.undo=function(){var t=this.options.newParent.param?this.options.newParent.param.functions:this.options.newParent.functions,e=this.options.oldParent.param?this.options.oldParent.param.functions:this.options.oldParent.functions;t.splice(this.options.newIndex,1),e.splice(this.options.oldIndex,0,this.options.unit);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.controleditor.appendunitcommand";},e.prototype.getLabel=function(){return"Move Unit";},t.VA.Core.Editors.Diagram.Commands.ControlEditor.AppendUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var t=this.options.parent.param?this.options.parent.param.functions:this.options.parent.functions;this.options.unit=this.options.analyticsModel.newFnUnit(this.options.func),this.options.dataFlowFile&&this.createDataFlowUnitInformation(),-1!==this.options.index?t.splice(this.options.index,0,this.options.unit):(t.push(this.options.unit),this.options.index=t.indexOf(this.options.unit));},e.prototype.redo=function(){var t=this.options.parent.param?this.options.parent.param.functions:this.options.parent.functions;this.options.dataFlowFile&&this.createDataFlowUnitInformation(),-1!==this.options.index?t.splice(this.options.index,0,this.options.unit):(t.push(this.options.unit),this.options.index=t.indexOf(this.options.unit));},e.prototype.undo=function(){(this.options.parent.param?this.options.parent.param.functions:this.options.parent.functions).splice(this.options.index,1);},e.prototype.createDataFlowUnitInformation=function(){var t=this.options.unit,e=this.options.dataFlowFile,i=e.getContents()["gv-def"]||{};t.param.mid=e.getFileId(),t.param.label=e.getLabel()||"",t.param.description=e.getDescription()||"",t.display={label:e.getLabel(),description:""},$.map(i,function(e,i){t.param.args[i]={type:"literal",value:e.value,"variable-type":e["variable-type"]||"string"};});},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.controleditor.newunitcommand";},e.prototype.getLabel=function(){return"New Unit";},t.VA.Core.Editors.Diagram.Commands.ControlEditor.NewUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var t=this.options.parent.param?this.options.parent.param.functions:this.options.parent.functions;for(var e in this.options.index=-1,t){t[e].fid==this.options.unit.fid&&(this.options.index=e);}t.splice(this.options.index,1);},e.prototype.undo=function(){(this.options.parent.param?this.options.parent.param.functions:this.options.parent.functions).splice(this.options.index,0,this.options.unit);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.controleditor.removeunitcommand";},e.prototype.getLabel=function(){return"Remove Unit";},t.VA.Core.Editors.Diagram.Commands.ControlEditor.RemoveUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.old.index=this.options.analyticsModel.variables.indexOf(this.options.variable),this.options.analyticsModel.variables.splice(this.old.index,1);},e.prototype.undo=function(){this.options.analyticsModel.variables.splice(this.old.index,0,this.options.variable);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.controleditor.removevariablecommand";},e.prototype.getLabel=function(){return"Remove Control Flow Variable";},t.VA.Core.Editors.Diagram.Commands.ControlEditor.RemoveVariableCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){var t=this.options.parent.param.functions;this.options.oldIndex=t.indexOf(this.options.unit),t.splice(this.options.newIndex,0,t.splice(this.options.oldIndex,1)[0]);},e.prototype.undo=function(){var t=this.options.parent.param.functions;t.splice(this.options.oldIndex,0,t.splice(this.options.newIndex,1)[0]);},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.controleditor.reorderunitcommand";},e.prototype.getLabel=function(){return"Reorder Unit";},t.VA.Core.Editors.Diagram.Commands.ControlEditor.ReorderUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.old.display={},this.old.param={};}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){for(var t in this.options.display){this.old.display[t]=this.options.unit.display[t],this.options.unit.display[t]=this.options.display[t];}for(var t in this.options.param){this.old.param[t]=Array.isArray(this.options.unit.param[t])?$.extend([],this.options.unit.param[t]):this.options.unit.param[t],this.options.unit.param[t]=this.options.param[t];}},e.prototype.undo=function(){for(var t in this.old.display){this.options.unit.display[t]=this.old.display[t];}for(var t in this.old.param){this.options.unit.param[t]=Array.isArray(this.old.param[t])?$.extend([],this.old.param[t]):this.old.param[t];}},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.controleditor.updateunitcommand";},e.prototype.getLabel=function(){return"Update Unit";},t.VA.Core.Editors.Diagram.Commands.ControlEditor.UpdateUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.old.index=this.options.analyticsModel.variables.indexOf(this.options.variable),this.old.variable=$.extend(!0,{},this.options.analyticsModel.variables[this.old.index]);var t=this.options.analyticsModel.variables[this.old.index].type,e=this.options.ref.type||this.options.analyticsModel.variables[this.old.index].type;t!==e&&("array"===t?this.options.ref.value="number"===e?"":String(this.options.analyticsModel.variables[this.old.index].value[0]):"number"===e?this.options.ref.value="":"array"===e&&(this.options.ref.value=[this.options.analyticsModel.variables[this.old.index].value])),this.options.analyticsModel.variables[this.old.index].name=this.options.ref.name||this.old.variable.name,this.options.analyticsModel.variables[this.old.index].type=this.options.ref.type||this.old.variable.type,this.options.analyticsModel.variables[this.old.index].value=""!==this.options.ref.value?this.options.ref.value||this.old.variable.value:this.options.ref.value;},e.prototype.undo=function(){this.options.analyticsModel.variables[this.old.index].name=this.old.variable.name,this.options.analyticsModel.variables[this.old.index].type=this.old.variable.type,this.options.analyticsModel.variables[this.old.index].value=this.old.variable.value;},e.prototype.getId=function(){return"brightics.va.editors.diagram.commands.controleditor.updatevariablecommand";},e.prototype.getLabel=function(){return"Update Control Flow Variable";},t.VA.Core.Editors.Diagram.Commands.ControlEditor.UpdateVariableCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.$parent=t,this.options={draggable:!0,resizable:!0},this.options=$.extend(!0,this.options,e),this.init();}e.prototype.init=function(){this.createLayout(),this.createContents();},e.prototype.getTitle=function(){},e.prototype.setPosition=function(){},e.prototype.createLayout=function(){var t=this;this.$boatArea=$('<div class="brtc-va-editors-diagram-minimap">   <div class="brtc-va-editors-diagram-minimap-header">       <div class="brtc-va-editors-diagram-minimap-title">'+this.getTitle()+'</div>       <div class="brtc-va-editors-diagram-minimap-collapse"><i class="fa fa-chevron-up" aria-hidden="true"></i></div>   </div>   <div class="brtc-va-editors-diagram-minimap-contents">   </div></div>'),this.$boat=this.$boatArea.find(".brtc-va-editors-diagram-minimap-contents"),this.$parent.append(this.$boatArea),this.setPosition(),this.options.draggable&&this.$boatArea.draggable({containment:"parent",handle:".brtc-va-editors-diagram-minimap-header",start:function start(){$(this).css("right","auto");},stop:function stop(){var t=$(this).position();t.left>$(this).parent().width()/2&&($(this).css("left","auto"),$(this).css("right",$(this).parent().width()-t.left-$(this).width()));}}),this.options.resizable&&this.$boat.resizable({maxWidth:1280,minWidth:190,minHeight:90,containment:".brtc-va-editors-modeleditor-splitter",start:function start(e,i){t.$boatArea.css("left",t.$boatArea.position().left),t.$boatArea.css("right","initial");},stop:function stop(e,i){var o=t.$boatArea.position();o.left>t.$boatArea.parent().width()/2&&(t.$boatArea.css("left","initial"),t.$boatArea.css("right",t.$boatArea.parent().width()-o.left-t.$boatArea.width())),t.updateMiniMapWindow();}});var e=this.$boatArea.find(".brtc-va-editors-diagram-minimap-collapse");e.on("click",function(i){e.find("i").hasClass("fa-chevron-down")?(e.find("i").removeClass("fa-chevron-down"),t.$boat.removeClass("collapsed")):(e.find("i").addClass("fa-chevron-down"),t.$boat.addClass("collapsed"));}),this.$boatArea.find(".brtc-va-editors-diagram-minimap-close").on("click",function(e){t.$boatArea.addClass("closed");});},e.prototype.destroy=function(){this.$boatArea.remove();},t.VA.Core.Editors.Diagram.Boat=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Diagram.Boat.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Diagram.Boat.prototype),e.prototype.constructor=e,e.prototype.createContents=function(){var e=$('<div class="brtc-va-dialogs-index-item-container"></div>');this.$boat.append(e);var i=this.options.editor.getModel().mid,o=new t.VA.Core.Editors.Sheet.DataProxy(e,i);this.innerPropertiesPanel=this.options.editor.getPanelFactory().createPropertiesPanel(e,{width:"100%",height:"100%",fnUnit:this.options.editor.getActiveFnUnit(),dataProxy:o,blockCommandListener:!0}),this.innerPropertiesPanel.setHeight(300),this.innerPropertiesPanel.setType("inner"),this.innerPropertiesPanel.hideTopArea(),this.innerPropertiesPanel.hideBottomArea(),this.innerPropertiesPanel.hideInTableControl(),this.innerPropertiesPanel.$mainControl.find(".brtc-va-editors-sheet-controls-propertycontrol-columnlist").hide(),e.find(".brtc-va-progress").hide(),this.configureStyle();},e.prototype.configureStyle=function(){this.$boat.addClass("brtc-style-height-400px").addClass("brtc-style-border-top-grey").addClass("brtc-style-background-white");},e.prototype.getTitle=function(){return"Expression";},e.prototype.setPosition=function(){this.$boatArea.css("right","300px");},t.VA.Core.Editors.Diagram.ExpressionBoat=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Diagram.Boat.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Diagram.Boat.prototype),e.prototype.constructor=e,e.prototype.createContents=function(){var e=this;this.$paper=$('<div class="brtc-va-editors-diagram-minimap-paper"></div>'),this.$window=$('<div class="brtc-va-editors-diagram-minimap-window"></div>'),this.$boat.append(this.$paper).append(this.$window),this.$wrapper=Studio.getEditorContainer().getActiveModelEditor().getDiagramEditorPageArea().find(".brtc-va-editors-diagram-diagrameditorpage"),this.$window.draggable({containment:"parent",stop:function stop(){var t=$(this).position(),i=e.getPaperSize(),o=e.$paper.find("svg"),n=o.width()/i.width,r=o.height()/i.height,a=t.left/n,s=t.top/r;e.$wrapper.scrollLeft(a).scrollTop(s),e.updateMiniMapWindow();}}),"true"!==t.VA.SettingStorage.getValue("editor.minimap.visible")&&e.$boatArea.addClass("closed"),this.miniPaper=new joint.dia.Paper({el:this.$paper,width:190,height:90,model:this.options.diagramEditorPage.graph,theme:"none"}),this.miniPaper.scale(.3),this.miniPaper.$el.css("pointer-events","none");},e.prototype.updateMiniMapWindow=function(){if(this.miniPaper){var t,e=this.getPaperSize(),i=this.$boat.width(),o=this.$boat.height();e.height*i/e.width<=o?(t=i/e.width,this.miniPaper.setDimensions(i,e.height*t)):(t=o/e.height,this.miniPaper.setDimensions(e.width*t,o)),this.miniPaper.scale(t*this.options.diagramEditorPage.getOptions().scale),this.$window.css({width:this.$wrapper.width()*t,height:this.$wrapper.height()*t,left:this.$wrapper.scrollLeft()*t,top:this.$wrapper.scrollTop()*t}),this.$boat.width()!=Math.max(190,this.miniPaper.options.width)&&this.$boat.width(Math.max(190,this.miniPaper.options.width)),this.$boat.height()!=Math.max(90,this.miniPaper.options.height)&&this.$boat.height(Math.max(90,this.miniPaper.options.height));}},e.prototype.getPaperSize=function(){return this.options.diagramEditorPage.getPaperSize();},e.prototype.getTitle=function(){return"Minimap";},t.VA.Core.Editors.Diagram.MinimapBoat=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-fnunitnavigator"></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.createLayout(),this.createNavigator();},e.prototype.createLayout=function(){var t=$('<div class="brtc-va-editors-sheet-fnunitnavigator-navigator"></div>');this.$mainControl.append(t);var e=$('<div class="brtc-va-editors-sheet-fnunitnavigator-mode"></div>');this.$mainControl.append(e),this.$navigator=t,this.$mode=e;},e.prototype.createNavigator=function(){var t=this.options.analyticsModel.getFnUnitListBySheetId(this.options.sheetId);for(var e in t){this.createNavigatorElement(this.$navigator,t[e]);}this.$navigator.append('<div class="brtc-va-editors-sheet-fnunitnavigator-navigator-addfn"><i class="fa fa-plus-circle"></i></div>');},e.prototype.createNavigatorElement=function(e,i){var o=i.parent().type,n="brtc-va-fnunit-category-"+t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(o,i.func).category,r=this,a=$('<div class="brtc-va-editors-sheet-fnunitnavigator-navigator-main">   <div class="brtc-va-editors-sheet-fnunitnavigator-navigator-element '+n+'">       <div class="brtc-va-editors-sheet-fnunitnavigator-navigator-element-title">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i.display.label)+"</div>   </div></div>");a.attr("fnunitid",i.id),e.append(a),a.on("click",function(){var t=$(this).attr("fnunitid");r.select(t,!0);});},e.prototype.select=function(t,e){this.$navigator.find(".brtc-va-editors-sheet-fnunitnavigator-navigator-element").removeClass("brtc-va-editors-sheet-fnunitnavigator-navigator-element-selected");var i=this.$navigator.children('.brtc-va-editors-sheet-fnunitnavigator-navigator-main[fnunitid="'+t+'"]');i.children(".brtc-va-editors-sheet-fnunitnavigator-navigator-element").addClass("brtc-va-editors-sheet-fnunitnavigator-navigator-element-selected");var o=this.$navigator.children(".brtc-va-editors-sheet-fnunitnavigator-navigator-addfn");o.detach(),i.after(o),e&&this.$parent.trigger("select",[{fnUnitId:t}]);},e.prototype.setFocusElement=function(t){var e=$("."+t),i=this.$navigator.find(".brtc-va-editors-sheet-fnunitnavigator-navigator-addfn");i.length>0?e.after(i):(i=this.createAddFn(),this.$navigator.append(i));for(var o=e.parent().children(),n=0;n<o.length;n++){$(o[n]).children().removeClass("brtc-va-editors-sheet-fnunitnavigator-navigator-element-selected");}e.children().addClass("brtc-va-editors-sheet-fnunitnavigator-navigator-element-selected");},e.prototype.createAddFn=function(){return $('<div class="brtc-va-editors-sheet-fnunitnavigator-navigator-addfn">   <i class="fa fa-plus-circle"></i></div>');},e.prototype.createMode=function(){$(this.$mode).jqxDropDownList({source:["2","3"],theme:"office",autoOpen:!1,itemHeight:30,width:"48px",height:"90%",selectedIndex:1,autoDropDownHeight:!0});},t.VA.Core.Editors.Sheet.FnUnitNavigator=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");function i(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}function o(t,e){this.parentId=t,this.mid=e,this.requested={},this.retrieveParent(),this.createControls();}i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-fnunitviewer"></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.createLayout();},i.prototype.createLayout=function(){this.$mainControl.append('<div class="brtc-va-editors-sheet-fnunitviewer-panel brtc-va-editors-sheet-fnunitviewer-flex-width brtc-va-editors-sheet-fnunitviewer-indata-fncenter" datapaneltype="in"></div><div class="brtc-va-editors-sheet-fnunitviewer-panel brtc-va-editors-sheet-fnunitviewer-fixed-width brtc-va-editors-sheet-fnunitviewer-fn-fncenter"></div><div class="brtc-va-editors-sheet-fnunitviewer-panel brtc-va-editors-sheet-fnunitviewer-flex-width brtc-va-editors-sheet-fnunitviewer-outdata-fncenter" datapaneltype="out"></div>');},i.prototype.destroy=function(){this.inPanel&&this.inPanel.destroy(),this.propertiesPanel&&this.propertiesPanel.destroy(),this.outPanel&&this.outPanel.destroy(),this.inViewerTab&&this.inViewerTab.destroy(),this.outViewerTab&&this.outViewerTab.destroy(),this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-indata-fncenter").off("sizeChange"),this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-outdata-fncenter").off("sizeChange"),this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-indata-fncenter").empty(),this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-fn-fncenter").empty(),this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-outdata-fncenter").empty(),this._status="destroyed";},i.prototype._alreadyRendered=function(t){return this.fnUnit&&this.fnUnit.fid===t.fid&&"rendered"===this._status;},i.prototype.movePanel=function(t){this.outViewerTab.select(t);},i.prototype.getDataTypes=function(t,i){return e.getTypes(t,i);},i.prototype.createOutPages=function(t){var e=this,i=[],o=this.getDataTypes(t.fnUnit,"out");for(var n in o=_.isEmpty(o)?["table","model","image"]:o){var r=o[n],a={label:r,type:r,renderer:function renderer(i,o){i.empty(),i.attr("datapaneltype","out"),t.type=o,t.panelType="out";var n=e.options.panelFactory.create(i,t);i.data("panelControl_ref",n);},destroy:function destroy(t){var e=t.data("panelControl_ref");e&&"function"==typeof e.destroy&&e.destroy();}};i.push(a);}return i;},i.prototype.createInPages=function(t){var e=this,i=[],o=this.getDataTypes(t.fnUnit,"in");for(var n in o=_.isEmpty(o)?["table","model","image"]:o){var r=o[n],a={label:r,type:r,renderer:function renderer(i,o){i.empty(),i.attr("datapaneltype","in"),t.type=o,t.panelType="in";var n=e.options.panelFactory.create(i,t);i.data("panelControl_ref",n);},destroy:function destroy(t){var e=t.data("panelControl_ref");e&&"function"==typeof e.destroy&&e.destroy();}};i.push(a);}return i;},i.prototype.createInPanel=function(i,o){var n=this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-indata-fncenter");if(e.hasInput(o.fnUnit)){i.show();var r=this.createInPages(o);o.pages=r,this.inViewerTab=new t.VA.Core.Tools.Tab(n,o);}else e.isBluffNode(o.fnUnit)?(i.show(),this.inPanel=new t.VA.Core.Editors.Sheet.Panels.BluffPanel(n,{label:"No Inputs"})):i.hide();},i.prototype.createOutPanel=function(i,o){var n=this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-outdata-fncenter");if(e.hasOutput(o.fnUnit)){i.show();var r=this.createOutPages(o);o.pages=r,this.outViewerTab=new t.VA.Core.Tools.Tab(n,o);}else e.isBluffNode(o.fnUnit)?(i.show(),this.outPanel=new t.VA.Core.Editors.Sheet.Panels.BluffPanel(n,{label:"No Outputs"})):i.hide();},i.prototype.render=function(e){if(!this._alreadyRendered(e)){var i=this;this.destroy(),this.fnUnit=e;var o,n,r,a=e.parent().mid,s=this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-fn-fncenter"),l=this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-indata-fncenter"),c=this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-outdata-fncenter");o||(o=new t.VA.Core.Editors.Sheet.DataProxy(s,a)),n||(n=new t.VA.Core.Editors.Sheet.DataProxy(l,a)),r||(r=new t.VA.Core.Editors.Sheet.DataProxy(c,a)),o.reset(),n.reset(),r.reset(),this.propertiesPanel=this.options.panelFactory.createPropertiesPanel(s,{width:"100%",height:"100%",fnUnit:e,dataProxy:o});var d={width:"100%",height:"100%",fnUnit:e,resizable:!0,dataProxy:n},p={width:"100%",height:"100%",fnUnit:e,resizable:!0,dataProxy:r};this.propertiesPanel.$mainControl.bind("callFunction",function(t,e){if(!e||e===i.propertiesPanel.options.fnUnit.fid){i.outPanel&&(i.outPanel.destroy(),i.outPanel=null);var o=i.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-outdata-fncenter");o.empty(),i.outPanel=i.createOutPanel(o,p);}}),this.inPanel=this.createInPanel(l,d),this.outPanel=this.createOutPanel(c,p),this.bindEventHandlers(),this.updatePanelWidth(),this._status="rendered";}},i.prototype.bindEventHandlers=function(){var t=this,e=this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-indata-fncenter"),i=this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-outdata-fncenter");e.on("sizeChange",function(){i&&"none"===i.css("display")?i.show():i.hide(),t.updatePanelWidth();}),i.on("sizeChange",function(i){e&&"none"===e.css("display")?e.show():e.hide(),t.updatePanelWidth();});},i.prototype.updatePanelWidth=function(){var t=0;this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-fixed-width").each(function(){"none"!==$(this).css("display")&&(t+=$(this).width());});var e=0,i=this.$mainControl.children(".brtc-va-editors-sheet-fnunitviewer-flex-width");i.each(function(){"none"!==$(this).css("display")&&e++;}),i.each(function(){"none"!==$(this).css("display")&&$(this).css("width","calc((100% - "+(t+2)+"px) / "+e+")");}),2==e&&(this.inPanel&&this.inPanel.adjustMaximize(!1),this.outPanel&&this.outPanel.adjustMaximize(!1)),this.adjustHeader(i),$(window).trigger("resize");},i.prototype.adjustHeader=function(t){t.each(function(){var t=$(this);if(0!==t.children().length){var e=t.find(".brtc-va-editors-sheet-panels-datapanel-toolbar");if(0!==e.length){var i=t.find(".brtc-va-editors-sheet-worksheet-selector"),o=t.find(".brtc-va-editors-sheet-panels-basepanel-header-context-menu-open"),n=t.find(".brtc-va-editors-sheet-panels-basepanel-header-title"),r=e.position(),a=n.width();a=0===r.top?t.width()-(i.width()+e.width()):t.width()-(i.width()+o.width()),n.width(a);}}});},i.prototype.refresh=function(){this.propertiesPanel&&this.propertiesPanel.refresh();},i.prototype.getPreviousFnUnit=function(t){var e=[],i=t.parent(),o=i.getPrevious(t.fid);return _.forEach(o,function(t){e.push(i.getFnUnitById(t));}),e;},t.VA.Core.Editors.Sheet.FnUnitViewer=i,o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},o.prototype.createControls=function(){this.$parent.append($('<div class="brtc-va-progress">   <div>       <span class="brtc-va-progress-loading"></span>       <p class="brtc-va-progress-loading-label">Fetching rows ...</p>   </div></div>'));},o.prototype.requestPageData=function(e,i,o,n,r){var a=this;this.requested[e]||(this.requested[e]=[]),this.requested[e].push({doneCallback:i,failCallback:o}),this._showProgress();var s=(n-1)*r,l=r;t.VA.Core.DataQueryTemplate.queryData(a.mid,e,s,l,function(t,e){a.requested[e]&&a.requested[e].shift().doneCallback(t,e),a._done(e);},function(t,e,i){o&&a.requested[e]&&a.requested[e].shift().failCallback(t),a._done(e);});},o.prototype.requestData=function(e,i,o,n,r){var a=this;this.requested[e]||(this.requested[e]=[]),this.requested[e].push({doneCallback:i,failCallback:o}),this._showProgress(),n?t.VA.Core.DataQueryTemplate.fetchMore(a.mid,e,n,function(t,e){a.requested[e]&&a.requested[e].shift().doneCallback(t),a._done(e);},function(t,e,i){o&&a.requested[e]&&a.requested[e].shift().failCallback(t),a._done(e);}):t.VA.Core.DataQueryTemplate.queryTable(a.mid,e,function(t,e){a.requested[e]&&a.requested[e].shift().doneCallback(t),a._done(e);},function(t,e,i){o&&a.requested[e]&&a.requested[e].shift().failCallback(t),a._done(e);},r);},o.prototype.requestDataForEDA=function(e,i,o,n,r){var a=this;this.requested[e]||(this.requested[e]=[]),this.requested[e].push({doneCallback:i,failCallback:o}),this._showProgress(),n?t.VA.Core.DataQueryTemplate.fetchMore(a.mid,e,n,function(t,e){a.requested[e]&&a.requested[e].shift().doneCallback(t),a._done(e);},function(t,e,i){a.requested[e]&&a.requested[e].shift().doneCallback({type:"table",data:[],bytes:1,count:0,columns:[{name:"continuous_feature_idx",type:"number",internalType:"Integer"},{name:"continuous_feature_num",type:"number",internalType:"Integer"},{name:"category_feature_idx",type:"number",internalType:"Integer"},{name:"category_feature_num",type:"number",internalType:"Integer"},{name:"label_idx",type:"number",internalType:"Integer"}]}),a._done(e);}):t.VA.Core.DataQueryTemplate.queryTable(a.mid,e,function(t,e){a.requested[e]&&a.requested[e].shift().doneCallback(t),a._done(e);},function(t,e,i){a.requested[e]&&a.requested[e].shift().doneCallback({type:"table",data:[],bytes:1,count:0,columns:[{name:"continuous_feature_idx",type:"number",internalType:"Integer"},{name:"continuous_feature_num",type:"number",internalType:"Integer"},{name:"category_feature_idx",type:"number",internalType:"Integer"},{name:"category_feature_num",type:"number",internalType:"Integer"},{name:"label_idx",type:"number",internalType:"Integer"}]}),a._done(e);},r);},o.prototype.requestSchema=function(t,e,i){this.requestData(t,e,i,!1);},o.prototype.requestFetchMore=function(t,e,i,o){this.requestData(t,i,o,e);},o.prototype.requestDataForce=function(t,e,i){this.requestData(t,e,i,!1,!0);},o.prototype._done=function(t){this.requested[t]&&0!==this.requested[t].length||delete this.requested[t],0===Object.keys(this.requested).length&&this._hideProgress();},o.prototype.reset=function(){this._hideProgress(),this.requested={};},o.prototype._hideProgress=function(){this.$parent.find(".brtc-va-progress").hide();},o.prototype._showProgress=function(){this.$parent.find(".brtc-va-progress").show();},t.VA.Core.Editors.Sheet.DataProxy=o;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");function i(){}i.prototype.createInDataPanel=function(e,i){if(i.fnUnit[IN_DATA])return i.title=i.title||"In",i.resizable=!!i.fnUnit[OUT_DATA],new t.VA.Core.Editors.Sheet.Panels.DataPanel(e,i);},i.prototype.createOutDataPanel=function(e,i){if(i.fnUnit[OUT_DATA])return i.title=i.title||"Out",i.resizable=!!i.fnUnit[IN_DATA],new t.VA.Core.Editors.Sheet.Panels.DataPanel(e,i);},i.prototype.createPropertiesPanel=function(e,i){if(i.fnUnit&&i.fnUnit.func){var o=i.fnUnit.parent().type;return i.title=i.title||i.fnUnit.display.label,new(void 0===t.VA.Core.Interface.Functions[o][i.fnUnit.func]?t.VA.Core.Interface.Functions[o].unknownFunction.propertiesPanel:t.VA.Core.Interface.Functions[o][i.fnUnit.func].propertiesPanel)(e,i);}},i.prototype.create=function(t,i){var o,n=i.type;return this[n]?("in"===i.panelType&&(i.resizable=!!e.hasOutput(i.fnUnit)),"out"===i.panelType&&(i.resizable=!!e.hasInput(i.fnUnit)),o=this[n](t,i)):o=this.note(),o;},i.prototype.inData=function(e,i){if(i.fnUnit[IN_DATA])return i.title=i.title||"In",i.resizable=!!i.fnUnit[OUT_DATA],new t.VA.Core.Editors.Sheet.Panels.DataPanel(e,i);},i.prototype.outData=function(e,i){if(i.fnUnit[OUT_DATA])return i.title=i.title||"Out",i.resizable=!!i.fnUnit[IN_DATA],new t.VA.Core.Editors.Sheet.Panels.DataPanel(e,i);},i.prototype.table=function(t,i){e.getTable(i.fnUnit,i.panelType);return i.title=i.title||"in"===i.panelType?"In":"Out",new(e.getDataPanel(i.fnUnit,i.panelType))(t,i);},i.prototype.model=function(e,i){return i.title=i.title||"in"===i.panelType?"In":"Out",new t.VA.Core.Editors.Sheet.Panels.ModelPanel(e,i);},i.prototype.html=function(e,i){return new t.VA.Core.Editors.Sheet.Panels.HtmlPanel(e,i);},i.prototype.md=function(t,e){},i.prototype.image=function(e,i){return i.title=i.title||"in"===i.panelType?"In":"Out",new t.VA.Core.Editors.Sheet.Panels.ImagePanel(e,i);},i.prototype.note=function(t,e){},t.VA.Core.Editors.Sheet.PanelFactory=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.EditorPage.call(this,e,i),this.registerCommandEventListener();}e.prototype=Object.create(t.VA.Core.Editors.EditorPage.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-sheeteditorpage">   <div class="brtc-va-editors-sheet-sheeteditorpage-description">       <i class="fa fa-info fa-5x"></i><br>       There is no selected function for this page.<br>Please select a function.   </div>   <div class="brtc-va-editors-sheet-sheeteditorpage-fnunitviewer"></div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$description=this.$mainControl.find(".brtc-va-editors-sheet-sheeteditorpage-description"),this.$fnUnitViewer=this.$mainControl.find(".brtc-va-editors-sheet-sheeteditorpage-fnunitviewer"),this.showDescription(!1),this.createFnUnitViewer(this.$fnUnitViewer);},e.prototype.createFnUnitViewer=function(e){this.fnUnitViewer=new t.VA.Core.Editors.Sheet.FnUnitViewer(e,{width:"100%",height:"100%",panelFactory:this.options.panelFactory});},e.prototype.registerCommandEventListener=function(){t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl).addCommandListener(function(t){});},e.prototype.render=function(e){var i=this;if(e&&e.length>0){if(1==e.length)this.showDescription(!1),this.fnUnitViewer.render(e[0]);else{this.$description.empty(),this.$description.append("Do you want to ");var o=$('<input value="Delete" type="button" style="margin-left: 6px; margin-right: 6px"/>');this.$description.append(o),this.$description.append("selected "+e.length+" functions ?"),o.jqxButton({theme:t.VA.Env.Theme,width:80,height:30}),o.on("click",function(){var o,n,r=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(i.$mainControl),a=r.options.editorInput.getContents(),s=new t.VA.Core.CompoundCommand(this,{}),l=[];for(o in e){var c=a.getConnectedLinkUnits(e[o].fid);for(n in c){l.indexOf(c[n].kid)<0&&l.push(c[n].kid);}}for(o in l){s.add(new t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand(this,{kid:l[o]}));}for(o in e){for(var d in s.add(new t.VA.Core.Editors.Diagram.Commands.RemoveFnUnitCommand(this,{fid:e[o].fid})),e[o].param){var p=e[o].parent().getVariable(e[o].fid,d);p&&s.add(new t.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(this,{fid:e[o].fid,paramKey:d,variable:p}));}}r.getCommandManager().execute(s);}),this.showDescription(!0);}}else this.fnUnitViewer.destroy(),this.$description.empty(),this.$description.append('<i class="fa fa-info fa-5x"></i><br>There is no selected function for this page.<br>Please select a function.'),this.showDescription(!0);},e.prototype.showDescription=function(t){t?(this.$description.css("display","block"),this.$fnUnitViewer.css("display","none")):(this.$description.css("display","none"),this.$fnUnitViewer.css("display","block"));},e.prototype.destroy=function(){this.fnUnitViewer.destroy();},e.prototype.getFnUnitViewer=function(){return this.fnUnitViewer;},e.prototype.onActivated=function(){return this.getFnUnitViewer().refresh();},t.VA.Core.Editors.Sheet.SheetEditorPage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol">   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents"></div>'),this.$labelArea=this.$mainControl.find(".brtc-va-editors-sheet-controls-propertycontrol-label"),this.$contentsArea=this.$mainControl.find(".brtc-va-editors-sheet-controls-propertycontrol-contents"),this.setLabel(this.$labelArea),this.$mainControl.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"left"}),this.$parent.append(this.$mainControl);},e.prototype.setLabel=function(t){t.text(this.options.label);},this.Brightics.VA.Core.Editors.Sheet.Controls.PropertyControl=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");var i=new t.VA.Log("DataWorksheet");function o(t,e){this.parentId=t,this.options=e,this.controls={},this.retrieveParent(),this._init(),this._setDataInfo(),this.renderDataWorksheet();}o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},o.prototype.renderDataWorksheet=function(){var t=this;this._prepareTables(),this._queryTables(function(){t.createControls();});},o.prototype._init=function(){var t=this.getDataWorksheetOption("partial");this.options.style={width:"100%",height:"100%"},this.options.worksheet={panel:t.panel,layout:t.layout},this.chartOptions={};},o.prototype.getDataWorksheetOption=function(t){return this.options.fnUnit.display.sheet&&this.options.fnUnit.display.sheet[this.options.panelType]&&this.options.fnUnit.display.sheet[this.options.panelType][t]&&this.options.fnUnit.display.sheet[this.options.panelType][t][0]?this.options.fnUnit.display.sheet[this.options.panelType][t][0]:{panel:[],layout:{}};},o.prototype._setDataInfo=function(){this.dataInfo={mid:this.options.fnUnit.parent().mid,fid:this.options.fnUnit.fid,fnUnitLabel:this.options.fnUnit.display.label,panelType:this.options.panelType,tableList:e.getTable(this.options.fnUnit,this.options.panelType)};},o.prototype._updateDataInfoTableList=function(){this.dataInfo.tableList=e.getTable(this.options.fnUnit,this.options.panelType);},o.prototype.getDataTable=function(){return e.getTable(this.options.fnUnit,this.options.panelType);},o.prototype._prepareTables=function(){this._updateDataInfoTableList();var e=this.getDataTable();for(var i in this._tableMap={},0===this.options.worksheet.panel.length?this.options.worksheet.panel.push({id:"default-"+Date.now(),chartOption:{chart:{type:"table"}}}):1===this.options.worksheet.panel.length&&"table"!==this.options.selectedChart&&(this.options.worksheet.panel[0].chartOption.chart.type=this.options.selectedChart),this.options.worksheet.panel){var o=this.options.worksheet.panel[i],n=t.Chart.Registry[o.chartOption.chart.type]||t.Chart.Registry.table,r=$.extend(!0,{},n.DefaultOptions,o.chartOption);r.colorSet=o.chartOption.colorSet||n.DefaultOptions.colorSet,o.chartOption=r;for(var a=this.options.worksheet.panel[i].tableIndexes||[0],s=0;s<a.length;s++){var l=e[a[s]]||e[0];void 0!==l&&(this._tableMap[l]=this._tableMap[l]||{});}}},o.prototype._queryTables=function(e){var i=this,o=0,n=Object.keys(this._tableMap);if(0===n.length){var r=this._getCallBackFunction("createRecommendedChartSheet");r&&r();}else for(var a=0;a<n.length;a++){var s=n[a],l=this._tableMap[s]||{},c=l.page||1,d=l.pageSize||1*t.VA.SettingStorage.getValue("editor.datapanel.defaultrowcount");this.options.dataProxy.requestPageData(n[a],function(t,r){i._tableMap[r]=t,i._tableMap[r].page=c,i._tableMap[r].pageSize=d,i._tableMap[r].count=t.count,i._tableMap[r].offset=(c-1)*d,o+=1,n.length===o&&e();},function(t){if(o+=1,n.length===o)if(i.options.worksheet.panel.length<=1&&t&&t.columns&&0===t.columns.length){var r=i._getCallBackFunction("createRecommendedChartSheet");r&&r();}else e();},c,d);}},o.prototype.createControls=function(){var t=this;for(var e in this.$parent.empty(),this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-dataworksheet"></div>'),this.$mainControl.css({width:"100%",height:"100%"}),this.$parent.append(this.$mainControl),this.options.worksheet.onAddChart=this.onAddChart.bind(this),this.options.worksheet.onRemoveChart=this.onRemoveChart.bind(this),this.options.worksheet.onChangeLayout=this.onChangeLayout.bind(this),this.options.worksheet.onChangeChart=this.onChangeChart.bind(this),this.options.worksheet.onSelectChart=this.onSelectChart.bind(this),this.options.worksheet.panel){this.options.worksheet.panel[e].chartOption.source=this._getPanelSource(this.options.worksheet.panel[e]),$.extend(!0,this.options.worksheet.panel[e].chartOption,{plotOptions:{map:{geoData:{url:function url(t){return"api/va/v2/map/"+t;}}}}}),this.options.worksheet.panel[e].chartOption.guide=this._getGuideOption(),this.options.worksheet.panel[e].dataSource=this._setPanelDataSource(e);}this.options.component={right:{chartOption:!0}},this.options.worksheet.toolbar={menu:{multichart:{title:"MultiChart",click:function click(){t._handleOpenMultiChart(this);}},report:{title:"Add to Report",click:function click(){t._handleAddToReport(this);}},setting:{click:function click(){t._handleChartSettings(this);}},duplicate:{},details:{},close:{}}},this.$mainControl.bchartsAdonis(this.options),this.bindEventHandlers(),this._initDataWorkSheet();},o.prototype._getGuideOption=function(){return{message:"Set data options using Chart Setting Button.",onClick:function onClick(){console.log("clicked validation Message");}};},o.prototype._handleChartSettings=function(t){this._openChartSettingsDialog(),this.onSelectChart(t.getOptions());},o.prototype._attachChartOptionPanelToDialog=function(t){t.data("original-parent",t.parent()),t.detach(),this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings").find(".brtc-va-dialog-contents").append(t);},o.prototype._detachChartOptionPanel=function(){this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings").find(".bcharts-option-panel").each(function(t,e){var i=$(e),o=i.data("original-parent");i.detach().appendTo(o);});},o.prototype._openChartSettingsDialog=function(){var t=this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings"),e=this.$mainControl.offset(),i=this.$mainControl.width(),o=$(window).width(),n=($(window).height(),function(t,e){return o<e+t.left?0:o-(e+t.left);});t.height()>this.$mainControl.height()+30?t.css({left:"",right:n(e,i),top:"",bottom:0}):t.css({left:"",right:n(e,i),top:105+this.$mainControl.parents(".brtc-va-editors-modeleditor-sheet").siblings(".brtc-va-editors-modeleditor-diagram").height(),bottom:""}),t.show();},o.prototype.arrange=function(t){this.$mainControl&&this.$mainControl.bchartsAdonis("layout",t);},o.prototype.onAddChart=function(e,i){if(0===$.grep(this.options.worksheet.panel,function(t,i){return t.id==e.id;}).length){var o=new t.VA.Core.CompoundCommand(this,{id:"brightics.va.editors.diagram.commands.addchartcommand"});o.add(this.createNewChartCommand(e)),o.add(this.createSetDataWorksheetLayoutCommand(i)),this.executeCommand(o);}},o.prototype.onRemoveChart=function(e,i){if($.grep(this.options.worksheet.panel,function(t,i){return t.id==e.id;}).length>0){var o=new t.VA.Core.CompoundCommand(this,{id:"brightics.va.editors.diagram.commands.removechartcommand"});o.add(this.createRemoveChartCommand(e)),o.add(this.createSetDataWorksheetLayoutCommand(i)),this.executeCommand(o);}},o.prototype.onChangeLayout=function(t){JSON.stringify(this.options.worksheet.layout)!==JSON.stringify(t)&&this.executeCommand(this.createSetDataWorksheetLayoutCommand(t));},o.prototype._assignArray=function(t,e){for(var i in e){$.isPlainObject(e[i])?this._assignArray(t[i],e[i]):$.isArray(e[i])&&(t[i]=$.extend(!0,[],e[i]));}},o.prototype._mergeArraySafely=function(t,e){var i=$.extend(!0,{},t,e);return this._assignArray(i,e),i;},o.prototype.onChangeChart=function(e,i){var o=this.chartOptions[e.id],n=this._mergeArraySafely(this.chartOptions[e.id],i);if(JSON.stringify(o)!==JSON.stringify(n)){var r=$.extend(!0,{},i);delete r.source;var a=new t.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand(this,{panelOption:e,ref:{chartOption:r}});this.executeCommand(a);}},o.prototype.onSelectChart=function(t){this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings").is(":visible")&&(this.$chartOptionPanel=this.$mainControl.find(".bcharts-option-panel"),this.$chartOptionPanel.length>0&&(this._detachChartOptionPanel(),this._attachChartOptionPanelToDialog(this.$chartOptionPanel)));var e=0;this._selectedPanelOptions=t,t&&t.tableIndexes&&t.tableIndexes[0]&&(e=t.tableIndexes[0]);var i=this.getPaginationInfoByTableIndex(e);this.options.callback.setPaginationInfo(i),"block"==$($(".bo-control-container-contents")[0]).css("display")?$("#complexTab").css({display:"block"}):$("#complexTab").css({display:"none"});},o.prototype.getPaginationInfoByTableIndex=function(e){var i=this.dataInfo.tableList[e],o=this._tableMap[i]||{};return this._tableMap[i]&&this._tableMap[i].data&&(o.page=o.page||1,o.pageSize=o.pageSize||1*t.VA.SettingStorage.getValue("editor.datapanel.defaultrowcount"),o.totalCount=o.count,o.tableId=i),o;},o.prototype.updataPageInfo=function(t,e){var i=this._tableMap[t]||{};i.page=e.page,i.pageSize=e.pageSize,i.offset=(i.page-1)*e.pageSize;},o.prototype.bindEventHandlers=function(){var e=this,i=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);i&&(this.commandListener=function(i){!i.event.source.dataInfo||i.event.source.dataInfo.fid!==e.dataInfo.fid||i.event.source.dataInfo.panelType!==e.dataInfo.panelType||i.event.source instanceof t.VA.Core.Editors.Sheet.Controls.BigDataWorksheet||("REDO"==i.event.type?e.redo(i):"UNDO"==i.event.type?e.undo(i):"EXECUTE"==i.event.type&&e.execute(i));},i.addCommandListener(this.commandListener));},o.prototype.unbindEventHandlers=function(){var e=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);e&&this.commandListener&&(e.removeCommandListener(this.commandListener),this.commandListener=null);},o.prototype.redo=function(e){if(e instanceof t.VA.Core.CompoundCommand){if("brightics.va.editors.diagram.commands.addchartcommand"===e.getId())this.onNewChartCommand(e);else if("brightics.va.editors.diagram.commands.removechartcommand"===e.getId())this.onRemoveChartCommand(e);else for(var i in e.commandList){this.redo(e.commandList[i]);}}else e instanceof t.VA.Core.Editors.Diagram.Commands.NewChartCommand?this.onNewChartCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveChartCommand?this.onRemoveChartCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand?this.onSetDataWorksheetLayoutCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand?this.onSetContentsPanelCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand&&this._onChangeDataSourceCommand(e);},o.prototype.undo=function(e){if(e instanceof t.VA.Core.CompoundCommand){if("brightics.va.editors.diagram.commands.addchartcommand"===e.getId())this.onNewChartCommand(e);else if("brightics.va.editors.diagram.commands.removechartcommand"===e.getId())this.onRemoveChartCommand(e);else for(var i=e.commandList.length-1;i>=0;i--){this.undo(e.commandList[i]);}}else e instanceof t.VA.Core.Editors.Diagram.Commands.NewChartCommand?this.onNewChartCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveChartCommand?this.onRemoveChartCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand?this.onSetDataWorksheetLayoutCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand?this.onSetContentsPanelCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand&&this._onChangeDataSourceCommand(e);},o.prototype.execute=function(e){e instanceof t.VA.Core.CompoundCommand&&"brightics.va.editors.diagram.commands.addchartcommand"===e.getId()&&this.configureSheetLayout();},o.prototype.onNewChartCommand=function(t){"REDO"==t.event.type?(t.options.panelOption.chartOption.source=this._getPanelSource(t.options.panelOption),t.options.panelOption.dataSource=this._setPanelDataSource(),this.$mainControl.bchartsAdonis("addChartPanel",t.options.panelOption),this.configureSheetLayout()):this.$mainControl.bchartsAdonis("removeChartPanel",t.options.panelOption.id);},o.prototype.onRemoveChartCommand=function(t){"REDO"==t.event.type?this.$mainControl.bchartsAdonis("removeChartPanel",t.options.panelOption.id):(this.$mainControl.bchartsAdonis("addChartPanel",t.options.panelOption),this.configureSheetLayout());},o.prototype.onSetDataWorksheetLayoutCommand=function(t){this.$mainControl.bchartsAdonis("layout",t.options.layout);},o.prototype.configureSheetLayout=function(){},o.prototype.onSetContentsPanelCommand=function(t){this.chartOptions[t.options.panelOption.id]=t.options.panelOption.chartOption,this.$mainControl.bchartsAdonis("setChartOptions",t.options.panelOption.id,t.options.panelOption.chartOption);},o.prototype.createNewChartCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.NewChartCommand(this,{panel:this.options.worksheet.panel,panelOption:e});},o.prototype.createRemoveChartCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.RemoveChartCommand(this,{panel:this.options.worksheet.panel,panelOption:e});},o.prototype.createSetDataWorksheetLayoutCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand(this,{layout:this.options.worksheet.layout,newLayout:e});},o.prototype.executeCommand=function(e){t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl).getCommandManager().execute(e);},o.prototype._handleOpenMultiChart=function(e){var i=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl),o={user:t.VA.Env.Session.userId,pid:i.options.editorInput.getProjectId(),mid:this.dataInfo.mid,fid:this.dataInfo.fid,tid:this.dataInfo.tableList[this._getSelectedPanelTableIndex()],cid:e.getOptions().id,ch:i.getConnectionKey()},n=$.map(o,function(t,e){return e+"="+t;}).join("&");window.open("multichart?"+n,"multiChart");},o.prototype._handleAddToReport=function(e){var i=this,o=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(i.$mainControl),n=this.$mainControl.closest(".brtc-va-editors-sheet-panels-basepanel").find(".brtc-va-editors-sheet-panels-basepanel-header-title").text();if(o.getReportManager().addReportData({options:{id:e.getOptions().id,chartOption:$.extend(!0,{},e.getOptions().chartOption)},data:{mid:i.dataInfo.mid,fid:i.dataInfo.fid,table:i.dataInfo.tableList[e.options.tableIndexes||0]},title:{fnUnitLabel:i.dataInfo.fnUnitLabel,panelTitle:n}}).then(function(e){o.notifyReportDataAdded();var n=o.options.editorInput.getContents().getFnUnitById(i.dataInfo.fid);t.VA.Core.Utils.ModelUtils.carvePersist(n,!0),o.save();},function(t){o.notification("error",t);}),t.VA.Implementation.Visual){var r=o.options.editorInput.getProjectId(),a=Studio.getResourceManager().getProject(r).getLabel(),s=Studio.getResourceManager().getFilesByModelType(r,t.VA.Implementation.Visual.Clazz),l=o.options.editorInput.getLabel(),c=i.dataInfo.fnUnitLabel;if(s.length)new t.VA.Implementation.Visual.Dialogs.SelectVisualModelDialog(i.$mainControl,{projectId:r,projectLabel:a,visualModels:s,modelId:i.dataInfo.mid,tableId:i.dataInfo.tableList[e.options.tableIndexes||0],defaultDataSourceLabel:l+"-"+c+"-"+n,close:function close(o){if(o.OK){t.VA.Implementation.Visual.Utils.ModelUtils.addChartContentToSelectedVisualModel({resourceManager:Studio.getResourceManager(),dataSourceLabel:o.dataSourceLabel?o.dataSourceLabel:l+"-"+c+"-"+n,dataSourceTag:o.dataSourceTag?o.dataSourceTag:"",selectedModels:o.selectedModels,projectId:r,modelId:i.dataInfo.mid,tableId:i.dataInfo.tableList[e.options.tableIndexes||0],chartOptions:$.extend(!0,{},e.getOptions().chartOption),columns:$.extend(!0,[],t.VA.Core.DataQueryTemplate.getSchema(i.dataInfo.mid,i.dataInfo.tableList[e.options.tableIndexes||0])),changeLabel:o.changeLabel});var a=o.selectedModels;Studio.getInstance().setChartContentAddedReport(a);var s={type:"info",isCancel:!0,contentText:"Successfully Added To The Report.",okLabel:"Open Report",cancelLabel:"Close",close:function close(e){if(e.OK)for(var i in a){var o=a[i].getProjectId(),n=a[i].getFileId(),r=Studio.getResourceManager().getFile(o,n);r?Studio.getLayoutManager().openEditor(r):t.VA.Core.Utils.WidgetUtils.openErrorDialog("File not found.");}}};t.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(i.$mainControl,s);}},resizable:!0,title:"Select Reports to Add"});else{var d={type:"info",isCancel:!0,contentText:"No report in this project. Do you want to create a report?",okLabel:"Create Report",cancelLabel:"Close",close:function close(t){t.OK&&Studio.getInstance().projectViewer.openNewFileDialog(r,"Report");}};t.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(i.$mainControl,d);}}},o.prototype.destroy=function(){this.$mainControl&&(this._cleanTableMap(),this.unbindEventHandlers(),this.$mainControl.bchartsAdonis("destroy"));},o.prototype._cleanTableMap=function(){for(var t in this._tableMap){delete this._tableMap[t];}},o.prototype.setDataSet=function(t,e){this._tableMap[t].columns=e.columns,this._tableMap[t].data=e.data,this.$mainControl.bchartsAdonis("refreshChartPanel");},o.prototype._getDataSourceList=function(){for(var t=this.options.fnUnit,i=this.dataInfo.panelType,o=e.getTable(t,i),n=[],r=0;r<o.length;r++){n.push({value:o[r],label:this._getDataSourceLabel(r)});}return n;},o.prototype._getPanelSource=function(t){var e=t.tableIndexes||[0];return this._getSourceByTableIndexes(e);},o.prototype._getSourceByTableIndexes=function(t){for(var e={dataType:"lazy",lazyData:[]},i=0;i<t.length;i++){e.lazyData.push(this._getLazyData(t[i]));}return e;},o.prototype._getDataSourceLabel=function(t){var i=this.dataInfo.panelType,o=e.getTable(this.options.fnUnit,i),n=o[t],r=this.options.fnUnit.parent().getFnUnitByOutTable(n).display.label||"";return"out"===i&&o.length>1&&(r=r+"-"+(t+1)),r;},o.prototype._getTableSchema=function(e){if(this._tableMap[e]&&this._tableMap[e].columns)return this._tableMap[e].columns;var i=this.options.fnUnit.parent().mid;return t.VA.Core.DataQueryTemplate.getSchema(i,e);},o.prototype._setTableMapFromCache=function(e){if(this._tableMap[e]&&this._tableMap[e].data)return this._tableMap[e].data;var i=this.options.fnUnit.parent().mid;return t.VA.Core.DataQueryTemplate.getTable(i,e);},o.prototype._getTableMap=function(e){if(!this._tableMap[e]){var i=this.options.fnUnit.parent().mid;this._tableMap[e]=t.VA.Core.DataQueryTemplate.getTable(i,e);}return this._tableMap[e];},o.prototype._getLazyData=function(t){var o=this,n=this.options.fnUnit,r=this.dataInfo.panelType,a=e.getTable(n,r)[t];return a?{id:{value:a,label:this._getDataSourceLabel(t)},columns:function columns(){return o._getTableSchema(a);},data:function data(t){o._prepareCache=o._prepareCache||{};var e=t;o._prepareCache[e.chartInstanceId]&&(clearTimeout(o._prepareCache[e.chartInstanceId]),delete o._prepareCache[e.chartInstanceId]),o._prepareCache[e.chartInstanceId]=setTimeout(function(){if(o._getTableMap(a))try{e.done({dataType:"rawdata",columns:o._tableMap[a].columns,data:o._getData(a,t),count:o._tableMap[a].count,offset:o._tableMap[a].offset});}catch(t){i.error(t.stack,{category:"Chart"});}},300);}}:{id:{value:""},columns:function columns(){return[];},data:function data(t){setTimeout(function(){t.done({dataType:"rawdata",columns:[],data:[],count:0,offset:0});},100);}};},o.prototype._getData=function(e,i){var o,n=i.filters;n&&n.length>0?o=new t.Chart.Helper.SelectionFilterHelper(n).filter(this._tableMap[e].columns,this._tableMap[e].data):o=n&&0===n.length?[]:this._tableMap[e].data;return o;},o.prototype._setPanelDataSource=function(e){var i=this;return{selectable:!0,getDataSourceList:function getDataSourceList(){return i._getDataSourceList();},getDataSourceColumnList:function getDataSourceColumnList(t){return i._tableMap[t].columns;},onDataSourceChangedCallBack:function onDataSourceChangedCallBack(e,o){o.forEach(function(t){i._tableMap[t]=i._tableMap[t]||{};}),i._queryTables(function(){var n=i._getPanelByPanelId(e),r=new t.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand(i,{panel:n,ref:{panel:{tableIndexes:i._getTableIndexes(o)}}});i.executeCommand(r),i.$mainControl.bchartsAdonis("setDataSource",e,i._getPanelSource(n));var a=i._getSelectedPanelTableIndex(),s=i.getPaginationInfoByTableIndex(a);i.options.callback&&"function"==typeof i.options.callback.setPaginationInfo&&i.options.callback.setPaginationInfo(s);});}};},o.prototype._getSelectedPanelTableIndex=function(){var t=this._selectedPanelOptions,e=0;return t&&t.tableIndexes&&t.tableIndexes[0]&&(e=t.tableIndexes[0]),e;},o.prototype._getPanelByPanelId=function(t){for(var e,i=0;i<this.options.worksheet.panel.length;i++){if(this.options.worksheet.panel[i].id===t){e=this.options.worksheet.panel[i];break;}}return e;},o.prototype._getTableIndexes=function(t){var i=this.options.fnUnit,o=this.dataInfo.panelType,n=e.getTable(i,o),r=[];return t.forEach(function(t){r.push(n.indexOf(t));}),r;},o.prototype._onChangeDataSourceCommand=function(t){this.$mainControl.bchartsAdonis("setDataSource",t.options.panel.id,this._getSourceByTableIndexes(t.options.panel.tableIndexes));},o.prototype._getCallBackFunction=function(t){if(this.options.callback[t])return this.options.callback[t];},o.prototype._initDataWorkSheet=function(){this.options.worksheet.panel.length>0&&this.$mainControl.bchartsAdonis("selectChartPanel",this.options.worksheet.panel[0].id);},t.VA.Core.Editors.Sheet.Controls.DataWorksheet=o;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Editors.Sheet.Controls.ArrayInput=function(e,i){return t.VA.Core.Widget.Factory.arrayInputControl(e,i);};}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.PropertyControl;function i(t,i){e.call(this,t,i);}i.prototype=Object.create(e.prototype),i.prototype.setContents=function(e){for(var i=[],o=0;o<this.options.value.length;o++){i[o]={item:this.options.value[o]};}var n={localdata:i,datafields:[{name:"item",type:"string"}],datatype:"array"},r=new $.jqx.dataAdapter(n);this.$contentsControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-checklist" style="margin: 10px;"/>'),this.$contentsControl.jqxGrid({theme:t.VA.Env.Theme,source:r,editable:!0,width:"85%",height:"200px",rowsheight:25,columns:[{text:"select",editable:!0,columntype:"checkbox",width:"25%",align:"center"},{text:"item",editable:!1,datafield:"item",width:"75%",align:"center",cellsalign:"center"}]}),e.append(this.$contentsControl);},this.Brightics.VA.Core.Editors.Sheet.Controls.CheckListControl=i;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.initOptions(),this.retrieveParent(),this.createControls(),this.$mainControl.data(this);}e.prototype.initOptions=function(){this.options=$.extend(!0,{multiple:!0,rowCount:1,maxRowCount:3,expand:!1,draggable:!1,sort:"none",sortBy:"name",showOpener:"button",removable:!0,defaultType:"",openerPosition:"right",placeHolder:"",fromModal:!1,isOneType:!1},this.options),this.options.rowCount=this.options.multiple?this.options.rowCount:1,this.options.maxRowCount=this.options.multiple?this.options.maxRowCount:1,this.options.height=this.options.height?this.options.height:25,this.options.items=[],this.options.selectedItems=[],this.options.renderedItems={},this.options.changedItems={};},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-columnlist"/>'),this.$parent.append(this.$mainControl),this.createColumnSelectButtonControl(),this.createColumnListControl(),this.createColumnSelector();},e.prototype.createColumnSelectButtonControl=function(){var t=this;if(this.options.multiple){this.$columnSelectButtonWrapper=$('<div class="brtc-va-editors-sheet-controls-columnlist-selectbutton-wrapper" />'),this.$mainControl.append(this.$columnSelectButtonWrapper),this.$selectCounter=$('<div class="brtc-va-editors-sheet-controls-columnlist-selectcounter"><span class="columnlist-select-counter">0</span><span> columns selected</span></div>'),this.$columnSelectButtonWrapper.append(this.$selectCounter);var e=$('<div class="brtc-va-selectbutton-container"></div>');this.$columnSelectButtonWrapper.append(e),"none"!==this.options.showOpener&&(this.$selectButton=$('<button class="brtc-va-editors-sheet-controls-columnlist-selectbutton">Select</button>'),e.append(this.$selectButton),this.$selectButton.jqxButton({theme:"office",height:this.options.height}),this.$selectButton.on("click",function(){t.openColumnSelector(this);}));}},e.prototype.sortSelectedItems=function(){var t=this;"ascending"===t.options.sort&&this.options.selectedItems.sort(function(e,i){return e[t.options.sortBy]>i[t.options.sortBy]?1:e[t.options.sortBy]<i[t.options.sortBy]?-1:0;}),"descending"===t.options.sort&&this.options.selectedItems.sort(function(e,i){return e[t.options.sortBy]<i[t.options.sortBy]?1:e[t.options.sortBy]>i[t.options.sortBy]?-1:0;});},e.prototype.setMaxHeight=function(){if(void 0!==this.options.maxRowCount&&this.options.maxRowCount>0){var t=parseInt(this.options.maxRowCount)*parseInt(this.options.height);this.$columnList.css({"max-height":t});}},e.prototype.setSortable=function(){"none"===this.options.sort&&!0===this.options.draggable&&this.options.selectedItems.length>1&&this.options.selectedItems.length>=this.options.rowCount&&(this.options.expand||"none"===this.$expanderContainer.css("display"))&&(this.$columnList.sortable({axis:"y",containment:"parent",cursor:"move",items:"div",tolerance:"pointer",helper:function helper(t,e){var i=$(e).clone();return i.css("position","absolute"),i.get(0);}}),this.$columnList.sortable("enable"));},e.prototype.setEmptyUnitHeight=function(){var t=this.options.height*(0==this.options.maxRowCount?1:this.options.maxRowCount);this.$emptyUnit.css({height:t+"px"}),this.$emptyUnit.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-empty").css({"line-height":t+"px"});},e.prototype.createColumnListControl=function(){var e=this;this.options.placeHolder||(this.options.placeHolder=this.options.multiple?"+ Select Columns":"+ Select Column"),this.$columnContainerWrapper=$('<div class="brtc-va-editors-sheet-controls-columnlist-columncontainer-wrapper" />'),this.$columnListControl=$('<div class="brtc-va-editors-sheet-controls-columnlist-columncontainer" />'),this.$emptyUnit=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element">   <div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-empty">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.placeHolder)+"</div></div>"),this.setEmptyUnitHeight(),this.$emptyUnit.on("click",function(t){e.openColumnSelector(this);}),this.$columnListControl.append(this.$emptyUnit),this.$columnList=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-sortable" style="position: relative;"/>'),this.$columnListControl.append(this.$columnList),this.$columnContainerWrapper.append(this.$columnListControl),this.$columnList.sortable({axis:"y",containment:"parent",cursor:"move",items:"div",tolerance:"pointer",helper:function helper(t,e){var i=$(e).clone();return i.css("position","absolute"),i.get(0);}}),this.$columnList.sortable("disable"),this.$columnList.on("sortstop",function(t,i){e.options.selectedItems=e.$columnList.sortable("toArray",{attribute:"value"}),e.options.changed("sortchange",{items:e.options.selectedItems});}),this.$columnList.on("mousewheel",function(t){t.stopPropagation();}),this.$expanderContainer=$('<div class="brtc-va-editors-sheet-controls-columnselector-expandercontainer" />');var i=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander" />'),o=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-left" />'),n=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-center" />'),r=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-right" />');i.append(o).append(n).append(r),this.$expandUp=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-up" />'),this.$expandUp.append('<i class="fa fa-angle-double-up"></i>'),this.$expandDown=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-down" />'),this.$expandDown.append('<i class="fa fa-angle-double-down"></i>'),n.append(this.$expandUp).append(this.$expandDown),this.$remainNumber=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-expander-remain" />'),r.append(this.$remainNumber),this.$expandUp.hide(),this.$expandDown.show(),i.click(function(t){"block"===e.$expandUp.css("display")?(e.options.expand=!1,e.$expandUp.hide(),e.$expandDown.show(),e.$columnList.sortable("disable")):"block"===e.$expandDown.css("display")&&(e.options.expand=!0,e.$expandUp.show(),e.$expandDown.hide()),e.renderColumnContainer();}),this.$expanderContainer.append(i),this.$expanderContainer.hide(),this.$columnContainerWrapper.append(this.$expanderContainer),this.$mainControl.append(this.$columnContainerWrapper);},e.prototype.renderColumnContainer=function(){var t=this,e=this.options.selectedItems,i=this.options.renderedItems;if(t.$columnList.find('div[empty="true"]').remove(),e.length>0?this.$emptyUnit.hide():this.$emptyUnit.show(),this.setEmptyUnitHeight(),this.sortSelectedItems(),$.each(e,function(e,o){i[o]||(i[o]=t.createColumnUnit(o),t.$columnList.append(i[o]));}),this.options.selectedItems.length>0)for(var o=this.options.selectedItems.length;o<this.options.maxRowCount;o++){var n=this.$emptyUnit.clone();n.css({height:this.options.height}).on("click",function(e){t.openColumnSelector(this);}),t.$columnList.append(n.attr("empty","true").text("").show());}this.options.multiple&&this.$selectCounter.find(".columnlist-select-counter").text(this.options.selectedItems.length),this.setMaxHeight(),this.setSortable();},e.prototype.addColumnUnitAll=function(){this.renderColumnContainerAll(),this.fillBackground();},e.prototype.renderColumnContainerAll=function(){var t=this,e=this.options.items,i=this.options.renderedItems;if(t.$columnList.find('div[empty="true"]').remove(),e.length>0?this.$emptyUnit.hide():this.$emptyUnit.show(),this.setEmptyUnitHeight(),$.each(e,function(e,o){void 0===i[o.name]&&(i[o.name]=t.createColumnUnit(o.name),t.$columnList.append(i[o.name]));}),this.options.selectedItems.length>0)for(var o=this.options.selectedItems.length;o<this.options.maxRowCount;o++){var n=this.$emptyUnit.clone();n.css({height:this.options.height}).on("click",function(e){t.openColumnSelector(this);}),t.$columnList.append(n.attr("empty","true").text("").show());}this.$selectCounter.find(".columnlist-select-counter").text(this.options.selectedItems.length),this.setMaxHeight(),this.setSortable();},e.prototype.createColumnSelector=function(){var e=this;this.columnSelector=new t.VA.Core.Editors.Sheet.Controls.ColumnSelector(this.$mainControl,{columnList:this,multiple:e.options.multiple,fromModal:e.options.fromModal,changed:function changed(t,i){if("selectAll"===t)if(i.length!=e.options.items.length||e.options.isOneType)for(var o in i){if(e.isSameType(i[o]))return;$.inArray(i[o].name,e.options.selectedItems)<0&&(e.options.changedItems[i[o].name]="select"),e.addColumnUnit(i[o].name),e.options.multiple&&e.options.added({added:[i.name],removed:[],items:e.options.selectedItems});}else{var n=[];for(var o in e.options.items){if(e.isSameType(e.options.items[o]))return;e.options.changedItems[e.options.items[o].name]="select",n.push(e.options.items[o].name);}e.options.selectedItems=n,e.options.renderedItems={},e.$columnList.empty(),e.addColumnUnitAll();}if("unselectAll"===t)if(i.length==e.options.items.length){e.options.selectedItems=[],e.options.renderedItems={},e.$columnList.empty();n=[];for(var o in e.options.items){e.options.changedItems[e.options.items[o].name]="unselect",n.push(e.options.items[o].name);}e.renderColumnContainer(!0),e.fillBackground(),e.options.removed({added:[],removed:n,items:[]});}else for(var o in i){$.inArray(i[o].name,e.options.selectedItems)>-1&&(e.options.changedItems[i[o].name]="unselect"),e.removeColumnUnit(i[o].name),e.options.multiple&&e.options.removed({added:[],removed:[i[o].name],items:e.options.selectedItems});}if("select"===t){if(e.isSameType(i))return;$.inArray(i.name,e.options.selectedItems)<0&&(e.options.changedItems[i.name]="select"),e.addColumnUnit(i.name),e.options.multiple&&e.options.added({added:[i.name],removed:[],items:e.options.selectedItems});}"unselect"===t&&($.inArray(i.name,e.options.selectedItems)>-1&&(e.options.changedItems[i.name]="unselect"),e.removeColumnUnit(i.name),e.options.multiple&&e.options.removed({added:[],removed:[i.name],items:e.options.selectedItems}));if("close"===t){var r=[],a=[];for(var s in e.options.changedItems){"select"===e.options.changedItems[s]?r.push(s):a.push(s);}(r.length>0||a.length>0)&&e.options.changed("change",{added:r,removed:a,items:e.options.selectedItems}),e.options.changedItems={},e.showColumnSelector=!1,e.$mainControl.removeClass("brtc-va-editors-sheet-controls-columnselector-hover"),e.$mainControl.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove").css({"background-color":"white"});}}});},e.prototype.createTypeLabel=function(t){var e="";return $.each(this.options.items,function(i,o){if(o.name===t)return e=o.type,!1;}),e;},e.prototype.getInternalType=function(t){for(var e in this.options.items){if(this.options.items[e].name===t)return this.options.items[e].internalType?this.options.items[e].internalType:this.options.items[e].type;}},e.prototype.createColumnUnit=function(e){var i=this,o=this.createTypeLabel(e),n=this.getInternalType(e),r=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element brtc-style-relative" />');return r.css({height:this.options.height}),this.$type=$('<span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-type" internal-type="'+n+'" data-type="'+(o||void 0)+'" >'+o+"</span>"),this.$type.text(t.VA.Core.Utils.CommonUtils.convertDataTypeForText(o,n)),this.$type.attr("title",t.VA.Core.Utils.CommonUtils.convertDataTypeForTitle(o,n)),this.$name=$('<span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-name" >'+e+"</span>").text(e),this.$remove=$('<span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove"></span>'),r.append(this.$type).append(this.$name).append(this.$remove),r.attr("value",e),r.attr("title",e),r.mouseover(function(t){i.options.removable&&$(this).find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove").css({display:"block"}),i.options.multiple&&r.attr("value")&&r.addClass("brtc-va-editors-sheet-controls-columnselector-columncontainer-element-hover");}),r.mouseout(function(t){$(this).find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove").css({display:"none"}),r.removeClass("brtc-va-editors-sheet-controls-columnselector-columncontainer-element-hover");}),r.on("click",function(t){i.openColumnSelector(this);}),this.$remove.click(function(t){for(var e=$(this).closest(".brtc-va-editors-sheet-controls-columnlist-columncontainer").find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove"),o=void 0,n=0;n<e.length;n++){if(this==e[n]){n,e[n+1]&&(o=$(e[n+1]));break;}}var r=$(this).prevAll(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-name").text();i.removeColumnUnit(r),i.options.changed("removed",{added:[],removed:[r],items:i.options.selectedItems}),i.options.removed({added:[],removed:[r],items:i.options.selectedItems}),i.options.removed({added:[],removed:[r],items:i.options.selectedItems}),o&&o.mouseover();}),r;},e.prototype.checkWidth=function(e){var i=e.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-name").text(),o={isTextOverflown:!1,width:0},n=$("<div>"+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i)+"</div>").css("display","table").css("z-index","-1").css("position","absolute").css("font-family",e.css("font-family")).css("font-size",e.css("font-size")).css("font-weight",e.css("font-weight")).appendTo("body");return o.isTextOverflown=n.width()>e.width(),o.width=n.width(),n.remove(),o;},e.prototype.addColumnUnit=function(t){for(var e in!1===this.options.multiple&&(this.options.selectedItems=[],this.options.renderedItems={},this.$columnList.empty()),this.options.selectedItems){if(this.options.selectedItems[e]===t)return;}this.options.selectedItems.push(t),this.renderColumnContainer(),this.fillBackground();},e.prototype.removeColumnUnit=function(t){for(var e in this.options.selectedItems){if(this.options.selectedItems[e]===t){this.options.selectedItems.splice(e,1);break;}}this.options.renderedItems[t]&&(this.options.renderedItems[t].remove(),delete this.options.renderedItems[t]),this.renderColumnContainer(),this.fillBackground();},e.prototype.setSelectedItems=function(t){if(t){this.options.selectedItems=[],this.options.renderedItems={};var e=$.extend(!0,[],$.grep(t,function(t){return t;}));this.options.multiple?this.options.selectedItems=e:e.length>0&&(this.options.selectedItems=[e[0]]),this.$columnList.empty(),this.renderColumnContainer();}},e.prototype.getSelectedItems=function(){return this.options.selectedItems.length>0?$.extend(!0,[],this.options.selectedItems):[];},e.prototype.getSelectedItemsWithType=function(){var t=[];for(var e in this.options.selectedItems){for(var i in this.options.items){this.options.selectedItems[e]===this.options.items[i].name&&t.push(this.options.items[i]);}}return t;},e.prototype.clearList=function(){this.$columnListControl.empty();},e.prototype.setItems=function(t){this._isDestroyed()||(t=t||[],this.options.items=t,this.columnSelector.setSource(t));},e.prototype._isDestroyed=function(){return!this.$mainControl.closest("body").length;},e.prototype.onChange=function(t){this.options.changed=t;},e.prototype.closeSelector=function(){this.columnSelector.close();},e.prototype.openColumnSelector=function(t){"none"!==this.options.showOpener&&(this.columnSelector.open(t,this.options.selectedItems),this.showColumnSelector=!0,this.fillBackground());},e.prototype.fillBackground=function(){var t=this.$mainControl.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-remove");this.showColumnSelector?(this.$mainControl.addClass("brtc-va-editors-sheet-controls-columnselector-hover"),t.css({"background-color":"#D3F0E0"})):(this.$mainControl.removeClass("brtc-va-editors-sheet-controls-columnselector-hover"),t.css({"background-color":"white"}));},e.prototype.isSameType=function(e){if(this.options.isOneType)if(1===this.options.rowCount){if(this.options.selectedItems.length>0)return t.VA.Core.Utils.WidgetUtils.openWarningDialog("You can only select one column."),this.columnSelector.close(),!0;}else{var i=[];if(this.options.selectedItems.length>0){for(var o in this.options.selectedItems){for(var n in this.options.items){if(this.options.selectedItems[o]===this.options.items[n].name){-1==$.inArray(this.options.items[n].type,i)&&i.push(this.options.items[n].type);break;}}}}else i.push(e.type);if(i.length>0&&-1==$.inArray(e.type,i))return t.VA.Core.Utils.WidgetUtils.openWarningDialog("You can only select columns of the same type."),this.columnSelector.close(),!0;}return!1;},t.VA.Core.Editors.Sheet.Controls.ColumnList=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils;function i(t,e){this.parentId=t,this.options=e,this.initOptions(),this.retrieveParent(),this.createControl();}i.prototype.initOptions=function(){this.options=$.extend(!0,{source:[],width:300,height:320,resizable:!0,multiple:!1,fromModal:!1},this.options);},i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createControl=function(){var e=this;this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-columnselector-editarea">   <div class="brtc-va-editors-sheet-controls-columnselector-header" />   <div class="brtc-va-editors-sheet-controls-columnselector-content brtc-style-full brtc-style-display-flex brtc-style-flex-direction-column" /></div>');var i=this.$mainControl.find(".brtc-va-editors-sheet-controls-columnselector-content");this.createFilter(i),this.options.multiple&&this.createSelectButton(i),this.createColumnContainer(i);var o={theme:t.VA.Env.Theme,width:this.options.width||300,height:this.options.height,resizable:!0,title:this.options.multiple?"Select Columns":"Select Column",autoOpen:!1,modal:!1,showAnimationDuration:50,minHeight:285,minWidth:307,resize:function resize(){e._updateViewPort(),e._renderItems(),e._updatePerfectScroll();},close:function close(){$(window).off("mousedown",e.closeHandler),e.options.changed("close");},destroy:function destroy(){e.$mainControl.dialog("destroy");}};this.options.multiple||(o.height-=33),this.$mainControl.dialog(o),this.$mainControl.attr("name",o.title),this.$mainControl.parent().find(".ui-dialog-titlebar.ui-widget-header").css({"border-bottom":"none !important;"}),this.$mainControl.parent().find("button.ui-dialog-titlebar-close").attr("style","right: -38px !important;"),this.closeHandler=function(t){0===e.$mainControl.closest(".ui-dialog").has(t.target).length&&e.$mainControl.dialog("close");};},i.prototype.createFilter=function(e){var i=this,o=$('<div class="brtc-va-editors-sheet-controls-columnselector-filter-container"></div>');e.append(o),this.$filterControl=$('<input type="search" placeholder="Search Column" />'),o.append(this.$filterControl),this.$filterControl.jqxInput({theme:t.VA.Env.Theme,placeHolder:"Search Column",height:31,minLength:1}),this.$filterControl.on("keyup search",function(t){clearTimeout(i._searchHandler),i._searchHandler=setTimeout(function(){var e=t.target.value;i._searchFilteredItem(e);},100);});},i.prototype._updatePerfectScroll=function(){this.$mainControl.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper").perfectScrollbar("update");},i.prototype._searchFilteredItem=function(t){for(var e in this._filteredItems=[],this._itemMap){-1!==e.toLowerCase().indexOf(t.toLowerCase())?(this._getItemControl(e).show(),this._filteredItems.push(e)):this._getItemControl(e).hide();}this.setAllCheckBoxCondition(),this._setBackground(),this._renderItems(),this._updatePerfectScroll();},i.prototype._resetFilter=function(){this.$filterControl.val(""),this._searchFilteredItem("");},i.prototype.setAllCheckBoxCondition=function(){if(this.options.multiple){for(var t,e=!0,i=0;i<this._filteredItems.length;i++){if(t=this._filteredItems[i],0===this._getItemControl(t).find(".checked").length){e=!1;break;}}e?this.$selectButton.jqxCheckBox("checked",!0):this.$selectButton.jqxCheckBox("checked",!1);}},i.prototype.createSelectButton=function(t){var e=this,i=$('<div class="brtc-column-check-box-wrapper"></div>');t.append(i),this.$selectButton=$('<div id="brtc-column-check-box"><span>Select All</span></div>'),i.append(this.$selectButton),this.$selectButton.jqxCheckBox({theme:"office",width:120,height:25,checked:!1,boxSize:"17px",animationShowDelay:10,animationHideDelay:10}),this.$selectButton.on("click",function(t,i){i?$(this).val(!$(this).val()):$(this).val()?e._selectAllItem():e._unSelectAllItem();});},i.prototype.createColumnContainer=function(t){var e=this,i=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper brtc-style-flex-1"></div>');t.append(i),this.$columnContainer=$('<div class ="brtc-va-editors-sheet-controls-columnselector-columncontainer-list"></div>'),i.append(this.$columnContainer),i.perfectScrollbar({suppressScrollX:!0}),i.on("ps-scroll-y",function(){e._renderItems();});},i.prototype.createTypeLabel=function(t){return t?t.substring(0,1).toUpperCase():this.options.defaultType;},i.prototype.getSelectedItems=function(){return Object.keys(this._selectedItemMap);},i.prototype._getItem=function(t){return this._itemMap[t].source;},i.prototype._getItemControl=function(t){if(this._itemMap[t]&&this._itemMap[t].control)return this._itemMap[t].control;},i.prototype._selectAllItem=function(){for(var t,e=[],i=0;i<this._filteredItems.length;i++){t=this._filteredItems[i],this._checkItemButton(t),this._selectedItemMap[t]=!0,e.push(this._getItem(t));}this.options.changed("selectAll",e);},i.prototype._unSelectAllItem=function(){for(var t,e=[],i=0;i<this._filteredItems.length;i++){t=this._filteredItems[i],this._unCheckItemButton(t),delete this._selectedItemMap[t],e.push(this._getItem(t));}this.options.changed("unselectAll",e);},i.prototype._addSelectedItem=function(t){this.options.multiple||(this._selectedItemMap={}),this._checkItemButton(t),this._selectedItemMap[t]=!0,this.options.changed("select",this._getItem(t));},i.prototype._deleteSelectedItem=function(t){this._unCheckItemButton(t),delete this._selectedItemMap[t],this.options.changed("unselect",this._getItem(t));},i.prototype._checkItemButton=function(t){this._getItemControl(t).find(".brtc-va-editors-sheet-controls-columnselector-button").addClass("checked");},i.prototype._unCheckItemButton=function(t){this._getItemControl(t).find(".checked").removeClass("checked");},i.prototype.setSource=function(t){for(var e in this.options.source=t,this._selectedItemMap={},this._itemMap={},this.options.source){var i=this.options.source[e].internalType?this.options.source[e].internalType:this.options.source[e].type;this.options.source[e].combineType=i+"?"+this.options.source[e].type;}this._createItems(this.options.source),this._filteredItems=Object.keys(this._itemMap),this._setBackground();},i.prototype._setBackground=function(){this._display={virtualHeight:30*this._filteredItems.length,viewPortHeight:this.$mainControl.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper").height(),viewPortScrollTop:this.$mainControl.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper").scrollTop()},this.$columnContainer.height(this._display.virtualHeight);},i.prototype._updateViewPort=function(){this._display.viewPortHeight=this.$mainControl.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper").height(),this._display.viewPortScrollTop=this.$mainControl.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-wrapper").scrollTop();},i.prototype._renderItems=function(){this._updateViewPort(),this.$columnContainer.empty();for(var t=Math.ceil(this._display.viewPortScrollTop/30)-1,e=t+Math.ceil(this._display.viewPortHeight/30)+2,i=t;i<e;i++){if(this._filteredItems[i]){var o=this._filteredItems[i],n=this._getItemControl(o);n.css("top",30*i+"px"),n.css("display","flex"),this.$columnContainer.append(n),this._createItemClickEvent(n);}}},i.prototype._createItems=function(i){for(var o,n=!0===this.options.multiple?"checkbox":"radio",r=0;r<i.length;r++){var a=(o=i[r]).combineType.split("?"),s=a[0],l=a[1],c=t.VA.Core.Utils.CommonUtils.convertDataTypeForText(l,s),d=t.VA.Core.Utils.CommonUtils.convertDataTypeForTitle(l,s),p=this.createTypeLabel(l),u=$('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-list-wrapper" name="'+o.name+'">');u.append('<div class="brtc-va-editors-sheet-controls-columnselector-button brtc-style-button" button-type="'+n+'"></div>'),u.append('<div class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element" title="'+e.WidgetUtils.convertHTMLSpecialChar(o.name)+'">   <span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-type" title="'+d+'" internal-type="'+s.toLowerCase()+'" data-type="'+e.WidgetUtils.convertHTMLSpecialChar(p)+'">'+c+'</span>   <span class="brtc-va-editors-sheet-controls-columnselector-columncontainer-element-name" name="'+o.name+'">'+e.WidgetUtils.convertHTMLSpecialChar(o.name)+"</span></div>"),this._itemMap[o.name]={control:u,source:o};}},i.prototype._createItemClickEvent=function(t){var e=this;t.click(function(){if(e.options.multiple){if(t.find(".brtc-style-button").hasClass("checked")){o=t.attr("name");e._unCheckItemButton(o),e._deleteSelectedItem(o);}else{o=t.attr("name");e._checkItemButton(o),e._addSelectedItem(o);}e.setAllCheckBoxCondition();}else{for(var i in e._selectedItemMap){e._getItemControl(i).find(".brtc-style-button.checked").removeClass("checked");}var o=t.attr("name");e._checkItemButton(o),e._addSelectedItem(o);}});},i.prototype.setSelectedItems=function(t){var e,i;for(var o in this._selectedItemMap){(e=this._getItemControl(o))&&(i=e.find(".brtc-va-editors-sheet-controls-columnselector-button")).hasClass("checked")&&i.removeClass("checked");}for(var n in this._selectedItemMap={},t){(e=this._getItemControl(t[n]))&&((i=e.find(".brtc-va-editors-sheet-controls-columnselector-button")).hasClass("checked")||i.addClass("checked"),this._selectedItemMap[t[n]]=!0);}},i.prototype.open=function(t,e){var i=this;this._resetFilter(),this.setSelectedItems(e),this.setAllCheckBoxCondition(),this.$mainControl.dialog({position:{my:"left top",at:"right+5 top",of:t}}),this.$mainControl.parent().find(".ui-dialog-titlebar.ui-widget-header").attr("style","border: none !important; margin-left: 11px !important"),this.$mainControl.dialog("open"),$(window).on("mousedown",this.closeHandler),this.$parent.closest(".ps-container").on("scroll",function(t){i.closeHandler(t);}),this._updateViewPort(),this._renderItems(),this._updatePerfectScroll();},i.prototype.close=function(t){this.$mainControl.dialog("close");},t.VA.Core.Editors.Sheet.Controls.ColumnSelector=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.PropertyControl;function i(t,i){e.call(this,t,i);}i.prototype=Object.create(e.prototype),i.prototype.setContents=function(e){this.$contentsControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox" style="margin: 10px;"/>'),this.$contentsControl.jqxComboBox({theme:t.VA.Env.Theme,source:this.options.value,selectedIndex:0,height:25,width:"85%"}),this.options.value.length<7&&this.$contentsControl.jqxComboBox({dropDownHeight:25*this.options.value.length}),e.append(this.$contentsControl);},this.Brightics.VA.Core.Editors.Sheet.Controls.ComboControl=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-controls-datatree"></div>'),this.$treeWrapper=$('<div class="brtc-va-controls-datatree-wrapper"><ul></ul></div>'),this.$parent.append(this.$mainControl),this.$mainControl.append(this.$treeWrapper),this.$mainControl.css({width:"200px",height:"100%",border:"1px solid grey",float:"left","background-color":"white"}),this.createTree();},e.prototype.createTree=function(){var e=this,i=this.$treeWrapper.find("ul");_.forEach(this.options.source,function(t,o){e.createTreeElement(i,o,t);}),this.$treeWrapper.jqxTree({height:"100%",width:"100%",theme:t.VA.Env.Theme,allowDrag:!1}),this.addTypeIcon(),e.options.draggable&&e.createDragEvent();},e.prototype.createTreeElement=function(t,e,i){var o=this,n=$("<li></li>");t.append(n),n.attr("item-expanded","true"),n.text(e),_.forEach(i,function(t,e){var i=$('<li class="brtc-va-controls-datatree-li-table"></li>');i.text(t.key),i.attr("key",t.key),i.attr("table-id",e),i.attr("type",t.type),n.append("<ul></ul>"),n.find("ul").append(i),o.createClickEvent(i);});},e.prototype.addTypeIcon=function(){for(var t=this.$treeWrapper.find(".brtc-va-controls-datatree-li-table"),e=0;e<t.length;e++){var i=$('<div class="brtc-va-controls-datatree-type-icon"></div>'),o=$(t[e]).attr("type").substring(0,1).toUpperCase();i.text(o),$(t[e]).prepend(i);}},e.prototype.createClickEvent=function(t){var e=this;t.click(function(){if("function"==typeof e.options.onClick){var t=$(this).attr("key"),i=$(this).attr("table-id");e.options.onClick({key:t,tableId:i});}});},e.prototype.createDragEvent=function(){var t=this,e=this.$treeWrapper.find(".brtc-va-controls-datatree-li-table div");_.forEach(e,function(e){$(e).draggable({helper:"clone",appendTo:t.options.dragTarget,start:function start(t,e){var i=$(t.target).closest(".brtc-va-controls-datatree-li-table").attr("table-id");e.helper.attr("table-id",i);}});});},e.prototype.getSource=function(){return this.options.source;},t.VA.Core.Editors.Sheet.Controls.DataList=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");function i(i,o){this.parentId=i,this.options=o,this.inTargetList=$.extend(!0,[],e.getInTable(this.options.fnUnit)),this.linkedTargetList=this.getAllTableList(this.options.fnUnit),this.command=new t.VA.Core.CompoundCommand(this,{}),this.retrieveParent(),this.createControls(),this.initContents();}i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createInputUnit=function(t){var i=t.key,o=t.tableId,n=t.type,r=t.fnUnit,a=this.getPrevFnUnitByInTableId(r,o),s=t.readOnly,l=this.createBox(i);l.attr("key",i),l.attr("type",n),l.attr("table-id",o);var c=l.find(".brtc-style-controls-inputselector-box-contents"),d=c.find(".brtc-style-controls-inputselector-box-contents-figure"),p=c.find(".brtc-style-controls-inputselector-box-contents-remove"),u=c.find(".brtc-style-controls-inputselector-box-key");t.appendTo.find(".brtc-va-editors-sheet-controls-input-list-container").append(l),c.append(h);var h=this.createEmptyItem({parent:d,type:n,label:t.emptyLabel,readOnly:s}),f=this.createFuncItem({label:e.getLabel(a),func:e.getFunc(a),type:e.getTypeByTableId(a,o),tableId:o}),m=e.getOutputsToObject(a),g=this.createKeyItem({key:m[o],type:n}),v=this.createRemoveButton();d.append(f),u.append(g),s||p.append(v),s||this.createDropEvent(l),o?(h.hide(),f.show(),g.show(),v.show()):(h.show(),f.hide(),g.hide(),v.hide());},i.prototype.createSingleTypeItem=function(i){var o=i.parent().type,n=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single"></div>'),r=t.VA.Core.Utils.WidgetUtils.createPaletteItem(n,i.func,o),a=e.getOutTable(i)[0];a&&(r.find(".brtc-va-views-palette-fnunit-label").text(i.display.label),r.find(".brtc-va-views-palette-fnunit-label").attr("title",i.display.label),n.attr("value",a),n.attr("fid",i.fid),r.addClass("item"),this.inTargetList.indexOf(a)>=0?(this.usedDataMap=this.usedDataMap||{},this.usedDataMap[a]=$.extend(!0,{},n)):(this.notUsedDataMap=this.notUsedDataMap||{},this.notUsedDataMap[a]=$.extend(!0,{},n)));},i.prototype.createMultiTypeItem=function(i,o){for(var n in e.getOutTable(i)){var r=i.parent().type,a=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single"></div>'),s=i.display.label+"-"+(parseInt(n)+1),l=t.VA.Core.Utils.WidgetUtils.createPaletteItem(a,i.func,r);l.find(".brtc-va-views-palette-fnunit-label").text(s),l.attr("title",s),a.attr("value",e.getOutTable(i)[n]),a.attr("fid",i.fid),l.addClass("item"),o.indexOf(e.getOutTable(i)[n])<0?(this.notUsedDataMap=this.notUsedDataMap||{},this.notUsedDataMap[e.getOutTable(i)[n]]=$.extend(!0,{},a)):(this.usedDataMap=this.usedDataMap||{},this.usedDataMap[e.getOutTable(i)[n]]=$.extend(!0,{},a));}},i.prototype.insertUsedDataContainer=function(){for(var t=0;t<this.inTargetList.length;t++){this.appendUsedDataItem(this.usedDataMap[this.inTargetList[t]]);}},i.prototype.appendUsedDataItem=function(t,e){var i=this,o=$('<div class="brtc-style-flex-center" style="padding-left: 10px"></div>'),n=$('<span class="brtc-style-editor-content-remove-button"></span>');o.append(t),o.append(n),void 0===e?this.$selectedContents.append(o):$(this.$selectedContents.children()[e]).after(o),this.createDropEvent(t),n.click(function(){var e=t.detach();i.appendNotUsedDataItem(e),o.remove(),i.setAddableDataContainer(),i.configureRowHeader(),i.onChangeInputTable();});},i.prototype.insertNotUsedDataContainer=function(){for(var t in this.notUsedDataMap){this.appendNotUsedDataItem(this.notUsedDataMap[t]);}},i.prototype.appendNotUsedDataItem=function(t){this.$notUsedDataContainer=this.$notUsedDataContainer||this.getNotUsedDataContainer(),this.$notUsedDataContainer.append(t),this.createNotUsedDataDragEvent(t),t.hasClass("ui-droppable")&&t.droppable("destroy");},i.prototype.createNotUsedDataDragEvent=function(t){t.draggable({helper:"clone",appendTo:this.$dataContainer});},i.prototype.destroyDragEvent=function(t){t.on("dragstop",function(e,i){t.hasClass("ui-draggable")&&i.helper.attr("value")!==e.target.getAttribute("value")&&t.draggable("destroy");});},i.prototype.getDropFuncTarget=function(t){return 1==t.find(".brtc-va-views-palette-fnunit").length?t.find(".brtc-va-views-palette-fnunit"):t;},i.prototype.createDropEvent=function(t){var e=this;t.droppable({accept:".brtc-va-editors-sheet-controls-notused-dataselector-contents-wrapper .brtc-va-editors-sheet-controls-dataselector-item, ",activate:function activate(t,i){console.log(t,i),e.getDropFuncTarget($(this)).addClass("brtc-style-droppable-active");},deactivate:function deactivate(t,i){console.log(t,i);var o=e.getDropFuncTarget($(this));o.removeClass("brtc-style-droppable-active"),o.removeClass("brtc-style-droppable-hover");},over:function over(t,i){console.log(t,i),e.getDropFuncTarget($(this)).addClass("brtc-style-droppable-hover");},out:function out(t,i){console.log(t,i),e.getDropFuncTarget($(this)).removeClass("brtc-style-droppable-hover");},drop:function drop(t,i){var o=e.getDropFuncTarget($(this));o.removeClass("brtc-style-droppable-active"),o.removeClass("brtc-style-droppable-hover");var n=$(this).attr("value"),r=i.draggable;n?e.switchData(r,$(this)):(e.appendUsedDataItem(r),r.closest(".brtc-va-editors-sheet-controls-notused-dataselector-contents-wrapper").remove(),e.setAddableDataContainer(),e.configureRowHeader()),e.destroyDragEvent(r),e.onChangeInputTable(),e.$selectedContents.find(".brtc-style-droppable-active").removeClass("brtc-style-droppable-active");}});},i.prototype.switchData=function(t,e){var i=e.parent().index();this.appendUsedDataItem(t,i),this.appendNotUsedDataItem(e),$(this.$selectedContents.children()[i]).remove();},i.prototype.getNotUsedDataContainer=function(){var t=$('<div class="brtc-va-editors-sheet-controls-notused-dataselector-contents brtc-style-controls-notused-dataselector-contents brtc-style-display-flex brtc-style-flex-direction-column">   <div>Connected Table</div></div>'),e=$('<div class="brtc-va-editors-sheet-controls-notused-dataselector-contents-wrapper brtc-style-full brtc-style-relative"></div>');return this.$dataContainer.append(t),t.append(e),e;},i.prototype.createRowHeaderContents=function(){var t=this.$dataContainer.find(".brtc-va-editors-sheet-controls-dataselector-contents-wrapper"),e=[];if("number"===this.options.rowHeaderType?$.each(this.getUsedDataList(),function(t,i){e.push(t+1);}):"custom"===this.options.rowHeaderType&&(e=this.options.rowHeaderList),0!==e.length){var i=this.options.rowHeaderWidth||20;this.$rowHeaderContentsArea=$('<div class="brtc-style-dataselecter-rowheader-container"></div>'),t.prepend(this.$rowHeaderContentsArea),this.$rowHeaderContentsArea.width(i);for(var o=0;o<e.length;o++){this.$rowHeaderContentsArea.append($('<div class="brtc-style-height-45px brtc-style-flex-center">'+e[o]+"</div>"));}}},i.prototype.configureRowHeader=function(){this.$rowHeaderContentsArea&&this.$rowHeaderContentsArea.remove(),this.createRowHeaderContents();},i.prototype.createContents=function(t){this.options.fnUnit.parent().type;var i=this.linkedTargetList,o=e.getInTable(this.options.fnUnit);this.$selectedContentsContainer=$('<div class="brtc-style-col-12" />'),this.$selectedContents=$('<div class="brtc-style-col-12" />'),t.append(this.$selectedContentsContainer),this.$selectedContentsContainer.append(this.$selectedContents);var n=this.getAllPrevFnUnits(this.options.fnUnit);for(var r in i){var a=_.find(n,function(t){return _.indexOf(e.getOutTable(t),i[r])>=0;});a&&e.getOutTable(a).length>1?this.createMultiTypeItem(a,o):a&&this.createSingleTypeItem(a);}this.insertUsedDataContainer(),this.notUsedDataMap&&this.insertNotUsedDataContainer(),this.setAddableDataContainer();},i.prototype.createDataContainer=function(t){var e=this;this.$dataContainer=$('<div class="brtc-va-editors-sheet-controls-dataselector-container brtc-style-editors-sheet-controls-dataselector-container">   <div class="brtc-va-editors-sheet-controls-dataselector-contents brtc-style-display-flex brtc-style-flex-1 brtc-style-flex-direction-column">       <div>Selected Table</div>       <div class="brtc-va-editors-sheet-controls-dataselector-contents-wrapper brtc-style-full brtc-style-display-flex brtc-style-relative"></div>   </div></div>'),t.append(this.$dataContainer),this.createContents(this.$dataContainer.find(".brtc-va-editors-sheet-controls-dataselector-contents-wrapper")),this.$selectedContents.sortable({axis:"y",cancel:".empty"}),this.$selectedContents.on("sortstop",function(){e.inTargetList=e.$selectedContents.sortable("toArray",{attribute:"value"}),e.onChangeInputTable();}),this.createRowHeaderContents(),this.$dataContainer.find(".brtc-va-editors-sheet-controls-dataselector-contents-wrapper").perfectScrollbar(),this.$dataContainer.find(".brtc-va-editors-sheet-controls-notused-dataselector-contents-wrapper").perfectScrollbar();},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-dataselector-editarea">   <div class="brtc-style-controls-dataselector-content"/></div>'),this.$parent.append(this.$mainControl);},i.prototype.initContents=function(){var t=this.$mainControl.find(".brtc-style-controls-dataselector-content");this.createDataContainer(t);},i.prototype.onChangeInputTable=function(){"function"==typeof this.options.onChangedHandler&&this.options.onChangedHandler(this.getUsedDataList(),this.options.type);},i.prototype.getFunctionDef=function(e){return t.VA.Core.Interface.Functions.data[e.func];},i.prototype.setAddableDataContainer=function(){var t=this.getUsedDataList(),i=e.getInRange(this.options.fnUnit).table;if(t.length<i.max&&0===this.$selectedContentsContainer.find(".brtc-va-editors-sheet-controls-empty-fnunit").length){var o=$('<div class="brtc-style-flex-center brtc-va-editors-sheet-controls-empty-fnunit">   <div class="brtc-style-controls-dataselector-empty-fnunit">       <div>Drop Data</div>   </div></div>');this.$selectedContentsContainer.append(o),this.createDropEvent(o.find(".brtc-style-controls-dataselector-empty-fnunit"));}else t.length>=i.max&&1===this.$selectedContentsContainer.find(".brtc-va-editors-sheet-controls-empty-fnunit").length&&this.$selectedContentsContainer.find(".brtc-va-editors-sheet-controls-empty-fnunit").remove();},i.prototype.getUsedDataList=function(){for(var t=this.$selectedContents.find(".brtc-va-editors-sheet-controls-dataselector-item"),e=[],i=0;i<t.length;i++){e.push($(t[i]).attr("value"));}return e;},i.prototype.getAllPrevFnUnits=function(t){return t.parent().getAllPreviousFnUnits(t.fid);},i.prototype.getAllTableList=function(i){return _.flatten(this.getAllPrevFnUnits(i).filter(function(e){return!t.VA.Core.Utils.NestedFlowUtils.isProcessFunction(e);}).map(function(t){return e.getOutTable(t)||[];}));},t.VA.Core.Editors.Sheet.Controls.DataSelector=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-controls-datatree"></div>'),this.$treeWrapper=$('<div class="brtc-va-controls-datatree-wrapper"></div>'),this.$parent.append(this.$mainControl),this.$mainControl.append(this.$treeWrapper),this.$mainControl.css({width:"100%",height:"100%",float:"left","background-color":"white"}),this.isEmpty()?this.createEmpty():this.createTree();},e.prototype.isEmpty=function(){var t=this.options.source;return!t||0===Object.keys(t).length;},e.prototype.createEmpty=function(){var t=$('<div class="brtc-va-controls-datatree-empty"><div class="brtc-va-controls-datatree-empty-contents">No Inputs</div></div>');this.$treeWrapper.append(t);},e.prototype.createTree=function(){var e=this,i=$("<ul></ul>");this.$treeWrapper.append(i),_.forEach(this.options.source,function(t,o){e.createTreeElement(i,o,t);}),this.$treeWrapper.jqxTree({height:"100%",width:"100%",theme:t.VA.Env.Theme,allowDrag:!1}),this.makeFunctionItem(),this.addEllipsisClass(),this.addTypeIcon(),e.options.draggable&&e.createDragEvent();},e.prototype.makeFunctionItem=function(){for(var e=this.$treeWrapper.find(".brtc-va-controls-datatree-li-function"),i=0;i<e.length;i++){var o=$(e[i]),n=o.children("div");o.children("span").addClass("brtc-style-height-22px");var r=o.attr("func"),a=n.text();n.hide();var s=t.VA.Core.Utils.WidgetUtils.createPaletteBox({func:r,label:a});s.find(".brtc-va-views-palette-fnunit-label").addClass("brtc-style-ellipsis"),n.replaceWith(s);}},e.prototype.addTypeIcon=function(){for(var t=this.$treeWrapper.find(".brtc-va-controls-datatree-li-table"),e=0;e<t.length;e++){var i=$('<div class="brtc-va-controls-datatree-li-table-icon"></div>');i.attr("type",$(t[e]).attr("type")),$(t[e]).prepend(i);}},e.prototype.addEllipsisClass=function(){for(var t=this.$treeWrapper.find(".brtc-va-controls-datatree-li-table > div"),e=0;e<t.length;++e){var i=$(t[e]);i.addClass("brtc-style-ellipsis"),i.css("width","100%"),i.attr("title",t[e].innerHTML);}},e.prototype.createTreeElement=function(t,e,i){var o=this,n=i.label,r=$('<li class="brtc-va-controls-datatree-li-function">'+n+"</li>");t.append(r),r.attr("item-expanded","true"),_.forEach(i.data,function(t,e){var i=$('<li class="brtc-va-controls-datatree-li-table"></li>');i.text(t.label),i.attr("key",t.key),i.attr("table-id",e),i.attr("type",t.type),i.attr("func",t.func),i.attr("label",n),r.text(t.funcLabel),r.append("<ul></ul>"),r.find("ul").append(i),r.attr("func",t.func),o.createClickEvent(i);});},e.prototype.createClickEvent=function(t){var e=this;t.click(function(){if("function"==typeof e.options.onClick){var t=$(this).attr("key"),i=$(this).attr("table-id");e.options.onClick({key:t,tableId:i});}});},e.prototype.createDragEvent=function(){var t=this,e=this.$treeWrapper.find(".brtc-va-controls-datatree-li-table .jqx-tree-item");_.forEach(e,function(e){$(e).draggable({helper:function helper(){var t=$(this).clone(),e=$(this).width();return t.css({"z-index":5100,width:e,height:"30px","line-height":"30px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}),t;},appendTo:t.options.dragTarget,start:function start(t,e){var i=$(t.target).closest(".brtc-va-controls-datatree-li-table").attr("table-id");e.helper.attr("table-id",i);}});});},e.prototype.getSource=function(){return this.options.source;},t.VA.Core.Editors.Sheet.Controls.DataTree=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils");var i=["scatter","line","pie","column","column-stacked","column-stacked-100","bar","bar-stacked","bar-stacked-100","boxplot","area","area-stacked","area-stacked-100","histogram","roccurve","bubble","card","heatmap","heatmap-matrix","treemap","donut"];function o(e,i,o){t.VA.Core.Editors.Sheet.Controls.DataWorksheet.call(this,e,i,o);}o.prototype=Object.create(t.VA.Core.Editors.Sheet.Controls.DataWorksheet.prototype),o.prototype.constructor=o,o.prototype._init=function(){var e=this.getDataWorksheetOption("full");this.chartOptions={};var o={type:"custom",show:"false"};if(0===e.panel.length){for(var n in e.panel.push({id:"default-chart"+Date.now(),chartOption:{chart:{type:"scatter"},toolbar:o},chartTypeList:i}),e.panel.push({id:"default-table"+Date.now(),chartOption:{chart:{type:"table"}},chartTypeSelectable:!1}),e.panel){var r=e.panel[n];r.chartOption=$.extend(!0,{},t.Chart.Registry[r.chartOption.chart.type||"table"].DefaultOptions,r.chartOption);}e.layout={type:"splitter",direction:"horizontal",ratio:"60%",items:[{id:e.panel[0].id,type:"panel"},{id:e.panel[1].id,type:"panel"}]};}else for(n=0;n<e.panel.length;n++){e.panel[n].chartTypeList&&(e.panel[n].chartTypeList=i),e.panel[n].chartOption&&(e.panel[n].chartOption.toolbar=$.extend(!0,{},e.panel[n].chartOption.toolbar,o));}this.options.style={width:"100%",height:"100%"},this.options.worksheet={panel:e.panel,layout:e.layout};},o.prototype.createControls=function(){var t=this;for(var e in this.$parent.empty(),this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-dataworksheet brtc-va-editors-sheet-controls-big-dataworksheet"></div>'),this.$mainControl.css({width:"100%",height:"100%"}),this.$parent.append(this.$mainControl),this.options.worksheet.onChangeLayout=this.onChangeLayout.bind(this),this.options.worksheet.onChangeChart=this.onChangeChart.bind(this),this.options.worksheet.onSelectChart=this.onSelectChart.bind(this),this.options.columnConf={scatter:{xAxis:{aggregationEnabled:!1,axisTypeList:[]},yAxis:{aggregationEnabled:!0},colorBy:{aggregationEnabled:!1,multiple:!0}},line:{xAxis:{aggregationEnabled:!1,axisTypeList:[]},yAxis:{aggregationEnabled:!0},colorBy:{aggregationEnabled:!1,multiple:!0}},boxplot:{xAxis:{axisTypeList:[]}}},this.options.worksheet.panel){this.options.worksheet.panel[e].chartOption.source=this._getPanelSource(this.options.worksheet.panel[e]),this.options.worksheet.panel[e].chartOption.guide=this._getGuideOption(),this.options.worksheet.panel[e].dataSource=this._setPanelDataSource(e);}this.options.component={right:{chartOption:!0}},this.options.worksheet.toolbar={menu:{multichart:{title:"MultiChart",click:function click(){t._handleOpenMultiChart(this);}},report:{title:"Add to Report",click:function click(){t._handleAddToReport(this);}},setting:{click:function click(){t._handleChartSettings(this);}}}},this.$mainControl.bchartsAdonis(this.options),this.$mainControl.find('.bcharts-ws-panel-chart-selector[chart="table"]').css({"background-image":"none","pointer-events":"none"}),this.bindEventHandlers(),this._initDataWorkSheet();},o.prototype._getLazyData=function(t){var i=this,o=this.options.fnUnit,n=o.parent(),r=this.dataInfo.panelType,a=e.getTable(o,r)[t],s=n.getFnUnitByOutTable(a);return a?{id:{value:a,label:s.display.label},columns:function columns(){return i._tableMap[a].columns;},data:function data(t){"table"===t.options.chart.type?setTimeout(function(){try{t.done({dataType:"rawdata",columns:i._tableMap[a].columns,data:i._tableMap[a].data,count:i._tableMap[a].count,offset:i._tableMap[a].offset});}catch(t){Logger.error(t.stack,{category:"Chart"});}},100):i._executeBigDataRendering(t,a);}}:{id:{value:""},columns:function columns(){return[];},data:function data(t){setTimeout(function(){t.done({dataType:"rawdata",columns:[],data:[],count:0,offset:i._tableMap[a].offset});},100);}};},o.prototype._executeBigDataRendering=function(e,i){var o=e.options,n=t.VA.Core.Utils.IDGenerator.table.id(),r=t.VA.Core.Utils.FullRenderingUtils.getFnUnit(o);r[IN_DATA].push(i),r[OUT_DATA].push(n),r.persist=!1;var a=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl).getModel();t.VA.Core.Utils.ModelUtils.extendParent(a,r);e.aborted=function(){this.jid&&Studio.getJobExecutor().terminate(this.jid);},t.VA.Core.Utils.FullRenderingUtils.getRenderedData(r,Studio.getJobExecutor(),{hideDialog:!0},function(t,i){e.done(t);},function(t,i,o){if(o&&o.message)e.fail(o.message);else if(o&&o.errorInfo.length>0){var n=o.errorInfo.map(function(t){return t.message;});e.fail(n);}else e.fail("Failed to get data.");},function(t){e.jid=t;});},o.prototype.bindEventHandlers=function(){var e=this,i=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);i&&(this.commandListener=function(i){i.event.source.dataInfo&&i.event.source.dataInfo.fid===e.dataInfo.fid&&i.event.source.dataInfo.table===e.dataInfo.table&&i.event.source instanceof t.VA.Core.Editors.Sheet.Controls.BigDataWorksheet&&("REDO"==i.event.type?e.redo(i):"UNDO"==i.event.type&&e.undo(i));},i.addCommandListener(this.commandListener));},o.prototype.onAddChart=function(t,e){},o.prototype.onRemoveChart=function(t,e){},o.prototype.setDataSet=function(t,e){for(var i in this.options.worksheet.panel){"table"===this.options.worksheet.panel[i].chartOption.chart.type&&(this._tableMap[t].columns=e.columns,this._tableMap[t].data=e.data,this.$mainControl.bchartsAdonis("refreshChartPanel",this.options.worksheet.panel[i].id));}},o.prototype.onSelectChart=function(t){this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings").is(":visible")&&(this.$chartOptionPanel=this.$mainControl.find(".bcharts-option-panel"),this.$chartOptionPanel.length>0&&(this._detachChartOptionPanel(),this._attachChartOptionPanelToDialog(this.$chartOptionPanel)));var e=0;this._selectedPanelOptions=t,t&&t.tableIndexes&&t.tableIndexes[0]&&(e=t.tableIndexes[0]);var i=!0;t&&t.chartOption&&"table"!==t.chartOption.chart.type&&(i=!1);var o=this.getPaginationInfoByTableIndex(e);o.showPageSelector=i,this.options.callback.setPaginationInfo(o);},o.prototype._setPanelDataSource=function(e){var i=this;return{selectable:!0,getDataSourceList:function getDataSourceList(){return i._getDataSourceList();},getDataSourceColumnList:function getDataSourceColumnList(t){return i._tableMap[t].columns;},onDataSourceChangedCallBack:function onDataSourceChangedCallBack(e,o){o.forEach(function(t){i._tableMap[t]=i._tableMap[t]||{};}),i._queryTables(function(){var e=new t.VA.Core.CompoundCommand(i,{label:"Change DataSource In Big Data WorkSheet"});for(var n in i.options.worksheet.panel){var r=i.options.worksheet.panel[n],a=new t.VA.Core.Editors.Diagram.Commands.ChangeDataSourceCommand(i,{panel:r,ref:{panel:{tableIndexes:i._getTableIndexes(o)}}});e.add(a);}for(var n in i.executeCommand(e),i.options.worksheet.panel){r=i.options.worksheet.panel[n];i.$mainControl.bchartsAdonis("setDataSource",r.id,i._getPanelSource(r));}var s=i.options.worksheet.panel[1],l=0;s&&s.tableIndexes&&s.tableIndexes[0]&&(l=s.tableIndexes[0]);var c=i.getPaginationInfoByTableIndex(l);i.options.callback&&"function"==typeof i.options.callback.setPaginationInfo&&i.options.callback.setPaginationInfo(c);});}};},o.prototype._initDataWorkSheet=function(){this.options.worksheet.panel.length>0&&this.$mainControl.bchartsAdonis("selectChartPanel",this.options.worksheet.panel[1].id);},o.prototype._onChangeDataSourceCommand=function(t){this.$mainControl.bchartsAdonis("setDataSource",t.options.panel.id,this._getSourceByTableIndexes(t.options.panel.tableIndexes));},o.prototype.removeAddReport=function(){var t=this.dataInfo.panelType;if("in"===t){var i=e.getInTable(this.options.fnUnit);for(var o in i){"load"===this.options.fnUnit.parent().getPreFnUnitByCondition(this.options.fnUnit.fid,function(t){return $.inArray(i[o],e.getOutTable(t))>-1;}).func&&this.$mainControl.find('.bcharts-ws-panel-toolbar .bcharts-ws-panel-toolitem[action="report"]').css({display:"none"});}}else"out"===t&&"load"===this.options.fnUnit.func&&this.$mainControl.find('.bcharts-ws-panel-toolbar .bcharts-ws-panel-toolitem[action="report"]').css({display:"none"});},t.VA.Core.Editors.Sheet.Controls.BigDataWorksheet=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e,i){this.parentId=t,this.options=e,this.dataInfo=i,this.controls={},this.retrieveParent(),this.createControls(),this.bindEventHandlers();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){var t=this;this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-dataworksheet"></div>'),this.$mainControl.css({width:"100%",height:"100%"}),this.$parent.append(this.$mainControl),this.chartOptions={},this.options.worksheet.$panelSelectionGroup=t.$mainControl.closest(".brtc-va-editors-sheet-fnunitviewer"),this.options.worksheet.onAddChart=this.onAddChart.bind(this),this.options.worksheet.onRemoveChart=this.onRemoveChart.bind(this),this.options.worksheet.onChangeLayout=this.onChangeLayout.bind(this),this.options.worksheet.onChangeChart=this.onChangeChart.bind(this),this.options.worksheet.onSelectChart=this.onSelectChart.bind(this),0===this.options.worksheet.panel.length&&this.options.worksheet.panel.push({id:"default-"+Date.now(),chartOption:{chart:{type:"table"},plotOptions:{table:{formatter:[]}}}});var e={dataType:"lazy",lazyData:[{columns:function columns(){return t.options.dataSet.columns;},data:function data(e){setTimeout(function(){e.done({dataType:"rawdata",columns:t.options.dataSet.columns,data:t.options.dataSet.data,count:t.options.dataSet.count,offset:t.options.dataSet.offset});},100);}}]};for(var i in this.options.worksheet.panel){this.options.worksheet.panel[i].chartOption.source=e;}this.options.worksheet.toolbar={menu:{report:{title:"Add to Report",click:function click(){t._handleAddToReport(this);}},setting:{click:function click(){t._handleChartSettings(this);}},duplicate:{},close:{}}},this.$mainControl.bchartsAdonis(this.options);},e.prototype._handleChartSettings=function(t){this._openChartSettingsDialog(),this.onSelectChart();},e.prototype._attachChartOptionPanelToDialog=function(t){t.data("original-parent",t.parent()),t.detach(),this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings").find(".brtc-va-dialog-contents").append(t);},e.prototype._detachChartOptionPanel=function(){this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings").find(".bcharts-option-panel").each(function(t,e){var i=$(e),o=i.data("original-parent");i.detach().appendTo(o);});},e.prototype._openChartSettingsDialog=function(){var t=this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings"),e=t.is(":visible");if(e){var i=t.parent().width(),o=t.parent().height(),n=t.offset(),r=t.outerWidth(),a=t.outerHeight();n.left+r>i&&(e=!1),n.top+a>o&&(e=!1);}if(0==e){(n=this.$mainControl.offset()).right=n.left+this.$mainControl.outerWidth(),n.bottom=n.top+this.$mainControl.outerHeight();r=t.outerWidth(),a=t.outerHeight();n.top-=50,n.top+a>n.bottom&&(n.top=n.bottom-a-20),n.left=n.right-r,t.css({left:n.left,top:n.top}),t.show();}},e.prototype.arrange=function(t){this.$mainControl.bchartsAdonis("layout",t);},e.prototype.onAddChart=function(e,i){if(0===$.grep(this.options.worksheet.panel,function(t,i){return t.id==e.id;}).length){var o=new t.VA.Core.CompoundCommand(this,{id:"brightics.va.editors.diagram.commands.addchartcommand"});o.add(this.createNewChartCommand(e)),o.add(this.createSetDataWorksheetLayoutCommand(i)),this.executeCommand(o);}},e.prototype.onRemoveChart=function(e,i){if($.grep(this.options.worksheet.panel,function(t,i){return t.id==e.id;}).length>0){var o=new t.VA.Core.CompoundCommand(this,{id:"brightics.va.editors.diagram.commands.removechartcommand"});o.add(this.createRemoveChartCommand(e)),o.add(this.createSetDataWorksheetLayoutCommand(i)),this.executeCommand(o);}},e.prototype.onChangeLayout=function(t){JSON.stringify(this.options.worksheet.layout)!==JSON.stringify(t)&&this.executeCommand(this.createSetDataWorksheetLayoutCommand(t));},e.prototype._assignArray=function(t,e){for(var i in e){$.isPlainObject(e[i])?this._assignArray(t[i],e[i]):$.isArray(e[i])&&(t[i]=$.extend(!0,[],e[i]));}},e.prototype._mergeArraySafely=function(t,e){var i=$.extend(!0,{},t,e);return this._assignArray(i,e),i;},e.prototype.onChangeChart=function(e,i){var o=this.chartOptions[e.id],n=this._mergeArraySafely(this.chartOptions[e.id],i);if(JSON.stringify(o)!==JSON.stringify(n)){var r=$.extend(!0,{},i);delete r.source;var a=new t.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand(this,{panelOption:e,ref:{chartOption:r}});this.executeCommand(a);}},e.prototype.onSelectChart=function(){this.$mainControl.closest(".brtc-va-editors-modeleditor").children(".brtc-va-dialog.brtc-va-chart-settings").is(":visible")&&(this.$chartOptionPanel=this.$mainControl.find(".bcharts-option-panel"),this.$chartOptionPanel.length>0&&(this._detachChartOptionPanel(),this._attachChartOptionPanelToDialog(this.$chartOptionPanel)));},e.prototype.bindEventHandlers=function(){var e=this,i=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);i&&(this.commandListener=function(i){!i.event.source.dataInfo||i.event.source.dataInfo.fid!==e.dataInfo.fid||i.event.source.dataInfo.table!==e.dataInfo.table||i.event.source instanceof t.VA.Core.Editors.Sheet.Controls.BigDataWorksheet||("REDO"==i.event.type?e.redo(i):"UNDO"==i.event.type&&e.undo(i));},i.addCommandListener(this.commandListener));},e.prototype.unbindEventHandlers=function(){var e=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);e&&this.commandListener&&(e.removeCommandListener(this.commandListener),this.commandListener=null);},e.prototype.redo=function(e){if(e instanceof t.VA.Core.CompoundCommand){if("brightics.va.editors.diagram.commands.addchartcommand"===e.getId())this.onNewChartCommand(e);else if("brightics.va.editors.diagram.commands.removechartcommand"===e.getId())this.onRemoveChartCommand(e);else for(var i in e.commandList){this.redo(e.commandList[i]);}}else e instanceof t.VA.Core.Editors.Diagram.Commands.NewChartCommand?this.onNewChartCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveChartCommand?this.onRemoveChartCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand?this.onSetDataWorksheetLayoutCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand&&this.onSetContentsPanelCommand(e);},e.prototype.undo=function(e){if(e instanceof t.VA.Core.CompoundCommand){if("brightics.va.editors.diagram.commands.addchartcommand"===e.getId())this.onNewChartCommand(e);else if("brightics.va.editors.diagram.commands.removechartcommand"===e.getId())this.onRemoveChartCommand(e);else for(var i=e.commandList.length-1;i>=0;i--){this.undo(e.commandList[i]);}}else e instanceof t.VA.Core.Editors.Diagram.Commands.NewChartCommand?this.onNewChartCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveChartCommand?this.onRemoveChartCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand?this.onSetDataWorksheetLayoutCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetContentsPanelCommand&&this.onSetContentsPanelCommand(e);},e.prototype.onNewChartCommand=function(t){"REDO"==t.event.type?this.$mainControl.bchartsAdonis("addChartPanel",t.options.panelOption):this.$mainControl.bchartsAdonis("removeChartPanel",t.options.panelOption.id);},e.prototype.onRemoveChartCommand=function(t){"REDO"==t.event.type?this.$mainControl.bchartsAdonis("removeChartPanel",t.options.panelOption.id):this.$mainControl.bchartsAdonis("addChartPanel",t.options.panelOption);},e.prototype.onSetDataWorksheetLayoutCommand=function(t){this.$mainControl.bchartsAdonis("layout",t.options.layout);},e.prototype.onSetContentsPanelCommand=function(t){this.chartOptions[t.options.panelOption.id]=t.options.panelOption.chartOption,this.$mainControl.bchartsAdonis("setChartOptions",t.options.panelOption.id,t.options.panelOption.chartOption);},e.prototype.createNewChartCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.NewChartCommand(this,{panel:this.options.worksheet.panel,panelOption:e});},e.prototype.createRemoveChartCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.RemoveChartCommand(this,{panel:this.options.worksheet.panel,panelOption:e});},e.prototype.createSetDataWorksheetLayoutCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand(this,{layout:this.options.worksheet.layout,newLayout:e});},e.prototype.executeCommand=function(e){t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl).getCommandManager().execute(e);},e.prototype._handleOpenMultiChart=function(e){var i=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl),o={user:t.VA.Env.Session.userId,pid:i.options.editorInput.getProjectId(),mid:this.dataInfo.mid,fid:this.dataInfo.fid,tid:this.dataInfo.table,cid:e.getOptions().id},n=$.map(o,function(t,e){return e+"="+t;}).join("&");window.open("multichart?"+n,"multiChart");},e.prototype._handleAddToReport=function(e){var i=this,o=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(i.$mainControl),n=this.$mainControl.closest(".brtc-va-editors-sheet-panels-basepanel").find(".brtc-va-editors-sheet-panels-basepanel-header-title").text();if(t.VA.Implementation.Visual){var r=Studio.getResourceManager(),a=o.options.editorInput.getProjectId(),s=r.getProject(a).getLabel(),l=r.getFilesByModelType(a,t.VA.Implementation.Visual.Clazz),c=o.options.editorInput.getLabel(),d=i.dataInfo.fnUnitLabel;l.length?new t.VA.Implementation.Visual.Dialogs.SelectVisualModelDialog(i.$mainControl,{projectId:a,projectLabel:s,visualModels:l,modelId:i.dataInfo.mid,tableId:i.dataInfo.table,defaultDataSourceLabel:c+"-"+d+"-"+n,close:function close(o){o.OK&&(t.VA.Implementation.Visual.Utils.ModelUtils.addChartContentToSelectedVisualModel({resourceManager:r,dataSourceLabel:o.dataSourceLabel?o.dataSourceLabel:c+"-"+d+"-"+n,selectedModels:o.selectedModels,projectId:a,modelId:i.dataInfo.mid,tableId:i.dataInfo.table,chartOptions:$.extend(!0,{},e.getOptions().chartOption),columns:$.extend(!0,[],t.VA.Core.DataQueryTemplate.getSchema(i.dataInfo.mid,i.dataInfo.table)),changeLabel:o.changeLabel}),t.VA.Core.Utils.WidgetUtils.openInformationDialog("Successfully Added To The Report."));},resizable:!0,title:"Select Reports to Add"}):t.VA.Core.Utils.WidgetUtils.openErrorDialog("No report in this project. Create a report in this project.");}},e.prototype.destroy=function(){this.unbindEventHandlers(),this.$mainControl.bchartsAdonis("destroy");},e.prototype.setDataSet=function(t){this.options.dataSet=t,this.$mainControl.bchartsAdonis("refreshChartPanel");},t.VA.Core.Editors.Sheet.Controls.SingleDataWorksheet=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.PropertyControl;function i(t,i){e.call(this,t,i);}i.prototype=Object.create(e.prototype),i.prototype.setContents=function(e){for(var i=[],o=this.options.value.length,n=100/o+"%",r=0;r<o;r++){i[r]={text:this.options.value[r],width:n,align:"center",cellsalign:"center"};}this.$contentsControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-grid" style="margin: 10px;"/>'),this.$contentsControl.jqxGrid({theme:t.VA.Env.Theme,width:"85%",height:"200px",rowsheight:25,editable:!0,columns:i}),this.$contentsControl.jqxGrid("addrow",null,{}),e.append(this.$contentsControl);},this.Brightics.VA.Core.Editors.Sheet.Controls.GridControl=i;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("FnUnitUtils"),i=brtc_require("FnUnitInputs");function o(t,e){this.parentId=t,this.options=e,this.keyMap={},this.retrieveParent(),this.createControls(),this.initContents();}o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},o.prototype.createControls=function(){var e=this;this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-inputselector-editarea">   <div class="brtc-style-controls-inputselector-content"/></div>');var i={theme:t.VA.Env.Theme,position:{my:"left top",at:"right top",of:this.$parent},appendTo:"body",width:600,height:550,title:"Set Inputs",modal:!1,showAnimationDuration:50,minHeight:250,open:function open(){$(".ui-dialog-titlebar.ui-widget-header",$(this).parent()).css({width:"calc(100% - 40px) !important","padding-left":"0px !important","padding-right":"0px !important","margin-left":"20px !important"});}};this.options.multiple||(i.height-=33),$.extend(i,this.options),this.$mainControl.dialog(i),this.$mainControl.css({width:"-webkit-fill-available","min-height":"50px","max-height":"600px","min-width":"100px","max-width":"800px"}),this.$mainControl.parent().find(".ui-resizable-handle:not(.ui-resizable-s)").hide(),this.closeHandler=function(t){var i=$(t.target);i.attr("class")&&i.attr("class").indexOf("ui-dialog")>-1||0===e.$mainControl.has(t.target).length&&e.$mainControl.dialog("close");},e.$mainControl.on("dialogclose",function(t){$(window).off("mousedown",this.closeHandler),e.$mainControl.dialog("destroy");}),e.$mainControl.parent().on("mousedown",function(t){t.stopPropagation();}),$(window).on("mousedown",e.closeHandler);},o.prototype.reset=function(){this.initContents();},o.prototype.initContents=function(){var t=this.$mainControl.find(".brtc-style-controls-inputselector-content");t.empty();var e=$('<div class="brtc-style-controls-inputselector-content-source-wrapper brtc-style-margin-right-10"></div>'),i=$('<div class="brtc-style-controls-inputselector-content-inputs-wrapper"></div>');this.$sourceArea=$('<div class="brtc-style-controls-inputselector-content-source"></div>'),this.$inputArea=$('<div class="brtc-style-controls-inputselector-content-input"></div>'),e.append(this.$sourceArea),i.append(this.$inputArea),t.append(e).append(i),this.createSourceContainer(this.$sourceArea),this.createInputContainer(this.$inputArea);},o.prototype.getDropFuncTarget=function(t){return 1==t.find(".brtc-va-views-palette-fnunit").length?t.find(".brtc-va-views-palette-fnunit"):t;},o.prototype.createDropEvent=function(t){var e=this;t.droppable({accept:".brtc-va-controls-datatree-li-table .ui-draggable",activate:function activate(t,i){i.draggable.attr("type");e.getDropFuncTarget($(this)).addClass("brtc-style-droppable-active");},deactivate:function deactivate(t,i){var o=e.getDropFuncTarget($(this));o.removeClass("brtc-style-droppable-active"),o.removeClass("brtc-style-droppable-hover");},over:function over(t,i){e.getDropFuncTarget($(this)).addClass("brtc-style-droppable-hover");},out:function out(t,i){e.getDropFuncTarget($(this)).removeClass("brtc-style-droppable-hover");},drop:function drop(t,i){var o=i.draggable,n=e.getDropFuncTarget($(this));n.removeClass("brtc-style-droppable-active"),n.removeClass("brtc-style-droppable-hover"),e.switchData(o,$(this)),e.destroyDragEvent(o),e.onChange();}});},o.prototype.switchData=function(t,e){var i=t.closest("li").attr("key"),o=t.closest("li").attr("table-id"),n=t.closest("li").attr("type"),r=this.createTableItem({fnUnit:this.options.fnUnit,label:i,value:o,type:n}),a=!!e.hasClass("brtc-style-controls-inputselector-empty-fnunit"),s=e.closest(".brtc-style-controls-inputselector-box-contents"),l=s.find(".brtc-va-editors-sheet-controls-empty-fnunit");s.find(".brtc-style-editor-content-remove-button").show(),l.hide(),this.createDropEvent(r),a?s.prepend(r):e.replaceWith(r);},o.prototype.createTreeSource=function(t){var i={},o={label:"",data:{}},n=e.getOutputsToObject(t),r=e.getLabel(t),a=e.getId(t);$.extend(this.keyMap,n);var s={};for(var l in n){s[l]={},s[l].key=n[l],s[l].type=e.getTypeByTableId(t,l),s[l].func=e.getFunc(t),s[l].label=e.getKeyLabel(t,n[l])||n[l];}return o.label=r,o.data=s,i[a]=o,i;},o.prototype.createSourceContainer=function(){var i=this,o={},n=this.getPreviousFnUnits(this.options.fnUnit),r=e.getParent(this.options.fnUnit);_.forEach(n,function(t){if(e.isProcessFunction(t)){var n=r.getAllPreviousFnUnits(e.getId(t));_.forEach(n,function(t){o=_.assign(o,i.createTreeSource(t));});}else o=_.assign(o,i.createTreeSource(t));});var a={draggable:!0,dragTarget:this.$mainControl,source:o,onClick:function onClick(t){console.log(t);}};new t.VA.Core.Editors.Sheet.Controls.DataTree(this.$sourceArea,a);},o.prototype.createInputContainer=function(){var t={appendTo:this.$inputArea,fnUnit:this.options.fnUnit,onChange:this.onChange.bind(this),onError:this.onError.bind(this),autoArrange:!e.hasMeta(this.options.fnUnit)};this.inputsList=i.render(t),this.$inputArea.closest(".brtc-style-controls-inputselector-content-inputs-wrapper").perfectScrollbar();},o.prototype.createRemoveButton=function(){var t=this,e=$('<span class="brtc-style-editor-content-remove-button"></span>');return e.click(function(){var e=$(this).closest(".brtc-style-controls-inputselector-box-wrapper"),i=e.attr("table-id"),o=e.attr("key"),n=e.find(".brtc-va-editors-sheet-controls-dataselector-item"),r=e.find(".brtc-va-editors-sheet-controls-empty-fnunit");e.find(".brtc-style-editor-content-remove-button").hide(),n.remove(),r.show(),t.handleRemove(o,i);}),e;},o.prototype.handleRemove=function(t,e){console.log(e),console.log(t),this.onChange();},o.prototype.createBoxWrapper=function(t){var e=$('<div class="brtc-style-controls-inputselector-box-wrapper"></div>'),i=$('<div class="brtc-style-controls-inputselector-box-header"></div>'),o=$('<div class="brtc-style-controls-inputselector-box-contents"></div>');return e.append(i).append(o),i.text(t),e;},o.prototype.createBox=function(t){return this.createBoxWrapper(t);},o.prototype.createTableItem=function(e){var i=e.label,o=e.value,n=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single"></div>'),r=t.VA.Core.Utils.WidgetUtils.createTableItem(n,{label:e.label,id:e.value,type:e.type});return n.attr("table-id",o),n.attr("type",e.type),r.find(".brtc-va-views-palette-fnunit-label").addClass("brtc-style-ellipsis"),r.find(".brtc-va-views-palette-fnunit-label").text(i),r.attr("title",i),r.addClass("item"),n;},o.prototype.createEmptyContainer=function(t){var e=$('<div class="brtc-style-controls-inputselector-content-empty"></div>');return e.text(t),e;},o.prototype.createEmptyItem=function(){return $('<div class="brtc-style-flex-center brtc-va-editors-sheet-controls-empty-fnunit">   <div class="brtc-style-controls-inputselector-empty-fnunit">       <div>Drop Data</div>   </div></div>');},o.prototype.getPreviousFnUnits=function(){var t=[],e=this.options.fnUnit.parent(),i=e.getPrevious(this.options.fnUnit.fid);return _.forEach(i,function(i){t.push(e.getFnUnitById(i));}),t;},o.prototype.destroyDragEvent=function(t){t.on("dragstop",function(e,i){t.hasClass("ui-draggable")&&i.helper.attr("table-id")!==e.target.getAttribute("table-id")&&t.draggable("destroy");});},o.prototype.onChange=function(t,e){"function"==typeof this.options.onChange&&this.options.onChange(e);},o.prototype.onError=function(t,e){"function"==typeof this.options.onError&&this.options.onError(e);},t.VA.Core.Editors.Sheet.Controls.InputSelector=o;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.PropertyControl;function i(t,i){e.call(this,t,i);}i.prototype=Object.create(e.prototype),i.prototype.setContents=function(e){this.$contentsControl=$('<div class="brtc-va-editors-sheet-controls-numberinputcontrol" style="margin: 10px;"/>'),this.$contentsControl.jqxNumberInput({theme:t.VA.Env.Theme,height:25,width:"85%"}),e.append(this.$contentsControl);},this.Brightics.VA.Core.Editors.Sheet.Controls.NumberInputControl=i;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Editors.Sheet.Controls.NumericInput=function(e,i){return t.VA.Core.Widget.Factory.numericInputControl(e,i);};}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.controls={},this.retrieveParent(),this.createControls(),this.init();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.init=function(){return this.getReportOptions().then(this.renderReportWorksheet.bind(this)).catch(function(t){throw console.error(t),t;});},e.prototype.textRenderer=function(t,e,i,o){t.html(e.html),i();},e.prototype.chartRenderer=function(t,e,i,o){var n=e.source;this.options.dataProxy.requestPageData(n,function(o){var n=e;n.source={dataType:"local",localData:[{dataType:"rawdata",columns:o.columns,data:o.data}]},t.bcharts(n),i();},function(t){o();},1,1e3);},e.prototype.addUnit=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-dataworksheet-unit"></div>');return e.css({width:"95%",height:"text"===t?"auto":"300px","margin-bottom":"15px","margin-left":"10px"}),this.$mainControl.append(e),e;},e.prototype.renderReportWorksheet=function(t){var e=this;this.unitRenderer={text:this.textRenderer,chart:this.chartRenderer};var i=[];for(var o in t){var n=t[o].options||t[o].option,r=this.addUnit(t[o].type),a=new Promise(function(i,a){t[o].type;e.unitRenderer[t[o].type].bind(e)(r,n,i,a);});i.push(a);}return Promise.all(i).then(this.$mainControl.perfectScrollbar());},e.prototype.getReportOptions=function(){var t=this,e=this.options.fnUnit[OUT_DATA][0];return new Promise(function(i,o){t.options.dataProxy.requestPageData(e,function(t){var e=JSON.parse(t.data[0][0].replace("'",""));i(e);},function(t){o();},1,1e3);});},e.prototype.queryTable=function(t){var e=this;return new Promise(function(i,o){e.options.dataProxy.requestPageData(t,function(t){i(t);},function(t){o();},1,1e3);});},e.prototype.createControls=function(){this.$parent.empty(),this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-dataworksheet"></div>'),this.$mainControl.css({width:"100%",height:"100%"}),this.$parent.append(this.$mainControl);},e.prototype.destroy=function(){},t.VA.Core.Editors.Sheet.Controls.ReportWorksheet=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.initOptions(),this.retrieveParent(),this.createControls();}e.prototype.initOptions=function(){this.options=$.extend(!0,{rowCount:5,maxRowCount:7,expand:!1},this.options),this.options.items=[],this.options.renderedItems={};},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.createTableListControl(),this.createExpanderControl();},e.prototype.setMaxHeight=function(){var t=this.$tableList.find(".brtc-va-editors-sheet-controls-tablelist-element").css("height");if(void 0!==this.options.maxRowCount&&this.options.maxRowCount>0){var e=parseInt(this.options.expand?this.options.maxRowCount:this.options.rowCount)*parseInt(t);this.$tableList.css({"max-height":e,height:e}),this.$tableList.closest(".slimScrollDiv").css({height:e});}},e.prototype.createTableListControl=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-tablelist-wrapper" />'),this.$tableListControl=$('<div class="brtc-va-editors-sheet-controls-tablelist" />'),this.$tableList=$('<ul class="brtc-va-editors-sheet-controls-tablelist-sortable"/>'),this.$tableListControl.append(this.$tableList),this.$mainControl.append(this.$tableListControl),this.resetTableList(),this.$tableList.slimScroll({});},e.prototype.createExpanderControl=function(){var t=this;this.$expanderContainer=$('<div class="brtc-va-editors-sheet-controls-tablelist-expandercontainer" />');var e=$('<div class="brtc-va-editors-sheet-controls-tablelist-expander" />'),i=$('<div class="brtc-va-editors-sheet-controls-tablelist-expander-left" />'),o=$('<div class="brtc-va-editors-sheet-controls-tablelist-expander-center" />'),n=$('<div class="brtc-va-editors-sheet-controls-tablelist-expander-right" />');e.append(i).append(o).append(n),this.$expandUp=$('<div class="brtc-va-editors-sheet-controls-tablelist-expander-up" />'),this.$expandUp.append('<i class="fa fa-angle-double-up"></i>'),this.$expandDown=$('<div class="brtc-va-editors-sheet-controls-tablelist-expander-down" />'),this.$expandDown.append('<i class="fa fa-angle-double-down"></i>'),o.append(this.$expandUp).append(this.$expandDown),this.$remainNumber=$('<div class="brtc-va-editors-sheet-controls-tablelist-expander-remain" />'),n.append(this.$remainNumber),this.$expandUp.hide(),this.$expandDown.show(),e.click(function(){t.options.expand=!t.options.expand,t.options.expand?(t.$expandUp.show(),t.$expandDown.hide()):(t.$tableList.scrollTop(),t.$expandUp.hide(),t.$expandDown.show()),t.render();}),this.$expanderContainer.append(e),this.$expanderContainer.hide(),this.$mainControl.append(this.$expanderContainer),this.$parent.append(this.$mainControl);},e.prototype.render=function(){var t=this;this.options.items.length>0?this.$emptyElemet.hide():this.$emptyElemet.show();var e=this.options.items.length;if(this.options.expand)$.each(this.options.items,function(e,i){t.options.renderedItems[i.value]||(t.options.renderedItems[i.value]=t.createTableUnit(i),t.$tableList.append(t.options.renderedItems[i.value]));}),e<=this.options.rowCount?this.$expanderContainer.hide():this.$expanderContainer.show(),this.$remainNumber.text(e);else{for(var i=0;i<this.options.items.length;i++){var o=this.options.items[i];i<this.options.rowCount?o&&!t.options.renderedItems[o.value]&&(t.options.renderedItems[o.value]=t.createTableUnit(o),t.$tableList.append(t.options.renderedItems[o.value])):o&&t.options.renderedItems[o.value]&&(t.options.renderedItems[o.value].remove(),delete t.options.renderedItems[o.value]);}(e=this.options.items.length-this.options.rowCount)>0?this.$expanderContainer.show():this.$expanderContainer.hide(),this.$remainNumber.text("+"+e);}this.setMaxHeight();},e.prototype.createTableUnit=function(e){var i=$('<li class="brtc-va-editors-sheet-controls-tablelist-element" />');return i.append($("<span>"+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e.label)+"</span>")),i.attr("value",e.value),i;},e.prototype.setItems=function(t){if(t){this.options.items=[];var e=$.grep(t,function(t){return t;});this.options.items=e,this.resetTableList(),this.render();}},e.prototype.resetTableList=function(){this.options.renderedItems={},this.$tableList.empty(),this.$emptyElemet=$("<div><span></span></div>"),this.$emptyElemet.css({height:"80px"}),this.$tableList.append(this.$emptyElemet);},e.prototype.getItems=function(){return this.options.items.length>0?this.options.items:void 0;},t.VA.Core.Editors.Sheet.Controls.TableList=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){try{this.$mainControl=t,this.options=e,this.verifier=e.verifier,this.data=null,this.createControls();}catch(t){console.error(t);}}e.prototype.createControls=function(){this.verifier&&this.verifier.getSyntaxRule();this.initCodeMirror();},e.prototype.initCodeMirror=function(){var e=this,i={mode:this.verifier?this.verifier.getRuleMode():"brtc-default",theme:"default",lineNumbers:!1,lineWrapping:!0,scrollbarStyle:void 0!==e.options.scrollbarStyle?"null":"simple",placeholder:"Enter value",extraKeys:{"Ctrl-Space":"autocomplete"},showTrailingSpace:!0,autoCloseBrackets:!0,matchBrackets:!0},o=$.extend(!0,{},i,this.options);this.codeMirror=CodeMirror.fromTextArea(this.$mainControl[0],o),this.codeMirror.on("focus",function(t,i){e.old=t.getValue();}),this.codeMirror.on("blur",function(t,i){t.getValue()!=e.old&&"function"==typeof e.callback&&e.callback("change",i);}),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror);},e.prototype.getValue=function(){return this.codeMirror.getValue();},e.prototype.setValue=function(t){this.codeMirror.setValue(t);},e.prototype.onChange=function(t){this.callback=t;},e.prototype.getControl=function(){return this.$mainControl;},this.Brightics.VA.Core.Editors.Sheet.Controls.TextAreaControl=e;}.call(this),function(){"use strict";var t=this.Brightics.VA.Core.Editors.Sheet.Controls.PropertyControl;function e(e,i){t.call(this,e,i);}e.prototype=Object.create(t.prototype),e.prototype.setContents=function(t){this.$contentsControl=$('<input type= "text" class="brtc-va-editors-sheet-controls-textinputcontrol" style="margin: 10px;"/>'),this.$contentsControl.jqxInput({height:25,width:"85%",minLength:1,placeHolder:"Enter text"}),t.append(this.$contentsControl);},this.Brightics.VA.Core.Editors.Sheet.Controls.TextInputControl=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.caller=t,this.options=e||{},this.init(),this.createControl();}e.prototype.init=function(){this.controls={};},e.prototype.registerSpec=function(t){var e=this;this.PARAM_INFO={},t.forEach(function(t){e.PARAM_INFO[t.Key]={Label:t.Label,Default:t.Default||""},t.Source&&(e.PARAM_INFO[t.Key].Source=t.Source),t.NumberType&&(e.PARAM_INFO[t.Key].NumberType=t.NumberType);});},e.prototype.createControl=function(){},e.prototype.renderControl=function(){var t=this.Default;this.options.value&&(t=this.options.value),this.controls[this.CONTROL_KEY].setValue(t);},e.prototype.getSection=function(t){return"left"==t?this.caller.$leftArea:"right"==t?this.caller.$rightArea:this.caller.$contentsArea;},e.prototype.getValue=function(){var t={};return t[this.CONTROL_KEY]=this.controls[this.CONTROL_KEY].getValue(),t;},e.prototype.bindValidation=function(t){var e=this;void 0!==t.$target&&(t.mandatory||this.options.isMandatory)&&(this.checkValidation(t),t.$target.on("change",function(i){e.checkValidation(t);}));},e.prototype.checkValidation=function(t){if(this.removeValidation(t.$target),t.control&&(!t.control.getValue()||$.isEmptyObject(t.control.getValue()))){var e={$target:t.$target,message:this.caller.problemFactory.makeMessage({errorCode:"BR-0033",param:t.$target,messageParam:[t.label]})};this.createValidationContent(e);}},e.prototype.removeValidation=function(t){t.find(".brtc-va-editors-opt-validation-tooltip-wrapper").remove(),t.removeClass("brtc-va-editors-opt-validation-error");},e.prototype.createValidationContent=function(t){var e=$('<div class="brtc-va-editors-opt-validation-tooltip-wrapper">   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>    <div class="brtc-va-editors-opt-validation-tooltip">'+t.message+"</div></div>");t.$target.append(e),t.$target.addClass("brtc-va-editors-opt-validation-error"),e.show();},e.prototype.createDeckProperties=function(t,e,i,o){var n=$('<div class="deck-property">    <div class="property-label"></div>    <div class="property-control"></div></div>');if(t.append(n),n.find(".property-label").text(e),"function"==typeof i&&i.call(this,n.find(".property-control")),o.mandatory){n.find(".property-label").append('<div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div>'),this.bindValidation({$target:n.find(".property-control"),control:this._getControl(o),mandatory:!0,label:e});}return n;},e.prototype.getFilteredData=function(){var t=this.dataMap&&this.options.fnUnit["in-table"][0]?this.dataMap[this.options.fnUnit["in-table"][0]].columns:[];return $.grep(t,function(t){return"double"===t.internalType.toLowerCase();});},e.prototype.configureControls=function(t,e,i){},e.prototype._setControl=function(t,e){var i=this.CONTROL_KEY,o=t.options?t.options.attr:void 0;void 0===o?this.controls[i]=e:t.options.control?t.options.control[o]=e:void 0!==t.controlIndex?this.controls[i][t.controlIndex][o]=e:this.controls[i][o]=e;},e.prototype._getControl=function(t){if(void 0!==t){var e=this.CONTROL_KEY,i=t.attr;return t.control?t.control[i]:void 0!==t.controlIndex?this.controls[e][t.controlIndex][i]:this.controls[e][i];}},e.prototype.createRadioButtonControl=function(t,e){var i=this,o={},n=e.source,r=this.CONTROL_KEY,a=function(){if(e.value&&n.some(function(t){return t.value==e.value;}))return e.value;}(),s={};n.forEach(function(n){o[r+"."+n.value]=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">'+n.label+"</div>"),t.append(o[r+"."+n.value]),s[r+"."+n.value]=i.caller.createRadioButton(o[r+"."+n.value],{disabled:e.disabled,groupName:r}),s[r+"."+n.value].on("checked",function(o){a=n.value,i.configureControls(t,e.attr,a);});}),s.getValue=function(){return e.getValue?e.getValue.call(this,a):a;},s.setValue=function(t){o[r+"."+t].jqxRadioButton("check");},this._setControl({options:e},s);},e.prototype.createTextAreaControl=function(e,i){var o={theme:t.VA.Env.Theme,width:"264px",height:"75px"};return i&&$.extend(o,i),e.jqxTextArea(o),e;},e.prototype.createNumberArrayControl=function(t,e){var i=this.CONTROL_KEY,o={},n=$('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-input"/>');n.attr("maxlength",1e3),t.append(n),o[i]=this.caller.createInput(n,{placeHolder:e&&e.placeHolder?e.placeHolder:"ex) 0.4, 0.5"}),o[i].setValue=function(t){void 0!==t&&n.val(t.replace(/\[|\]/g,""));},o[i].getValue=function(){if(n.val())return"["+n.val()+"]";},this.options.isMandatory&&this.bindValidation({$target:t,control:o[i],label:this.constructor.Label}),this._setControl({options:e},o[i]);},e.prototype.createInputControl=function(t,e){var i=this.CONTROL_KEY,o={},n=$('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-input"/>');e.maxLength>0&&n.attr("maxlength",e.maxLength),t.append(n),o[i]=this.caller.createInput(n,{placeHolder:e&&e.placeHolder?e.placeHolder:"ex) 0.4, 0.5"}),o[i].setValue=function(t){n.val(t);},o[i].getValue=function(){return n.val();},this._setControl({options:e},o[i]);},e.prototype.createDropDownControl=function(t,e){var i=e&&e.source?e.source:[],o=this.CONTROL_KEY,n={},r=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');t.append(r);var a={source:i,selectedIndex:0};n[o]=this.caller.createDropDownList(r,a),n[o].setValue=function(t){void 0!==t&&this.jqxDropDownList("selectItem",t);},n[o].getValue=function(){return this.jqxDropDownList("getSelectedItem").value;},this._setControl({options:e},n[o]);},e.prototype.createDeckDropdownControl=function(t,e,i){var o,n=this,r=e.source,a=e.attr,s=e.target?e.target:{},l=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');s[a]=this.createDeckProperties(t,this.PARAM_INFO[a].Label,function(s){var c;s.append(l),r||(r=n.PARAM_INFO[a].Source||[]),r&&r.length>0&&(c=(c=r.findIndex(function(t){return t.value==n.PARAM_INFO[a].Default;}))>-1?c:0);var d={source:r,selectedIndex:c||0};o=n.caller.createDropDownList(l,d),n._setControl({options:e,controlIndex:i},o),o.setValue=function(t){this.jqxDropDownList("selectItem",t);},o.getValue=function(){return this.jqxDropDownList("getSelectedItem").value;},n.configureControls(t,a,o.getValue(),i),o.on("change",function(e){n.configureControls(t,a,e.args.item.value,i);});},{mandatory:e.mandatory,controlIndex:i,attr:a});},e.prototype.createDeckInputControl=function(t,e,i){var o,n=this,r=(e.source,e.attr),a=e.target?e.target:{},s=$('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-input"/>');a[r]=this.createDeckProperties(t,this.PARAM_INFO[r].Label,function(t){t.append(s);var a={placeHolder:n.PARAM_INFO[r].Default};o=n.caller.createInput(s,a),n._setControl({options:e,controlIndex:i},o),o.setValue=function(t){s.val(t);},o.getValue=function(){return s.val();};},{mandatory:e.mandatory,controlIndex:i,attr:r});},e.prototype.createDeckNumberInputControl=function(t,e,i){var o,n=this,r=(e.source,e.attr),a=e.target?e.target:{},s=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');a[r]=this.createDeckProperties(t,n.PARAM_INFO[r].Label,function(t){if(t.append(s),"constraints"===n.CONTROL_KEY&&"min"===r&&n.PARAM_INFO[r].Default)var a={placeholder:n.PARAM_INFO[r].Default,numberType:n.PARAM_INFO[r].NumberType||"int",min:parseFloat(n.PARAM_INFO[r].Default)};else a={placeholder:n.PARAM_INFO[r].Default,numberType:n.PARAM_INFO[r].NumberType||"int"};o=n.caller.createNumberInput(s,a),n._setControl({options:e,controlIndex:i},o);},{mandatory:e.mandatory,controlIndex:i,attr:r,control:e.control});},e.prototype.configureScalingControls=function(){},t.VA.Core.Editors.Sheet.Controls.Optimization.Base=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype.createDeleteButton=function(t){var e=$('<div class ="brtc-va-editors-sheet-controls-propertycontrol-deck-remove"></div>');t.append(e);var i=this;e.click(function(e){e.stopPropagation();var o=t.index();i.controls[i.CONTROL_KEY].splice(o,1),t.remove(),(i.options.multiple||!i.options.multiple&&0==i.controls[i.CONTROL_KEY].length)&&i.$addButton.appendTo(i.$controlContainer),i.updateSectionScroll();});},i.prototype.renderControl=function(){var t=this;if(this.options.value){var e=this.options.params,i=this.options.value.slice();this.$addButton.detach(),this.options.multiple||(i=i.splice(0,1));for(var o=0;o<i.length;o++){this.createDeck(),e.forEach(function(e){t.controls[t.CONTROL_KEY][o][e.attr]&&t.controls[t.CONTROL_KEY][o][e.attr].setValue(i[o][e.attr]);});}(this.options.multiple||!this.options.multiple&&0==this.controls[this.CONTROL_KEY].length)&&this.$addButton.appendTo(this.$controlContainer);}},i.prototype.createAddButton=function(){var e=this;this.$addButton=$('<input type="button" class= "brtc-va-editors-sheet-controls-propertycontrol-addbutton" />'),this.$addButton.val("+ Add "+this.getLabel()),this.$controlContainer.append(this.$addButton),this.$addButton.jqxButton({theme:t.VA.Env.Theme,width:"100%",height:25}),this.$addButton.click(function(){$(this).detach(),e.createDeck(),e.updateSectionScroll(),e.options.multiple&&$(this).appendTo(e.$controlContainer);});},i.prototype.getValue=function(){for(var t=[],e=this,i=this.options.params,o=0;o<this.controls[this.CONTROL_KEY].length;o++){t[o]={},i.forEach(function(i){e.controls[e.CONTROL_KEY][o][i.attr]&&(t[o][i.attr]=e.controls[e.CONTROL_KEY][o][i.attr].getValue());});}return t;},i.prototype.configureScalingControls=function(){if(this.getScalingValue())for(var t,e=0;e<this.controls[this.CONTROL_KEY].length;e++){t=$(this.$controlContainer.find(".method")[e]),this._createDeckDetailControls(t,"scale-type",e),this._createDeckDetailControls(t,"scale",e);}else for(e=0;e<this.controls[this.CONTROL_KEY].length;e++){this.$deckElem[e]["scale-type"]&&this.$deckElem[e].scale&&(this.$deckElem[e]["scale-type"].remove(),delete this.controls[this.CONTROL_KEY][e]["scale-type"],this.$deckElem[e].scale.remove(),delete this.controls[this.CONTROL_KEY][e].scale);}this.updateSectionScroll();},i.prototype.getScalingValue=function(){if(this.caller.controls.method.scaling){var t=this.caller.controls.method.scaling.getValue();return t&&"true"==t.scaling;}return!1;},i.prototype.updateSectionScroll=function(){},i.prototype.getLabel=function(){},t.VA.Core.Editors.Sheet.Controls.Optimization.BaseMultipleDeck=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;var i="constraints-column";function o(t,i){e.constructor.call(this,t,i);}o.prototype=Object.create(e),o.prototype.constructor=o,o.Label="Constraints",o.prototype.init=function(){e.init.call(this),this.CONTROL_KEY=i;},o.prototype.createControl=function(){var t=this,e=this.caller,n=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-textareacontrol"/>');e.addPropertyControl(o.Label,function(e){e.append(n);t.controls[i]=t.createTextAreaControl(n,{disabled:!0}),t.controls[i].setValue=function(t){if(t)n.val(t.map(function(t){return t.name;}).join("\n"));},t.controls[i].getValue=function(){return n.val();};},{mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization[i]=o;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.BaseMultipleDeck.prototype;var i="name",o="type",n="target",r="min",a="max",s="scale";function l(t,i){e.constructor.call(this,t,i);}l.prototype=Object.create(e),l.prototype.constructor=l,l.Label="Constraints",l.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="constraints";var t=[{Key:i,Label:"Name"},{Key:o,Label:"Type",Default:"inequality",Source:[{label:"Inequality",value:"inequality"},{label:"Equality",value:"equality"}]},{Key:n,Label:"Target",Default:"0",NumberType:"double"},{Key:r,Label:"Min",Default:"-1.e+30",NumberType:"double"},{Key:a,Label:"Max",Default:"0",NumberType:"double"},{Key:"scale-type",Label:"Scale Type",Default:"none",Source:["none","value","auto","log"]},{Key:s,Label:"Scale",Default:"1",NumberType:"double"}];this.registerSpec(t),this.controls.constraints=[],this.$deckElem=[];},l.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(this.getLabel(),function(e){t.$controlContainer=e;},{propertyControlParent:t.getSection(l.Section),mandatory:t.options.isMandatory}),this.createAddButton();},l.prototype.createDeck=function(t){var e=$('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');this.$controlContainer.append(e);var n=this.controls.constraints?this.controls.constraints.length:0;this.createDeleteButton(e),this._createDeckDetailControls(e,i,n),this._createDeckDetailControls(e,o,n);},l.prototype.configureControls=function(t,e,i,l){this._removeControls(e,l),e==o&&("equality"==i?this._createDeckDetailControls(t,n,l):"inequality"==i&&(this._createDeckDetailControls(t,r,l),this._createDeckDetailControls(t,a,l)),this.getScalingValue()&&(this._createDeckDetailControls(t,"scale-type",l),this._createDeckDetailControls(t,s,l)));},l.prototype._createDeckDetailControls=function(t,e,l){var c={};this.controls.constraints[l]||(this.controls.constraints[l]={},this.$deckElem[l]={});var d=this.options.params.find(function(t){return e==t.attr;});void 0!==d?(c=$.extend(!0,{target:this.$deckElem[l],control:this.controls.constraints[l]},d),e===o||"scale-type"===e?this.createDeckDropdownControl(t,c,l):e===i?this.createDeckInputControl(t,c,l):[n,r,a,s].includes(e)&&this.createDeckNumberInputControl(t,c,l)):console.warn(e+" is not defined in json");},l.prototype._removeControls=function(t,e){if(t==o)for(var n in $.extend(!0,{},this.$deckElem[e])){n==t||[i,o].includes(n)||(this.$deckElem[e][n].remove(),delete this.$deckElem[e][n],delete this.controls.constraints[e][n]);}},l.prototype.updateSectionScroll=function(){this.getSection(l.Section).perfectScrollbar("update");},l.prototype.getLabel=function(){return l.Label;},t.VA.Core.Editors.Sheet.Controls.Optimization.constraints=l;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;var i="convergence-tolerance";function o(t,i){e.constructor.call(this,t,i);}o.prototype=Object.create(e),o.prototype.constructor=o,o.Label="Convergence Tolerance",o.Section="left",o.prototype.init=function(){e.init.call(this),this.CONTROL_KEY=i;},o.prototype.createControl=function(){var t=this,e=this.caller,n=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');e.addPropertyControl(o.Label,function(o){o.append(n);t.controls[i]=e.createNumberInput(n,{placeholder:"1.e-4",numberType:"double"});},{propertyControlParent:t.getSection(o.Section),mandatory:t.options.isMandatory}),this.bindValidation({$target:n,control:this.controls[i],label:o.Label});},t.VA.Core.Editors.Sheet.Controls.Optimization[i]=o;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Dace Type",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="dace-type",this.Source=[{label:"Random",value:"random"},{label:"Grid Sampling",value:"grid_sampling"},{label:"Orthogonal Array",value:"orthogonal_array"},{label:"Orthogonal Array Latin Hypercube Sampling",value:"orthogonal_array_latin_hypercube_sampling"},{label:"Latin Hypercube Sampling",value:"latin_hypercube_sampling"},{label:"Box Behnken",value:"box_behnken"},{label:"Central Composite",value:"central_composite"}];},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createDropDownControl(e,{source:t.options.source||t.Source});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["dace-type"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Distribution",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="distribution",this.Source=[{label:"Cumulative",value:"cumulative"},{label:"Complementary",value:"complementary"}];},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createDropDownControl(e,{source:t.options.source||t.Source});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization.distribution=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Gen Reliability Levels",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="gen-reliability-levels";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createInputControl(e,{maxLength:1e3,placeHolder:"ex) '[[0.1,0.2], [0.3,0.4]]"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["gen-reliability-levels"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Gradient",i.Section="right",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="gradient",this.Default="no_gradient",this.Source=[{label:"No Gradient",value:"no_gradient"},{label:"Numerical Gradient",value:"numerical_gradient"}],this.controls.gradient=[];},i.prototype.createControl=function(){var t=this,e=this.caller,o=(this.options.source,void 0!==this.options.value?this.options.value:this.Default);e.addPropertyControl(i.Label,function(e){t.createRadioButtonControl(e,{disabled:t.options.disabled,source:t.options.source||t.Source,value:o});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization.gradient=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Hessian",i.Section="right",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="hessian",this.Default="no_hessian",this.Source=[{label:"No Hessian",value:"no_hessian"},{label:"Numerical Hessian",value:"numerical_hessian"}],this.controls.hessian=[];},i.prototype.createControl=function(){var t=this,e=this.caller,o=(this.options.source,void 0!==this.options.value?this.options.value:this.Default);e.addPropertyControl(i.Label,function(e){t.createRadioButtonControl(e,{disabled:t.options.disabled,source:t.options.source||t.Source,value:o});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization.hessian=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="List",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="list";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createInputControl(e,{maxLength:1e3,placeHolder:"ex) {'x1':[0.4, 0.5, 1.2, 3], 'x2':[6, 7, 8, 9]}"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization.list=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="List Type",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="list-type",this.Source=[{label:"Val List",value:"val_list"}],this.controls["list-type"]={};},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createDropDownControl(e,{source:t.options.source||t.Source});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["list-type"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Max Evaluations",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="max-evaluations";},i.prototype.createControl=function(){var t=this,e=this.caller,o=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');e.addPropertyControl(i.Label,function(i){i.append(o);t.controls["max-evaluations"]=e.createNumberInput(o,{placeholder:1e3,numberType:"int"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory}),this.bindValidation({$target:o,control:this.controls["max-evaluations"],label:i.Label});},t.VA.Core.Editors.Sheet.Controls.Optimization["max-evaluations"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Max Iterations",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="max-iterations";},i.prototype.createControl=function(){var t=this,e=this.caller,o=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');e.addPropertyControl(i.Label,function(i){i.append(o);t.controls["max-iterations"]=e.createNumberInput(o,{placeholder:100,numberType:"int"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory}),this.bindValidation({$target:o,control:this.controls["max-iterations"],label:i.Label});},t.VA.Core.Editors.Sheet.Controls.Optimization["max-iterations"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Model",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="model";var t=[{Key:"surr-approximation",Label:"Approximation",Default:"gaussian_process",Source:[{label:"Gaussian Process",value:"gaussian_process"},{label:"Mars",value:"mars"},{label:"Moving Least Squares",value:"moving_least_squares"},{label:"Radial Basis",value:"radial_basis"},{label:"Neural Network",value:"neural_network"},{label:"Polynomial",value:"polynomial"}]},{Key:"surr-training-points",Label:"Training Points",Source:[{label:"Total Points",value:"total_points"},{label:"Minimum Points",value:"minimum_points"},{label:"Recommended Points",value:"recommended_points"}]},{Key:"max-nodes",Label:"Max Nodes"},{Key:"polynomial-order-type",Label:"Polynomial Order Type",Source:[{label:"Cubic",value:"cubic"},{label:"Basis Order",value:"basis_order"},{label:"Linear",value:"linear"},{label:"Quadratic",value:"quadratic"}]},{Key:"basis-order",Label:"Basis Order"},{Key:"total-point",Label:"Total Point"}];this.registerSpec(t),this.controls.model={},this.deckControl={};},i.prototype.createControl=function(){var t=this,e=this.caller;this.$mainControl=e.addPropertyControl(i.Label,function(e){t.$controlContainer=e;},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},i.prototype.createDeck=function(t){var e=$('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');this.$controlContainer.append(e),this._createDeckDetailControls(e);},i.prototype._createDeckDetailControls=function(t,e){var i,o;e?(o=this.options.params.find(function(t){return e==t.attr;}),i=e):i=(o=this.options.params[0]).attr,o.target=this.deckControl,"surr-approximation"===i||"surr-training-points"===i||"polynomial-order-type"===i?this.createDeckDropdownControl(t,o):"max-nodes"!==i&&"basis-order"!==i&&"total-point"!==i||this.createDeckNumberInputControl(t,o);},i.prototype.configureControls=function(t,e,i){this._removeControls(e),"surr-approximation"==e?["mars","moving_least_squares","radial_basis"].includes(i)?this._createDeckDetailControls(t,"surr-training-points"):"neural_network"==i?this._createDeckDetailControls(t,"max-nodes"):"polynomial"==i&&this._createDeckDetailControls(t,"polynomial-order-type"):"surr-training-points"==e?"total_points"==i&&this._createDeckDetailControls(t,"total-point"):"polynomial-order-type"==e&&"basis_order"==i&&this._createDeckDetailControls(t,"basis-order");},i.prototype._removeControls=function(t){var e=$.extend(!0,{},this.deckControl);for(var i in e){i!=t&&"surr-approximation"!=i&&(this.deckControl[i].remove(),delete this.controls.model[i]);}},i.prototype.renderControl=function(){var t=this;(this.controls.model&&this.createDeck(),this.options.value)&&this.options.params.forEach(function(e){t.controls.model[e.attr]&&t.options.value[e.attr]&&t.controls.model[e.attr].setValue(t.options.value[e.attr]);});},i.prototype.getValue=function(){var t={},e=this;return this.options.params.forEach(function(i){e.controls.model&&e.controls.model[i.attr]&&(t[i.attr]=e.controls.model[i.attr].getValue());}),t;},i.prototype.removeControl=function(){this.$mainControl&&(delete this.controls.model,this.$mainControl.remove());},t.VA.Core.Editors.Sheet.Controls.Optimization.model=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Mpp Search",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="mpp-search",this.Source=[{label:"None",value:"none"},{label:"X Taylor Mean",value:"x_taylor_mean"},{label:"U Taylor Mean",value:"u_taylor_mean"},{label:"X Taylor Mpp",value:"x_taylor_mpp"},{label:"U Taylor Mpp",value:"u_taylor_mpp"},{label:"X Two Point",value:"x_two_point"},{label:"U Two Point",value:"u_two_point"},{label:"No Approx",value:"no_approx"}],this.controls["mpp-search"]={};},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createDropDownControl(e,{source:t.options.source||t.Source});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["mpp-search"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Num Delta",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="num-delta";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createNumberArrayControl(e,{value:t.options.value});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["num-delta"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Num Step",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="num-step";},i.prototype.createControl=function(){var t=this,e=this.caller,o=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');e.addPropertyControl(i.Label,function(i){i.append(o);t.controls["num-step"]=e.createNumberInput(o,{min:1,max:1e3,placeholder:100,numberType:"int"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory}),this.bindValidation({$target:o,control:this.controls["num-step"],label:i.Label});},t.VA.Core.Editors.Sheet.Controls.Optimization["num-step"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;var i="objectives-column";function o(t,i){e.constructor.call(this,t,i);}o.prototype=Object.create(e),o.prototype.constructor=o,o.Label="Objectives",o.prototype.init=function(){e.init.call(this),this.CONTROL_KEY=i;},o.prototype.createControl=function(){var t=this,e=this.caller,n=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-textareacontrol"/>');e.addPropertyControl(o.Label,function(e){e.append(n);t.controls[i]=t.createTextAreaControl(n,{disabled:!0}),t.controls[i].setValue=function(t){if(t)n.val(t.map(function(t){return t.name;}).join("\n"));},t.controls[i].getValue=function(){return n.val();};},{mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization[i]=o;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.BaseMultipleDeck.prototype;var i="scale-type",o="scale";function n(t,i){e.constructor.call(this,t,i);}n.prototype=Object.create(e),n.prototype.constructor=n,n.Label="Objectives",n.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="objectives";var t=[{Key:"name",Label:"Name"},{Key:"sense",Label:"Sense",Default:"minimize",Source:[{label:"Maximize",value:"maximize"},{label:"Minimize",value:"minimize"}]},{Key:i,Label:"Scale Type",Default:"none",Source:[{label:"None",value:"none"},{label:"Value",value:"value"},{label:"Log",value:"log"}]},{Key:o,Label:"Scale",NumberType:"double",Default:"1.0"}];this.registerSpec(t),this.controls.objectives=[],this.$deckElem=[];},n.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(this.getLabel(),function(e){t.$controlContainer=e;},{propertyControlParent:t.getSection(n.Section),mandatory:t.options.isMandatory}),this.createAddButton();},n.prototype.createDeck=function(){var t=$('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');this.$controlContainer.append(t);var e=this.controls.objectives?this.controls.objectives.length:0;this.createDeleteButton(t);for(var n,r=this.getScalingValue(),a=0;a<this.options.params.length;a++){n=this.options.params[a],!r&&[i,o].includes(n.attr)||this._createDeckDetailControls(t,n.attr,e);}},n.prototype._createDeckDetailControls=function(t,e,n){var r={};this.controls.objectives[n]||(this.controls.objectives[n]={},this.$deckElem[n]={});var a=this.options.params.find(function(t){return e==t.attr;});void 0!==a?(r=$.extend(!0,{target:this.$deckElem[n]},a),"sense"===e||e===i?this.createDeckDropdownControl(t,r,n):"name"===e?this.createDeckInputControl(t,r,n):e===o&&this.createDeckNumberInputControl(t,r,n)):console.warn(e+" is not defined in json");},n.prototype.updateSectionScroll=function(){this.getSection(n.Section).perfectScrollbar("update");},n.prototype.getLabel=function(){return n.Label;},t.VA.Core.Editors.Sheet.Controls.Optimization.objectives=n;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Parameters",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="parameters";},i.prototype.createControl=function(){var t=this,e=this.caller,o=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-columnlist"/>');e.addPropertyControl(i.Label,function(n){n.append(o);t.controls.parameters=e.createColumnList(o,{maxRowCount:3,multiple:!0}),t.controls.parameters.setValue=function(e){this.setSelectedItems(e),t.bindValidation({$target:o,control:t.controls.parameters,label:i.Label});},t.controls.parameters.getValue=function(){return this.getSelectedItems();};},{mandatory:t.options.isMandatory}),e.registerColumnControl(t.controls.parameters);},i.prototype.bindValidation=function(t){var e=this;void 0!==t.$target&&(t.mandatory||this.options.isMandatory)&&(this.checkValidation(t),t.control.onChange(function(i){e.checkValidation(t);}));},t.VA.Core.Editors.Sheet.Controls.Optimization.parameters=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Partition",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="partition";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createNumberArrayControl(e,{placeHolder:"ex) 5,5",value:t.options.value});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization.partition=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Probability Levels",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="probability-levels";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createInputControl(e,{maxLength:1e3,placeHolder:"ex) '[[0.1,0.2], [0.3,0.4]]"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["probability-levels"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Reliability Levels",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="reliability-levels";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createInputControl(e,{maxLength:1e3,placeHolder:"ex) '[[0.1,0.2], [0.3,0.4]]"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["reliability-levels"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Response Levels",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="response-levels";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createInputControl(e,{maxLength:1e3,placeHolder:"ex) '[[0.1,0.2], [0.3,0.4]]"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["response-levels"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Sample Type",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="sample-type",this.Source=[{label:"Latin Hypercube Sampling",value:"latin_hypercube_sampling"},{label:"Random",value:"random"}],this.controls["sample-type"]={};},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createDropDownControl(e,{source:t.options.source||t.Source});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["sample-type"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Samples",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="samples";},i.prototype.createControl=function(){var t=this,e=this.caller,o=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');e.addPropertyControl(i.Label,function(i){i.append(o);t.controls.samples=e.createNumberInput(o,{placeholder:"0",numberType:"int"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory}),this.bindValidation({$target:o,control:this.controls.samples,label:i.Label});},t.VA.Core.Editors.Sheet.Controls.Optimization.samples=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Scaling",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="scaling",this.Default="false",this.Source=[{label:"True",value:"true"},{label:"False",value:"false"}],this.controls.scaling=[];},i.prototype.createControl=function(){var t=this,e=this.caller,o=(this.options.source,void 0!==this.options.value?this.options.value:this.Default);e.addPropertyControl(i.Label,function(e){t.createRadioButtonControl(e,{source:t.options.source||t.Source,value:o});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},i.prototype.configureControls=function(t,e,i){this.caller.controls.objectives.configureScalingControls(),this.caller.controls.constraints.configureScalingControls();},t.VA.Core.Editors.Sheet.Controls.Optimization.scaling=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Seed",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="seed";},i.prototype.createControl=function(){var t=this,e=this.caller,o=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');e.addPropertyControl(i.Label,function(i){i.append(o);t.controls.seed=e.createNumberInput(o,{placeholder:"Random",numberType:"int"});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory}),this.bindValidation({$target:o,control:this.controls.seed,label:i.Label});},t.VA.Core.Editors.Sheet.Controls.Optimization.seed=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Sequence Type",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="sequence-type",this.Source=[{label:"Halton",value:"halton"},{label:"Hammersley",value:"hammersley"}],this.controls["sequence-type"]={};},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createDropDownControl(e,{source:t.options.source||t.Source});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["sequence-type"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Step Size",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="step-size";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createNumberArrayControl(e);},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["step-size"]=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Submethod",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="submethod";var t=[{Key:"method-name",Label:"Method Name",Source:[{label:"Conmin Frcg",value:"conmin_frcg"},{label:"Conmin Mfd",value:"conmin_mfd"},{label:"Optpp Fd Newton",value:"optpp_fd_newton"},{label:"Optpp G Newton",value:"optpp_g_newton"},{label:"Optpp Newton",value:"optpp_newton"},{label:"Optpp Pds",value:"optpp_pds"},{label:"Coliny Cobyla",value:"coliny_cobyla"},{label:"Coliny Solis Wets",value:"coliny_solis_wets"},{label:"Ncsu Direct",value:"ncsu_direct"},{label:"Soga",value:"soga"},{label:"Moga",value:"moga"},{label:"Asynch Pattern Search",value:"asynch_pattern_search"},{label:"Coliny Pattern Search",value:"coliny_pattern_search"},{label:"Coliny Direct",value:"coliny_direct"},{label:"Coliny Ea",value:"coliny_ea"},{label:"Efficient Global",value:"efficient_global"}]},{Key:"max-iterations",Default:"100",Label:"Max Iterations"}];this.registerSpec(t),this.controls.submethod={};},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.$controlContainer=e;},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},i.prototype.createDeck=function(t){var e=$('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');this.$controlContainer.append(e),this._createDeckDetailControls(e);},i.prototype._createDeckDetailControls=function(t){var e=this;this.options.params.forEach(function(i){"method-name"===i.attr?e.createDeckDropdownControl(t,i):e.createDeckNumberInputControl(t,i);});},i.prototype.renderControl=function(){var t=this;(this.createDeck(),this.options.value)&&this.options.params.forEach(function(e){t.controls.submethod[e.attr].setValue(t.options.value[e.attr]);});},i.prototype.getValue=function(){var t={},e=this;return this.options.params.forEach(function(i){t[i.attr]=e.controls.submethod[i.attr].getValue();}),t;},t.VA.Core.Editors.Sheet.Controls.Optimization.submethod=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Surrogate",i.Section="right",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="surrogate";var t=[{Key:"type",Label:"Surrogate",Default:"false",Source:[{label:"True",value:"true"},{label:"False",value:"false"}]},{Key:"submethod",Label:"Surrogate Method"},{Key:"method-name",Label:"Method Name",Source:[{label:"Sampling",value:"sampling"},{label:"Dace",value:"dace"}]},{Key:"sample-type",Label:"Sample Type",Source:[{label:"Latin Hypercube Sampling",value:"latin_hypercube_sampling"},{label:"Random",value:"random"}]},{Key:"dace-type",Label:"Dace Type",Source:[{label:"Random",value:"random"},{label:"Grid Sampling",value:"grid_sampling"},{label:"Orthogonal Array",value:"orthogonal_array"},{label:"Orthogonal Array Latin Hypercube Sampling",value:"orthogonal_array_latin_hypercube_sampling"},{label:"Latin Hypercube Sampling",value:"latin_hypercube_sampling"},{label:"Box Behnken",value:"box_behnken"},{label:"Central Composite",value:"central_composite"}]},{Key:"samples",Label:"Samples",Default:"Random"},{Key:"seed",Label:"Seed",Default:"Random"}];this.registerSpec(t),this.controls.surrogate={};},i.prototype.createControl=function(){this.options.isMandatory?(this._createModelControl(),this._createMethodControl()):this._createTypeControl();},i.prototype._createTypeControl=function(){var t=this,e=this.caller;this.options.source,void 0!==this.options.value?this.options.value.type:this.PARAM_INFO.type.Default;e.addPropertyControl(i.Label,function(e){t.createRadioButtonControl(e,{source:t.options.source||t.PARAM_INFO.type.Source,attr:"type",control:t.controls.surrogate});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},i.prototype._createModelControl=function(){this.options.params.some(function(t){return"model"==t.attr;})&&this.caller._createObjectArrayControl("model");},i.prototype._createMethodControl=function(){var t=this;this.$deckElem={},this.controls.surrogate.submethod={};var e=this.caller;this.$deckControlWrapper=e.addPropertyControl(t.PARAM_INFO.submethod.Label,function(e){var i=$('<div class = "brtc-va-editors-sheet-controls-propertycontrol-deck method"/>');e.append(i),t._createDeckDetailControls(i,"method-name");},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},i.prototype.configureControls=function(t,e,i){this._removeControls(e),"type"==e?"true"==i?(this._createModelControl(),this._renderModelControl(),this._createMethodControl()):(this.$deckControlWrapper&&(this.$deckControlWrapper.remove(),delete this.controls.surrogate.submethod),this.caller.controls.model&&this.caller.controls.model.removeControl()):"method-name"==e?"sampling"==i?this._createDeckDetailControls(t,"sample-type"):this._createDeckDetailControls(t,"dace-type"):(this._createDeckDetailControls(t,"samples"),this._createDeckDetailControls(t,"seed"));},i.prototype._createDeckDetailControls=function(t,e){var i=this.options.params.find(function(t){return e==t.attr;}),o=$.extend(!0,{target:this.$deckElem,control:this.controls.surrogate.submethod},i);"method-name"===e||"sample-type"===e||"dace-type"===e?this.createDeckDropdownControl(t,o):this.createDeckNumberInputControl(t,o);},i.prototype._removeControls=function(t){if(this.$deckControlWrapper){var e=$.extend(!0,{},this.$deckElem);for(var i in e){i!=t&&"method-name"!=i&&(this.$deckElem[i].remove(),delete this.$deckElem[i],delete this.controls.surrogate.submethod[i]);}}},i.prototype.getValue=function(){var t={},e=this.options.params,i=this.controls.surrogate;return e.forEach(function(e){"type"==e.attr?t[e.attr]=i[e.attr]?i[e.attr].getValue():"true":i.submethod&&i.submethod[e.attr]&&(t[e.attr]=i.submethod[e.attr].getValue());}),t;},i.prototype.renderControl=function(){this.options.isMandatory?(this._renderModelControl(),this._renderMethodControl()):(this._renderTypeControl(),this._renderMethodControl());},i.prototype._renderTypeControl=function(){var t=this.PARAM_INFO.type.Default;this.options.value&&this.options.value.type&&(t=this.options.value.type),this.controls.surrogate.type&&this.controls.surrogate.type.setValue(t);},i.prototype._renderModelControl=function(){this.options.params.some(function(t){return"model"==t.attr;})&&this.caller._renderObjectArrayControl("model");},i.prototype._renderMethodControl=function(){var t,e=this,i=this.options.params,o=this.controls.surrogate;i.forEach(function(i){"type"!=i.attr&&"model"!=i.attr&&o.submethod&&o.submethod[i.attr]&&e.options.value&&e.options.value[i.attr]&&(t=e.options.value[i.attr],o.submethod[i.attr].setValue(t));});},t.VA.Core.Editors.Sheet.Controls.Optimization.surrogate=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Vector",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="vector";},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createNumberArrayControl(e,{value:t.options.value});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization.vector=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Controls.Optimization.Base.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.Label="Vector Type",i.Section="left",i.prototype.init=function(){e.init.call(this),this.CONTROL_KEY="vector-type",this.Source=[{label:"Final Val",value:"final_val"},{label:"Step Size",value:"step_size"}],this.controls["vector-type"]={};},i.prototype.createControl=function(){var t=this;this.caller.addPropertyControl(i.Label,function(e){t.createDropDownControl(e,{source:t.options.source||t.Source});},{propertyControlParent:t.getSection(i.Section),mandatory:t.options.isMandatory});},t.VA.Core.Editors.Sheet.Controls.Optimization["vector-type"]=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.panelId=_.uniqueId(),this.options=e,this.FnUnitUtils=brtc_require("FnUnitUtils"),this.retrieveParent(),this.registerProblemListener(),this.registerCommandListener(),this.createControls(),this.configureOptions(),this.init();}e.prototype.init=function(){this.$mainControl.attr("type",this.options.type);},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId),this.options.modelEditor||(this.options.modelEditor=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$parent));},e.prototype.registerScrollListener=function(){},e.prototype.registerProblemListener=function(){},e.prototype.registerCommandListener=function(){},e.prototype.createControls=function(){var t=this;this.$mainControl=$('<div class="brtc-va-editors-sheet-panels-basepanel"/>'),this.$parent.append(this.$mainControl),this.createTopArea(),this.createContentsArea(),this.createBottomArea(),this.$topArea&&this.createTopAreaControls(this.$topArea),this.$bottomArea&&this.createBottomAreaControls(this.$bottomArea),this.$contentsArea&&(this.createContentsAreaControls(this.$contentsArea),this.$contentsArea.hasClass("brtc-va-editors-sheet-panels-propertiespanel-contents-area")&&this.$contentsArea.perfectScrollbar());var e=this.$topArea.find(".brtc-va-editors-sheet-panels-basepanel-header-tooltip");e.click(function(){"auto"===e.attr("persist-mode")?(e.attr("persist-mode","true"),t.options.fnUnit["persist-mode"]="true"):"true"===e.attr("persist-mode")?(e.attr("persist-mode","false"),t.options.fnUnit["persist-mode"]="false"):(e.attr("persist-mode","auto"),t.options.fnUnit["persist-mode"]="auto");var i={"persist-mode":t.options.fnUnit["persist-mode"]},o=t.createSetFnUnitCommand(i);t.executeCommand(o);});},e.prototype.destroy=function(){},e.prototype.createTopAreaHeaderTitle=function(t){this.$header=$('<div class="brtc-va-editors-sheet-panels-basepanel-header brtc-va-editors-sheet-panels-datapanel-header">   <div class="brtc-va-editors-sheet-worksheet-selector"></div>   <div class="brtc-va-editors-sheet-panels-basepanel-header-container">       <div class="brtc-va-editors-sheet-panels-basepanel-header-title" />   </div></div>'),this.$header.find(".brtc-va-editors-sheet-panels-basepanel-header-title").attr("title",this.options.title),t.append(this.$header);},e.prototype.createMinMaxToolItem=function(t){var e=this;this.$minMaxButton=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-maximize" title="Max/Min"></div>'),this.$minMaxButton.attr("maximize","false"),t.append(this.$minMaxButton);var i=this.$parent.closest(".brtc-va-editors-sheet-fnunitviewer").find(".brtc-va-editors-sheet-fnunitviewer-indata-fncenter"),o=this.$parent.closest(".brtc-va-editors-sheet-fnunitviewer").find(".brtc-va-editors-sheet-fnunitviewer-outdata-fncenter");"in"===e.options.panelType&&"none"===o.css("display")?this.adjustMaximize(!0):"out"===e.options.panelType&&"none"===i.css("display")&&this.adjustMaximize(!0),this.$minMaxButton.on("click",function(t){"true"===$(this).attr("maximize")?e.adjustMaximize(!1):e.adjustMaximize(!0),e.$parent.trigger("sizeChange",[e.options.panelType]);}),this.$minMaxButton.css("display",this.options.resizable?"block":"none");},e.prototype.adjustMaximize=function(t){t?this.$minMaxButton.removeClass("brtc-va-editors-sheet-panels-datapanel-toolitem-maximize").addClass("brtc-va-editors-sheet-panels-datapanel-toolitem-minimize").attr("maximize","true"):this.$minMaxButton.removeClass("brtc-va-editors-sheet-panels-datapanel-toolitem-minimize").addClass("brtc-va-editors-sheet-panels-datapanel-toolitem-maximize").attr("maximize","false");},e.prototype.adjustHeader=function(){},e.prototype.createTopArea=function(){this.$topArea=$('<div class="brtc-va-editors-sheet-panels-basepanel-top-area"></div>'),this.$mainControl.append(this.$topArea);},e.prototype.createContentsArea=function(){this.$contentsArea=$('<div class="brtc-va-editors-sheet-panels-basepanel-contents-area" ></div>'),this.$mainControl.append(this.$contentsArea);},e.prototype.createBottomArea=function(){this.$bottomArea=$('<div class="brtc-va-editors-sheet-panels-basepanel-bottom-area"></div>'),this.$mainControl.append(this.$bottomArea);},e.prototype.createTopAreaControls=function(t){var e=$('<div class="brtc-va-editors-sheet-panels-basepanel-header">   <div class="brtc-va-editors-sheet-panels-basepanel-header-tooltip" item-type="persist" persist-mode="auto"><i title="Persist" class="fa fa-hdd-o" style="font-size: 1.5em;" aria-hidden="true"></i></div>   <div class="brtc-va-editors-sheet-panels-basepanel-header-title"></div></div>');return e.find(".brtc-va-editors-sheet-panels-basepanel-header-title").text(this.options.title),t.append(e),e;},e.prototype.createContentsAreaControls=function(t){},e.prototype.createBottomAreaControls=function(t){},e.prototype.configureOptions=function(){},e.prototype.configureRunnable=function(){},e.prototype.hideCallFunctionButton=function(){},e.prototype.setInOutData=function(){},e.prototype.hideTopArea=function(){this.$topArea.hide();},e.prototype.hideBottomArea=function(){this.$bottomArea.hide();},e.prototype.renderFail=function(t,e){var i=$('<div class="brtc-va-editors-sheet-panels-basepanel-fail"><h3></h3></div>');t.append(i),i.addClass("brtc-style-full").addClass("brtc-style-flex-center"),i.find("h3").text(e);},t.VA.Core.Editors.Sheet.Panels.BasePanel=e;}.call(this),function(){"use strict";var t=this,e=t.Brightics,i=e.VA.Core.Utils.DownLoader;var o={pageNum:1,pageSize:1e3,count:0},n=["scalaScript","pythonScript"];function r(t,i){this.pageOptionsMap={},e.VA.Core.Editors.Sheet.Panels.BasePanel.call(this,t,i),this.createDataWorksheet(),this._setOutTableInfo();}function a(t){this.$parent=t,this.createLayout();}r.prototype=Object.create(e.VA.Core.Editors.Sheet.Panels.BasePanel.prototype),r.prototype.constructor=r,r.prototype.registerCommandListener=function(){var t=this;this.commandListener=function(i){i instanceof e.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand||i instanceof e.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand?t.options.fnUnit.fid===i.options[TARGET_FID]&&t.handleConnectionCommand(i):i instanceof e.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand?t.options.fnUnit.fid!==i.options[TARGET_FID]&&t.options.fnUnit.fid!==i.old[TARGET_FID]||t.handleConnectionCommand(i):i instanceof e.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand?t.options.fnUnit.fid===i.options.fnUnit.fid&&t.handleOutTableCommand(i):i instanceof e.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand?t.options.fnUnit.fid===i.options.fnUnit.fid&&t.handleConnectionCommand(i):i instanceof e.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand?t.options.fnUnit.fid===i.options.fnUnit.fid&&t.handleConnectionCommand(i):i instanceof e.VA.Core.Editors.Diagram.Commands.NewOutTableCommand?t.options.fnUnit.fid===i.options.fnUnit.fid&&t.handleNewOutTableCommand(i):i instanceof e.VA.Core.CompoundCommand&&$.each(i.commandList,function(i,o){o instanceof e.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand||o instanceof e.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand?t.options.fnUnit.fid===o.options[TARGET_FID]&&t.handleConnectionCommand(o):o instanceof e.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand?t.options.fnUnit.fid!==o.options[TARGET_FID]&&t.options.fnUnit.fid!==o.old[TARGET_FID]||t.handleConnectionCommand(o):o instanceof e.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand?t.options.fnUnit.fid===o.options.fnUnit.fid&&-1==n.indexOf(t.options.fnUnit.func)&&t.handleOutTableCommand(o):o instanceof e.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand?t.options.fnUnit.fid===o.options.fnUnit.fid&&t.handleConnectionCommand(o):o instanceof e.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand?t.options.fnUnit.fid===o.options.fnUnit.fid&&t.handleConnectionCommand(o):o instanceof e.VA.Core.Editors.Diagram.Commands.NewOutTableCommand&&t.options.fnUnit.fid===o.options.fnUnit.fid&&t.handleNewOutTableCommand(o);});},this.options.modelEditor.addCommandListener(this.commandListener);},r.prototype.handleOutTableCommand=function(t){this.options.fnUnit.hasOwnProperty("parent")&&t instanceof e.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand&&"out"===this.display.panelType&&(this.initialize(this.display.panelType),this.refreshHeaderToolbar(),this.dataWorksheet.renderDataWorksheet());},r.prototype.handleConnectionCommand=function(t){this.options.fnUnit.hasOwnProperty("parent")&&(t instanceof e.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand||t instanceof e.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand||t instanceof e.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand||t instanceof e.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand||t instanceof e.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand)&&"in"===this.display.panelType&&(this.initialize(this.display.panelType),this.refreshHeaderToolbar(),this.dataWorksheet.renderDataWorksheet());},r.prototype.handleNewOutTableCommand=function(t){this.options.fnUnit.hasOwnProperty("parent")&&t instanceof e.VA.Core.Editors.Diagram.Commands.NewOutTableCommand&&"out"===this.display.panelType&&(this.initialize(this.display.panelType),this.refreshHeaderToolbar(),this.dataWorksheet.renderDataWorksheet());},r.prototype.destroy=function(){this.$worksheetSelector.jqxDropDownList("destroy"),this.$contextMenu.jqxMenu("destroy"),this.pagination&&this.pagination.destroy(),this.dataSchema&&this.dataSchema.destroy(),this.dataWorksheet&&this.dataWorksheet.destroy(),e.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.destroy.call(this),this.options.modelEditor.removeCommandListener(this.commandListener);},r.prototype.initialize=function(t){this.display.tableList=[];var e=this.options.fnUnit.parent();if("in"===t)for(var i=e.getPrevious(this.options.fnUnit.fid),o=0;o<i.length;o++){var n=e.getFnUnitById(i[o]);n&&(this.display.tableList=this.display.tableList.concat(this.FnUnitUtils.getOutTable(n)));}"out"===t&&(this.display.tableList=this.FnUnitUtils.getOutTable(this.options.fnUnit)||[]);},r.prototype._getSelectedTable=function(){return this.selectedTableId?this.selectedTableId:this.display.tableList[0];},r.prototype._isDisposed=function(){return 0===this.$contentsArea.closest(".brtc-va-editors-sheet-fnunitviewer-panel").length;},r.prototype._updatePagination=function(t,e){if(this.pagination){this.pageOptionsMap[t]=this.pageOptionsMap[t]||$.extend(!0,{},o);var i=(this.pageOptionsMap[t].pageNum-1)*this.pageOptionsMap[t].pageSize+1,n=i+e-1;this.pagination.setPageRows(i,n);var r=-1;this.pageOptionsMap[t].count>=0?r=this.pageOptionsMap[t].count:e<this.pageOptionsMap[t].pageSize&&(r=e),this.pagination.setTotalCount(r);}},r.prototype.getChartTypeList=function(){return Object.keys(e.Chart.Registry);},r.prototype.getChartLabelByType=function(t){return e.Chart.Registry[t].Label;},r.prototype.getRenderChart=function(){var t=[],e=this.options.dataProxy.requested,i=Object.keys(e)[0],o="in";if("3.6"===this.options.fnUnit.version){var n=this.options.fnUnit.outputs;if(n)for(var r in n){if(n[r]===i){o="out";break;}}}else{var a=this.options.fnUnit[OUT_DATA];a&&a.indexOf(i)>-1&&(o="out");}var s=this.options.fnUnit.display.sheet[o].partial[0].panel;for(var l in s){t.push(s[l].chartOption.chart.type);}return t;},r.prototype.createRecommendedChartSheet=function(){var i=this,o=this.options.fnUnit.func,n="in"==this.display.panelType?["table"]:t.Brightics.VA.Env.Recommend.NextChart[o]||["table"],r=this.getChartTypeList(),a=this.getRenderChart()[0],s=$('<div class="brtc-va-editors-sheet-panels-basepanel-contents-recommend-area"></div>');this.$contentsArea.empty(),this.$contentsArea.append(s);var l=s.find(".brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box").first();l.addClass("brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box-selected"),i.options.selectedChart=l.find(":first-child").attr("type"),s.append('<div class="brtc-va-editors-sheet-panels-basepanel-contents-recommend-title">Recommended Graph Type</div>');var c=$('<div class="brtc-va-editors-sheet-panels-basepanel-contents-recommend-chart-list"></div>');s.append(c),$.each(n,function(t,o){c.append('<div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box"><div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-icon" type='+o+'></div><div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-text">'+e.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i.getChartLabelByType(o))+"</div></div>");}),s.append('<div class="brtc-va-editors-sheet-panels-basepanel-contents-recommend-title">Available Graph Type</div>');var d=$('<div class="brtc-va-editors-sheet-panels-basepanel-contents-available-chart-list"></div>');s.append(d),$.each(r,function(t,o){d.append('<div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box"><div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-icon" type='+o+'></div><div class="brtc-va-editors-sheet-panels-basepanel-contents-chart-text">'+e.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i.getChartLabelByType(o))+"</div></div>");}),s.find(".brtc-va-editors-sheet-panels-basepanel-contents-chart-icon[type="+a+"]").closest(".brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box").addClass("brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box-selected"),i.options.selectedChart=a,s.slimScroll({color:"#a4bed4",height:"100%"});var p=s.find(".brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box");p.click(function(t){var e=$(t.target);e.hasClass("brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box")||(e=e.closest(".brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box")),p.removeClass("brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box-selected"),e.addClass("brtc-va-editors-sheet-panels-basepanel-contents-chart-icon-box-selected"),i.options.selectedChart=e.find(":first-child").attr("type");}),"true"!==window.useSpark&&$('.brtc-va-editors-sheet-panels-basepanel-contents-chart-icon[type="decisionTreeForBrightics"]').parent().hide();},r.prototype.createBottomAreaControls=function(t){var i=this;this.pagination=new e.Chart.Component.Pagination(t,{pageNum:1,pageSize:1*e.VA.SettingStorage.getValue("editor.datapanel.defaultrowcount"),changed:function changed(t){var n=i._getSelectedTable();i.pageOptionsMap[n]=i.pageOptionsMap[n]||$.extend(!0,{},o),i.pageOptionsMap[n].pageNum=t.pageNum,i.pageOptionsMap[n].pageSize=t.pageSize,i.options.dataProxy.requestPageData(n,function(e,o){!1===i._isDisposed()&&e.data.length>0&&(e.offset=(i.pageOptionsMap[o].pageNum-1)*i.pageOptionsMap[o].pageSize,i.dataWorksheet.updataPageInfo(o,{page:t.pageNum,pageSize:t.pageSize}),i.dataWorksheet.setDataSet(o,e),i._updatePagination(o,e.data.length));},function(t){e.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(t);},i.pageOptionsMap[n].pageNum,i.pageOptionsMap[n].pageSize);}}),this.pagination.$mainControl.find(".bcharts-pagination-showing").hide(),this.pagination.$mainControl.css("float","right"),this.pagination.hide();},r.prototype.setPaginationInfo=function(t){t.page?(!1===t.showPageSelector?this.pagination.showOnlyCount():this.pagination.show(),this.pagination.update({pageNum:t.page,totalCount:t.count,pageSize:t.pageSize,columnCount:t.columns.length}),this.dataSchema.show(),this.dataSchema.update(t),this.selectedTableId=t.tableId,this.pageOptionsMap[t.tableId]=this.pageOptionsMap[t.tableId]||$.extend(!0,{},o),this.pageOptionsMap[t.tableId].count=t.count):(this.pagination.hide(),this.dataSchema.hide());},r.prototype.createDataWorksheet=function(){this.dataWorksheet&&this.dataWorksheet.destroy(),this.$contentsArea.empty();var t=this.$worksheetSelector.jqxDropDownList("getSelectedIndex");0===t?(this.$topArea.attr("sheet-type","partial"),this.dataWorksheet=new e.VA.Core.Editors.Sheet.Controls.DataWorksheet(this.$contentsArea,{selectedChart:this.options.selectedChart||"table",dataProxy:this.options.dataProxy,panelType:this.display.panelType,fnUnit:this.options.fnUnit,callback:{createRecommendedChartSheet:this.createRecommendedChartSheet.bind(this),setPaginationInfo:this.setPaginationInfo.bind(this)}})):1===t&&(this.$topArea.attr("sheet-type","full"),this.dataWorksheet=new e.VA.Core.Editors.Sheet.Controls.BigDataWorksheet(this.$contentsArea,{dataProxy:this.options.dataProxy,panelType:this.display.panelType,fnUnit:this.options.fnUnit,callback:{createRecommendedChartSheet:this.createRecommendedChartSheet.bind(this),setPaginationInfo:this.setPaginationInfo.bind(this)}}));},r.prototype.createContentsArea=function(){this.display={panelType:this.$parent.attr("datapaneltype")||"in"},this.initialize(this.display.panelType);var t=this.$mainControl.find(".brtc-va-editors-sheet-panels-basepanel-contents-area");t.length>0&&t.remove(),this.$infoArea=$('<div class="brtc-va-editors-sheet-panels-basepanel-info-area" />'),this.$contentsArea=$('<div class="brtc-va-editors-sheet-panels-basepanel-contents-area brtc-va-editors-sheet-panels-datapanel-content brtc-style-margin-bottom-3" />'),this.$mainControl.append(this.$infoArea).append(this.$contentsArea);},r.prototype.createTopAreaControls=function(t){this.$header=$('<div class="brtc-va-editors-sheet-panels-basepanel-header brtc-va-editors-sheet-panels-datapanel-header">   <div class="brtc-va-editors-sheet-worksheet-selector"></div>   <div class="brtc-va-editors-sheet-panels-basepanel-header-container">       <div class="brtc-va-editors-sheet-panels-basepanel-header-title" />   </div>   <div title="Chart Context Menu" class="brtc-va-editors-sheet-panels-basepanel-header-context-menu-open" />   <div class="brtc-va-editors-sheet-panels-basepanel-header-context-menu" /></div>'),this.$contextMenuOpen=this.$header.find(".brtc-va-editors-sheet-panels-basepanel-header-context-menu-open"),this.createTopAreaHeaderTitle(t),this.createTopAreaHeaderToolbar(),this.createTopAreaHeaderContext(this.$contextMenuOpen);},r.prototype.createTopAreaHeaderTitle=function(t){var i=this;this.dataSchema=new e.VA.Core.Editors.Sheet.Panels.DataSchema(this.$infoArea),this.dataSchema.hide(),t.append(this.$header),this.$worksheetSelector=this.$header.children(".brtc-va-editors-sheet-worksheet-selector").jqxDropDownList({theme:e.VA.Env.Theme,source:["Partial Rendering","Full Rendering"],width:120,autoDropDownHeight:!0,dropDownWidth:120,selectedIndex:0}),this.$worksheetSelector.on("change",function(t){i.pagination.hide(),i.dataSchema.hide(),i.createDataWorksheet();});},r.prototype.createTopAreaHeaderContext=function(t){this._createTopAreaHeaderContext=this._createTopAreaHeaderContext||function(t){var i=!1,o=this.$toolbar.children(),n=this.$header.find(".brtc-va-editors-sheet-panels-basepanel-header-context-menu");return this.$contextMenu=n,function(){var r=_.filter(o,function(t){return!$(t).hasClass("brtc-va-editors-sheet-panels-datapanel-toolitem-splitter");}),a=r.map(function(t){return function(){t.click();};});i||(n.jqxMenu({theme:e.VA.Env.Theme,width:"120px",height:"100%",autoOpenPopup:!1,mode:"popup",animationHideDuration:0,animationShowDuration:0}),t.click(function(t){n.jqxMenu("open",Math.min(t.clientX,$(window).width()-120),t.clientY);}),n.on("itemclick",function(t){var e=$(t.args.children[0]).attr("index");a[e]();}),i=!0);var s=r.map(function(t,e){return _.template('<span index="${index}" title="${label}">${label}</span>')({label:t.title,index:e});});n.jqxMenu("source",s);};}.call(this,t),this._createTopAreaHeaderContext(t);},r.prototype.createTopAreaHeaderToolbar=function(){var t=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolbar"/>');this.$header.append(t),this.$toolbar=t,this.createPopupToolItem(t),this.createMinMaxToolItem(t),t.append('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-splitter"></div>'),this.createArrangeToolItem(t),t.append('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-splitter"></div>'),this.createDownloadItem(t),t.find(".brtc-va-editors-sheet-panels-datapanel-toolitem-splitter:eq(0)").css("display",this.options.resizable?"block":"none");},r.prototype.createMinMaxToolItem=function(t){var e=this;this.$minMaxButton=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-maximize" title="Max/Min"></div>'),this.$minMaxButton.attr("maximize","false"),t.append(this.$minMaxButton);var i=this.$parent.closest(".brtc-va-editors-sheet-fnunitviewer").find(".brtc-va-editors-sheet-fnunitviewer-indata-fncenter"),o=this.$parent.closest(".brtc-va-editors-sheet-fnunitviewer").find(".brtc-va-editors-sheet-fnunitviewer-outdata-fncenter");"in"===e.display.panelType&&"none"===o.css("display")?this.adjustMaximize(!0):"out"===e.display.panelType&&"none"===i.css("display")&&this.adjustMaximize(!0),this.$minMaxButton.on("click",function(t){"true"===$(this).attr("maximize")?e.adjustMaximize(!1):e.adjustMaximize(!0),e.$parent.trigger("sizeChange",[e.display.panelType]);}),this.$minMaxButton.css("display",this.options.resizable?"block":"none");},r.prototype.adjustMaximize=function(t){t?this.$minMaxButton.removeClass("brtc-va-editors-sheet-panels-datapanel-toolitem-maximize").addClass("brtc-va-editors-sheet-panels-datapanel-toolitem-minimize").attr("maximize","true"):this.$minMaxButton.removeClass("brtc-va-editors-sheet-panels-datapanel-toolitem-minimize").addClass("brtc-va-editors-sheet-panels-datapanel-toolitem-maximize").attr("maximize","false");},r.prototype.createArrangeToolItem=function(t){var e=this,i=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-arrange-evenly" title="Evenly"></div>');t.append(i),i.on("click",function(t){e.dataWorksheet.arrange("evenly");});var o=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-arrange-stacked" title="Horizontal"></div>');t.append(o),o.on("click",function(t){e.dataWorksheet.arrange("horizontal");});var n=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-arrange-side-by-side" title="Vertical"></div>');t.append(n),n.on("click",function(t){e.dataWorksheet.arrange("vertical");});},r.prototype.createPopupToolItem=function(t){var i=this,o=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-popup" title="Pop up Chart" target="popupChart"></div>');t.append(o);o.click(function(){var t,o,n,r=e.VA.Core.Utils.WidgetUtils.getModelEditorRef(i.$mainControl),a=(t=i.FnUnitUtils.getTable(i.options.fnUnit,i.options.panelType),o=[],n=[],t.forEach(function(t){i.pageOptionsMap[t]?(o.push((i.pageOptionsMap[t].pageNum-1)*i.pageOptionsMap[t].pageSize),n.push(i.pageOptionsMap[t].pageSize)):(o.push(0),n.push(1e3));}),{offsetArr:o,limitArr:n}),s={user:e.VA.Env.Session.userId,pid:r.options.editorInput.getProjectId(),mid:i.options.fnUnit.parent().mid,fid:i.options.fnUnit.fid,tids:i.FnUnitUtils.getTable(i.options.fnUnit,i.options.panelType),offsetArr:a.offsetArr,limitArr:a.limitArr},l=$.map(s,function(t,e){return e+"="+t;}).join("&");window.open("popupchart?"+l,"popupChart");});},r.prototype.onSetDataWorksheetInform=function(t){var i=new e.VA.Core.CompoundCommand(this,{id:"brightics.va.editors.diagram.commands.setdataworksheetimformation"});i.add(this.createSetDataWorksheetPanelCommand(t.panel)),i.add(this.createSetDataWorksheetLayoutCommand(t.layout)),this.executeCommand(i);},r.prototype.createSetDataWorksheetPanelCommand=function(t){return new e.VA.Core.Editors.Diagram.Commands.SetDataWorksheetPanelCommand(this,{panel:this.options.fnUnit.display.sheet[this.display.panelType][0].panel,newPanel:t});},r.prototype.createSetDataWorksheetLayoutCommand=function(t){return new e.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand(this,{layout:this.options.fnUnit.display.sheet[this.display.panelType][0].layout,newLayout:t});},r.prototype.executeCommand=function(t){e.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl).getCommandManager().execute(t);},r.prototype.createDownloadItem=function(t){var o=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-download" title="Download"></div>');t.append(o);var n=this;o.click(function(t){var o=n.options.fnUnit.parent(),r=e.VA.Env.Session.userId,a=o.mid,s=[],l=n.FnUnitUtils.getTable(n.options.fnUnit,n.options.panelType);for(var c in l){var d=o.getFnUnitByOutTable(l[c]).display.label,p=1==l.length||"out"!==n.display.panelType?d:d+"-"+(Number(c)+1);s.push({value:l[c],label:p});}var u={userId:r,mid:a,tableObjList:s,fileName:(n.options.fnUnit.display.label.replace(/\s/g,"_")+"_"+n.display.panelType+".csv").replace(/[~!@\#$%^&*\()\[\]\{\}=+'";:?`|\\\/]/gi,"")};n.dataWorksheet?new e.VA.Core.Wizards.DataDownloadWizard(n.$mainControl,{mode:"open",height:400,close:function close(){},downloader:i,downloaderOptions:u,previewData:n.dataWorksheet.dataSet}):e.VA.Core.Utils.WidgetUtils.openErrorDialog("No data to download.");});},r.prototype.refreshHeaderToolbar=function(){this.$header.find(".brtc-va-editors-sheet-panels-datapanel-toolbar").remove(),this.createTopAreaHeaderToolbar(),this.createTopAreaHeaderContext(this.$contextMenuOpen);},r.prototype._setOutTableInfo=function(){if("out"===this.display.panelType&&this.FnUnitUtils.getOutTable(this.options.fnUnit)&&this.FnUnitUtils.getOutTable(this.options.fnUnit).length>1){var t=this.$header.find(".brtc-va-editors-sheet-panels-basepanel-header-title"),e=this.options.title+" ("+this.FnUnitUtils.getOutTable(this.options.fnUnit).length+" Outputs)";t.text(e),t.attr("title",e);}},e.VA.Core.Editors.Sheet.Panels.DataPanel=r,a.prototype.createLayout=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-panels-datapanel-schema"></div>'),this.$column=$('<div class="brtc-va-editors-sheet-panels-datapanel-schema-column"><div type="text">Column(s) :</div><div type="count"></div></div>'),this.$row=$('<div class="brtc-va-editors-sheet-panels-datapanel-schema-row"><div type="text">Row(s) :</div><div type="count"></div></div>'),this.$parent.append(this.$mainControl),this.$mainControl.append(this.$column).append(this.$row);},a.prototype.update=function(t){var i=t.columns?t.columns.length:0,o=e.VA.Core.Utils.CommonUtils.numberToStringWithComma(t.totalCount);this.$column.find("[type=count]").text(i),this.$row.find("[type=count]").text(o);},a.prototype.destroy=function(){this.$mainControl.remove();},a.prototype.hide=function(){this.$mainControl.hide();},a.prototype.show=function(){this.$mainControl.show();},e.VA.Core.Editors.Sheet.Panels.DataSchema=a;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Panels.BasePanel;function i(t,i){e.call(this,t,i);}i.prototype=Object.create(e.prototype),i.prototype.createBottomArea=function(){},i.prototype.createTopAreaControls=function(e){t.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createTopAreaControls.call(this,e),this.$mainControl.find(".brtc-va-editors-sheet-panels-basepanel-header").addClass("brtc-va-editors-sheet-panels-newfnunitpanel-header");},i.prototype.createContentsArea=function(e){t.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createContentsArea.call(this,e);var i=this.$mainControl.find(".brtc-va-editors-sheet-panels-basepanel-contents-area");i.append('<div>   <i class="fa fa-plus-circle fa-4x"></i></div>'),i.addClass("brtc-va-editors-sheet-panels-newfnunitpanel-contents");},t.VA.Core.Editors.Sheet.Panels.NewFnUnitPanel=i;}.call(this),function(){"use strict";var t=this,e=t.Brightics,i=["df-names"];function o(t,i){e.VA.Core.Editors.Sheet.Panels.BasePanel.call(this,t,i);}o.prototype=Object.create(e.VA.Core.Editors.Sheet.Panels.BasePanel.prototype),o.prototype.constructor=o,o.prototype.createContentsAreaControls=function(t){e.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createContentsAreaControls.call(this,t),this.FnUnitInputs=brtc_require("FnUnitInputs"),this.createInputsControl();},o.prototype.registerScrollEventListener=function(t,e){this.scrollEventTypeList||(this.scrollEventTypeList=[]),-1===this.scrollEventTypeList.indexOf(t)&&this.scrollEventTypeList.push(t),this.$contentsArea.on(t,e);},o.prototype.destroyScrollEventListener=function(){for(var t in this.scrollEventTypeList){this.$contentsArea.off(t);}},o.prototype.registerProblemListener=function(){var t=this;this.problemsListener=function(e,i,o){if(t.options.fnUnit&&t.getModel()&&i===t.getModel().mid){for(var n in t.problems=[],o){o[n]&&o[n].fid===t.options.fnUnit.fid&&t.problems.push(o[n]);}t.handleProblem();}},Studio.getInstance().addProblemListener(this.problemsListener);},o.prototype.registerCommandListener=function(){if(!this.isBlockCommandListener()){var t=this;this.commandListener=function(e){t.options.isRendered?(t.options.isRendered=!1,t.handleCommand(e),t.options.isRendered=!0):t.handleCommand(e);},this.options.modelEditor.addCommandListener(this.commandListener);}},o.prototype.handleCommand=function(t){t instanceof e.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand?this.handleSetFnUnitParameterValueCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand?this.handleSetFnUnitCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.SetUDFFnUnitParameterValueCommand?this.handleSetUDFFnUnitCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.ReplaceFnUnitParamCommand?this.handleSetFnUnitCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand?this.handleRenameFnUnitCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand?this.handleConnectFnUnitCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand?this.handleConnectFnUnitCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand?this.handleConnectFnUnitCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.BindVariableCommand?this.handleGlobalVariableCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand?this.handleGlobalVariableCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand?this.handleChangeIntableCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand?this.handleChangeInputsCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand?this.handleChangeOutTableCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.AddOperationCommand?this.handleOperationCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand?this.handleOperationCommand(t):t instanceof e.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand?this.handleOperationCommand(t):t instanceof e.VA.Core.CompoundCommand&&this.handleCompoundCommand(t);},o.prototype.handleGlobalVariableCommand=function(t){t.options.subFnUnitIndex>-1?t.options.fid==this.options.fnUnit.param.functions[t.options.subFnUnitIndex].fid&&this.refreshGlobalVariableControl(t.options.paramKey,t.options.subFnUnitIndex):t.options.fid==this.options.fnUnit.fid&&this.refreshGlobalVariableControl(t.options.paramKey,t.options.subFnUnitIndex);},o.prototype.handleCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type)for(e in t.commandList){this.handleCommand(t.commandList[e]);}else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--){this.handleCommand(t.commandList[e]);}},o.prototype.handleSetFnUnitCommand=function(t){if(this.options.fnUnit.fid!=t.options.fnUnit.fid||"UNDO"!==t.event.type&&"REDO"!==t.event.type){if(t.event.source!==this)if(t.event.source instanceof e.VA.Core.Editors.Sheet.Controls.DataSelector){var i=this.FnUnitUtils.getInData(t.options.fnUnit);this.retrieveTableInfo(i);}else this.renderPersistButton(),this.renderValues(t),this.fillControlValues();}else this.renderPersistButton(),this.renderValues(t);},o.prototype.handleChangeOutputsCommand=function(t){if(this.options.fnUnit.fid!=t.options.fnUnit.fid||"UNDO"!==t.event.type&&"REDO"!==t.event.type){if(t.event.source!==this&&t.event.source instanceof e.VA.Core.Editors.Sheet.Controls.DataSelector){var i=this.FnUnitUtils.getOutTable(t.options.fnUnit);i.length>0&&this.retrieveTableInfo(i);}}else;},o.prototype.handleChangeOutTableCommand=function(t){(this.options.fnUnit.fid!=t.options.fnUnit.fid||"UNDO"!==t.event.type&&"REDO"!==t.event.type)&&t.event.source!==this&&t.event.source instanceof e.VA.Core.Editors.Sheet.Controls.DataSelector&&this.retrieveTableInfo(t.options.fnUnit[OUT_DATA]);},o.prototype.handleSetFnUnitParameterValueCommand=function(t){this.options.fnUnit.fid!=t.options.fnUnit.fid||"UNDO"!==t.event.type&&"REDO"!==t.event.type?t.event.source!==this&&this.renderValues(t):this.renderValues(t);},o.prototype.handleOperationCommand=function(t){!t.options.fnUnit||this.options.fnUnit.fid!==t.options.fnUnit.fid||"UNDO"!==t.event.type&&"REDO"!==t.event.type?t.event.source!==this&&this.renderOperationValues(t):this.renderOperationValues(t);},o.prototype.renderOperationValues=function(t){console.error("check here");},o.prototype.handleRenameFnUnitCommand=function(t){if(this.options.fnUnit.fid==t.options.fid){var i=this.$mainControl.find(".brtc-va-editors-sheet-panels-basepanel-header-title");i.text(this.options.fnUnit.display.label);var o=this.options.fnUnit.display.label,n=this.getModel().type,r=e.VA.Core.Interface.Functions[n][this.options.fnUnit.func];r&&(o=this.options.fnUnit.display.label+" ("+r.defaultFnUnit.display.label+")"),i.attr("title",o);}},o.prototype.handleConnectFnUnitCommand=function(t){if(this.options.fnUnit.fid===t.options[TARGET_FID]){var e=this.FnUnitUtils.getInTable(this.options.fnUnit);this.retrieveTableInfo(e),this.handleChangeInputsCommand();}},o.prototype.handleChangeIntableCommand=function(){var t=this.FnUnitUtils.getInTable(this.options.fnUnit);if(this.retrieveTableInfo(t),this.inputsList){var e={fnUnit:this.options.fnUnit,disable:!0};this.createInputsList(this.$inputsControl,e);}},o.prototype.handleChangeInputsCommand=function(){var t=this.FnUnitUtils.getInTable(this.options.fnUnit);if(this.retrieveTableInfo(t),this.inputsList){var e={fnUnit:this.options.fnUnit,disable:!0};this.createInputsList(this.$inputsControl,e);}},o.prototype.setContentsEditable=function(t){t?(this.options.isRendered=!1,this.fillControlValues(),this.renderValues(),this.options.isRendered=!0,this.options.fnUnit.hasOwnProperty("parent")&&Studio.getInstance().doValidate(this.getModel()),this.updateScroll()):this.options.isRendered=!1;},o.prototype.getProblems=function(){this.problems=this.getModel().getProblemsByFid(this.options.fnUnit.fid);},o.prototype.fillControlValues=function(){},o.prototype.destroy=function(){e.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.destroy.call(this),this.options.modelEditor.removeCommandListener(this.commandListener),Studio.getInstance().removeProblemListener(this.problemsListener),this.destroyGrid(),this.destroyColumnSelector(),this.destroyComboBox(),this.destroyDropDownList(),this.destroyScrollEventListener(),this.$ctxMenu&&this.$ctxMenu.jqxMenu("destroy");},o.prototype.destroyGrid=function(){var t=this.$contentsArea.find(".jqx-grid");t.length>0&&t.each(function(t){$(this).jqxGrid("destroy");});},o.prototype.destroyColumnSelector=function(t){var e=$(".brtc-va-editors-sheet-controls-columnselector-editarea");e.length>0&&(e.dialog("close"),e.dialog("destroy"));},o.prototype.destroyDropDownList=function(){var t=this.$contentsArea.find(".brtc-va-editors-sheet-controls-wrapper").children(".jqx-dropdownlist-state-normal");t.length>0&&t.each(function(t){$(this).jqxDropDownList("destroy");});},o.prototype.destroyComboBox=function(){var t=this.$contentsArea.find(".brtc-va-editors-sheet-controls-wrapper").children(".jqx-combobox");t.length>0&&t.each(function(t){$(this).jqxComboBox("destroy");});},o.prototype.renderValues=function(t){if(t&&t.options.renderParams)for(var e in t.options.renderParams){this.render[t.options.renderParams[e]].bind(this)();}else for(var i in t?t.options.ref.param:this.render){this.render[i]?this.render[i].bind(this)():void 0===this.render[i]&&delete this.render[i];}this.updateScroll();},o.prototype.renderCommonValidation=function(){for(var t in this.problems){this.problems[t].param||this.$contentsArea.prepend($('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>   <div class="brtc-va-editors-sheet-panels-validation-tooltip">'+this.problems[t].message+"</div></div>"));}},o.prototype.renderValidation=function(){},o.prototype.removeValidation=function(){this.$mainControl.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove(),this.$mainControl.find(".brtc-va-editors-sheet-controls-propertycontrol-label").removeClass("brtc-va-editors-sheet-controls-propertycontrol-label-error"),this.$mainControl.find(".brtc-va-editors-sheet-controls-property-in-table-control-label").removeClass("brtc-va-editors-sheet-controls-property-in-table-control-label-error"),this.$mainControl.find(".brtc-va-editor-sheet-panels-validation-error").removeClass("brtc-va-editor-sheet-panels-validation-error"),this.$mainControl.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove();},o.prototype.renderPropertyControlHeader=function(t,e){},o.prototype.showValidation=function(t,e){this.renderPropertyControlHeader(t),this.createValidationContent(t,e);},o.prototype.createValidationContent=function(t,e,i){var o=t.hasClass("brtc-va-editors-sheet-controls-wrapper")?t:t.parent(".brtc-va-editors-sheet-controls-wrapper");o=o.length?o:t;var n=$('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>   <div class="brtc-va-editors-sheet-panels-validation-tooltip">'+e.message+"</div></div>");o.append(n),o.addClass("brtc-va-editor-sheet-panels-validation-error"),i&&n.css("clear","both"),n.show();},o.prototype.handleProblem=function(){try{this.getModel()&&this.options.isRendered&&(this.removeValidation(),this.renderCommonValidation(),this.renderValidation(),this.updateScroll());}catch(t){}},o.prototype.bindValidationTooltip=function(t,e){},o.prototype.getRequestData=function(t){this.dataMap={};var e={},i=this,o=0;$.each(t,function(n,r){i.options.dataProxy.requestSchema(r,function(n){e[r]=n,++o===t.length&&(i.dataMap=e,i.setContentsEditable(!0));},function(n){e[r]=n,++o===t.length&&(i.dataMap=e,i.setContentsEditable(!0));});});},o.prototype.retrieveTableInfo=function(t){t&&t.length>0?this.getRequestData(t):this.setContentsEditable(!0);},o.prototype.createTopAreaControls=function(t){var i=this,o=this.options.fnUnit.parent().type,n=e.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createTopAreaControls.call(this,t);n.addClass("brtc-va-editors-sheet-panels-propertiespanel-header");var r=e.VA.Core.Utils.WidgetUtils.getFunctionLibrary(o,this.options.fnUnit.func).category;n.addClass("brtc-va-fnunit-category-"+r);var a=this.options.fnUnit.context||("control"===r||"process"===r?r:"scala");n.attr("context",a);var s=n.find(".brtc-va-editors-sheet-panels-basepanel-header-title"),l=e.VA.Core.Utils.WidgetUtils.getFunctionLibrary(o,this.options.fnUnit.func),c=l?this.options.fnUnit.display.label+" ("+l.defaultFnUnit.display.label+")":this.options.fnUnit.display.label;s.attr("title",c);var d=$(crel("div",{class:"brtc-style-display-flex brtc-style-float-right"}));return n.append(d),d.append('<div class="brtc-va-editors-sheet-panels-propertiespanel-header-help" title="Help"></div>'),d.append('<div class="brtc-va-editors-sheet-panels-propertiespanel-header-more-menu"></div>'),d.append('<div class="brtc-va-editors-sheet-panels-propertiespanel-header-help-popover"></div>'),"data"===o&&d.append($(crel("div",{class:"brtc-va-editors-sheet-panels-propertiespanel-header-close-panel",title:"Close"}))),this.createPersistButton(),this.createPropertiesContextMenu(),this.createHelpPopover(),n.find(".brtc-va-editors-sheet-panels-propertiespanel-header-more-menu").on("click",function(t){var e=$(window).scrollTop(),o=$(window).scrollLeft(),n=parseInt(t.clientX)+o;$(window).width()-t.clientX<100&&(n-=130);var r=parseInt(t.clientY)+e;r+=5,i.$ctxMenu.jqxMenu("open",n,r),$(window).on("resize",i.ctxMenuCloseHandler);}),n.find(".brtc-va-editors-sheet-panels-propertiespanel-header-close-panel").on("click",function(t){i.getEditor().resetSheetEditorPage();}),n;},o.prototype.createPersistButton=function(){var t=this;this.$mainControl.find(".brtc-va-editors-sheet-panels-propertiespanel-header > .brtc-va-editors-sheet-panels-basepanel-header-title").attr("persist-mode","auto"),this.$mainControl.find(".brtc-va-editors-sheet-panels-propertiespanel-header [item-type=persist]").click(function(){var e=["auto","true","false"],i=e.indexOf($(this).attr("persist-mode"));i=(i+1)%e.length,$(this).attr("persist-mode",e[i]);var o={"persist-mode":e[i]},n=t.createSetFnUnitCommand(o);t.executeCommand(n);}),this.renderPersistButton();},o.prototype.renderPersistButton=function(){this.$mainControl.find(".brtc-va-editors-sheet-panels-propertiespanel-header > .brtc-va-editors-sheet-panels-basepanel-header-title").before();this.options.fnUnit["persist-mode"]?$(this).attr("persist-mode",this.options.fnUnit["persist-mode"]):$(this).attr("persist-mode","auto");},o.prototype.createHelpPopover=function(){var t=this;this.$mainControl.find(".brtc-va-editors-sheet-panels-propertiespanel-header-help").click(function(){var i=t.getPrimaryOperation();"UDF"===t.getFunctionDef().defaultFnUnit.name&&(i="udf_"+t.getFunctionDef().defaultFnUnit.func);var o=t.getFunctionDef().defaultFnUnit.context||"scala";"control"===t.getFunctionDef().category&&(o="common"),e.VA.Core.Utils.ModelUtils.openFunctionReferencePopup("data",i,o);});},o.prototype.createPropertiesContextMenu=function(){var t=this,i=this.$mainControl.find(".brtc-va-editors-sheet-panels-propertiespanel-header"),o=$('<div class="brtc-va-editors-sheet-panels-propertiespanel-header-ctxmenu">   <ul>       <li action="rename">Edit</li>       <li action="select_function">Select Function</li>   </ul></div>');i.append(o),this.$ctxMenu=o.jqxMenu({theme:e.VA.Env.Theme,width:"120px",height:"120px",autoOpenPopup:!1,mode:"popup",animationHideDuration:0,animationShowDuration:0}),this.$ctxMenu.on("itemclick",function(i){var o=$(i.args);if("rename"==o.attr("action")){var n={title:"Edit Function",label:t.options.fnUnit.display.label,description:t.options.fnUnit.display.description||"",close:function close(e){e.OK&&t.doEditFunction(t.options.fnUnit.fid,e.label,e.description);}};new e.VA.Core.Dialogs.EditResourceDialog($(document.body),n);}else if("select_function"==o.attr("action")){var r=t.getFnUnit(),a=r.parent(),s=a.getPrevious(r.fid);new e.VA.Core.Dialogs.SwitchFnUnitDialog($(i.target),{modelType:t.getModel().type,position:"center",preFnUnit:a.getFnUnitById(s[0]),close:function close(o){if(o.OK){var n=a.getFnUnitById(r.fid);if(n.func!==o.func){var s=a.newFnUnit(o.func);s.display.diagram.position=$.extend({},n.display.diagram.position);var l=new e.VA.Core.Editors.Diagram.Commands.SwitchFnUnitCommand($(i.target),{modelType:t.getModel().type,fid:n.fid,fnUnit:s,prvFnUnit:n});l.event.source=$(i.target),e.VA.Core.Utils.WidgetUtils.getModelEditorRef(t.$mainControl).getCommandManager().execute(l);}}}});}}),this.ctxMenuCloseHandler=function(){t.$ctxMenu.jqxMenu("close");},this.$ctxMenu.on("closed",function(){$(window).off("resize",t.ctxMenuCloseHandler);});},o.prototype.doEditFunction=function(t,i,o){var n=new e.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this,{fid:t,name:i,description:o});this.executeCommand(n);},o.prototype.createExample=function(t,e){var i=$('<div class="brtc-va-popover-help-func-example"></div>');t.append(i);var o,n=$('<div class="brtc-va-popover-help-func-example-title"></div>');for(var r in n.text(e.title),i.append($ex),e.params){var a=$('<div class="brtc-va-popover-help-func-example-param"></div>'),s=$("<span></span>");s.text(r);var l=$("<span></span>");l.text(e.params[r]),a.append(s),a.append(l),i.append(a);}for(o in e.input){i.append('<div class="brtc-va-popover-help-func-example-param"><span>Input</span></div>'),this.createExampleTable(i,e.input[o]);}for(o in e.output){i.append('<div class="brtc-va-popover-help-func-example-param"><span>Output</span></div>'),this.createExampleTable(i,e.output[o]);}},o.prototype.createExampleTable=function(t,e){var i=$('<table class="brtc-va-popover-help-func-example-table"></table>');t.append(i);var o,n=$("<tr></tr>");for(var r in i.append(n),e.columns){var a=$("<td></td>");a.text(e.columns[r].name),n.append(a);}for(var s in e.data){for(var l in o=$("<tr></tr>"),i.append(o),e.data[s]){var c=$("<td></td>");c.text(e.data[s][l]),o.append(c);}}},o.prototype.hasInModel=function(){var t=this.getFunctionDef();if(t.viewer&&t.viewer.in&&t.viewer.in.indexOf("model")>=0)return!0;return!1;},o.prototype.createInputsControl=function(t){var e=this;this.FnUnitUtils.inputChangable(this.options.fnUnit)&&this.FnUnitUtils.hasInput(this.options.fnUnit)&&(this.$inputsControl=$('<div class="brtc-va-editors-sheet-controls-property-inputs-control-columnlist"/>'),this.addPropertyInTableControl("Inputs",function(i){i.append(e.$inputsControl),e.wrapControl(e.$inputsControl);var o={fnUnit:e.options.fnUnit,disable:t};e.createInputsList(e.$inputsControl,o);},{mandatory:!0}));},o.prototype.getFunctionDef=function(){var t=this.getModel().type;return e.VA.Core.Utils.WidgetUtils.getFunctionLibrary(t,this.options.fnUnit.func);},o.prototype.getPrimaryOperation=function(){var t=this.getModel().type;return e.VA.Core.Utils.WidgetUtils.getFunctionLibrary(t,this.options.fnUnit.func).defaultFnUnit.name;},o.prototype.createContentsArea=function(){e.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createContentsArea.call(this),this.$contentsArea.addClass("brtc-va-editors-sheet-panels-propertiespanel-contents-area");},o.prototype.createBottomAreaControls=function(t){this.$callFunctionButton=$('<button type="button" class="brtc-va-editors-sheet-panels-propertiespanel-button">Run</button>'),t.append(this.$callFunctionButton),this.$callFunctionButton.jqxButton({theme:e.VA.Env.Theme,width:"92px",height:"100%"});var i=this;this.$callFunctionButton.click(function(){this.blur(),i.callFunction();});},o.prototype.callFunction=function(){var t=this,e={success:function success(e){t.$mainControl.trigger("callFunction",[]);}};Studio.getJobExecutor().launchUnit(t.options.fnUnit,{},{},e);},o.prototype.addPropertyControl=function(t,i,o){var n=this,r=$('<div class="brtc-va-editors-sheet-controls-propertycontrol" label="'+t+'">   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents"></div>');return o?(o.mandatory&&(t="<div>"+e.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t)+'   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>'),o.propertyControlParent?o.propertyControlParent.append(r):this.$contentsArea.append(r)):this.$contentsArea.append(r),r.jqxExpander({theme:e.VA.Env.Theme,arrowPosition:"left",initContent:function initContent(){"function"==typeof i&&i.call(n,r.find(".brtc-va-editors-sheet-controls-propertycontrol-contents"),o);}}),r.jqxExpander("setHeaderContent",t),r;},o.prototype.addPropertyInTableControl=function(t,i,o){var n=this,r=$('<div class="brtc-va-editors-sheet-controls-property-in-table-control">   <div class="brtc-va-editors-sheet-controls-property-in-table-control-label"></div>   <div class="brtc-va-editors-sheet-controls-property-in-table-control-contents"></div>');return o?(o.mandatory&&(t="<div>"+e.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t)+'   <div class="brtc-va-editors-sheet-controls-property-in-table-control-mandatory">*</div></div>'),o.propertyControlParent?o.propertyControlParent.append(r):this.$contentsArea.append(r)):this.$contentsArea.append(r),r.jqxExpander({theme:e.VA.Env.Theme,arrowPosition:"left",initContent:function initContent(){"function"==typeof i&&i.call(n,r.find(".brtc-va-editors-sheet-controls-property-in-table-control-contents"),o);}}),r.jqxExpander("setHeaderContent",t),r;},o.prototype.addGlobalVariableControl=function(t,i,o,n,r){var a=this,s=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-variable"></div>');s.css(i),r&&r.type&&s.attr("type",r.type),s.click(function(t){var i=$(this).closest(".brtc-va-editors-sheet-controls-propertycontrol-label");i&&i.closest(".jqx-expander").jqxExpander("disable");new e.VA.Core.Dialogs.SettingVariableDialog($(this),{close:function close(t){t.OK&&a.executeCommand(t.command),i&&i.closest(".jqx-expander").jqxExpander("enable");},remove:function remove(t){a.executeCommand(t.command);},fnUnit:a.options.fnUnit,param:{key:o,label:n,type:r&&r.type?r.type:"string",index:a.globalVariableFnUnitIndex[o]}});}),t.append(s),this.globalVariableControls=this.globalVariableControls||{},this.globalVariableFnUnitIndex=this.globalVariableFnUnitIndex||{},this.globalVariableControls[o]=s,this.globalVariableFnUnitIndex[o]=r&&r.index>-1?r.index:-1,this.refreshGlobalVariableControl(o,r&&r.index>-1?r.index:-1);},o.prototype.refreshGlobalVariableControl=function(t,e){var i=this.options.modelEditor.getModel(),o=i.getVariable(this.options.fnUnit.fid,t);e>-1&&(o=i.getVariable(this.options.fnUnit.param.functions[e].fid,t)),o?this.globalVariableControls[t].addClass("set"):this.globalVariableControls[t].removeClass("set");},o.prototype.executeCommand=function(t){var i=e.VA.Core.Utils.WidgetUtils.getModelEditorRef(this.$mainControl);["kmeans2","kmeans2model","kmeansmodelpy","testftn1","testftn2","testftn3"].indexOf(this.options.fnUnit.func)>-1?i.getCommandManager().execute(t):i&&this.options.isRendered&&i.getCommandManager().execute(t);},o.prototype.createCommandOptions=function(){return{};},o.prototype.createSetFnUnitCommand=function(t){var i={fnUnit:this.options.fnUnit,ref:{}};for(var o in t){i.ref[o]=t[o];}return new e.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand(this,i);},o.prototype.createSetParameterValueCommand=function(t,i,o){if(o===void 0){o=!0;}if(!o&&this.getParam(t)===i)return null;var n={fnUnit:this.options.fnUnit,ref:{param:{}}};return 0===i||i||"boolean"==typeof i||(i=""),n.ref.param[t]=i,new e.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this,n);},o.prototype.getColumnsOfInTable=function(t,e){var i=[];return this.dataMap&&this.FnUnitUtils.getInTable(this.options.fnUnit)[t]&&this.FnUnitUtils.getInTable(this.options.fnUnit)[t]&&(i=this.dataMap[this.FnUnitUtils.getInTable(this.options.fnUnit)[t]].columns),e&&e.length>0&&(i=$.grep(i,function(t){return e.indexOf(t.type)>-1||e.indexOf(t.internalType)>-1;})),i;},o.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');t.wrap(e);},o.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},o.prototype.addCssToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.css(e);}},o.prototype.createComboBox=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme,width:"100%",height:"25px",closeDelay:0,openDelay:0};i&&$.extend(a,i),t.jqxComboBox(a);var s=t.val();t.find("input").focus(function(){s=t.val();}),$("svg").on("mousedown",function(){t.val()!==s&&t.find("input").is(":focus")&&t.trigger("change");}),this.registerScrollEventListener("ps-scroll-y",function(){t.jqxComboBox("close");});},o.prototype.createInput=function(i,o,n,r){this.wrapControl(i);var a="";n&&(a=a.concat(" ",n)),i.attr("type")||i.attr("type","text"),i.attr("maxlength")||i.attr("maxlength","100"),this.addClassToWrapper(i,a),this.addCssToWrapper(i,r);var s={theme:e.VA.Env.Theme,height:"25px",placeHolder:"Enter value"};o&&$.extend(s,o),i.jqxInput(s);var l=i.val();i.focus(function(){l=i.val();}),$("svg").on("mousedown",function(){i.val()!==l&&i.is(":focus")&&i.trigger("change");});var c=this;return i.on("keydown",function(t){clearTimeout(c.keydownTimeout),c.keydownTimeout=setTimeout(function(){i.is(":focus")&&(i.blur(),i.focus());},1e3);}),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(i),i;},o.prototype.createNumberInput=function(t,i,o,n){this.wrapControl(t);var r="";return o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n),new e.VA.Core.Editors.Sheet.Controls.NumericInput(t,i,o);},o.prototype.createDropDownList=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme,enableBrowserBoundsDetection:!0,animationType:"none",width:"100%",height:"25px",openDelay:0};return i&&(i.source&&i.source.length>7?(a.autoDropDownHeight=!1,a.dropDownHeight=120):a.autoDropDownHeight=!0,$.extend(a,i)),t.jqxDropDownList(a),this.registerScrollEventListener("ps-scroll-y",function(){t.jqxDropDownList("close");}),t;},o.prototype.createGrid=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme,width:"100%",rowsheight:25};return i&&$.extend(a,i),t.jqxGrid(a),t;},o.prototype.createCheckBox=function(t,i,o,n){this.wrapControl(t);var r="brtc-va-editors-sheet-controls-checkbox-default";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme};return i&&$.extend(a,i),t.jqxCheckBox(a),t;},o.prototype.createRadioButton=function(t,i,o,n){this.wrapControl(t);var r="brtc-va-editors-sheet-controls-radiobutton-default";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme};return i&&$.extend(a,i,{groupName:(i.groupName||"")+this.panelId}),t.jqxRadioButton(a),t;},o.prototype.createButton=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme};return i&&$.extend(a,i),t.jqxButton(a),t;},o.prototype.createSwitchButton=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme,width:"100%",height:"23px"};return i&&$.extend(a,i),t.jqxSwitchButton(a),t;},o.prototype.createButtonGroup=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme};return i&&$.extend(a,i),t.jqxButtonGroup(a),t;},o.prototype.onInputsChange=function(t){if(this.FnUnitUtils.hasMeta(this.options.fnUnit)){if(!this.isInputsChanged(t))return;var i={fnUnit:this.options.fnUnit,ref:{inputs:t}},o=new e.VA.Core.CompoundCommand(this),n=new e.VA.Core.Editors.Diagram.Commands.ChangeInputsCommand(this,i);o.add(n);}else{var r=[];for(var a in t){_.isEmpty(t[a])||r.push(t[a]);}if(_.isEqual(this.FnUnitUtils.getInTable(this.options.fnUnit),r))return;i={fnUnit:this.options.fnUnit,ref:r},o=new e.VA.Core.CompoundCommand(this);var s=new e.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand(this,i);o.add(s);}this.executeCommand(o);},o.prototype.onInputsError=function(t){this.options.modelEditor.notification("error",t);},o.prototype.createInputsList=function(t,e,i,o){var n="";i&&(n=n.concat(" ",i)),this.addClassToWrapper(t,n),this.addCssToWrapper(t,o);var r={appendTo:t,fnUnit:this.options.fnUnit,emptyLabel:"Empty",onClick:this.openInputSelector.bind(this),readOnly:!0};e&&$.extend(r,e),this.inputsList=this.FnUnitInputs.render(r);},o.prototype.openInputSelector=function(){this.inputSelector=new e.VA.Core.Editors.Sheet.Controls.InputSelector(this.$mainControl,{fnUnit:this.options.fnUnit,onChange:this.onInputsChange.bind(this),onClose:this.onInputsChange.bind(this),onError:this.onInputsError.bind(this)});},o.prototype.isInputsChanged=function(t){return!_.isEqual(this.FnUnitUtils.getInputs(this.options.fnUnit),t);},o.prototype.addFnUnitCommandToCompoundCommand=function(t,o){var n=!1,r={fnUnit:this.options.fnUnit,ref:{param:{}}},a=Object.keys(this.options.fnUnit.param);for(var s in a){var l=a[s];i.indexOf(l)>-1&&(n=!0,r.ref.param[l]=o);}if(n){var c=new e.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand(this,r);t.add(c);}},o.prototype.createColumnList=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={multiple:!0,rowCount:1,maxRowCount:5,expand:!1,sort:"none",sortBy:"name",showOpener:"button",removable:!0,defaultType:"-",changed:function changed(t,e){},added:function added(){},removed:function removed(){}};return i&&$.extend(a,i),new e.VA.Core.Editors.Sheet.Controls.ColumnList(t,a);},o.prototype.createTableList=function(t,i,o,n){this.wrapControl(t);var r="";return o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n),new e.VA.Core.Editors.Sheet.Controls.TableList(t,i);},o.prototype.createDateTimeInput=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme,width:"100%",height:"25px"};return i&&$.extend(a,i),t.jqxDateTimeInput(a),t;},o.prototype.createTextArea=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme,width:"100%",height:"60px"};return i&&$.extend(a,i),t.jqxTextArea(a),t;},o.prototype.createNumericInput=function(t,i,o,n){this.wrapControl(t);var r="";return o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n),new e.VA.Core.Editors.Sheet.Controls.NumericInput(t,i);},o.prototype.createArrayInput=function(t,i,o,n){this.wrapControl(t);var r="";return o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n),new e.VA.Core.Editors.Sheet.Controls.ArrayInput(t,i);},o.prototype.getPreviousFnUnit=function(t){return this.options.modelEditor.getModel().getFnUnitById(t);},o.prototype.createResizableTextArea=function(t,e,i,o){this.wrapControl(t);var n="brtc-va-editors-sheet-controls-resizable-textarea-default";i&&(n=n.concat(" ",i)),t.addClass(n),o&&$.extend(e,o),t.css(e);},o.prototype.createTextAreaControl=function(t,i,o,n){this.wrapControl(t);var r="brtc-va-editors-sheet-controls-textareacontrol";return o&&(r=r.concat(" ",o)),t.addClass(r),n&&t.css(n),new e.VA.Core.Editors.Sheet.Controls.TextAreaControl(t,i);},o.prototype.createItemList=function(t,i,o,n){this.wrapControl(t);var r="";return o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n),new e.VA.Core.Widget.Controls.ItemList(t,i);},o.prototype.createDateTimePickerControl=function(t,i,o,n){this.wrapControl(t);var r="brtc-va-editors-sheet-controls-datetime-picker";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme,width:"100%",height:"23px",formatString:"yyyy/MM/dd HH:mm:ss",textAlign:"center"};i&&$.extend(a,i),t.jqxDateTimeInput(a);},o.prototype.createTildeControl=function(t,e,i){this.wrapControl(t),this.addClassToWrapper(t,e),this.addCssToWrapper(t,i);},o.prototype.handleSetUDFFnUnitCommand=function(t){this.options.fnUnit.fid!=t.options.fnUnit.fid||"UNDO"!==t.event.type&&"REDO"!==t.event.type?t.event.source!==this&&(t.event.source instanceof e.VA.Core.Editors.Sheet.Controls.DataSelector?this.retrieveTableInfo(t.options.fnUnit[IN_DATA]):(this.renderUDFValues(t),this.fillControlValues())):this.renderUDFValues(t);},o.prototype.createSetUDFParameterValueCommand=function(t,i){var o={fnUnit:this.options.fnUnit,ref:{param:{"input-variables":$.extend(!0,[],this.options.fnUnit.param["input-variables"])}}};for(var n in this.options.fnUnit.param["input-variables"]){this.options.fnUnit.param["input-variables"][n][0]===t&&(o.ref.param["input-variables"][n][2]=i);}return new e.VA.Core.Editors.Diagram.Commands.SetUDFFnUnitParameterValueCommand(this,o);},o.prototype.renderUDFValues=function(t){if(t&&t.options.renderParams)for(var e in t.options.renderParams){this.render[t.options.renderParams[e]].bind(this)();}else if(t)for(var i in t.options.ref.param["input-variables"]){this.render[t.options.ref.param["input-variables"][i][0]].bind(this)();}else for(var i in this.render){this.render[i].bind(this)();}},o.prototype.isInputValueChanged=function(t,e){var i=this.options.fnUnit.param[t],o=e;return!(_.isArray(i)&&_.isEmpty(i[0])&&_.isEmpty(o))&&(_.isUndefined(i)||!_.isEqual(i,o));},o.prototype.createBarButton=function(t,e,i,o){var n={width:"100%",height:25};return e&&$.extend(n,e),this.createButton(t,n,i,o);},o.prototype.getFnUnit=function(){return this.options.fnUnit;},o.prototype.getModel=function(){return this.FnUnitUtils.getParent(this.getFnUnit());},o.prototype.getEditor=function(){return this.options.modelEditor;},o.prototype.configureOptions=function(){},o.prototype.refresh=function(){},o.prototype.getParam=function(t){return t?this.getFnUnit().param[t]:this.getFnUnit().param;},o.prototype.hideInTableControl=function(){this.$mainControl.find(".brtc-va-editors-sheet-controls-property-in-table-control").hide();},o.prototype.updateScroll=function(){this.$contentsArea.perfectScrollbar("update");},o.prototype.createDropEvent=function(t){},o.prototype.isBlockCommandListener=function(){return!!this.options.blockCommandListener;},e.VA.Core.Editors.Sheet.Panels.PropertiesPanel=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype),e.prototype.constructor=e,e.prototype.createPersistButton=function(){this.$mainControl.find(".brtc-va-editors-sheet-panels-propertiespanel-header > .brtc-va-editors-sheet-panels-basepanel-header-title").addClass("no-content");},e.prototype.renderPersistButton=function(){},e.prototype.renderValues=function(t){for(var e in t?t.options.ref["dex-param"]:this.render){this.render[e].bind(this)();}},e.prototype.createSetParameterValueCommand=function(e,i){var o={fnUnit:this.options.fnUnit,ref:{"dex-param":{}}};return o.ref["dex-param"][e]=i,new t.VA.Core.Editors.Diagram.Commands.SetFnUnitDexParameterValueCommand(this,o);},e.prototype.handleCommand=function(e){t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype.handleCommand.call(this,e),e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitDexParameterValueCommand&&this.handleSetFnUnitParameterValueCommand(e);},t.VA.Core.Editors.Sheet.Panels.DexPropertiesPanel=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.$parent=t,this.options=e,this.createControls();}e.prototype.createControls=function(){this.$parent.addClass("brtc-style-flex-1");var t=$('<div class="brtc-va-editors-sheet-panels-basepanel-empty"></div>');this.$parent.append(t),t.append("<h3>"+this.options.label+"</h3");},t.VA.Core.Editors.Sheet.Panels.BluffPanel=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype),e.prototype.constructor=e,e.prototype.createContentsAreaControls=function(e){t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype.createContentsAreaControls.call(this,e),this.$elements={},this.controls={};},e.prototype.renderValidation=function(){for(var t in this.problems){var e=this.problems[t].param;this.$elements[e]&&this.createValidationContent(this.$elements[e],this.problems[t]);}},e.prototype.changeCallback=function(t){},e.prototype.setValues=function(t){var e=Object.keys(t);for(var i in e){this.changeCallback(e[i]);}},e.prototype.getQueryResult=function(t,e,i,o,n){n=n||"String";var r={url:"api/va/v2/datasources/jdbcloader/query/"+e,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i||{}),blocking:!0,async:!1};$.ajax(r).done(function(e){var i=[];if("Integer"===n||"Double"===n)for(var r=0;r<e.data.length;r++){(a=e.data[r])[0]&&(e.data[r][0]=Number(a[0]));}if("DropDownList"===o){for(r=0;r<e.data.length;r++){(a=e.data[r])[0]&&i.push({label:a[0],value:a[0]});}t.jqxDropDownList({source:i});}else if("ItemSelector"===o){for(r=0;r<e.data.length;r++){var a;(a=e.data[r])[0]&&i.push({item:a[0],description:a[1]});}t.setItems(i);}}).fail(function(){"DropDownList"===o?t.jqxDropDownList({source:[]}):"ItemSelector"===o&&t.setItems([]);});},e.prototype.createSetParameterValueJdbcLoaderCommand=function(e,i){var o={fnUnit:this.options.fnUnit,ref:{param:{sql:{metadata:"sql",sqlId:this.options.fnUnit.param.sql.sqlId,condition:$.extend(!0,{},this.options.fnUnit.param.sql.condition)}}}};return o.ref.param.sql.condition[e]=i,new t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this,o);},e.prototype.createSetDataSourceParamValueJdbcLoaderCommand=function(e,i){var o={fnUnit:this.options.fnUnit,ref:{param:{datasource:{metadata:"datasource",datasourceId:this.options.fnUnit.param.datasource.datasourceId}}}};return o.ref.param.datasource[e]=i,new t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this,o);},t.VA.Core.Editors.Sheet.Panels.DistributedJdbcLoaderProperties=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Sheet.Panels.BasePanel.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Sheet.Panels.BasePanel.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-panels-basepanel brtc-style-display-flex brtc-style-flex-direction-column"/>'),this.$parent.append(this.$mainControl),this.createTopArea(),this.createContentsArea(),this.createBottomArea(),this.$topArea&&this.createTopAreaControls(this.$topArea),this.$bottomArea&&this.createBottomAreaControls(this.$bottomArea),this.$contentsArea&&(this.createContentsAreaControls(this.$contentsArea),this.$contentsArea.hasClass("brtc-va-editors-sheet-panels-propertiespanel-contents-area")&&this.$contentsArea.perfectScrollbar());},e.prototype.createContentsAreaControls=function(t){t.addClass("brtc-style-flex-1"),this.$contentsArea.addClass("brtc-style-padding-right-20").addClass("brtc-style-padding-right-20").addClass("rtc-style-width-minus-40");this.options.dataProxy.requestDataForce("html",function(e){t.append(e);},function(){t.append("<h3>There is No Model</h3>");});},t.VA.Core.Editors.Sheet.Panels.HtmlPanel=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Sheet.Panels.BasePanel.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Sheet.Panels.BasePanel.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-panels-basepanel brtc-style-display-flex brtc-style-flex-direction-column"/>'),this.$parent.append(this.$mainControl),this.createTopArea(),this.createContentsArea(),this.createBottomArea(),this.$topArea&&this.createTopAreaControls(this.$topArea),this.$bottomArea&&this.createBottomAreaControls(this.$bottomArea),this.$contentsArea&&(this.createContentsAreaControls(this.$contentsArea),this.$contentsArea.hasClass("brtc-va-editors-sheet-panels-propertiespanel-contents-area")&&this.$contentsArea.perfectScrollbar());},e.prototype.createTopAreaControls=function(t){this.createTopAreaHeaderTitle(t),this.createTopAreaHeaderToolbar();},e.prototype.createTopAreaHeaderToolbar=function(t){var e=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolbar"/>');this.$header.append(e),this.createPopupToolItem(e),this.createMinMaxToolItem(e);},e.prototype.createPopupToolItem=function(e){var i=this,o=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-popup" title="Pop up Chart" target="popupChart"></div>');e.append(o),o.click(function(){var e=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(i.$mainControl),o={user:t.VA.Env.Session.userId,pid:e.options.editorInput.getProjectId(),mid:i.options.fnUnit.parent().mid,fid:i.options.fnUnit.fid,tids:i.FnUnitUtils.getImage(i.options.fnUnit,i.options.panelType),offsetArr:[0],limitArr:[1e3]},n=$.map(o,function(t,e){return e+"="+t;}).join("&");window.open("popupimage?"+n,"popupImage");});},e.prototype.render=function(e,i){t.VA.Core.Utils.RenderUtils.image(e,i);},e.prototype.createContentsAreaControls=function(t){var e=this;t.addClass("brtc-style-flex-1");var i=this.FnUnitUtils.getImage(this.options.fnUnit,this.options.panelType);this.options.dataProxy.requestDataForce(i,function(i){var o=$('<div class="brtc-va-editors-sheet-panels-imagepanel"></div>');t.append(o),e.render(o,i);},function(){e.renderFail(e.$contentsArea,"No Image");});},t.VA.Core.Editors.Sheet.Panels.ImagePanel=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.call(this,e,i),this.innerType="";}e.prototype=Object.create(t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype),e.prototype.constructor=e,e.prototype.handleOperationCommand=function(e){t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype.handleOperationCommand.call(this,e),Studio.getInstance().doValidate(this.getModel());},e.prototype.createControls=function(){var t=this;this.$mainControl=$('<div class="brtc-va-editors-sheet-panels-basepanel"/>'),this.$parent.append(this.$mainControl),this.createTopArea(),this.createStepArea(),this.createContentsArea(),this.createBottomArea(),this.$contentsArea.perfectScrollbar("update"),this.$topArea&&this.createTopAreaControls(this.$topArea),this.$bottomArea&&this.createBottomAreaControls(this.$bottomArea),this.$contentsArea&&(this.createContentsAreaControls(this.$contentsArea),this.$contentsArea.hasClass("brtc-va-editors-sheet-panels-propertiespanel-contents-area")&&this.$contentsArea.perfectScrollbar());var e=this.$topArea.find(".brtc-va-editors-sheet-panels-basepanel-header-tooltip");e.click(function(){"auto"===e.attr("persist-mode")?(e.attr("persist-mode","true"),t.options.fnUnit["persist-mode"]="true"):"true"===e.attr("persist-mode")?(e.attr("persist-mode","false"),t.options.fnUnit["persist-mode"]="false"):(e.attr("persist-mode","auto"),t.options.fnUnit["persist-mode"]="auto");var i={"persist-mode":t.options.fnUnit["persist-mode"]},o=t.createSetFnUnitCommand(i);t.executeCommand(o);});},e.prototype.createContentsArea=function(){t.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.createContentsArea.call(this),this.$contentsArea.addClass("brtc-va-editors-sheet-panels-propertiespanel-contents-area"),this.$contentsArea.addClass("inner");},e.prototype.createStepArea=function(){this.$stepArea=$('<div class="brtc-va-editors-sheet-panels-basepanel-step-area"></div>'),this.$mainControl.append(this.$stepArea),this.$stepArea.addClass("brtc-style-padding-left-20").addClass("brtc-style-padding-right-20"),this.createStepIntoControl(),this.createStepOutControl();},e.prototype.createStepIntoControl=function(){var e=this;this.$stepIntoControl=$('<div class="brtc-va-editors-sheet-controls-property-step-control in"></div>'),this.$stepArea.append(this.$stepIntoControl),this.$stepIntoButton=$('<button type="button" class="brtc-va-editors-sheet-panels-propertiespanel-button">Step Into</button>'),this.$stepIntoControl.append(this.$stepIntoButton),this.$stepIntoButton.jqxButton({theme:t.VA.Env.Theme,width:"100%",height:"30px"}),this.$stepIntoButton.click(function(){e.stepInto();});},e.prototype.createStepOutControl=function(){var e=this;this.$stepOutControl=$('<div class="brtc-va-editors-sheet-controls-property-step-control out"></div>'),this.$stepArea.append(this.$stepOutControl),this.$stepOutButton=$('<button type="button" class="brtc-va-editors-sheet-panels-propertiespanel-button">Step Out</button>'),this.$stepOutControl.append(this.$stepOutButton),this.$stepOutButton.jqxButton({theme:t.VA.Env.Theme,width:"100%",height:"30px"}),this.$stepOutButton.click(function(){e.stepOut();});},e.prototype.stepInto=function(){this.options.modelEditor.getDiagramEditorPageArea().trigger("fnUnit:dbclick",[[this.options.fnUnit.fid]]);},e.prototype.stepOut=function(){var t=this.options.modelEditor.getModelLayoutManager(),e=this.options.modelEditor.getEditorInput(),i=this.options.modelEditor.getToolbar().navigator.getPath(),o=1===i.length?{mid:e.getFileId()}:i[i.length-2];t.openActivity(o.mid,o.fnUnit);},e.prototype.setType=function(t){this.$mainControl.find(".brtc-va-editors-sheet-controls-property-step-control").addClass(t);},e.prototype.setHeight=function(t){this.$contentsArea.height(t);},t.VA.Core.Editors.Sheet.Panels.InnerPropertiesPanel=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Sheet.Panels.BasePanel.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Sheet.Panels.BasePanel.prototype),e.prototype.constructor=e,e.prototype.init=function(){this.$mainControl.attr("type",this.options.type),this.model={};},e.prototype.createTopAreaControls=function(t){return this.$header=$('<div class="brtc-va-editors-sheet-panels-basepanel-header">   <div class="brtc-va-editors-sheet-worksheet-selector"></div></div>'),this.$selector=this.$header.find(".brtc-va-editors-sheet-worksheet-selector"),t.append(this.$header),this.createTopAreaHeaderToolbar(),this.$header;},e.prototype.createSelector=function(e){var i=this;this.$selector.jqxDropDownList({theme:t.VA.Env.Theme,source:e._repr_brtc_?["MODEL","JSON"]:["JSON"],width:120,autoDropDownHeight:!0,dropDownWidth:120,selectedIndex:0}),this.$selector.on("change",function(t){"JSON"===$(this).val()?(i.showJson(),i.renderJson()):(i.showModel(),i.renderModel()),i.$contentsArea.perfectScrollbar("update");});},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-sheet-panels-basepanel brtc-style-display-flex brtc-style-flex-direction-column"/>'),this.$parent.append(this.$mainControl),this.createTopArea(),this.createContentsArea(),this.createBottomArea(),this.$topArea&&this.createTopAreaControls(this.$topArea),this.$bottomArea&&this.createBottomAreaControls(this.$bottomArea),this.$contentsArea&&(this.createContentsAreaControls(this.$contentsArea),this.$contentsArea.hasClass("brtc-va-editors-sheet-panels-propertiespanel-contents-area")&&this.$contentsArea.perfectScrollbar());},e.prototype.createTopAreaHeaderToolbar=function(t){var e=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolbar"/>');this.$header.append(e),this.createPopupToolItem(e),this.createMinMaxToolItem(e);},e.prototype.createPopupToolItem=function(e){var i=this,o=$('<div class="brtc-va-editors-sheet-panels-datapanel-toolitem brtc-va-editors-sheet-panels-datapanel-toolitem-popup" title="Pop up Chart" target="popupChart"></div>');e.append(o),o.click(function(){var e=t.VA.Core.Utils.WidgetUtils.getModelEditorRef(i.$mainControl),o={user:t.VA.Env.Session.userId,pid:e.options.editorInput.getProjectId(),mid:i.options.fnUnit.parent().mid,fid:i.options.fnUnit.fid,tids:i.FnUnitUtils.getModel(i.options.fnUnit,i.options.panelType),offsetArr:[0],limitArr:[1e3]},n=$.map(o,function(t,e){return e+"="+t;}).join("&");window.open("popupmodel?"+n,"popupModel");});},e.prototype.registerCommandListener=function(){var e=this;this.commandListener=function(i){i instanceof t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand||i instanceof t.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand?e.options.fnUnit.fid===i.options[TARGET_FID]&&e.handleConnectionCommand(i):i instanceof t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand?e.options.fnUnit.fid!==i.options[TARGET_FID]&&e.options.fnUnit.fid!==i.old[TARGET_FID]||e.handleConnectionCommand(i):i instanceof t.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand?e.options.fnUnit.fid===i.options.fnUnit.fid&&e.handleOutTableCommand(i):i instanceof t.VA.Core.Editors.Diagram.Commands.NewOutTableCommand?e.options.fnUnit.fid===i.options.fnUnit.fid&&e.handleNewOutTableCommand(i):i instanceof t.VA.Core.CompoundCommand&&$.each(i.commandList,function(i,o){o instanceof t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand||o instanceof t.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand?e.options.fnUnit.fid===o.options[TARGET_FID]&&e.handleConnectionCommand(o):o instanceof t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand?e.options.fnUnit.fid!==o.options[TARGET_FID]&&e.options.fnUnit.fid!==o.old[TARGET_FID]||e.handleConnectionCommand(o):o instanceof t.VA.Core.Editors.Diagram.Commands.ChangeOutTableCommand?e.options.fnUnit.fid===o.options.fnUnit.fid&&e.handleOutTableCommand(o):o instanceof t.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand?e.options.fnUnit.fid===o.options.fnUnit.fid&&e.handleConnectionCommand(o):o instanceof t.VA.Core.Editors.Diagram.Commands.NewOutTableCommand&&e.options.fnUnit.fid===o.options.fnUnit.fid&&e.handleNewOutTableCommand(o);});},this.options.modelEditor.addCommandListener(this.commandListener);},e.prototype.handleNewOutTableCommand=function(t){},e.prototype.handleConnectionCommand=function(t){},e.prototype.handleOutTableCommand=function(t){},e.prototype.createContentsAreaControls=function(t){var e=this;t.addClass("brtc-style-flex-1"),this.createLayout(t);var i=this.FnUnitUtils.getModel(this.options.fnUnit,this.options.panelType);this.options.dataProxy.requestDataForce(i,function(t){e.model=t,e.createSelector(e.model),e.reset(),e.render();},function(){e.showFail(),e.renderFail("No Model");});},e.prototype.createLayout=function(t){this.$jsonContainer=$('<div class="brtc-va-editors-sheet-panels-basepanel-json"></div>'),this.$modelContainer=$('<div class="brtc-va-editors-sheet-panels-basepanel-model"></div>'),this.$failContainer=$('<div class="brtc-va-editors-sheet-panels-basepanel-fail"></div>'),t.append(this.$jsonContainer).append(this.$modelContainer).append(this.$failContainer),this.$contentsArea.perfectScrollbar();},e.prototype.getRenderType=function(){return this.$selector.val();},e.prototype.reset=function(){this.renderedJson=!1,this.renderedModel=!1;},e.prototype.showJson=function(){this.$jsonContainer.show(),this.$modelContainer.hide(),this.$failContainer.hide();},e.prototype.showModel=function(){this.$jsonContainer.hide(),this.$modelContainer.show(),this.$failContainer.hide();},e.prototype.showFail=function(){this.$jsonContainer.hide(),this.$modelContainer.hide(),this.$failContainer.show();},e.prototype.render=function(){"JSON"===this.getRenderType()?(this.showJson(),this.renderJson()):(this.showModel(),this.renderModel());},e.prototype.destroy=function(){this.$selector.jqxDropDownList("destroy"),t.VA.Core.Editors.Sheet.Panels.BasePanel.prototype.destroy.call(this);},e.prototype.renderJson=function(){this.renderedJson||(this.$jsonWrapper=$('<div class="brtc-va-editors-sheet-panels-modelpanel-json">   <pre></pre></div>'),this.$jsonContainer.append(this.$jsonWrapper),this.$jsonWrapper.find("pre").val(this.model),this.$jsonWrapper.find("pre").jsonViewer(this.model),this.$contentsArea.perfectScrollbar("update"),this.renderedJson=!0);},e.prototype.renderModel=function(){if(!this.renderedModel&&void 0!==this.model._repr_brtc_){for(var t in this._repr_brtc_=this.model._repr_brtc_,this.resources=this._repr_brtc_.resources,this.$modelWrapper=$('<div class="brtc-va-editors-sheet-panels-modelpanel-model"></div>'),this.$modelContainer.append(this.$modelWrapper),this._repr_brtc_.contents){var e=this._repr_brtc_.contents[t];this.addContents(this.$modelWrapper,e);}this.$contentsArea.perfectScrollbar("update"),this.renderedModel=!0;}},e.prototype.addContents=function(e,i){var o=i.type;if("md"===o){var n="",r=i.text.split("\n");for(var a in r){var s=r[a].trim();_.isEmpty(s)&&(s="\n"),n+=s+"\n";}var l=t.VA.Core.Utils.RenderUtils[o](e,n);this.makeChart(l);}else{l=t.VA.Core.Utils.RenderUtils[o](e,i.text);this.makeChart(l);}},e.prototype.makeChart=function(e){if(this.resources&&this.resources.chart){var i=e.find(".brightics-chart");for(var o in i){var n=$(i[o]),r=n.attr("id"),a=this.getChartOption(r);t.VA.Core.Utils.RenderUtils.chart(n,a);}}},e.prototype.getChartOption=function(t){var e={};for(var i in this.resources.charts){if(this.resources.charts[i].id===t)return(e=this.resources.charts[i].options).source={},e.source.dataType="local",e.source.localData=[{dataType:"rawdata",columns:this.resources.charts[i].dataSource.columns,data:this.resources.charts[i].dataSource.data}],e;}},e.prototype.renderFail=function(t){var e=$('<div class="brtc-va-editors-sheet-panels-basepanel-fail"><h3></h3></div>');this.$failContainer.append(e),e.addClass("brtc-style-full").addClass("brtc-style-flex-center"),e.find("h3").text(t);},t.VA.Core.Editors.Sheet.Panels.ModelPanel=e;}.call(this),function(){"use strict";var t=this.Brightics,e="brtc-style-emphasis";function i(t,e){this.options=e,this.editorInput=this.options.editor.options.editorInput,this.editor=this.options.editor,this.activityList=[],this.path=[],this.retrieveParent(t),this.createControls(),this.init();}i.prototype.retrieveParent=function(t){this.$parent=t;},i.prototype.createControls=function(){var t=$('<div class="brtc-va-editors-model-info-toolbar brtc-style-editor-model-info brtc-style-padding-0 brtc-va-editors-toolbar-navigator">   <div class="brtc-va-editors-model-info-toolbar-title brtc-style-editors-model-info-toolitem brtc-style-cursor-default">Home   </div></div>');this.$parent.append(t),this.$mainControl=t.find(".brtc-va-editors-model-info-toolbar-title.brtc-style-editors-model-info-toolitem");},i.prototype.init=function(){this.$mainControl.html("Home"),this.addProject(),this.addFile();},i.prototype._getConditionType=function(t,e){return e[0]===t?"if":e[e.length-1]===t?"else":"else if";},i.prototype.dfs=function(t,e,i){if(_.isUndefined(t))return!1;if(t.mid===e)return!0;for(var o=function o(t){return t.display.label;},n=0;n<t.functions.length;++n){var r=t.functions[n];if(!e&&r.fid===i)return this.path.push({fnUnit:r,label:o(r)}),!0;if("if"===r.func)for(var a=this.getConditions(r),s=0;s<a.length;++s){var l=a[s];if(this.path.push({mid:l.mid,fnUnit:r,label:o(r)+"("+this._getConditionType(l,a)+")"}),this.dfs(this._getModelByMid(l.mid),e,i))return!0;this.path.pop();}else if("forLoop"===r.func||"whileLoop"===r.func){if(this.path.push({mid:r.param.mid,fnUnit:r,label:o(r)}),this.dfs(this._getModelByMid(r.param.mid),e,i))return!0;this.path.pop();}}return!1;},i.prototype.getConditions=function(t){var e=[];return e.push(t.param.if),(e=e.concat(t.param.elseif)).push(t.param.else),e;},i.prototype.buildNavigator=function(t,i){this.init(),this.path=[],this.activityList=[],this.dfs(this.options.editor.getModel(),t,i)&&(this.path.length>2&&this.addDotDotDot(),_.forEach(_.dropRight(_.takeRight(this.path,2)),_.partial(this.addActivity,_,!0),this),_.isEmpty(this.path)?this.$fileUnit.removeClass(e):(this.addActivity(_.last(this.path)),this.$fileUnit.addClass(e)));},i.prototype.addProject=function(){var t=this.editorInput.getProjectId(),e=Studio.getResourceManager().getProject(t).getLabel(),i=this.createUnit(t),o=$('<div class="brtc-va-editors-modelinfo-toolbar-project-label"></div>');o.text(e).attr("title",e),i.append(o);},i.prototype.addFile=function(){var t=this,e=this.createUnit(this.editorInput.getFileId()),i=this.editorInput.getLabel(),o=$('<div class="brtc-va-editors-modelinfo-toolbar-file-label"></div>');o.text(i).attr("title",i),e.append(o),this.$fileUnit=e,o.click(function(){if(t.isClickable(e)){var i=t.editor.modelLayoutManager;i&&i.openActivity&&"function"==typeof i.openActivity&&i.openActivity(t.editorInput.getFileId());}});},i.prototype.addDotDotDot=function(){var t=this,e=this.options.editor.modelLayoutManager,i=this.createUnit("---"),o=$('<div class="brtc-va-editors-modelinfo-toolbar-activity-label"></div>');o.text("...").attr("title","..."),this.addEmphasis(i),i.append(o),o.addClass("brtc-va-editors-modelinfo-toolbar-dotdotdot"),o.click(function(i){var o=$(i.target).offset(),n={x:o.left-402+26,y:o.top-10+40};t.openNavigatorDialog(n,_.dropRight(t.path,2),{getNavigatorData:function getNavigatorData(){return _.dropRight(t.path,2);},navigate:function navigate(t,i){e.openActivity(t,i);}});});},i.prototype.addActivity=function(t,e){var i=this,o=t.mid||t.fnUnit.fid,n=this.createUnit(o),r=t.label,a=$('<div class="brtc-va-editors-modelinfo-toolbar-activity-label"></div>');return a.text(r).attr("title",r),n.append(a),e&&(this.addEmphasis(n),a.click(function(){i.handleActivitySelected(o);})),this.addToActivityList({id:o,view:n,fnUnit:t.fnUnit}),a;},i.prototype.addToActivityList=function(t){this.activityList.push(t);},i.prototype.createUnit=function(t){this.activityList.push(t);var e=$('<div class="brtc-va-editors-modelinfo-toolbar-unit brtc-style-flex-center"></div>');return e.attr("id",t),this.addArrow(e),this.$mainControl.append(e),e;},i.prototype.addArrow=function(t){var e=$('<div class="brtc-style-editors-model-info-arrow brtc-style-cursor-default" ></div>');t.append(e);},i.prototype.getActivity=function(t){for(var e in this.activityList){if(this.activityList[e].id===t)return this.activityList[e].index=e,this.activityList[e];}return{};},i.prototype.handleActivitySelected=function(t){var e=this.getActivity(t),i=this.options.editor.modelLayoutManager;i&&i.openActivity&&"function"==typeof i.openActivity&&i.openActivity(e.id,e.fnUnit);},i.prototype._getModelByMid=function(t){return this.editor.getModelByMid(t);},i.prototype._getFunctionByFid=function(t){return this.editor.getFunctionByFid(t);},i.prototype.addEmphasis=function(t){t.addClass(e);},i.prototype.removeEmphasis=function(t){t.removeClass(e);},i.prototype.isClickable=function(t){return t.hasClass(e);},i.prototype.registerOpenNavigatorDialog=function(t){this.openNavigatorDialog=t;},i.prototype.getPath=function(){return this.path;},t.VA.Core.Editors.Navigator=i;}.call(this),function(){"use strict";var t=this.Brightics,e=window.__module__.DataStructures.TreeNode;function i(t,i){this.__root=new e(t,i);}i.prototype.getRoot=function(){return this.__root;},i.prototype.addChild=function(t,e){return this.getRoot().addChild(t,e);},i.prototype.getChild=function(t){return this.getRoot().getChild(t);},i.prototype.deleteChild=function(t){this.getRoot().deleteChild(t);},t.VA.Core.Editors.NavigatorTree=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.options=e,this.editor=e.editor||null,this.items={},this.retrieveParent(t),this.createControls(),this.registerItems();}e.prototype.retrieveParent=function(t){this.$parent=t;},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-modeleditor-toolbar brtc-style-editor-toolbar brtc-style-col-12"></div>'),this.$parent.append(this.$mainControl),this.createNavigator(this.$mainControl);},e.prototype.createNavigator=function(e){this.navigator=new t.VA.Core.Editors.Navigator(e,this.options);},e.prototype.registerItems=function(){console.error("registerItems must be implemented");},e.prototype.addItem=function(e){var i=new(e.class&&"function"==typeof e.class?e.class:t.VA.Core.Editors.Toolbar.Item)(this.$mainControl,e);this.items[i.getItemType()]=i;},e.prototype.getHeight=function(){return this.$mainControl.outerHeight();},e.prototype.showItem=function(t){this.items[t].show();},e.prototype.hideItem=function(t){this.items[t].hide();},e.prototype.getItem=function(t){return this.items[t];},t.VA.Core.Editors.Toolbar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.options=e||{},this.options.attribute=this.options.attribute||{},this.options.action=this.options.action||{},this.retrieveParent(t),this.createControls(),this.initOptions(),this.applyOptions();}e.prototype.retrieveParent=function(t){this.$parent=t;},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem"></div>'),this.$parent.append(this.$mainControl);},e.prototype.initOptions=function(){},e.prototype.applyOptions=function(){this.applyAttribute(),this.applyAction(),this.applyVisible(),this.applySeparator();},e.prototype.applyAttribute=function(){for(var t in this.options.attribute){this.$mainControl.attr(t,this.options.attribute[t]);}},e.prototype.applyAction=function(){for(var t in this.options.action){"function"==typeof this.options.action[t]&&this.$mainControl.on(t,this.options.action[t].bind(this));}},e.prototype.applyVisible=function(){!1===this.options.visible&&this.$mainControl.hide();},e.prototype.applySeparator=function(){if(!0===this.options.separator){var t=$('<div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem" item-type="separator"></div>');this.$parent.append(t);}},e.prototype.setOptions=function(t){this.options=$.extend(this.options,t);},e.prototype.getOptions=function(){return this.options;},e.prototype.getTitle=function(){return this.options.attribute.title;},e.prototype.getItemType=function(){return this.options.attribute["item-type"];},e.prototype.show=function(){this.$mainControl.show();},e.prototype.hide=function(){this.$mainControl.hide();},e.prototype.setEnable=function(){this.$mainControl.removeClass("status-disabled");},e.prototype.setDisable=function(){this.$mainControl.addClass("status-disabled");},e.prototype.handleOnSelectionChanged=function(){},t.VA.Core.Editors.Toolbar.Item=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Function Clipboard","item-type":"clipboard"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){Studio.getClipboardManager().openClipboardDialog(!0);},t.VA.Core.Editors.Toolbar.ClipboardItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Datasource Management","item-type":"datasource"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(e){new t.VA.Core.Dialogs.DatasourceManagementDialog(this.$parent);},t.VA.Core.Editors.Toolbar.DatasourceItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Function Reference","item-type":"functionhelp"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){},t.VA.Core.Editors.Toolbar.FunctionhelpItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"History","item-type":"history"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){this.closeHistoryDialog(),this.openHistoryDialog(t);},e.prototype.closeHistoryDialog=function(){this.historySelector&&this.historySelector.close(),this.historySelector=null;},e.prototype.openHistoryDialog=function(e){var i,o=Studio.getEditorContainer().getActiveModelEditor(),n=o.getCommandManager(),r=n.getStacks(),a=[];for(var s in r){i=r[s].option&&r[s].option.fnUnit?r[s].getLabel()+" - "+r[s].options.fnUnit.display.label:r[s].getLabel(),a.push({name:r[s].getLabel(),description:i});}this.historySelector=new t.VA.Core.Dialogs.HistorySelector(o.$mainControl,{selectHistory:function selectHistory(t){t.OK&&n.go(t.goHistory);},stackIndex:n.index,source:a,editor:o});},t.VA.Core.Editors.Toolbar.HistoryItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Index","item-type":"index"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){this.closeIndexDialog(),this.openIndexDialog();},e.prototype.closeIndexDialog=function(t){var e=Studio.getEditorContainer().getActiveModelEditor().indexDialog;e&&e.close(),e=null;},e.prototype.openIndexDialog=function(e){var i=Studio.getEditorContainer().getActiveModelEditor();i.indexDialog=new t.VA.Core.Dialogs.IndexDialog(i.$mainControl,{editor:i,appendTo:i.$mainControl});},t.VA.Core.Editors.Toolbar.IndexItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Model Information","item-type":"model-info"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){this.closeInfoDialog(),this.openInfoDialog(t);},e.prototype.closeInfoDialog=function(){this.infoDialog&&this.infoDialog.close(),this.infoDialog=null;},e.prototype.openInfoDialog=function(e){var i=Studio.getEditorContainer().getActiveModelEditor(),o=i.getEditorInput(),n=Studio.getResourceManager().getProject(o.getProjectId());this.infoDialog=new t.VA.Core.Dialogs.InfoDialog(i.getMainArea(),{project:n,model:o,position:{my:"left top",at:"left bottom",of:e.target},appendTo:i.getMainArea(),modal:!1,title:"Model Information"});},t.VA.Core.Editors.Toolbar.ModelInfoItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i),this.isSelected=!1;}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Move Mode","item-type":"move-mode"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){var e=Studio.getEditorContainer().getActiveModelEditor();this.isSelected?(e.setEditorState("move-mode-enabled",!1),this.$mainControl.removeClass("status-selected")):(e.setEditorState("move-mode-enabled",!0),this.$mainControl.addClass("status-selected")),this.isSelected=!this.isSelected;},t.VA.Core.Editors.Toolbar.MoveModeItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i),this.refresh(),this.addCommandListener(),this.addGoHistoryListener();}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Redo","item-type":"redo"},action:{click:this.handleOnClick}});},e.prototype.refresh=function(){this.refreshEnable(),this.refreshTitle();},e.prototype.refreshEnable=function(){Studio.getEditorContainer().getActiveModelEditor().getCommandManager().canRedo()?this.$mainControl.removeClass("status-disabled"):this.$mainControl.addClass("status-disabled");},e.prototype.refreshTitle=function(){var t=Studio.getEditorContainer().getActiveModelEditor().getCommandManager(),e=t.stack,i=t.index,o=e[i+1]?e[i+1].getLabel():"";this.$mainControl.attr("title","Redo "+o);},e.prototype.addCommandListener=function(){var t=this;Studio.getEditorContainer().getActiveModelEditor().addCommandListener(function(e){t.refresh();});},e.prototype.addGoHistoryListener=function(){var t=this;Studio.getEditorContainer().getActiveModelEditor().addGoHistoryListener(function(e){t.refresh();});},e.prototype.handleOnClick=function(t){Studio.getEditorContainer().getActiveModelEditor().getCommandManager().redo();},t.VA.Core.Editors.Toolbar.RedoItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Run","item-type":"run"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){},t.VA.Core.Editors.Toolbar.RunItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Schedule","item-type":"schedule"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(e){var i=Studio.getEditorContainer().getActiveModelEditor();new t.VA.Core.Dialogs.ScheduleManagementDialog(i.$mainControl,{editorInput:i.options.editorInput,appendTo:i.$parent,position:{my:"center top",at:"center top+15%",of:window},title:"Schedule list"});},t.VA.Core.Editors.Toolbar.ScheduleItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{"item-type":"separator"}});},t.VA.Core.Editors.Toolbar.Separator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.TooltipItem=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Tooltip","item-type":"tooltip"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){var e=Studio.getEditorContainer().getActiveModelEditor();this.$mainControl.hasClass("status-selected")?(e.diagramEditorPage.changeTooltipEnabled(!1),this.$mainControl.removeClass("status-selected")):(e.diagramEditorPage.changeTooltipEnabled(!0),this.$mainControl.addClass("status-selected"));},t.VA.Core.Editors.Toolbar.TooltipItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i),this.refresh(),this.addCommandListener(),this.addGoHistoryListener();}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Undo","item-type":"undo"},action:{click:this.handleOnClick}});},e.prototype.refresh=function(){this.refreshEnable(),this.refreshTitle();},e.prototype.refreshEnable=function(){Studio.getEditorContainer().getActiveModelEditor().getCommandManager().canUndo()?this.$mainControl.removeClass("status-disabled"):this.$mainControl.addClass("status-disabled");},e.prototype.refreshTitle=function(){var t=Studio.getEditorContainer().getActiveModelEditor().getCommandManager(),e=t.stack,i=t.index,o=e[i]?e[i].getLabel():"";this.$mainControl.attr("title","Undo "+o);},e.prototype.addCommandListener=function(){var t=Studio.getEditorContainer().getActiveModelEditor(),e=this;t.addCommandListener(function(t){e.refresh();});},e.prototype.addGoHistoryListener=function(){var t=Studio.getEditorContainer().getActiveModelEditor(),e=this;t.addGoHistoryListener(function(t){e.refresh();});},e.prototype.handleOnClick=function(t){Studio.getEditorContainer().getActiveModelEditor().getCommandManager().undo();},t.VA.Core.Editors.Toolbar.UndoItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Upload","item-type":"upload"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){this.openRepositoryBrowserDialog();},e.prototype.openRepositoryBrowserDialog=function(e){var i=Studio.getEditorContainer().getActiveModelEditor();new t.VA.Core.Dialogs.RepositoryBrowserDialog(i.getMainArea(),{useButton:!1,filePath:"",open:function open(){$(".ui-dialog-titlebar.ui-widget-header",$(this).parent()).css("margin-left","30px !important");},resizable:!0,title:"Browse Repository"});},t.VA.Core.Editors.Toolbar.UploadItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Variables","item-type":"variable"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){Studio.getEditorContainer().getActiveModelEditor().getSideBarManager().expandStatusChange("variables",!0);},t.VA.Core.Editors.Toolbar.VariableItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Version Management","item-type":"version"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(e){var i=Studio.getEditorContainer().getActiveModelEditor(),o=i.getEditorInput(),n=o.getProjectId(),r=o.getFileId();new t.VA.Core.Dialogs.VersionManagementDialog(this.$mainControl,{projectId:n,fileId:r,position:{my:"center top",at:"center top+15%",of:window},editor:i});},t.VA.Core.Editors.Toolbar.VersionItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.Item.call(this,e,i),this.createZoomContextMenu();}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.Item.prototype),e.prototype.constructor=e,e.prototype.createZoomContextMenu=function(){var e=this,i=Studio.getEditorContainer().getActiveModelEditor();this.$ctxMenu=$('<div class="brtc-va-editor-toolitem-zoom-ctxmenu brtc-style-editor-toolitem-zoom-ctxmenu">   <ul>       <li action="0.6" title="x 0.6">x 0.6</li>       <li action="0.8" title="x 0.8">x 0.8</li>       <li action="1.0" title="x 1.0">x 1.0</li>   </ul></div>'),this.$parent.append(this.$ctxMenu),this.$ctxMenu.jqxMenu({theme:t.VA.Env.Theme,width:"56px",height:"180px",autoOpenPopup:!1,mode:"popup",animationHideDuration:0,animationShowDuration:0}),i.options.lastSelectedScale=this.$ctxMenu.find('li[action="1.0"]'),this.$ctxMenu.on("itemclick",function(t){var e=$(t.args);i.options.lastSelectedScale&&i.options.lastSelectedScale.removeClass("selected"),i.options.lastSelectedScale=e,i.options.lastSelectedScale.addClass("selected"),i.diagramEditorPage.changeScale(1*e.attr("action"));}),this.$ctxMenu.find('li[action="1.0"]').addClass("selected"),this.ctxMenuCloseHandler=function(){e.$ctxMenu.jqxMenu("close");};},e.prototype.initOptions=function(){this.setOptions({attribute:{title:"Zoom","item-type":"zoom"},action:{click:this.handleOnClick}});},e.prototype.handleOnClick=function(t){var e=$(t.target).offset().left-16,i=$(t.target).offset().top+$(t.target).height()+4;this.$ctxMenu.jqxMenu("open",e,i),$(".brtc-va-editors-modeleditor-diagram").on("scroll",this.ctxMenuCloseHandler),$(window).on("resize",this.ctxMenuCloseHandler);},t.VA.Core.Editors.Toolbar.ZoomItem=e;}.call(this),function(){"use strict";this.Brightics.VA.Core.Editors.Toolbar.ItemsTemplate={};}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-dataexplorer brtc-va-tab-contents">   <div class="brtc-va-views-dataexplorer-repostiory"></div></div>'),this.$parent.append(this.$mainControl),this.repositoryViewer=new t.VA.Core.Controls.RepositoryViewer(this.$mainControl.find(".brtc-va-views-dataexplorer-repostiory"));},e.prototype.destroy=function(){this.repositoryViewer.destroy();},e.prototype.render=function(){this.repositoryViewer.render();},t.VA.Core.Views.DataExplorer=e;}.call(this),function(t){var e=t.Brightics,i=function i(){var _e$VA$Core$Utils$Comm;return(_e$VA$Core$Utils$Comm=e.VA.Core.Utils.CommonUtils).dim.apply(_e$VA$Core$Utils$Comm,arguments);},o=brtc_require("crel"),n=e.VA.Env.Theme,_brtc_require$Datasou=brtc_require("Dao").DatasourceDao,r=_brtc_require$Datasou.DB,a=_brtc_require$Datasou.Cloud,s=r.getDatasources,l=r.addDatasource,c=r.updateDatasource,d=r.deleteDatasource,p=r.getDbTypes,u=a.getS3s,h=a.addS3,f=a.updateS3,m=a.deleteS3,g="Amazon S3",v=function v(t){return!1;};var b=[];var y=function y(t){return Promise.resolve($.ajax({type:"GET",url:"api/va/v2/rsa/publickey"})).then(function(_ref5){var t=_ref5.publicN,e=_ref5.publicE;var i=new RSAKey();return i.setPublic(t,e),i;}).then(function(e){return"RDB"===t.datasourceType?Object.assign({},t,{password:e.encrypt(t.password)}):Object.assign({},t,{secretAccessKey:e.encrypt(t.secretAccessKey)});});},C=function(){function t(t,i){var _this8=this;v(t,i),this.data=i.data,this.handler=i.handler,this.$control=$(o("div","datasource-management-view__tree")),this.$control.jqxTree({theme:e.VA.Env.Theme,source:this.getTreeSourceFromData(i.data),height:"100%",width:"100%",allowDrag:!1,allowDrop:!1}),this.$control.on("itemClick",function(t){v(t);var e=_this8.$control.jqxTree("getItem",t.args.element),i=_this8.getDataByItem(e);v(i,"selected"),_this8.handler.itemClick(i);}),t.append(this.$control);}return t.prototype.destroy=function(){this.$control.jqxTree("destroy");},t.prototype.getTreeSourceFromData=function(t){return t.map(function(_ref6,i){var t=_ref6.label,e=_ref6.items;return{html:"\n                        <i\n                            class=\"fa fa-"+("DB"===t?"database":"cloud")+"\"\n                            aria-hidden=\"true\"\n                        ></i> "+_.escape(t),expanded:!1,items:e.map(function(t,e){var i=t.datasourceName+" ("+(t.dbType||t.cloudType||g)+")";return{html:"\n                                <span\n                                    class=\"datasource-management-view__tree-item brtc-style-ellipsis\"\n                                    ds-type=\""+("RDB"===t.datasourceType?"RDB":"Cloud")+"\"\n                                    ds-name=\""+t.datasourceName+"\"\n                                    title=\""+i+"\"\n                                >"+_.escape(i)+"</span>\n                            ",items:[]};})};});},t.prototype.render=function(t){this.setData(t),this.$control.jqxTree({theme:e.VA.Env.Theme,source:this.getTreeSourceFromData(this.data)}),this.$control.jqxTree("refresh");},t.prototype.select=function(_temp){var _ref7=_temp===void 0?{}:_temp,t=_ref7.datasourceName,e=_ref7.datasourceType;var i=this.getItemByLabelAndType(t,e);if(this.$control.jqxTree("selectItem",i),!i)return;var o=this.getItemByElement(i.parentElement);o&&this.$control.jqxTree("expandItem",o);},t.prototype.getItemByElement=function(t){var e=this.$control.jqxTree("getItems");for(var _iterator=e,_isArray=Array.isArray(_iterator),_i6=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){var _ref8;if(_isArray){if(_i6>=_iterator.length)break;_ref8=_iterator[_i6++];}else{_i6=_iterator.next();if(_i6.done)break;_ref8=_i6.value;}var _i7=_ref8;if(_i7.element===t)return _i7;}return null;},t.prototype.getItemByLabelAndType=function(t,e){var i=this.$control.jqxTree("getItems");for(var _iterator2=i,_isArray2=Array.isArray(_iterator2),_i8=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){var _ref9;if(_isArray2){if(_i8>=_iterator2.length)break;_ref9=_iterator2[_i8++];}else{_i8=_iterator2.next();if(_i8.done)break;_ref9=_i8.value;}var _o3=_ref9;var _i9=_o3.element.querySelector("span");if(_i9&&_i9.getAttribute("ds-name")===t&&_i9.getAttribute("ds-type")===e)return _o3;}return null;},t.prototype.setData=function(t){this.data=t;},t.prototype.deleteById=function(_ref10){var t=_ref10.datasourceName,_ref10$datasourceType=_ref10.datasourceType,e=_ref10$datasourceType===void 0?"Cloud":_ref10$datasourceType;var i=this.getItemByLabelAndType(t,e);i&&this.$control.jqxTree("removeItem",i.element);},t.prototype.getDataByItem=function(t){var e=t.element.querySelector("span");if(e){var _t5=e.getAttribute("ds-name"),_i10=e.getAttribute("ds-type");for(var _iterator3=this.data,_isArray3=Array.isArray(_iterator3),_i11=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){var _ref11;if(_isArray3){if(_i11>=_iterator3.length)break;_ref11=_iterator3[_i11++];}else{_i11=_iterator3.next();if(_i11.done)break;_ref11=_i11.value;}var _e2=_ref11;for(var _iterator4=_e2.items,_isArray4=Array.isArray(_iterator4),_i12=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){var _ref12;if(_isArray4){if(_i12>=_iterator4.length)break;_ref12=_iterator4[_i12++];}else{_i12=_iterator4.next();if(_i12.done)break;_ref12=_i12.value;}var _o4=_ref12;if(_o4.datasourceName===_t5&&(_o4.datasourceType||"Cloud")===_i10)return _o4;}}return null;}},t;}(),x=function(){function t(t,e){var i=e||{};this.options=i,this.handler=i.handler||{};var n=$(o("div",{class:"datasource-management-view__form"}));this.$control=n,t.append(n);}return t.prototype.getAllValidationMessage=function(){return this.view.map(function(_ref13){var t=_ref13.validate;return t();}).filter(function(t){return t;});},t.prototype.focusFirstInvalidInput=function(){var t=this.view.find(function(_ref14){var t=_ref14.validate;return t();});t&&t.focus();},t.prototype.validate=function(){return this.view.forEach(function(t){return t.validate();});},t.prototype.isDirty=function(){var _this9=this;return this.view.some(function(_ref15){var t=_ref15.getValue,e=_ref15.key;return v(t(),_this9.data[e]),t()!==_this9.data[e];});},t.prototype.getJSON=function(){var t=this.view.reduce(function(t,e){var _Object$assign;return Object.assign(t,(_Object$assign={},_Object$assign[e.key]=e.getValue(),_Object$assign));},{});return"RDB"===this.data.datasourceType?Object.assign({datasourceType:"RDB"},t):Object.assign({datasourceType:"Cloud"},t);},t.prototype.setData=function(t){this.data=t,t&&"RDB"!==t.datasourceType&&(this.data=Object.assign({cloudType:g},t));},t.prototype.render=function(t,e){var _this10=this;if(this.setData(t),this.$control.empty(),!t)return;var i=function i(t,e){return o("div",{class:"datasource-management-view__input-row"},o("div",{class:"datasource-management-view__input-wrapper"},o("div",{class:"datasource-management-view__label-wrapper"},o("label",t,o("span",{class:"datasource-management-view__required-star"},"*"))),e),o("div",{class:"datasource-management-view__validation-area"}));},r=function r(t){return 0===t.trim().length?"Required field":"";},a=function a(t,e,_a2,_temp2){var _ref16=_temp2===void 0?{}:_temp2,_ref16$validator=_ref16.validator,s=_ref16$validator===void 0?r:_ref16$validator,_ref16$option=_ref16.option,l=_ref16$option===void 0?{}:_ref16$option;var c=o("input",Object.assign({class:"datasource-management-view__input",value:_a2,maxlength:80,title:l.disabled?_a2:""},l)),d=$(i(e,c)),p=$(c).jqxInput({theme:n,value:_a2,disabled:l.disabled,height:"100%",width:"300px"}),u=d.find(".datasource-management-view__validation-area"),h=function h(){var t=p.jqxInput("val"),e=s?s(t):"";return d.toggleClass("datasource-management-view__input-row--error",!!e),u.html(e),e;};return p.on("keyup",function(){return _this10.handler.valueChange();}),p.on("focusout",function(){h();}),{$el:d,getValue:function getValue(){return p.jqxInput("val");},validate:h,focus:function focus(){return p.focus();},key:t};},s=function s(t,e,r,a,_s){var l=o("div",Object.assign({class:"datasource-management-view__dropdown"},_s)),c=Math.max(0,r.indexOf(a)),d=$(l).jqxDropDownList({theme:n,source:r,selectedIndex:c,height:"100%",width:"300px",dropDownHeight:function(t){return Math.min(25*t,150)+"px";}(r.length)});d.on("change",function(){return _this10.handler.handleValueChange();});return{$el:$(i(e,l)),getValue:function getValue(){return d.jqxDropDownList("val");},validate:function validate(){return"";},key:t};},l="RDB"===t.datasourceType?"RDB":"Cloud",c={RDB:[a("datasourceName","Name",t.datasourceName,{option:{disabled:e}}),a("ip","IP",t.ip),a("port","Port",t.port,{validator:function validator(t){if(r(t))return r(t);var e=t.length;for(var _i13=0;_i13<e;_i13++){if(-1==="01234567890".indexOf(t[_i13]))return"Number type is required.";}return"";}}),s("dbType","DB Type",b,t.dbType),a("dbName","DB Name",t.dbName),a("userName","User Name",t.userName),a("password","Password",t.password,{option:{type:"password"}})],Cloud:[a("datasourceName","Name",t.datasourceName,{option:{disabled:e}}),s("cloudType","Cloud Type",[g],t.cloudType||g),a("accessKeyId","Access Key ID",t.accessKeyId),a("secretAccessKey","Secret Access Key",t.secretAccessKey,{option:{type:"password"}}),a("bucketName","Bucket Name",t.bucketName)]}[l];this.view=c,this.$control.append(c.map(function(t){return t.$el;})),v(c.map(function(t){return t.getValue();}));},t;}(),A=function(){function t(t,e){var _this11=this;var i=e||{};this.handler=i.handler;var r=$(o("div",{class:"datasource-management-view__detail"},o("div",{class:"datasource-management-view__form-area"}),o("div",{class:"datasource-management-view__button-area"},o("div",{class:"datasource-management-view__left-button-area"},o("button",{class:"datasource-management-view__delete-button"},"Delete")),o("div",{class:"datasource-management-view__right-button-area"},o("button",{class:"datasource-management-view__cancel-button"},"Cancel"),o("button",{class:"datasource-management-view__save-button"},"Save")))));this.data=i.item,this.$control=r,this.$formArea=this.$control.find(".datasource-management-view__form-area"),this.dmvForm=new x(this.$formArea,{item:this.item,handler:{valueChange:this.handleValueChange.bind(this)}}),this.$formArea.perfectScrollbar(),t.append(r);var a={theme:n,width:100,height:30};this.$buttonArea=this.$control.find(".datasource-management-view__button-area"),this.$saveButton=this.$buttonArea.find(".datasource-management-view__save-button").jqxInput(a),this.$cancelButton=this.$buttonArea.find(".datasource-management-view__cancel-button").jqxInput(a),this.$deleteButton=this.$buttonArea.find(".datasource-management-view__delete-button").jqxInput(a),this.$saveButton.click(function(t){_this11.handler.saveClick(_this11.getDataByType());}),this.$cancelButton.click(function(t){_this11.render(_this11.data,_this11.lastReadOnly);}),this.$deleteButton.click(function(t){_this11.data&&_this11.handler.deleteClick(_this11.data);}),this.$buttonArea.hide();}return t.prototype.isValid=function(){return 0===this.dmvForm.getAllValidationMessage().length;},t.prototype.focusFirstInvalidInput=function(){return this.dmvForm.focusFirstInvalidInput();},t.prototype.getDataByType=function(){return this.dmvForm.getJSON();},t.prototype.handleValueChange=function(){v("disabled",!this.dmvForm.isDirty()),this.$saveButton.jqxInput({disabled:!this.dmvForm.isDirty()});},t.prototype.render=function(t,e){this.data=t,this.dmvForm.render(t,e),this.lastReadOnly=e,this.$buttonArea.toggle(!!t),this.$deleteButton.toggle(!(!t||!t.datasourceName)),t&&this.$saveButton.jqxInput({disabled:!this.dmvForm.isDirty()});},t.prototype.getDatasourceName=function(){return this.data?this.data.datasourceName:"";},t;}();function w(t,o){var _this12=this;this.parentId=t,this.options=o,this.$parent=e.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId),this.$control=this._createControl(this.$parent),this.data=[{label:"Cloud Datasource",items:[]},{label:"DB",items:[]}],this.fetched=!1,i(function(){return _this12._fetchData().then(function(t){return _this12._init(t);});},{appendTo:this.$parent}).catch(function(t){console.error(t);});}w.prototype._createControl=function(t){var _this13=this;var i=$(o("div",{class:"datasource-managemenet-view__wrapper"},o("div",{class:"datasource-management-view__upper-button-area"},o("button",{class:"datasource-management-view__new-connection-button"},"New Connection ▼")),o("div",{class:"datasource-managemenet-view"},o("div",{class:"datasource-management-view__left-panel"}),o("div",{class:"datasource-management-view__right-panel"}))));return this.$dmvLeftPanel=i.find(".datasource-management-view__left-panel"),this.$dmvRightPanel=i.find(".datasource-management-view__right-panel"),this.$addNew=i.find(".datasource-management-view__new-connection-button").jqxInput({theme:n,width:120,height:30}),this.$newConnectionMenu=$(o("div",{class:"datasource-management-view__add-connection-menu"},o("ul",o("li",{action:"cloud"},"Cloud"),o("li",{action:"db"},"DB")))),this.$newConnectionMenu.jqxMenu({theme:e.VA.Env.Theme,width:"100px",height:"180px",autoOpenPopup:!1,mode:"popup",animationHideDuration:0,animationShowDuration:0}),this.$newConnectionMenu.on("itemclick",function(t){var e=t.args.getAttribute("action");v(t,e),_this13._handleNewConnectionClick(e);}),this.$addNew.click(function(t){var _this13$$addNew$offse=_this13.$addNew.offset(),e=_this13$$addNew$offse.top,i=_this13$$addNew$offse.left;_this13.$newConnectionMenu.jqxMenu("open",i-_this13.$newConnectionMenu.outerWidth()+_this13.$addNew.outerWidth(),e+_this13.$addNew.outerHeight()),v(t);}),t.append(i),i;},w.prototype.getElement=function(){return this.$control;},w.prototype._fetchData=function(){this.fetched=!0;var t=s(),e=u(),i=p();return Promise.all([t,e,i]).then(function(_ref17){var t=_ref17[0],e=_ref17[1],i=_ref17[2];return b=i,new Promise(function(i,o){i([{label:"Cloud Datasource",items:e},{label:"DB",items:t}]);});});},w.prototype._init=function(t){v("render",t),this.data=t,this.datasourceTree=new C(this.$dmvLeftPanel,{data:t,handler:{itemClick:this._handleItemClick.bind(this)}}),this.datasourceDetail=new A(this.$dmvRightPanel,{item:null,handler:{saveClick:this._handleSaveClick.bind(this),cancelClick:this._handleCancelClick.bind(this),deleteClick:this._handleDeleteClick.bind(this)}});},w.prototype._handleSaveClick=function(t){var _this14=this;v("handle save click",t),this.datasourceDetail.isValid()?this.selected?(i(function(){return y(t).then(function(t){return"RDB"===t.datasourceType?c(t):f(t);}).then(function(){_this14._modify(_this14.selected,t);});}),v(t)):i(function(){return y(t).then(function(t){return"RDB"===t.datasourceType?l(t):h(t);}).then(function(){_this14._new(t).then(function(){_this14.selected=t,_this14.datasourceTree.select(t),_this14.datasourceDetail.render(t,!0);});}).catch(function(t){t.responseText?e.VA.Core.Utils.WidgetUtils.openErrorDialog(JSON.parse(t.responseText)):e.VA.Core.Utils.WidgetUtils.openErrorDialog(t);});}):(v("validation error"),this.datasourceDetail.focusFirstInvalidInput());},w.prototype._new=function(t){var _this15=this;return Promise.resolve(t).then(function(e){var i=e||t;if(v("add",i),"RDB"===i.datasourceType){var _t6=_this15.data.find(function(t){return"DB"===t.label;});_t6&&(_t6.items=_t6.items.concat(Object.assign({},i,{password:""})));}else{var _t7=_this15.data.find(function(t){return"Cloud Datasource"===t.label;});_t7&&(_t7.items=_t7.items.concat(Object.assign({},i,{secretAccessKey:""})));}_this15.datasourceTree.render(_this15.data);}).catch(function(t){console.error(t);});},w.prototype._modify=function(t,e){var _this16=this;var i=t.datasourceName;i===e.datasourceName&&(this.data=this.data.map(function(_ref18){var t=_ref18.label,o=_ref18.items;return{label:t,items:o.map(function(t){return t.datasourceName===i?e:t;})};}),this.datasourceTree.setData(this.data),this.datasourceDetail.render(e,!0)),[].reduce(function(t,e){return t.then(e);},Promise.resolve()).then(function(){_this16.datasourceTree.select(e),_this16.selected=e;}).catch(function(t){console.error(t);});},w.prototype._handleCancelClick=function(){v("handle cancel click");},w.prototype._delete=function(_ref19){var t=_ref19.datasourceName,_ref19$datasourceType=_ref19.datasourceType,e=_ref19$datasourceType===void 0?"Cloud":_ref19$datasourceType;this.data=this.data.map(function(_ref20){var i=_ref20.label,o=_ref20.items;return{label:i,items:o.filter(function(i){return!((i.datasourceType||"Cloud")===e&&i.datasourceName===t);})};});},w.prototype._handleDeleteClick=function(t){var _this17=this;var e=t.datasourceName;v("handle delete click",e),i(function(){return("RDB"===t.datasourceType?d(t.datasourceName):m(t.datasourceName)).then(function(){_this17._delete(t),_this17.datasourceTree.deleteById(t),_this17.datasourceTree.setData(_this17.data),_this17.datasourceDetail.render(null);});});},w.prototype._handleNewConnectionClick=function(t){v("handle new connection click",t),this.selected=null;var e="cloud"===t?{datasourceName:"",datasourceType:"Cloud",accessKeyId:"",secretAccessKey:"",bucketName:""}:{datasourceName:"",datasourceType:"RDB",deploy:!1,ip:"",port:"",userName:"",password:"",dbType:"postgre",dbName:""};this.datasourceDetail.render(e),this.datasourceTree.select();},w.prototype._handleItemClick=function(t){v("handle item click"),this.selected=t,this.datasourceDetail.render(t,!0);},w.prototype.destroy=function(){this.datasourceTree&&(this.datasourceTree.destroy(),this.datasourceTree=null);},e.VA.Core.Views.DatasourceManagementView=w;}(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-palette brtc-va-tab-contents brtc-style-tab-content">   <div class="brtc-va-views-palette-filter brtc-va-searcharea brtc-style-search-area"></div>   <div class="brtc-va-views-palette-navigator-wrapper  brtc-va-contentsarea">       <div class="brtc-va-views-palette-navigator"></div>   </div></div>'),this.$parent.append(this.$mainControl),this.$filter=this.$mainControl.find(".brtc-va-views-palette-filter"),this.$navigator=this.$mainControl.find(".brtc-va-views-palette-navigator"),this.createFilterControl(),this.createNavigatorControl(),this.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar();},e.prototype.createFilterControl=function(){var e=this,i=$('<input type="search" class="brtc-va-views-palette-filter-input searchinput"/>');this.$filter.append(i),i.jqxInput({placeHolder:"Search Item",theme:t.VA.Env.Theme});var o=function o(i){var o=i.target.value.toLowerCase(),n=e.$mainControl.find(".brtc-va-views-palette-fnunit-list");$.each(n,function(t,i){e.$navigator.jqxNavigationBar("expandAt",t);});var r=t.VA.Implementation.DeepLearning.Functions.Library.getListByTags([o.trim()]),a=e.$mainControl.find(".brtc-va-views-palette-fnunit");$.each(a,function(e,i){var o=$(i).parent(),n=t.VA.Core.Utils.WidgetUtils.getData(o.find(".brtc-va-views-palette-fnunit"),"func");o.css("display",$.inArray(n,r)>-1?"block":"none");}),n=e.$mainControl.find(".brtc-va-views-palette-fnunit-list"),$.each(n,function(t,e){var i=$(e).find(".brtc-va-views-palette-fnunit-content").filter(function(){return"block"==$(this).css("display");});$(e).css("display",i.length>0?"block":"none"),$(e).prev().css("display",i.length>0?"block":"none");}),e.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar("update");};i.keyup(function(t){o(t);}),i.on("search",function(){o(event);});},e.prototype.createNavigatorControl=function(){var e=this,i={url:"api/va/v2/studio/palette/"+this.options.modelType,type:"GET",contentType:"application/json; charset=utf-8",blocking:!1};$.ajax(i).done(function(i){if(e.options.additionalGroup&&i.push(e.options.additionalGroup),e.createFunctions(i),e.options.modelType===t.VA.Implementation.DataFlow.Clazz);else{e.options.draggable&&e.draggablePalette();var o={theme:t.VA.Env.Theme,expandMode:"multiple",expandedIndexes:[],width:"100%"};for(var n in i){o.expandedIndexes.push(n);}e.$navigator.jqxNavigationBar(o);}});},e.prototype.appendFunction=function(e){var i=this,o=$('<div class = "brtc-va-views-palette-fnunit-list"></div>');$.each(e.functions,function(e,n){if(n.visible){var r=i.options.modelType;t.VA.Core.Utils.WidgetUtils.createPaletteItem(o,n.func,r);}}),i.$navigator.append('<div>   <div>       <div class="brtc-va-views-palette-fnunit-type">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e.label)+"</div>   </div></div>"),i.$navigator.append(o);},e.prototype.createFunctions=function(t){var e=this;$.each(t,function(t,i){i.visible&&e.appendFunction(i);});},e.prototype.draggablePalette=function(){var t=this;this.$navigator.find(".brtc-va-views-palette-fnunit").each(function(){$(this).mouseover(function(){$(this).toggleClass("brtc-va-views-palette-fnunit-hover");}).mouseout(function(){$(this).toggleClass("brtc-va-views-palette-fnunit-hover");}),t._draggableFnUnit($(this));});},e.prototype._draggableFnUnit=function(e){var i=this;e.draggable({appendTo:"body",scroll:!1,cursor:"move",cursorAt:{left:5,top:5},helper:function helper(o){var n=$(this).clone();n.css({"z-index":5100});var r={functions:[{func:t.VA.Core.Utils.WidgetUtils.getData(e,"func")}],links:[]};return t.VA.Core.Utils.WidgetUtils.putData(n,"template",r),t.VA.Core.Utils.WidgetUtils.putData(n,"source",i),n;},start:function start(t,e){$(".brtc-va-studio").addClass("brtc-va-studio-dragging"),$(this).draggable("option","cursorAt",{left:Math.floor(e.helper.width()/2),top:Math.floor(e.helper.height()/2)});},drag:function drag(t,e){e.helper.trigger("feedback",[{clientX:t.clientX,clientY:t.clientY}]);},stop:function stop(t,e){$(".brtc-va-studio").removeClass("brtc-va-studio-dragging");}});},t.VA.Core.Views.DeepLearningPalette=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e||{},this.listeners={},this.opened=[],this.maxTabCount=this.options.maxTabCount||6,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-menubar-editor-title-container">   <ul>       <li class="brtc-va-tools-menubar-editor-tab newmodel" title="Open Model/Report">           <div class="brtc-va-tools-menubar-editor-title-new-button"></div>       </li>   </ul></div>'),this.$parent.append(this.$mainControl),this.createNewEditorButton(this.$mainControl.find(".brtc-va-tools-menubar-editor-tab.newmodel"));},e.prototype.createNewEditorButton=function(t){this.newEditorButton=t,t.on("click",this.handleNewEditorButtonClicked.bind(this));},e.prototype.showNewEditorButton=function(){this.newEditorButton.css("display","block");},e.prototype.hideNewEditorButton=function(){this.newEditorButton.css("display","none");},e.prototype.handleNewEditorButtonClicked=function(){Studio.getLayoutManager().showProjectViewerPopup();},e.prototype.openTab=function(t){var e=this.getIdFromEditorInput(t).pid,i=this.getIdFromEditorInput(t).fid,o=this.getTargetTabIndex(e,i);if(o>-1)this.selectTabIndex(o);else{if(this.isOverMaxTabCount())return this.showErrorMessage(),!1;this.createTab(t),this.selectTab(e,i);}return!0;},e.prototype.updateTab=function(t){var e=this.getIdFromEditorInput(t).pid,i=this.getIdFromEditorInput(t).fid,o=this.getTargetTabIndex(e,i);if(o>-1){var n=this.$mainControl.find("li:eq("+o+")");this.setTabTemplateData(n,t);}},e.prototype.closeTab=function(t){var e=this.getIdFromEditorInput(t).pid,i=this.getIdFromEditorInput(t).fid,o=this.getSelectedTabIndex(),n=this.getTargetTabIndex(e,i);if(n>-1&&(this.closeTabIndex(n),o===n&&this.getOpenedTabs().length)){var r=0===n?0:n-1;return this.selectTabIndex(r),this.getEditorInputByIndex(r);}},e.prototype.unselectAll=function(){this.$mainControl.find("li").removeClass("selected");},e.prototype.getSelectedTabIndex=function(){return this.$mainControl.find("li.selected").length?this.$mainControl.find("li.selected").prevAll().length:-1;},e.prototype.getOpenedTabs=function(){return this.opened;},e.prototype.getTargetTabIndex=function(t,e){for(var i=-1,o=0;o<this.opened.length;o++){if(this.opened[o].pid===t&&this.opened[o].fid===e){i=o;break;}}return i;},e.prototype.getEditorInputByIndex=function(t){if(0<=t&&t<this.opened.length){var e=this.opened[t].pid,i=this.opened[t].fid;return this.getEditorInput(e,i);}},e.prototype.selectTab=function(t,e){for(var i=0;i<this.opened.length;i++){if(this.opened[i].pid===t&&this.opened[i].fid===e){this.selectTabIndex(i);break;}}},e.prototype.selectTabIndex=function(t){this.$mainControl.find("li").removeClass("selected"),t>-1&&this.$mainControl.find("li:eq("+t+")").addClass("selected");},e.prototype.closeTabIndex=function(t){t>-1&&(this.opened.splice(t,1),this.$mainControl.find("li:eq("+t+")").remove());},e.prototype.isOverMaxTabCount=function(){return this.opened.length>=this.maxTabCount;},e.prototype.showErrorMessage=function(){return t.VA.Core.Utils.WidgetUtils.openInformationDialog("You can not open more than "+this.maxTabCount+" editors.");},e.prototype.createTab=function(t){var e=this.getIdFromEditorInput(t).pid,i=this.getIdFromEditorInput(t).fid;this.opened.push({pid:e,fid:i}),this.createTabTemplate(t);},e.prototype.createTabTemplate=function(t){var e=$('<li class="brtc-va-tools-menubar-editor-tab">   <div class="brtc-va-tools-menubar-editor-title">      <div class="brtc-va-tools-menubar-editor-title-icon"></div>      <div class="brtc-va-tools-menubar-editor-title-text"></div>   </div>   <div class="brtc-va-tools-menubar-editor-close-button"></div></li>');this.$mainControl.find(".brtc-va-tools-menubar-editor-tab.newmodel").before(e),this.setTabTemplateData(e,t),this.createTabCloseHandler(e.find(".brtc-va-tools-menubar-editor-close-button")),this.createTabClickHandler(e);},e.prototype.setTabTemplateData=function(t,e){var i=this.getIdFromEditorInput(e).pid,o=this.getIdFromEditorInput(e).fid,n=e.getLabel(),r=e.getContents().type;t.data({pid:i,fid:o}),t.find(".brtc-va-tools-menubar-editor-title-icon").addClass(r),t.find(".brtc-va-tools-menubar-editor-title-text").text(n),t.attr("title",n);},e.prototype.createTabCloseHandler=function(t){t.on("click",this.handleTabClosed.bind(this));},e.prototype.getTabTemplateFromEventTarget=function(t){return $(t.target).hasClass("brtc-va-tools-menubar-editor-tab")?$(t.target):$(t.target).parents(".brtc-va-tools-menubar-editor-tab");},e.prototype.handleTabClosed=function(t){var e=this.getTabTemplateFromEventTarget(t),i=e.data("pid"),o=e.data("fid");Studio.getLayoutManager().closeEditor(this.getEditorInput(i,o)),t.stopPropagation();},e.prototype.createTabClickHandler=function(t){t.on("click",this.handleTabClicked.bind(this));},e.prototype.handleTabClicked=function(t){var e=this.getTabTemplateFromEventTarget(t),i=e.data("pid"),o=e.data("fid");Studio.getLayoutManager().openEditor(this.getEditorInput(i,o));},e.prototype.getIdFromEditorInput=function(t){return{pid:t.getProjectId(),fid:t.getFileId()};},e.prototype.getEditorInput=function(t,e){return Studio.getResourceManager().getFile(t,e);},t.VA.Core.Views.EditorTab=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-funcproperties brtc-va-tab-contents brtc-style-tab-content"></div>'),this.$parent.append(this.$mainControl);},e.prototype.selectionChanged=function(t){this.propertiesPanel&&this.propertiesPanel.destroy(),this.empty(),t&&t.length>0&&(this.propertiesPanel=this.options.panelFactory.createPropertiesPanel(this.$mainControl,{width:"100%",height:"100%",fnUnit:t[0]}));},e.prototype.empty=function(){this.$mainControl.empty();},t.VA.Core.Views.FuncProperties=e;}.call(this),function(){"use strict";var t=this.Brightics,e={id:"in-left",group:"in:l",args:{},markup:'<circle class="fnunit-port" r="0"/>'},i={id:"out-right",group:"out:r",args:{},markup:'<circle class="fnunit-port" r="0"/>'};function o(t,e){this.parentId=t,this.options=e,this.templates=[],this.retrieveParent(),this.createControls();}o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},o.prototype.createControls=function(){var e=this;this.$mainControl=$('<div class="brtc-va-views-library brtc-va-tab-contents">   <div class="brtc-va-views-library-group">       <div class="brtc-va-views-library-group-selector"></div>   </div>   <div class="brtc-va-views-library-separator"></div>   <div class="brtc-va-views-library-totalcount"><span>Total</span><span>0</span></div>   <div class="brtc-va-views-library-container"></div>   <div class="brtc-va-views-library-template-ctxmenu">       <ul>           <li action="edit">Edit</li>           <li action="delete">Delete</li>       </ul>   </div></div>'),this.$parent.append(this.$mainControl),this.$mainControl.find(".brtc-va-views-library-container").perfectScrollbar();var i=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"id"},{name:"label"}],url:"api/va/v2/ws/libraries",async:!0});this.$librarySelector=this.$parent.find(".brtc-va-views-library-group-selector").jqxDropDownList({theme:t.VA.Env.Theme,source:i,displayMember:"label",valueMember:"id",placeHolder:"Choose Template",width:"100%",height:"30px",itemHeight:30}),this.$librarySelector.on("select",function(t){e.fillTemplates(t.args.item.value);}),this.$ctxMenu=this.$mainControl.find(".brtc-va-views-library-template-ctxmenu").jqxMenu({theme:t.VA.Env.Theme,width:"140px",height:"150px",autoOpenPopup:!1,mode:"popup",animationHideDuration:0,animationShowDuration:0}),this.$ctxMenu.on("itemclick",function(t){var i=$(t.args),o=i.closest(".brtc-va-views-library-template-ctxmenu").attr("library-id"),n=i.closest(".brtc-va-views-library-template-ctxmenu").attr("template-id");"edit"==i.attr("action")?e.editTemplate(o,n):"delete"==i.attr("action")&&e.deleteTemplate(o,n);});},o.prototype.activate=function(){if(this.$librarySelector.jqxDropDownList("getSelectedItem"));else{var t=this.$librarySelector.jqxDropDownList("getItems");t&&t.length>0&&this.selectLibrary(t[0].value);}},o.prototype.editTemplate=function(e,i){var o=this;new t.VA.Core.Dialogs.EditResourceDialog(this.$mainControl,{title:"Edit Template",label:o.templates[i].label,description:o.templates[i].description,close:function close(n){if(n.OK){var r={url:"api/va/v2/ws/libraries/"+e+"/templates/"+i+"/update",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({label:n.label,description:n.description}),blocking:!0};$.ajax(r).done(function(t){o.selectLibrary(e);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}}});},o.prototype.deleteTemplate=function(e,i){var o=this;t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Are you sure you want to delete ?",function(n){if(n.OK){var r={url:"api/va/v2/ws/libraries/"+e+"/templates/"+i+"/delete",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0};$.ajax(r).done(function(t){o.selectLibrary(e);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}});},o.prototype.selectLibrary=function(t){var e=this.$librarySelector.jqxDropDownList("getSelectedItem");if(e&&e.value==t)this.fillTemplates(t);else{var i=this.$librarySelector.jqxDropDownList("getItems");for(var o in i){if(i[o].value==t){this.$librarySelector.jqxDropDownList("selectItem",i[o]);break;}}}},o.prototype.appendTemplate=function(e){var i=this;e.id=t.VA.Core.Utils.IDGenerator.template.id();var o={url:"api/va/v2/ws/libraries/"+e.library_id+"/templates",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),blocking:!0};$.ajax(o).done(function(t){var o=i.$librarySelector.jqxDropDownList("getSelectedItem");o&&o.value==e.library_id&&i.fillTemplates(e.library_id);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},o.prototype.fillTemplates=function(e){var i=this,o={url:"api/va/v2/ws/libraries/"+e+"/templates",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0};$.ajax(o).done(function(t){for(var e in i.$mainControl.find(".brtc-va-views-library-container").empty(),i.$mainControl.find(".brtc-va-views-library-totalcount > span:nth-child(2)").text("0"),i.templates={},t.sort(function(t,e){return t.label.toLowerCase()<e.label.toLowerCase()?-1:t.label.toLowerCase()>e.label.toLowerCase()?1:0;}),i.$mainControl.find(".brtc-va-views-library-totalcount > span:nth-child(2)").text(t.length),t){i._addTemplate(t[e]),i.templates[t[e].id]=t[e];}}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},o.prototype._addTemplate=function(t){var e=this,i=$('<div class="brtc-va-views-library-template">   <div class="brtc-va-views-library-template-label brtc-va-studio-dm-draggable">GalaxyS7 Preprocessing</div>   <div class="brtc-va-views-library-template-author"><span>Created on </span><span></span><span> by </span><span></span></div>   <div class="brtc-va-views-library-template-edit"></div>   <div class="brtc-va-views-library-template-preview"></div></div>');this.$mainControl.find(".brtc-va-views-library-container").append(i),i.find(".brtc-va-views-library-template-label").text(t.label),i.find(".brtc-va-views-library-template-label").attr("title",t.label),i.find(".brtc-va-views-library-template-author > span:nth-child(2)").text(moment(t.create_time).format("YYYY-MM-DD HH:mm")),i.find(".brtc-va-views-library-template-author > span:nth-child(4)").text(t.creator),i.find(".brtc-va-views-library-template-edit").click(function(){var i=$(this).offset().left+$(this).width()-140-2,o=$(this).offset().top+$(this).height();e.$ctxMenu.attr("library-id",t.library_id),e.$ctxMenu.attr("template-id",t.id),e.$ctxMenu.jqxMenu("open",i,o);});var o,n=i.find(".brtc-va-views-library-template-preview"),r=new joint.dia.Graph(),a=new joint.dia.Paper({el:n,width:"100%",height:"calc(100% - 53px)",model:r,theme:"none",interactive:!1});for(o in a.$el.css("pointer-events","none"),a.scale(.5),t.contents.functions){var s=this._createFnUnitFigure(t.contents.functions[o]);r.addCells([s]);}for(o in t.contents.links){var l=this._createLinkFigure(r,t.contents.links[o]);r.addCells([l]);}var c=r.getLinks();return $.each(c,function(t,e){e.toBack();}),this._draggableTemplate(i,t.contents),i;},o.prototype._draggableTemplate=function(e,i){var o=this;e.find(".brtc-va-views-library-template-label").draggable({appendTo:"body",scroll:!1,cursor:"move",cursorAt:{left:5,top:5},helper:function helper(n){var r=e.clone();r.css({width:410,background:"#FFFFFF","z-index":5100});var a=t.VA.Core.Utils.ModelUtils.cloneModel(i);return t.VA.Core.Utils.WidgetUtils.putData(r,"template",a),t.VA.Core.Utils.WidgetUtils.putData(r,"source",o),r;},start:function start(t,e){$(".brtc-va-studio").addClass("brtc-va-studio-dragging"),$(this).draggable("option","cursorAt",{left:Math.floor(e.helper.width()/2),top:Math.floor(e.helper.height()/2)});},drag:function drag(t,e){e.helper.trigger("feedback",[{clientX:t.clientX,clientY:t.clientY}]);},stop:function stop(t,e){$(".brtc-va-studio").removeClass("brtc-va-studio-dragging");}});},o.prototype._createFnUnitFigure=function(o){o.display.diagram.position.x+=t.VA.Env.Diagram.PAPER_MARGIN_LEFT,o.display.diagram.position.y+=t.VA.Env.Diagram.PAPER_MARGIN_TOP;var n=new t.VA.Core.Shapes.FnUnitFigure({position:o.display.diagram.position,size:{width:t.VA.Env.Diagram.FIGURE_WIDTH,height:t.VA.Env.Diagram.FIGURE_HEIGHT},fid:o.fid,ports:{groups:{"in:l":{position:{name:"left"},attrs:{".fnunit-port":{stroke:"red"}}},"out:r":{position:{name:"right"},attrs:{".fnunit-port":{stroke:"blue"}}}},items:[e,i]}});n.label(o.display.label,.5);var r=this.options.modelType,a=t.VA.Core.Interface.Functions[r][o.func];return a&&(n.tooltip(o.display.label+" ("+a.defaultFnUnit.display.label+")"),n.category(a)),n;},o.prototype._createLinkFigure=function(e,i){var o=this.getFigureByFnUnitId(e,i[SOURCE_FID]),n=this.getFigureByFnUnitId(e,i[TARGET_FID]);return new t.VA.Core.Shapes.LinkFigure({kid:i.kid,source:{id:o.id,port:"out-right"},target:{id:n.id,port:"in-left"}});},o.prototype.getFigureByFnUnitId=function(t,e){var i=t.getElements();for(var o in i){if(i[o].attributes.fid===e)return i[o];}},o.prototype.refresh=function(){var t=this.getSelectedLibraryId();t&&this.fillTemplates(t);},o.prototype.getSelectedLibraryId=function(){return this.$librarySelector.val();},o.prototype.destroy=function(){this.$librarySelector.jqxDropDownList("destroy"),this.$ctxMenu.jqxMenu("destroy");},t.VA.Core.Views.LibraryExplorer=o;}.call(this),function(t){"use strict";var e=t.Brightics,i=500,o=function o(t){if(_.isUndefined(t))throw new Error("ASSERT");};function n(t){o(t.$parent),o(t.projectId),o(t.model);var n=this;n.$parent=t.$parent,n.projectId=t.projectId,n.model=t.model,n.editor=t.editor,n.view=function(t){var o=$(crel("div",{class:"flow-outline-wrapper",style:"height: 100%;"},crel("div",{class:"flow-outline-button-wrapper"}),crel("div",{class:"flow-outline",style:"box-sizing: border-box;"}),crel("div",{class:"flow-outline-error"}))),r=o.find(".flow-outline").jqxTree({width:"100%",height:"100%",source:[],theme:e.VA.Env.Theme,allowDrag:!1,allowDrop:!1,toggleMode:"x"}),a=o.find(".flow-outline-error");t.append(o);var s=$(crel("button",{class:"flow-outline-expand-all-btn"},"Expand All")).jqxButton({theme:e.VA.Env.Theme}),l=$(crel("button",{class:"flow-outline-collapse-all-btn"},"Collapse All")).jqxButton({theme:e.VA.Env.Theme});o.find(".flow-outline-button-wrapper").append(l,s);var c=0,d=-1,p=!1;return{bind:{doubleClickItem:function doubleClickItem(t){r.on("itemClick",function(e){if(!p){var o=Date.now(),n=e.args.element.id;d===n&&o-c<=i?(e.stopPropagation(),c=0,d=-1,t(e.args.element.id)):(d=n,c=o);}});},clickExpandAll:function clickExpandAll(t){s.on("click",function(e){t();});},clickCollapseAll:function clickCollapseAll(t){l.on("click",function(e){t();});}},render:{error:function error(t){r.jqxTree({disabled:!0}),p=!0,a.html(t.message),o.addClass("error");},all:function all(){var t=n.getData();n.source=t,r.jqxTree({source:t,disabled:!1}),p=!1,o.removeClass("error");},underline:function underline(t){var e=r.find(".underline");if(e&&e.removeClass("underline"),t){var i=r.find("#"+t);i&&i.children(0).children(0).addClass("underline");}},navigate:function navigate(){},expandAll:function expandAll(){r.jqxTree("expandAll");},collapseAll:function collapseAll(){r.jqxTree("collapseAll");},status:function status(t){var e=Studio.getEditorContainer().getActiveModelEditor(),i=t.fid,o=t.status;if(i){var n=r.find("#"+i);n&&($(n).find(".item-status").attr("status",o),e.showStatus(i,$(n).find(".item-status")));}}}};}(n.$parent),n.view.bind.doubleClickItem(function(t){n.onDoubleClickItem(t);}),n.view.bind.clickExpandAll(function(){n.view.render.expandAll();}),n.view.bind.clickCollapseAll(function(){n.view.render.collapseAll();}),n.refresh();}n.prototype.onDoubleClickItem=function(){throw new Error("not implemented");},n.prototype.getData=function(){throw new Error("not implemented");},n.prototype.getProjectId=function(){return this.getEditor().getEditorInput().getProjectId();},n.prototype.refresh=function(t,e){try{t?this.view.render[t](e):this.view.render.all();}catch(t){this.view.render.error(t);}},e.VA.Core.Views.Outline=n;}(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils;function i(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls(),this.functionsList=[];}i.prototype.retrieveParent=function(){this.$parent=e.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-palette brtc-va-tab-contents brtc-style-tab-content">   <div class="brtc-va-views-palette-context brtc-va-contextarea"></div>   <div class="brtc-va-views-palette-filter brtc-va-searcharea brtc-style-search-area"></div>   <div class="brtc-va-views-palette-navigator-wrapper  brtc-va-contentsarea">       <div class="brtc-va-views-palette-navigator"></div>   </div></div>'),this.$parent.append(this.$mainControl),this.$context=this.$mainControl.find(".brtc-va-views-palette-context"),this.$filter=this.$mainControl.find(".brtc-va-views-palette-filter"),this.$navigator=this.$mainControl.find(".brtc-va-views-palette-navigator"),this.createFilterControl(),this.createNavigatorControl(),this.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar();},i.prototype.applyFilter=function(i,o){if(o===void 0){o=!0;}var n=this,r=i,a=n.$mainControl.find(".brtc-va-views-palette-fnunit-list"),s=n.$mainControl.find('div[role="tab"]');o&&$.each(a,function(t,e){n.$navigator.jqxNavigationBar("expandAt",t);});var l=t.VA.Core.Functions.Library.getListByTags([r.trim()]),c=n.$mainControl.find(".brtc-va-views-palette-fnunit");$.each(c,function(t,i){var o=$(i).parent(),n=e.WidgetUtils.getData(o.find(".brtc-va-views-palette-fnunit"),"func");o.css("display",$.inArray(n,l)>-1?"block":"none");}),a=n.$mainControl.find(".brtc-va-views-palette-fnunit-list");var d=n.$navigator.jqxNavigationBar("expandedIndexes");$.each(a,function(t,e){var i=$(e).find(".brtc-va-views-palette-fnunit-content").filter(function(){return"block"==$(this).css("display");}),o=d.indexOf(t)>=0,n=$(s[t]).find(".brtc-va-views-palette-fnunit-type");"UDF"!==(n=n&&n.length>0?$($(s[t]).find(".brtc-va-views-palette-fnunit-type")[0]).text():"").trim()&&($(e).css("display",o&&i.length>0?"block":"none"),$(e).prev().css("display",i.length>0?"block":"none"));}),n.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar("update");},i.prototype.getContextList=function(){var t=[],e=["control","process","deeplearning","opt","ad"];return _.forEach(this.functionsList,function(i){var o=i.attr("context"),n=i.attr("category");_.isEmpty(o)||_.indexOf(e,n)>-1||(t=_.union(t,[o]));}),t;},i.prototype.createContextControl=function(){if(!(this.getContextList().length<2)){var t=this,e=$('<div class="brtc-va-views-palette-context-check-spark selected">Spark</div>'),i=$('<div class="brtc-va-views-palette-context-check-python selected">Python</div>');this.$context.append(i).append(e),e.click(function(){$(this).hasClass("selected")?($(this).removeClass("selected"),t.hideByContext("scala")):($(this).addClass("selected"),t.showByContext("scala"));}),i.click(function(){$(this).hasClass("selected")?($(this).removeClass("selected"),t.hideByContext("python")):($(this).addClass("selected"),t.showByContext("python"));});}},i.prototype.showByContext=function(t){_.forEach(this.functionsList,function(e){_.isEqual(t,e.attr("context"))&&!_.isEqual("none",e.attr("title"))&&e.removeClass("brtc-style-display-none-important").addClass("brtc-style-display-flex-important");});},i.prototype.hideByContext=function(t){var e=["control","process","deeplearning","opt","ad"];_.forEach(this.functionsList,function(i){_.isEqual(t,i.attr("context"))&&-1==_.indexOf(e,i.attr("category"))&&i.removeClass("brtc-style-display-flex-important").addClass("brtc-style-display-none-important");});},i.prototype.createFilterControl=function(){var e=this,i=$('<input type="search" class="brtc-va-views-palette-filter-input searchinput"/>');this.$filter.append(i),this.$filterInput=i,i.jqxInput({placeHolder:"Search Item",theme:t.VA.Env.Theme}),i.keyup(function(t){e.applyFilter(t.target.value.toLowerCase());}),i.on("search",function(){e.applyFilter(event.target.value.toLowerCase());});},i.prototype.createNavigatorControl=function(){var e=this;(function(){var i={url:"api/va/v2/studio/palette/"+e.options.modelType,type:"GET",contentType:"application/json; charset=utf-8",blocking:!1};$.ajax(i).done(function(i){var o;e.options.additionalGroup&&i.push(e.options.additionalGroup),"data"===e.options.modelType?o="DataFlow":"deeplearning"===e.options.modelType?o="DeepLearning":"script"===e.options.modelType?o="Script":"control"===e.options.modelType&&(o="ControlFlow");var n=t.VA.Implementation[o].Functions;if("Script"!==o)for(var r in n){if(n[r].defaultFnUnit){var a=n[r].defaultFnUnit.func,s=n[r].category;if("bigdata"!==s){var l=!1,c={func:a,visible:!0};for(var d in i){if(i[d].key===s){for(var p in i[d].functions){if(i[d].functions[p].func===a){l=!0;break;}}l||"udf"===s||i[d].functions.push(c);}}}}}i=e.createFunctions(i),e.createContextControl(),e.options.draggable&&e.draggablePalette();var u={theme:t.VA.Env.Theme,expandMode:"multiple",expandedIndexes:[],width:"100%"};for(var h in i){u.expandedIndexes.push(parseInt(h,10));}e.$navigator.jqxNavigationBar(u),e.$navigator.on("collapsedItem",function(t){e.$mainControl.find(".ps-container").perfectScrollbar("update");}),e.$navigator.on("expandedItem",function(t){e.$mainControl.find(".ps-container").perfectScrollbar("update");});});}).bind(this)();},i.prototype.makeHeaderButton=function(i){var o=this,n=$('   <div class="brtc-va-views-palette-header-button">       <button class="brtc-va-controls-palette-create"><div class="brtc-va-icon"></div>Create UDF</button>       <button class="brtc-va-controls-palette-import"><div class="brtc-va-icon"></div>Import UDF</button>   </div>');i.append(n);var r=n.find(".brtc-va-controls-palette-create"),a=n.find(".brtc-va-controls-palette-import");r.jqxButton({theme:t.VA.Env.Theme}),r.on("click",function(){var t=window.location.origin+"/toolkit/udf-generator/spec-generator";window.open(t,"Brightics ToolKit");}),a.jqxButton({theme:t.VA.Env.Theme}),a.on("click",function(){new t.VA.Core.Dialogs.ImportUDFDialog(o.$mainControl,{fileType:"AddonFunction",title:"Import UDF",close:function close(t){t.OK&&(e.WidgetUtils.openInformationDialog("Imported successfully new UDF"),o.refreshControl());}});});},i.prototype.appendFunction=function(i){var o=this,n=$('<div class = "brtc-va-views-palette-fnunit-list"></div>');i&&"udf"===i.key&&this.makeHeaderButton(n);var r=i.functions.sort(function(e,i){var n=t.VA.Core.Interface.Functions[o.options.modelType][e.func],r=n?n.defaultFnUnit:void 0,a=r?"python"===r.context?1:-1:1,s=t.VA.Core.Interface.Functions[o.options.modelType][i.func],l=s?s.defaultFnUnit:void 0;return a-(l?"python"===l.context?1:-1:1);});i&&"udf"===i.key?r.forEach(function(i,r){if(i.visible){var a=o.options.modelType,s=(l=i,function(e){if(e.OK){var i=l&&l.func?l.func:"";$.ajax({url:"api/va/v3/ws/udfs/"+i,type:"DELETE",contentType:"application/json; charset=utf-8",blocking:!0}).done(function(e){"OK"===e&&(o.refreshControl(),""===i?t.VA.Core.Utils.WidgetUtils.openErrorDialog("Sorry! UDF has been Deleted. Try again."):(delete t.VA.Core.Interface.Functions[a][i],o.options.editor.diagramEditorPage.render(),o.options.editor.resetSheetEditorPage()));}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}});a=o.options.modelType;i.deletable?e.WidgetUtils.createPaletteUDFItem(n,i.func,a,s):e.WidgetUtils.createPaletteItem(n,i.func,a);}var l;}):$.each(r,function(t,i){if(i.visible){var r=o.options.modelType,a=e.WidgetUtils.createPaletteItem(n,i.func,r);_.isEqual(a.attr("title"),"none")||o.functionsList.push(a);}});var a=n.find(".brtc-va-views-palette-fnunit-content").length,s=n.find(".brtc-va-views-palette-fnunit.brtc-va-fnunit-category-none").length,l=$('<div>   <div>       <div class="brtc-va-views-palette-fnunit-type">'+e.WidgetUtils.convertHTMLSpecialChar(i.label)+"</div>   </div></div>");i&&"udf"!==i.key&&a===s&&(l.addClass("brtc-va-palette-display-none"),n.addClass("brtc-va-palette-display-none")),o.$navigator.append(l),o.$navigator.append(n);},i.prototype.createFunctions=function(t){var e=this,i=[];return $.each(t,function(t,o){o.visible&&(e.appendFunction(o),i.push(o));}),i;},i.prototype.draggablePalette=function(){var t=this;this.$navigator.find(".brtc-va-views-palette-fnunit").each(function(){$(this).mouseover(function(){$(this).toggleClass("brtc-va-views-palette-fnunit-hover");}).mouseout(function(){$(this).toggleClass("brtc-va-views-palette-fnunit-hover");}),t._draggableFnUnit($(this));});},i.prototype._draggableFnUnit=function(t){var i=this;t.draggable({appendTo:"body",scroll:!1,cursor:"move",cursorAt:{left:5,top:5},helper:function helper(o){var n=$(this).clone();n.css({"z-index":5100});var r={functions:[{func:e.WidgetUtils.getData(t,"func")}],links:[]};return e.WidgetUtils.putData(n,"template",r),e.WidgetUtils.putData(n,"source",i),n;},start:function start(t,e){$(".brtc-va-studio").addClass("brtc-va-studio-dragging"),$(this).draggable("option","cursorAt",{left:Math.floor(e.helper.width()/2),top:Math.floor(e.helper.height()/2)});},drag:function drag(t,e){e.helper.trigger("feedback",[{clientX:t.clientX,clientY:t.clientY}]);},stop:function stop(t,e){$(".brtc-va-studio").removeClass("brtc-va-studio-dragging");}});},i.prototype.udfChanged=function(){this.refreshControl();},i.prototype.refreshControl=function(){Studio.getInstance().reloadResource();var i=this,o=this.$navigator.find(".jqx-widget-header").length-1,n=this.$navigator.jqxNavigationBar("getHeaderContentAt",o);if("UDF"===$(n).find(".brtc-va-views-palette-fnunit-type").text()){$.ajax({url:"api/va/v3/ws/udfs",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}).done(function(n){var r=n,a={label:"UDF",visible:!0,functions:[]};for(var s in r){a.functions.push({func:r[s].id,visible:!0,deletable:r[s].creator===t.VA.Env.Session.userId});}e.WidgetUtils.putUdfRef($(document.body),a.functions);var l='<div>   <div>       <div class="brtc-va-views-palette-fnunit-type">'+e.WidgetUtils.convertHTMLSpecialChar(a.label)+"</div>   </div></div>";i.$navigator.jqxNavigationBar("update",o,l,"");var c=i.$navigator.find(".brtc-va-views-palette-fnunit-list").last();i.makeHeaderButton(c),a.functions.forEach(function(o,n){if(o.visible){var r=i.options.modelType,a=(s=o,function(e){if(e.OK){var o=s&&s.func?s.func:"";$.ajax({url:"api/va/v3/ws/udfs/"+o,type:"DELETE",contentType:"application/json; charset=utf-8",blocking:!0}).done(function(e){"OK"===e&&(i.refreshControl(),""===o?t.VA.Core.Utils.WidgetUtils.openErrorDialog("Sorry! UDF has been Deleted! Try again"):(delete t.VA.Core.Interface.Functions[r][o],i.options.editor.diagramEditorPage.render(),i.options.editor.resetSheetEditorPage()));}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}});o.deletable?e.WidgetUtils.createPaletteUDFItem(c,o.func,r,a):e.WidgetUtils.createPaletteItem(c,o.func,r);}var s;}),i.options.draggable&&i.draggablePalette(),c.css("height","auto"),c.show(),i.applyFilter(i.$filterInput.val().toLowerCase(),!1),i.$navigator.jqxNavigationBar("refresh"),i.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar("update");});}else this.$mainControl.remove(),e.WidgetUtils.removeUdfRefData($(document.body)),this.createControls(),this.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar("update");this.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar("update");},i.prototype.destroy=function(){},t.VA.Core.Views.Palette=i;}.call(this),function(){"use strict";var t=this,e=t.Brightics;function i(t,e){this.parentId=t,this.options=e||{},this.init(),this.retrieveParent(),this.createControls(),this.renderValues();}i.prototype.init=function(){var t=this;this.isRendered=!1,this.parameters=$.extend(!0,this.parameters,this.options.modelContents.param),this.commandListener=function(e){t.isRendered?(t.isRendered=!1,t.handleCommand(e),t.isRendered=!0):t.handleCommand(e);};},i.prototype.executeCommand=function(t){this.isRendered&&this.activeEditor.getCommandManager().execute(t);},i.prototype.handleCommand=function(t){if(t instanceof e.VA.Core.Editors.Diagram.Commands.GoHistoryCommand)for(var i in t.options.commands){this.handleCommand(t.options.commands[i]);}else t instanceof e.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand&&this.handleUpdateParameterCommand(t);},i.prototype.editorChanged=function(t){t?(this.activeEditor&&(this.activeEditor.removeCommandListener(this.commandListener),this.activeEditor.removeGoHistoryListener(this.commandListener)),this.activeEditor=t,this.activeEditor.addCommandListener(this.commandListener),this.activeEditor.addGoHistoryListener(this.commandListener)):this.activeEditor=null;},i.prototype.handleUpdateParameterCommand=function(t){"UNDO"===t.event.type?t instanceof e.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand&&(this.parameters=$.extend(!0,{},this.options.modelContents.param),this.renderValues()):"REDO"===t.event.type?t instanceof e.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand&&(this.parameters=$.extend(!0,{},this.options.modelContents.param),this.renderValues()):t instanceof e.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand&&(this.parameters=$.extend(!0,{},this.options.modelContents.param));},i.prototype.createUpdateParametersCommand=function(t,i){var o=new e.VA.Core.Editors.Diagram.Commands.UpdateParameterCommand(this.activeEditor,{name:t,ref:i});this.executeCommand(o);},i.prototype.retrieveParent=function(){this.$parent=e.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-parameters">   <div class="brtc-va-views-parameters-wrapper"></div></div>'),this.$parent.append(this.$mainControl),this.createLossControl(),this.createMetricsControl(),this.createBatchSizeControl(),this.createEpochsControl(),this.createStepsPerEpochControl(),this.createValidationStepsControl(),this.createOptimizerControl(),this.createCheckPointGroupNameControl(),this.$mainControl.find(".brtc-va-views-parameters-wrapper").perfectScrollbar();},i.prototype.renderValues=function(){this.isRendered=!1,this.renderLossControl(),this.renderMetricsControl(),this.renderBatchSizeControl(),this.renderEpochsControl(),this.renderStepsPerEpochControl(),this.renderValidationStepsControl(),this.renderOptimizerControl(),this.renderCheckPointGroupNameControl(),this.isRendered=!0;},i.prototype.createLossControl=function(t,e,i){var o=this;this.LOSSTYPES=[{label:"mean_squared_error",value:"mean_squared_error"},{label:"mean_absolute_error",value:"mean_absolute_error"},{label:"categorical_crossentropy",value:"categorical_crossentropy"},{label:"binary_crossentropy",value:"binary_crossentropy"}],this.$loss=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>'),this.addPropertyControl("Loss",function(t){o.createDropDownList(this.$loss,{source:o.LOSSTYPES,displayMember:"label",valueMember:"value"}),t.append(this.$loss.parent()),o.$loss.on("change",function(){o.createUpdateParametersCommand("loss",$(this).val()),o.setParameter("loss",$(this).val());});});},i.prototype.createMetricsControl=function(t,e,i){var o=this;this.MATRICSTYPES=[{label:"accuracy",value:"accuracy"},{label:"binary_accuracy",value:"binary_accuracy"},{label:"categorical_accuracy",value:"categorical_accuracy"}],this.$metrics=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>'),this.addPropertyControl("Metrics",function(t){o.createDropDownList(this.$metrics,{source:o.MATRICSTYPES,displayMember:"label",valueMember:"value"}),t.append(this.$metrics.parent()),o.$metrics.on("change",function(){o.createUpdateParametersCommand("metrics",$(this).val()),o.setParameter("metrics",$(this).val());});});},i.prototype.createBatchSizeControl=function(t,e,i){var o=this;this.$batchSize=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');this.addPropertyControl("Batch Size",function(t){t.append(this.$batchSize);o.batchSizeControl=o.createNumericInput(o.$batchSize,{numberType:"int",min:0,minus:!1,placeholder:"Default: 32"}),o.batchSizeControl.onChange(function(){o.createUpdateParametersCommand("batch_size",this.getValue()),o.setParameter("batch_size",this.getValue());});});},i.prototype.createEpochsControl=function(t,e,i){var o=this;this.$epochs=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');this.addPropertyControl("Epochs",function(t){t.append(this.$epochs);o.epochsControl=o.createNumericInput(o.$epochs,{numberType:"int",min:0,minus:!1,placeholder:"Default: 10"}),o.epochsControl.onChange(function(){o.createUpdateParametersCommand("epochs",this.getValue()),o.setParameter("epochs",this.getValue());});});},i.prototype.createStepsPerEpochControl=function(t,e,i){var o=this,n=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');this.addPropertyControl("Steps Per Epoch",function(t){t.append(n);o.stepsPerEpochsControl=o.createNumericInput(n,{numberType:"int",min:0,minus:!1,placeholder:"Default: None"}),o.stepsPerEpochsControl.onChange(function(){o.createUpdateParametersCommand("steps_per_epoch",this.getValue()),o.setParameter("steps_per_epoch",this.getValue());});});},i.prototype.createValidationStepsControl=function(t,e,i){var o=this,n=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-numberinput"/>');this.addPropertyControl("Validation Steps",function(t){t.append(n);o.validationStepsControl=o.createNumericInput(n,{numberType:"int",min:0,minus:!1,placeholder:"Default: None"}),o.validationStepsControl.onChange(function(){o.createUpdateParametersCommand("validation_steps",this.getValue()),o.setParameter("validation_steps",this.getValue());});});},i.prototype.createOptimizerControl=function(t,e,i){var o=this;this.OPTIMIZERTYPES=[{label:"SGD",value:"sgd"},{label:"RMSprop",value:"rmsprop"},{label:"Adadelta",value:"adadelta"},{label:"Adam",value:"adam"},{label:"Adamax",value:"adamax"},{label:"Nadam",value:"nadam"}],this.$optimizer=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>'),this.addPropertyControl("Optimizer",function(t){o.createDropDownList(this.$optimizer,{source:o.OPTIMIZERTYPES,displayMember:"label",valueMember:"value"}),t.append(this.$optimizer.parent()),o.$optimizer.on("change",function(){o.createUpdateParametersCommand("optimizer",$(this).val()),o.setParameter("optimizer",$(this).val());});});},i.prototype.createEvaluationControl=function(t,e,i){var o=this;this.$evaluationTrueControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">True</div>'),this.$evaluationFalseControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">False</div>'),this.addPropertyControl("Evaluation",function(t){t.append(this.$evaluationTrueControl).append(this.$evaluationFalseControl),o.createRadioButton(o.$evaluationTrueControl,{width:"80",groupName:"evaluation"}),o.createRadioButton(o.$evaluationFalseControl,{width:"80",groupName:"evaluation"}),o.$evaluationTrueControl.on("checked",function(){o.createUpdateParametersCommand("evaluation",!0),o.setParameter("evaluation",!0);}),o.$evaluationFalseControl.on("checked",function(){o.createUpdateParametersCommand("evaluation",!1),o.setParameter("evaluation",!1);});}),this.$evaluationTrueControl.jqxRadioButton("check");},i.prototype.createExecutionControl=function(t,e,i){var o=this;this.$executionTrueControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">True</div>'),this.$executionFalseControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">False</div>'),this.addPropertyControl("Execution",function(t){t.append(this.$executionTrueControl).append(this.$executionFalseControl),o.createRadioButton(o.$executionTrueControl,{width:"80",groupName:"execution"}),o.createRadioButton(o.$executionFalseControl,{width:"80",groupName:"execution"}),o.$executionTrueControl.on("checked",function(){o.createUpdateParametersCommand("execution",!0),o.setParameter("execution",!0);}),o.$executionFalseControl.on("checked",function(){o.createUpdateParametersCommand("execution",!1),o.setParameter("execution",!1);});}),this.$executionTrueControl.jqxRadioButton("check");},i.prototype.createTrainDataControl=function(t,e,i){var o=this;this.$trainData=$('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>'),this.addPropertyControl("Train Data",function(t){t.append(o.$trainData),o.trainDataControl=o.createInput(o.$trainData,{height:"23px"},"");}),this.$trainData.on("change",function(){o.createUpdateParametersCommand("train_data",$(this).val()),o.setParameter("train_data",$(this).val());});},i.prototype.createTrainLabelControl=function(t,e,i){var o=this;this.$trainLabel=$('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>'),this.addPropertyControl("Train Label",function(t){t.append(o.$trainLabel),o.trainLabelControl=o.createInput(o.$trainLabel,{height:"23px"},"");}),this.$trainLabel.on("change",function(){o.createUpdateParametersCommand("train_label",$(this).val()),o.setParameter("train_label",$(this).val());});},i.prototype.createTestDataControl=function(t,e,i){var o=this;this.$testData=$('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>'),this.addPropertyControl("Test Data",function(t){t.append(o.$testData),o.testDataControl=o.createInput(o.$testData,{height:"23px"},"");}),this.$testData.on("change",function(){o.createUpdateParametersCommand("test_data",$(this).val()),o.setParameter("test_data",$(this).val());});},i.prototype.createTestLabelControl=function(t,e,i){var o=this;this.$testLabel=$('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>'),this.addPropertyControl("Test Label",function(t){t.append(o.$testLabel),o.testLabelControl=o.createInput(o.$testLabel,{height:"23px"},"");}),this.$testLabel.on("change",function(){o.createUpdateParametersCommand("test_label",$(this).val()),o.setParameter("test_label",$(this).val());});},i.prototype.createCheckPointGroupNameControl=function(t,e,i){var o=this;this.$checkPointGroupName=$('<input class="brtc-va-editors-sheet-controls-propertycontrol-input" valid-type="type1"/>'),this.addPropertyControl("Checkpoint Group Name",function(t){t.append(o.$checkPointGroupName),o.checkPointGroupName=o.createInput(o.$checkPointGroupName,{height:"23px",placeHolder:"Default: checkpoint"},"");}),this.$checkPointGroupName.on("change",function(){o.parameters.checkPointGroupName!==$(this).val()&&(o.createUpdateParametersCommand("checkPointGroupName",$(this).val()),o.setParameter("checkPointGroupName",$(this).val()));});},i.prototype.renderLossControl=function(){this.$loss.val(this.parameters.loss);},i.prototype.renderMetricsControl=function(t,e,i){this.$metrics.val(this.parameters.metrics);},i.prototype.renderBatchSizeControl=function(t,e,i){this.batchSizeControl.setValue(this.parameters.batch_size);},i.prototype.renderEpochsControl=function(t,e,i){this.epochsControl.setValue(this.parameters.epochs);},i.prototype.renderStepsPerEpochControl=function(t,e,i){this.stepsPerEpochsControl.setValue(this.parameters.steps_per_epoch);},i.prototype.renderValidationStepsControl=function(t,e,i){this.validationStepsControl.setValue(this.parameters.validation_steps);},i.prototype.renderOptimizerControl=function(t,e,i){this.$optimizer.val(this.parameters.optimizer);},i.prototype.renderEvaluationControl=function(t,e,i){var o=this.$evaluationTrueControl.jqxRadioButton("checked");this.parameters.evaluation&&!o?this.$evaluationTrueControl.jqxRadioButton("check"):!this.parameters.evaluation&&o&&this.$evaluationFalseControl.jqxRadioButton("check");},i.prototype.renderExecutionControl=function(t,e,i){var o=this.$executionTrueControl.jqxRadioButton("checked");this.parameters.execution&&!o?this.$executionTrueControl.jqxRadioButton("check"):!this.parameters.execution&&o&&this.$executionFalseControl.jqxRadioButton("check");},i.prototype.renderTrainDataControl=function(t,e,i){this.$trainData.val(this.parameters.train_data);},i.prototype.renderTrainLabelControl=function(t,e,i){this.$trainLabel.val(this.parameters.train_label);},i.prototype.renderTestDataControl=function(t,e,i){this.$testData.val(this.parameters.test_data);},i.prototype.renderTestLabelControl=function(t,e,i){this.$testLabel.val(this.parameters.test_label);},i.prototype.renderCheckPointGroupNameControl=function(t,e,i){this.$checkPointGroupName.val(this.parameters.checkPointGroupName);},i.prototype.addPropertyControl=function(t,i,o){var n=this,r=$('<div class="brtc-va-editors-sheet-controls-propertycontrol">   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents"></div>');return this.$mainControl.find(".brtc-va-views-parameters-wrapper").append(r),r.jqxExpander({theme:e.VA.Env.Theme,arrowPosition:"left",initContent:function initContent(){"function"==typeof i&&i.call(n,r.find(".brtc-va-editors-sheet-controls-propertycontrol-contents"),o);}}),r.jqxExpander("setHeaderContent",t),r;},i.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');t.wrap(e);},i.prototype.createDropDownList=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme,enableBrowserBoundsDetection:!0,animationType:"none",width:"100%",height:"25px",openDelay:0};return i&&(i.source&&i.source.length>7?(a.autoDropDownHeight=!1,a.dropDownHeight=120):a.autoDropDownHeight=!0,$.extend(a,i)),t.jqxDropDownList(a),t;},i.prototype.createNumericInput=function(t,i,o,n){this.wrapControl(t);var r="";return o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n),new e.VA.Core.Editors.Sheet.Controls.NumericInput(t,i);},i.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},i.prototype.addCssToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.css(e);}},i.prototype.createRadioButton=function(t,i,o,n){this.wrapControl(t);var r="brtc-va-editors-sheet-controls-radiobutton-default";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme};return i&&$.extend(a,i),t.jqxRadioButton(a),t;},i.prototype.createInput=function(i,o,n,r){this.wrapControl(i);var a="";n&&(a=a.concat(" ",n)),i.attr("type")||i.attr("type","text"),i.attr("maxlength")||i.attr("maxlength","100"),this.addClassToWrapper(i,a),this.addCssToWrapper(i,r);var s={theme:e.VA.Env.Theme,height:"25px",placeHolder:"Enter value"};o&&$.extend(s,o),i.jqxInput(s);var l=i.val();return i.focus(function(){l=i.val();}),$("svg").on("mousedown",function(){i.val()!==l&&i.is(":focus")&&i.trigger("change");}),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(i),i;},i.prototype.setParameter=function(t,e){this.parameters[t]=e;},i.prototype.activate=function(){this.$mainControl.find(".brtc-va-views-parameters-wrapper").perfectScrollbar("update");},e.VA.Core.Views.Parameters=i;}.call(this),function(){"use strict";var t=this.Brightics;var e={data:"Data Flow",script:"Script",control:"Control Flow",realtime:"Real-time",visual:"Report",deeplearning:"Deep Learning",etl:"ETL"};function i(t,e){this.parentId=t,this.options=e,this.chartContentAddedReport={},this.retrieveParent(),this.createControls(),this.fillProjectList();}i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-workspace-project-container">   <div class="brtc-va-workspace-project-container-contents"></div>   <div class="brtc-va-workspace-project-container-ctxmenu">       <ul>           <li action="edit">Edit</li>           <li action="delete">Delete</li>           <li action="duplicate">Duplicate</li>           <li type="separator"></li>           <li action="export">Export</li>           <li action="exportAsRunnable">Export as Runnable</li>           <li action="deploy">Deploy</li>           <li type="separator"></li>           <li action="members">Member Management</li>           <li action="version">Version Management</li>       </ul>   </div></div>'),this.$parent.append(this.$mainControl),this.$contentsContainer=this.$mainControl.find(".brtc-va-workspace-project-container-contents"),this.createContentsContainer(this.$contentsContainer),this.$ctxMenu=this.$mainControl.find(".brtc-va-workspace-project-container-ctxmenu").jqxMenu({theme:t.VA.Env.Theme,width:"200px",height:"180px",autoOpenPopup:!1,mode:"popup",animationHideDuration:0,animationShowDuration:0});var e=this;this.$ctxMenu.on("itemclick",_.debounce(function(i){var o=$(i.args),n=o.closest(".brtc-va-workspace-project-container-ctxmenu").attr("menu-type"),r=o.closest(".brtc-va-workspace-project-container-ctxmenu").attr("project-id"),a=o.closest(".brtc-va-workspace-project-container-ctxmenu").attr("file-id");if("file-edit"==n)"edit"==o.attr("action")&&e.editFile(r,a),"delete"==o.attr("action")&&e.openDeleteConfirmDialog(r,a),"duplicate"==o.attr("action")&&e.openDuplicateModelDialog(r,a),"export"==o.attr("action")&&e.exportFile(r,a),"deploy"==o.attr("action")&&e.deployFile(r,a),"exportAsRunnable"==o.attr("action")&&e.exportRunnableFile(r,a),"sendTo"==o.attr("action")&&e.openSelectUserDialog(r,a),"version"===o.attr("action")&&e.openVersionManagementDialog(r,a);else if("bulk-edit"==n){var s=e.getSelectedTabType(),l=e.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+s+" .brtc-va-workspace-model-list-item-select.jqx-checkbox-checked");if(!l||0==l.length)return void t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please select a "+s+".");var c=[];l.each(function(t){c.push($(this).attr("id"));}),"delete"==o.attr("action")&&e.deleteFiles(r,c),"duplicate"==o.attr("action")&&e.duplicateFiles(r,c),"export"==o.attr("action")&&e.exportFiles(r,c);}else"project-edit"==n&&("edit"==o.attr("action")&&e.openEditProjectDialog(r),"delete"==o.attr("action")&&e.deleteProject(r),"members"==o.attr("action")&&e.openMemberManagementDialog(r),"export"==o.attr("action")&&e.exportProject(r));},300,{leading:!0,trailing:!1})),this.ctxMenuCloseHandler=function(){e.$ctxMenu.jqxMenu("close");},this.$ctxMenu.on("closed",function(){$(".brtc-va-workspace-model-list-area").off("scroll",e.ctxMenuCloseHandler),$(window).off("resize",e.ctxMenuCloseHandler);});},i.prototype.openSelectUserDialog=function(e,i){new t.VA.Core.Dialogs.SelectUserDialog(this.$mainControl,{projectId:e,fileId:i,fileListByProject:Studio.getResourceManager().getFiles(e)});},i.prototype.openVersionManagementDialog=function(e,i){new t.VA.Core.Dialogs.VersionManagementDialog(this.$mainControl,{projectId:e,fileId:i,position:{my:"center top",at:"center top+15%",of:window}});},i.prototype.openDeleteConfirmDialog=function(e,i){var o=this,n=Studio.getResourceManager().getFile(e,i);if(n.getType()===t.VA.Implementation.DataFlow.Clazz){var r=this.getFlowUsingTargetDataFlow(e,i);if(r.length>0){var a=r.map(function(t){return t.getLabel();});return void t.VA.Core.Utils.WidgetUtils.openErrorDialog("This data flow is used for other flows. "+JSON.stringify(a));}}var s='Are you sure you want to delete "'+n.getLabel()+'"?';t.VA.Core.Utils.WidgetUtils.openConfirmDialog(s,function(t){t.OK&&Studio.getResourceManager().deleteFile(e,i).then(function(){o.deleteAlluxioFile([i]),o.fillProjectList(n.getProjectId(),n.getContents().type);}).catch(function(t){});});},i.prototype.getControlFlowUsingTargetDataFlow=function(t,e){var i=[],o=Studio.getResourceManager().getFiles(t,"control");for(var n in o){r(o[n].getContents().functions)&&i.push(o[n]);}return i;function r(t){var i=!1;for(var o in t){if(i="dataFlow"===t[o].func&&t[o].param.mid===e||r(t[o].param.functions))break;}return i;}},i.prototype.getDataFlowUsingTargetDataFlow=function(e,i){return Studio.getResourceManager().getFiles(e).filter(function(e){return e.getFileId()!==i&&e.getType()===t.VA.Implementation.DataFlow.Clazz;}).filter(function(t){var e=t.getContents(),o=_.toArray(e.getInnerModels());return _.any(o.concat(e),function(t){return _.any(t.functions,function(t){return"Flow"===t[FUNCTION_NAME]&&t.param.mid===i;});});});},i.prototype.getFlowUsingTargetDataFlow=function(t,e){return this.getControlFlowUsingTargetDataFlow(t,e).concat(this.getDataFlowUsingTargetDataFlow(t,e));},i.prototype.openDuplicateModelDialog=function(e,i){var o=this,n=Studio.getResourceManager().getFile(e,i),r="model"===this.getSelectedTabType()?"Duplicate Model":"Duplicate Report";new t.VA.Core.Dialogs.DuplicateModelDialog($("body"),{files:[n],title:r,resourceManager:Studio.getResourceManager(),close:function close(t){t.OK&&o.fillProjectList(t.projectId,"model"==o.getSelectedTabType()?"model":"visual");},width:600,height:300,minWidth:600,minHeight:300,maxWidth:800,maxHeight:400,resizable:!1});},i.prototype.editFile=function(t,e){var i=Studio.getResourceManager().getFile(t,e);this.openEditFileDialog(i);},i.prototype.openEditFileDialog=function(e){var i=this,o="model"===this.getSelectedTabType()?"Edit Model":"Edit Report",n=new t.VA.Core.Dialogs.EditResourceDialog(this.$mainControl,{title:o,label:e.getLabel(),description:e.getDescription(),close:function close(o){if(o.OK){if(e.getLabel()==o.label&&e.getDescription()==o.description)return;e.setLabel(o.label),e.setDescription(o.description),i.doEditFile(e).catch(function(o){if(400===o.status)t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(o);else if(!o.status)throw console.error(o),o;e.setLabel(n.options.label),e.setDescription(n.options.description),i.fillProjectList(e.getProjectId(),e.getContents().type);});}}});},i.prototype.doEditFile=function(e){var i=this;return e.setUpdater(t.VA.Env.Session.userId),Studio.getResourceManager().updateFile(e.getProjectId(),e).then(function(_ref21){var t=_ref21[0];t||i.fillProjectList(e.getProjectId(),e.getContents().type);});},i.prototype._exportObjectFile=function(e){e.getContents().problemList=[],t.VA.Core.Utils.CommonUtils.downloadJsonFile(JSON.stringify(e.getContents()),e.getLabel());},i.prototype._exportArrayFile=function(e,i){t.VA.Core.Utils.ModelUtils.createModelTree(e,i.getContents()).then(function(o){var n=t.VA.Core.Utils.ModelUtils.getModelArrayByTree(o,i,e);return t.VA.Core.Utils.CommonUtils.downloadJsonFile(JSON.stringify(n),i.getLabel());}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},i.prototype.exportFile=function(t,e){this.exportFiles(t,[e],!0);},i.prototype.searchDataFlowFile=function(t,e,i){for(var o in e){e[o].param.functions&&this.searchDataFlowFile(t,e[o].param.functions,i);var n=!1;if("DataFlow"===e[o][FUNCTION_NAME]){for(var r in i){e[o].param.mid===i[r].mid&&(n=!0);}if(!n){var a=Studio.getResourceManager().getFile(t,e[o].param.mid);if(null==a)return'"'+e[o].display.label+'" dataflow was deleted or format is invalid in selected control flow';i.push(a.getContents());}}}},i.prototype.exportRunnableFile=function(e,i){var o=Studio.getResourceManager().getFile(e,i),n=function n(e){if(e.OK){(function(i){return t.VA.Core.Utils.RunnableFactory.createForFlow(i.getContents(),void 0,void 0,e.args,{});})(o).then(function(e){var i=JSON.stringify(e),n=o.getLabel();t.VA.Core.Utils.CommonUtils.downloadJsonFile(i,n);}).catch(console.error);}};"true"===t.VA.SettingStorage.getValue("editor.variable.visible")&&"control"==o.getContents().type&&o.getContents().variables.length>0?new t.VA.Core.Dialogs.RunControlDialog(this.$parent,{close:n,analyticsModel:o.getContents()}):"true"===t.VA.SettingStorage.getValue("editor.variable.visible")&&"realtime"==o.getContents().type?new t.VA.Core.Dialogs.RunRealTimeDialog(this.$parent,{close:n,analyticsModel:o.getContents()}):"true"===t.VA.SettingStorage.getValue("editor.variable.visible")&&"data"==o.getContents().type&&Object.keys(o.getContents().variables).length>0?new t.VA.Core.Dialogs.RunDataDialog(this.$parent,{close:n,analyticsModel:o.getContents()}):n({OK:!0});},i.prototype.createDescriptionControl=function(e){var i=this,o={height:230,description:this.options.description,okButton:this.$okButton,maxLength:2e3,toolbar:this.options.toolbar};this.noteControl=t.VA.Core.Widget.Factory.noteControl(e,o),this.$mainControl.on("resizing",function(t){i.noteControl.setHeight(i.$mainControl.find(".brtc-va-dialogs-contents").height());});},i.prototype.deployFile=function(e,i){var o=$(".brtc-va-workspace-model-list-title").text(),n="N",r={},a=Studio.getResourceManager().getFile(e,i),s=this;if("true"===t.VA.SettingStorage.getValue("editor.variable.visible")&&"data"===a.getContents().type&&_.keys(a.getContents().variables).length>0){n="Y";var l=a.getContents().variables;_.forIn(l,function(t){r[t.name]=t.value;});}return t.VA.Core.Utils.RunnableFactory.createForFlow(a.getContents(),r,{}).then(function(t){var e=a.getContents(),i=t;return s.openDeployModelDialog(o,a,e,i,n);}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},i.prototype.openDeployModelDialog=function(e,i,o,n,r){var a=this,s=t.VA.Env.Session.userId;new t.VA.Core.Dialogs.DeployModelDialog(this.$mainControl,{title:"Deploy to Server",projectId:i.getProjectId(),fileId:i.getFileId(),close:function close(t){if(t.OK){var l={server:t.server,projectId:i.getProjectId(),modelId:i.getFileId(),registerUserId:s,projectName:e,modelName:i.getLabel(),title:t.name,description:t.description,contents:JSON.stringify(o),runnableContents:JSON.stringify(n),gvFlag:r};a.deployAction(l);}}});},i.prototype.deployAction=function(e){var i=this;return $.ajax({type:"POST",url:"api/va/v2/ws/deploy",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),blocking:!0}).done(function(t){i.doCreateSuccessPopup(t,e.server,function(){setTimeout(function(){window.open("/ng1123/deploy","Brightics Management").blur();},1e3);});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);}),!0;},i.prototype.createContentsContainer=function(e){var i=this;e.append('<div class="brtc-va-workspace-model-list-popup-header">   <div class="brtc-va-workspace-model-list-popup-header-title">Open Model/Report</div>   <div class="brtc-va-workspace-model-list-popup-header-close"></div></div>'),e.find(".brtc-va-workspace-model-list-popup-header-close").click(function(){i.result={selectedProject:void 0,selectedFiles:void 0},i.performFinish();});var o=$('<div class="brtc-va-workspace-project-list-area">   <div class="brtc-va-workspace-project-filter brtc-va-searcharea brtc-style-search-area"></div>   <div class="brtc-va-workspace-project-groups"></div></div>');e.append(o);var n=$('<input type="search" class="brtc-va-views-workspace-project-input searchinput"/>');o.find(".brtc-va-workspace-project-filter").append(n),n.jqxInput({placeHolder:"Search Project",theme:t.VA.Env.Theme});var r=function r(t){var e=t.target.value.toLowerCase(),o=i.$mainControl.find(".brtc-va-workspace-project-list-item");$.each(o,function(t,i){$(i).css("display",$(i).find(".brtc-va-workspace-project-list-item-label").text().toLowerCase().indexOf(e)>-1?"block":"none");}),i.renderProjectListContainer();};n.keyup(function(t){r(t);}),n.on("search",function(){r(event);}),t.VA.Core.Utils.WidgetUtils.createPrivatePolicy(e.find(".brtc-va-workspace-project-list-area")),e.append('<div class="brtc-va-workspace-model-list-area"></div>');},i.prototype._clearProjectList=function(){this.$mainControl.find(".brtc-va-workspace-project-groups").empty(),this.$mainControl.find(".brtc-va-views-workspace-project-input").val("");},i.prototype.renderProjectListContainer=function(){var t=this.$mainControl.find(".brtc-va-workspace-project-group-area.my"),e=this.$mainControl.find(".brtc-va-workspace-project-group-area.shared"),i="block"==$(t).find(".brtc-va-workspace-project-list").css("display"),o="block"==$(e).find(".brtc-va-workspace-project-list").css("display"),n=$(t).find(".brtc-va-workspace-project-list-item").filter(function(){return"block"==$(this).css("display");}),r=$(e).find(".brtc-va-workspace-project-list-item").filter(function(){return"block"==$(this).css("display");});if(this.$mainControl.find(".brtc-va-workspace-project-groups").is(":visible")){var a=this.$mainControl.find(".brtc-va-workspace-project-list-title").height()+1,s=this.$mainControl.find(".brtc-va-workspace-project-list-item").height()+4,l=r.length*s+a,c=n.length*s+a;i&&o?l>.3*this.$mainControl.find(".brtc-va-workspace-project-groups").height()?($(e).css("height","30%"),$(e).css("min-height","30%"),c>.7*this.$mainControl.find(".brtc-va-workspace-project-groups").height()?($(t).css("height","70%"),$(t).css("max-height","70%")):($(t).css("height",c),$(t).css("max-height",c))):($(e).css("height",l),$(e).css("min-height",l),c>this.$mainControl.find(".brtc-va-workspace-project-groups").height()-l?(c=this.$mainControl.find(".brtc-va-workspace-project-groups").height()-l,$(t).css("height",c),$(t).css("max-height",c)):($(t).css("height",c),$(t).css("max-height",c))):i?($(e).css("height",a),$(e).css("min-height",a),c>this.$mainControl.find(".brtc-va-workspace-project-groups").height()-a?(c=this.$mainControl.find(".brtc-va-workspace-project-groups").height()-a,$(t).css("height",c),$(t).css("max-height",c)):($(t).css("height",c),$(t).css("max-height",c))):o?(l=this.$mainControl.find(".brtc-va-workspace-project-groups").height()-a,$(e).css("height",l),$(e).css("min-height",l),$(t).css("height",a),$(t).css("max-height",a)):($(e).css("height",a),$(e).css("min-height",a),$(t).css("height",a),$(t).css("max-height",a)),$(t).find(".brtc-va-workspace-project-group-total-count").text(n.length),$(t).find(".brtc-va-workspace-project-list").perfectScrollbar("update"),$(e).find(".brtc-va-workspace-project-group-total-count").text(r.length),$(e).find(".brtc-va-workspace-project-list").perfectScrollbar("update");}},i.prototype._addProjectItem=function(e){var i=this,o={my:{label:"My Projects",projects:[]},shared:{label:"Shared Projects",projects:[]}};for(var n in e.filter(function(e){e.getCreator()===t.VA.Env.Session.userId?o.my.projects.push(e):o.shared.projects.push(e);}),o){var r=$('<div class = "brtc-va-workspace-project-group-area"></div>'),a=$('<div class="brtc-va-workspace-project-list-item-label brtc-va-workspace-project-list-title">'+o[n].label+'<span class="brtc-va-workspace-project-group-total-count"></span><div class="brtc-va-workspace-project-list-tool-item"><i class="fa fa-chevron-up fa-chevron-down" aria-hidden="true"></i></div></div>'),s=$('<div class="brtc-va-workspace-project-new" title="Create New Project"></div>'),l=$('<div class="brtc-va-workspace-project-import" title="Import Project"></div>'),c=$('<div class="brtc-va-workspace-project-list">');for(var d in r.append(a),r.addClass(n),r.append(c),this.$mainControl.find(".brtc-va-workspace-project-groups").append(r),"my"===n&&(r.append(s),r.append(l),s.click(function(){i.openNewProjectDialog();}),l.click(function(){i.openImportProjectDialog();})),a.find(".brtc-va-workspace-project-group-total-count").text(o[n].projects.length),a.find(".brtc-va-workspace-project-list-tool-item>i").toggleClass("fa-chevron-down"),a.find(".brtc-va-workspace-project-list-tool-item").click(function(t){t.preventDefault(),$(this).find("i").hasClass("fa-chevron-down")?$(this).closest(".brtc-va-workspace-project-group-area").find(".brtc-va-workspace-project-list").show():$(this).closest(".brtc-va-workspace-project-group-area").find(".brtc-va-workspace-project-list").hide(),i.renderProjectListContainer(),$(this).find("i").toggleClass("fa-chevron-down");}),a.find(".brtc-va-workspace-project-list-tool-item").mouseover(function(){$(this).find("i").hasClass("fa-chevron-down")?$(this).attr("title","Expand"):$(this).attr("title","Collapse");}),a.find(".brtc-va-workspace-project-group-total-count").text(o[n].projects.length),o[n].projects){var p=o[n].projects[d],u=$('<div class="brtc-va-workspace-project-list-item" id="'+p.getProjectId()+'"></div>'),h=$('<div class="brtc-va-worksapce-project-list-item-new"></div>'),f=$('<div class="brtc-va-workspace-project-list-item-label"></div>'),m=$('<div class="brtc-va-workspace-project-list-item-model"></div>');u.append(h),u.append(f),u.append(m),f.text(p.getLabel()),f.attr("title",p.getLabel()),m.append("<span>Models</span><span>"+p.getModelCount()+"</span><span>Reports</span><span>"+p.getReportCount()+"</span>"),c.append(u),t.VA.Core.Utils.CommonUtils.getTimeDifferenceFromNow(p.getCreateTime())<24&&h.show(),u.click(function(){i.selectProject($(this).attr("id"));});}this.renderProjectListContainer(),c.perfectScrollbar();}},i.prototype.clearProjectItem=function(){this.$mainControl.find(".brtc-va-workspace-model-list-area").empty();},i.prototype.fillProjectList=function(t,e,i){var o=this,n=t||this.$mainControl.find(".brtc-va-workspace-project-list-item-selected").attr("id"),r=function r(t,e){var i=t.getLabel().toLowerCase(),o=e.getLabel().toLowerCase();return i<o?-1:i>o?1:0;};Studio.getResourceManager().fetchProjects().then(function(t){t.sort(r),o._clearProjectList(),o._addProjectItem(t),0===$.grep(t,function(t){return t.getProjectId()===n;}).length?t.length>0?o.selectProject(o.$mainControl.find(".brtc-va-workspace-project-list-item")[0].id):o.clearProjectItem():n?o.selectProject(n,e,i):t.length>0&&o.selectProject(t[0].getProjectId());}).catch(function(t){console.error(t);});},i.prototype.selectProject=function(t,e,i){var o=this.$mainControl.find(".brtc-va-workspace-project-list-area");o.find(".brtc-va-workspace-project-list-item.brtc-va-workspace-project-list-item-selected").attr("id")!=t&&(o.find(".brtc-va-workspace-project-list-item").removeClass("brtc-va-workspace-project-list-item-selected"),o.find("#"+t).addClass("brtc-va-workspace-project-list-item-selected"),this.renderModelList(t,e,i));},i.prototype.renderModelList=function(t,e,i){this._fillModelList(t,e,i);},i.prototype.openNewFileDialog=function(e,i){var o=this;new t.VA.Core.Dialogs.NewFileDialog(this.$mainControl,{project:Studio.getResourceManager().getProject(e),fileType:i,close:function close(t){t.OK&&Studio.getResourceManager().fetchFiles(e).catch().then(function(){o.selectProject(e),o.result={selectedProject:e,selectedFiles:[t.selectedFile.getFileId()],fileListByProject:Studio.getResourceManager().getFiles(e)},o.performFinish();});},title:"Create New "+i});},i.prototype.openImportDialog=function(e,i){var o=this;new t.VA.Core.Dialogs.ImportDialog(this.$mainControl,{resourceManager:Studio.getResourceManager(),fileType:i,project:Studio.getResourceManager().getProject(e),close:function close(t){t.OK&&Studio.getResourceManager().fetchFiles(e).catch().then(function(){o.result={selectedProject:e,selectedFiles:t.selectedFiles},o.fillProjectList(e);});}});},i.prototype._clearModelList=function(t){var e=this.$mainControl.find(".brtc-va-workspace-model-list-area");e.find(".brtc-va-workspace-model-list-header").remove(),e.find(".brtc-va-workspace-model-list-content").remove();},i.prototype._createModelContainer=function(e){var i=this,o=Studio.getResourceManager().getProject(e),n=this.$mainControl.find(".brtc-va-workspace-model-list-area");n.attr("project-id",e);var r=$('<div class="brtc-va-workspace-model-list-header">   <div class="brtc-va-workspace-model-list-title"></div>   <div class="brtc-va-workspace-model-list-edit"></div>   <div class="brtc-va-workspace-model-list-author">       <div class="brtc-style-editor-toolitem brtc-style-s-editor-toolitem" title="Info" item-type="model-info" />       <span>Created on</span><span>'+moment(o.getCreateTime()).format("YYYY-MM-DD HH:mm:ss")+'</span>       <span>by</span><span></span>   </div>   <div class="brtc-va-workspace-model-list-hashtag"></div>   <div class="brtc-va-workspace-model-list-type">       <div class="brtc-va-workspace-model-list-type-item model"><div>Models</div></div>       <div class="brtc-va-workspace-model-list-type-item report"><div>Reports</div><div class="addedcount"></div></div>       <div class="brtc-va-workspace-model-list-toolbar">           <div class="brtc-va-workspace-model-list-select"></div>          <div class="brtc-style-workspace-toolitem brtc-style-s-workspace-toolitem" title="Bulk edit" item-type="bulk-edit"></div>       </div>   </div></div><div class="brtc-va-workspace-model-list-content" id="'+e+'" item-type="model"></div>');r.find(".brtc-va-workspace-model-list-title").attr("title",o.getLabel()).text(o.getLabel()),r.find(".brtc-va-workspace-model-list-author > span:nth-child(5)").text(o.getCreator()),n.append(r),n.find(".brtc-style-editor-toolitem[item-type=model-info]").click(function(t){i.closeInfoDialog(),i.openInfoDialog(t);}),n.find(".brtc-va-workspace-model-list-select").jqxCheckBox({theme:t.VA.Env.Theme,width:23,height:24,boxSize:17,checked:!1}),n.find(".brtc-va-workspace-model-list-select").on("checked",function(){var t=i.getSelectedTabType();i.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+t+" .jqx-checkbox").jqxCheckBox({locked:!1}),i.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+t+" .jqx-checkbox").jqxCheckBox({checked:!0}),i.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+t+" .jqx-checkbox").jqxCheckBox({locked:!0});}),n.find(".brtc-va-workspace-model-list-select").on("unchecked",function(){var t=i.getSelectedTabType();i.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+t+" .jqx-checkbox").jqxCheckBox({locked:!1}),i.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+t+" .jqx-checkbox").jqxCheckBox({checked:!1}),i.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+t+" .jqx-checkbox").jqxCheckBox({locked:!0});}),n.find(".brtc-style-workspace-toolitem[item-type=bulk-edit]").click(function(){i.$ctxMenu.attr("project-id",$(this).closest(".brtc-va-workspace-model-list-area").attr("project-id")),i.$ctxMenu.attr("menu-type","bulk-edit"),i.$ctxMenu.removeAttr("file-id"),i.$ctxMenu.find("li").css("display","none"),i.$ctxMenu.find("li[action=delete]").css("display","block"),i.$ctxMenu.find("li[action=duplicate]").css("display","none"),i.$ctxMenu.find("li[action=export]").css("display","block"),i.$ctxMenu.find("li[type=separator]:eq(0)").css("display","block");var t=$(this).offset().left+$(this).width()-200-2,e=$(this).offset().top+$(this).height();i.$ctxMenu.jqxMenu("open",t,e),$(".brtc-va-workspace-model-list-area").on("scroll",i.ctxMenuCloseHandler),$(window).on("resize",i.ctxMenuCloseHandler);}),n.find(".brtc-va-workspace-model-list-edit").click(function(){i.$ctxMenu.attr("project-id",$(this).closest(".brtc-va-workspace-model-list-area").attr("project-id")),i.$ctxMenu.attr("menu-type","project-edit"),i.$ctxMenu.removeAttr("file-id"),i.$ctxMenu.find("li").css("display","none"),i.$ctxMenu.find("li[action=edit]").css("display","block"),i.$ctxMenu.find("li[action=delete]").css("display","block"),i.$ctxMenu.find("li[action=export]").css("display","block"),i.$ctxMenu.find("li[action=members]").css("display","block"),i.$ctxMenu.find("li[type=separator]").css("display","block");var t=$(this).offset().left+$(this).width()-200-2,e=$(this).offset().top+$(this).height();i.$ctxMenu.jqxMenu("open",t,e),$(".brtc-va-workspace-model-list-area").on("scroll",i.ctxMenuCloseHandler),$(window).on("resize",i.ctxMenuCloseHandler);}),n.find(".brtc-va-workspace-model-list-type-item").click(function(){n.find(".brtc-va-workspace-model-list-type-item").removeClass("selected"),$(this).addClass("selected"),$(this).hasClass("model")?(n.find(".brtc-va-workspace-model-list-content").removeClass("report"),n.find(".brtc-va-workspace-model-list-content").addClass("model")):(n.find(".brtc-va-workspace-model-list-content").removeClass("model"),n.find(".brtc-va-workspace-model-list-content").addClass("report")),i.$mainControl.find(".brtc-va-workspace-model-list-content").scrollTop(0),i.$mainControl.find(".brtc-va-workspace-model-list-content").perfectScrollbar("update"),i._refreshCheckBoxStatus();});var a=this.$mainControl.find("#"+e+".brtc-va-workspace-model-list-content"),s=$('<div class="brtc-va-workspace-model-list-cell model">   <div class="brtc-va-workspace-model-list-item brtc-va-workspace-model-list-item-new" model-type="newmodel">       <div class="brtc-va-workspace-model-list-item-new-title">Create a Model</div>       <div class="brtc-va-workspace-model-list-item-new-content">          <div class="brtc-va-workspace-model-list-item-new-item new">               <div class="brtc-va-workspace-model-list-item-new-item-icon new"></div>              <div>New</div>           </div>           <div class="brtc-va-workspace-model-list-item-new-item splitter"></div>          <div class="brtc-va-workspace-model-list-item-new-item import">               <div class="brtc-va-workspace-model-list-item-new-item-icon import"></div>              <div>Import</div>           </div>       </div>   </div></div>'),l=$('<div class="brtc-va-workspace-model-list-cell report">   <div class="brtc-va-workspace-model-list-item brtc-va-workspace-model-list-item-new" model-type="newreport">       <div class="brtc-va-workspace-model-list-item-new-title">Create a Report</div>       <div class="brtc-va-workspace-model-list-item-new-content">          <div class="brtc-va-workspace-model-list-item-new-item new">               <div class="brtc-va-workspace-model-list-item-new-item-icon new"></div>              <div>New</div>           </div>           <div class="brtc-va-workspace-model-list-item-new-item splitter"></div>          <div class="brtc-va-workspace-model-list-item-new-item import">               <div class="brtc-va-workspace-model-list-item-new-item-icon import"></div>              <div>Import</div>           </div>       </div>   </div></div>');s.find(".brtc-va-workspace-model-list-item-new-item.new").click(function(){i.openNewFileDialog(e,"Model");}),l.find(".brtc-va-workspace-model-list-item-new-item.new").click(function(){i.openNewFileDialog(e,"Report");}),s.find(".brtc-va-workspace-model-list-item-new-item.import").click(function(){i.openImportDialog(e,"Model");}),l.find(".brtc-va-workspace-model-list-item-new-item.import").click(function(){i.openImportDialog(e,"Report");}),a.append(s),a.append(l);},i.prototype.closeInfoDialog=function(){this.infoDialog&&this.infoDialog.close(),this.infoDialog=null;},i.prototype.openInfoDialog=function(e){var i=this.$mainControl.find(".brtc-va-workspace-model-list-area").attr("project-id"),o=Studio.getResourceManager().getProject(i);this.infoDialog=new t.VA.Core.Dialogs.InfoDialog(this.$mainControl,{project:o,appendTo:this.$mainControl,modal:!0,title:"Project Information"});},i.prototype._addModelItem=function(i,o){var n=this,r=this.$mainControl.find("#"+i+".brtc-va-workspace-model-list-content");for(var a in o){var s=o[a],l=s.getContents().type?s.getContents().type:"data",c=$('<div class="brtc-va-workspace-model-list-cell '+("visual"==l?"report":"model")+'">   <div class="brtc-va-workspace-model-list-item" id="'+s.getFileId()+'" model-type="'+l+'">       <div class="brtc-va-workspace-model-list-item-header">           <div class="brtc-va-workspace-model-list-item-icon"></div>           <div class="brtc-va-workspace-model-list-item-type brtc-style-width-minus-250">'+e[l]+'</div>           <div class="brtc-va-workspace-model-list-item-version"></div>           <div class="brtc-va-workspace-model-list-item-select" id="'+s.getFileId()+'" model-type="'+l+'"></div>           <div class="brtc-va-workspace-model-list-item-edit"></div>       </div>       <div class="brtc-va-workspace-model-list-item-label"></div>       <div class="brtc-va-workspace-model-list-item-updatetime">           <div>Updated on</div><div>'+moment(s.getUpdateTime()).format("YYYY-MM-DD HH:mm:ss")+'</div><div>by</div><div></div>       </div>       <div class="brtc-va-workspace-model-list-item-createtime">           <div>Created on</div><div>'+moment(s.getCreateTime()).format("YYYY-MM-DD HH:mm:ss")+'</div><div>by</div><div></div>       </div>       <div class="brtc-va-workspace-model-list-item-description">'+s.getDescription()+'       </div>       <div class="brtc-va-workspace-model-list-item-open">Open</div>   </div></div>');n.chartContentAddedReport[i]&&n.chartContentAddedReport[i][s.id]&&c.find(".brtc-va-workspace-model-list-item-type").addClass("chartadded"),c.find(".brtc-va-workspace-model-list-item-label").attr("title",s.getLabel()).text(s.getLabel()),c.find(".brtc-va-workspace-model-list-item-updatetime div:nth-child(4)").text(s.getUpdater()),c.find(".brtc-va-workspace-model-list-item-createtime div:nth-child(4)").text(s.getCreator()),c.find(".brtc-va-workspace-model-list-item-version").text(s.getFromVersion()&&"0.0"!=s.getFromVersion()?"From "+s.getFromVersion():""),c.find(".brtc-va-workspace-model-list-item-type").css("cursor","pointer"),c.find(".brtc-va-workspace-model-list-item-icon").css("cursor","pointer"),c.hover(function(){$(this).addClass("brtc-va-workspace-model-list-cell-hover");},function(){$(this).removeClass("brtc-va-workspace-model-list-cell-hover");}),c.find(".brtc-va-workspace-model-list-item-open").click(function(){n.result={selectedProject:i,selectedFiles:[$(this).parent().attr("id")],fileListByProject:Studio.getResourceManager().getFiles(i)},n.performFinish();}),c.find(".brtc-va-workspace-model-list-item-select").jqxCheckBox({theme:t.VA.Env.Theme,width:23,height:24,boxSize:17,checked:!1,locked:!0}),c.find(".brtc-va-workspace-model-list-item-select").on("change",function(){n._refreshCheckBoxStatus();}),c.find(".brtc-va-workspace-model-list-item-header").on("click",function(t){"hidden"!=$(this).find(".brtc-va-workspace-model-list-item-select").css("visibility")&&($(this).find(".brtc-va-workspace-model-list-item-select").jqxCheckBox({locked:!1}),$(this).find(".brtc-va-workspace-model-list-item-select").jqxCheckBox("toggle"),$(this).find(".brtc-va-workspace-model-list-item-select").jqxCheckBox({locked:!0}));}),c.find(".brtc-va-workspace-model-list-item-edit").click(function(t){t.stopPropagation();var e=$(this).closest(".brtc-va-workspace-model-list-content").attr("id"),i=$(this).closest(".brtc-va-workspace-model-list-item").attr("id"),o=Studio.getResourceManager().getFile(e,i).getContents().type||"data";n.$ctxMenu.attr("menu-type","file-edit"),n.$ctxMenu.attr("project-id",e),n.$ctxMenu.attr("file-id",i),n.$ctxMenu.find("li").css("display","none"),n.$ctxMenu.find("li[action=edit]").css("display","block"),n.$ctxMenu.find("li[action=delete]").css("display","block"),"visual"==o?n.$ctxMenu.find("li[type=separator]:eq(0)").css("display","block"):n.$ctxMenu.find("li[type=separator]").css("display","block"),n._configureCtxMenuVisible(o);var r=$(this).offset().left+$(this).width()-200-2,a=$(this).offset().top+$(this).height();n.$ctxMenu.jqxMenu("open",r,a),$(".brtc-va-workspace-model-list-content").on("scroll",n.ctxMenuCloseHandler),$(window).on("resize",n.ctxMenuCloseHandler);}),r.append(c);}},i.prototype._refreshCheckBoxStatus=function(){var t=this.getSelectedTabType(),e=this.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+t+" .brtc-va-workspace-model-list-item-select.jqx-checkbox"),i=this.$contentsContainer.find(".brtc-va-workspace-model-list-cell."+t+" .brtc-va-workspace-model-list-item-select.jqx-checkbox-checked");0==i.length?this.$contentsContainer.find(".brtc-va-workspace-model-list-select").jqxCheckBox({checked:!1}):i.length==e.length?this.$contentsContainer.find(".brtc-va-workspace-model-list-select").jqxCheckBox({checked:!0}):this.$contentsContainer.find(".brtc-va-workspace-model-list-select").jqxCheckBox("indeterminate");},i.prototype._configureCtxMenuVisible=function(e){var i=this;t.VA.Core.Interface.ProjectContextMenuList[e].forEach(function(t){i.$ctxMenu.find("li[action="+t+"]").css("display","block");}),-1===$.inArray("duplicate",t.VA.Core.Interface.ProjectContextMenuList[e])&&this.$ctxMenu.find("li[type=separator]:eq(0)").css("display","none"),-1===$.inArray("version",t.VA.Core.Interface.ProjectContextMenuList[e])&&this.$ctxMenu.find("li[type=separator]:eq(1)").css("display","none");},i.prototype._fillModelList=function(t,e,i){var o=this;Studio.getResourceManager().fetchFiles(t).then(function(n){if(o._clearModelList(t),o._createModelContainer(t),e&&"visual"===e?o.$mainControl.find(".brtc-va-workspace-model-list-type-item.report").click():o.$mainControl.find(".brtc-va-workspace-model-list-type-item.model").click(),o.chartContentAddedReport[t]){var r=Object.keys(o.chartContentAddedReport[t]).length;o.$mainControl.find(".brtc-va-workspace-model-list-type-item.report .addedcount").text(r);}else o.$mainControl.find(".brtc-va-workspace-model-list-type-item.report .addedcount").hide();o._addModelItem(t,n),o.$mainControl.find(".brtc-va-workspace-model-list-content").perfectScrollbar(),o.$mainControl.find(".brtc-va-workspace-model-list-content").perfectScrollbar("update"),i&&"function"==typeof i&&i(),o.$el&&o.$el.remove();}).catch(function(t){throw console.error(t),t;});},i.prototype.performFinish=function(){"function"==typeof this.options.close&&this.options.close(this.result);},i.prototype.openNewProjectDialog=function(){var e=this,i=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-newprojectdialog">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">           <div class="brtc-va-dialogs-contents-label-main">Name</div>           <input type="text" class="brtc-va-dialogs-newfiledialog-name-input" maxlength="80"/>       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />       </div>   </div></div>');$("body").append(i),i.dialog({theme:t.VA.Env.Theme,title:"Create Project",width:400,height:200,modal:!0,resizable:!1,open:function open(){$(".ui-dialog .ui-dialog-titlebar",$(this).parent()).css("border-bottom","1px solid #d9d9d9");var o=i.find(".brtc-va-dialogs-contents > input");o.jqxInput({theme:t.VA.Env.Theme}),o.jqxInput("selectAll"),i.find(".brtc-va-dialogs-buttonbar-ok").jqxButton({theme:t.VA.Env.Theme}),i.find(".brtc-va-dialogs-buttonbar-cancel").jqxButton({theme:t.VA.Env.Theme}),i.find(".brtc-va-dialogs-buttonbar-ok").click(function(){""!==o.val().trim()?(e.doCreateProject(o.val()),i.dialog("close")):t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter name.");}),i.find(".brtc-va-dialogs-buttonbar-cancel").click(function(){i.dialog("close");}),i.find(".brtc-va-dialogs-contents > input").focus();}}),i.attr("name","Create Project"),i.on("close",function(t){i.dialog("destroy"),i.remove();});},i.prototype.openImportProjectDialog=function(){var e=this;new t.VA.Core.Dialogs.ImportProjectDialog(this.$mainControl,{close:function close(t){t.OK&&(e.$mainControl.trigger("project:create",[{projectId:t.projectId}]),e.fillProjectList(t.projectId));}});},i.prototype.doCreateSuccessPopup=function(e,i,o){var n=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-newprojectdialog">   <div class="brtc-va-dialogs-body" style="overflow: hidden;">       <div class="brtc-va-dialogs-contents">           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">               <div class="brtc-va-dialogs-contents-label-main">Deploy ID</div>                   <div class="target-id" style="margin-top: 5px;"></div>           </div>           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">               <div class="brtc-va-dialogs-contents-label-main">Version</div>                   <div class="target-version" style="margin-top: 5px;"></div>           </div>           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">               <div class="brtc-va-dialogs-contents-label-main">Variable Flag</div>                   <div class="target-gvyn" style="margin-top: 5px;"></div>           </div>           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">               <div class="brtc-va-dialogs-contents-label-main">Target Store</div>                   <div class="target-store brtc-va-text-ellipsis" style="margin-top: 5px;"></div>           </div>           <div class="brtc-va-dialogs-row-flex-layout" style="margin-bottom: 5px !important;">               <div class="brtc-va-dialogs-contents-label-main">Name</div>                   <div class="target-name brtc-va-text-ellipsis" style="margin-top: 5px;"></div>           </div>       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />       </div>   </div></div>');return $("body").append(n),n.find(".brtc-va-dialogs-buttonbar-ok").jqxButton({theme:t.VA.Env.Theme}),n.find(".brtc-va-dialogs-buttonbar-ok").click(function(){n.dialog("destroy"),n.remove(),o&&o();}),n.dialog({theme:t.VA.Env.Theme,title:"Success",width:400,height:310,modal:!0,resizable:!1,open:function open(){var t=n.find(".target-id"),o=n.find(".target-name"),r=n.find(".target-version"),a=n.find(".target-store"),s=n.find(".target-gvyn");t.text(e.deployId),o.text(e.title),o.attr("title",e.title),r.text(e.version),a.text(i),a.attr("title",i),s.text(e.gvYn);}}),n.on("close",function(t){n.dialog("destroy"),n.remove(),o&&o();}),!0;},i.prototype.doCreateProject=function(e){var i=this,o=new t.VA.Vo.Project();o.setProjectId(t.VA.Core.Utils.IDGenerator.project.id()),o.setLabel(e),o.setDescription(""),o.setCreator(t.VA.Env.Session.userId),Studio.getResourceManager().addProject(o).then(function(){i.$mainControl.trigger("project:create",[{projectId:o.getProjectId()}]),i.fillProjectList(o.getProjectId());}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},i.prototype.openMemberManagementDialog=function(e){var i=this;new t.VA.Core.Dialogs.MemberManagementDialog(this.$mainControl,{projectId:e,close:function close(t){if(t.OK){var o="model"==i.getSelectedTabType()?"model":"visual";i.fillProjectList(e,o);}},title:"Member Management",appendTo:i.$parent});},i.prototype.exportProject=function(e){return Studio.getResourceService().exportProject(e).then(function(e){t.VA.Core.Utils.CommonUtils.downloadJsonFile(JSON.stringify(e),e.data.label||"untitled");}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},i.prototype.openEditProjectDialog=function(e){var i=this,o=Studio.getResourceManager().getProject(e),n=new t.VA.Core.Dialogs.EditResourceDialog(this.$mainControl,{title:"Edit Project",label:o.getLabel(),description:o.getDescription(),close:function close(e){e.OK&&(o.setLabel(e.label),o.setDescription(e.description),i.doEditProject(o).catch(function(e){400===e.status&&t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),o.setLabel(n.options.label),o.setDescription(n.options.description),i.fillProjectList(o.getProjectId());}));}});},i.prototype.doEditProject=function(e){var i=this;return e.setUpdater(t.VA.Env.Session.userId),Studio.getResourceManager().updateProject(e).then(function(){i.$mainControl.trigger("project:change",[{projectId:e.getProjectId()}]),i.fillProjectList(e.getProjectId());});},i.prototype.deleteProject=function(e){var i=this,o='Are you sure you want to delete "'+Studio.getResourceManager().getProject(e).getLabel()+'"?';t.VA.Core.Utils.WidgetUtils.openConfirmDialog(o,function(t){if(t.OK){var o=Studio.getResourceManager().getFiles(e),n=[];for(var r in o){n.push(o[r].getFileId());}i.deleteAlluxioFile(n),Studio.getResourceManager().deleteProject(e).then(function(){i.$mainControl.trigger("project:delete",[{projectId:e}]),i.fillProjectList();});}});},i.prototype.deleteAlluxioFile=function(e){t.VA.Core.GarbageCollector.immediatelyClearData(e);},i.prototype.deleteFiles=function(e,i){var o=this,n="Are you sure you want to delete the "+i.length+" "+this.getSelectedTabType()+"(s)?";t.VA.Core.Utils.WidgetUtils.openConfirmDialog(n,function(n){if(n.OK){var r=[],a=Studio.getResourceManager().getFile(e,i[0]);for(var s in i){r.push(new Promise(function(t,n){Studio.getResourceManager().deleteFile(e,i[s]).then(function(i){o.$mainControl.trigger("file:delete",[{projectId:e,fileId:i}]),t(i);}).catch(function(t){n(t.responseJSON);});}));}Promise.all(r).then(function(t){o.deleteAlluxioFile(t);}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog(e);}).then(function(){o._clearModelList(e),o.fillProjectList(e,a.getContents().type);});}});},i.prototype.duplicateFiles=function(e,i){var o=this,n="model"===this.getSelectedTabType()?"Duplicate Model":"Duplicate Report",r=[];for(var a in i){r.push(Studio.getResourceManager().getFile(e,i[a]));}new t.VA.Core.Dialogs.DuplicateModelDialog($("body"),{files:r,title:n,resourceManager:Studio.getResourceManager(),close:function close(t){t.OK&&o.fillProjectList(t.projectId,"model"==o.getSelectedTabType()?"model":"visual");},width:600,height:300,minWidth:600,minHeight:300,maxWidth:800,maxHeight:400,resizable:!1});},i.prototype.exportFiles=function(e,i,o){var n=o?"Are you sure you want to export the "+Studio.getResourceManager().getFile(e,i[0]).getLabel()+"?":"Are you sure you want to export the "+i.length+" model(s)?",r=0;for(var a in i){var s=Studio.getResourceManager().getFile(e,i[a]);s&&"visual"===s.getContents().type&&r++;}var l="Include the data flow(s) along with the selected model.";r>0&&(l="Include the data flow(s) along with the selected report."),t.VA.Core.Utils.WidgetUtils.openConfirmWithOptionDialog("",n,l,function(o){o.OK&&_.forEach(i,function(i){var n=Studio.getResourceManager().getFile(e,i);Studio.getResourceService().exportJSON(n.getFileId(),e,o.OPTION).then(function(e){return console.log(e),t.VA.Core.Utils.CommonUtils.downloadJsonFile(JSON.stringify(e),n.getLabel()),!0;}).catch(console.error);});});},i.prototype.getSelectedTabType=function(){return this.$mainControl.find(".brtc-va-workspace-model-list-type-item.model").hasClass("selected")?"model":"report";},i.prototype.show=function(){this.$parent.removeClass("brtc-va-workspace-popup"),this.$parent.css("display","block"),this.$mainControl.css("display","block");},i.prototype.hide=function(){this.$parent.css("display","none"),this.$mainControl.css("display","none");},i.prototype.showPopup=function(){var t=this;this.fillProjectList(null,null,function(){t.$parent.addClass("brtc-va-workspace-popup"),t.$parent.css("display","block"),t.$mainControl.css("display","flex"),t.renderProjectListContainer();});},i.prototype.setChartContentAddedReport=function(t){for(var e in this.chartContentAddedReport={},t){var i=t[e].project_id,o=t[e].id;this.chartContentAddedReport[i]||(this.chartContentAddedReport[i]={}),this.chartContentAddedReport[i][o]=t[e];}},t.VA.Workspace.ProjectViewer=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.factory=this.getPropertyPageFactory(),this.retrieveParent(),this.createControls(),this.init();}function i(){}e.prototype.init=function(){var t=this;this.commandListener=function(e){t.page&&t.page.onCommand(e);},this.problemsListener=function(e,i,o){t.page&&t.activeEditor.getModel().mid==i&&t.page.onProblem(o);},this.$contentsArea.bind("fireCommand",function(e,i){t.activeEditor&&t.activeEditor.getCommandManager().execute(i);}),Studio.getInstance().addProblemListener(this.problemsListener);},e.prototype.getPropertyPageFactory=function(){return new i();},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-properties">   <div class="brtc-va-views-properties-contents" /></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$contentsArea=this.$mainControl.find(".brtc-va-views-properties-contents"),this.$mainControl.perfectScrollbar();},e.prototype.editorChanged=function(t){this.activeEditor=null;},e.prototype.selectionChanged=function(t){var e=this;t&&this.selection!==t?(this.page&&this.page.destroy(),this.$contentsArea.empty(),this.page=this.factory.createPage(this.$contentsArea,t),this.page.parent=this,this.page.setInput(t).then(function(){e.page.removeValidation(),e.page.renderValidation();})):t||(this.page&&this.page.destroy(),this.$contentsArea.empty(),this.page=null),this.selection=t;},t.VA.Core.Views.Properties=e,i.prototype.createPage=function(e,i){return new t.VA.Core.Views.Pages.PropertyPage(e,{width:"100%",height:"100%"});};}.call(this),function(){"use strict";var t=this.Brightics,e=(t.VA.Env.Session.userId,"brtc-va-controls-repository-viewer-element-hide");function i(t,e){this.parentId=t,this.options=e,this.loadedFolders={},this.retrieveParent(),this.createControls();}i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-controls-repository-viewer">   <input  class="brtc-va-controls-repository-viewer-search" type="search">   <div    class="brtc-va-controls-repository-viewer-more"></div>   <button class="brtc-va-controls-repository-viewer-upload"><div class="brtc-va-icon"></div>Add</button>   <button class="brtc-va-controls-repository-viewer-refresh"><div class="brtc-va-icon"></div>Refresh</button>   <div    class="brtc-va-controls-repository-viewer-tree"></div>   <div    class="brtc-va-controls-repository-viewer-context-menu"></div></div>'),this.$parent.append(this.$mainControl),this.createSearchControl(this.$mainControl.find(".brtc-va-controls-repository-viewer-search")),this.createRefreshButton(this.$mainControl.find(".brtc-va-controls-repository-viewer-refresh")),this.createUploadButton(this.$mainControl.find(".brtc-va-controls-repository-viewer-upload")),this.createMoreButton(this.$mainControl.find(".brtc-va-controls-repository-viewer-more")),this.createTreeControl(this.$mainControl.find(".brtc-va-controls-repository-viewer-tree")),this.createContextMenu(this.$mainControl.find(".brtc-va-controls-repository-viewer-context-menu")),this.$searchControl.focus();},i.prototype.destroy=function(){this.$ctxMenu.jqxMenu("destroy"),this.$tree.jqxTree("destroy");},i.prototype.createSearchControl=function(e){var i=this;this.$searchControl=e.jqxInput({placeHolder:"Search Item",theme:t.VA.Env.Theme}),this.throttledApplyFilter=_.throttle(function(){i.applyFilter();},500),this.$searchControl.keyup(function(t){i.throttledApplyFilter();}),this.$searchControl.on("search",function(t){i.throttledApplyFilter();});},i.prototype.applyFilter=function(){var i=this,o=this.$searchControl.val().toLowerCase().trim();if(o.length>0){_.forEach(i.$tree[0].querySelectorAll("li"),function(t){t.classList.add(e);});var n=i.$tree.jqxTree("getItems");$.each(n,function(n,r){if(r.value){var a=r.value,s=a.lastIndexOf("/"),l=a.substring(0,s);if("/shared/upload"==l||0==l.indexOf("/"+t.VA.Env.Session.userId+"/upload"))if(a.substring(s+1).toLowerCase().indexOf(o)>-1){r.element.classList.remove(e);for(var c=r.parentElement;c;){c.classList.remove(e),c=i.$tree.jqxTree("getItem",c).parentElement;}}}});}else _.forEach(i.$tree[0].querySelectorAll("li"),function(t){t.classList.remove(e);});this.debouncedTriggerResize=this.debouncedTriggerResize||_.debounce(function(){$(window).trigger("resize");},1e3),this.debouncedTriggerResize(),i.$tree.find(".brtc-va-controls-repository-viewer-loading").length>0&&(i.$tree.jqxTree("expandAll"),i.throttledApplyFilter());},i.prototype.createRefreshButton=function(e){var i=this;this.$refreshButton=e.jqxButton({theme:t.VA.Env.Theme}),this.$refreshButton.click(function(e){i.$searchControl.val(""),i.initRootItem(),i.loadedFolders={},t.VA.RepositoryQueryTemplate.browse("",!0,{blocking:!0});});},i.prototype.createUploadButton=function(e){var i=this;this.$uploadButton=e.jqxButton({theme:t.VA.Env.Theme}),this.$uploadButton.click(function(e){new t.VA.Core.Wizards.DataUploadWizard(i.$mainControl,{mode:"open",close:function close(e){e.OK&&(e.path&&(i.addItem(e.path),i.selectItem(e.path,!0)),i.$searchControl.val(""),t.VA.RepositoryQueryTemplate.browse("",!0,{blocking:!0}));}});});},i.prototype.createMoreButton=function(t){var e=this;t.click(function(t){e.openContextMenu($(t.currentTarget));});},i.prototype.createTreeControl=function(e){var i=this;this.$tree=e.jqxTree({theme:t.VA.Env.Theme,width:"calc(100% - 2px)",height:"calc(100% - 82px)",allowDrag:!1,allowDrop:!1}),this.initRootItem(),this.$tree.on("select",function(){i.pended=null;}),this.$tree.on("expand",function(e){var o=!1,n=null,r=$(e.args.element),a=r.find("ul:first").children();if($.each(a,function(){var t=i.$tree.jqxTree("getItem",this);if(t&&!t.value)return n=t,o=!0,!1;}),o&&!i.loadedFolders[r.attr("id")]){i.loadedFolders[r.attr("id")]=!0;var s=i.$tree.jqxTree("getItem",r[0]).value;t.VA.RepositoryQueryTemplate.browse(s,!1,{blocking:!1}).done(function(e){if(i.$tree.jqxTree("removeItem",n.element),e.length>0){var o=e.filter(function(t){if(0==t.path.indexOf(s))return t;}).map(function(e){var o=e.path.lastIndexOf("/");return e.path.substring(0,o)=="/"+t.VA.Env.Session.userId+"/upload/"?i.createFolderItem(e.path):i.createFileItem(e.path);});o.length>0&&i.$tree.jqxTree("addTo",o,r[0]),i.$tree.jqxTree("refresh"),i.pended&&i.selectItem(i.pended),i._updateTooltip();}}).fail(function(e){i.$tree.jqxTree("removeItem",n.element),t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}});},i.prototype.openContextMenu=function(t){var e=t.offset().left+t.width()-140-2,i=t.offset().top+t.height()+10;this.$ctxMenu.jqxMenu("open",e,i);},i.prototype.createContextMenu=function(e){var i=this;e.append('<ul>   <li action="rename">Rename</li>   <li action="delete">Delete</li>   <li action="export">Export</li></ul>'),this.$ctxMenu=e.jqxMenu({theme:t.VA.Env.Theme,width:"140px",height:"20px",autoOpenPopup:!1,popupZIndex:5e4,mode:"popup",animationHideDuration:0,animationShowDuration:0}),this.$ctxMenu.on("itemclick",function(e){var o,n=$(e.args);"rename"===n.attr("action")?(o=i.getSelectedFile())?i.openRenameDialog(o):t.VA.Core.Utils.WidgetUtils.openInformationDialog("There is no selected file."):"delete"===n.attr("action")?(o=i.getSelectedFile())?i.openDeleteDialog(o):t.VA.Core.Utils.WidgetUtils.openInformationDialog("There is no selected file."):(o=i.getSelectedFile())?i.openExportDialog(o):t.VA.Core.Utils.WidgetUtils.openInformationDialog("There is no selected file.");});},i.prototype.openExportDialog=function(e){var i=this,o=t.VA.Env.Session.userId,n=e.lastIndexOf("/"),r=(e.substring(0,n),e.substring(n+1));new t.VA.Core.Wizards.DataExportWizard(i.$mainControl,{name:r,path:e,mode:"open",close:function close(e){e.OK&&(i.initRootItem(),t.VA.RepositoryQueryTemplate.browse("",!0,{blocking:!0}));},userid:o});},i.prototype.openRenameDialog=function(e){var i=this,o=e.lastIndexOf("/"),n=e.substring(0,o),r=e.substring(o+1);new t.VA.Core.Dialogs.RenameDialog(this.$mainControl,{name:r,close:function close(o){o.OK&&t.VA.RepositoryQueryTemplate.move(e,n+"/"+o.newName,{blocking:!0}).done(function(){i.$searchControl.val(""),i.initRootItem(),t.VA.RepositoryQueryTemplate.browse("",!0,{blocking:!1});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},title:"Rename"});},i.prototype.openDeleteDialog=function(e){var i=this,o=e.lastIndexOf("/"),n='Are you sure you want to delete "'+e.substring(o+1)+'"?';t.VA.Core.Utils.WidgetUtils.openConfirmDialog(n,function(o){o.OK&&t.VA.RepositoryQueryTemplate.delete(e,{blocking:!0}).done(function(){i.initRootItem(),t.VA.RepositoryQueryTemplate.browse("",!0,{blocking:!1});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});});},i.prototype.createLoadingItem=function(){return{html:'<div class="brtc-va-controls-repository-viewer-loading"><div class="brtc-va-icon"></div> Loading...</div>'};},i.prototype.createFolderItem=function(t){var e=t.lastIndexOf("/");return{html:'<i class="fa fa-folder" aria-hidden="true"></i>'+_.escape(t.substring(e+1)),value:t,items:[this.createLoadingItem()]};},i.prototype.createFileItem=function(t){var e=t.lastIndexOf("/");return{html:'<i class="fa fa-file-o" aria-hidden="true"></i>'+_.escape(t.substring(e+1)),value:t,items:[]};},i.prototype._updateTooltip=function(){var t=this.$tree.jqxTree("getItems");$.each(t,function(){$(this.titleElement).attr("title",this.label);});},i.prototype.initRootItem=function(){this.$tree.jqxTree("clear");var e=[{html:'<i class="fa fa-folder" aria-hidden="true"></i>shared',value:"/shared",expanded:!0,items:[{html:'<i class="fa fa-folder" aria-hidden="true"></i>upload',value:"/shared/upload",items:[this.createLoadingItem()]}]},{html:'<i class="fa fa-folder" aria-hidden="true"></i>'+t.VA.Env.Session.userId,value:"/"+t.VA.Env.Session.userId,expanded:!0,items:[{html:'<i class="fa fa-folder" aria-hidden="true"></i>upload',value:"/"+t.VA.Env.Session.userId+"/upload",items:[this.createLoadingItem()]}]}];this.$tree.jqxTree("addTo",e,this.$tree[0]),this._updateTooltip();},i.prototype.getSelectedPath=function(){var t=this.$tree.jqxTree("getSelectedItem");return t?t.value:void 0;},i.prototype.render=function(){this.$tree.jqxTree("render");},i.prototype.getSelectedFile=function(){var e=this.$tree.jqxTree("getSelectedItem");return e&&e.value&&0==e.value.indexOf("/shared/upload/")?e.value:e&&e.value&&0==e.value.indexOf("/"+t.VA.Env.Session.userId+"/upload/")&&4==e.value.split("/").length?e.value:void 0;},i.prototype.getSelectedFileType=function(){var t=this.$tree.jqxTree("getSelectedItem");if(t){var e=_.get(t,"element").querySelector("div");if(e&&e.children[0])return e.children[0].classList.contains("fa-folder")?"folder":"file";}};i.prototype.addItem=function(t){var e=t.split("/")[1],i=t.split("/")[3],o=this.getRepo(e),n=this.getChildren(o)[0],r=this.getChildren(n);if(!(r.length>0)||r[0].value){for(var a=0;a<r.length&&r[a].label.localeCompare(i)<0;){a++;}if(!(a<r.length&&0===r[a].label.localeCompare(i))){var s=this.createFileItem(t);a>=r.length?this.$tree.jqxTree("addTo",s,n):this.$tree.jqxTree("addBefore",s,r[a]);}}},i.prototype.getChildren=function(t){var e=this.$tree.jqxTree("getItems");return t?e.filter(function(e){return e.parentElement===t.element;}):e.filter(function(t){return!t.parentElement;});},i.prototype.getRepo=function(t){return this.getChildren().find(function(e){return e.label===t;});},i.prototype.selectItem=function(t,e){var i,o=this,n=t.split("/")[1],r=this.getRepo(n),a=this.getChildren(r)[0];(this.$tree.jqxTree("expandItem",a.element),!(i=o.getChildren(a).find(function(e){return e.value===t;}))||(o.$tree.jqxTree("selectItem",i.element),0))&&e&&(this.pended=t);},t.VA.Core.Controls.RepositoryViewer=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e||{},this.retrieveParent(),this.createControls(),this.initialReport();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$parent.empty(),this.$mainControl=$('<div class="brtc-va-views-report-result-contents"></div>'),this.$mainControl.css({width:"100%",height:"100%","margin-left":"10px"}),this.$parent.append(this.$mainControl),$(document).bind("contextmenu",function(t){return!1;});},e.prototype.initialReport=function(){t.VA.Env.Session.userId=this.options.userId;var e=this.options.html,i=JSON.parse(this.options.chartOptions);for(var o in i.charts){var n=i.charts[o].id,r=new RegExp("<code>{&quot;chart&quot;:&quot;"+n+"&quot;}</code>","g");e=e.toString().replace(r,'<div id="'+n+'" class="'+n+'" style="width: 600px; height: 400px"></div>');}this.$mainControl.html(e),this.dataProxy=new t.VA.Core.Editors.Sheet.DataProxy(this.$mainControl,this.options.mid);i=JSON.parse(this.options.chartOptions);for(var o in i.charts){n=i.charts[o].id;var a=i.charts[o].options,s=i.charts[o].options.source,l=this.$mainControl.find("."+n);l.css({width:"580px",height:"400px","margin-bottom":"15px"}),this.chartRenderer(l,a,s);}this.$parent.perfectScrollbar();},e.prototype.chartRenderer=function(t,e,i){this.dataProxy.requestData(i,function(i){e.source={dataType:"local",localData:[{dataType:"rawdata",columns:i.columns,data:i.data}]},t.bcharts(e);},function(t){});},t.VA.Core.Views.ResultReport=e;}.call(this),function(){"use strict";var t=this.Brightics,e="value-control";function i(t,e){this.parentId=t,this.options=e||{},o.bind(this)(),this.init(),this.createControls();}var o=function o(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);};i.prototype.initTempDataStorage=function(){var t,e,i,o,n,r;this.tempDataStorage=(t=[],e=function e(t,_e3){return{id:t,data:_e3||{}};},i=function i(e,_i14){var o=_.findIndex(t,function(t){return t.id===e;});if(o>=0)return _i14(t[o].data);},o=function o(e,i){if(t[e])return i(t[e].data);},n=function n(t,e){return _.partial(_.set,_,t,e);},r=function r(t){return _.partial(_.get,_,t);},{init:function init(){t=[];},push:function push(i){t.push(e(i));},removeById:function removeById(e){var i=_.findIndex(t,function(t){return t.id===e;});i>=0&&t.splice(i,1);},splice:function splice(i,o,n){n?t.splice(i,o,e(n)):t.splice(i,o);},putDataById:function putDataById(t,e,o){i(t,n(e,o));},getDataById:function getDataById(t,e){return i(t,r(e));},putDataByIndex:function putDataByIndex(t,e,i){o(t,n(e,i));},getDataByIndex:function getDataByIndex(t,e){return o(t,r(e));}});},i.prototype.init=function(){var t=this;this.isRendered=!1,this.propertyControls=[],this.index=0,this.initTempDataStorage(),this.commandListener=function(e){t.isRendered?(t.isRendered=!1,t.handleCommand(e),t.isRendered=!0):t.handleCommand(e);},this.options.editor.addCommandListener(this.commandListener),this.options.editor.addGoHistoryListener(this.commandListener);},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-variable">       <input type="button" class="brtc-va-tools-sidebar-variable-button add-variable-button" value="+ Add Variable"/>       <div class="brtc-va-tools-sidebar-variable-filter brtc-va-searcharea">           <input type="search" class="brtc-va-tools-sidebar-variable-filter-input" maxlength="80"/>       </div>       <div class="brtc-va-tools-sidebar-variable-list">       </div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$filter=this.$mainControl.find(".brtc-va-tools-sidebar-variable-filter"),this.$variableList=this.$mainControl.find(".brtc-va-tools-sidebar-variable-list"),this.createFilterControl(),this.createAddVariableButton(),this.refresh(),this.$variableList.perfectScrollbar();},i.prototype.refresh=function(){this.variables=[],this.propertyControls=[],this.tempDataStorage.init(),this.$variableList.find(".brtc-va-tools-sidebar-variable-deck").remove(),this.parseVariables(),this.renderValues(this.variables);},i.prototype.parseVariables=function(){if("control"===this.options.editor.getModel().type)this.variables=this.options.editor.getModel().variables;else for(var t in this.options.editor.getModel().variables){this.variables.push({name:t,type:this.options.editor.getModel().variables[t].type,value:this.options.editor.getModel().variables[t].value||""});}},i.prototype.createFilterControl=function(){var e=this,i=this.$filter.find(".brtc-va-tools-sidebar-variable-filter-input");i.jqxInput({placeHolder:"Search Variable",theme:t.VA.Env.Theme});var o=function o(t){var i=t.target.value.toLowerCase(),o=e.$mainControl.find(".brtc-va-tools-sidebar-variable-name");$.each(o,function(t,e){$(e).find(".CodeMirror").each(function(t,o){var n=o.CodeMirror.getValue().toLowerCase().indexOf(i)>-1;$(e).parents(".brtc-va-tools-sidebar-variable-deck").css("display",n?"block":"none");});}),e.$variableList.perfectScrollbar("update");};i.keyup(function(t){o(t);}),i.on("search",function(){o(event);});},i.prototype.createAddVariableButton=function(){var e=this;this.$addVariableButton=this.$mainControl.find(".add-variable-button"),this.$addVariableButton.jqxButton({theme:t.VA.Env.Theme}),this.$addVariableButton.click(function(){var t={type:"string",name:"variable"+ ++e.index,value:""};e.createAddVariableCommand(t),e.$variableList.perfectScrollbar("update");});},i.prototype.removeVariableControl=function(e,i){var o=i;i<=-1&&(o=this.propertyControls.length-1),t.VA.Core.Utils.WidgetUtils.destroyJqxControl(this.propertyControls[o]),this.propertyControls[o].remove(),this.propertyControls.splice(o,1),this.tempDataStorage.splice(o,1);},i.prototype.updateVariableControl=function(t,i){var o=this.propertyControls[i],n=o.find(".brtc-va-tools-sidebar-variable-type");o.find(".brtc-va-widget-contents-input-control"),o.find(".brtc-va-tools-sidebar-variable-value");n.val(t.type);var r=_.partial(this.tempDataStorage.getDataByIndex,i);this.setVariableName(r("name-control"),t.name),r(e).setInputValue(t.value);},i.prototype.setVariableName=function(t,e){var i=this.wrap(e);t.setValue(i),t.markText({line:0,ch:0},{line:0,ch:2},{readOnly:!0,inclusiveLeft:!0,atomic:!0}),t.markText({line:0,ch:i.length-1},{line:0,ch:i.length},{readOnly:!0,inclusiveRight:!0,atomic:!0});},i.prototype.createVariableControl=function(i,o){var n=this,r=$('<div class="brtc-va-tools-sidebar-variable-deck">   <div class ="brtc-va-tools-sidebar-variable-remove" />   <div class="controls">       <div class="control-row">            <div class="brtc-va-editors-sheet-controls-wrapper brtc-va-tools-sidebar-variable-name">                <textarea  class="brtc-va-widget-contents-input-control"/>            </div>       </div>       <div class="control-row">            <div class="brtc-va-tools-sidebar-variable-type"/>       </div>       <div>            <div class="brtc-va-tools-sidebar-variable-value" />       </div>   </div></div>'),a=_.uniqueId("var-"),s=_.partial(this.tempDataStorage.putDataById,a),l=_.partial(this.tempDataStorage.getDataById,a);if(o||o>-1){var c=this.propertyControls[o];c?r.insertBefore(c):this.$variableList.append(r),this.propertyControls.splice(o,0,r),this.tempDataStorage.splice(o,0,a);}else this.$variableList.append(r),this.propertyControls.push(r),this.tempDataStorage.push(a);s("variable",i);var d=r.find(".brtc-va-tools-sidebar-variable-type"),p=r.find(".brtc-va-widget-contents-input-control"),u=r.find(".brtc-va-tools-sidebar-variable-value"),h=r.find(".brtc-va-tools-sidebar-variable-remove");this.createDropDownList(d,{source:[{label:"String",value:"string"},{label:"Number",value:"number"},{label:"Array String Value",value:"array[string]"},{label:"Array Number Value",value:"array[number]"},{label:"Calculation Value",value:"calculation"}],displayMember:"label",valueMember:"value"}),d.on("change",function(i){var o=l("variable"),r=d.jqxDropDownList("val");l(e).setVariableType(r),n.createUpdateVariableCommand(o,{value:"calculation"===r?t.VA.Core.Utils.VariableUtils.wrap(o.value):t.VA.Core.Utils.VariableUtils.strip(o.value),type:r});});var f=CodeMirror.fromTextArea(p[0],{mode:"brtc-controlflow-variable",scrollbarStyle:"null",placeholder:"",lineWrapping:!1,lineNumbers:!1,viewportMargin:1/0,hintOptions:{list:[]},extraKeys:{Tab:!1,"Shift-Tab":!1}});t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(f,{"valid-type":"type1"}),f.on("blur",function(e,i){var o=l("variable"),r=n.strip(e.getValue()),a=!1;for(var s in n.variables){if(n.variables[s].name==r){a=!0;break;}}o.name!==r&&(a?(t.VA.Core.Utils.WidgetUtils.openErrorDialog("The typed name already exists. Variable Name must be unique."),n.setVariableName(f,o.name)):n.createUpdateVariableCommand(o,{name:r}));}),s("name-control",f);var m=t.VA.Core.Widget.Factory.variableControl(u,{variable:{temp:{type:"literal",value:i.value,"variable-type":i.type}},onChangeCallback:function onChangeCallback(t){var e=l("variable");n.createUpdateVariableCommand(e,{value:t.value});},"valid-type":"type1"});s(e,m),h.click(function(t){var e=l("variable");n.createRemoveVariableCommand(e),n.$variableList.perfectScrollbar("update"),t.stopPropagation();}),d.val(i.type),this.setVariableName(f,i.name),m.setInputValue(i.value);try{var g=parseInt(i.name.split("variable")[1].replace("}",""));this.index=Math.max(this.index,_.isNaN(g)?0:g);}catch(t){}return r;},i.prototype.renderValues=function(t){for(var e in this.isRendered=!1,t){this.createVariableControl(t[e]);}this.isRendered=!0;},i.prototype.executeCommand=function(t){this.isRendered&&this.options.editor.getCommandManager().execute(t);},i.prototype.createAddVariableCommand=function(e){var i;i="control"===this.options.editor.getModel().type?new t.VA.Core.Editors.Diagram.Commands.ControlEditor.AddVariableCommand(this.options.editor,{variable:e}):new t.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand(this.options.editor,{name:e.name,ref:{type:e.type||"string",value:""},variable:e}),this.executeCommand(i);},i.prototype.createUpdateVariableCommand=function(e,i){if("control"===this.options.editor.getModel().type)n=new t.VA.Core.Editors.Diagram.Commands.ControlEditor.UpdateVariableCommand(this.options.editor,{variable:e,ref:i});else{var o=this.variables.indexOf(e),n=new t.VA.Core.CompoundCommand(this.options.editor,{label:"Update Variable"}),r=new t.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand(this.options.editor,{name:e.name,newName:i.name||e.name,ref:{type:i.type||e.type,value:_.isUndefined(i.value)?e.value:i.value}});n.add(r),r.old.index=o,r.old.variable=$.extend(!0,{},e);var a=this.options.editor.getModel().getVariableAssignedParamList(e.name);for(var s in a){n.add(new t.VA.Core.Editors.Diagram.Commands.UpdateVariableCommand(this.options.editor,{fid:a[s].fid,paramKey:a[s].param,ref:i.name||e.name}));}}this.executeCommand(n);},i.prototype.createRemoveVariableCommand=function(e){var i;if("control"===this.options.editor.getModel().type)i=new t.VA.Core.Editors.Diagram.Commands.ControlEditor.RemoveVariableCommand(this.options.editor,{variable:e});else{var o=this.variables.indexOf(e);i=new t.VA.Core.CompoundCommand(this.options.editor,{label:"Delete Variable"});var n=new t.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand(this.options.editor,{name:e.name,variable:e});i.add(n),n.old.index=o;var r=this.options.editor.getModel().getVariableAssignedParamList(e.name);for(var a in r){i.add(new t.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(this.options.editor,{fid:r[a].fid,paramKey:r[a].param,variable:e.name,subFnUnitIndex:-1}));}}this.executeCommand(i);},i.prototype._exist=function(t){for(var e in this.variables){if(this.variables[e].name==t.name)return!0;}return!1;},i.prototype.handleCommand=function(e){if(e instanceof t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand)for(var i in e.options.commands){this.handleCommand(e.options.commands[i]);}else e instanceof t.VA.Core.CompoundCommand?this.handleCompoundCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand?this.handleAddVariableCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand?this.handleRemoveVariableCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand?this.handleUpdateVariableCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ControlEditor.AddVariableCommand?this.handleAddVariableCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ControlEditor.UpdateVariableCommand?this.handleUpdateVariableCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.ControlEditor.RemoveVariableCommand&&this.handleRemoveVariableCommand(e);},i.prototype.handleCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type)for(e in t.commandList){this.handleCommand(t.commandList[e]);}else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--){this.handleCommand(t.commandList[e]);}},i.prototype.handleAddVariableCommand=function(e){if("UNDO"===e.event.type)this.removeVariableControl(e.options.variable,this.variables.length-1),e instanceof t.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand&&this.variables.splice(this.variables.length-1,1);else if("REDO"===e.event.type){if(e instanceof t.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand){if(this._exist(e.options.variable))return;this.variables.push(e.options.variable),this.createVariableControl(e.options.variable);}else this.createVariableControl(e.options.variable);}else if(e instanceof t.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand){if(this._exist(e.options.variable))return;this.variables.push(e.options.variable),this.createVariableControl(e.options.variable);}else this.createVariableControl(e.options.variable);this.$mainControl.perfectScrollbar("update");},i.prototype.handleUpdateVariableCommand=function(e){"UNDO"===e.event.type?e instanceof t.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand?(this.variables[e.old.index].name=e.old.variable.name,this.variables[e.old.index].type=e.old.variable.type,this.variables[e.old.index].value=e.old.variable.value,this.updateVariableControl(e.old.variable,e.old.index)):this.updateVariableControl(e.old.variable,e.old.index):(e.event.type,e instanceof t.VA.Core.Editors.Diagram.Commands.UpdateVariableDefCommand?(this.variables[e.old.index].name=e.options.newName,this.variables[e.old.index].type=e.options.ref.type||e.old.variable.type,this.variables[e.old.index].value=_.isUndefined(e.options.ref.value)?e.old.variable.value:e.options.ref.value,this.updateVariableControl(this.variables[e.old.index],e.old.index)):this.updateVariableControl(e.options.analyticsModel.variables[e.old.index],e.old.index));},i.prototype.handleRemoveVariableCommand=function(e){if("UNDO"===e.event.type){if(e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand){if(this._exist(e.options.variable))return;this.variables.splice(e.old.index,0,e.options.variable),this.createVariableControl(e.options.variable,e.old.index);}else this.createVariableControl(e.options.variable,e.old.index);}else e.event.type,this.removeVariableControl(e.options.variable,e.old.index),e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveVariableDefCommand&&this.variables.splice(e.old.index,1);this.$mainControl.perfectScrollbar("update");},i.prototype.createDropDownList=function(e,i,o,n){this.wrapControl(e);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(e,r),this.addCssToWrapper(e,n);var a={theme:t.VA.Env.Theme,height:"25px",autoDropDownHeight:!0,enableBrowserBoundsDetection:!0,width:"calc(100% - 2px)"};i&&$.extend(a,i),e.jqxDropDownList(a);},i.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');t.wrap(e);},i.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},i.prototype.addCssToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.css(e);}},i.prototype.destroy=function(){for(var t in this.propertyControls){this.removeVariableControl("",t);}},i.prototype.strip=function(t){return t.substring(2,t.length-1);},i.prototype.wrap=function(t){return"${"+t+"}";},t.VA.Core.Views.Variable=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Views.LibraryExplorer.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Views.LibraryExplorer.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-library brtc-va-tab-contents">   <div class="brtc-va-views-library-container brtc-style-margin-0"></div></div>'),this.$parent.append(this.$mainControl),this.fillTemplates();},e.prototype.fillTemplates=function(){for(var t in this.options.functionList){this._addTemplate(this.options.functionList[t]);}},e.prototype._addTemplate=function(t){var e=$('<div class="brtc-va-views-library-template" uid="'+t.uid+'">   <div class="brtc-va-views-library-template-label brtc-va-studio-dm-draggable"></div>   <div class="brtc-va-views-library-template-preview"></div></div>');this.$mainControl.find(".brtc-va-views-library-container").append(e),this._addTemplateLabel(e.find(".brtc-va-views-library-template-label"),t);var i,o=e.find(".brtc-va-views-library-template-preview"),n=new joint.dia.Graph(),r=new joint.dia.Paper({el:o,width:"100%",height:"calc(100% - 43px)",model:n,theme:"none",interactive:!1});for(i in r.$el.css("pointer-events","none"),r.scale(.5),t.contents.functions){var a=this._createFnUnitFigure(t.contents.functions[i]);n.addCells([a]);}for(i in t.contents.links){var s=this._createLinkFigure(n,t.contents.links[i]);n.addCells([s]);}var l=n.getLinks();return $.each(l,function(t,e){e.toBack();}),this._draggableTemplate(e,t.contents),e;},e.prototype._removeTemplate=function(t){this.$mainControl.find(".brtc-va-views-library-template[uid="+t.uid+"]").remove();},e.prototype._addTemplateLabel=function(t,e){var i=e.contents.functions,o=1===i.length?"1 function":i.length+" functions",n=e.width+" x "+e.height;t.append(o+"<br>"+n);},e.prototype.updateFunctionList=function(t){for(var e in t){var i=t[e];this._isInTargetFunctionList(i,this.options.functionList)||this._addTemplate(i);}for(var e in this.options.functionList){var o=this.options.functionList[e];this._isInTargetFunctionList(o,t)||this._removeTemplate(i);}this.options.functionList=$.extend(!0,[],t);},e.prototype._isInTargetFunctionList=function(t,e){var i=!1;for(var o in e){var n=e[o];if(t.uid===n.uid){i=!0;break;}}return i;},t.VA.Core.Views.ClipboardExplorer=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Views.Variable.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Views.Variable.prototype),e.prototype.constructor=e;e.prototype.init=function(){this.isRendered=!1,this.propertyControls=[],this.index=0,this.initTempDataStorage();},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-variable">       <input type="button" class="brtc-va-tools-sidebar-variable-button brtc-style-col-12 add-variable-button" value="+ Add Variable"/>       <div class="brtc-va-tools-sidebar-variable-list brtc-style-padding-0 brtc-style-padding-right-10">           <div class="brtc-va-tools-sidebar-variable-list-wrapper brtc-style-height-full"></div>       </div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$variableList=this.$mainControl.find(".brtc-va-tools-sidebar-variable-list-wrapper"),this.createAddVariableButton(),this.$variableList.perfectScrollbar(),this.configureOptions();},e.prototype.createAddVariableButton=function(){var e=this;this.$addVariableButton=this.$mainControl.find(".add-variable-button"),this.$addVariableButton.jqxButton({theme:t.VA.Env.Theme}),this.$addVariableButton.click(function(){e.$empty&&e.$empty.remove();var t={type:"string",name:"variable"+(e.$variableList.find(".brtc-va-tools-sidebar-variable-deck").length+1),param:{value:""}};e.createVariableControl(t),e.options.onAdd(t),e.$variableList.perfectScrollbar("update");});},e.prototype.renderEmptyControl=function(){this.$empty=$('<div class="brtc-va-tools-sidebar-variable-deck">   <div class="controls">       <div class="control-row empty">There is no Variables</div>   </div></div>'),this.$variableList.append(this.$empty);},e.prototype.createVariableControl=function(e,i){this.isRendered=!1;var o=this,n=$('<div class="brtc-va-tools-sidebar-variable-deck">   <div class ="brtc-va-tools-sidebar-variable-remove" />   <div class="controls">       <div class="control-row">            <div class="brtc-va-editors-sheet-controls-wrapper brtc-va-tools-sidebar-variable-name">                <textarea  class="brtc-va-widget-contents-input-control"/>            </div>       </div>       <div class="control-row">            <div class="brtc-va-tools-sidebar-variable-type"/>       </div>       <div>            <div class="brtc-va-tools-sidebar-variable-value" />       </div>   </div></div>'),r=_.uniqueId("var-"),a=_.partial(this.tempDataStorage.putDataById,r),s=_.partial(this.tempDataStorage.getDataById,r);this.$variableList.append(n),this.tempDataStorage.push(r),a("variable",e);var l=n.find(".brtc-va-tools-sidebar-variable-type"),c=n.find(".brtc-va-widget-contents-input-control"),d=n.find(".brtc-va-tools-sidebar-variable-value"),p=n.find(".brtc-va-tools-sidebar-variable-remove");this.createDropDownList(l,{source:this.getSource(),displayMember:"label",valueMember:"value"}),l.on("change",function(t){var e=s("variable"),i=$.extend(!0,{},e),n=l.jqxDropDownList("val");s("value-control").setVariableType(n),i.type=n,i.param={},"cell"===n?i.param={inData:"",rowIndex:"",column:""}:i.param.value="",o.isRendered&&(o.options.onChange(e,i),a("variable",i));});var u=CodeMirror.fromTextArea(c[0],{mode:"brtc-controlflow-variable",scrollbarStyle:"null",placeholder:"",lineWrapping:!1,lineNumbers:!1,viewportMargin:1/0,hintOptions:{list:[]},extraKeys:{Tab:!1,"Shift-Tab":!1}});t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(u,{"valid-type":"type1"}),u.on("blur",function(e,i){if(o.isRendered){var n=s("variable"),r=o.strip(e.getValue()),l=!1;for(var c in o.variables){if(o.variables[c].name==r){l=!0;break;}}if(n.name!==r)if(l)t.VA.Core.Utils.WidgetUtils.openErrorDialog("The typed name already exists. Variable Name must be unique."),o.setVariableName(u,n.name);else{var d=n,p=$.extend(!0,{},d);p.name=r,p.param={},p.param.value=n.value,o.options.onChange(d,p),a("variable",p);}}}),a("name-control",u);var h=t.VA.Core.Widget.Factory.variableControl(d,{fnUnit:this.options.fnUnit,variable:{temp:{type:"literal",value:e.value,"variable-type":e.type}},onChangeCallback:function onChangeCallback(t){if(o.isRendered){var e=s("variable"),i=$.extend(!0,{},e);i.type=t["variable-type"],"cell"===i.type?i.param=t.value:(i.value=t.value,i.param={},i.param.value=t.value),o.options.onChange(e,i),a("variable",i);}},"valid-type":"type1"});return a("value-control",h),p.click(function(t){var e=s("variable");n.remove(),o.tempDataStorage.removeById(r),0==o.$variableList.find(".brtc-va-tools-sidebar-variable-deck").length&&o.renderEmptyControl(),o.options.onRemove(e),o.$variableList.perfectScrollbar("update"),t.stopPropagation();}),l.val(e.type),this.setVariableName(u,e.name),h.setInputValue(e.value),this.isRendered=!0,n;},e.prototype.renderValues=function(t){for(var e in this.isRendered=!1,this.empty(),t){this.createVariableControl(t[e]);}0===t.length&&this.renderEmptyControl(),this.configureOptions(),this.isRendered=!0;},e.prototype.empty=function(){this.$variableList.empty();},e.prototype.configureOptions=function(){this.configureFixedVariable();},e.prototype.configureFixedVariable=function(){this.options.isFixedVariable&&(this.$mainControl.find("input.add-variable-button").hide(),this.$mainControl.find(".brtc-va-tools-sidebar-variable-remove").hide());},e.prototype.getTargetByType=function(t,e){var i=_.isArray(e),o=["array[string]","array[number]"].indexOf(t)>=0;return i&&o?e:i||o?i&&!o?e[0]:[e]:e;},e.prototype.getValueByType=function(t,e){var i=this.getVarUtils();return({calculation:i.wrap,number:i.toNumber,string:i.toString,"array[string]":function arrayString(t){return _.map(t,i.toString);},"array[number]":function arrayNumber(t){return _.map(t,i.toNumber);}}[t]||function(t){return t;})(this.getTargetByType(t,e));},e.prototype.setValueByType=function(t,e){return({calculation:this.getVarUtils().strip}[t]||function(t){return t;})(e);},e.prototype.getVarUtils=function(){return t.VA.Core.Utils.VariableUtils;},e.prototype.getSource=function(){var t=[{label:"String",value:"string"},{label:"Number",value:"number"},{label:"Array String Value",value:"array[string]"},{label:"Array Number Value",value:"array[number]"},{label:"Calculation Value",value:"calculation"}];return this.options.isNormalType?t:t.concat([{label:"Cell",value:"cell"}]);},t.VA.Core.Views.SetVariable=e;}.call(this),function(t){var e=t.VA.Core.Views.Outline;function i(t){e.call(this,t);}i.prototype=_.create(e.prototype),i.prototype.constructor=i,i.prototype.onDoubleClickItem=function(t){var e=this.id2item[t],i=e.parent;"fn"===e.type?(this.editor.changeEditorContext(i.id,i.parent?i.parent.fn:void 0),this.editor.showFunctionProperty(e.id)):this.editor.changeEditorContext(e.id,i?i.fn:void 0);},i.prototype.getData=function(){var e=this,i=e.model,o=e.editor.getActiveModel(),n=e.editor.getActiveFnUnitOnProp()?e.editor.getActiveFnUnitOnProp().fid:void 0,r=t.VA.Core.Utils.NestedFlowUtils.getLocalOutline(i,o,n);e.id2item={};var a=function a(t){var i="fn"===t.type?t.fn.fid:t.model.mid,o=e.editor.getStatus(i),n={type:t.type,id:i,items:t.items.map(function(t){return a(t,i);})};return t.model?n.model=t.model:n.fn=t.fn,n.html=[crel("div",{class:"item-status",status:o&&o.status?o.status:"READY",title:o&&o.message?o.message:"",type:t.type}).outerHTML,crel("span",{class:[t.active?"active":"",t.selected?"underline":""].join(" "),title:t.label},t.label).outerHTML].join(""),n.items.forEach(function(t){t.parent=n;}),e.id2item[n.id]=n,n;};return[a(r)];},i.prototype.refresh=function(t,e){try{t?this.view.render[t](e):this.view.render.all();}catch(t){this.view.render.error(t);}},t.VA.Core.Views.LocalOutline=i;}(window.Brightics),function(t){var e=t.VA.Core.Views.Outline;function i(t){e.call(this,t);}i.prototype=_.create(e.prototype),i.prototype.constructor=i,i.prototype.onClickItem=function(t){},i.prototype.getData=function(){return[t.VA.Core.Utils.NestedFlowUtils.getGlobalOutline(this.projectId,this.model)];},t.VA.Core.Views.GlobalOutline=i;}(window.Brightics),function(){"use strict";var t=this;t.Brightics.VA.SettingStorage={getValue:function getValue(t){var e=this.DEFAULT_SETTINGS[t];return e="undefined"!=typeof Storage?null!==localStorage.getItem(t)?localStorage.getItem(t):e:void 0!==$.cookie(t)?$.cookie(t):e;},setValue:function setValue(t,e){"undefined"!=typeof Storage?localStorage.setItem(t,"object"==typeof e?JSON.stringify(e):e):$.cookie(t,"object"==typeof e?JSON.stringify(e):e);},setToDefault:function setToDefault(t){"undefined"!=typeof Storage?localStorage.removeItem(t):$.removeCookie(t);},clear:function clear(){if("undefined"!=typeof Storage)localStorage.clear();else for(var t in this.DEFAULT_SETTINGS){$.removeCookie(t);}}},t.Brightics.VA.SettingStorage.SETTINGS={},t.Brightics.VA.SettingStorage.DEFAULT_SETTINGS={"common.scroll.indicate.mouseover":"true","common.document.useonline":"false","common.document.onlinedocurl":"","common.persist.mode":"storage-mode","editor.diagram.autoconnect":"true","editor.minimap.visible":"true","editor.function.add.doubleclick":"true","editor.variable.visible":"true","editor.datapanel.chart.table.pivotsinglerow":"false","editor.datapanel.defaultrowcount":"1000","chart.table.formatter.use":"false","chart.table.formatter.double":"9","chart.table.formatter.integer":"0","chart.table.formatter.exponential":"2","chart.table.formatter.type":"number","chart.table.formatter.pivot":"false","editor.maxfuncnum":"120","chart.style.selectedColorSet":"Brightics","chart.style.colorSet":JSON.stringify([{name:"Brightics",colors:["#FD026C","#4682B8","#A5D22D","#F5CC0A","#FE8C01","#6B9494","#B97C46","#84ACD0","#C2E173","#F9DD5B","#FE569D","#FEB356","#9CB8B8","#D0A884","#2E6072","#6D8C1E","#A48806","#A90148","#A95E01","#476363","#7B532F"]},{name:"Rainbow",colors:["#FF0000","#FF9D00","#EEFF00","#34B545","#3E6DC4","#4B0082","#863DCC"]}])},function(){var e=t.Brightics.VA.SettingStorage,i=e.getValue("chart.table.formatter.number");i&&(e.setValue("chart.table.formatter.double",i),e.setValue("chart.table.formatter.integer",i),e.setToDefault("chart.table.formatter.number"));}();}.call(this),function(){"use strict";var t=this.Brightics,e={createInput:function createInput(e,i){var o=t.VA.SettingStorage.getValue(e),n=i.jqxInput({theme:t.VA.Env.Theme});return i.jqxInput("val",o),{id:e,$control:n};}};t.VA.Setting.Widget=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.init(),this.createContents(t),this.applyPreferenceSettings(),this.render();}e.prototype.init=function(){t.VA.SettingStorage.TEMP=t.VA.SettingStorage.TEMP||{},this.controlList=[],this.initSettingId();},e.prototype.initPerfectScrollbar=function(){this.$mainControl.perfectScrollbar();},e.prototype.initSettingId=function(t){},e.prototype.createContents=function(t){this.$mainControl=$('<div class="brtc-va-setting-container"/>'),t.append(this.$mainControl);},e.prototype.getValue=function(e){return void 0===t.VA.SettingStorage.TEMP[e]?t.VA.SettingStorage.getValue(e):t.VA.SettingStorage.TEMP[e];},e.prototype.changeValue=function(e,i){t.VA.SettingStorage.TEMP[e]="object"==typeof i?JSON.stringify(i):""+i;},e.prototype.render=function(){},e.prototype.save=function(){for(var e in t.VA.SettingStorage.TEMP){t.VA.SettingStorage.setValue(e,t.VA.SettingStorage.TEMP[e]);}},e.prototype._createCheckBox=function(e,i){var o=i.settingId,n=i.label,r=i.tagList||[],a=$('<div class="brtc-va-setting-component-wrapper">   <div class="'+this._parseSettingIdToClassName(o)+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-va-setting-checkbox-content"></div>       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1"></div>   </div></div>');a.find(".brtc-va-setting-checkbox-label").text(n),a.find(".brtc-va-setting-checkbox-content").jqxCheckBox({theme:t.VA.Env.Theme}),e.append(a),r&&r.length>0&&this._createEditorTagList(e,r);var s=this;return a.on("change",function(t){var e=t.args.checked;s.changeValue(o,e);}),this.controlList.push(a),a;},e.prototype._parseSettingIdToClassName=function(t){return t?"brtc-va-setting-"+t.replace(/[.]/gi,"-"):"brtc-va-setting-"+t;},e.prototype._createEditorTagList=function(e,i){var o=this,n=$('<div class = "brtc-va-setting-editor-label-group"/>');e.append(n),Object.keys(t.VA.Core.Interface.Label).forEach(function(e){var r=$.inArray(e,i)>-1;o._createEditorTag(n,t.VA.Core.Interface.Label[e],r);});},e.prototype._createEditorTag=function(t,e,i){var o=$('<button class = "brtc-va-setting-editor-label">'+e+"</button>");i&&(o.addClass("apply"),o.jqxButton({theme:"Web"}),o.css("font-size","8px"),t.append(o));},e.prototype._createSplitBar=function(t){var e=$('<div class="brtc-va-setting-splitbar"></div>');t.append(e);},e.prototype._createDropDownList=function(e,i){var o=i.settingId,n=i.label,r=i.list,a=i.tagList||[],s=i.width||100,l=i.dropDownHeight,c=$('<div class="brtc-va-setting-component-wrapper">   <div class="'+this._parseSettingIdToClassName(o)+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-va-setting-dropdownlist-label brtc-style-setting-label"/>       <div class="brtc-va-setting-dropdownlist-content"></div>   </div></div>');e.append(c),c.find(".brtc-va-setting-dropdownlist-label").text(n);var d=e.closest(".brtc-va-dialogs-body").find(".brtc-va-dialogs-buttonbar-ok").offset().top-c.find(".brtc-va-setting-dropdownlist-content").offset().top-25;d-=d%25,(d=void 0===l?d||100:l||100)>100&&(d=100);var p=c.find(".brtc-va-setting-dropdownlist-content").jqxDropDownList({theme:t.VA.Env.Theme,source:r,width:s,dropDownHeight:d});a&&a.length>0&&this._createEditorTagList(e,a);var u=this;return c.on("change",function(t){var e=t.args.item.value;u.changeValue(o,e);}),e.closest(".ps-container").on("scroll",function(){null!=p&&p.jqxDropDownList("close");}),this.controlList.push(c),c;},e.prototype._createNumericInput=function(e,i){return t.VA.Core.Widget.Factory.numericInputControl(e,i);},e.prototype.getSettingId=function(t){return this.SettingId[t];},e.prototype.applySetting=function(){},e.prototype.applyPreferenceSettings=function(){},t.VA.Setting.BaseSetting=e,t.VA.Setting.CONST={KEY_DELIMITER:"."};}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("crel"),i=function i(){0;};function o(e,i){t.VA.Setting.BaseSetting.call(this,e,i);}o.prototype=Object.create(t.VA.Setting.BaseSetting.prototype),o.prototype.constructor=o,o.prototype.initSettingId=function(t){this.SettingId={use:"chart.table.formatter.use",double:"chart.table.formatter.double",integer:"chart.table.formatter.integer",exponential:"chart.table.formatter.exponential",type:"chart.table.formatter.type",pivot:"chart.table.formatter.pivot",selectedPalette:"chart.style.selectedColorSet",palette:"chart.style.colorSet"};},o.prototype.createContents=function(e){t.VA.Setting.BaseSetting.prototype.createContents.call(this,e),this.createFormatterControl(),this.createSingleRowPivotControl(),this.createCustomColorPalettes();},o.prototype.createFormatterControl=function(){var _this18=this;var e=this,i=$('<div class="brtc-va-setting-component-wrapper">   <div class="'+this._parseSettingIdToClassName(this.getSettingId("use"))+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-va-setting-checkbox-content use"></div>       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1">Use default table format  (will be applied after screen refresh)</div>   </div>   <div class="'+this._parseSettingIdToClassName(this.getSettingId("number"))+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-style-display-none" brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">           <div class="brtc-va-setting-input-content-label">Integer</div>           <div class="brtc-va-setting-input-content number integer"></div>       </div>       <div class="brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">           <div class="brtc-va-setting-input-content-label">Number</div>           <div class="brtc-va-setting-input-content number double"></div>       </div>   </div></div>');this.$mainControl.append(i),this.$useControl=i.find(".brtc-va-setting-checkbox-content.use"),this.$useControl.jqxCheckBox({theme:t.VA.Env.Theme});var _map2=[".brtc-va-setting-input-content.double",".brtc-va-setting-input-content.integer"].map(function(t){return i.find(t);}),o=_map2[0],n=_map2[1];var _map3=[o,n].map(function(t){return _this18._createNumericInput(t,{numberType:"int",min:0,max:10,minus:!1,placeholder:"Enter value"});});this.numberControl=_map3[0];this.integerControl=_map3[1];var r=[this.numberControl,this.integerControl],a=_.zip(["double","integer"],r);this.$useControl.on("change",function(e){var i=e.args.checked;r.forEach(function(t){return t.setDisabled(!i);}),i||t.Chart.Helper.PreferenceUtils.clearTableFormatter(),_this18.changeValue(_this18.getSettingId("use"),i),i&&a.forEach(function(_ref22){var t=_ref22[0],e=_ref22[1];_this18.changeValue(_this18.getSettingId(t),e.getValue());});}),a.forEach(function(_ref23){var i=_ref23[0],o=_ref23[1];o.onChange(function(){var n=o.getValue();t.Chart.Helper.PreferenceUtils.setTableFormatter([{type:i,digit:3}]),e.changeValue(e.getSettingId(i),n);});}),this._createEditorTagList(this.$mainControl,["data","visual"]),this.controlList.push(i);},o.prototype.createSingleRowPivotControl=function(e){var i=this,o=$('<div class="brtc-va-setting-component-wrapper">   <div class="'+this._parseSettingIdToClassName(this.getSettingId("pivot"))+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-va-setting-checkbox-content pivot"></div>       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1"> Pivot single-row table (will be applied after screen refresh)</div></div>');this.$mainControl.append(o),this.$pivotControl=o.find(".brtc-va-setting-checkbox-content.pivot"),this.$pivotControl.jqxCheckBox({theme:t.VA.Env.Theme}),this.$pivotControl.on("change",function(e){var o=e.args.checked;o?t.Chart.Helper.PreferenceUtils.setTableFormatter([{pivot:"true"}]):t.Chart.Helper.PreferenceUtils.setTableFormatter([{pivot:"false"}]),i.changeValue(i.getSettingId("pivot"),o);});},o.prototype.createCustomColorPalettes=function(){var i="brtc-va-setting-component-palette__item",o="brtc-va-setting-component-palette__button",n=$('<div class="brtc-va-setting-component-wrapper" style="margin-top: 20px;">   <div class="'+this._parseSettingIdToClassName(this.getSettingId("palette"))+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1"> Configure custom color palettes. </div>       <div class="brtc-va-setting-checkbox-content colors"></div></div>'),r=this.getPlatteStateStore(),a=$(e("div",{class:"brtc-va-setting-component-palette__button-wrapper"})),s=$(e("div",{class:"brtc-va-setting-component-palette__selecor"})),l=$(e("div",{class:o},"Save")),c=$(e("div",{class:o},"Save As")),d=$(e("div",{class:o},"Reset")),p=$(e("div",{class:o},"Delete")),u=$(e("div",{class:o},"Ok")).jqxButton({theme:t.VA.Env.Theme}),h=$(e("div",{class:o},"Cancel")).jqxButton({theme:t.VA.Env.Theme}),f=$(e("input",{class:"brtc-va-setting-component-palette__input",maxLength:80})),m=$(e("div",{class:"brtc-va-setting-component-palette__wrapper"}));a.append(s,f,l,c,d,p,u,h),s.on("change",function(e){-1!==e.args.index&&function(e){var i=e.args.index;if(i!==r.get("index")){var o=r.get("dirty");!function(t){r.dispatch({type:"paletteSelected",index:t});}(i),o?t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Are you sure you want to change palette?",function(t){t.OK||r.undo(),y();}):y();}}(e);}),f.keyup(function(t){t.target.value!==r.get("input")&&(r.dispatch({type:"inputChanged",input:t.target.value}),g());}),l.on("click",function(t){t.target.disabled||(r.dispatch({type:"saveClicked"}),g(),v());}),c.on("click",function(t){t.target.disabled||(r.dispatch({type:"saveAsClicked"}),y());}),d.on("click",function(t){t.target.disabled||(r.dispatch({type:"resetClicked"}),g(),b());}),p.on("click",function(t){t.target.disabled||(r.dispatch({type:"deleteClicked"}),y());}),u.on("click",function(t){t.target.disabled||(r.dispatch({type:"saveOkClicked"}),y());}),h.on("click",function(t){t.target.disabled||(r.dispatch({type:"cancelClicked"}),y());});var g=function g(){l.jqxButton({disabled:r.get("saveDisabled"),theme:t.VA.Env.Theme}),c.jqxButton({disabled:r.get("saveAsDisabled"),theme:t.VA.Env.Theme}),p.jqxButton({disabled:r.get("deleteDisabled"),theme:t.VA.Env.Theme}),u.jqxButton({disabled:!r.get("canSaveAs"),theme:t.VA.Env.Theme}),d.jqxButton({disabled:r.get("resetDisabled"),theme:t.VA.Env.Theme}),l.toggle(!r.get("inputActive")),c.toggle(!r.get("inputActive")),p.toggle(!r.get("inputActive")),d.toggle(!r.get("inputActive")),u.toggle(r.get("inputActive")),h.toggle(r.get("inputActive")),f.jqxInput({value:r.get("input"),width:150}),f.toggle(r.get("inputActive"));},v=function v(){s.jqxDropDownList({source:r.get("colorSet").map(function(t){return _.escape(t.name);}),selectedIndex:r.get("index"),theme:t.VA.Env.Theme,width:150}),s.toggle(!r.get("inputActive"));};m.on("click",function(e){if(!r.get("inputActive")&&e.target.classList.contains(i)){var o=parseInt(e.target.getAttribute("palette-index"),10),n=e.target.getAttribute("palette-color");new t.Chart.Adonis.Component.Dialogs.ColorPickerDialog($(e.target),{windowPosition:"bottom",close:function close(t){var i=function i(t){return t>=10?String.fromCharCode(t-10+"A".charCodeAt(0)):t.toString();};var a=(s=t,"#"+["r","g","b"].map(function(t){var e=parseInt(s[t],10);return[parseInt(e/16,10),e%16].map(i).join("");}).join(""));var s;a!==n&&(r.dispatch({type:"paletteChanged",index:o,color:a}),$(e.target).css("background-color",a),e.target.setAttribute("palette-color",a),g());},color:n});}});var b=function b(){var t=r.get("tempPalette");m.empty(),r.get("inputActive")?m.addClass("saving"):m.removeClass("saving"),m.append(t.map(function(t,o){var n=$(e("div",{class:i}));return n.css("background-color",t),n.attr("palette-index",o),n.attr("palette-color",t),n;})),m.perfectScrollbar(),m.perfectScrollbar("update");},y=function y(){v(),g(),b();};y(),n.append(a,m),this.$mainControl.append(n);},o.prototype.render=function(){this.renderNumberControl(),this.renderUseControl(),this.renderPivotControl();},o.prototype.getPlatteStateStore=function(){var t,e,o,n,r,a,s,l=this;return t=JSON.parse(l.getValue(l.getSettingId("palette"))),e=l.getValue(l.getSettingId("selectedPalette")),o=t.findIndex(function(t){return t.name===e;}),n={inputActive:!1,input:"",colorSet:t,index:o,dirty:!1,tempPalette:t[o].colors.slice()},r=[],a={deleteDisabled:function deleteDisabled(){return a.isDefaultPalette();},paletteDisabled:function paletteDisabled(){return n.inputActive;},saveDisabled:function saveDisabled(){return!n.dirty||a.isDefaultPalette();},saveAsDisabled:function saveAsDisabled(){return!1;},resetDisabled:function resetDisabled(){return!n.dirty;},currentPalette:function currentPalette(){return n.colorSet[n.index];},canSaveAs:function canSaveAs(){return 0===n.colorSet.filter(function(t){return t.name===n.input;}).length;},isDefaultPalette:function isDefaultPalette(){return n.index<2;}},{dispatch:function dispatch(t){for(r.push(n),n=_.merge({},n,function(t,e){switch(i("[REDUCER]",e.type,e),i("   before: ",t),e.type){case"saveAsClicked":return{inputActive:!0,input:a.currentPalette().name};case"saveClicked":return s("saveDisabled")?{}:{inputActive:!1,colorSet:t.colorSet.map(function(e,i){return i===t.index?{name:e.name,colors:t.tempPalette.slice()}:e;}),dirty:!1};case"deleteClicked":var o=t.colorSet.filter(function(e,i){return i!==t.index;}),n=Math.min(t.index,o.length-1);return{colorSet:o,index:n,dity:!1,tempPalette:o[n].colors.slice()};case"paletteSelected":return t.index===e.index?{}:{index:e.index,tempPalette:t.colorSet[e.index].colors.slice(),dirty:!1};case"paletteChanged":return{tempPalette:t.tempPalette.map(function(t,i){return i===e.index?e.color:t;}).slice(),dirty:!0};case"cancelClicked":return{inputActive:!1};case"inputChanged":return{input:e.input};case"resetClicked":return{tempPalette:a.currentPalette().colors.slice(),dirty:!1};case"saveOkClicked":var r=t.colorSet.concat([{name:t.input,colors:t.tempPalette.slice()}]);return{inputActive:!1,index:r.length-1,colorSet:r,dirty:!1};default:throw new Error("unexpected action");}}(n,t),function(t,e){if(Array.isArray(e))return e;});r.length>5;){r.shift();}i("   after: ",n),l.changeValue(l.getSettingId("palette"),n.colorSet),l.changeValue(l.getSettingId("selectedPalette"),a.currentPalette().name);},get:s=function s(t){if(void 0!==t){if(void 0!==n[t])return n[t];if("function"==typeof a[t])return a[t]();throw new Error("unexpected state key");}return n;},undo:function undo(){if(0===r.length)throw new Error("cannot undo");i("[UNDO]"),i("    before: ",n),n=Object.assign({},r.pop()),i("    after: ",n),l.changeValue(l.getSettingId("palette"),n.colorSet),l.changeValue(l.getSettingId("selectedPalette"),a.currentPalette().name);}};},o.prototype.renderUseControl=function(){this.$useControl.jqxCheckBox({checked:"true"==this.getValue(this.getSettingId("use"))}),"true"!=this.getValue(this.getSettingId("use"))&&[this.numberControl,this.integerControl].forEach(function(t){return t.setDisabled(!0);});},o.prototype.renderNumberControl=function(){this.numberControl.setValue(this.getValue(this.getSettingId("double"))),this.integerControl.setValue(this.getValue(this.getSettingId("integer")));},o.prototype.renderPivotControl=function(){this.$pivotControl.jqxCheckBox({checked:"true"==this.getValue(this.getSettingId("pivot"))});},o.prototype.getIndex=function(){return 3;},o.Key="setting-chart",o.Label="Chart",o.index=3,t.VA.Setting.Registry[o.Key]=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Setting.BaseSetting.call(this,e,i);}e.prototype=Object.create(t.VA.Setting.BaseSetting.prototype),e.prototype.constructor=e,e.prototype.initSettingId=function(t){this.SettingId={scrollBar:"common.scroll.indicate.mouseover",useOnline:"common.document.useonline",url:"common.document.onlinedocurl",urlDefault:"common.document.onlinedocurl.default"};},e.prototype.createContents=function(e){t.VA.Setting.BaseSetting.prototype.createContents.call(this,e),this.createScrollbarControl(),this.createDocumentControl();},e.prototype.createScrollbarControl=function(){this.$scrollbarControl=this._createCheckBox(this.$mainControl,{settingId:this.getSettingId("scrollBar"),label:"Show scroll bar only when the mouse is over on scrollable area. (Show always when unchecked)"});},e.prototype.createDocumentControl=function(){var e=this,i=$('<div class="brtc-va-setting-component-wrapper">   <div class="'+this._parseSettingIdToClassName(this.getSettingId("useOnline"))+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-va-setting-checkbox-content use"></div>       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1">Use on-line help document (※ The prefix "http://" is required.)</div>   </div>   <div class="'+this._parseSettingIdToClassName(this.getSettingId("url"))+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-va-setting-input-content-label">URL</div>       <input class="brtc-va-setting-input-content link" type="text">   </div>   <div class="brtc-va-setting-input-content-validation-tooltip-wrapper">       <div class="brtc-va-setting-input-content-validation-tooltip">       </div>   </div></div>');this.$mainControl.append(i),this.$useControl=i.find(".brtc-va-setting-checkbox-content.use"),this.$useControl.jqxCheckBox({theme:t.VA.Env.Theme}),this.$linkControl=i.find(".brtc-va-setting-input-content.link").jqxInput({theme:t.VA.Env.Theme,placeHolder:e.getValue(e.getSettingId("urlDefault")),height:25,width:"100%"}),this.$useControl.on("change",function(t){var i=t.args.checked;i?e.$linkControl.jqxInput({disabled:!1}):e.$linkControl.jqxInput({disabled:!0}),e.changeValue(e.getSettingId("useOnline"),i),e.renderMessage(e.validateUrl(e.getValue(e.getSettingId("url"))));}),this.$linkControl.on("change",function(){var t=$(this).val();e.changeValue(e.getSettingId("url"),t),e.renderMessage(e.validateUrl(t));}),this.$validationWrapper=i.find(".brtc-va-setting-input-content-validation-tooltip-wrapper"),this.$validation=i.find(".brtc-va-setting-input-content-validation-tooltip");},e.prototype.render=function(){this.renderScrollbarControl(),this.renderDocumentControl();},e.prototype.renderScrollbarControl=function(){this.$scrollbarControl.find(".brtc-va-setting-checkbox-content").jqxCheckBox({checked:"true"==this.getValue(this.getSettingId("scrollBar"))});},e.prototype.renderDocumentControl=function(){this.$useControl.jqxCheckBox({checked:"true"==this.getValue(this.getSettingId("useOnline"))}),"true"!=this.getValue(this.getSettingId("useOnline"))&&this.$linkControl.jqxInput({disabled:!0}),this.$linkControl.val(this.getValue(this.getSettingId("url")));},e.prototype.getIndex=function(){return 1;},e.prototype.validateUrl=function(){var t="true"===this.getValue(this.getSettingId("useOnline")),e=this.getValue(this.getSettingId("url")),i=this.getValue(this.getSettingId("urlDefault"));if(t){if(!e&&i)return"";if(!e&&!i)return"URL is not specified.";if(!_.startsWith(e,"http://"))return"URL must start with 'http://'.";}return"";},e.prototype.renderMessage=function(t){""===t||"true"!==this.getValue(this.getSettingId("useOnline"))?this.$validationWrapper.hide():(this.$validationWrapper.show(),this.$validation.html(t));},e.Key="setting-common",e.Label="Common",e.index=1,t.VA.Setting.Registry[e.Key]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Setting.BaseSetting.call(this,e,i);}e.prototype=Object.create(t.VA.Setting.BaseSetting.prototype),e.prototype.constructor=e,e.prototype.initSettingId=function(t){this.SettingId={autoConnect:"editor.diagram.autoconnect",minimap:"editor.minimap.visible",doubleClick:"editor.function.add.doubleclick",variable:"editor.variable.visible",dataCount:"editor.datapanel.defaultrowcount",useMaximum:"editor.useMaximum",maxFuncNum:"editor.maxfuncnum"};},e.prototype.createContents=function(e){t.VA.Setting.BaseSetting.prototype.createContents.call(this,e),this.createAutoConnectControl(),this.createMinimapControl(),this.createDoubleClickControl(),this.createVariableControl(),this.createDataCountControl(),this.createMaxFuncControl();},e.prototype.createAutoConnectControl=function(t){this.$autoConnectControl=this._createCheckBox(this.$mainControl,{settingId:this.getSettingId("autoConnect"),label:"Link adjacent function(s) automatically.",tagList:["data"]});},e.prototype.createMinimapControl=function(t){this.$minimapControl=this._createCheckBox(this.$mainControl,{settingId:this.getSettingId("minimap"),label:"Show mini map when open a editor.",tagList:["data","realtime","deeplearning"]});},e.prototype.createDoubleClickControl=function(e){var i=this;this.$doubleClickControl=$(crel("div",{class:"brtc-va-setting-component-wrapper"},"Change operation to add function.")),this.$mainControl.append(this.$doubleClickControl);var o=$(crel("div",{class:"brtc-va-editors-sheet-controls-radiobutton-default doubleclick",style:"margin-left: 10px"},"Use double click to add function."));this.$doubleClickControl.append(o),o.jqxRadioButton({theme:t.VA.Env.Theme});var n=$(crel("div",{class:"brtc-va-editors-sheet-controls-radiobutton-default click",style:"margin-left: 10px"},"Use click to add function."));this.$doubleClickControl.append(n),n.jqxRadioButton({theme:t.VA.Env.Theme}),this._createEditorTagList(this.$doubleClickControl,["data","realtime","deeplearning"]),o.on("change",function(t){var e=t.args.checked;i.changeValue(i.getSettingId("doubleClick"),e);});},e.prototype.createVariableControl=function(t){this.$variableControl=this._createCheckBox(this.$mainControl,{settingId:this.getSettingId("variable"),label:"Use variable before running.",tagList:["data","control","realtime"]});},e.prototype.createDataCountControl=function(t){this.$dataCountControl=this._createDropDownList(this.$mainControl,{settingId:this.getSettingId("dataCount"),label:"Default number of rows to show in data panel",width:100,list:["1000","3000","5000","10000","50000"],tagList:["data","realtime"],dropDownHeight:100});},e.prototype.createMaxFuncControl=function(e){var i=this,o=$('<div class="brtc-va-setting-component-wrapper">   <div class="'+this._parseSettingIdToClassName(this.getSettingId("useMaximum"))+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center">       <div class="brtc-va-setting-checkbox-content useMaximum"></div>       <div class="brtc-va-setting-checkbox-label brtc-style-setting-label brtc-style-flex-1"> Set maximum number of functions on editor.</div>   </div>   <div class="'+this._parseSettingIdToClassName(this.getSettingId("maxFuncNum"))+' brtc-va-setting-component brtc-style-display-flex brtc-style-align-items-center" style="margin-left:  30px;">       <div class="brtc-va-setting-input-content-label">Number</div>       <div class="brtc-va-setting-input-content number"></div>   </div></div>');this.$mainControl.append(o),this.$useControl=o.find(".brtc-va-setting-checkbox-content.useMaximum"),this.$useControl.jqxCheckBox({theme:t.VA.Env.Theme});var n=o.find(".brtc-va-setting-input-content.number");this.numberControl=this._createNumericInput(n,{numberType:"int",min:1,max:120,minus:!1,placeholder:"60"}),this.$useControl.on("change",function(t){var e=t.args.checked;e?i.numberControl.setDisabled(!1):(i.numberControl.$mainControl.val("60"),i.numberControl.setDisabled(!e),i.changeValue(i.getSettingId("maxFuncNum"),60)),i.changeValue(i.getSettingId("useMaximum"),e);}),this.numberControl.onChange(function(){var t=i.numberControl.getValue();i.changeValue(i.getSettingId("maxFuncNum"),t);}),this._createEditorTagList(this.$mainControl,["data"]),this.controlList.push(o);},e.prototype.render=function(){this.renderAutoConnectControl(),this.renderMinimapControl(),this.renderDoubleClickControl(),this.renderVariableControl(),this.renderDataCountControl(),this.renderMaxFuncControl();},e.prototype.renderAutoConnectControl=function(){this.$autoConnectControl.find(".brtc-va-setting-checkbox-content").jqxCheckBox({checked:"true"==this.getValue(this.getSettingId("autoConnect"))});},e.prototype.renderMinimapControl=function(){this.$minimapControl.find(".brtc-va-setting-checkbox-content").jqxCheckBox({checked:"true"==this.getValue(this.getSettingId("minimap"))});},e.prototype.renderDoubleClickControl=function(){var t=this.getValue(this.getSettingId("doubleClick"));this.$doubleClickControl.find(".brtc-va-editors-sheet-controls-radiobutton-default.click").jqxRadioButton({checked:"false"==t}),this.$doubleClickControl.find(".brtc-va-editors-sheet-controls-radiobutton-default.doubleclick").jqxRadioButton({checked:"true"==t});},e.prototype.renderVariableControl=function(){this.$variableControl.find(".brtc-va-setting-checkbox-content").jqxCheckBox({checked:"true"==this.getValue(this.getSettingId("variable"))});},e.prototype.renderDataCountControl=function(){this.$dataCountControl.find(".brtc-va-setting-dropdownlist-content").jqxDropDownList("selectItem",this.getValue(this.getSettingId("dataCount")));},e.prototype.renderMaxFuncControl=function(){this.renderNumberControl(),this.renderUseControl();},e.prototype.renderNumberControl=function(){this.numberControl.setValue(this.getValue(this.getSettingId("maxFuncNum")));},e.prototype.renderUseControl=function(){this.$useControl.jqxCheckBox({checked:"true"==this.getValue(this.getSettingId("useMaximum"))}),"true"!=this.getValue(this.getSettingId("useMaximum"))&&this.numberControl.setDisabled(!0);},e.prototype.getIndex=function(){return 2;},e.prototype.applyPreferenceSettings=function(){this.$mainControl.closest(".brtc-va-dialogs-content-panel").perfectScrollbar("update");},e.Key="setting-editor",e.Label="Editor",e.index=2,t.VA.Setting.Registry[e.Key]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.init(),this.customPreference=t;}e.prototype.init=function(){for(var e in this.preferenceMap={},t.VA.Setting.Registry){t.VA.Preference[e]&&(this.preferenceMap[e]=new t.VA.Preference[e](this.customPreference));}this.applySetting();},e.prototype.applySetting=function(){for(var t in this.preferenceMap){this.preferenceMap[t].applySetting();}},e.prototype.preferenceChanged=function(){this.applySetting();},t.VA.Preference=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.storageMap={table:{number:"chart.table.formatter.number",double:"chart.table.formatter.double",integer:"chart.table.formatter.integer",use:"chart.table.formatter.use",pivot:"chart.table.formatter.pivot"},color:{selectedPalette:"chart.style.selectedColorSet",palette:"chart.style.colorSet"}},this.customPreference=t;}e.prototype.applySetting=function(){this.storage=this.customPreference?this.customPreference:localStorage,this.applyNumber(),this.applyPivot(),this.applyCustomColorPalettes();},e.prototype.applyNumber=function(){var _this19=this;if("true"===this.storage[this.storageMap.table.use]){var e=["double","integer"].map(function(t){return{type:t,digit:_this19.storage[_this19.storageMap.table[t]]};});t.Chart.Helper.PreferenceUtils.setTableFormatter(e);}else t.Chart.Helper.PreferenceUtils.clearTableFormatter();},e.prototype.applyPivot=function(){var e=[{pivot:this.storage[this.storageMap.table.pivot]}];t.Chart.Helper.PreferenceUtils.setTableFormatter(e);},e.prototype.applyCustomColorPalettes=function(){var e=function e(_e4,i){return void 0!==_e4[i]?_e4[i]:t.VA.SettingStorage.DEFAULT_SETTINGS[i];},i=e(this.storage,this.storageMap.color.selectedPalette),o=JSON.parse(e(this.storage,this.storageMap.color.palette));t.Chart.Adonis.Preference.setColorPalette(i,o);},t.VA.Preference["setting-chart"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.storageMap={common:{scroll:"common.scroll.indicate.mouseover"}},this.customPreference=t;}e.prototype.applySetting=function(){this.storage=this.customPreference?this.customPreference:localStorage,this.applyScroll();},e.prototype.applyScroll=function(){"false"===this.storage[this.storageMap.common.scroll]?$("body").addClass("scroll-always"):$("body").removeClass("scroll-always");},t.VA.Preference["setting-common"]=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Validator.BaseValidator.call(this);}e.prototype=Object.create(t.VA.Core.Validator.BaseValidator.prototype),e.prototype.constructor=e,e.prototype.initRules=function(){},e.prototype.createProblem=function(t){return{level:this.problemFactory.rule[t.errorCode].level,param:t.param,paramIndex:t.paramIndex,code:t.errorCode,message:this.problemFactory.makeMessage(t)};},e.prototype.getSchema=function(t){var e=[];return this.options.dataProxy.requestSchema(t[IN_DATA][0],function(t){e=t.columns;}),e;},t.VA.Core.Validator.StepValidator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Validator.StepValidator.call(this),this.PARAM_SELECT="select";}e.prototype=Object.create(t.VA.Core.Validator.StepValidator.prototype),e.prototype.constructor=e,e.prototype.initRules=function(){t.VA.Core.Validator.StepValidator.prototype.initRules.call(this),this.addRule(this.emptyNewColumnAndValue);},e.prototype.emptyNewColumnAndValue=function(t){var e=[];if(void 0===t.param[this.PARAM_SELECT])return e.push(this.createProblem({errorCode:"BR-0033",paramIndex:key,param:"New column name",messageParam:["New column name","Value"]})),e;var i=[],o=t.param[this.PARAM_SELECT].split("\n");o[0].startsWith("*")&&o.splice(0,1);for(var n=0;n<o.length;n++){var r=o[n].lastIndexOf(" as "),a=o[n].substring(0,r).trim(),s=o[n].substring(r+4).trim();if(","==s.slice(-1)&&(s=s.substring(0,s.length-1)),""===s)e.push(this.createProblem({errorCode:"BR-0033",paramIndex:n,param:"New column name",messageParam:["New column name"]}));else if($.inArray(s,i)>-1){var l="New column name(s) - '"+s+"' already exist.";e.push(this.createProblem({errorCode:"BR-0100",paramIndex:n,param:"New column name",messageParam:[l]}));}else""===a&&e.push(this.createProblem({errorCode:"BR-0033",paramIndex:n,param:"Value",messageParam:["Value"]})),i.push(s);}return e;},t.VA.Core.Validator.AddColumnValidator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.parentId=e,this.options=i,this.dialogResult={OK:!1,Cancel:!0,FnUnit:{}},this.problemFactory=new t.VA.Core.Validator.ProblemFactory(),this.problems=[],this.resultFnUnit={},this.DEFAULT_SCRIPT="from pandasql import sqldf\npysqldf = lambda q: sqldf(q, globals())\ndata = inputs[0]\nresult = pysqldf('SELECT ${SELECT_SQL} FROM data ${ADDITIONAL_QUERY}')",this.DEFAULT_FN_UNIT={fid:"",func:"",name:"SQLExecutor",inData:[],outData:[],param:{select:"","additional-query":""},display:{label:""}},this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.getTitle=function(){return"";},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />       </div>   </div></div>'),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel");var e={theme:t.VA.Env.Theme,title:this.getTitle(),width:600,height:500,maxWidth:600,maxHeight:500,modal:!0,resizable:!1,close:this.destroy.bind(this)};this.$mainControl.dialog(e),this.$mainControl.find(".brtc-va-refine-step-header-help").css("display","none"),this.$mainControl.find(".brtc-va-refine-step-header-help").click(function(){window.open("api/va/v2/help/function/sqlfunctionhelp","SQL Function Help").blur();});},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.handleOkClicked.bind(this)),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme}),this.$cancelButton.click(this.handleCancelClicked.bind(this));},e.prototype.destroy=function(){this.$mainControl.dialog("destroy"),"function"==typeof this.options.close&&this.options.close(this.dialogResult);},e.prototype.destroyColumnSelector=function(){var t=$(".brtc-va-editors-sheet-controls-columnselector-editarea");t.length>0&&(t.dialog("close"),t.dialog("destroy"));},e.prototype.createDialogContentsArea=function(t){},e.prototype.handleOkClicked=function(){this.dialogResult.OK=!0,this.dialogResult.Cancel=!1,this.dialogResult.force=this.options.force,this.dialogResult.FnUnit=this.resultFnUnit,this.$mainControl.dialog("close");},e.prototype.handleCancelClicked=function(){this.dialogResult.OK=!1,this.dialogResult.Cancel=!0,this.dialogResult.force=this.options.force,this.$mainControl.dialog("close");},e.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');t.wrap(e);},e.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},e.prototype.addCssToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.css(e);}},e.prototype.createColumnList=function(e,i,o,n){this.wrapControl(e);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(e,r),this.addCssToWrapper(e,n);var a={multiple:!0,rowCount:1,maxRowCount:5,expand:!1,sort:"none",sortBy:"name",showOpener:"button",removable:!0,defaultType:"-",changed:function changed(t,e){},added:function added(){},removed:function removed(){}};return i&&$.extend(a,i),new t.VA.Core.Editors.Sheet.Controls.ColumnList(e,a);},e.prototype.createButton=function(e,i,o,n){this.wrapControl(e);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(e,r),this.addCssToWrapper(e,n);var a={theme:t.VA.Env.Theme};i&&$.extend(a,i),e.jqxButton(a);},e.prototype.createSQLExecutor=function(t,e,i,o){this.dialogResult.FnUnit=this.resultFnUnit;},e.prototype.addProblem=function(t){this.problems.push(t);},e.prototype.checkValidation=function(){},e.prototype.createValidationContent=function(e,i,o){var n=$('<div class="brtc-va-refine-step-validation-tooltip"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> '+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i.message)+"</div>");e.append(n),o?o.addClass("brtc-va-refine-step-validation-error"):e.addClass("brtc-va-refine-step-validation-error"),n.show();},e.prototype.removeValidation=function(){this.$mainControl.find(".brtc-va-refine-step-validation-error").removeClass("brtc-va-refine-step-validation-error"),this.$mainControl.find(".brtc-va-refine-step-validation-tooltip").remove(),this.problems=[];},e.prototype.createProblem=function(t,e){return{param:t.param,paramIndex:t.paramIndex,code:t.errorCode,message:this.problemFactory.makeMessage(t)};},e.prototype.sortableStopCallback={hideRemoveButton:function hideRemoveButton(t,e,i){for(var o=t.$mainControl.find("."+e),n=0;n<o.length;n++){0==n?$(o[n]).find("."+i).hide():$(o[n]).find("."+i).show();}}},e.prototype.sqlFunctionHelpContent=function(){return $('<div class="brtc-va-searcharea" style="float:right; position:fixed; right:10px"><input type="search" class="searchinput" placeholder="Search Key..."/></div><div style="font-family: "Lucida Grande", "Segoe UI", "Apple SD Gothic Neo", "Malgun Gothic", "Lucida Sans Unicode", Helvetica, Arial, sans-serif; font-size: 0.9em; overflow-x: hidden; overflow-y: auto; margin: 0px !important; padding: 5px 20px 26px !important; background-color: rgb(255, 255, 255);font-family: "Hiragino Sans GB", "Microsoft YaHei", STHeiti, SimSun, "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "Segoe UI", AppleSDGothicNeo-Medium, "Malgun Gothic", Verdana, Tahoma, sans-serif; padding: 20px;padding: 20px; font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", "Microsoft YaHei", STHeiti, SimSun, "Segoe UI", AppleSDGothicNeo-Medium, "Malgun Gothic", Arial, freesans, sans-serif; font-size: 15px; line-height: 1.6; -webkit-font-smoothing: antialiased; background: rgb(255, 255, 255);"><h1 id="sql-functions" style="clear: both;font-size: 2.2em; font-weight: bold; margin: 1.5em 0px 1em;margin-top: 0px;"><a name="sql-functions" href="#sql-functions" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>SQL Function Help</h1><h2 id="date-functions" style="clear: both;font-size: 1.8em; font-weight: bold; margin: 1.275em 0px 0.85em;border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(230, 230, 230); line-height: 1.6;"><a name="date-functions" href="#date-functions" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>Date Functions</h2><p style="margin-top: 0px;margin: 1em 0px; word-wrap: break-word;">The following built-in date functions are supported in hive.</p><table style="padding: 0px; border-collapse: collapse; border-spacing: 0px; margin-bottom: 16px;background-color: rgb(250, 250, 250);"><thead><tr><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Return Type</th><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Name(Signature)</th><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Example</th></tr></thead><tbody><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">from_unixtime(bigint unixtime[, string format])</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts the number of seconds from unix epoch (1970-01-01 00:00:00 UTC) to a string representing the timestamp of that moment in the current system time zone in the format of "1970-01-01 00:00:00"</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bigint</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">unix_timestamp()</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Gets current time stamp using the default time zone.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bigint</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">unix_timestamp(string date)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts time string in format yyyy-MM-dd HH:mm:ss to Unix time stamp, return 0 if fail: unix_timestamp(??009-03-20 11:30:01?? = 1237573801</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bigint</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">unix_timestamp(string date, string pattern)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Convert time string with given pattern to Unix time stamp, return 0 if fail: unix_timestamp(??009-03-20?? ?�yyyy-MM-dd?? = 1237532400</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">to_date(string timestamp)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the date part of a timestamp string: to_date("1970-01-01 00:00:00") = "1970-01-01"</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">year(string date)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the year part of a date or a timestamp string: year("1970-01-01 00:00:00") = 1970, year("1970-01-01") = 1970</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">month(string date)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the month part of a date or a timestamp string: month("1970-11-01 00:00:00") = 11, month("1970-11-01") = 11</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">day(string date) dayofmonth(date)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return the day part of a date or a timestamp string: day("1970-11-01 00:00:00") = 1, day("1970-11-01") = 1</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">hour(string date)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the hour of the timestamp: hour(??009-07-30 12:58:59?? = 12, hour(??2:58:59?? = 12</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">minute(string date)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the minute of the timestamp</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">second(string date)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the second of the timestamp</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">weekofyear(string date)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return the week number of a timestamp string: weekofyear("1970-11-01 00:00:00") = 44, weekofyear("1970-11-01") = 44</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">datediff(string enddate, string startdate)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return the number of days from startdate to enddate: datediff(??009-03-01?? ??009-02-27?? = 2</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">date_add(string startdate, int days)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Add a number of days to startdate: date_add(??008-12-31?? 1) = ??009-01-01??/td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">date_sub(string startdate, int days)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Subtract a number of days to startdate: date_sub(??008-12-31?? 1) = ??008-12-30??/td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">timestamp</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">from_utc_timestamp(timestamp, string timezone)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Assumes given timestamp ist UTC and converts to given timezone (as of Hive 0.8.0)</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">timestamp</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">to_utc_timestamp(timestamp, string timezone)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Assumes given timestamp is in given timezone and converts to UTC (as of Hive 0.8.0)</td></tr></tbody></table><h2 id="mathematical-functions" style="clear: both;font-size: 1.8em; font-weight: bold; margin: 1.275em 0px 0.85em;border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(230, 230, 230); line-height: 1.6;">`<a name="mathematical-functions" href="#mathematical-functions" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>Mathematical Functions</h2><p style="margin-top: 0px;margin: 1em 0px; word-wrap: break-word;">The following built-in mathematical functions are supported in hive; most return NULL when the argument(s) are NULL:</p><table style="padding: 0px; border-collapse: collapse; border-spacing: 0px; margin-bottom: 16px;background-color: rgb(250, 250, 250);"><thead><tr><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Return Type</th><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Name(Signature)</th><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Example</th></tr></thead><tbody><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">BIGINT</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">round(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the rounded BIGINT value of the double</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">DOUBLE</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">round(double a, int d)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the double rounded to d decimal places</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">BIGINT</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">floor(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the maximum BIGINT value that is equal or less than the double</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">BIGINT</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ceil(double a), ceiling(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the minimum BIGINT value that is equal or greater than the double</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">rand(), rand(int seed)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns a random number (that changes from row to row) that is distributed uniformly from 0 to 1. Specifiying the seed will make sure the generated random number sequence is deterministic.</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">exp(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns e<sup style="margin-top: 0px;margin-bottom: 0px;">a</sup> where e is the base of the natural logarithm</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ln(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the natural logarithm of the argument</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">log10(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the base-10 logarithm of the argument</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">log2(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the base-2 logarithm of the argument</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">log(double base, double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return the base "base" logarithm of the argument</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">pow(double a, double p), power(double a, double p)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return a<sup style="margin-top: 0px;margin-bottom: 0px;">p</sup></td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sqrt(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the square root of a</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bin(BIGINT a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the number in binary format</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">hex(BIGINT a) hex(string a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">If the argument is an int, hex returns the number as a string in hex format. Otherwise if the number is a string, it converts each character into its hex representation and returns the resulting string.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">unhex(string a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Inverse of hex. Interprets each pair of characters as a hexidecimal number and converts to the character represented by the number.</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">conv(BIGINT num, int from_base, int to_base), conv(STRING num, int from_base, int to_base)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts a number from a given base to another</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">abs(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the absolute value</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">pmod(int a, int b) pmod(double a, double b)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the positive value of a mod b</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sin(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the sine of a (a is in radians)</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">asin(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the arc sin of x if -1&lt;=a&lt;=1 or null otherwise</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">cos(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the cosine of a (a is in radians)</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">acos(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the arc cosine of x if -1&lt;=a&lt;=1 or null otherwise</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">tan(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">tan(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the tangent of a (a is in radians)</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">atan(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the arctangent of a</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">degrees(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts value of a from radians to degrees</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">radians(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Converts value of a from degrees to radians</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">positive(int a), positive(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns a</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">negative(int a), negative(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns -a</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">float</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sign(double a)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the sign of a as ??.0??or ??1.0??/td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">e()</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the value of e</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">pi()</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the value of pi</td></tr></tbody></table><h2 id="string-functions" style="clear: both;font-size: 1.8em; font-weight: bold; margin: 1.275em 0px 0.85em;border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(230, 230, 230); line-height: 1.6;"><a name="string-functions" href="#string-functions" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>String Functions</h2><p style="margin-top: 0px;margin: 1em 0px; word-wrap: break-word;">The following are built-in String functions are supported in hive</p><table style="padding: 0px; border-collapse: collapse; border-spacing: 0px; margin-bottom: 16px;background-color: rgb(250, 250, 250);"><thead><tr><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Return Type</th><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Name(Signature)</th><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Example</th></tr></thead><tbody><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ascii(string str)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the numeric value of the first character of str</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">concat(string, string)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string or bytes resulting from concatenating the strings or bytes passed in as parameters in order. e.g. concat(?�foo?? ?�bar?? results in ?�foobar?? Note that this function can take any number of input strings.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array&lt;struct&lt;string,double&gt;&gt;</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">context_ngrams(array&lt;array&gt;, array, int K, int pf)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the top-k contextual N-grams from a set of tokenized sentences, given a string of "context". See StatisticsAndDataMining for more information.</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">concat_ws(string SEP, string A, string B??</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Like concat() above, but with custom separator SEP.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">concat_ws(string SEP, array)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Like concat_ws() above, but taking an array of strings. (as of Hive 0.9.0)</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">find_in_set(string str, string strList)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the first occurance of str in strList where strList is a comma-delimited string. Returns null if either argument is null. Returns 0 if the first argument contains any commas. e.g. find_in_set(?�ab?? ?�abc,b,ab,c,def?? returns 3</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">format_number(number x, int d)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Formats the number X to a format like ??,###,###.##?? rounded to D decimal places, and returns the result as a string. If D is 0, the result has no decimal point or fractional part. (as of Hive 0.10.0)</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">get_json_object(string json_string, string path)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Extract json object from a json string based on json path specified, and return json string of the extracted json object. It will return null if the input json string is invalid.NOTE: The json path can only have the characters [0-9a-z_], i.e., no upper-case or special characters. Also, the keys <em style="margin-top: 0px;margin-bottom: 0px;">cannot start with numbers.</em> This is due to restrictions on Hive column names.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">boolean</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">in_file(string str, string filename)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns true if the string str appears as an entire line in filename.</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">instr(string str, string substr)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the position of the first occurence of substr in str</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">length(string A)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the length of the string</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">int</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">locate(string substr, string str[, int pos])</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the position of the first occurrence of substr in str after position pos</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">lower(string A) lcase(string A)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);"></td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">lpad(string str, int len, string pad)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns str, left-padded with pad to a length of len</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ltrim(string A)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from trimming spaces from the beginning(left hand side) of A e.g. ltrim(??foobar ?? results in ?�foobar ??/td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array&lt;struct&lt;string,double&gt;&gt;</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">ngrams(array&lt;array &gt;, int N, int K, int pf)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the top-k N-grams from a set of tokenized sentences, such as those returned by the sentences() UDAF. See StatisticsAndDataMining for more information.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">parse_url(string urlString, string partToExtract [, string keyToExtract])</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the specified part from the URL. Valid values for partToExtract include HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, and USERINFO. e.g. parse_url(??a href="http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1" style="text-decoration: none; vertical-align: baseline;margin-top: 0px;color: rgb(50, 105, 160);">http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1</a>?? ?�HOST?? returns ?�facebook.com?? Also a value of a particular key in QUERY can be extracted by providing the key as the third argument, e.g. parse_url(??a href="http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1" style="text-decoration: none; vertical-align: baseline;margin-bottom: 0px;color: rgb(50, 105, 160);">http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1</a>?? ?�QUERY?? ?�k1?? returns ?�v1??</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">printf(String format, Obj??args)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the input formatted according do printf-style format strings (as of Hive 0.9.0)</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">regexp_extract(string subject, string pattern, int index)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string extracted using the pattern. e.g. regexp_extract(?�foothebar?? ?�foo(.*?)(bar)?? 2) returns ?�bar.??Note that some care is necessary in using predefined character classes: using ??s??as the second argument will match the letter s; ?�s??is necessary to match whitespace, etc. The ?�index??parameter is the Java regex Matcher group() method index. See docs/api/java/util/regex/Matcher.html for more information on the ?�index??or Java regex group() method.</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">regexp_replace(string INITIAL_STRING, string PATTERN, string REPLACEMENT)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from replacing all substrings in INITIAL_STRING that match the java regular expression syntax defined in PATTERN with instances of REPLACEMENT, e.g. regexp_replace("foobar", "oo|ar", "") returns ?�fb.??Note that some care is necessary in using predefined character classes: using ??s??as the second argument will match the letter s; ?�s??is necessary to match whitespace, etc.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">repeat(string str, int n)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Repeat str n times</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">reverse(string A)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the reversed string</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">rpad(string str, int len, string pad)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns str, right-padded with pad to a length of len</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">rtrim(string A)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from trimming spaces from the end(right hand side) of A e.g. rtrim(??foobar ?? results in ??foobar??/td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array&lt;array&gt;</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sentences(string str, string lang, string locale)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Tokenizes a string of natural language text into words and sentences, where each sentence is broken at the appropriate sentence boundary and returned as an array of words. The ?�lang??and ?�locale??are optional arguments. e.g. sentences(?�Hello there! How are you??? returns ( ("Hello", "there"), ("How", "are", "you") )</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">space(int n)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Return a string of n spaces</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">split(string str, string pat)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Split str around pat (pat is a regular expression)</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">map&lt;string,string&gt;</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">str_to_map(text[, delimiter1, delimiter2])</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Splits text into key-value pairs using two delimiters. Delimiter1 separates text into K-V pairs, and Delimiter2 splits each K-V pair. Default delimiters are ????for delimiter1 and ????for delimiter2.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">substr(string, int start) substring(string, int start)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the substring or slice of the byte array of A starting from start position till the end of string A e.g. substr(?�foobar?? 4) results in ?�bar??/td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">substr(string, int start, int len) substring(string, int start, int len)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the substring or slice of the byte array of A starting from start position with length len e.g. substr(?�foobar?? 4, 1) results in ?�b??/td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">translate(string input, string from, string to)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Translates the input string by replacing the characters present in the from string with the corresponding characters in the to string. This is similar to the translatefunction in PostgreSQL. If any of the parameters to this UDF are NULL, the result is NULL as well (available as of Hive 0.10.0)</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">trim(string A)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from trimming spaces from both ends of A e.g. trim(??foobar ?? results in ?�foobar??/td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">string</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">upper(string A) ucase(string A)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the string resulting from converting all characters of A to upper case e.g. upper(?�fOoBaR?? results in ?�FOOBAR??/td></tr></tbody></table><h2 id="built-in-aggregate-functions-(udaf)" style="clear: both;font-size: 1.8em; font-weight: bold; margin: 1.275em 0px 0.85em;border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(230, 230, 230); line-height: 1.6;"><a name="built-in-aggregate-functions-(udaf)" href="#built-in-aggregate-functions-(udaf)" style="text-decoration: none; vertical-align: baseline;color: rgb(50, 105, 160);"></a>Built-in Aggregate Functions (UDAF)</h2><p style="margin-top: 0px;margin: 1em 0px; word-wrap: break-word;">The following are built-in aggregate functions are supported in Hive.</p><table style="padding: 0px; border-collapse: collapse; border-spacing: 0px; margin-bottom: 16px;background-color: rgb(250, 250, 250);"><thead><tr><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Return Type</th><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Name(Signature)</th><th style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;font-weight: bold;border: 1px solid rgb(230, 230, 230);">Example</th></tr></thead><tbody><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">bigint</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">count(*), count(expr), count(DISTINCT expr[, expr_.])</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">count(*) ??Returns the total number of retrieved rows, including rows containing NULL values; count(expr) ??Returns the number of rows for which the supplied expression is non-NULL; count(DISTINCT expr[, expr]) ??Returns the number of rows for which the supplied expression(s) are unique and non-NULL.</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">sum(col), sum(DISTINCT col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the sum of the elements in the group or the sum of the distinct values of the column in the group</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">avg(col), avg(DISTINCT col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the average of the elements in the group or the average of the distinct values of the column in the group</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">min(col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the minimum of the column in the group</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">max(col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the maximum value of the column in the group</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">variance(col), var_pop(col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the variance of a numeric column in the group</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">var_samp(col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the unbiased sample variance of a numeric column in the group</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">stddev_pop(col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the standard deviation of a numeric column in the group</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">stddev_samp(col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the unbiased sample standard deviation of a numeric column in the group</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">covar_pop(col1, col2)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the population covariance of a pair of numeric columns in the group</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">covar_samp(col1, col2)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the sample covariance of a pair of a numeric columns in the group</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">corr(col1, col2)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the Pearson coefficient of correlation of a pair of a numeric columns in the group</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">percentile(BIGINT col, p)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the exact p<sup style="margin-top: 0px;margin-bottom: 0px;">th</sup> percentile of a column in the group (does not work with floating point types). p must be between 0 and 1. NOTE: A true percentile can only be computed for integer values. Use PERCENTILE_APPROX if your input is non-integral.</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">percentile(BIGINT col, array(p1 [, p2]??)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns the exact percentiles p1, p2, ??of a column in the group (does not work with floating point types). pi must be between 0 and 1. NOTE: A true percentile can only be computed for integer values. Use PERCENTILE_APPROX if your input is non-integral.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">double</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">percentile_approx(DOUBLE col, p [, B])</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns an approximate p<sup style="margin-top: 0px;margin-bottom: 0px;">th</sup> percentile of a numeric column (including floating point types) in the group. The B parameter controls approximation accuracy at the cost of memory. Higher values yield better approximations, and the default is 10,000. When the number of distinct values in col is smaller than B, this gives an exact percentile value.</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">percentile_approx(DOUBLE col, array(p1 [, p2]?? [, B])</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Same as above, but accepts and returns an array of percentile values instead of a single one.</td></tr><tr><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">histogram_numeric(col, b)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Computes a histogram of a numeric column in the group using b non-uniformly spaced bins. The output is an array of size b of double-valued (x,y) coordinates that represent the bin centers and heights</td></tr><tr style="background-color: rgb(242, 242, 242);"><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">array</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">collect_set(col)</td><td style="text-align:left; border: 1px solid rgb(204, 204, 204); margin: 0px; padding: 6px 13px;border: 1px solid rgb(230, 230, 230);">Returns a set of objects with duplicate elements eliminated</td></tr></tbody></table></div>');},t.VA.Core.Dialogs.RefineSteps.StepDialog=e;}.call(this),function(){"use strict";var t=this,e=t.Brightics;function i(t,i){e.VA.Core.Dialogs.RefineSteps.StepDialog.call(this,t,i);}i.prototype=Object.create(e.VA.Core.Dialogs.RefineSteps.StepDialog.prototype),i.prototype.constructor=i,i.prototype.getTitle=function(){return"Add Column";},i.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-refine-addcolumn-newcolumn-container"></div><div class="brtc-va-refine-addcolumn-addbutton">+ Add New Column</div>'),t.find(".brtc-va-refine-addcolumn-newcolumn-container").sortable({axis:"y",helper:function helper(t,e){var i=$(e).clone();return i.css("position","absolute"),i.get(0);},containment:".brtc-va-refine-addcolumn-newcolumn-container",handle:".brtc-va-refine-addcolumn-newcolumn-sort",stop:function stop(t,e){}}),t.find(".brtc-va-refine-addcolumn-newcolumn-container").disableSelection(),this.render();var i=t.find(".brtc-va-refine-addcolumn-addbutton").jqxButton({theme:e.VA.Env.Theme}),o=this;i.click(function(){o.createNewColumnItem(),o.checkValidation();}),t.perfectScrollbar(),t.perfectScrollbar("update");},i.prototype.createNewColumnItem=function(i,o){var n=this,r=this.$mainControl.find(".brtc-va-refine-addcolumn-newcolumn-container"),a=$('<div class="brtc-va-refine-addcolumn-newcolumn-item">   <div class="brtc-va-refine-addcolumn-newcolumn-sort"><i class="fa fa-bars"></i></div>   <input type="text" class="brtc-va-refine-addcolumn-newcolumn-name" valid-type="type1"/>   <div class="brtc-va-refine-addcolumn-newcolumn-assignor">=</div>   <textarea class="brtc-va-refine-addcolumn-newcolumn-value"></textarea>   <div class="brtc-va-refine-addcolumn-newcolumn-remove"></div></div>');r.append(a),a.find(".brtc-va-refine-addcolumn-newcolumn-name").jqxInput({theme:e.VA.Env.Theme,placeHolder:"Enter name",width:"122px",height:27}),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(a.find(".brtc-va-refine-addcolumn-newcolumn-name")),i&&a.find(".brtc-va-refine-addcolumn-newcolumn-name").val(i);var s=$.map(this.options.columns,function(t,e){return t.name;}),l=CodeMirror.fromTextArea(a.find(".brtc-va-refine-addcolumn-newcolumn-value")[0],{mode:"text/x-sql",theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!1,matchBrackets:!1,scrollbarStyle:"null",extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{list:[].concat(s,["ROUND()","MAX()","MIN()","SUM()","AVG()","OVER()","NVL()","CONCAT()","LPAD()","LTRIM()","RPAD()","RTRIM()","SUBSTR()","SUBSTRING()","FROM_UNIXTIME()","YEAR()","MONTH()","WEEKOFYEAR()"])}});l.setSize("calc(100% - 200px)",a.find(".brtc-va-refine-addcolumn-newcolumn-name").height()),e.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(l),l.on("beforeChange",function(t,e){var i=e.text.join("").replace(/\n/g,"");return e.update&&e.update(e.from,e.to,[i]),!0;}),o&&l.setValue(o),a.find(".brtc-va-refine-addcolumn-newcolumn-name").on("change",function(t){n.checkValidation();}),l.on("change",function(t){n.checkValidation();}),a.find(".brtc-va-refine-addcolumn-newcolumn-remove").click(function(){$(this).closest(".brtc-va-refine-addcolumn-newcolumn-item").remove(),n.checkValidation();});},i.prototype.handleOkClicked=function(){if(this.problems.length>0)e.VA.Core.Utils.WidgetUtils.openErrorDialog("There is a problem with some values.");else{var t=this.createSelect();this.buildFunctionUnit("Add Column","addColumnByRefine",t,""),e.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);}},i.prototype.buildFunctionUnit=function(t,i,o,n){var r=this.DEFAULT_FN_UNIT;r.fid=this.options.fid?this.options.fid:e.VA.Core.Utils.IDGenerator.func.id(),r.func=i,r.name="python"===this.options.context?"PythonScript":"SQLExecutor",r.inData=this.options.in,r.outData=this.options.out,r.param={select:o,"additional-query":n},"python"===this.options.context&&(r.param.script=this.buildScript(o,n),r.param["out-table-alias"]=["result"]),r.display={label:t},this.resultFnUnit=r;},i.prototype.buildScript=function(t,e){var i=this.DEFAULT_SCRIPT,o=t.replace(/\n/g,""),n=e.replace(/\n/g,"");return i=(i=i.replace("${SELECT_SQL}",o)).replace("${ADDITIONAL_QUERY}",n);},i.prototype.createSelect=function(){var t=this.$mainControl.find(".brtc-va-refine-addcolumn-newcolumn-item"),e="*",i=0;return $.each(t,function(o,n){i<t.length&&(e+=", \n",i++);var r=$(t[o]).find(".brtc-va-refine-addcolumn-newcolumn-name").val(),a=$(t[o]).find(".CodeMirror")[0].CodeMirror.getValue();e+=a+" as `"+r+"`";}),e;},i.prototype.render=function(){if(this.options.param){var t=this.options.param.select.split("\n");t[0].startsWith("*")&&t.splice(0,1);for(var e=0;e<t.length;e++){var i=t[e].lastIndexOf(" as "),o=t[e].substring(0,i).trim(),n=t[e].substring(i+4).trim();","==(n=n.replace(/`/gi,"")).slice(-1)&&(n=n.substring(0,n.length-1)),this.createNewColumnItem(n,o);}}else this.createNewColumnItem();this.checkValidation();},i.prototype.renderValidation=function(){var t=this;$.each(this.problems,function(e,i){var o=t.$mainControl.find(".brtc-va-refine-addcolumn-newcolumn-item");"BR-0033"==i.code?t.createValidationContent($(o[i.paramIndex]),i):t.createValidationContent($(o[i.paramIndex]),i,"New column name"==i.param?$(o[i.paramIndex]).find(".brtc-va-refine-addcolumn-newcolumn-name"):$(o[i.paramIndex]).find(".CodeMirror")),t.$mainControl.find(".brtc-va-refine-step-validation-tooltip").css({width:"465px","margin-left":"30px"});});},i.prototype.checkValidation=function(){var t=this,e=this.$mainControl.find(".brtc-va-refine-addcolumn-newcolumn-item");this.removeValidation();var i=[];$.each(e,function(o,n){var r=$(e[o]).find(".brtc-va-refine-addcolumn-newcolumn-name").val(),a=$(e[o]).find(".CodeMirror")[0].CodeMirror.getValue();if(""===r&&""===a)t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:o,param:"New column name",messageParam:["New column name","Value"]}));else if(""===r)t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:o,param:"New column name",messageParam:["New column name"]}));else if($.inArray(r,i)>-1){var s="New column name(s) - '"+r+"' already exist.";t.addProblem(t.createProblem({errorCode:"BR-0100",paramIndex:o,param:"New column name",messageParam:[s]}));}else if($.inArray(r,$.map(t.options.columns,function(t){return t.name;}))>-1){s="New column name(s) - '"+r+"' already exist.";t.addProblem(t.createProblem({errorCode:"BR-0100",paramIndex:o,param:"New column name",messageParam:[s]}));}else""===a&&t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:o,param:"Value",messageParam:["Value"]})),i.push(r);}),this.renderValidation();},e.VA.Core.Dialogs.RefineSteps.AddColumnDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.RefineSteps.StepDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype),e.prototype.constructor=e,e.prototype.getTitle=function(){return"Advanced Filter";},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-refine-advanced-filter-container">   <textarea class="brtc-va-refine-filter-conditioneditor"></textarea></div>'),this.render(t);},e.prototype.render=function(e){for(var i=this,o={},n=0;n<this.options.columns.length;n++){o[this.options.columns[n].name]=[this.options.columns[n].name];}this.cm=CodeMirror.fromTextArea(e.find(".brtc-va-refine-filter-conditioneditor")[0],{mode:"text/x-sql",theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{tables:o}}),this.cm.setSize("100%","calc(100% - 20px)"),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.cm),this.options.param?this.cm.setValue(this.options.param["additional-query"]):this.cm.setValue("WHERE "),this.cmMarker=this.cm.markText({line:0,ch:0},{line:0,ch:6},{readOnly:!0,inclusiveLeft:!0}),this.checkValidation(),this.cm.on("change",function(){i.checkValidation();});},e.prototype.getAdditionalQueryString=function(){return this.cm.getValue();},e.prototype.handleOkClicked=function(){if(this.problems.length>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check the query statement.");else{var e=this.getAdditionalQueryString();this.buildFunctionUnit("Advanced Filter","advancedFilter","*",e),t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);}},e.prototype.buildFunctionUnit=function(e,i,o,n){var r=this.DEFAULT_FN_UNIT;r.fid=this.options.fid?this.options.fid:t.VA.Core.Utils.IDGenerator.func.id(),r.func=i,r.name="python"===this.options.context?"PythonScript":"SQLExecutor",r.inData=this.options.in,r.outData=this.options.out,r.param={select:o,"additional-query":n},"python"===this.options.context&&(r.param.script=this.buildScript(o,n),r.param["out-table-alias"]=["result"]),r.display={label:e},this.resultFnUnit=r;},e.prototype.buildScript=function(t,e){var i=this.DEFAULT_SCRIPT,o=t.replace(/\n/g,""),n=e.replace(/\n/g,"");return i=(i=i.replace("${SELECT_SQL}",o)).replace("${ADDITIONAL_QUERY}",n);},e.prototype.checkValidation=function(){this.removeValidation();var t=this.cmMarker.find(),e=this.cm.getDoc().lastLine(),i=this.cm.getDoc().getLine(e).length;""===this.cm.getDoc().getRange(t.to,{line:e,ch:i})&&this.addProblem(this.createProblem({errorCode:"BR-0033",paramIndex:0,param:"Filter",messageParam:["Filter statement"]})),this.renderValidation();},e.prototype.renderValidation=function(){var t=this.$mainControl.find(".brtc-va-refine-advanced-filter-container");this.problems.length&&this.createValidationContent($(t),this.problems[0]);},t.VA.Core.Dialogs.RefineSteps.AdvancedFilterDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.RefineSteps.StepDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype),e.prototype.constructor=e,e.prototype.getTitle=function(){return"Change Value";},e.prototype.createDialogContentsArea=function(e){var i=this;e.append('<div class="brtc-va-refine-changevalue-newcolumn-container"></div><div class="brtc-va-refine-changevalue-addbutton">+ Add New Column</div>'),this.render(),e.find(".brtc-va-refine-changevalue-addbutton").jqxButton({theme:t.VA.Env.Theme}).click(function(){i.createNewChangeValueItem(),i.checkValidation();}),e.perfectScrollbar(),e.perfectScrollbar("update");},e.prototype.render=function(){if(this.options.param){var t=this.options.param.select.split(" \n");""==t[t.length-1]&&t.splice(t.length-1,1);for(var e=0;e<t.length;e++){","==t[e].slice(-1)&&(t[e]=t[e].substring(0,t[e].length-1));}var i=$.map(this.options.columns,function(t){return t.name;});for(e=0;e<t.length;e++){if(i[e]!==t[e]){var o=t[e].lastIndexOf(" as ");if(o>-1){var n=t[e].substring(0,o).trim(),r=t[e].substring(o+4).trim();r=r.replace(/`/gi,""),this.createNewChangeValueItem({name:r,value:n});}}}}else this.createNewChangeValueItem();this.checkValidation();},e.prototype.createNewChangeValueItem=function(e){var i=this,o=this.$mainControl.find(".brtc-va-refine-changevalue-newcolumn-container"),n=$('<div class="brtc-va-refine-changevalue-newcolumn-item">   <div class="brtc-va-refine-changevalue-newcolumn-name"></div>   <div class="brtc-va-refine-changevalue-newcolumn-assignor">= </div>   <textarea class="brtc-va-refine-changevalue-newcolumn-value"></textarea>   <div class="brtc-va-refine-changevalue-newcolumn-remove"></div></div>');o.append(n);var r=$.map(this.options.columns,function(t,e){return t.name;}),a=CodeMirror.fromTextArea(n.find(".brtc-va-refine-changevalue-newcolumn-value")[0],{mode:"brtc-control",theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!1,matchBrackets:!0,scrollbarStyle:"null",extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{list:[].concat(r,["ROUND()","MAX()","MIN()","SUM()","AVG()","OVER()","NVL()","CONCAT()","LPAD()","LTRIM()","RPAD()","RTRIM()","SUBSTR()","SUBSTRING()","FROM_UNIXTIME()","YEAR()","MONTH()","WEEKOFYEAR()"])}});a.on("beforeChange",function(t,e){var i=e.text.join("").replace(/\n/g,"");return e.update&&e.update(e.from,e.to,[i]),!0;}),a.setSize("calc(100% - 190px)","25px"),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(a);var s=n.find(".brtc-va-refine-changevalue-newcolumn-name");this.data=[],this.data=this.options.columns;var l=this.createColumnList(s,{rowCount:1,multiple:!1,showOpener:"click",removable:!1,fromModal:!0},"brtc-va-editors-sheet-controls-width-3",{height:"25px","padding-left":"4px"});l.setItems(this.data),l.columnSelector.$mainControl.attr("isDialog",!0),s.data("columnList",l),n.find(".brtc-va-refine-changevalue-newcolumn-remove").click(function(){$(this).closest(".brtc-va-refine-changevalue-newcolumn-item").remove(),i.checkValidation();}),l.onChange(function(t,e){i.checkValidation();}),a.on("change",function(t){i.checkValidation();}),e&&(l.setSelectedItems([e.name]),a.setValue(e.value)),s.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-empty").css({width:"100%","margin-left":"0px"}),n.find(".brtc-va-refine-changevalue-newcolumn-assignor").css({"text-align":"left","margin-left":"4px",width:"16px"});},e.prototype.getSelectString=function(){var t=this.$mainControl.find(".brtc-va-refine-changevalue-newcolumn-item"),e="";this.columnNameArray=[],this.validationData=[];var i=this,o=[],n=[];$.each(t,function(r,a){var s=$(t[r]).find(".brtc-va-refine-changevalue-newcolumn-name").data("columnList").getSelectedItems()[0];i.columnNameArray[r]=s;a=$(t[r]).find(".CodeMirror")[0].CodeMirror.getValue();e=a+" as `"+s+"`",o.push(s),n.push(e),i.validationData.push({index:r,column:s,value:a});});var r=$.map(this.data,function(t){return t.name;}),a="";for(var s in r){var l=!1;for(var c in o){if(r[s]===o[c]){a+=n[c],l=!0;break;}}l||(a+="`"+r[s]+"`"),a+=s<r.length-1?", \n":" \n";}return a;},e.prototype.getSelectSchema=function(){for(var t=[],e=0;e<this.data.length;e++){for(var i=0,o=0;o<this.columnNameArray.length&&this.data[e].name!=this.columnNameArray[o];o++){++i==this.columnNameArray.length&&(t[e]=this.data[e].name);}}return t;},e.prototype.handleOkClicked=function(){if(this.problems.length>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("There is a problem with some values.");else{var e=this.getSelectString();this.buildFunctionUnit("Change Value","changeValue",e,""),t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);}},e.prototype.buildFunctionUnit=function(e,i,o,n){var r=this.DEFAULT_FN_UNIT;r.fid=this.options.fid?this.options.fid:t.VA.Core.Utils.IDGenerator.func.id(),r.func=i,r.name="python"===this.options.context?"PythonScript":"SQLExecutor",r.inData=this.options.in,r.outData=this.options.out,r.param={select:o,"additional-query":n},"python"===this.options.context&&(r.param.script=this.buildScript(o,n),r.param["out-table-alias"]=["result"]),r.display={label:e},this.resultFnUnit=r;},e.prototype.buildScript=function(t,e){var i=this.DEFAULT_SCRIPT,o=t.replace(/\n/g,""),n=e.replace(/\n/g,"");return i=(i=i.replace("${SELECT_SQL}",o)).replace("${ADDITIONAL_QUERY}",n);},e.prototype.renderValidation=function(){var t=this;$.each(this.problems,function(e,i){var o=t.$mainControl.find(".brtc-va-refine-changevalue-newcolumn-item");"BR-0033"==i.code?t.createValidationContent($(o[i.paramIndex]),i):t.createValidationContent($(o[i.paramIndex]),i,"Select column"==i.param?$(o[i.paramIndex]).find(".brtc-va-refine-changevalue-newcolumn-name"):$(o[i.paramIndex]).find(".CodeMirror")),t.$mainControl.find(".brtc-va-refine-step-validation-tooltip").css("margin-left","8px");});},e.prototype.checkValidation=function(){var t=this,e=this.$mainControl.find(".brtc-va-refine-changevalue-newcolumn-item");this.removeValidation();var i=[];$.each(e,function(o,n){var r=$(e[o]).find(".brtc-va-refine-changevalue-newcolumn-name").data("columnList").getSelectedItems()[0];n=$(e[o]).find(".CodeMirror")[0].CodeMirror.getValue();if(void 0===r&&""===n?t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:o,param:"Select column",messageParam:["Select column","Change value"]})):void 0===r?t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:o,param:"Select column",messageParam:["Select column"]})):""===n&&t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:o,param:"Change value",messageParam:["Change value"]})),r)if($.inArray(r,i)>-1){var a="Select column(s) - '"+r+"' already exist.";t.addProblem(t.createProblem({errorCode:"BR-0100",paramIndex:o,param:"Select column",messageParam:[a]}));}else i.push(r);}),this.renderValidation();},e.prototype.destroy=function(){this.destroyColumnSelector(),this.$mainControl.dialog("destroy"),"function"==typeof this.options.close&&this.options.close(this.dialogResult);},t.VA.Core.Dialogs.RefineSteps.ChangeValueDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.RefineSteps.StepDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype),e.prototype.constructor=e,e.prototype.getTitle=function(){return"Group-by";},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-refine-groupby-container">   <textarea class="brtc-va-refine-select-sqleditor"></textarea></div>'),t.append('<div class="brtc-va-refine-groupby-container">   <textarea class="brtc-va-refine-groupby-sqleditor"></textarea></div>'),this.render(t);},e.prototype.render=function(e){for(var i=this,o={},n=0;n<this.options.columns.length;n++){o[this.options.columns[n].name]=[this.options.columns[n].name];}this.selectCM=CodeMirror.fromTextArea(e.find(".brtc-va-refine-select-sqleditor")[0],{mode:"text/x-sql",theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{tables:o}}),this.selectCM.setSize("100%","80%"),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.selectCM),this.groupbyCM=CodeMirror.fromTextArea(e.find(".brtc-va-refine-groupby-sqleditor")[0],{mode:"text/x-sql",theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{tables:o}}),this.groupbyCM.setSize("100%","80%"),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.groupbyCM),this.options.param?(this.selectCM.setValue("SELECT "+this.options.param.select),this.groupbyCM.setValue(this.options.param["additional-query"])):(this.selectCM.setValue("SELECT "),this.groupbyCM.setValue("GROUP BY ")),this.selectMarker=this.selectCM.markText({line:0,ch:0},{line:0,ch:7},{readOnly:!0}),this.groupByMarker=this.groupbyCM.markText({line:0,ch:0},{line:0,ch:9},{readOnly:!0}),this.checkValidation(),this.selectCM.on("change",function(t){i.checkValidation();}),this.groupbyCM.on("change",function(t){i.checkValidation();});},e.prototype.getAdditionalQueryString=function(){this.groupByMarker.find();var t=this.groupbyCM.getDoc().lastLine();this.groupbyCM.getDoc().getLine(t).length;return this.groupbyCM.getValue();},e.prototype.getSelectQueryString=function(){var t=this.selectMarker.find(),e=this.selectCM.getDoc().lastLine(),i=this.selectCM.getDoc().getLine(e).length;return this.selectCM.getDoc().getRange(t.to,{line:e,ch:i});},e.prototype.handleOkClicked=function(){if(this.problems.length>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please check the query statement.");else{var e=this.getSelectQueryString(),i=this.getAdditionalQueryString();this.buildFunctionUnit("Group By","groupBy",e,i),t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);}},e.prototype.buildFunctionUnit=function(e,i,o,n){var r=this.DEFAULT_FN_UNIT;r.fid=this.options.fid?this.options.fid:t.VA.Core.Utils.IDGenerator.func.id(),r.func=i,r.name="python"===this.options.context?"PythonScript":"SQLExecutor",r.inData=this.options.in,r.outData=this.options.out,r.param={select:o,"additional-query":n},"python"===this.options.context&&(r.param.script=this.buildScript(o,n),r.param["out-table-alias"]=["result"]),r.display={label:e},this.resultFnUnit=r;},e.prototype.buildScript=function(t,e){var i=this.DEFAULT_SCRIPT,o=t.replace(/\n/g,""),n=e.replace(/\n/g,"");return i=(i=i.replace("${SELECT_SQL}",o)).replace("${ADDITIONAL_QUERY}",n);},e.prototype.checkValidation=function(){this.removeValidation();var t=this.selectMarker.find(),e=this.selectCM.getDoc().lastLine(),i=this.selectCM.getDoc().getLine(e).length;""===this.selectCM.getDoc().getRange(t.to,{line:e,ch:i})&&this.addProblem(this.createProblem({errorCode:"BR-0033",paramIndex:0,param:"SELECT",messageParam:["SELECT statement"]}));var o=this.groupByMarker.find(),n=this.groupbyCM.getDoc().lastLine(),r=this.groupbyCM.getDoc().getLine(n).length;""===this.groupbyCM.getDoc().getRange(o.to,{line:n,ch:r})&&this.addProblem(this.createProblem({errorCode:"BR-0033",paramIndex:1,param:"GROUP BY",messageParam:["GROUP BY statement"]})),this.renderValidation();},e.prototype.renderValidation=function(){var t=this;$.each(this.problems,function(e,i){var o=t.$mainControl.find(".brtc-va-refine-groupby-container");t.createValidationContent($(o[i.paramIndex]),i);});},t.VA.Core.Dialogs.RefineSteps.GroupByDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.RefineSteps.StepDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype),e.prototype.constructor=e,e.prototype.getTitle=function(){return"Index Column";},e.prototype.createControls=function(){t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.createControls.call(this);this.$mainControl.dialog({height:550,maxHeight:550});},e.prototype.createDialogContentsArea=function(e){var i=this;e.append('<div class="brtc-va-refine-indexcolumn-column-contents">   <div class="brtc-va-refine-indexcolumn-newcolumn-name-contents"><span>New Column Name</span><input type="text" style="margin-left: 83px; " class="brtc-va-refine-indexcolumn-newcolumn-name"/></div>   <div class="brtc-va-refine-indexcolumn-newcolumn-lagvalue-contents"><span>Lag Value</span></div>   <div style="width: 510px; height:130px; margin-top: 10px;"><div>Partition By</div>       <div><div class="brtc-va-refine-indexcolumn-group-columns"></div></div>   </div></div>   <div style="margin-top: 10px;"><div style="margin-left: 10px; margin-bottom: 7px">Order By</div>       <div class="brtc-va-refine-indexcolumn-newcolumn-container" style="margin-left: 3px;"></div>       <div class="brtc-va-refine-indexcolumn-addbutton" >+ Add New Column</div></div>'),e.find(".brtc-va-refine-indexcolumn-newcolumn-name").jqxInput({theme:t.VA.Env.Theme,placeHolder:"Enter name",width:295}),e.find(".brtc-va-refine-indexcolumn-newcolumn-name").on("change",function(t){i.checkValidation();});var o=e.find(".brtc-va-refine-indexcolumn-newcolumn-lagvalue-contents");this.$lagValueInput=new t.VA.Core.Widget.Controls.NumericInput(o,{numberType:"int",min:void 0,max:void 0,minus:!1,placeHolder:"Enter value"});var n=e.find(".brtc-va-refine-indexcolumn-group-columns");this.data=[],this.data=this.options.columns;var r=this.createColumnList(n,{maxRowCount:3,multiple:!0,showOpener:"click",removable:!0,fromModal:!0},"",{width:"510px"});r.setItems(this.data),n.data("columnList",r),e.find(".brtc-va-refine-indexcolumn-newcolumn-container").sortable({axis:"y",containment:".brtc-va-refine-indexcolumn-newcolumn-container",helper:function helper(t,e){var i=$(e).clone();return i.css("position","absolute"),i.get(0);},handle:".brtc-va-refine-indexcolumn-column-sort",stop:function stop(t,e){}}),e.find(".brtc-va-refine-indexcolumn-newcolumn-container").disableSelection(),this.render(),e.find(".brtc-va-refine-indexcolumn-addbutton").jqxButton({theme:t.VA.Env.Theme}).click(function(){i.createNewSortItem(),i.checkValidation();}),e.perfectScrollbar(),e.perfectScrollbar("update");},e.prototype.render=function(){var t=this.$mainControl.find(".brtc-va-refine-indexcolumn-group-columns"),e=$(t).data("columnList");if(this.options.param){var i=this.options.param.select.replace(/ \n/gi,"\n").split("\n");if(i[0].startsWith("*, ROW_NUMBER() OVER(")){i.splice(0,1);var o=[];if("PARTITION BY"==i[0]){i.splice(0,1);for(var n=0;n<i.length;n++){if(i[n].startsWith("ORDER BY")||i[n].startsWith(") as ")){i.splice(0,n),e.setSelectedItems(o);break;}o.push(i[n].replace(",",""));}}if("ORDER BY"==i[0]){i.splice(0,1);for(n=0;n<i.length;n++){if(i[n].startsWith(") as ")){i.splice(0,n);break;}var r=(l=i[n].replace(",","").split(" "))[0].replace(" ",""),a=l[1].replace(" ","");this.createNewSortItem({name:r,"sort-mode":a});}}if(i[i.length-1].startsWith(") as ")){var s=i[i.length-1].replace(") as ","");this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-name").val(s);}}else if(i[0].startsWith("*, zeroIfNeg(ROW_NUMBER() OVER(")){i.splice(0,1);o=[];if("PARTITION BY"==i[0]){i.splice(0,1);for(n=0;n<i.length;n++){if(i[n].startsWith("ORDER BY")||i[n].startsWith(") -")){i.splice(0,n),e.setSelectedItems(o);break;}o.push(i[n].replace(",",""));}}if("ORDER BY"==i[0]){i.splice(0,1);for(n=0;n<i.length;n++){if(i[n].startsWith(") - ")){i.splice(0,n);break;}var l;r=(l=i[n].replace(",","").split(" "))[0].replace(" ",""),a=l[1].replace(" ","");this.createNewSortItem({name:r,"sort-mode":a});}}if(i[0].startsWith(") - ")){var c=i[0].replace(") - ","");this.$lagValueInput.setValue(c);}if(i[i.length-1].startsWith(") as ")){s=i[i.length-1].trim().replace(") as ","");this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-name").val(s);}}}else this.createNewSortItem();this.checkValidation();},e.prototype.createNewSortItem=function(t){var e=this,i=this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-container"),o=$('<div class="brtc-va-refine-indexcolumn-column-item">   <div class="brtc-va-refine-indexcolumn-column-sort" style="cursor: pointer;"><i class="fa fa-bars"></i></div>   <div class="brtc-va-refine-indexcolumn-column-name"></div>   <div class="brtc-va-refine-indexcolumn-column-propertycontrol-button"><i class="fa fa-sort"></i></div>   <div class="brtc-va-refine-indexcolumn-column-remove"></div></div>');i.append(o);var n=o.find(".brtc-va-refine-indexcolumn-column-name"),r=this.createColumnList(n,{rowCount:1,multiple:!1,showOpener:"click",removable:!1,fromModal:!0},"brtc-va-editors-sheet-controls-width-10",{height:"25px","padding-left":"4px"});r.setItems(this.options.columns),r.columnSelector.$mainControl.attr("isDialog",!0),o.data("columnList",r);var a=o.find(".brtc-va-refine-indexcolumn-column-propertycontrol-button");this.createButton(a,{width:"19px",height:"19px"},"",{float:"left","margin-left":"3px"}),a.data("sort-mode","ASC"),a.on("click",function(){var t=r.getSelectedItems(),i=$.grep(e.options.columns,function(e,i){return e.name===t[0];});i&&i.length>0&&("ASC"===a.data("sort-mode")?a.data("sort-mode","DESC"):a.data("sort-mode","ASC"),e.updateSortModeIcon(a,r));}),r.onChange(function(t,i){e.updateSortModeIcon(a,r),e.checkValidation();}),o.find(".brtc-va-refine-indexcolumn-column-remove").click(function(){$(this).closest(".brtc-va-refine-indexcolumn-column-item").remove(),e.checkValidation();}),t&&(r.setSelectedItems([t.name]),a.data("sort-mode",t["sort-mode"]),this.updateSortModeIcon(a,r)),o.find(".brtc-va-refine-indexcolumn-column-sort").css("margin-bottom","5px");},e.prototype.handleOkClicked=function(){if(this.problems.length>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("There is a problem with some values.");else{var e=this.createAdditionalQuery();this.createSQLExecutor("Index Column","indexColumnByRefine",e,""),t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);}},e.prototype.createAdditionalQuery=function(){var t="",e="",i=this.$mainControl.find(".brtc-va-refine-indexcolumn-group-columns"),o=$(i).data("columnList"),n=o.getSelectedItems();n.length&&(e="PARTITION BY\n",$.each(o.getSelectedItems(),function(t,i){e+=i,e+=t<n.length-1?",\n":"\n";}));var r=this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-container").find(".brtc-va-refine-indexcolumn-column-item");r.length>0&&(t="ORDER BY\n"),r.each(function(e,i){var o=$(i).data("columnList"),n=$(i).find(".brtc-va-refine-indexcolumn-column-propertycontrol-button"),a=o.getSelectedItems();if(a.length){var s=n.data("sort-mode");t+=a[0]+" "+s,t+=e<r.length-1?",\n":"\n";}else t="";});var a=this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-name").val(),s=this.$lagValueInput.getValue();return""===s?"*, ROW_NUMBER() OVER(\n"+e+t+") as "+a:"*, zeroIfNeg(ROW_NUMBER() OVER(\n"+e+t+") - "+s+"\n) as "+a;},e.prototype.renderValidation=function(){var t=this,e=this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-name-contents"),i=this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-container").find(".brtc-va-refine-indexcolumn-column-item");$.each(t.problems,function(o,n){-1==n.paramIndex||("New column name"==n.param?t.createValidationContent($(e),n):"Select column"==n.param&&$(i[n.paramIndex]).find(".brtc-va-refine-step-validation-tooltip").css({clear:"",float:"left","margin-top":"0px","margin-bottom":"10px","margin-left":"35px"}));});},e.prototype.checkValidation=function(){var e=this;this.removeValidation();var i=this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-name").val(),o=this.$mainControl.find(".brtc-va-refine-indexcolumn-newcolumn-container").find(".brtc-va-refine-indexcolumn-column-item");""===i?e.addProblem(e.createProblem({errorCode:"BR-0033",param:"New column name",messageParam:["New Column Name"]})):t.VA.Core.Utils.InputValidator.isValid.columnNameType(i)||e.addProblem(e.createProblem({errorCode:"BR-0045",param:"New Column Name"}));var n=[];o.length?o.each(function(t,i){var o=$(i).data("columnList").getSelectedItems();if(o.length){if($.inArray(o[0],n)>-1){var r="Select column(s) - '"+o[0]+"' already exist.";e.addProblem(e.createProblem({errorCode:"BR-0100",paramIndex:t,param:"Select column",messageParam:[r]}));}else n.push(o[0]);}else e.addProblem(e.createProblem({errorCode:"BR-0033",paramIndex:t,param:"Select column",messageParam:["Select column"]}));}):this.addProblem(e.createProblem({errorCode:"BR-0033",paramIndex:-1,param:"Column",messageParam:["Column"]})),this.renderValidation();},e.prototype.updateSortModeIcon=function(t,e){var i=e.getSelectedItems(),o=$.grep(this.options.columns,function(t,e){return t.name===i[0];}),n=t.data("sort-mode");if(o&&o.length>0){var r,a=o[0].type;t.find("i").removeClass(),"string"===a?(r="fa fa-sort-alpha-"+n.toLowerCase(),t.find("i").addClass(r)):"number"===a||"date"===a?(r="fa fa-sort-numeric-"+n.toLowerCase(),t.find("i").addClass(r)):(r="fa fa-sort",t.find("i").addClass(r));}},e.prototype.destroy=function(){this.destroyColumnSelector(),this.$mainControl.dialog("destroy"),"function"==typeof this.options.close&&this.options.close(this.dialogResult);},t.VA.Core.Dialogs.RefineSteps.IndexColumnDialog=e;}.call(this),function(){"use strict";var t=this,e=t.Brightics;function i(t,i){e.VA.Core.Dialogs.RefineSteps.StepDialog.call(this,t,i);}i.prototype=Object.create(e.VA.Core.Dialogs.RefineSteps.StepDialog.prototype),i.prototype.constructor=i,i.prototype.getTitle=function(){return"Select Column";},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />       </div>   </div></div>'),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel"),this.$mainControl.find(".brtc-va-refine-step-header-help").css("display","none"),this.$mainControl.find(".brtc-va-refine-step-header-help").click(function(){window.open("api/va/v2/help/function/sqlfunctionhelp","SQL Function Help").blur();});},i.prototype.createDialogContentsArea=function(t){var i=this;t.addClass("brtc-va-dataflow-refine-select-column-dialog"),this.createAliasHelper(t),t.append('<div class="brtc-va-refine-selectcolumn-header">   <div class="brtc-va-refine-selectcolumn-header-check"></div>   <div class="brtc-va-refine-selectcolumn-header-column-sort"></div>   <div class="brtc-va-refine-selectcolumn-header-name">Name</div>   <div class="brtc-va-refine-selectcolumn-header-alias">New Name</div>   <div class="brtc-va-refine-selectcolumn-column-alias-setting-wrapper"><div class="brtc-va-refine-selectcolumn-column-alias-setting-button"></div></div>   <div class="brtc-va-refine-selectcolumn-column-alias-reset-wrapper"><div class="brtc-va-refine-selectcolumn-column-reset"></div></div>   <div class="brtc-va-refine-selectcolumn-header-type">Type</div>   <div class="brtc-va-refine-selectcolumn-column-type-reset-wrapper"><div class="brtc-va-refine-selectcolumn-column-reset"></div></div></div><div class="brtc-va-refine-selectcolumn-contents"></div>');var o={theme:e.VA.Env.Theme,title:this.getTitle(),width:600,height:500,maxWidth:600,maxHeight:500,modal:!0,resizable:!1,close:this.destroy.bind(this)};this.$mainControl.dialog(o),this.$headerCheckBox=$(t.find(".brtc-va-refine-selectcolumn-header-check")),this.$headerCheckBox.jqxCheckBox({theme:e.VA.Env.Theme,width:23,height:27,checked:!0}),this.$headerCheckBox.on("checked",function(t){i.checkAllItems("check"),i.$okButton.jqxButton({disabled:!1});}),this.$headerCheckBox.on("unchecked",function(t){i.checkAllItems("uncheck"),i.$okButton.jqxButton({disabled:!0});}),this.render(),t.find(".brtc-va-refine-selectcolumn-contents").sortable({axis:"y",helper:function helper(t,e){var i=$(e).clone();return i.css("position","absolute"),i.get(0);},items:".brtc-va-refine-selectcolumn-column-item",cancel:".brtc-va-refine-selectcolumn-column-item.sort-disabled",handle:".brtc-va-refine-selectcolumn-column-sort",update:function update(t,e){i.checkValidation();}},"refreshPositions"),t.find(".brtc-va-refine-selectcolumn-contents").disableSelection(),t.perfectScrollbar(),t.perfectScrollbar("update"),$(".brtc-va-refine-selectcolumn-column-alias-setting-button").click(function(){$(".brtc-va-refine-selectcolumn-alias-helper").toggleClass("setting-active"),$(this).toggleClass("setting-active");}),$(".brtc-va-refine-selectcolumn-column-alias-reset-wrapper .brtc-va-refine-selectcolumn-column-reset").click(function(){i.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item").each(function(t,e){if($(e).find(".brtc-va-refine-selectcolumn-column-check").val()){var i=$(e).find(".brtc-va-refine-selectcolumn-column-alias");i.val(i.data("default-alias"));}});}),$(".brtc-va-refine-selectcolumn-column-type-reset-wrapper .brtc-va-refine-selectcolumn-column-reset").click(function(){i.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item").each(function(t,e){if($(e).find(".brtc-va-refine-selectcolumn-column-check").val()){var i=$(e).find(".brtc-va-refine-selectcolumn-column-type");i.val(i.data("default-type"));}});}),this.checkValidation();},i.prototype.checkAllItems=function(t){for(var e=this.$mainControl.find(".brtc-va-refine-selectcolumn-column-item"),i=0;i<e.length;i++){var o=$(e[i]).find(".brtc-va-refine-selectcolumn-column-check");$(o).jqxCheckBox(t);}},i.prototype.isUncheckedAllItems=function(){for(var t=this.$mainControl.find(".brtc-va-refine-selectcolumn-column-item"),e=0;e<t.length;e++){var i=$(t[e]).find(".brtc-va-refine-selectcolumn-column-check");if($(i).jqxCheckBox("checked"))return;}this.$okButton.jqxButton({disabled:!0});},i.prototype.render=function(){if(this.options.param){var t=this.options.param.select.replace(/, \n/gi,"\n").split("\n");""==t[t.length-1]&&t.splice(t.length-1,1);for(var e=[],i=[],o=0;o<t.length;o++){var n,r,a,s;t[o].startsWith("cast(")?(r=(n=t[o].replace(/`/gi,"").replace("cast(","").replace(") as "," ").replace(" as "," ").split(" "))[0].replace(" ",""),a=n[1].replace(" ",""),s=n[2].replace(" ","")):(r=(n=t[o].replace(/`/gi,"").replace(" as "," ").split(" "))[0].replace(" ",""),a="",s=n[1].replace(" ","")),e.push(r),i.push({name:r,alias:s,type:a});}for(var l=0;l<i.length;l++){var c={checked:!0,name:i[l].name,alias:i[l].alias,type:i[l].type};this.createColumnItem(c);}for(var d=this.options.columns,p=[],u=0;u<d.length;u++){-1==$.inArray(d[u].name,e)&&p.push(d[u]);}for(var h in p){c={checked:!1,name:p[h].name,alias:p[h].name,type:this.convertInternalTypeToHiveGrammar(p[h].internalType)};this.createColumnItem(c);}}else{d=this.options.columns;for(var h in d){this.createColumnItem({checked:!0,name:d[h].name,alias:d[h].name,type:this.convertInternalTypeToHiveGrammar(d[h].internalType)});}}},i.prototype.convertInternalTypeToHiveGrammar=function(t){var e="";switch(t){case"String":e="string";break;case"Integer":e="int";break;case"Double":e="double";break;case"Long":e="bigint";break;case"Boolean":e="boolean";}return e;},i.prototype.createColumnItem=function(i){var o=this,n=this.$mainControl.find(".brtc-va-refine-selectcolumn-contents"),r=$('<div class="brtc-va-refine-selectcolumn-column-item">   <div class="brtc-va-refine-selectcolumn-column-check"></div>   <div class="brtc-va-refine-selectcolumn-column-sort"><i class="fa fa-bars"></i></div>   <input type="text" class="brtc-va-refine-selectcolumn-column-name" readonly="readonly"/>   <input type="text" class="brtc-va-refine-selectcolumn-column-alias" valid-type="type1"/>   <div class="brtc-va-refine-selectcolumn-column-type"></div>   <div class="brtc-va-refine-selectcolumn-column-reset-wrapper"><div class="brtc-va-refine-selectcolumn-column-reset"></div></div></div>');n.append(r),r.find(".brtc-va-refine-selectcolumn-column-check").jqxCheckBox({theme:e.VA.Env.Theme,width:23,height:27,checked:i.checked}),r.find(".brtc-va-refine-selectcolumn-column-check").on("checked",function(){r.removeClass("sort-disabled"),r.find(".brtc-va-refine-selectcolumn-column-sort").css({opacity:"",cursor:"pointer"}),r.find(".brtc-va-refine-selectcolumn-column-name").jqxInput({disabled:!1}),r.find(".brtc-va-refine-selectcolumn-column-alias").jqxInput({disabled:!1}),r.find(".brtc-va-refine-selectcolumn-column-type").jqxDropDownList({disabled:!1}),r.find(".brtc-va-refine-selectcolumn-column-reset").css({opacity:"",cursor:"pointer"}),o.checkValidation(),o.$okButton.jqxButton({disabled:!1});}),r.find(".brtc-va-refine-selectcolumn-column-check").on("unchecked",function(){r.addClass("sort-disabled"),r.find(".brtc-va-refine-selectcolumn-column-sort").css({opacity:"0.5",cursor:"default"}),r.find(".brtc-va-refine-selectcolumn-column-name").jqxInput({disabled:!0}),r.find(".brtc-va-refine-selectcolumn-column-alias").jqxInput({disabled:!0}),r.find(".brtc-va-refine-selectcolumn-column-type").jqxDropDownList({disabled:!0}),r.find(".brtc-va-refine-selectcolumn-column-reset").css({opacity:"0.5",cursor:"default"}),o.isUncheckedAllItems(),o.checkValidation();}),r.find(".brtc-va-refine-selectcolumn-column-name").val(i.name),r.find(".brtc-va-refine-selectcolumn-column-name").jqxInput({theme:e.VA.Env.Theme,width:"172px",height:"27px"}),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(r.find(".brtc-va-refine-selectcolumn-column-name")),r.find(".brtc-va-refine-selectcolumn-column-name").on("change",function(){o.checkValidation();}),r.find(".brtc-va-refine-selectcolumn-column-alias").data("default-alias",i.alias),r.find(".brtc-va-refine-selectcolumn-column-alias").val(i.alias),r.find(".brtc-va-refine-selectcolumn-column-alias").jqxInput({theme:e.VA.Env.Theme,width:"182px",height:"27px"}),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(r.find(".brtc-va-refine-selectcolumn-column-alias")),r.find(".brtc-va-refine-selectcolumn-column-alias").on("change",function(){o.checkValidation();});r.find(".brtc-va-refine-selectcolumn-column-type").jqxDropDownList({theme:e.VA.Env.Theme,source:[{display:"String",value:"string"},{display:"Integer",value:"int"},{display:"Double",value:"double"},{display:"Long",value:"bigint"},{display:"Boolean",value:"boolean"}],width:90,height:25,animationType:"none",openDelay:0,displayMember:"display",valueMember:"value",autoDropDownHeight:!0});var a=r.find(".brtc-va-refine-selectcolumn-column-type").attr("id");$("#listBox"+a).insertBefore(r.closest(".ui-dialog")),i.type?(r.find(".brtc-va-refine-selectcolumn-column-type").data("default-type",i.type),r.find(".brtc-va-refine-selectcolumn-column-type").val(i.type)):r.find(".brtc-va-refine-selectcolumn-column-type").jqxDropDownList({disabled:!0}),r.find(".brtc-va-refine-selectcolumn-column-reset").on("click",function(){r.find(".brtc-va-refine-selectcolumn-column-check").val()&&(r.find(".brtc-va-refine-selectcolumn-column-type").val(i.type),r.find(".brtc-va-refine-selectcolumn-column-alias").val(i.alias));}),i.checked?(r.find(".brtc-va-refine-selectcolumn-column-sort").css({opacity:"",cursor:"pointer"}),r.find(".brtc-va-refine-selectcolumn-column-reset").css({opacity:"",cursor:"pointer"})):(r.addClass("sort-disabled"),r.find(".brtc-va-refine-selectcolumn-column-sort").css({opacity:"0.5",cursor:"default"}),r.find(".brtc-va-refine-selectcolumn-column-name").jqxInput({disabled:!0}),r.find(".brtc-va-refine-selectcolumn-column-alias").jqxInput({disabled:!0}),r.find(".brtc-va-refine-selectcolumn-column-type").jqxDropDownList({disabled:!0}),r.find(".brtc-va-refine-selectcolumn-column-reset").css({opacity:"0.5",cursor:"default"}));},i.prototype.createSelect=function(){var t="",e=this.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item"),i=[];return e.each(function(t,e){$(e).find(".brtc-va-refine-selectcolumn-column-check").val()&&i.push(e);}),$(i).each(function(e,o){var n=$(o).find(".brtc-va-refine-selectcolumn-column-name"),r=$(o).find(".brtc-va-refine-selectcolumn-column-alias"),a=$(o).find(".brtc-va-refine-selectcolumn-column-type");a.val()?t+="cast(`"+n.val()+"` as "+a.val()+") as `"+r.val()+"`":t+="`"+n.val()+"` as `"+r.val()+"`",t+=e<i.length-1?", \n":" \n";}),t;},i.prototype.handleOkClicked=function(){if(this.problems.length>0)e.VA.Core.Utils.WidgetUtils.openErrorDialog("There is a problem with some values.");else{var t=this.createSelect();this.buildFunctionUnit("Select Column","selectColumn",t,""),e.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);}},i.prototype.buildFunctionUnit=function(t,i,o,n){var r=this.DEFAULT_FN_UNIT;r.fid=this.options.fid?this.options.fid:e.VA.Core.Utils.IDGenerator.func.id(),r.func=i,r.name="python"===this.options.context?"PythonScript":"SQLExecutor",r.inData=this.options.in,r.outData=this.options.out,r.param={select:o,"additional-query":n},"python"===this.options.context&&(r.param.script=this.buildScript(o,n),r.param["out-table-alias"]=["result"]),r.display={label:t},this.resultFnUnit=r;},i.prototype.buildScript=function(t,e){var i=this.DEFAULT_SCRIPT,o=t.replace(/\n/g,""),n=e.replace(/\n/g,"");return i=(i=i.replace("${SELECT_SQL}",o)).replace("${ADDITIONAL_QUERY}",n);},i.prototype.renderValidation=function(){var t=this,e=this.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item");$.each(this.problems,function(i,o){var n;"Name"===o.param?n=$(e[o.paramIndex]).find(".brtc-va-refine-selectcolumn-column-name"):"Alias"===o.param&&(n=$(e[o.paramIndex]).find(".brtc-va-refine-selectcolumn-column-alias")),t.createValidationContent($(e[o.paramIndex]),o,n),t.$mainControl.find(".brtc-va-refine-step-validation-tooltip").css({width:"465px","margin-left":"45px"});});},i.prototype.checkValidation=function(){var t=this;this.removeValidation();var e=[];for(var i in t.options.columns){e.push(t.options.columns[i].name);}var o=this.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item"),n=[],r=!1;o.each(function(e,i){if($(i).find(".brtc-va-refine-selectcolumn-column-check").val()){r=!0,""==$(i).find(".brtc-va-refine-selectcolumn-column-name").val()&&t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:e,param:"Name",messageParam:["Name"]}));var o=$(i).find(".brtc-va-refine-selectcolumn-column-alias").val();if(""==o)t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:e,param:"Alias",messageParam:["Alias"]}));else if($.inArray(o,n)>-1){var a="Alias - '"+o+"' already exist.";t.addProblem(t.createProblem({errorCode:"BR-0100",paramIndex:e,param:"Alias",messageParam:[a]}));}else n.push(o);}}),r||this.addProblem(t.createProblem({errorCode:"BR-0001",paramIndex:-1,param:"Column",messageParam:["Column"]})),this.renderValidation();},i.prototype.createAliasHelper=function(i){var o=this,n=$('<div class="brtc-va-refine-selectcolumn-alias-helper">   <div class="brtc-va-refine-selectcolumn-alias-helper-title">Alias Setting</div>   <div class="brtc-va-refine-selectcolumn-upper-lower-button-container">       <button class="brtc-va-refine-selectcolumn-column-uppercase-button">UPPERCASE</button>       <button class="brtc-va-refine-selectcolumn-column-lowercase-button">lowercase</button>       <button class="brtc-va-refine-selectcolumn-column-firstuppercase-button">Uppercase first letter</button>   </div>   <div class="brtc-va-refine-selectcolumn-fix-input-button-container">       <input class="brtc-va-refine-selectcolumn-column-fix-input" type="text" placeholder="Pre, Suffix" valid-type="type1"/>       <button class="brtc-va-refine-selectcolumn-column-prefix-button">Prefix</button>       <button class="brtc-va-refine-selectcolumn-column-suffix-button">Suffix</button>       <button class="brtc-va-refine-selectcolumn-column-prefix-index-button">Pre. Index</button>       <button class="brtc-va-refine-selectcolumn-column-suffix-index-button">Suf. Index</button><br>   </div>   <div class="brtc-va-refine-selectcolumn-find-replace-button-container">       <input class="brtc-va-refine-selectcolumn-column-find-input" type="text" placeholder="Find" valid-type="type1"/>       <input class="brtc-va-refine-selectcolumn-column-replace-input" type="text" placeholder="Replace" valid-type="type1"/>       <button class="brtc-va-refine-selectcolumn-column-replace-button">Replace</button>   </div></div>');i.append(n);var r=n.find(".brtc-va-refine-selectcolumn-column-fix-input"),a=n.find(".brtc-va-refine-selectcolumn-column-find-input"),s=n.find(".brtc-va-refine-selectcolumn-column-replace-input");r.jqxInput({theme:e.VA.Env.Theme}),a.jqxInput({theme:e.VA.Env.Theme}),s.jqxInput({theme:e.VA.Env.Theme}),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(r),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(a),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(s);var l=n.find(".brtc-va-refine-selectcolumn-column-uppercase-button"),c=n.find(".brtc-va-refine-selectcolumn-column-lowercase-button"),d=n.find(".brtc-va-refine-selectcolumn-column-firstuppercase-button"),p=n.find(".brtc-va-refine-selectcolumn-column-prefix-button"),u=n.find(".brtc-va-refine-selectcolumn-column-suffix-button"),h=n.find(".brtc-va-refine-selectcolumn-column-prefix-index-button"),f=n.find(".brtc-va-refine-selectcolumn-column-suffix-index-button"),m=n.find(".brtc-va-refine-selectcolumn-column-replace-button");l.jqxButton({theme:e.VA.Env.Theme}),c.jqxButton({theme:e.VA.Env.Theme}),d.jqxButton({theme:e.VA.Env.Theme}),p.jqxButton({theme:e.VA.Env.Theme}),u.jqxButton({theme:e.VA.Env.Theme}),h.jqxButton({theme:e.VA.Env.Theme}),f.jqxButton({theme:e.VA.Env.Theme}),m.jqxButton({theme:e.VA.Env.Theme}),l.click(function(){o.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item").each(function(t,e){if($(e).find(".brtc-va-refine-selectcolumn-column-check").val()){var i=$(e).find(".brtc-va-refine-selectcolumn-column-alias"),o=i.val();i.val(o.toUpperCase());}});}),c.click(function(){o.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item").each(function(t,e){if($(e).find(".brtc-va-refine-selectcolumn-column-check").val()){var i=$(e).find(".brtc-va-refine-selectcolumn-column-alias"),o=i.val();i.val(o.toLowerCase());}});}),d.click(function(){o.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item").each(function(t,e){if($(e).find(".brtc-va-refine-selectcolumn-column-check").val()){var i=$(e).find(".brtc-va-refine-selectcolumn-column-alias"),o=i.val();i.val(o.charAt(0).toUpperCase()+o.slice(1));}});}),p.click(function(){var t=o.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item"),e=$(".brtc-va-refine-selectcolumn-column-fix-input").val();t.each(function(t,i){if($(i).find(".brtc-va-refine-selectcolumn-column-check").val()){var o=$(i).find(".brtc-va-refine-selectcolumn-column-alias"),n=o.val();o.val(e+n);}});}),u.click(function(){var t=o.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item"),e=$(".brtc-va-refine-selectcolumn-column-fix-input").val();t.each(function(t,i){if($(i).find(".brtc-va-refine-selectcolumn-column-check").val()){var o=$(i).find(".brtc-va-refine-selectcolumn-column-alias"),n=o.val();o.val(n+e);}});}),h.click(function(){var t=o.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item"),e=1;t.each(function(t,i){if($(i).find(".brtc-va-refine-selectcolumn-column-check").val()){var o=$(i).find(".brtc-va-refine-selectcolumn-column-alias"),n=o.val();o.val(e++ +n);}});}),f.click(function(){var t=o.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item"),e=1;t.each(function(t,i){if($(i).find(".brtc-va-refine-selectcolumn-column-check").val()){var o=$(i).find(".brtc-va-refine-selectcolumn-column-alias"),n=o.val();o.val(n+e++);}});}),m.click(function(){var t=o.$mainControl.find(".brtc-va-refine-selectcolumn-contents > .brtc-va-refine-selectcolumn-column-item"),e=$(".brtc-va-refine-selectcolumn-column-find-input").val(),i=$(".brtc-va-refine-selectcolumn-column-replace-input").val();t.each(function(t,o){if($(o).find(".brtc-va-refine-selectcolumn-column-check").val()){var n=$(o).find(".brtc-va-refine-selectcolumn-column-alias"),r=n.val();n.val(r.split(e).join(""+i));}});});},i.prototype.destroy=function(){this.destroyDropDownList(),this.$mainControl.dialog("destroy"),"function"==typeof this.options.close&&this.options.close(this.dialogResult);},i.prototype.destroyDropDownList=function(){var t=$(".brtc-va-refine-selectcolumn-column-type");t.length>0&&t.jqxDropDownList("destroy");},e.VA.Core.Dialogs.RefineSteps.SelectColumnDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.RefineSteps.StepDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype),e.prototype.constructor=e,e.prototype.getTitle=function(){return"Simple Filter";},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-refine-simplefilter-contents"></div>'),this.render(),t.perfectScrollbar(),t.perfectScrollbar("update");},e.prototype.parseSql=function(t){var e={},i=t.indexOf(" ");e.name=t.substring(0,i).trim();var o=t.substring(i).trim(),n=o.indexOf(" ");return e.condition=o.substring(0,n).trim(),e.columnValue=o.substring(n).trim(),e;},e.prototype.render=function(){var t,e,i="and";if(this.options.param){var o=this.options.param["additional-query"].split(" \n");for(var n in o){if(o[n].startsWith("WHERE")){var r=o[n].replace("WHERE ","").trim();(t=this.parseSql(r)).name=t.name.replace(/`/gi,"");}else{i=o[n].startsWith("and")?"and":"or";var a=o[n].replace(i,"").trim();(e=this.parseSql(a)).name=e.name.replace(/`/gi,"");}}}this.createColumnItem(t),this.createSimplefilterRadioButton({type:i}),this.createColumnItem(e),this.checkValidation();},e.prototype.createSimplefilterRadioButton=function(e){var i=this.$mainControl.find(".brtc-va-refine-simplefilter-contents"),o=$('<div class="brtc-va-dialogs-simplefilter-type">   <div class="brtc-va-dialogs-simplefilter-type-and">And</div>   <div class="brtc-va-dialogs-simplefilter-type-or">Or</div></div>');i.append(o),i.find(".brtc-va-dialogs-simplefilter-type-and").jqxRadioButton({checked:"and"==e.type,theme:t.VA.Env.Theme}),i.find(".brtc-va-dialogs-simplefilter-type-or").jqxRadioButton({checked:"or"==e.type,theme:t.VA.Env.Theme});},e.prototype.createColumnItem=function(e){var i=this,o=this.$mainControl.find(".brtc-va-refine-simplefilter-contents"),n=$('<div class="brtc-va-refine-simplefilter-column-item">   <div class="brtc-va-refine-simplefilter-column-name"></div>   <div class="brtc-va-refine-simplefilter-condition"></div>   <input type="text" class="brtc-va-refine-simplefilter-column-value"/></div>');o.append(n);var r=n.find(".brtc-va-refine-simplefilter-column-name");this.data=[],this.data=this.options.columns;var a=this.createColumnList(r,{rowCount:1,multiple:!1,showOpener:"click",removable:!1,fromModal:!0},"brtc-va-editors-sheet-controls-width-3",{height:"25px","padding-left":"4px"});a.setItems(this.data),r.data("columnList",a);n.find(".brtc-va-refine-simplefilter-condition").jqxDropDownList({theme:t.VA.Env.Theme,source:["","=","<>",">",">=","<","<="],width:150});var s=$.map(this.options.columns,function(t,e){return t.name;}),l=CodeMirror.fromTextArea(n.find(".brtc-va-refine-simplefilter-column-value")[0],{mode:"brtc-control",theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!1,matchBrackets:!0,scrollbarStyle:"null",extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{list:[].concat(s,t.VA.Env.SQLFunctions)}});l.on("beforeChange",function(t,e){var i=e.text.join("").replace(/\n/g,"");return e.update&&e.update(e.from,e.to,[i]),!0;}),l.setSize("calc(100% - 310px)","25px"),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(l),l.on("beforeChange",function(t,e){var i=e.text.join("").replace(/\n/g,"");return e.update&&e.update(e.from,e.to,[i]),!0;}),e&&(a.setSelectedItems([e.name]),n.find(".brtc-va-refine-simplefilter-condition").val(e.condition),l.setValue(e.columnValue)),a.onChange(function(t,e){i.checkValidation();}),n.find(".brtc-va-refine-simplefilter-condition").on("change",function(){i.checkValidation();}),l.on("change",function(t){i.checkValidation();}),r.find(".brtc-va-editors-sheet-controls-columnselector-columncontainer-element-empty").css({width:"100%","margin-left":"0px"});},e.prototype.getAdditionalQueryString=function(){var t=this.$mainControl.find(".brtc-va-refine-simplefilter-column-item"),e=this.getRadioButtonValue(),i=[];return $.each(t,function(e,o){var n,r=$(t[e]).find(".brtc-va-refine-simplefilter-column-name").data("columnList").getSelectedItems()[0];if(void 0!==r){n=$(t[e]).find(".brtc-va-refine-simplefilter-condition").val();var a=$(t[e]).find(".CodeMirror")[0].CodeMirror.getValue();i[e]="`"+r+"` "+n+" "+a+" ";}}),i[1]?"WHERE "+i[0]+"\n"+e+" "+i[1]:"WHERE "+i[0];},e.prototype.getRadioButtonValue=function(){var t="",e=this.$mainControl.find(".brtc-va-dialogs-simplefilter-type-and"),i=this.$mainControl.find(".brtc-va-dialogs-simplefilter-type-or");return e.jqxRadioButton("checked")?t="and":i.jqxRadioButton("checked")&&(t="or"),t;},e.prototype.handleOkClicked=function(){if(this.problems.length>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("There is a problem with some values.");else{var e=this.getAdditionalQueryString();this.buildFunctionUnit("Simple Filter","simpleFilter","*",e),t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);}},e.prototype.buildFunctionUnit=function(e,i,o,n){var r=this.DEFAULT_FN_UNIT;r.fid=this.options.fid?this.options.fid:t.VA.Core.Utils.IDGenerator.func.id(),r.func=i,r.name="python"===this.options.context?"PythonScript":"SQLExecutor",r.inData=this.options.in,r.outData=this.options.out,r.param={select:o,"additional-query":n},"python"===this.options.context&&(r.param.script=this.buildScript(o,n),r.param["out-table-alias"]=["result"]),r.display={label:e},this.resultFnUnit=r;},e.prototype.buildScript=function(t,e){var i=this.DEFAULT_SCRIPT,o=t.replace(/\n/g,""),n=e.replace(/\n/g,"");return i=(i=i.replace("${SELECT_SQL}",o)).replace("${ADDITIONAL_QUERY}",n);},e.prototype.renderValidation=function(){},e.prototype.checkValidation=function(){var t=this;this.removeValidation();var e=this.$mainControl.find(".brtc-va-refine-simplefilter-column-item");$.each(e,function(i,o){var n,r,a=$(e[i]).find(".brtc-va-refine-simplefilter-column-name").data("columnList").getSelectedItems()[0];if(0==i&&null==a)t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:i,param:"Column",messageParam:["Column"]}));else if(0==i||1==i&&null!=a){n=$(e[i]).find(".brtc-va-refine-simplefilter-condition").val(),r=$(e[i]).find(".CodeMirror")[0].CodeMirror.getValue(),""==n?t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:i,param:"Operator",messageParam:["Operator"]})):""==r&&t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:i,param:"Value",messageParam:["Value"]}));}}),this.renderValidation();},e.prototype.destroy=function(){this.destroyColumnSelector(),this.destroyDropDownList(),this.$mainControl.dialog("destroy"),"function"==typeof this.options.close&&this.options.close(this.dialogResult);},e.prototype.destroyDropDownList=function(){var t=$(".brtc-va-refine-simplefilter-condition");t.length>0&&t.jqxDropDownList("destroy");},t.VA.Core.Dialogs.RefineSteps.SimpleFilterDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.RefineSteps.StepDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype),e.prototype.constructor=e,e.prototype.getTitle=function(){return"Sorter";},e.prototype.createDialogContentsArea=function(e){var i=this;e.append('<div class="brtc-va-refine-sortcolumn-newcolumn-container"></div><div class="brtc-va-refine-sortcolumn-addbutton">+ Add New Column</div>'),e.find(".brtc-va-refine-sortcolumn-newcolumn-container").sortable({axis:"y",containment:".brtc-va-refine-sortcolumn-newcolumn-container",helper:function helper(t,e){var i=$(e).clone();return i.css("position","absolute"),i.get(0);},handle:".brtc-va-refine-sortcolumn-column-sort",stop:function stop(t,e){}}),e.find(".brtc-va-refine-sortcolumn-newcolumn-container").disableSelection(),this.render(),e.find(".brtc-va-refine-sortcolumn-addbutton").jqxButton({theme:t.VA.Env.Theme}).click(function(){i.createNewSortItem(),i.checkValidation();}),e.perfectScrollbar(),e.perfectScrollbar("update");},e.prototype.render=function(){if(this.options.param){var t=this.options.param["additional-query"].replace(/ \n/gi,"\n").split("\n");t[0].startsWith("ORDER BY")&&t.splice(0,1),""==t[t.length-1]&&t.splice(t.length-1,1);for(var e=0;e<t.length;e++){var i=t[e].replace(/`/gi,"").replace(",","").split(" "),o=i[0].replace(" ",""),n=i[1].replace(" ","");this.createNewSortItem({name:o,"sort-mode":n});}}else this.createNewSortItem();this.checkValidation();},e.prototype.createNewSortItem=function(t){var e=this,i=this.$mainControl.find(".brtc-va-refine-sortcolumn-newcolumn-container"),o=$('<div class="brtc-va-refine-sortcolumn-column-item">   <div class="brtc-va-refine-sortcolumn-column-sort" style="cursor: pointer;"><i class="fa fa-bars"></i></div>   <div class="brtc-va-refine-sortcolumn-column-name"></div>   <div class="brtc-va-refine-sortcolumn-column-propertycontrol-button"><i class="fa fa-sort"></i></div>   <div class="brtc-va-refine-sortcolumn-column-remove"></div></div>');i.append(o);var n=o.find(".brtc-va-refine-sortcolumn-column-name"),r=this.createColumnList(n,{rowCount:1,multiple:!1,showOpener:"click",removable:!1,fromModal:!0},"brtc-va-editors-sheet-controls-width-10",{height:"25px","padding-left":"4px"});r.setItems(this.options.columns),o.data("columnList",r);var a=o.find(".brtc-va-refine-sortcolumn-column-propertycontrol-button");this.createButton(a,{width:"19px",height:"19px"},"",{float:"left","margin-left":"3px"}),a.data("sort-mode","ASC"),a.on("click",function(){var t=r.getSelectedItems(),i=$.grep(e.options.columns,function(e,i){return e.name===t[0];});i&&i.length>0&&("ASC"===a.data("sort-mode")?a.data("sort-mode","DESC"):a.data("sort-mode","ASC"),e.updateSortModeIcon(a,r));}),r.onChange(function(t,i){e.updateSortModeIcon(a,r),e.checkValidation();}),o.find(".brtc-va-refine-sortcolumn-column-remove").click(function(){$(this).closest(".brtc-va-refine-sortcolumn-column-item").remove(),e.checkValidation();}),t&&(r.setSelectedItems([t.name]),a.data("sort-mode",t["sort-mode"]),this.updateSortModeIcon(a,r)),o.find(".brtc-va-refine-sortcolumn-column-sort").css("margin-bottom","5px");},e.prototype.createAdditionalQuery=function(){var t="ORDER BY \n",e=this.$mainControl.find(".brtc-va-refine-sortcolumn-newcolumn-container").find(".brtc-va-refine-sortcolumn-column-item");return e.each(function(i,o){var n=$(o).data("columnList"),r=$(o).find(".brtc-va-refine-sortcolumn-column-propertycontrol-button"),a=n.getSelectedItems();if(a.length){var s=r.data("sort-mode");t+="`"+a[0]+"` "+s,t+=i<e.length-1?", \n":" \n";}}),t;},e.prototype.handleOkClicked=function(){if(this.problems.length>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("There is a problem with some values.");else{var e=this.createAdditionalQuery();this.buildFunctionUnit("Sort","sortByRefine","*",e),t.VA.Core.Dialogs.RefineSteps.StepDialog.prototype.handleOkClicked.call(this);}},e.prototype.buildFunctionUnit=function(e,i,o,n){var r=this.DEFAULT_FN_UNIT;r.fid=this.options.fid?this.options.fid:t.VA.Core.Utils.IDGenerator.func.id(),r.func=i,r.name="python"===this.options.context?"PythonScript":"SQLExecutor",r.inData=this.options.in,r.outData=this.options.out,r.param={select:o,"additional-query":n},"python"===this.options.context&&(r.param.script=this.buildScript(o,n),r.param["out-table-alias"]=["result"]),r.display={label:e},this.resultFnUnit=r;},e.prototype.buildScript=function(t,e){var i=this.DEFAULT_SCRIPT,o=t.replace(/\n/g,""),n=e.replace(/\n/g,"");return i=(i=i.replace("${SELECT_SQL}",o)).replace("${ADDITIONAL_QUERY}",n);},e.prototype.renderValidation=function(){var t=this,e=this.$mainControl.find(".brtc-va-refine-sortcolumn-newcolumn-container").find(".brtc-va-refine-sortcolumn-column-item");$.each(this.problems,function(i,o){-1==o.paramIndex||(t.createValidationContent($(e[o.paramIndex]),o),$(e[o.paramIndex]).find(".brtc-va-refine-step-validation-tooltip").css({clear:"",float:"left","margin-top":"0px","margin-bottom":"10px","margin-left":"35px"}));});},e.prototype.checkValidation=function(){var t=this;this.removeValidation();var e=this.$mainControl.find(".brtc-va-refine-sortcolumn-newcolumn-container").find(".brtc-va-refine-sortcolumn-column-item"),i=[];e.length?e.each(function(e,o){var n=$(o).data("columnList").getSelectedItems();if(n.length){if($.inArray(n[0],i)>-1){var r="Select column(s) - '"+n[0]+"' already exist.";t.addProblem(t.createProblem({errorCode:"BR-0100",paramIndex:e,param:"Select column",messageParam:[r]}));}else i.push(n[0]);}else t.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:e,param:"Select column",messageParam:["Select column"]}));}):this.addProblem(t.createProblem({errorCode:"BR-0033",paramIndex:-1,param:"Column",messageParam:["Column"]})),this.renderValidation();},e.prototype.updateSortModeIcon=function(t,e){var i=e.getSelectedItems(),o=$.grep(this.options.columns,function(t,e){return t.name===i[0];}),n=t.data("sort-mode");if(o&&o.length>0){var r,a=o[0].type;t.find("i").removeClass(),"string"===a?(r="fa fa-sort-alpha-"+n.toLowerCase(),t.find("i").addClass(r)):"number"===a||"date"===a?(r="fa fa-sort-numeric-"+n.toLowerCase(),t.find("i").addClass(r)):(r="fa fa-sort",t.find("i").addClass(r));}},e.prototype.destroy=function(){this.destroyColumnSelector(),this.$mainControl.dialog("destroy"),"function"==typeof this.options.close&&this.options.close(this.dialogResult);},t.VA.Core.Dialogs.RefineSteps.SortDialog=e;}.call(this),function(){"use strict";var t=this,e=t.Brightics;function i(t,i){e.VA.Dialogs.Dialog.call(this,t,i);}i.prototype=Object.create(e.VA.Dialogs.Dialog.prototype),i.prototype.constructor=i,i.prototype.checkInfo=function(){Studio.getEditorContainer().getActiveModelEditor().checkInfo();},i.prototype._initOptions=function(){e.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=1400,this.dialogOptions.height=700,this.dialogOptions.maxWidth=1400,this.dialogOptions.maxHeight=700;},i.prototype.createDialogContentsArea=function(t,e){this.scriptEditorOptions={statement:"",scriptType:"",mode:"",dataMap:{},fnUnit:{},additionalHint:[],maxLength:999999,close:function close(t){}},$.extend(!0,this.scriptEditorOptions,this.options),this.createLayout(),this.renderInfoArea(),this.renderEditorArea(),this.renderResultArea(),this.registerEvent();},i.prototype.destroy=function(){this.$outTableType.jqxDropDownList("destroy"),e.VA.Dialogs.Dialog.prototype.destroy.call(this);},i.prototype.createLayout=function(){this.$contentArea=this.$mainControl.find(".brtc-va-dialogs-contents");var t=!!this.options.scriptOnly&&this.options.scriptOnly;this.$editorArea=$('<div class="brtc-va-dialogs-contents-statement" script-only="'+t+'">   <textarea></textarea>   <div class="brtc-va-dialogs-contents-statement-error">Up to '+e.VA.Core.Utils.CommonUtils.numberToStringWithComma(this.scriptEditorOptions.maxLength)+" characters can be entered.</div></div>"),this.$errorArea=this.$editorArea.find(".brtc-va-dialogs-contents-statement-error"),this.$infoArea=$('<div class="brtc-va-dialogs-contents-info" script-only="'+t+'">'),this.$contentArea.append(this.$editorArea).append(this.$infoArea),this.$infoArea.perfectScrollbar();var i=this;this.$mainControl.on("resized",function(t){i.$infoArea.perfectScrollbar("update");});},i.prototype.registerEvent=function(){this.$editorArea.find("textarea").bind("showOverflow",function(){$(this).siblings(".brtc-va-dialogs-contents-statement-error").show();}),this.$editorArea.find("textarea").bind("hideOverflow",function(){$(this).siblings(".brtc-va-dialogs-contents-statement-error").hide();});},i.prototype.renderEditorArea=function(){this.codeMirror=CodeMirror.fromTextArea(this.$editorArea.find("textarea")[0],{mode:this.scriptEditorOptions.mode,theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!1,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{list:this.scriptEditorOptions.additionalHint}}),e.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror),e.VA.Core.Utils.WidgetUtils.setCodeMirrorMaxLength(this.codeMirror),this.setEditorStatement(this.options.statement),this.codeMirror.setSize("100%","100%"),this.codeMirror.setOption("maxLength",this.scriptEditorOptions.maxLength);},i.prototype.renderResultArea=function(t){},i.prototype.setEditorStatement=function(t){this.codeMirror.setValue(t),this.codeMirror.clearHistory();},i.prototype.renderInfoArea=function(){},i.prototype.handleOkClicked=function(){this.dialogResult={OK:!0,Cancel:!1,queryStatement:this.codeMirror.getValue()},this.$mainControl.dialog("close");},i.prototype.createDropDownList=function(t,i,o,n){this.$outTableType=$('<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-type" tableId="'+n+'"></div>'),t.append(this.$outTableType);var r={theme:e.VA.Env.Theme,width:"100%",height:"20px",source:[{text:"TABLE",value:"table"},{text:"MODEL",value:"model"},{text:"IMAGE",value:"image"}],displayMember:"text",selectedIndex:0,valueMember:"value",dropDownHeight:70};this.$outTableType.jqxDropDownList(r);},i.prototype.createInput=function(i,o,n,r){this.wrapControl(i);var a="";n&&(a=a.concat(" ",n)),i.attr("type")||i.attr("type","text"),i.attr("maxlength")||i.attr("maxlength","100"),this.addClassToWrapper(i,a),this.addCssToWrapper(i,r);var s={theme:e.VA.Env.Theme,height:"25px"};o&&$.extend(s,o),i.jqxInput(s);var l=i.val();i.focus(function(){l=i.val();}),$("svg").on("mousedown",function(){i.val()!==l&&i.is(":focus")&&i.trigger("change");}),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(i);},i.prototype.createRadioButton=function(t,i,o,n){this.wrapControl(t);var r="brtc-va-editors-sheet-controls-radiobutton-default";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={theme:e.VA.Env.Theme};return i&&$.extend(a,i),t.jqxRadioButton(a),t;},i.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');t.wrap(e);},i.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},i.prototype.addCssToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.css(e);}},e.VA.Core.Dialogs.ScriptEditorDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=600,this.dialogOptions.height=800;},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px"></div>       <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit"></div>       <div class="brtc-va-dialogs-buttonbar"></div>   </div></div>'),this.$titleArea=this.$mainControl.find(".brtc-va-dialogs-title");},e.prototype.initContents=function(){t.VA.Dialogs.Dialog.prototype.initContents.call(this),this.createTitleArea();},e.prototype.createTitleArea=function(){this.createLabel(),this.createHelp(),this.createContext(),this.setLabel();},e.prototype.createLabel=function(){this.$label=$('<div class="brtc-va-dialogs-title-label brtc-style-flex-1"></div>'),this.$titleArea.append(this.$label);},e.prototype.createHelp=function(){this.$help=$('<div class="brtc-va-dialogs-title-help">   <div class="brtc-va-editors-sheet-panels-propertiespanel-header-help" title="Help"></div></div>'),this.$titleArea.append(this.$help),this.createHelpPopover();},e.prototype.createContext=function(){var t=this;this.$contenxt=$('<div class="brtc-va-dialogs-title-contenxt">   <div class="brtc-va-editors-sheet-panels-propertiespanel-header-more-menu"></div></div>'),this.$titleArea.append(this.$contenxt),this.createPropertiesContextMenu(),this.$contenxt.on("click",function(e){var i=$(window).scrollTop(),o=$(window).scrollLeft(),n=parseInt(e.clientX)+o;$(window).width()-e.clientX<100&&(n-=130);var r=parseInt(e.clientY)+i;r+=5,t.$ctxMenu.jqxMenu("open",n,r),$(window).on("resize",t.ctxMenuCloseHandler);});},e.prototype.setLabel=function(t){t=t||this.options.fnUnit.display.label;this.$label.text(t);},e.prototype.createHelpPopover=function(){var e=this;this.$help.click(function(){var i=e.getPrimaryOperation(),o=e.getFunctionDef().defaultFnUnit.context||"scala";"process"===e.getFunctionDef().category&&(o="common"),t.VA.Core.Utils.ModelUtils.openFunctionReferencePopup("data",i,o);});},e.prototype.createPropertiesContextMenu=function(){var e=this,i=$('<div class="brtc-va-editors-sheet-panels-propertiespanel-header-ctxmenu">   <ul>       <li action="rename">Edit</li>   </ul></div>');this.$titleArea.append(i),this.$ctxMenu=i.jqxMenu({theme:t.VA.Env.Theme,width:"120px",height:"120px",autoOpenPopup:!1,mode:"popup",animationHideDuration:0,animationShowDuration:0}),this.$ctxMenu.on("itemclick",function(i){if("rename"==$(i.args).attr("action")){var o={title:"Edit Function",label:e.options.fnUnit.display.label,description:e.options.fnUnit.display.description||"",close:function close(t){t.OK&&(e.setLabel(t.label),e.options.fnUnit.display.label=t.label,e.options.fnUnit.display.description=t.description);}};new t.VA.Core.Dialogs.EditResourceDialog($(document.body),o);}}),this.ctxMenuCloseHandler=function(){e.$ctxMenu.jqxMenu("close");},this.$ctxMenu.on("closed",function(){$(window).off("resize",e.ctxMenuCloseHandler);});},e.prototype.getPrimaryOperation=function(){var e=this.options.editor.getModel().type;return t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(e,this.options.fnUnit.func).defaultFnUnit.name;},e.prototype.getFunctionDef=function(){var e=this.options.editor.getModel().type;return t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(e,this.options.fnUnit.func);},t.VA.Core.Dialogs.FnUnitDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils;function i(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}i.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),i.prototype.constructor=i,i.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=685,this.dialogOptions.height=435,this.projectId=this.options.editorInput.getProjectId(),this.fileId=this.options.editorInput.getFileId();},i.prototype.createDialogContentsArea=function(i){var o=this;i.append('<div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Schedule Name</div>   <input type="text" class="brtc-va-dialogs-schedule-name-input" valid-type="type2" maxlength="80"/></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Cron Expression</div>   <input type="text" class="brtc-va-dialogs-schedule-cron-input" valid-type="cronType" maxlength="80"/>   <div class="brtc-va-dialogs-schedule-cron-help"></div>   <div class="brtc-va-dialogs-schedule-cron-checkbox">IMMEDIATE</div></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Schedule Owner</div>   <input type="text" class="brtc-va-dialogs-schedule-owner-input brtc-style-text-overflow-ellipsis" valid-type="type1" maxlength="80"/></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Is Active</div>   <div class="brtc-va-dialogs-schedule-active-selector"></div></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Dependency Schedule</div>   <div class="brtc-va-dialogs-schedule-dependency-selector"></div></div><div class="brtc-va-dialogs-schedule-row brtc-style-margin-top-5">   <div class="brtc-va-dialogs-schedule-label">Model Version</div>   <input type="text" class="brtc-va-dialogs-schedule-model-version-input" />   <input type="button" class="brtc-va-dialogs-model-version-load" value="Select Version"/></div>'),this.$scheduleNameInput=i.find(".brtc-va-dialogs-schedule-name-input").jqxInput({theme:t.VA.Env.Theme}),e.InputValidator.appendValidationCondition(this.$scheduleNameInput),t.VA.Core.Utils.WidgetUtils.setTrimInputControlOnFocusout(i.find(".brtc-va-dialogs-schedule-name-input")),this.$cronInput=i.find(".brtc-va-dialogs-schedule-cron-input").jqxInput({theme:t.VA.Env.Theme}),e.InputValidator.appendValidationCondition(this.$cronInput),$(".brtc-va-dialogs-schedule-cron-help").on("click",function(){window.open("cron-expression","Brightics Cron Expression Help");}),this.$chkimmediate=i.find(".brtc-va-dialogs-schedule-cron-checkbox").jqxCheckBox({theme:t.VA.Env.Theme}),this.$chkimmediate.on("change",function(t){1==t.args.checked?o.$cronInput.jqxInput({disabled:!0,value:"IMMEDIATE"}):o.$cronInput.jqxInput({disabled:!1,value:""});}),this.$scheduleOwnerInput=i.find(".brtc-va-dialogs-schedule-owner-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0,value:t.VA.Env.Session.userId}),this.$activeSelector=i.find(".brtc-va-dialogs-schedule-active-selector").jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,source:["Y","N"],selectedIndex:0}),this.$dependencySelector=i.find(".brtc-va-dialogs-schedule-dependency-selector").jqxDropDownList({theme:t.VA.Env.Theme,displayMember:"scheduleName",valueMember:"scheduleId",placeHolder:"Please Choose:",dropDownHeight:300}),this.$modelVersionInput=i.find(".brtc-va-dialogs-schedule-model-version-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0,placeHolder:"Select version"}),this.$loadVersionButton=i.find(".brtc-va-dialogs-model-version-load"),this.$loadVersionButton.jqxButton({theme:t.VA.Env.Theme,width:120,height:27}),this.$loadVersionButton.on("click",function(){o.openSelectVersionDialog();});var n=[];n.push(new Promise(function(i,n){$.ajax({url:"api/admin/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(t){$.each(t,function(i,o){t[i].scheduleId=e.WidgetUtils.convertHTMLSpecialChar(o.scheduleId);}),o.$dependencySelector.jqxDropDownList({source:t}),o.$dependencySelector.jqxDropDownList("insertAt","",0);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});})),Promise.all(n).catch(function(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog(e);}).then(function(){}),o.initData();},i.prototype.openSelectVersionDialog=function(){var e=function(t){if(t.OK){var e=t.data;this.$modelVersionInput.val(e.getVersion()),this.versionId=e.getVersionId(),this.versionContents=e.getContents();}}.bind(this);new t.VA.Core.Dialogs.SelectVersionDialog(this.$mainControl,{projectId:this.projectId,fileId:this.fileId,close:e});},i.prototype.initData=function(e){var i=this;i.fileList={};var o=Studio.getResourceManager();o.fetchProjects().then(function(t){return $.each(t,function(t,e){e.getProjectId()===i.options.editorInput.getProjectId()&&(i.projectLabel=e.getLabel());}),i.fileList[i.options.editorInput.getProjectId()]={},o.fetchFiles(i.options.editorInput.getProjectId()).then(function(t){return $.each(t,function(t,e){i.fileList[i.options.editorInput.getProjectId()][e.getFileId()]=e;}),!0;});}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},i.prototype.handleOkClicked=function(){var e=this;if(""===e.$scheduleNameInput.val())return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter schedule name."),void $(".brtc-va-dialogs-schedule-name-input").focus();if(""!==e.$modelVersionInput.val()){if(""===_.trim(e.$cronInput.val()))return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter cron expression."),void $(".brtc-va-dialogs-schedule-cron-input").focus();if(!$(".brtc-va-dialogs-schedule-cron-checkbox").jqxCheckBox("checked")&&!new RegExp("^\\s*($|#|\\w+\\s*=|(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[01]?\\d|2[0-3])(?:(?:-|/|\\,)(?:[01]?\\d|2[0-3]))?(?:,(?:[01]?\\d|2[0-3])(?:(?:-|/|\\,)(?:[01]?\\d|2[0-3]))?)*)\\s+(\\?|\\*|(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?(?:,(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?)*)\\s+(\\?|\\*|(?:[1-9]|1[012])(?:(?:-|/|\\,)(?:[1-9]|1[012]))?(?:L|W)?(?:,(?:[1-9]|1[012])(?:(?:-|/|\\,)(?:[1-9]|1[012]))?(?:L|W)?)*|\\?|\\*|(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?(?:,(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?)*)\\s+(\\?|\\*|(?:[0-6])(?:(?:-|/|\\,|#)(?:[0-6]))?(?:L)?(?:,(?:[0-6])(?:(?:-|/|\\,|#)(?:[0-6]))?(?:L)?)*|\\?|\\*|(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?(?:,(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?)*)(|\\s)+(\\?|\\*|(?:|\\d{4})(?:(?:-|/|\\,)(?:|\\d{4}))?(?:,(?:|\\d{4})(?:(?:-|/|\\,)(?:|\\d{4}))?)*))$").test(e.$cronInput.val()))return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Syntax error in cron expression."),void $(".brtc-va-dialogs-schedule-cron-input").focus();e.modelDBContents=this.options.editorInput.getContents();var i=function i(_i15){_i15.OK&&t.VA.Core.Utils.RunnableFactory.createForFlow(e.versionContents,void 0,void 0,_i15.args).then(function(o){var n=_.merge(o,{duration:_i15.duration});_.forIn(n.models,function(e){_.forEach(e.functions,function(e){t.VA.Core.Utils.ModelUtils.carvePersist(e,!0);});}),delete n.report;var r={scheduleId:t.VA.Core.Utils.IDGenerator.schedule.id(),scheduleName:e.$scheduleNameInput.val(),cronExpression:e.$cronInput.val(),scheduleOwner:t.VA.Env.Session.userId,scheduleType:"JSON",executeContents:JSON.stringify(n),fileId:e.options.editorInput.getLabel(),projectId:e.projectLabel,isActive:e.$activeSelector.val(),modifyUser:t.VA.Env.Session.userId,dependencyId:e.$dependencySelector.val()},a={url:"api/admin/v2/schedules",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(r),blocking:!0};$.ajax(a).done(function(){t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(e);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});});};"true"===t.VA.SettingStorage.getValue("editor.variable.visible")&&"data"===e.modelDBContents.type&&e.modelDBContents.hasOwnProperty("variables")&&Object.keys(e.modelDBContents.variables).length>0?new t.VA.Core.Dialogs.RunDataDialog(e.$parent,{close:i,analyticsModel:e.modelDBContents}):i({OK:!0});}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please select model version.");},i.prototype.destroy=function(){this.$activeSelector.jqxDropDownList("destroy"),this.$dependencySelector.jqxDropDownList("destroy"),t.VA.Dialogs.Dialog.prototype.destroy.call(this);},t.VA.Core.Dialogs.AddScheduleDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=400,this.dialogOptions.height=300;},e.prototype.createDialogContentsArea=function(e){e.append('<div class="brtc-va-dialogs-add2lib-library-label">Template</div><div class="brtc-va-dialogs-add2lib-library-selector"></div><div class="brtc-va-dialogs-add2lib-library-label">Name</div><input type="text" class="brtc-va-dialogs-add2lib-library-name-input" maxlength="80"/><div class="brtc-va-dialogs-add2lib-library-preview"></div>');var i=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"id"},{name:"label"}],url:"api/va/v2/ws/libraries",async:!0});this.$librarySelector=e.find(".brtc-va-dialogs-add2lib-library-selector").jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,source:i,selectedIndex:0,displayMember:"label",valueMember:"id",width:"calc(100% - 100px)",height:"25px"}),this.$nameInput=e.find(".brtc-va-dialogs-add2lib-library-name-input").jqxInput({theme:t.VA.Env.Theme,placeHolder:"Enter name",width:"calc(100% - 100px)",height:"25px"});},e.prototype.setFocus=function(){this.$nameInput.focus();},e.prototype.handleOkClicked=function(){this.$librarySelector.val()&&this.$nameInput.val().trim()?(this.dialogResult.library=this.$librarySelector.val(),this.dialogResult.label=this.$nameInput.val().trim(),t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)):t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter template and name.",function(){});},t.VA.Core.Dialogs.AddToLibraryDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils,i=t.VA.Dialogs.Dialog.prototype;function o(t,e){i.constructor.call(this,t,e);}o.prototype=Object.create(i),o.prototype.constructor=o,o.prototype._initOptions=function(){i._initOptions.call(this),this.dialogOptions.width=760,this.dialogOptions.height=480,this.dialogOptions.maxHeight=480,this.dialogOptions.title="Update Version",this.options.resourceManager=Studio.getResourceManager(),this.options.file=this.options.resourceManager.getFile(this.options.projectId,this.options.fileId);},o.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-add-version-contents"),t.append('<div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Update</div>   <div class="brtc-va-dialogs-add-version-radio-group brtc-va-dialogs-row-flex-layout">       <div class="brtc-va-dialogs-add-version-major-radio">Major Version (X.o)</div>       <div class="brtc-va-dialogs-add-version-minor-radio">Minor Version (o.X)</div>   </div></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Name</div>   <input type="text" class="brtc-va-dialogs-add-version-name-input brtc-style-flex-1" maxlength="80"></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Description</div>   <div class="brtc-va-dialogs-add-version-description-container" /></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Tags</div>   <input type="text" class="brtc-va-dialogs-add-version-tags-input brtc-style-flex-1" maxlength="80"></div>'),this.$mainRadiobox=t.find(".brtc-va-dialogs-add-version-major-radio"),this.$subRadiobox=t.find(".brtc-va-dialogs-add-version-minor-radio"),this.createVersionControl(this.$mainRadiobox,this.$subRadiobox),this.createNameControl(t.find(".brtc-va-dialogs-add-version-name-input")),this.createTagsControl(t.find(".brtc-va-dialogs-add-version-tags-input")),this.createDescriptionControl(t.find(".brtc-va-dialogs-add-version-description-container")),this.$mainControl.dialog(this.dialogOptions),this.$tagsControl.focus();},o.prototype.createNameControl=function(e){this.$nameControl=e.jqxInput({disabled:"true",theme:t.VA.Env.Theme}),this.$nameControl.val(this.options.file.getLabel());},o.prototype.createTagsControl=function(e){this.$tagsControl=e.jqxInput({placeHolder:"Enter Tags",theme:t.VA.Env.Theme}),this.$tagsControl.val(this.options.tags);},o.prototype.createDescriptionControl=function(e){var i=this,o={focus:!1,height:155,description:this.options.file.description,okButton:this.$okButton,maxLength:2e3,toolbar:this.options.toolbar};this.noteControl=t.VA.Core.Widget.Factory.noteControl(e,o),this.$mainControl.on("resizing",function(t){i.noteControl.setHeight(i.$mainControl.find(".brtc-va-dialogs-contents").height()-110);});},o.prototype.createVersionControl=function(e,i){e.jqxRadioButton({theme:t.VA.Env.Theme,checked:!1,groupName:"update-version"}),i.jqxRadioButton({theme:t.VA.Env.Theme,checked:!0,groupName:"update-version"});},o.prototype.handleOkClicked=function(){this.debounced=this.debounced||_.debounce(function(){var e=this.noteControl.getCode();"<p><br></p>"===e&&(e="");var o=Studio.getResourceManager().getFile(this.options.projectId,this.options.fileId).getLabel(),n=new t.VA.Vo.Version();n.setVersionId(t.VA.Core.Utils.IDGenerator.version.id()),n.setTags(this.$tagsControl.val()),n.setLabel(o),n.setDescription(e),n.setIsMajor(!!this.$mainRadiobox.jqxRadioButton("checked")),this.options.resourceManager.addVersion(this.options.projectId,this.options.fileId,n).then(i.handleOkClicked.bind(this)).catch(this._onError.bind(this));}.bind(this),300),this.debounced();},o.prototype._onError=function(t){e.WidgetUtils.openBadRequestErrorDialog(t),this.close();},t.VA.Core.Dialogs.AddVersionDialog=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=600,this.dialogOptions.height=500;},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Array Delimiter</div>   <input type="text" class="brtc-va-dialogs-delimiter-input" param="array-delimiter" placeholder="Unicode #2" maxlength="80"></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Key Value Delimiter</div>   <input type="text" class="brtc-va-dialogs-delimiter-input" param="key-value-delimiter" placeholder="Unicode #3" maxlength="80"></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Array Start String</div>   <input type="text" class="brtc-va-dialogs-delimiter-input" param="array-start-string" placeholder="[" maxlength="80"></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Array End String</div>   <input type="text" class="brtc-va-dialogs-delimiter-input" param="array-end-string" placeholder="]" maxlength="80"></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Map Start String</div>   <input type="text" class="brtc-va-dialogs-delimiter-input" param="map-start-string" placeholder="{" maxlength="80"></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-delimiter-input-label">Map End String</div>   <input type="text" class="brtc-va-dialogs-delimiter-input" param="map-end-string" placeholder="}" maxlength="80"></div>'),this.createInputControls(t.find(".brtc-va-dialogs-delimiter-input")),this.fillInputControls(t.find(".brtc-va-dialogs-delimiter-input"));},e.prototype.createInputControls=function(e){e.jqxInput({theme:t.VA.Env.Theme});},e.prototype.fillInputControls=function(t){for(var e,i,o,n=this.options.delimiters,r=this.options.defaultDelimiter,a=0;a<t.length;a++){o=n[i=(e=$(t[a])).attr("param")]===r[i]?"":n[i],e.val(o);}},e.prototype.handleOkClicked=function(){for(var t,e={},i=this.$mainControl.find(".brtc-va-dialogs-delimiter-input"),o=0;o<i.length;o++){e[(t=$(i[o])).attr("param")]=t.val();}this.dialogResult={OK:!0,Cancel:!1,delimiters:e},this.$mainControl.dialog("close");},t.VA.Core.Dialogs.AdvancedLoadSettingDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=600,this.dialogOptions.height=250;},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-dialogs-row-flex-layout" style="flex-direction: column;">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-checkpoint-group"></div>   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-checkpoint-file"></div></div>'),this.createCheckpointGroupControl(t.find(".brtc-va-dialogs-checkpoint-group")),this.createCheckpointControl(t.find(".brtc-va-dialogs-checkpoint-file")),this.init();},e.prototype.init=function(){this.isRendered=!1,this.splitedCheckpointPath=this.splitCheckpointFullPath(this.options.checkpointPath),this.getCheckPointGroupList();},e.prototype.createCheckpointGroupControl=function(e){var i=this,o=$('<div class="brtc-va-dialogs-checkpoint-group-wrapper" style="width:100%; margin-top: 10px;">   <div class="brtc-va-dialogs-checkpoint-group-label" style="width:120px; float: left; font-weight: bold;">Checkpoint Group</div>   <div class="brtc-va-dialogs-checkpoint-group-dropdownlist"></div></div>');e.append(o),this.$checkpointGroup=o.find(".brtc-va-dialogs-checkpoint-group-dropdownlist"),this.$checkpointGroup.jqxDropDownList({placeHolder:"please choose",displayMember:"name",valueMember:"path",theme:t.VA.Env.Theme,width:"calc(100% - 125px)",height:"25px",openDelay:0}),i.$checkpointGroup.on("change",function(){var t=i.$checkpointGroup.jqxDropDownList("getSelectedItem");i.dialogResult.checkpointPath="",i.getCheckPointList(t.label);});},e.prototype.createCheckpointControl=function(e){var i=this,o=$('<div class="brtc-va-dialogs-checkpoint-file-wrapper" style="width:100%; margin-top: 10px;">   <div class="brtc-va-dialogs-checkpoint-file-label" style="width:120px; float: left; font-weight: bold;">Checkpoint</div>   <div class="brtc-va-dialogs-checkpoint-file-dropdownlist"></div></div>');e.append(o),this.$checkpoint=o.find(".brtc-va-dialogs-checkpoint-file-dropdownlist"),this.$checkpoint.jqxDropDownList({placeHolder:"please choose",displayMember:"name",valueMember:"path",theme:t.VA.Env.Theme,width:"calc(100% - 125px)",height:"25px",openDelay:0}),i.$checkpoint.on("change",function(){i.dialogResult.checkpointPath=$(this).val();});},e.prototype.getCheckPointGroupList=function(e){var i=this,o={url:"api/va/v2/dl/browse?path=/checkpoint/"+t.VA.Env.Session.userId,type:"GET",blocking:!0,contentType:"application/json; charset=utf-8"};$.ajax(o).done(function(t){var e=i.splitedCheckpointPath.prefix,o=i.splitedCheckpointPath.splitKey,n=i.splitedCheckpointPath.checkpointGroup;i.$checkpointGroup.jqxDropDownList({source:t}),i.isRendered||i.$checkpointGroup.val(e+o+n);});},e.prototype.getCheckPointList=function(e){var i=this,o={url:"api/va/v2/dl/browse?path=/checkpoint/"+t.VA.Env.Session.userId+"/"+e,type:"GET",blocking:!1,contentType:"application/json; charset=utf-8"};$.ajax(o).done(function(t){if(i.$checkpoint.jqxDropDownList("clear"),i.$checkpoint.jqxDropDownList({source:t}),!i.isRendered){var e=i.splitedCheckpointPath.prefix,o=i.splitedCheckpointPath.splitKey,n=i.splitedCheckpointPath.checkpointGroup,r=i.splitedCheckpointPath.checkpoint;i.$checkpoint.val(e+o+n+"/"+r),i.isRendered=!0;}});},e.prototype.splitCheckpointFullPath=function(e){var i=t.VA.Env.Session.userId,o=i+"/",n="",r=[];if(e){var a=e.split(i+"/");n=a[0],r=a[1].split("/");}return{prefix:n,splitKey:o,checkpointGroup:r[0],checkpoint:r[1]};},t.VA.Core.Dialogs.CheckpointBrowserDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-main-clipboard">   <div class="brtc-va-dialogs-body">   </div></div>'),this.$mainControl.dialog(this.dialogOptions),this.$mainControl.parent().draggable("option","containment",this.$mainControl.closest(".brtc-va-editor"));},e.prototype._initOptions=function(){this.dialogOptions={title:"Function Clipboard",appendTo:this.$parent,position:{my:"left top",at:"left bottom",of:this.$parent.find(".brtc-style-s-editor-toolitem[item-type=clipboard]")},width:400,height:600,maxWidth:400,maxHeight:600,modal:!1,resizable:!1},this.destroyOnClose=!0;},e.prototype.initContents=function(){var e=this.$mainControl.find(".brtc-va-dialogs-body");this.$clipboardList=$('<div class="brtc-va-dialogs-body-clipboardlist brtc-style-full brtc-style-relative"></div>'),e.append(this.$clipboardList),this.clipboardExplorer=new t.VA.Core.Views.ClipboardExplorer(this.$clipboardList,{height:"100%",modelType:t.VA.Implementation.DataFlow.Clazz,functionList:$.extend(!0,[],this.options.functionList)}),this.$clipboardList.perfectScrollbar();},e.prototype.updateFunctionList=function(t){this.clipboardExplorer.updateFunctionList(t),this.$clipboardList.perfectScrollbar("update");},e.prototype.setEnable=function(t){var e=this.$mainControl.find(".brtc-va-dialogs-body-disable");!0===t&&e.length>0?e.remove():!0!==t&&0===e.length&&this.$mainControl.append('<div class="brtc-va-dialogs-body-disable"></div>');},e.prototype.isAlive=function(){return!!this.$mainControl;},t.VA.Core.Dialogs.ClipboardDialog=e;}.call(this),function(t){"use strict";var e=t.Brightics;function i(t,i){e.VA.Dialogs.Dialog.call(this,t,i);var o,n=this;this._close=function(t){t.target.classList.contains("ui-widget-overlay")&&n.close();},$(window).on("mousedown",this._close),this.dialogResult.color=i.color,this.options.onClose&&(this.options.close=(o=this.options.onClose,function(t){t.color&&o(t.color);}));}i.prototype=Object.create(e.VA.Dialogs.Dialog.prototype),i.prototype.constructor=i,i.prototype.createDialogContentsArea=function(t){this.$colorPicker=this.createColorPicker(t);},i.prototype._initOptions=function(){e.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.height="auto",this.dialogOptions.width="auto",this.dialogOptions.title="Color Picker";},i.prototype.createColorPicker=function(t){var e=this,i=$("<div></div>");i.jqxColorPicker({height:230,width:275,colorMode:"hue"}),i.jqxColorPicker("setColor",this.options.color),t.append(i);var o=function o(t){return t>=10?String.fromCharCode(t-10+"A".charCodeAt(0)):t.toString();};return i.bind("colorchange",function(t){var i;e.dialogResult.color=(i=t.args.color,"#"+["r","g","b"].map(function(t){var e=parseInt(i[t],10);return[parseInt(e/16,10),e%16].map(o).join("");}).join(""));}),i;},i.prototype.createDialogButtonBar=function(t){var i=this;this.$resetButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Reset" />'),t.append(this.$resetButton),this.$resetButton.jqxButton({theme:e.VA.Env.Theme}),this.$resetButton.click(function(){i.dialogResult.color=i.options.color,i.$colorPicker.jqxColorPicker("setColor",i.options.color);});},i.prototype.destroy=function(){e.VA.Dialogs.Dialog.prototype.destroy.call(this),$(window).off("mousedown",this._close);},e.VA.Dialogs.ColorPickerDialog=i;}(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=450,this.dialogOptions.height=250;},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-dialogs-row-flex-layout">    <span class="brtc-va-dialogs-body-content-icon"></span>    <div class="brtc-va-dialogs-body-content-content-text"><span>'+_.escape(this.options.contentText)+'</span></div></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-option">'+_.escape(this.options.optionText)+"</div></div>"),this.createOptionControl(t.find(".brtc-va-dialogs-contents-option"));},e.prototype.createOptionControl=function(t){this.$includeControl=t.jqxCheckBox({theme:"office",height:25,checked:!0,boxSize:"17px"});},e.prototype.handleOkClicked=function(){this.dialogResult.OPTION=this.$includeControl.jqxCheckBox("val"),t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);},t.VA.Core.Dialogs.ConfirmWithOptionDialog=e;}.call(this),function(t){var e=t.Brightics;function i(t,i){var o=_.extend({title:"Datasource Management"},i);e.VA.Dialogs.Dialog.call(this,t,o);}i.prototype=Object.create(e.VA.Dialogs.Dialog.prototype),i.prototype.constructor=i,i.prototype._initOptions=function(){e.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=800,this.dialogOptions.height=600;},i.prototype.createDialogContentsArea=function(t){return this.datasourceManagementView=new e.VA.Core.Views.DatasourceManagementView(t),this.datasourceManagementView.getElement();},i.prototype.createDialogButtonBar=function(t){e.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this,t),this.$cancelButton.hide(),this.$okButton.val("Close");},i.prototype.destroy=function(){var _e$VA$Dialogs$Dialog$;for(var _len=arguments.length,t=new Array(_len),_key=0;_key<_len;_key++){t[_key]=arguments[_key];}(_e$VA$Dialogs$Dialog$=e.VA.Dialogs.Dialog.prototype.destroy).call.apply(_e$VA$Dialogs$Dialog$,[this].concat(t)),this.datasourceManagementView&&(this.datasourceManagementView.destroy(),this.datasourceManagementView=null);},e.VA.Core.Dialogs.DatasourceManagementDialog=i;}(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.ScriptEditorDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.ScriptEditorDialog.prototype),e.prototype.constructor=e,e.prototype.renderInfoArea=function(){},e.prototype.setEditorStatement=function(t){this.codeMirror.setValue(t),this.codeMirror.clearHistory(),this.selectMarker=this.codeMirror.markText({line:0,ch:0},{line:0,ch:7},{readOnly:!0,inclusiveLeft:!0,atomic:!0});},t.VA.Core.Dialogs.DBReaderSqlEditorDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i),this.selectedVersion="";}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=760,this.dialogOptions.height=480;},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-editresourcedialog-contents"),t.append('           <div class="brtc-va-dialogs-row-flex-layout">             <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold" style="margin-right: 11px;">Target</div>                   <div class="brtc-va-editors-sheet-controls-propertycontrol-input" maxlength="80"></div>           </div>           <div class="brtc-va-dialogs-row-flex-layout">               <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Name</div>                   <input type="text" class="brtc-va-dialogs-editresourcedialog-name-input" maxlength="40"/></div>           <div class="brtc-va-dialogs-row-flex-layout">               <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Description</div>               <div class="brtc-va-dialogs-editresourcedialog-description-container"></div>           </div></div>'),this.createTargetControl(t.find(".brtc-va-editors-sheet-controls-propertycontrol-input")),this.createNameControl(t.find(".brtc-va-dialogs-editresourcedialog-name-input")),this.createDescriptionControl(t.find(".brtc-va-dialogs-editresourcedialog-description-container")),this.$serverControl.focus();},e.prototype.createTargetControl=function(e){var i={datatype:"json",datafields:[{name:"datasourceName"},{name:"datasourceType"}],url:"api/va/v2/ws/deploy/target",async:!0},o=new $.jqx.dataAdapter(i);o.dataBind(i),this.$serverControl=e.jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,width:"91%",placeHolder:"Choose Target Server",selectedIndex:2,source:o,displayMember:"datasourceName"});},e.prototype.createSelectVersionControl=function(e,i){this.$versionInput=e.jqxInput({theme:t.VA.Env.Theme,placeHolder:"Select version"}),this.$versionButton=i.jqxButton({theme:t.VA.Env.Theme});var o=function(t){this.$versionInput.val(t.getMajorVersion()+"."+t.getMinorVersion()),this.selectedVersion=t.getVersionId();}.bind(this),n=function(){var e=new t.VA.EventEmitter();e.on("select",o),new t.VA.Core.Dialogs.SelectVersionDialog(this.$mainControl,{projectId:this.options.projectId,fileId:this.options.fileId,emitter:e});}.bind(this);this.$versionButton.on("click",n);},e.prototype.createNameControl=function(e){this.$nameControl=e.jqxInput({placeHolder:"Enter name",theme:t.VA.Env.Theme});},e.prototype.createDescriptionControl=function(e){var i=this,o={focus:!1,height:188,okButton:this.$okButton,maxLength:2e3,toolbar:this.options.toolbar,callbacks:{onFocus:function onFocus(){i.$serverControl.jqxDropDownList("isOpened")&&i.$serverControl.jqxDropDownList("close");}}};this.noteControl=t.VA.Core.Widget.Factory.noteControl(e,o),this.$mainControl.on("resizing",function(t){i.noteControl.setHeight(i.$mainControl.find(".brtc-va-dialogs-contents").height()-110);});},e.prototype.handleOkClicked=function(){"Choose Target Server"!=this.$serverControl.val()?""!==this.$nameControl.val().trim()?(this.dialogResult.server=this.$serverControl.val(),this.dialogResult.name=this.$nameControl.val().trim(),this.dialogResult.description=this.noteControl.getCode(),t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)):t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter name."):t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please choose target server.");},t.VA.Core.Dialogs.DeployModelDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=680,this.dialogOptions.height=540,this.dialogOptions.keyboardCloseKey="",this.dialogOptions.closeOnEscape=!1;},e.prototype.createDialogContentsArea=function(t){t.append('<textarea class="brtc-va-dialogs-launch-progress-logs" style="display: none"></textarea>'),this.detailText=CodeMirror.fromTextArea(t.find(".brtc-va-dialogs-launch-progress-logs")[0],{mode:"text/html",theme:"default",lineNumbers:!1,matchBrackets:!0,autofocus:!0,readOnly:!0}),this.detailText.setSize("100%","100%"),this.detailText.setValue(this.options.detailText),this.detailText.focus(),t.css("height","calc(100% - 10px)");},e.prototype.createDialogButtonBar=function(t){t.hide();},t.VA.Core.Dialogs.DetailDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils;function i(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}i.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),i.prototype.constructor=i,i.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=685,this.dialogOptions.height=435;},i.prototype.createDialogContentsArea=function(i){var o=this,n=o.options.schedule;i.append('<div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Schedule Name</div>   <input type="text" class="brtc-va-dialogs-schedule-name-input" valid-type="type1" maxlength="80"/></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Cron Expression</div>   <input type="text" class="brtc-va-dialogs-schedule-cron-input" valid-type="type1" maxlength="80"/></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Schedule Owner</div>   <input type="text" class="brtc-va-dialogs-schedule-owner-input" valid-type="type1" maxlength="80"/></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Is Active</div>   <div class="brtc-va-dialogs-schedule-active-selector"></div></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Dependency Schedule</div>   <div class="brtc-va-dialogs-schedule-dependency-selector"></div></div><div class="brtc-va-dialogs-schedule-row brtc-style-margin-top-5">   <div class="brtc-va-dialogs-schedule-label">Model Version</div>   <input type="text" class="brtc-va-dialogs-schedule-model-version-input" /></div>'),this.$scheduleNameInput=i.find(".brtc-va-dialogs-schedule-name-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0}),this.$scheduleNameInput.val(n.scheduleName),this.$cronInput=i.find(".brtc-va-dialogs-schedule-cron-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0}),this.$cronInput.val(n.cronExpression),this.$scheduleOwnerInput=i.find(".brtc-va-dialogs-schedule-owner-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0}),this.$scheduleOwnerInput.val(n.scheduleOwner),this.$activeSelector=i.find(".brtc-va-dialogs-schedule-active-selector").jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,source:["Y","N"],disabled:!0}),this.$activeSelector.val(n.isActive),this.$dependencySelector=i.find(".brtc-va-dialogs-schedule-dependency-selector").jqxDropDownList({theme:t.VA.Env.Theme,displayMember:"scheduleName",valueMember:"scheduleId",dropDownHeight:300,disabled:!0}),this.$modelVersionInput=i.find(".brtc-va-dialogs-schedule-model-version-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0,placeHolder:"Select version"});var r=Studio.getResourceManager().fetchVersions(this.options.editorInput.getProjectId(),this.options.editorInput.getFileId()).then(function(t){var e="",i=o.getVersionInfo(JSON.parse(n.executeContents)).id;return _.forEach(t,function(t){i===t.getVersionId()&&(e=t.getVersion());}),o.$modelVersionInput.val(e),!0;}),a=[];a.push(new Promise(function(i,r){$.ajax({url:"api/admin/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(t){$.each(t,function(i,o){t[i].scheduleId=e.WidgetUtils.convertHTMLSpecialChar(o.scheduleId);}),o.$dependencySelector.jqxDropDownList({source:t}),o.$dependencySelector.jqxDropDownList("insertAt","",0),o.$dependencySelector.val(n.dependencyId),i();}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),r(e);});})),a.push(r),Promise.all(a).catch(function(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog(e);}).then(function(){});},i.prototype.getVersionInfo=function(t){var e,i=t.models;for(var o in i){e=i[o].version_id;}return{name:"",id:e};},i.prototype.createDialogButtonBar=function(e){this.$editButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-ok" value="Edit" />'),e.append(this.$editButton),this.$editButton.jqxButton({theme:t.VA.Env.Theme}),this.$editButton.click(this.handleEditClicked.bind(this)),this.$deleteButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-delete" value="Delete" />'),e.append(this.$deleteButton),this.$deleteButton.jqxButton({theme:t.VA.Env.Theme}),this.$deleteButton.click(this.handleDeleteClicked.bind(this)),this.$cancelButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />'),e.append(this.$cancelButton),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme}),this.$cancelButton.click(this.handleCancelClicked.bind(this));},i.prototype.handleEditClicked=function(){var e=this;new t.VA.Core.Dialogs.EditScheduleDialog(e.$parent,{editorInput:e.options.editorInput,schedule:e.options.schedule,close:function close(i){i.OK&&t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(e);},title:"Edit Schedule"});},i.prototype.refreshScheduleData=function(){var e=this;$.ajax({url:"api/admin/v2/schedules/"+e.options.schedule.scheduleId,type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}).done(function(t){t.length>0&&(e.$scheduleNameInput.val(t[0].scheduleName),e.$cronInput.val(t[0].cronExpression),e.$scheduleOwnerInput.val(t[0].scheduleOwner),e.$activeSelector.val(t[0].isActive),e.options.schedule=t[0]);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},i.prototype.handleDeleteClicked=function(){this.createDeleteConfirmDialog();},i.prototype.createDeleteConfirmDialog=function(){var e=this,i=e.options.schedule;t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Selected item(s) will be permanently deleted and cannot be recovered. Are you sure?",function(o){o.OK&&$.ajax({url:"api/admin/v2/schedules/"+i.scheduleId+"/delete",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",blocking:!0}).done(function(){t.VA.Core.Utils.WidgetUtils.openInformationDialog("Schedule(s) ( "+i.scheduleName+" ) has been deleted.",function(){t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(e);});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});});},t.VA.Core.Dialogs.DetailScheduleDialog=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Dialogs.Dialog.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype._initOptions=function(){e._initOptions.call(this),this.dialogOptions.width=760,this.dialogOptions.height=440,this.dialogOptions.maxHeight=440,this.dialogOptions.title="Version Detail";},i.prototype.createDialogContentsArea=function(e){var i=['<div class="brtc-va-dialogs-version-datail-contents">','  <div class="brtc-va-dialogs-version-detail">',"  </div>","</div>"].join("\n");this.$self=$(i),e.append(this.$self),this.$detailBody=this.$self.find(".brtc-va-dialogs-version-detail"),this.modelVersionDetail=new t.VA.Core.Components.ModelVersionDetail({$el:this.$detailBody}),this._refreshDetail(),this.$mainControl.dialog(this.dialogOptions);},i.prototype.createDialogButtonBar=function(t){e.createDialogButtonBar.call(this,t),this.$okButton.val("Edit");},i.prototype.handleEditClicked=function(){this.openEditVersionDialog();},i.prototype.handleOkClicked=function(){this.handleEditClicked();},i.prototype._refreshDetail=function(){var e=function(t){this.modelVersionDetail.update(t);}.bind(this);Studio.getResourceManager().fetchVersion(this.options.projectId,this.options.fileId,this.options.versionId).then(e).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),this.$mainControl.dialog("close");}.bind(this));},i.prototype.openEditVersionDialog=function(){var e=function(t){t.OK&&(this.dialogResult.edited=!0);}.bind(this);new t.VA.Core.Dialogs.EditVersionDialog(this.$mainControl,{projectId:this.options.projectId,fileId:this.options.fileId,versionId:this.options.versionId,onEditCallback:this._refreshDetail.bind(this),close:e});},t.VA.Core.Dialogs.DetailVersionDialog=i;}.call(this),function(){"use strict";this.Brightics.VA.Core.Functions.Library.DialogPanelProperties={};}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Editors.Sheet.Panels.PropertiesPanel.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype.createControls=function(){this.columnControlList=[],this.problemFactory=new t.VA.Core.Validator.ProblemFactory(),this.$mainControl=$('<div class="brtc-va-editors-sheet-panels-basepanel"/>'),this.$parent.append(this.$mainControl),this.createContentsArea(),this.$mainControl.addClass("dialog-properties"),this.$contentsArea.addClass("dialog-properties");},i.prototype.createContentsAreaControls=function(t){},i.prototype.fillControlValues=function(){this.options.fillControlValues();},i.prototype.getColumnData=function(t){return this.columnData;},i.prototype.registerColumnControl=function(t){this.columnControlList.push(t);},i.prototype.renderValues=function(){this.options.renderValues();},i.prototype._initializePerfectScroll=function(){this.$contentsArea.perfectScrollbar();},i.prototype._updatePerfectScroll=function(){this.$contentsArea.perfectScrollbar("update");},i.prototype.renderProperties=function(){},i.prototype._renderDefaultControl=function(t){var e=this,i=this.options.controlSpec[t];i&&i.params&&i.params.forEach(function(i){e._renderOptControl(e.controls[t][i.attr]);});},i.prototype._renderObjectArrayControl=function(t){var e=this.options.controlSpec[t];e&&e.params&&this._renderOptControl(this.controls[t]);},i.prototype._renderOptControl=function(t){t&&t.renderControl();},i.prototype.getParams=function(){},t.VA.Core.Functions.Library.DialogPanelProperties.propertiesPanel=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.Validator.SingleInputValidator.call(this);}e.prototype=Object.create(t.VA.Core.Validator.SingleInputValidator.prototype),e.prototype.constructor=e,t.VA.Core.Functions.Library.DialogPanelProperties.validator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=600,this.dialogOptions.height=300;},e.prototype.createDialogContentsArea=function(t){var e="Include the data flow(s) that belongs to the ";e+="control"===this.options.files[0].type?"control flow.":"report.",t.append('<div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-duplicate-model-newname-label">New name</div>   <input type="text" class="brtc-va-dialogs-duplicate-model-newname-input" maxlength="80"></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-duplicate-model-targetproject-label">To project</div>   <div class="brtc-va-dialogs-duplicate-model-targetproject-input"></div></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-duplicate-model-include-dataflow">'+e+"</div></div>"),this.createNewNameControl(t.find(".brtc-va-dialogs-duplicate-model-newname-input")),this.createTargetProjectControl(t.find(".brtc-va-dialogs-duplicate-model-targetproject-input")),this.createOptionControl(t.find(".brtc-va-dialogs-duplicate-model-include-dataflow")),this.$nameControl.focus();},e.prototype.createOptionControl=function(t){this.$includeControl=t.jqxCheckBox({theme:"office",height:25,checked:!0,boxSize:"17px"}),"control"!==this.options.files[0].type&&"visual"!==this.options.files[0].type&&this.$includeControl.css("display","none");},e.prototype.createNewNameControl=function(e){this.$nameControl=e.jqxInput({placeHolder:"Enter name",theme:t.VA.Env.Theme}),this.options.files[0]&&this.$nameControl.val(this.options.files[0].getLabel()+"_copy");},e.prototype.createTargetProjectControl=function(e){var i=this,o=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"id"},{name:"label"}],url:"api/va/v2/ws/projects",async:!0},{beforeLoadComplete:function beforeLoadComplete(e){for(var i in e){e[i].originLabel=e[i].label,e[i].label=t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e[i].label);}}});this.$targetProjectControl=e.jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,placeHolder:"Choose Project",source:o,displayMember:"label",valueMember:"id",itemHeight:30,dropDownWidth:418}),this.$targetProjectControl.on("bindingComplete",function(){if(i.options.files[0]){var t=e.jqxDropDownList("getItemByValue",i.options.files[0].getProjectId());e.jqxDropDownList("selectItem",t);}e.jqxDropDownList("getItems").length>4&&(e.jqxDropDownList("autoDropDownHeight",!1),e.jqxDropDownList("dropDownHeight",120));}).on("select",function(t){var i=t.args;i&&i.item&&e.attr("title",i.item.originalItem.originLabel);});},e.prototype.searchDataFlowFile=function(t,e,i){for(var o in e){e[o].param.functions&&this.searchDataFlowFile(t,e[o].param.functions,i);var n=!1;if("DataFlow"===e[o][FUNCTION_NAME]){for(var r in i){e[o].param.mid===i[r].mid&&(n=!0);}if(!n){var a=Studio.getResourceManager().getFile(t,e[o].param.mid);if(null==a)return'"'+e[o].display.label+'" dataflow was deleted or format is invalid in selected controlflow';i.push(a.contents);}}}},e.prototype.changeModelId=function(t,e){for(var i in e){e[i].param.functions&&this.changeModelId(t,e[i].param.functions),t.oldMid===e[i].param.mid&&(e[i].param.mid=t.newMid);}},e.prototype.handleOkClicked=function(){var e=this.$nameControl.val().trim();if(e.length>80)return t.VA.Core.Utils.WidgetUtils.openErrorDialog('"New Name" should be 80 characters or less.',function(){}),!1;if(!e)return t.VA.Core.Utils.WidgetUtils.openErrorDialog('"New Name" should not be empty or blank.',function(){}),!1;if("control"===this.options.files[0].type&&this.$includeControl.jqxCheckBox("checked")){var i=this.searchDataFlowFile(this.options.files[0].project_id,this.options.files[0].contents.functions,[]);if(i)return t.VA.Core.Utils.WidgetUtils.openErrorDialog(i,function(){}),!1;}var o=this.options.files[0].getProjectId(),n=this.$targetProjectControl.val(),r=this.options.files[0],a=function(){this.dialogResult.projectId=o,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);}.bind(this);Studio.getResourceService().duplicateFile(r.getFileId(),o,n,!0,r.getLabel(),e).then(a).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},t.VA.Core.Dialogs.DuplicateModelDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=648,this.dialogOptions.height=248;},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-rename-name-label">Data Source Label: </div>   <input type="text" class="brtc-va-dialogs-rename-name-input" maxlength="80"></div>'),this.createNameControl(t.find(".brtc-va-dialogs-rename-name-input"));},e.prototype.createNameControl=function(e){this.$nameControl=e.jqxInput({placeHolder:"Enter a data source label.",theme:t.VA.Env.Theme}),this.options.name&&this.$nameControl.val(this.options.name);},e.prototype.handleOkClicked=function(){var e=this.$nameControl.val().trim();if(0!=e.length){if("function"==typeof this.options.validate){var i=this.options.validate(e);if(i)return void t.VA.Core.Utils.WidgetUtils.openErrorDialog(i);}this.dialogResult.newName=e,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter data source label.");},t.VA.Core.Dialogs.EditDataSourceAliasDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=760,this.dialogOptions.height=440;},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-editresourcedialog-contents"),t.append('<div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Name</div>   <input type="text" class="brtc-va-dialogs-editresourcedialog-name-input" maxlength="80"></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Description</div>   <div class="brtc-va-dialogs-editresourcedialog-description-container">   </div></div>'),this.createNameControl(t.find(".brtc-va-dialogs-editresourcedialog-name-input")),this.createDescriptionControl(t.find(".brtc-va-dialogs-editresourcedialog-description-container")),this.$nameControl.focus();},e.prototype.createNameControl=function(e){this.$nameControl=e.jqxInput({placeHolder:"Enter name",theme:t.VA.Env.Theme}),this.$nameControl.val(this.options.label);},e.prototype.createDescriptionControl=function(e){var i=this,o={focus:!1,height:188,description:this.options.description,okButton:this.$okButton,maxLength:2e3,toolbar:this.options.toolbar};this.noteControl=t.VA.Core.Widget.Factory.noteControl(e,o),this.$mainControl.on("resizing",function(t){i.noteControl.setHeight(i.$mainControl.find(".brtc-va-dialogs-contents").height()-110);});},e.prototype.handleOkClicked=function(){if(""!==this.$nameControl.val().trim()){if($("<div>").append(this.noteControl.getCode()).text().length>2e3)t.VA.Core.Utils.WidgetUtils.openErrorDialog("Description should be less than or equal to 2000 characters.");else{this.dialogResult.label=this.$nameControl.val().trim();var e=this.noteControl.getCode();"<p><br></p>"===e&&(e=""),this.dialogResult.description=e,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);}}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter name.");},t.VA.Core.Dialogs.EditResourceDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils;function i(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}i.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),i.prototype.constructor=i,i.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=685,this.dialogOptions.height=435;},i.prototype.createDialogContentsArea=function(i){var o=this,n=o.options.schedule;i.append('<div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Schedule Name</div>   <input type="text" class="brtc-va-dialogs-schedule-name-edit-input" valid-type="type2" maxlength="80"/></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Cron Expression</div>   <input type="text" class="brtc-va-dialogs-schedule-cron-edit-input" valid-type="cronType" maxlength="80"/>   <div class="brtc-va-dialogs-schedule-cron-help"></div>   <div class="brtc-va-dialogs-schedule-cron-checkbox">IMMEDIATE</div></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Schedule Owner</div>   <input type="text" class="brtc-va-dialogs-schedule-owner-edit-input" valid-type="type1" maxlength="80"/></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Is Active</div>   <div class="brtc-va-dialogs-schedule-active-edit-selector"></div></div><div class="brtc-va-dialogs-schedule-row">   <div class="brtc-va-dialogs-schedule-label">Dependency Schedule</div>   <div class="brtc-va-dialogs-schedule-dependency-selector"></div></div><div class="brtc-va-dialogs-schedule-row brtc-style-margin-top-5">   <div class="brtc-va-dialogs-schedule-label">Model Version</div>   <input type="text" class="brtc-va-dialogs-schedule-model-version-input" />   <input type="button" class="brtc-va-dialogs-model-version-load" value="Add Version"/></div>'),this.$scheduleNameInput=i.find(".brtc-va-dialogs-schedule-name-edit-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0}),this.$scheduleNameInput.val(n.scheduleName),e.InputValidator.appendValidationCondition(this.$scheduleNameInput),this.$cronInput=i.find(".brtc-va-dialogs-schedule-cron-edit-input").jqxInput({theme:t.VA.Env.Theme}),this.$cronInput.val(n.cronExpression),e.InputValidator.appendValidationCondition(this.$cronInput),$(".brtc-va-dialogs-schedule-cron-help").on("click",function(){window.open("cron-expression","Brightics Cron Expression Help");}),this.$chkimmediate=i.find(".brtc-va-dialogs-schedule-cron-checkbox").jqxCheckBox({theme:t.VA.Env.Theme}),this.$chkimmediate.on("change",function(t){1==t.args.checked?o.$cronInput.jqxInput({disabled:!0,value:"IMMEDIATE"}):o.$cronInput.jqxInput({disabled:!1,value:""});}),"IMMEDIATE"===n.cronExpression&&(this.$cronInput.jqxInput({disabled:!0}),this.$chkimmediate.jqxCheckBox({checked:!0})),this.$scheduleOwnerInput=i.find(".brtc-va-dialogs-schedule-owner-edit-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0}),this.$scheduleOwnerInput.val(n.scheduleOwner),this.$activeSelector=i.find(".brtc-va-dialogs-schedule-active-edit-selector").jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,source:["Y","N"]}),this.$activeSelector.val(n.isActive),this.$dependencySelector=i.find(".brtc-va-dialogs-schedule-dependency-selector").jqxDropDownList({theme:t.VA.Env.Theme,displayMember:"scheduleName",valueMember:"scheduleId",dropDownHeight:300}),this.$modelVersionInput=i.find(".brtc-va-dialogs-schedule-model-version-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0,placeHolder:"Select version"}),this.$loadVersionButton=i.find(".brtc-va-dialogs-model-version-load"),this.$loadVersionButton.jqxButton({theme:t.VA.Env.Theme,width:120,height:27}),this.$loadVersionButton.on("click",function(){o.openSelectVersionDialog();});var r=Studio.getResourceManager().fetchVersions(this.options.editorInput.getProjectId(),this.options.editorInput.getFileId()).then(function(t){var e="",i=o.getVersionInfo(JSON.parse(n.executeContents)).id;return _.forEach(t,function(t){i===t.getVersionId()&&(e=t.getVersion());}),o.$modelVersionInput.val(e),!0;}),a=[];a.push(new Promise(function(i,r){$.ajax({url:"api/admin/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8"}).done(function(t){$.each(t,function(i,o){t[i].scheduleId=e.WidgetUtils.convertHTMLSpecialChar(o.scheduleId);}),o.$dependencySelector.jqxDropDownList({source:t}),o.$dependencySelector.jqxDropDownList("insertAt","",0),o.$dependencySelector.val(n.dependencyId),i();}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),r(e);});})),a.push(r),Promise.all(a).catch(function(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog(e);}).then(function(){});},i.prototype.getVersionInfo=function(t){var e,i=t.models;for(var o in i){e=i[o].version_id;}return{name:"",id:e};},i.prototype.openSelectVersionDialog=function(){var e=function(t){if(t.OK){var e=t.data;this.$modelVersionInput.val(e.getVersion()),this.versionId=e.getVersion(),this.versionContents=e.getContents();}}.bind(this);new t.VA.Core.Dialogs.SelectVersionDialog(this.$mainControl,{projectId:this.options.editorInput.getProjectId(),fileId:this.options.editorInput.getFileId(),close:e});},i.prototype.addFileVersion=function(t,e){t.versionId=e;},i.prototype.handleOkClicked=function(){var e=this,i=e.options.schedule;if(""===_.trim(e.$scheduleNameInput.val()))return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter schedule name."),void $(".brtc-va-dialogs-schedule-name-edit-input").focus();if(""===_.trim(e.$cronInput.val()))return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter cron expression."),void $(".brtc-va-dialogs-schedule-cron-edit-input").focus();if(!$(".brtc-va-dialogs-schedule-cron-checkbox").jqxCheckBox("checked")&&!new RegExp("^\\s*($|#|\\w+\\s*=|(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?(?:,(?:[0-5]?\\d)(?:(?:-|/|\\,)(?:[0-5]?\\d))?)*)\\s+(\\?|\\*|(?:[01]?\\d|2[0-3])(?:(?:-|/|\\,)(?:[01]?\\d|2[0-3]))?(?:,(?:[01]?\\d|2[0-3])(?:(?:-|/|\\,)(?:[01]?\\d|2[0-3]))?)*)\\s+(\\?|\\*|(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?(?:,(?:0?[1-9]|[12]\\d|3[01])(?:(?:-|/|\\,)(?:0?[1-9]|[12]\\d|3[01]))?)*)\\s+(\\?|\\*|(?:[1-9]|1[012])(?:(?:-|/|\\,)(?:[1-9]|1[012]))?(?:L|W)?(?:,(?:[1-9]|1[012])(?:(?:-|/|\\,)(?:[1-9]|1[012]))?(?:L|W)?)*|\\?|\\*|(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?(?:,(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC)(?:(?:-)(?:JAN|FEB|MAR|APR|MAY|JUN|JUL|AUG|SEP|OCT|NOV|DEC))?)*)\\s+(\\?|\\*|(?:[0-6])(?:(?:-|/|\\,|#)(?:[0-6]))?(?:L)?(?:,(?:[0-6])(?:(?:-|/|\\,|#)(?:[0-6]))?(?:L)?)*|\\?|\\*|(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?(?:,(?:MON|TUE|WED|THU|FRI|SAT|SUN)(?:(?:-)(?:MON|TUE|WED|THU|FRI|SAT|SUN))?)*)(|\\s)+(\\?|\\*|(?:|\\d{4})(?:(?:-|/|\\,)(?:|\\d{4}))?(?:,(?:|\\d{4})(?:(?:-|/|\\,)(?:|\\d{4}))?)*))$").test(e.$cronInput.val()))return t.VA.Core.Utils.WidgetUtils.openInformationDialog("Cron expression syntax error."),void $(".brtc-va-dialogs-schedule-cron-edit-input").focus();var o,n=i.mid,r=i.executeContents;if(this.versionContents){for(var a in(r=$.extend(!0,{},t.VA.Core.Utils.ModelUtils.exportAsRunnableFile(this.versionContents,n,void 0,!0,void 0))).models){for(var s in e.addFileVersion(r.models[a],this.versionId),r.models[a].functions){var l=r.models[a].functions[s];t.VA.Core.Utils.ModelUtils.carvePersist(l,!0);}}void 0!==r.reports&&Object.keys(r.reports).length>0&&(o=$.extend(!0,{},r.reports),delete r.reports),r=JSON.stringify(r);}var c={scheduleId:i.scheduleId,scheduleName:e.$scheduleNameInput.val(),cronExpression:e.$cronInput.val(),scheduleOwner:e.$scheduleOwnerInput.val(),scheduleType:"JSON",executeContents:r,reportContents:void 0!==o?JSON.stringify(o):null,fileId:i.fileId,projectId:i.projectId,isActive:e.$activeSelector.val(),modifyUser:t.VA.Env.Session.userId,dependencyId:e.$dependencySelector.val()},d={url:"api/admin/v2/schedules/"+i.scheduleId+"/update",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0,data:JSON.stringify(c)};$.ajax(d).done(function(){t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(e);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},i.prototype.destroy=function(){this.$activeSelector.jqxDropDownList("destroy"),this.$dependencySelector.jqxDropDownList("destroy"),t.VA.Dialogs.Dialog.prototype.destroy.call(this);},t.VA.Core.Dialogs.EditScheduleDialog=i;}.call(this),function(){var t=this.Brightics,e=t.VA.Dialogs.Dialog.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype._initOptions=function(){e._initOptions.call(this),this.dialogOptions.width=760,this.dialogOptions.height=440,this.dialogOptions.maxHeight=440,this.dialogOptions.title="Edit Version";},i.prototype.createDialogContentsArea=function(t){var e=['<div class="brtc-va-dialogs-edit-version-wrapper">','<div class="brtc-va-dialogs-edit-version-body">','  <div class="brtc-va-dialogs-edit-version-row">','    <div class="brtc-va-dialogs-edit-version-label">Name</div>','    <input type="text" class="brtc-va-dialogs-edit-version-name-input brtc-style-flex-1" maxlength="80"/>',"  </div>",'  <div class="brtc-va-dialogs-edit-version-row">','    <div class="brtc-va-dialogs-edit-version-label">Description</div>','    <div class="brtc-va-dialogs-edit-version-description-input">',"    </div>","  </div>",'  <div class="brtc-va-dialogs-edit-version-row">','    <div class="brtc-va-dialogs-edit-version-label">Tags</div>','    <input type="text" class="brtc-va-dialogs-edit-version-tags-input brtc-style-flex-1" maxlength="80"/>',"  </div>","</div>","</div>"].join("\n");t.append(e),this.createLabelControl(t.find(".brtc-va-dialogs-edit-version-name-input")),this.createDescriptionControl(t.find(".brtc-va-dialogs-edit-version-description-input")),this.createTagsControl(t.find(".brtc-va-dialogs-edit-version-tags-input")),this._refreshContents(),this.$mainControl.dialog(this.dialogOptions);},i.prototype.createLabelControl=function(e){this.$labelInput=e.jqxInput({theme:t.VA.Env.Theme,disabled:!0});},i.prototype.createDescriptionControl=function(e){var i=this,o={focus:!1,height:155,description:this.options.description,okButton:this.$okButton,maxLength:2e3,toolbar:this.options.toolbar};this.noteControl=t.VA.Core.Widget.Factory.noteControl(e,o),this.$mainControl.on("resizing",function(t){i.noteControl.setHeight(i.$mainControl.find(".brtc-va-dialogs-contents").height()-110);});},i.prototype.createTagsControl=function(e){this.$tagsControl=e.jqxInput({placeHolder:"Enter Tags",theme:t.VA.Env.Theme});},i.prototype.createDialogButtonBar=function(t){e.createDialogButtonBar.call(this,t),this.$okButton.val("OK");},i.prototype.handleCancelClicked=function(){t.VA.Dialogs.Dialog.prototype.handleCancelClicked.call(this);},i.prototype.handleOkClicked=function(){var t=function(){this.options.onEditCallback(),e.handleOkClicked.call(this);}.bind(this);this.debouncedUpdateFileVersion=this.debouncedUpdateFileVersion||_.debounce(function(){var e=this.noteControl.getCode();"<p><br></p>"===e&&(e=""),this.data.setTags(this.$tagsControl.val()),this.data.setDescription(e),Studio.getResourceManager().updateVersion(this.options.projectId,this.options.fileId,this.data).then(t).catch(this._onError.bind(this));}.bind(this)),this.debouncedUpdateFileVersion();},i.prototype._refreshContents=function(){Studio.getResourceManager().fetchVersion(this.options.projectId,this.options.fileId,this.options.versionId).then(this._fillContents.bind(this)).catch(this._onError.bind(this));},i.prototype._fillContents=function(t){return this.$labelInput.val(t.getLabel()),this.noteControl.setValue(t.getDescription()),this.$tagsControl.val(t.getTags()),this.data=t,!0;},i.prototype._onError=function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),this.$mainControl.dialog("close");},t.VA.Core.Dialogs.EditVersionDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.results=$.extend(!0,{},i.param),this.DATA_PARAM={"input-path":{label:"Input Path",type:"code",category:"source",mandatory:!0},"copy-to":{label:"Export To",type:"radio",category:"target"},ip:{label:"IP",type:"code",category:"target",mandatory:!0},port:{label:"Port",category:"target",mandatory:!0},"output-path":{label:"Output Path",type:"code",category:"target",mandatory:!0,placeholder:"ex. /temp/data.csv"},delimiter:{label:"Delimiter",type:"radio",category:"target"},header:{label:"Header",type:"radio",category:"target"},quote:{label:"Quote",type:"radio",category:"target"},"array-delimiter":{label:"Array Delimiter",type:"radio",category:"target"},"array-start-string":{label:"Array Start",type:"radio",category:"target"},"array-end-string":{label:"Array End",type:"radio",category:"target"},"key-value-delimiter":{label:"Key Value",type:"radio",category:"target"},"map-start-string":{label:"Map Start",type:"radio",category:"target"},"map-end-string":{label:"Map End",type:"radio",category:"target"},"null-value":{label:"Null Value",type:"radio",category:"target"},"datasource-name":{label:"Datasource",type:"dropDown",category:"target",mandatory:!0},"table-name":{label:"Table Name",type:"code",category:"target",mandatory:!0},"is-delete":{label:"Overwrite",type:"radio",category:"target"},"is-append":{},"connection-timeout":{label:"Connection Timeout(sec)",type:"number",category:"target",placeholder:"Default: 600",max:3e3},"login-timeout":{label:"Login Timeout(sec)",type:"number",category:"target",placeholder:"Default: 600",max:3e3},"socket-timeout":{label:"Socket Timeout(sec)",type:"number",category:"target",placeholder:"Default: 600",max:3e3},"lock-timeout":{label:"Lock Timeout(sec)",type:"number",category:"target",placeholder:"Default: 600",max:3e3}},this.RADIO_DATA_PARAM={"copy-to":[{label:"Repository",value:"alluxio"},{label:"HDFS",value:"hdfs"},{label:"Relational DB",value:"jdbc"}],delimiter:[{label:"Comma",value:","},{label:"Tab",value:"\t"},{label:"Space",value:" "},{label:"Colon",value:":"},{label:"Semicolon",value:";"},{label:"Other",value:"Other"}],header:[{label:"True",value:"true"},{label:"False",value:"false"}],quote:[{label:"Double Quotation",value:'"'},{label:"Other",value:"Other"}],"array-delimiter":[{label:"Colon",value:":"},{label:"Other",value:"Other"}],"array-start-string":[{label:"Left Square Bracket",value:"["},{label:"Other",value:"Other"}],"array-end-string":[{label:"Right Square Bracket",value:"]"},{label:"Other",value:"Other"}],"key-value-delimiter":[{label:"Equal",value:"="},{label:"Other",value:"Other"}],"map-start-string":[{label:"Left Curly Bracket",value:"{"},{label:"Other",value:"Other"}],"map-end-string":[{label:"Right Curly Bracket",value:"}"},{label:"Other",value:"Other"}],"null-value":[{label:"Empty String",value:""},{label:"Other",value:"Other"}],"is-delete":[{label:"True",value:"true"},{label:"False",value:"false"}]},this.PARAM_VISIBLE={hdfs:["copy-to","input-path","ip","port","output-path","delimiter","header","quote","array-delimiter","array-start-string","array-end-string","key-value-delimiter","map-start-string","map-end-string","null-value","is-delete"],jdbc:["copy-to","datasource-name","input-path","is-delete","table-name","connection-timeout","login-timeout","socket-timeout","lock-timeout","is-append"],alluxio:["copy-to","input-path","output-path","delimiter","header","quote","array-delimiter","array-start-string","array-end-string","key-value-delimiter","map-start-string","map-end-string","null-value","is-delete"]},t.VA.Core.Dialogs.FnUnitDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.FnUnitDialog.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-style-minus-40">    <div class="brtc-va-dialogs-body">        <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px brtc-style-padding-right-20"></div>        <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit brtc-style-display-flex brtc-style-width-97-p"></div>        <div class="brtc-va-dialogs-buttonbar brtc-style-padding-right-30"></div>    </div></div>'),this.$titleArea=this.$mainControl.find(".brtc-va-dialogs-title");},e.prototype.createDialogContentsArea=function(t){var e=this;this.$contentsAreaWrapper=$('<div class="brtc-va-views-properties-pages import-setting-dialog brtc-style-width-full rtc-style-overflow-hidden">   <div class="brtc-va-views-properties-pages-contents-area brtc-style-padding-right-10 brtc-style-relative brtc-style-full"></div></div>'),this.$contentsAreaWrapper.css({width:this.options.width,height:this.options.height}),t.append(this.$contentsAreaWrapper),this.$contentsArea=this.$contentsAreaWrapper.find(".brtc-va-views-properties-pages-contents-area"),this.codeArgumentControlMap={},this.addPropertyControl("Source",function(t){e.variableArea=t,e.createCategoryControl(t,"source");}),this.addPropertyControl("Target",function(t){e.variableArea=t,e.createCategoryControl(t,"target");}),this.setParamControlVisible(e.results["copy-to"]),this.renderValidation(),this.$contentsAreaWrapper.find(".brtc-va-views-properties-pages-contents-area").perfectScrollbar();},e.prototype.renderValidation=function(){this.removeValidation();},e.prototype.removeValidation=function(){this.$mainControl.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove(),this.$mainControl.find(".brtc-va-editors-sheet-controls-propertycontrol-label").removeClass("brtc-va-editors-sheet-controls-propertycontrol-label-error"),this.$mainControl.find(".brtc-va-editor-sheet-panels-validation-error").removeClass("brtc-va-editor-sheet-panels-validation-error"),this.$mainControl.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove();},e.prototype.createValidationContent=function(t,e,i){var o=$('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>   <div class="brtc-va-editors-sheet-panels-validation-tooltip">'+e.message+"</div></div>");t.append(o),t.addClass("brtc-va-editor-sheet-panels-validation-error"),i&&o.css("clear","both"),o.show();},e.prototype.addPropertyControl=function(e,i,o){var n=this,r=$('<div class="brtc-va-views-properties-pages-controls-propertycontrol">   <div class="brtc-va-views-properties-pages-controls-propertycontrol-label"></div>   <div class="brtc-va-views-properties-pages-controls-propertycontrol-contents"></div>');return o&&o.mandatory&&(e="<div>"+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e)+'   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>'),this.$contentsArea.append(r),r.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"left",initContent:function initContent(){"function"==typeof i&&i.call(n,r.find(".brtc-va-views-properties-pages-controls-propertycontrol-contents"),o);}}),r.jqxExpander("setHeaderContent",e),r;},e.prototype.createCategoryControl=function(t,e){for(var i,o,n=Object.keys(this.DATA_PARAM),r=0;r<n.length;r++){if(o=n[r],this.DATA_PARAM[o].category===e){(i=$('<div class="control-row" control-type="'+o+'">   <div class="column-1">'+this.DATA_PARAM[o].label+': </div>   <div class="column-2" /></div>')).find(".column-1").addClass(o),this.DATA_PARAM[o].mandatory&&i.find(".column-1").addClass("mandatory"),t.append(i);var a=this.results;"radio"===this.DATA_PARAM[o].type?(this.createRadioArgumentControl(i,o),this.setRadioControlValue(o,a[o]||"")):"code"===this.DATA_PARAM[o].type?(this.createCodeArgumentControl(i,o),this.setCodeControlValue(o,a[o]||"")):"dropDown"===this.DATA_PARAM[o].type?(this.createDropDownArgumentControl(i,o),this.setDropDownControlValue(o,a[o]||"")):"number"===this.DATA_PARAM[o].type?(this.createNumberInputArgumentControl(i,o),this.setNumberInputControlValue(o,a[o]||"")):(this.createInputArgumentControl(i,o),this.setInputControlValue(o,a[o]||""));}}},e.prototype.createRadioArgumentControl=function(e,i){var o=this,n=$('<div class="brtc-va-views-properties-pages-controls-propertycontrol-button" param-key="'+i+'"/>');e.find(".column-2").append(n);for(var r=0;r<this.RADIO_DATA_PARAM[i].length;r++){var a=this.RADIO_DATA_PARAM[i][r].label,s=this.RADIO_DATA_PARAM[i][r].value;'"'===s&&(s="quot");var l=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton" param-value="'+s+'"/>');n.append(l),"Other"==s?(l.append('<div class="brtc-va-delimiter-input-wrapper">   <input type="text" class="brtc-va-delimiter-input"/></div>'),o.createRadioButton(l,i),l.find(".brtc-va-delimiter-input").jqxInput({theme:t.VA.Env.Theme,width:57,height:24}),l.find(".brtc-va-delimiter-input").on("change",function(){o.results[i]=$(this).val(),o.renderValidation();})):(l.text(a),o.createRadioButton(l,i)),l.on("checked",function(t){var e=$(t.target);if("quot"==e.attr("param-value")?o.results[i]='"':o.results[i]=e.attr("param-value"),"Other"==e.attr("param-value")){var n=e.find(".brtc-va-delimiter-input");o.results[i]=n.val();}"copy-from"!==i&&"copy-to"!==i||(o.setParamControlVisible(o.results[i]),o.$mainControl.find(".brtc-va-dialogs-contents").perfectScrollbar("update")),"is-delete"==e.closest(".brtc-va-views-properties-pages-controls-propertycontrol-button").attr("param-key")&&o.setAppendControlVisible(),o.renderValidation();});}if("is-delete"===i){var c=n.find(".brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value=false]").parent(),d=$('<div class="brtc-va-views-properties-pages-controls-append">Append</div>');c.append(d),c.addClass("brtc-style-display-flex"),c.addClass("brtc-va-editors-sheet-controls-width-8"),c.addClass("brtc-style-col-7"),c.find(".brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value=false]").addClass("brtc-style-col-4-important"),this.createCheckBox(d),d.val(this.results["is-append"]),this.addClassToWrapper(d,"brtc-style-display-flex"),this.addClassToWrapper(d,"brtc-style-line-height-25"),d.parent().prepend($("<span>(&nbsp</span>")),d.parent().append($("<span>&nbsp)</span>")),d.parent().removeClass("brtc-va-editors-sheet-controls-wrapper"),d.parent().attr("control-type","is-append"),d.on("change",function(){o.results["is-append"]=$(this).val().toString();});}},e.prototype.setAppendControlVisible=function(){this.$mainControl.find(".brtc-va-views-properties-pages-controls-append").jqxCheckBox("true"==this.results["is-delete"]?"disable":"enable");},e.prototype.setParamControlVisible=function(t){for(var e,i=Object.keys(this.DATA_PARAM),o=this.PARAM_VISIBLE[t],n=0;n<i.length;n++){e=this.$mainControl.find("div[control-type="+i[n]+"]"),o.indexOf(i[n])>=0?e.css("display",""):e.css("display","none"),e.find(".CodeMirror").each(function(t,e){e.CodeMirror.refresh();});}"jdbc"===t?this.$mainControl.find(".column-type").removeClass("mandatory"):this.$mainControl.find(".column-type").addClass("mandatory");},e.prototype.createCodeArgumentControl=function(e,i){var o=this,n=$('<textarea  class="brtc-va-views-properties-pages-controls-propertycontrol-code-input" param-key="'+i+'"/>');e.find(".column-2").append(n);var r={verifier:"column-type"===i?new t.VA.Core.Verifier():new t.VA.Core.Verifier.CFVariableVerifier(),mode:"brtc-controlflow-variable",scrollbarStyle:"null",placeholder:this.DATA_PARAM[i].placeholder||"",lineWrapping:!1,lineNumbers:!1,extraKeys:{"Ctrl-Space":"autocomplete",Tab:!1,"Shift-Tab":!1},showTrailingSpace:!0,hintOptions:{paramKey:i,list:"column-type"===i?["Int","Long","String","Double","Boolean"]:[]}},a=o.createCodeMirrorControl(n,r);t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(a),a.on("blur",function(t,e){o.results[i]="column-type"==i?o.splitStringToArrayWithTrim(t.getValue()):t.getValue(),o.renderValidation();}),this.codeArgumentControlMap[i]=a;},e.prototype.splitStringToArrayWithTrim=function(t){var e=[],i=t.split(",");i=$.map(i,function(t,e){return t.trim();});for(var o=0;o<i.length;o++){if(-1!=i[o].indexOf("map")){var n=i[o]+","+i[++o];e.push(n);}else e.push(i[o]);}return e;},e.prototype.createDropDownArgumentControl=function(t,e){var i=this,o=$('<div class="brtc-va-views-properties-pages-controls-propertycontrol-dropdown" param-key="'+e+'"/>');if(t.find(".column-2").append(o),i.createDropDownList(o,{}),o.on("change",function(t){i.results[e]=$(this).val(),i.renderValidation();}),"datasource-name"===e){var n=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"datasourceName",type:"string"},{name:"datasourceType",type:"string"}],url:"api/va/v2/datasources?type=RDB"},{loadComplete:function loadComplete(){o.val(i.results[e]);}});o.jqxDropDownList({source:n,displayMember:"datasourceName",valueMember:"datasourceName"});}},e.prototype.createNumberInputArgumentControl=function(e,i){var o=this,n=$('<div class="brtc-va-views-properties-pages-controls-propertycontrol-numberinput" param-key="'+i+'"/>');e.find(".column-2").append(n);var r={placeholder:this.DATA_PARAM[i].placeholder};this.DATA_PARAM[i].max&&(r.max=this.DATA_PARAM[i].max);var a=o.createNumberInput(n,r);t.VA.Core.Utils.WidgetUtils.putData(n,i,a),a.onChange(function(t){o.results[i]=t,o.renderValidation();});},e.prototype.createInputArgumentControl=function(t,e){var i=this,o=$('<input type="text" class="brtc-va-views-properties-pages-controls-propertycontrol-input" param-key="'+e+'"/>');t.find(".column-2").append(o),i.createInput(o,{}),o.on("change",function(t){i.results[e]=$(this).val(),i.renderValidation();});},e.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper controlflow"></div>');t.wrap(e);},e.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},e.prototype.createRadioButton=function(e,i){this.wrapControl(e),"quote"===i||"array-delimiter"===i||"array-start-string"===i||"array-end-string"===i||"key-value-delimiter"===i||"map-start-string"===i||"map-end-string"===i||"null-value"===i?this.addClassToWrapper(e,"brtc-va-editors-control-controls-radiobutton-default brtc-va-editors-sheet-controls-width-6"):this.addClassToWrapper(e,"brtc-va-editors-control-controls-radiobutton-default brtc-va-editors-sheet-controls-width-4");var o={theme:t.VA.Env.Theme,width:"100%",height:"25px",groupName:i};e.jqxRadioButton(o);},e.prototype.setRadioControlValue=function(t,e){'"'===e&&(e="quot");var i=[];"\\"!=e&&(i=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-button[param-key="'+t+'"] .brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value="'+e+'"]')),0==i.length?((i=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-button[param-key="'+t+'"] .brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value="Other"]')).jqxRadioButton({checked:!0}),"quot"===e&&(e='"'),i.find(".brtc-va-delimiter-input").jqxInput("val",e)):i.jqxRadioButton({checked:!0});},e.prototype.createCodeMirrorControl=function(t,e){return this.wrapControl(t),t.addClass("brtc-va-editors-sheet-controls-textareacontrol"),CodeMirror.fromTextArea(t[0],e);},e.prototype.setCodeControlValue=function(t,e){var i=this.codeArgumentControlMap[t],o=this.splitStringToArrayWithTrim(i.getValue());e.toString()!==o.toString()&&i.setValue(e.toString());},e.prototype.createDropDownList=function(e){this.wrapControl(e);var i={theme:t.VA.Env.Theme,width:"100%",height:"25px"};e.jqxDropDownList(i);},e.prototype.setDropDownControlValue=function(t,e){var i=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-dropdown[param-key="'+t+'"]');i.val()!==e&&i.val(e);},e.prototype.createNumberInput=function(e,i){this.wrapControl(e);var o={min:0};return $.extend(!0,o,i),new t.VA.Core.Editors.Sheet.Controls.NumericInput(e,o);},e.prototype.setNumberInputControlValue=function(e,i){var o=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-numberinput[param-key="'+e+'"]');t.VA.Core.Utils.WidgetUtils.getData(o,e).setValue(i);},e.prototype.createInput=function(e,i){this.wrapControl(e);var o={theme:t.VA.Env.Theme,height:"25px"};$.extend(!0,o,i),e.jqxInput(o);},e.prototype.setInputControlValue=function(t,e){var i=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-input[param-key="'+t+'"]');i.val()!==e&&i.val(e);},e.prototype.handleOkClicked=function(){this.options.fnUnit.param=$.extend(!0,{},this.results),this.dialogResult={OK:!0,Cancel:!1,results:{fnUnit:this.options.fnUnit}},this.$mainControl.dialog("close");},e.prototype.createCheckBox=function(e){this.wrapControl(e);var i={theme:t.VA.Env.Theme,height:"25px",disabled:!0};return e.jqxCheckBox(i),e;},t.VA.Core.Dialogs.ExportDataSettingDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=982,this.dialogOptions.height=871,this.dialogOptions.keyboardCloseKey="";},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-exporttoudfdialog-contents"),this.$progress=$('   <div class="brtc-va-progress">       <div>           <span class="brtc-va-progress-loading"/>           <p>Testing...</p>       </div></div>'),t.append(this.$progress),this.$progress.hide(),t.append('<div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold mandatory">UDF Name</div>   <div class ="brtc-va-dialogs-exporttoudfdialog-name-container">       <input type="text" class="brtc-va-dialogs-exporttoudfdialog-name-input brtc-s-style-dialogs-exporttoudfdialog-name-input" maxlength="80"  isMandatory="true" valid-type="type2">       <input type="text" class="brtc-va-dialogs-exporttoudfdialog-name-version-input brtc-s-style-dialogs-exporttoudfdialog-name-version-input" maxlength="80" readonly>   </div></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Description</div>   <div class="brtc-va-dialogs-exporttoudfdialog-description-container"/></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Input Variables</div>   <div class="brtc-va-dialogs-exporttoudfdialog-input-variables-container"/></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold mandatory"  >Script</div>   <div class="brtc-va-dialogs-exporttoudfdialog-script-container"/></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold mandatory">Out Alias</div>   <div class="brtc-va-dialogs-exporttoudfdialog-out-alias-container"/></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold">Test Result</div>   <div class="brtc-va-dialogs-exporttoudfdialog-test-result-container brtc-s-style-dialogs-exporttoudfdialog-test-result-container">   </div></div>'),this.createNameControl(t.find(".brtc-va-dialogs-exporttoudfdialog-name-input")),this.createNameVersionControl(t.find(".brtc-va-dialogs-exporttoudfdialog-name-version-input")),this.createDescriptionControl(t.find(".brtc-va-dialogs-exporttoudfdialog-description-container")),this.createInputVariablesControl(t.find(".brtc-va-dialogs-exporttoudfdialog-input-variables-container")),this.createScriptControl(t.find(".brtc-va-dialogs-exporttoudfdialog-script-container")),this.createOutAlias(t.find(".brtc-va-dialogs-exporttoudfdialog-out-alias-container")),this.createResultControl(t.find(".brtc-va-dialogs-exporttoudfdialog-test-result-container")),t.perfectScrollbar(),t.perfectScrollbar("update"),this.renderUDFVersion(),this.renderInOutValidation(),this.$nameControl.focus();},e.prototype.renderUDFVersion=function(){var e=this,i={url:"api/va/v2/ws/udfs?udfName="+encodeURIComponent(this.$nameControl.val().trim()),type:"GET",blocking:!0,contentType:"application/json; charset=utf-8"};$.ajax(i).done(function(t){var i=e.options.label+" ver";t.length>0?(e.UDF_VERSION=(parseFloat(t[0].udf_version)+.1).toFixed(1),e.options.version?i+=parseFloat(e.options.version).toFixed(1):i+=parseFloat(t[0].udf_version).toFixed(1)):(e.UDF_VERSION="1.0",i+="1.0"),e.$nameVersionControl.val(i),"save"===e.options.type?(e.$nameVersionControl.hide(),e.$nameControl.show()):(e.$nameVersionControl.show(),e.$nameVersionControl.jqxInput({disabled:!0}),e.$nameControl.hide());}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},e.prototype.createNameControl=function(e){var i=this;this.$nameControl=e.jqxInput({placeHolder:"Enter UDF name",theme:t.VA.Env.Theme}),t.VA.Core.Utils.InputValidator.appendValidationCondition(this.$nameControl),this.$nameControl.val(this.options.label),this.$nameControl.on("change",function(){i.renderValidation(i.$nameControl,'"UDF Name" is required.',!1),i.renderUDFVersion();}),this.renderValidation(this.$nameControl,'"UDF Name" is required.',!1);},e.prototype.createNameVersionControl=function(e){this.$nameVersionControl=e.jqxInput({theme:t.VA.Env.Theme}),this.$nameVersionControl.val(this.options.label),this.$nameVersionControl.hide();},e.prototype.createDescriptionControl=function(e){var i=this,o={focus:!1,height:125,description:this.options.description,okButton:this.$okButton,maxLength:2e3};this.noteControl=t.VA.Core.Widget.Factory.noteControl(e,o),this.$mainControl.on("resizing",function(t){i.noteControl.setHeight(i.$mainControl.find(".brtc-va-dialogs-contents").height()-110);});},e.prototype.createScriptControl=function(e){var i=this,o={mode:i.options.fnUnit.func,commands:[],events:[],value:i.options.fnUnit.param.script};this.scriptControl=t.VA.Core.Widget.Factory.aceEditorControl(e,o),this.scriptControl.getWrapperDiv().attr("isMandatory",!0),this.scriptControl.editor.on("blur",function(){i.renderValidation(i.scriptControl.getWrapperDiv(),'"Script" is required.',!1,i.scriptControl.getValue().trim());}),this.renderValidation(i.scriptControl.getWrapperDiv(),'"Script" is required.',!1,i.scriptControl.getValue().trim());},e.prototype.createInputVariablesControl=function(t){var e=this;this.$InputVariablesLineArea=$('<div class="brtc-va-dialogs-contents-statement-input-variables">   <div class="brtc-va-dialogs-export-to-udf input-variable-empty">       <div class="brtc-va-dialogs-contents-statement-input-variable-empty brtc-s-style-dialogs-contents-statement-input-variable-empty">           <div>If you want to enter Input Variables, click to plus button.</div>       </div>   </div></div>'),t.append(this.$InputVariablesLineArea),this.emptyVariableArea=this.$InputVariablesLineArea.find(".input-variable-empty");var i=$('<div class="brtc-va-dialogs-export-to-udf add-icon"></div>');i.click(function(){e.createInputVariable(!0),e.renderInOutValidation();}),this.$InputVariablesLineArea.find(".input-variable-empty").append(i),this.$InputVariablesLineArea.perfectScrollbar(),this.$InputVariablesLineArea.perfectScrollbar("update"),this.rednerInputVariables();},e.prototype.rednerInputVariables=function(){var t=this.options.inputVariables;for(var e in t){var i=this.createInputVariable(!0);i.find(".input-variable-param-name").val(t[e].param_name),i.find(".input-variable-type").val(t[e].arg_type),i.find(".input-variable-param-description").val(t[e].description),this.$InputVariablesLineArea.perfectScrollbar("update");}},e.prototype.createInputVariable=function(e){if(this.emptyVariableArea.hide(),!(this.$InputVariablesLineArea.find(".input-variable").length>=10))return this.createInputs(this.$InputVariablesLineArea,"",e);t.VA.Core.Utils.WidgetUtils.openErrorDialog("Up to 10 input variable can be added.");},e.prototype.createInputs=function(e,i,o){var n=this,r=$('<div class="brtc-va-dialogs-export-to-udf input-variable" >   <div class="brtc-va-dialogs-export-to-udf input-variable-name"><input type="text" class="brtc-va-dialogs-export-to-udf input-variable-param-name"  maxlength="80"  valid-type="type1" isMandatory='+o+' /></div>   <div class="brtc-va-dialogs-export-to-udf input-variable-type" maxlength="80"  isMandatory='+o+' />   <div class="brtc-va-dialogs-export-to-udf input-variable-description"><input type="text" class="brtc-va-dialogs-export-to-udf input-variable-param-description" maxlength="400"/></div>   <div class="brtc-va-dialogs-export-to-udf remove-icon" ></div>   <div class="brtc-va-dialogs-export-to-udf add-icon" ></div></div>');e.append(r);var a=r.find(".input-variable-param-name"),s=r.find(".input-variable-type"),l=r.find(".input-variable-param-description"),c=r.find(".add-icon"),d=r.find(".remove-icon");return a.jqxInput({placeHolder:"Enter name",theme:t.VA.Env.Theme}),t.VA.Core.Utils.InputValidator.appendValidationCondition(a),s.jqxDropDownList({placeHolder:"Enter argument type",autoDropDownHeight:!0,source:["string","double","int","expression"],theme:t.VA.Env.Theme,height:"22px",width:"100px",selectedIndex:0}),l.jqxInput({placeHolder:"Enter description",theme:t.VA.Env.Theme}),a.jqxInput("val",i),a.on("change",function(){n.renderInOutValidation();}),d.click(function(){$(this).closest(".brtc-va-dialogs-export-to-udf.input-variable").remove(),0==n.$InputVariablesLineArea.find(".input-variable").length&&n.emptyVariableArea.show(),n.renderInOutValidation(),e.perfectScrollbar("update");}),c.click(function(){n.createInputVariable(!0),n.renderInOutValidation();}),e.perfectScrollbar("update"),r;},e.prototype.createOutAlias=function(t){this.$outAliasArea=$('<div class="brtc-va-dialogs-contents-statement-out-aliases"></div>'),t.append(this.$outAliasArea),this.$outAliasArea.perfectScrollbar(),this.$outAliasArea.perfectScrollbar("update"),this.rednerOutAliasControl();},e.prototype.createOutTableAlias=function(e){if(!(this.$outAliasArea.find(".out-alias").length>=10))return this.createOutAliasInput(this.$outAliasArea,"",e);t.VA.Core.Utils.WidgetUtils.openErrorDialog("Up to 10 out alias can be added.");},e.prototype.createOutAliasInput=function(e,i,o){var n=this,r=$('<div class="brtc-va-dialogs-export-to-udf out-alias" >   <div class="brtc-va-dialogs-export-to-udf out-alias-name"><input type="text" class="brtc-va-dialogs-export-to-udf out-alias-param-name"  valid-type="type1" maxlength="80"  isMandatory='+o+' /></div>   <div class="brtc-va-dialogs-export-to-udf out-alias-description"><input type="text" class="brtc-va-dialogs-export-to-udf out-alias-param-description" maxlength="400"  /></div>   <div class="brtc-va-dialogs-export-to-udf remove-icon"></div>   <div class="brtc-va-dialogs-export-to-udf add-icon" ></div></div>');e.append(r);var a=r.find(".out-alias-param-name"),s=r.find(".out-alias-param-description"),l=r.find(".remove-icon"),c=r.find(".add-icon");return a.jqxInput({placeHolder:"Enter name",theme:"office"}),t.VA.Core.Utils.InputValidator.appendValidationCondition(a),s.jqxInput({placeHolder:"Enter description",theme:"office"}),a.jqxInput("val",i),a.on("change",function(){n.renderInOutValidation();}),l.click(function(){n.$outAliasArea.find(".out-alias").length>1?($(this).closest(".brtc-va-dialogs-export-to-udf.out-alias").remove(),n.renderInOutValidation(),n.refreshOutAliasFirstRowCss(n.$outAliasArea),e.perfectScrollbar("update")):t.VA.Core.Utils.WidgetUtils.openErrorDialog("There must be at least one out alias.");}),c.click(function(){n.createOutTableAlias(!0),n.renderInOutValidation();}),e.perfectScrollbar("update"),n.refreshOutAliasFirstRowCss(e),r;},e.prototype.refreshOutAliasFirstRowCss=function(t){1==t.find(".brtc-va-dialogs-export-to-udf.out-alias").length?(t.find(".brtc-va-dialogs-export-to-udf.out-alias").find(".out-alias-description").addClass("out-alias-desc-width-max"),t.find(".brtc-va-dialogs-export-to-udf.out-alias").find(".remove-icon").hide(),t.find(".brtc-va-dialogs-export-to-udf.out-alias").find(".add-icon").show(),t.find(".brtc-va-dialogs-export-to-udf.out-alias").find(".add-icon").addClass("add-icon-margin-left-10")):($(t.find(".brtc-va-dialogs-export-to-udf.out-alias")[0]).find(".out-alias-description").removeClass("out-alias-desc-width-max"),$(t.find(".brtc-va-dialogs-export-to-udf.out-alias")[0]).find(".remove-icon").show());},e.prototype.rednerOutAliasControl=function(){var t=this.options.outputAlias;if(0==t.length)this.createOutTableAlias(!0);else for(var e in t){var i=this.createOutTableAlias(!0);i.find(".out-alias-param-name").val(t[e].param_name),i.find(".out-alias-param-description").val(t[e].description);}},e.prototype.checkUDFName=function(){return""!==this.$nameControl.val().trim();},e.prototype.checkInputVariables=function(){var t=$.makeArray(this.$InputVariablesLineArea.find(".brtc-va-dialogs-export-to-udf.input-variable-param-name"));for(var e in t){if(""===$(t[e]).val().trim())return!1;if(1==/[\s]/g.test($(t[e]).val()))return!1;}return!0;},e.prototype.duplicateName=function(t,e){var i=$.makeArray(t);e&&(i=i.concat($.makeArray(e)));var o=[];for(var n in i){if(-1!=$.inArray($(i[n]).val().trim(),o))return!0;o.push($(i[n]).val().trim());}return!1;},e.prototype.checkOutAlias=function(){var t=$.makeArray(this.$outAliasArea.find(".brtc-va-dialogs-export-to-udf.out-alias-param-name"));for(var e in t){if(""===$(t[e]).val().trim())return!1;if(1==/[\s]/g.test($(t[e]).val()))return!1;}return!0;},e.prototype.checkScript=function(){return""!==this.scriptControl.getValue().trim();},e.prototype.handleOkClicked=function(){var e=this;if(this.checkUDFName()){if(this.checkInputVariables()){if(this.checkScript()){var i=this.$InputVariablesLineArea.find(".brtc-va-dialogs-export-to-udf.input-variable-param-name"),o=this.$outAliasArea.find(".brtc-va-dialogs-export-to-udf.out-alias-param-name");if(this.duplicateName(i))t.VA.Core.Utils.WidgetUtils.openErrorDialog("There is a duplicate name in the input variable.");else if(this.checkOutAlias()){if(this.duplicateName(o))t.VA.Core.Utils.WidgetUtils.openErrorDialog("There are duplicate name in the out alias.");else if(this.duplicateName(i,o))t.VA.Core.Utils.WidgetUtils.openErrorDialog("There are duplicate name in the input variable and out alias.");else{var n={url:"api/va/v2/ws/udfs?udfName="+this.$nameControl.val().trim()+"&udfVersion="+e.UDF_VERSION.trim(),type:"GET",contentType:"application/json; charset=utf-8",blocking:!0};$.ajax(n).done(function(i){if(0!=i.length)return e.dialogResult.udf_id=i[0].udf_id,void t.VA.Core.Utils.WidgetUtils.openErrorDialog("This name already exists. Please raise your version.");var o=e.$nameControl.val().trim().replace(/\s/gi,"_")+"_"+e.UDF_VERSION.replace(/\./gi,"_");e.dialogResult.udf_id=t.VA.Core.Utils.IDGenerator.udf.id(o),e.dialogResult.udf_name=e.$nameControl.val().trim(),e.dialogResult.udf_version=e.UDF_VERSION.trim(),e.dialogResult.description=e.noteControl.getCode(),e.dialogResult.contents=e.scriptControl.getValue(),e.dialogResult.udfParams=e.getUDFParams(),e.dialogResult.creator=t.VA.Env.Session.userId,e.dialogResult.in_table_count=e.getInTableCnt(),e.dialogResult.out_table_count=e.getOutTableAliaes().length,e.dialogResult.status="public",e.dialogResult.updater=t.VA.Env.Session.userId,e.dialogResult.name="python"==e.options.fnUnit.func?"PythonScript":"ScalaScript",t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(e);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Out alias are empty or contains spaces.");}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Script is empty.");}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Input variables are empty or contains spaces.");}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("UDF name is empty or contains spaces.");},e.prototype.getInTableCnt=function(){var t=this.scriptControl.getValue(),e="python"==this.options.fnUnit.func?/inputs\[(?:[0-9])\]/gm:/inputs\((?:[0-9])\)/gm,i=t.replace(/"(\\[\s\S]|[^"])*"|'(\\[\s\S]|[^'])*'|(--.*|\/\/.*|\/\*[\s\S]*?\*\/)/gm,function(t,e,i,o){return e?t:i?t:o?"":void 0;}).match(e);if(null===i||0==i.length)return 0;var o=i.join().match(/[0-9]/gm);return Math.max.apply(null,o)+1;},e.prototype.getUDFParams=function(){var t=this.$InputVariablesLineArea.find(".brtc-va-dialogs-export-to-udf.input-variable"),e=[];$(t).each(function(t,i){var o=$(i).find(".input-variable-param-name").jqxInput("val"),n=$(i).find(".input-variable-type").jqxDropDownList("val"),r=$(i).find(".input-variable-param-description").jqxInput("val");e.push({param_name:o,arg_type:n,description:r,inout_type:"IN",sequence:t+1});});var i=this.$outAliasArea.find(".brtc-va-dialogs-export-to-udf.out-alias");return $(i).each(function(t,i){var o=$(i).find(".out-alias-param-name").jqxInput("val"),n=$(i).find(".out-alias-param-description").jqxInput("val");e.push({param_name:o,arg_type:"",description:n,inout_type:"OUT",sequence:t+1});}),e;},e.prototype.getOutTableAliaes=function(){var t=this.$outAliasArea.find(".brtc-va-dialogs-export-to-udf.out-alias"),e=[];return $(t).each(function(t,i){var o=$(i).find(".out-alias-param-name").jqxInput("val");e.push(o);}),e;},e.prototype.createDialogButtonBar=function(e){t.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this,e),"save"==this.options.type?this.$okButton.val("Save"):this.$okButton.val("Update");},e.prototype.handleTestClicked=function(){var e=this;if(this.checkOutAlias()){if(0!=this.getInTableCnt()){var i=e.getUDFParams().filter(function(t){return"IN"===t.inout_type;}),o={title:"Test Parameter",inputDataCnt:e.getInTableCnt(),inputVariable:i,close:function close(i){if(i.OK){var o=e.createModel(i.inputTables,i.inputVariables);t.VA.Core.DataQueryTemplate.removeCache(o.mid);var n={main:"mid",models:{mid:o},version:t.VA.Env.CoreVersion},r=function r(i){e._checkProgress(i).done(function(t){"PROCESSING"==t.status?(e.progress(!0),setTimeout(r.bind(e,i),3e3)):"SUCCESS"==t.status?(e.progress(!1),e.refreshResult(o)):e.progress(!1,t.errorInfo[0].message);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},a={url:"api/va/v2/analytics/jobs/execute",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),blocking:!1};$.ajax(a).done(function(t){var i=JSON.parse(t).result;e.progress(!0),setTimeout(r.bind(e,i),3e3);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}}};new t.VA.Core.Dialogs.TestUDFParamDialog(e.$mainControl,o);}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("UDF test requires input data.");}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Out alias are empty or contains spaces.");},e.prototype._checkProgress=function(t){var e={url:"api/va/v2/analytics/jobs/"+t,type:"GET",blocking:!1};return $.ajax(e);},e.prototype.progress=function(e,i){e?this.$progress.show():(this.$progress.hide(),this.$okButton.jqxButton({disabled:e}),this.$cancelButton.jqxButton({disabled:e}),i&&t.VA.Core.Utils.WidgetUtils.openErrorDialog(i)),this.$okButton.jqxButton({disabled:e}),this.$cancelButton.jqxButton({disabled:e});},e.prototype.refreshResult=function(e){var i=this;for(var o in this.$resultPanelContent){this.$resultPanelContent[o].remove();}var n=e.functions[e.functions.length-1][OUT_DATA],r=e.functions[e.functions.length-1].param["out-table-alias"];for(var o in this.$resultPanelContent={},this.$resultSheet={},n){t.VA.Core.DataQueryTemplate.queryData(e.mid,n[o],0,1e3,function(t,o){i.createResultPanelContent(r[$.inArray(o,n)],t,e);var a=i.$mainControl.find(".brtc-va-dialogs-export-to-udf-result").position().top;i.$mainControl.find(".brtc-va-dialogs-exporttoudfdialog-contents").animate({scrollTop:a<0?0:a},500);},function(e,i){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);},!1);}},e.prototype.createModel=function(e,i){var o=this,n=(t.VA.Core.Utils.IDGenerator.model.id(),$.extend(!0,{},t.VA.Implementation.DataFlow.defaultModel));(n=$.extend(!0,n,t.VA.Default.model)).mid="mid",n.entries=[],n.title="UDF Test";var r="python"==this.options.fnUnit.func?$.extend(!0,{},t.VA.Core.Functions.Library.pythonScript.defaultFnUnit):$.extend(!0,{},t.VA.Core.Functions.Library.scalaScript.defaultFnUnit);for(var a in r.fid=t.VA.Core.Utils.IDGenerator.func.id(),r.label=r.display.label,r.persist=!0,r["persist-mode"]="auto",r.param["input-variables"]=[],e){var s=t.VA.Core.Utils.IDGenerator.table.id(),l=t.VA.Core.Utils.IDGenerator.func.id(),c=t.VA.Core.Utils.IDGenerator.func.id(),d=$.extend(!0,{},t.VA.Core.Functions.Library.load.defaultFnUnit);d.fid=l,d.label=d.display.label,d.persist=!0,d["persist-mode"]="auto",d[OUT_DATA]=[s],d.param.functions[0].fid=c,d.param.functions[0].label=d.display.label,d.param.functions[0][OUT_DATA]=[s],d.param.functions[0].param["df-names"]=[s],d.param.functions[0].param["fs-paths"].push(e[a].value),d.param.functions[0].param.persist=!0;var p={kid:t.VA.Core.Utils.IDGenerator.link.id(),sourceFid:l,targetFid:r.fid};n.links.push(p),n.functions.push(d),n.entries.push(l),r[IN_DATA].push(s);}for(var a in 0===e.length&&n.entries.push(r.fid),i){var u=[];u.push(i[a].paramName),u.push(i[a].paramType),u.push(i[a].value),r.param["input-variables"].push(u);}return r.param.script=o.scriptControl.getValue(),r.param["out-table-alias"]=o.getOutTableAliaes(),r.display.label=o.$nameControl.val(),r.parent=function(){var t=$.extend(!0,{},o.options.fnUnit.parent());return t.functions=[r],t.links=[],t;},$.each(o.getOutTableAliaes(),function(){r[OUT_DATA].push(t.VA.Core.Utils.IDGenerator.table.id());}),n.functions.push(r),n;},e.prototype._generateJobId=function(t){return"va_"+t+"_"+moment(Date.now()).format("YYYYMMDDHHmmssSSS");},e.prototype.createResultControl=function(t){var e=this,i=$('<div class="brtc-va-dialogs-export-to-udf-test-button-area brtc-s-style-dialogs-export-to-udf-test-button-area">   <input type="button" class="brtc-va-dialogs-export-to-udf-test-button brtc-s-style-dialogs-export-to-udf-test-button" value="Test Run" /></div><div class="brtc-va-dialogs-export-to-udf-result"></div>');i.find(".brtc-va-dialogs-export-to-udf-test-button").click(function(){e.handleTestClicked();}),t.append(i);},e.prototype.createResultPanelContent=function(t,e,i){this.$resultPanelContent[t]=$('<div class="brtc-va-dialogs-export-to-udf-result-panel-content"></div>'),this.$mainControl.find(".brtc-va-dialogs-export-to-udf-result").append(this.$resultPanelContent[t]),this.$mainControl.find(".brtc-va-dialogs-export-to-udf-result").perfectScrollbar(),this.$mainControl.find(".brtc-va-dialogs-export-to-udf-result").perfectScrollbar("update"),this.createResultContents(this.$resultPanelContent[t],t,e,i);},e.prototype.createResultContents=function(t,e,i,o){this.$resultSheet[e]=$('<div>   <div class="brtc-va-dialogs-export-to-udf-result-panel-content-title">Out( '+e+' )</div>   <div class="brtc-va-dialogs-export-to-udf-result-panel-content-chart-area"></div></div>'),t.append(this.$resultSheet[e]),this.createResultGrid(e,i,o),this.$mainControl.find(".brtc-va-dialogs-export-to-udf-result").perfectScrollbar("update");},e.prototype.createResultGrid=function(e,i,o){var n=$('<div class="brtc-va-dialogs-export-to-udf-result-panel-spreadsheet"></div>');this.$resultSheet[e].find(".brtc-va-dialogs-export-to-udf-result-panel-content-chart-area").append(n);var r={localdata:i.data,datatype:"array",datafields:$.map(i.columns,function(t,e){return{name:"__"+t.name,type:t.type,map:""+e};})},a=$.map(i.columns,function(e,i){var o={text:e.name,datafield:"__"+e.name,width:80};return"date"==e.type?o.cellsformat="yyyy-MM-dd HH:mm:ss:fff":"number"==e.type?(o.cellsformat="d",o.cellsalign="right"):"string"==e.type&&(o.cellsrenderer=function(e,i,o){var n="overflow:hidden; text-overflow:ellipsis; padding-bottom:2px; margin-right: 2px; margin-left: 4px; margin-top: 4px;",r=this.owner.source.records[e][i];if(void 0!==r&&""!==r&&null!==r)return'<div style="'+n+'">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o)+"</div>";var a=this.owner.source._source.localdata[e],s=this.owner.source._source.datafields,l=0;for(var c in s){if(s[c].name===i){l=Number(s[c].map);break;}}return void 0===a[l]?'<div style="'+n+'color: #ff3333">undefined</div>':null===a[l]?'<div align="right" style="'+n+'color: #ff3333">null</div>':""===a[l]?'<div align="right" style="'+n+'"></div>':void 0;}),o;});a.unshift({text:"No",sortable:!1,menu:!1,editable:!1,groupable:!1,draggable:!1,datafield:"",width:40,columntype:"number",renderer:function renderer(t){return'<div class="brtc-va-refine-spreadsheet-rownum-column">'+t+"</div>";},cellsformat:"d",cellsalign:"right",cellclassname:"brtc-va-refine-spreadsheet-rownum-cell",cellsrenderer:function cellsrenderer(t,e,i){return'<div align="right" style="margin:4px;">'+(i+1)+"</div>";}});var s=new $.jqx.dataAdapter(r);n.jqxGrid({theme:t.VA.Env.Theme,width:"100%",height:"200",rowsheight:25,source:s,altrows:!1,filterable:!1,sortable:!1,columnsresize:!0,selectionmode:"multiplecellsextended",columns:a}),n.on("columnclick",function(t){"No"==t.args.column.text&&$(this).jqxGrid("autoresizecolumns");});},e.prototype.createWorksheet=function(t,e,i){var o={data:[],columns:[]},n=this;"object"==typeof e&&(o=e||o);var r={worksheet:{layout:[],panel:[{id:"default-"+Date.now(),chartOption:{chart:{type:"table"}}}]}},a={dataType:"lazy",lazyData:[{columns:function columns(){return o.columns;},data:function data(t){setTimeout(function(){t.done({dataType:"rawdata",columns:o.columns,data:o.data});},100);}}]};r.worksheet.panel[0].chartOption.source=a,r.worksheet.toolbar={menu:{setting:{click:function click(){n._handleChartSettings(this);}},duplicate:{},close:{}}},this.$resultSheet[t].find(".brtc-va-dialogs-export-to-udf-result-panel-content-chart-area").bchartsAdonis(r);},e.prototype.createChartSettingControl=function(t){var e=$('<div class="brtc-va-dialog brtc-va-chart-settings brtc-va-dialog-export-to-udf">   <div class="brtc-va-dialog-header">       <div class="brtc-va-dialog-title">Chart Settings</div>       <div class="brtc-va-dialog-button" action="close"></div>   </div>   <div class="brtc-va-dialog-contents"></div></div>');return t.append(e),e.draggable({handle:e.find(".brtc-va-dialog-header > .brtc-va-dialog-title"),containment:"parent"}),e.find('.brtc-va-dialog-header > .brtc-va-dialog-button[action="close"]').click(function(){$(this).closest(".brtc-va-dialog.brtc-va-chart-settings").hide();}),e.hide(),e;},e.prototype._handleChartSettings=function(t){this._openChartSettingsDialog(t),this.onSelectChart();},e.prototype._openChartSettingsDialog=function(t){var e=t.$mainControl.closest(".brtc-va-dialogs-export-to-udf-result-panel-content-chart-area").find(".brtc-va-dialog.brtc-va-chart-settings");if(!1===e.is(":visible")){var i=t.$mainControl.closest(".brtc-va-dialogs-export-to-udf-result-panel-content-chart-area").offset();i.right=t.$mainControl.closest(".brtc-va-dialogs-export-to-udf-result-panel-content-chart-area").outerWidth(),i.bottom=t.$mainControl.closest(".brtc-va-dialogs-export-to-udf-result-panel-content-chart-area").outerHeight();var o=e.outerWidth(),n=e.outerHeight();i.top-=40,i.top+n>i.bottom&&(i.top=i.bottom-n),i.left=i.right-o,e.css({left:i.left,top:i.top}),e.show();}},e.prototype.getHighestZindex=function(t){for(var e=$("body").children(".jqx-window"),i=0,o=0,n=0;n<e.length;n++){(o=parseInt($(e[n]).css("z-index"))||0)>i&&(i=o);}return i+1;},e.prototype._attachChartOptionPanelToDialog=function(t){t.data("original-parent",t.parent()),t.detach(),this.$mainControl.find(".brtc-va-dialog.brtc-va-chart-settings").find(".brtc-va-dialog-contents").append(t);},e.prototype.onSelectChart=function(){this.$mainControl.find(".brtc-va-dialog.brtc-va-chart-settings").is(":visible")&&(this.$chartOptionPanel=this.$mainControl.find(".bcharts-option-panel"),this.$chartOptionPanel.length>0&&(this._detachChartOptionPanel(),this._attachChartOptionPanelToDialog(this.$chartOptionPanel)));},e.prototype._detachChartOptionPanel=function(){this.$mainControl.find(".brtc-va-dialog.brtc-va-chart-settings").find(".bcharts-option-panel").each(function(t,e){var i=$(e),o=i.data("original-parent");i.detach().appendTo(o);});},e.prototype._attachChartOptionPanelToDialog=function(t){t.data("original-parent",t.parent()),t.detach(),this.$mainControl.find(".brtc-va-dialog.brtc-va-chart-settings").find(".brtc-va-dialog-contents").append(t);},e.prototype.renderValidation=function(t,e,i,o){var n=o||t.val();if(t.parent().find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove(),"true"==t.attr("isMandatory")&&""==n||i&&1==/[\s]/g.test(n)){t.addClass("brtc-s-style-export-to-udf-validation-error");var r=$('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">      <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>      <div class="brtc-va-editors-sheet-panels-validation-tooltip">'+e+"</div></div>");$(t).parent().append(r);}else t.removeClass("brtc-s-style-export-to-udf-validation-error");},e.prototype.renderInOutValidation=function(){var t=$.makeArray(this.$InputVariablesLineArea.find(".brtc-va-dialogs-export-to-udf.input-variable-param-name"));this.$outAliasArea&&(t=t.concat($.makeArray(this.$outAliasArea.find(".brtc-va-dialogs-export-to-udf.out-alias-param-name"))));var e=[];for(var i in t){$(t[i]).removeClass("brtc-s-style-export-to-udf-validation-error"),$(t[i]).parent().parent().find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove(),$(t[i]).parent().parent().removeClass("mb-25");var o=$.inArray($(t[i]).val().trim(),$.map(e,function(t){return t.value;})),n=$(t[i]).val();if(-1==o){if("true"==$(t[i]).attr("isMandatory")&&""==n||1==/[\s]/g.test(n)){$(t[i]).addClass("brtc-s-style-export-to-udf-validation-error");var r=$('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>   <div class="brtc-va-editors-sheet-panels-validation-tooltip">"Name" is required.</div></div>');$(t[i]).parent().parent().append(r),$(t[i]).parent().parent().addClass("mb-25");}e.push({index:i,value:$(t[i]).val().trim()});}else{$(t[o]).addClass("brtc-s-style-export-to-udf-validation-error"),$(t[i]).addClass("brtc-s-style-export-to-udf-validation-error");var a='"'+$(t[i]).val()+'" already used.';""==$(t[i]).val()&&(a="Name is required.");r=$('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>      <div class="brtc-va-editors-sheet-panels-validation-tooltip">'+a+"</div> </div>");$(t[i]).parent().parent().append(r),$(t[i]).parent().parent().addClass("mb-25");}}},t.VA.Core.Dialogs.ExportToUDFDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this._configureDialogOption({theme:t.VA.Env.Theme,title:"Remote file path",width:400,height:250,modal:!0,resizable:!1});},e.prototype.createDialogContentsArea=function(e){this.$input=$('<input type="text"/>'),e.append(this.$input),this.$input.jqxInput({placeHolder:"Enter name",theme:t.VA.Env.Theme,width:"calc(100% - 2px)",height:25}),this.$input.val(this.options.name),this.$input.jqxInput("selectAll"),this.$input.jqxInput("focus");},e.prototype.handleOkClicked=function(){""!==this.$input.val().trim()?(this.dialogResult={OK:!0,Cancel:!1,name:this.$input.val()},this.$mainControl.dialog("close")):t.VA.Core.Utils.WidgetUtils.openErrorDialog("File does not exist.",function(){});},e.prototype.handleCancelClicked=function(){this.dialogResult={OK:!1,Cancel:!0},this.$mainControl.dialog("close");},t.VA.Core.Dialogs.FilePathDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls(),this.initContents(),this.registerCommandListener();}e.prototype.registerCommandListener=function(){var t=this;this.commandListener=function(e,i){t.handleCommand(e,i);},this.options.editor.addCommandListener(this.commandListener),this.options.editor.addGoHistoryListener(this.commandListener);},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-main-history">   <div class="brtc-va-dialogs-body">   </div></div>'),this.$mainControl.dialog({title:"History",appendTo:this.$parent,position:{my:"left top",at:"left bottom",of:this.$parent.find(".brtc-style-s-editor-toolitem[item-type=history]")},width:400,height:600,maxWidth:400,maxHeight:600,modal:!1,resizable:!1}),this.$mainControl.parent().draggable("option","containment",this.$parent);},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-body"));},e.prototype.createDialogContentsArea=function(t){this.$historyList=$('<div class="brtc-va-dialogs-body-historylist" style="padding-right: 0px; padding-top: 5px;"></div>'),t.append(this.$historyList);var e=this;this.options.source.unshift({name:"Open",description:"Init history"}),$.each(this.options.source,function(t,i){e.addHistory(i);}),this.setSelect(),this.$historyList.perfectScrollbar();},e.prototype.close=function(){this.$mainControl.dialog("close"),this.options.editor.removeCommandListener(this.commandListener),this.options.editor.removeGoHistoryListener(this.commandListener),this.$mainControl.dialog("destroy");},e.prototype.setSelect=function(){this.changeBackGround(this.options.stackIndex+1);},e.prototype.changeBackGround=function(t){var e=this.$historyList.find(".brtc-va-dialogs-body-historylist-history");$.each(e,function(e,i){e>t?($(i).addClass("brtc-va-dialogs-body-historylist-history-gray"),$(i).removeClass("brtc-va-dialogs-body-historylist-history-highlight")):e<t?($(i).removeClass("brtc-va-dialogs-body-historylist-history-gray"),$(i).removeClass("brtc-va-dialogs-body-historylist-history-highlight")):($(i).removeClass("brtc-va-dialogs-body-historylist-history-gray"),$(i).addClass("brtc-va-dialogs-body-historylist-history-highlight"));});},e.prototype.handelselectedItem=function(t){var e=this.$historyList.find(".brtc-va-dialogs-body-historylist-history"),i=$.inArray(t,e);this.changeBackGround(i);var o={};o.label=$(t).text(),o.index=i-1,this.handleSelect(o);},e.prototype.handleCommand=function(e,i){if(e instanceof t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand)this.options.editor.save(e,i);else if("EXECUTE"==e.event.type){var o;o=e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.AddFnUnitParameterCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveFnUnitParameterCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.ReplaceFnUnitParamCommand?e.getLabel()+" - "+e.options.fnUnit.display.label:e.getLabel();var n=this.$historyList.find(".brtc-va-dialogs-body-historylist-history");if(this.options.editor.getCommandManager().index+1!==n.length)for(var r=this.options.editor.getCommandManager().index+1;r<n.length;r++){$(n[r]).remove();}this.addHistory({name:e.getLabel(),description:o}),this.changeBackGround(this.options.editor.getCommandManager().index+1),this.$historyList.scrollTop(this.$historyList.prop("scrollHeight"));}else"UNDO"!=e.event.type&&"REDO"!=e.event.type||this.changeBackGround(this.options.editor.getCommandManager().index+1);},e.prototype.addHistory=function(e){var i=this.$historyList.find(".brtc-va-dialogs-body-historylist-history"),o=this;$.each(i,function(t,e){$(e).removeClass("brtc-va-dialogs-body-historylist-history-highlight"),$(e).removeClass("brtc-va-dialogs-body-historylist-history-gray");});var n=$('<div class="brtc-va-dialogs-body-historylist-history">   <div class="brtc-va-dialogs-body-history-icon"></div>   <div class="brtc-va-dialogs-body-history-label">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e.name)+"</div></div>");e.name&&(0==e.name.indexOf("Create")||0==e.name.indexOf("Clone")?n.find(".brtc-va-dialogs-body-history-icon").addClass("brtc-va-dialogs-body-history-create"):0==e.name.indexOf("Remove")?n.find(".brtc-va-dialogs-body-history-icon").addClass("brtc-va-dialogs-body-history-remove"):0==e.name.indexOf("Create")||0==e.name.indexOf("Clone")?n.find(".brtc-va-dialogs-body-history-icon").addClass("brtc-va-dialogs-body-history-open"):n.find(".brtc-va-dialogs-body-history-icon").addClass("brtc-va-dialogs-body-history-edit")),n.on("click",function(t){o.handelselectedItem(this);}),0===i.length?this.$historyList.append(n):$(i[i.length-1]).after(n);},e.prototype.handleSelect=function(t){this.dialogResult={OK:!0,Cancel:!1,goHistory:{index:t.index,name:t.label,eventType:t.eventType}},"function"==typeof this.options.selectHistory&&this.options.selectHistory(this.dialogResult);},t.VA.Core.Dialogs.HistorySelector=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.results=$.extend(!0,{},i.param),this.DATA_PARAM={"copy-from":{label:"Import From",type:"radio",category:"source"},"input-path":{label:"Input Path",type:"code",category:"source",mandatory:!0,placeholder:"ex. /temp/data.csv"},ip:{label:"IP",type:"code",category:"source",mandatory:!0},port:{label:"Port",category:"source",mandatory:!0},"output-path":{label:"Output Path",type:"code",category:"target",mandatory:!0},"datasource-name":{label:"Datasource",type:"dropDown",category:"source",mandatory:!0},"table-name":{label:"Table Name",type:"code",category:"source",mandatory:!0},"column-type":{label:"Column Type",type:"code",category:"source",placeholder:"ex. Int, String, String"},delimiter:{label:"Delimiter",type:"radio",category:"source"},quote:{label:"Quote",type:"radio",category:"source"},"array-delimiter":{label:"Array Delimiter",type:"radio",category:"source"},"array-start-string":{label:"Array Start",type:"radio",category:"source"},"array-end-string":{label:"Array End",type:"radio",category:"source"},"key-value-delimiter":{label:"Key Value",type:"radio",category:"source"},"map-start-string":{label:"Map Start",type:"radio",category:"source"},"map-end-string":{label:"Map End",type:"radio",category:"source"},"null-value":{label:"Null Value",type:"radio",category:"source"},"nan-value":{label:"NaN Value",type:"radio",category:"source"},"is-delete":{label:"Overwrite",type:"radio",category:"target"},"connection-timeout":{label:"Connection Timeout(sec)",type:"number",category:"source",placeholder:"Default: 600",max:3e3},"execution-timeout":{label:"Execution Timeout(sec)",type:"number",category:"source",placeholder:"Default: 600",max:3e3}},this.RADIO_DATA_PARAM={"copy-from":[{label:"Repository",value:"alluxio"},{label:"HDFS",value:"hdfs"},{label:"Relational DB",value:"jdbc"}],delimiter:[{label:"Comma",value:","},{label:"Tab",value:"\t"},{label:"Space",value:" "},{label:"Colon",value:":"},{label:"Semicolon",value:";"},{label:"Other",value:"Other"}],quote:[{label:"Double Quotation",value:'"'},{label:"Other",value:"Other"}],"array-delimiter":[{label:"Colon",value:":"},{label:"Other",value:"Other"}],"array-start-string":[{label:"Left Square Bracket",value:"["},{label:"Other",value:"Other"}],"array-end-string":[{label:"Right Square Bracket",value:"]"},{label:"Other",value:"Other"}],"key-value-delimiter":[{label:"Equal",value:"="},{label:"Other",value:"Other"}],"map-start-string":[{label:"Left Curly Bracket",value:"{"},{label:"Other",value:"Other"}],"map-end-string":[{label:"Right Curly Bracket",value:"}"},{label:"Other",value:"Other"}],"null-value":[{label:"Empty String",value:""},{label:"Other",value:"Other"}],"nan-value":[{label:"NaN",value:"NaN"},{label:"Other",value:"Other"}],"is-delete":[{label:"True",value:"true"},{label:"False",value:"false"}]},this.PARAM_VISIBLE={hdfs:["copy-from","column-type","input-path","ip","port","output-path","delimiter","quote","array-delimiter","array-start-string","array-end-string","key-value-delimiter","map-start-string","map-end-string","null-value","nan-value","is-delete"],jdbc:["copy-from","column-type","datasource-name","output-path","is-delete","table-name","connection-timeout","execution-timeout"],alluxio:["copy-from","column-type","input-path","output-path","delimiter","quote","array-delimiter","array-start-string","array-end-string","key-value-delimiter","map-start-string","map-end-string","null-value","nan-value","is-delete"]},t.VA.Core.Dialogs.FnUnitDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.FnUnitDialog.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-style-minus-40">    <div class="brtc-va-dialogs-body">        <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px brtc-style-padding-right-20"></div>        <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit brtc-style-display-flex brtc-style-width-97-p"></div>        <div class="brtc-va-dialogs-buttonbar brtc-style-padding-right-30"></div>    </div></div>'),this.$titleArea=this.$mainControl.find(".brtc-va-dialogs-title");},e.prototype.createDialogContentsArea=function(t){var e=this;this.$contentsAreaWrapper=$('<div class="brtc-va-views-properties-pages import-setting-dialog brtc-style-width-full rtc-style-overflow-hidden">   <div class="brtc-va-views-properties-pages-contents-area brtc-style-padding-right-10 brtc-style-relative brtc-style-full"></div></div>'),this.$contentsAreaWrapper.css({width:this.options.width,height:this.options.height}),t.append(this.$contentsAreaWrapper),this.$contentsArea=this.$contentsAreaWrapper.find(".brtc-va-views-properties-pages-contents-area"),this.codeArgumentControlMap={},this.addPropertyControl("Source",function(t){e.variableArea=t,e.createCategoryControl(t,"source");}),this.addPropertyControl("Target",function(t){e.variableArea=t,e.createCategoryControl(t,"target");}),this.setParamControlVisible(e.results["copy-from"]),this.renderValidation(),this.$contentsAreaWrapper.find(".brtc-va-views-properties-pages-contents-area").perfectScrollbar();},e.prototype.renderValidation=function(){this.removeValidation();},e.prototype.createValidationContent=function(t,e,i){var o=$('<div class="brtc-va-editors-sheet-panels-validation-tooltip-wrapper">   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>   <div class="brtc-va-editors-sheet-panels-validation-tooltip">'+e.message+"</div></div>");t.append(o),t.addClass("brtc-va-editor-sheet-panels-validation-error"),i&&o.css("clear","both"),o.show();},e.prototype.removeValidation=function(){this.$mainControl.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove(),this.$mainControl.find(".brtc-va-editors-sheet-controls-propertycontrol-label").removeClass("brtc-va-editors-sheet-controls-propertycontrol-label-error"),this.$mainControl.find(".brtc-va-editor-sheet-panels-validation-error").removeClass("brtc-va-editor-sheet-panels-validation-error"),this.$mainControl.find(".brtc-va-editors-sheet-panels-validation-tooltip-wrapper").remove();},e.prototype.addPropertyControl=function(e,i,o){var n=this,r=$('<div class="brtc-va-views-properties-pages-controls-propertycontrol">   <div class="brtc-va-views-properties-pages-controls-propertycontrol-label"></div>   <div class="brtc-va-views-properties-pages-controls-propertycontrol-contents"></div>');return o&&o.mandatory&&(e="<div>"+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e)+'   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>'),this.$contentsArea.append(r),r.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"left",initContent:function initContent(){"function"==typeof i&&i.call(n,r.find(".brtc-va-views-properties-pages-controls-propertycontrol-contents"),o);}}),r.jqxExpander("setHeaderContent",e),r;},e.prototype.createCategoryControl=function(t,e){for(var i,o,n=Object.keys(this.DATA_PARAM),r=0;r<n.length;r++){if(o=n[r],this.DATA_PARAM[o].category===e){(i=$('<div class="control-row" control-type="'+o+'">   <div class="column-1">'+this.DATA_PARAM[o].label+': </div>   <div class="column-2" /></div>')).find(".column-1").addClass(o),this.DATA_PARAM[o].mandatory&&i.find(".column-1").addClass("mandatory"),t.append(i);var a=this.results;"radio"===this.DATA_PARAM[o].type?(this.createRadioArgumentControl(i,o),this.setRadioControlValue(o,a[o]||"")):"code"===this.DATA_PARAM[o].type?(this.createCodeArgumentControl(i,o),this.setCodeControlValue(o,a[o]||"")):"dropDown"===this.DATA_PARAM[o].type?(this.createDropDownArgumentControl(i,o),this.setDropDownControlValue(o,a[o]||"")):"number"===this.DATA_PARAM[o].type?(this.createNumberInputArgumentControl(i,o),this.setNumberInputControlValue(o,a[o]||"")):(this.createInputArgumentControl(i,o),this.setInputControlValue(o,a[o]||""));}}},e.prototype.createRadioArgumentControl=function(e,i){var o=this,n=$('<div class="brtc-va-views-properties-pages-controls-propertycontrol-button" param-key="'+i+'"/>');e.find(".column-2").append(n);for(var r=0;r<this.RADIO_DATA_PARAM[i].length;r++){var a=this.RADIO_DATA_PARAM[i][r].label,s=this.RADIO_DATA_PARAM[i][r].value;'"'===s&&(s="quot");var l=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton" param-value="'+s+'"/>');n.append(l),"Other"==s?(l.append('<div class="brtc-va-delimiter-input-wrapper">   <input type="text" class="brtc-va-delimiter-input"/></div>'),o.createRadioButton(l,i),l.find(".brtc-va-delimiter-input").jqxInput({theme:t.VA.Env.Theme,width:57,height:24}),l.find(".brtc-va-delimiter-input").on("change",function(){o.results[i]=$(this).val(),o.renderValidation();})):(l.text(a),o.createRadioButton(l,i)),l.on("checked",function(t){var e=$(t.target);if("quot"==e.attr("param-value")?o.results[i]='"':o.results[i]=e.attr("param-value"),"Other"==e.attr("param-value")){var n=e.find(".brtc-va-delimiter-input");o.results[i]=n.val();}"copy-from"!==i&&"copy-to"!==i||(o.setParamControlVisible(o.results[i]),o.$mainControl.find(".brtc-va-dialogs-contents").perfectScrollbar("update")),o.renderValidation();});}},e.prototype.setParamControlVisible=function(t){for(var e,i=Object.keys(this.DATA_PARAM),o=this.PARAM_VISIBLE[t],n=0;n<i.length;n++){e=this.$mainControl.find("div[control-type="+i[n]+"]"),o.indexOf(i[n])>=0?e.css("display",""):e.css("display","none"),e.find(".CodeMirror").each(function(t,e){e.CodeMirror.refresh();});}},e.prototype.createCodeArgumentControl=function(e,i){var o=this,n=$('<textarea  class="brtc-va-views-properties-pages-controls-propertycontrol-code-input" param-key="'+i+'"/>');e.find(".column-2").append(n);var r={verifier:"column-type"===i?new t.VA.Core.Verifier():new t.VA.Core.Verifier.CFVariableVerifier(),mode:"brtc-controlflow-variable",scrollbarStyle:"null",placeholder:this.DATA_PARAM[i].placeholder||"",lineWrapping:!1,lineNumbers:!1,extraKeys:{"Ctrl-Space":"autocomplete",Tab:!1,"Shift-Tab":!1},showTrailingSpace:!0,hintOptions:{paramKey:i,list:"column-type"===i?["Int","Long","String","Double","Boolean"]:[]}},a=o.createCodeMirrorControl(n,r);t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(a),a.on("blur",function(t,e){o.results[i]="column-type"==i?o.splitStringToArrayWithTrim(t.getValue()):t.getValue(),o.renderValidation();}),this.codeArgumentControlMap[i]=a;},e.prototype.splitStringToArrayWithTrim=function(t){var e=[],i=t.split(",");i=$.map(i,function(t,e){return t.trim();});for(var o=0;o<i.length;o++){if(-1!=i[o].toLowerCase().indexOf("map")){var n=i[o]+","+i[++o];e.push(n);}else e.push(i[o]);}return e;},e.prototype.createDropDownArgumentControl=function(t,e){var i=this,o=$('<div class="brtc-va-views-properties-pages-controls-propertycontrol-dropdown" param-key="'+e+'"/>');if(t.find(".column-2").append(o),i.createDropDownList(o,{}),o.on("change",function(t){i.results[e]=$(this).val(),i.renderValidation();}),"datasource-name"===e){var n=new $.jqx.dataAdapter({datatype:"json",datafields:[{name:"datasourceName",type:"string"},{name:"datasourceType",type:"string"}],url:"api/va/v2/datasources?type=RDB"},{loadComplete:function loadComplete(){o.val(i.results[e]);}});o.jqxDropDownList({source:n,displayMember:"datasourceName",valueMember:"datasourceName"});}},e.prototype.createNumberInputArgumentControl=function(e,i){var o=this,n=$('<div class="brtc-va-views-properties-pages-controls-propertycontrol-numberinput" param-key="'+i+'"/>');e.find(".column-2").append(n);var r={placeholder:this.DATA_PARAM[i].placeholder};this.DATA_PARAM[i].max&&(r.max=this.DATA_PARAM[i].max);var a=o.createNumberInput(n,r);t.VA.Core.Utils.WidgetUtils.putData(n,i,a),a.onChange(function(t){o.results[i]=t,o.renderValidation();});},e.prototype.createInputArgumentControl=function(t,e){var i=this,o=$('<input type="text" class="brtc-va-views-properties-pages-controls-propertycontrol-input" param-key="'+e+'"/>');t.find(".column-2").append(o),i.createInput(o,{}),o.on("change",function(t){i.results[e]=$(this).val(),i.renderValidation();});},e.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper controlflow"></div>');t.wrap(e);},e.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},e.prototype.createRadioButton=function(e,i){this.wrapControl(e),"quote"===i||"array-delimiter"===i||"array-start-string"===i||"array-end-string"===i||"key-value-delimiter"===i||"map-start-string"===i||"map-end-string"===i||"null-value"===i||"nan-value"===i?this.addClassToWrapper(e,"brtc-va-editors-control-controls-radiobutton-default brtc-va-editors-sheet-controls-width-6"):this.addClassToWrapper(e,"brtc-va-editors-control-controls-radiobutton-default brtc-va-editors-sheet-controls-width-4");var o={theme:t.VA.Env.Theme,width:"100%",height:"25px",groupName:i};e.jqxRadioButton(o);},e.prototype.setRadioControlValue=function(t,e){'"'===e&&(e="quot");var i=[];"\\"!=e&&(i=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-button[param-key="'+t+'"] .brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value="'+e+'"]')),0==i.length?((i=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-button[param-key="'+t+'"] .brtc-va-editors-sheet-controls-propertycontrol-radiobutton[param-value="Other"]')).jqxRadioButton({checked:!0}),"quot"===e&&(e='"'),i.find(".brtc-va-delimiter-input").jqxInput("val",e)):i.jqxRadioButton({checked:!0});},e.prototype.createCodeMirrorControl=function(t,e){return this.wrapControl(t),t.addClass("brtc-va-editors-sheet-controls-textareacontrol"),CodeMirror.fromTextArea(t[0],e);},e.prototype.setCodeControlValue=function(t,e){var i=this.codeArgumentControlMap[t],o=this.splitStringToArrayWithTrim(i.getValue());e.toString()!==o.toString()&&i.setValue(e.toString());},e.prototype.createDropDownList=function(e){this.wrapControl(e);var i={theme:t.VA.Env.Theme,width:"100%",height:"25px"};e.jqxDropDownList(i);},e.prototype.setDropDownControlValue=function(t,e){var i=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-dropdown[param-key="'+t+'"]');i.val()!==e&&i.val(e);},e.prototype.createNumberInput=function(e,i){this.wrapControl(e);var o={min:0};return $.extend(!0,o,i),new t.VA.Core.Editors.Sheet.Controls.NumericInput(e,o);},e.prototype.setNumberInputControlValue=function(e,i){var o=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-numberinput[param-key="'+e+'"]');t.VA.Core.Utils.WidgetUtils.getData(o,e).setValue(i);},e.prototype.createInput=function(e,i){this.wrapControl(e);var o={theme:t.VA.Env.Theme,height:"25px"};$.extend(!0,o,i),e.jqxInput(o);},e.prototype.setInputControlValue=function(t,e){var i=this.$mainControl.find('.brtc-va-views-properties-pages-controls-propertycontrol-input[param-key="'+t+'"]');i.val()!==e&&i.val(e);},e.prototype.handleOkClicked=function(){this.options.fnUnit.param=$.extend(!0,{},this.results),this.dialogResult={OK:!0,Cancel:!1,results:{fnUnit:this.options.fnUnit}},this.$mainControl.dialog("close");},t.VA.Core.Dialogs.ImportDataSettingDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.modelData={},this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-newfiledialog import">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents import">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK"/>           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel"/>       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel");var e=this,i={theme:t.VA.Env.Theme,title:"Report"===this.options.fileType?"Import Report":"Import Model",width:778,height:500,modal:!0,resizable:!1,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}};this.$mainControl.dialog(i);},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme,disabled:!0}),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.performFinish.bind(this)),this.$cancelButton.click(this.handleCancelClicked.bind(this));},e.prototype.createDialogContentsArea=function(e){var i=this;e.append('<div class="brtc-va-dialogs-newfiledialog-label import"></div>');var o=e.find(".brtc-va-dialogs-newfiledialog-label.import");o.css({width:"100%",height:"100%",overflow:"hidden"}),this.fileList=new t.VA.Core.Widget.Controls.FileList(o,{multiple:!0}),o.on("addFile",function(t,e,o){i.makeModelData(e,o);}),o.on("removeFile",function(t,e){for(var o in e){delete i.modelData[e[o]];}i.configureOkButton();});},e.prototype.configureOkButton=function(){var t=Object.keys(this.fileList.getFiles()),e=Object.keys(this.modelData);t.length>0&&t.length==e.length?this.$okButton.jqxButton({disabled:!1}):this.$okButton.jqxButton({disabled:!0});},e.prototype.makeModelData=function(t,e){var i=this,o=[],n=function n(o,_n6){i.handleLocalFileSelected(r,t[r],e,o);};for(var r in t){var a=new Promise(n);o.push(a);}Promise.all(o).then(function(){i.configureOkButton();},function(t){});},e.prototype.handleLocalFileSelected=function(e,i,o,n){var r=this,a={model:{},errorMessage:""};try{var s=new FileReader();o[e]?(a.errorMessage="Omitted for duplicate.",t.VA.Core.Utils.WidgetUtils.openErrorDialog(a.errorMessage)):(s.onloadend=function(i){var o={};if(i.target.readyState==FileReader.DONE){try{o=JSON.parse(i.target.result);}catch(e){a.errorMessage="Invalid Model(.json) File.",t.VA.Core.Utils.WidgetUtils.openErrorDialog("Invalid Model(.json) File.");}a.errorMessage=r.options.resourceManager.validateFile(o,r.options.fileType);}else a.errorMessage="Invalid Model(.json) File.";a.errorMessage?(r.fileList.setDisableFile(e,a.errorMessage),t.VA.Core.Utils.WidgetUtils.openErrorDialog(a.errorMessage)):r.modelData[e]=o,n();},s.readAsText(i));}catch(t){a.errorMessage="Only JSON file can be imported.",r.fileList.setDisableFile(i.fileKey,a.errorMessage),n();}},e.prototype.createFileContents=function(e,i){var o=t.VA.Core.Utils.ModelUtils.cloneModel(i);return o.mid=e,o;},e.prototype.getFileNameByMid=function(t){var e=this,i=this.fileList.getFiles();return _.chain(i).filter(function(i,o){var n=e.modelData[o];return n&&n.mid===t;}).map("name").value();},e.prototype.performFinish=function(){var e=this,i=function(){this.dialogResult={OK:!0,Cancel:!1,selectedFiles:[]},this.$mainControl.dialog("close");}.bind(this);Studio.getResourceService().importJSONs(_.toArray(this.modelData),this.options.project.getProjectId()).then(i).catch(function(i){i.responseJSON.errors[0].message+=" ("+e.getFileNameByMid(i.responseJSON.errors[0].mid).join(", ")+")",delete i.responseJSON.errors[0].detailMessage,t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(i);});},e.prototype.handleCancelClicked=function(){this.dialogResult.OK=!1,this.dialogResult.Cancel=!0,this.$mainControl.dialog("close");},t.VA.Core.Dialogs.ImportDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-import-project">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents"></div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK"/>           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel"/>       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel");var e=this,i={theme:t.VA.Env.Theme,title:"Import Project",width:778,height:500,modal:!0,resizable:!1,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}};this.$mainControl.dialog(i);},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.performFinish.bind(this)),this.$cancelButton.click(this.handleCancelClicked.bind(this));},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-dialogs-label select-file">Select File</div><div class="brtc-va-dialogs-select-file-control"></div><div class="brtc-va-dialogs-label name">Name</div><input type="text" class="brtc-va-dialogs-name-input" maxlength="80"/><div class="brtc-va-dialogs-label description">Description</div><div class="brtc-va-dialogs-description-container"></div>'),this.createSelectFileControl(t.find(".brtc-va-dialogs-select-file-control")),this.createNameControl(t.find(".brtc-va-dialogs-name-input")),this.createDescriptionControl(t.find(".brtc-va-dialogs-description-container"));},e.prototype.createSelectFileControl=function(e){var i=this;e.append('<div class="brtc-va-dialogs-dataupload-contents">   <div class="brtc-va-dialogs-dataupload-contents-fileselectpage page import">      <div class="fileselect">          <div class="contents filename">              <span class="nodata">Select file to upload</span>          </div>          <div class="header">                  <input for="brtc-va-dialogs-dataupload-contents-fileselectpage-ex-filename open-model-button" type="button" id="fileselect-local" value="Find" />                  <input type="file" id="brtc-va-dialogs-dataupload-contents-fileselectpage-ex-filename" name="fileToUpload" accept=".json">          </div>      </div>   </div></div>'),this.$fileSelectPage=e.find(".brtc-va-dialogs-dataupload-contents-fileselectpage");var o=this.$fileSelectPage.find("#fileselect-local"),n=this.$fileSelectPage.find("#brtc-va-dialogs-dataupload-contents-fileselectpage-ex-filename");o.jqxButton({theme:t.VA.Env.Theme}),o.on("click",function(){n.click();}),n.on("change",function(t){i.file=$(this)[0].files[0],i.handleLocalFileSelected();}),o.focus(),o.attr("tabindex","1"),this.$fileSelectPage.find(".import-contents").perfectScrollbar();},e.prototype.createNameControl=function(e){this.$nameControl=e,this.$nameControl.jqxInput({width:618,height:23,theme:t.VA.Env.Theme}),this.$nameControl.attr("tabindex","2");},e.prototype.createDescriptionControl=function(e){var i=this,o={focus:!1,height:208,description:"",okButton:this.$okButton,maxLength:2e3,toolbar:this.options.toolbar};this.noteControl=t.VA.Core.Widget.Factory.noteControl(e,o),e.find(".note-editable.panel-body").attr("tabindex","3"),this.$mainControl.on("resizing",function(t){i.noteControl.setHeight(i.$mainControl.find(".brtc-va-dialogs-contents").height()-110);});},e.prototype.reset=function(){this.file="",this.fileName="",this.data=[],$("input[type=file]").val("");},e.prototype.isJsonFile=function(t){var e=this.fileName.split(".");return"json"==e[e.length-1];},e.prototype.handleLocalFileSelected=function(){var e=this;this.fileName=this.file.name,window.FileReader||(this.fileName=$(this).val().split("/").pop().split("\\").pop());var i=this.$fileSelectPage.find(".filename");i.empty(),i.append($('<span class="brtc-va-icon brtc-va-dialogs-dataupload file"></span><span class="brtc-va-dialogs-dataupload file-name"></span>')),i.find(".brtc-va-dialogs-dataupload.file-name").text(e.fileName),i.find(".brtc-va-dialogs-dataupload.file-name").attr("title",e.fileName);var o=Studio.getResourceService();if(this.isJsonFile(this.fileName))try{var n=new FileReader();n.onloadend=function(n){if(e.reset(),n.target.readyState===FileReader.DONE)try{o.validateExportedProjectSpec(JSON.parse(n.target.result)).then(function(t){e.data=t,e.$nameControl.val(t.data.label||"untitled"),e.noteControl.setValue(t.data.description||"");}).catch(function(){i.empty(),i.append($('<span class="brtc-va-icon brtc-va-dialogs-dataupload error">File Type Error: Not a file that can be imported.</span>')),t.VA.Core.Utils.WidgetUtils.openErrorDialog("Invalid Project File.");});}catch(e){i.empty(),i.append($('<span class="brtc-va-icon brtc-va-dialogs-dataupload error">File Type Error : json type can be entered only.</span>')),t.VA.Core.Utils.WidgetUtils.openErrorDialog("Invalid Project(.json) File.");}else e.refresh();},n.readAsText(this.file);}catch(t){e.refresh();}else i.append($('<span class="brtc-va-icon brtc-va-dialogs-dataupload error">File Type Error : json type can be entered only.</span>'));},e.prototype.refresh=function(t){this.$fileSelectPage.find(".filename").empty();},e.prototype.performFinish=function(){var e=this;if(this.$fileSelectPage.find(".nodata").length>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please select file to upload.",function(){e.$fileSelectPage.find("#fileselect-local").focus();});else if(this.$fileSelectPage.find(".brtc-va-icon.brtc-va-dialogs-dataupload.error").length>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please select valid model(.json) file.",function(){e.$fileSelectPage.find("#fileselect-local").focus();});else if(""!==e.$nameControl.val().trim()){if($("<div>").append(this.noteControl.getCode()).text().length>2e3)t.VA.Core.Utils.WidgetUtils.openErrorDialog("Description should be less than or equal to 2000 characters.");else{var i=e.$nameControl.val(),o=""===e.noteControl.getCode()?"":e.noteControl.getCode(),n=Studio.getResourceService();e.data.data.label=i,e.data.data.description=o,n.importProject(e.data).then(function(t){e.dialogResult={OK:!0,Cancel:!1,projectId:t},e.$mainControl.dialog("close");}).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter name.",function(){e.$nameControl.focus();});},e.prototype.handleCancelClicked=function(){this.dialogResult.OK=!1,this.dialogResult.Cancel=!0,this.$mainControl.dialog("close");},t.VA.Core.Dialogs.ImportProjectDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils;function i(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}i.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),i.prototype.constructor=i,i.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=760,this.dialogOptions.height=300;},i.prototype.createDialogContentsArea=function(i){var o=this;i.addClass("brtc-va-dialogs-import-udf-contents"),i.append('<div class="fileselect">       <div class="header">           <span>File</span>               <input for="brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename" type="button" id="fileselect-local" value="Local" />               <input type="file" id="brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename" name="fileToUpload" accept=".json">       </div>       <div class="contents filename">           <span class="nodata">Select file to upload</span>       </div></div>');var n=i.find("#fileselect-local"),r=i.find("#brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename");r.on("change",function(n){var r=new FileReader(),a=$(this)[0].files[0];r.onloadend=function(n){var r;r=JSON.parse(n.target.result),o.data=r;a.size>1048576?parseFloat(Math.round(a.size/1024/1024*100)/100).toFixed(2):parseFloat(Math.round(a.size/1024*100)/100).toFixed(2);var s=i.find(".filename");s.empty(),"object"==typeof o.data&&o.data.hasOwnProperty("script")&&o.data.hasOwnProperty("specJson")&&"udf"===o.data.specJson.category&&""!==o.data.script.content&&""!==o.data.script.type?(s.append($('<span class="brtc-va-icon brtc-va-wizardpage-dataupload file"></span><span>'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(a.name)+"</span>")),o.configureOkButton()):(o.data={specJson:{}},s.append($('<span class="nodata">Select file to upload</span>')),o.configureOkButton(),e.WidgetUtils.openInformationDialog("Check your JSON file"));},r.readAsText(a);}),n.jqxButton({theme:t.VA.Env.Theme}),n.on("click",function(){r.click();});},i.prototype.handleOkClicked=function(){var i=e.IDGenerator.uuid.id(16),o="udf_script"+e.IDGenerator.uuid.id(16),n=this;this.data.id=i,this.data.specJson.scriptId=o;var r={type:"POST",url:"api/va/v3/ws/udfs",data:JSON.stringify(this.data),contentType:"application/json; charset=utf-8"};$.ajax(r).done(function(e){t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(n);}).fail(function(e){t.VA.Dialogs.Dialog.prototype.handleCancelClicked.call(n);});},i.prototype.configureOkButton=function(){JSON.stringify(this.data)===JSON.stringify({specJson:{}})?this.$okButton.jqxButton({disabled:!0}):this.$okButton.jqxButton({disabled:!1});},t.VA.Core.Dialogs.ImportUDFDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i),this.addListener();}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype.addListener=function(){var t=this;this.commandListener=function(e){t.handleCommand(e);},this.options.editor.addCommandListener(this.commandListener),this.activeModelChangeListener=function(){t.refresh();},this.options.editor.addActiveModelChangeListener(this.activeModelChangeListener);},e.prototype.removeListener=function(){this.options.editor.removeCommandListener(this.commandListener),this.options.editor.removeActiveModelChangeListener(this.activeModelChangeListener);},e.prototype.handleCommand=function(e){e instanceof t.VA.Core.Editors.Diagram.Commands.ConnectFnUnitCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.DisconnectFnUnitCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.ReconnectFnUnitCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand||e instanceof t.VA.Core.Editors.Diagram.Commands.AddFnUnitParameterCommand||this.refresh();},e.prototype.getTitle=function(){return"Index";},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-main-index">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents" style="padding-right: 20px;padding-left: 20px;">       </div>       <div class="brtc-va-dialogs-buttonbar">       </div>   </div></div>');var e=this._configureDialogOption({theme:t.VA.Env.Theme,title:this.getTitle(),position:{my:"left top",at:"left bottom",of:this.$parent.find(".brtc-style-s-editor-toolitem[item-type=index]")},width:400,height:600,maxWidth:400,maxHeight:600,modal:!1,resizable:!1});this.$mainControl.dialog(e),this.$mainControl.parent().draggable("option","containment",this.$parent),$(".ui-dialog-titlebar.ui-widget-header",$(this).parent()).css("width","calc(100% - 60px) !important");},e.prototype.createDialogContentsArea=function(t){var e=$('<div class="brtc-va-dialogs-index-item-container"></div>');t.append(e),this.refresh(),t.perfectScrollbar();},e.prototype.createIndexItems=function(e){var i=this.options.editor.getActiveModel().functions.slice();for(var o in i.sort(function(t,e){var i=t.display.diagram.position,o=e.display.diagram.position;return i.x<o.x?-1:i.x==o.x?i.y<o.y?-1:i.y==o.y?0:1:1;}),i){var n=i[o].parent().type,r=t.VA.Core.Interface.Functions[n][i[o].func],a=$('<div class="brtc-va-dialogs-index-item">   <div class="brtc-va-dialogs-index-item-label"></div>   <div class="brtc-va-dialogs-index-item-func"></div></div>');a.attr("id",i[o].fid),a.addClass("brtc-va-fnunit-category-"+r.category),a.find(".brtc-va-dialogs-index-item-label").attr("title",i[o].display.label),a.find(".brtc-va-dialogs-index-item-label").text(i[o].display.label),a.find(".brtc-va-dialogs-index-item-func").text(r.defaultFnUnit.display.label),e.append(a);}var s=this;e.find(".brtc-va-dialogs-index-item").click(function(){$(this).hasClass("brtc-va-dialogs-index-item-select")||(e.children().removeClass("brtc-va-dialogs-index-item-select"),$(this).addClass("brtc-va-dialogs-index-item-select"),s.options.editor.selectFunction($(this).attr("id")));});},e.prototype.createDialogButtonBar=function(t){},e.prototype.destroy=function(){this.removeListener(),t.VA.Dialogs.Dialog.prototype.destroy.call(this);},e.prototype.refresh=function(){var t=this.$mainControl.find(".brtc-va-dialogs-index-item-container");t.empty(),this.createIndexItems(t),this.$mainControl.find(".brtc-va-dialogs-contents").perfectScrollbar("update");},t.VA.Core.Dialogs.IndexDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=655,this.dialogOptions.height=this.options.model?640:500;},e.prototype.createDialogContentsArea=function(e){var i=moment(this.options.project.getCreateTime()).format("YYYY-MM-DD HH:mm:ss"),o=$('<div class="brtc-style-editors-model-info-tooltip brtc-va-editors-tooltip-modelinfo">   <div class="date_area"/></div>');if(e.append(o),this.options.model){var n=moment(this.options.model.getCreateTime()).format("YYYY-MM-DD"),r=moment(this.options.model.getUpdateTime()).format("YYYY-MM-DD");o.find(".date_area").append('<p>   <span>Updated on</span>   <span class="value">'+r+'</span>   <span>by</span>   <span class="value updater">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.model.getUpdater())+'</span></p><p>   <span>Created on</span>   <span class="value">'+n+'</span>   <span>by</span>   <span class="value creator">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.model.getCreator())+"</span></p>"),o.find(".date_area .value.updater").attr("title",this.options.model.getUpdater()),o.find(".date_area .value.creator").attr("title",this.options.model.getCreator());var a="<p><br /></p>"!==this.options.model.getDescription()?this.options.model.getDescription():"There is no description for this model.";o.find(".date_area").append('<div class="model_description">'+a+"</div>"),o.append('   <div class="project_area">       <p class="proj_title">Project</p>       <p class="proj_name">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.project.getLabel())+'</p>       <p class="create">           <span>Created on</span><span class="value">'+i+'</span>           <span>by</span><span class="value creator">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.project.getCreator())+"</span></p>   </div>"),o.find(".proj_name").attr("title",this.options.project.getLabel()),o.find(".project_area .value.creator").attr("title",this.options.project.getCreator());}else{o.find(".date_area").append('<p>   <span>Created on</span>   <span class="value">'+i+'</span>   <span>by</span>   <span class="value creator">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.project.getCreator())+"</span></p>"),o.find(".date_area .value.creator").attr("title",this.options.project.getCreator());a="<p><br /></p>"!==this.options.project.getDescription()?this.options.project.getDescription():"There is no description for this project.";o.find(".date_area").append('<div class="model_description">'+a+"</div>");}o.find(".model_description").perfectScrollbar();},e.prototype.createDialogButtonBar=function(t){},t.VA.Core.Dialogs.InfoDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype.createDialogContentsArea=function(t){this.PARAM_COLUMN_NAMES="column-names",this.PARAM_TYPE_ARRAY="column-types",this.PARAM_DATA_ARRAY="data-array",this.options.context&&(this.PARAM_COLUMN_NAMES="col_names",this.PARAM_TYPE_ARRAY="type_array",this.PARAM_DATA_ARRAY="data_array"),this.$gridArea=$('<div class="brtc-va-dialogs-contents-grid-area" style="width:100%; height:100%; box-sizing: border-box; padding-bottom:20px;">   <div class="brtc-va-dialogs-contents-grid" style="width:100%; height:100%; box-sizing: border-box;"></div></div>'),t.append(this.$gridArea),this.createGridArea(this.$gridArea.find(".brtc-va-dialogs-contents-grid"));},e.prototype.createGridArea=function(e){for(var i=t.VA.Env.Theme,o=function o(t,e,i){return 0===i?'<div style="text-align: center; margin-top: 5px;" title="Column Name">C</div>':'<div style="text-align: center; margin-top: 5px;">'+i+"</div>";},n=[],r=[],a=0;a<26;a++){var s=String.fromCharCode(65+a);if(0==a){var l="jqx-widget-header";""!=i&&(l+=" jqx-widget-header-"+i),r[r.length]={pinned:!0,exportable:!1,text:"",columntype:"number",cellclassname:l,cellsrenderer:o};}n[n.length]={name:s},r[r.length]={text:s,datafield:s,width:60,align:"center",cellsrenderer:function cellsrenderer(t,e,i){var o=$('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');return o.attr("title",i),o.text(i),$("<div>").append(o.clone()).html();}};}var c={unboundmode:!0,totalrecords:100,datafields:n,localdata:this.getFormattedLocalData()},d=new $.jqx.dataAdapter(c);this.grid=e.jqxGrid({theme:t.VA.Env.Theme,width:"100%",height:"100%",rowsheight:25,source:d,editable:!0,editmode:"click",columnsresize:!0,selectionmode:"multiplecellsadvanced",columns:r});},e.prototype.getFormattedLocalData=function(){var t=[],e=this.options.fnUnit.param[this.PARAM_COLUMN_NAMES],i=this.options.fnUnit.param[this.PARAM_DATA_ARRAY];if(e.length>0){t[0]={};for(var o=0;o<e.length;o++){t[0][String.fromCharCode(o+"A".charCodeAt(0))]=e[o];}for(o=0;o<i.length;o++){t[o+1]={};for(var n=0;n<i[o].length;n++){t[o+1][String.fromCharCode(n+"A".charCodeAt(0))]=i[o][n];}}}return t;},e.prototype.handleOkClicked=function(){try{this.setRows(this.grid.jqxGrid("getrows")),this.setColumnNames(this.getRows()),this.setDataArray(this.getRows()),this.dialogResult[this.PARAM_COLUMN_NAMES]=this.getColumnNames(),this.dialogResult[this.PARAM_DATA_ARRAY]=this.getDataArray(),this.dialogResult.OK=!0,this.dialogResult.Cancel=!1,this.$mainControl.dialog("close");}catch(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog(e.message);}},e.prototype.setRows=function(t){this.rows=t;},e.prototype.getRows=function(){return this.rows;},e.prototype.setColumnNames=function(t){if(!this.isValidColumnNames(t[0]))throw new Error(this.getValidationErrorMessage());for(var e=[],i="A";i<="Z"&&t[0][i];i=String.fromCharCode(i.charCodeAt(0)+1)){e.push(t[0][i]);}this.columnNames=e;},e.prototype.getColumnNames=function(){return this.columnNames;},e.prototype.setDataArray=function(t){for(var e=[],i=-1,o=1;o<t.length;o++){e[o-1]=[];for(var n=String.fromCharCode("A".charCodeAt(0)+this.getColumnNames().length-1),r="A";r<=n;r=String.fromCharCode(r.charCodeAt(0)+1)){t[o][r]&&(i=o),void 0===t[o][r]?e[o-1].push(""):null===t[o][r]?e[o-1].push(""):e[o-1].push(t[o][r]);}}if(!this.isValidDataArray(i))throw new Error(this.getValidationErrorMessage());e.splice(i,e.length-i),this.dataArray=e;},e.prototype.getDataArray=function(){return this.dataArray;},e.prototype.isValidDataArray=function(t){var e=!0;return-1===t&&(this.validationErrorMessage="There is no data. Please input data.",e=!1),e;},e.prototype.isValidColumnNames=function(t){if(!this.isExistsColumns(t))return this.validationErrorMessage="There is no column. Please input column names in the first row.",!1;var e=this.getInvalidEmptyColumns(t);if(e.length)return this.validationErrorMessage="All column names should be given but the column names of "+JSON.stringify(e)+" are not given. Please check the input.",!1;var i=this.getInvalidColumnNames(t);if(i.length)return this.validationErrorMessage="All column names should start with alphabet characters. You can use alphabet, number, and '_' only. Please check the input in "+JSON.stringify(i)+".",!1;var o=this.getDuplicatedColumnNames(t);return!o.length||(this.validationErrorMessage="There are columns of the same name. Column names do not distinguish upper and lower cases. Please check the column names. "+JSON.stringify(o)+".",!1);},e.prototype.isExistsColumns=function(t){for(var e=!1,i="A";i<="Z";i=String.fromCharCode(i.charCodeAt(0)+1)){if(t[i]){e=!0;break;}}return e;},e.prototype.getInvalidEmptyColumns=function(t){for(var e=!1,i=-1,o=[],n="A";n<="Z";n=String.fromCharCode(n.charCodeAt(0)+1)){t[n]?i=n.charCodeAt(0)-"A".charCodeAt(0):(e||(e=!0,n.charCodeAt(0)-"A".charCodeAt(0)),o.push(n));}return o=$.grep(o,function(t,e){return t.charCodeAt(0)-"A".charCodeAt(0)<i;});},e.prototype.getInvalidColumnNames=function(t){for(var e=[],i="A";i<="Z";i=String.fromCharCode(i.charCodeAt(0)+1)){var o=t[i];if(o){var n=new RegExp("^[a-zA-Z0-9_]+$"),r=new RegExp("^[0-9]+");n.test(o)&&!r.test(o)||e.push(i);}}return e;},e.prototype.getDuplicatedColumnNames=function(t){for(var e=[],i={},o="A";o<="Z";o=String.fromCharCode(o.charCodeAt(0)+1)){var n=t[o];if(n){var r=n.toLowerCase();i[r]?i[r].push(o):i[r]=[o];}}for(var a in i){if(i[a].length>1){e=i[a];break;}}return e;},e.prototype.getValidationErrorMessage=function(){return this.validationErrorMessage;},t.VA.Core.Dialogs.InputDataFrameEditorDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=700,this.dialogOptions.height=700;},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-repository-browser-contents"),t.append('<div class="brtc-va-dialogs-repository-browser-tree"></div><div class="brtc-va-dialogs-repository-browser-file-layout">   <div class="brtc-va-dialogs-repository-browser-file-label">File Path</div>   <div class="brtc-va-dialogs-repository-browser-file-input"><textarea></textarea></div></div><div class="brtc-va-dialogs-repository-browser-setting-option">   <div class="brtc-va-dialogs-repository-browser-radio" value="static">Set a static file path for users repository.</div>   <div class="brtc-va-dialogs-repository-browser-radio" value="dynamic">Set a dynamic file path for users repository.</div></div>'),this.createRepositoryTree(t.find(".brtc-va-dialogs-repository-browser-tree")),this.createSettingOptionControl(t.find(".brtc-va-dialogs-repository-browser-setting-option")),this.createFilePathControl(t.find(".brtc-va-dialogs-repository-browser-file-input > textarea"));},e.prototype.createRepositoryTree=function(e){var i=this;this.repositoryViewer=new t.VA.Core.Controls.RepositoryViewer(e),this.repositoryViewer.$tree.on("select",function(t){var e=i.repositoryViewer.getSelectedPath();i._setFilePath(e);});},e.prototype.createSettingOptionControl=function(e){var i=this,o=e.find(".brtc-va-dialogs-repository-browser-radio");this.$settingOptionGroup=e,o.jqxRadioButton({theme:t.VA.Env.Theme,groupName:"repository-browser-setting-option"}),o.on("checked",function(){var t=i.repositoryViewer.getSelectedPath()||i.options.filePath;i._setFilePath(t);}),this.options.filePath.match(/\/users\/\$\{sys.user\}\//g)?this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=dynamic]").jqxRadioButton("check"):this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=static]").jqxRadioButton("check"),this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").hide();},e.prototype.createFilePathControl=function(e){this.fileName=CodeMirror.fromTextArea(e[0],{mode:"text",theme:"default",indentWithTabs:!1,smartIndent:!1,lineNumbers:!1,matchBrackets:!0,scrollbarStyle:"null",autofocus:!1}),this.fileName.on("beforeChange",function(t,e){var i=e.text.join("").replace(/\n/g,"");return e.update(e.from,e.to,[i]),!0;}),this.fileName.setSize("100%","100%"),this.options.filePath&&this._setFilePath(this.options.filePath);t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.fileName,{"valid-type":"fileNameType","valid-message-position":"bottom"});},e.prototype._setFilePath=function(e){if(e){var i=e.match(/^\/brtc\/repo\/shared\/[^\/]*/),o=e.match(/^\/brtc\/repo\/users\/[^\/]+\/[^\/]*/);if(this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").hide(),i)this.fileName.setValue(e),this.fileName.markText({line:0,ch:0},{line:0,ch:18},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"});else if(o){this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").show();var n=0,r=e,a=(r=this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=dynamic]").val()?r.replace(/\/users\/\S*\//g,"/users/${sys.user}/"):r.replace(/\/users\/\$\{sys\.user\}\//g,"/users/"+t.VA.Env.Session.userId+"/")).split("/");this.fileName.setValue(r);for(var s=0;s<5;s++){n+=a[s].length,n++;}this.fileName.markText({line:0,ch:0},{line:0,ch:n},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"});}else r=e+"/",r=this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=dynamic]").val()?r.replace(/\/users\/\S*\//g,"/users/${sys.user}/"):r.replace(/\/users\/\$\{sys\.user\}\//g,"/users/"+t.VA.Env.Session.userId+"/"),this.fileName.setValue(r),this.fileName.markText({line:0,ch:0},{line:0,ch:r.length+1},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"});}},e.prototype.handleOkClicked=function(){var e=this.fileName.getValue().trim();if(e){for(var i=e.match(/^\/brtc\/repo\/shared\/[^\/]+$/),o=e.match(/^\/brtc\/repo\/users\/[^\/]+\/[^\/]+$/),n=e.match(/^\/brtc\/repo\/users\/\$\{sys\.user\}\/[^\/]+$/),r="",a=0,s=0;s<e.length;s++){"."!=(r=e.charAt(s))&&"@"!=r&&"/"!=r||r==e.charAt(s+1)&&(a+=1);}if(a>0)return void t.VA.Core.Utils.WidgetUtils.openErrorDialog("Invalid file path.");i||o||n?(this.dialogResult.selectedFile=e,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)):t.VA.Core.Utils.WidgetUtils.openErrorDialog("Invalid file path.");}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("At least one file must be selected.");},t.VA.Core.Dialogs.InputDataPathDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=600,this.dialogOptions.height=700,this.dialogOptions.maxWidth=600,this.dialogOptions.maxHeight=700,this.dialogOptions.create=function(){$(".ui-widget-content").css("border","none");};},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-invite-member-contents"),t.append('<input type="search" class="brtc-va-dialogs-invite-member-search"><div class="brtc-va-dialogs-invite-member-search-user-label"><span>Total</span><span>0</span></div><div class="brtc-va-dialogs-invite-member-search-user-grid"></div><div class="brtc-va-dialogs-invite-member-register-member-authority"></div><div class="brtc-va-dialogs-invite-member-register-member-remove"></div><div class="brtc-va-dialogs-invite-member-register-member-label"><span>Total</span><span>0</span></div><div class="brtc-va-dialogs-invite-member-register-member-grid"></div>'),this.createSearchControl(t),this.createUserGrid(t),this.createAuthorityCombo(t),this.createRemoveMemberButton(t),this.createMemberGrid(t);},e.prototype.updateUserCount=function(){if(this.$userGrid){var t=this.$userGrid.jqxGrid("getrows");this.$mainControl.find(".brtc-va-dialogs-invite-member-search-user-label > span:nth-child(2)").text(t.length);}},e.prototype.updateMemberCount=function(){if(this.$memberGrid){var t=this.$memberGrid.jqxGrid("getrows");this.$mainControl.find(".brtc-va-dialogs-invite-member-register-member-label > span:nth-child(2)").text(t.length);}},e.prototype.createSearchControl=function(e){var i=this;this.$searchControl=e.find(".brtc-va-dialogs-invite-member-search").jqxInput({placeHolder:"Search for Name, ID",theme:t.VA.Env.Theme}),this.$searchControl.keypress(function(t){13==t.keyCode&&i.searchUser(i.$searchControl.val());}),this.$searchControl.focus();},e.prototype.searchUser=function(t){var e=this._createUserGridSource();this.$userGrid.jqxGrid("source",e);},e.prototype._createUserGridSource=function(){var t={datatype:"json",datafields:[{name:"name",type:"string"},{name:"id",type:"string"}]};return this.$searchControl.val().trim()?t.url="api/admin/v2/users?pattern="+encodeURIComponent(this.$searchControl.val()):t.localdata=[],new $.jqx.dataAdapter(t);},e.prototype.createUserGrid=function(e){var i=this;e.find(".brtc-va-dialogs-invite-member-search-user-grid").on("bindingcomplete",function(){i.updateUserCount();});var o=this._createUserGridSource();this.$userGrid=e.find(".brtc-va-dialogs-invite-member-search-user-grid").jqxGrid({theme:t.VA.Env.Theme,source:o,width:"100%",rowsheight:25,height:"calc(50% - 80px)",altrows:!1,filterable:!1,sortable:!1,columnsresize:!0,enabletooltips:!0,columns:[{text:"Name",datafield:"name",width:240,cellsrenderer:function cellsrenderer(e,i,o){return'<div class="jqx-grid-cell-left-align" style="margin-top: 4px;">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o)+"</div>";}},{text:"ID",datafield:"id"}]}),this.$userGrid.on("rowclick",function(e){var o=i.$authorityCombo.jqxDropDownList("getSelectedItem"),n=o.value,r=o.label,a=e.args,s=i.$userGrid.jqxGrid("getrowdata",a.rowindex),l={user_name:s.name,user_id:s.id,role_id:n,role_label:r},c=!1,d=!1,p=i.$memberGrid.jqxGrid("getrows");for(var u in p){p[u].user_id==s.id&&(c=!0);}for(var u in i.options.members){i.options.members[u].user_id==s.id&&(d=!0);}c||(d?t.VA.Core.Utils.WidgetUtils.openWarningDialog(s.id+" is invited already.",function(){}):(i.$memberGrid.jqxGrid("addrow",null,l),i.updateMemberCount()));});},e.prototype.createRemoveMemberButton=function(t){var e=this;t.find(".brtc-va-dialogs-invite-member-register-member-remove").click(function(){var t=[],i=e.$memberGrid.jqxGrid("getselectedrowindexes");for(var o in i){var n=e.$memberGrid.jqxGrid("getrowdata",i[o]);t.push(n.uid);}e.$memberGrid.jqxGrid("deleterow",t),e.updateMemberCount();});},e.prototype.createMemberGrid=function(e){var i=this;e.find(".brtc-va-dialogs-invite-member-register-member-grid").on("bindingcomplete",function(){i.updateMemberCount();});var o=new $.jqx.dataAdapter({datatype:"local",datafields:[{name:"user_name",type:"string"},{name:"user_id",type:"string"},{name:"role_id",type:"string"},{name:"role_label",type:"string"}],localdata:[],addrow:function addrow(t,e,i,o){o(!0);},deleterow:function deleterow(t,e){e(!0);}});this.$memberGrid=e.find(".brtc-va-dialogs-invite-member-register-member-grid").jqxGrid({theme:t.VA.Env.Theme,source:o,width:"100%",height:"calc(50% - 80px)",rowsheight:25,altrows:!1,filterable:!1,sortable:!1,columnsresize:!0,selectionmode:"multiplerowsextended",enabletooltips:!0,columns:[{text:"Name",datafield:"user_name",width:240,cellsrenderer:function cellsrenderer(e,i,o){return'<div class="jqx-grid-cell-left-align" style="margin-top: 4px;">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o)+"</div>";}},{text:"ID",datafield:"user_id",width:240},{text:"Authority",datafield:"role_label"}]});},e.prototype.createAuthorityCombo=function(e){this.$authorityCombo=e.find(".brtc-va-dialogs-invite-member-register-member-authority").jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,source:[{id:"role_10002",label:"as Organizer"},{id:"role_10003",label:"as Member"},{id:"role_10004",label:"as Reporter"}],displayMember:"label",valueMember:"id",itemHeight:29,dropDownWidth:118,selectedIndex:1});},e.prototype.handleOkClicked=function(){var e=this,i=this.$memberGrid.jqxGrid("getrows");if(0==i.length)t.VA.Core.Utils.WidgetUtils.openErrorDialog("At least one member must be selected.");else{var o={members:[]};for(var n in i){var r=i[n];o.members.push({user_id:r.user_id,role_id:r.role_id});}var a={url:"api/va/v2/ws/projects/"+e.options.projectId+"/members/invite",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0,data:JSON.stringify(o)};$.ajax(a).done(function(i){t.VA.Core.Utils.WidgetUtils.openInformationDialog("Invited "+i+" members.",function(){t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(e);});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}},t.VA.Core.Dialogs.InviteMemberDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i),this.terminated=!1;}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=680,this.dialogOptions.height=540,this.dialogOptions.keyboardCloseKey="",this.dialogOptions.closeOnEscape=!1,this.dialogOptions.create=function(){$(".ui-widget-content").css("border-color","#d4d4d4"),$(".ui-dialog-titlebar-close",$(this).parent()).hide();};},e.prototype.createDialogContentsArea=function(e){var i=this;e.parent().parent().addClass("brtc-va-dialogs-launch-progress"),e.addClass("brtc-va-dialogs-launch-progress-contents"),e.append('<div class="brtc-va-dialogs-launch-progress-label"><span>Starting...</span><span class="brtc-va-dialogs-launch-progress-elapsed"></span><span></span></div><div class="brtc-va-dialogs-launch-progress-progressbar"></div><div class="brtc-va-dialogs-launch-progress-tab">   <ul>       <li style="margin-left: 0; width: 80px">Status</li>       <li style="width: 80px">Log</li>   </ul>   <div>       <div>           <div class="brtc-va-dialogs-launch-progress-processes">           </div>       </div>       <div>           <textarea class="brtc-va-dialogs-launch-progress-logs" style="display: none"></textarea>       </div>   </div></div>'),this.$progressBar=e.find(".brtc-va-dialogs-launch-progress-progressbar").jqxProgressBar({theme:t.VA.Env.Theme,value:3,animationDuration:0}),this.$progressTab=e.find(".brtc-va-dialogs-launch-progress-tab").jqxRibbon({theme:t.VA.Env.Theme,width:"100%",height:"calc(100% - 70px)",position:"bottom",selectionMode:"click",initContent:function initContent(t){0==t?i.$processScrollbar=e.find(".brtc-va-dialogs-launch-progress-processes").perfectScrollbar():1==t&&(i.logMirror=CodeMirror.fromTextArea(e.find(".brtc-va-dialogs-launch-progress-logs")[0],{mode:"text/html",theme:"default",lineNumbers:!1,matchBrackets:!0,autofocus:!1,readOnly:!0}),i.logMirror.setSize("100%","100%"));}}).addClass("brtc-va-dialogs-launch-progress-tab"),this.$progressTab.jqxRibbon("hideAt",1),setTimeout(this._renderTimer.bind(this),500),this.createCloseOptionCheckBox(e);},e.prototype.createDialogButtonBar=function(e){t.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this,e),this.$okButton.val("Done"),this.$okButton.css("display","none"),this.$cancelButton.val("Stop Running"),this.createDetailButton(e),this.createDetailOptimizationButton(e);},e.prototype.createDetailButton=function(e){var i=this;this.$detailButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-detail" value="Detail" />'),e.append(this.$detailButton),this.$detailButton.jqxButton({theme:t.VA.Env.Theme}),this.$detailButton.click(function(){var e="JOB ID: "+i.options.jobId;e+="\n"+(i.errorDetailMessage||i.errorMessage),new t.VA.Core.Dialogs.DetailDialog(i.$mainControl,{title:"Detail Information",detailText:e});}),this.$detailButton.hide();},e.prototype.createDetailOptimizationButton=function(e){var i=this;this.$detailOptButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-detail" value="Detail Optimization" />'),e.append(this.$detailOptButton),this.$detailOptButton.jqxButton({theme:t.VA.Env.Theme}),this.$detailOptButton.click(function(){i.optProgressDialog?i.optProgressDialog.render(i.eventOriginalResponse):i.optProgressDialog=new t.VA.Core.Dialogs.OptProgressDialog(null,{data:i.eventOriginalResponse,close:function close(){i.optProgressDialog=null;}});}),this.$detailOptButton.hide();},e.prototype._showDetailOptimizationButton=function(t){this._getOptimizationData(t)&&(this.eventOriginalResponse=t,this.$detailOptButton.show(),this.optProgressDialog&&this.optProgressDialog.render(this.eventOriginalResponse));},e.prototype._getOptimizationData=function(t){if(t){var e=t.processes;if(!e)return null;for(var i=e.length-1;i>=0;i--){for(var o=e[i].functions,n=o.length-1;n>=0;n--){var r=o[n].optimization;if(r)return r;}}}return null;},e.prototype.createCloseOptionCheckBox=function(e){this.$checkboxDiv=$('<div class = "brtc-va-dialogs-launch-progress-closeoption">Close the dialog after the process completes successfully.</div>'),e.append(this.$checkboxDiv),this.$checkboxDiv.jqxCheckBox({theme:t.VA.Env.Theme,checked:t.VA.Env.Session.launchProgressAutoClose}),this.$checkboxDiv.on("change",function(e){var i=e.args.checked;t.VA.Env.Session.launchProgressAutoClose=i;});},e.prototype.progress=function(t){var e;t.jid&&(this.options.jobId=t.jid),"BEGIN-JOB"==t.eventType?this._beginJob(t.status,t.launchOptions.expectedUnitCount):"END-JOB"==t.eventType?this._endJob(t.status,t.message,t.detailMessage):"BEGIN-PROCESS"==t.eventType?(e=t.label||"(default model)",this._beginProcess(t.pid,t.status,e,t.count)):"END-PROCESS"==t.eventType?this._endProcess(t.pid,t.status,t.begin,t.end):"BEGIN-UNIT"==t.eventType?(e=t.label||"(default function)",this._beginUnit(t.pid,t.fid,t.status,e,t.message)):"END-UNIT"==t.eventType?this._endUnit(t.pid,t.fid,t.status,t.begin,t.end,t.message):"UPDATE-UNIT"==t.eventType?this._updateUnit(t.pid,t.fid,t.status,t.begin,t.end,t.message):"PENDING-JOB"===t.eventType&&this._pendingJob(t.status,t.message),this.updateStatus(t),this._updateProgress(t),this._showDetailOptimizationButton(t.originalResponse);},e.prototype.updateStatus=function(t){["END-UNIT"].indexOf(t.eventType)>-1&&Studio.getEditorContainer().getActiveModelEditor().updateStatus(t);},e.prototype.handleCancelClicked=function(){this.dialogResult={OK:!1,Cancel:!0},Studio.getJobExecutor().terminate(this.options.jobId);},e.prototype._pendingJob=function(t,e){var i="0 process, 0 function completed... ("+e+")";this.$mainControl.find(".brtc-va-dialogs-launch-progress-label > span:nth-child(1)").text(i),this.$mainControl.find(".brtc-va-dialogs-launch-progress-label > span:nth-child(1)").attr("title",i);},e.prototype._updateProgress=function(e){this.terminated&&t.VA.Env.Session.launchProgressAutoClose&&"FAIL"!==e.status||(this._updateProgressLabel(e),this._updateProgressBar(e));},e.prototype._updateProgressLabel=function(t){var e=this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="SUCCESS"], .brtc-va-dialogs-launch-progress-proc[status="FAIL"]'),i=this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="SUCCESS"], .brtc-va-dialogs-launch-progress-func[status="FAIL"]'),o=e.length+" process, "+i.length+" function completed...",n="PENDING-JOB"===t.eventType?t.message:"";this.errorMessage&&(o=this.errorMessage),this.$mainControl.find(".brtc-va-dialogs-launch-progress-label > span:nth-child(1)").text(o),this.$mainControl.find(".brtc-va-dialogs-launch-progress-label > span:nth-child(1)").attr("title",o),this.$mainControl.find(".brtc-va-dialogs-launch-progress-label > span:nth-child(3)").text(n);},e.prototype._updateProgressBar=function(){var t=10,e=this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="SUCCESS"]').length;"SUCCESS"==this.$mainControl.find(".brtc-va-dialogs-launch-progress-contents").attr("STATUS")?t=100:(t=85*e/this.expectedUnitCount+10)>95&&(this.expectedUnitCount+=10,t=85*e/this.expectedUnitCount+10);var i=this;clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(function(){i.$progressBar.jqxProgressBar({value:t});},300);},e.prototype._renderTimer=function(){var e=this;if(this.$mainControl&&this.$mainControl.find(".brtc-va-dialogs-launch-progress-elapsed").length&&this.$mainControl.find(".brtc-va-dialogs-launch-progress-elapsed").each(function(t){var i=$(this).attr("begin");i=i?parseInt(i):Date.now();var o=$(this).attr("end");o=o?parseInt(o):Date.now();var n=e._elapsedString(o-i);$(this).text("( "+n+" )");}),0==this.terminated)setTimeout(this._renderTimer.bind(this),500);else if(t.VA.Env.Session.launchProgressAutoClose)return void clearTimeout(this._renderTimer);},e.prototype._elapsedString=function(t){var e=t,i=Math.floor(e/864e5);e-=864e5*i;var o=Math.floor(e/36e5);e-=36e5*o;var n=Math.floor(e/6e4);e-=6e4*n;var r=Math.floor(e/1e3);e-=1e3*r;var a="";return i>0&&(a=i+" day "),o>0&&(a+=o+" hour "),n>0&&(a+=n+" min "),r>0&&(a+=r+" sec"),""==a&&(a="1 sec"),a;},e.prototype._beginJob=function(t,e){this.expectedUnitCount=e,this.$mainControl.find(".brtc-va-dialogs-launch-progress-contents").attr("STATUS",t),this.$mainControl.find(".brtc-va-dialogs-launch-progress-label .brtc-va-dialogs-launch-progress-elapsed").attr("begin",Date.now());},e.prototype._endJob=function(t,e,i){this.$mainControl.find(".brtc-va-dialogs-launch-progress-contents").attr("STATUS",t),this.$mainControl.find(".brtc-va-dialogs-launch-progress-label .brtc-va-dialogs-launch-progress-elapsed").attr("end",Date.now()),this.$mainControl.find(".jqx-window-close-button-background").css("visibility","visible"),this.$okButton.css("display","block"),this.$cancelButton.css("display","none"),"FAIL"===t?(this.errorMessage=e||"",this.errorDetailMessage=i||"",0==this.errorMessage.indexOf("SparkException:")||0==this.errorMessage.indexOf("NoClassDefFoundError:")?this.errorMessage="Sorry! An unexpected error occurred. Please contact administrator.":0==this.errorMessage.indexOf("Exception:")?this.errorMessage="Sorry! An unexpected error occurred. Please contact administrator.":0==this.errorMessage.indexOf("AnalysisException:")?this.errorMessage=this.errorMessage.substring(18,this.errorMessage.length).trim():0==this.errorMessage.indexOf("InvalidInputException:")?this.errorMessage="Input path does not exist.":0==this.errorMessage.indexOf("FileNotFoundException:")?this.errorMessage="Data Source does not exist.":'{"result":"Cannot execute the flow. It contains invalid contents.","resultCode":1100}'==this.errorMessage?this.errorMessage="Cannot execute the flow. It contains invalid contents.":"'condition' is a required parameter.\n'condition' is a required parameter."==this.errorMessage?this.errorMessage="'condition' is a required parameter.":this.errorMessage.startsWith("/home/brightics/brightics/packages/brightics-agent/repo/BRIGHTICS/script")&&this.errorMessage.indexOf("error: not found")>0?this.errorMessage="Script contains invalid contents.":"'in-table' is not of Array[String] type."===this.errorMessage?this.errorMessage="Inputs is required.":"Error: Invalid tid "===this.errorMessage?this.errorMessage="Inputs is required.":"The size of 'fs-paths' must be 1."==this.errorMessage&&(this.errorMessage="'Input Path' is a required parameter."),this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="PROCESSING"] > .brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(t)),this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="PROCESSING"]').attr("status",t),this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="PROCESSING"] > .brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(t)),this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="PROCESSING"]').attr("status",t),this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="WAIT"] > .brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(t)),this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="WAIT"]').attr("status",t),this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="WAIT"] > .brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(t)),this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="WAIT"]').attr("status",t)):"ABORT"===t?(this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="PROCESSING"] > .brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(t)),this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="PROCESSING"]').attr("status",t),this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="PROCESSING"] > .brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(t)),this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="PROCESSING"]').attr("status",t),this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="WAIT"] > .brtc-va-dialogs-launch-progress-proc-status').text(this._statusLabel(t)),this.$mainControl.find('.brtc-va-dialogs-launch-progress-proc[status="WAIT"]').attr("status",t),this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="WAIT"] > .brtc-va-dialogs-launch-progress-func-status').text(this._statusLabel(t)),this.$mainControl.find('.brtc-va-dialogs-launch-progress-func[status="WAIT"]').attr("status",t)):"SUCCESS"===t&&!0===this.$checkboxDiv.val()&&this.handleOkClicked(),this.errorMessage&&this.$detailButton.show(),this.terminated=!0;},e.prototype._beginProcess=function(t,e,i,o){var n=this.$mainControl.find(".brtc-va-dialogs-launch-progress-processes"),r=n.find(".brtc-va-dialogs-launch-progress-proc[id="+t+"]");0==r.length&&((r=$('<div class="brtc-va-dialogs-launch-progress-proc">    <div class="brtc-va-dialogs-launch-progress-proc-icon">        <div class="brtc-va-dialogs-launch-progress-icon"></div>    </div>    <div class="brtc-va-dialogs-launch-progress-proc-label"></div>    <div class="brtc-va-dialogs-launch-progress-proc-status"></div>    <div class="brtc-va-dialogs-launch-progress-elapsed brtc-va-dialogs-launch-progress-proc-elapsed"></div>    <div class="brtc-va-dialogs-launch-progress-functions">    </div></div>')).attr("id",t),n.append(r),r.find(".brtc-va-dialogs-launch-progress-proc-elapsed").attr("begin",Date.now()),r.find(".brtc-va-dialogs-launch-progress-proc-elapsed").removeAttr("end")),"WAIT"===r.attr("status")&&"PROCESSING"===e&&r.find(".brtc-va-dialogs-launch-progress-proc-elapsed").attr("begin",Date.now()),r.attr("status",e);var a=o>1?i+" ("+o+")":i;r.find(".brtc-va-dialogs-launch-progress-proc-label").text(a),r.find(".brtc-va-dialogs-launch-progress-proc-label").attr("title",a),r.find(".brtc-va-dialogs-launch-progress-proc-status").text(this._statusLabel(e)),r.find("> .brtc-va-dialogs-launch-progress-functions").empty();},e.prototype._endProcess=function(t,e,i,o){var n=this.$mainControl.find("#"+t+".brtc-va-dialogs-launch-progress-proc");n.attr("status",e),n.find(".brtc-va-dialogs-launch-progress-proc-status").text(this._statusLabel(e)),n.find(".brtc-va-dialogs-launch-progress-proc-elapsed").attr("begin",i),n.find(".brtc-va-dialogs-launch-progress-proc-elapsed").attr("end",o);},e.prototype._beginUnit=function(t,e,i,o,n){var r=this.$mainControl.find("#"+t+".brtc-va-dialogs-launch-progress-proc > .brtc-va-dialogs-launch-progress-functions"),a=r.find(".brtc-va-dialogs-launch-progress-func[id="+e+"]");0==a.length&&((a=$('<div class="brtc-va-dialogs-launch-progress-func">    <div class="brtc-va-dialogs-launch-progress-func-icon">        <div class="brtc-va-dialogs-launch-progress-icon"></div>    </div>    <div class="brtc-va-dialogs-launch-progress-func-label"></div>    <div class="brtc-va-dialogs-launch-progress-func-loop"></div>    <div class="brtc-va-dialogs-launch-progress-func-status"></div>    <div class="brtc-va-dialogs-launch-progress-elapsed brtc-va-dialogs-launch-progress-func-elapsed"></div>    </div></div>')).attr("id",e),r.append(a),a.find(".brtc-va-dialogs-launch-progress-func-elapsed").attr("begin",Date.now()),a.find(".brtc-va-dialogs-launch-progress-func-elapsed").removeAttr("end")),a.attr("status",i),a.find(".brtc-va-dialogs-launch-progress-func-label").text(o),n&&(a.find(".brtc-va-dialogs-launch-progress-func-loop").text(n),a.find(".brtc-va-dialogs-launch-progress-func-loop").attr("title",n)),a.find(".brtc-va-dialogs-launch-progress-func-label").attr("title",o),a.find(".brtc-va-dialogs-launch-progress-func-status").text(this._statusLabel(i)),this.$processScrollbar.scrollTop(this.$processScrollbar.prop("scrollHeight")),this.$processScrollbar.perfectScrollbar("update");},e.prototype._endUnit=function(t,e,i,o,n,r){var a=this.$mainControl.find("#"+t+".brtc-va-dialogs-launch-progress-proc #"+e+".brtc-va-dialogs-launch-progress-func");a.attr("status",i),a.find(".brtc-va-dialogs-launch-progress-func-status").text(this._statusLabel(i)),r&&(a.find(".brtc-va-dialogs-launch-progress-func-loop").text(r),a.find(".brtc-va-dialogs-launch-progress-func-loop").attr("title",r)),a.find(".brtc-va-dialogs-launch-progress-func-elapsed").attr("begin",o),a.find(".brtc-va-dialogs-launch-progress-func-elapsed").attr("end",n);},e.prototype._updateUnit=function(t,e,i,o,n,r){var a=this.$mainControl.find("#"+t+".brtc-va-dialogs-launch-progress-proc #"+e+".brtc-va-dialogs-launch-progress-func");a.attr("status",i),r&&(a.find(".brtc-va-dialogs-launch-progress-func-loop").text(r),a.find(".brtc-va-dialogs-launch-progress-func-loop").attr("title",r));},e.prototype._statusLabel=function(t){return"wait"==t.toLowerCase()?"Wait":"processing"==t.toLowerCase()?"Running":"success"==t.toLowerCase()?"Success":"fail"==t.toLowerCase()?"Fail":"abort"==t.toLowerCase()?"Abort":t;},t.VA.Core.Dialogs.LaunchProgressDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=700,this.dialogOptions.height=600,this.dialogOptions.maxWidth=700,this.dialogOptions.maxHeight=600;},e.prototype.createSearchControl=function(e){var i=this;this.$searchControl=e.find(".brtc-va-dialogs-member-management-search").jqxInput({placeHolder:"Search for Name, ID",theme:t.VA.Env.Theme}),this.$searchControl.keyup(function(t){i.applySearchFilter(i.$searchControl.val().trim());}),this.$searchControl.on("search",function(){i.applySearchFilter(i.$searchControl.val().trim());});},e.prototype.applySearchFilter=function(t){if(t){var e=new $.jqx.filter(),i=e.createfilter("stringfilter",t,"contains");e.addfilter(1,i);var o=new $.jqx.filter();o.operator="or";var n=e.createfilter("stringfilter",t,"contains");o.addfilter(1,n),this.$memberGrid.jqxGrid("addfilter","user_name",e),this.$memberGrid.jqxGrid("addfilter","user_id",o),this.$memberGrid.jqxGrid("applyfilters");}else this.$memberGrid.jqxGrid("clearfilters");this.$memberGrid.jqxGrid("clearselection");},e.prototype.createInviteButton=function(e){var i=this;this.$inviteButton=e.find(".brtc-va-dialogs-member-management-invite").jqxButton({theme:t.VA.Env.Theme}),this.$inviteButton.click(function(){new t.VA.Core.Dialogs.InviteMemberDialog(e,{members:i.$memberGrid.jqxGrid("getrows"),projectId:i.options.projectId,close:function close(){i.$memberGrid.jqxGrid("updatebounddata"),i.$memberGrid.jqxGrid("clearselection");},title:"Invite Member"});});},e.prototype.createMemberGrid=function(e){var i={datatype:"json",datafields:[{name:"user_name",type:"string"},{name:"user_id",type:"string"},{name:"role_id",type:"string"},{name:"role_category",type:"string"},{name:"role_label",type:"string"},{name:"joined_time",type:"date"}],url:"api/va/v2/ws/projects/"+this.options.projectId+"/members"},o=new $.jqx.dataAdapter(i);this.$memberGrid=e.find(".brtc-va-dialogs-member-management-grid").jqxGrid({theme:t.VA.Env.Theme,source:o,width:"100%",height:"calc(100% - 160px)",altrows:!1,filterable:!1,sortable:!1,columnsresize:!0,columnsheight:34,rowsheight:34,selectionmode:"checkbox",showfiltercolumnbackground:!1,enabletooltips:!0,columns:[{text:"Name",datafield:"user_name",width:120,cellsrenderer:function cellsrenderer(e,i,o){return'<div class="jqx-grid-cell-left-align" style="margin-top: 10px;">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o)+"</div>";}},{text:"ID",datafield:"user_id",width:240},{text:"Authority",datafield:"role_label",width:110},{text:"Joined Date",datafield:"joined_time",cellsformat:"yyyy-MM-dd HH:mm"}]});},e.prototype.createAuthorityCombo=function(e){this.$authorityCombo=e.find(".brtc-va-dialogs-member-management-authority").jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,source:[{id:"role_10002",label:"as Organizer"},{id:"role_10003",label:"as Member"},{id:"role_10004",label:"as Reporter"}],displayMember:"label",valueMember:"id",itemHeight:29,dropDownWidth:118,selectedIndex:1});},e.prototype.createApplyAuthorityButton=function(e){var i,o=this;this.$applyButton=e.find(".brtc-va-dialogs-member-management-apply-authority").jqxButton({theme:t.VA.Env.Theme}),this.$applyButton.click(function(){var e=o.$memberGrid.jqxGrid("getselectedrowindexes");if(0==e.length)t.VA.Core.Utils.WidgetUtils.openErrorDialog("At least one member must be selected.");else{if(1==e.length&&"role_10001"==(i=o.$memberGrid.jqxGrid("getrowdata",e[0])).role_id)return void t.VA.Core.Utils.WidgetUtils.openErrorDialog("Can not change authority of owner.");var n=o.$authorityCombo.jqxDropDownList("getSelectedItem").value,r={members:[]};for(var a in e){i=o.$memberGrid.jqxGrid("getrowdata",e[a]),r.members.push({user_id:i.user_id,role_id:n});}var s={url:"api/va/v2/ws/projects/"+o.options.projectId+"/members/authority",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0,data:JSON.stringify(r)};$.ajax(s).done(function(e){t.VA.Core.Utils.WidgetUtils.openInformationDialog("Changed "+e+" member's authority.",function(){o.$memberGrid.jqxGrid("updatebounddata"),o.$memberGrid.jqxGrid("clearselection");});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}});},e.prototype.createWithdrawButton=function(e){var i=this;this.$withdrawButton=e.find(".brtc-va-dialogs-member-management-withdraw").jqxButton({theme:t.VA.Env.Theme}),this.$withdrawButton.click(function(){var e=i.$memberGrid.jqxGrid("getselectedrowindexes");if(0==e.length)t.VA.Core.Utils.WidgetUtils.openErrorDialog("At least one member must be selected.");else{var o;for(var n in e){var r=i.$memberGrid.jqxGrid("getrowdata",e[n]);if("role_10001"==r.role_id)return void t.VA.Core.Utils.WidgetUtils.openErrorDialog("Can not change authority of owner.");r.user_id==t.VA.Env.Session.userId&&(o=!0);}o?t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Are you sure you want to leave the project?",function(t){t.OK&&i.withdraw();}):t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Are you sure you want to withdraw the member(s)?",function(t){t.OK&&i.withdraw();});}});},e.prototype.withdraw=function(){var e={members:[]},i=this,o=this.$memberGrid.jqxGrid("getselectedrowindexes");for(var n in o){var r=this.$memberGrid.jqxGrid("getrowdata",o[n]);e.members.push({user_id:r.user_id,role_id:r.role_id});}var a={url:"api/va/v2/ws/projects/"+i.options.projectId+"/members/withdraw",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0,data:JSON.stringify(e)};$.ajax(a).done(function(o){t.VA.Core.Utils.WidgetUtils.openInformationDialog("Withdraw "+o+" members.",function(){1==e.members.length&&e.members[0].user_id==t.VA.Env.Session.userId?i.handleOkClicked():(i.$memberGrid.jqxGrid("updatebounddata"),i.$memberGrid.jqxGrid("clearselection"));});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},e.prototype.createDialogContentsArea=function(t){t.append('<input type="search" class="brtc-va-dialogs-member-management-search"><input type="button" class="brtc-va-dialogs-member-management-invite" value="Invite Members"><div class="brtc-va-dialogs-member-management-grid"></div><input type="button" class="brtc-va-dialogs-member-management-withdraw" value="Withdraw"><input type="button" class="brtc-va-dialogs-member-management-apply-authority" value="Apply Authority"><div class="brtc-va-dialogs-member-management-authority"></div>'),this.createSearchControl(t),this.createInviteButton(t),this.createMemberGrid(t),this.createAuthorityCombo(t),this.createApplyAuthorityButton(t),this.createWithdrawButton(t);},e.prototype.createDialogButtonBar=function(e){t.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this,e),this.$okButton.val("Close"),this.$cancelButton.css({display:"none"});},e.prototype.handleOkClicked=function(){t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);},t.VA.Core.Dialogs.MemberManagementDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i),this.addListener();}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype.addListener=function(){var t=this;this.activeModelChangeListener=function(){t.options.getNavigatorData(),t.refresh();},this.options.editor.addActiveModelChangeListener(this.activeModelChangeListener);},e.prototype.removeListener=function(){this.options.editor.removeActiveModelChangeListener(this.activeModelChangeListener);},e.prototype.getTitle=function(){return"Navigator";},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-main-navigator">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents" style="padding-right: 20px;padding-left: 20px;">       </div>       <div class="brtc-va-dialogs-buttonbar">       </div>   </div></div>');var e=this._configureDialogOption({theme:t.VA.Env.Theme,title:this.getTitle(),position:{my:"left top",at:"left bottom",of:this.$parent.find(".brtc-va-editors-modelinfo-toolbar-dotdotdot")},width:400,height:600,maxWidth:400,maxHeight:600,modal:!1,resizable:!1});this.$mainControl.dialog(e),this.$mainControl.parent().draggable("option","containment",this.$parent),$(".ui-dialog-titlebar.ui-widget-header",$(this).parent()).css("width","calc(100% - 60px) !important");},e.prototype.createDialogContentsArea=function(t){var e=$('<div class="brtc-va-dialogs-navigator-item-container"></div>');t.append(e),this.refresh(),t.perfectScrollbar();},e.prototype.createNavigatorItems=function(e){var i=this;this.fnUnits={};var o=this.options.getNavigatorData();0===o.length&&this.close(),e.empty(),e.append(o.map(function(e){var o=e.fnUnit,n=o.fid;i.fnUnits[n]=e.fnUnit;var r=e.mid,a=t.VA.Core.Interface.Functions.data[o.func],s=$('<div class="brtc-va-dialogs-index-item">   <div class="brtc-va-dialogs-index-item-label"></div>   <div class="brtc-va-dialogs-index-item-func"></div></div>');return s.attr("fid",n),s.attr("mid",r),s.addClass("brtc-va-fnunit-category-"+a.category),s.find(".brtc-va-dialogs-index-item-label").attr("title",o.display.label),s.find(".brtc-va-dialogs-index-item-label").text(o.display.label),s.find(".brtc-va-dialogs-index-item-func").text(a.defaultFnUnit.display.label),s;})),e.find(".brtc-va-dialogs-index-item").click(function(){var t=$(this).attr("fid"),e=$(this).attr("mid"),o=i.fnUnits[t];i.options.navigate(e,o);});},e.prototype.createDialogButtonBar=function(t){},e.prototype.destroy=function(){this.removeListener(),t.VA.Dialogs.Dialog.prototype.destroy.call(this);},e.prototype.refresh=function(){var t=this.$mainControl.find(".brtc-va-dialogs-navigator-item-container");(t.empty(),this.createNavigatorItems(t),this.$mainControl)&&this.$mainControl.find("brtc-va-dialogs-contents").perfectScrollbar("update");},t.VA.Core.Dialogs.NavigatorDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=980,this.dialogOptions.height=670;},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-newfile-contents"),t.parent().parent().find(".ui-dialog-titlebar.ui-widget-header").css("margin-left","26px !important"),this.createModelTypeListArea(t),this.createModelInfoInputArea(t);},e.prototype.createModelTypeListArea=function(e){var i=this,o=$('<div class="brtc-va-dialogs-modeltype-list"></div>'),n=t.VA.Implementation;for(var r in n){if("Report"===i.options.fileType){if("Visual"!==r)continue;}else if("Visual"===r)continue;o.append('   <div class="brtc-va-dialogs-modeltype-list-item" model-type="'+n[r].Clazz+'">       <div class="brtc-va-dialogs-modeltype-list-item-icon"></div>       <div class="brtc-va-dialogs-modeltype-list-item-label" title="'+n[r].Label+'">'+n[r].Label+"</div>   </div>");}e.append(o),e.find(".brtc-va-dialogs-modeltype-list-item:first").addClass("brtc-va-dialogs-modeltype-list-item-selected"),e.find(".brtc-va-dialogs-modeltype-list-item").click(function(){$(this).parent().find(".brtc-va-dialogs-modeltype-list-item-selected").removeClass("brtc-va-dialogs-modeltype-list-item-selected"),$(this).addClass("brtc-va-dialogs-modeltype-list-item-selected"),i.renderModelList($(this).attr("model-type"));});},e.prototype.createModelInfoInputArea=function(e){e.append('<div class="brtc-va-dialogs-newfiledialog-input-area">   <div class="brtc-va-dialogs-newfiledialog-label">Name</div>   <input type="text" class="brtc-va-dialogs-newfiledialog-name-input" maxlength="80"/>   <div class="brtc-va-dialogs-newfiledialog-label">Description</div>   <div class="brtc-va-dialogs-newfiledialog-description-container"></div>   <div class="brtc-va-dialogs-newfiledialog-label">Template</div>   <div class="brtc-va-dialogs-newfiledialog-template-list"></div></div>'),this.$nameControl=e.find(".brtc-va-dialogs-newfiledialog-name-input"),this.$nameControl.jqxInput({theme:t.VA.Env.Theme}),this.$nameControl.focus();var i=e.find(".brtc-va-dialogs-modeltype-list-item").attr("model-type");this.createDescriptionControl(e.find(".brtc-va-dialogs-newfiledialog-description-container")),this.createTemplate(e.find(".brtc-va-dialogs-newfiledialog-template-list"),i);},e.prototype.renderModelList=function(t){var e=this.$mainControl.find(".brtc-va-dialogs-newfiledialog-template-list"),i=e.parent();e.remove(),i.find(".brtc-va-dialogs-newfiledialog-name-input").focus(),i.append('<div class="brtc-va-dialogs-newfiledialog-template-list"></div>'),this.createTemplate(i.find(".brtc-va-dialogs-newfiledialog-template-list"),t);},e.prototype.convertTemplateContents=function(t){var e,i;"deeplearning"!==(t=t).type||_.isEmpty(t.functions)||(_.forEach(t.functions,function(t){"dlLoad"===t.func&&(e=t),"output"===t.func&&(i=t);}),i.param.train_data=e.fid);return t;},e.prototype.createTemplate=function(e,i){var o=this;if(o.$templateContainer=$('<div class="brtc-va-dialogs-file-thumbnail-container"></div>'),e.append(o.$templateContainer),void 0!==i){var n={url:"api/va/v2/studio/templates/"+i,type:"GET",contentType:"application/json; charset=utf-8",blocking:!0};$.ajax(n).done(function(e){e.sort(function(t,e){return"Default"===t.name?-1:"Default"===e.name?1:t.name.localeCompare(e.name);}),e.forEach(function(e,i){var n=t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e.name),r=$('<div class="brtc-va-dialogs-file-thumbnail-unit">   <div class="brtc-va-dialogs-file-thumbnail name">'+n+'</div>   <div class="brtc-va-dialogs-file-thumbnail image"/>   <div class="brtc-va-dialogs-file-thumbnail overlay">'+e.description+"</div></div>");"Default"!==n&&r.mouseover(function(){r.find(".brtc-va-dialogs-file-thumbnail.overlay").css({opacity:.6});}).mouseout(function(){r.find(".brtc-va-dialogs-file-thumbnail.overlay").css({opacity:0});}),e.thumbnail&&r.find(".brtc-va-dialogs-file-thumbnail.image").append($('<img src="'+e.thumbnail+'" />')),0==i&&r.addClass("brtc-va-dialogs-file-thumbnail-selected"),o.$templateContainer.append(r),r.data("contents",e.contents);}),o.$templateContainer.find(".brtc-va-dialogs-file-thumbnail-unit").click(function(t){o.$templateContainer.find(".brtc-va-dialogs-file-thumbnail-selected").removeClass("brtc-va-dialogs-file-thumbnail-selected"),$(this).addClass("brtc-va-dialogs-file-thumbnail-selected");});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);}),e.perfectScrollbar();}},e.prototype.createDescriptionControl=function(e){var i=this,o={focus:!1,height:120,description:"",okButton:this.$okButton,maxLength:2e3,toolbar:this.options.toolbar};this.noteControl=t.VA.Core.Widget.Factory.noteControl(e,o),this.$mainControl.on("resizing",function(t){i.noteControl.setHeight(i.$mainControl.find(".brtc-va-dialogs-contents").height()-110);});},e.prototype.createFileContents=function(e,i,o){var n=this.$templateContainer.find(".brtc-va-dialogs-file-thumbnail-selected");return 0==n.length&&(n=this.$templateContainer.find(".brtc-va-dialogs-file-thumbnail:nth-child(1)")),this.convertTemplateContents(t.VA.Core.Utils.ModelUtils.createFileContents(n.data("contents"),e,i,o));},e.prototype.handleOkClicked=function(){var e=this,i=this.$mainControl.find(".brtc-va-dialogs-newfiledialog-name-input");if(""!==i.val().trim()){if($(e.noteControl.getCode()).text().length>2e3)t.VA.Core.Utils.WidgetUtils.openErrorDialog("Description should be less than or equal to 2000 characters.");else{var o=t.VA.Core.Utils.IDGenerator.model.id(),n=""===e.noteControl.getCode()?"":e.noteControl.getCode(),r=new t.VA.Vo.File();r.setFileId(o),r.setProjectId(this.options.project.getProjectId()),r.setLabel(i.val()),r.setContents(e.createFileContents(o,i.val())),r.setDescription(n),r.setCreator(t.VA.Env.Session.userId),Studio.getResourceManager().addFile(this.options.project.getProjectId(),r).then(function(t){e.dialogResult={OK:!0,Cancel:!1,selectedFile:t},e.$mainControl.dialog("close");}).catch(function(e){console.error(e),t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});}}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter name.",function(){e.$nameControl.focus();});},t.VA.Core.Dialogs.NewFileDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls(),this.createContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-notedialog">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">           <div class="brtc-va-dialogs-notecontents">           </div>       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="Save" />       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok");var e={theme:t.VA.Env.Theme,title:"Note",width:1020,height:690,maxWidth:1020,maxHeight:690,modal:!0,resizable:!1};this.$mainControl.dialog(e);},e.prototype.createContents=function(){this.initContents(this.$mainControl.find(".brtc-va-dialogs-notecontents")),this.createNoteArea(this.$mainControl.find(".brtc-va-dialogs-notecontents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.handleOkClicked.bind(this));},e.prototype.initContents=function(t){},e.prototype.createNoteArea=function(e){var i={height:480,description:this.options.contents,okButton:this.$okButton,maxLength:1e3};this.note=t.VA.Core.Widget.Factory.noteControl(e,i);},e.prototype.handleOkClicked=function(){"function"==typeof this.options.save&&this.options.save(this.note.getCode()),this.$mainControl.dialog("close");},t.VA.Core.Dialogs.NoteDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=760,this.dialogOptions.height=440;},e.prototype.createDialogContentsArea=function(e){var i=$('<div class="brtc-va-dialogs-row-flex-layout notice">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold notice">Title</div>   <div class="brtc-va-dialogs-contents-input notice"></div></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold notice">Register Date</div>   <div class="brtc-va-dialogs-contents-input-half notice">'+t.VA.Core.Utils.CommonUtils.transferTimestampToDateString(new Date(this.options.noticeData.create_time))+'</div>   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold notice">Creator</div>   <div class="brtc-va-dialogs-contents-input-half notice creator">'+this.options.noticeData.creator+'</div></div><div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold notice">Content</div>   <div class="brtc-va-dialogs-contents-textarea-wrapper notice" style="word-wrap:break-word; ">       <div class="brtc-va-dialogs-contents-textarea notice"></div>   </div></div>');i.find(".brtc-va-dialogs-contents-input.notice").attr("title",this.options.noticeData.title).text(this.options.noticeData.title),i.find(".brtc-va-dialogs-contents-input-half.notice.creator").attr("title",this.options.noticeData.creator),e.append(i),e.find(".brtc-va-dialogs-contents-textarea.notice").html(this.options.noticeData.content),$(".brtc-va-dialogs-contents-textarea-wrapper.notice").perfectScrollbar();},e.prototype.createDialogButtonBar=function(e){var i=this;this.$closeButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-close" value="Close" />'),e.append(this.$closeButton),this.$closeButton.jqxButton({theme:t.VA.Env.Theme}),this.$closeButton.on("click",function(t){i.$mainControl.dialog("close"),t.stopPropagation();});},t.VA.Core.Dialogs.NoticeDetailDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=900,this.dialogOptions.height=540,this.dialogOptions.keyboardCloseKey="",this.dialogOptions.closeOnEscape=!1,this.$elements={},this.controls={};},e.prototype.createDialogContentsArea=function(e){var i=this;this.$contentsArea=e;var o={url:"api/va/v2/studio/optcontrol",type:"GET",data:{func:this.options.fnUnit.func,method:this.options.method},contentType:"application/json; charset=utf-8",blocking:!0};this.options.methodType&&(o.data.methodType=this.options.methodType),$.ajax(o).done(function(o){var n={controlSpec:o,fnUnit:i.options.fnUnit,dataProxy:i.options.dataProxy,modelEditor:i.options.modelEditor};i.popupProperty=new t.VA.Core.Functions.Library.optDialogBase.propertiesPanel(e,n);});},e.prototype.handleOkClicked=function(){this.dialogResult.param=this.popupProperty.getParams(),t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);},e.prototype.destroy=function(){this.popupProperty.destroy(),this.$mainControl.dialog("destroy"),this.$mainControl=void 0;},t.VA.Core.Dialogs.OptDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){var o=Studio.getEditorContainer().getActiveModelEditor();e=e||o.$mainControl,(i=i||{}).title="Optimization Progress",t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=1e3,this.dialogOptions.height=600,this.dialogOptions.modal=!1,this.dialogOptions.create=function(){$(".ui-widget-content").css("border-color","#d4d4d4");};},e.prototype.createDialogContentsArea=function(t){var e=$('<div class="brtc-va-dialogs-opt-progress-container" style="display: flex;"></div>');t.append(e),this.createParameterArea(e),this.createObjectiveValueArea(e),this.options.data&&(this.selectedIndex=0,this.render(this.options.data)),t.perfectScrollbar();},e.prototype.createParameterArea=function(t){var e=$('<div style="width: 50%;height: 440px;overflow: hidden;"></div>');t.append(e),this.createHistoryArea(e),this.createBestParamArea(e),this.createTabsArea(e);},e.prototype.createHistoryArea=function(t){this.$historyArea=$('<div style="margin-bottom: 15px;">   <div style="font-weight:bold;margin-bottom:3px;">History</div>   <div class="brtc-opt-progress-dialog-history-grid"></div></div>'),t.append(this.$historyArea);},e.prototype.createBestParamArea=function(t){this.$bestParamArea=$('<div>   <div style="font-weight:bold;margin-bottom:3px;">Best Parameter</div>   <div class="brtc-opt-progress-dialog-best-param-grid"></div></div>'),t.append(this.$bestParamArea);},e.prototype.createTabsArea=function(t){this.$tabsArea=$('<div>  <div class="brtc-opt-progress-dialog-tabs-wrapper" style="margin-top: 20px;">  </div></div>'),t.append(this.$tabsArea);},e.prototype.createObjectiveValueArea=function(t){var e=$('<div style="width: 50%;height: 440px;overflow: hidden;"></div>');t.append(e),this.createObjectiveChartArea(e);},e.prototype.createObjectiveChartArea=function(t){this.$chartArea=$('<div>   <div style="font-weight:bold;margin-bottom:3px;">Objective Value</div>   <div class="brtc-opt-progress-dialog-chart-wrapper" style="width:470px;height:421px;"></div></div>'),t.append(this.$chartArea);},e.prototype.createDialogButtonBar=function(e){this.$okButton=$('\n            <input type="button" class="brtc-va-dialogs-buttonbar-ok" \n            style="width:155px;" value="Apply Best Parameters" />'),e.append(this.$okButton),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.handleOkClicked.bind(this));},e.prototype.handleOkClicked=function(){var e=Studio.getEditorContainer().getActiveModelEditor(),i=e.getEditorInput().getContents(),o=e.getCommandManager(),n=new t.VA.Core.CompoundCommand(this,{label:"Apply best parameters"});this.optimizationData=this.optimizationData||{};var r=this.optimizationData.bestParameter||[];if(r.length){for(var a=0;a<r[0].length;a++){var s=r[0][a],l=s.fid,c=s.name,d=s.value,p=i.getFnUnitById(l);if(p){var u={fnUnit:p,ref:{param:{}}};u.ref.param[c]=d;var h=new t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this,u);n.add(h);}}o.execute(n);}t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);},e.prototype.render=function(t){var e=this.getOptimizationData(t);e&&(this.optimizationData=e,this.optimizationFids=this.getOptimizationFids(e),this.$mainControl&&(this.$mainControl.parent().show(),this._render(e)));},e.prototype.getOptimizationData=function(t){var e=t.processes;if(!e)return null;for(var i=e.length-1;i>=0;i--){for(var o=e[i].functions,n=o.length-1;n>=0;n--){var r=o[n].optimization;if(r)return r;}}return null;},e.prototype.getOptimizationFids=function(t){var e=t.parameter;return _(e).flatten().map("fid").uniq().sortBy().value();},e.prototype._render=function(t){var e=t.parameter,i=t.bestParameter,o=t.objective;this.renderHistory(e),this.renderBestParam(i),this.renderTabs(this.optimizationFids),this.renderObjectiveChart(o);},e.prototype.getFunctionLabel=function(t){var e=Studio.getEditorContainer().getActiveModelEditor().getEditorInput().getContents().getFnUnitById(t);return e?e.display.label:"";},e.prototype.renderTabs=function(t){var e=this,i=this.$tabsArea.find(".brtc-opt-progress-dialog-tabs-wrapper");if(i.find("li").length){var o=i.find("li").toArray().map(function(t){return t.getAttribute("fid");});if(_.isEqual(o,t))return;}i.empty();var n=$('<div class="brtc-opt-progress-dialog-tabs"></div>');i.append(n),n.append("<ul></ul>"),_.forEach(t,function(t,i){var o=e.getFunctionLabel(t),r=$("<li></li>");r.attr({fid:t,title:o}),r.text(o),n.find("ul").append(r),n.append("<div></div>");}),t.length<=this.selectedIndex&&(this.selectedIndex=0),n.jqxTabs({theme:"office",selectedItem:this.selectedIndex,width:450,position:"bottom",scrollPosition:"both"}),n.on("selected",function(t){var i=t.args.item;e.selectedIndex=i,e.renderHistory(e.optimizationData.parameter),e.renderBestParam(e.optimizationData.bestParameter);});},e.prototype.renderHistory=function(e){var i=this.$historyArea.find(".brtc-opt-progress-dialog-history-grid"),o=this.convertParameter(e),n=new $.jqx.dataAdapter(o),r=this.getColumns(o.datafields);this.historyGrid=i.jqxGrid({theme:t.VA.Env.Theme,width:450,height:270,source:n,columns:r,columnsresize:!0});},e.prototype.renderBestParam=function(e){var i=this.$bestParamArea.find(".brtc-opt-progress-dialog-best-param-grid"),o=this.convertParameter(e),n=new $.jqx.dataAdapter(o),r=this.getColumns(o.datafields,!0);this.bestParameterGrid=i.jqxGrid({theme:t.VA.Env.Theme,width:450,autoheight:!0,source:n,columns:r,columnsresize:!0});},e.prototype.renderObjectiveChart=function(e){var i=this.$chartArea.find(".brtc-opt-progress-dialog-chart-wrapper");this.objectiveValue||(this.objectiveValue=e);var o=this.getChartOptions(e);if(this.chart){var n=!1;this.objectiveValue.length!=e.length&&(this.objectiveValue=e,n=!0),n&&this.chart.setOptions(o);}else i.empty(),this.chart=new t.Chart.BCharts(i,o);},e.prototype.getChartOptions=function(t){var e={chart:{border:"1px #000000 none",background:"rgba(255, 255, 255,1)",animationDuration:1e3,type:"line"},plotOptions:{line:{marker:{symbolSize:7,itemStyle:{normal:{opacity:1}}}}},xAxis:[{selected:[{value:"Index",name:"Index",type:"Integer"}],title:{show:!0,text:"",subtext:"",rotate:0,textStyle:{color:"#000000",fontSize:12,fontFamily:""},subtextStyle:{color:"#000000",fontSize:12,fontFamily:""},left:"50%",bottom:"5px"},axisTick:{show:!0},axisLabel:{show:!0,rotate:0,textStyle:{color:"#000000",fontSize:12,fontFamily:""}},zlevel:1,axisType:null}],yAxis:[{selected:[{value:"Objective",name:"Objective",type:"Double"}],title:{show:!1,text:"",subtext:"",rotate:-90,textStyle:{color:"#000000",fontSize:12,fontFamily:""},subtextStyle:{color:"#000000",fontSize:12,fontFamily:""},left:"8px",top:"50%"},axisTick:{show:!0},axisLabel:{show:!0,rotate:0,textStyle:{color:"#000000",fontSize:12,fontFamily:""}},zlevel:1,axisType:null}]};return e.source={dataType:"local",localData:[{dataType:"rawdata",columns:[{name:"Index",type:"number",internalType:"Integer"},{name:"Objective",type:"number",internalType:"Double"}],data:this.getConvertedObjectiveValue(t)}]},e.toolbar={type:"custom",show:!1},e;},e.prototype.getConvertedObjectiveValue=function(t){for(var e=[],i=0;i<t.length;i++){e.push([Number(i)+1,t[i]]);}return e;},e.prototype.convertParameter=function(t){for(var e=this.optimizationFids[this.selectedIndex],i={},o=[],n=0;n<t.length;n++){for(var r=t[n],a={},s=0;s<r.length;s++){if(r[s].fid==e){var l=r[s].name,c=r[s].value;a[l]=c,i[l]&&"number"!==i[l]||(i[l]=1==$.isNumeric(c)?"number":"string");}}o.push(a);}var d=[];for(var p in i){d.push({name:p,type:i[p]});}return{localdata:o,datatype:"json",datafields:d};},e.prototype.getColumns=function(t,e){var i=e?[]:[{text:"#",sortable:!1,filterable:!1,editable:!1,groupable:!1,draggable:!1,resizable:!1,datafield:"",columntype:"number",width:30,cellsrenderer:function cellsrenderer(t,e,i){return"<div style='margin:4px;'>"+(i+1)+"</div>";}}];for(var o in t){i.push({text:t[o].name,datafield:t[o].name});}return i;},e.prototype.hide=function(){this.$mainControl.parent().hide();},t.VA.Core.Dialogs.OptProgressDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Dialogs.ScriptEditorDialog.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype._initOptions=function(){e._initOptions.call(this),this.controls={},this.columnControlList=[];},i.prototype.createLayout=function(t,i){e.createLayout.call(this),this.$controlWrapper=$('<div class="brtc-va-dialogs-controlwrapper">'),this.$controlWrapper.css("display","flex"),this.$infoArea.append(this.$controlWrapper);},i.prototype.renderInfoArea=function(t,e){this.createColumnControls(),this.fillControlValues();},i.prototype.createColumnControls=function(e){for(var i=["parameters","constraints-column","objectives-column"],o=0;o<i.length;o++){var n=i[o],r=this.options.fnUnit.param[n]?this.options.fnUnit.param[n]:this.options.fnUnit.param[n.replace("-column","")];this.controls[n]=new t.VA.Core.Editors.Sheet.Controls.Optimization[n](this,{value:r});}},i.prototype.renderColumnControls=function(t){for(var e=["parameters","constraints-column","objectives-column"],i=0;i<e.length;i++){this.controls[e[i]].renderControl();}},i.prototype.addPropertyControl=function(t,e,i){i.mandatory&&(t='<div style="display:inline-block;">'+t+' <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>');var o=$('<div class="brtc-va-dialogs-scalaeditor-alias-header">'+t+"</div>"),n=$('<div class="brtc-va-dialogs-scalaeditor-alias-body space"></div>');return o.append(n),this.$controlWrapper.append(o).append(n),"function"==typeof e&&e.call(this,n),n;},i.prototype.createColumnList=function(e,i){var o=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');e.wrap(o);var n={placeHolder:"No Columns",multiple:!0,rowCount:1,maxRowCount:5,expand:!1,sort:"none",sortBy:"name",showOpener:"none",removable:!1,defaultType:"-",changed:function changed(t,e){},added:function added(){},removed:function removed(){}};return i&&$.extend(n,i),new t.VA.Core.Editors.Sheet.Controls.ColumnList(e,n);},i.prototype.registerColumnControl=function(t){this.columnControlList.push(t);},i.prototype.fillControlValues=function(){var t=[],e=this;this.options.fnUnit[IN_DATA][0]?this.options.dataProxy.requestSchema(this.options.fnUnit[IN_DATA][0],function(i){if(t=i.columns,e.columnControlList)for(var o=0;o<e.columnControlList.length;o++){e.columnControlList[o].setItems(t);}e.renderColumnControls();},function(t){}):e.renderColumnControls();},i.prototype.getTitle=function(){return"Python";},t.VA.Core.Dialogs.OptScriptEditorDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){var o=Studio.getEditorContainer().getActiveModelEditor();e=e||o.$mainControl,(i=i||{}).title="Select Objective",t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=607,this.dialogOptions.height=800,this.dialogOptions.modal=!0,this.dialogOptions.create=function(){$(".ui-widget-content").css("border-color","#d4d4d4");};},e.prototype.createDialogContentsArea=function(t){var e=$('<div class="brtc-va-dialogs-opt-select-objective-container" style="display: flex;"></div>');t.append(e),this.createFunctionsArea(e),this.createObjectiveArea(e),e.append("\n            <style>\n                .brtc-va-dialogs-opt-select-objective-container div.jqx-expander-header {\n                    font-family: Arial, helvetica, sans-serif;\n                    font-size: 13px;\n                    font-weight: bold;\n                    margin-bottom: 5px;\n                    border: none;\n                    border-bottom-color: white;\n                    background: #fff;\n                }\n\n                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-header-content-office {\n                    margin-left: 19px !important;\n                }\n\n                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-arrow {\n                    margin-top: 6px !important;\n                }\n\n                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-arrow-top-office {\n                    background-image: url(/css/plugins/aui-package/images/office-icon-right.png);\n                }\n\n                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-arrow-bottom-office {\n                    background-image: url(/css/plugins/aui-package/images/office-icon-down.png);\n                }\n\n                .brtc-va-dialogs-opt-select-objective-container .jqx-expander-content {\n                    border: none;\n                    margin-bottom: 15px;\n                }\n\n                .brtc-opt-function-table-label:hover {\n                    background-color: #f2f2f2;                    \n                }\n\n                .brtc-opt-function-table-label.selected {\n                    background-color: #EFF1FD;\n                    border-color: #626FDB;\n                }\n\n                .brtc-opt-function-table-label.selected:hover {\n                    background-color: #EFF1FD;\n                    border-color: #626FDB;\n                }\n\n                .brtc-opt-function-table-label {\n                    user-select: text;\n                    border: 1px solid white;\n                    margin-right: 5px;\n                    width: 265px;\n                    font-size: 12px;\n                    height: 35px;\n                    line-height: 35px;\n                    box-sizing: border-box;\n                    padding: 0 10px 0 13px;\n                    cursor: pointer;\n                    margin-left: 27px;\n                    text-overflow: ellipsis;\n                    overflow: hidden;\n                    white-space: nowrap;\n                }\n\n                .brtc-va-select-opt-objective-mandatory {\n                    line-height: 5px;\n                    margin-top: 3px;\n                    color: #ee7379;\n                }\n            </style>\n        "),t.perfectScrollbar();},e.prototype.createFunctionsArea=function(e){var i=this,o=$('<div class="brtc-opt-select-" style="\n            width: 330px;\n            height: 640px;\n            overflow: hidden;\n            box-sizing: border-box;\n            padding-right: 15px;\n            position: relative;\n        "></div>');e.append(o);var n=this.options.functions;for(var r in n){!function(e,n){var r=$('<div style="\n            border-bottom: solid 1px #f2f2f2;\n        "></div>');o.append(r);var a=e[n].display.label,s=t.VA.Core.Functions.Library[e[n].func].category;s=s||"io";var l=$("\n                    <div class=\"brtc-va-jqx-expander-header-wrapper\" style=\"margin-bottom: 0;\">\n                        <div class=\"brtc-va-fnunit-category-"+s+"\" style=\"\n            box-sizing: border-box;\n            width: 270px;\n            height: 32px;\n            line-height: 32px;\n            font-size: 12px;            \n            font-family: Arial, Dotum, Tahoma, sans-serif;\n            font-weight: bold;            \n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            margin-right: 8px;\n            margin-left: 0;\n            display: flex;\n        \">\n                            <div class=\"brtc-style-views-palette-fnunit-icon\" style=\"margin-top: 5px;\"></div>\n                            <div class=\"brtc-opt-function-label\" style=\"       \n            width: 223px;   \n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        \"></div>\n                        </div>\n                    </div>\n                ");l.find(".brtc-opt-function-label").text(a),l.attr("title",a),r.append(l);var c=$('<div style=""></div>');r.append(c);var d=e[n].outData;for(var p in d){!function(t,r){var s=a+"-"+(Number(r)+1),l=t[r],d=$('\n                            <div class="brtc-opt-function-table-label">\n                                <i class="fa fa-table" aria-hidden="true"></i>\n                                <span style="margin-left: 5px;"></span>\n                            </div>\n                        ');i.options.objective.tableName===l&&d.addClass("selected"),d.find("span").text(s),d.attr("title",s),c.append(d),d.click(function(){o.find(".brtc-opt-function-table-label").removeClass("selected"),$(this).addClass("selected"),i.options.objective.fid=e[n].fid,i.options.objective.tableName=l,i.$functionLabelControl.text(a),i.$functionLabelControl.attr("title",a),i.$tableLabelControl.text(s),i.$tableLabelControl.attr("title",s);});}(d,p);}r.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"left",expanded:!0});}(n,r);}o.perfectScrollbar();},e.prototype.createObjectiveArea=function(t){var e=$('<div style="\n            width: 217px;\n            height: 440px; \n            overflow: hidden;\n        "></div>');t.append(e);var i=$('<div style="\n            padding: 8px 10px 10px 10px;\n            background-color: #f2f2f2;\n        "></div>');e.append(i),this.createFunctionLabelControl(i),this.createTableLabelControl(i),this.createRowControl(i),this.createColumnControl(i),this.createSenseControl(i),e.append("\n            <style>\n                .brtc-opt-model-sense-radio .jqx-radiobutton-default-office {\n                    background-color: #ffffff;\n                    border-radius: 100% !important;  \n                }\n            </style>\n        ");},e.prototype.createFunctionLabelControl=function(t){t.append('\n            <div style="margin: 0 0 4px 0;">\n                Function\n                <span class="brtc-va-select-opt-objective-mandatory">*</span>\n            </div>');this.$functionLabelControl=$('<div style="\n            width: 197px;\n            height: 26px;\n            font-family: Arial, helvetica, sans-serif;\n            border: 1px solid #d4d4d4;\n            line-height: 24px;\n            padding-left: 10px;\n            padding-right: 10px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            box-sizing: border-box;\n            color: rgba(0, 0, 0, .8);\n            cursor: default;\n            background-color: #fff;\n            opacity: .55;\n        "></div>');var e=this.options.objective.fid,i=Studio.getEditorContainer().getActiveModelEditor().getEditorInput().getContents().getFnUnitById(e);if(i){var o=i.display.label;this.$functionLabelControl.text(o),this.$functionLabelControl.attr("title",o);}else this.options.objective.fid="",this.$functionLabelControl.text("Select objective");t.append(this.$functionLabelControl);},e.prototype.createTableLabelControl=function(t){t.append('\n            <div style="margin: 10px 0 4px 0;">\n                Table Name\n                <span class="brtc-va-select-opt-objective-mandatory">*</span>\n            </div>');this.$tableLabelControl=$('<div style="\n            width: 197px;\n            height: 26px;\n            font-family: Arial, helvetica, sans-serif;\n            border: 1px solid #d4d4d4;\n            line-height: 24px;\n            padding-left: 10px;\n            padding-right: 10px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            box-sizing: border-box;\n            color: rgba(0, 0, 0, .8);\n            cursor: default;\n            background-color: #fff;\n            opacity: .55;\n        "></div>');var e=this.options.objective.fid,i=Studio.getEditorContainer().getActiveModelEditor().getEditorInput().getContents().getFnUnitById(e);if(i){var o,n=i.display.label,r=this.options.objective.tableName,a=i.outData;for(var s in a){if(a[s]===r){o=n+"-"+(Number(s)+1);break;}}this.$tableLabelControl.text(o),this.$tableLabelControl.attr("title",o);}else this.options.objective.tableName="",this.$tableLabelControl.text("Select objective");t.append(this.$tableLabelControl);},e.prototype.createRowControl=function(e){var i=this;e.append('\n            <div style="margin: 10px 0 4px 0;">\n                Row Number\n                <span class="brtc-va-select-opt-objective-mandatory">*</span>\n            </div>'),this.$rowControlWrapper=$("<div></div>"),e.append(this.$rowControlWrapper);this.$rowControl=new t.VA.Core.Editors.Sheet.Controls.NumericInput(this.$rowControlWrapper,{numberType:"int",min:1,max:9999,minus:!1,placeholder:"Enter row number"});var o=this.options.objective.row;this.$rowControl.setValue(o),this.$rowControl.onChange(function(t){i.options.objective.row=t;});},e.prototype.createColumnControl=function(e){var i=this;e.append('\n            <div style="margin: 10px 0 4px 0;">\n                Column Name\n                <span class="brtc-va-select-opt-objective-mandatory">*</span>\n            </div>'),this.$columnControl=$('<input type="text"/>'),e.append(this.$columnControl),this.$columnControl.jqxInput({placeHolder:"Enter column name",theme:t.VA.Env.Theme,width:"100%",height:25}),this.$columnControl.val(this.options.objective.column),this.$columnControl.on("change",function(t){var e=$(this).val();i.options.objective.column=e;});},e.prototype.createSenseControl=function(e){var i=this;e.append('\n            <div style="margin: 10px 0 4px 0;">\n                Sense\n                <span class="brtc-va-select-opt-objective-mandatory">*</span>\n            </div>'),this.$senseMax=$('<div class="brtc-opt-model-sense-radio" style="margin-top: 10px;">Maximize</div>'),this.$senseMin=$('<div class="brtc-opt-model-sense-radio" style="margin-top: 10px;">Minimize</div>'),e.append(this.$senseMax),e.append(this.$senseMin);var o="maximize"===this.options.objective.sense.toLowerCase();this.$senseMax.jqxRadioButton({theme:t.VA.Env.Theme,checked:o}),this.$senseMin.jqxRadioButton({theme:t.VA.Env.Theme,checked:!o}),this.$senseMax.on("change",function(t){t.args.checked&&(i.options.objective.sense="maximize");}),this.$senseMin.on("change",function(t){t.args.checked&&(i.options.objective.sense="minimize");});},e.prototype.createDialogButtonBar=function(e){this.$okButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />'),e.append(this.$okButton),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.handleOkClicked.bind(this)),this.$cancelButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />'),e.append(this.$cancelButton),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme}),this.$cancelButton.click(this.handleCancelClicked.bind(this));},e.prototype.handleOkClicked=function(){if(void 0!==this.$mainControl){if(this.options.objective){if(!this.options.objective.fid||!this.options.objective.tableName)return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please select objective.");if(!this.options.objective.row)return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter row number.");if(!this.options.objective.column)return t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter column name.");}this.dialogResult.OK=!0,this.dialogResult.Cancel=!1,this.dialogResult.objective=$.extend(!0,{},this.options.objective),this.$mainControl.dialog("close");}},e.prototype.render=function(t){var e=this.getOptimizationData(t);e&&(this.$mainControl.parent().show(),this._render(e));},e.prototype.getOptimizationData=function(t){var e=t.processes;if(!e)return null;for(var i=e.length-1;i>=0;i--){for(var o=e[i].functions,n=o.length-1;n>=0;n--){var r=o[n].optimization;if(r)return r;}}return null;},e.prototype._render=function(t){var e=t.parameter,i=t.bestParameter,o=t.objective;this.renderHistory(e),this.renderBestParam(i),this.renderObjectiveChart(o);},e.prototype.renderHistory=function(e){var i=this.$historyArea.find(".brtc-opt-progress-dialog-history-grid"),o=this.convertParamter(e),n=new $.jqx.dataAdapter(o),r=this.getColumns(o.datafields);this.historyGrid=i.jqxGrid({theme:t.VA.Env.Theme,width:450,height:322,source:n,columns:r,columnsresize:!0});},e.prototype.renderBestParam=function(e){var i=this.$bestParamArea.find(".brtc-opt-progress-dialog-best-param-grid"),o=this.convertParamter(e),n=new $.jqx.dataAdapter(o),r=this.getColumns(o.datafields);this.bestParameterGrid=i.jqxGrid({theme:t.VA.Env.Theme,width:450,autoheight:!0,source:n,columns:r,columnsresize:!0});},e.prototype.renderObjectiveChart=function(e){var i=this.$chartArea.find(".brtc-opt-progress-dialog-chart-wrapper");this.objectiveValue||(this.objectiveValue=e);var o=this.getChartOptions(e);if(this.chart){var n=!1;this.objectiveValue.length!=e.length&&(this.objectiveValue=e,n=!0),n&&this.chart.setOptions(o);}else i.empty(),this.chart=new t.Chart.BCharts(i,o);},t.VA.Core.Dialogs.OptSelectObjectiveDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Dialogs.Dialog.prototype;function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype._initOptions=function(){e._initOptions.call(this),this.dialogOptions.width=600,this.dialogOptions.height=540,this.dialogOptions.keyboardCloseKey="",this.dialogOptions.closeOnEscape=!1,this.controls={};},i.prototype.createDialogContentsArea=function(e){var i={fnUnit:this.options.fnUnit,dataProxy:this.options.dataProxy,modelEditor:this.options.modelEditor,renderValues:this.renderValues.bind(this),fillControlValues:this.fillControlValues.bind(this)};this.popupProperty=new t.VA.Core.Functions.Library.DialogPanelProperties.propertiesPanel(e,i),this.createContentsAreaControls(this.popupProperty.$contentsArea),this.popupProperty.retrieveTableInfo(this.FnUnitUtils.getInTable(this.options.fnUnit)),this.popupProperty._initializePerfectScroll();},i.prototype.fillControlValues=function(){},i.prototype.renderValues=function(){},i.prototype.handleOkClicked=function(){this.dialogResult.param=this.popupProperty.getParams(),t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);},i.prototype.bindValidation=function(t){},i.prototype.checkValidation=function(t){if(this.removeValidation(t.$target),t.control&&(!t.control.getValue()||$.isEmptyObject(t.control.getValue()))){var e={$target:t.$target,message:this.popupProperty.problemFactory.makeMessage({errorCode:"BR-0033",param:t.$target,messageParam:[t.label]})};this.createValidationContent(e);}},i.prototype.createValidationContent=function(e){var i=$('<div class="brtc-va-editors-sheet-validation-tooltip-wrapper-dialog">   <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>    <div class="brtc-va-editors-sheet-validation-tooltip-dialog">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e.message)+"</div></div>");e.$target.append(i),e.$target.addClass("brtc-va-editors-sheet-validation-error-dialog"),i.show();},i.prototype.removeValidation=function(t){t.find(".brtc-va-editors-sheet-validation-tooltip-wrapper-dialog").remove(),t.removeClass("brtc-va-editors-sheet-validation-error-dialog");},i.prototype.destroy=function(){this.popupProperty.destroy(),this.$mainControl.dialog("destroy"),this.$mainControl=void 0;},i.prototype.createInput=function(t,e){var i=$('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-input"/>');t.append(i);var o={placeHolder:"Enter value"};e.widgetOption&&(o=$.extend(!0,o,e.widgetOption));var n=e.addClass?e.addClass:"",r=e.addCSS?e.addCSS:"",a=this.popupProperty.createInput(i,o,n,r);return a.setValue=function(t){i.val(t);},a.getValue=function(){return i.val();},a.setDisable=function(){this.jqxInput({disabled:!0});},a.setEnable=function(){this.jqxInput({disabled:!1});},a;},i.prototype.createTextArea=function(t,e){var i=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-textareacontrol"/>'),o=$('<textarea class="brtc-va-editors-sheet-controls-textarea"></textarea>');i.append(o),t.append(i);var n={placeholder:"sepal_length + 1",extraKeys:{"Ctrl-Space":"autocomplete",Tab:!1,"Shift-Tab":!1},autofocus:!1,hintOptions:{list:[]}};e.widgetOption&&(n=$.extend(!0,n,e.widgetOption));var r=e.addClass?e.addClass:" ";i.addClass(r);var a=this.popupProperty.createTextAreaControl(o,n);return a.codeMirror.options.hintOptions.list=this.columnData.slice(),a.codeMirror.setSize("100%",e.widgetOption.height),a;},i.prototype.createDropDownList=function(t,e){var i={source:e&&e.source?e.source:[],selectedIndex:0};e.widgetOption&&(i=$.extend(!0,i,e.widgetOption));var o=e.addClass?e.addClass:"",n=e.addCSS?e.addCSS:"",r=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"/>');t.append(r);var a=this.popupProperty.createDropDownList(r,i,o,n);return a.setValue=function(t){void 0!==t&&this.jqxDropDownList("selectItem",t);},a.getValue=function(){return this.jqxDropDownList("getSelectedItem").value;},a.setDisable=function(){this.jqxDropDownList({disabled:!0});},a.setEnable=function(){this.jqxDropDownList({disabled:!1});},a;},i.prototype.createRadioButton=function(t,e){var i=this,o=e.key,n=e.source,r={groupName:o};e.widgetOption&&(r=$.extend(!0,r,e.widgetOption));var a=e.addClass?e.addClass:"",s=e.addCSS?e.addCSS:"",l=function(){if(e.value&&n.some(function(t){return t.value==e.value;}))return e.value;}(),c={},d={};return n.forEach(function(e){d[o+"."+e.value]=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">'+e.label+"</div>"),t.append(d[o+"."+e.value]),c[o+"."+e.value]=i.popupProperty.createRadioButton(d[o+"."+e.value],r,a,s),c[o+"."+e.value].on("checked",function(t){l=e.value;});}),c.getValue=function(){return l;},c.setValue=function(t){d[o+"."+t].jqxRadioButton("check");},c;},i.prototype.createCheckBox=function(t,e){var i=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-checkbox"/>');t.append(i);var o={width:23,height:27};e&&e.widgetOption&&(o=$.extend(!0,o,e.widgetOption));var n=this.popupProperty.createCheckBox(i,o);return n.on("checked",e.checkedFunc),n.on("unchecked",e.uncheckedFunc),n.setValue=function(t){t?i.jqxCheckBox("check"):i.jqxCheckBox("uncheck");},n.getValue=function(){return i.val();},n;},i.prototype.createColumnList=function(t,e){var i=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-columnlist"/>');t.append(i);var o=this,n={maxRowCount:3,multiple:!0,changed:function changed(){o.bindValidation({mandatory:!0,$target:i,control:a,label:"Column"});}};e&&e.widgetOption&&(n=$.extend(!0,n,e.widgetOption));var r=e.addClass?e.addClass:"",a=this.popupProperty.createColumnList(i,n,r),s=this.popupProperty.getColumnData();return a.setItems(s),a.setValue=function(t){this.setSelectedItems(t),o.bindValidation({mandatory:!0,$target:i,control:a,label:"Column"});},a.getValue=function(){return this.getSelectedItems();},a;},t.VA.Core.Dialogs.PropertiesPanelDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.ScriptEditorDialog.call(this,e,i),this.checkInfo();}e.prototype=Object.create(t.VA.Core.Dialogs.ScriptEditorDialog.prototype),e.prototype.constructor=e,e.prototype.renderInfoArea=function(){this.options.scriptOnly&&!1!==this.options.scriptOnly||(this.renderInputs(this.$infoArea),this.renderOutputs(this.$infoArea));},e.prototype.createInTableAlias=function(e){var i=this,o=this.options.fnUnit.parent(),n=this.FnUnitUtils.getInTable(this.options.fnUnit),r=[];for(var a in n){r.push(o.getFnUnitByOutData(n[a]));}for(var a in r){var s=r[a],l="inputs["+a+"]",c=$('<div class="brtc-va-dialogs-scalaeditor-alias-element">   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">'+l+"</div></div>"),d=s.parent().type,p=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),u=t.VA.Core.Utils.WidgetUtils.createPaletteItem(p,s.func,d);u.find(".brtc-va-views-palette-fnunit-label").text(s.display.label).attr("variable",l),p.attr("value",this.FnUnitUtils.getOutTable(s)[0]),u.addClass("item"),c.append(p),e.append(c),c.find(".brtc-va-views-palette-fnunit").click(function(){var t=$(this).find(".brtc-va-views-palette-fnunit-label").attr("variable"),e=i.codeMirror.getDoc(),o=i.codeMirror.getCursor();e.replaceRange(t,o);});}},e.prototype.createInModelAlias=function(e){var i=this,o=this.options.fnUnit.parent(),n=this.FnUnitUtils.getInModel(this.options.fnUnit),r=[];for(var a in n){r.push(o.getFnUnitByOutData(n[a]));}for(var a in r){var s=r[a],l="models["+a+"]",c=$('<div class="brtc-va-dialogs-scalaeditor-alias-element">   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">'+l+"</div></div>"),d=s.parent().type,p=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),u=t.VA.Core.Utils.WidgetUtils.createPaletteItem(p,s.func,d);u.find(".brtc-va-views-palette-fnunit-label").text(s.display.label).attr("variable",l),p.attr("value",this.FnUnitUtils.getOutModel(s)[0]),u.addClass("item"),c.append(p),e.append(c),c.find(".brtc-va-views-palette-fnunit").click(function(){var t=$(this).find(".brtc-va-views-palette-fnunit-label").attr("variable"),e=i.codeMirror.getDoc(),o=i.codeMirror.getCursor();e.replaceRange(t,o);});}},e.prototype.createInImageAlias=function(e){var i=this,o=this.options.fnUnit.parent(),n=this.FnUnitUtils.getInImage(this.options.fnUnit),r=[];for(var a in n){r.push(o.getFnUnitByOutData(n[a]));}for(var a in r){var s=r[a],l="images["+a+"]",c=$('<div class="brtc-va-dialogs-scalaeditor-alias-element">   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">'+l+"</div></div>"),d=s.parent().type,p=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),u=t.VA.Core.Utils.WidgetUtils.createPaletteItem(p,s.func,d);u.find(".brtc-va-views-palette-fnunit-label").text(s.display.label).attr("variable",l),p.attr("value",this.FnUnitUtils.getOutImage(s)[0]),u.addClass("item"),c.append(p),e.append(c),c.find(".brtc-va-views-palette-fnunit").click(function(){var t=$(this).find(".brtc-va-views-palette-fnunit-label").attr("variable"),e=i.codeMirror.getDoc(),o=i.codeMirror.getCursor();e.replaceRange(t,o);});}},e.prototype.renderEditorArea=function(){this.sendFnunit=$.extend(!0,{},this.options.fnUnit),this.codeMirror=CodeMirror.fromTextArea(this.$editorArea.find("textarea")[0],{mode:this.scriptEditorOptions.mode,theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!1,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{list:this.scriptEditorOptions.additionalHint}}),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror),t.VA.Core.Utils.WidgetUtils.setCodeMirrorMaxLength(this.codeMirror),this.setEditorStatement(this.options.statement),this.codeMirror.setSize("100%","100%"),this.codeMirror.setOption("maxLength",this.scriptEditorOptions.maxLength);},e.prototype.renderInputs=function(t){this.$inputs=$('<div class="brtc-va-dialogs-scalaeditor-alias-in"></div>'),t.append(this.$inputs),this.renderInTableAlias(this.$inputs),this.renderInModelAlias(this.$inputs),this.renderInImageAlias(this.$inputs);},e.prototype.renderInTableAlias=function(t){var e=$('<div class="brtc-va-dialogs-scalaeditor-alias-in-table"></div>');t.append(e);var i=this.addPropertyControl(e,{label:"In Table Variable"});this.createInTableAlias(i),i.perfectScrollbar();},e.prototype.renderInModelAlias=function(t){var e=$('<div class="brtc-va-dialogs-scalaeditor-alias-in-model"></div>');t.append(e);var i=this.addPropertyControl(e,{label:"In Model Variable"});this.createInModelAlias(i),i.perfectScrollbar();},e.prototype.renderInImageAlias=function(t){var e=$('<div class="brtc-va-dialogs-scalaeditor-alias-in-image"></div>');t.append(e);var i=this.addPropertyControl(e,{label:"In Image Variable"});this.createInImageAlias(i),i.perfectScrollbar();},e.prototype.renderOutputs=function(e){var i=this,o=$('<div class="brtc-va-dialogs-scalaeditor-alias-out"></div>');e.append(o),this.$outputsBody=this.addPropertyControl(o,{label:"Outputs"}),this.$outputsBody.perfectScrollbar(),this.$addButton=$('<input type="button" class= "brtc-va-editors-sheet-controls-propertycontrol-addbutton" value="+ Add Output"/>'),o.find(".brtc-va-dialogs-scalaeditor-alias-header").after(this.$addButton),this.$addButton.jqxButton({theme:t.VA.Env.Theme,width:"100%",height:32}),this.$addButton.click(function(){i.createOutTableAlias(i.$outputsBody,!1),i.$outputsBody.perfectScrollbar("update");}),this.createOutput(i.$outputsBody);},e.prototype.createOutput=function(t){var e=this,i=this.FnUnitUtils.getOutputs(this.options.fnUnit);_.forEach(i,function(i,o){var n=e.createOutTableAlias(t,!1,i),r=e.FnUnitUtils.getTypeByTableId(e.options.fnUnit,i);n.find(".alias input").val(o),n.find(".type .brtc-va-dialogs-scalaeditor-alias-body-outtable-type").val(r);}),t.perfectScrollbar();},e.prototype.createOutTableAlias=function(t,e,i){var o=$('<div class="brtc-va-dialogs-contents-statement-lastline-element-wrapper">   <div class="brtc-va-dialogs-contents-statement-lastline-element-script alias"></div>   <div class="brtc-va-dialogs-contents-statement-lastline-element-script-type type"></div></div>');return t.append(o),this.createInput(o.find(".brtc-va-dialogs-contents-statement-lastline-element-script"),"",e,i),this.createDropDownList(o.find(".brtc-va-dialogs-contents-statement-lastline-element-script-type"),"",e,i),o;},e.prototype.createInput=function(t,e,i,o){var n=this,r=$('<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable" tableId="'+o+'">   <input class="brtc-va-dialogs-scalaeditor-alias-body-outtable-input" isMandatory='+i+' />   <div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-remove""></div></div>'),a=r.find("input");t.append(r),a.jqxInput({placeHolder:"Enter alias",height:32,width:"105px",theme:"office"}),a.jqxInput("val",e),""!==a.val()&&null!=a.val()||a.css("border-color","red"),a.focus(),a.on("change",function(){""==$(this).val()?$(this).css("border-color","red"):$(this).css("border-color","#d4d4d4");}),a.keydown(function(t){13==t.keyCode&&n.createOutTableAlias(n.$outputsBody,!1);}),1==i&&""==e&&a.css("border-color","red");var s=r.find(".brtc-va-dialogs-scalaeditor-alias-body-outtable-remove");return s.attr({isMandatory:i}),s.click(function(){var t=$(this).closest(".brtc-va-dialogs-contents-statement-lastline-element-wrapper");t.find(".brtc-va-dialogs-scalaeditor-alias-body-outtable").attr("tableId")&&n.removeSendFnunit(t.attr("tableId")),t.remove(),n.$outputsBody.perfectScrollbar("update");}),a;},e.prototype.removeSendFnunit=function(t){},e.prototype.addPropertyControl=function(t,e){var i=e.label;e.mandatory&&(i='<div style="display:inline-block;">'+i+' <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>');var o=$('<div class="brtc-va-dialogs-scalaeditor-alias-header">'+i+"</div>"),n=$('<div class="brtc-va-dialogs-scalaeditor-alias-body"></div>');return t.append(o).append(n),n;},e.prototype.getTitle=function(){return"Python";},e.prototype.createSendOutputs=function(){},e.prototype.handleOkClicked=function(){if(this.options.scriptOnly||!1===this.options.scriptOnly)this.dialogResult={OK:!0,Cancel:!1,queryStatement:this.codeMirror.getValue()};else{var e=this.$outputsBody.find(".brtc-va-dialogs-contents-statement-lastline-element-wrapper");this.sendFnunit.outputs={},this.sendFnunit.meta={inputs:{type:"table",range:{min:1,max:10}},models:{type:"model",range:{min:1,max:10}},images:{type:"image",range:{min:1,max:10}}};for(var i=0;i<e.length;i++){var o=$(e[i]).find(".brtc-va-dialogs-scalaeditor-alias-body-outtable input").val(),n=$(e[i]).find(".brtc-va-dialogs-scalaeditor-alias-body-outtable-type").val(),r=$(e[i]).find(".brtc-va-dialogs-scalaeditor-alias-body-outtable").attr("tableId");"undefined"!==r&&r||(r=t.VA.Core.Utils.IDGenerator.table.id()),this.sendFnunit.outputs[o]=r,this.sendFnunit.meta[o]={type:n};}this.sendFnunit.param.script=this.codeMirror.getValue(),this.dialogResult={OK:!0,Cancel:!1,param:this.sendFnunit.param,outputs:this.sendFnunit.outputs,meta:this.sendFnunit.meta};}this.$mainControl.dialog("close");},t.VA.Core.Dialogs.PythonEditorDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.ScriptEditorDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.ScriptEditorDialog.prototype),e.prototype.constructor=e,e.prototype.renderInfoArea=function(t,e){var i=this;this.$trueControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">true</div>'),this.$falseControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">false</div>'),this.$infoArea.addClass("rscript"),this.$infoArea.append('<div class="brtc-va-dialogs-controls-propertycontrol-columnlist"/><div class="brtc-va-dialogs-controls-propertycontrol-groupbylist"/><div class="brtc-va-dialogs-controls-propertycontrol-stringasfactors"/><div class="brtc-va-dialogs-controls-propertycontrol-resultlist"/>'),this.$columns=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-columnlist"),this.$groupby=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-groupbylist"),this.$stringasfactors=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-stringasfactors"),this.$resultNames=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-resultlist"),this.addPropertyControl("Columns",function(t){t.append(this.$columns);var e={multiple:!0,maxRowCount:3,sort:"none",showOpener:"button",changed:function changed(t,e){i.selectedColumns=e.items,i.renderValidation();}};i.columnsControl=i.createColumnList(i.$columns,e);},{mandatory:!0}),this.addPropertyControl("Group by",function(t){t.append(this.$groupby);var e={multiple:!0,maxRowCount:3,sort:"none",showOpener:"button",changed:function changed(t,e){i.selectedGroupby=e.items,i.renderValidation();}};i.groupbyControl=i.createColumnList(i.$groupby,e);},{mandatory:!1}),this.addPropertyControl("Strings As Factors",function(t){this.$stringasfactors.append(this.$trueControl).append(this.$falseControl),t.append(this.$stringasfactors),i.createRadioButton(i.$trueControl,{width:"80",groupName:"Group"}),i.createRadioButton(i.$falseControl,{width:"80",groupName:"Group"}),i.$trueControl.on("checked",function(){i.selectedFactors="true";}),i.$falseControl.on("checked",function(){i.selectedFactors="false";});},{mandatory:!1}),this.addPropertyControl("Result Columns",function(t){t.append(this.$resultNames),i.resultColumnsControl=i.createResultNameList(i.$resultNames);},{mandatory:!0}),this.fillControlValues(),this.renderValues();},e.prototype.createResultNameList=function(t){var e=this.options.fnUnit.param["result-names"];if(void 0===e)this.createResultControlLayout(0,!0,t);else if(0===e.length)this.createResultControlLayout(0,!0,t);else for(var i=0;i<e.length;i++){this.createResultControlLayout(i,!0,t);}},e.prototype.createResultControlLayout=function(t,e,i,o){var n=i,r=this,a=!1,s=$('<div class="brtc-va-rcontents-input-container"></div>'),l=n.find(".brtc-va-rcontents-input-container");0!==l.length&&l[t]?($(l[t]).after(s),a=!0):n.append(s);var c,d,p=$('<div class="brtc-va-widget-contents-input-control-container"></div>');s.append(p),e&&(c=$('<div class="brtc-va-widget-contents-input-control-add"></div>'),s.append(c),c.click(function(t){r.handleAddInputControlEvent($(this).closest(".brtc-va-rcontents-input-container"),n);})),(t>0||a)&&(d=$('<div class="brtc-va-widget-contents-input-control-delete"></div>'),s.append(d),d.click(function(t){r.handleDeleteButtonClick($(this).closest(".brtc-va-rcontents-input-container"));})),this.createInputControl(p,o);},e.prototype.handleAddInputControlEvent=function(t,e,i){var o=t.index();this.createResultControlLayout(o,!0,e,i),this.getInputValue(),this.renderValidation();},e.prototype.handleDeleteButtonClick=function(t){t.remove(),this.getInputValue(),this.renderValidation();},e.prototype.createInputControl=function(e,i){var o,n=this;o=$('<input type="text" class="brtc-va-widget-contents-input-control"/>'),e.append(o);var r={theme:t.VA.Env.Theme,height:"25px",width:"100%"};o.jqxInput(r),i||o.jqxInput("focus"),o.keydown(function(t){13==t.keyCode&&(n.handleAddInputControlEvent(o.closest(".brtc-va-rcontents-input-container"),!0),n.getInputValue(),n.renderValidation());}),o.focusout(function(t){n.getInputValue(),n.renderValidation();});},e.prototype.getInputValue=function(){var t,e=this.$resultNames.find(".brtc-va-widget-contents-input-control");t=[];for(var i=0;i<e.length;i++){$(e[i]).val()&&t.push($(e[i]).val());}this.resultColumns=t;},e.prototype.setInputValue=function(t){for(var e=this.$resultNames.find(".brtc-va-widget-contents-input-control"),i=0;i<e.length;i++){$(e[i]).val(t[i]||"");}},e.prototype.fillControlValues=function(){var t=this.options.dataMap&&this.options.fnUnit[IN_DATA][0]?this.options.dataMap[this.options.fnUnit[IN_DATA][0]].columns:[],e=[],i=[];$.each(t,function(t,o){"byte[]"===o.type?e.push(o):i.push(o);}),this.groupbyControl.setItems(i),this.columnsControl.setItems(e);},e.prototype.renderValues=function(){var t=this.options.fnUnit.param;this.columnsControl.setSelectedItems(t.columns[0]);var e=this.options.fnUnit.param.groupby;e?this.groupbyControl.setSelectedItems(e):this.groupbyControl.setSelectedItems([]);var i=this.options.fnUnit.param["strings-as-factors"];""===i?this.$trueControl.jqxRadioButton("check"):("true"===i&&this.$trueControl.jqxRadioButton({checked:!0}),"false"===i&&this.$falseControl.jqxRadioButton({checked:!0}));var o=this.options.fnUnit.param["result-names"];this.setInputValue(o),this.selectedColumns=t.columns[0],this.selectedGroupby=e,this.selectedFactors=i,this.resultColumns=o;},e.prototype.renderValidation=function(){if(0===this.selectedColumns.length?this.createValidationContent(this.$columns.parent(),'"Columns" filed is required.',!0):this.removeValidation(this.$columns.parent().parent()),0===this.resultColumns.length)this.createValidationContent(this.$resultNames,'"Result Columns" filed is required.',!0);else{var e=!0;for(var i in this.resultColumns){if(!t.VA.Core.Utils.InputValidator.isValid.columnNameType(this.resultColumns[i])){e=!1;break;}}e?this.removeValidation(this.$resultNames):this.createValidationContent(this.$resultNames,"If the column name begins with _ or is only a number, it may be a problem in some functions later.",!0);}},e.prototype.removeValidation=function(t){t.find(".brtc-va-editors-sheet-panels-validation-tooltip").remove(),t.find(".brtc-va-editors-sheet-controls-propertycontrol-label").removeClass("brtc-va-editors-sheet-controls-propertycontrol-label-error"),t.find(".brtc-va-editor-sheet-panels-validation-error").removeClass("brtc-va-editor-sheet-panels-validation-error"),t.find(".brtc-va-editors-sheet-panels-validation-tooltip").remove();},e.prototype.createValidationContent=function(t,e,i){var o=t.find(".brtc-va-editors-sheet-panels-validation-tooltip");o&&o.remove();var n=$('<div class="brtc-va-editors-sheet-panels-validation-tooltip"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> '+e+"</div>");t.append(n),t.addClass("brtc-va-editor-sheet-panels-validation-error"),i&&n.css("clear","both");var r=t.find(".brtc-va-editors-sheet-controls-columnselector");r.is("div")&&r.data().renderMissingColumns(),n.show();},e.prototype.addPropertyControl=function(e,i,o){var n=this,r=$('<div class="brtc-va-editors-sheet-controls-propertycontrol">   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents"></div>');return o?(o.mandatory&&(e="<div>"+e+'   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>'),n.$infoArea.append(r)):n.$infoArea.append(r),r.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"left",initContent:function initContent(){"function"==typeof i&&i.call(n,r.find(".brtc-va-editors-sheet-controls-propertycontrol-contents"),o);}}),r.jqxExpander("setHeaderContent",e),r;},e.prototype.createColumnList=function(e,i,o,n){this.wrapControl(e);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(e,r),this.addCssToWrapper(e,n);var a={openerPosition:"bottom",multiple:!0,rowCount:1,maxRowCount:5,expand:!1,sort:"none",sortBy:"name",showOpener:"button",removable:!0,defaultType:"-",changed:function changed(t,e){},added:function added(){},removed:function removed(){}};i&&$.extend(a,i);var s=new t.VA.Core.Editors.Sheet.Controls.ColumnList(e,a);return s.columnSelector.$mainControl.attr("isDialog",!0),s;},e.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');t.wrap(e);},e.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},e.prototype.addCssToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.css(e);}},e.prototype.handleOkClicked=function(){this.dialogResult={OK:!0,Cancel:!1,queryStatement:this.codeMirror.getValue(),columns:this.selectedColumns,groupbys:this.selectedGroupby,factors:this.selectedFactors,resultNames:this.resultColumns},this.$mainControl.dialog("close");},e.prototype.getTitle=function(){return"R";},t.VA.Core.Dialogs.REditorDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=(t.VA.Core.Utils,0),i={addColumnByRefine:{clazz:"AddColumnDialog",validator:"AddColumnValidator"},selectColumn:{clazz:"SelectColumnDialog",validator:"AddColumnValidator"},changeValue:{clazz:"ChangeValueDialog",validator:"AddColumnValidator"},groupBy:{clazz:"GroupByDialog",validator:"AddColumnValidator"},simpleFilter:{clazz:"SimpleFilterDialog",validator:"AddColumnValidator"},advancedFilter:{clazz:"AdvancedFilterDialog",validator:"AddColumnValidator"},sortByRefine:{clazz:"SortDialog",validator:"AddColumnValidator"}};function o(t,i){e=0,this.parentId=t,this.options=i,this.dialogResult={OK:!1,Cancel:!0,param:{functions:$.extend(!0,[],i.fnUnit.param.functions)}},this.dialogResult.param.functions.splice(this.dialogResult.param.functions.length-1,1),this.retrieveParent(),this.createControls(),this.initContents(),this.render();}o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},o.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents brtc-va-dialogs-refine-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />       </div>   </div></div>'),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel");var e=this,i={theme:t.VA.Env.Theme,title:"Refine Data",width:1024,height:800,maxWidth:1024,maxHeight:800,modal:!0,resizable:!1,create:function create(){$(".ui-dialog-titlebar-close",$(this).parent()).hide();},close:function close(){e.$mainControl.dialog("destroy"),"function"==typeof e.options.close&&e.options.close(e.dialogResult);}};this.$mainControl.dialog(i);},o.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.handleOkClicked.bind(this)),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme}),this.$cancelButton.click(this.handleCancelClicked.bind(this));},o.prototype.handleOkClicked=function(){var e=this;if(this.$mainControl.find(".brtc-va-refine-step-warning").length>0){t.VA.Core.Utils.WidgetUtils.openConfirmDialog("The steps you need to check exists. Do you want to continue?",function(t){t.OK&&(e.dialogResult.OK=!0,e.dialogResult.Cancel=!1,e.$mainControl.dialog("close"));});}else this.dialogResult.OK=!0,this.dialogResult.Cancel=!1,this.$mainControl.dialog("close");},o.prototype.handleCancelClicked=function(){this.dialogResult.OK=!1,this.dialogResult.Cancel=!0,this.$mainControl.dialog("close");},o.prototype.createDialogContentsArea=function(i){i.append('<div class="brtc-va-dialogs-refine-toolbar-area">   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-addcolumn">Add Column</div>   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-changevalue">Change Value</div>   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-selectcolumn">Select Column</div>   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-simplefilter">Simple Filter</div>   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-advancedfilter">Advanced Filter</div>   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-sorter">Sorter</div>   <div class="brtc-va-dialogs-refine-toolitem brtc-va-dialogs-refine-toolitem-groupby">Group-by</div></div><div class="brtc-va-dialogs-refine-left-area"></div><div class="brtc-va-dialogs-refine-right-area">   <div class="brtc-va-refine-step-container">       <div class="brtc-va-refine-step-container-header">Applied Steps</div>       <div class="brtc-va-refine-step-container-body">       </div>   </div></div>'),i.find(".brtc-va-refine-step-container-body").perfectScrollbar(),i.find(".brtc-va-refine-step-container-body").perfectScrollbar("update");var o=$('<div class="brtc-va-refine-step-open">   <div class="brtc-va-refine-step-header-open">       <div class="brtc-va-refine-step-label-open" id="open">Open</div>   </div></div>');o.find(".brtc-va-refine-step-header-open").click(function(){n.refreshData(-1);}),i.find(".brtc-va-refine-step-container-body").append(o),i.find(".brtc-va-dialogs-refine-toolitem").jqxButton({theme:t.VA.Env.Theme});var n=this,r=function r(i){e>=20?t.VA.Core.Utils.WidgetUtils.openErrorDialog("The maximum number of steps that can be added to refine data is 20."):i();};i.find(".brtc-va-dialogs-refine-toolitem-addcolumn").on("click",function(){r(function(){n.getSchema(function(e){var i={func:"addColumnByRefine",in:n.getInput(),out:[t.VA.Core.Utils.IDGenerator.table.id()],columns:$.extend(!0,[],e),close:n.dialogClosed.bind(n),force:!1,context:n.options.context};n.openStepDialog(i);});});}),i.find(".brtc-va-dialogs-refine-toolitem-changevalue").on("click",function(){r(function(){n.getSchema(function(e){var i={func:"changeValue",in:n.getInput(),out:[t.VA.Core.Utils.IDGenerator.table.id()],columns:$.extend(!0,[],e),close:n.dialogClosed.bind(n),force:!1,context:n.options.context};n.openStepDialog(i);});});}),i.find(".brtc-va-dialogs-refine-toolitem-selectcolumn").on("click",function(){r(function(){n.getSchema(function(e){var i={func:"selectColumn",in:n.getInput(),out:[t.VA.Core.Utils.IDGenerator.table.id()],columns:$.extend(!0,[],e),close:n.dialogClosed.bind(n),force:!1,context:n.options.context};n.openStepDialog(i);});});}),i.find(".brtc-va-dialogs-refine-toolitem-simplefilter").on("click",function(){r(function(){n.getSchema(function(e){var i={func:"simpleFilter",in:n.getInput(),out:[t.VA.Core.Utils.IDGenerator.table.id()],columns:$.extend(!0,[],e),close:n.dialogClosed.bind(n),force:!1,context:n.options.context};n.openStepDialog(i);});});}),i.find(".brtc-va-dialogs-refine-toolitem-advancedfilter").on("click",function(){r(function(){n.getSchema(function(e){var i={func:"advancedFilter",in:n.getInput(),out:[t.VA.Core.Utils.IDGenerator.table.id()],columns:$.extend(!0,[],e),close:n.dialogClosed.bind(n),force:!1,context:n.options.context};n.openStepDialog(i);});});}),i.find(".brtc-va-dialogs-refine-toolitem-sorter").on("click",function(){r(function(){n.getSchema(function(e){var i={func:"sortByRefine",in:n.getInput(),out:[t.VA.Core.Utils.IDGenerator.table.id()],columns:$.extend(!0,[],e),close:n.dialogClosed.bind(n),force:!1,context:n.options.context};n.openStepDialog(i);});});}),i.find(".brtc-va-dialogs-refine-toolitem-groupby").on("click",function(){r(function(){n.getSchema(function(e){var i={func:"groupBy",in:n.getInput(),out:[t.VA.Core.Utils.IDGenerator.table.id()],columns:$.extend(!0,[],e),close:n.dialogClosed.bind(n),force:!1,context:n.options.context};n.openStepDialog(i);});});});},o.prototype.fillSpreadsheet=function(e,i,o){e.empty();var n=this,r=function r(i){n.$spreadsheet=$('<div class="brtc-va-refine-spreadsheet"></div>'),e.empty(),e.append(n.$spreadsheet);var o={localdata:i.data,datatype:"array",datafields:$.map(i.columns,function(t,e){return{name:"__"+t.name,type:t.type,map:""+e};})},r=$.map(i.columns,function(e,i){var o={text:e.name,datafield:"__"+e.name,width:80};return"date"==e.type?o.cellsformat="yyyy-MM-dd HH:mm:ss:fff":"number"==e.type?(o.cellsformat="d",o.cellsalign="right"):"string"==e.type&&(o.cellsrenderer=function(e,i,o){var n="overflow:hidden; text-overflow:ellipsis; padding-bottom:2px; margin-right: 2px; margin-left: 4px; margin-top: 4px;",r=this.owner.source.records[e][i];if(void 0!==r&&""!==r&&null!==r)return'<div style="'+n+'">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o)+"</div>";var a=this.owner.source._source.localdata[e],s=this.owner.source._source.datafields,l=0;for(var c in s){if(s[c].name===i){l=Number(s[c].map);break;}}return void 0===a[l]?'<div style="'+n+'color: #ff3333">undefined</div>':null===a[l]?'<div align="right" style="'+n+'color: #ff3333">null</div>':""===a[l]?'<div align="right" style="'+n+'"></div>':void 0;}),o;});r.unshift({text:"No",sortable:!1,menu:!1,editable:!1,groupable:!1,draggable:!1,datafield:"",width:40,columntype:"number",renderer:function renderer(t){return'<div class="brtc-va-refine-spreadsheet-rownum-column">'+t+"</div>";},cellsformat:"d",cellsalign:"right",cellclassname:"brtc-va-refine-spreadsheet-rownum-cell",cellsrenderer:function cellsrenderer(t,e,i){return'<div align="right" style="margin:4px;">'+(i+1)+"</div>";}});var a=new $.jqx.dataAdapter(o);n.$spreadsheet.jqxGrid({theme:t.VA.Env.Theme,width:"100%",height:"100%",rowsheight:25,source:a,altrows:!1,filterable:!1,sortable:!1,columnsresize:!0,selectionmode:"multiplecellsextended",columns:r}),n.$spreadsheet.on("columnclick",function(t){"No"==t.args.column.text&&$(this).jqxGrid("autoresizecolumns");});},a=function a(i){n.$spreadsheet=$('<div class="brtc-va-refine-spreadsheet"></div>'),e.empty(),e.append(n.$spreadsheet),n.$spreadsheet.jqxGrid({theme:t.VA.Env.Theme,width:"100%",height:"100%",rowsheight:25,altrows:!1,filterable:!1,sortable:!1,columnsresize:!0,selectionmode:"multiplecellsextended"});};o?this.options.dataProxy.requestDataForce(i,r,a):this.options.dataProxy.requestData(i,r,a);},o.prototype.dialogClosed=function(t){t.OK&&this.callFunction(t.FnUnit,t.force);},o.prototype.addStep=function(t){var e=this,i=!0;$.each(e.dialogResult.param.functions,function(o,n){if(n.fid&&n.fid==t.fid)return e.dialogResult.param.functions[o]=$.extend(!0,{},t),void(i=!1);}),i&&(e.appendFnUnit(t),e.appendStep(t));},o.prototype.callFunction=function(e,i){var o=this;e.parent=function(){var t=$.extend(!0,{},o.options.fnUnit.parent());return t.functions=[e],t.links=[],t;};var n=$.extend(!0,{},e);n.param["additional-query"]=e.param["additional-query"],o.addStep(e);var r=$.inArray(e.fid,$.map(o.dialogResult.param.functions,function(t){return t.fid;})),a={success:function success(t){o.refreshData(r,i),o.renderWarningStep(r+1);},catch:function _catch(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog(e),o.refreshData(r,i),o.renderWarningStep(r);}};Studio.getJobExecutor().launchUnit(n,{},{},a);},o.prototype.getInput=function(){return 0==this.$mainControl.find(".brtc-va-refine-step").length?this.options.fnUnit[IN_DATA]:this.dialogResult.param.functions[this.dialogResult.param.functions.length-1][OUT_DATA];},o.prototype.getSchema=function(t,e){var i=[];return 0==this.$mainControl.find(".brtc-va-refine-step").length?(i=this.options.columns,t(i)):void 0!==e?0==e?(i=this.options.columns,t(i)):this.options.dataProxy.requestSchema(this.dialogResult.param.functions[e-1][OUT_DATA][0],function(e){i=e.columns,t(i);},function(t){}):this.options.dataProxy.requestSchema(this.dialogResult.param.functions[this.dialogResult.param.functions.length-1][OUT_DATA][0],function(e){i=e.columns,t(i);},function(t){}),i;},o.prototype.appendFnUnit=function(t){this.dialogResult.param.functions.push(t);},o.prototype.render=function(){var t=this;if(this.dialogResult.param.functions.length){var e=this.dialogResult.param.functions;$.each(e,function(i,o){t.appendStep(e[i]);});}null!=this.options.stepIdx?this.refreshData(this.options.stepIdx):this.refreshData();},o.prototype.refreshData=function(t,e){var i=this.dialogResult.param.functions,o=this.$mainControl.find(".brtc-va-dialogs-refine-left-area");void 0!==t?0==i.length?this.fillSpreadsheet(o,this.options.fnUnit[IN_DATA][0],e):this.fillSpreadsheet(o,-1!==t?i[t][OUT_DATA][0]:this.options.fnUnit[IN_DATA][0],e):0==i.length?this.fillSpreadsheet(o,this.options.fnUnit[IN_DATA][0],e):i[i.length-1].fid?this.fillSpreadsheet(o,i[i.length-1][OUT_DATA][0],e):this.fillSpreadsheet(o,this.options.fnUnit[IN_DATA][0],e),this.renderSelectionStep(t);},o.prototype.appendStep=function(i){var o=this,n=$('<div class="brtc-va-refine-step">   <div class="brtc-va-refine-step-header">       <div class="brtc-va-refine-step-label">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i.display.label)+'       </div>   </div>   <div class="brtc-va-refine-step-remove-button"></div>   <div class="brtc-va-refine-step-open-button"></div></div>');n.find(".brtc-va-refine-step-header").click(function(){var t=$(this).parents(".brtc-va-refine-step").prevAll(".brtc-va-refine-step").length;o.refreshData(t);}),n.find(".brtc-va-refine-step-open-button").click(function(t){t.stopPropagation();var e=$(this).parents(".brtc-va-refine-step").prevAll(".brtc-va-refine-step").length,i=o.dialogResult.param.functions[e];o.getSchema(function(t){var e={func:i.func,fid:i.fid,in:i[IN_DATA],out:i[OUT_DATA],columns:$.extend(!0,[],t),close:o.dialogClosed.bind(o),param:i.param,force:!0,context:o.options.context};o.openStepDialog(e);},e);}),this.$mainControl.find(".brtc-va-refine-step-container-body").append(n),n.find(".brtc-va-refine-step-remove-button").click(function(t){t.stopPropagation();var e=$(this).parents(".brtc-va-refine-step"),i=e.prevAll(".brtc-va-refine-step").length;o.removeStep(e),o.removeFnUnit(i),o.refreshData(i-1),o.renderWarningStep(i);}),e++;},o.prototype.renderSelectionStep=function(t){var e=this.$mainControl.find(".brtc-va-refine-step-header"),i=this.$mainControl.find(".brtc-va-refine-step-header-open")[0];$(e).removeClass("brtc-va-refine-step-select"),$(i).removeClass("brtc-va-refine-step-select"),void 0!==t?-1===t?$(i).addClass("brtc-va-refine-step-select"):$(e[t]).addClass("brtc-va-refine-step-select"):$(this.$mainControl.find(".brtc-va-refine-step-header")).last().addClass("brtc-va-refine-step-select");},o.prototype.renderWarningStep=function(t){var e=this.$mainControl.find(".brtc-va-refine-step-header");$(e).removeClass("brtc-va-refine-step-warning");for(var i=t;i<e.length;i++){$(e[i]).addClass("brtc-va-refine-step-warning");}},o.prototype.openStepDialog=function(e){var o=i[e.func].clazz;new t.VA.Core.Dialogs.RefineSteps[o](this.$mainControl,e);},o.prototype.removeStep=function(t){t.remove(),e--;},o.prototype.removeFnUnit=function(t){var e=this.dialogResult.param.functions;t!=e.length-1&&(e[t+1][IN_DATA]=$.extend(!0,[],e[t][IN_DATA])),e.splice(t,1);},t.VA.Core.Dialogs.RefineDialog=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=600,this.dialogOptions.height=300;},e.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-rename-name-label">Name</div>   <input type="text" class="brtc-va-dialogs-rename-name-input" maxlength="80" valid-type="renamefileType"></div>'),this.createNameControl(t.find(".brtc-va-dialogs-rename-name-input"));},e.prototype.createNameControl=function(e){this.$nameControl=e.jqxInput({placeHolder:"Enter name",theme:t.VA.Env.Theme}),this.options.name&&this.$nameControl.val(this.options.name),t.VA.Core.Utils.InputValidator.appendValidationCondition(this.$nameControl);},e.prototype.handleOkClicked=function(){var e=this.$nameControl.val().trim();if(0!=e.length){for(var i="",o=0,n=0;n<e.length;n++){"."==(i=e.charAt(n))&&i==e.charAt(n+1)&&(o+=1);}if(o>0)t.VA.Core.Utils.WidgetUtils.openErrorDialog("[.] can not use it repeatedly.");else{if("function"==typeof this.options.validate){var r=this.options.validate(e);if(r)return void t.VA.Core.Utils.WidgetUtils.openErrorDialog(r);}this.dialogResult.newName=e,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);}}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Please enter name.");},t.VA.Core.Dialogs.RenameDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-renamevariable">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel");var e=this,i={theme:t.VA.Env.Theme,title:"Rename",width:400,height:200,modal:!0,resizable:!1,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}};this.$mainControl.dialog(i);},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.handleOkClicked.bind(this)),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme});},e.prototype.createDialogContentsArea=function(e){this.$input=$('<textarea  class="brtc-va-widget-contents-input-control"/>'),e.append(this.$input);var i={verifier:new t.VA.Core.Verifier.CFVariableVerifier(),scrollbarStyle:"null",placeholder:"",lineWrapping:!1,matchBrackets:!1,hintOptions:{list:[]}};this.expressionControl=new t.VA.Core.Editors.Sheet.Controls.TextAreaControl(this.$input,i),this.expressionControl.codeMirror.setSize("100%","26px"),this.expressionControl.codeMirror.on("beforeChange",function(t,e){if("+input"==e.origin&&"object"==typeof e.text&&""==e.text.join(""))return t.doc.setCursor(t.getCursor()),e.cancel();if("paste"==e.origin&&"object"==typeof e.text&&e.text.length>1){var i=e.text.join(" ");return e.update(null,null,[i]);}return null;}),this.expressionControl.codeMirror.setValue(this.options.name),this.expressionControl.codeMirror.markText({line:0,ch:0},{line:0,ch:2},{readOnly:!0,inclusiveLeft:!0,atomic:!0}),this.expressionControl.codeMirror.markText({line:0,ch:this.options.name.length-1},{line:0,ch:this.options.name.length},{readOnly:!0,inclusiveRight:!0,atomic:!0});},e.prototype.handleOkClicked=function(){"${}"!==this.expressionControl.getValue()&&(this.dialogResult={OK:!0,Cancel:!1,name:this.expressionControl.getValue()},this.$mainControl.dialog("close"));},t.VA.Core.Dialogs.RenameVariableDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=700,this.dialogOptions.height=700;},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-repository-browser-contents");var e="Setting Input Path"===this.options.title?"Input Path":"Unload To";e=this.options.pathLabel?this.options.pathLabel:e;t.append('<div class="brtc-va-dialogs-repository-browser-tree"></div><div class="brtc-va-dialogs-repository-browser-file-layout">   <div class="brtc-va-dialogs-repository-browser-file-label">'+e+'</div>   <div class="brtc-va-dialogs-repository-browser-file-input"><textarea></textarea></div></div><div class="brtc-va-dialogs-repository-browser-setting-option">   <div class="brtc-va-dialogs-repository-browser-radio" value="static">Set a static path for users repository.</div>   <div class="brtc-va-dialogs-repository-browser-radio" value="dynamic">Set a dynamic path for users repository.</div></div>'),this.createRepositoryTree(t.find(".brtc-va-dialogs-repository-browser-tree")),this.createSettingOptionControl(t.find(".brtc-va-dialogs-repository-browser-setting-option")),this.createFilePathControl(t.find(".brtc-va-dialogs-repository-browser-file-input > textarea"));},e.prototype.createRepositoryTree=function(e){var i=this;this.repositoryViewer=new t.VA.Core.Controls.RepositoryViewer(e),this.repositoryViewer.$tree.on("select",function(t){var e=i.repositoryViewer.getSelectedPath();i._setFilePath(e);});},e.prototype.createSettingOptionControl=function(e){var i=this,o=e.find(".brtc-va-dialogs-repository-browser-radio");this.$settingOptionGroup=e,o.jqxRadioButton({theme:t.VA.Env.Theme,groupName:"repository-browser-setting-option"}),o.on("checked",function(){var t=i.repositoryViewer.getSelectedPath()||i.options.filePath;i._setFilePath(t);}),this.options.filePath.match(/\$\{\=sys.user\}\//g)?this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=dynamic]").jqxRadioButton("check"):this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=static]").jqxRadioButton("check"),this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").hide();},e.prototype.createFilePathControl=function(e){this.fileName=CodeMirror.fromTextArea(e[0],{mode:"text",theme:"default",indentWithTabs:!1,smartIndent:!1,lineNumbers:!1,matchBrackets:!0,scrollbarStyle:"null",autofocus:!1}),this.fileName.on("beforeChange",function(t,e){var i=e.text.join("").replace(/\n/g,"");return e.update&&e.update(e.from,e.to,[i]),!0;});var i=this;this.fileName.on("change",function(e,o){var n=e.getValue();i.$okButton.jqxButton({disabled:"/shared/"===n||n==="/"+t.VA.Env.Session.userId+"/"||"/shared/upload/"===n||n==="/"+t.VA.Env.Session.userId+"/upload/"||"/${=sys.user}/upload/"===n});}),this.fileName.setSize("100%","100%"),this.options.filePath&&this._setFilePath(this.options.filePath);t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.fileName,{"valid-type":"fileNameType","valid-message-position":"bottom"});},e.prototype._setFilePath=function(e){if(e){var i=e.match(/\/shared\/upload\/[^\/]*/);if(this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").hide(),i)this.fileName.setValue(e),this.fileName.markText({line:0,ch:0},{line:0,ch:15},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"});else if(e.startsWith("/"+t.VA.Env.Session.userId+"/upload/")||e.startsWith("/${=sys.user}/upload/")){this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio").show();var o=0,n=e,r=(n=this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=dynamic]").val()?n.replace(/\/\S*\/upload\//g,"/${=sys.user}/upload/"):n.replace(/\/\$\{\=sys\.user\}\/upload\//g,"/"+t.VA.Env.Session.userId+"/upload/")).split("/");this.fileName.setValue(n);for(var a=0;a<3;a++){o+=r[a].length,o++;}this.fileName.markText({line:0,ch:0},{line:0,ch:o},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"});}else n=e+"/",this.$settingOptionGroup.find(".brtc-va-dialogs-repository-browser-radio[value=dynamic]").val()&&!n.startsWith("/shared/")?n=n.replace(/\/\S*\/upload\//g,"/${=sys.user}/upload/"):n.startsWith("/shared/")||(n=n.replace(/\/\$\{\=sys\.user\}\/upload\//g,"/"+t.VA.Env.Session.userId+"/upload/")),this.fileName.setValue(n),this.fileName.markText({line:0,ch:0},{line:0,ch:n.length+1},{readOnly:!0,inclusiveLeft:!0,css:"color: #b4b4b4"});}},e.prototype.handleOkClicked=function(){var e=this.fileName.getValue().trim();e?this._isAvailablePath(e)?(this.dialogResult.selectedFile=e,t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this)):t.VA.Core.Utils.WidgetUtils.openErrorDialog("Invalid path selected. It should start with '/shared/upload/' or '/{USER_ID}/upload/'."):t.VA.Core.Utils.WidgetUtils.openErrorDialog("At least one file must be selected.");},e.prototype.createDialogButtonBar=function(e){!1!==this.dialogOptions.useButton&&t.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this,e);},e.prototype._isAvailablePath=function(t){for(var e=t.match(/^\/shared\/upload\/[^\/]+$/),i=t.match(/[^\/]+\/upload\/[^\/]*/),o=t.match(/^\/\$\{\=sys\.user\}\/[^\/]+$/),n="",r=0,a=0;a<t.length;a++){"."!=(n=t.charAt(a))&&"@"!=n&&"/"!=n||n==t.charAt(a+1)&&(r+=1);}return r<=0||e||i||o;},t.VA.Core.Dialogs.RepositoryBrowserDialog=e;}.call(this),function(){"use strict";var t=this,e=t.Brightics;function i(t,i){e.VA.Core.Dialogs.ScriptEditorDialog.call(this,t,i);}i.prototype=Object.create(e.VA.Core.Dialogs.ScriptEditorDialog.prototype),i.prototype.constructor=i,i.prototype.renderInfoArea=function(t,e){var i=this;this.$trueControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">true</div>'),this.$falseControl=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-radiobutton">false</div>'),this.$infoArea.addClass("rscript"),this.$infoArea.append('<div class="brtc-va-dialogs-controls-propertycontrol-columnlist"/><input type="text" class="brtc-va-dialogs-controls-propertycontrol-inputdataframe" valid-type="type1"/><div class="brtc-va-dialogs-controls-propertycontrol-partitionbylist"/><div class="brtc-va-dialogs-controls-propertycontrol-outputdataframelist"/><div class="brtc-va-dialogs-controls-propertycontrol-stringasfactors"/><input type="text" class="brtc-va-dialogs-controls-propertycontrol-scripterrorcol" valid-type="type1"/><input type="text" class="brtc-va-dialogs-controls-propertycontrol-flattenerrorcol" valid-type="type1"/>'),this.$columns=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-columnlist"),this.$inputDataframes=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-inputdataframe"),this.$partitionby=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-partitionbylist"),this.$outputDataframes=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-outputdataframelist"),this.$stringasfactors=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-stringasfactors"),this.$scripterrorcol=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-scripterrorcol"),this.$flattenerrorcol=this.$infoArea.find(".brtc-va-dialogs-controls-propertycontrol-flattenerrorcol"),this.addPropertyControl("Columns",function(t){t.append(this.$columns);var e={multiple:!0,maxRowCount:3,sort:"none",showOpener:"button",changed:function changed(t,e){i.selectedColumns=e.items,i.renderValidation();}};i.columnsControl=i.createColumnList(i.$columns,e);},{mandatory:!0}),this.addPropertyControl("Input Dataframe",function(t){t.append(i.$inputDataframes);i.createInput(i.$inputDataframes,{placeHolder:"Input Dataframe"},"brtc-va-editors-sheet-controls-width-12"),i.$inputDataframes.on("change",function(t){i.inputDataframe=$(this).val(),i.renderValidation();});},{mandatory:!0}),this.addPropertyControl("Partition by",function(t){t.append(this.$partitionby);var e={multiple:!0,maxRowCount:3,sort:"none",showOpener:"button",changed:function changed(t,e){i.selectedGroupby=e.items,i.renderValidation();}};i.groupbyControl=i.createColumnList(i.$partitionby,e);},{mandatory:!1}),this.addPropertyControl("Output Dataframe",function(t){t.append(this.$outputDataframes),i.outputDataframe=i.createOutputDataframeList(i.$outputDataframes);},{mandatory:!0}),this.addPropertyControl("Strings As Factors",function(t){this.$stringasfactors.append(this.$trueControl).append(this.$falseControl),t.append(this.$stringasfactors),i.createRadioButton(i.$trueControl,{width:"80",groupName:"Group"}),i.createRadioButton(i.$falseControl,{width:"80",groupName:"Group"}),i.$trueControl.on("checked",function(){i.selectedFactors="true";}),i.$falseControl.on("checked",function(){i.selectedFactors="false";});},{mandatory:!1}),this.addPropertyControl("Script Error Column",function(t){t.append(i.$scripterrorcol);i.createInput(i.$scripterrorcol,{placeHolder:"Script Error Column"},"brtc-va-editors-sheet-controls-width-12"),i.$scripterrorcol.on("change",function(t){i.scriptErrorCol=$(this).val();});},{mandatory:!1}),this.addPropertyControl("Flatten Error Column",function(t){t.append(i.$flattenerrorcol);i.createInput(i.$flattenerrorcol,{placeHolder:"Flatten Error Column"},"brtc-va-editors-sheet-controls-width-12"),i.$flattenerrorcol.on("change",function(t){i.flattenErrorCol=$(this).val();});},{mandatory:!1}),this.fillControlValues(),this.renderValues();},i.prototype.createOutputDataframeList=function(t){var e=this.options.fnUnit.param["output-dataframe"];if(void 0===e)this.createOutputControlLayout(0,!0,t);else if(0===e.length)this.createOutputControlLayout(0,!0,t);else for(var i=0;i<e.length;i++){this.createOutputControlLayout(i,!0,t);}},i.prototype.createOutputControlLayout=function(t,e,i,o){var n=i,r=this,a=!1,s=$('<div class="brtc-va-rcontents-input-container"></div>'),l=n.find(".brtc-va-rcontents-input-container");0!==l.length&&l[t]?($(l[t]).after(s),a=!0):n.append(s);var c,d,p=$('<div class="brtc-va-widget-contents-input-control-container"></div>');s.append(p),e&&(c=$('<div class="brtc-va-widget-contents-input-control-add"></div>'),s.append(c),c.click(function(t){r.handleAddInputControlEvent($(this).closest(".brtc-va-rcontents-input-container"),n),r.$infoArea.perfectScrollbar("update");})),(t>0||a)&&(d=$('<div class="brtc-va-widget-contents-input-control-delete"></div>'),s.append(d),d.click(function(t){r.handleDeleteButtonClick($(this).closest(".brtc-va-rcontents-input-container")),r.$infoArea.perfectScrollbar("update");})),this.createInputControl(p,o);},i.prototype.handleAddInputControlEvent=function(t,e,i){var o=t.index();this.createOutputControlLayout(o,!0,e,i),this.getInputValue(),this.renderValidation();},i.prototype.handleDeleteButtonClick=function(t){t.remove(),this.getInputValue(),this.renderValidation();},i.prototype.createInputControl=function(t,i){var o,n=this;o=$('<input type="text" class="brtc-va-widget-contents-input-control"/>'),t.append(o);var r={theme:e.VA.Env.Theme,height:"25px",width:"100%"};o.jqxInput(r),i||o.jqxInput("focus"),o.keydown(function(t){13==t.keyCode&&(n.handleAddInputControlEvent(o.closest(".brtc-va-rcontents-input-container"),!0),n.getInputValue(),n.renderValidation());}),o.focusout(function(t){n.getInputValue(),n.renderValidation();});},i.prototype.createInput=function(i,o,n,r){this.wrapControl(i);var a="";n&&(a=a.concat(" ",n)),i.attr("type")||i.attr("type","text"),i.attr("maxlength")||i.attr("maxlength","100"),this.addClassToWrapper(i,a),this.addCssToWrapper(i,r);var s={theme:e.VA.Env.Theme,height:"25px",placeHolder:"Enter value"};o&&$.extend(s,o),i.jqxInput(s);var l=i.val();i.focus(function(){l=i.val();}),$("svg").on("mousedown",function(){i.val()!==l&&i.is(":focus")&&i.trigger("change");});var c=this;return i.on("keydown",function(t){clearTimeout(c.keydownTimeout),c.keydownTimeout=setTimeout(function(){i.is(":focus")&&(i.blur(),i.focus());},1e3);}),t.Brightics.VA.Core.Utils.InputValidator.appendValidationCondition(i),i;},i.prototype.getInputValue=function(){var t,e=this.$outputDataframes.find(".brtc-va-widget-contents-input-control");t=[];for(var i=0;i<e.length;i++){$(e[i]).val()&&t.push($(e[i]).val());}this.outputDataframe=t;},i.prototype.setInputValue=function(t){for(var e=this.$outputDataframes.find(".brtc-va-widget-contents-input-control"),i=0;i<e.length;i++){$(e[i]).val(t[i]||"");}},i.prototype.fillControlValues=function(){var t=this.options.dataMap&&this.options.fnUnit[IN_DATA][0]?this.options.dataMap[this.options.fnUnit[IN_DATA][0]].columns:[],e=[];$.each(t,function(t,i){e.push(i);}),this.groupbyControl.setItems(e),this.columnsControl.setItems(e);},i.prototype.renderValues=function(){var t=this.options.fnUnit.param;this.columnsControl.setSelectedItems(t["input-cols"]);var e=this.options.fnUnit.param["partition-by"];e?this.groupbyControl.setSelectedItems(e):this.groupbyControl.setSelectedItems([]);var i=this.options.fnUnit.param["strings-as-factors"];""===i?this.$trueControl.jqxRadioButton("check"):("true"===i&&this.$trueControl.jqxRadioButton({checked:!0}),"false"===i&&this.$falseControl.jqxRadioButton({checked:!0}));var o=this.options.fnUnit.param["output-dataframe"];this.setInputValue(o),this.selectedColumns=t["input-cols"],this.selectedGroupby=e,this.selectedFactors=i,this.outputDataframe=o;var n=this.options.fnUnit.param["input-dataframe"];this.inputDataframe=n,this.$inputDataframes.val(n);var r=this.options.fnUnit.param["script-error-col"];this.scriptErrorCol=r,this.$scripterrorcol.val(r);var a=this.options.fnUnit.param["flatten-error-col"];this.flattenErrorCol=a,this.$flattenerrorcol.val(a);},i.prototype.renderValidation=function(){if(this.selectedColumns&&0!==this.selectedColumns.length?this.removeValidation(this.$columns.parent().parent()):this.createValidationContent(this.$columns.parent(),'"Columns" field is required.',!0),this.inputDataframe?this.removeValidation(this.$inputDataframes.parent()):this.createValidationContent(this.$inputDataframes.parent(),'"Input Dataframe" field is required.',!0),0===this.outputDataframe.length)this.createValidationContent(this.$outputDataframes,'"Output Dataframe" field is required.',!0);else{var t=!0;for(var i in this.outputDataframe){if(!e.VA.Core.Utils.InputValidator.isValid.columnNameType(this.outputDataframe[i])){t=!1;break;}}t?this.removeValidation(this.$outputDataframes):this.createValidationContent(this.$outputDataframes,"If the column name begins with _ or is only a number, it may be a problem in some functions later.",!0);}},i.prototype.removeValidation=function(t){t.find(".brtc-va-editors-sheet-panels-validation-tooltip").remove(),t.find(".brtc-va-editors-sheet-controls-propertycontrol-label").removeClass("brtc-va-editors-sheet-controls-propertycontrol-label-error"),t.find(".brtc-va-editor-sheet-panels-validation-error").removeClass("brtc-va-editor-sheet-panels-validation-error"),t.find(".brtc-va-editors-sheet-panels-validation-tooltip").remove();},i.prototype.createValidationContent=function(t,e,i){var o=t.find(".brtc-va-editors-sheet-panels-validation-tooltip");o&&o.remove();var n=$('<div class="brtc-va-editors-sheet-panels-validation-tooltip"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i> '+e+"</div>");t.append(n),t.addClass("brtc-va-editor-sheet-panels-validation-error"),i&&n.css("clear","both");var r=t.find(".brtc-va-editors-sheet-controls-columnselector");r.is("div")&&r.data().renderMissingColumns(),n.show();},i.prototype.addPropertyControl=function(t,i,o){var n=this,r=$('<div class="brtc-va-editors-sheet-controls-propertycontrol">   <div class="brtc-va-editors-sheet-controls-propertycontrol-label"></div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-contents"></div>');return o?(o.mandatory&&(t="<div>"+t+'   <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>'),n.$infoArea.append(r)):n.$infoArea.append(r),r.jqxExpander({theme:e.VA.Env.Theme,arrowPosition:"left",initContent:function initContent(){"function"==typeof i&&i.call(n,r.find(".brtc-va-editors-sheet-controls-propertycontrol-contents"),o);}}),r.jqxExpander("setHeaderContent",t),r;},i.prototype.createColumnList=function(t,i,o,n){this.wrapControl(t);var r="";o&&(r=r.concat(" ",o)),this.addClassToWrapper(t,r),this.addCssToWrapper(t,n);var a={openerPosition:"bottom",multiple:!0,rowCount:1,maxRowCount:5,expand:!1,sort:"none",sortBy:"name",showOpener:"button",removable:!0,defaultType:"-",changed:function changed(t,e){},added:function added(){},removed:function removed(){}};i&&$.extend(a,i);var s=new e.VA.Core.Editors.Sheet.Controls.ColumnList(t,a);return s.columnSelector.$mainControl.attr("isDialog",!0),s;},i.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');t.wrap(e);},i.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.addClass(e);}},i.prototype.addCssToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-editors-sheet-controls-wrapper");i&&i.css(e);}},i.prototype.handleOkClicked=function(){this.dialogResult={OK:!0,Cancel:!1,queryStatement:this.codeMirror.getValue(),columns:this.selectedColumns,partitionBy:this.selectedGroupby,factors:this.selectedFactors,inputDataframe:this.inputDataframe,outputDataframe:this.outputDataframe,scriptErrorCol:this.scriptErrorCol,flattenErrorCol:this.flattenErrorCol},this.$mainControl.dialog("close");},i.prototype.getTitle=function(){return"R";},e.VA.Core.Dialogs.RScriptEditorDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.analyticsModel=this.options.analyticsModel,this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-run">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$contentsArea=this.$mainControl.find(".brtc-va-dialogs-contents"),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok");var e=this;this.$mainControl.dialog({theme:t.VA.Env.Theme,title:"Variables",width:450,height:630,modal:!0,resizable:!1,draggable:!0,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}});},e.prototype.initContents=function(){this.$mainControl.find(".brtc-va-dialogs-contents").addClass("scrollable"),this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme,disabled:!1}),this.$okButton.click(this.handleOkClicked.bind(this));},e.prototype.createDialogContentsArea=function(e){var i,o=this.analyticsModel.variables||[];this.variableControlList=[];for(var n=0;n<o.length;n++){(i={})[o[n].name]={type:"literal",value:o[n].value||"","variable-type":o[n].type};var r={button:{visible:!1},variable:i,label:o[n].name};this.variableControlList.push(t.VA.Core.Widget.Factory.variableControl(e,r));}e.perfectScrollbar();},e.prototype.createVariablesList=function(){for(var t,e={},i=0;i<this.variableControlList.length;i++){e[(t=this.variableControlList[i].getFormattedValue()).key]=t.value;}return e;},e.prototype.handleOkClicked=function(){this.dialogResult={OK:!0,Cancel:!1,args:this.createVariablesList()},this.$mainControl.dialog("close");},t.VA.Core.Dialogs.RunControlDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.analyticsModel=this.options.analyticsModel,this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-run">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$contentsArea=this.$mainControl.find(".brtc-va-dialogs-contents"),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok");var e=this;this.$mainControl.dialog({theme:t.VA.Env.Theme,title:"Variables",width:450,height:630,modal:!0,resizable:!1,draggable:!0,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}});},e.prototype.initContents=function(){this.$mainControl.find(".brtc-va-dialogs-contents").addClass("scrollable"),this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme,disabled:!1}),this.$okButton.click(this.handleOkClicked.bind(this));},e.prototype.createDialogContentsArea=function(e){var i,o=this.analyticsModel.variables||{};this.variableControlList=[];for(var n=Object.keys(o),r=0;r<n.length;r++){(i={})[n[r]]={value:o[n[r]].value||"","variable-type":o[n[r]].type||"string"};var a={button:{visible:!1},variable:i,label:n[r]};this.variableControlList.push(t.VA.Core.Widget.Factory.variableControl(e,a));}e.perfectScrollbar();},e.prototype.createVariablesList=function(){for(var t,e={},i=0;i<this.variableControlList.length;i++){e[(t=this.variableControlList[i].getFormattedValue()).key]=t.value;}return e;},e.prototype.handleOkClicked=function(){this.dialogResult={OK:!0,Cancel:!1,args:this.createVariablesList()},this.$mainControl.dialog("close");},t.VA.Core.Dialogs.RunDataDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.analyticsModel=this.options.analyticsModel,this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-run">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$contentsArea=this.$mainControl.find(".brtc-va-dialogs-contents"),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok");var e=this;this.$mainControl.dialog({theme:t.VA.Env.Theme,title:"Variables",width:450,height:630,modal:!0,resizable:!1,draggable:!0,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}});},e.prototype.initContents=function(){this.$mainControl.find(".brtc-va-dialogs-contents").addClass("scrollable"),this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme,disabled:!1}),this.$okButton.click(this.handleOkClicked.bind(this));},e.prototype.createDialogContentsArea=function(e){var i,o=this.analyticsModel["gv-def"]||{};this.variableControlList=[],this.duration={};var n={Duration:{type:"literal",value:"5","variable-type":"string"}},r={button:{visible:!1},variable:n};this.duration=t.VA.Core.Widget.Factory.variableControl(e,r);for(var a=0;a<Object.keys(o).length;a++){(i={})[Object.keys(o)[a]]={type:"literal",value:o[Object.keys(o)[a]].value||"","variable-type":o[Object.keys(o)[a]]["variable-type"]||"string"};var s={button:{visible:!1},variable:i};this.variableControlList.push(t.VA.Core.Widget.Factory.variableControl(e,s));}e.perfectScrollbar();},e.prototype.createVariablesList=function(){for(var t,e={},i=0;i<this.variableControlList.length;i++){("array"==(t=this.variableControlList[i].getFormattedValue())["variable-type"]&&1==t.value.length?t.value[0]:t.value)&&(e[t.key]=t.value);}return e;},e.prototype.handleOkClicked=function(){this.dialogResult={OK:!0,Cancel:!1,args:this.createVariablesList(),duration:this.duration.getFormattedValue().value},this.$mainControl.dialog("close");},t.VA.Core.Dialogs.RunRealTimeDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Dialogs.ScriptEditorDialog.call(this,e,i),this.checkInfo();}e.prototype=Object.create(t.VA.Core.Dialogs.ScriptEditorDialog.prototype),e.prototype.constructor=e,e.prototype.renderInfoArea=function(){this.options.scriptOnly&&!1!==this.options.scriptOnly||(this.renderInputs(this.$infoArea),this.renderOutputs(this.$infoArea));},e.prototype.createInTableAlias=function(e){var i=this,o=this.options.fnUnit.parent(),n=this.FnUnitUtils.getInTable(this.options.fnUnit),r=[];for(var a in n){r.push(o.getFnUnitByOutData(n[a]));}for(var a in r){var s=r[a],l="inputs("+a+")",c=$('<div class="brtc-va-dialogs-scalaeditor-alias-element">   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">'+l+"</div></div>"),d=s.parent().type,p=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),u=t.VA.Core.Utils.WidgetUtils.createPaletteItem(p,s.func,d);u.find(".brtc-va-views-palette-fnunit-label").text(s.display.label).attr("variable",l),p.attr("value",this.FnUnitUtils.getOutTable(s)[0]),u.addClass("item"),c.append(p),e.append(c),c.find(".brtc-va-views-palette-fnunit").click(function(){var t=$(this).find(".brtc-va-views-palette-fnunit-label").attr("variable"),e=i.codeMirror.getDoc(),o=i.codeMirror.getCursor();e.replaceRange(t,o);});}},e.prototype.createInModelAlias=function(e){var i=this,o=this.options.fnUnit.parent(),n=this.FnUnitUtils.getInModel(this.options.fnUnit),r=[];for(var a in n){r.push(o.getFnUnitByOutData(n[a]));}for(var a in r){var s=r[a],l="models("+a+")",c=$('<div class="brtc-va-dialogs-scalaeditor-alias-element">   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">'+l+"</div></div>"),d=s.parent().type,p=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),u=t.VA.Core.Utils.WidgetUtils.createPaletteItem(p,s.func,d);u.find(".brtc-va-views-palette-fnunit-label").text(s.display.label).attr("variable",l),p.attr("value",this.FnUnitUtils.getOutModel(s)[0]),u.addClass("item"),c.append(p),e.append(c),c.find(".brtc-va-views-palette-fnunit").click(function(){var t=$(this).find(".brtc-va-views-palette-fnunit-label").attr("variable"),e=i.codeMirror.getDoc(),o=i.codeMirror.getCursor();e.replaceRange(t,o);});}},e.prototype.createInImageAlias=function(e){var i=this,o=this.options.fnUnit.parent(),n=this.FnUnitUtils.getInImage(this.options.fnUnit),r=[];for(var a in n){r.push(o.getFnUnitByOutData(n[a]));}for(var a in r){var s=r[a],l="images("+a+")",c=$('<div class="brtc-va-dialogs-scalaeditor-alias-element">   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">'+l+"</div></div>"),d=s.parent().type,p=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item" isDialog=true></div>'),u=t.VA.Core.Utils.WidgetUtils.createPaletteItem(p,s.func,d);u.find(".brtc-va-views-palette-fnunit-label").text(s.display.label).attr("variable",l),p.attr("value",this.FnUnitUtils.getOutImage(s)[0]),u.addClass("item"),c.append(p),e.append(c),c.find(".brtc-va-views-palette-fnunit").click(function(){var t=$(this).find(".brtc-va-views-palette-fnunit-label").attr("variable"),e=i.codeMirror.getDoc(),o=i.codeMirror.getCursor();e.replaceRange(t,o);});}},e.prototype.renderEditorArea=function(){this.sendFnunit=$.extend(!0,{},this.options.fnUnit),this.codeMirror=CodeMirror.fromTextArea(this.$editorArea.find("textarea")[0],{mode:"text/x-scala",theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!1,extraKeys:{"Ctrl-Space":"autocomplete"},hintOptions:{list:this.scriptEditorOptions.additionalHint}}),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror),t.VA.Core.Utils.WidgetUtils.setCodeMirrorMaxLength(this.codeMirror),this.setEditorStatement(this.options.statement),this.codeMirror.setSize("100%","100%"),this.codeMirror.setOption("maxLength",this.scriptEditorOptions.maxLength);},e.prototype.renderInputs=function(t){this.$inputs=$('<div class="brtc-va-dialogs-scalaeditor-alias-in"></div>'),t.append(this.$inputs),this.renderInTableAlias(this.$inputs),this.renderInModelAlias(this.$inputs);},e.prototype.renderInTableAlias=function(t){var e=$('<div class="brtc-va-dialogs-scalaeditor-alias-in-table"></div>');t.append(e);var i=this.addPropertyControl(e,{label:"In Table Variable"});this.createInTableAlias(i),i.perfectScrollbar();},e.prototype.renderInModelAlias=function(t){var e=$('<div class="brtc-va-dialogs-scalaeditor-alias-in-model"></div>');t.append(e);var i=this.addPropertyControl(e,{label:"In Model Variable"});this.createInModelAlias(i),i.perfectScrollbar();},e.prototype.renderInImageAlias=function(t){var e=$('<div class="brtc-va-dialogs-scalaeditor-alias-in-image"></div>');t.append(e);var i=this.addPropertyControl(e,{label:"In Image Variable"});this.createInImageAlias(i),i.perfectScrollbar();},e.prototype.renderOutputs=function(e){var i=this,o=$('<div class="brtc-va-dialogs-scalaeditor-alias-out"></div>');e.append(o),this.$outputsBody=this.addPropertyControl(o,{label:"Outputs"}),this.$outputsBody.perfectScrollbar(),this.$addButton=$('<input type="button" class= "brtc-va-editors-sheet-controls-propertycontrol-addbutton" value="+ Add Output"/>'),o.find(".brtc-va-dialogs-scalaeditor-alias-header").after(this.$addButton),this.$addButton.jqxButton({theme:t.VA.Env.Theme,width:"100%",height:32}),this.$addButton.click(function(){i.createOutTableAlias(i.$outputsBody,!1),i.$outputsBody.perfectScrollbar("update");}),this.createOutput(i.$outputsBody);},e.prototype.createOutput=function(t){var e=this,i=this.FnUnitUtils.getOutputs(this.options.fnUnit);_.forEach(i,function(i,o){var n=e.createOutTableAlias(t,!1,i),r=e.FnUnitUtils.getTypeByTableId(e.options.fnUnit,i);n.find(".alias input").val(o),n.find(".type .brtc-va-dialogs-scalaeditor-alias-body-outtable-type").val(r);}),t.perfectScrollbar();},e.prototype.createOutTableAlias=function(t,e,i){var o=$('<div class="brtc-va-dialogs-contents-statement-lastline-element-wrapper">   <div class="brtc-va-dialogs-contents-statement-lastline-element-script alias"></div>   <div class="brtc-va-dialogs-contents-statement-lastline-element-script-type type"></div></div>');return t.append(o),this.createInput(o.find(".brtc-va-dialogs-contents-statement-lastline-element-script"),"",e,i),this.createDropDownList(o.find(".brtc-va-dialogs-contents-statement-lastline-element-script-type"),"",e,i),o;},e.prototype.createDropDownList=function(e,i,o,n){var r=$('<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-type" tableId="'+n+'"></div>');e.append(r);var a={theme:t.VA.Env.Theme,width:"100%",height:"20px",source:[{text:"TABLE",value:"table"},{text:"MODEL",value:"model"}],displayMember:"text",selectedIndex:0,valueMember:"value",dropDownHeight:50};r.jqxDropDownList(a);},e.prototype.createInput=function(t,e,i,o){var n=this,r=$('<div class="brtc-va-dialogs-scalaeditor-alias-body-outtable" tableId="'+o+'">   <input class="brtc-va-dialogs-scalaeditor-alias-body-outtable-input" isMandatory='+i+' />   <div class="brtc-va-dialogs-scalaeditor-alias-body-outtable-remove""></div></div>'),a=r.find("input");t.append(r),a.jqxInput({placeHolder:"Enter alias",height:32,width:"108px",theme:"office"}),a.jqxInput("val",e),""!==a.val()&&null!=a.val()||a.css("border-color","red"),a.focus(),a.on("change",function(){""==$(this).val()?$(this).css("border-color","red"):$(this).css("border-color","#d4d4d4");}),a.keydown(function(t){13==t.keyCode&&n.createOutTableAlias(n.$outputsBody,!1);}),1==i&&""==e&&a.css("border-color","red");var s=r.find(".brtc-va-dialogs-scalaeditor-alias-body-outtable-remove");return s.attr({isMandatory:i}),s.click(function(){var t=$(this).closest(".brtc-va-dialogs-contents-statement-lastline-element-wrapper");t.find(".brtc-va-dialogs-scalaeditor-alias-body-outtable").attr("tableId")&&n.removeSendFnunit(t.attr("tableId")),t.remove(),n.$outputsBody.perfectScrollbar("update");}),a;},e.prototype.removeSendFnunit=function(t){},e.prototype.addPropertyControl=function(t,e){var i=e.label;e.mandatory&&(i='<div style="display:inline-block;">'+i+' <div class="brtc-va-editors-sheet-controls-propertycontrol-mandatory">*</div></div>');var o=$('<div class="brtc-va-dialogs-scalaeditor-alias-header">'+i+"</div>"),n=$('<div class="brtc-va-dialogs-scalaeditor-alias-body"></div>');return n.css("height","460px"),t.append(o).append(n),n;},e.prototype.getTitle=function(){return"Scala";},e.prototype.handleOkClicked=function(){if(this.options.scriptOnly||!1===this.options.scriptOnly)this.dialogResult={OK:!0,Cancel:!1,queryStatement:this.codeMirror.getValue()};else{var e=this.$outputsBody.find(".brtc-va-dialogs-contents-statement-lastline-element-wrapper");this.sendFnunit.outputs={},this.sendFnunit.meta={inputs:{type:"table",range:{min:1,max:10}},models:{type:"model",range:{min:1,max:10}}};for(var i=0;i<e.length;i++){var o=$(e[i]).find(".brtc-va-dialogs-scalaeditor-alias-body-outtable input").val(),n=$(e[i]).find(".brtc-va-dialogs-scalaeditor-alias-body-outtable-type").val(),r=$(e[i]).find(".brtc-va-dialogs-scalaeditor-alias-body-outtable").attr("tableId");"undefined"!==r&&r||(r=t.VA.Core.Utils.IDGenerator.table.id()),this.sendFnunit.outputs[o]=r,this.sendFnunit.meta[o]={type:n};}this.sendFnunit.param.script=this.codeMirror.getValue(),this.dialogResult={OK:!0,Cancel:!1,param:this.sendFnunit.param,outputs:this.sendFnunit.outputs,meta:this.sendFnunit.meta};}this.$mainControl.dialog("close");},t.VA.Core.Dialogs.ScalaEditorDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils,i=t.VA.Dialogs.Dialog.prototype;function o(t,e){i.constructor.call(this,t,e);}o.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),o.prototype.constructor=o,o.prototype._initOptions=function(){i._initOptions.call(this),this.dialogOptions.width=1200,this.dialogOptions.height="auto",this.dialogOptions.maxHeight="auto";},o.prototype.createDialogContentsArea=function(e){var i=['<div class="brtc-va-dialogs-schedule-management-header">','   <input type="button" class="brtc-va-dialogs-schedule-management-delete" value="Delete">','   <input type="button" class="brtc-va-dialogs-schedule-management-add" value="Add">',"</div>",'<div class="brtc-va-dialogs-schedule-management-body">',"</div>"].join("\n");e.append(i),this.$addButton=e.find(".brtc-va-dialogs-schedule-management-add"),this.$deleteButton=e.find(".brtc-va-dialogs-schedule-management-delete"),this.$contentBody=e.find(".brtc-va-dialogs-schedule-management-body");var o=new t.VA.EventEmitter();o.on("row-click",function(t){this.openDetailScheduleDialog(t);}.bind(this)),o.on("row-select",function(t){this._refreshButtonStatus("row-select",t);}.bind(this)),o.on("row-unselect",function(t){this._refreshButtonStatus("row-unselect",t);}.bind(this)),this.scheduleListComponent=new t.VA.Core.Components.ScheduleList({$el:this.$contentBody,emitter:o}),this.createDeleteButton(this.$deleteButton),this.createAddButton(this.$addButton),this._refreshScheduleList();},o.prototype.createDialogButtonBar=function(e){t.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this,e),this.$okButton.val("Close"),this.$cancelButton.css({display:"none"});},o.prototype.createAddButton=function(e){e.jqxButton({theme:t.VA.Env.Theme}),e.click(_.debounce(this.openAddScheduleDialog.bind(this)));},o.prototype.openAddScheduleDialog=function(){var e=function(t){t.OK&&this._refreshScheduleList();}.bind(this);new t.VA.Core.Dialogs.AddScheduleDialog(this.$mainControl,{editorInput:this.options.editorInput,close:e,title:"Add Schedule"});},o.prototype.createDeleteButton=function(e){e.jqxButton({theme:t.VA.Env.Theme,disabled:!0}),e.click(_.debounce(this.openDeleteScheduleDialog.bind(this)));},o.prototype.openDeleteScheduleDialog=function(e){var i=function(t){if(t.OK){var e=this.scheduleListComponent.getControl().getSelectedRows(),i=0,o=this;for(var n in e){$.ajax({url:"api/admin/v2/schedules/"+e[n].scheduleId+"/delete",type:"POST",data:JSON.stringify(e[n]),blocking:!0,contentType:"application/json; charset=utf-8"}).done(function(t){t.success&&i++,i===e.length&&o._refreshScheduleList();}).fail(function(t){o._onError(t);});}}}.bind(this);t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Selected item(s) will be permanently deleted and cannot be recovered. Are you sure?",i);},o.prototype.openDetailScheduleDialog=function(e){var i=function(t){t.OK&&this._refreshScheduleList();}.bind(this);new t.VA.Core.Dialogs.DetailScheduleDialog(this.$mainControl,{editorInput:this.options.editorInput,schedule:e,close:i,title:"Schedule Detail"});},o.prototype._refreshScheduleList=function(){var t,e,i;(t={url:"api/admin/v2/schedules",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0},new Promise(function(o,n){$.ajax(t).done(function(t){e&&"function"==typeof e&&e(t),o(t);}).fail(function(t){i&&"function"==typeof i&&i(t),n(t);});})).then(function(t){var e=_.filter(t,function(t){return JSON.parse(t.executeContents).main===this.options.editorInput.getFileId();}.bind(this));e=_.map(e,function(t){var e,i,o=JSON.parse(t.executeContents);for(var n in o.models){e=o.models[n].versionId,i=o.models[n].mid;}return t.versionId=e,t.mid=i,t;}),this.scheduleListComponent.update(e);}.bind(this)).catch(this._onError.bind(this));},o.prototype._refreshButtonStatus=function(t,e){var i=this.scheduleListComponent.getControl().getSelectedRows();this.$deleteButton.jqxButton({disabled:i.length<=0});},o.prototype._onError=function(t){e.WidgetUtils.openBadRequestErrorDialog(t);},o.prototype.destroy=function(){this.scheduleListComponent.destroy(),i.destroy.call(this);},t.VA.Core.Dialogs.ScheduleManagementDialog=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=420,this.dialogOptions.height=200;},e.prototype.createDialogContentsArea=function(t){t.append('<span class="brtc-va-dialogs-body-content-icon" alert="warn"></span><p>Please be cautious with using scripts because they can cause serious problems to your system.</p>'),$(".ui-dialog-titlebar.ui-widget-header").attr("style","border-bottom: none !important;");},e.prototype.getPosition=function(t){},e.prototype.createDialogButtonBar=function(e){var i=$("<div>Do not ask me again</input>");e.append(i),i.jqxCheckBox({theme:"office",width:200,height:25,checked:!1,boxSize:"17px",animationShowDelay:0,animationHideDelay:0}),i.on("click",function(){localStorage.setItem("info.script.show",!$(this).val());}),i.css("float","left"),this.$okButton=$('<input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />'),e.append(this.$okButton),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.handleOkClicked.bind(this));},t.VA.Core.Dialogs.ScriptInfoDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-newfiledialog">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="Send" />       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel");var e=this,i={theme:t.VA.Env.Theme,title:"Select User",width:600,height:470,modal:!0,resizable:!1,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}};this.$mainControl.dialog(i);},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme,disabled:!0}),this.$okButton.click(this.sendModelInformation.bind(this));},e.prototype.createDialogContentsArea=function(e){var i=this;e.append('<div class="brtc-va-dialogs-contents-label-main">Name</div><input type="search" class="brtc-va-dialogs-selectuser-name-input" /><div class="brtc-va-dialogs-selectuser-result-label">User</div><div class="brtc-va-dialogs-selectuser-result-list"></div>'),e.find(".brtc-va-dialogs-selectuser-name-input").jqxInput({placeHolder:"Search User",theme:t.VA.Env.Theme,height:"23px",width:"250px"}),e.find(".brtc-va-dialogs-selectuser-result-list").perfectScrollbar(),e.find(".brtc-va-dialogs-selectuser-name-input").focus(),e.find(".brtc-va-dialogs-selectuser-name-input").keyup(function(t){var e=t.target.value||"";e.trim(),13===t.keyCode&&""!==e&&i.searchUserByName(e);});},e.prototype.searchUserByName=function(t){var e=this;$.ajax({method:"get",url:"api/admin/v2/users?pattern="+encodeURIComponent(t)+"&name=true",blocking:!0}).done(function(t){e.reset(),e.fillUserList(t);}).fail(function(t){});},e.prototype.reset=function(){this.$mainControl.find(".brtc-va-dialogs-selectuser-result-list").empty(),this.selectedUserId="",this.$okButton.jqxButton({disabled:!0});},e.prototype.createUserListHeader=function(){this.$mainControl.find(".brtc-va-dialogs-selectuser-result-list").append('<table class="brtc-va-dialogs-selectuser-table">   <tr class="brtc-va-dialogs-selectuser-table-header">       <th>name</th>       <th>id</th>       <th>email</th>   </tr></table>');},e.prototype.fillUserList=function(t){var e,i,o=this.$mainControl.find(".brtc-va-dialogs-selectuser-result-list");if(0===t.length)o.text("Your search did not match any person.");else{this.createUserListHeader(),i=o.find("table");for(var n=0;n<t.length;n++){e=t[n],i.append($('   <tr class="brtc-va-dialogs-selectuser-table-tr" userId="'+e.id+'">       <td>'+e.name+"</td>       <td>"+e.id+"</td>       <td>"+e.email+"</td>   </tr>"));}this.createUserSelectEvent(i);}},e.prototype.createUserSelectEvent=function(t){for(var e,i=t.find(".brtc-va-dialogs-selectuser-table-tr"),o=this,n=0;n<i.length;n++){$(i[n]).click(function(t){i.removeClass("selected"),(e=$(t.target).closest("tr")).addClass("selected"),o.selectedUserId=e.attr("userId"),o.$okButton.jqxButton({disabled:!1});});}this.openConfirmDialog();},e.prototype.sendModelInformation=function(){var e=this,i={sendId:t.VA.Core.Utils.IDGenerator.send.id(),userId:this.selectedUserId,fromUserId:t.VA.Env.Session.userId,sendMessage:"",projectId:this.options.projectId,fileId:this.options.fileId};$.ajax({url:"api/v1/ws/send/file/create",type:"POST",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",blocking:!0}).done(function(i){t.VA.Core.Utils.WidgetUtils.openInformationDialog("Success.",function(){e.$mainControl.dialog("close");});});},t.VA.Core.Dialogs.SelectUserDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=(t.VA.Core.Utils,t.VA.Dialogs.Dialog.prototype);function i(t,i){e.constructor.call(this,t,i);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype._initOptions=function(){e._initOptions.call(this),this.dialogOptions.width=760,this.dialogOptions.height=440,this.dialogOptions.maxHeight=440,this.dialogOptions.title="Version Detail";},i.prototype.createDialogContentsArea=function(e){var i=['<div class="brtc-va-dialogs-select-version-datail-contents">','  <div class="brtc-va-dialogs-select-version-detail">',"  </div>","</div>"].join("\n");this.$self=$(i),e.append(this.$self),this.$detailBody=this.$self.find(".brtc-va-dialogs-select-version-detail"),this.modelVersionDetail=new t.VA.Core.Components.ModelVersionDetail({$el:this.$detailBody}),this._refreshDetail();},i.prototype.createDialogButtonBar=function(t){e.createDialogButtonBar.call(this,t),this.$okButton.val("Close"),this.$cancelButton.css({display:"none"});},i.prototype.handleOkClicked=function(){e.handleOkClicked.call(this);},i.prototype._refreshDetail=function(){var e=function(t){this.data=t,this.modelVersionDetail.update(t);}.bind(this);Studio.getResourceManager().fetchVersion(this.options.projectId,this.options.fileId,this.options.versionId).then(e).catch(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),this.$mainControl.dialog("close");}.bind(this));},t.VA.Core.Dialogs.SelectVersionDetailDialog=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Dialogs.Dialog.prototype;function i(t,i){e.constructor.call(this,t,i),this.onSelect=i.onSelect,this.emitter=i.emitter;}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype._initOptions=function(){e._initOptions.call(this),this.dialogOptions.title="Version List",this.dialogOptions.width=1e3,this.dialogOptions.height="auto",this.dialogOptions.maxHeight="auto";},i.prototype.createDialogContentsArea=function(i){var o=['<div class="brtc-va-dialogs-select-version-list-contents">','  <div class="brtc-va-dialogs-select-version-list-body">',"  </div>","</div>"].join("\n");this.$self=$(o),i.append(this.$self),this.$contentBody=i.find(".brtc-va-dialogs-select-version-list-body");var n=new t.VA.EventEmitter();n.on("select",function(t){this.dialogResult.data=t,e.handleOkClicked.call(this);}.bind(this)),this.modelVersionListComponent=new t.VA.Core.Components.ModelVersionListSelectable({$el:this.$contentBody,emitter:n,projectId:this.options.projectId,fileId:this.options.fileId});},i.prototype.createDialogButtonBar=function(t){e.createDialogButtonBar.call(this,t),this.$okButton.val("Close"),this.$cancelButton.css({display:"none"});},t.VA.Core.Dialogs.SelectVersionDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel");var e=this,i={theme:t.VA.Env.Theme,title:"Set Properties",width:1024,height:600,maxWidth:1024,maxHeight:600,modal:!0,resizable:!1,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}};this.$mainControl.dialog(i);},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this.$okButton.jqxButton({theme:t.VA.Env.Theme}),this.$okButton.click(this.performFinish.bind(this)),this.$cancelButton.jqxButton({theme:t.VA.Env.Theme});},e.prototype.createDialogContentsArea=function(e){var i=this;this.$columnGrid=$('<div class="brtc-va-dialog-spreadsheet style="width:98%; height:95%;"></div>'),e.append(this.$columnGrid);var o=function o(t,e,_o5,n){var r=!1,a=i.$columnGrid.jqxGrid("getselectedrowindexes");if(a.length>0&&"column"!=e)for(var s in a){t==a[s]&&(r=!0);}return r;};this.$columnGrid.jqxGrid({theme:t.VA.Env.Theme,width:"calc(100% - 2px)",height:"99%",rowsheight:25,filterable:!1,showfiltercolumnbackground:!1,showfiltermenuitems:!0,autoshowfiltericon:!0,altrows:!1,sortable:!0,editable:!0,showsortcolumnbackground:!1,columnsresize:!0,selectionmode:"checkbox",columns:[{text:"Column",datafield:"column",width:"80",cellbeginedit:o},{text:"analyzer",datafield:"analyzer",width:"80",cellbeginedit:o,columntype:"textbox"},{text:"boost",datafield:"boost",width:"80",cellbeginedit:o,columntype:"numberinput",cellsalign:"right",initeditor:function initeditor(t,e,i){i.jqxNumberInput({decimalDigits:0});}},{text:"coerce",datafield:"coerce",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"copyto",datafield:"copyto",width:"80",cellbeginedit:o},{text:"docvalues",datafield:"docvalues",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"dynamic",datafield:"dynamic",width:"80",columntype:"dropdownlist",cellbeginedit:o,initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"enabled",datafield:"enabled",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"fielddata",datafield:"fielddata",width:"80",cellbeginedit:o},{text:"format",datafield:"format",width:"80",cellbeginedit:o},{text:"geohash",datafield:"geohash",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"geohashPrefix",datafield:"geohashprefix",width:"100",columntype:"dropdownlist",cellbeginedit:o,initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"geohashPrecision",datafield:"geohashprecision",width:"100",cellbeginedit:o,columntype:"numberinput",cellsalign:"right",initeditor:function initeditor(t,e,i){i.jqxNumberInput({decimalDigits:0});}},{text:"ignoreAbove",datafield:"ignoreabove",width:"80",cellbeginedit:o,columntype:"numberinput",cellsalign:"right",initeditor:function initeditor(t,e,i){i.jqxNumberInput({decimalDigits:0});}},{ext:"ignoreMalformed",datafield:"ignoremalformed",width:"100",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"includeInAll",datafield:"includeinall",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"index",datafield:"index",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","no","not_analyzed","analyzed"]});}},{text:"indexOptions",datafield:"indexoptions",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","docs","freqs","positions","offsets"]});}},{text:"latLon",datafield:"latlon",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"fields",datafield:"fields",width:"80",cellbeginedit:o},{text:"normsEnabled",datafield:"normsenabled",width:"100",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"normsLoading",datafield:"normsloading",width:"100"},{text:"nullValue",datafield:"nullvalue",width:"80",cellbeginedit:o},{text:"positionIncrementGap",datafield:"positionincrementgap",width:"130",cellbeginedit:o,columntype:"numberinput",cellsalign:"right",initeditor:function initeditor(t,e,i){i.jqxNumberInput({decimalDigits:0});}},{text:"properties",datafield:"properties",width:"80",cellbeginedit:o},{text:"searchanalyzer",datafield:"searchanalyzer",width:"100",cellbeginedit:o},{text:"similarity",datafield:"similarity",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","TF","IDF","BM25"]});}},{text:"store",datafield:"store",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","True","False"]});}},{text:"termvector",datafield:"termvector",width:"80",cellbeginedit:o,columntype:"dropdownlist",initeditor:function initeditor(t,e,i,o,n,r){i.jqxDropDownList({source:["","no","yes","with_positions","with_offsets","with_positions_offsets"]});}}]});var n=[];for(var r in this.options.columns){var a={};for(var s in a.column=this.options.columns[r].name,this.options.fnUnit.param["properties-colums"]){this.options.columns[r].name==this.options.fnUnit.param["properties-colums"][s]&&(a.analyzer=this.options.fnUnit.param["properties-analyzer"][s],a.boost=this.options.fnUnit.param["properties-boost"][s],a.coerce=this.options.fnUnit.param["properties-coerce"][s],a.copyto=this.options.fnUnit.param["properties-copy-to"][s],a.docvalues=this.options.fnUnit.param["properties-doc-values"][s],a.dynamic=this.options.fnUnit.param["properties-dynamic"][s],a.enabled=this.options.fnUnit.param["properties-enabled"][s],a.fielddata=this.options.fnUnit.param["properties-fielddata"][s],a.format=this.options.fnUnit.param["properties-format"][s],a.geohash=this.options.fnUnit.param["properties-geohash"][s],a.geohashprefix=this.options.fnUnit.param["properties-geohash-prefix"][s],a.geohashprecision=this.options.fnUnit.param["properties-geohash-precision"][s],a.ignoreabove=this.options.fnUnit.param["properties-ignore-above"][s],a.ignoremalformed=this.options.fnUnit.param["properties-ignore-malformed"][s],a.includeinall=this.options.fnUnit.param["properties-include-in-all"][s],a.index=this.options.fnUnit.param["properties-index"][s],a.indexoptions=this.options.fnUnit.param["properties-index-options"][s],a.latlon=this.options.fnUnit.param["properties-lat-lon"][s],a.fields=this.options.fnUnit.param["properties-fields"][s],a.normsenabled=this.options.fnUnit.param["properties-norms-enabled"][s],a.normsloading=this.options.fnUnit.param["properties-norms-loading"][s],a.nullvalue=this.options.fnUnit.param["properties-null-value"][s],a.positionincrementgap=this.options.fnUnit.param["properties-position-increment-gap"][s],a.properties=this.options.fnUnit.param["properties-properties"][s],a.searchanalyzer=this.options.fnUnit.param["properties-search-analyzer"][s],a.similarity=this.options.fnUnit.param["properties-similarity"][s],a.store=this.options.fnUnit.param["properties-store"][s],a.termvector=this.options.fnUnit.param["properties-term-vector"][s],i.$columnGrid.jqxGrid("selectrow",parseInt(r)));}n.push(a);}var l={localdata:n,datafields:[{name:"column",type:"string"},{name:"analyzer",type:"string"},{name:"boost",type:"string"},{name:"coerce",type:"string"},{name:"copyto",type:"string"},{name:"docvalues",type:"string"},{name:"dynamic",type:"string"},{name:"enabled",type:"string"},{name:"fielddata",type:"string"},{name:"format",type:"string"},{name:"geohash",type:"string"},{name:"geohashprefix",type:"string"},{name:"geohashprecision",type:"string"},{name:"ignoreabove",type:"string"},{name:"ignoreMalformed",type:"string"},{name:"includeinall",type:"string"},{name:"index",type:"string"},{name:"indexoptions",type:"string"},{name:"latlon",type:"string"},{name:"fields",type:"string"},{name:"normsenabled",type:"string"},{name:"normsloading",type:"string"},{name:"nullvalue",type:"string"},{name:"positionincrementgap",type:"string"},{name:"properties",type:"string"},{name:"searchanalyzer",type:"string"},{name:"similarity",type:"string"},{name:"store",type:"string"}],datatype:"array"},c=new $.jqx.dataAdapter(l);i.$columnGrid.jqxGrid("source",c);},e.prototype.performFinish=function(){var e={fnUnit:this.options.fnUnit,ref:{param:{}}},i=this.$columnGrid.jqxGrid("getselectedrowindexes");for(var o in e.ref.param["properties-colums"]=[],e.ref.param["properties-analyzer"]=[],e.ref.param["properties-boost"]=[],e.ref.param["properties-coerce"]=[],e.ref.param["properties-copy-to"]=[],e.ref.param["properties-doc-values"]=[],e.ref.param["properties-dynamic"]=[],e.ref.param["properties-enabled"]=[],e.ref.param["properties-fielddata"]=[],e.ref.param["properties-format"]=[],e.ref.param["properties-geohash"]=[],e.ref.param["properties-geohash-prefix"]=[],e.ref.param["properties-geohash-precision"]=[],e.ref.param["properties-ignore-above"]=[],e.ref.param["properties-ignore-malformed"]=[],e.ref.param["properties-include-in-all"]=[],e.ref.param["properties-index"]=[],e.ref.param["properties-index-options"]=[],e.ref.param["properties-lat-lon"]=[],e.ref.param["properties-fields"]=[],e.ref.param["properties-norms-enabled"]=[],e.ref.param["properties-norms-loading"]=[],e.ref.param["properties-null-value"]=[],e.ref.param["properties-position-increment-gap"]=[],e.ref.param["properties-properties"]=[],e.ref.param["properties-search-analyzer"]=[],e.ref.param["properties-similarity"]=[],e.ref.param["properties-store"]=[],e.ref.param["properties-term-vector"]=[],i){var n=this.$columnGrid.jqxGrid("getrowdata",i[o]);e.ref.param["properties-colums"].push(n.column),n.analyzer?e.ref.param["properties-analyzer"].push(n.analyzer):e.ref.param["properties-analyzer"].push(""),n.boost?e.ref.param["properties-boost"].push(n.boost):e.ref.param["properties-boost"].push(""),n.coerce?e.ref.param["properties-coerce"].push(n.coerce):e.ref.param["properties-coerce"].push(""),n.copyto?e.ref.param["properties-copy-to"].push(n.copyto):e.ref.param["properties-copy-to"].push(""),n.docvalues?e.ref.param["properties-doc-values"].push(n.docvalues):e.ref.param["properties-doc-values"].push(""),n.dynamic?e.ref.param["properties-dynamic"].push(n.dynamic):e.ref.param["properties-dynamic"].push(""),n.enabled?e.ref.param["properties-enabled"].push(n.enabled):e.ref.param["properties-enabled"].push(""),n.fielddata?e.ref.param["properties-fielddata"].push(n.fielddata):e.ref.param["properties-fielddata"].push(""),n.format?e.ref.param["properties-format"].push(n.format):e.ref.param["properties-format"].push(""),n.geohash?e.ref.param["properties-geohash"].push(n.geohash):e.ref.param["properties-geohash"].push(""),n.geohashprefix?e.ref.param["properties-geohash-prefix"].push(n.geohashprefix):e.ref.param["properties-geohash-prefix"].push(""),n.geohashprecision?e.ref.param["properties-geohash-precision"].push(n.geohashprecision):e.ref.param["properties-geohash-precision"].push(""),n.ignoreabove?e.ref.param["properties-ignore-above"].push(n.ignoreabove):e.ref.param["properties-ignore-above"].push(""),n.ignoremalformed?e.ref.param["properties-ignore-malformed"].push(n.ignoremalformed):e.ref.param["properties-ignore-malformed"].push(""),n.includeinall?e.ref.param["properties-include-in-all"].push(n.includeinall):e.ref.param["properties-include-in-all"].push(""),n.index?e.ref.param["properties-index"].push(n.index):e.ref.param["properties-index"].push(""),n.indexoptions?e.ref.param["properties-index-options"].push(n.indexoptions):e.ref.param["properties-index-options"].push(""),n.latlon?e.ref.param["properties-lat-lon"].push(n.latlon):e.ref.param["properties-lat-lon"].push(""),n.fields?e.ref.param["properties-fields"].push(n.fields):e.ref.param["properties-fields"].push(""),n.normsenabled?e.ref.param["properties-norms-enabled"].push(n.normsenabled):e.ref.param["properties-norms-enabled"].push(""),n.normsloading?e.ref.param["properties-norms-loading"].push(n.normsloading):e.ref.param["properties-norms-loading"].push(""),n.nullvalue?e.ref.param["properties-null-value"].push(n.nullvalue):e.ref.param["properties-null-value"].push(""),n.positionincrementgap?e.ref.param["properties-position-increment-gap"].push(n.positionincrementgap):e.ref.param["properties-position-increment-gap"].push(""),n.properties?e.ref.param["properties-properties"].push(n.properties):e.ref.param["properties-properties"].push(""),n.searchanalyzer?e.ref.param["properties-search-analyzer"].push(n.searchanalyzer):e.ref.param["properties-search-analyzer"].push(""),n.similarity?e.ref.param["properties-similarity"].push(n.similarity):e.ref.param["properties-similarity"].push(""),n.store?e.ref.param["properties-store"].push(n.store):e.ref.param["properties-store"].push(""),n.termvector?e.ref.param["properties-term-vector"].push(n.termvector):e.ref.param["properties-term-vector"].push("");}var r=new t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this,e);this.dialogResult={OK:!0,Cancel:!1,command:r},this.$mainControl.dialog("close");},t.VA.Core.Dialogs.SetPropertiesDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=(t.VA.Core.Utils,{MSG_PANEL_EMPTY:"Select configuration element in the tree to edit its settings",MSG_MENU_EMPTY:"Nothing to show"});var i=Object.keys(t.VA.Setting.Registry);function o(e,i){t.VA.SettingStorage.TEMP={},this.settingPanelList=[],t.VA.Dialogs.Dialog.call(this,e,i);}o.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),o.prototype.constructor=o,o.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=780,this.dialogOptions.height=500;},o.prototype.createDialogContentsArea=function(t){t.addClass("setting");var e=$('<div class="brtc-va-dialogs-menu setting"/><div class="brtc-va-dialogs-content setting"/>');t.append(e),this.createSplitter(t),this.createMenuArea(t.find(".brtc-va-dialogs-menu")),this.createContentArea(t.find(".brtc-va-dialogs-content"));},o.prototype.createSplitter=function(t){t.jqxSplitter({width:null,height:null,resizable:!1,splitBarSize:3,panels:[{size:200,min:200},{min:300}]});},o.prototype.createMenuArea=function(t){var e=$('<div class ="brtc-va-dialogs-menu-filter"/><div class ="brtc-va-dialogs-menu-tree"/>');t.append(e),this.createFilterControl(t.find(".brtc-va-dialogs-menu-filter")),this.createTreeControl(t.find(".brtc-va-dialogs-menu-tree"));},o.prototype.createTreeControl=function(i){var o=this._generateJSONObject();o&&o.length>0?(o[0].selected=!0,i.removeClass("brtc-va-dialogs-center"),this.settingMenu=i.jqxTree({theme:t.VA.Env.Theme,width:200,source:o})):(this.settingMenu=null,i.addClass("brtc-va-dialogs-center"),i.jqxTree({theme:t.VA.Env.Theme,source:[{label:e.MSG_MENU_EMPTY,disabled:!0}]}));},o.prototype.createFilterControl=function(e){var i=this,o=$('<input type="search" class="brtc-va-views-palette-filter-input searchinput"/>');e.append(o),o.jqxInput({height:29,theme:t.VA.Env.Theme,placeHolder:"Search Item"});var n=function n(t){var e=t.target.value.toLowerCase();i.filterArray=i.getMatchedList(e.trim()),i.filterSelectItem=!0,i.createTreeControl(i.$mainControl.find(".brtc-va-dialogs-menu-tree")),i.settingMenu&&i.settingMenu.jqxTree("selectItem",null),i.createContentArea(i.$mainControl.find(".brtc-va-dialogs-content"));};o.keyup(function(t){n(t);}),o.on("search",function(t){n(t);});},o.prototype.getMatchedList=function(e){return e&&""!==e?$.grep(i,function(i){return t.VA.Setting.Registry[i].Label.toLowerCase().indexOf(e.toLowerCase())>-1;}):null;},o.prototype._generateJSONObject=function(e){var o=this,n=[],r=i.filter(function(i){return e?i.startsWith(e+t.VA.Setting.CONST.KEY_DELIMITER)&&!i.replace(e+".","").includes("."):!i.includes(t.VA.Setting.CONST.KEY_DELIMITER);});if(r&&r.length>0){var a={};r.forEach(function(e){var i=t.VA.Setting.Registry,r=i[e].Label,s=i[e].Key;r&&s&&(a={id:s,label:r,items:o._generateJSONObject(s)},o.filterArray?($.inArray(s,o.filterArray)>-1||a.items.length>0)&&(o.filterSelectItem&&(a.selected=!0,o.filterSelectItem=!1),a.expanded=!0,n.push(a)):n.push(a));});}return n;},o.prototype.createContentArea=function(t){var i=$('<div class = "brtc-va-dialogs-content-info setting"></div><div class = "brtc-va-dialogs-content-panel setting"></div>'),o=function o(){t.addClass("brtc-va-dialogs-center"),t.text(e.MSG_PANEL_EMPTY),i.remove();},n=function n(){t.removeClass("brtc-va-dialogs-center"),t.text(""),t.append(i);};if(this.settingMenu){var r=this,a=r.settingMenu.jqxTree("getSelectedItem");a?(n(),r._attachSettingPanel(t,a)):o(),this.settingMenu.on("select",function(e){if(r.settingMenu){t.text().length>0&&n();var i=e.args,o=r.settingMenu.jqxTree("getItem",i.element);r._attachSettingPanel(t,o);}});}else o();},o.prototype._attachSettingPanel=function(e,i){var o=this._getTreeParent(i,t.VA.Setting.Registry);e.find(".brtc-va-dialogs-content-info").text(o.label);var n=e.find(".brtc-va-dialogs-content-panel");n.empty();var r=new t.VA.Setting.Registry[i.id](n);n.perfectScrollbar(),this.settingPanelList.push(r);},o.prototype._getTreeParent=function(t,e){var i={label:t.label,objStr:t.id};if(t.parentElement){var o=this._getTreeParent(this.settingMenu.jqxTree("getItem",t.parentElement));i.label=o.label+" > "+i.label;}return i;},o.prototype.handleOkClicked=function(){for(var e in this.settingPanelList){this.settingPanelList[e].save();}Studio.getPreference().preferenceChanged(Object.keys(t.VA.SettingStorage.TEMP||{})),t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);},t.VA.Core.Dialogs.SettingDialog=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.parentId=e,this.options=i,this.dialogResult={OK:!1,Cancel:!0,command:new t.VA.Core.CompoundCommand(this,{})},this.analyticsModel=this.options.fnUnit.parent(),this.mainModel=this.analyticsModel.getMainModel(),this.options.param.index>-1&&this.options.fnUnit.param.functions&&(this.options.fnUnit=this.options.fnUnit.param.functions[this.options.param.index]),this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){var e=this;this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-setting-variable-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents" style="display: initial">       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$mainControl.dialog({theme:t.VA.Env.Theme,modal:!1,width:200,resizable:!1,showAnimationDuration:50,position:{my:"left top",at:"right top",of:this.$mainControl.parent()},open:function open(){e.$mainControl.parent().find(".ui-dialog-titlebar.ui-widget-header").remove();},close:function close(){$(window).off("mousedown",e.closeHandler),$(window).off("resize",e.closeHandler),"function"==typeof e.options.close&&e.options.close(e.dialogResult);}}),this.closeHandler=function(t){0===e.$mainControl.has(t.target).length&&e.$mainControl.dialog("isOpen")&&e.$mainControl.dialog("close");},$(window).on("mousedown",this.closeHandler),$(window).on("resize",this.closeHandler);},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents"));},e.prototype.createDialogContentsArea=function(t){this.$contents=$('<div class="brtc-va-setting-variable-dialogs-contents">   <div class="brtc-va-global-variable-set element-wrapper">       <div class="element">Set as variable</div>       <hr>   </div>   <div class="brtc-va-global-variable-list element-wrapper">   </div>   <div class="brtc-va-global-variable-unset element-wrapper">       <hr>       <div class="element">Unset variable</div>   </div></div>'),t.append(this.$contents),this.createGlobalVariableList(),this.bindSetGlobalVariable(),this.bindUnsetGlobalVariable();},e.prototype.createGlobalVariableList=function(){var e=this;this.variableList=Object.keys(this.getModel().variables);var i=this.getModel().getVariable(this.options.fnUnit.fid,this.options.param.key);for(var o in i?this.$contents.find(".brtc-va-global-variable-set").hide():this.$contents.find(".brtc-va-global-variable-unset").hide(),this.variableList){var n=$('<div class="element">Set to '+this.variableList[o]+"</div>");n.attr("title",this.variableList[o]),n.attr("type",this.getModel().variables[this.variableList[o]]["variable-type"]),this.$contents.find(".brtc-va-global-variable-list.element-wrapper").append(n),n.data("variable",this.variableList[o]),i===this.variableList[o]&&n.addClass("set"),n.click(function(){e.dialogResult.OK=!0,e.dialogResult.command.add(new t.VA.Core.Editors.Diagram.Commands.BindVariableCommand(e,{fid:e.options.fnUnit.fid,paramKey:e.options.param.key,variable:$(this).data("variable"),subFnUnitIndex:e.options.param.index})),e.$mainControl.dialog("close");});}this.$contents.find(".brtc-va-global-variable-list").perfectScrollbar();},e.prototype.bindSetGlobalVariable=function(){var e=this;this.$contents.find(".brtc-va-global-variable-set").click(function(){var i=e.options.param.label.toLowerCase().replace(/ /gi,"_"),o=e.options.param.type.toLowerCase().indexOf("array")>-1,n={name:i,type:o?"array[string]":"string",value:o?[""]:""},r=new t.VA.Core.Editors.Diagram.Commands.AddVariableDefCommand(e,{name:n.name,ref:{type:n.type,value:n.value},variable:n});t.VA.Core.Utils.WidgetUtils.getModelEditorRef(e.$parent).getCommandManager().execute(r),e.dialogResult.OK=!0,e.dialogResult.command.add(new t.VA.Core.Editors.Diagram.Commands.BindVariableCommand(e,{fid:e.options.fnUnit.fid,paramKey:e.options.param.key,variable:n.name,subFnUnitIndex:e.options.param.index})),e.$mainControl.dialog("close");});},e.prototype.bindUnsetGlobalVariable=function(){var e=this,i=this.getModel().getVariable(this.options.fnUnit.fid,this.options.param.key);this.$contents.find(".brtc-va-global-variable-unset").click(function(){e.dialogResult.command.add(new t.VA.Core.Editors.Diagram.Commands.UnBindVariableCommand(e,{fid:e.options.fnUnit.fid,paramKey:e.options.param.key,variable:i,subFnUnitIndex:e.options.param.index})),"function"==typeof e.options.remove&&e.options.remove(e.dialogResult),e.$mainControl.dialog("close");});},e.prototype.getModel=function(){return this.mainModel;},t.VA.Core.Dialogs.SettingVariableDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e={dataSelectorWrapper:["brtc-va-editors-sheet-controls-dataselector-contents-wrapper","brtc-va-dialogs-setvariable-dataselector-wrapper"].join(" "),dataSelectorItem:"brtc-va-editors-sheet-controls-dataselector-item"};function i(e,i){t.VA.Core.Dialogs.FnUnitDialog.call(this,e,i);}i.prototype=Object.create(t.VA.Core.Dialogs.FnUnitDialog.prototype),i.prototype.constructor=i,i.prototype.getTitle=function(){return this.options.title;},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-style-minus-40">    <div class="brtc-va-dialogs-body">        <div class="brtc-va-dialogs-title brtc-style-display-flex brtc-style-height-45px brtc-style-padding-right-20"></div>        <div class="brtc-va-dialogs-contents brtc-va-dialogs-fnunit brtc-style-display-flex"></div>        <div class="brtc-va-dialogs-buttonbar brtc-style-padding-right-30"></div>    </div></div>'),this.$titleArea=this.$mainControl.find(".brtc-va-dialogs-title");},i.prototype.createDialogContentsArea=function(t){t.append('<div class="brtc-va-dialogs-control-function-body brtc-style-height-full brtc-style-flex-1"></div>'),this.$headerArea=t.find(".brtc-va-dialogs-control-function-header"),this.$bodyArea=t.find(".brtc-va-dialogs-control-function-body"),this.createVariablesControl(),this.$bodyArea.perfectScrollbar({suppressScrollX:!0});},i.prototype.createDataControl=function(){this.$dataArea.append('<div class="brtc-va-dialogs-data-selector"></div><div class="brtc-va-dialogs-data-viewer"></div>');t.VA.Env.Theme,this.createIndataSource();var e=this.$dataArea.find(".brtc-va-dialogs-data-selector"),i=this.createDataSelector();e.append(i),i.perfectScrollbar();},i.prototype.createDataSelectorItem=function(i,o,n){var r=$(crel("div",{class:e.dataSelectorItem})),a=t.VA.Core.Utils.WidgetUtils.createPaletteItem(r,n,"data");return a.find(".brtc-va-views-palette-fnunit-label").text(i),a.addClass("item"),a.attr("tid",o),r.addClass("brtc-va-editors-setvalue-indata-item"),r;},i.prototype.createDataSelectorSource=function(){var t=Studio.getEditorContainer().getActiveModelEditor().getActiveModel();return this.options.fnUnit.inData.map(function(e){var i=t.getFnUnitByOutTable(e);return{label:i.display.label,tid:e,type:i.func};});},i.prototype.createDataSelector=function(){var t=this,i=$(crel("div",{class:e.dataSelectorWrapper})),o=this.createDataSelectorSource(),n="",r=function r(e,i){n&&n.removeClass("selected"),(n=e).addClass("selected"),t.renderData(i);},a=o.map(function(e){var i=t.createDataSelectorItem(e.label,e.tid,e.type);return i.click(function(){r(i,e.tid);}),i;});return i.append(a),a.length>0&&r(a[0]),i;},i.prototype.renderData=function(e){var i=this.$dataArea.find(".brtc-va-dialogs-data-viewer");i.empty();var o=$.extend(!0,{},this.options.fnUnit);this.changeTableInfo(o,e);var n=Studio.getEditorContainer().getActiveModelEditor().getActiveModel().mid,r=new t.VA.Core.Editors.Sheet.DataProxy(i,n);r.reset(),this.panelFactory=Studio.getEditorContainer().getActiveModelEditor().getPanelFactory(),this.inPanel=this.panelFactory.createInDataPanel(i,{width:"100%",height:"100%",modelEditor:Studio.getEditorContainer().getActiveModelEditor(),fnUnit:o,resizable:!0,dataProxy:r});},i.prototype.changeTableInfo=function(t,e){t.inData=[e],t.display.sheet.in.partial[0].panel.length>0&&(t.display.sheet.in.partial[0].panel[0].tableIndexes=[0]);},i.prototype.createIndataSource=function(){var t=Studio.getEditorContainer().getActiveModelEditor().getActiveModel();return this.options.fnUnit.inData.map(function(e){var i=t.getFnUnitByOutTable(e);return{label:i.display.label,tid:e,type:i.func};});},i.prototype.createVariablesControl=function(){var e=this;this.variableControl=new t.VA.Core.Views.SetVariable(this.$bodyArea,{width:"100%",height:"100%",fnUnit:this.options.fnUnit,editor:this.options.editor,onAdd:function onAdd(t){e.onAdd(t);},onRemove:function onRemove(t){e.onRemove(t);},onChange:function onChange(t,i){e.onChange(t,i);}}),this.variableControl.$mainControl.find("input").addClass("brtc-style-minus-20").addClass("brtc-style-padding-right-20"),this.variableControl.$mainControl.find(".brtc-va-tools-sidebar-variable-list").addClass("brtc-style-padding-right-20");var i=[];for(var o in this.options.fnUnit.param.variables){var n=this.options.fnUnit.param.variables[o];i.push({type:n.type,name:n.name,value:"cell"===n.type?n.param:n.param.value});}this.variableControl.renderValues(i);},i.prototype.onRemove=function(t){var e=t.name,i=this.options.fnUnit.param.variables,o=[];for(var n in i){i[n].name!==e&&o.push(i[n]);}this.options.fnUnit.param.variables=o;},i.prototype.onChange=function(t,e){var i=t.name,o=this.options.fnUnit.param.variables,n=[];for(var r in this.updateMode(e),o){o[r].name!==i?n.push(o[r]):n.push(e);}this.options.fnUnit.param.variables=n;},i.prototype.onAdd=function(t){var e=$.extend(!0,{},t),i=$.extend(!0,[],this.options.fnUnit.param.variables);this.updateMode(e),i.push(e),this.options.fnUnit.param.variables=i;},i.prototype.refresh=function(){this.$mainControl.find(".brtc-va-dialogs-index-item-container").empty(),this.$mainControl.perfectScrollbar("update");},i.prototype.handleOkClicked=function(){this.dialogResult={OK:!0,Cancel:!1,results:{fnUnit:this.options.fnUnit}},this.$mainControl.dialog("close");},i.prototype.handleCancelClicked=function(){this.dialogResult={OK:!1,Cancel:!0},this.$mainControl.dialog("close");},i.prototype.updateMode=function(t){"cell"===t.type?t.mode="cell":t.mode="value";},t.VA.Core.Dialogs.SetValueSettingDialog=i;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(e,i){t.VA.Core.Dialogs.ScriptEditorDialog.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Dialogs.ScriptEditorDialog.prototype),e.prototype.createLayout=function(){this.$contentArea=this.$mainControl.find(".brtc-va-dialogs-contents");var e=!!this.options.scriptOnly&&this.options.scriptOnly;this.$editorArea=$('<div class="brtc-va-dialogs-contents-statement sql" script-only="'+e+'">   <textarea></textarea>   <div class="brtc-va-dialogs-contents-statement-error">Up to '+t.VA.Core.Utils.CommonUtils.numberToStringWithComma(this.scriptEditorOptions.maxLength)+" characters can be entered.</div></div>"),this.$errorArea=this.$editorArea.find(".brtc-va-dialogs-contents-statement-error"),this.$infoArea=$('<div class="brtc-va-dialogs-contents-info sql" script-only="'+e+'">'),this.$resultArea=$('<div class="brtc-va-dialogs-result sql">'),this.$contentArea.append(this.$editorArea).append(this.$infoArea).append(this.$resultArea),this.$infoArea.perfectScrollbar();var i=this;this.$mainControl.on("resized",function(t){i.$infoArea.perfectScrollbar("update");});},e.prototype.renderInfoArea=function(t,e){this.renderTableAlias(this.$infoArea);},e.prototype.createInTableAlias=function(e){var i=this,o=this.FnUnitUtils.getParent(this.options.fnUnit),n=this.FnUnitUtils.getInTable(this.options.fnUnit),r=[];for(var a in n){r.push(o.getFnUnitByOutTable(n[a]));}for(var a in this.tableAlias=[],r){var s=r[a],l="#{DF("+a+")}";this.tableAlias.push("#{DF("+a+")}");var c=$('<div class="brtc-va-dialogs-scalaeditor-alias-element">   <div class="brtc-va-dialogs-scalaeditor-alias-element-label">'+l+"</div></div>"),d=s.parent().type,p=$('<div class="brtc-va-editors-sheet-controls-dataselector-item single brtc-va-dialogs-scalaeditor-alias-element-item"></div>'),u=t.VA.Core.Utils.WidgetUtils.createPaletteItem(p,s.func,d);u.find(".brtc-va-views-palette-fnunit-label").text(s.display.label).attr("variable",l),p.attr("value",this.FnUnitUtils.getOutTable(this.options.fnUnit)),u.addClass("item"),c.append(p),e.append(c),c.find(".brtc-va-views-palette-fnunit").click(function(){var t=$(this).find(".brtc-va-views-palette-fnunit-label").attr("variable");i.codeMirror.setValue(i.codeMirror.getValue()+" "+t),i.selectMarker=i.codeMirror.markText({line:0,ch:0},{line:0,ch:7},{readOnly:!0,inclusiveLeft:!0,atomic:!0});});}},e.prototype.renderTableAlias=function(t){var e=$('<div class="brtc-va-dialogs-reditor-alias-in"></div>');t.append(e);var i=this.addPropertyControl("In Table Variable",e);this.createInTableAlias(i);},e.prototype.addPropertyControl=function(t,e){var i=$('<div class="brtc-va-dialogs-reditor-alias-header">'+t+"</div>"),o=$('<div class="brtc-va-dialogs-reditor-alias-body"></div>');return e.append(i).append(o),o;},e.prototype.setEditorStatement=function(t){this.codeMirror.setValue(t),this.codeMirror.clearHistory(),this.selectMarker=this.codeMirror.markText({line:0,ch:0},{line:0,ch:7},{readOnly:!0,inclusiveLeft:!0,atomic:!0});},e.prototype.renderEditorArea=function(){var e=this;this.codeMirror=CodeMirror.fromTextArea(this.$editorArea.find("textarea")[0],{mode:this.scriptEditorOptions.mode,theme:"default",indentWithTabs:!0,smartIndent:!0,lineNumbers:!0,matchBrackets:!0,autofocus:!1,extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-Enter":function CtrlEnter(){e.tempFnUnit=$.extend(!0,{},e.options.fnUnit),"queryExecutorPython"==e.tempFnUnit.func?(e.tempFnUnit.outputs.out_table=e.FnUnitUtils.getOutputs(e.options.fnUnit).out_table,e.tempFnUnit.param.query=e.codeMirror.getValue()):(e.tempFnUnit.outData=e.FnUnitUtils.getOutputs(e.options.fnUnit),e.tempFnUnit.param["full-query"]=e.codeMirror.getValue(),e.tempFnUnit.param["alias-names"]=e.tableAlias),Studio.getJobExecutor().launchUnit(e.tempFnUnit,{},{},{catch:function _catch(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);},success:function success(t){e.refreshResult();}});}},hintOptions:{list:this.scriptEditorOptions.additionalHint}}),t.VA.Core.Utils.WidgetUtils.adjustCodeMirrorEsc(this.codeMirror),t.VA.Core.Utils.WidgetUtils.setCodeMirrorMaxLength(this.codeMirror),this.setEditorStatement(this.options.statement),this.codeMirror.setSize("100%","100%"),this.codeMirror.setOption("maxLength",this.scriptEditorOptions.maxLength);},e.prototype.renderResultArea=function(){var t=this,e=$('<div class="brtc-va-dialogs-result-sql"></div><div class="brtc-va-dialogs-sql-test-button-area brtc-s-style-dialogs-sql-test-button-area">   <input type="button" class="brtc-va-dialogs-sql-test-button brtc-s-style-dialogs-sql-test-button" value="Run" /></div>');e.find(".brtc-va-dialogs-sql-test-button").click(function(){t.handleTestClicked();}),this.$contentArea.find(".brtc-va-dialogs-result").append(e);},e.prototype.handleTestClicked=function(){var e=this;e.tempFnUnit=$.extend(!0,{},e.options.fnUnit),"queryExecutorPython"==e.tempFnUnit.func?(e.tempFnUnit.outputs.out_table=e.FnUnitUtils.getOutputs(e.options.fnUnit).out_table,e.tempFnUnit.param.query=e.codeMirror.getValue()):(e.tempFnUnit.outData=e.FnUnitUtils.getOutputs(e.options.fnUnit),e.tempFnUnit.param["full-query"]=e.codeMirror.getValue(),e.tempFnUnit.param["alias-names"]=e.tableAlias),Studio.getJobExecutor().launchUnit(e.tempFnUnit,{},{},{catch:function _catch(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);},success:function success(t){e.refreshResult(t);}});},e.prototype.refreshResult=function(){var e=this;for(var i in this.$resultPanelContent){this.$resultPanelContent[i].remove();}this.$resultPanelContent={},this.$resultSheet={};var o=this.FnUnitUtils.getOutputs(e.tempFnUnit);o="queryExecutorPython"==e.tempFnUnit.func?o.out_table:o[0],t.VA.Core.DataQueryTemplate.queryData(this.options.fnUnit.parent().mid,o,0,1e3,function(t,i){e.createResultPanelContent(o,t);},function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);},!1);},e.prototype.createResultPanelContent=function(t,e){this.$resultPanelContent[t]=$('<div class="brtc-va-dialogs-result-sql-panel-content"></div>'),this.$mainControl.find(".brtc-va-dialogs-result-sql").append(this.$resultPanelContent[t]),this.createResultContents(this.$resultPanelContent[t],t,e);},e.prototype.createResultContents=function(t,e,i){this.$resultSheet[e]=$('<div>   <div class="brtc-va-dialogs-result-sql-panel-content-chart-area"></div></div>'),t.append(this.$resultSheet[e]),this.createResultGrid(e,i);},e.prototype.createResultGrid=function(e,i){var o=$('<div class="brtc-va-dialogs-result-sql-panel-spreadsheet"></div>');this.$resultSheet[e].find(".brtc-va-dialogs-result-sql-panel-content-chart-area").append(o);var n={localdata:i.data,datatype:"array",datafields:$.map(i.columns,function(t,e){return{name:"__"+t.name,type:t.type,map:""+e};})},r=$.map(i.columns,function(e,i){var o={text:e.name,datafield:"__"+e.name,width:80};return"date"==e.type?o.cellsformat="yyyy-MM-dd HH:mm:ss:fff":"number"==e.type?(o.cellsformat="d",o.cellsalign="right"):"string"==e.type&&(o.cellsrenderer=function(e,i,o){var n="overflow:hidden; text-overflow:ellipsis; padding-bottom:2px; margin-right: 2px; margin-left: 4px; margin-top: 4px;",r=this.owner.source.records[e][i];if(void 0!==r&&""!==r&&null!==r)return'<div style="'+n+'">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o)+"</div>";var a=this.owner.source._source.localdata[e],s=this.owner.source._source.datafields,l=0;for(var c in s){if(s[c].name===i){l=Number(s[c].map);break;}}return void 0===a[l]?'<div style="'+n+'color: #ff3333">undefined</div>':null===a[l]?'<div align="right" style="'+n+'color: #ff3333">null</div>':""===a[l]?'<div align="right" style="'+n+'"></div>':void 0;}),o;});r.unshift({text:"No",sortable:!1,menu:!1,editable:!1,groupable:!1,draggable:!1,datafield:"",width:40,columntype:"number",renderer:function renderer(t){return'<div class="brtc-va-refine-spreadsheet-rownum-column">'+t+"</div>";},cellsformat:"d",cellsalign:"right",cellclassname:"brtc-va-refine-spreadsheet-rownum-cell",cellsrenderer:function cellsrenderer(t,e,i){return'<div align="right" style="margin:4px;">'+(i+1)+"</div>";}});var a=new $.jqx.dataAdapter(n);o.jqxGrid({theme:t.VA.Env.Theme,width:"100%",height:"200",rowsheight:25,source:a,altrows:!1,filterable:!1,sortable:!1,columnsresize:!0,selectionmode:"multiplecellsextended",columns:r}),o.on("columnclick",function(t){"No"==t.args.column.text&&$(this).jqxGrid("autoresizecolumns");});},e.prototype.getTitle=function(){return"SQL";},t.VA.Core.Dialogs.SqlEditorDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0,param:{}},this.retrieveParent(),this.createControls(),this.renderValue();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents brtc-va-dialogs-subfunction-contents">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />           <input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />       </div>   </div></div>'),this.$parent.append(this.$mainControl),this.$okButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-ok"),this.$cancelButton=this.$mainControl.find(".brtc-va-dialogs-buttonbar-cancel");var e=this,i={theme:t.VA.Env.Theme,title:"Auto Sub Function",width:"800",height:"800",maxWidth:"800",maxHeight:"800",modal:!0,resizable:!1,create:function create(){e.createDialogContentsArea(e.$mainControl.find(".brtc-va-dialogs-contents")),e.$okButton.jqxButton({theme:t.VA.Env.Theme}),e.$okButton.click(e.handleOkClicked.bind(e)),e.$cancelButton.jqxButton({theme:t.VA.Env.Theme}),e.$cancelButton.click(e.handleCancelClicked.bind(e));},close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult);}};this.$mainControl.dialog(i),$(".ui-dialog-titlebar-close",$(this).parent()).hide();},e.prototype.renderValue=function(){for(var t=0;t<this.options.subFunction.length;t++){var e=this.options.subFunction[t];this.controlsArray[e]={};for(var i=0;i<this.options.subFunctionParam[e].length;i++){var o=this.options.subFunctionParam[e][i].name,n=this.options.subFunctionParam[e][i].controltype,r=this.options.subFunctionParam[e][i].opt;if("dropdown"===n){var a=this.options.fnUnit.param[e][o];if(this.controlsArray[e][o]=[],this.$elements[e][o].empty(),this.createControlArrRow(!0,e,o,r),void 0!==a)for(var s=0;s<a.length;s++){s>=1&&this.createControlArrRow(!1,e,o,r),this.controlsArray[e][o][s].val(a[s]);}}else{a="";for(var s in this.options.fnUnit.param[e][o]){a=a+this.options.fnUnit.param[e][o][s]+",";}this.$elements[e][o].val(a.substring(0,a.length-1)||"");}}}},e.prototype.handleOkClicked=function(){this.dialogResult.param=this.getSubFunctionProperty(),this.dialogResult.OK=!0,this.dialogResult.Cancel=!1,this.$mainControl.dialog("close");},e.prototype.handleCancelClicked=function(){this.dialogResult.OK=!1,this.dialogResult.Cancel=!0,this.$mainControl.dialog("close");},e.prototype.getSubFunctionProperty=function(){for(var t={},e=0;e<this.options.subFunction.length;e++){var i=this.options.subFunction[e];t[i]={};for(var o=0;o<this.options.subFunctionParam[i].length;o++){var n=this.options.subFunctionParam[i][o].name;if("dropdown"===this.options.subFunctionParam[i][o].controltype)for(var r=0;r<this.controlsArray[i][n].length;r++){""!=this.controlsArray[i][n][r].val()&&(t[i][n]=[],t[i][n].push(this.controlsArray[i][n][r].val()));}else if(""!=this.$elements[i][n].val()){t[i][n]=[];var a=this.$elements[i][n].val().split(",");for(var r in a){t[i][n].push(a[r].trim());}}}}return t;},e.prototype.createDialogContentsArea=function(e){e.append('<div class="brtc-va-dialogs-subfunction-toolbar-area"></div><div class="brtc-va-dialogs-subfunction-properties-area"></div>');for(var i=e.find(".brtc-va-dialogs-subfunction-toolbar-area"),o=0;o<this.options.subFunction.length;o++){var n=this.options.subFunction[o];i.append('<div class="brtc-va-dialogs-subfunction-toolitem" function-name="'+n+'">'+n+"</div>"),i.find('.brtc-va-dialogs-subfunction-toolitem[function-name="'+n+'"]').on("click",function(){e.find(".brtc-va-dialogs-area").css("display","none"),e.find('.brtc-va-dialogs-area[function-name="'+event.target.innerText+'"]').css("display","block");});}e.find(".brtc-va-dialogs-subfunction-toolitem").jqxButton({theme:t.VA.Env.Theme}),this.$elements={},this.controls={},this.controlsArray={},this.$propertiesArea=e.find(".brtc-va-dialogs-subfunction-properties-area");for(o=0;o<this.options.subFunction.length;o++){this.createSubFunctionContentsArea(this.$propertiesArea,this.options.subFunction[o]);}},e.prototype.createSubFunctionContentsArea=function(t,e){t.append('<div class="brtc-va-dialogs-area" function-name="'+e+'"/>'),this.$contentsArea=t.find(".brtc-va-dialogs-area"),this.$elements[e]={},this.controls[e]={};for(var i=0;i<this.options.subFunctionParam[e].length;i++){var o=this.options.subFunctionParam[e][i].label,n=this.options.subFunctionParam[e][i].name,r=this.options.subFunctionParam[e][i].placeholder;"dropdown"===this.options.subFunctionParam[e][i].controltype?this.createDropDownControl(this.$contentsArea,e,o,n,{placeHolder:r}):this.createInputControl(this.$contentsArea,e,o,n,{placeHolder:r});}this.$contentsArea.css("display","none");},e.prototype.createInputControl=function(t,e,i,o,n){var r=this;r.$elements[e][o]=$('<input type="text" class="brtc-va-dialogs-controls-propertycontrol-input"/>'),r.addPropertyControl(i,function(t){t.append(r.$elements[e][o]),r.controls[e][o]=r.createInput(r.$elements[e][o],n);});},e.prototype.addPropertyControl=function(e,i){var o=this,n=$('<div class="brtc-va-dialogs-controls-propertycontrol">   <div class="brtc-va-dialogs-controls-propertycontrol-label"></div>   <div class="brtc-va-dialogs-controls-propertycontrol-contents"></div>');return this.$contentsArea.append(n),n.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"left",initContent:function initContent(){"function"==typeof i&&i.call(o,n.find(".brtc-va-dialogs-controls-propertycontrol-contents"));}}),n.jqxExpander("setHeaderContent",e),n;},e.prototype.createInput=function(e,i){var o={theme:t.VA.Env.Theme,height:"25px",placeHolder:"Enter value"};return i&&$.extend(o,i),e.jqxInput(o),e;},e.prototype.createControlArrRow=function(t,e,i,o){var n=this,r=$('<div class="brtc-va-dialogs-property-row-container brtc-va-dialog-property-row-content"></div>'),a=$('<div class="brtc-va-dialogs-controls-propertycontrol-combobox"/>'),s=$('<div class="brtc-va-dialogs-property-row-content-add-button"></div>'),l=$('<div class="brtc-va-dialogs-property-row-content-remove-button"></div>');r.append(a),t?r.append(s):r.append(l),this.controlsArray[e][i].push(a),this.$elements[e][i].append(r),n.controls[e][i]=n.createDropDownList(a,o,"",{width:"90%",float:"left"}),l.click(function(){var t=l.parents(".brtc-va-dialogs-property-row-content"),o=t.prevAll().length;n.controlsArray[e][i].splice(o,1),t.remove();}),l.hover(function(){$(this).css({color:"#86BFA0"});},function(){$(this).css({color:""});}),s.click(function(){n.createControlArrRow(!1,e,i,o);}),s.hover(function(){$(this).css({color:"#429366"});},function(){$(this).css({color:""});});},e.prototype.createDropDownControl=function(t,e,i,o){var n=this;n.$elements[e][o]=$('<div class="brtc-va-dialogs-controls-propertycontrol-combobox"/>'),n.addPropertyControl(i,function(t){t.append(n.$elements[e][o]);});},e.prototype.createDropDownList=function(e,i){var o={theme:t.VA.Env.Theme,width:"100%",height:"25px"};return i&&$.extend(o,i),e.jqxDropDownList(o),e;},t.VA.Core.Dialogs.SubFunctionDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-selectfnunit">   <div class="brtc-va-dialogs-body brtc-va-dialogs-selectfnunit">       <div class="brtc-va-dialogs-contents brtc-va-dialogs-selectfnunit" />   </div></div>'),this.$parent.append(this.$mainControl);var e=this,i={theme:t.VA.Env.Theme,title:"Select Function",width:800,height:700,modal:!0,resizable:!1,close:function close(){"function"==typeof e.options.close&&e.options.close(_.merge({position:e.options.position},e.dialogResult)),e.$mainControl.dialog("destroy"),e.$mainControl.remove();}};this.$mainControl.dialog(i),$("button.ui-dialog-titlebar-close",$(this).parent()).css("right","1em");},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this._removeTitleBottomBorder();},e.prototype._removeTitleBottomBorder=function(){this.$mainControl.prev().css("border","initial");},e.prototype.createDialogContentsArea=function(e){var _this20=this;e.append('<ul>     <li>Search Functions</li>     <li>All Functions</li></ul><div class="brtc-va-dialogs-selectfnunit-tab-searchfunctions"></div><div class="brtc-va-dialogs-selectfnunit-tab-allfunctions brtc-style-border-box"></div>'),this.tabControl=t.VA.Core.Widget.Factory.tabControl(e);var i=e.find(".brtc-va-dialogs-selectfnunit-tab-searchfunctions"),o=e.find(".brtc-va-dialogs-selectfnunit-tab-allfunctions"),n={url:"api/va/v2/studio/palette/"+this.options.modelType,type:"GET",contentType:"application/json; charset=utf-8",blocking:!0};new Promise(function(t){return Promise.resolve($.ajax(n)).then(function(e){return t(e);}).catch(function(){return t([]);});}).then(function(t){_this20.createRecommendArea(i,t),_this20.createKeywordArea(i,t),_this20.createSearchResultArea(i,t),_this20.createAllFunctionsArea(o,t),o.perfectScrollbar(),_this20.$mainControl.find(".brtc-va-dialogs-selectfnunit-keyword-input").jqxInput("focus");});},e.prototype.createAllFunctionsArea=function(e,i){var o=this;this.palette=new t.VA.Core.Views.Palette(e,{width:"100%",height:"100%",draggable:!1,modelType:o.options.modelType}),e.find(".brtc-va-views-palette-filter-input").hide(),e.find(".brtc-va-views-palette-navigator").bind("DOMNodeInserted",function(e){$(e.target).hasClass("brtc-va-views-palette-fnunit-list")&&$(e.target).find(".brtc-va-views-palette-fnunit").click(function(e){var i=$(this);var n=t.VA.Core.Utils.WidgetUtils.getData(i,"func");o.dialogResult={OK:!0,Cancel:!1,func:n},o.$mainControl.dialog("close");});}),e.find(".brtc-va-views-palette").css("height","100%"),e.find(".brtc-va-views-palette-navigator-wrapper").css({height:"calc(100% - 40px)",position:"relative"}).perfectScrollbar();},e.prototype.createRecommendArea=function(e,i){var o=this,n=$('<div class="brtc-va-dialogs-selectfnunit-recommend">   <div class="sub-title">Recommendations&nbsp<Strong id="count">0</Strong></div>   <div class="brtc-va-dialogs-selectfnunit-recommend-list"></div></div>');e.append(n);var r=n.find(".brtc-va-dialogs-selectfnunit-recommend-list");var a=function a(t,e){for(var _iterator5=t,_isArray5=Array.isArray(_iterator5),_i16=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ref24;if(_isArray5){if(_i16>=_iterator5.length)break;_ref24=_iterator5[_i16++];}else{_i16=_iterator5.next();if(_i16.done)break;_ref24=_i16.value;}var _ref25=_ref24,_i17=_ref25.functions;for(var _iterator6=_i17,_isArray6=Array.isArray(_iterator6),_i18=0,_iterator6=_isArray6?_iterator6:_iterator6[Symbol.iterator]();;){var _ref26;if(_isArray6){if(_i18>=_iterator6.length)break;_ref26=_iterator6[_i18++];}else{_i18=_iterator6.next();if(_i18.done)break;_ref26=_i18.value;}var _t8=_ref26;if(_t8.func===e)return _t8.visible;}}return!1;};if(r.append($('<div style="height: 65px; text-align: center; display: block; padding-top: 10px"><span>Recommend item does not exist.</span></div>')),this.options.preFnUnit){r.empty();var _e5=t.VA.Env.Recommend.Next.getList(this.options.preFnUnit.func,this.options.modelType);$.each(_e5,function(t,e){"load"!==e&&a(i,e)&&o.createItem(r,e);});}else{r.empty();var _e6=t.VA.Env.Recommend.Next[this.options.modelType].default;$.each(_e6,function(t,e){a(i,e)&&o.createItem(r,e);});}var s=n.find("#count"),l=r.find(".brtc-va-dialogs-selectfnunit-item").length;s.text(l),r.perfectScrollbar();},e.prototype.createKeywordArea=function(e,i){var o=this,n=$('<div class="brtc-va-dialogs-selectfnunit-keyword">   <div class="sub-title">Search functions by the following keywords: </div>   <div class="brtc-va-dialogs-selectfnunit-keyword-list"></div></div>');e.append(n);var r=n.find(".brtc-va-dialogs-selectfnunit-keyword-list");for(var a in t.VA.Env.Tags[o.options.modelType]){var s=t.VA.Env.Tags[o.options.modelType][a];if("Prescriptive"!==s){var l=$('<div class="brtc-va-dialogs-selectfnunit-keyword-item">'+s+"</div>");l.css("cursor","pointer"),r.append(l);}}r.find(".brtc-va-dialogs-selectfnunit-keyword-item").click(function(t){var e=$(this);e.hasClass("selected")?e.removeClass("selected"):e.addClass("selected"),o.refreshResult();}),n.find(".brtc-va-dialogs-selectfnunit-keyword-list").slimscroll({height:"calc(100% - 5px)"});},e.prototype.createSearchResultArea=function(e,i){var o=this,n=$('<div class="brtc-va-dialogs-selectfnunit-searchresult">   <div class="sub-title">       <span>Any other keywords?</span>       <input type="search" class="brtc-va-dialogs-selectfnunit-keyword-input" />   </div>   <div class="sub-title">Result&nbsp;<strong id="count">0</strong></div>   <div class="brtc-va-dialogs-selectfnunit-searchresult-list"></div></div>');e.append(n);var r=n.find(".brtc-va-dialogs-selectfnunit-searchresult-list");var a={data:"DataFlow",deeplearning:"DeepLearning",script:"Script",control:"ControlFlow"}[o.options.modelType];var s=t.VA.Implementation[a].Functions;if("Script"!==a){var _arr=Object.values(s);for(var _i19=0;_i19<_arr.length;_i19++){var _t9=_arr[_i19];if(_t9.defaultFnUnit){var l=_t9.defaultFnUnit.func,c=_t9.category;if("bigdata"!==c){var d=!1,p={func:l,visible:!0};for(var u in i){if(i[u].key===c){for(var h in i[u].functions){if(i[u].functions[h].func===l){d=!0;break;}}d||i[u].functions.push(p);}}}}}}if($.each(i,function(t,e){$.each(e.functions,function(t,e){if((!o.options.preFnUnit||"load"!==e.func)&&e.visible){var i=o.createItem(r,e.func);i&&i.hide();}});}),o.options.modelType===t.VA.Implementation.DataFlow.Clazz){$.ajax({url:"api/va/v3/ws/udfs",type:"GET",blocking:!1,contentType:"application/json; charset=utf-8"}).done(function(e){if(e.length>0){var i={label:"UDF",visible:!0,functions:[]};for(var n in e){"udf"===t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(o.options.modelType,e[n].udf_id).category&&i.functions.push({func:e[n].udf_id,visible:!0});}i.functions.length>0&&$.each(i.functions,function(t,e){if(e.visible){var i=o.createItem(r,e.func);i&&i.hide();}});}});}var f=n.find(".brtc-va-dialogs-selectfnunit-keyword-input");f.jqxInput({height:29,width:300,theme:t.VA.Env.Theme,placeHolder:"Search Item"}),f.on("keyup search",function(t){o.refreshResult();}),r.perfectScrollbar();},e.prototype.refreshResult=function(){var e=this.$mainControl.find(".brtc-va-dialogs-selectfnunit-searchresult-list"),i=this.$mainControl.find(".brtc-va-dialogs-selectfnunit-keyword-input").jqxInput("val").toLowerCase(),o=$.map(this.$mainControl.find(".brtc-va-dialogs-selectfnunit-keyword-item.selected"),function(t){return $(t).text();});i&&o.push(i.trim());var n,r=e.find(".brtc-va-dialogs-selectfnunit-item"),a=0;(e.scrollTop(0),o.length>0)?(n="deeplearning"===this.options.modelType?t.VA.Implementation.DeepLearning.Functions.Library.getListByTags(o):t.VA.Core.Functions.Library.getListByTags(o),$.each(r,function(e,i){var o=t.VA.Core.Utils.WidgetUtils.getData($(i).find(".brtc-va-views-palette-fnunit"),"func");$.inArray(o,n)>-1?($(i).show(),a++):$(i).hide();})):$.each(r,function(t,e){$(e).hide();});this.$mainControl.find(".brtc-va-dialogs-selectfnunit-searchresult #count").text(a),e.perfectScrollbar("update");},e.prototype.createItem=function(e,i){var o,n=this,r=$('<div class="brtc-va-dialogs-selectfnunit-item"></div>'),a=this.options.modelType,s=t.VA.Core.Utils.WidgetUtils.createPaletteItem(r,i,a);try{var l=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(a,i);if("unknownFunction"===l.defaultFnUnit.func)return;var c=l.description;return(o=$('<div class="brtc-va-dialogs-selectfnunit-item-description"><span></span></div>')).find("span").attr("title",c).text(c),r.append(o),s.click(function(e){var i=$(this);var o=t.VA.Core.Utils.WidgetUtils.getData(i,"func");n.dialogResult={OK:!0,Cancel:!1,func:o},n.$mainControl.dialog("close");}),e.append(r),r;}catch(t){console.error(t);}},t.VA.Core.Dialogs.SwitchFnUnitDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.dialogResult={OK:!1,Cancel:!0},this.retrieveParent(),this.createControls(),this.initContents();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-dialogs-main brtc-va-dialogs-selectfnunit">   <div class="brtc-va-dialogs-body brtc-va-dialogs-selectfnunit">       <div class="brtc-va-dialogs-contents brtc-va-dialogs-selectfnunit" />   </div></div>'),this.$parent.append(this.$mainControl);var e=this,i={theme:t.VA.Env.Theme,title:"Insert Unit",width:780,height:700,modal:!0,resizable:!1,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult),e.$mainControl.dialog("destroy"),e.$mainControl.remove();}};this.$mainControl.dialog(i),this.$mainControl.parent().find(".brtc-va-dialogs-selectfnunit-tab-allfunctions").css("padding-left","14px");},e.prototype.initContents=function(){this.createDialogContentsArea(this.$mainControl.find(".brtc-va-dialogs-contents")),this._removeTitleBottomBorder();},e.prototype._removeTitleBottomBorder=function(){this.$mainControl.prev().css("border","initial");},e.prototype.createDialogContentsArea=function(e){e.append('<ul>     <li>All Units</li></ul><div class="brtc-va-dialogs-selectfnunit-tab-allfunctions brtc-style-border-box"></div>'),e.jqxTabs({theme:t.VA.Env.Theme,width:this.options.width||"100%",position:"top",scrollable:!1});var i=e.find(".brtc-va-dialogs-selectfnunit-tab-allfunctions");this.createAllFunctionsArea(i),i.perfectScrollbar(),e.jqxTabs("focus"),e.find(".jqx-tabs-titleContentWrapper").css("margin-top","4.5px");},e.prototype.createAllFunctionsArea=function(e){var i=this,o={label:"DataFlow",visible:!0,functions:[]};for(var n in i.options.dataFlowList){o.functions.push({func:{func:"dataFlow",category:"DataFlow",label:i.options.dataFlowList[n].getLabel(),mid:i.options.dataFlowList[n].getFileId()},label:i.options.dataFlowList[n].getLabel(),visible:!0});}this.palette=new t.VA.Core.Views.Palette(e,{width:"100%",height:"100%",draggable:!1,modelType:i.options.modelType,additionalGroup:o}),e.find(".brtc-va-views-palette-filter-input").hide(),e.find(".brtc-va-views-palette-navigator").bind("DOMNodeInserted",function(e){$(e.target).hasClass("brtc-va-views-palette-fnunit-list")&&$(e.target).find(".brtc-va-views-palette-fnunit").click(function(e){var o=t.VA.Core.Utils.WidgetUtils.getData($(this),"func"),n={};o&&o.category&&"DataFlow"==o.category?(n.func=o.func,n.mid=o.mid):n.func=o,i.dialogResult={OK:!0,Cancel:!1,unit:n},i.$mainControl.dialog("close");});});},t.VA.Core.Dialogs.SwitchUnitDialog=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Dialogs.Dialog.call(this,e,i);}e.prototype=Object.create(t.VA.Dialogs.Dialog.prototype),e.prototype.constructor=e,e.prototype._initOptions=function(){t.VA.Dialogs.Dialog.prototype._initOptions.call(this),this.dialogOptions.width=500,this.dialogOptions.height=500;},e.prototype.createDialogContentsArea=function(t){t.addClass("brtc-va-dialogs-test-udf-param-contents"),t.append('<div class="brtc-va-dialogs-test-udf-param"></div>'),this.createInputTableControl(t.find(".brtc-va-dialogs-test-udf-param")),this.createInputVariablesControl(t.find(".brtc-va-dialogs-test-udf-param")),t.perfectScrollbar(),t.perfectScrollbar("update");},e.prototype.createInputTableControl=function(e){var i=this;if(0!==i.options.inputDataCnt){var o=$('<div class="brtc-va-dialogs-test-udf-param-input-tables-container">    <div class="header">        <span>Input Data</span>    </div>    <div class="contents">    </div></div>');this.inputFsPaths=[];for(var n={},r=0;r<i.options.inputDataCnt;r++){var a=$('<div class="brtc-va-dialogs-test-udf-param-row-flex-layout" style="display: flex">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold" style="width: 30%;">inputs('+r+")</div></div>");n[r]=$('<input type="text" class="brtc-va-editors-sheet-controls-propertycontrol-dropDownList" style="width: 70%;"/>'),i.createInput(n[r]),n[r].prop("readonly",!0),a.append(n[r]),n[r].click(function(){var e=this;new t.VA.Core.Dialogs.RepositoryBrowserDialog(i.$mainControl,{filePath:$(e).val(),close:function close(t){t.OK&&t.selectedFile&&i.renderInput($(e),[t.selectedFile]);},resizable:!0,title:"Browse Repository"}).$settingOptionGroup.attr("setting","false");}),this.inputFsPaths.push({index:r,control:n[r],value:""}),o.find(".contents").append(a),e.append(o);}}},e.prototype.renderInput=function(t,e){var i=e[0]||"";t.val(i),t.attr("title",i),this.renderInputSchema(i);},e.prototype.createInputVariablesControl=function(e){if(0!==this.options.inputVariable.length){var i=$('<div class="brtc-va-dialogs-test-udf-param-input-variables-container">    <div class="header">        <span>Input Variable</span>    </div>    <div class="contents">    </div></div>');for(var o in this.inputVariables=[],this.options.inputVariable){var n=$('<div class="brtc-va-dialogs-row-flex-layout">   <div class="brtc-va-dialogs-contents-label brtc-va-dialogs-contents-label-bold" style="width: 30%;">'+this.options.inputVariable[o].param_name+"</div></div>");e.append(i);var r="";if("int"===this.options.inputVariable[o].arg_type||"double"===this.options.inputVariable[o].arg_type||"long"===this.options.inputVariable[o].arg_type){r=$('<div class="brtc-va-dialog-test-udf-param-input-param-value" style="width:70%;"/>');var a={numberType:this.options.inputVariable[o].arg_type,placeholder:"Enter value"},s=this.createNumberInput(r,a,"",{width:"70%"});n.append(r),i.find(".contents").append(n),this.inputVariables.push({paramName:this.options.inputVariable[o].param_name,paramType:this.options.inputVariable[o].arg_type,control:s,value:""});}else if("string"===this.options.inputVariable[o].arg_type){r=$('<input type="text" class="brtc-va-dialog-test-udf-param-input-param-value"/>');a={placeHolder:"Enter value",width:"70%"};this.createInput(r,a,"",{width:"70%"}),n.append(r),i.find(".contents").append(n),this.inputVariables.push({paramName:this.options.inputVariable[o].param_name,paramType:this.options.inputVariable[o].arg_type,control:r,value:""});}else{r=$('<textarea class="brtc-va-dialog-test-udf-param-input-param-value"></textarea>'),n.append(r),i.find(".contents").append(n);var l=new t.VA.Core.Verifier.SqlVerifier(),c={placeholder:'Enter value. \n Ex)Array("a", "b") \n Map("a"->"b")',hintOptions:{list:[]}};c.verifier=l;var d=this.createTextAreaControl(r,c,"",{width:"70%"});r.data("codeMirror",d),d.codeMirror.setSize("100%","50px"),this.inputVariables.push({paramName:this.options.inputVariable[o].param_name,paramType:this.options.inputVariable[o].arg_type,control:d,value:""});}}this.updateCodeMirrorHint();}},e.prototype.updateCodeMirrorHint=function(){for(var t in this.hintList=[],this.hintList=$.extend(!0,this.hintList,CodeMirror.hintWords["text/x-scala"]),this.columnList){for(var e in this.columnList[t]){this.hintList.push(this.columnList[t][e].name);}}for(var t in this.inputVariables){"expression"===this.inputVariables[t].paramType&&(this.inputVariables[t].control.codeMirror.options.hintOptions.list=this.hintList);}},e.prototype.handleOkClicked=function(){this.dialogResult.inputTables=this.getInputTables(),this.dialogResult.inputVariables=this.getInputParams(),t.VA.Dialogs.Dialog.prototype.handleOkClicked.call(this);},e.prototype.getInputTables=function(){for(var t in this.inputFsPaths){this.inputFsPaths[t].value=this.inputFsPaths[t].control.val();}return this.inputFsPaths;},e.prototype.getInputParams=function(){for(var t in this.inputVariables){"int"===this.inputVariables[t].paramType||"double"===this.inputVariables[t].paramType||"long"===this.inputVariables[t].paramType?this.inputVariables[t].value=this.inputVariables[t].control.getValue():"string"===this.inputVariables[t].paramType?this.inputVariables[t].value=this.inputVariables[t].control.val():this.inputVariables[t].value=this.inputVariables[t].control.getValue();}return this.inputVariables;},e.prototype.createDialogButtonBar=function(e){t.VA.Dialogs.Dialog.prototype.createDialogButtonBar.call(this,e),this.$okButton.val("RUN"),this.$cancelButton.css({display:"none"});},e.prototype.wrapControl=function(t){var e=$('<div class="brtc-va-dialog-test-udf-param-controls-wrapper"></div>');t.wrap(e);},e.prototype.addClassToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-dialog-test-udf-param-controls-wrapper");i&&i.addClass(e);}},e.prototype.addCssToWrapper=function(t,e){if(e){var i=t.parent(".brtc-va-dialog-test-udf-param-controls-wrapper");i&&i.css(e);}},e.prototype.createInput=function(e,i,o,n){this.wrapControl(e);var r="";o&&(r=r.concat(" ",o)),e.attr("type")||e.attr("type","text"),e.attr("maxlength")||e.attr("maxlength","100"),this.addClassToWrapper(e,r),this.addCssToWrapper(e,n);var a={theme:t.VA.Env.Theme,height:"25px"};i&&$.extend(a,i),e.jqxInput(a);var s=e.val();return e.focus(function(){s=e.val();}),$("svg").on("mousedown",function(){e.val()!==s&&e.is(":focus")&&e.trigger("change");}),e;},e.prototype.createNumberInput=function(e,i,o,n){this.wrapControl(e);var r="";return o&&(r=r.concat(" ",o)),this.addClassToWrapper(e,r),this.addCssToWrapper(e,n),new t.VA.Core.Editors.Sheet.Controls.NumericInput(e,i);},e.prototype.createTextAreaControl=function(e,i,o,n){this.wrapControl(e);var r="";return o&&(r=r.concat(" ",o)),this.addClassToWrapper(e,r),this.addCssToWrapper(e,n),e.addClass(r),n&&e.css(n),new t.VA.Core.Editors.Sheet.Controls.TextAreaControl(e,i);},e.prototype.renderInputSchema=function(e){this.columnList={};var i=this;t.VA.RepositoryQueryTemplate.schema(e).done(function(t){i.columnList[e]=t.columns,$.each(i.columnList[e],function(t,e){void 0===e.type?e.type=e.internalType:e.type=e.type;}),i.updateCodeMirrorHint();}).fail(function(t){});},t.VA.Core.Dialogs.TestUDFParamDialog=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils,i=t.VA.Dialogs.Dialog.prototype;function o(t,e){i.constructor.call(this,t,e);}o.prototype=Object.create(i),o.prototype.constructor=o,o.prototype._initOptions=function(){i._initOptions.call(this),this.dialogOptions.title="Version List",this.dialogOptions.width=1e3,this.dialogOptions.height="auto",this.dialogOptions.maxHeight="auto";},o.prototype.createDialogContentsArea=function(e){var i=['<div class="brtc-va-dialogs-version-management-contents">','  <div class="brtc-va-dialogs-version-management-header">','    <input type="button" class="brtc-va-dialogs-version-management-add" value="Update Version">',"  </div>",'  <div class="brtc-va-dialogs-version-management-body">',"  </div>","</div>"].join("\n");e.append(i),this.$addBtn=e.find(".brtc-va-dialogs-version-management-add"),this.$contentBody=e.find(".brtc-va-dialogs-version-management-body");var o=new t.VA.EventEmitter();o.on("load",_.debounce(function(t){this.openLoadQuestionDialog(function(e){e.OK&&this.loadFileVersion(t.getFileId(),t.getVersionId());}.bind(this));}.bind(this),300)),o.on("error",_.debounce(function(t){this._onError(t);}.bind(this))),this.modelVersionListComponent=new t.VA.Core.Components.ModelVersionListLoadable({$el:this.$contentBody,emitter:o,projectId:this.options.projectId,fileId:this.options.fileId}),this.createAddButton(this.$addBtn);},o.prototype.createAddButton=function(e){e.jqxButton({theme:t.VA.Env.Theme}),e.click(_.debounce(this.openAddVersionDialog.bind(this)));},o.prototype.openAddVersionDialog=function(){var e=function(t){t.OK&&this.modelVersionListComponent.refreshFileVersionList();}.bind(this);new t.VA.Core.Dialogs.AddVersionDialog(this.$mainControl,{projectId:this.options.projectId,fileId:this.options.fileId,close:e});},o.prototype.openLoadQuestionDialog=function(t){e.WidgetUtils.openQuestionDialog("Current model contents will be overwritten by this version and cannot be recovered. Are you sure?",t);},o.prototype.createDialogButtonBar=function(t){i.createDialogButtonBar.call(this,t),this.$okButton.val("Close"),this.$cancelButton.css({display:"none"});},o.prototype.loadFileVersion=function(t,i){var o=function(){return this.closedEditor=Studio.getEditorContainer().findEditorById(this.options.projectId,t),this.closedEditor&&Studio.getLayoutManager().closeEditor(this.closedEditor.options.editorInput),!0;}.bind(this),n=function(){return this.dialogResult.loadingSuccess=!1,this.$mainControl.dialog("close");}.bind(this),r=function(t){this.updatedFiles=t;}.bind(this),a=function(){Studio.getLayoutManager().openEditor(this.updatedFiles);}.bind(this);Studio.getResourceManager().loadVersion(this.options.projectId,t,i).then(r).then(o).then(function(){return e.WidgetUtils.openInformationDialog("Loading success");}).then(n).then(a).catch(this._onError.bind(this));},o.prototype._onError=function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),this.$mainControl.dialog("close");},o.prototype.destroy=function(){i.destroy.call(this),this.modelVersionListComponent.destroy();},t.VA.Core.Dialogs.VersionManagementDialog=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=$.extend({},e||{showPreviousButton:!0,showNextButton:!0,showFinishButton:!0}),this.retrieveParent(),this.createControls(),this.initPermission();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.initPermission=function(){this.permissions=["data_upload_shared"],this.checkPermission();},e.prototype.checkPermission=function(){t.VA.Core.Utils.PermissionUtils.check(this.$mainControl,this.permissions);},e.prototype.init=function(){$(":focus").blur(),this.options.wizard.$btnPrevious.removeClass("jqx-fill-state-hover").removeClass("jqx-fill-state-hover-office"),this.options.wizard.$btnNext.removeClass("jqx-fill-state-hover").removeClass("jqx-fill-state-hover-office"),this.options.wizard.$btnFinish.removeClass("jqx-fill-state-hover").removeClass("jqx-fill-state-hover-office"),this.options.wizard.$btnPrevious.jqxButton({disabled:!1}),this.options.wizard.$btnNext.jqxButton({disabled:!1}),this.options.wizard.$btnFinish.jqxButton({disabled:!1}),this.$mainControl.find(".preview").find(".contents").perfectScrollbar("update");},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-wizardpage">   <div class="brtc-va-wizardpage-header"></div>   <div class="brtc-va-wizardpage-content"></div></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.$mainControl.addClass(this.options.class),this.$headerControl=this.$mainControl.find(".brtc-va-wizardpage-header"),this.$headerControl.addClass(this.options.class),this.createHeaderArea(this.$headerControl),this.$contentsControl=this.$mainControl.find(".brtc-va-wizardpage-content"),this.$contentsControl.addClass(this.options.class),this.createContentsArea(this.$contentsControl);},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(t){},e.prototype.show=function(){this.$mainControl.show();},e.prototype.hide=function(){this.$mainControl.hide();},e.prototype.doFinish=function(t){t();},e.prototype.findActivatedInput=function(t){for(var e in t){if($(t[e]).hasClass("jqx-fill-state-focus"))return $(t[e]);}},e.prototype.destroy=function(){},t.VA.Core.Wizards.Pages.WizardPage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.options=i,this.options.class="downloadloadingpage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options);}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.doFinish();},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(t){var e=this.options.loadingText||"Preparing...";t.append($('<div class="brtc-va-loading-page-contents-area">   <div class="brtc-va-loading-page-text-area">       <div class="brtc-va-loading-page-text-wrapper">           <span>'+e+'</span>       </div>    </div>    <div class="brtc-va-loading-page-spinner-area">        <div class="brtc-va-loading-page-spinner-wrapper">            <div class="brtc-va-loading-page-spin-icon">               <div class="brtc-va-progress-loading"></div>           </div>        </div>   </div></div>'));},e.prototype.doFinish=function(){var e=this,i=t.VA.Core.Utils.DownLoader,o=this.options.wizard.options.downloaderOptions,n=o.userId,r=o.mid,a=this.options.wizard.result.tid,s=this.options.wizard.result.fileName||o.fileName,l=this.options.wizard.result.delimiters;i.run(n,r,a,s,l,function(){e.options.wizard.$mainControl.dialog("destroy");},function(i){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(i,function(){e.options.wizard.$mainControl.dialog("destroy");});});},t.VA.Core.Wizards.Pages.DownloadLoadingPage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.options=i,this.options.class="selectalluxiodatapage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options),this.options.wizard.registerEvent("changeData");}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.$btnPrevious.jqxButton({disabled:!1}),this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.result.remotePath?this.options.wizard.$btnNext.jqxButton({disabled:!1}):this.options.wizard.$btnNext.jqxButton({disabled:!0}),this.options.wizard.result.data=this.options.wizard.result.data||[];},e.prototype.createHeaderArea=function(t){t.addClass("brtc-va-wizardpage-dataupload"),this.$wizardHeader=$('   <div class="step01">       <span class="brtc-va-icon step normal selected"></span>       <p class="step normal selected"><strong>01</strong> Select Data</p>   </div>   <div class="step02">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>02</strong> Set Delimiter</p>   </div>   <div class="step03">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>   </div>'),t.append(this.$wizardHeader);},e.prototype.createContentsArea=function(e){e.addClass("brtc-va-wizardpage-dataupload");var i=this;e.append($('   <div class="fileselect">       <div style="font-size: 13px; font-style: italic; margin-bottom: 20px;">Select data consisting of delimiter-separated values.</div>       <div class="header">           <span>File: </span>               <input type="button" id="fileselect-remote" value="Remote" />       </div>       <div class="contents filename">           <span class="nodata">Select file to upload</span>       </div>   </div>   <div class="uploadtoselect">       <div class="header">           <span>Add to: </span>       </div>       <div class="contents">           <div class="brtc-va-radio">               <div class="brtc-va-radio-button" id="upload-to-shared-alluxio" value="shared">Shared</div>           </div>           <div class="brtc-va-radio">               <div class="brtc-va-radio-button" id="upload-to-userid-alluxio" value="'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t.VA.Env.Session.userId)+'"><span>'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t.VA.Env.Session.userId)+'</span></div>           </div>       </div>   </div>   <div class="preview selectdata alluxio">       <div class="header">           <span>Data preview</span>       </div>       <div class="contents">           <span class="nodata">no data</span>       </div>   </div>'));var o=e.find("#fileselect-remote");e.find("#upload-to-shared-alluxio").jqxRadioButton({theme:t.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:"alluxio"}),e.find("#upload-to-userid-alluxio").jqxRadioButton({theme:t.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:"alluxio"}),e.find(".brtc-va-radio-button").on("checked",function(t){i.options.wizard.result.uploadTo=this.getAttribute("value");}),e.find("#upload-to-userid-alluxio").jqxRadioButton("check"),o.jqxButton({theme:t.VA.Env.Theme}),o.on("click",function(t){i.handleRemoteFileSelected(t);});},e.prototype.handleRemoteFileSelected=function(e){var i=this;new t.VA.Core.Dialogs.FilePathDialog($(e.target),{close:function close(e){if(e.OK){var o=e.name,n=i.$contentsControl.find(".filename");n.empty(),n.append($('<span class="brtc-va-icon brtc-va-dialogs-dataupload file"></span><span>'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(o)+"</span>")),i.reset(),$.ajax({method:"GET",url:"api/va/v2/data/head?length=20&path="+o,blocking:!0}).done(function(t){i.options.wizard.triggerEvent("changeData",!0),i.updateFileSelectPreview(t),i.refreshButton(!0),i.options.wizard.result.fileName=o.split("/").pop(),i.options.wizard.result.remotePath=o,i.options.wizard.$btnNext.jqxButton({disabled:!1});}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog("File does not exist.",function(){i.refreshButton();}),i.refreshButton();});}}});},e.prototype.updateFileSelectPreview=function(e){var i=e.split("\n"),o=this.$contentsControl.find(".preview.selectdata.alluxio").find(".contents"),n=0;this.options.wizard.result.data=[];for(var r=0;r<Math.min(i.length,20);r++){i[r].trim()&&(o.find(".number-column").append($("<li>"+n+"</li>")),o.find(".data-column").append($("<li>"+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(i[r])+"</li>")),this.options.wizard.result.data.push(i[r]),n++);}o.perfectScrollbar();},e.prototype.reset=function(){var t=this.$parent.find(".preview").find(".contents");this.options.wizard.result.fileName="",this.options.wizard.result.data=[],$("input[type=file]").val(""),t.empty(),t.append($('<ul class="number-column"></ul>')),t.append($('<ul class="data-column"></ul>'));},e.prototype.refreshButton=function(t){},t.VA.Core.Wizards.Pages.SelectAlluxioDataPage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.options=i,this.options.class="selectdelimiterpage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options);var o=this;this.options.wizard.registerEvent("changeDelimiter"),this.options.wizard.addEventListener("changeData",function(t,e){e&&(o.options.wizard.result.delimiter=void 0);});}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.delimiterMap={comma:",",tab:"\t",semicolon:";",colon:":",space:" "},this.options.wizard.$btnPrevious.jqxButton({disabled:!1}),this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.result.delimiter?this.options.wizard.$btnNext.jqxButton({disabled:!1}):this.options.wizard.$btnNext.jqxButton({disabled:!0}),void 0===this.options.wizard.result.delimiter?this.$mainControl.find(".brtc-va-radio-button[value=comma]").val(!0):this.splitData(this.options.wizard.result.delimiter);},e.prototype.createHeaderArea=function(t){t.addClass("brtc-va-wizardpage-dataupload"),this.$wizardHeader=$('   <div class="step01">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>01</strong> Select Data</p>   </div>   <div class="step02">       <span class="brtc-va-icon step normal selected"></span>       <p class="step normal selected"><strong>02</strong> Set Delimiter</p>   </div>   <div class="step03">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>   </div>'),t.append(this.$wizardHeader);},e.prototype.createContentsArea=function(e){var i=this;e.append($('<div class="delimiterselect brtc-va-column-delimiter">   <div style="font-size: 13px; font-style: italic; margin-bottom: 20px;">Choose a delimiter for separating data.</div>   <div class="header">       <span>Delimiters: </span>    </div>    <div class="contents">        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-comma" value="comma" aria-checked="true">Comma</div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-tab" value="tab"><span>Tab</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-space" value="space"><span>Space</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-colon" value="colon"><span>Colon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>        </div>   </div></div><div class="column-preview selectdelimiter">   <div class="header"><span class="column-row-length">0</span>Columns</div>   <div class="contents">       <div class="delimiter-table"></div>   </div></div>')),e.find(".brtc-va-radio-button").jqxRadioButton({theme:t.VA.Env.Theme,height:25,width:95,boxSize:"18px",groupName:"delimiter"}),e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").jqxInput({theme:t.VA.Env.Theme,width:"70px",height:"24px"}),e.find(".brtc-va-column-delimiter .jqx-radiobutton").on("change",function(t){if(i.options.wizard.triggerEvent("changeDelimiter",!0),"INPUT"==t.target.tagName)i.options.wizard.result.delimiter=e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").val(),i.splitData(i.options.wizard.result.delimiter);else if(t.args.checked){var o=t.target.getAttribute("value");"other"==o?(i.options.wizard.result.delimiter=e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").val(),i.splitData(i.options.wizard.result.delimiter)):(i.options.wizard.result.delimiter=i.delimiterMap[o],i.splitData(i.options.wizard.result.delimiter));}i.options.wizard.result.delimiter&&i.options.wizard.result.data.length>1?(i.options.wizard.$btnNext.jqxButton({disabled:!1}),i.options.wizard.$btnNext.jqxButton({disabled:!1})):i.options.wizard.$btnNext.jqxButton({disabled:!0});}),this.createColumnGrid();},e.prototype.getColumnNameList=function(){var t=[];return this.options.wizard.result.data[0]&&(t=this.options.wizard.result.data[0].split(this.options.wizard.result.delimiter||",")),t;},e.prototype.splitData=function(t){var e=[],i=[];this.options.wizard.result.data[0]&&(e=this.options.wizard.result.data[0].split(t||this.options.wizard.result.delimiter),this.options.wizard.result.data[1]&&(i=this.options.wizard.result.data[1].split(t||this.options.wizard.result.delimiter))),this.setColumnGridData(e,i);},e.prototype.createColumnGrid=function(){var e=this.$mainControl.find(".column-preview .contents .delimiter-table"),i=$('<div class="brtc-va-selectdelimiter-preview-column-grid"></div>');e.append(i);var o=this._getFormattedGridData([]);this.$grid=i.jqxGrid({theme:t.VA.Env.Theme,width:619,height:265,rowsheight:25,source:o,selectionmode:"none",columnsresize:!0,columns:[{text:"No.",sortable:!1,filterable:!1,editable:!1,groupable:!1,draggable:!1,resizable:!1,datafield:"",columntype:"number",width:50,cellsrenderer:function cellsrenderer(t,e,i){return'<div style="margin:4px;">'+(i+1)+"</div>";}},{text:"Column Name",datafield:"column",cellsrenderer:function cellsrenderer(t,e,i){var o=$('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');return o.attr("title",i),o.text(i),$("<div>").append(o.clone()).html();}},{text:"First Data",datafield:"column-data",cellsrenderer:function cellsrenderer(t,e,i){var o=$('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');return o.attr("title",i),o.text(i),$("<div>").append(o.clone()).html();}}]});},e.prototype.setColumnGridData=function(t,e){var i=this._getFormattedGridData(t,e);this.$grid.jqxGrid({source:i}),this.$mainControl.find(".column-row-length").text(t.length);},e.prototype._getFormattedGridData=function(t,e){for(var i=[],o=0;o<t.length;o++){var n={};n.column=t[o],n["column-data"]=e[o],i[o]=n;}var r={localdata:i,datatype:"array",datafields:[{name:"column",type:"string"},{name:"column-data",type:"string"}]};return new $.jqx.dataAdapter(r);},e.prototype.destroy=function(){this.$grid.jqxGrid("destroy");},t.VA.Core.Wizards.Pages.SelectDelimiterPage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.options=i,this.options.class="selectexportdelimiterpage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options);}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.delimiterMap={comma:",",tab:"\t",semicolon:";",colon:":",space:" "},this.options.wizard.$btnPrevious.jqxButton({disabled:!1}),this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.result.delimiter?(this.options.wizard.$btnNext.jqxButton({disabled:!0}),this.options.wizard.$btnFinish.jqxButton({disabled:!1})):(this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.$btnNext.jqxButton({disabled:!0}));},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(e){e.addClass("brtc-va-wizardpage-dataexport");var i=this;this.$progress=$('   <div class="brtc-va-progress">       <div>           <span class="brtc-va-progress-loading"/>           <p>Exporting...</p>       </div></div>'),e.append(this.$progress),this.$progress.hide(),e.append($('<div class="fileselect">   <div class="header">       <span>Export File</span>    </div>       <div class="contents filename">           <span class="nodata">Select file to upload</span>       </div></div><div class="delimiterselect brtc-va-column-delimiter">   <div class="header">       <span>Delimiters</span>    </div>    <div class="contents">        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-comma" value="comma">Comma</div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-tab" value="tab"><span>Tab</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-space" value="space"><span>Space</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-colon" value="colon"><span>Colon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>        </div>   </div></div>')),e.css({height:"400px"}),e.find(".brtc-va-radio-button").jqxRadioButton({theme:t.VA.Env.Theme,height:28,width:102,boxSize:"18px",groupName:"delimiter"}),e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").jqxInput({theme:t.VA.Env.Theme,width:77,height:25}),e.find(".brtc-va-column-delimiter .jqx-radiobutton").on("change",function(t){if("INPUT"==t.target.tagName)i.options.wizard.result.delimiter=e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").val();else if(t.args.checked){var o=t.target.getAttribute("value");i.options.wizard.result.delimiter="other"==o?e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").val():i.delimiterMap[o];}i.options.wizard.result.delimiter?i.options.wizard.$btnFinish.jqxButton({disabled:!1}):i.options.wizard.$btnFinish.jqxButton({disabled:!0});}),e.find(".brtc-va-column-delimiter .brtc-va-radio-button[value=other]").on("checked",function(){e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").jqxInput("focus");}),i.handleExportFileSelected();},e.prototype.handleExportFileSelected=function(){var e=this.options.wizard,i=this.$contentsControl.find(".filename");i.empty(),i.append($('<span class="brtc-va-icon brtc-va-wizardpage-dataupload file"></span><span>'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e.options.name)+"</span>"));},e.prototype.doFinish=function(){var e=this;e.progress(!0,"Exporting...");var i=t.VA.Core.Utils.DownLoader;if("local"===this.options.wizard.result.copyFrom){var o=e.options.wizard.options.name,n=e.options.wizard.result.delimiter,r={};r.delimiter=n;var a=e.options.wizard.options.path;i.runStartWithExport(o,a,r,function(){e.progress(!1);},function(i){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(i,function(){e.$parent.parent().dialog("destroy");});});}},e.prototype.progress=function(e,i){var o=this;e?(this.$progress.show(),this.options.wizard.$btnFinish.jqxButton({disabled:e})):(this.$progress.hide(),i?t.VA.Core.Utils.WidgetUtils.openErrorDialog(i,function(){o.$parent.parent().dialog("destroy");}):t.VA.Core.Utils.WidgetUtils.openInformationDialog("Data Export preparation has been successfully completed. File Download will start.",function(){o.$parent.parent().dialog("destroy");})),this.options.wizard.$btnPrevious.jqxButton({disabled:e});},t.VA.Core.Wizards.Pages.SelectExportDelimiterPage=e;}.call(this),function(){"use strict";var t=this.Brightics;var e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;function i(e,i){this.options=i,this.options.class="SelectExportJdbcPage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options);}i.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),i.prototype.constructor=i,i.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.$btnPrevious.jqxButton({disabled:!1}),this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.$message.text(""),this.options.wizard.result.data=this.options.wizard.result.data||[],this.options.wizard.result.columnType=this.options.wizard.result.columnType||{},this.options.wizard.result.jdbc=this.options.wizard.result.jdbc||{},""!=this.$host.jqxInput("val")&&""!=this.$port.jqxInput("val")&&""!=this.$service.jqxInput("val")&&""!=this.$username.jqxInput("val")&&""!=this.$password.jqxInput("val")&&""!=this.$tablename.jqxInput("val")?this.$contentsControl.find(".connect").jqxButton({disabled:!1}):this.$contentsControl.find(".connect").jqxButton({disabled:!0});},i.prototype.createHeaderArea=function(t){},i.prototype.refreshConnectControl=function(){this.$message.text("");var i=this.$host.val(),o=this.$port.val(),n=this.$contentsControl.find(".connect");""!=i&&""!=o&&""!=this.$service.jqxInput("val")&&""!=this.$username.jqxInput("val")&&""!=this.$password.jqxInput("val")&&""!=this.$tablename.jqxInput("val")?n.jqxButton({disabled:!(e.test(i)&&t.VA.Core.Utils.InputValidator.isValid.integerType(o)&&o<65535)}):n.jqxButton({disabled:!0});},i.prototype.createContentsArea=function(i){t.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this,i);var o=this;this.$progress=$('   <div class="brtc-va-progress">       <div>           <span class="brtc-va-progress-loading"/>           <p>Exporting...</p>       </div></div>'),i.append(this.$progress),this.$progress.hide(),i.append($('   <div class="brtc-va-wizard-contents-property export-file-contents">       <div class="brtc-va-wizard-contents-property-label">Export File :</div>       <div class="contents filename">       </div>   </div>   <div class="brtc-va-wizard-contents-property db-type-contents">       <div class="brtc-va-wizard-contents-property-label mandatory">DB Type :</div>       <div class="brtc-va-wizard-contents-property-input db-type" />       <input type="button" class="connect" value="Connection Test"/>       <div class="message-container"><span class="message"/></div>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Host :</div>       <input type="text" class="brtc-va-wizard-contents-property-input host" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Port :</div>       <input type="text" class="brtc-va-wizard-contents-property-input port" maxlength="5"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Service :</div>       <input type="text" class="brtc-va-wizard-contents-property-input service" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Username :</div>       <input type="text" class="brtc-va-wizard-contents-property-input username" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Password :</div>       <input type="password" class="brtc-va-wizard-contents-property-input password" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Table Name :</div>       <input type="text" class="brtc-va-wizard-contents-property-input tablename" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property connection-timeout-contents">       <div class="brtc-va-wizard-contents-property-label">Connection :</div>       <div  class="brtc-va-wizard-contents-property-input connection-timeout"/>   </div>   <div class="brtc-va-wizard-contents-property login-timeout-contents">       <div class="brtc-va-wizard-contents-property-label">Login :</div>       <div  class="brtc-va-wizard-contents-property-input login-timeout"/>   </div>   <div class="brtc-va-wizard-contents-property socket-timeout-contents">       <div class="brtc-va-wizard-contents-property-label">Socket :</div>       <div  class="brtc-va-wizard-contents-property-input socket-timeout"/>   </div>   <div class="brtc-va-wizard-contents-property lock-timeout-contents">       <div class="brtc-va-wizard-contents-property-label">Lock :</div>       <div  class="brtc-va-wizard-contents-property-input lock-timeout"/>   </div>')),this.$dbtype=i.find(".db-type"),this.$dbtype.jqxDropDownList({theme:t.VA.Env.Theme,height:"25px",source:["Postgre"],selectedIndex:0}),i.find(":text").jqxInput({theme:t.VA.Env.Theme,maxLength:30}),i.find(":password").jqxInput({theme:t.VA.Env.Theme,maxLength:30}),i.find(".connect").jqxButton({theme:t.VA.Env.Theme,width:150,height:27}),i.jqxValidator({hintType:"label",animationDuration:10,closeOnClick:!1,rules:[{input:".host",message:"[0~255].[0~255].[0~255].[0~255]",action:"keyup",rule:function rule(t,i){var n=o.findActivatedInput(t);return!!n&&e.test(n.val());}},{input:".port",message:"[0~65535]",action:"keyup",rule:function rule(e,i){var n=o.findActivatedInput(e);return!!n&&t.VA.Core.Utils.InputValidator.isValid.integerType(n.val())&&n.val()<65536;}}]}),this.$host=i.find(".host"),this.$port=i.find(".port"),this.$service=i.find(".service"),this.$username=i.find(".username"),this.$password=i.find(".password"),this.$connectionTimeout=new t.VA.Core.Widget.Controls.NumericInput(i.find(".connection-timeout"),{numberType:"int",minus:!1,placeholder:"Timeout(sec) Default: 600",max:3e3}),i.find(".connection-timeout").find(".brtc-va-widgets-controls-numericInput").addClass("widthfree"),this.$loginTimeout=new t.VA.Core.Widget.Controls.NumericInput(i.find(".login-timeout"),{numberType:"int",minus:!1,placeholder:"Timeout(sec) Default: 600",max:3e3}),i.find(".login-timeout").find(".brtc-va-widgets-controls-numericInput").addClass("widthfree"),this.$socketTimeout=new t.VA.Core.Widget.Controls.NumericInput(i.find(".socket-timeout"),{numberType:"int",minus:!1,placeholder:"Timeout(sec) Default: 600",max:3e3}),i.find(".socket-timeout").find(".brtc-va-widgets-controls-numericInput").addClass("widthfree"),this.$lockTimeout=new t.VA.Core.Widget.Controls.NumericInput(i.find(".lock-timeout"),{numberType:"int",minus:!1,placeholder:"Timeout(sec) Default: 600",max:3e3}),i.find(".lock-timeout").find(".brtc-va-widgets-controls-numericInput").addClass("widthfree"),this.$tablename=i.find(".tablename"),this.$message=i.find(".message"),i.find(":text").on("change",function(){o.refreshConnectControl();}),i.find(":password").on("change",function(){o.refreshConnectControl();}),i.find(".connect").on("click",function(){o.refreshControlValues(),$.ajax({type:"GET",url:"api/va/v2/rsa/publickey",blocking:!0}).done(function(t){var e=new RSAKey();o.publicN=t.publicN,o.publicE=t.publicE,e.setPublic(t.publicN,t.publicE);var i=e.encrypt(o.options.wizard.result.jdbc.password),n={url:"api/va/v2/datasources/external/query",method:"POST",data:{dbtype:o.options.wizard.result.jdbc.dbtype,host:o.options.wizard.result.jdbc.host,port:o.options.wizard.result.jdbc.port,service:o.options.wizard.result.jdbc.service,username:o.options.wizard.result.jdbc.username,password:i},blocking:!0};$.ajax(n).done(function(t){o.$message.text("SUCCESS"),o.options.wizard.$btnFinish.jqxButton({disabled:!1});}).fail(function(t){o.$message.text("FAILED"),o.options.wizard.$btnFinish.jqxButton({disabled:!0});});}).fail(function(t){o.$message.text("FAILED"),o.options.wizard.$btnFinish.jqxButton({disabled:!0});});}),o.handleExportFileSelected();},i.prototype.doFinish=function(t){var e=new RSAKey();e.setPublic(this.publicN,this.publicE);e.encrypt(this.options.wizard.result.jdbc.password);this.exportJDBCData(this.options);},i.prototype.createExportDataOption=function(e){this.refreshControlValues();var i="va_mexportdata_"+moment(Date.now()).format("YYYYMMDDHHmmssSSS"),o={fid:"fexportdata",func:"exportData",name:"ExportData",label:"Export Data",persist:!0,"persist-mode":"auto"};return"jdbc"===this.options.wizard.result.copyFrom&&(o.param={"copy-to":"jdbc",ip:this.options.wizard.result.jdbc.host,port:this.options.wizard.result.jdbc.port,"input-path":this.options.wizard.options.path,"db-type":this.options.wizard.result.jdbc.dbtype.toLowerCase(),username:this.options.wizard.result.jdbc.username,password:this.options.wizard.result.jdbc.password,"db-name":this.options.wizard.result.jdbc.service,"table-name":this.options.wizard.result.jdbc.tablename,"connection-timeout":this.options.wizard.result.jdbc.connectiontimeout.toString(),"login-timeout":this.options.wizard.result.jdbc.logintimeout.toString(),"socket-timeout":this.options.wizard.result.jdbc.sockettimeout.toString(),"lock-timeout":this.options.wizard.result.jdbc.locktimeout.toString()}),t.VA.Core.Utils.RunnableFactory.createForDummy(o,i,t.VA.Env.Session.userId);},i.prototype.exportJDBCData=function(e){var i=this,o=this.createExportDataOption(e),n=function n(e){i._checkProgress(o.user,e).done(function(t){if("PROCESSING"==t.status)setTimeout(n.bind(i,e),3e3);else if("SUCCESS"==t.status)i.progress(!1);else{var o={errors:[{message:"Failed to export data.",code:400}]};t.responseJSON&&t.responseJSON.errors?(o=t.responseJSON).errors[0].contentType=t.getResponseHeader("Content-Type"):t.errorInfo&&t.errorInfo[0]&&(o.errors[0].message=t.errorInfo[0].message),i.progress(!1,o);}}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e,function(){i.$parent.parent().dialog("destroy");});});},r={url:"api/va/v2/analytics/jobs/execute",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(o),blocking:!1};$.ajax(r).done(function(t){var e=JSON.parse(t);i.progress(!0,"Exporting... 30%"),setTimeout(n.bind(i,e.result),1e3);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e,function(){i.$parent.parent().dialog("destroy");});});},i.prototype._checkProgress=function(t,e){var i={url:"api/va/v2/analytics/jobs/"+e,type:"GET",blocking:!1};return $.ajax(i);},i.prototype.progress=function(e,i){var o=this;e?(this.$progress.show(),this.options.wizard.$btnFinish.jqxButton({disabled:e})):(this.$progress.hide(),i?t.VA.Core.Utils.WidgetUtils.openErrorDialog(i,function(){o.$parent.parent().dialog("destroy");}):t.VA.Core.Utils.WidgetUtils.openInformationDialog("Data Export has been successfully completed.",function(){o.$parent.parent().dialog("destroy");})),this.options.wizard.$btnPrevious.jqxButton({disabled:e});},i.prototype.refreshControlValues=function(){this.options.wizard.result.jdbc.dbtype=this.$dbtype.jqxDropDownList("val"),this.options.wizard.result.jdbc.host=this.$host.jqxInput("val"),this.options.wizard.result.jdbc.port=this.$port.jqxInput("val"),this.options.wizard.result.jdbc.service=this.$service.jqxInput("val"),this.options.wizard.result.jdbc.username=this.$username.jqxInput("val"),this.options.wizard.result.jdbc.password=this.$password.jqxInput("val"),this.options.wizard.result.jdbc.connectiontimeout=this.$connectionTimeout.getValue()||"600",this.options.wizard.result.jdbc.logintimeout=this.$loginTimeout.getValue()||"600",this.options.wizard.result.jdbc.sockettimeout=this.$socketTimeout.getValue()||"600",this.options.wizard.result.jdbc.locktimeout=this.$lockTimeout.getValue()||"600",this.options.wizard.result.jdbc.tablename=this.$tablename.jqxInput("val");},i.prototype.handleExportFileSelected=function(){var e=this.options.wizard,i=this.$contentsControl.find(".filename");i.empty(),i.append($('<span class="brtc-va-icon brtc-va-wizardpage-dataupload file"></span><span>'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e.options.name)+"</span>"));},i.prototype.destroy=function(){this.$dbtype.jqxDropDownList("destroy");},t.VA.Core.Wizards.Pages.SelectExportJdbcPage=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.options=i,this.options.class="selectexporttypepage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options);}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.result.copyFrom="local",this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.$btnPrevious.jqxButton({disabled:!0}),this.options.wizard.$btnNext.jqxButton({disabled:!1});},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(e){t.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this,e);var i=this;this.$local=$('<div class="selector" value="local">   <span class="brtc-va-icon file"></span>   <span class="brtc-va-label">Local</span></div>'),this.$jdbc=$('<div class="selector" value="jdbc">   <span class="brtc-va-icon grid"></span>   <span class="brtc-va-label">Relational Database</span></div>'),e.append(this.$local),e.append(this.$jdbc),this.$local.jqxRadioButton({width:"100%",height:50,theme:t.VA.Env.Theme,groupName:"Group",checked:!0}),this.$jdbc.jqxRadioButton({width:"100%",height:50,theme:t.VA.Env.Theme,groupName:"Group"}),e.find(".selector").on("checked",function(){i.refreshSelection($(this).attr("value"));}),e.perfectScrollbar();},e.prototype.refreshSelection=function(t){this.options.wizard.result.copyFrom=t,this.options.wizard.$btnNext.jqxButton({disabled:!1});},e.prototype.getParam=function(){return{copyFrom:_.isEqual(this.$local.val(),!0)?"local":"jdbc"};},t.VA.Core.Wizards.Pages.SelectExportTypePage=e;}.call(this),function(){"use strict";var t=this.Brightics;var e=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;function i(e,i){this.options=i,this.options.class="selectjdbcdatapage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options),this.options.wizard.registerEvent("changeData");}i.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),i.prototype.constructor=i,i.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.$btnPrevious.jqxButton({disabled:!1}),this.options.wizard.$btnNext.jqxButton({disabled:!1}),this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.$message.text(""),this.options.wizard.result.data=this.options.wizard.result.data||[],this.options.wizard.result.jdbc=this.options.wizard.result.jdbc||{},""!=this.$host.jqxInput("val")&&""!=this.$port.jqxInput("val")&&""!=this.$service.jqxInput("val")&&""!=this.$username.jqxInput("val")&&""!=this.$password.jqxInput("val")&&""!=this.$tablename.jqxInput("val")?this.$contentsControl.find(".connect").jqxButton({disabled:!1}):this.$contentsControl.find(".connect").jqxButton({disabled:!0});},i.prototype.createHeaderArea=function(e){t.VA.Core.Wizards.Pages.WizardPage.prototype.createHeaderArea.call(this,e),e.addClass("brtc-va-wizardpage-dataupload"),this.$wizardHeader=$('   <div class="step01">       <span class="brtc-va-icon step normal selected"></span>       <p class="step normal selected"><strong>01</strong> Select Data</p>   </div>   <div class="step02">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>02</strong> Set Delimiter</p>   </div>   <div class="step03">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>   </div>'),e.append(this.$wizardHeader);},i.prototype.refreshConnectControl=function(){this.$message.text(""),this.options.wizard.$btnNext.jqxButton({disabled:!0});var i=this.$host.val(),o=this.$port.val(),n=this.$contentsControl.find(".connect");""!=i&&""!=o&&""!=this.$service.jqxInput("val")&&""!=this.$username.jqxInput("val")&&""!=this.$password.jqxInput("val")&&""!=this.$tablename.jqxInput("val")?n.jqxButton({disabled:!(e.test(i)&&t.VA.Core.Utils.InputValidator.isValid.integerType(o)&&o<65535)}):n.jqxButton({disabled:!0});},i.prototype.createContentsArea=function(i){t.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this,i);var o=this;i.addClass("brtc-va-wizardpage-dataupload"),i.append($('   <div class="brtc-va-wizard-contents-property db-type-contents">       <div class="brtc-va-wizard-contents-property-label mandatory">DB Type :</div>       <div class="brtc-va-wizard-contents-property-input db-type" />       <input type="button" class="connect" value="Connection Test" />       <div class="message-container"><span class="message"/></div>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Host :</div>       <input type="text" class="brtc-va-wizard-contents-property-input host" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Port :</div>       <input type="text" class="brtc-va-wizard-contents-property-input port" maxlength="5"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Service :</div>       <input type="text" class="brtc-va-wizard-contents-property-input service" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Username :</div>       <input type="text" class="brtc-va-wizard-contents-property-input username" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Password :</div>       <input type="password" class="brtc-va-wizard-contents-property-input password" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property">       <div class="brtc-va-wizard-contents-property-label mandatory">Table Name :</div>       <input type="text" class="brtc-va-wizard-contents-property-input tablename" maxlength="80"/>   </div>   <div class="brtc-va-wizard-contents-property socket-timeout-contents">       <div class="brtc-va-wizard-contents-property-label">Socket :</div>       <div  class="brtc-va-wizard-contents-property-input socket-timeout"/>   </div>   <div class="brtc-va-wizard-contents-property lock-timeout-contents">       <div class="brtc-va-wizard-contents-property-label">Lock :</div>       <div  class="brtc-va-wizard-contents-property-input lock-timeout"/>   </div>   <div class="brtc-va-wizard-contents-property upload-to-contents">       <div class="brtc-va-wizard-contents-property-label">Add To :</div>       <div class="brtc-va-radio">           <div class="brtc-va-radio-button" id="upload-to-shared-jdbc" value="shared">Shared</div>       </div>       <div class="brtc-va-radio">           <div class="brtc-va-radio-button" id="upload-to-userid-jdbc" value="'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t.VA.Env.Session.userId)+'"><span>'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t.VA.Env.Session.userId)+"</span></div>       </div>   </div>")),this.$dbtype=i.find(".db-type"),this.$dbtype.jqxDropDownList({theme:t.VA.Env.Theme,height:"25px",source:["Postgre"],selectedIndex:0}),i.find(":text").jqxInput({theme:t.VA.Env.Theme,maxLength:30}),i.find(":password").jqxInput({theme:t.VA.Env.Theme,maxLength:30}),i.find(".connect").jqxButton({theme:t.VA.Env.Theme,width:150,height:27}),i.find("#upload-to-shared-jdbc").jqxRadioButton({theme:t.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:"jdbc"}),i.find("#upload-to-userid-jdbc").jqxRadioButton({theme:t.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:"jdbc",checked:!0}),i.find(".brtc-va-radio-button").on("checked",function(t){o.options.wizard.result.uploadTo=this.getAttribute("value");}),i.jqxValidator({hintType:"label",animationDuration:10,closeOnClick:!1,rules:[{input:".host",message:"[0~255].[0~255].[0~255].[0~255]",action:"keyup",rule:function rule(t,i){var n=o.findActivatedInput(t);return!!n&&e.test(n.val());}},{input:".port",message:"[0~65535]",action:"keyup",rule:function rule(e,i){var n=o.findActivatedInput(e);return!!n&&t.VA.Core.Utils.InputValidator.isValid.integerType(n.val())&&n.val()<65536;}}]}),this.$host=i.find(".host"),this.$port=i.find(".port"),this.$service=i.find(".service"),this.$username=i.find(".username"),this.$password=i.find(".password"),this.$socketTimeout=new t.VA.Core.Widget.Controls.NumericInput(i.find(".socket-timeout"),{numberType:"int",minus:!1,placeholder:"Timeout(sec) Default: 600",max:3e3}),i.find(".socket-timeout").find(".brtc-va-widgets-controls-numericInput").addClass("widthfree"),this.$lockTimeout=new t.VA.Core.Widget.Controls.NumericInput(i.find(".lock-timeout"),{numberType:"int",minus:!1,placeholder:"Timeout(sec) Default: 600",max:3e3}),i.find(".lock-timeout").find(".brtc-va-widgets-controls-numericInput").addClass("widthfree"),this.$tablename=i.find(".tablename"),this.$message=i.find(".message"),i.find(":text").on("change",function(){o.$mainControl.is(":visible")&&o.refreshConnectControl();}),i.find(":password").on("change",function(){o.$mainControl.is(":visible")&&o.refreshConnectControl();}),i.find(".connect").on("click",function(){o.refreshControlValues(),$.ajax({type:"GET",url:"api/va/v2/rsa/publickey",blocking:!0}).done(function(e){var i=new RSAKey();o.publicN=e.publicN,o.publicE=e.publicE,i.setPublic(e.publicN,e.publicE);var n=i.encrypt(o.options.wizard.result.jdbc.password),r={url:"api/va/v2/datasources/external/query",method:"POST",data:{dbtype:o.options.wizard.result.jdbc.dbtype,host:o.options.wizard.result.jdbc.host,port:o.options.wizard.result.jdbc.port,service:o.options.wizard.result.jdbc.service,username:o.options.wizard.result.jdbc.username,password:n,tablename:o.options.wizard.result.jdbc.tablename},blocking:!0};$.ajax(r).done(function(t){o.$message.text("SUCCESS"),o.options.wizard.$btnNext.jqxButton({disabled:!1});}).fail(function(e){o.$message.text("FAILED"),o.options.wizard.$btnNext.jqxButton({disabled:!0}),e.responseText.includes("does not exist")&&t.VA.Core.Utils.WidgetUtils.openErrorDialog("Table does not exist.");});}).fail(function(t){o.$message.text("FAILED"),o.options.wizard.$btnNext.jqxButton({disabled:!0});});});},i.prototype.doFinish=function(e){var i=this,o=new RSAKey();o.setPublic(i.publicN,i.publicE);var n=o.encrypt(this.options.wizard.result.jdbc.password);this.refreshControlValues(),$.ajax({url:"api/va/v2/datasources/external/schema",method:"POST",data:{dbtype:i.options.wizard.result.jdbc.dbtype,host:this.options.wizard.result.jdbc.host,port:this.options.wizard.result.jdbc.port,service:this.options.wizard.result.jdbc.service,username:this.options.wizard.result.jdbc.username,password:n,tablename:this.options.wizard.result.jdbc.tablename},blocking:!0}).done(function(o){try{i.options.wizard.result.data=[];var r=[];for(var a in o){r.push(o[a].column_name);}i.options.wizard.result.data.push(r),$.ajax({url:"api/va/v2/datasources/external/query",method:"POST",data:{dbtype:i.options.wizard.result.jdbc.dbtype,host:i.options.wizard.result.jdbc.host,port:i.options.wizard.result.jdbc.port,service:i.options.wizard.result.jdbc.service,username:i.options.wizard.result.jdbc.username,password:n,tablename:i.options.wizard.result.jdbc.tablename},blocking:!0}).done(function(t){for(var o in t){for(var n=[],a=0;a<Object.keys(t[o]).length;a++){n.push(t[o][r[a]]||"");}i.options.wizard.result.data.push(n);}i.options.wizard.triggerEvent("changeData",!0),e();}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openErrorDialog("Table does not exist.",function(){i.options.wizard.$btnNext.jqxButton({disabled:!0});});});}catch(t){}});},i.prototype.refreshControlValues=function(){this.options.wizard.result.jdbc.dbtype=this.$dbtype.jqxDropDownList("val"),this.options.wizard.result.jdbc.host=this.$host.jqxInput("val"),this.options.wizard.result.jdbc.port=this.$port.jqxInput("val"),this.options.wizard.result.jdbc.service=this.$service.jqxInput("val"),this.options.wizard.result.jdbc.username=this.$username.jqxInput("val"),this.options.wizard.result.jdbc.password=this.$password.jqxInput("val"),this.options.wizard.result.jdbc.sorckettimeout=this.$socketTimeout.getValue()||"600",this.options.wizard.result.jdbc.locktimeout=this.$lockTimeout.getValue()||"600",this.options.wizard.result.jdbc.tablename=this.$tablename.jqxInput("val");},i.prototype.destroy=function(){this.$dbtype.jqxDropDownList("destroy");},t.VA.Core.Wizards.Pages.SelectJdbcDataPage=i;}.call(this),function(){"use strict";var t=this.Brightics,e=this.LineNavigator;function i(e,i){this.options=i,this.options.class="selectlocaldatapage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options),this.options.wizard.registerEvent("changeData");}i.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),i.prototype.constructor=i,i.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.$btnPrevious.jqxButton({disabled:!1}),this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.result.fileName&&t.VA.Core.Utils.InputValidator.isValid.type4(this.options.wizard.result.fileName)?this.options.wizard.$btnNext.jqxButton({disabled:!1}):this.options.wizard.$btnNext.jqxButton({disabled:!0}),this.options.wizard.result.data=this.options.wizard.result.data||[];},i.prototype.createHeaderArea=function(t){t.addClass("brtc-va-wizardpage-dataupload"),this.$wizardHeader=$('   <div class="step01">       <span class="brtc-va-icon step normal selected"></span>       <p class="step normal selected"><strong>01</strong> Select Data</p>   </div>   <div class="step02">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>02</strong> Set Delimiter</p>   </div>   <div class="step03">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>03</strong> Set Column Data Format</p>   </div>'),t.append(this.$wizardHeader);},i.prototype.createContentsArea=function(e){e.addClass("brtc-va-wizardpage-dataupload");var i=this;this.options.wizard.result.uploadTo="shared",e.append($('   <div class="fileselect">       <div style="font-size: 13px; font-style: italic; margin-bottom: 20px;">Select data consisting of delimiter-separated values.</div>       <div class="header">           <span>File: </span>               <input for="brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename" type="button" id="fileselect-local" value="Local" />               <input type="file" id="brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename" name="fileToUpload" accept=".csv,.txt">       </div>       <div class="contents filename">           <span class="nodata">Select file to upload</span>       </div>   </div>   <div class="uploadtoselect">       <div class="header">           <span>Add to: </span>       </div>       <div class="contents">           <div class="brtc-va-radio">               <div class="brtc-va-radio-button" id="upload-to-shared-local" value="shared">Shared</div>           </div>           <div class="brtc-va-radio">               <div class="brtc-va-radio-button" id="upload-to-userid-local" value="'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t.VA.Env.Session.userId)+'"><span>'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(t.VA.Env.Session.userId)+'</span></div>           </div>       </div>   </div>   <div class="preview selectdata local">       <div class="header">           <span>Data preview</span>       </div>       <div class="contents">           <span class="nodata">no data</span>       </div>   </div>'));var o=e.find("#fileselect-local"),n=e.find("#brtc-va-wizardpage-dataupload-contents-fileselectpage-ex-filename");e.find("#upload-to-shared-local").jqxRadioButton({theme:t.VA.Env.Theme,height:25,width:100,boxSize:"18px",groupName:"local"}),e.find("#upload-to-userid-local").jqxRadioButton({theme:t.VA.Env.Theme,height:25,width:200,boxSize:"18px",groupName:"local",checked:!0}),e.find(".brtc-va-radio-button").on("checked",function(t){i.options.wizard.result.uploadTo=this.getAttribute("value");}),o.jqxButton({theme:t.VA.Env.Theme}),o.on("click",function(){n.click();}),n.on("change",function(e){$(this)[0]&&$(this)[0].files[0]&&(i.options.wizard.triggerEvent("changeData",!0),i.options.wizard.result.file=$(this)[0].files[0],i.options.wizard.result.fileName=i.options.wizard.result.file.name,window.FileReader||(i.options.wizard.result.fileName=$(this).val().split("/").pop().split("\\").pop()),t.VA.Core.Utils.InputValidator.isValid.type4(i.options.wizard.result.fileName)?(i.handleLocalFileSelected(e),i.options.wizard.$btnNext.jqxButton({disabled:!1})):(i.alertInvalid(),i.options.wizard.$btnNext.jqxButton({disabled:!0})));});},i.prototype.alertInvalid=function(){var t=this.$contentsControl.find(".filename");t.empty();t.append($('<span class="brtc-va-wizard-invalid-file-icon"></span><span class="brtc-va-wizard-invalid-file-name">※ File Name allows only the following characters: "a-z", "A-Z", "0-9", "_", ".".</span>')),this.reset(),this.refreshButton();},i.prototype.handleLocalFileSelected=function(){var i=this,o=this.$contentsControl.find(".filename");o.empty(),o.append($('<span class="brtc-va-icon brtc-va-wizardpage-dataupload file"></span><span>'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(this.options.wizard.result.fileName)+"</span>"));try{var n="Chrome"===t.VA.Core.Utils.CommonUtils.getUserBrowserName()?104857600:16777216;new e(this.options.wizard.result.file,{chunkSize:n}).readLines(0,20,function(t,e,o,n,r){i.reset(),i.updateFileSelectPreview(o);});}catch(t){i.refreshButton();}},i.prototype.updateFileSelectPreview=function(e){for(var i=this.$contentsControl.find(".preview.selectdata.local").find(".contents"),o=0,n=0;n<e.length;n++){e[n].trim()&&(i.find(".number-column").append($("<li>"+(o+1)+"</li>")),i.find(".data-column").append($("<li>"+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(e[n])+"</li>")),0!=o&&1!=o||this.options.wizard.result.data.push(e[n]),o++);}this.$parent.find(".preview").find(".contents").perfectScrollbar();},i.prototype.reset=function(){var t=this.$parent.find(".preview").find(".contents");this.options.wizard.result.data=[],$("input[type=file]").val(""),t.empty(),t.append($('<ul class="number-column"></ul>')),t.append($('<ul class="data-column"></ul>'));},i.prototype.refreshButton=function(t){},t.VA.Core.Wizards.Pages.SelectLocalDataPage=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.options=i,this.options.class="selectuploadtypepage",this.options.showNextButton=!0,t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options);}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.result.copyFrom="local",this.options.wizard.$btnFinish.jqxButton({disabled:!0}),this.options.wizard.$btnPrevious.jqxButton({disabled:!0}),this.options.wizard.$btnNext.jqxButton({disabled:!1});},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(e){t.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this,e);var i=this;this.$local=$('<div class="selector" value="local">   <span class="brtc-va-icon file"></span>   <span class="brtc-va-label">Local</span></div>'),this.$alluxio=$('<div class="selector" value="alluxio">   <span class="brtc-va-icon file"></span>   <span class="brtc-va-label">Remote</span></div>'),this.$jdbc=$('<div class="selector" value="jdbc">   <span class="brtc-va-icon grid"></span>   <span class="brtc-va-label">Relational Database</span></div>'),e.append(this.$local),e.append(this.$alluxio),e.append(this.$jdbc),this.$local.jqxRadioButton({width:"100%",height:50,theme:t.VA.Env.Theme,groupName:"Group",checked:!0}),this.$alluxio.jqxRadioButton({width:"100%",height:50,theme:t.VA.Env.Theme,groupName:"Group"}),this.$jdbc.jqxRadioButton({width:"100%",height:50,theme:t.VA.Env.Theme,groupName:"Group"}),e.find(".selector").on("checked",function(){i.refreshSelection($(this).attr("value"));}),e.perfectScrollbar();},e.prototype.refreshSelection=function(t){this.options.wizard.result.copyFrom=t,this.options.wizard.$btnNext.jqxButton({disabled:!1});},e.prototype.getParam=function(){return{copyFrom:_.isEqual(this.$local.val(),!0)?"local":_.isEqual(this.$alluxio.val(),!0)?"alluxio":"jdbc"};},t.VA.Core.Wizards.Pages.SelectUploadTypePage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.options=i,this.options.class="setcolumndatatypepage",this.columnType={double:"Double",string:"String",integer:"Integer",long:"Long",boolean:"Boolean"},t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options);var o=this;this.options.wizard.addEventListener("changeData",function(t,e){e&&(o.options.wizard.result.columnName=[],o.options.wizard.result.columnType=[],o.$grid&&(o.clearGridColumnSelection(),o.clearSearchInput(),o.removeGridColumnFilter()));}),this.options.wizard.addEventListener("changeDelimiter",function(t,e){e&&(o.options.wizard.result.columnName=[],o.options.wizard.result.columnType=[],o.$grid&&(o.clearGridColumnSelection(),o.clearSearchInput(),o.removeGridColumnFilter()));});}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.createHeaderArea=function(e){t.VA.Core.Wizards.Pages.WizardPage.prototype.createHeaderArea.call(this,e),e.addClass("brtc-va-wizardpage-dataupload"),e.append($('   <div class="step01">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>01</strong> Select Data</p>   </div>   <div class="step02">       <span class="brtc-va-icon step disabled"></span>       <p class="step disabled"><strong>02</strong> Set Delimiter</p>   </div>   <div class="step03">       <span class="brtc-va-icon step normal selected"></span>       <p class="step normal selected"><strong>03</strong> Set Column Data Format</p>   </div>'));},e.prototype.createContentsArea=function(e){t.VA.Core.Wizards.Pages.WizardPage.prototype.createContentsArea.call(this,e),this.createProgressSpinnerArea(e),this.createChangeInputArea(e),this.createGridArea(e),this.createInvalidColumnNameDetailArea(),this.createNotification();},e.prototype.createProgressSpinnerArea=function(t){this.$progress=$('   <div class="brtc-va-progress">       <div>           <span class="brtc-va-progress-loading"/>           <p>Adding data...</p>           <p class="brtc-va-progress-percent"></p>       </div></div>'),t.append(this.$progress),this.$progress.hide();},e.prototype.createChangeInputArea=function(t){t.append($('   <div style="font-size: 13px; font-style: italic; margin-bottom: 20px;">Select the column and apply your changes. After you complete the changes, click the "Finish" button to upload all the columns.</div>   <div class="header">       <span>Column name and type: </span>    </div>   <div class="brtc-va-change-input-area">       <div class="contents">           <div class="brtc-va-change-name-row">               <div class="brtc-va-change-name-label-wrapper">                  <div class="brtc-va-change-name-label">Name</div>               </div>               <div class="brtc-va-change-name-search-input-wrapper">                   <input type="search" class="brtc-va-change-name-search-input" tabIndex="101"/>               </div>               <div class="brtc-va-change-name-find-input-wrapper">                   <input type="text" class="brtc-va-change-name-find-input" tabIndex="102"/>               </div>               <div class="brtc-va-change-name-replace-input-wrapper">                   <input type="text" class="brtc-va-change-name-replace-input" tabIndex="103"/>               </div>               <div class="brtc-va-change-name-replace-button-wrapper">                   <input type="button" value="Replace" class="brtc-va-change-name-replace-button" tabIndex="104"/>               </div>           </div>           <div class="brtc-va-change-type-row">               <div class="brtc-va-change-type-label-wrapper">                   <div class="brtc-va-change-type-label">Type</div>               </div>               <div class="brtc-va-change-type-search-input-wrapper">                   <input type="search" class="brtc-va-change-type-search-input" tabIndex="105"/>               </div>               <div class="brtc-va-change-type-button-area">                  <div class="brtc-va-button-wrapper">                      <input type="button" class="brtc-va-change-button" value="String"/>                   </div>                   <div class="brtc-va-button-wrapper">                       <input type="button" class="brtc-va-change-button" value="Double"/>                   </div>                   <div class="brtc-va-button-wrapper">                       <input type="button" class="brtc-va-change-button" value="Integer"/>                   </div>                   <div class="brtc-va-button-wrapper">                       <input type="button" class="brtc-va-change-button" value="Long"/>                   </div>                   <div class="brtc-va-button-wrapper">                       <input type="button" class="brtc-va-change-button last" value="Boolean"/>                   </div>               </div>           </div>       </div>   </div>')),this.createChangeNameArea(t),this.createChangeTypeArea(t);},e.prototype.createChangeNameArea=function(t){this.createColumnSearchInput(t),this.createColumnFindInput(t),this.createColumnReplaceInput(t),this.createColumnReplaceButton(t);},e.prototype.createColumnSearchInput=function(e){var i=this;this.$columnSearchInput=e.find(".brtc-va-change-name-search-input"),this.$columnSearchInput.jqxInput({theme:t.VA.Env.Theme,width:255,height:28,placeHolder:"Search Name"}),this.$columnSearchInput.on("change",function(t){t.args&&t.args.type&&"keyboard"===t.args.type&&i.applyGridColumnNameFilter();});},e.prototype.createColumnFindInput=function(e){this.$columnFindInput=e.find(".brtc-va-change-name-find-input"),this.$columnFindInput.jqxInput({theme:t.VA.Env.Theme,width:125,height:28,placeHolder:"Find"});},e.prototype.createColumnReplaceInput=function(e){this.$columnReplaceInput=e.find(".brtc-va-change-name-replace-input"),this.$columnReplaceInput.jqxInput({theme:t.VA.Env.Theme,width:125,height:28,placeHolder:"Replace"});},e.prototype.createColumnReplaceButton=function(e){var i=this;this.$columnReplaceButton=e.find(".brtc-va-change-name-replace-button"),this.$columnReplaceButton.jqxButton({theme:t.VA.Env.Theme,width:60,height:28}),this.$columnReplaceButton.on("click",function(t){i.replaceColumnName();});},e.prototype.replaceColumnName=function(){var e=this.$grid.jqxGrid("getselectedrowindexes");if(e.length){var i=this.$columnFindInput.val(),o=this.$columnReplaceInput.val();if(i){for(var n=new RegExp(i,"g"),r=0;r<e.length;r++){e[r]>=0&&(this.options.wizard.result.columnName[e[r]]=this.options.wizard.result.columnName[e[r]].replace(n,o));}this.fillColumnGrid(),this.checkColumnNameValidation(),this.refreshGridColumnFilter(),this.showSuccessNotification("Column names were updated successfully.");}else t.VA.Core.Utils.WidgetUtils.openWarningDialog('Please enter "Find" word.');}else t.VA.Core.Utils.WidgetUtils.openWarningDialog("There is no selected column.");},e.prototype.createChangeTypeArea=function(t){this.createSearchTypeInput(t),this.createChangeTypeButtons(t);},e.prototype.createSearchTypeInput=function(e){var i=this;this.$typeSearchInput=e.find(".brtc-va-change-type-search-input"),this.$typeSearchInput.jqxInput({theme:t.VA.Env.Theme,width:255,height:28,placeHolder:"Search Type"}),this.$typeSearchInput.on("change",function(t){t.args&&t.args.type&&"keyboard"===t.args.type&&i.applyGridColumnTypeFilter();});},e.prototype.createChangeTypeButtons=function(e){var i=this;this.$typeChangeButtons=e.find(".brtc-va-change-button"),this.$typeChangeButtons.jqxButton({theme:t.VA.Env.Theme,width:60,height:28}),this.$typeChangeButtons.on("click",function(t){i.changeColumnType($(this).attr("value"));});},e.prototype.changeColumnType=function(e){var i=this.$grid.jqxGrid("getselectedrowindexes");if(i.length){for(var o=0;o<i.length;o++){i[o]>=0&&(this.options.wizard.result.columnType[i[o]]=e);}this.fillColumnGrid(),this.refreshGridColumnFilter(),this.showSuccessNotification("Column types were updated successfully.");}else t.VA.Core.Utils.WidgetUtils.openWarningDialog("There is no selected column.");},e.prototype.clearSearchInput=function(){this.clearColumnSearchInput(),this.clearFindInput(),this.clearReplaceInput(),this.clearTypeSearchInput();},e.prototype.clearColumnSearchInput=function(){this.$columnSearchInput.val("");},e.prototype.clearFindInput=function(){this.$columnFindInput.val("");},e.prototype.clearReplaceInput=function(){this.$columnReplaceInput.val("");},e.prototype.clearTypeSearchInput=function(){this.$typeSearchInput.val("");},e.prototype.createGridArea=function(t){t.append($('   <div class="brtc-va-grid-area">       <div class="contents">           <div class="columns-table" tabIndex="-1"></div>       </div>       <div class="brtc-va-wizard-message-area">           <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>           <div class="brtc-va-wizard-message-label"></div>           <div class="brtc-va-wizard-message-show-detail">Detail</div>       </div>   </div>')),this.$messageArea=t.find(".brtc-va-wizard-message-area"),this.$messageDetailArea=t.find(".brtc-va-wizard-message-show-detail"),this.createColumnGrid(t);},e.prototype.createColumnGrid=function(e){var i=this;this._invalidConlumnNameMap={};var o=$('<div class="brtc-va-setcolumndatatype-preview-column-grid" tabIndex="-1"></div>');e.find(".columns-table").append(o);var n=this._getGridDataAdapter();this.dataAdapter=n,this.$grid=o.jqxGrid({theme:t.VA.Env.Theme,width:619,height:215,rowsheight:25,source:this.dataAdapter,selectionmode:"checkbox",filterable:!1,editable:!0,keyboardnavigation:!1,columnsresize:!0,columns:[{text:"No.",sortable:!1,filterable:!1,editable:!1,groupable:!1,draggable:!1,resizable:!1,datafield:"",columntype:"number",width:50,cellsrenderer:function cellsrenderer(t,e,i){return'<div style="margin:4px;">'+(t+1)+"</div>";}},{text:"Name",datafield:"column-name",filtertype:"input",editable:!0,filterable:!1,cellsrenderer:function cellsrenderer(t,e,o){var n=$('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');return n.attr("title",o),n.text(o),i._invalidConlumnNameMap[t].length>0?n.css("color","rgba(194, 6, 17, .65)"):n.css("color","#000"),$("<div>").append(n.clone()).html();}},{text:"Type",datafield:"column-type",displayfield:"column-type-dropdown",columntype:"dropdownlist",filtertype:"checkedlist",filterable:!1,editable:!0,createeditor:function createeditor(t,e,o){o.jqxDropDownList({source:i._getDropDownAdapter(),displayMember:"label",valueMember:"value"}),o.css("margin-left","1px"),o.css("margin-top","1px"),o.css("height",o.height-2+"px");}},{text:"First Data",datafield:"column-data",editable:!1,filterable:!1,cellsrenderer:function cellsrenderer(t,e,i){var o=$('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');return o.attr("title",i),o.text(i),$("<div>").append(o.clone()).html();}},{text:"Error Message",datafield:"column-name-invalid",editable:!1,filterable:!1,hidden:!0,cellsrenderer:function cellsrenderer(t,e,o){if(0===i._invalidConlumnNameMap[t].length)return"";var n=$('<div class="jqx-grid-cell-left-align" style="margin-top: 5.5px;"></div>');return n.attr("title",o),n.text(i._invalidConlumnNameMap[t].join(" ")),$("<div>").append(n.clone()).html();}}]}),this.$grid.on("cellendedit",function(t){var e=t.args.rowindex;"column-name"===t.args.datafield?i.options.wizard.result.columnName[e]!=t.args.value&&(i.options.wizard.result.columnName[e]=t.args.value,i._createCountOfColumnNameMap(),i._setInvalidColumnNameMapByRow(e,t.args.value),i.$grid.jqxGrid({source:i._getGridDataAdapter()}),setTimeout(function(){i.checkColumnNameValidation(),i.refreshGridColumnFilter(),i.showSuccessNotification("Column name was updated successfully.");},300)):"column-type"===t.args.datafield&&i.options.wizard.result.columnType[e]!=t.args.value.value&&(i.options.wizard.result.columnType[e]=t.args.value.value,setTimeout(function(){i.refreshGridColumnFilter(),i.showSuccessNotification("Column type was updated successfully.");},300));}),this.$grid.on("filter",function(t){var e=i.$grid.jqxGrid("getdisplayrows");if(e.length){var o={},n=[],r=$.extend(!0,[],i.$grid.jqxGrid("getselectedrowindexes"));e.forEach(function(t){o[t.uid]=!0;});for(var a=0;a<r.length;a++){o.hasOwnProperty(r[a])&&n.push(r[a]);}i.$grid.jqxGrid({selectedrowindexes:n});}else i.clearGridColumnSelection();i.$grid.jqxGrid("refreshdata");}),this.$grid.on("keydown",function(t){9==t.keyCode&&($(t.target).parents(".brtc-va-setcolumndatatype-preview-column-grid").length||$(t.target).hasClass("brtc-va-setcolumndatatype-preview-column-grid"))&&(t.preventDefault(),t.stopPropagation());});},e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.$btnPrevious.jqxButton({disabled:!1}),this.options.wizard.$btnNext.jqxButton({disabled:!0}),this.options.wizard.$btnFinish.jqxButton({disabled:!1}),this.options.wizard.result.columnName=this.options.wizard.result.columnName||[],this.options.wizard.result.columnType=this.options.wizard.result.columnType||[],this.extractColumnName(),this.checkColumnNameValidation(),this.extractColumnType(),this.fillColumnGrid();},e.prototype.extractColumnName=function(){if(this.options.wizard.result.columnName&&0===this.options.wizard.result.columnName.length&&this.options.wizard.result.data[0]){var t,e=this.options.wizard.result.data;if(e[0]&&e[0].length)t=$.isArray(e[0])?e[0]:e[0].split(this.options.wizard.result.delimiter||","),this.options.wizard.result.columnName=t;}},e.prototype.extractColumnType=function(){if(this.options.wizard.result.columnName&&0!==this.options.wizard.result.columnName.length){var t=this.options.wizard.result.columnName,e=this.options.wizard.result.columnType,i=this.options.wizard.result.data;this.dataArray=void 0,$.isArray(i[0])?this.dataArray=i[1]||[]:(this.dataArray=[],this.options.wizard.result.data[1]&&(this.dataArray=this.options.wizard.result.data[1].split(this.options.wizard.result.delimiter||",")));for(var o=0;o<t.length;o++){void 0===e[o]&&(e[o]=this.columnType.string,this.dataArray[o]&&$.isNumeric(this.dataArray[o])&&(e[o]=this.columnType.double));}}},e.prototype.fillColumnGrid=function(){var t=this._getGridDataAdapter();this.$grid.jqxGrid({source:t});},e.prototype._getGridDataAdapter=function(){var t={localdata:this._getGridData(),datatype:"array",datafields:[{name:"column-name",type:"string"},{name:"column-type",type:"string"},{name:"column-data",type:"string"},{name:"column-type-dropdown",value:"column-type",values:{source:this._getDropDownAdapter().records,value:"value",name:"label"}},{name:"column-name-invalid",type:"string"}]};return new $.jqx.dataAdapter(t);},e.prototype._getGridData=function(){var t=[],e=this;if(this.dataArray&&this.options.wizard.result.columnName&&0!==this.options.wizard.result.columnName.length){var i=this.options.wizard.result.columnName,o=this.options.wizard.result.columnType,n=this.dataArray;this._createCountOfColumnNameMap(),t=$.map(i,function(t,i){return e._setInvalidColumnNameMapByRow(i,t),{"column-name":t,"column-type":o[i],"column-data":n[i],"column-name-invalid":e._invalidConlumnNameMap[i].length>0?e._invalidConlumnNameMap[i]:""};});}return t;},e.prototype._setInvalidColumnNameMapByRow=function(t,e){this._invalidConlumnNameMap[t]=[];var i=this._invalidConlumnNameMap[t];this._isColumnNameEmpty(e)?i.push("Column name cannot be empty."):(this._hasSpaceChar(e)&&i.push("Column name cannot ues white space."),this._hasInvalidChar(e)&&i.push("You can use alphabet, number, and '_' only."),this._isStartedNumber(e)&&i.push("Column name should start with alphabet characters."),this._hasDuplicatedColumnName(e)&&i.push("Some columns have same name."));},e.prototype._createCountOfColumnNameMap=function(){this._countOfColumnNameMap={};for(var t=this.options.wizard.result.columnName,e=0;e<t.length;e++){this._countOfColumnNameMap[t[e]]=this._countOfColumnNameMap[t[e]]+1||1;}},e.prototype._getDropDownAdapter=function(){var t={datatype:"array",datafields:[{name:"label",type:"string"},{name:"value",type:"string"}],localdata:[{value:"Double",label:"Double"},{value:"String",label:"String"},{value:"Integer",label:"Integer"},{value:"Long",label:"Long"},{value:"Boolean",label:"Boolean"}]};return new $.jqx.dataAdapter(t,{autoBind:!0});},e.prototype.getColumnNameArray=function(){this.options.wizard.result.columnName=[],this.$grid.jqxGrid("removefilter","column-name"),this.$grid.jqxGrid("removefilter","column-type");for(var t=this.$grid.jqxGrid("getrows"),e=0;e<t.length;e++){this.options.wizard.result.columnName.push(t[e]["column-name"].trim());}return this.options.wizard.result.columnName;},e.prototype.getColumnTypeArray=function(){this.options.wizard.result.columnType=[],this.$grid.jqxGrid("removefilter","column-name"),this.$grid.jqxGrid("removefilter","column-type");for(var t=this.$grid.jqxGrid("getrows"),e=0;e<t.length;e++){this.options.wizard.result.columnType.push(t[e]["column-type"]);}return this.options.wizard.result.columnType;},e.prototype.clearGridColumnSelection=function(){this.$grid.jqxGrid("clearselection");},e.prototype.refreshGridColumnFilter=function(){this.$grid.jqxGrid("applyfilters"),this.$grid.jqxGrid("refresh");},e.prototype.removeGridColumnFilter=function(){this.removeGridColumnNameFilter(),this.removeGridColumnTypeFilter();},e.prototype.removeGridColumnNameFilter=function(){this.$grid.jqxGrid("removefilter","column-name");},e.prototype.removeGridColumnTypeFilter=function(){this.$grid.jqxGrid("removefilter","column-type");},e.prototype.removeInvalidColumnNameFilter=function(){this.$grid.jqxGrid("removefilter","column-name-invalid");},e.prototype.applyGridColumnNameFilter=function(){this.removeGridColumnNameFilter();var t=this.$contentsControl.find(".brtc-va-change-name-search-input").val();if(t){var e=this.getGridFilterGroup(t);this.$grid.jqxGrid("addfilter","column-name",e),this.$grid.jqxGrid("applyfilters");}},e.prototype.applyGridColumnTypeFilter=function(){this.removeGridColumnTypeFilter();var t=this.$contentsControl.find(".brtc-va-change-type-search-input").val();if(t){var e=this.getGridFilterGroup(t);this.$grid.jqxGrid("addfilter","column-type",e),this.$grid.jqxGrid("applyfilters");}},e.prototype.applyInvalidColumnNameFilter=function(){this.removeInvalidColumnNameFilter(),this.dataAdapter=this._getGridDataAdapter(),this.dataAdapter.dataBind(),this.$grid.jqxGrid("updatebounddata");var t=this.getGridEmptyFilterGroup();this.$grid.jqxGrid("addfilter","column-name-invalid",t),this.$grid.jqxGrid("applyfilters");},e.prototype.getGridEmptyFilterGroup=function(){var t=new $.jqx.filter(),e=t.createfilter("stringfilter","","NOT_EMPTY");return t.addfilter(1,e),t;},e.prototype.getGridFilterGroup=function(t){var e=new $.jqx.filter(),i=t,o=e.createfilter("stringfilter",i,"contains");return e.addfilter(1,o),e;},e.prototype.handleError=function(e){var i=this;t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e,function(){i.$progress.hide(),i.options.wizard.$btnFinish.jqxButton({disabled:!1}),i.options.wizard.$btnPrevious.jqxButton({disabled:!1});});},e.prototype.createInvalidColumnNameDetailArea=function(){var e=this;this.$messageDetailArea.jqxCheckBox({theme:t.VA.Env.Theme}),this.$messageDetailArea.on("change",function(t){t.args.checked?(e.$grid.jqxGrid("hidecolumn","column-data"),e.$grid.jqxGrid("showcolumn","column-name-invalid"),e.applyInvalidColumnNameFilter()):(e.$grid.jqxGrid("hidecolumn","column-name-invalid"),e.$grid.jqxGrid("showcolumn","column-data"),e.removeInvalidColumnNameFilter());});},e.prototype.checkColumnNameValidation=function(){return this.validationMessage="",this.$messageArea.hide(),this.checkColumnEmpty(),this.checkColumnNameEmpty(),this.checkColumnNameCharacter(),this._createCountOfColumnNameMap(),this.checkDuplicatedColumnName(),this.validationMessage&&(this.$messageArea.find(".brtc-va-wizard-message-label").text(this.validationMessage),this.$messageArea.show()),this.validationMessage;},e.prototype.checkColumnEmpty=function(){this.validationMessage||0===this.options.wizard.result.columnName.length&&(this.validationMessage="There is no column. Please check column.");},e.prototype._isColumnNameEmpty=function(t){return!t;},e.prototype.checkColumnNameEmpty=function(){if(!this.validationMessage)for(var t in this.options.wizard.result.columnName){if(this._isColumnNameEmpty(this.options.wizard.result.columnName[t])){this.validationMessage="Column name cannot be empty. Please check column name.";break;}}},e.prototype._isInvalidChar=function(t){var e=new RegExp("^[a-zA-Z0-9_]+$"),i=new RegExp("^[0-9]+");return!e.test(t)||i.test(t);},e.prototype._hasSpaceChar=function(t){return new RegExp(" +").test(t);},e.prototype._hasInvalidChar=function(t){return!new RegExp("^[a-zA-Z0-9_ ]+$").test(t);},e.prototype._isStartedNumber=function(t){return new RegExp("^[0-9]+").test(t);},e.prototype.checkColumnNameCharacter=function(){if(!this.validationMessage)for(var t in this.options.wizard.result.columnName){if(this._isInvalidChar(this.options.wizard.result.columnName[t])){this.validationMessage="All column names should start with alphabet characters. You can use alphabet, number, and '_' only.";break;}}},e.prototype._hasDuplicatedColumnName=function(t){return this._countOfColumnNameMap[t]>1;},e.prototype.checkDuplicatedColumnName=function(){if(!this.validationMessage)for(var t in this.options.wizard.result.columnName){if(this._hasDuplicatedColumnName(this.options.wizard.result.columnName[t])){this.validationMessage="Some columns have same name. Please column name.";break;}}},e.prototype.showSuccessNotification=function(t){this.notification("success",t);},e.prototype.createNotification=function(){this.$notificationContainer=$(crel("div",{class:"brtc-va-dialogs-notification-container"})),this.$notificationContent=$(crel("div",{class:"brtc-va-dialogs-notification-content"})),this.$notification=$(crel("div",{class:"brtc-va-dialogs-notification"},this.$notificationContent[0])),this.$parent.append(this.$notificationContainer,this.$notification),this.$notification.jqxNotification({theme:t.VA.Env.Theme,appendContainer:this.$notificationContainer,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:3e3,template:"info"});},e.prototype.notification=function(t,e){this.$notificationContainer.empty(),this.$notificationContent.html(e),this.$notification.jqxNotification({template:t}),this.$notification.jqxNotification("open");},e.prototype.doFinish=function(){var e=this,i=this.getColumnNameArray(),o=this.getColumnTypeArray();if(this.checkColumnNameValidation())t.VA.Core.Utils.WidgetUtils.openErrorDialog(this.validationMessage,function(){});else{if(e.progress(!0,"Adding data..."),this.path="","shared"===e.options.wizard.result.uploadTo?this.path="/"+e.options.wizard.result.uploadTo+"/upload/"+e.options.wizard.result.fileName:this.path="/"+t.VA.Env.Session.userId+"/upload/"+e.options.wizard.result.fileName,"local"===this.options.wizard.result.copyFrom){var n=this.$progress.find(".brtc-va-progress-percent"),r=new FormData();r.append("column-name",'["'+i.join('","')+'"]'),r.append("column-type",'["'+o.join('","')+'"]'),r.append("delimiter",'"'+e.options.wizard.result.delimiter+'"'),r.append("path",this.path),r.append("attach",this.options.wizard.result.file),$.ajax({url:"api/va/v2/data/upload",type:"POST",mimeType:"multipart/form-data",data:r,cache:!1,contentType:!1,processData:!1,blocking:!1,xhr:function xhr(){var t=$.ajaxSettings.xhr();return t.upload.onprogress=function(t){var e=t.loaded/t.total*100;"number"==typeof e&&n.text(e.toFixed(1)+" %");},t;}}).done(function(t){e.progress(!1);}).fail(function(t){e.handleError(t);});}if("alluxio"===this.options.wizard.result.copyFrom){var a={inputpath:this.options.wizard.result.remotePath,path:this.path,columnname:i,columntype:o,delimiter:this.options.wizard.result.delimiter},s={url:"api/va/v2/data/import",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),blocking:!1};$.ajax(s).done(function(){e.progress(!1);}).fail(function(t){e.handleError(t);});}"jdbc"===this.options.wizard.result.copyFrom&&this.uploadFormattedAlluxio({});}},e.prototype.uploadFormattedAlluxio=function(t){var e=this,i=this.createImportDataOption(t),o=function o(t){e._checkProgress(i.user,t).done(function(i){"PROCESSING"==i.status?setTimeout(o.bind(e,t),3e3):"SUCCESS"==i.status?e.progress(!1):e.progress(!1,i.message||"Failed to upload.");}).fail(function(t){e.handleError(t);});},n={url:"api/va/v2/analytics/jobs/execute",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),blocking:!1};$.ajax(n).done(function(t){var i=JSON.parse(t).result;setTimeout(o.bind(e,i),3e3);}).fail(function(t){e.handleError(t);});},e.prototype.createImportDataOption=function(){var e="shared"===this.options.wizard.result.uploadTo?"/shared/upload/":"/"+t.VA.Env.Session.userId+"/upload/",i=this.getColumnNameArray(),o=this.getColumnTypeArray(),n="va_mimportdata_"+moment(Date.now()).format("YYYYMMDDHHmmssSSS"),r={fid:"fimportdata",func:"importData",name:"ImportData",label:"Import Data",persist:!0,"persist-mode":"auto"};return r.param={"copy-from":"jdbc",columns:i.join(","),"column-type":o,ip:this.options.wizard.result.jdbc.host,port:this.options.wizard.result.jdbc.port,"output-path":e+this.options.wizard.result.jdbc.tablename,"db-type":this.options.wizard.result.jdbc.dbtype.toLowerCase(),username:this.options.wizard.result.jdbc.username,password:this.options.wizard.result.jdbc.password,"db-name":this.options.wizard.result.jdbc.service,"table-name":this.options.wizard.result.jdbc.tablename,"socket-timeout":this.options.wizard.result.jdbc.sorckettimeout,"lock-timeout":this.options.wizard.result.jdbc.locktimeout,delimiter:""},t.VA.Core.Utils.RunnableFactory.createForDummy(r,n,t.VA.Env.Session.userId);},e.prototype._checkProgress=function(t,e){var i={url:"api/va/v2/analytics/jobs/"+e,type:"GET",blocking:!1};return $.ajax(i);},e.prototype.progress=function(e,i){var o=this;e?(this.$progress.show(),this.options.wizard.$btnFinish.jqxButton({disabled:e})):(this.$progress.hide(),i?t.VA.Core.Utils.WidgetUtils.openErrorDialog(i,function(){o.options.wizard.$btnFinish.jqxButton({disabled:e});}):t.VA.Core.Utils.WidgetUtils.openInformationDialog("Add data success!",function(){o.options.wizard.dialogResult.OK=!0,o.options.wizard.dialogResult.Cancel=!1,o.options.wizard.dialogResult.path=o.path,o.$parent.parent().dialog("close");})),this.options.wizard.$btnPrevious.jqxButton({disabled:e});},e.prototype.destroy=function(){this.$grid.find(".jqx-dropdownlist-state-normal").each(function(){$(this).jqxDropDownList("destroy");}),this.$grid.jqxGrid("destroy");},t.VA.Core.Wizards.Pages.SetColumnDataTypePage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.options=i,this.options.class="setdownloaddelimiterpage",t.VA.Core.Wizards.Pages.WizardPage.call(this,e,this.options);}e.prototype=Object.create(t.VA.Core.Wizards.Pages.WizardPage.prototype),e.prototype.constructor=e,e.prototype.init=function(){t.VA.Core.Wizards.Pages.WizardPage.prototype.init.call(this),this.options.wizard.result.delimiters={delimiter:",","array-delimiter":";","key-value-delimiter":":","quote-delimiter":'"'},this.delimiterMap={comma:",",tab:"\t",semicolon:";",colon:":",space:" "};},e.prototype.createHeaderArea=function(t){},e.prototype.createContentsArea=function(t){this.createTableSelectorArea(t),this.createColumnDelimiterArea(t),this.createFileNameArea(t);},e.prototype.createTableSelectorArea=function(e){var i=this;e.append($('<div class="">   <div class="header">       <span>Table Selector</span>    </div>    <div class="contents">        <div class="table-selector">        </div>   </div></div>'));var o=e.find(".table-selector").jqxDropDownList({theme:t.VA.Env.Theme,autoDropDownHeight:!0,width:"611px",selectedIndex:0,source:this.options.wizard.options.downloaderOptions.tableObjList});i.options.wizard.result.tid=o.jqxDropDownList("getSelectedItem").value,e.find(".table-selector").on("change",function(t){i.options.wizard.result.tid=t.args.item.value;});},e.prototype.createFileNameArea=function(e){var i=this;e.append($('<div class="">   <div class="header">       <span>File Name</span>    </div>    <div class="contents">        <div class="brtc-va-input-wrapper">        <input type="text" class="brtc-va-input-file-name"  maxlength="80"/>        </div>   </div></div>')),e.find(".brtc-va-input-wrapper .brtc-va-input-file-name").jqxInput({theme:t.VA.Env.Theme,width:"611px",height:26,placeHolder:i.options.wizard.options.downloaderOptions.fileName}),e.find(".brtc-va-input-wrapper .brtc-va-input-file-name").on("change",function(t){var o=e.find(".brtc-va-input-wrapper .brtc-va-input-file-name").val().trim();i.options.wizard.result.fileName=o.replace(/\s/g,"_");});},e.prototype.createColumnDelimiterArea=function(e){var i,o=this;e.append($('<div class="delimiterselect brtc-va-column-delimiter">   <div class="header">       <span>Column Delimiter</span>    </div>    <div class="contents">        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-comma" value="comma">Comma</div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-tab" value="tab"><span>Tab</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-space" value="space"><span>Space</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-colon" value="colon"><span>Colon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input"  maxlength="80"/></div></div>        </div>   </div></div>')),e.find(".brtc-va-column-delimiter .brtc-va-radio-button").jqxRadioButton({theme:t.VA.Env.Theme,height:26,width:103,boxSize:"18px",groupName:"delimiter"}),e.find(".brtc-va-column-delimiter .brtc-va-radio-button[value=comma]").jqxRadioButton("check"),e.find(".brtc-va-column-delimiter .jqx-radiobutton").on("change",function(t){if(o.options.wizard.result.delimiters.delimiter&&""!==o.options.wizard.result.delimiters.delimiter&&(i=o.options.wizard.result.delimiters.delimiter),"INPUT"==t.target.tagName)o.options.wizard.result.delimiters.delimiter=e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").val();else if(t.args.checked){var n=t.target.getAttribute("value");o.options.wizard.result.delimiters.delimiter="other"==n?e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").val():o.delimiterMap[n];}for(var r in o.options.wizard.result.delimiters){"delimiter"!==r&&o.options.wizard.result.delimiters[r]===o.options.wizard.result.delimiters.delimiter&&(o.options.wizard.result.delimiters[r]=i);}}),e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").jqxInput({theme:t.VA.Env.Theme,width:73,height:24}),e.find(".brtc-va-column-delimiter .brtc-va-radio-button[value=other]").on("checked",function(){e.find(".brtc-va-column-delimiter .brtc-va-delimiter-input").jqxInput("focus");});},e.prototype.createArrayDateDelimiterArea=function(e){var i=this;e.append($('<div class="delimiterselect brtc-va-array-delimiter">   <div class="header">       <span>Array Data Delimiter</span>    </div>    <div class="contents">        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-comma" value="comma">Comma</div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-tab" value="tab"><span>Tab</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-space" value="space"><span>Space</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-colon" value="colon"><span>Colon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="array-delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>        </div>   </div></div>')),e.find(".brtc-va-array-delimiter .brtc-va-radio-button").jqxRadioButton({theme:t.VA.Env.Theme,height:26,width:103,boxSize:"18px",groupName:"array-delimiter"}),e.find(".brtc-va-array-delimiter .brtc-va-radio-button[value=semicolon]").jqxRadioButton("check"),e.find(".brtc-va-array-delimiter .jqx-radiobutton").on("change",function(t){if("INPUT"==t.target.tagName)i.options.wizard.result.delimiters["array-delimiter"]=e.find(".brtc-va-array-delimiter .brtc-va-delimiter-input").val();else if(t.args.checked){var o=t.target.getAttribute("value");i.options.wizard.result.delimiters["array-delimiter"]="other"==o?e.find(".brtc-va-array-delimiter .brtc-va-delimiter-input").val():i.delimiterMap[o];}}),e.find(".brtc-va-array-delimiter .brtc-va-delimiter-input").jqxInput({theme:t.VA.Env.Theme,width:73,height:24}),e.find(".brtc-va-array-delimiter .brtc-va-radio-button[value=other]").on("checked",function(){e.find(".brtc-va-array-delimiter .brtc-va-delimiter-input").jqxInput("focus");});},e.prototype.createKeyValueDataDelimiterArea=function(e){var i=this;e.append($('<div class="delimiterselect brtc-va-key-value-delimiter">   <div class="header">       <span>Key Value Data Delimiter</span>    </div>    <div class="contents">        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-comma" value="comma">Comma</div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-tab" value="tab"><span>Tab</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-space" value="space"><span>Space</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-colon" value="colon"><span>Colon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="key-value-delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>        </div>   </div></div>')),e.find(".brtc-va-key-value-delimiter .brtc-va-radio-button").jqxRadioButton({theme:t.VA.Env.Theme,height:26,width:103,boxSize:"18px",groupName:"key-value-delimiter"}),e.find(".brtc-va-key-value-delimiter .brtc-va-radio-button[value=colon]").jqxRadioButton("check"),e.find(".brtc-va-key-value-delimiter .jqx-radiobutton").on("change",function(t){if("INPUT"==t.target.tagName)i.options.wizard.result.delimiters["key-value-delimiter"]=e.find(".brtc-va-key-value-delimiter .brtc-va-delimiter-input").val();else if(t.args.checked){var o=t.target.getAttribute("value");i.options.wizard.result.delimiters["key-value-delimiter"]="other"==o?e.find(".brtc-va-key-value-delimiter .brtc-va-delimiter-input").val():i.delimiterMap[o];}}),e.find(".brtc-va-key-value-delimiter .brtc-va-delimiter-input").jqxInput({theme:t.VA.Env.Theme,width:73,height:24}),e.find(".brtc-va-key-value-delimiter .brtc-va-radio-button[value=other]").on("checked",function(){e.find(".brtc-va-key-value-delimiter .brtc-va-delimiter-input").jqxInput("focus");});},e.prototype.createQuoteDelimiterArea=function(e){var i=this;e.append($('<div class="delimiterselect brtc-va-quote-delimiter">   <div class="header">       <span>Quote Delimiter</span>    </div>    <div class="contents">        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-comma" value="comma">Comma</div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-tab" value="tab"><span>Tab</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-space" value="space"><span>Space</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-colon" value="colon"><span>Colon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-semicolon" value="semicolon"><span>SemiColon</span></div>        </div>        <div class="brtc-va-radio">            <div class="brtc-va-radio-button selectdelimiter" id="quote-delimiter-other" value="other"><div class="brtc-va-delimiter-input-wrapper"><input type="text" class="brtc-va-delimiter-input" maxlength="80"/></div></div>        </div>   </div></div>')),e.find(".brtc-va-quote-delimiter .brtc-va-radio-button").jqxRadioButton({theme:t.VA.Env.Theme,height:26,width:103,boxSize:"18px",groupName:"quote-delimiter"}),e.find(".brtc-va-quote-delimiter .brtc-va-radio-button[value=other]").jqxRadioButton("check"),e.find(".brtc-va-quote-delimiter .jqx-radiobutton").on("change",function(t){if("INPUT"==t.target.tagName)i.options.wizard.result.delimiters["quote-delimiter"]=e.find(".brtc-va-quote-delimiter .brtc-va-delimiter-input").val();else if(t.args.checked){var o=t.target.getAttribute("value");i.options.wizard.result.delimiters["quote-delimiter"]="other"==o?e.find(".brtc-va-quote-delimiter .brtc-va-delimiter-input").val():i.delimiterMap[o];}}),e.find(".brtc-va-quote-delimiter .brtc-va-delimiter-input").jqxInput({theme:t.VA.Env.Theme,width:73,height:24,value:'"'}),e.find(".brtc-va-quote-delimiter .brtc-va-radio-button[value=other]").on("checked",function(){e.find(".brtc-va-quote-delimiter .brtc-va-delimiter-input").jqxInput("focus");});},e.prototype.destroy=function(){this.$parent.find(".table-selector").jqxDropDownList("destroy");},t.VA.Core.Wizards.Pages.SetDownloadDelimiterPage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.pages=[],this.result={},this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){var e=this;this.$mainControl=$('<div class="brtc-va-wizard-main">   <div class="brtc-va-wizard-body"></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$mainControl.dialog({theme:t.VA.Env.Theme,title:this.options.title,width:675,height:this.options.height||620,maxHeight:this.options.maxHeight,modal:!0,resizable:!1,closeOnEscape:!1,close:function close(){"function"==typeof e.options.close&&e.options.close(e.dialogResult),e.close();},keyboardCloseKey:""}),this.$mainControl.addClass(this.options.class),this.$mainControl.attr("name",this.$mainControl.parent().find("span.ui-dialog-title").text()),this.initContents(),this.initPage(),this.setFocus();},e.prototype.close=function(){this.$mainControl.dialog("destroy"),this.$mainControl.remove();},e.prototype.initContents=function(){this.createContentsArea(this.$mainControl.find(".brtc-va-wizard-body")),this.createButtonArea(this.$mainControl.find(".brtc-va-wizard-body"));},e.prototype.initPage=function(){if(this.pages.length>0){this.pages[0].show(),this.currentPage=this.pages[0],this.currentPage.init();for(var t=1;t<this.pages.length;t++){this.pages[t].hide();}}this.initButton(this.currentPage);},e.prototype.addPage=function(t){this.pages.push(t);},e.prototype.setFocus=function(){},e.prototype.createButtonArea=function(e){var i=this;this.$buttonArea=$('<div class="brtc-va-wizard-buttonarea">   <input type="button" class="finish" value="Finish"/>   <input type="button" class="next" value="Next"/>   <input type="button" class="previous" value="Previous"/></div>'),e.append(this.$buttonArea),this.$buttonArea.find(":button").jqxButton({theme:t.VA.Env.Theme}),this.$btnPrevious=this.$buttonArea.find(".previous"),this.$btnPrevious.on("click",function(){i.handlePrevious();}),this.$btnPrevious.hide(),this.$btnNext=this.$buttonArea.find(".next"),this.$btnNext.on("click",function(){i.handleNext();}),this.$btnNext.hide(),this.$btnFinish=this.$buttonArea.find(".finish"),this.$btnFinish.on("click",function(){i.handleFinish();}),this.$btnFinish.hide();},e.prototype.handlePrevious=function(){this.currentPage&&(this.currentPage.hide(),this.currentPage=this.getPreviousPage(this.currentPage),this.currentPage.show(),this.currentPage.init(),this.initButton(this.currentPage));},e.prototype.handleNext=function(){var t=this;this.currentPage.doFinish(function(){t.currentPage&&(t.currentPage.hide(),t.currentPage=t.getNextPage(t.currentPage),t.currentPage.show(),t.currentPage.init(),t.initButton(t.currentPage));});},e.prototype.handleFinish=function(){},e.prototype.initButton=function(t){var e=t?t.options:{showPreviousButton:!1,showNextButton:!1,showFinishButton:!1};e.showPreviousButton?this.$btnPrevious.show():this.$btnPrevious.hide(),e.showNextButton?this.$btnNext.show():this.$btnNext.hide(),e.showFinishButton?this.$btnFinish.show():this.$btnFinish.hide();},e.prototype.getNextPage=function(t){var e=this.pages.indexOf(t);return e<this.pages.length-1?this.pages[e+1]:null;},e.prototype.getPreviousPage=function(t){var e=this.pages.indexOf(t);return e>0?this.pages[e-1]:null;},t.VA.Core.Wizards.Wizard=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.parentId=e,this.options=i,this.options.title="Data Download",this.options.class="datadownloadwizard",this.dialogResult={OK:!1,Cancel:!0},t.VA.Core.Wizards.Wizard.call(this,e,this.options);}e.prototype=Object.create(t.VA.Core.Wizards.Wizard.prototype),e.prototype.constructor=e,e.prototype.createContentsArea=function(e){e.css({"padding-left":"19px","padding-right":"19px"}),this.setDownloadDelimiterPage=new t.VA.Core.Wizards.Pages.SetDownloadDelimiterPage(e,{wizard:this,showPreviousButton:!1,showNextButton:!1,showFinishButton:!0}),this.addPage(this.setDownloadDelimiterPage),this.downloadLoadingPage=new t.VA.Core.Wizards.Pages.DownloadLoadingPage(e,{wizard:this,showPreviousButton:!1,showNextButton:!1,showFinishButton:!1,loadingText:"Preparing..."}),this.addPage(this.downloadLoadingPage);},e.prototype.getNextPage=function(t){return t===this.setDownloadDelimiterPage?this.downloadLoadingPage:t===this.downloadLoadingPage?null:void 0;},e.prototype.getPreviousPage=function(t){return t===this.setDownloadDelimiterPage?null:t===this.downloadLoadingPage?this.setDownloadDelimiterPage:void 0;},e.prototype.handleFinish=function(){var e=this.setDownloadDelimiterPage.options.wizard.result.delimiters.delimiter,i=this.setDownloadDelimiterPage.options.wizard.options.downloaderOptions.fileName,o=this.setDownloadDelimiterPage.options.wizard.result.fileName;e?/[~!@\#$%^&*\()\[\]\{\}=+'";:?`|\\\/]/gi.test(o||i)?t.VA.Core.Utils.WidgetUtils.openInformationDialog("File names can not contain special characters."):this.handleNext():t.VA.Core.Utils.WidgetUtils.openInformationDialog("Delimiter should not be empty.");},e.prototype.close=function(){this.setDownloadDelimiterPage.destroy(),t.VA.Core.Wizards.Wizard.prototype.close.call(this);},t.VA.Core.Wizards.DataDownloadWizard=e;}.call(this),function(){"use strict";var t=this.Brightics;var e="false"!==this.useSpark;function i(i,o){this.parentId=i,this.options=o,this.options.title="Data Export",this.options.class="dataexportwizard",this.options.height=640,this.options.maxHeight=640,this.dialogResult={OK:!1,Cancel:!0},t.VA.Core.Wizards.Wizard.call(this,i,this.options),e||this.handleNext();}i.prototype=Object.create(t.VA.Core.Wizards.Wizard.prototype),i.prototype.constructor=i,i.prototype.createContentsArea=function(i){i.css({"padding-left":"19px","padding-right":"19px"}),this.selectExportTypePage=new t.VA.Core.Wizards.Pages.SelectExportTypePage(i,{wizard:this,showPreviousButton:!0,showNextButton:!0,showFinishButton:!0}),this.addPage(this.selectExportTypePage),this.selectJdbcDataPage=new t.VA.Core.Wizards.Pages.SelectExportJdbcPage(i,{wizard:this,showPreviousButton:!0,showNextButton:!1,showFinishButton:!0}),this.addPage(this.selectJdbcDataPage),this.selectExportDelimiterPage=new t.VA.Core.Wizards.Pages.SelectExportDelimiterPage(i,{wizard:this,showPreviousButton:e,showNextButton:!1,showFinishButton:!0}),this.addPage(this.selectExportDelimiterPage);},i.prototype.getNextPage=function(t){if(t===this.selectExportTypePage){var e=this.selectExportTypePage.getParam().copyFrom;if("local"===e)return this.selectExportDelimiterPage;if("jdbc"===e)return this.selectJdbcDataPage;}},i.prototype.getPreviousPage=function(t){return t===this.selectExportTypePage?null:t===this.selectExportDelimiterPage?this.selectExportTypePage:t===this.selectJdbcDataPage?this.selectExportTypePage:void 0;},i.prototype.handleFinish=function(t){this.handleNext();},i.prototype.close=function(){this.selectExportDelimiterPage.destroy(),this.selectExportTypePage.destroy(),this.selectJdbcDataPage.destroy(),t.VA.Core.Wizards.Wizard.prototype.close.call(this);},t.VA.Core.Wizards.DataExportWizard=i;}.call(this),function(){"use strict";var t=this.Brightics;var e="false"!==this.useSpark;function i(i,o){this.parentId=i,this.options=o,this.options.title="Add Data",this.options.class="datauploadwizard",this.options.height=600,this.dialogResult={OK:!1,Cancel:!0},this.eventList={},this.eventListener={},t.VA.Core.Wizards.Wizard.call(this,i,this.options),e||this.handleNext();}i.prototype=Object.create(t.VA.Core.Wizards.Wizard.prototype),i.prototype.constructor=i,i.prototype.createContentsArea=function(i){this.selectUploadTypePage=new t.VA.Core.Wizards.Pages.SelectUploadTypePage(i,{wizard:this,showPreviousButton:!0,showNextButton:!0,showFinishButton:!0}),this.addPage(this.selectUploadTypePage),this.selectLocalDataPage=new t.VA.Core.Wizards.Pages.SelectLocalDataPage(i,{wizard:this,showPreviousButton:e,showNextButton:!0,showFinishButton:!0}),this.addPage(this.selectLocalDataPage),this.selectAlluxioDataPage=new t.VA.Core.Wizards.Pages.SelectAlluxioDataPage(i,{wizard:this,showPreviousButton:!0,showNextButton:!0,showFinishButton:!0}),this.addPage(this.selectAlluxioDataPage),this.selectJdbcDataPage=new t.VA.Core.Wizards.Pages.SelectJdbcDataPage(i,{wizard:this,showPreviousButton:!0,showNextButton:!0,showFinishButton:!0}),this.addPage(this.selectJdbcDataPage),this.selectDelimiterPage=new t.VA.Core.Wizards.Pages.SelectDelimiterPage(i,{wizard:this,showPreviousButton:!0,showNextButton:!0,showFinishButton:!0}),this.addPage(this.selectDelimiterPage),this.setColumnDataTypePage=new t.VA.Core.Wizards.Pages.SetColumnDataTypePage(i,{wizard:this,showPreviousButton:!0,showNextButton:!0,showFinishButton:!0}),this.addPage(this.setColumnDataTypePage);},i.prototype.getNextPage=function(t){if(t===this.selectUploadTypePage){var e=this.selectUploadTypePage.getParam().copyFrom;if("local"===e)return this.selectLocalDataPage;if("alluxio"===e)return this.selectAlluxioDataPage;if("jdbc"===e)return this.selectJdbcDataPage;}return t===this.selectLocalDataPage?this.selectDelimiterPage:t===this.selectAlluxioDataPage?this.selectDelimiterPage:t===this.selectJdbcDataPage?this.setColumnDataTypePage:t===this.selectDelimiterPage?this.setColumnDataTypePage:t===this.setColumnDataTypePage?null:void 0;},i.prototype.getPreviousPage=function(t){if(t===this.selectUploadTypePage)return null;if(t===this.selectLocalDataPage)return this.selectUploadTypePage;if(t===this.selectAlluxioDataPage)return this.selectUploadTypePage;if(t===this.selectJdbcDataPage)return this.selectUploadTypePage;if(t===this.selectDelimiterPage){if("local"===this.result.copyFrom)return this.selectLocalDataPage;if("alluxio"===this.result.copyFrom)return this.selectAlluxioDataPage;}if(t===this.setColumnDataTypePage){if("local"===this.result.copyFrom)return this.selectDelimiterPage;if("alluxio"===this.result.copyFrom)return this.selectDelimiterPage;if("jdbc"===this.result.copyFrom)return this.selectJdbcDataPage;}},i.prototype.handleFinish=function(){this.setColumnDataTypePage.doFinish();},i.prototype.registerEvent=function(t){var e=this;this.eventList[t]||(this.$mainControl.on(t,function(i,o){if(e.eventListener[t])for(var n in e.eventListener[t]){e.eventListener[t][n]&&"function"==typeof e.eventListener[t][n]&&e.eventListener[t][n](i,o);}}),this.eventList[t]=!0);},i.prototype.addEventListener=function(t,e){this.eventListener[t]||(this.eventListener[t]=[]),this.eventListener[t].push(e);},i.prototype.triggerEvent=function(t,e){this.$mainControl.trigger(t,[e]);},i.prototype.close=function(){this.selectJdbcDataPage.destroy(),this.selectAlluxioDataPage.destroy(),this.selectDelimiterPage.destroy(),this.selectLocalDataPage.destroy(),this.selectUploadTypePage.destroy(),this.setColumnDataTypePage.destroy(),t.VA.Core.Wizards.Wizard.prototype.close.call(this);},t.VA.Core.Wizards.DataUploadWizard=i;}.call(this),function(){"use strict";var t={},e=brtc_require("crel");t.USER_INPT_ARR_DELIMETER="[i]",this.Brightics.VA.Core.Utils.CommonUtils={getUserBrowserName:function getUserBrowserName(){!!window.chrome&&window.chrome.webstore;return window.navigator.userAgent.indexOf("Chrome")>=0?"Chrome":document.documentMode?"Internet Explorer":!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0?"Opera":"undefined"!=typeof InstallTrigger?"Firefox":Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString()?"Safari":void 0;},downloadJsonFile:function downloadJsonFile(t,e){var i=this.getUserBrowserName(),o=new Blob([t],{type:"text/json;charset=utf-8;"});if("Internet Explorer"===i)window.navigator.msSaveBlob(o,e+".json");else{var n=URL.createObjectURL(o),r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",e+".json"),r.click(),URL.revokeObjectURL(n);}},numberToStringWithComma:function numberToStringWithComma(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");},getTimeDifferenceFromNow:function getTimeDifferenceFromNow(t){var e=new Date(t);return(new Date().getTime()-e.getTime())/36e5;},transferTimestampToDateString:function transferTimestampToDateString(t){var e=function e(t){return t<10?"0"+t:t;};return t.getFullYear()+"-"+e(t.getMonth()+1)+"-"+e(t.getDate())+" "+e(t.getHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds());},convertDataTypeForText:function convertDataTypeForText(t,e){if(void 0===t)return"-";if(-1!==t.indexOf("[")){var i,o=e.replace("[]","");switch(o){case"String":i="S";break;case"Integer":i="I";break;case"Long":i="L";break;case"Double":i="Db";break;case"Date":i="Dt";break;case"Boolean":i="Bl";break;case"Byte":i="Bt";break;default:i=o;}return"Array("+i+")";}return"map"===t?"Map":e;},convertDataTypeForTitle:function convertDataTypeForTitle(t,e){return void 0===t?"Undefined Type":-1!==t.indexOf("[")?"Array("+e.replace("[]","")+")":e;},getTypes:function getTypes(){return[{type:"number",internalType:"Integer"},{type:"number",internalType:"Long"},{type:"number",internalType:"Double"},{type:"string",internalType:"Boolean"},{type:"string",internalType:"String"},{type:"number[]",internalType:"Double[]"},{type:"number[]",internalType:"Long[]"},{type:"string[]",internalType:"Boolean[]"},{type:"string[]",internalType:"String[]"},{type:"byte[]",internalType:"Byte[]"},{type:"number[]",internalType:"Double[]"},{type:"number[]",internalType:"Long[]"},{type:"string[]",internalType:"String[]"},{type:"byte[]",internalType:"Byte[]"},{type:"map",internalType:"Map(Integer,Double)"},{type:"map",internalType:"Map(String,Double)"},{type:"map",internalType:"Map(Integer,Double)"},{type:"map",internalType:"Map(String,String)"},{type:"date",internalType:"Date"}];},fetchFromObject:function fetchFromObject(e,i){if(void 0!==e&&void 0!==i)try{var o=e.indexOf("."),n=e.slice(0,o).indexOf(t.USER_INPT_ARR_DELIMETER);if(n>-1){var r=[],a=i[e.substring(0,n)];if(a)for(var s=0;s<a.length;s++){e.indexOf(".")>-1&&r.push(this.fetchFromObject(e.substr(n+4),a[s]));}return r.length>0?r:a;}return o>-1?this.fetchFromObject(e.substr(o+1),i[e.substring(0,o)]):i[e];}catch(t){console.error(e),console.error(t);}},isPC:function isPC(){var t=!0;return["win16","win32","win64","macintel","mac"].indexOf(navigator.platform.toLowerCase())<0&&(t=!1),t;},byteCalculation:function byteCalculation(t){t=parseInt(t);var e=["bytes","KB","MB","GB","TB","PB"],i=Math.floor(Math.log(t)/Math.log(1024));return"-Infinity"==i?"0 "+e[0]:(t/Math.pow(1024,Math.floor(i))).toFixed(2)+" "+e[i];},getQueryString:function getQueryString(t){return _.map(t,function(t,e){return e+"="+t;}).join("&");},getObjByJsonPath:function getObjByJsonPath(t,e){var i=$.extend(!0,{},t);return Array.isArray(e)?e.reduce(function(t,e,i,o){return t=t&&t[e]?t[e]:void 0;},i):i[e];},removeArrayElement:function removeArrayElement(t,e){_.remove(t,function(t){return e.indexOf(t)>-1;});},dim:function dim(t,i){var o=$((i||{}).appendTo||document.body),n=Promise.resolve().then(function(){return"function"==typeof t?t():t;}),r=$(e("div",{class:"brtc-dim"},e("div",{class:"brtc-dim-text brtc-style-apper-1sendond"},e("i",{class:"fa fa-spinner fa-pulse fa-5x fa-fw"}))));return o.append(r),n.then(function(t){return r.remove(),t;}).catch(function(t){throw r.remove(),t;});},progress:function progress(t,e){var i=e||{},o=e.showPercent||!1,n=e.msg||"",r=$(i.appendTo||document.body),a=Promise.resolve().then(function(){return"function"==typeof t?t():t;}),s=$('   <div class="brtc-va-progress">       <div>           <span class="brtc-va-progress-loading"/>           <p>'+n+"</p>"+(o?'<p class="brtc-va-progress-percent"></p>':"")+"       </div></div>");return s.css("top","0"),s.css("left","0"),r.append(s),a.then(function(t){return s.remove(),t;}).catch(function(t){throw s.remove(),t;});}};}.call(this),function(){"use strict";var t=this.Brightics;this.Brightics.VA.Core.Utils.DownLoader={run:function run(t,e,i,o,n,r,a){var s="/"+t+"/"+e+"/"+i;this.runStartWithExport(o,s,n,r,a);},runStartWithExport:function runStartWithExport(t,e,i,o,n){this.export(t,e,i,o,n);},doDownload:function doDownload(t,e,i,o,n,r){this.download(t,e).always(function(){var t={url:"api/v1/repo/alluxio/datas/"+i+"/destroy",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1,data:JSON.stringify({type:"tmp",data:i})};$.extend(!0,t,r),$.ajax(t),t={url:"api/v1/repo/alluxio/datas/"+i+".csv/destroy",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1,data:JSON.stringify({type:"tmp",data:i+".csv"})},$.extend(!0,t,r),$.ajax(t);}).done(function(){"function"==typeof o&&o();}).fail(n);},progress:function progress(e,i,o){var n={fail:function fail(t){return this.failCallback=t,this;},done:function done(t){return this.doneCallback=t,this;}},r=function r(){var e={url:"api/va/v2/analytics/jobs/"+i,type:"GET",blocking:!1};$.extend(!0,e,o),$.ajax(e).done(function(e){if("FAIL"===e.status||"ABORT"===e.status){var i={status:400,responseJSON:{errors:[{code:400,message:"Failed to export data."}]}};try{var o=t.VA.Core.Utils.MessageUtils.getFunctionLabels("unload",e.errorInfo[0].parameter);i.responseJSON.errors[0].message=t.VA.Core.Utils.MessageUtils.getMessage(e.errorInfo[0].errorCode,o),n.failCallback&&n.failCallback(i);}catch(t){n.failCallback&&n.failCallback(i);}}else"SUCCESS"===e.status?n.doneCallback&&n.doneCallback():setTimeout(r,3e3);}).fail(function(t){n.failCallback&&n.failCallback(t);});};return setTimeout(r,3e3),n;},unload:function unload(t,e,i,o,n,r){var a=this,s={fail:function fail(t){return this.failCallback=t,this;},done:function done(t){return this.doneCallback=t,this;}},l="va_"+Date.now();n?(n.delimiter||(n.delimiter=","),n["array-delimiter"]||(n["array-delimiter"]=";"),n["key-value-delimiter"]||(n["key-value-delimiter"]=":"),n["quote-delimiter"]||(n["quote-delimiter"]='"')):n={delimiter:",","array-delimiter":";","key-value-delimiter":":","quote-delimiter":'"'};var c={user:t,jid:l,main:e,args:{},models:{}};c.models[e]={mid:e,type:"data",functions:[{fid:"f-unload",func:"unload",inData:[i],name:"OutData",param:{"io-mode":"write","fs-type":"alluxiocsv","df-names":[i],"fs-paths":[o],delimiter:n.delimiter,"array-delimiter":n["array-delimiter"],"key-value-delimiter":n["key-value-delimiter"],quote:n["quote-delimiter"]}}],links:[],entries:["f-unload"]};var d={url:"api/va/v2/analytics/jobs",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),blocking:!1};return $.extend(!0,d,r),$.ajax(d).done(function(){a.progress(t,l).done(s.doneCallback).fail(s.failCallback);}).fail(function(){s.failCallback&&s.failCallback();}),s;},export:function _export(e,i,o,n,r,a){e=e;var s=o.delimiter||",",l=i,c={url:"api/va/v2/data/download",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({delimiter:s,remotePath:l,filename:e}),blocking:!1,timeout:18e5};$.extend(!0,c,a);var d=encodeURIComponent(l),p=encodeURIComponent(s),u=encodeURIComponent(e);$.ajax(c).done(function(i){if(window.navigator.msSaveBlob)Promise.resolve($.get("api/va/v2/data/download/files/?"+t.VA.Core.Utils.CommonUtils.getQueryString({key:d,delimiter:p,filename:u}))).then(function(t){console.log(t),window.navigator.msSaveBlob(new Blob([t]),e);});else{var o=document.createElement("a");o.setAttribute("href",encodeURI("api/va/v2/data/download/files/?key="+encodeURIComponent(l)+"&delimiter="+encodeURIComponent(s)+"&filename="+encodeURIComponent(e))),o.setAttribute("download",e),o.setAttribute("id","downloadfile"),o.setAttribute("target","_blank"),$(o)[0].click(),setTimeout(function(){$("#downloadfile").remove();},1e4);}n();}).fail(function(t){r(t);});},download:function download(t,e,i){var o={remotePath:t,localFileName:e},n={url:"api/va/v2/data/download",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1,data:JSON.stringify(o)};return $.extend(!0,n,i),$.ajax(n).done(function(t){$("<object>",{id:"downloadfile",data:"api/va/v2/repo/download/files/"+t.file,target:"_top",type:"text/html",title:"Title"}).hide().appendTo("body"),setTimeout(function(){$("#downloadfile").remove();},1e4);}).fail(function(t){console.log(t);});}};}.call(this),function(){"use strict";var t=this.Brightics;this.Brightics.VA.Core.Utils.ExportUtils={exportProject:function exportProject(e,i,o){!function(e,i,o){ResourceManager.fetchProject(e).then(function(t){return ResourceManager.initProject(t);}).then(function(){var i=ResourceManager.getProject(e).toJSON();return i?(i.files=_.map(ResourceManager.getFiles(e),function(t){return t.toJSON();}),function(e){var i=_.filter(e.files,function(t){return"control"===t.type;}),o=_.map(i,function(i){return t.VA.Core.Utils.ModelUtils.createModelTree(e.id,i.contents);});return Promise.all(o).then(function(t){return _.reduce(t,_.merge,{});}).then(function(t){var e=[];return _.forOwn(t,function(t){_.forOwn(t.version,function(t){e.push(t);});}),e;});}(i).then(function(t){return i.versions=_.map(t,function(t){return t.toJSON();}),i;})):Promise.reject("there is no project");}).then(function(t){i&&"function"==typeof i&&i([t]);}).catch(function(t){o(t);});}(e,i,o);}};}.call(this),function(){"use strict";this.Brightics.VA.Core.Utils.FileDao={getFile:function getFile(t,e,i,o){return function(t,e,i){return new Promise(function(o,n){$.ajax(t).done(function(t){e&&"function"==typeof e&&(t&&t.length?e(t[0]):e(t||null)),t&&t.length?o(t[0]):o(t||null);}).fail(function(t){i&&"function"==typeof i&&i(t),n(t);});});}({url:"api/va/v2/ws/projects/"+t+"/files/"+e,type:"GET",contentType:"application/json; charset=utf-8"},i,o);}};}.call(this),function(){"use strict";var t;this.Brightics.VA.Core.Utils.FileVersionDao=(t=function t(_t10,e,i){return new Promise(function(o,n){$.ajax(_t10).done(function(t){e&&"function"==typeof e&&e(t),o(t);}).fail(function(t){i&&"function"==typeof i&&i(t),n(t);});});},{getFileVersions:function getFileVersions(e,i,o,n){return t({url:"api/va/v2/ws/projects/"+e+"/files/"+i+"/versions",type:"GET",contentType:"application/json; charset=utf-8"},o,n);},getFileVersion:function getFileVersion(e,i,o,n,r){return t({url:"api/va/v2/ws/projects/"+e+"/files/"+i+"/versions/"+o,type:"GET",contentType:"application/json; charset=utf-8"},n,r);},addFileVersion:function addFileVersion(e,i,o,n,r){var a={url:"api/va/v2/ws/projects/"+e+"/files/"+i+"/versions",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1,data:JSON.stringify(o)};return t(a,n,r);},addFileVersionSync:function addFileVersionSync(e,i,o,n,r){var a={url:"api/va/v2/ws/projects/"+e+"/files/"+i+"/versions",type:"POST",contentType:"application/json; charset=utf-8",blocking:!0,data:JSON.stringify(o)};return t(a,n,r);},deleteFileVersion:function deleteFileVersion(e,i,o,n,r){return t({url:"api/va/v2/ws/projects/"+e+"/files/"+i+"/versions/"+o+"/delete",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1},n,r);},updateFileVersion:function updateFileVersion(e,i,o,n,r,a){var s={url:"api/va/v2/ws/projects/"+e+"/files/"+i+"/versions/"+o+"/update",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1,data:JSON.stringify(n)};return t(s,r,a);},loadFileVersion:function loadFileVersion(e,i,o,n,r){return t({url:"api/va/v2/ws/projects/"+e+"/files/"+i+"/versions/"+o+"/load",type:"POST",contentType:"application/json; charset=utf-8",blocking:!1},n,r);}});}.call(this),function(){"use strict";var t=this.Brightics;var e=3e4;function i(t,e){return"string"==typeof e?t.id+e:t.id+e[OUT_DATA][0];}t.VA.Core.Utils.FullRenderingUtils={getFnUnit:function getFnUnit(e){var i=e.chart.type,o={chartOptions:e};return(t.VA.Core.Utils.FnUnitGenerator[i]?new t.VA.Core.Utils.FnUnitGenerator[i](o):new t.VA.Core.Utils.FnUnitGenerator(o)).generate();},convertToChartSource:function convertToChartSource(t,e){var i=e;if("bigDataBoxPlot"===t||"boxplot"===t)for(var o in i.data){i.data[o][1].box=i.data[o][1].box.split(",").map(function(t){return parseFloat(t);});var n=i.data[o][1].outliers;n=""!=n?n.split(",").map(function(t){return parseFloat(t);}):[];}return i.dataType="chartdata",i;},getRenderedData:function getRenderedData(o,n,r,a,s,l){var c=this,d={dataType:"rawdata",columns:[],data:[]},p=function p(t){return t&&"function"==typeof t?t:function(){};},u=p(a),h=p(s),f=p(l),m=function m(t){return{offset:0,limit:t,user:r.user,publish:r.publish};},g=r.mid||o.parent().mid,v=o[IN_DATA];"dummy"===o.func?function(e,i){t.VA.Core.DataQueryTemplate.queryTable(e,i,function(t,e){t.dataType="rawdata",u(t,e);},function(t,e,i){h(t,e,i);},!0,m(1e4));}(g,v):t.VA.Core.DataQueryTemplate.queryTable(g,v,function(a,s){a.count>=0&&a.count<e?(a.dataType="rawdata",u(a,s)):new Promise(function(e,n){try{if(!r.publish)return n();t.VA.Core.DataQueryTemplate.queryTable(g,i(r.contentUnit.content,o[IN_DATA][0]),function(t,i){return e([t,i]);},function(t,e,i){return n(i);},!0,m(1e5));}catch(t){return n(t);}}).then(function(t){var e=t[0],i=t[1],n=c.convertToChartSource(o.func,e);u(n,i);}).catch(function(){var e={success:function success(e){var i=o[OUT_DATA];t.VA.Core.DataQueryTemplate.queryTable(g,i,function(t,e){var i=c.convertToChartSource(o.func,t);u(i,e);},function(t,e,i){h(t,e,i);},!0,m(1e5)),f(e.result);},fail:function fail(t){h(d,s,t);},catch:function _catch(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),h(d,s,e);}};n.launchUnit(Object.assign({},o,{persist:!0}),{},r,e);});},function(t,e,i){h(t,e,i);},!0,m(e));},getBigDataTargetTid:i,isBigData:function isBigData(i){var o=i,n=o.modelId,r=o.tableId,a=o.user,s=o.isPublish,l=function l(t,e){if(void 0===e)throw new Error(t+" is required");};return l("modelId",n),l("tableId",r),l("user",a),l("isPublish",s),new Promise(function(i,o){t.VA.Core.DataQueryTemplate.queryTable(n,r,function(t,o){return i(t.count>=e);},function(t,e,i){return o(i);},!0,{offset:0,limit:e,user:a,publish:s});});}};}.call(this),function(){"use strict";var t=this.Brightics;function e(t,i){for(var o in t){if(e(t[o].param.functions,i),"dataFlow"===t[o].func){var n=t[o].param.mid;t[o].param.mid=i[n]||"DeletedDataFlow";}}}this.Brightics.VA.Core.Utils.ImportUtils={importProject:function importProject(i,o,n,r,a){if(n.length){var s=t.VA.Core.Utils.IDGenerator.project.id(),l=n[0];!function(e,i,o,n,r){var a=new t.VA.Vo.Project();a.setProjectId(e),a.setLabel(i||"untitled"),a.setDescription(o||""),a.setCreator(t.VA.Env.Session.userId),ResourceManager.addProject(a).then(function(){n();}).catch(function(t){r(t);});}(s,i,o,function(){l.versions=l.versions||[];var i=function(e,i){var o={},n=function n(e){_.forEach(e,function(e){e.param.functions&&n(e.param.functions),e.param.mid&&(o[e.param.mid]=o[e.param.mid]||t.VA.Core.Utils.IDGenerator.model.id());});};e&&_.forEach(e,function(e){o[e.id]=o[e.id]||t.VA.Core.Utils.IDGenerator.model.id(),n(e.contents.functions);});i&&_.forEach(i,function(e){o[e.file_id]=o[e.file_id]||t.VA.Core.Utils.IDGenerator.model.id(),n(e.contents.functions);});return o;}(l.files,l.versions);!function(t,i,o){t&&_.forEach(t,function(t){"control"===t.type&&e(t.contents.functions,o);var i=t.id;t.id=o[i],t.contents.mid=o[i];});i&&_.forEach(i,function(t){"control"===t.type&&e(t.contents.functions,o);var i=t.file_id;t.file_id=o[i],t.contents.mid=o[i];});}(l.files,l.versions,i),function(e,i){var o={};e&&_.forEach(e,function(t){o[t.id]=o[t.id]||{version:{}},o[t.id].main=t.contents;});i&&_.forEach(i,function(t){o[t.file_id]=o[t.file_id]||{version:{}},o[t.file_id].version[t.version_id]=t.contents;});var n=t.VA.Core.Utils.ModelUtils.cloneModelsByTree(o);e&&_.forEach(e,function(t){t.contents=n[t.id].main;});i&&_.forEach(i,function(t){t.contents=n[t.file_id].version[t.version_id];});}(l.files,l.versions),function(e,i){var o={};return Promise.all(_.map(i,function(i){var n=new t.VA.Vo.Version(i);return n.setIsManual(!0),t.VA.Dao.VersionDao.addVersion(e,n.getFileId(),n).then(function(t){o[n.getVersionId()]=t.getVersionId();});})).then(function(){return o;});}(s,l.versions).then(function(e){!function(t,e){_.forEach(t,function(t){_.forEach(t.contents.functions,function(t){"DataFlow"===t[FUNCTION_NAME]&&t.param.version_id&&(t.param.version_id=e[t.param.version_id]);});});}(l.files,e),function(e,i,o,n){var r=[];for(var a in i){if("visual"!==i[a].type){var s=i[a],l=t.VA.Core.Utils.ModelUtils.cloneModel(s.contents),c=new t.VA.Vo.File();c.setFileId(s.id),c.setProjectId(e),c.setLabel(s.label),c.setDescription(s.description),c.setContents(l),c.setCreator(t.VA.Env.Session.userId);var d=ResourceManager.addFile(e,c);r.push(d);}}Promise.all(r).then(function(){o&&"function"==typeof o&&o(e);},function(t){n&&"function"==typeof n&&n(t);});}(s,l.files,function(){r&&"function"==typeof r&&r(s);},a);}).catch(function(t){a(t);});},a);}else a&&"function"==typeof a&&a("Invalid JSON Data.");}};}.call(this),function(){"use strict";this.Brightics.VA.Core.Utils.InputValidator={isDefaultKeyCode:function isDefaultKeyCode(t){var e=t.keyCode,i=t.ctrlKey;return!!(-1!==$.inArray(e,[46,8,9,27,13,110])||i||16===e||17===e||e>=35&&e<=40);},isNotInsertKeyCode:function isNotInsertKeyCode(t){var e=t.keyCode,i=t.ctrlKey;return!!(-1!==$.inArray(e,[8,27,46,110])||i&&-1!==$.inArray(e,[65,67,88,90])||e>=35&&e<=40);},isValid:{type1:function type1(t){return new RegExp("^[a-zA-Z0-9_]+$").test(t);},type2:function type2(t){return new RegExp("^[a-zA-Z0-9_\\s]+$").test(t);},type3:function type3(t){return new RegExp("^[a-zA-Z0-9_{}\\$]+$").test(t);},type4:function type4(t){return new RegExp("^[a-zA-Z0-9_\\.]+$").test(t);},type5:function type5(t){return new RegExp("^[0-9_]").test(t);},type6:function type6(t){return new RegExp("^[a-zA-Z ]+$").test(t);},columnNameType:function columnNameType(t){return!new RegExp("^[0-9]+").test(t);},integerType:function integerType(t){return new RegExp("^[0-9]+$").test(t);},startWithSpace:function startWithSpace(t){return new RegExp("^\\s").test(t);},endWithSpace:function endWithSpace(t){return new RegExp("\\s$").test(t);},cronType:function cronType(t){return new RegExp("^[A-Z0-9-?*/,# ]+$").test(t);},rangeType:function rangeType(t){return new RegExp("^[0-9_.-~]+$").test(t);},featureEncodingRangeType:function featureEncodingRangeType(t){return new RegExp("^[0-9_.~]+$").test(t);},fileNameType:function fileNameType(t){return new RegExp("^[a-zA-Z0-9_./@]+$").test(t);},renamefileType:function renamefileType(t){return new RegExp("^[a-zA-Z0-9_.]+$").test(t);}},replaceKoreanToEmpty:function replaceKoreanToEmpty(t){return t.replace(/[ㄱ-ㅎㅏ-ㅣ가-힣]/g,"");},appendValidationCondition:function appendValidationCondition(t){var e=this;if(t.attr("valid-type")){var i=t.attr("valid-type");t.on("paste",function(o){var n=(o.originalEvent.clipboardData||window.clipboardData).getData("Text");if(!e.isValid[i](n)){o.preventDefault();Brightics.VA.Core.Widget.Factory.createFadeOutMessage(t,{message:"※ This pasted string is NOT allowed."});}}),t.keydown(function(o){if(!e.isDefaultKeyCode(o)){var n,r={Spacebar:" ",Up:"ArrowUp",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight"}[(n=o).key]||n.key;if(e.isValid[i](r)||"Process"!==r){if(!e.isValid[i](r)){o.preventDefault();a="※ This character( "+r+" ) is NOT allowed.";Brightics.VA.Core.Widget.Factory.createFadeOutMessage(t,{message:a});}}else{var a="※ Korean character is NOT allowed.";Brightics.VA.Core.Widget.Factory.createFadeOutMessage(t,{message:a});var s=e.replaceKoreanToEmpty(t.val());e.replaceKoreanToEmptyTimeout&&clearTimeout(e.replaceKoreanToEmptyTimeout),e.replaceKoreanToEmptyTimeout=setTimeout(function(){t.val(s);},100);}}});}}};}.call(this),function(){"use strict";this.Brightics;this.Brightics.VA.Core.Utils.MessageUtils={initMessage:function initMessage(){var t=this;$.ajax({url:"api/va/v2/studio/message/en",type:"GET",blocking:!1}).done(function(e){var i={};for(var o in e){i[e[o].code]={message:e[o].message};}t.Message=i;});},initFunctionLabel:function initFunctionLabel(){var t=this;this.FunctionLabel={},$.ajax({url:"api/va/v2/studio/functionlabel/en",type:"GET",blocking:!1}).done(function(e){for(var i=0;i<e.length;i++){var o=e[i];t.FunctionLabel[o.functionName]=t.FunctionLabel[o.functionName]||{},t.FunctionLabel[o.functionName][o.parameter]=o.label;}});},getFunctionLabels:function getFunctionLabels(t,e){var i=[];for(var o in e){this.FunctionLabel[t]&&this.FunctionLabel[t][e[o]]?i.push(this.FunctionLabel[t][e[o]]):"inData"===e[o]?i.push("In Table"):i.push(e[o]);}return i;},getFunctionLabel:function getFunctionLabel(t,e){return this.FunctionLabel[t]&&this.FunctionLabel[t][e]?this.FunctionLabel[t][e]:e;},getMessage:function getMessage(t,e){if(!this.Message||!this.Message[t])return"Please contact administrator! Error: "+t;var i=this.Message[t].message;for(var o in e){i=i.replace("%s",e[o]);}return i;},getReplacedParam:function getReplacedParam(t,e){if("evaluateRankingAlgorithm"==t){return["Precision","NDCG","K-Values"];}},getFunctionLabelAll:function getFunctionLabelAll(){return this.FunctionLabel;}};}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Dao,i=brtc_require("ResourceManager"),o=brtc_require("FnUnitUtils");function n(t){var e={fidCache:{},outputCache:{}};for(var i in t){var o=t[i];$.extend(!0,e,r(o));}return e;}function r(e){var i={fidCache:{},outputCache:{}},o=i.fidCache,r=i.outputCache;for(var a in o[e.fid]=t.VA.Core.Utils.IDGenerator.func.id(),e[OUT_DATA]){r[e[OUT_DATA][a]]=t.VA.Core.Utils.IDGenerator.table.id();}return e.param.functions&&$.extend(!0,i,n(e.param.functions)),i;}function a(e,i,n){var r=n.fidCache,a=n.tidCache,s=function s(){return t.VA.Core.Utils.IDGenerator.table.id();},l=function l(t,e,i){t[e]=t[e]||i;},c=function c(e){l(r,e.fid,t.VA.Core.Utils.IDGenerator.func.id()),_.forEach(o.getAllData(e),function(t){l(a,t,s());}),e.param.tableId&&l(a,e.param.tableId,s()),e.param.functions&&_.forEach(e.param.functions,function(t){c(t);});},d=function d(i){_.forEach([IN_DATA,OUT_DATA],function(t){_.forEach(i[t],function(t){l(a,t,s());});}),_.forEach(i.functions,function(i){c(i);var o=t.VA.Core.Utils.NestedFlowUtils.getSubModels(e,i);_.forEach(o,d);});};return d(i),n;}function s(e,i,o){var n=o.fidCache,r=o.tidCache,a=function a(i){for(var s in d(i,r),p(i,r),i.functions){var l=i.functions[s];l.fid=n[l.fid],d(l,r),p(l,r),u(l,r),h(l,n),g(l,r,n),y(l,r),"deeplearning"===i.type&&v(l,n),l.param&&l.param.functions&&a(l.param,o);var c=t.VA.Core.Utils.NestedFlowUtils.getSubModels(e,l);_.forEach(c,a);}i.report&&(_.forEach(i.report.data,function(t){t.originData&&t.originData.data&&(t.originData.data.fid=l.fid,b(t,r));}),i.report=C(i.report,n)),f(i,n);};return a(i),m(e,n),e;}function l(e,i){_.forEach(e,function(e){!function(e,i){var o=i.fidCache,n=i.outputCache;e.fid.startsWith("d")?o[e.fid]=o[e.fid]||t.VA.Core.Utils.IDGenerator.dataSource.id():o[e.fid]=o[e.fid]||t.VA.Core.Utils.IDGenerator.func.id();_.forEach(e.outData,function(e){n[e]=n[e]||t.VA.Core.Utils.IDGenerator.table.id();}),e.param.functions&&l(e.param.functions,i);}(e,i);});}function c(t,e){var i=e.fidCache,o=e.outputCache;for(var n in t.functions){var r=t.functions[n];r.fid=i[r.fid],(r=y(r=g(r=h(r=u(r=p(r=d(r,o),o),o),i),o,i),o)).param&&r.param.functions&&c(r.param,e),"deeplearning"==t.type&&(r=v(r,i));}if(t.report){for(var a in t.report.data){t.report.data[a].originData.data.fid=r.fid,t.report.data[a]=b(t.report.data[a],o);}t.report=C(t.report,i);}return t=m(t=f(t,i),i);}function d(t,e){return _.forEach(e,function(e,i){o.changeData(t,i,e);}),t;}function p(t,e){return _.forEach(e,function(e,i){o.changeData(t,i,e);}),t;}function u(t,e){if(t.param&&t.param["df-names"])for(var i in t.param["df-names"]){t.param["df-names"][i]=e[t.param["df-names"][i]];}return t;}function h(t,e){if(t.param&&t.param.entries)for(var i in t.param.entries){t.param.entries[i]=e[t.param.entries[i]];}return t;}function f(e,i){for(var o in e.links){var n=e.links[o],r=t.VA.Core.Utils.IDGenerator.link.id();n.kid=r,n[SOURCE_FID]=i[n[SOURCE_FID]],n[TARGET_FID]=i[n[TARGET_FID]];}return e;}function m(t,e){for(var i in t.variableRef){var o=t.variableRef[i].fid;t.variableRef[i].fid=e[o];}return t;}function g(e,i,o){if("outData"===e.func&&"Subflow"===e[FUNCTION_NAME])for(var n in e.param.functions){if("exportData"===e.param.functions[n].func){var r="/brtc/repo/tmp/"+t.VA.Core.Utils.IDGenerator.file.id();e.param["fs-paths"]=[r],e.param.functions[n]&&(e.param.functions[n].param["input-path"]=r,e.param.functions[n].param["output-path"]=r+".csv");}}return"DataViewer"===e[FUNCTION_NAME]&&(e.param.fid=o[e.param.fid]),e;}function v(t,e){var i=["train_data","validation_data"];if(!t.param)return t;for(var o=0;o<i.length;o++){t.param[i[o]]&&e[t.param[i[o]]]&&(t.param[i[o]]=e[t.param[i[o]]]);}return t;}function b(t,e){return t.originData.data.table=e[t.originData.data.table],t;}function y(t,e){return t.param.tableId&&(t.param.tableId=e[t.param.tableId]),t;}function C(t,e){if(t.pages)for(var i in t.pages){var o=Object.keys(t.pages[i].contents);for(var n in o){t.pages[i].contents[o[n]].dataSourceId=e[t.pages[i].contents[o[n]].dataSourceId];}}return t;}this.Brightics.VA.Core.Utils.ModelUtils={extendParent:function extendParent(t,e){if(e.parent=function(){return t;},e.param&&e.param.functions)for(var i in e.param.functions){void 0!==e.param.functions[i].fid&&this.extendParent(e,e.param.functions[i]);}},extendMainFunc:function extendMainFunc(e,i){i.getMainModel=function(){return e;},i.isMainModel=function(){return this===this.getMainModel();};var o=t.VA.Core.Utils.NestedFlowUtils.getChildModels(e,i);_.forEach(o,_.partial(this.extendMainFunc.bind(this),e,_));},extendModel:function extendModel(e,i){var o,n=this,r=t.VA.Core.Interface.DefaultModel[e.type];if(r){for(var a in o=i?$.extend(!0,{},r,e):$.extend(!0,e,r),_.forIn(o.innerModels,function(t){n.extendInnerModel(o,t);}),(o=$.extend(!0,o,t.VA.Default.model)).functions){o.functions[a]&&(this.extendParent(o,o.functions[a]),void 0===o.functions[a]["persist-mode"]&&(o.functions[a]["persist-mode"]="auto"));}return void 0===o["persist-mode"]&&(o["persist-mode"]="auto"),this.extendMainFunc(o,o),o;}console.error("Create DefaultModel("+e.type+")!");},extendInnerModel:function extendInnerModel(e,i,o){var n,r=t.VA.Implementation.DataFlow.innerModel;if(r){for(var a in n=o?$.extend(!0,{},r,i):$.extend(!0,i,r),(n=$.extend(!0,n,t.VA.Default.model)).functions){n.functions[a]&&(this.extendParent(n,n.functions[a]),void 0===n.functions[a]["persist-mode"]&&(n.functions[a]["persist-mode"]="auto"));}return void 0===n["persist-mode"]&&(n["persist-mode"]="auto"),this.extendMainFunc(e,n),n;}console.error("Create DefaultModel("+i.type+")!");},exportAsRunnablePromise:function exportAsRunnablePromise(e,o,n){var r=i.getFile(void 0,e.mid).getProjectId();return t.VA.Core.Utils.NestedFlowUtils.makeRunnable(r,o);},exportAsRunnable:function exportAsRunnable(t,e){var i=this,o=this.extendModel(t,!0);for(var n in delete o.FUNC_ID_CHAR,delete o.FUNC_ID_LENGTH,delete o.preferences,delete o.problemList,delete o.sheets,void 0!==e&&e||delete o.report,o.entries=[],o.functions){var r=o.functions[n],a=r.display.label||"";if(r.label=a,delete r.display,r.parent().getPrevious(r.fid).length<1&&o.entries.push(r.fid),this.carvePersist(r,!0),this.deleteEmptyArray(r),"Subflow"==r[FUNCTION_NAME]&&r.param.functions.length>0)for(var s in r.param.entries||(r.param.entries=[r.param.functions[0].fid]),r.param.functions){var l=r.param.functions[s];a=r.label||"";l.label=a,delete l.display;}}return o.innerModels&&(o.innerModels=_.reduce(_.map(o.innerModels,function(t,e){var o={};return o[e]=i.exportAsRunnable(t),o;}),_.merge,{})),o;},previousFnUnitList:function previousFnUnitList(t,e,i){var o=t.getPrevious(e);for(var n in o){-1==i.indexOf(o[n])&&i.push(o[n]),this.previousFnUnitList(t,o[n],i);}},previousLinks:function previousLinks(t,e,i){for(var o in t.links){var n=t.links[o];n[TARGET_FID]==e&&(i.push(n),this.previousLinks(t,n[SOURCE_FID],i));}},exportAsRunnableForRealTime:function exportAsRunnableForRealTime(t,e,i){var o=this.extendModel(t,!0),n=[];n.push(e.fid),this.previousFnUnitList(o,e.fid,n);var r=[];for(var a in o.functions){for(var s in n){n[s]===o.functions[a].fid&&r.push(o.functions[a]);}}var l=[];for(var c in this.previousLinks(o,e.fid,l),o.functions=r,o.links=l,delete o.FUNC_ID_CHAR,delete o.FUNC_ID_LENGTH,delete o.preferences,delete o.problemList,delete o.sheets,delete o.title,void 0!==i&&i||delete o.report,o.entries=[],o.functions){if(delete(e=o.functions[c]).display,e.parent().getPrevious(e.fid).length<1&&o.entries.push(e.fid),this.deleteEmptyArray(e),"Subflow"==e[FUNCTION_NAME]&&e.param.functions.length>0)for(var a in e.param.entries||(e.param.entries=[e.param.functions[0].fid]),e.param.functions){delete e.param.functions[a].display;}}return o;},getModelIds:function t(e,i,o){if("object"!=typeof e)return o;for(var n in e){e.hasOwnProperty(n)&&(n===i&&o.push(e[n]),t(e[n],i,o));}return o;},getModelIdsWithVersion:function t(e,i,o){if("object"!=typeof e)return o;for(var n in e){if(e.hasOwnProperty(n)){if(n===i){var r={};r[n]=e[n],e.hasOwnProperty("version_id")&&(r.version_id=e.version_id),o.push(r);}t(e[n],i,o);}}return o;},exportAsRunnableFileByTree:function exportAsRunnableFileByTree(t,e,i){return this.createModelTree(t,e).then(function(t){return this._exportAsRunnableFileByTree(e,t,i);}.bind(this));},_exportAsRunnableFileByTree:function _exportAsRunnableFileByTree(t,e,i){var o=this.exportAsRunnable(t),n={user:"input_user_id",jid:"input_job_id",main:o.mid,args:i,models:{}};if(n.models[o.mid]=o,"control"===o.type){var r=this.getModelIdsWithVersion(o.functions,"mid",[]);_.forEach(r,function(t){var i=t.version_id?t.mid+"_"+t.version_id:t.mid,o=t.version_id?e[t.mid].version[t.version_id]:e[t.mid].main;n.models[i]=this.exportAsRunnable(o.contents);}.bind(this));}else for(var a in o.gv){var s=o.gv[a];for(var l in s.param){i&&!i[s.param[l]]&&delete s.param[l];}Object.keys(s.param).length<1&&o.gv.splice(a,1);}return n;},createModelTree:function createModelTree(t,e){var i={};return Promise.all(this._createModelTree(t,e,i)).then(function(){return i;});},_createModelTree:function _createModelTree(t,e,o){var n=e.functions,r=function r(t,e,o){return o?i.fetchVersion(t,e,o):i.fetchFile(t,e);},a=function a(t,e,i){return o[e]=o[e]||{version:{}},i?o[e].version[i]=t:o[e].main=t,!0;},s=[];return _.forEach(n,function(e){e.param.functions&&s.push(this._createModelTree(t,e.param.functions,o)),"DataFlow"===e[FUNCTION_NAME]&&s.push(r(t,e.param.mid,e.param.version_id).then(function(t){return void 0===t?Promise.reject('"'+e.display.label+'" dataflow was deleted or format is invalid in selected control flow'):a(t,e.param.mid,e.param.version_id);})),void 0!==e.param.modelId&&s.push(r(t,e.param.modelId,e.param.version_id).then(function(t){return void 0===t?Promise.reject('"'+e.display.label+'" dataflow was deleted or format is invalid in selected report model'):a(t,e.param.modelId,e.param.version_id);}));}.bind(this)),_.flatten(s);},flattenModelTree:function flattenModelTree(t,e){var i=[],o=function o(t,e){return t.getMajorVersion()!==e.getMajorVersion()?e.getMajorVersion()-t.getMajorVersoin():e.getMinorVersion()-t.getMinorVersion();};return _.forOwn(t,function(t){var e=[],n=!1;_.forOwn(t.version,function(t){e.push(t),n=!0;}),e.sort(o),e=_.map(e,function(t){var e=_.cloneDeep(t.getContents());return e.versionTags=t.getTags(),e.versionDescription=t.getDescription(),e.majorVersion=t.getMajorVersion(),e.minorVersion=t.getMinorVersion(),e;}),n?e.push(_.omit(e[0],["version_id","versionTags","versionDescription","majorVersion","minorVersion"])):e.push(t.main.contents),i.push(e);}),_.flatten(i);},getModelArrayByTree:function getModelArrayByTree(e,i,o){var n=t.VA.Core.Utils.ModelUtils.flattenModelTree(e,o);return n.push(i.getContents()),n;},exportAsRunnableFile:function exportAsRunnableFile(e,i,o,n,r){var a=this.exportAsRunnable(e,n),s={};void 0!==a.report&&(s=$.extend(!0,{},a.report),delete a.report);var l={main:a.mid,models:{},reports:{},version:t.VA.Env.CoreVersion};if(r&&(l.duration=r),l.models[a.mid]=a,"control"===a.type){var c=this,d=this.getModelIds(a.functions,"mid",[]);$.each(d,function(t,e){for(var o in i){i[o].id==e&&(l.models[e]=c.exportAsRunnable(i[o].contents,n));}l.models[e]&&(n&&l.models[e].report&&l.models[e].report.data.length>0&&(l.reports[e]=$.extend(!0,{},l.models[e].report)),delete l.models[e].report);});}else for(var p in n&&s.data.length>0&&(l.reports[a.mid]=s),a.gv){var u=a.gv[p];for(var h in u.param){o&&!o[u.param[h]]&&delete u.param[h];}Object.keys(u.param).length<1&&a.gv.splice(p,1);}return l;},fileArrayToModelTree:function fileArrayToModelTree(t){var e={};return _.forOwn(t,function(t){var i=t instanceof Array?t:[t];_.forEach(i,function(t){t.version_id?function(t){e[t.mid]=e[t.mid]||{version:{}},e[t.mid].version[t.version_id]=t;}(t):function(t){e[t.mid]=e[t.mid]||{},e[t.mid].main=t;}(t);});}),e;},importModels:function importModels(o,n,r,a){var s={},l={},c={},d=this.cloneModelsByTree(this.fileArrayToModelTree(n));_.forOwn(d,function(e){s[e.main.mid]=t.VA.Core.Utils.IDGenerator.model.id(),c[e.main.mid]=e.main.title;});var p=function p(t){_.forOwn(t,function(t){t.param.functions&&p(t.param.functions),t.param.mid&&s[t.param.mid]&&(t.param.mid=s[t.param.mid]),t.param.modelId&&s[t.param.modelId]&&(t.param.modelId=s[t.param.modelId]),t.param.tableId&&l[t.param.tableId]&&(t.param.tableId=l[t.param.tableId]);});},u={},h=[];return _.forOwn(d,function(i){i.main&&p(i.main.functions),_.forOwn(i.version,function(i){var n=new t.VA.Vo.Version().setFileId(s[i.mid]).setLabel(i.title).setTags(i.versionTags).setDescription(i.versionDescription).setIsManual(!0).setType(i.type).setMajorVersion(i.majorVersion).setMinorVersion(i.minorVersion),r=_.omit(i,["versionId","versionTags","versionDescription","majorVersion","minorVersion"]);n.setContents(r),h.push(e.VersionDao.addVersion(o,n.getFileId(),n).then(function(t){return u[i.version_id]=t.getVersionId(),t;}));});}),Promise.all(h).then(function(){var e=[];return _.forOwn(d,function(n){_.forEach(n.main.functions,function(t){"DataFlow"===t[FUNCTION_NAME]&&t.param.version_id&&(t.param.version_id=u[t.param.version_id]);});var r=new t.VA.Vo.File().setFileId(s[n.main.mid]).setProjectId(o).setLabel(c[n.main.mid]).setDescription("").setCreator(t.VA.Env.Session.userId).setContents(n.main);e.push(i.addFile(o,r));}),Promise.all(e).then(function(t){return _.map(t,function(t){return i.fetchVersions(o,t.getFileId());});});});},makeEntries:function makeEntries(t){if("Subflow"==t[FUNCTION_NAME]&&t.param.functions.length>0)for(var e in t.param.links||(t.param.links=[]),t.param.entries||(t.param.entries=[],t.param.entries.push(t.param.functions[0].fid)),t.param.functions){this.makeEntries(t.param.functions[e]);}},isControlFunction:function isControlFunction(t,e){return"data"===(e?e.type:t.parent().type)&&["If","ForLoop","WhileLoop"].indexOf(t[FUNCTION_NAME])>-1;},isEmptyExpression:function isEmptyExpression(t){var e=t||"";return!_.trim(e.substring(3,e.length-1));},deleteEmptyExpression:function deleteEmptyExpression(t,e){var i=t.param;"ForLoop"===t[FUNCTION_NAME]?"count"===i.type?(_.has(i.prop,"start")&&this.isEmptyExpression(i.prop.start)&&delete i.prop.start,_.has(i.prop,"end")&&this.isEmptyExpression(i.prop.end)&&delete i.prop.end):"collection"===i.type&&_.has(i.prop,"collection")&&this.isEmptyExpression(i.prop.collection)&&delete i.prop.collection:"While"===t[FUNCTION_NAME]&&"while"===i.type&&_.has(i.prop,"expression")&&this.isEmptyExpression(i.prop.expression)&&delete i.prop.expression;},isEmpty:function isEmpty(t){return _.isUndefined(t)||_.isNull(t)||_.isNaN(t)||(_.isString(t)||_.isArray(t))&&_.isEmpty(t);},deleteEmptyArray:function deleteEmptyArray(e,i){if(e.param)for(var o in e.param){if(this.isControlFunction(e,i))this.deleteEmptyExpression(e,i);else if("functions"==o)for(var n in e.param.functions){this.deleteEmptyArray(e.param.functions[n],i||e.parent());}else if(["boolean","number"].some(function(t){return t===typeof e.param[o];})||e.param[o]){var r=e.param[o];if(_.isArray(r)){if(r.length>1)continue;if(this.isEmpty(r[0])){if(this.isEmpty(r[0])){var a=i?i.type:e.parent().type;if(t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(a,e.func).mandatory&&-1!==$.inArray(o,t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(a,e.func).mandatory))continue;delete e.param[o];}}else if(_.isArray(r[0])){if(r[0].length>1)continue;this.isEmpty(r[0][0])&&delete e.param[o];}else this.isEmpty(r[0])&&delete e.param[o];}}else{a=i?i.type:e.parent().type;if(t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(a,e.func).mandatory&&-1!==$.inArray(o,t.VA.Core.Utils.WidgetUtils.getFunctionLibrary(a,e.func).mandatory))continue;delete e.param[o];}}},deleteDisplay:function deleteDisplay(t){var e="";if(t.display&&t.display.label&&(e=t.display.label),t.label=e,t.display={label:e},"Subflow"==t[FUNCTION_NAME]){var i=t.param.functions;for(var o in i){this.deleteDisplay(i[o]);}}},getKeyMapFromModelTree:function getKeyMapFromModelTree(t){var e={fidCache:{},outputCache:{}};return _.forOwn(t,function(t){t.main&&l(t.main.functions,e),t.version&&_.forOwn(t.version,function(t){l(t.functions,e);});}),e;},cloneModelsByTree:function cloneModelsByTree(e){var i=this.getKeyMapFromModelTree(e),o={},n=function n(e,i,o){var n=$.extend(!0,{},e);return o&&n.mid&&(n.mid=t.VA.Core.Utils.IDGenerator.model.id()),n=c(n,i);};return _.forOwn(e,function(t,e){o[e]={},t.main&&(o[e].main=n(t.main,i)),t.version&&(o[e].version={},_.forOwn(t.version,function(t,r){o[e].version[r]=n(t,i);}));}),o;},cloneModel:function cloneModel(e){if("data"===e.type)return function(e){var i=_.cloneDeep(e),o={},n=function n(e){o[e]=o[e]||t.VA.Core.Utils.IDGenerator.model.id();},r=function r(t){return o[t];},l=function l(e){_.forEach(e.functions,function(e){"If"===e[FUNCTION_NAME]&&(n(e.param.if.mid),_.forEach(e.param.elseif,function(t){n(t.mid);}),n(e.param.else.mid)),"ForLoop"!==e[FUNCTION_NAME]&&"WhileLoop"!==e[FUNCTION_NAME]||n(e.param.mid);var o=t.VA.Core.Utils.NestedFlowUtils.getSubModels(i,e);_.forEach(o,l);});};_.forEach(i.innerModels,function(t,e){n(e);});var c=function c(e){_.forEach(e.functions,function(e){var o=t.VA.Core.Utils.NestedFlowUtils.getSubModels(i,e);_.forEach(o,c),"If"===e[FUNCTION_NAME]&&(e.param.if.mid=r(e.param.if.mid),_.forEach(e.param.elseif,function(t){t.mid=r(t.mid);}),e.param.else.mid=r(e.param.else.mid)),"ForLoop"!==e[FUNCTION_NAME]&&"WhileLoop"!==e[FUNCTION_NAME]||(e.param.mid=r(e.param.mid));});};l(i),c(i),i.innerModels=_.reduce(_.map(i.innerModels,function(t){t.mid=r(t.mid);var e={};return e[t.mid]=t,e;}),_.merge,{});var d={fidCache:{},tidCache:{}};return a(i,i,d),s(i,i,d),i;}(this.extendModel(e));var i=$.extend(!0,{},e);return i.mid&&(i.mid=t.VA.Core.Utils.IDGenerator.model.id()),i=c(i,n(i.functions));},cloneFnUnit:function cloneFnUnit(t){var e=r(t),i=$.extend(!0,{},t),o=e.fidCache,n=e.outputCache;return i.fid=o[i.fid],i[IN_DATA]&&(i[IN_DATA]=[]),"unload"===i.func&&(i.param["df-names"]=[]),(i=p(i,n)).param=c(i.param,e),i;},carvePersist:function carvePersist(e,i){var o,n=t.VA.SettingStorage.DEFAULT_SETTINGS["common.persist.mode"];o=t.VA.Core.Functions.Library[e.func]?t.VA.Core.Functions.Library[e.func].defaultFnUnit.persist:n;var r=e.parent()["persist-mode"];"user-mode"===n&&("true"===e["persist-mode"]?e.persist=!0:"false"===e["persist-mode"]?e.persist=!1:e.persist="true"===r||"false"!==r),"performance-mode"===n&&(e.persist=void 0!==o&&o),"storage-mode"===n&&(e.persist=void 0===o||o),"Subflow"===e[FUNCTION_NAME]&&e.param.functions.length>0&&(e.param.functions[e.param.functions.length-1].persist=!0);},generateVersionText:function generateVersionText(t){return t.major_version+"."+t.minor_version;},openDocumentationPopup:function openDocumentationPopup(){if("true"===t.VA.SettingStorage.getValue("common.document.useonline")){var e=t.VA.SettingStorage.getValue("common.document.onlinedocurl");""===e&&(e=t.VA.SettingStorage.getValue("common.document.onlinedocurl.default")),window.open(e).blur();}else t.VA.Core.Utils.WidgetUtils.openErrorDialog("Help document installed in Local does not exist.\nSet up on-line help service url or contact your administrator.\n(Settings > Preferences > Common > Use on-line help..)");},openFunctionReferencePopup:function openFunctionReferencePopup(e,i,o){var n,r;if("true"===t.VA.SettingStorage.getValue("common.document.useonline")){var a=t.VA.SettingStorage.getValue("common.document.onlinedocurl");""===a&&(a=t.VA.SettingStorage.getValue("common.document.onlinedocurl.default")),a=_.trimRight(a,"/");try{var s=[a,(navigator.language||navigator.userLanguage).toLowerCase(),"ai","v"+(t.VA.Env.CoreVersion||"3.0"),"function_reference",o||"scala",i].join("/");n=window.open(s);}catch(t){n=window.open(a);}}else r="api/va/v2/help/function",i&&(r=r+"/"+i),r=r+"?type="+e+(o?"&context="+o:""),n=window.open(r,"Brightics Help");n.blur();},createCachePersist:function createCachePersist(t,e){return l(t,e);},setKeys:function setKeys(t,e){return c(t,e);},createFileContents:function createFileContents(e,i,o,n){var r=$.extend(!0,{},e);r.mid=i,o&&(r.title=o),n&&(r.description=n);var a,s,l,c,d,p,u,h,f={},m={};for(a in r.functions){for(l in f[(d=r.functions[a]).fid]=t.VA.Core.Utils.IDGenerator.func.id(),d[OUT_DATA]){m[d[OUT_DATA][l]]=t.VA.Core.Utils.IDGenerator.table.id();}if("Subflow"===d[FUNCTION_NAME])for(y in d.param.functions){for(c in f[(p=d.param.functions[y]).fid]=t.VA.Core.Utils.IDGenerator.func.id(),p[OUT_DATA]){m[p[OUT_DATA][c]]=t.VA.Core.Utils.IDGenerator.table.id();}}}for(a in r.functions){for(y in(d=r.functions[a]).fid=f[d.fid],d[IN_DATA]){d[IN_DATA][y]=m[d[IN_DATA][y]];}for(y in d[OUT_DATA]){d[OUT_DATA][y]=m[d[OUT_DATA][y]];}if("unload"===d.func)for(y in d.param["df-names"]){d.param["df-names"][y]=m[d.param["df-names"][y]];}if("Subflow"===d[FUNCTION_NAME]){for(y in d.param.entries){d.param.entries[y]=f[d.param.entries[y]];}for(y in d.param.functions){for(s in(p=d.param.functions[y]).fid=f[p.fid],p[IN_DATA]){p[IN_DATA][s]=m[p[IN_DATA][s]];}for(s in p[OUT_DATA]){p[OUT_DATA][s]=m[p[OUT_DATA][s]];}if("load"===p.func)for(s in p.param["df-names"]){p.param["df-names"][s]=m[p.param["df-names"][s]];}if("unload"==p.func){for(s in p.param["df-names"]){p.param["df-names"][s]=m[p.param["df-names"][s]];}var g="/brtc/repo/tmp/"+t.VA.Core.Utils.IDGenerator.file.id();p.param["fs-paths"]=[g],d.param.functions[parseInt(y)+1]&&(d.param.functions[parseInt(y)+1].param["input-path"]=g,d.param.functions[parseInt(y)+1].param["output-path"]=g+".csv");}}for(y in d.param.links){(h=d.param.links[y]).kid=t.VA.Core.Utils.IDGenerator.link.id(),h[SOURCE_FID]=f[h[SOURCE_FID]],h[TARGET_FID]=f[h[TARGET_FID]];}}}for(a in r.links){(u=r.links[a]).kid=t.VA.Core.Utils.IDGenerator.link.id(),u[SOURCE_FID]=f[u[SOURCE_FID]],u[TARGET_FID]=f[u[TARGET_FID]];}if("visual"===r.type){var v=r.report.pages;for(a in v.push({id:t.VA.Core.Utils.IDGenerator.reportPage.id(),contents:{}}),v){var b=v[a].contents;for(var y in b){b[y].dataSourceId&&f[b[y].dataSourceId]&&(b[y].dataSourceId=f[b[y].dataSourceId]);}}}return r;},initDefaultModelContents:function initDefaultModelContents(){var t=this,e={url:"api/va/v2/studio/templates/data",type:"GET",contentType:"application/json; charset=utf-8",blocking:!0};$.ajax(e).done(function(e){var i=_.findIndex(e,function(t){return"Default"===t.name;});i>-1&&(t.defaultModelContents=e[i].contents);});},getDefaultModelContents:function getDefaultModelContents(){return this.defaultModelContents;},createCacheNestedFlow:a,setKeyNestedFlow:s};}.call(this),function(t,e){"use strict";var i=t.Brightics,o=brtc_require("Dao"),n=["df-names"],r=function r(t,i){var o=e.filter(t.links,function(t){return t[SOURCE_FID]===i;});return e.map(o,function(t){return t[TARGET_FID];});},a=function a(t){var i=[];return t.param.if&&i.push(t.param.if.mid),t.param.elseif&&e.forEach(t.param.elseif,function(t){i.push(t.mid);}),i.push(t.param.else.mid),i;},s=function s(t,i){var o=[],n=t.getInnerModel?t:t.getMainModel();return e.forEach(i.functions,function(t){if("if"===t.func){var i=a(t);e.forEach(i,function(t){o.push(n.getInnerModel(t));});}else"forLoop"!==t.func&&"whileLoop"!==t.func||o.push(n.getInnerModel(t.param.mid));}),e.filter(o,e.negate(e.isUndefined));},l=function l(t,i){var o=s(t,i);return e.flatten(o.concat(e.map(o,e.partial(l,t))));},c=function c(t,e){return t+"_"+e;},d=function d(t,i,n){var r={},a={},l=function l(t){return function(e){if(e){var i=e.getContents();return r[t(e)]=i,u(i,i);}};},d=l(function(t){return c(t.getFileId(),t.getVersionId());}),p=l(function(t){return t.getFileId();}),u=function u(i,r){var l=[];e.forEach(r.functions,function(e){var i;if("Flow"===e[FUNCTION_NAME]){var r=e.param.mid,s=e.param.versionId;r&&s?n||(i=c(r,s),a[i]||(a[i]=!0,l.push(o.VersionDao.getVersion(t,r,s).then(d)))):r&&(a[i=r]||(a[i]=!0,l.push(o.FileDao.getFile(t,r).then(p))));}});var h=s(i,r);return e.forEach(h,function(t){l.push(u(i,t));}),Promise.all(l);};return u(i,i).then(function(){var t=e.keys(r);return e.forIn(t,function(t){e.isUndefined(r[t])&&(r=e.omit(r,t));}),r;});},p=function p(t,i){var o=[];return function(t,i,o){var n=a(i);e.forEach(n,function(e){var i=t.getInnerModel(e);o(i);});}(t,i,function(t){o.push(t);}),o;},u=function u(t,i){var o=i?"forLoop"===i.func||"whileLoop"===i.func?function(t,e){return[t.getInnerModel(e.param.mid)];}(t,i):"if"===i.func?p(t,i):[]:t;return e.filter(o,e.negate(e.isUndefined));},h=function h(t,e,o){var r=!1,a={fnUnit:e,ref:{param:{}}},s=Object.keys(e.param);for(var l in s){var c=s[l];n.indexOf(c)>-1&&(r=!0,a.ref.param[c]=o);}if(r)return new i.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand(t,a);},f=function f(t,o,n){var r={},a=function a(o,l){r[l]={adj:[],version:o instanceof i.VA.Vo.File?"Current":"v"+o.getVersion()},n&&(r[l].model=o.getContents());var c,d,p,u=(c=o.getContents(),d=s(c,c).concat(c),p=[],d.forEach(function(t){t.functions.forEach(function(t){if("Flow"===t[FUNCTION_NAME]){var e=t.param.mid,i=t.param.versionId;e&&i?p.push({type:"version",mid:e,versionId:i}):e&&p.push({type:"file",mid:e});}});}),p).reduce(function(e,i){return"file"===i.type?e[i.mid]=Studio.getResourceManager().getFile(t,i.mid):e[i.mid+"_"+i.versionId]=Studio.getResourceManager().getVersion(t,i.mid,i.versionId),e;},{});e.forEach(u,function(t,e){r[e]||a(t,e),r[l].adj.push(e);});};return a(Studio.getResourceManager().getFile(t,o.mid),o.mid),r;},m=function m(t,i){var o={},n=f(t,i),r=function r(t){o[t]=-1;var i=e.any(n[t].adj,function(t){return!(o[t]||!r(t))||-1===o[t];});return o[t]=1,i;};return r(i.mid);};i.VA.Core.Utils.NestedFlowUtils={getParentModel:function getParentModel(t,i){if(e.has(i,"innerModels"))return i;var o=function o(e){for(var n=s(t,e),r=0;r<n.length;r++){if(n[r].mid===i.mid)return e;var a=o(n[r]);if(a)return a;}};return o(t);},getAdjacencyLists:function getAdjacencyLists(t,i){var o={};return e.forEach(i,function(e){o[e]=r(t,e);}),o;},getAdjacencyList:r,getConnectedFnUnits:function getConnectedFnUnits(t,i){for(var o=function(t,e){var i=function i(o){for(var n=o.functions,r=0;r<n.length;r++){if(n[r].fid===e)return o;}for(var a=s(t,o),l=0;l<a.length;l++){var c=i(a[l]);if(c)return c;}};return i(t);}(t,i.fid),n=r(o,i.fid),a=[],l=o.functions,c=0;c<l.length;c++){e.indexOf(n,l[c].fid)>-1&&a.push(l[c]);}return a;},getSubModels:u,createAdjustOutTableCommand:function createAdjustOutTableCommand(t,o,n,r){for(var a=[],s=n[OUT_DATA].length;s<r;){a.push(new i.VA.Core.Editors.Diagram.Commands.AddOperationCommand(t,{target:n,path:[OUT_DATA,s],value:i.VA.Core.Utils.IDGenerator.table.id()})),s++;}for(var l=function l(t){return function(e){return t!==e;};};s>r;){s--,a.push(new i.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(t,{target:n,path:[OUT_DATA,s]}));for(var c=n[OUT_DATA][s],d=i.VA.Core.Utils.NestedFlowUtils.getConnectedFnUnits(o,n),p=0;p<d.length;p++){var u=d[p],f=e.filter(u[IN_DATA],l(c));a.push(new i.VA.Core.Editors.Diagram.Commands.ChangeIntableCommand(t,{fnUnit:u,ref:{inData:f}}));var m=h(t,u,f);m&&a.push(m);}}return a;},calcNextFnUnitOutTableSize:function calcNextFnUnitOutTableSize(t,e,i,o){for(var n=u(t,e),r=0,a=0;a<n.length;a++){r=parseInt(Math.max(r,(n[a][OUT_DATA]?n[a][OUT_DATA].length:0)+(i===n[a].mid?o:0)));}return r;},getChildFlows:d,getChildModels:s,makeRunnable:function makeRunnable(t,o){return d(t,o).then(function(t){var n=e.indexBy(l(o,o),"mid"),r=e.cloneDeep(o),a=e.cloneDeep(t);return r.innerModels=n,(a=e.reduce(e.map(a,function(t,e){var o={};return o[e]=i.VA.Core.Utils.ModelUtils.exportAsRunnable(t),o;}),e.merge,{}))[r.mid]=r,{main:r.mid,models:a,version:i.VA.Env.CoreVersion};}).catch(console.error);},getAllSubModelsFromModel:l,getAllSubModelsFromFnUnit:function getAllSubModelsFromFnUnit(t,i){var o=u(t,i);return e.flatten(o.concat(e.map(o,e.partial(l,t))));},getNewActivityCommandOptions:function getNewActivityCommandOptions(t){var i=[];return"If"===t[FUNCTION_NAME]?(i.push({mid:t.param.if.mid,type:t.func,conditionType:"if"}),(i=i.concat(e.map(t.param.elseif,function(e){return{mid:e.mid,type:t.func,conditionType:"elseif"};}))).push({mid:t.param.else.mid,type:t.func,conditionType:"else"})):"ForLoop"!==t[FUNCTION_NAME]&&"WhileLoop"!==t[FUNCTION_NAME]||i.push({mid:t.param.mid,type:t.func}),i;},getFnUnitByCondition:function getFnUnitByCondition(t,i){var o=function o(t){return e.reduce(t.functions,function(t,e){return t||(i(e)?e:o(u(e)));},e.noop());};return o(t);},isProcessFunction:function isProcessFunction(t){return["SetValue","ImportData","ExportData"].indexOf(t[FUNCTION_NAME])>=0;},checkCycle:m,getLocalOutline:function getLocalOutline(t,i,o){var n=function n(r,a){var s=r.functions.map(function(i){return function(i){var r={type:"fn",fn:i,items:[],label:i.display.label,selected:i.fid===o};if("If"===i[FUNCTION_NAME]){var a=[].concat(i.param.if,i.param.elseif,i.param.else);r.items=e.map(a,function(e,i){var o="Else If";return 0===i&&(o="If"),i===a.length-1&&(o="Else"),n(t.getInnerModel(e.mid),o);});}else"ForLoop"!==i[FUNCTION_NAME]&&"WhileLoop"!==i[FUNCTION_NAME]||(r.items=[n(t.getInnerModel(i.param.mid),"ForLoop"===i[FUNCTION_NAME]?"For":"While")]);return r.active=e.any(e.map(r.items,"active")),r;}(i);});return{type:"model",model:r,items:s,active:r.mid===i.mid||e.any(e.map(s,"active")),label:a};};return n(t,t.title);},getGlobalOutline:function getGlobalOutline(t,e){if(m(t,e))throw new Error("This model contains cycle.");var i=f(t,e,!0),o=function o(t){return{id:t.model.mid,label:t.model.title+" ["+t.version+"]",items:t.adj.map(function(t){return o(i[t]);})};};return o(i[e.mid]);}};}(this,_),function(){"use strict";var t=this.Brightics;t.OptModelManager={isValidOptModel:function isValidOptModel(t){var e=this.isValidObjective(t),i=this.isValidOptFunctions(t);return e&&i;},isValidObjective:function isValidObjective(t){var e=!1;return t&&t.options&&t.options.objective&&t.options.objective.fid&&t.options.objective.tableName&&t.options.objective.row&&t.options.objective.column&&t.options.objective.sense&&(e=!0),e;},isValidOptFunctions:function isValidOptFunctions(t){var e=!1;if(t&&t.optFunctions)for(var i=0;i<t.optFunctions.length;i++){if("true"===t.optFunctions[i].optSelected)for(var o in t.optFunctions[i].optParam){"true"===t.optFunctions[i].optParam[o].optParamSelected&&(e=!0);}}return e;},renderOptModels:function renderOptModels(e){var i=Studio.getEditorContainer().getActiveModelEditor();if(e||(e=i.diagramEditorPage),e){var o=e.$mainControl.find(".brtc-va-editors-diagram-diagrameditorpage-paper");o.find(".brtc-opt-model-box").remove();var n=i.getEditorInput().getContents().optModels;if(n&&Object.keys(n).length){for(var r={},a=e.options.scale,s=e.graph.getElements(),l=0;l<s.length;l++){var c=s[l].attributes.fid,d=$.extend(!0,{},s[l].attributes.position);r[c]=d;}for(var p in n){var u,h,f,m,g=n[p].label||"Optimization",v=n[p].optFunctions,b=-1;for(l=0;l<v.length;l++){if(r[v[l].fid]){b=l;break;}}if(-1!=b){u=f=r[v[b].fid].y,h=m=r[v[b].fid].x;for(var y=0;y<v.length;y++){r[c=v[y].fid]&&(u=Math.min(u,r[c].y),f=Math.max(f,r[c].y),h=Math.min(h,r[c].x),m=Math.max(m,r[c].x));}var C=u*a,x=h*a+3,A=(t.VA.Env.Diagram.FIGURE_WIDTH+m-h)*a-5,w=(t.VA.Env.Diagram.FIGURE_HEIGHT+f-u)*a+7,D=this.isValidOptModel(n[p])?"#626fdb":"#ea3539",I=$("<div class=\"brtc-opt-model-box\" style=\"\n                        position: absolute;\n                        display: block;\n                        box-sizing: content-box;\n                        margin-top: -1px;\n                        margin-left: -5px;\n                        padding-right: 7px;\n                        pointer-events: none;\n                        border: 1px solid "+D+";' +\n                        \"></div>");o.append(I),I.css({top:C,left:x,width:A,height:w});var V=$("\n                        <div class=\"brtc-opt-model-toolbar\" style=\"\n                            position: absolute;\n                            left: -1px;\n                            top: -20px;\n                            padding: 1px 5px 0 5px;\n                            border: 1px solid "+D+";\n                            background: #fafbfc;\n                            pointer-events: auto;\n                            height: 17px;\n                            line-height: 17px;\n                            cursor: pointer;\n                        \">\n                            <div class=\"brtc-opt-model-label\" style=\"\n                                max-width: 187px;\n                                overflow: hidden;\n                                text-overflow: ellipsis;\n                                white-space: nowrap;\n                                font-size: 11px;\n                                \"></div>\n                        </div>");V.attr("opt-id",p),V.find(".brtc-opt-model-label").attr("title",g),V.find(".brtc-opt-model-label").text(g),I.append(V),V.click(function(){var t=$(this).attr("opt-id"),e=Studio.getEditorContainer().getActiveModelEditor().getSideBarManager().getSideBars().optSetting;e.show(),e.createDetailView(t),e.render(t);});}}}}},getOptModels:function getOptModels(t,e){var i=Studio.getResourceManager().getFile(t,e).getContents();if(i.optModels){var o=i.optModels;return Object.values(o).sort(function(t,e){return t.createTime<e.createTime?-1:t.createTime>e.createTime?1:0;});}return[];},getOptModel:function getOptModel(t,e,i){var o=Studio.getResourceManager().getFile(t,e).getContents();if(o.optModels&&o.optModels[i]){var n=o.optModels;return $.extend(!0,{},n[i]);}},getTargetOptModelId:function getTargetOptModelId(t,e,i){var o=Studio.getResourceManager().getFile(t,e).getContents();if(o.optModels){var n=o.optModels;for(var r in n){if(n[r].optFunctions)for(var a=n[r].optFunctions,s=0;s<a.length;s++){if(a[s].fid===i)return r;}}}return null;},createNewOptModelCommand:function createNewOptModelCommand(e,i,o,n){for(var r=Studio.getResourceManager().getFile(e,i).getContents(),a=[],s=[],l={},c=0;c<o.length;c++){var d=o[c],p=$.extend(!0,{},r.getFnUnitById(d));0!==Object.keys(p).length&&(l[d]=p,a.push(p));}for(c=0;c<r.links.length;c++){var u=r.links[c].sourceFid,h=r.links[c].targetFid;if(l[u]&&l[h]){var f=$.extend(!0,{},r.links[c]);s.push(f);}}var m=this.newOptModel(a,s,n);return new t.VA.Core.Editors.Diagram.Commands.NewOptModelCommand(this,{pid:e,mid:i,optModel:m});},createSetOptModelCommand:function createSetOptModelCommand(e,i,o,n,r){return new t.VA.Core.Editors.Diagram.Commands.SetOptModelCommand(this,{pid:e,mid:i,optId:o,optModel:n,target:r});},createRemoveOptModelCommand:function createRemoveOptModelCommand(e,i,o){return new t.VA.Core.Editors.Diagram.Commands.RemoveOptModelCommand(this,{pid:e,mid:i,optId:o});},newOptModel:function newOptModel(e,i,o){var n=$.extend(!0,[],e);o=o||{};for(var r=t.VA.Core.Utils.IDGenerator.model.id(),a=[],s=0;s<n.length;s++){a.push(n[s].fid);var l=n[s].name;delete n[s].display,delete n[s].func,delete n[s].name,delete n[s].inData,delete n[s].outData,delete n[s].param,delete n[s]["persist-mode"];var c=t.OptFunctions[l];c?(n[s].optSelected=c.optSelected,n[s].optParam=$.extend(!0,{},c.optParam)):(n[s].optSelected="none",n[s].optParam={});}var d;return{optId:r,hash:a.sort().join("_"),label:o.label||"OPT "+(d=new Date(),[d.getFullYear(),d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1,d.getDate()<9?"0"+d.getDate():d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds()].join("")),description:"description",createTime:new Date().getTime(),creator:t.VA.Env.Session.userId,updateTime:new Date().getTime(),updater:t.VA.Env.Session.userId,options:{activated:"true",useSavedModel:"false",method:"SOGA",maxIterations:"100",maxEvaluations:"20",constraints:[],objective:{fid:"",tableName:"",row:"1",column:"",sense:"maximize"}},optFunctions:n};},addOptModel:function addOptModel(t,e,i){var o=Studio.getResourceManager().getFile(t,e).getContents();o.optModels||(o.optModels={}),o.optModels[i.optId]=$.extend(!0,{},i);},setOptModel:function setOptModel(t,e,i,o){var n=Studio.getResourceManager().getFile(t,e).getContents();if(n.optModels&&n.optModels[i]){var r=n.optModels[i];for(var a in o){o[a].constructor==Array?r[a]=$.extend(!0,[],o[a]):o[a].constructor==Object?r[a]=$.extend(!0,{},o[a]):r[a]=o[a];}}},removeOptModel:function removeOptModel(t,e,i){var o=Studio.getResourceManager().getFile(t,e).getContents();if(o.optModels&&o.optModels[i]){var n=o.optModels[i];return delete o.optModels[i],n;}},buildOptRunnable:function buildOptRunnable(t){var e=function e(t,_e7){var i=!0;if("true"!==t.options.activated&&(i=!1),i)for(var o=t.optFunctions,n=0;n<o.length;n++){if(!_e7[o[n].fid]){i=!1;break;}}return i;},i=function i(t){for(var e={},i=0;i<t.functions.length;i++){e[t.functions[i].fid]=t.functions[i];}return e;},o=function o(t){var o={},r=i(t),a=t.optModels;for(var s in a){if(a.hasOwnProperty(s)){var l=a[s];e(l,r)&&(o[l.optId]=$.extend(!0,{},l));}}return n(o,r,t.links);},n=function n(t,e,i){for(var o in t){if(t.hasOwnProperty(o)){var n=t[o];r(n),a(n,e),s(n,i),delete n.optFunctions;}}return t;},r=function r(t){t.optSelected={};for(var e=t.optFunctions,i=0;i<e.length;i++){var o=e[i].fid;if("true"===e[i].optSelected)for(var n in t.optSelected[o]={optParam:{}},e[i].optParam){var r=e[i].optParam[n];"true"===r.optParamSelected&&(t.optSelected[o].optParam[n]=$.extend(!0,{},r),delete t.optSelected[o].optParam[n].optParamSelected);}}},a=function a(t,e){t.functions=[];for(var i=t.optFunctions,o=0;o<i.length;o++){var n=i[o].fid;t.functions.push($.extend(!0,{},e[n]));}},s=function s(t,e){t.links=[];for(var i=0;i<e.length;i++){var o=e[i].sourceFid,n=e[i].targetFid;t.hash.indexOf(o)>-1&&t.hash.indexOf(n)>-1&&t.links.push($.extend(!0,{},e[i]));}},l=function l(t,e){var i=[];for(var o in e){i.push({fid:e[o].optId,label:e[o].label,name:"Opt",param:{mid:e[o].optId}});}for(var n=0;n<i.length;n++){t.functions.push(i[n]);}},c=function c(t,e){var o=$.extend(!0,[],t.links),n=t.links,r=i(t),a={},s={},l={};for(var c in e){for(var d=e[c],p=0;p<o.length;p++){var u=o[p].sourceFid,h=o[p].targetFid;l[h]=!1,!(d.hash.indexOf(u)>-1)&&d.hash.indexOf(h)>-1&&(a[o[p].kid]=!0,s[u+"_"+c]||(s[u+"_"+c]=!0,n.push({sourceFid:u,targetFid:c})),n.push({sourceFid:c,targetFid:h}));}for(var f in r){!1!==l[f]&&d.hash.indexOf(f)>-1&&n.push({sourceFid:c,targetFid:f});}}for(p=n.length-1;p>=0;p--){a[n[p].kid]&&n.splice(p,1);}},d=$.extend(!0,{},t),p=d.models;for(var u in p){if(p.hasOwnProperty(u)){var h=p[u],f=o(h);c(h,f),l(h,f),h.optModels=$.extend(!0,{},f);}}return d;}};}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils.PermissionUtils={check:function check(t,e){var i=this;_.map(e,function(e){i.validate(e)||i[e](t);});},validate:function validate(t){return!(this[t]&&!this.hasPermission(t));},hasPermission:function hasPermission(e){for(var i in t.VA.Env.Session.permissions){if(t.VA.Env.Session.permissions[i].permission_id===e)return!0;}return!1;},data_upload_shared:function data_upload_shared(t){!function(t){_.map(["#upload-to-shared-local","#upload-to-shared-jdbc","#upload-to-shared-alluxio"],function(e){var i=t.find(e);i.length>0&&_.map(i,function(t){$(t).jqxRadioButton({disabled:!0});});});}(t);}};}.call(this),function(){"use strict";this.Brightics.VA.Core.Utils.QuickHelp={showQuickModeling:function showQuickModeling(){var t,e,i;t="brtc-va-quickhelp-quickdrawing",e=$("body"),(i=$('<div class="brtc-va-quickhelp-background"></div>')).addClass(t),e.append(i),i.on("click",function(){i.remove();});}};}.call(this),function(){"use strict";var t=window.markdownit&&new window.markdownit();this.Brightics.VA.Core.Utils.RenderUtils={md:function md(e,i){var o=$('<div class="brtc-va-md-content"></div>');return e.append(o),o.html(t.render(i)),o;},html:function html(t,e){var i=$('<div class="brtc-va-html-content"></div>');return t.append(i),i.append(e),i;},image:function image(t,e){var i=$('<div class="brtc-va-image-content"></div>'),o=$("<img></img>");return t.append(i),i.append(o),o.attr("src",e),i;},chart:function chart(t,e){t.bcharts(e);}};}.call(this),function(){"use strict";var t=this.Brightics;this.Brightics.VA.Core.Utils.RunnableFactory={_create:function _create(e,i){return{main:"",models:{},version:t.VA.Env.CoreVersion};},createForUnit:function createForUnit(e,i,o,n,r){var a=e.parent().type||"data",s=t.VA.Core.Interface.RunnableFactory[a];if(s)return s.createForUnit(e,i,o,n,r);},createForFlow:function createForFlow(e,i,o,n,r){var a=e.type,s=t.VA.Core.Interface.RunnableFactory[a];if(s)return s.createForFlow(e,i,o,n,r);},createForDummy:function createForDummy(e,i,o,n,r){return{main:"mid",models:{mid:{mid:"mid",type:"data",functions:[$.extend(!0,{},e)]}},version:t.VA.Env.CoreVersion};}};}.call(this),function(t){"use strict";t.Brightics.VA.Core.Utils.VariableUtils={wrap:function wrap(t){return _.startsWith(t,"${=")&&_.endsWith(t,"}")&&(t=t.substring(3,t.length-1)),"${="+t+"}";},strip:function strip(t){return _.startsWith(t,"${=")&&_.endsWith(t,"}")?t.substring(3,t.length-1):t;}};}(this),function(){"use strict";var t=function t(_t11){return _.isNull(_t11)||_.isUndefined(_t11)||""===_t11?"":_.isNumber(_t11)?_.isNaN(_t11)||_.isUndefined(_t11)?"":_t11.toString():_t11;},e=function e(t){var e=t||"";return function(t){return _.startsWith(t,"${=")&&_.endsWith(t,"}");}(e)?e.substring(3,e.length-1):e;};this.Brightics.VA.Core.Utils.VariableUtils={convertValueByType:function convertValueByType(t,e,i){},toString:t,toNumber:function toNumber(e){return _.isNull(e)||_.isUndefined(e)||""===e?0:Number(t(Number(e)));},strip:e,wrap:function wrap(t){return"${="+t+"}";}};}.call(this),function(){"use strict";var t=this.Brightics;function e(){this.initWebSocket();}e.prototype.initWebSocket=function(){var t=this;$.ajax({url:"api/v1/websocket",type:"GET",blocking:!1}).done(function(e){t.createWebSocket(e.address);});},e.prototype.createWebSocket=function(e){if("WebSocket"in window)try{var i=this.socket=new WebSocket(e+"/"+t.VA.Env.Session.userId);i.onopen=function(){console.log("Socket has been opened!");var e={socketAPI:"checkDuplicate",userId:t.VA.Env.Session.userId};i.send(JSON.toString(e));},i.onerror=function(t){},i.onmessage=function(t){try{console.log(t);}catch(e){return void console.log("This doesn't look like a valid JSON: ",t);}},i.onclose=function(){console.log("socket is closed.");};}catch(t){}else console.log("no WebSocket");},e.prototype.send=function(t){this.socket.send(t);},t.VA.Core.WebSocketVA=e;}.call(this),function(){"use strict";this.Brightics.VA.Core.Utils.WidgetUtils={ALPHABET:"23456789abcdefghijkmnpqrstuvwxyz",ID_LENGTH:8,retrieveWidget:function retrieveWidget(t){return"string"==typeof t?$(t):t;},putWorkspaceRef:function putWorkspaceRef(t,e){this.putData(t,"brtc-va-workspace-body-area-ref",e);},getWorkspaceRef:function getWorkspaceRef(t){var e=t.closest(".brtc-va-workspace-body-area");return this.getData(e,"brtc-va-workspace-body-area-ref");},putStudioRef:function putStudioRef(t,e){this.putData(t,"brtc-studio-ref",e);},getStudioRef:function getStudioRef(t){var e=$(".brtc-va-studio");return this.getData(e,"brtc-studio-ref");},putUdfRef:function putUdfRef(t,e){this.removeUdfRefData(t),this.putData(t,"brtc-udf-ref",e);},getUdfRef:function getUdfRef(t){return this.getData(t,"brtc-udf-ref");},putModelEditorRef:function putModelEditorRef(t,e){this.putEditorRef(t,e);},getModelEditorRef:function getModelEditorRef(t){return this.getEditorRef(t,"brtc-va-editors-modeleditor");},closestModelEditor:function closestModelEditor(t){return this.closestEditor(t,"brtc-va-editors-modeleditor");},putEditorRef:function putEditorRef(t,e){this.putData(t,"brtc-va-editor-ref",e);},getEditorRef:function getEditorRef(t,e){var i=e||"brtc-va-editor",o=this.closestEditor(t,i);return this.getData(o,"brtc-va-editor-ref");},closestEditor:function closestEditor(t,e){return t.closest("."+e);},putData:function putData(t,e,i){t.data(e,i);},getData:function getData(t,e){return t.data(e);},removeUdfRefData:function removeUdfRefData(t){t.removeData("brtc-udf-ref");},isRightClick:function isRightClick(t){var e,i=t||window.event;return i.which?e=3==i.which:i.button&&(e=2==i.button),e||$.jqx.mobile.isTouchDevice();},getRightClick:function getRightClick(t){if(Brightics.VA.Core.Utils.WidgetUtils.isRightClick(t)){var e=$(window).scrollTop(),i=$(window).scrollLeft();return{x:parseInt(t.clientX)+i,y:parseInt(t.clientY)+e};}},createPaletteItem:function createPaletteItem(t,e,i){var o,n,r=$('<div class="brtc-va-views-palette-fnunit-content">'),a=$('<div class="brtc-va-views-palette-fnunit brtc-style-views-palette-fnunit brtc-va-studio-dm-draggable">   <div class="brtc-va-views-palette-fnunit-icon brtc-style-views-palette-fnunit-icon"></div>   <div class="brtc-va-views-palette-fnunit-label brtc-style-views-palette-fnunit-label"></div></div>');r.append(a);var s=!1,l=Brightics.VA.Core.Interface.WidgetUtils[i];if(l&&l.createPaletteItem){var c=l.createPaletteItem(e);o=c.label,n=c.category;}else{var d="",p="",u="scala";void 0===Brightics.VA.Core.Interface.Functions[i][e]?(d="none",p="none"):(d=Brightics.VA.Core.Interface.Functions[i][e].defaultFnUnit.display.label,p=Brightics.VA.Core.Interface.Functions[i][e].category,s=s||Brightics.VA.Core.Interface.Functions[i][e].deprecated,u=Brightics.VA.Core.Interface.Functions[i][e].defaultFnUnit.context||u),o=d,n="brtc-va-fnunit-category-"+p;}return a.attr("title",o),"udf"!==p&&a.attr("context",u).attr("category",p),a.find(".brtc-va-views-palette-fnunit-label").text(o),s&&(o+="\nDeprecated: "+Brightics.VA.Core.Interface.Functions[i][e]["deprecated-message"]),a.attr("title",o),s&&a.addClass("deprecated"),a.addClass(n),t.append(r),this.putData(a,"func",e),a;},createPaletteUDFItem:function createPaletteUDFItem(t,e,i,o){var n,r,a=$('<div class="brtc-va-views-palette-fnunit-content">'),s=$('<div class="brtc-va-views-palette-fnunit brtc-style-views-palette-fnunit brtc-va-studio-dm-draggable">   <div class="brtc-va-views-palette-fnunit-icon brtc-style-views-palette-fnunit-icon"></div>   <div class="brtc-va-views-palette-fnunit-label brtc-style-views-palette-fnunit-label"></div>   <div class="brtc-va-views-palette-fnunit-remove-icon brtc-style-views-palette-fnunit-remove-icon" title="Delete"></div></div>');a.append(s);var l=!1,c=Brightics.VA.Core.Interface.WidgetUtils[i];if(c&&c.createPaletteItem){var d=c.createPaletteItem(e);n=d.label,r=d.category;}else{var p="",u="",h="scala";void 0===Brightics.VA.Core.Interface.Functions[i][e]?(p="none",u="none"):(p=Brightics.VA.Core.Interface.Functions[i][e].defaultFnUnit.display.label,u=Brightics.VA.Core.Interface.Functions[i][e].category,l=l||Brightics.VA.Core.Interface.Functions[i][e].deprecated,h=Brightics.VA.Core.Interface.Functions[i][e].defaultFnUnit.context),n=p,r="brtc-va-fnunit-category-"+u;}return s.attr("title",n),"udf"!==u&&s.attr("context",h),s.find(".brtc-va-views-palette-fnunit-label").text(n),l&&(n+="\nDeprecated: "+Brightics.VA.Core.Interface.Functions[i][e]["deprecated-message"]),s.attr("title",n),s.find(".brtc-va-views-palette-fnunit-remove-icon").on("click",function(){var e={contentText:"These items will be permanently deleted and cannot be recovered. Are you sure?",close:o,isCancel:!0};Brightics.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(t,e);}),s.find(".brtc-va-views-palette-fnunit-remove-icon").hide(),s.mouseover(function(t){$(this).find(".brtc-va-views-palette-fnunit-remove-icon").show();}),s.mouseout(function(t){$(this).find(".brtc-va-views-palette-fnunit-remove-icon").hide();}),l&&s.addClass("deprecated"),s.addClass(r),t.append(a),this.putData(s,"func",e),s;},createPaletteBox:function createPaletteBox(t){var e,i=$('<div class="brtc-va-views-palette-fnunit-content">'),o=$('<div class="brtc-va-views-palette-box-fnunit brtc-va-studio-dm-draggable">   <div class="brtc-va-views-palette-fnunit-icon brtc-style-views-palette-fnunit-icon"></div>   <div class="brtc-va-views-palette-fnunit-label brtc-style-views-palette-fnunit-label"></div></div>');i.append(o);var n=Brightics.VA.Core.Interface.WidgetUtils.data;if(n&&n.createPaletteItem){e=n.createPaletteItem(t.func).category;}else{var r="",a="scala";void 0===Brightics.VA.Core.Interface.Functions.data[t.func]?r="none":(r=Brightics.VA.Core.Interface.Functions.data[t.func].category,a=Brightics.VA.Core.Interface.Functions.data[t.func].defaultFnUnit.context),e="brtc-va-fnunit-category-"+r;}return o.attr("title",t.label),o.find(".brtc-va-views-palette-fnunit-icon").attr("context",a||"scala"),o.find(".brtc-va-views-palette-fnunit-label").text(t.label),o.addClass(e),this.putData(o,"func",t.func),o;},createTableItem:function createTableItem(t,e){var i=$('<div class="brtc-va-views-table-content">'),o=$('<div class="brtc-style-views-table brtc-va-studio-dm-draggable">   <div class="brtc-style-views-table-icon">'+e.type.substring(0,1)+'</div>   <div class="brtc-style-views-table-label"></div></div>');return i.append(o),o.attr("title",e.label),o.find(".brtc-style-views-table-label").text(e.label),t.append(i),o;},createKeyItem:function createKeyItem(t){var e=$('<div class="brtc-va-views-key-content">'),i=$('<div class="brtc-style-views-key">   <div class="brtc-style-views-key-icon"><i></i></div>   <div class="brtc-style-views-key-label"></div></div>');return e.append(i),i.attr("title",t.label),i.find(".brtc-style-views-key-icon").attr(t.type),i.find(".brtc-style-views-key-label").text(t.label),i.find("i").addClass({table:"fa fa-table",model:"fa fa-table",image:"fa fa-table"}[t.type]),e;},createDialogContentsArea:function createDialogContentsArea(t,e){var i=$('<div class="brtc-va-dialogs-body-content">    <span class="brtc-va-dialogs-body-content-icon"></span>    <div class="brtc-va-dialogs-body-content-content-text"><span></span></div></div>');t.append(i),i.find(".brtc-va-dialogs-body-content-icon").attr("alert",e.type),i.find(".brtc-va-dialogs-body-content-content-text span").text(e.contentText),i.find(".brtc-va-dialogs-body-content-content-text").attr("title",e.contentText),i.find(".brtc-va-dialogs-body-content-content-text").innerHeight()>30&&i.find(".brtc-va-dialogs-body-content-content-text").css("line-height","15px");},openConfirmDialog:function openConfirmDialog(t,e){this.createCommonConfirmDialog($("body"),{type:"info",isCancel:!0,contentText:t,close:e});},openConfirmWithOptionDialog:function openConfirmWithOptionDialog(t,e,i,o){this.createCommonConfirmWithOptionDialog($("body"),{title:t,type:"info",isCancel:!0,contentText:e,optionText:i,close:o});},checkAgentStatus:function checkAgentStatus(){return $.ajax({url:"api/va/v2/analytics/agentuser/status",blocking:!1,type:"GET"});},createProgressDialog:function createProgressDialog(t,e){var i,o={OK:!1,Cancel:!0},n=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-progress">           <div style="padding-left: 120px;"><span class="brtc-va-progress-loading"></span></div>       </div>       <div class="brtc-va-dialogs-contents">           <span class="brtc-va-dialogs-body-content-icon" alert="info"></span>           <div class="brtc-va-dialogs-body-content-content-text">Please try again later.</div>       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />       </div>   </div></div>');t.append(n),n.find(".brtc-va-dialogs-body-content-content-text").css("display","none"),n.find(".brtc-va-dialogs-body-content-icon").css("display","none"),(i=n.find(".brtc-va-dialogs-buttonbar-ok")).css("display","none");var r={theme:Brightics.VA.Env.Theme,width:400,height:280,title:e.title,modal:!0,resizable:!1,showCloseButton:!1,open:function open(){i.jqxButton({theme:Brightics.VA.Env.Theme}),i.click(function(){o={OK:!0,Cancel:!1},n.dialog("close");});},close:function close(){n.dialog("destroy"),n.remove(),"function"==typeof e.close&&e.close(o);},focus:function focus(){},keyboardCloseKey:""};return n.dialog(r),n.attr("name",r.title),n;},getBadRequestErrorMessage:function getBadRequestErrorMessage(t){if(400==t.status){var e=t.responseJSON;if(!e)try{e=JSON.parse(t.responseText);}catch(t){console.error(t);}if(e&&"BR-3203"===e.errors[0].code)return"Sorry! The workspace is not available. Please contact administrator.";}},openBadRequestErrorDialog:function openBadRequestErrorDialog(t,e){if(400===t.status){var i=t.responseJSON;if(!i)try{i=JSON.parse(t.responseText);}catch(t){i={errors:[{message:"Sorry! An unexpected error occurred. Please contact administrator.",code:400,detailMessage:t.responseText,detailContentType:"application/json"}]};}if(i&&"BR-3203"===i.errors[0].code){var o=this,n=this.createProgressDialog($("body"),{title:"Preparing workspace...",close:e}),r=0,a=function a(){var t=function t(){n.find(".brtc-va-progress").css("display","none"),n.find(".brtc-va-dialogs-body-content-content-text").css("display","block"),n.find(".brtc-va-dialogs-body-content-icon").css("display","block"),n.find(".brtc-va-dialogs-buttonbar-ok").css("display","block");};r++,o.checkAgentStatus().done(function(e){"STOP"===e?r>30?(clearTimeout(o.timer),t()):(clearTimeout(o.timer),o.timer=setTimeout(a,2e3)):(clearTimeout(o.timer),t());}).fail(function(e){clearTimeout(o.timer),t();});};clearTimeout(o.timer),o.timer=setTimeout(a,2e3);}else i&&i.errors?this.openErrorDialog(i,e):this.openErrorDialog("Sorry! An unexpected error occurred. Please contact administrator.",e);}else"function"==typeof e&&e({OK:!1,Cancel:!0});},openErrorDialog:function openErrorDialog(t,e){var i,o,n;"string"==typeof t?i=this.codeToMessage(t):t.errors&&Array.isArray(t.errors)&&((i=t.errors[0].message)||(i="Sorry! An unexpected error occurred. Please contact administrator."),0==i.indexOf("SparkException:")||0==i.indexOf("NoClassDefFoundError:")?i="Sorry! An unexpected error occurred. Please contact administrator.":0==i.indexOf("Exception:")?i=i.substring(10,msg.length).trim():0==i.indexOf("AnalysisException:")?i=i.substring(18,msg.length).trim():0==i.indexOf("InvalidInputException:")&&(i="Input path does not exist."),i.indexOf("Not allowed condition")>-1&&(i="Can not update. Check schedule status."),t.errors[0].detailMessage&&(o=t.errors[0].detailMessage),t.errors[0].contentType&&(n=t.errors[0].contentType));var r=this;clearTimeout(this.openError),this.openError=setTimeout(function(){r.createCommonConfirmDialog($("body"),{type:"error",isCancel:!1,contentText:i,close:e,detailText:o,detailContentType:n});},500);},openInformationDialog:function openInformationDialog(t,e){this.createCommonConfirmDialog($("body"),{type:"info",isCancel:!1,contentText:t,close:e});},openQuestionDialog:function openQuestionDialog(t,e){this.createCommonConfirmDialog($("body"),{type:"info",okLabel:"Yes",cancelLabel:"No",isCancel:!0,contentText:t,close:e});},openWarningDialog:function openWarningDialog(t,e){var i=this;clearTimeout(this.openWarning),this.openWarning=setTimeout(function(){i.createCommonConfirmDialog($("body"),{type:"warn",isCancel:!1,contentText:t,close:e});},500);},createCommonConfirmDialog:function createCommonConfirmDialog(t,e){var i,o,n,r={OK:!1,Cancel:!0},a=$('<div class="brtc-va-dialogs-main">   <div class="brtc-va-dialogs-body">       <div class="brtc-va-dialogs-contents" style="padding-right: 0 !important; padding-bottom: 10px !important;">       </div>       <div class="brtc-va-dialogs-buttonbar">           <input type="button" class="brtc-va-dialogs-buttonbar-ok" value="OK" />       </div>   </div></div>');t.append(a),i=a.find(".brtc-va-dialogs-buttonbar-ok"),e.okLabel&&i.val(e.okLabel),e.isCancel&&(o=$('<input type="button" class="brtc-va-dialogs-buttonbar-cancel" value="Cancel" />'),a.find(".brtc-va-dialogs-buttonbar").append(o),e.cancelLabel&&o.val(e.cancelLabel)),e.detailText&&(n=$('<input type="button" class="brtc-va-dialogs-buttonbar-detail" value="Detail" />'),a.find(".brtc-va-dialogs-buttonbar").append(n));var s=this,l={theme:Brightics.VA.Env.Theme,width:400,height:210,modal:!0,resizable:!1,cancelButton:o,open:function open(){$(".ui-dialog-titlebar.ui-widget-header").attr("style","border-bottom: none !important;"),$("button.ui-dialog-titlebar-close").css("top","30px !important"),s.createDialogContentsArea(a.find(".brtc-va-dialogs-contents"),e),i.jqxButton({theme:Brightics.VA.Env.Theme}),i.click(function(){r={OK:!0,Cancel:!1},a.dialog("close");}),e.isCancel&&(o.jqxButton({theme:Brightics.VA.Env.Theme}),o.click(function(){r={OK:!1,Cancel:!0},a.dialog("close");})),e.detailText&&(n.jqxButton({theme:Brightics.VA.Env.Theme}),n.click(function(){if(e.detailContentType&&e.detailContentType.startsWith("text/html")){window.open("/detail-popup","Detail Information",["width=800","height=600","menubar=no","status=no","toolbar=no","location=no"].join(",")).document.write(e.detailText);}else new Brightics.VA.Core.Dialogs.DetailDialog(a,{title:"Detail Information",detailText:e.detailText});}));},close:function close(){a.dialog("destroy"),a.remove(),"function"==typeof e.close&&e.close(r);},focus:function focus(){a.focus();}};return a.dialog(l),a.find(".brtc-va-dialogs-main").css("padding-left","5px"),a.attr("name",l.title),a;},createCommonConfirmWithOptionDialog:function createCommonConfirmWithOptionDialog(t,e){new Brightics.VA.Core.Dialogs.ConfirmWithOptionDialog(t,e);},codeToMessage:function codeToMessage(t){var e;if(t&&Array.isArray(t.errors)){var i="";for(var o in t.errors){(e=t.errors[o].message)||(e="Sorry! An unexpected error occurred. Please contact administrator."),0==e.indexOf("SparkException:")||0==e.indexOf("NoClassDefFoundError:")?e="Sorry! An unexpected error occurred. Please contact administrator.":0==e.indexOf("Exception:")?e=e.substring(10,e.length).trim():0==e.indexOf("AnalysisException:")?e=e.substring(18,e.length).trim():0==e.indexOf("InvalidInputException:")&&(e="Input path does not exist."),e.indexOf("Not allowed condition")>-1&&(e="Can not update. Check schedule status."),i+=e+"\n";}return i;}return"string"==typeof t?(0==(e=t).indexOf("SparkException:")||0==e.indexOf("NoClassDefFoundError:")?e="Sorry! An unexpected error occurred. Please contact administrator.":0==e.indexOf("Exception:")?e=e.substring(10,e.length).trim():0==e.indexOf("AnalysisException:")?e=e.substring(18,e.length).trim():0==e.indexOf("InvalidInputException:")&&(e="Input path does not exist."),e):t;},convertHTMLSpecialChar:function convertHTMLSpecialChar(t){return t?t=(t=(t=(t=(t=t.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/"/g,"&quot;")).replace(/\s/g,"&nbsp;"):t;},adjustCodeMirrorEsc:function adjustCodeMirrorEsc(t){t.on("endCompletion",function(t){window.event instanceof KeyboardEvent&&"keydown"==window.event.type&&"Escape"==window.event.key&&window.event.stopPropagation();});},setValidatorToCodeMirror:function setValidatorToCodeMirror(t){var e={};return e.type=void 0===t?"":t["valid-type"],e.isValid=function(t){return!e.type||Brightics.VA.Core.Utils.InputValidator.isValid[e.type](t);},e;},changeCodeMirrorLineToSingle:function changeCodeMirrorLineToSingle(t,e){var i=this.setValidatorToCodeMirror(e);t.on("beforeChange",function(t,o){var n=o.text.join("").replace(/\n/g,"");o.update(o.from,o.to,[n]);var r="+input"==o.origin&&"object"==typeof o.text&&""==o.text.join(" "),a="setValue"===o.origin||"+delete"===o.origin?void 0:o.text.join("")||"",s=i.isValid(a);if(!s){var l="※ This character( "+(a="\t"===(a=a.length>10?a.substring(0,9)+"...":a)?"Tab":""===a?"Enter":a)+" ) is NOT allowed.";Brightics.VA.Core.Widget.Factory.createFadeOutMessage($(t.display.lineDiv).closest(".CodeMirror"),{message:l,position:e["valid-message-position"]});}if(r||!s)return t.doc.setCursor(t.getCursor()),o.cancel();if("paste"==o.origin&&"object"==typeof o.text&&o.text.length>1){var c=o.text.join(" ");return o.update(null,null,[c]);}return null;}),t.setSize("100%","27px");},setCodeMirrorMaxLength:function setCodeMirrorMaxLength(t){t.on("beforeChange",function(t,e){var i=t.getOption("maxLength");if(i&&e.update){var o=e.text.join("\n"),n=o.length-(t.indexFromPos(e.to)-t.indexFromPos(e.from));if(n<=0)return $(t.getTextArea()).trigger("hideOverflow"),!0;(n=t.getValue().length+n-i)>0&&($(t.getTextArea()).trigger("showOverflow"),o=o.substr(0,o.length-n),e.update(e.from,e.to,o.split("\n")));}return!0;});},createUDFItem:function createUDFItem(t,e,i,o,n){var r,a,s=$('<div class="brtc-va-views-udf-fnunit-content brtc-va-views-udf-type-'+e.type+'">'),l=$('<div class="brtc-va-views-udf-fnunit brtc-style-views-udf-fnunit brtc-va-studio-dm-draggable">   <div class="brtc-va-views-udf-fnunit-icon"></div>   <div class="brtc-va-views-udf-fnunit-label"></div>   <div class="brtc-va-views-udf-fnunit-version"></div>   <div class="brtc-va-views-udf-fnunit-remove-icon brtc-style-udf-fnunit-remove-icon" title="Delete"></div></div>');s.append(l);var c=Brightics.VA.Core.Interface.WidgetUtils[i];if(c&&c.createPaletteItem){var d=c.createPaletteItem(e.id);r=d.label,a=d.category;}else{var p="",u="";Brightics.VA.Core.Interface.Functions[i][e.id],p=e.label,u=" ver"+e.version,r=p,a="brtc-va-fnunit-category-"+"udf";}return l.find(".brtc-va-views-udf-fnunit-open-icon").hide(),l.find(".brtc-va-views-udf-fnunit-remove-icon").hide(),l.attr("title",r),l.find(".brtc-va-views-udf-fnunit-label").text(r),l.find(".brtc-va-views-udf-fnunit-version").text(u),l.find(".brtc-va-views-udf-fnunit-open-icon").on("click",function(){n();}),l.mouseover(function(t){$(this).find(".brtc-va-views-udf-fnunit-open-icon").show(),$(this).find(".brtc-va-views-udf-fnunit-remove-icon").show();}),l.mouseout(function(t){$(this).find(".brtc-va-views-udf-fnunit-open-icon").hide(),$(this).find(".brtc-va-views-udf-fnunit-remove-icon").hide();}),l.find(".brtc-va-views-udf-fnunit-remove-icon").on("click",function(){var e={contentText:"These items will be permanently deleted and cannot be recovered. Are you sure?",close:o,isCancel:!0};Brightics.VA.Core.Utils.WidgetUtils.createCommonConfirmDialog(t,e);}),l.addClass(a),t.append(s),this.putData(l,"udf",e),l;},getFunctionLibrary:function getFunctionLibrary(t,e){return void 0===Brightics.VA.Core.Interface.Functions[t][e]?Brightics.VA.Core.Interface.Functions[t].unknownFunction:Brightics.VA.Core.Interface.Functions[t][e];},createPrivatePolicy:function createPrivatePolicy(t){var e=$('<div class="brtc-va-widget-utils-private-policy-division">   <span class="brtc-va-widget-utils-private-policy-span">Private Policy</span></div>');t.append(e),e.click(function(){window.open("/private-policy","Brightics Private Policy");});var i=t.find(".brtc-va-workspace-project-list");i&&i.length&&i.css("height","calc(100% - 98px)");},updateGridSource:function updateGridSource(t,e){var i=new $.jqx.dataAdapter(e);t.jqxGrid("source",i),t.jqxGrid("clearfilters"),t.jqxGrid("clearselection"),this.updatePageButton(t);},updatePageButton:function updatePageButton(t){var e=t.jqxGrid("getpaginginformation"),i=t.find(".jqx-grid-pager div[type=button][title=first]"),o=t.find(".jqx-grid-pager div[type=button][title=previous]"),n=t.find(".jqx-grid-pager div[type=button][title=last]"),r=t.find(".jqx-grid-pager div[type=button][title=next]");0===e.pagenum?(i.css("opacity",".3").jqxButton({disabled:!0}),o.css("opacity",".3").jqxButton({disabled:!0})):(i.css("opacity","1").jqxButton({disabled:!1}),o.css("opacity","1").jqxButton({disabled:!1})),0===e.pagescount||e.pagenum===e.pagescount-1?(n.css("opacity",".3").jqxButton({disabled:!0}),r.css("opacity",".3").jqxButton({disabled:!0})):(n.css("opacity","1").jqxButton({disabled:!1}),r.css("opacity","1").jqxButton({disabled:!1}));},debounce:function debounce(t,e){return _.debounce(t,e,{maxWait:e});},setTrimInputControlOnFocusout:function setTrimInputControlOnFocusout(t){t.focusout(function(e){var i=t.val(),o=Brightics.VA.Core.Utils.InputValidator.isValid;(o.startWithSpace(i)||o.endWithSpace(i))&&(t.val(i.trim()),Brightics.VA.Core.Widget.Factory.createFadeOutMessage(t,{message:"This input value is trimmed.",position:"bottom"}));});},convertInequalitySign:function convertInequalitySign(t){return t?t=(t=t.replace(/<=/g,"≤")).replace(/>=/g,"≥"):t;},destroyJqxControl:function destroyJqxControl(t){t.find(".jqx-widget").each(function(){var t=$(this).data();if(t.jqxWidget){var e=t.jqxWidget.widgetName;"function"==typeof $(this)[e]&&$(this)[e]("destroy");}});}};}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=this.setOptions(e),this.retrieveParent(),this.createControls(),this.createEditorCommands(),this.registerEventListener(),this.setValue(this.options.value),this.navigateFileEnd();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.setOptions=function(t){return $.extend(!0,{},t);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-widget-ace-editor-control"></div>'),this.$parent.append(this.$mainControl),this.editor=ace.edit(this.$mainControl[0]),this.options.mode&&this.editor.session.setMode("ace/mode/"+this.options.mode),this.editor.setTheme("ace/theme/eclipse");var t={enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,minLines:10,maxLines:10};this.options.editorOptions&&$.extend(!0,t,this.options.editorOptions),this.editor.setOptions(t),this.editor.setShowPrintMargin(!1),this.editor.$blockScrolling=1/0;},e.prototype.getWrapperDiv=function(){return this.$mainControl;},e.prototype.createEditorCommands=function(){for(var t in this.options.commands){this.editor.commands.addCommand(this.options.commands[t]);}},e.prototype.registerEventListener=function(){for(var t in this.options.events){this.editor.addEventListener(this.options.events[t].name,this.options.events[t].event);}},e.prototype.setValue=function(t){this.editor.setValue(t);},e.prototype.getValue=function(){return this.editor.getValue();},e.prototype.getEditor=function(){return this.editor;},e.prototype.resize=function(){this.editor.resize();},e.prototype.navigateFileEnd=function(){return this.editor.navigateFileEnd();},e.prototype.getCursorPosition=function(){return this.editor.getCursorPosition();},e.prototype.getSession=function(){return this.editor.session;},e.prototype.insert=function(t){this.editor.insert(t);},e.prototype.focus=function(){this.editor.focus();},e.prototype.setHeight=function(t){this.$mainControl.css("height",t);},e.prototype.destroy=function(){this.editor.destroy(),this.$mainControl.remove();},t.VA.Core.Widget.Controls.AceEditorControl=e;}.call(this),function(){"use strict";var t=this.Brightics,e={button:{visible:!0,disabled:!1,checked:!0,on:{label:"ON",value:"on"},off:{label:"OFF",value:"off"}}};function i(t,e){this.parentId=t,this.initOptions(e),this.retrieveParent(),this.createControls(),this.setInputValue();}i.prototype.initOptions=function(t){this.options=$.extend(!0,{},e,t),this.variableKey=Object.keys(this.options.variable)[0],this.inputType=this.options.variable[this.variableKey].type,this.variableType=this.options.variable[this.variableKey]["variable-type"],this.variableValue=this.options.variable[this.variableKey].value;},i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createControls=function(){var t=this;this.$mainControl=$('<div class="brtc-va-widget-container">   <div class ="brtc-va-widget-remove" />   <div class="brtc-va-widget-header">       <div class="brtc-va-widget-label">'+this.variableKey+'</div>       <div class="brtc-va-widget-type-button-area"><div class="brtc-va-widget-type-switch-button"></div></div>   </div>   <div class="brtc-va-widget-contents"><div class="brtc-va-widget-contents-input-container-wrapper"></div></div></div>'),this.$parent.append(this.$mainControl),this.$mainControl.find(".brtc-va-widget-label").addClass(this.variableType),this.options.mandatory&&this.$mainControl.find(".brtc-va-widget-label").addClass("mandatory"),this.createTypeButtonControl(),this.createContentsArea(),this.$mainControl.find(".brtc-va-widget-remove").on("click",function(){"function"==typeof t.options.onRemoveCallback&&(t.options.onRemoveCallback(t.createFormattedValue()),t.$mainControl.remove());}),"calculation"===this.variableType&&(this.$mainControl.find(".brtc-va-widget-type-button-area").hide(),this.$mainControl.find(".brtc-va-widget-contents-input-control-container").addClass("read-only"));},i.prototype.createTypeButtonControl=function(){var t=this;if(this.$btnArea=this.$mainControl.find(".brtc-va-widget-type-switch-button"),this.options.button.visible){var e,i,o=this.options.button.on.label,n=this.options.button.on.value;this.isArrayValue()?(e="Variable",i="expression"):(e=this.options.button.off.label,i=this.options.button.off.value),this.$btnArea.jqxSwitchButton({height:"100%",width:"100px",thumbSize:"15%",onLabel:o,offLabel:e,checked:this.setSwitchButtonChecked()}),this.inputType=this.$btnArea.val()?n:i,this.$btnArea.on("change",function(e){t.variableValue=t.getInputValue(),t.inputType=t.$btnArea.val()?n:i,t.$contentsArea.empty(),t.createContentsArea(),t.setInputValue(),t.triggerChangeInputValue(!0);});}},i.prototype.setSwitchButtonChecked=function(){var t,e,i=this.options.button.on.value;return e=this.isArrayValue()?"expression":this.options.button.off.value,this.inputType===i?t=!0:this.inputType===e?t=!1:(this.inputType=this.options.button.checked?i:e,t=this.options.button.checked),t;},i.prototype.isArrayValue=function(){return"array"===this.variableType&&this.options.button.visible;},i.prototype.createContentsArea=function(){this.$contentsArea=this.$mainControl.find(".brtc-va-widget-contents-input-container-wrapper"),this.isArrayValue()?"expression"!==this.inputType?this.createArrayInputControl():(this.$contentsArea.append($('<div class="brtc-va-widget-contents-input-container">   <div class="brtc-va-widget-contents-input-control-container"></div></div>')),this.createCodeInputControl(this.$contentsArea.find(".brtc-va-widget-contents-input-control-container"))):this.createSingleInputControl();},i.prototype.createArrayInputControl=function(){if(0===this.variableValue.length)this.createInputControlLayout(0,this.isArrayValue());else if(this.variableValue instanceof Array)for(var t=0;t<this.variableValue.length;t++){this.createInputControlLayout(t,this.isArrayValue());}else this.createInputControlLayout(0,this.isArrayValue());this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar();},i.prototype.createSingleInputControl=function(){this.createInputControlLayout(0,!1);},i.prototype.createInputControlLayout=function(t,e,i){var o=this.$contentsArea,n=this,r=!1,a=$('<div class="brtc-va-widget-contents-input-container"></div>'),s=o.find(".brtc-va-widget-contents-input-container");0!==s.length&&s[t]?($(s[t]).after(a),r=!0):o.append(a);var l,c,d=$('<div class="brtc-va-widget-contents-input-control-container"></div>');a.append(d),(t>0||r)&&(c=$('<div class="brtc-va-widget-contents-input-control-delete"></div>'),a.append(c),c.click(function(t){n.handleDeleteButtonClick($(this).closest(".brtc-va-widget-contents-input-container"));})),e&&(l=$('<div class="brtc-va-widget-contents-input-control-add"></div>'),a.append(l),l.click(function(t){n.handleAddInputControlEvent($(this).closest(".brtc-va-widget-contents-input-container"));})),this.isArrayValue()?this.createInputControl(d,i):this.createCodeInputControl(d,i);},i.prototype.createInputControl=function(e,i){var o=this,n=$('<input type="text" class="brtc-va-widget-contents-input-control"/>');e.append(n);var r={theme:t.VA.Env.Theme,height:"25px",width:"100%",placeHolder:"Enter value"};n.jqxInput(r),i&&n.jqxInput("focus"),n.keydown(function(t){13==t.keyCode&&o.isArrayValue()&&o.handleAddInputControlEvent(n.closest(".brtc-va-widget-contents-input-container"),!0);}),n.focusout(function(t){o.triggerChangeInputValue();});},i.prototype.createCodeInputControl=function(e,i){var o=this,n=$('<textarea  class="brtc-va-widget-contents-input-control"/>');e.append(n);var r={mode:"brtc-control",scrollbarStyle:"null",placeholder:this.options.button.visible?"calculation"==this.inputType?"Enter expression\tex. ${Variable1}+${Variable2}":"Enter value\tex. 1":"Enter variable\tex. ${Variable1}",lineWrapping:!1,matchBrackets:!1,extraKeys:{"Ctrl-Space":"autocomplete",Tab:!1,"Shift-Tab":!1},showTrailingSpace:!0,hintOptions:{list:[]},readOnly:"calculation"===this.variableType};this.codeMirror=CodeMirror.fromTextArea(n[0],r);var a={"valid-message-position":this.options["valid-message-position"],"valid-type":this.options.button.visible?this.isArrayValue&&"expression"===this.inputType?"type3":"":"type3"};t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.codeMirror,a),this.codeMirror.on("blur",function(t,e){o.triggerChangeInputValue();});},i.prototype.handleAddInputControlEvent=function(t,e){var i=t.index();this.createInputControlLayout(i,!0,e),this.triggerChangeInputValue(),this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar("update");var o=this.$mainControl.parents(".ps-container");o&&o.length&&o.perfectScrollbar("update");},i.prototype.handleDeleteButtonClick=function(t){t.remove(),this.triggerChangeInputValue(),this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar("update");var e=this.$mainControl.parents(".ps-container");e&&e.length&&e.perfectScrollbar("update");},i.prototype.triggerChangeInputValue=function(t){if("function"==typeof this.options.onChangeCallback){var e=this.getInputValue();(JSON.stringify(e)!==JSON.stringify(this.variableValue)||t)&&(this.variableValue=e,this.options.onChangeCallback(this.createFormattedValue()));}},i.prototype.createFormattedValue=function(){return{key:this.variableKey,type:this.inputType,"variable-type":this.variableType,value:this.variableValue};},i.prototype.getFormattedValue=function(){return{key:this.variableKey,type:this.inputType,"variable-type":this.variableType,value:this.getInputValue()};},i.prototype.getInputValue=function(){var t,e=this.$contentsArea.find(".brtc-va-widget-contents-input-control");if(this.isArrayValue()&&"expression"!==this.inputType){t=[];for(var i=0;i<e.length;i++){t.push($(e[i]).val());}}else t=this.codeMirror.getValue();return t;},i.prototype.setVariableType=function(t){this.variableType=t,this.$contentsArea.empty(),this.createContentsArea();},i.prototype.setInputValue=function(t){void 0!==t&&(this.variableValue=t);var e,i=this.$contentsArea.find(".brtc-va-widget-contents-input-control");if(this.isArrayValue()&&"expression"!==this.inputType){if(Array.isArray(this.variableValue)){if(i.length>this.variableValue.length)for(e=0;e<i.length;e++){void 0===this.variableValue[e]?$(i[e]).parents(".brtc-va-widget-contents-input-container").remove():$(i[e]).val(this.variableValue[e]||"");}else{for(e=i.length;e<this.variableValue.length;e++){this.createInputControlLayout(e,!0);}for(i=this.$contentsArea.find(".brtc-va-widget-contents-input-control"),e=0;e<i.length;e++){$(i[e]).val(this.variableValue[e]||"");}}}else $(i[0]).val(this.variableValue||"");}else Array.isArray(this.variableValue)?this.codeMirror.setValue(this.variableValue[0]):this.codeMirror.setValue(this.variableValue);},i.prototype.setRemovable=function(t){this.options.removable=t,t?this.$mainControl.find(".brtc-va-widget-remove").addClass("removable"):this.$mainControl.find(".brtc-va-widget-remove").removeClass("removable");},i.prototype.getOptions=function(){return this.options;},this.Brightics.VA.Core.Widget.Controls.ArgumentControl=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.initOptions(e),this.retrieveParent(),this.createControls();}e.prototype.initOptions=function(t){this.options=t,this._isNumberType="number"===this.options.type;},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-widget-container">   <div class="brtc-va-widget-contents"><div class="brtc-va-widget-contents-input-container-wrapper"></div></div></div>'),this.$parent.append(this.$mainControl),this.$contentsArea=this.$mainControl.find(".brtc-va-widget-contents-input-container-wrapper"),this.createArrayInputControl(this.$contentsArea);},e.prototype.createArrayInputControl=function(){this.createInputControlLayout(0),this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar();},e.prototype.createInputControlLayout=function(t){var e=this.$contentsArea,i=this,o=!1,n=$('<div class="brtc-va-widget-contents-input-container"></div>'),r=e.find(".brtc-va-widget-contents-input-container");0!==r.length&&r[t]?($(r[t]).after(n),o=!0):e.append(n);var a,s,l=$('<div class="brtc-va-widget-contents-input-control-container"></div>');n.append(l),(t>0||o)&&(s=$('<div class="brtc-va-widget-contents-input-control-delete"></div>'),n.append(s),s.click(function(t){i.handleDeleteButtonClick($(this).closest(".brtc-va-widget-contents-input-container"));})),a=$('<div class="brtc-va-widget-contents-input-control-add"></div>'),n.append(a),a.click(function(t){i.handleAddInputControlEvent($(this).closest(".brtc-va-widget-contents-input-container"));}),this._isNumberType?this.createNumericInputControl(l):this.createInputControl(l);},e.prototype.createNumericInputControl=function(e){var i=this,o={theme:t.VA.Env.Theme,height:"25px",width:"100%",numberType:"double",placeHolder:"Enter value",className:["brtc-va-widget-contents-array-input-control"]};new t.VA.Core.Widget.Controls.NumericInput(e,o).onChange(function(){i.triggerChangeInputValue();});},e.prototype.createInputControl=function(e){var i=this,o=$('<input type="text" class="brtc-va-widget-contents-array-input-control"/>');e.append(o);var n={theme:t.VA.Env.Theme,height:"25px",width:"100%",placeHolder:"Enter value"};o.jqxInput(n),o.focusout(function(t){i.triggerChangeInputValue();});},e.prototype.handleAddInputControlEvent=function(t){var e=t.index();this.createInputControlLayout(e),this.triggerChangeInputValue(),this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar("update");var i=this.$mainControl.parents(".ps-container");i&&i.length&&i.perfectScrollbar("update");},e.prototype.handleDeleteButtonClick=function(t){t.remove(),this.triggerChangeInputValue(),this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar("update");var e=this.$mainControl.parents(".ps-container");e&&e.length&&e.perfectScrollbar("update");},e.prototype.triggerChangeInputValue=function(t){if("function"==typeof this.options.onChangeCallback){var e=this.getInputValue();(JSON.stringify(e)!==JSON.stringify(this._preValue)||t)&&(this.options.onChangeCallback(e),this._preValue=e);}},e.prototype.getInputValue=function(){var t,e=this.$contentsArea.find(".brtc-va-widget-contents-array-input-control");(t=[]).length=e.length;for(var i=0;i<e.length;i++){var o=this.getValueByType($(e[i]).val());t[i]=o;}return t;},e.prototype.setValue=function(t){this._preValue=t;var e,i=this.$contentsArea.find(".brtc-va-widget-contents-array-input-control");if(i.length>t.length)for(e=0;e<i.length;e++){void 0!==t[e]&&$(i[e]).val(this.getValueByType(t[e])),e>=t.length&&0!==t.length&&$(i[e]).closest(".brtc-va-widget-contents-input-container").remove();}else{for(e=i.length;e<t.length;e++){this.createInputControlLayout(e,!0);}for(i=this.$contentsArea.find(".brtc-va-widget-contents-array-input-control"),e=0;e<i.length;e++){$(i[e]).val(this.getValueByType(t[e]));}}},e.prototype.toString=function(t){return _.isNull(t)||_.isUndefined(t)||""===t?"":_.isNumber(t)?_.isNaN(t)||_.isUndefined(t)?"":t.toString():t;},e.prototype.toNumber=function(t){return _.isNull(t)||_.isUndefined(t)||""===t?null:Number(this.toString(Number(t)));},e.prototype.getValueByType=function(t){return this._isNumberType?this.toNumber(t):this.toString(t);},this.Brightics.VA.Core.Widget.Controls.ArrayInputControl=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.$parent=t,this.options=e;var i=this.getParentOffset(),o=this.getParentSize();this.removePreMessageBox(),this.createMessageBox(i,o),this.notifyMessage();}e.prototype.getParentOffset=function(){return this.$parent.offset();},e.prototype.getParentSize=function(){return{width:this.$parent.width(),height:this.$parent.height()};},e.prototype.removePreMessageBox=function(){var t=$("body").children(".brtc-va-widget-messagebox-container");t.length>0&&t.remove();},e.prototype.removeMessageBoxTimeout=function(){var t=this;setTimeout(function(){var e=$("body").children(".brtc-va-widget-messagebox-container");e.find("div").length>0?t.removeMessageBoxTimeout():e.remove();},1e3);},e.prototype.createMessageBox=function(t,e){this.$messageBox=$('<div class="brtc-va-widget-messagebox-container"></div>'),$("body").append(this.$messageBox),this.messageBoxWidth=this.$messageBox.width(),this.removeMessageBoxTimeout();},e.prototype.getMessageBoxOffset=function(t,e){var i=this.options.position;return"bottom"===i?{top:t.top+e.height+10,left:t.left}:"left"===i?{top:t.top,left:t.left-this.messageBoxWidth-10}:{top:t.top,left:t.left+e.width+10};},e.prototype.notifyMessage=function(){$("<div>"+this.options.message+"</div>").jqxNotification({width:"100%",appendContainer:this.$messageBox,opacity:.9,autoClose:!0,autoOpen:!0,template:"info",theme:"office"});},t.VA.Core.Widget.Controls.FadeOutMessage=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.defaultOptions={multiple:!0,fileType:["json"]},this.options=$.extend(!0,this.defaultOptions,e),this.files={},this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-widget-controls-fileList">   <div class="brtc-va-widget-controls-fileList-toolbar"></div>   <div class="brtc-va-widget-controls-fileList-list-wrapper">       <div class="brtc-va-widget-controls-fileList-list"></div>   </div></div>'),this.$toolbarArea=this.$mainControl.find(".brtc-va-widget-controls-fileList-toolbar"),this.$listArea=this.$mainControl.find(".brtc-va-widget-controls-fileList-list"),this.$mainControl.find(".brtc-va-widget-controls-fileList-list-wrapper").perfectScrollbar(),this.$parent.append(this.$mainControl),this.renderToolbarArea(this.$toolbarArea),this.renderListArea(this.$listArea);},e.prototype.renderToolbarArea=function(t){this.createSumArea(t),this.createDeleteFileButton(t),this.createSelectFileButton(t);},e.prototype.renderListArea=function(e){var i=this;e.append($('<div class="brtc-va-dialogs-publish-management-grid"></div>'));var o=new $.jqx.dataAdapter({localdata:[],datafields:[{name:"name",type:"string"},{name:"size",type:"string"},{name:"lastModifiedDate",type:"date"},{name:"lastModified",type:"timestamp"},{name:"type",type:"string"},{name:"webkitRelativePath",type:"string"},{name:"fileKey",type:"string"}],datatype:"json"});this.$fileListGrid=e.find(".brtc-va-dialogs-publish-management-grid").jqxGrid({theme:t.VA.Env.Theme,width:"100%",height:"calc(100% - 45px)",altrows:!1,filterable:!1,source:o,sortable:!1,columnsresize:!0,selectionmode:"checkbox",showfiltercolumnbackground:!1,rowsheight:53,columns:[{text:"Name",datafield:"name",align:"center",cellclassname:"brtc-grid-cell",cellsrenderer:i.renderer,renderer:i.gridV2Renderer,width:"50%"},{text:"Size",datafield:"size",align:"center",cellclassname:"brtc-grid-cell",cellsrenderer:i.fileSizeRenderer,renderer:i.gridV2Renderer,width:80},{text:"Last Modified Date",datafield:"lastModifiedDate",align:"center",cellclassname:"brtc-grid-cell",renderer:i.gridV2Renderer,cellsalign:"center",cellsformat:"yyyy-MM-dd h:mm:ss"},{text:"fileKey",datafield:"fileKey",hidden:!0},{text:"lastModified",datafield:"lastModified",hidden:!0},{text:"type",datafield:"type",hidden:!0},{text:"webkitRelativePath",datafield:"webkitRelativePath",hidden:!0}]}),this.setGridStyleV2(this.$fileListGrid);var n=function n(){i.$fileListGrid.jqxGrid("getselectedrowindexes").length>0?(i.$deleteButton.jqxButton({disabled:!1}),i.$deleteButton.css("cursor","pointer")):(i.$deleteButton.jqxButton({disabled:!0}),i.$deleteButton.css("cursor","default"));};this.$fileListGrid.on("rowselect",n.bind(i)),this.$fileListGrid.on("rowunselect",n.bind(i));},e.prototype.fileSizeRenderer=function(e,i,o){var n="1.00 KB";return o>1024&&(n=t.VA.Core.Utils.CommonUtils.byteCalculation(o)),'<div index="'+e+'" style="float: right;height:53px;line-height:53px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;width: calc(100% - 15px); ">'+n+"</div>";},e.prototype.renderer=function(t,e,i,o,n,r){var a="",s="float: left;margin-left: 15px;height:53px;line-height:53px;text-overflow: ellipsis;white-space: nowrap;overflow: hidden;width: calc(100% - 15px); ";return r.errorMessage?(s+="color:red;",a=r.errorMessage):a=i,'<div title="'+a+'" fileKey="'+r.fileKey+'" index="'+t+'" style="'+s+'">'+i+"</div>";},e.prototype.gridV2Renderer=function(t){return'<div style="opacity:0.8; font-family: Arial; font-size: 16px; font-weight: bold; text-align: center; color: rgba(0, 0, 0, 0.8);">'+t+"</div>";},e.prototype.setGridStyleV2=function(t){t.addClass("GridStyleV2"),t.css({height:"calc(100% - 35px) !important","margin-top":"15px !important","margin-bottom":"20px !important"}),this.$mainControl.find("input[type=button]").width(100);},e.prototype.createSumArea=function(t){this.$sumArea=$('<div class="brtc-va-widget-controls-fileList-toolbar-sum">   <span>Total<strong class="brtc-va-widget-controls-fileList-toolbar-sum-count">0</strong></span></div>'),t.append(this.$sumArea);},e.prototype.createSelectFileButton=function(e){var i=this,o=$('<div class="brtc-va-widget-controls-fileList-toolbar-selectfile">   <input for="brtc-va-widget-controls-fileList-toolbar-selectfile-button" type="button" id="fileselect-local" value="Select File" />   <input type="file" id="brtc-va-widget-controls-fileList-toolbar-selectfile-file" name="fileToUpload" accept=".json"></div>');e.append(o);var n=o.find("#fileselect-local"),r=o.find("#brtc-va-widget-controls-fileList-toolbar-selectfile-file");this.options.multiple&&r.attr("multiple",!0),r.hide(),n.jqxButton({theme:t.VA.Env.Theme}),n.on("click",function(){r.click();}),r.on("input",function(e){var o=$(this)[0].files;if(i.isJsonFile(o)){var n=i.addFileKey(o),a=i.renderFiles(n);i.$parent.trigger("addFile",[n,a]);}else t.VA.Core.Utils.WidgetUtils.openErrorDialog(".json file can be imported only");r.val(null);});},e.prototype.setTotalCount=function(){this.$sumArea.find(".brtc-va-widget-controls-fileList-toolbar-sum-count").text(this.$fileListGrid.jqxGrid("getRows").length);},e.prototype.addFileKey=function(e){for(var i={},o=0;o<e.length;o++){i[t.VA.Core.Utils.IDGenerator.importedFile.id()]=e[o];}return i;},e.prototype.createDeleteFileButton=function(e){var i=this,o=$('<div class="brtc-va-widget-controls-fileList-toolbar-deletefile">   <input class="brtc-va-widget-controls-fileList-toolbar-deletefile-button" type="button" value="Delete File" /></div>');e.append(o),this.$deleteButton=o.find(".brtc-va-widget-controls-fileList-toolbar-deletefile-button"),this.$deleteButton.jqxButton({theme:t.VA.Env.Theme,disabled:!0}),this.$deleteButton.on("click",function(){for(var t=[],e=i.$fileListGrid.jqxGrid("getselectedrowindexes").sort(function(t,e){return t-e;}),o=e.length-1;o>=0;o--){var n=i.$fileListGrid.jqxGrid("getrowdata",e[o]);t.push(n.fileKey),delete i.files[n.fileKey];var r=i.$fileListGrid.jqxGrid("getrowid",e[o]);i.$fileListGrid.jqxGrid("deleterow",r);}i.$parent.trigger("removeFile",[t]),i.setTotalCount(),i.$deleteButton.jqxButton({disabled:!0});});},e.prototype.makeGridSource=function(t,e){var i=[],o=$.extend(!0,{},e);return o.fileKey=t,this.files[t]=o,i.push(o),i;},e.prototype.equal=function(t,e){return t.name===e.name&&t.size===e.size&&t.lastModified===e.lastModified;},e.prototype.renderFiles=function(t){var e={};for(var i in t){var o=!1;for(var n in this.files){if(this.equal(this.files[n],t[i])){e[i]=!0,o=!0;break;}}o||this.$fileListGrid.jqxGrid("addrow",null,this.makeGridSource(i,t[i]));}return this.setTotalCount(),e;},e.prototype.isJsonFile=function(t){for(var e=0;e<t.length;e++){var i=t[e].name.split(".");if(this.options.fileType.indexOf(i[i.length-1])<0)return!1;}return!0;},e.prototype.getFiles=function(){return this.files;},e.prototype.setDisableFile=function(t,e){var i,o=-1,n=this.$fileListGrid.jqxGrid("getRows");for(var r in n){if(n[r].fileKey===t){o=r,(i=n[r]).errorMessage=e;break;}}this.$fileListGrid.jqxGrid("updaterow",o,i);},t.VA.Core.Widget.Controls.FileList=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.options.selectedItems=[],this.options.selectedIndexes=[],this.options.changedItems={},this.options.items=[],this.eventListeners={},this.sortOptions={},this._initEventListeners(),this.retrieveParent(),this.createControls(),this._setSortFunction();}e.prototype._setSortFunction=function(){this.compareFunctionGenerator=function(t,e){return e=e||function(t){return t;},function(i,o){return t(e(i),e(o));};};var t,e=function e(t,_e8){return String(t).localeCompare(String(_e8));},i=(t=this,function(e){return t.options.items[e].item;});this.sortOptions={comp:e,getter:i,sortOnIndex:this.compareFunctionGenerator(e,i),sortOnValue:this.compareFunctionGenerator(e)};},e.prototype._initEventListeners=function(){this.eventListeners={selectAll:this._handleSelectAll.bind(this),unselectAll:this._handleUnselectAll.bind(this),select:this._handleSelect.bind(this),unselect:this._handleUnselect.bind(this),close:this._handleClose.bind(this)};},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){var e=this;this.$mainControl=$('<div class="brtc-va-widget-controls-itemlist">   <div class="brtc-va-widget-controls-itemlist-selectbutton-wrapper">       <span class="brtc-va-widget-controls-itemlist-selectcounter counter">0</span>       <span class="brtc-va-widget-controls-itemlist-selectcounter">items selected</span>       <button class="brtc-va-widget-controls-itemlist-clearbutton">Clear</button>       <button class="brtc-va-widget-controls-itemlist-selectbutton">Select</button>   </div>   <div class="brtc-va-widget-controls-itemlist-control" />'),this.$parent.append(this.$mainControl),this.$selectButton=this.$mainControl.find(".brtc-va-widget-controls-itemlist-selectbutton"),this.$selectButton.jqxButton({theme:t.VA.Env.Theme,height:25}),this.$selectButton.on("click",function(){e.openItemSelector();}),this.$clearButton=this.$mainControl.find(".brtc-va-widget-controls-itemlist-clearbutton"),this.$clearButton.jqxButton({theme:t.VA.Env.Theme,height:25}),this.$clearButton.on("click",function(){e.clearSelectedItems();}),this.$itemControl=this.$mainControl.find(".brtc-va-widget-controls-itemlist-control"),this.createItemListControl(this.$itemControl),this.createItemSelector();},e.prototype.createItemListControl=function(e){var i=this,o={localdata:this.options.selectedItems,datatype:"array",beforeprocessing:function beforeprocessing(){o.totalrecords=i.options.selectedItems.length;}},n=new $.jqx.dataAdapter(o);$(e).jqxGrid({width:i.options.width||"100%",theme:t.VA.Env.Theme,height:i.options.height||120,virtualmode:!0,pageable:!1,source:n,rendergridrows:function rendergridrows(t){for(var e={},o=t.startindex;o<t.endindex&&o<i.options.selectedItems.length;++o){e[o]={item:i.options.selectedItems[o]};}return e;},selectionmode:"none",showheader:!1,rowsheight:20,columns:[{text:"Item",datafield:"item",cellsrenderer:function cellsrenderer(t,e,o){if(t<i.options.selectedItems.length)return'<div class="brtc-va-widget-controls-itemselector-itemcontainer-element" row-index="'+t+'">   <span class="brtc-va-widget-controls-itemselector-itemcontainer-element-name" title="'+o+'">'+o+'</span>   <span class="brtc-va-widget-controls-itemselector-itemcontainer-element-remove"></span></div>';},width:"100%",cellsalign:"left"}]}),$(e).jqxGrid("localizestrings",{emptydatastring:" "});},e.prototype.createItemSelector=function(){var e=this;this.options.multiple=!0,this.options.fromModal=!0,this.itemSelector=new t.VA.Core.Widget.Controls.ItemSelector(this.$mainControl,{multiple:e.options.multiple,fromModal:e.options.fromModal,limit:e.options.limit,showDesc:e.options.showDesc,changed:function changed(t,i){e.eventListeners[t]&&"function"==typeof e.eventListeners[t]&&e.eventListeners[t](i);}});},e.prototype._getUniqueItems=function(t,e){for(var i={},o=[],n=0;n<t.length;++n){var r=void 0===e?t[n]:t[n][e];void 0===i[r]&&(i[r]=!0,o.push(t[n]));}return o;},e.prototype.setItems=function(t){this.options.items=this._getUniqueItems(t,"item"),this.itemSelector.setSortOptions(this.sortOptions),this.itemSelector.setSource(this.options.items);},e.prototype.setSelectedItems=function(t){var e=this._getUniqueItems(t||[]);this.options.selectedItems=$.extend(!0,[],e),this.options.selectedItems.sort(this.compareFunctionGenerator(this.sortOptions.comp,function(t){return t.item;})),this.options.selectedIndexes=this.itemSelector.calcSelectedIndexes(this.options.selectedItems),this.refreshControl();},e.prototype.getSelectedItems=function(){return this.options.selectedItems;},e.prototype.refreshControl=function(){var t=this;this.$itemControl.jqxGrid("updatebounddata"),this.$mainControl.find(".brtc-va-widget-controls-itemlist-selectcounter.counter").text(this.options.selectedItems.length),this.$itemControl.find(".jqx-grid-cell").mouseover(function(e){$(this).find(".brtc-va-widget-controls-itemselector-itemcontainer-element-remove").show();$(this).find(".brtc-va-widget-controls-itemselector-itemcontainer-element-remove").unbind("click"),$(this).find(".brtc-va-widget-controls-itemselector-itemcontainer-element-remove").bind("click",function(){var e=$(this).closest(".brtc-va-widget-controls-itemselector-itemcontainer-element").attr("row-index");t.removeItem(e),t.refreshControl();});}),this.$itemControl.find(".jqx-grid-cell").mouseout(function(t){$(this).find(".brtc-va-widget-controls-itemselector-itemcontainer-element-remove").hide();});},e.prototype.clearSelectedItems=function(){this.itemSelector.clearSelectedItems(),this.setSelectedItems([]),this.options.changed("clear",{items:[]});},e.prototype.removeItem=function(t){var e=this.options.selectedItems[t],i=this.options.selectedIndexes[t];this.options.selectedItems.splice(t,1),this.options.selectedIndexes.splice(t,1),this.itemSelector.unselectRow(i),this.options.changed("removed",{added:[],removed:[e],items:this.options.selectedItems});},e.prototype.openItemSelector=function(){this.itemSelector.open(this.$clearButton,this.options.selectedItems,this.options.selectedIndexes);},e.prototype.getSelectorPosition=function(){var t={left:0,top:0};t.left=this.$mainControl.offset().left+this.$mainControl.width()+5,t.top=this.$mainControl.offset().top;var e=document.all?document.body.clientHeight:window.innerHeight,i=this.itemSelector.getHeight();return e-i-10<t.top&&(t.top=e-i-10),t;},e.prototype.isLimited=function(e){return this.options.limit<this.options.selectedItems.length+(e||0)&&(t.VA.Core.Utils.WidgetUtils.openWarningDialog("You are only allowed to select "+this.options.limit+" items."),this.itemSelector.close(),!0);},e.prototype.processing=function(t){this.itemSelector._processing(t);},e.prototype._updateChangedItemOrDelete=function(t,e){void 0!==this.options.changedItems[e]&&this.options.changedItems[e]!==t?delete this.options.changedItems[e]:this.options.changedItems[e]=t;},e.prototype._handleSelectAll=function(t){for(var e=[],i=0,o=0;i<this.options.selectedIndexes.length&&o<t.length&&!this.isLimited(e.length+1);){this.options.selectedIndexes[i]<t[o].id?i++:this.options.selectedIndexes[i]>t[o].id?(this._updateChangedItemOrDelete("select",t[o].value),e.push(t[o]),o++):(i++,o++);}for(;o<t.length&&!this.isLimited(e.length+1);){this._updateChangedItemOrDelete("select",t[o].value),e.push(t[o]),o++;}var n=[],r=[];for(i=0,o=0;i<this.options.selectedIndexes.length&&o<e.length;){this.options.selectedIndexes[i]<e[o].id?(n.push(this.options.selectedIndexes[i]),r.push(this.options.selectedItems[i]),i++):this.options.selectedIndexes[i]>e[o].id?(n.push(e[o].id),r.push(e[o].value),o++):(n.push(this.options.selectedIndexes[i]),r.push(this.options.selectedItems[i]),i++,o++);}for(;i<this.options.selectedIndexes.length;){n.push(this.options.selectedIndexes[i]),r.push(this.options.selectedItems[i]),i++;}for(;o<e.length;){n.push(e[o].id),r.push(e[o].value),o++;}this.options.selectedIndexes=n,this.options.selectedItems=r,this.refreshControl();},e.prototype._handleUnselectAll=function(t){for(var e=[],i=[],o=0,n=0;o<this.options.selectedItems.length&&n<t.length;){this.options.selectedIndexes[o]<t[n].id?(e.push(this.options.selectedIndexes[o]),i.push(this.options.selectedItems[o]),o++):this.options.selectedIndexes[o]>t[n].id?n++:(this._updateChangedItemOrDelete("unselect",t[n].value),o++,n++);}for(;o<this.options.selectedItems.length;){e.push(this.options.selectedIndexes[o]),i.push(this.options.selectedItems[o]),o++;}this.options.selectedIndexes=e,this.options.selectedItems=i,this.refreshControl();},e.prototype._handleSelect=function(t){if(!this.isLimited(1)){for(var e=0;e<this.options.selectedItems.length&&this.options.selectedIndexes[e]<t.id;){++e;}e<this.options.selectedItems.length&&this.options.selectedIndexes[e]===t.id||(this.options.selectedIndexes.splice(e,0,t.id),this.options.selectedItems.splice(e,0,t.value),this._updateChangedItemOrDelete("select",t.value),this.refreshControl());}},e.prototype._handleUnselect=function(t){var e=this.options.selectedIndexes.indexOf(t.id);-1!==e&&(this.options.selectedItems.splice(e,1),this.options.selectedIndexes.splice(e,1),this._updateChangedItemOrDelete("unselect",t.value),this.refreshControl());},e.prototype._handleClose=function(t){var e=[],i=[];for(var o in this.options.changedItems){"select"===this.options.changedItems[o]?e.push(o):i.push(o);}(e.length>0||i.length>0)&&this.options.changed("change",{added:e,removed:i,items:this.options.selectedItems}),this.options.changedItems={};},t.VA.Core.Widget.Controls.ItemList=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t,e){this.parentId=t,this.options=e,this.sortOptions={},this.initOptions(),this.retrieveParent(),this.createControl();}e.prototype.initOptions=function(){this.options=$.extend(!0,{source:[],width:290,height:320,resizable:!0,fromModal:!1,limit:99999999,showDesc:!1},this.options);},e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControl=function(){var e=this;this.$mainControl=$('<div class="brtc-va-widget-controls-itemselector">   <div class="brtc-va-widget-controls-itemselector-header" />   <div class="brtc-va-widget-controls-itemselector-content brtc-style-full brtc-style-display-flex brtc-style-flex-direction-column" /></div>'),this.$parent.append(this.$mainControl);var i=this.$mainControl.find(".brtc-va-widget-controls-itemselector-content");this.createFilter(i),this.createSelectButton(i),this.createItemContainer(i),this.closeHandler=function(t){0===e.$mainControl.closest(".ui-dialog").has(t.target).length&&e.$mainControl.dialog("close");};var o={theme:t.VA.Env.Theme,width:this.options.width,height:this.options.height,resizable:!0,title:"Select Items",autoOpen:!1,modal:!1,showAnimationDuration:50,minHeight:285,minWidth:307,zIndex:this.getHighestZindex(),close:function close(){e.options.fromModal||$(".jqx-window-modal").remove(),$(window).off("mousedown",e.closeHandler),e.options.changed("close",[]);}};this.$mainControl.dialog(o),this.$mainControl.siblings(".ui-dialog-titlebar.ui-widget-header").addClass("brtc-style-itemselector"),this.$mainControl.css("z-index",this.getHighestZindex());},e.prototype.createFilter=function(e){var i=this,o=$('<div class="brtc-va-widget-controls-itemselector-filter-container"></div>');e.append(o),this.$filterControl=$('<input type="search" placeholder="Search Item" />'),o.append(this.$filterControl),this.$filterControl.jqxInput({theme:t.VA.Env.Theme,placeHolder:"Search Item",height:31,minLength:1}),this.$filterControl.on("keyup search",function(t){i.$itemControl.jqxGrid("clearfilters");var e=new $.jqx.filter(),o=e.createfilter("stringfilter",t.target.value,"contains");e.addfilter(1,o),i.$itemControl.jqxGrid("addfilter","item",e),i.$itemControl.jqxGrid("applyfilters");});},e.prototype.createSelectButton=function(e){var i=this,o=$('<div class="brtc-item-check-box-wrapper"></div>');e.append(o),this.$selectAllButton=$('<input type="button" value="Select All" style="width: 100%; float:left; margin-left: 0px;"/>'),this.$clearAllButton=$('<input type="button" value="Unselect All" style="width: 100%; float:left; margin-left: 2px; margin-bottom: 2px;"/>'),o.append(this.$selectAllButton),o.append(this.$clearAllButton),this.$selectAllButton.jqxButton({height:23,width:134,Theme:t.VA.Env.Theme}),this.$clearAllButton.jqxButton({height:23,width:134,Theme:t.VA.Env.Theme}),this.$selectAllButton.on("click",function(){i.selectedAll();}),this.$clearAllButton.on("click",function(){i._processing(!0),i.unSelectedAll(),i._processing(!1);});},e.prototype.createItemContainer=function(e){var i=this,o=$('<div class="brtc-va-progress">     <span class="brtc-va-progress-loading"></span></div><div class="brtc-va-widget-controls-itemselector-itemcontainer-wrapper brtc-style-flex-1">   <div class="brtc-va-widget-controls-itemselector-itemcontrol brtc-style-border-box"></div></div>');e.append(o);var n=function n(t,e,i){return'<div class="brtc-va-widget-controls-itemselector-itemcontainer-element" row-index="'+t+'">   <span class="brtc-va-widget-controls-itemselector-itemcontainer-element-name" title="'+i+'">'+i+"</span></div>";};this.$progress=e.find(".brtc-va-progress"),this.$progress.hide(),this.$itemControl=o.find(".brtc-va-widget-controls-itemselector-itemcontrol");var r=[{text:"Item",datafield:"item",cellsrenderer:n,minwidth:120,cellsalign:"left"}];this.options.showDesc&&(r[0].minwidth=90,r.push({text:"Description",datafield:"description",cellsrenderer:n,width:110,minwidth:90,maxwidth:110,cellsalign:"left"})),this.$itemControl.jqxGrid({width:"100%",theme:t.VA.Env.Theme,height:"100%",pageable:!1,selectionmode:"checkbox",showheader:!1,rowsheight:20,columns:r}),this.$itemControl.on("rowselect",function(t){if(!i.systemEvent){var e=t.args.rowindex;i.options.changed("select",{id:i.invPos[e],value:i.options.source[e].item});}}),this.$itemControl.on("rowunselect",function(t){if(!i.systemEvent){var e=t.args.rowindex;i.options.changed("unselect",{id:i.invPos[e],value:i.options.source[e].item});}});},e.prototype.selectedAll=function(){var t=this;this.systemEvent=!0;var e=this.$itemControl.jqxGrid("getrows");this.chkCnt++;var i=e.map(function(e){var i=void 0!==e.dataindex?e.dataindex:e.boundindex;return t.chk[i]=t.chkCnt,i;}),o=this.pos.filter(function(e){return t.chk[e]===t.chkCnt;}),n=this._getSelectedRowIndexes(),r=o.map(function(e){return{id:t.invPos[e],value:t.options.source[e].item};});this.$itemControl.jqxGrid({selectedrowindexes:this._union(n,i)}),this.$itemControl.jqxGrid("refresh"),this.options.changed("selectAll",r),this.systemEvent=!1;},e.prototype.unSelectedAll=function(){var t=this;this.systemEvent=!0;var e=this.$itemControl.jqxGrid("getrows");this.chkCnt++;var i=e.map(function(e){var i=void 0!==e.dataindex?e.dataindex:e.boundindex;return t.chk[i]=t.chkCnt,i;}),o=this.pos.filter(function(e){return t.chk[e]===t.chkCnt;}).map(function(e){return{id:t.invPos[e],value:t.options.source[e].item};}),n=this._getSelectedRowIndexes();this.$itemControl.jqxGrid({selectedrowindexes:this._difference(n,i)}),this.$itemControl.jqxGrid("refresh"),this.options.changed("unselectAll",o),this.systemEvent=!1;},e.prototype._getSelectedRowIndexes=function(){return this._countingSort(this.$itemControl.jqxGrid("getselectedrowindexes"),this.options.source.length);},e.prototype._preCalculation=function(t){var e=this;this.pos=[],this.invPos=[],this.chk=[],this.chkCnt=0;for(var i=t.length,o=0;o<i;++o){this.pos.push(o),this.invPos.push(-1),this.chk.push(-1);}this.pos.sort(this.sortOptions.sortOnIndex),this.pos.forEach(function(t,i){e.invPos[t]=i;});},e.prototype.setSource=function(t){this.options.source=t,this._preCalculation(t);var e=[{name:"item",type:"string"}];this.options.showDesc&&e.push({name:"description",type:"string"});var i={localdata:this.options.source,datatype:"array",datafields:e},o=new $.jqx.dataAdapter(i);this.$itemControl.jqxGrid({source:o});},e.prototype.getSource=function(){return this.options.source;},e.prototype.calcSelectedIndexes=function(t){for(var e=[],i=0,o=0;i<t.length&&o<this.pos.length;){var n=t[i],r=this.options.source[this.pos[o]].item,a=this.sortOptions.comp(n,r);a<0?i++:a>0?o++:(e.push(o),i++,o++);}return e;},e.prototype.setSelectedItems=function(t,e){var i=this;this._processing(!0),this.systemEvent=!0;var o=e.filter(function(t){return t<i.options.source.length;});this.chkCnt++;var n=o.map(function(t){return i.pos[t];});n.forEach(function(t){i.chk[t]=i.chkCnt;}),n=this._countingSort(n,this.options.source.length),this.$itemControl.jqxGrid({selectedrowindexes:n}),this.$itemControl.jqxGrid("refresh"),this.systemEvent=!1,this._processing(!1);},e.prototype._countingSort=function(t,e){for(var i=[],o=0;o<e;++o){i.push(-1);}return t.forEach(function(t){i[t]=t;}),i.filter(function(t,e){return t===e;});},e.prototype._processing=function(t){t?($(window).off("mousedown",this.closeHandler),this.$progress.show()):($(window).on("mousedown",this.closeHandler),this.$progress.hide());},e.prototype.open=function(t,e,i){this.selectEventFlag=!1,this.systemEvent=!0,this.$itemControl.jqxGrid("clearselection"),this.systemEvent=!1,this.$mainControl.dialog({position:{my:"left top",at:"right+5, top",of:t}}),this.$mainControl.dialog("open"),this.$mainControl.css("z-index",this.getHighestZindex()),$(window).on("mousedown",this.closeHandler);var o=[{name:"item",type:"string"}];this.options.showDesc&&o.push({name:"description",type:"string"});var n={localdata:this.options.source,datatype:"array",datafields:o},r=new $.jqx.dataAdapter(n);this.$itemControl.jqxGrid({source:r}),this.setSelectedItems(e,i);},e.prototype.close=function(){this.$mainControl.dialog("close");},e.prototype.getHighestZindex=function(){for(var t=$("body").children(".jqx-window"),e=0,i=0,o=0;o<t.length;o++){(i=parseInt($(t[o]).css("z-index"))||0)>e&&(e=i);}return e+1;},e.prototype.getHeight=function(){return this.$mainControl.height();},e.prototype.clear=function(){this.systemEvent=!0;for(var t=0;t<this.options.source.length;++t){this.$itemControl.jqxGrid({selectedrowindexes:[]});}this.systemEvent=!1;},e.prototype.clearSelectedItems=function(){this.$itemControl.jqxGrid({selectedrowindexes:[]});},e.prototype.unselectRow=function(t){this.$itemControl.jqxGrid("unselectrow",this.pos[t]);},e.prototype._union=function(t,e){for(var i=0,o=0,n=[];i<t.length&&o<e.length;){t[i]<e[o]?(n.push(t[i]),i++):t[i]>e[o]?(n.push(e[o]),o++):(n.push(t[i]),i++,o++);}for(;i<t.length;){n.push(t[i]),i++;}for(;o<e.length;){n.push(e[o]),o++;}return n;},e.prototype._difference=function(t,e){for(var i=0,o=0,n=[];i<t.length&&o<e.length;){t[i]<e[o]?(n.push(t[i]),i++):t[i]>e[o]?o++:(i++,o++);}for(;i<t.length;){n.push(t[i]),i++;}return n;},e.prototype.setSortOptions=function(t){this.sortOptions=t;},t.VA.Core.Widget.Controls.ItemSelector=e;}.call(this),function(){"use strict";var t=this.Brightics;var e=[["style",["bold","italic","underline","clear"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["height",["height"]]];function i(t,e){this.parentId=t,this.options=this.setOptions(e),this.retrieveParent(),this.createControls(),this.createEvents();}i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.setOptions=function(t){return $.extend(!0,{},t);},i.prototype.createControls=function(){var t=this.options.description||"";if(this.$mainControl=$('<div class="brtc-va-widget-note-control">'+t+"</div>"),this.$parent.append(this.$mainControl),document.createRange)try{document.getSelection().removeAllRanges();}catch(t){document.getSelection().addRange(document.createRange());}this.$mainControl.summernote({focus:void 0===this.options.focus||this.options.focus,toolbar:this.options.toolbar||e,fontSizes:FONT_SIZES,popover:{},height:this.options.height-24,disableDragAndDrop:!0,maximumImageFileSize:1,callbacks:$.extend(!0,{},this.options.callbacks)});},i.prototype.createEvents=function(){this.setRestrictCondition(),this.$mainControl.closest(".ui-dialog").length>0&&this._setStopPropagationMouseDown();},i.prototype.setRestrictCondition=function(){this.options.maxLength&&(this.createMessageArea(),this.createLengthRestriction(),this.createInputRestriction());},i.prototype._setStopPropagationMouseDown=function(){this.$parent.mousedown(function(t){t.stopPropagation();});},i.prototype.createMessageArea=function(){this.$messageArea=$('<div class="brtc-va-widget-note-message"></div>'),this.$parent.append(this.$messageArea),this.$messageArea.text(this.$parent.find(".note-editable").text().length+" / "+this.options.maxLength+" characters");},i.prototype.deleteImageElement=function(){this.$parent.find(".note-editing-area img").remove();},i.prototype.deleteHrefAttribute=function(){this.$parent.find(".note-editing-area a").removeAttr("href");},i.prototype.createLengthRestriction=function(){var t=this;this.$mainControl.on("summernote.change",function(e,i){t.deleteImageElement(),t.deleteHrefAttribute();var o=t.$parent.find(".note-editable").text().length;t.$messageArea.text(o+" / "+t.options.maxLength+" characters"),o>t.options.maxLength?(t.setOkbuttonCondition(!0),t.$messageArea.addClass("error")):(t.setOkbuttonCondition(!1),t.$messageArea.removeClass("error"));});},i.prototype.createInputRestriction=function(){var e=this;this.$mainControl.on("summernote.keydown",function(i,o){e.$parent.find(".note-editable").text().length>e.options.maxLength&&(t.VA.Core.Utils.InputValidator.isNotInsertKeyCode(o)||o.preventDefault());});},i.prototype.setOkbuttonCondition=function(t){this.options.okButton&&this.options.okButton.jqxButton({disabled:t});},i.prototype.getCode=function(){return this.getValue();},i.prototype.setCode=function(t){this.setValue(t);},i.prototype.focus=function(){this.$mainControl.summernote("focus");},i.prototype.isEmpty=function(){return this.$mainControl.summernote("isEmpty");},i.prototype.setHeight=function(t){this.$parent.find(".note-editable.panel-body").css({height:t});},i.prototype.getValue=function(){return this.$mainControl.summernote("code");},i.prototype.setValue=function(t){this.$mainControl.summernote("focus"),this.$mainControl.summernote("code",t||"");},i.prototype.clear=function(){this.$mainControl.summernote("focus"),this.$mainControl.summernote("reset");},i.prototype.destroy=function(){this.$mainControl.summernote("destroy");},t.VA.Core.Widget.Controls.NoteControl=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){return this.parentId=t,this.options=this.setOptions(e),this.value="",this.retrieveParent(),this.createControls(),this.createFocusEvent(),this;}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.setOptions=function(t){var e={numberType:"int",min:void 0,max:void 0,minus:!0,placeholder:"Enter value",enterCallback:function enterCallback(){}},i=$.extend(!0,e,t);return"int"==i.numberType?(i.max=i.max?i.max:"1073741824",i.min=i.min?i.min:"-1073741824"):"double"==i.numberType&&(i.max=i.max?i.max:"1073741824",i.min=i.min?i.min:"-1073741824"),i;},e.prototype.createControls=function(){var t=["brtc-va-editors-sheet-controls-numericInput"].concat(this.options.className||[]).join(" ");this.$mainControl=$('<input type="text" class="'+t+'" contenteditable>'),this.$mainControl.attr("placeholder",this.options.placeholder),this.$parent.append(this.$mainControl),this.addKeyEventListener();},e.prototype.setValue=function(t){this.$mainControl.val(t);},e.prototype.getValue=function(){return this.$mainControl.val();},e.prototype.setDisabled=function(t){return this.$mainControl.prop("disabled",t);},e.prototype.onChange=function(t){this.callback=t;},e.prototype.parseToNumber=function(t){return""===t?t:isNaN(t)?"":Number(t);},e.prototype.createFocusEvent=function(){var t=this;this.$mainControl.focus(function(){t.preValue=t.parseToNumber(t.$mainControl.val());}),this._OnNumericInputFocusOut=function(){var e=t.$mainControl.val();+e||t.isZero(e)?(void 0!==t.options.min&&+e<+t.options.min&&t.$mainControl.val(t.options.min),void 0!==t.options.max&&+e>+t.options.max&&t.$mainControl.val(t.options.max)):""===e&&t.options.mandatory&&void 0!==t.options.min&&t.$mainControl.val(t.options.min);},this.$mainControl.focusout(function(){t._OnNumericInputFocusOut();var e=t.parseToNumber(t.$mainControl.val());t.$mainControl.val(e),(e!==t.preValue&&"function"==typeof t.callback||t.options.checkValueChanged)&&t.callback(t.$mainControl.val());}),$("svg").on("mousedown",function(){var e=t.parseToNumber(t.$mainControl.val());t.$mainControl.val(e),e!==t.preValue&&"function"==typeof t.callback&&t.$mainControl.is(":focus")&&t.callback(t.$mainControl.val());});},e.prototype.getControl=function(){return this.$mainControl;},e.prototype.addKeyEventListener=function(){var t=this;this._OnNumericInputKeyDown=function(e){var i=e.which||e.keyCode;if(13===i)return t.options.enterCallback(t.getControl()),e.preventDefault(),!1;if(!e.shiftKey&&!e.altKey&&!e.ctrlKey&&i>=65&&i<=90||32==i||13==i)return e.preventDefault(),!1;if(!e.shiftKey&&!e.altKey&&!e.ctrlKey&&i>=48&&i<=57||i>=96&&i<=105||65==e.keyCode&&!0===e.ctrlKey||67==i&&!0===e.ctrlKey||88==i&&!0===e.ctrlKey||i>=35&&i<=39||8==i||9==i||13==i||46==i||45==i)return!0;var o=t.$mainControl.val();return 109==i||189==i?!("-"===o[0]||!t.options.minus):(!(e.shiftKey||e.altKey||e.ctrlKey||190!=i)||188==i||110==i)&&!/[\.,]/.test(o)&&"int"!==t.options.numberType;},this.$mainControl.keydown(this._OnNumericInputKeyDown),this._OnNumericInputKeyUp=function(e){var i=t.$mainControl.val();i&&(i=(i=("-"===i[0]?"-":"")+i.replace(/[^0-9\.]/g,"")).replace(/\.(?=(.*)\.)+/g,""),t.$mainControl.val(i));},this.$mainControl.keyup(this._OnNumericInputKeyUp);},e.prototype.isZero=function(t){return null!=t&&""!=t&&0==+t;},e.prototype.focus=function(){this.$mainControl.focus();},t.VA.Core.Widget.Controls.NumericInput=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.init();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.init=function(){var t=this;for(var e in this.$tabHeaderWrapper=this.$parent.children("ul"),this.$tabHeaders=this.$tabHeaderWrapper.children("li"),this.$tabContents=this.$parent.children("div"),this.$tabHeaderWrapper.addClass("brtc-style-tab-header-wrapper"),this.$tabHeaders.addClass("brtc-va-tab-header").addClass("brtc-style-tab-header"),this.$tabContents.addClass("brtc-style-tab"),this.$tabHeaders){var i=this.$tabHeaders.eq(e),o=i.text();i.html('<div class="brtc-va-tab-header-titlewrapper brtc-style-tab-header-titlewrapper"></div>'),i.find(".brtc-va-tab-header-titlewrapper").text(o);}this.$tabHeaders.eq(0).addClass("selected"),this.$tabContents.eq(0).addClass("selected"),this.$tabHeaders.on("click",function(e){var i=t.$tabHeaders.index(this);t.$tabHeaders.removeClass("selected"),$(this).addClass("selected"),t.$tabContents.removeClass("selected"),t.$tabContents.eq(i).addClass("selected"),t.$parent.trigger("selected",[i]),$("body").hasClass("scroll-always")&&1==i&&t.$parent.find(".brtc-va-dialogs-selectfnunit-tab-allfunctions").perfectScrollbar("update");});},e.prototype.select=function(t){this.$tabHeaders.removeClass("selected"),$(this.$tabHeaders[t||0]).addClass("selected"),this.$tabContents.removeClass("selected"),this.$tabContents.eq(t).addClass("selected"),$("body").hasClass("scroll-always")&&1==t&&this.$parent.find(".brtc-va-dialogs-selectfnunit-tab-allfunctions").perfectScrollbar("update");},t.VA.Core.Widget.Controls.TabControl=e;}.call(this),function(){"use strict";var t=this.Brightics,e=["number","string","array[string]","array[number]"],i=["array[string]","array[number]"],o=["number","array[number]"],n=brtc_require("FnUnitUtils");function r(t,e){this.parentId=t,this.initOptions(e),this.retrieveParent(),this.createControls(),this.setInputValue();}r.prototype.initOptions=function(t){this.options=$.extend(!0,{},t),this.variableKey=Object.keys(this.options.variable)[0],this.variableType=this.options.variable[this.variableKey]["variable-type"],this.inputType=this.getInputType(this.variableType),this.variableValue=this.options.variable[this.variableKey].value;},r.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},r.prototype.createControls=function(){var t=this;this.$mainControl=$('<div class="brtc-va-widget-container">   <div class ="brtc-va-widget-remove" />   <div class="brtc-va-widget-label" />   <div class="brtc-va-widget-header" />   <div class="brtc-va-widget-contents"><div class="brtc-va-widget-contents-input-container-wrapper"></div></div></div>'),this.$parent.append(this.$mainControl),this._renderLabel(),this.createContentsArea(),this.$mainControl.find(".brtc-va-widget-remove").on("click",function(){"function"==typeof t.options.onRemoveCallback&&(t.options.onRemoveCallback(t.createFormattedValue()),t.$mainControl.remove());});},r.prototype._renderLabel=function(){var t=this.$mainControl.find(".brtc-va-widget-label");if(this.options.label){this.options.mandatory&&t.addClass("mandatory"),this.variableType=this.variableType||"";var e=this.variableType.indexOf("array")>=0?"array":this.variableType;t.addClass(e),t.text(this.options.label),t.show();}else t.hide();},r.prototype.isArrayValue=function(){return i.indexOf(this.variableType)>-1;},r.prototype.isCellValue=function(){return"cell"===this.variableType;},r.prototype.createContentsArea=function(){this.$contentsArea=this.$mainControl.find(".brtc-va-widget-contents-input-container-wrapper");var t=this.$mainControl.find(".brtc-va-widget-header");t.hide(),this.isCellValue()?this.createCellInputControl():this.isArrayValue()?(t.show(),this.createArrayInputControl()):this.createSingleInputControl();},r.prototype.createCellInputControl=function(){this.createCellControlLayout();},r.prototype._createArrayInputHeaderArea=function(){var _this21=this;this.$arrayInputHeader&&this.$arrayInputHeader.remove(),this.$arrayInputHeader=$('\n            <div class="brtc-va-widget-contents-array-input-header-area">\n                <div class="brtc-va-widget-contents-array-header-button" current-edit-type="control">Bulk edit</div>\n            </div>');var t=this.$arrayInputHeader.find(".brtc-va-widget-contents-array-header-button");this.$mainControl.find(".brtc-va-widget-header").append(this.$arrayInputHeader),t.click(function(){"control"===t.attr("current-edit-type")?(_this21._changeControlToBulk(),_this21._changeArrayInputHeaderButton("bulk")):"bulk"===t.attr("current-edit-type")&&(_this21._changeBulkToControl(),_this21._changeArrayInputHeaderButton("control")),_this21.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar("update");});},r.prototype._changeArrayInputHeaderButton=function(t){var e=this.$arrayInputHeader.find(".brtc-va-widget-contents-array-header-button");"bulk"===t?(e.attr("current-edit-type","bulk"),e.text("Apply"),this.$mainControl.find(".brtc-va-widget-contents").scrollTop(0)):"control"===t&&(e.attr("current-edit-type","control"),e.text("Bulk edit"));},r.prototype._isBulkType=function(){return"bulk"===this.$arrayInputHeader.find(".brtc-va-widget-contents-array-header-button").attr("current-edit-type");},r.prototype._changeControlToBulk=function(){var e=this.getInputValue();this.$contentsArea.empty(),this._bulkAceEditorControl=t.VA.Core.Widget.Factory.aceEditorControl(this.$contentsArea,{value:e.join("\n"),editorOptions:{enableBasicAutocompletion:!1,enableSnippets:!1,enableLiveAutocompletion:!1}});var i=this._bulkAceEditorControl.getSession();i.setOption("indentedSoftWrap",!1),i.setUseWrapMode(!0),i.setWrapLimitRange();},r.prototype._changeBulkToControl=function(){var t=this._getBulkListValue();this.setInputValue(t),this.triggerChangeInputValue(!0),this._destroyBulkAceEditor();},r.prototype._destroyBulkAceEditor=function(){this._bulkAceEditorControl&&(this._bulkAceEditorControl.destroy(),this._bulkAceEditorControl=void 0);},r.prototype.createArrayInputControl=function(){if(this._createArrayInputHeaderArea(),this.variableValue&&0!==this.variableValue.length){if(this.variableValue instanceof Array)for(var t=0;t<this.variableValue.length;t++){this.createInputControlLayout(t,this.isArrayValue());}else this.createInputControlLayout(0,this.isArrayValue());}else this.createInputControlLayout(0,this.isArrayValue());this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar();},r.prototype.createSingleInputControl=function(){this.createInputControlLayout(0,!1);},r.prototype.createCellControlLayout=function(){var t=this.$contentsArea,e=$('<div class="brtc-va-widget-contents-input-container brtc-style-flex-direction-column brtc-style-height-auto brtc-style-align-items-flex-start">   <div class="data-area brtc-style-display-flex brtc-style-col-12 brtc-style-margin-top-5">       <div class="brtc-style-width-100 brtc-style-line-height-30">Input Data</div>   </div>   <div class="row-area brtc-style-display-flex brtc-style-col-12 brtc-style-margin-top-5">       <div class="brtc-style-width-100 brtc-style-line-height-30">Row Index</div>   </div>   <div class="column-area brtc-style-display-flex brtc-style-col-12 brtc-style-margin-top-5">       <div class="brtc-style-width-100 brtc-style-line-height-30">Column Name</div>   </div></div>');t.append(e);var i=$('<div class="brtc-style-width-minus-100"></div>'),o=$('<div class="brtc-style-width-minus-100"></div>'),n=$('<div class="brtc-style-width-minus-100"></div>'),r=e.find(".data-area"),a=e.find(".row-area"),s=e.find(".column-area");r.append(i),a.append(o),s.append(n),this.createCellControl(i,o,n);},r.prototype.createInputControlLayout=function(t,e,i){var o=this.$contentsArea,n=this,r=!1,a=$('<div class="brtc-va-widget-contents-input-container"></div>'),s=o.find(".brtc-va-widget-contents-input-container");0!==s.length&&s[t]?($(s[t]).after(a),r=!0):o.append(a);var l,c,d=$('<div class="brtc-va-widget-contents-input-control-container"></div>');a.append(d),(t>0||r)&&(c=$('<div class="brtc-va-widget-contents-input-control-delete"></div>'),a.append(c),c.click(function(t){n.handleDeleteButtonClick($(this).closest(".brtc-va-widget-contents-input-container"));})),e&&(l=$('<div class="brtc-va-widget-contents-input-control-add"></div>'),a.append(l),l.click(function(t){n.handleAddInputControlEvent($(this).closest(".brtc-va-widget-contents-input-container"));})),this.isArrayValue()?this.isNumericType()?this.createNumericInputControl(d,i):this.createInputControl(d,i):this.isNumericType()?this.createNumericInputControl(d,i):this.createCodeInputControl(d,i);},r.prototype.createNumericInputControl=function(e,i){var o=this,n={theme:t.VA.Env.Theme,height:"25px",width:"100%",numberType:"double",placeHolder:"Enter value",className:["brtc-va-widget-contents-input-control"],enterCallback:function(t){this.isArrayValue()&&this.handleAddInputControlEvent(t.closest(".brtc-va-widget-contents-input-container"),!0);}.bind(this)},r=new t.VA.Core.Widget.Controls.NumericInput(e,n);r.onChange(function(){o.triggerChangeInputValue(!1);}),i&&r.focus();},r.prototype.createDropDownList=function(e,i){var o={theme:t.VA.Env.Theme,height:"25px",autoDropDownHeight:!0,enableBrowserBoundsDetection:!0,width:"calc(100% - 100px)"};i&&$.extend(o,i),e.jqxDropDownList(o);},r.prototype.createIndataSource=function(){var t=Studio.getEditorContainer().getActiveModelEditor().getActiveModel();return n.getInTable(this.options.fnUnit).map(function(e){var i=t.getFnUnitByOutTable(e);return{label:i.display.label,tid:e,type:i.func};});},r.prototype.createCellControl=function(e,i,o){var n=this;this.$data=e,this.createDropDownList(e,{source:this.createIndataSource(),displayMember:"label",valueMember:"tid"}),e.change(function(){n.triggerChangeCellValue();});var r={theme:t.VA.Env.Theme,height:"25px",width:"100%",numberType:"int",minus:!1,placeholder:"(0 < value)",className:["brtc-va-widget-contents-input-control"]};this.rowInput=new t.VA.Core.Widget.Controls.NumericInput(i,r),this.rowInput.onChange(function(){n.triggerChangeCellValue();}),this.rowInput.focus(),this.$columnControl=$('<input type="text" class="brtc-va-widget-contents-input-control"/>'),o.append(this.$columnControl);var a={theme:t.VA.Env.Theme,height:"25px",width:"100%",placeHolder:"Enter value"};this.$columnControl.jqxInput(a),this.$columnControl.focusout(function(t){n.triggerChangeCellValue();});},r.prototype.createInputControl=function(e,i){var o=this,n=$('<input type="text" class="brtc-va-widget-contents-input-control"/>');e.append(n);var r={theme:t.VA.Env.Theme,height:"25px",width:"100%",placeHolder:"Enter value"};n.jqxInput(r),i&&n.jqxInput("focus"),n.keydown(function(t){13==t.keyCode&&o.isArrayValue()&&o.handleAddInputControlEvent(n.closest(".brtc-va-widget-contents-input-container"),!0);}),n.focusout(function(t){o.triggerChangeInputValue(!1);});},r.prototype.createCodeInputControl=function(e,i){var o=this,n=$('<textarea  class="brtc-va-widget-contents-input-control"/>');e.append(n);var r={mode:this.isLiteralType(this.variableType)?"brtc-system-variable":"brtc-control",scrollbarStyle:"null",placeholder:this.isLiteralType(this.variableType)?"Enter value":"Enter expression",lineWrapping:!1,matchBrackets:!1,extraKeys:{"Ctrl-Space":"autocomplete",Tab:!1,"Shift-Tab":!1},showTrailingSpace:!0,hintOptions:{list:"literal"==this.variableType?["${sys.user}","${sys.date}"]:[]}};this.codeMirror=CodeMirror.fromTextArea(n[0],r);var a={"valid-message-position":this.options["valid-message-position"]};t.VA.Core.Utils.WidgetUtils.changeCodeMirrorLineToSingle(this.codeMirror,a),this.codeMirror.on("blur",function(t,e){o.triggerChangeInputValue(!1);});},r.prototype.handleAddInputControlEvent=function(t,e){var i=t.index();this.createInputControlLayout(i,!0,e),this.triggerChangeInputValue(),this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar("update");var o=this.$mainControl.parents(".ps-container");o&&o.length&&o.perfectScrollbar("update");},r.prototype.handleDeleteButtonClick=function(t){t.remove(),this.triggerChangeInputValue(),this.$mainControl.find(".brtc-va-widget-contents").perfectScrollbar("update");var e=this.$mainControl.parents(".ps-container");e&&e.length&&e.perfectScrollbar("update");},r.prototype.triggerChangeInputValue=function(t){if("function"==typeof this.options.onChangeCallback){var e=this.getInputValue();(JSON.stringify(e)!==JSON.stringify(this.variableValue)||t)&&(this.variableValue=e,this.options.onChangeCallback(this.createFormattedValue()));}},r.prototype.triggerChangeCellValue=function(t){if("function"==typeof this.options.onChangeCallback){var e={inData:this.$data.val(),rowIndex:this.rowInput.getValue(),column:this.$columnControl.val()};(JSON.stringify(e)!==JSON.stringify(this.variableValue)||t)&&(this.variableValue=e,this.options.onChangeCallback(this.createFormattedCellValue()));}},r.prototype.createFormattedCellValue=function(){return{key:this.variableKey,type:this.inputType,"variable-type":this.variableType,value:this.variableValue};},r.prototype.createFormattedValue=function(){return{key:this.variableKey,type:this.inputType,"variable-type":this.variableType,value:this.isLiteralType(this.variableType)?this.variableValue:t.VA.Core.Utils.VariableUtils.wrap(this.variableValue)};},r.prototype.getFormattedValue=function(){return{key:this.variableKey,type:this.inputType,"variable-type":this.variableType,value:"calculation"===this.variableType?t.VA.Core.Utils.VariableUtils.wrap(this.getInputValue()):this.getInputValue()};},r.prototype._getBulkListValue=function(){var _this22=this;var t=[],e=this._bulkAceEditorControl.getValue();return e&&e.split("\n").forEach(function(e){t.push(_this22.getValueByType(e));}),0===t.length&&(t=this.isNumericType()?[0]:[""]),t;},r.prototype.getInputValue=function(){var t,e=this.$contentsArea.find(".brtc-va-widget-contents-input-control");if(this.isArrayValue()){(t=[]).length=e.length;for(var i=0;i<e.length;i++){var o=this.getValueByType($(e[i]).val());t[i]=o;}}else t=this.isNumericType()?this.getValueByType(e.val()):this.getValueByType(this.codeMirror.getValue());return t;},r.prototype.setVariableType=function(t){this.variableType=t,this.$contentsArea.empty(),this.createContentsArea();},r.prototype.setInputValue=function(t){void 0!==t&&(this.variableValue=t);var e=this.$contentsArea.find(".brtc-va-widget-contents-input-control");if(this.isCellValue())this.rowInput.setValue(this.variableValue.rowIndex),this.$columnControl.val(this.variableValue.column),this.$data.val(this.variableValue.inData);else if(this.isArrayValue()){var i;if(e.length>this.variableValue.length)for(i=0;i<e.length;i++){void 0===this.variableValue[i]?$(e[i]).parents(".brtc-va-widget-contents-input-container").remove():$(e[i]).val(this.getValueByType(this.variableValue[i]));}else{for(i=e.length;i<this.variableValue.length;i++){this.createInputControlLayout(i,!0);}for(e=this.$contentsArea.find(".brtc-va-widget-contents-input-control"),i=0;i<e.length;i++){$(e[i]).val(this.getValueByType(this.variableValue[i]));}}this._destroyBulkAceEditor(),this._changeArrayInputHeaderButton("control");}else Array.isArray(this.variableValue)?this.isNumericType()?e.val(this.getValueByType(this.variableValue[0])):this.codeMirror.setValue(this.getValueByType(this.variableValue[0])):this.isNumericType()?e.val(this.getValueByType(this.variableValue)):this.codeMirror.setValue(this.getValueByType(this.variableValue));},r.prototype.setRemovable=function(t){this.options.removable=t,t?this.$mainControl.find(".brtc-va-widget-remove").addClass("removable"):this.$mainControl.find(".brtc-va-widget-remove").removeClass("removable");},r.prototype.getOptions=function(){return this.options;},r.prototype.isLiteralType=function(t){return e.indexOf(t)>-1;},r.prototype.getInputType=function(t){return this.isLiteralType(t)?"literal":"expression";},r.prototype.isNumericType=function(){return o.indexOf(this.variableType)>-1;},r.prototype.toString=function(t){return _.isNull(t)||_.isUndefined(t)||""===t?"":_.isNumber(t)?_.isNaN(t)||_.isUndefined(t)?"":t.toString():t;},r.prototype.toNumber=function(t){return _.isNull(t)||_.isUndefined(t)||""===t?0:Number(this.toString(Number(t)));},r.prototype.getValueByType=function(e){return this.isNumericType()?this.toNumber(e):this.isLiteralType(this.variableType)?this.toString(e):t.VA.Core.Utils.VariableUtils.strip(e);},this.Brightics.VA.Core.Widget.Controls.VariableControl=r;}.call(this),function(){"use strict";this.Brightics.VA.Core.Widget.Configurator={setCodeMirrorConfiguration:function setCodeMirrorConfiguration(){CodeMirror.defineMode("brtc-default",function(t){return CodeMirror.simpleMode(t,{start:[]});});var t=new Brightics.VA.Core.Verifier.CFConditionVerifier();CodeMirror.defineMode(t.getRuleMode(),function(e){return CodeMirror.simpleMode(e,{start:t.getSyntaxRule()});});var e=new Brightics.VA.Core.Verifier.CFVariableVerifier();CodeMirror.defineMode(e.getRuleMode(),function(t){return CodeMirror.simpleMode(t,{start:e.getSyntaxRule()});});var i=new Brightics.VA.Core.Verifier.ConditionVerifier();CodeMirror.defineMode(i.getRuleMode(),function(t){return CodeMirror.simpleMode(t,{start:i.getSyntaxRule()});});var o=new Brightics.VA.Core.Verifier.NumericalFormulaVerifier();CodeMirror.defineMode(o.getRuleMode(),function(t){return CodeMirror.simpleMode(t,{start:o.getSyntaxRule()});});var n=new Brightics.VA.Core.Verifier.SystemVariableVerifier();CodeMirror.defineMode(n.getRuleMode(),function(t){return CodeMirror.simpleMode(t,{start:n.getSyntaxRule()});}),CodeMirror.commands.autocomplete=function(t){var e=t.getDoc().getCursor(),i=CodeMirror.innerMode(t.getMode(),t.getTokenAt(e).state).mode.name;"sql"==i?CodeMirror.showHint(t,CodeMirror.hint.sql):"clike"==i?CodeMirror.showHint(t,CodeMirror.hint["scala-custom"]):"brtc-default"==i||"brtc-controlflow-variable"==i||"brtc-control"==i||"brtc-va-numerical-formula-rule"==i||"r"==i?CodeMirror.showHint(t,CodeMirror.hint["brtc-custom"]):CodeMirror.showHint(t,CodeMirror.hint.anyword);};}};}.call(this),function(){"use strict";var t=this;t.Brightics.VA.Core.Widget.Factory={variableControl:function variableControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.VariableControl(e,i);},arrayInputControl:function arrayInputControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.ArrayInputControl(e,i);},argumentControl:function argumentControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.ArgumentControl(e,i);},createFadeOutMessage:function createFadeOutMessage(e,i){new t.Brightics.VA.Core.Widget.Controls.FadeOutMessage(e,i);},noteControl:function noteControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.NoteControl(e,i);},numericInputControl:function numericInputControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.NumericInput(e,i);},aceEditorControl:function aceEditorControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.AceEditorControl(e,i);},tabControl:function tabControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.TabControl(e,i);},colorPickerControl:function colorPickerControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.ColorPickerControl(e,i);},opacityControl:function opacityControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.OpacityControl(e,i);},borderControl:function borderControl(e,i){return new t.Brightics.VA.Core.Widget.Controls.BorderControl(e,i);}};}.call(this),function(){"use strict";var t=this.Brightics;function e(){this.clipboardCache=[],this.visualCache={};}e.prototype.addFunctionToClipboard=function(t){t.uid=Date.now(),this.clipboardCache.push(t),this.openClipboardDialog(!1);},e.prototype.addVisualObjects=function(t){Studio.getActiveEditor().handleOnCopy(),_.extend(this.visualCache,t);},e.prototype.getVisualObjects=function(t){return this.visualCache[t];},e.prototype.getParent=function(){return Studio.getActiveEditor().getMainArea();},e.prototype.openClipboardDialog=function(e){var i=!!_.isUndefined(e)||e,o=this.getParent();this.clipboardDialog?i?(this.clipboardDialog.close(),this.clipboardDialog=new t.VA.Core.Dialogs.ClipboardDialog(o,{functionList:this.clipboardCache})):this.clipboardDialog.isAlive()?this.clipboardDialog.updateFunctionList(this.clipboardCache):this.clipboardDialog=new t.VA.Core.Dialogs.ClipboardDialog(o,{functionList:this.clipboardCache}):this.clipboardDialog=new t.VA.Core.Dialogs.ClipboardDialog(o,{functionList:this.clipboardCache});},e.prototype.setEditorType=function(e){this.clipboardDialog&&this.clipboardDialog.isAlive()&&this.clipboardDialog.setEnable(t.VA.Core.Interface.Clipboard[e]);},t.VA.Core.Tools.Manager.ClipboardManager=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.$target=t;}e.prototype.setWidth=function(t){t&&this.$target.width(t);},e.prototype.setHeight=function(t){t&&this.$target.width(t);},e.prototype.setMarginLeft=function(t){return this.$target.css("margin-left",t);},e.prototype.getWidth=function(){return this.$target.width();},e.prototype.getHeight=function(){return this.$target.height();},e.prototype.getPaddingLeft=function(){return Number(this.$target.css("padding-left").replace("px",""));},e.prototype.getPaddingRight=function(){return Number(this.$target.css("padding-right").replace("px",""));},t.VA.Core.Tools.Manager.EditorLayoutManager=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.editor=t,this.retrieveParent(),this.init(),this.createSideBarArea(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.editor.getMainArea());},e.prototype.init=function(){this.configureLayout(),this.attachTabBarWrapperToLayout(),this.sideBar={};},e.prototype.configureLayout=function(){},e.prototype.attachTabBarWrapperToLayout=function(t){var e=this;this.$leftTabBarWrapper=this.editor.getLeftTabBarArea(),this.$rightTabBarWrapper=this.editor.getRightTabBarArea(),_.forIn(this.layout,function(t){_.assign(t,{$tabBarWrapper:"left"==t.position?e.$leftTabBarWrapper:e.$rightTabBarWrapper});});},e.prototype.createSideBarArea=function(){for(var t in this.layout){var e=$('<div class="brtc-va-studio-sidebar" name="'+t+'">   <div class="brtc-va-studio-sidebar-area" name="'+t+'" style="display: none"></div></div>');e.find(".brtc-va-studio-sidebar-area").addClass(this.layout[t].position),this.$parent.append(e);}},e.prototype.createControls=function(){},e.prototype.expandStatusChange=function(t,e){e?this.sideBar[t].show():this.sideBar[t].hide();var i=this.sideBar[t],o=i.getLayout().position;_.forIn(this.sideBar,function(t){t.getLayout().position===o&&t!==i&&t.hide();}),i.show(),this.fireExpandStatusChanged();},e.prototype.fireExpandStatusChanged=function(t,e){if(e)for(var i in this.sideBar){var o=this.sideBar[i],n=o.options.visible,r=!1;this.sideBar[t]&&(r=this.sideBar[t].options.position===o.options.position),i!==t&&n&&r&&o.hide();}this.editor.getModelLayoutManager().handleExpandStatusChanged();},e.prototype.onActivated=function(){this.sideBar&&_.forIn(this.sideBar,function(t){t.onActivated&&"function"==typeof t.onActivated&&t.onActivated();});},e.prototype.onFnUnitSelect=function(t){this.sideBar&&_.forIn(this.sideBar,function(e){e.onFnUnitSelect(t);});},e.prototype.onModelChange=function(t){this.sideBar&&_.forIn(this.sideBar,function(e){e.onModelChange(t);});},e.prototype.destroy=function(){this.sideBar&&_.forIn(this.sideBar,function(t){t.destroy();});},e.prototype.openAll=function(){if(this.sideBar)for(var t in this.sideBar){this.expandStatusChange(t,!0),this.sideBar[t].onModelChange();}},e.prototype.closeAll=function(){if(this.sideBar)for(var t in this.sideBar){this.expandStatusChange(t,!1),this.sideBar[t].onModelChange();}},e.prototype.getSideBars=function(){return this.sideBar;},e.prototype.getEditor=function(){return this.editor;},e.prototype.getLeftSideBarWidth=function(){for(var t in this.sideBar){var e=this.sideBar[t].options;if(!0===e.visible&&"left"===e.position)return e.width;}return this.editor.getLeftTabBarArea().height();},e.prototype.getRightSideBarWidth=function(){for(var t in this.sideBar){var e=this.sideBar[t].options;if(!0===e.visible&&"right"===e.position)return e.width;}return this.editor.getRightTabBarArea().height();},e.prototype.isOpen=function(t){for(var e in this.sideBar){var i=this.sideBar[e].options;if(!0===i.visible&&i.position==t)return!0;}return!1;},e.prototype.refresh=function(){},e.prototype.updateStatus=function(){},t.VA.Core.Tools.Manager.SideBarManager=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.options=e,this.parentId=t,this.FnUnitUtils=brtc_require("FnUnitUtils"),i.bind(this)(),this.init(),this.createControls(),this.createExpander(),this.initPreferenceTarget();}var i=function i(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);};e.prototype.init=function(){this.preferenceTarget={scroll:{}},this.configureSize();},e.prototype.createControls=function(){this.createHeader(),this.createContent();},e.prototype.createExpander=function(){var t=this;this.$expandButton=$('<div class="brtc-va-studio-sidebar-expand"></div>'),this.$expandButton.addClass(this.options.position);var e=this.options["description-label"]||this.options.label;this.$descriptionButton=$('<div class="brtc-va-studio-sidebar-description">'+e+"</div>"),this.$descriptionButton.addClass(this.options.position);var i=$('<div class="brtc-va-studio-sidebar-expander"></div>');i.append(this.$descriptionButton),this.options.$tabBarWrapper.append(i),i.click(function(e){t.options.visible?t.hide():t.show(),$("body").hasClass("scroll-always")&&t.$parent.find(".brtc-va-studio-sidebar-area").find(".ps-container").perfectScrollbar("update");}),this.options.visible&&this.show();},e.prototype.createDescription=function(){},e.prototype.expandStatusChanged=function(t){this.refreshCodeMirrorControl();},e.prototype.refreshCodeMirrorControl=function(){this.$parent.find(".CodeMirror").each(function(t,e){e.CodeMirror.refresh();});},e.prototype.selectionChanged=function(t){},e.prototype.destroy=function(t){},e.prototype.hide=function(){this.options.visible=!1,this.$parent.find(".brtc-va-studio-sidebar-area").hide(),this.$descriptionButton.css("background-color","#FFFFFF"),this.$descriptionButton.css("color","#4C4C4C"),this.$descriptionButton.parent().css("outline","1px solid #dbdde2"),this.expandStatusChanged(!1);},e.prototype.show=function(){this.options.visible=!0,this.$parent.find(".brtc-va-studio-sidebar-area").show(),this.$descriptionButton.css("background-color","#4B505E"),this.$descriptionButton.css("color","#FFFFFF"),this.$descriptionButton.parent().css("outline","1px solid rgb(75, 80, 94)"),this.expandStatusChanged(!0);},e.prototype.expandStatusChanged=function(t){this.applyPreferenceSettings(t),this.fireExpandStatusChanged(t),this.resizeAceEditors(),this.refreshCodeMirrorControl(),$(window).trigger("resize"),this.refreshjqxTabs(),this.refreshTabs();},e.prototype.applyPreferenceSettings=function(t){this.applyScrollSetting(t);},e.prototype.fireExpandStatusChanged=function(t){this.options.manager.fireExpandStatusChanged(this.options.id,t);},e.prototype.applyScrollSetting=function(t){$.isEmptyObject(this.preferenceTarget.scroll)||$("body").hasClass("scroll-always")&&this.preferenceTarget.scroll.perfectScrollbar("update");},e.prototype.resizeAceEditors=function(){this.$parent.find(".ace_editor").each(function(t,e){e.env.editor.resize();});},e.prototype.refreshCodeMirrorControl=function(){this.$parent.find(".CodeMirror").each(function(t,e){e.CodeMirror.refresh();});},e.prototype.refreshjqxTabs=function(){var t=this.$parent.find(".jqx-tabs");t.length>0&&t.jqxTabs("render");},e.prototype.refreshTabs=function(){if(this.$mainControl){var t=this.$mainControl.find(".brtc-va-tab-header");t.length>0&&0===t.filter(".selected:visible").length&&t.filter(":visible").eq(0).click();}},e.prototype.appendTemplate=function(t){console.error("if you want to use Library, Must implement appendTemplate Method");},e.prototype.configureSize=function(){this.$parent.find(".brtc-va-studio-sidebar-area").width(this.options.width-20);},e.prototype.createHeader=function(){var t=this,e=this.options.label;this.$headerControl=$(crel("div",{class:"brtc-va-studio-sidebar-header-wrapper"},crel("div",{class:"brtc-va-studio-sidebar-collapse "+this.options.position}),crel("dlv",{class:"brtc-va-tools-sidebar-header"},e))),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$headerControl),this.$headerControl.find(".brtc-va-studio-sidebar-collapse").click(function(){t.hide();});},e.prototype.udfChanged=function(t){},e.prototype.templateChanged=function(t){},e.prototype.onActivated=function(){},e.prototype.onFnUnitSelect=function(t){},e.prototype.onModelChange=function(){},e.prototype.initPreferenceTarget=function(){},e.prototype.destroy=function(){},e.prototype.getEditor=function(){return this.options.manager.getEditor();},e.prototype.getLayout=function(){return this.options;},t.VA.Core.Tools.SideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){this.$modelSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar visual"></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar),this.dataSourceExplorer=new t.VA.Implementation.Visual.Views.DataSourceExplorer(this.$modelSideBar,{width:"100%",height:"100%",editor:this.getEditor()});},e.prototype.destroy=function(t){this.dataSourceExplorer.destroy(t);},e.prototype.configureSize=function(){this.$parent.find(".brtc-va-studio-sidebar-area").width(this.options.width);},e.prototype.selectionChanged=function(t){},e.prototype.onActivated=function(){this.dataSourceExplorer.editorChanged(this.getEditor());},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.$modelSideBar.find(".bcharts-ds-panel");},t.VA.Core.Tools.SideBar.DataBoxSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){var e=this;this.$modelSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar deeplearning">   <ul>       <li>Function</li>       <li>Parameters</li>   </ul>   <div class="brtc-va-tools-sidebar-functiontab" />   <div class="brtc-va-tools-sidebar-parameterstab" /></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar),this.tabControl=t.VA.Core.Widget.Factory.tabControl(this.$modelSideBar);var i=this.$modelSideBar.find(".brtc-va-tools-sidebar-functiontab");this.deepLearningPalette=new t.VA.Core.Views.DeepLearningPalette(i,{width:"100%",height:"100%",draggable:!0,modelType:t.VA.Implementation.DeepLearning.Clazz});var o=this.$modelSideBar.find(".brtc-va-tools-sidebar-parameterstab");this.parametersControl=new t.VA.Core.Views.Parameters(o,{height:"100%",modelType:t.VA.Implementation.DeepLearning.Clazz,modelContents:this.getEditor().getModel()}),this.$modelSideBar.on("selected",function(t,i){1===i&&e.parametersControl.activate();});var n=Studio.getEditorContainer().getActiveModelEditor();this.parametersControl.editorChanged(n);},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.tabControl.$tabContents.find(".brtc-va-views-palette-navigator-wrapper");},t.VA.Core.Tools.SideBar.DeepLearningPaletteSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){var e=this;this.$etlSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar etlflow">   <ul>       <li>Function</li>       <li>Template</li>   </ul>   <div class="brtc-va-tools-sidebar-palettetab" />   <div class="brtc-va-tools-sidebar-librarytab"></div></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$etlSideBar),this.tabControl=t.VA.Core.Widget.Factory.tabControl(this.$etlSideBar);var i=this.$etlSideBar.find(".brtc-va-tools-sidebar-palettetab");this.etlFlowPalette=new t.VA.Core.Views.Palette(i,{width:"100%",height:"100%",draggable:!0,modelType:t.VA.Implementation.ETLFlow.Clazz});var o=this.$etlSideBar.find(".brtc-va-tools-sidebar-librarytab");this.etlLibraryExplorer=new t.VA.Core.Views.LibraryExplorer(o,{height:"100%",modelType:t.VA.Implementation.ETLFlow.Clazz}),this.$etlSideBar.on("selected",function(t,i){1==i&&e.etlLibraryExplorer.activate();});},e.prototype.appendTemplate=function(t){this.etlLibraryExplorer.appendTemplate(t);},e.prototype.udfChanged=function(t){this.etlFlowPalette.udfChanged();},e.prototype.templateChanged=function(t){this.etlLibraryExplorer.templateChanged();},e.prototype.onActivated=function(){this.etlLibraryExplorer.refresh();},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.tabControl.$tabContents.find(".brtc-va-views-palette-navigator-wrapper");},e.prototype.destroy=function(){this.etlFlowPalette.destroy(),this.etlLibraryExplorer.destroy();},t.VA.Core.Tools.SideBar.ETLPaletteSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){this.$FuncPropertiesSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar deeplearning">   <div class="brtc-va-tools-sidebar-funcpropertytab" /></div>'),this.initWidth(),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$FuncPropertiesSideBar),this.$funcPropertiesArea=this.$FuncPropertiesSideBar.find(".brtc-va-tools-sidebar-funcpropertytab"),this.funcProperties=new t.VA.Core.Views.FuncProperties(this.$funcPropertiesArea,{width:"100%",height:"100%",panelFactory:this.getEditor().getPanelFactory(),modelType:t.VA.Implementation.DeepLearning.Clazz});},e.prototype.initWidth=function(){this.$FuncPropertiesSideBar.width(this.options.width-40);},e.prototype.selectionChanged=function(t){1===t.length&&this.show(),this.funcProperties.selectionChanged(t),this.preferenceTarget.scroll.perfectScrollbar("update");},e.prototype.empty=function(){this.funcProperties.empty();},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.$funcPropertiesArea.find(".brtc-va-editors-sheet-panels-basepanel-contents-area");},t.VA.Core.Tools.SideBar.FuncPropertiesSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("KeyItems"),i={sideBarArea:"brtc-va-studio-sidebar-area",toolsSideBar:"brtc-va-tools-sidebar",styleSideBar:"brtc-style-sidebar",sSideBar:"brtc-stype-s-sidebar",header:["brtc-style-s-font-size-13","brtc-style-s-font-weight-bold","brtc-style-s-font-faminly-arial","brtc-style-margin-top-10","brtc-style-margin-bottom-10","brtc-style-padding-right-30"].join(" "),selectedTableWrapper:["brtc-va-tools-sidebar-selected-table","brtc-va-editors-sheet-controls-dataselector-contents","brtc-style-display-flex","brtc-style-flex-direction-column"].join(" "),selectedTableDataContainer:["brtc-va-editors-sheet-controls-dataselector-contents-wrapper","brtc-va-editors-sheet-controls-dataselector-item-container","brtc-style-relative"].join(" "),notSelectedItemContainer:["brtc-va-editors-sheet-controls-dataselector-contents-wrapper","brtc-va-editors-sheet-controls-dataselector-item-container","brtc-style-relative"].join(" "),emptyContainer:["brtc-va-editors-sheet-controls-dataselector-empty-wrapper","brtc-style-height-60px","brtc-style-padding-right-20"].join(" "),emptyContents:"brtc-va-editors-sheet-controls-dataselector-empty-contents",inTableListWrapper:["brtc-va-tools-sidebar-out-table-list-wrapper","brtc-va-editors-sheet-controls-dataselector-contents-wrapper"].join(" "),inTableListItemWrapper:"brtc-va-tools-sidebbar-out-table-list-item-wrapper",dataSelectorItem:["brtc-va-editors-sheet-controls-dataselector-item","brtc-style-flex-start","brtc-style-padding-left-20"].join(" "),refresh:["bcharts-ds-refresh-button","brtc-style-float-right"].join(" ")};function o(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}o.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),o.prototype.constructor=o,o.prototype.createContent=function(){var t=this,e=[i.toolsSideBar,i.styleSideBar,i.sSideBar,"brtc-style-display-flex","brtc-style-flex-direction-column"].join(" "),o=crel("div",{class:i.selectedTableDataContainer}),n=crel("div",{class:i.notSelectedItemContainer});this.$itemContainerAndAddableWrapper=$(crel("div",{class:"brtc-style-relative brtc-style-padding-right-20"},o));var r=crel("div",{class:i.selectedTableWrapper},crel("div",{class:i.header},"Selected Data"),this.$itemContainerAndAddableWrapper[0]),a=crel("div",{class:i.inTableListWrapper},crel("div",{class:i.header},"In Data List"),n);this.$inTableListWrapper=$(a),this.$modelSideBar=$(crel("div",{class:e},r,a)),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar),this.$itemContainer=$(o),this.$notSelectedItemContainer=$(n),this.$inTableContainer=$(a),this.$itemContainer.on("sortstop",function(e,i){var o=t.getSelectedTableIds();t.changeSelectedTableOrder(o);}),this.$itemContainer.sortable({axis:"y",cancel:".empty",helper:"clone",appendTo:this.$modelSideBar}),this.$itemContainerAndAddableWrapper.append(this.createAddableArea()),this.$itemContainerAndAddableWrapper.perfectScrollbar(),this.refresh();},o.prototype.onActivated=function(){this.refresh();},o.prototype.onFnUnitSelect=function(t){},o.prototype.initPreferenceTarget=function(){},o.prototype.destroy=function(){},o.prototype.getFnUnitByTableId=function(e){var i=this,o=this.getEditor().getModel(),n=function n(r){for(var a=r.functions,s=0;s<a.length;s++){var l=a[s];if(_.indexOf(i.FnUnitUtils.getOutData(l),e)>-1)return l;for(var c=t.VA.Core.Utils.NestedFlowUtils.getSubModels(o,l),d=0;d<c.length;d++){var p=c[d],u=n(p);if(u)return u;}}};return n(o);},o.prototype.getModelByTableId=function(e){var i=this.getEditor().getModel(),o=function o(n){for(var r=n.functions,a=0;a<r.length;a++){var s=r[a];if(_.indexOf(s[OUT_DATA],e)>-1)return s;for(var l=t.VA.Core.Utils.NestedFlowUtils.getSubModels(i,s),c=0;c<l.length;c++){var d=l[c],p=o(d);if(p)return p;}}};return o(i);},o.prototype.getActiveModel=function(){return this.getEditor().getActiveModel();},o.prototype.getActiveFnUnit=function(){return this.getEditor().getActiveFnUnitOnProp();},o.prototype.onModelChange=function(){this.refresh();},o.prototype.getModelInData=function(){return this.getActiveModel()[IN_DATA];},o.prototype.createSelectedTableElements=function(t){var e=this,i=[];return _.forEach(t,function(t){var o=e.getFnUnitByTableId(t);o&&i.push(e.createSelectedItem(o,t));}),i;},o.prototype.createNotSelectedTableElements=function(t){if(!this.isNestedFlow()){var e=this,i=[];return _.forEach(t,function(t){var o=e.getFnUnitByTableId(t);o&&i.push(e.createNotSelectedItem(o,t));}),0===i.length&&i.push(e.createEmptyItem()),i;}},o.prototype.createEmptyItem=function(){return $(crel("div",{class:i.emptyContainer},crel("div",{class:i.emptyContents},"Create a function that loads data from functions in the I/O category, and set some of them to Input Data.")));},o.prototype.createSelectedItem=function(t,e){var i=this.isNestedFlow()?this.createItemForNested(t,e):this.createItem(t,e);return this.isNestedFlow()?this.wrapSelectedItemForNested(i):this.wrapSelectedItem(i);},o.prototype.createNotSelectedItem=function(t,e){var i=this.createItem(t,e).css("cursor","move");return this.wrapNotSelectedItem(i);},o.prototype.createKeyItem=function(e){var o=e.fnUnit,n=e.tableId,r=e.type,a=$(crel("div",{class:i.dataSelectorItem})),s=this.getTableItemLabel(o,n),l=t.VA.Core.Utils.WidgetUtils.createKeyItem({label:s,type:r});a.append(l),a.attr("tid",n),a.attr("fid",o.fid);var c=this.FnUnitUtils.getOutData(o).indexOf(n);return a.attr("index",c),l.addClass("item"),a;},o.prototype.wrapSelectedItemForNested=function(t){var e=$(crel("div",{class:"brtc-style-flex-center brtc-style-relative"}));t.attr("tid"),t.attr("fid");return e.append(t),this.attachDragEventListenerForNested(t.find(".brtc-va-studio-dm-draggable")),e;},o.prototype.wrapSelectedItem=function(t){var e=this,i=$(crel("div",{class:"brtc-style-flex-center brtc-style-relative"})),o=$(crel("span",{class:"brtc-style-editor-content-remove-button"})),n=t.attr("tid"),r=t.attr("fid");return o.click(function(){e.removeSelectedTable(n,r),i.remove();}),i.append(t),i.append(o),this.attachDropEventListener(i,"replace"),i;},o.prototype.wrapNotSelectedItem=function(t){this.attachDragEventListener(t);var e=$(crel("div",{class:"brtc-style-flex-center brtc-style-relative",style:"padding-right: 20px"}));return e.append(t),e;},o.prototype.attachDropEventListener=function(t,e){var i=this;t.droppable({accept:".brtc-style-controls-inputselector-box-wrapper.input-table",activate:function activate(t,e){$(this).find(".brtc-style-controls-dataselector-empty-fnunit").addClass("brtc-style-droppable-active");},deactivate:function deactivate(t,e){var i=$(this).find(".brtc-style-controls-dataselector-empty-fnunit");i.removeClass("brtc-style-droppable-active"),i.removeClass("brtc-style-droppable-hover");},over:function over(t,e){$(this).find(".brtc-style-controls-dataselector-empty-fnunit").addClass("brtc-style-droppable-hover");},out:function out(t,e){$(this).find(".brtc-style-controls-dataselector-empty-fnunit").removeClass("brtc-style-droppable-hover");},drop:function drop(t,o){var n=$(this).find(".brtc-style-controls-dataselector-empty-fnunit"),r=o.draggable;n.removeClass("brtc-style-droppable-active"),n.removeClass("brtc-style-droppable-hover"),"replace"===e?i.replaceSelectedTable(r,$(this)):"add"===e&&i.addSelectedTable(r);}});},o.prototype.replaceSelectedTable=function(t,e){var i=t.attr("tid"),o=this.getDropFuncTarget(e).attr("tid"),n=_.indexOf(this.getModelInData(),o),r=this.createModelInDataUpdateCommand(this.getTargetModel(),[IN_DATA,n],i);r.add(this.createSetSkipPropertyByTid(i,!0)),r.add(this.createSetSkipPropertyByTid(o,!1)),this.getEditor().getCommandManager().execute(r),this.refresh();},o.prototype.refresh=function(){this.isNestedFlow()?(this.createNestedFlowInputDataControls(),this.$modelSideBar.find(".brtc-va-editors-sheet-controls-empty-fnunit").hide(),this.$inTableListWrapper.hide(),this.$itemContainer.sortable("disable"),this.$itemContainerAndAddableWrapper.perfectScrollbar(),this.$itemContainerAndAddableWrapper.perfectScrollbar("update"),this.$notSelectedItemContainer.perfectScrollbar(),this.$notSelectedItemContainer.perfectScrollbar("update"),this.$modelSideBar.addClass("inner-flow")):(this.createModelInputDataControls(),this.$modelSideBar.find(".brtc-va-editors-sheet-controls-empty-fnunit").show(),this.$inTableListWrapper.show(),this.$itemContainer.sortable("enable"),this.$itemContainerAndAddableWrapper.perfectScrollbar(),this.$itemContainerAndAddableWrapper.perfectScrollbar("update"),this.$notSelectedItemContainer.perfectScrollbar(),this.$notSelectedItemContainer.perfectScrollbar("update"),this.$modelSideBar.removeClass("inner-flow"));},o.prototype.createNestedFlowInputDataControls=function(){this.createTableLink(this.getModelInData());},o.prototype.createModelInputDataControls=function(){this.$selectedItems=this.createSelectedTableElements(this.getModelInData()),this.$notSelectedItems=this.createNotSelectedTableElements(this.getInFunctions()),this.$itemContainer.empty(),this.$notSelectedItemContainer.empty(),this.$itemContainer.append(this.$selectedItems),this.$notSelectedItemContainer.append(this.$notSelectedItems);},o.prototype.createTableLink=function(e){var i=this,o=i.getActiveModel(),n=o.getMainModel(),r=t.VA.Core.Utils.NestedFlowUtils.getParentModel(n,o),a={links:[]};for(var s in e){a.links.push({source:"/"+t.VA.Env.Session.userId+"/"+r.mid+"/"+e[s],alias:"/"+t.VA.Env.Session.userId+"/"+o.mid+"/"+e[s]});}var l={url:"api/va/v2/data/link/create",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),blocking:!0};console.log(a),$.ajax(l).done(function(t){i.$selectedItems=i.createSelectedTableElements(i.getModelInData()),i.$itemContainer.empty(),i.$notSelectedItemContainer.empty(),i.$itemContainer.append(i.$selectedItems);}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});},o.prototype.getTableItemLabel=function(t,e){return this.FnUnitUtils.getOutputsToObject(t)[e];},o.prototype.createItemForNested=function(e,o){var n=$(crel("div",{class:i.dataSelectorItem})),r=t.VA.Core.Utils.WidgetUtils.createPaletteItem(n,e.func,"data");return r.find(".brtc-va-views-palette-fnunit-label").text(this.FnUnitUtils.getLabel(e)),r.addClass("item"),t.VA.Core.Utils.WidgetUtils.putData(r,"template",e),n;},o.prototype.createItem=function(t,i){var o=this.FnUnitUtils.getOutputsToObject(t),n=(i=i,this.FnUnitUtils.getTypeByTableId(t,i)),r=this.FnUnitUtils.getFunc(t),a=this.FnUnitUtils.getLabel(t),s=e.create({key:o[i],tableId:i,type:n,func:r,label:a});return s.attr("tid",i),s.addClass("input-table"),s;},o.prototype.getActiveModel=function(){return this.getEditor().getActiveModel();},o.prototype.createModelInDataUpdateCommand=function(e,i,o){var n=new t.VA.Core.CompoundCommand(this,{label:"Change Input Data"});return n.add(new t.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand(this,{target:e,path:i,value:o})),n;},o.prototype.createModelInDataAddCommand=function(e,i,o){var n=new t.VA.Core.CompoundCommand(this,{label:"Add Input Data"});return e[IN_DATA]||n.add(new t.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this,{target:e,path:[IN_DATA],value:[]})),n.add(new t.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this,{target:e,path:i,value:o})),n;},o.prototype.createModelInDataRemoveCommand=function(e,i){var o=new t.VA.Core.CompoundCommand(this,{label:"Remove Input Data"});return o.add(new t.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(this,{target:e,path:i})),o;},o.prototype.createAddableArea=function(){if(!this.$addableArea){var t=$(crel("div",{class:"brtc-style-flex-center brtc-va-editors-sheet-controls-empty-fnunit"},crel("div",{class:"brtc-style-controls-dataselector-empty-fnunit"},crel("div","Drop Data"))));t.addClass("empty"),this.attachDropEventListener(t,"add"),this.$addableArea=t;}return this.$addableArea;},o.prototype.isAcceptable=function(t){return _.isEqual(this.FnUnitUtils.getCategory(t),"io")&&!this.FnUnitUtils.hasInput(t)&&this.FnUnitUtils.hasOutput(t)&&this.FnUnitUtils.hasTable(t);},o.prototype.getInFunctions=function(){var t=this,e=[],i=this.getEditor().getModel(),o=this.getEditor().getActiveModel(),n=_.filter(o.functions,function(e){return t.isAcceptable(e);});return _.forEach(n,function(o){var n=t.FnUnitUtils.getOutData(o);e.push(_.filter(n,function(t){return-1===_.indexOf(i[IN_DATA],t);}));}),_.flatten(e);},o.prototype.attachDragEventListenerForNested=function(e){var i=this;e.draggable({appendTo:"body",scroll:!1,cursor:"move",cursorAt:{left:5,top:5},helper:function helper(o){var n=$(this).clone();n.css({"z-index":5100});var r=i.getActiveModel(),a=r.getMainModel(),s=t.VA.Core.Utils.NestedFlowUtils.getParentModel(a,r),l=t.VA.Core.Utils.WidgetUtils.getData(e,"template"),c=t.VA.Core.Utils.WidgetUtils.getFunctionLibrary("data","dataViewer").defaultFnUnit;c.display.label=l.display.label,c.outData=i.FnUnitUtils.getOutTable(l),c.fid=t.VA.Core.Utils.IDGenerator.func.id(),c.display.diagram.position.x=20,c.display.diagram.position.y=10,c.param.mid=s.mid,c.param.fid=l.fid,console.log(c);var d={functions:[c],links:[]};return t.VA.Core.Utils.WidgetUtils.putData(n,"template",$.extend(!0,{},d)),t.VA.Core.Utils.WidgetUtils.putData(n,"source",i),n;},start:function start(t,e){$(".brtc-va-studio").addClass("brtc-va-studio-dragging"),$(this).draggable("option","cursorAt",{left:Math.floor(e.helper.width()/2),top:Math.floor(e.helper.height()/2)});},drag:function drag(t,e){e.helper.trigger("feedback",[{clientX:t.clientX,clientY:t.clientY}]);},stop:function stop(t,e){$(".brtc-va-studio").removeClass("brtc-va-studio-dragging");}});},o.prototype.attachDragEventListener=function(t){return t.draggable({helper:function helper(){var t=$(this).clone(),e=$(this).width();return t.css({"z-index":5100,width:e,height:"65px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}),t;},appendTo:"body"}),t;},o.prototype.createSetSkipPropertyByTid=function(e,i){var o=this.getFnUnitByTableId(e);if(o)return new t.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand(this,{target:o,path:["skip"],value:i});},o.prototype.addSelectedTable=function(t){var e=t.attr("tid"),i=this.getModelInData().length,o=this.createModelInDataAddCommand(this.getTargetModel(),[IN_DATA,i],e);o.add(this.createSetSkipPropertyByTid(e,!0)),this.getEditor().getCommandManager().execute(o);},o.prototype.removeSelectedTable=function(t,e){var i=_.indexOf(this.getModelInData(),t),o=this.createModelInDataRemoveCommand(this.getTargetModel(),[IN_DATA,i]);o.add(this.createSetSkipPropertyByTid(t,!1)),this.getEditor().getCommandManager().execute(o);},o.prototype.getTargetModel=function(){return this.getEditor().getModel();},o.prototype.getSelectedTableIds=function(){return _.map(this.$itemContainer.children(),function(t){return $(t).find("."+i.dataSelectorItem).attr("tid");});},o.prototype.changeSelectedTableOrder=function(t){var e=this.getTargetModel(),i=t.length!==e[IN_DATA].length;if(!i)for(var o=0;o<e[IN_DATA].length;o++){if(t[o]!==e[IN_DATA][o]){i=!0;break;}}if(i){var n=this.createModelInDataUpdateCommand(e,[IN_DATA],t);this.getEditor().getCommandManager().execute(n);}},o.prototype.getDropFuncTarget=function(t){var e=t.find("."+i.dataSelectorItem);return e.length?e:t;},o.prototype.isNestedFlow=function(){var t=this.getEditor().getActiveFnUnit();return t&&("if"===t.func||"forLoop"===t.func||"whileLoop"===t.func);},t.VA.Core.Tools.SideBar.InputTableSideBar=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){this.$modelSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar visual"></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar),this.optionPanelManager=new t.VA.Implementation.Visual.Views.OptionPanelManager(this.$modelSideBar,{width:"100%",height:"100%",editor:this.getEditor()});},e.prototype.selectionChanged=function(e){this.getEditor().getModelClazz()==t.VA.Implementation.Visual.Clazz&&this.optionPanelManager.selectionChanged(e);},e.prototype.destroy=function(t){this.optionPanelManager.destroy(t);},e.prototype.configureSize=function(){this.$parent.find(".brtc-va-studio-sidebar-area").width(this.options.width);},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.$modelSideBar.find(".bcharts-ds-panel");},t.VA.Core.Tools.SideBar.ObjectAndPropertiesSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){var t=this;this.commandListener=function(e){t.handleCommand(e);},this.options.manager.editor.addCommandListener(this.commandListener),this.options.manager.editor.addGoHistoryListener(this.commandListener);this.$modelSideBar=$('\n            <div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar dataflow optsidebar">\n               <div class="brtc-va-tools-sidebar-contents-wrapper" style="\n            overflow: hidden;\n            height: 100%;\n            position: relative;\n            padding-right: 20px;\n        ">\n                   <div style="\n            width: 100%;\n            height: auto;\n            margin-bottom: 10px;\n        ">\n                       <div class="brtc-opt-model-dropdownlist"></div>\n                       <div class="brtc-opt-model-delete-button" style="\n            width: 100%;\n            height: 30px;\n            background-color: #6c79e9;\n            color: #fff;\n            text-align: center;\n            line-height: 30px;\n            margin: 10px 0;\n            cursor: pointer;\n        ">\n                       Unbind OPT</div>\n                       <div class="brtc-opt-model-detail-view"></div>\n                   </div>\n               </div>\n            </div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar),this.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar(),this.createOptModelDropDownList(),this.createOptModelDeleteButton(),this.createDetailView(),this.render();},e.prototype.createOptModelDropDownList=function(){var e=this,i=this._getDropDownListSource();this.$dropdownList=this.$modelSideBar.find(".brtc-opt-model-dropdownlist"),this.$dropdownList.jqxDropDownList({theme:t.VA.Env.Theme,source:i,selectedIndex:0,checkboxes:!1,width:325,height:25,openDelay:0,closeDelay:0,autoDropDownHeight:!0,displayMember:"text",valueMember:"value"}),this.$dropdownList.on("select",function(t){var i=t.args;if(i){var o=i.item.value;"mouse"!==i.type&&"keyboard"!==i.type||(e.createDetailView(o),e.render(o));}});},e.prototype._getDropDownListSource=function(){var e=Studio.getEditorContainer().getActiveModelEditor(),i=e.getEditorInput().getProjectId(),o=e.getEditorInput().getFileId(),n=t.OptModelManager.getOptModels(i,o),r=[];if(n[0])for(var a=0;a<n.length;a++){r.push({text:n[a].label,value:n[a].optId});}return r;},e.prototype.createOptModelDeleteButton=function(){var e=this;this.$optModelDeleteButton=this.$modelSideBar.find(".brtc-opt-model-delete-button"),this.$optModelDeleteButton.click(function(){t.VA.Core.Utils.WidgetUtils.openConfirmDialog("Are you sure you want to unbind this optimization model?",function(i){if(i.OK){var o=Studio.getEditorContainer().getActiveModelEditor(),n=o.getEditorInput().getProjectId(),r=o.getEditorInput().getFileId(),a=e.$dropdownList.val();if(a&&t.OptModelManager.getOptModel(n,r,a)){var s=o.getCommandManager(),l=t.OptModelManager.createRemoveOptModelCommand(n,r,a);s.execute(l);}}});});},e.prototype.createDetailView=function(e){this.$detailView=this.$modelSideBar.find(".brtc-opt-model-detail-view"),this.$detailView.empty();var i=Studio.getEditorContainer().getActiveModelEditor(),o=i.getEditorInput().getProjectId(),n=i.getEditorInput().getFileId();if(!e){var r=t.OptModelManager.getOptModels(o,n);r[0]&&(e=r[0].optId);}this.optModel=t.OptModelManager.getOptModel(o,n,e),this.optModel?this.createDetailViewControls(this.$detailView):this.resetDropDownList();},e.prototype.createDetailViewControls=function(t){this.$controls={options:{objective:{functionLabel:null,tableLabel:null,row:null,column:null,sense:null},maxEvaluations:null,method:null}};var e=$('<div style="\n            margin-bottom:30px;\n        "></div>');this.$detailViewControls=e,t.append(e),e.append("\n            <style>\n                .brtc-opt-model-detail-view .jqx-expander-header-content-office {\n                    margin-left: 0 !important;\n                }\n\n                .brtc-va-tools-sidebar .brtc-opt-model-selected-function-controls-area div.jqx-expander-header-expanded {\n                    border: none;\n                }\n\n                .brtc-va-tools-sidebar .brtc-opt-model-selected-function-controls-area .jqx-expander-arrow {\n                    margin-top: 6px !important;\n                }\n\n                .brtc-va-tools-sidebar .brtc-opt-model-selected-function-controls-area div.jqx-expander-content {\n                    margin-bottom: 0;\n                }\n                    \n                .brtc-opt-model-selected-function-controls-area .jqx-expander-arrow-top-office {\n                    background-image: url(/css/plugins/aui-package/images/office-icon-right.png);\n                }\n                \n                .brtc-opt-model-selected-function-controls-area .jqx-expander-arrow-bottom-office {\n                    background-image: url(/css/plugins/aui-package/images/office-icon-down.png);\n                }\n\n                .brtc-opt-param-label-row .jqx-checkbox-default-office {\n                    margin-right: 5px;\n                    margin-left: 0;\n                }\n\n                .brtc-opt-objective-data {\n                    width: 235px;\n                    height: 26px;\n                    font-family: Arial, helvetica, sans-serif;\n                    border: 1px solid #d4d4d4;\n                    line-height: 24px;\n                    padding-left: 10px;\n                    padding-right: 10px;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                    white-space: nowrap;\n                    box-sizing: border-box;\n                    color: rgba(0, 0, 0, .8);\n                    cursor: default;\n                    background-color: #fff;\n                    opacity: .55;\n                }\n\n                .brtc-opt-function-select-button {\n                    display: inline-block;\n                    box-sizing: border-box;\n                    text-align: center;\n                    cursor: pointer;\n                    float: left;\n                    font-weight: normal;\n                    font-size: 12px;\n\n                    width: 55px;\n                    height: 24px;\n\n                    border: 1px solid #656eea;\n\n                    background-color: #fff;\n                    color: #656eea;\n                }\n\n                .brtc-opt-function-select-button.selected {\n                    background-color: #656eea;\n                    color: #FFFFFF;\n                }\n\n                .brtc-opt-function-select-button + .brtc-opt-function-select-button {\n                    border-left: none;\n                }\n            </style>\n        "),this.createObjectiveControl(e),this.createSelectedFunctionsControl(e),this.createAdvancedSettingControl(e);},e.prototype.createLabelControl=function(e){var i=this,o=$("<div></div>");e.append(o);var n=$('<div style="margin-bottom: 3px;">Label</div>');o.append(n);var r=$('<input type="text"/>');o.append(r),r.jqxInput({placeHolder:"Enter label",theme:t.VA.Env.Theme,width:"100%",height:25}),r.val(this.optModel.label),r.on("change",function(t){var e=t.args;if(e&&null!=e.type){var o=$(this).val();i.executeSetOptModelCommand({label:o});}});},e.prototype.createDescriptionControl=function(e){var i=this,o=$("<div></div>");e.append(o);var n=$('<div style="margin: 7px 0 3px 0;">Description</div>');o.append(n);var r=$('<input type="text"/>');o.append(r),r.jqxInput({placeHolder:"Enter description",theme:t.VA.Env.Theme,width:"100%",height:25}),r.val(this.optModel.description),r.on("change",function(t){var e=t.args;if(e&&null!=e.type){var o=$(this).val();i.executeSetOptModelCommand({description:o});}});},e.prototype.createContinueControl=function(e){var i=this,o=$("<div></div>");e.append(o);var n=$('<div style="margin-top: 11px;">Continue from saved model</div>');o.append(n),n.jqxCheckBox({theme:t.VA.Env.Theme});var r="true"===this.optModel.options.useSavedModel;n.jqxCheckBox("val",r),n.on("change",function(t){var e=t.args.checked?"true":"false";i.optModel.options.useSavedModel!=e&&(i.optModel.options.useSavedModel=e,i.executeSetOptModelCommand({options:i.optModel.options},{key:"useSavedModel"}));});},e.prototype.createObjectiveControl=function(e){var i=this,o=$("<div></div>");e.append(o);var n=$('<div style="\n            font-weight: bold;\n            height: 17px;\n            line-height: 17px;\n            margin-left: 0;\n        ">Objective</div>');o.append(n);var r=$('<div style="padding-top:8px;"></div>');o.append(r),this.createSelectObjectiveButton(r);var a=$('<div style="\n            margin-top: 10px;\n            margin-bottom: 10px;\n        "></div>');r.append(a),this.createFunctionLabelControl(a),this.createTableLabelControl(a),this.createRowControl(a),this.createColumnControl(a),this.createSenseControl(a),o.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"right",expanded:!0}),o.on("expanded",function(){i.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar("update");}),o.on("collapsed",function(){i.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar("update");});},e.prototype.createSelectObjectiveButton=function(e){var i=$('<input type="button" value="+ Select Objective"/>');e.append(i),i.jqxButton({theme:t.VA.Env.Theme,width:"100%",height:30}),i.on("click",this.openOptSelectObjectiveDialog.bind(this)),this.$selectObjectiveButton=i;},e.prototype.openOptSelectObjectiveDialog=function(e){var i=this;new t.VA.Core.Dialogs.OptSelectObjectiveDialog(i,{functions:i.getFunctionsInfo(),objective:$.extend(!0,{},i.optModel.options.objective),close:function close(t){t.OK&&(i.optModel.options.objective=t.objective,i.executeSetOptModelCommand({options:i.optModel.options},{key:"objective"}));}});},e.prototype.appendObjectiveParamRow=function(t,e){var i=$('<div style="\n            display: flex;\n            margin-bottom: 5px;\n        "></div>');t.append(i);var o=$("<div style=\"\n            margin: 0 0 4px 0;\n            width: 95px;\n            line-height: 22px;\n        \">"+e+"</div>");i.append(o);var n=$('<div class="brtc-opt-objective-data"></div>');return i.append(n),n;},e.prototype.createFunctionLabelControl=function(t){this.$controls.options.objective.functionLabel=this.appendObjectiveParamRow(t,"Function");},e.prototype.createTableLabelControl=function(t){this.$controls.options.objective.tableLabel=this.appendObjectiveParamRow(t,"Table Name");},e.prototype.createRowControl=function(t){this.$controls.options.objective.row=this.appendObjectiveParamRow(t,"Row Number");},e.prototype.createColumnControl=function(t){this.$controls.options.objective.column=this.appendObjectiveParamRow(t,"Column Name");},e.prototype.createSenseControl=function(t){this.$controls.options.objective.sense=this.appendObjectiveParamRow(t,"Sense");},e.prototype.createSelectedFunctionsControl=function(e){var i=this,o=Studio.getEditorContainer().getActiveModelEditor().getEditorInput().getContents();this.$controls.optFunctions={},this.$functionsArea&&this.$functionsArea.remove();var n=$("<div></div>");e.append(n),this.$functionsArea=n;var r=$('<div style="\n            font-weight: bold;\n            height: 17px;\n            line-height: 17px;\n            margin-left: 0;\n        ">Parameters</div>');n.append(r);var a=$('\n            <div class="brtc-opt-model-selected-function-controls-area" style="padding-top:8px;">\n            </div>');n.append(a);for(var s=this.optModel.optFunctions,l=0;l<s.length;l++){if("none"!==s[l].optSelected){var c=o.getFnUnitById(s[l].fid);c&&c.display&&t.VA.Core.Functions.Library[c.func]&&function(e,n){var r=e[n].fid,s=$('<div style="\n                    margin-bottom: 0;\n                "></div>');s.attr("fid",r),a.append(s);var l=$('<div style="display:flex;"></div>');s.append(l);var c=o.getFnUnitById(r),d=c.display.label,p=t.VA.Core.Functions.Library[c.func].category;i.createFunctionLabel(l,d,r,p),i.createFunctionSelectControl(l,e,n);var u=$('<div style="\n                    padding-top: 10px;\n                "></div>');s.append(u);var h=e[n].optParam;for(var f in h){!function(t,e){var o=$('<div style="                            \n                            margin-bottom: 10px;\n                            margin-left: 18px;\n                        "></div>');o.attr("fid",r),u.append(o);var a=$('<div class="brtc-opt-param-label-row" style="\n                            display: flex;\n                            margin-bottom: 4px;\n                        "></div>');o.append(a),i.createParamSelectControl(a,n,r,e),i.createParamLabel(a,e);var s=$('<div style="\n                            padding: 10px 10px 5px 10px;\n                            background-color: #f2f2f2;\n                        "></div>');o.append(s),i.createParamTypeControl(s,r,e),i.createParamInitValueControl(s,r,e),"DISCRETE_RANGE"===t[e].type||"CONTINUOUS"===t[e].type?(i.createParamMinControl(s,r,e),i.createParamMaxControl(s,r,e)):i.createParamSetControl(s,r,e);}(h,f);}s.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"left",expanded:!1}),s.on("expanded",function(){i.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar("update");}),s.on("collapsed",function(){i.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar("update");});}(s,l);}}n.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"right",expanded:!0}),n.on("expanded",function(){i.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar("update");}),n.on("collapsed",function(){i.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar("update");});},e.prototype.createFunctionLabel=function(t,e,i,o){o=o||"io";var n=$("\n            <div class=\"brtc-va-fnunit-category-"+o+"\" style=\"\n            box-sizing: border-box;\n            width: 190px;\n            height: 32px;\n            line-height: 32px;\n            font-size: 12px;            \n            font-family: Arial, Dotum, Tahoma, sans-serif;\n            font-weight: bold;            \n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n            margin-right: 8px;\n            margin-left: 16px;\n            display: flex;\n        \">\n                <div class=\"brtc-style-views-palette-fnunit-icon\" style=\"margin-top: 5px;\"></div>\n                <div class=\"brtc-opt-function-label\" style=\"       \n            width: 223px;   \n            overflow: hidden;\n            text-overflow: ellipsis;\n            white-space: nowrap;\n        \"></div>\n            </div>\n        ");n.find(".brtc-opt-function-label").text(e),n.attr("title",e),t.append(n);},e.prototype.createFunctionSelectControl=function(t,e,i){var o=this,n=$('\n            <div style="\n            width: 110px;\n            margin-top: 5px;\n        ">\n                <button class="brtc-opt-function-select-button" value="true">Use</button>\n                <button class="brtc-opt-function-select-button" value="false">Unuse</button>\n            </div>');t.append(n);var r=e[i].fid;this.$controls.optFunctions[r]=this.$controls.optFunctions[r]||{optSelected:null,optParam:{}},this.$controls.optFunctions[r].optSelected=n,n.find("button").click(function(t){var e=$(this).attr("value"),n=o.optModel.optFunctions[i];n.optSelected!=e&&(n.optSelected=e,o.executeSetOptModelCommand({optFunctions:o.optModel.optFunctions},{fid:r,key:"optSelected"})),t.stopPropagation();});},e.prototype.createParamLabel=function(t,e){var i=$('<div style="\n            text-transform: capitalize;\n            margin-right: 3px;\n            padding-top: 2px;\n            width: 100%;\n        "></div>');i.text(e.replace(/-/g," ")),t.append(i);},e.prototype.createParamSelectControl=function(e,i,o,n){var r=this,a=$('<div style=""></div>');e.append(a),this.$controls.optFunctions[o].optParam[n]=this.$controls.optFunctions[o].optParam[n]||{optParamSelected:null},this.$controls.optFunctions[o].optParam[n].optParamSelected=a.jqxCheckBox({theme:t.VA.Env.Theme}),a.click(function(t){t.stopPropagation();}),a.on("change",function(t){var e=t.args.checked?"true":"false",a=r.optModel.optFunctions[i].optParam[n];a.optParamSelected!=e&&(a.optParamSelected=e,r.executeSetOptModelCommand({optFunctions:r.optModel.optFunctions},{fid:o,param:n,key:"optParamSelected"}));});},e.prototype.appendFunctionParamRow=function(e,i,o,n){var r=$('<div style="display: flex; margin-bottom: 5px;"></div>');e.append(r);var a=$("<div style=\"\n            height: 25px;\n            line-height: 25px;\n            width: 75px;\n        \">"+i+"</div>");r.append(a);var s=$('<input type="text"/>');return r.append(s),s.jqxInput({placeHolder:o,theme:t.VA.Env.Theme,width:214,height:25,disabled:n}),s;},e.prototype.createParamTypeControl=function(t,e,i){var o=this.appendFunctionParamRow(t,"Type","Enter type",!0);this.$controls.optFunctions[e].optParam[i].type=o;},e.prototype.createParamInitValueControl=function(t,e,i){var o=this,n=this.appendFunctionParamRow(t,"Initial Value","Enter initial value");n.on("change",function(t){var n=t.args;if(n&&null!=n.type){var r=$(this).val();for(var a in o.optModel.optFunctions){if(o.optModel.optFunctions[a].fid===e){o.optModel.optFunctions[a].optParam[i].value=r;break;}}o.executeSetOptModelCommand({optFunctions:o.optModel.optFunctions},{fid:e,param:i,key:"value"});}}),this.$controls.optFunctions[e].optParam[i].value=n;},e.prototype.createParamMinControl=function(t,e,i){var o=this,n=this.appendFunctionParamRow(t,"Min","Enter min");n.on("change",function(t){var n=t.args;if(n&&null!=n.type){var r=$(this).val();for(var a in o.optModel.optFunctions){if(o.optModel.optFunctions[a].fid===e){o.optModel.optFunctions[a].optParam[i].min=r;break;}}o.executeSetOptModelCommand({optFunctions:o.optModel.optFunctions},{fid:e,param:i,key:"min"});}}),this.$controls.optFunctions[e].optParam[i].min=n;},e.prototype.createParamMaxControl=function(t,e,i){var o=this,n=this.appendFunctionParamRow(t,"Max","Enter max");n.on("change",function(t){var n=t.args;if(n&&null!=n.type){var r=$(this).val();for(var a in o.optModel.optFunctions){if(o.optModel.optFunctions[a].fid===e){o.optModel.optFunctions[a].optParam[i].max=r;break;}}o.executeSetOptModelCommand({optFunctions:o.optModel.optFunctions},{fid:e,param:i,key:"max"});}}),this.$controls.optFunctions[e].optParam[i].max=n;},e.prototype.createParamSetControl=function(t,e,i){var o=this,n=this.appendFunctionParamRow(t,"Value Set","Enter value set");n.on("change",function(t){var n=t.args;if(n&&null!=n.type){var r=$(this).val().split(",").map(function(t){return t.replace(/ /g,"");});for(var a in o.optModel.optFunctions){if(o.optModel.optFunctions[a].fid===e){o.optModel.optFunctions[a].optParam[i].set=r;break;}}o.executeSetOptModelCommand({optFunctions:o.optModel.optFunctions},{fid:e,param:i,key:"set"});}}),this.$controls.optFunctions[e].optParam[i].set=n;},e.prototype.createAdvancedSettingControl=function(e){var i=this,o=$("<div></div>");e.append(o);var n=$('<div style="\n            font-weight: bold;\n            height: 17px;\n            line-height: 17px;\n            margin-left: 0;\n        ">Advanced Settings</div>');o.append(n);var r=$('<div style="padding-top:8px; margin-bottom: 80px;"></div>');o.append(r),this.createMethodControl(r),this.createMaxEvaluationsControl(r),o.jqxExpander({theme:t.VA.Env.Theme,arrowPosition:"right",expanded:!1}),o.on("expanded",function(){i.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar("update");}),o.on("collapsed",function(){i.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper").perfectScrollbar("update");});},e.prototype.createMethodControl=function(e){var i=this;e.append('<div style="margin: 3px 0 4px 0;">Method</div>');var o=$('<div style="width:"></div>');e.append(o);this.$controls.options.method=o.jqxDropDownList({theme:t.VA.Env.Theme,source:[{text:"Soga",value:"SOGA"},{text:"Coliny Cobyla",value:"COLINY_COBYLA"},{text:"Coliny Direct",value:"COLINY_DIRECT"},{text:"Conmin MFD",value:"CONMIN_MFD"},{text:"Mesh Adaptive Search",value:"MESH_ADAPTIVE_SEARCH"}],checkboxes:!1,width:325,height:25,openDelay:0,closeDelay:0,autoDropDownHeight:!0,displayMember:"text",valueMember:"value"}),o.on("select",function(t){var e=t.args;if(e){var o=e.item.value;"mouse"!==e.type&&"keyboard"!==e.type||(i.optModel.options.method=o,i.executeSetOptModelCommand({options:i.optModel.options},{key:"method"}));}});},e.prototype.createMaxEvaluationsControl=function(e){var i=this;e.append('<div style="margin: 10px 0 4px 0;">Max Evaluations</div>');var o=$("<div></div>");e.append(o);this.$controls.options.maxEvaluations=new t.VA.Core.Editors.Sheet.Controls.NumericInput(o,{numberType:"int",min:1,max:9999,minus:!1,placeholder:"Enter max evaluations"}),this.$controls.options.maxEvaluations.onChange(function(t){i.optModel.options.maxEvaluations=t,i.executeSetOptModelCommand({options:i.optModel.options},{key:"maxEvaluations"});});},e.prototype.render=function(e){var i=Studio.getEditorContainer().getActiveModelEditor(),o=i.getEditorInput().getProjectId(),n=i.getEditorInput().getFileId();if(!e){var r=t.OptModelManager.getOptModels(o,n);r[0]&&(e=r[0].optId);}this.optModel=t.OptModelManager.getOptModel(o,n,e),this.optModel&&(this.resetDropDownList(),this.renderOptModelDropDownList(e),this.renderDetailViewControls(),this.renderValidation());},e.prototype.renderOptModelDropDownList=function(t){this.$dropdownList.val(t);},e.prototype.renderDetailViewControls=function(){var t=this.optModel;this.$detailViewControls.attr("opt-id",t.optId),this.renderObjectiveControl(),this.renderSelectedFunctionsControl(),this.renderAdvancedSettingControl();},e.prototype.renderObjectiveControl=function(){this.renderFunctionLabelControl(),this.renderTableLabelControl(),this.renderRowControl(),this.renderColumnControl(),this.renderSenseControl();},e.prototype.renderObjectiveParamRow=function(t,e,i){e?(t.text(e),t.attr("title",e)):t.text(i);},e.prototype.renderFunctionLabelControl=function(){var t=this.optModel.options.objective.fid,e=Studio.getEditorContainer().getActiveModelEditor().getEditorInput().getContents().getFnUnitById(t),i=e?e.display.label:"",o=this.$controls.options.objective.functionLabel;this.renderObjectiveParamRow(o,i,"");},e.prototype.renderTableLabelControl=function(){var t,e=this.optModel.options.objective.fid,i=this.optModel.options.objective.tableName,o=Studio.getEditorContainer().getActiveModelEditor().getEditorInput().getContents().getFnUnitById(e),n=o?o.display.label:"";if(o){var r=o.outData;for(var a in r){if(r[a]===i){t=n+"-"+(Number(a)+1);break;}}}var s=this.$controls.options.objective.tableLabel;this.renderObjectiveParamRow(s,t,"");},e.prototype.renderRowControl=function(){var t=this.optModel.options.objective.row,e=this.$controls.options.objective.row;this.renderObjectiveParamRow(e,t,"");},e.prototype.renderColumnControl=function(){var t=this.optModel.options.objective.column,e=this.$controls.options.objective.column;this.renderObjectiveParamRow(e,t,"");},e.prototype.renderSenseControl=function(){var t=this.optModel.options.objective.sense,e=t.charAt(0).toUpperCase()+t.slice(1),i=this.$controls.options.objective.sense;this.renderObjectiveParamRow(i,e,"");},e.prototype.renderSelectedFunctionsControl=function(){for(var t=this,e=this.optModel.optFunctions,i=0;i<e.length;i++){"none"!==e[i].optSelected&&function(e,i){var o=e[i];t.renderFunctionSelectControl(o);var n=o.optParam;for(var r in n){!function(e){t.renderParamSelectControl(o,e),t.renderParamTypeControl(o,e),t.renderParamInitValueControl(o,e);var i=o.optParam[e].type;"DISCRETE_RANGE"===i||"CONTINUOUS"===i?(t.renderParamMinControl(o,e),t.renderParamMaxControl(o,e)):t.renderParamSetControl(o,e);}(r);}}(e,i);}},e.prototype.renderFunctionSelectControl=function(t){var e=t.fid,i=t.optSelected;if(this.$controls.optFunctions[e]){var o=this.$controls.optFunctions[e].optSelected;o.find("button").removeClass("selected"),o.find("button[value="+i+"]").addClass("selected");}},e.prototype.renderParamSelectControl=function(t,e){var i=t.fid,o="true"===t.optParam[e].optParamSelected;this.$controls.optFunctions[i]&&this.$controls.optFunctions[i].optParam[e].optParamSelected.jqxCheckBox("val",o);},e.prototype.renderFunctionParamControl=function(t,e,i,o){this.$controls.optFunctions[t]&&this.$controls.optFunctions[t].optParam[e][i].val(o);},e.prototype.renderParamTypeControl=function(t,e){var i=t.fid,o=t.optParam[e].type.replace(/_/g," ");this.renderFunctionParamControl(i,e,"type",o);},e.prototype.renderParamInitValueControl=function(t,e){var i=t.fid,o=t.optParam[e].value;this.renderFunctionParamControl(i,e,"value",o);},e.prototype.renderParamMinControl=function(t,e){var i=t.fid,o=t.optParam[e].min;this.renderFunctionParamControl(i,e,"min",o);},e.prototype.renderParamMaxControl=function(t,e){var i=t.fid,o=t.optParam[e].max;this.renderFunctionParamControl(i,e,"max",o);},e.prototype.renderParamSetControl=function(t,e){var i=t.fid,o=t.optParam[e].set,n=$.isArray(o)?o.toString():o;this.renderFunctionParamControl(i,e,"set",n);},e.prototype.renderAdvancedSettingControl=function(){this.renderMethodControl(),this.renderMaxEvaluationsControl();},e.prototype.renderMethodControl=function(){var t=this.optModel.options.method;this.$controls.options.method.val(t);},e.prototype.renderMaxEvaluationsControl=function(){var t=this.optModel.options.maxEvaluations;this.$controls.options.maxEvaluations.setValue(t);},e.prototype.renderValidation=function(){var t=this.optModel;this.renderObjectiveValidation(t),this.renderOptFunctionsValidation(t);},e.prototype.renderObjectiveValidation=function(e){var i="#d4d4d4";t.OptModelManager.isValidObjective(e)||(i="#ea3539"),this.$selectObjectiveButton.css("border-color",i);},e.prototype.renderOptFunctionsValidation=function(){for(var t in this.$controls.optFunctions){for(var e in this.$controls.optFunctions[t].optParam){for(var i in this.$controls.optFunctions[t].optParam[e]){var o=this.$controls.optFunctions[t].optParam[e][i];o&&(o.val()?o.css("border-color","#d4d4d4"):o.css("border-color","#ea3539"));}}}},e.prototype.getFunctionsInfo=function(){for(var t=Studio.getEditorContainer().getActiveModelEditor().getEditorInput().getContents(),e=this.optModel.optFunctions,i=[],o=0;o<e.length;o++){var n=e[o].fid,r=t.getFnUnitById(n);i.push($.extend(!0,{},r));}return i;},e.prototype.resetDropDownList=function(){this.$dropdownList.jqxDropDownList("clear"),this.$dropdownList.jqxDropDownList("clearSelection"),this.$dropdownList.jqxDropDownList({source:this._getDropDownListSource()});},e.prototype.handleCommand=function(e){if(e instanceof t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand)for(var i in e.options.commands){this.handleCommand(e.options.commands[i]);}else e instanceof t.VA.Core.CompoundCommand?this.handleCompoundCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.NewOptModelCommand?this.handleNewOptModelCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.SetOptModelCommand?this.handleSetOptModelCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RemoveOptModelCommand?this.handleRemoveOptModelCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand&&this.handleRenameFnUnitCommand(e);},e.prototype.handleCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type)for(e in t.commandList){this.handleCommand(t.commandList[e]);}else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--){this.handleCommand(t.commandList[e]);}},e.prototype.handleNewOptModelCommand=function(t){if("UNDO"===t.event.type)this.createDetailView(),this.render();else{this.show();var e=t.options.optModel.optId;this.createDetailView(e),this.render(e);}},e.prototype.handleSetOptModelCommand=function(t){this.show();var e=t.options.optId;this.optModel.optId!=e&&this.createDetailView(e),this.render(e);},e.prototype.handleRemoveOptModelCommand=function(t){if("UNDO"===t.event.type){this.show();var e=t.options.optId;this.createDetailView(e),this.render(e);}else this.createDetailView(),this.render();},e.prototype.handleRenameFnUnitCommand=function(t){var e=t.options.fid,i=Studio.getEditorContainer().getActiveModelEditor().getActiveModel().getFnUnitById(e).display.label;if(this.$controls&&this.$controls.optFunctions[e]){var o=this.$controls.optFunctions[e].optSelected.prev();o.attr("title",i),o.find(".brtc-opt-function-label").text(i);}this.optModel&&this.optModel.options.objective.fid==e&&(this.renderFunctionLabelControl(),this.renderTableLabelControl());},e.prototype.executeSetOptModelCommand=function(e,i){var o=Studio.getEditorContainer().getActiveModelEditor(),n=o.getEditorInput().getProjectId(),r=o.getEditorInput().getFileId(),a=this.$dropdownList.val();if(a&&t.OptModelManager.getOptModel(n,r,a)){var s=o.getCommandManager(),l=t.OptModelManager.createSetOptModelCommand(n,r,a,e,i);s.execute(l);}},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.$modelSideBar.find(".brtc-va-tools-sidebar-contents-wrapper");},e.prototype.destroy=function(){},t.VA.Core.Tools.SideBar.OptSettingSideBar=e;}.call(this),function(t){"use strict";var e=t.Brightics;function i(t,i){e.VA.Core.Tools.SideBar.call(this,t,i);}i.prototype=Object.create(e.VA.Core.Tools.SideBar.prototype),i.prototype.constructor=i,i.prototype.createContent=function(){this.$modelSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar dataflow">   <div class="brtc-va-tools-sidebar-outline brtc-va-tools-sidebar-local-outline selected"></div>   <div class="brtc-va-tools-sidebar-outline brtc-va-tools-sidebar-global-outline"></div></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar);var t=this.$modelSideBar.find(".brtc-va-tools-sidebar-local-outline"),i=this.getEditor().getEditorInput().getProjectId(),o=this.getEditor().getModel();this.localOutline=new e.VA.Core.Views.LocalOutline({$parent:t,projectId:i,model:o,editor:this.getEditor()});},i.prototype.onModelChange=function(t){this.localOutline.refresh("all");},i.prototype.onFnUnitSelect=function(t){this.localOutline.refresh("underline",t?t.fid:void 0);},i.prototype.refresh=function(){this.localOutline.refresh("all");},i.prototype.updateStatus=function(t){this.localOutline.refresh("status",{fid:t.fid,status:t.status});},e.VA.Core.Tools.SideBar.OutlineSideBar=i;}(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){var e=this;this.$modelSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar dataflow">   <ul>       <li>Function</li>       <li>Template</li>       <li>Data</li>   </ul>   <div class="brtc-va-tools-sidebar-palettetab" />   <div class="brtc-va-tools-sidebar-librarytab"></div>   <div class="brtc-va-tools-sidebar-datatab" /></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar),this.tabControl=t.VA.Core.Widget.Factory.tabControl(this.$modelSideBar);var i=this.$modelSideBar.find(".brtc-va-tools-sidebar-palettetab");this.dataFlowPalette=new t.VA.Core.Views.Palette(i,{width:"100%",height:"100%",draggable:!0,modelType:t.VA.Implementation.DataFlow.Clazz,editor:this.getEditor()});var o=this.$modelSideBar.find(".brtc-va-tools-sidebar-librarytab");this.libraryExplorer=new t.VA.Core.Views.LibraryExplorer(o,{height:"100%",modelType:t.VA.Implementation.DataFlow.Clazz,editor:this.getEditor()});var n=this.$modelSideBar.find(".brtc-va-tools-sidebar-datatab");this.dataExplorer=new t.VA.Core.Views.DataExplorer(n,{height:"100%",editor:this.getEditor()}),this.$modelSideBar.on("selected",function(t,i){var o=i;1===o?e.libraryExplorer.activate():2===o&&e.dataExplorer.render();});},e.prototype.appendTemplate=function(t){this.libraryExplorer.appendTemplate(t);},e.prototype.udfChanged=function(t){this.dataFlowPalette.udfChanged();},e.prototype.templateChanged=function(t){this.libraryExplorer.templateChanged();},e.prototype.onActivated=function(){this.libraryExplorer.refresh(),this.dataFlowPalette.udfChanged();},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.tabControl.$tabContents.find(".brtc-va-views-palette-navigator-wrapper");},e.prototype.destroy=function(){this.dataFlowPalette.destroy(),this.libraryExplorer.destroy(),this.dataExplorer.destroy();},t.VA.Core.Tools.SideBar.PaletteSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){this.$controlSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar controlflow">   <div class="brtc-va-tools-sidebar-propertytab brtc-style-tab" /></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$controlSideBar);var e=this.$controlSideBar.find(".brtc-va-tools-sidebar-propertytab");this.controlEditorProperties=new t.VA.Implementation.ControlFlow.Views.Properties(e,{width:"100%",height:"100%"}),this.controlEditorProperties.editorChanged(this.getEditor());},e.prototype.selectionChanged=function(e){if(this.controlEditorProperties.activeEditor&&this.controlEditorProperties.activeEditor.getModel().type==t.VA.Implementation.ControlFlow.Clazz)if(e instanceof Object&&e.func)for(var i in t.VA.Implementation.ControlFlow.Functions){i==e.func&&this.controlEditorProperties.selectionChanged(e);}else void 0===e&&this.controlEditorProperties.selectionChanged();this.applyPreferenceSettings(!0);},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.$controlSideBar.find(".brtc-va-views-properties");},e.prototype.render=function(){this.controlEditorProperties.render();},t.VA.Core.Tools.SideBar.PropertiesSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){this.$realtimeSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar realtime">   <div class="brtc-va-tools-sidebar-palettetab brtc-style-tab" /></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$realtimeSideBar);var e=this.$realtimeSideBar.find(".brtc-va-tools-sidebar-palettetab");this.realtimePalette=new t.VA.Core.Views.Palette(e,{width:"100%",height:"100%",draggable:!0,modelType:"realtime"});},t.VA.Core.Tools.SideBar.RealTimePaletteSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics,e=brtc_require("KeyItems"),i={sideBarArea:"brtc-va-studio-sidebar-area",toolsSideBar:"brtc-va-tools-sidebar",styleSideBar:"brtc-style-sidebar",sSideBar:"brtc-stype-s-sidebar",header:["brtc-style-s-font-size-13","brtc-style-s-font-weight-bold","brtc-style-s-font-faminly-arial","brtc-style-margin-top-10","brtc-style-margin-bottom-10"].join(" "),selectedTableWrapper:["brtc-va-editors-sheet-controls-dataselector-contents","brtc-style-display-flex","brtc-style-flex-direction-column"].join(" "),selectedTableDataContainer:["brtc-va-editors-sheet-controls-dataselector-contents-wrapper","brtc-style-relative"].join(" "),notSelectedItemContainer:["brtc-va-editors-sheet-controls-dataselector-contents-wrapper","brtc-style-full","brtc-style-relative"].join(" "),emptyContainer:["brtc-va-editors-sheet-controls-dataselector-empty-wrapper","brtc-style-height-60px","brtc-style-padding-right-20"].join(" "),emptyContents:"brtc-va-editors-sheet-controls-dataselector-empty-contents",outTableListWrapper:"brtc-va-tools-sidebar-out-table-list-wrapper",outTableListItemWrapper:"brtc-va-tools-sidebar-out-table-list-item-wrapper",dataSelectorItem:["brtc-va-editors-sheet-controls-dataselector-item","brtc-style-flex-start","brtc-style-padding-right-20"].join(" ")};function o(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}o.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),o.prototype.constructor=o,o.prototype.createContent=function(){var t=this,e=[i.toolsSideBar,i.styleSideBar,i.sSideBar,"brtc-style-display-flex","brtc-style-flex-direction-column"].join(" "),o=crel("div",{class:i.selectedTableDataContainer});this.$selectedTableAndAddableWrapper=$(crel("div",{class:"brtc-style-relative  brtc-style-padding-right-20"},o));var n=crel("div",{class:i.notSelectedItemContainer}),r=crel("div",{class:i.selectedTableWrapper,style:"height: 47%;"},crel("div",{class:i.header},"Selected Data"),this.$selectedTableAndAddableWrapper[0]),a=crel("div",{class:i.outTableListWrapper},crel("div",{class:i.header},"Out Data List"),n);this.$modelSideBar=$(crel("div",{class:e},r,a)),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar),this.$itemContainer=$(o),this.$notSelectedItemContainer=$(n),this.$outTableContainer=$(a),this.$itemContainer.on("sortstop",function(e,i){var o=t.getSelectedTableIds();t.changeSelectedTableOrder(o);}),this.$itemContainer.sortable({axis:"y",cancel:".empty"}),this.$selectedTableAndAddableWrapper.append(this.createAddableArea()),this.$notSelectedItemContainer=$(n),this.scroll(),this.refresh();},o.prototype.scroll=function(){this.$notSelectedItemContainer.perfectScrollbar(),this.$notSelectedItemContainer.perfectScrollbar("update"),this.$selectedTableAndAddableWrapper.perfectScrollbar(),this.$selectedTableAndAddableWrapper.perfectScrollbar("update");},o.prototype.onActivated=function(){this.refresh(),this.renderNotSelectedItems();},o.prototype.onFnUnitSelect=function(t){this.renderNotSelectedItems();},o.prototype.initPreferenceTarget=function(){},o.prototype.destroy=function(){},o.prototype.attachDragEventListener=function(t){return t.draggable({helper:function helper(){var t=$(this).clone(),e=$(this).width();return t.css({"z-index":5100,width:e,height:"65px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}),t;},appendTo:"body"}),t;},o.prototype.attachDropEventListener=function(t,e){var i=this;t.droppable({accept:".brtc-style-controls-inputselector-box-wrapper.return-table",activate:function activate(t,e){$(this).find(".brtc-style-controls-dataselector-empty-fnunit").addClass("brtc-style-droppable-active");},deactivate:function deactivate(t,e){var i=$(this).find(".brtc-style-controls-dataselector-empty-fnunit");i.removeClass("brtc-style-droppable-active"),i.removeClass("brtc-style-droppable-hover");},over:function over(t,e){$(this).find(".brtc-style-controls-dataselector-empty-fnunit").addClass("brtc-style-droppable-hover");},out:function out(t,e){$(this).find(".brtc-style-controls-dataselector-empty-fnunit").removeClass("brtc-style-droppable-hover");},drop:function drop(t,o){var n=$(this).find(".brtc-style-controls-dataselector-empty-fnunit"),r=o.draggable;n.removeClass("brtc-style-droppable-active"),n.removeClass("brtc-style-droppable-hover"),"replace"===e?i.replaceSelectedTable(r,$(this)):"add"===e&&i.addSelectedTable(r);}});},o.prototype.getDropFuncTarget=function(t){var e=t.find(".brtc-style-controls-inputselector-box-wrapper");return e.length?e:t;},o.prototype.changeSelectedTableOrder=function(t){var e=this.getActiveModel(),i=t.length!==e[OUT_DATA].length;if(!i)for(var o=0;o<e[OUT_DATA].length;o++){if(t[o]!==e[OUT_DATA][o]){i=!0;break;}}if(i){var n=this.createModelOutDataUpdateCommand(e,[OUT_DATA],t);this.getEditor().getCommandManager().execute(n);}},o.prototype.createModelOutDataUpdateCommand=function(e,i,o){return new t.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand(this,{target:e,path:i,value:o,label:"Change Return Data"});},o.prototype.createModelOutDataAddCommand=function(e,i,o){var n=new t.VA.Core.CompoundCommand(this,{label:"Add Return Data"});if(e[OUT_DATA]||n.add(new t.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this,{target:e,path:[OUT_DATA],value:[]})),n.add(new t.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this,{target:e,path:i,value:o})),this.isNestedFlow()){var r=t.VA.Core.Utils.NestedFlowUtils.calcNextFnUnitOutTableSize(this.getEditor().getModel(),this.getEditor().getActiveFnUnit(),e.mid,1);n.add(this.createAdjustOutTableCommand(r));}return n;},o.prototype.createModelOutDataRemoveCommand=function(e,i){var o=new t.VA.Core.CompoundCommand(this,{label:"Remove Return Data"});if(o.add(new t.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(this,{target:e,path:i})),this.isNestedFlow()){var n=t.VA.Core.Utils.NestedFlowUtils.calcNextFnUnitOutTableSize(this.getEditor().getModel(),this.getEditor().getActiveFnUnit(),e.mid,-1);o.add(this.createAdjustOutTableCommand(n));}return o;},o.prototype.addSelectedTable=function(t){var e=t.attr("tid"),i=this.getModelOutData().length,o=this.createModelOutDataAddCommand(this.getActiveModel(),[OUT_DATA,i],e);this.getEditor().getCommandManager().execute(o);},o.prototype.removeSelectedTable=function(t,e){var i=_.indexOf(this.getModelOutData(),t),o=this.createModelOutDataRemoveCommand(this.getActiveModel(),[OUT_DATA,i]);this.getEditor().getCommandManager().execute(o);},o.prototype.replaceSelectedTable=function(t,e){var i=this.getActiveModel(),o=t.attr("tid"),n=_.indexOf(this.getModelOutData(),this.getDropFuncTarget(e).attr("tid")),r=this.createModelOutDataUpdateCommand(i,[OUT_DATA,n],o);this.getEditor().getCommandManager().execute(r),this.renderNotSelectedItems();},o.prototype.createItem=function(t,i){var o=this.FnUnitUtils.getOutputsToObject(t),n=(i=i,this.FnUnitUtils.getTypeByTableId(t,i)),r=this.FnUnitUtils.getFunc(t),a=this.FnUnitUtils.getLabel(t),s=e.create({key:o[i],tableId:i,type:n,func:r,label:a});return s.attr("tid",i),s.addClass("return-table"),s;},o.prototype.createKeyItem=function(e){var o=e.fnUnit,n=e.tableId,r=e.type,a=$(crel("div",{class:i.dataSelectorItem})),s=this.getTableItemLabel(o,n),l=t.VA.Core.Utils.WidgetUtils.createKeyItem({label:s,type:r});a.append(l),a.attr("tid",n),a.attr("fid",o.fid);var c=this.FnUnitUtils.getOutTable(o).indexOf(n);return a.attr("index",c),l.addClass("item"),a;},o.prototype.createEmptyItem=function(){return $(crel("div",{class:i.emptyContainer},crel("div",{class:i.emptyContents},"Select a function in the diagram that contains the data you want to set as return data.")));},o.prototype.getFnUnitByTableId=function(t){for(var e=this.getActiveModel().functions,i=0;i<e.length;i++){var o=e[i];if(_.indexOf(this.FnUnitUtils.getOutTable(o),t)>-1)return o;}},o.prototype.getTableItemLabel=function(t,e){return this.FnUnitUtils.getOutputsToObject(t)[e];},o.prototype.createSelectedTableElements=function(t){var e=this,i=[];return _.forEach(t,function(t){var o=e.getFnUnitByTableId(t);o&&i.push(e.createSelectedItem(o,t));}),i;},o.prototype.createSelectedItem=function(t,i){var o=this.FnUnitUtils.getOutputsToObject(t),n=(i=i,this.FnUnitUtils.getTypeByTableId(t,i)),r=this.FnUnitUtils.getFunc(t),a=this.FnUnitUtils.getLabel(t),s=e.create({key:o[i],tableId:i,type:n,func:r,label:a});return s.attr("tid",i),this.wrapSelectedItem(s);},o.prototype.createNotSelectedItem=function(t,e){var i=this.createItem(t,e).css("cursor","move");return this.wrapNotSelectedItem(i);},o.prototype.renderEmpty=function(){var t=this.createEmptyItem();this.$notSelectedItemContainer.append(t);},o.prototype.wrapSelectedItem=function(t){var e=this,i=$(crel("div",{class:"brtc-style-flex-center brtc-style-relative"})),o=$(crel("span",{class:"brtc-style-editor-content-remove-button"})),n=t.attr("tid"),r=t.attr("fid");return o.click(function(){e.removeSelectedTable(n,r),i.remove();}),i.append(t),i.append(o),this.attachDropEventListener(i,"replace"),i;},o.prototype.wrapNotSelectedItem=function(t){this.attachDragEventListener(t);var e=$(crel("div",{class:"brtc-style-flex-center brtc-style-relative",style:"padding-right: 20px"}));return e.append(t),e;},o.prototype.getActiveModel=function(){return this.getEditor().getActiveModel();},o.prototype.getActiveFnUnit=function(){return this.getEditor().getActiveFnUnitOnProp();},o.prototype.renderNotSelectedItems=function(){var t=this,e=this.getModelOutData(),i=this.getActiveFnUnit();if(this.$notSelectedItemContainer.empty(),i){var o=_.filter(this.FnUnitUtils.getOutTable(i),function(t){return-1===_.indexOf(e,t);});_.forEach(o,function(e){t.$notSelectedItemContainer.append(t.createNotSelectedItem(i,e));});}else this.renderEmpty();},o.prototype.getSelectedTableIds=function(){return _.map(this.$itemContainer.children(),function(t){return $(t).find(".brtc-style-controls-inputselector-box-wrapper").attr("tid");});},o.prototype.getModelOutData=function(){return this.getActiveModel()[OUT_DATA];},o.prototype.createAddableArea=function(){var t=$(crel("div",{class:"brtc-style-flex-center brtc-va-editors-sheet-controls-empty-fnunit"},crel("div",{class:"brtc-style-controls-dataselector-empty-fnunit"},crel("div","Drop Data"))));return t.addClass("empty"),this.attachDropEventListener(t,"add"),t;},o.prototype.onModelChange=function(){this.refresh(),this.renderNotSelectedItems();},o.prototype.refresh=function(){this.$selectedItems=this.createSelectedTableElements(this.getModelOutData()),this.$itemContainer.empty(),this.$itemContainer.append(this.$selectedItems),this.renderNotSelectedItems(),this.scroll();},o.prototype.createAdjustOutTableCommand=function(e){return t.VA.Core.Utils.NestedFlowUtils.createAdjustOutTableCommand(this,this.getEditor().getModel(),this.getEditor().getActiveFnUnit(),e);},o.prototype.isNestedFlow=function(){var t=this.getEditor().getActiveFnUnit();return t&&("if"===t.func||"forLoop"===t.func||"whileLoop"===t.func);},t.VA.Core.Tools.SideBar.ReturnTableSideBar=o;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){this.$mainControl=$('<div class="brtc-va-tools-sidebar script brtc-style-sidebar brtc-style-s-sidebar">   <ul>       <li class="tab-header-function">Function</li>       <li class="tab-header-data">Data</li>       <li class="tab-header-udf">UDF</li>   </ul>   <div class="brtc-va-core-views-palette" />   <div class="brtc-va-implementation-script-views-datasourcelist" />   <div class="brtc-va-implementation-script-views-udflist" /></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$mainControl),this.tabControl=t.VA.Core.Widget.Factory.tabControl(this.$mainControl);var e=this.$mainControl.find(".brtc-va-core-views-palette");this.functionListView=new t.VA.Implementation.Script.Views.FunctionList(e,{height:"calc(100% - 30px)",draggable:!0,modelType:t.VA.Implementation.Script.Clazz});var i=this.$mainControl.find(".brtc-va-implementation-script-views-datasourcelist");this.dataSourceListView=new t.VA.Implementation.Script.Views.DataSourceList(i,{width:"100%",height:"calc(100% - 20px)",projectId:this.getEditor().options.editorInput.data.project_id});var o=this.$mainControl.find(".brtc-va-implementation-script-views-udflist");this.udfListView=new t.VA.Implementation.Script.Views.UDFViewer(o,{width:"100%",height:"calc(100% - 30px)",modelType:t.VA.Implementation.Script.Clazz,editor:this.getEditor()});},e.prototype.selectionChanged=function(t){},e.prototype.udfChanged=function(t){this.udfListView.udfChanged();},e.prototype.onActivated=function(){this.dataSourceListView&&this.dataSourceListView.refresh(),this.udfListView&&this.udfListView.udfChanged();},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.tabControl.$tabContents.find(".brtc-va-views-palette-navigator-wrapper");},t.VA.Core.Tools.SideBar.ScriptPaletteSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(e,i){this.$mainControl=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar script">   <div class="brtc-va-tools-sidebar-script brtc-style-tab" />   </div></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$mainControl);var o=this.$mainControl.find(".brtc-va-tools-sidebar-script");this.scriptUnitListView=new t.VA.Implementation.Script.Views.ScriptUnitList(o,{width:"100%",height:"calc(100% - 30px)",editor:this.getEditor()});},e.prototype.selectionChanged=function(e){this.scriptUnitListView.activeEditor&&this.scriptUnitListView.activeEditor.getModel().type==t.VA.Implementation.Script.Clazz&&this.scriptUnitListView.selectionChanged(e);},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.$mainControl.find(".brtc-style-list-area");},t.VA.Core.Tools.SideBar.ScriptSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Tools.SideBar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Tools.SideBar.prototype),e.prototype.constructor=e,e.prototype.createContent=function(){this.$modelSideBar=$('<div class="brtc-va-tools-sidebar brtc-style-sidebar brtc-style-s-sidebar dataflow">   <div class="brtc-va-tools-sidebar-variabletab brtc-style-tab" /></div>'),this.$parent.find(".brtc-va-studio-sidebar-area").append(this.$modelSideBar),this.$variableArea=this.$modelSideBar.find(".brtc-va-tools-sidebar-variabletab"),this.dataEditorVariable=new t.VA.Core.Views.Variable(this.$variableArea,{width:"100%",height:"calc(100% - 30px)",editor:this.getEditor()});},e.prototype.initPreferenceTarget=function(){this.preferenceTarget.scroll=this.$variableArea.find(".brtc-va-tools-sidebar-variable-list");},e.prototype.destroy=function(){this.dataEditorVariable.destroy();},t.VA.Core.Tools.SideBar.VariablesSideBar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e||{},this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-modelselector"></div>'),this.$parent.append(this.$mainControl),this.$mainControl.css({width:"100%",height:"100%"}),this.createModelControl();},e.prototype.createModelControl=function(){var t=this;this.$modelArea=$('<div class="brtc-va-tools-modelselector-model"></div>'),this.$mainControl.append(this.$modelArea);var e=[];if(this.options.projectId){var i=this.getModels(this.options.projectId);_.map(i,function(i){i.getType()===(t.options.type||"data")&&e.push({text:i.getLabel(),value:i.getFileId()});});}this.createDropdownList(this.$modelArea,{placeHolder:"Report",source:e,disabled:this.options.disabled}),this.$modelArea.val(this.options.modelId);},e.prototype.createDropdownList=function(e,i){var o=this,n={theme:t.VA.Env.Theme,enableBrowserBoundsDetection:!0,animationType:"none",width:"100%",height:"25px",openDelay:0,dropDownHeight:120,disabled:this.options.disabled,displayMember:"text",valueMember:"value"};$.extend(!0,n,i),e.jqxDropDownList(n),e.change(function(){var t=$(this).val();o.options.onChange&&o.options.onChange(t);});},e.prototype.getModels=function(t){return Studio.getResourceManager().getFiles(t);},e.prototype.getModelId=function(){return this.$modelArea.val();},e.prototype.setSource=function(t){return this.$modelArea.jqxDropDownList("source",t);},t.VA.Core.Tools.ModelSelector=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e||{},this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-projectselector"></div>'),this.$parent.append(this.$mainControl),this.$mainControl.css({width:"100%",height:"100%"}),this.createProjectControl();},e.prototype.createProjectControl=function(){this.$projectArea=$('<div class="brtc-va-tools-projectselector-project"></div>'),this.$mainControl.append(this.$projectArea);var t=[],e=this.getProjects();_.map(e,function(e){t.push({text:e.getLabel(),value:e.getProjectId()});}),this.createDropdownList(this.$projectArea,{placeHolder:"Project",source:t,disabled:this.options.disabled}),this.$projectArea.val(this.options.projectId);},e.prototype.createDropdownList=function(e,i){var o=this,n={theme:t.VA.Env.Theme,enableBrowserBoundsDetection:!0,animationType:"none",width:"100%",height:"25px",openDelay:0,dropDownHeight:120,disabled:this.options.disabled,displayMember:"text",valueMember:"value"};$.extend(!0,n,i),e.jqxDropDownList(n),e.change(function(){var t=$(this).val();o.options.onChange&&o.options.onChange(t);});},e.prototype.getProjects=function(){return Studio.getResourceManager().getProjects();},e.prototype.getProjectId=function(){return this.$projectArea.val();},e.prototype.setSource=function(t){return this.$projectArea.jqxDropDownList("source",t);},t.VA.Core.Tools.ProjectSelector=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.options=e,this.parentId=t,i.bind(this)(),this.createControls();}var i=function i(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);};e.prototype.init=function(){this.renderedIndexes=[];},e.prototype.destroy=function(){this.pages&&this.pages.destroy();},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-tab"></div>'),this.$pageArea=$('<div class="brtc-va-tools-tab-pages"></div>'),this.$navigatorArea=$('<div class="brtc-va-tools-tab-navigator"></div>'),this.$parent.append(this.$mainControl),this.$mainControl.append(this.$pageArea).append(this.$navigatorArea),this.createPages(this.$pageArea),this.createNavigator(this.$navigatorArea),this.select(0);},e.prototype.createPages=function(e){this.pages=new t.VA.Core.Tools.TabPage(e,{pages:this.options.pages});},e.prototype.createNavigator=function(e){var i=this,o=_.map(this.options.pages,function(t){return t.label;});this.navigator=new t.VA.Core.Tools.TabNavigator(e,{elements:o,onClick:function onClick(t){i.select(t);}});},e.prototype.select=function(t){this.navigator.select(t),this.pages.select(t);},t.VA.Core.Tools.Tab=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.options=e,this.parentId=t,i.bind(this)(),this.createControls();}var i=function i(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);};e.prototype.init=function(){this.selectedIndex=0;},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-tab-navigator-wrapper"></div>'),this.$parent.append(this.$mainControl),this.createNavigator();},e.prototype.createNavigator=function(){var t=this;for(var e in this.options.elements){var i=$('<div class="brtc-va-tools-tab-navigator-element"></div>');i.text(this.options.elements[e]),i.attr("tabIndex",e),i.click(function(){var e=$(this).attr("tabIndex");t.select(e);}),this.$mainControl.append(i);}},e.prototype.select=function(t){this.getSelectedIndex()!=t&&(this.active(t),this.options.onClick(t));},e.prototype.active=function(t){this.setSelectedIndex(t),this.$mainControl.find(".brtc-va-tools-tab-navigator-element").removeClass("selected"),this.$mainControl.find(".brtc-va-tools-tab-navigator-element[tabIndex="+t+"]").addClass("selected");},e.prototype.getSelectedIndex=function(){return this.selectedIndex;},e.prototype.setSelectedIndex=function(t){this.selectedIndex=t;},t.VA.Core.Tools.TabNavigator=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.options=e,this.parentId=t,i.bind(this)(),this.init(),this.createControls();}var i=function i(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);};e.prototype.init=function(){this.pages=[];},e.prototype.destroy=function(){for(var t=0;t<this.pages.length;t++){this.options.pages[t].destroy(this.pages[t]);}},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-tools-tab-pages-wrapper"></div>'),this.$parent.append(this.$mainControl),this.createPages();},e.prototype.createPages=function(){for(var t in this.options.pages){var e=$('<div class="brtc-va-tools-tab-page" isRendered="false"></div>');e.attr("tabIndex",t),this.pages.push(e),this.$mainControl.append(e);}},e.prototype.select=function(t){var e=this.getRenderedIndexes();this.active(t),e.indexOf(t)<0&&this.render(t);},e.prototype.render=function(t){var e=this.options.pages[t].renderer;this.pages[t].attr("isRendered","true"),e(this.pages[t],this.options.pages[t].type);},e.prototype.active=function(t){this.$mainControl.find(".brtc-va-tools-tab-page").hide(),this.pages[t].show();},e.prototype.getRenderedIndexes=function(){for(var t=[],e=0;e<this.pages.length;e++){"true"===this.pages[e].attr("isRendered")&&t.push(e);}return t;},t.VA.Core.Tools.TabPage=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.$el=t.$el;var e=['<div class="brtc-va-version-detail-body">','   <div class="brtc-va-version-detail-row">','      <div class="brtc-va-version-detail-label">Name</div>','      <input readonly type="text" class="brtc-va-version-detail-label-input brtc-style-flex-1" maxlength="80"/>',"   </div>",'   <div class="brtc-va-version-detail-row">','      <div class="brtc-va-version-detail-label">Description</div>','      <div readonly class="brtc-va-version-detail-description-input brtc-style-flex-1">',"      </div>","   </div>",'   <div class="brtc-va-version-detail-row">','      <div class="brtc-va-version-detail-label">Tags</div>','      <input readonly type="text" class="brtc-va-version-detail-tags-input brtc-style-flex-1" maxlength="80"/>',"   </div>","</div>"].join("\n");this.$self=$(e),this.$el.append(this.$self),this._init();}e.prototype._init=function(){this.$labelInput=this.$self.find(".brtc-va-version-detail-label-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0}),this.$tagsInput=this.$self.find(".brtc-va-version-detail-tags-input").jqxInput({theme:t.VA.Env.Theme,disabled:!0}),this.$descriptionInput=this.$self.find(".brtc-va-version-detail-description-input"),this.$descriptionInput.perfectScrollbar();},e.prototype._render=function(){this.$labelInput.val(this.data.getLabel()),this.$tagsInput.val(this.data.getTags()),this.$descriptionInput.html(this.data.getDescription()),this.$descriptionInput.perfectScrollbar("update");},e.prototype.update=function(t){this.data=t,this._render();},t.VA.Core.Components.ModelVersionDetail=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Core.Utils;function e(t){this.$el=t.$el,this.onItemClick=t.onItemClick,this.$self=$('<div class="brtc-va-version-list-grid"></div>'),this.emitter=t.emitter,this.columnOptions=[{name:"Version",key:"version",type:"string",headerAlign:"center",dataAlign:"center",width:100},{name:"Name",key:"label",type:"string",headerAlign:"center",dataAlign:"left",width:"auto"},{name:"Tags",key:"tags",type:"string",headerAlign:"center",dataAlign:"left",width:"auto"},{name:"Create Time",key:"create_time",type:"date",headerAlign:"center",dataAlign:"center",width:150},{name:"Update Time",key:"update_time",type:"date",headerAlign:"center",dataAlign:"center",width:150}],this.listOptions={height:"400px"},this._initOptions(),this.baseList=this._createList(this.$self),this.$el.append(this.$self),this.data=[],this.projectId=t.projectId,this.fileId=t.fileId,this.refreshFileVersionList();}e.prototype.update=function(t){this.data=_.clone(t),this.data.sort(function(t,e){return e.compareToByVersion(t);}),this.baseList.update(_.map(this.data,function(t){return{version:t.getVersion(),label:t.getLabel(),tags:t.getTags(),update_time:t.getUpdateTime(),create_time:t.getCreateTime()};}));},e.prototype._initOptions=function(){},e.prototype._createList=function(e){return new t.VA.Controls.ControlFactory.createListControl(e,{width:"100%",height:"calc(100% - 35px)",columns:this.columnOptions,listOptions:this.listOptions}).on("cell-click",_.debounce(function(t){var e=this.data[t.index];this.openDetailVersionDialog(e.getFileId(),e.getVersionId());}.bind(this),300)).render();},e.prototype.openDetailVersionDialog=function(e,i){var o=function(t){t.edited&&this.refreshFileVersionList();}.bind(this);new t.VA.Core.Dialogs.DetailVersionDialog(this.$mainControl,{projectId:this.projectId,fileId:e,versionId:i,close:o});},e.prototype.refreshFileVersionList=function(){Studio.getResourceManager().fetchVersions(this.projectId,this.fileId).then(function(t){this.update(t);}.bind(this)).catch(this._onError.bind(this));},e.prototype._onError=function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e),this.emitter.emit("error",e);},e.prototype.getControl=function(){return this.baseList;},e.prototype.destroy=function(){this.baseList.destroy();},t.VA.Core.Components.ModelVersionList=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Components.ModelVersionList.prototype;function i(t){e.constructor.call(this,t);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype._initOptions=function(){var t=this.emitter,e=this,i=[{name:"Load",key:"load",dataRenderer:function dataRenderer(i,o){var n=$("<div>Load</div>");return n.on("mousedown",function(i){return t.emit("load",e.data[i.index]),i.stopPropagation(),!1;}),n.addClass("brtc-va-base-list-button"),n;}}];this.columnOptions=this.columnOptions.concat(i);},t.VA.Core.Components.ModelVersionListLoadable=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Components.ModelVersionList.prototype;function i(t){e.constructor.call(this,t);}i.prototype=Object.create(e),i.prototype.constructor=i,i.prototype._initOptions=function(){var t=this.emitter,e=this,i=[{name:"Select",key:"select",dataRenderer:function dataRenderer(i,o){var n=$("<div>Select</div>");return n.on("mousedown",function(i){return i.stopPropagation(),t.emit("select",e.data[i.index]),!1;}),n.addClass("brtc-va-base-list-button"),n;}}];this.columnOptions=this.columnOptions.concat(i);},i.prototype.openDetailVersionDialog=function(e,i){new t.VA.Core.Dialogs.SelectVersionDetailDialog(this.$mainControl,{projectId:this.projectId,fileId:e,versionId:i});},t.VA.Core.Components.ModelVersionListSelectable=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){this.$el=t.$el,this.onItemClick=t.onItemClick,this.$self=$('<div class="brtc-va-schedule-list-grid"></div>'),this.emitter=t.emitter,this.columnOptions=[{name:"Schedule Name",key:"scheduleName",type:"string",headerAlign:"center",dataAlign:"left",width:"auto"},{name:"Cron Expression",key:"cronExpression",type:"string",headerAlign:"center",dataAlign:"center",width:"auto"},{name:"Start Time",key:"scheduleStartTime",type:"date",headerAlign:"center",dataAlign:"center",width:150},{name:"End Time",key:"scheduleEndTime",type:"date",headerAlign:"center",dataAlign:"center",width:150},{name:"Next Time",key:"scheduleNextTime",type:"date",headerAlign:"center",dataAlign:"center",width:150},{name:"Schedule Owner",key:"scheduleOwner",type:"string",headerAlign:"center",dataAlign:"center",width:"auto"},{name:"Is Active",key:"isActive",type:"string",headerAlign:"center",dataAlign:"center",width:90}],this._initOptions(),this.baseList=this._createList(this.$self),this.$el.append(this.$self),this.data=[];}e.prototype.update=function(t){this.data=_.clone(t),this.data.sort(function(t,e){return e.create_time-t.crete_time;}),this.baseList.update(this.data);},e.prototype._initOptions=function(){},e.prototype._createList=function(e){return new t.VA.Controls.ControlFactory.createListControl(e,{width:"100%",height:"calc(100% - 35px)",columns:this.columnOptions,selectable:!0}).on("cell-click",_.debounce(function(t){this.emitter.emit("row-click",t.data);}.bind(this),300)).on("row-select",_.debounce(function(t){this.emitter.emit("row-select",t.data);}.bind(this),300)).on("row-unselect",_.debounce(function(t){this.emitter.emit("row-unselect",t.data);}.bind(this),300)).render();},e.prototype.getControl=function(){return this.baseList;},e.prototype.destroy=function(){this.baseList.destroy();},t.VA.Core.Components.ScheduleList=e;}.call(this),function(){"use strict";this.Brightics.VA.Extentsion={getActiveEditor:function getActiveEditor(){return Studio.getEditorContainer().getActiveModelEditor();},openClipboard:function openClipboard(){Studio.getClipboardManager().openClipboard();},openFunctionhelp:function openFunctionhelp(){window.open("api/va/v2/help/function?type=data","Brightics Help").blur();},openHistoryDialog:function openHistoryDialog(t){this.getActiveEditor().getModelLayoutManager().handleOpenHistoryDialog(t);},openIndexDialog:function openIndexDialog(t){this.getActiveEditor().getModelLayoutManager().handleOpenIndexDialog(t);},openScheduleManagementDialog:function openScheduleManagementDialog(){this.getActiveEditor().getModelLayoutManager().handleOpenScheduleManagementDialog();},redo:function redo(){this.getActiveEditor().getCommandManager().redo();},undo:function undo(){this.getActiveEditor().getCommandManager().undo();},setLastSelectedScale:function setLastSelectedScale(t){this.getActiveEditor().options.lastSelectedScale=t;},getLastSelectedScale:function getLastSelectedScale(){return this.getActiveEditor().options.lastSelectedScale;},changeScale:function changeScale(t){this.getActiveEditor().getModelLayoutManager().handleChangeScale(t);},changeTooltipEnabled:function changeTooltipEnabled(t){this.getActiveEditor().getModelLayoutManager().handleChangeTooltipEnabled(t);},sidebarExpandStatusChanged:function sidebarExpandStatusChanged(t,e){this.getActiveEditor().getSideBarManager().expandStatusChanged(t,e);}};}.call(this);