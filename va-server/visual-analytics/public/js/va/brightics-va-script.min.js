/*   Brightics VA Build 200907 */(function(){"use strict";this.Brightics.VA.Core.Functions.Library;this.Brightics.VA.Implementation.Script={Clazz:"script",Label:"Script",Launcher:{},Validator:{},Editors:{Diagram:{Commands:{}},Sheet:{Controls:{},Panels:{Properties:{}}}},Dialogs:{},Views:{},Tools:{Adapter:{},Manager:{}},Utils:{}},this.Brightics.VA.Implementation.Script.Functions={sql:{defaultFnUnit:{func:"sql",name:"SQL",param:{script:"",limit:"1000"},display:{label:"SQL Query Executor",layout:{width:"brtc-style-col-6","is-collapsed":!1,"script-panel":{"is-collapsed":!1,height:150},"result-panel":{"is-collapsed":!1,height:150,panel:[],layout:{}}},description:""}}},scala:{defaultFnUnit:{func:"scala",name:"Scala",param:{script:"","input-variables":[]},display:{label:"Scala Script Executor",layout:{width:"brtc-style-col-6","is-collapsed":!1,"argument-panel":{"is-collapsed":!1,height:100},"script-panel":{"is-collapsed":!1,height:150},"result-panel":{"is-collapsed":!1,height:150}},description:""}}},python:{defaultFnUnit:{func:"python",name:"Python",param:{script:"","input-variables":[],"out-table-alias":[]},display:{label:"Python Script Executor",layout:{width:"brtc-style-col-6","is-collapsed":!1,"argument-panel":{"is-collapsed":!1,height:100},"script-panel":{"is-collapsed":!1,height:150},"result-panel":{"is-collapsed":!1,height:150}},description:""}}},unknownFunction:{defaultFnUnit:{func:"unknownFunction",name:"UnknownFunction",param:{},display:{label:"Unknown Function",layout:{width:"brtc-style-col-6","is-collapsed":!1,"argument-panel":{"is-collapsed":!1,height:100},"script-panel":{"is-collapsed":!1,height:150},"result-panel":{"is-collapsed":!1,height:150}},description:""}}}};this.Brightics.VA.Implementation.Script.defaultModel=$.extend(!0,{},Brightics.VA.Default.model,{type:Brightics.VA.Implementation.Script.Clazz}),this.Brightics.VA.Implementation.Script.Constants={RESULT_SUCCESS:"SUCCESS",RESULT_FAIL:"FAIL",FUNCS:["sql","scala","python"],SIDEBAR_TEMPLATE:"template",SIDEBAR_FN_NAME:"func"};}).call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Add a unit";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){this.options.analyticsModel.addFnUnit(this.options.fnUnit,this.options.index);},e.prototype.undo=function(){this.old.fnUnit=this.options.analyticsModel.removeFnUnit(this.options.fnUnit.fid);},e.prototype.getId=function(){return"brightics.va.implementation.scriptmodel.editors.diagram.commands.newscriptunitcommand";},t.VA.Implementation.Script.Editors.Diagram.Commands.NewScriptUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Command.call(this,e,i),this.options.label=this.options.label||"Remove a unit";}e.prototype=Object.create(t.VA.Core.Command.prototype),e.prototype.constructor=e,e.prototype.execute=function(){for(var t in this.options.analyticsModel.functions){if(this.options.analyticsModel.functions[t].fid==this.options.fid){this.old.index=t;break;}}this.old.fnUnit=this.options.analyticsModel.removeFnUnit(this.options.fid);},e.prototype.undo=function(){this.options.analyticsModel.addFnUnit(this.old.fnUnit,this.old.index);},e.prototype.getId=function(){return"brightics.va.implementation.scriptmodel.editors.diagram.commands.removescriptunitcommand";},t.VA.Implementation.Script.Editors.Diagram.Commands.RemoveScriptUnitCommand=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Editor.call(this,e,i),this.registerCommandCallback(),this.initUDFChangeListener(),this.openSidebar(),this.checkInfo();}e.prototype=Object.create(t.VA.Core.Editors.Editor.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-editors-scripteditor brtc-va-editor brtc-style-editor">   <div class="brtc-style-editor-toolbar-area brtc-style-s-editor-toolbar-area" />   <div class="brtc-va-editors-side-tab-bar brtc-va-editors-left-tab-bar" />   <div class="brtc-va-editors-side-tab-bar brtc-va-editors-right-tab-bar" />   <div class="brtc-style-editor-diagram-area" />   <div class="brtc-style-editor-notification-area" /></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),t.VA.Core.Utils.WidgetUtils.putEditorRef(this.$mainControl,this),this.createToolbar(),this.createDiagramEditorPage(this.$mainControl.find(".brtc-style-editor-diagram-area")),this.createNotification(this.$mainControl.find(".brtc-style-editor-notification-area"));},e.prototype.createDiagramEditorPage=function(e){this.diagramEditorPage=new t.VA.Implementation.Script.Editors.Diagram.EditorPage(e,{width:"100%",height:"100%",editor:this,editorInput:this.getModel()});},e.prototype.createNotification=function(e){this.$notification=$('<div class="brtc-style-editor-notification">   <div class="brtc-style-editor-notification-content"/></div>'),this.$notification.jqxNotification({theme:t.VA.Env.Theme,appendContainer:e,autoOpen:!1,animationOpenDelay:800,autoClose:!0,autoCloseDelay:3e3,template:"info"});},e.prototype.notification=function(t,e){this.$notification.find(".brtc-style-editor-notification-content").html(e),this.$notification.jqxNotification({template:t}),this.$notification.jqxNotification("open");},e.prototype.setSelection=function(t){this.diagramEditorPage.setSelection(t);},e.prototype.destroy=function(){this.diagramEditorPage&&this.diagramEditorPage.destroy();},e.prototype.initUDFChangeListener=function(){var t=this;this.$mainControl.bind("udfChanged",function(e,i){t.fireUDFChanged(i);});},e.prototype.fireUDFChanged=function(t){this.modelLayoutManager.handleUDFChanged(t);},e.prototype.getMainArea=function(){return this.$mainControl;},e.prototype.getHeaderArea=function(){return this.$mainControl.find(".brtc-va-editors-scripteditor-header");},e.prototype.getLeftTabBarArea=function(){return this.$mainControl.find(".brtc-va-editors-left-tab-bar");},e.prototype.getRightTabBarArea=function(){return this.$mainControl.find(".brtc-va-editors-right-tab-bar");},e.prototype.onActivated=function(){this.getModelLayoutManager().handleOnActivate();},t.VA.Implementation.Script.Editor=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.ModelLayoutManager.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.ModelLayoutManager.prototype),e.prototype.constructor=e,e.prototype.init=function(){this.$editor=this.editor.$mainControl.find(".brtc-style-editor-scripteditorpage");},e.prototype.handleUDFChanged=function(t){this.getSideBarManager().getSideBars().scriptPalette.udfChanged(t);},e.prototype.getSplitter=function(){return this.editor.getMainArea().find(".brtc-style-editor-scripteditorpage");},e.prototype.handleOnActivate=function(){this.getSideBarManager().onActivated();},t.VA.Implementation.Script.ModelLayoutManager=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls(),this.init(),this.loadInput();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.init=function(){var t=this;this.registerDebugListener(),this.registerCommandEventListener(),this.registerGoHistoryEventListener(),this.$mainControl.bind("changeSelection",function(e,i,n){t.$mainControl.find(".brtc-va-figure-scriptunit").removeClass("status-selection"),i&&(t.$mainControl.find('.brtc-va-figure-scriptunit[fid="'+i.fid+'"]').addClass("status-selection"),t.options.editor.selection=i,n&&t.$parent.closest(".brtc-va-editor").trigger("editorSelectionChanged",[i]));});},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-style-editor-scripteditorpage brtc-style-editor-editorpage" />'),this.$parent.append(this.$mainControl),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.createFoldButton(),this.$mainControl.perfectScrollbar();},e.prototype.createFoldButton=function(){var t=$('<div class="brtc-style-editor-scripteditorpage-toolitem brtc-style-display-flex">   <div class="brtc-va-scripteditorpage-toolitem brtc-style-flex-center">       <div class="brtc-va-scripteditorpage-toolitem-label">Collapse All</div>       <div class="brtc-va-scripteditorpage-toolitem-icon brtc-style-expander-arrow"></div>   </div></div>');this.$mainControl.append(t);var e=t.find(".brtc-va-scripteditorpage-toolitem"),i=e.find(".brtc-va-scripteditorpage-toolitem-label"),n=e.find(".brtc-va-scripteditorpage-toolitem-icon"),r=this,o=!0;e.on("click",function(){o?(i.text("Expand All"),r.$mainControl.find(".brtc-va-figure-scriptunit-panelviewtoolitem").children().removeClass("selected"),r.$mainControl.find(".brtc-va-figure-scriptunit-content").children().addClass("collapsed"),n.addClass("arrow-up"),o=!1):(i.text("Collapse All"),r.$mainControl.find(".brtc-style-figure-scriptunit-panel").removeClass("collapsed"),$.makeArray(r.$mainControl.find(".brtc-va-figure-scriptunit-panelviewtoolitem").children()).forEach(function(t){$(t).jqxButton("disabled")||($(t).addClass("selected"),$(t).closest(".brtc-va-figure-scriptunit").find(".collapsed").removeClass("collapsed"));}),n.removeClass("arrow-up"),o=!0);});},e.prototype.fireCommand=function(e){return(e.constructor!==t.VA.Core.CompoundCommand||0!==e.commandList.length)&&this.options.editor.getCommandManager().execute(e);},e.prototype.registerDebugListener=function(){var t=this;this.debugListener=function(e,i){if(t.$mainControl.closest(".brtc-va-editor-wrapper").hasClass("selected")&&i.mid==t.getModel().mid)if("BEGIN-JOB"==i.eventType);else if("PENDING-JOB"==i.eventType);else if("END-JOB"==i.eventType);else if("BEGIN-PROCESS"==i.eventType);else if("END-PROCESS"==i.eventType);else if("BEGIN-UNIT"==i.eventType);else if("END-UNIT"==i.eventType){var n=i.fid,r=i.originalResponse;void 0!==t.functions[n]&&t.functions[n].refreshResult(r);}},Studio.getInstance().addDebugListener(this.debugListener);},e.prototype.registerCommandEventListener=function(){this.options.editor.addCommandListener(this.onCommand.bind(this));},e.prototype.registerGoHistoryEventListener=function(){var t=this;this.onGoHistoryCommand=function(e){t.onCommand(e);},this.options.editor.addGoHistoryListener(this.onGoHistoryCommand);},e.prototype.onCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this)for(e in t.commandList){this.onCommand(t.commandList[e]);}else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--){this.onCommand(t.commandList[e]);}},e.prototype.onCommand=function(e){e instanceof t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand&&this.handleHistoryCommand(e),e instanceof t.VA.Implementation.Script.Editors.Diagram.Commands.RemoveScriptUnitCommand&&this.handleRemoveUnit(e),e instanceof t.VA.Implementation.Script.Editors.Diagram.Commands.NewScriptUnitCommand&&this.handleNewUnit(e);},e.prototype.handleHistoryCommand=function(t){this.loadInput(t);},e.prototype.handleNewUnit=function(e){var i=e.options.fnUnit,n=e.options.fnUnit.fid;"REDO"==e.event.type||"EXECUTE"==e.event.type?(this.functions[i.fid]=new t.VA.Implementation.Script.Editors.Diagram.ScriptUnit[i.func](this.$mainControl,{unit:i,index:e.options.index}),this.$mainControl.find(".brtc-va-figure-scriptunit-box").removeClass("maximized").removeClass("minimized"),this.$mainControl.find(".brtc-va-figure-scriptunit-maximizetoolitem").removeClass("maximized"),this.setSelection(i)):(this.$mainControl.find('.brtc-va-figure-scriptunit[fid="'+n+'"]').parent().remove(),delete this.functions[i.fid]);},e.prototype.handleRemoveUnit=function(e){var i=e.old.fnUnit,n=e.options.fid;"REDO"==e.event.type||"EXECUTE"==e.event.type?(this.$mainControl.find('.brtc-va-figure-scriptunit[fid="'+n+'"]').parent().remove(),"EXECUTE"==e.event.type&&this.$mainControl.find(".brtc-va-figure-scriptunit-box.minimized").removeClass("minimized"),delete this.functions[i.fid],this.$mainControl.trigger("changeSelection",[])):(this.functions[i.fid]=new t.VA.Implementation.Script.Editors.Diagram.ScriptUnit[i.func](this.$mainControl,{unit:i,index:e.old.index}),this.$mainControl.find(".btrc-va-figure-scriptunit-box.maximized").length?this.$mainControl.find('.brtc-va-figure-scriptunit[fid="'+i.fid+'"]').addClass("minimized"):this.setSelection(i)),this.$mainControl.perfectScrollbar("update");},e.prototype.loadInput=function(e){for(var i in this.functions={},this.$mainControl.empty(),this.options.editorInput.functions){var n=this._envOptionMigrator(this.options.editorInput.functions[i]);this.functions[n.fid]=new t.VA.Implementation.Script.Editors.Diagram.ScriptUnit[n.func](this.$mainControl,{unit:n});}e&&e.options.fnUnit&&this.setSelection(e.options.fnUnit),this.$mainControl.perfectScrollbar("update");},e.prototype._envOptionMigrator=function(t){return t;},e.prototype.setSelection=function(t,e){if(t){var i=t.fid,n=this.$mainControl.find('.brtc-va-figure-scriptunit[fid="'+i+'"]');n.parent().hasClass("minimized")&&(this.$mainControl.find(".brtc-va-figure-scriptunit-box").removeClass("minimized").removeClass("maximized"),this.$mainControl.find(".brtc-va-figure-scriptunit-maximizetoolitem").removeClass("maximized"));var r=this.$mainControl.find(".brtc-va-figure-scriptunit:eq(0)"),o=n.position().top-r.position().top;this.$mainControl.animate({scrollTop:o<0?0:o},500),this.$mainControl.trigger("changeSelection",[t,e]),this.functions[i].editor.focus();}},e.prototype.fireSelectionChanged=function(t){this.options.editor.selection=t,this.$parent.closest(".brtc-va-editor").trigger("editorSelectionChanged",[t]);},e.prototype.destroy=function(){for(var t in this.functions){this.functions[t].destroy();}Studio.getInstance().removeDebugListener(this.debugListener);},e.prototype.getModel=function(){return this.getEditor().getModel();},e.prototype.getEditor=function(){return this.options.editor;},t.VA.Implementation.Script.Editors.Diagram.EditorPage=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Implementation.Script.Constants;function i(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls(),this.init();}i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.init=function(){var e=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);e.addCommandListener(this.onCommand.bind(this)),e.addGoHistoryListener(this.onCommand.bind(this));},i.prototype.destroy=function(){var e=t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl);e.removeCommandListener(this.onCommand),e.removeGoHistoryListener(this.onCommand);},i.prototype.createControls=function(){if(this.$mainControl=$('<div class="brtc-va-figure-scriptunit-box brtc-style-figure-scriptunit-box">   <div class="brtc-va-figure-scriptunit brtc-style-figure-scriptunit brtc-style-s-figure-scriptunit">   </div></div>'),void 0!==this.options.index&&this.options.index>-1){var t=this.$parent.find(".brtc-va-figure-scriptunit-box");t.eq(this.options.index).length>0?this.$mainControl.insertBefore(t.eq(this.options.index)):this.$parent.append(this.$mainControl);}else this.$parent.append(this.$mainControl);this.options.unit.fid&&this.$mainControl.find(".brtc-va-figure-scriptunit").attr("fid",this.options.unit.fid),this.options.unit.func&&this.$mainControl.find(".brtc-va-figure-scriptunit").attr("func",this.options.unit.func),this.$mainControl.addClass("brtc-style-col-12"),this.$mainControl.find(".brtc-va-figure-scriptunit").addClass("initial"),this.createHeader(this.$mainControl.find(".brtc-va-figure-scriptunit")),this.createContent(this.$mainControl.find(".brtc-va-figure-scriptunit"));var e=this;this.$mainControl.find(".brtc-va-figure-scriptunit").on("click",function(){e.$parent.trigger("changeSelection",[e.options.unit,!0]);}),this.resizeEditor();},i.prototype.createHeader=function(t){this.$unitHeader=$(' <div class="brtc-va-figure-scriptunit-header brtc-style-figure-scriptunit-header brtc-style-s-figure-scriptunit-header">   <div class="brtc-va-figure-scriptunit-type brtc-style-figure-scriptunit-type brtc-style-s-figure-scriptunit-type"></div></div>'),t.append(this.$unitHeader),this.options.unit.name&&this.$unitHeader.find(".brtc-va-figure-scriptunit-type").text(this.options.unit.name),this.createScriptLabel(this.$unitHeader),this.createHeaderToolbar(this.$unitHeader);},i.prototype.createScriptLabel=function(e){var i=this;this.$scriptLabel=$('<div class="brtc-va-figure-scriptunit-label brtc-style-figure-scriptunit-label brtc-style-s-figure-scriptunit-label"></div>');var n=$('<div class="brtc-va-figure-scriptunit-label-input-wrapper brtc-style-figure-scriptunit-label-input">   <input type="text" class="brtc-va-figure-scriptunit-label-input" maxlength="80" valid-type="type2"/></div>');e.append(this.$scriptLabel),e.append(n),this.$scriptLabelInput=n.find(".brtc-va-figure-scriptunit-label-input").jqxInput({theme:t.VA.Env.Theme,height:"25px"}),this.$scriptLabelInput.hide(),t.VA.Core.Utils.InputValidator.appendValidationCondition(this.$scriptLabelInput),this.$scriptLabel.text(this.options.unit.display.label),this.$scriptLabel.attr("title",this.options.unit.display.label),this.$scriptLabelInput.val(this.options.unit.display.label),this.$scriptLabelInput.attr("title",this.options.unit.display.label),this.$scriptLabel.mouseover(function(t){$(this).addClass("brtc-style-label-edit-mode");}),this.$scriptLabel.mouseout(function(t){$(this).removeClass("brtc-style-label-edit-mode");}),this.$scriptLabel.click(function(t){i.$scriptLabelInput.show(),i.$scriptLabelInput.focus(),i.$scriptLabel.hide();}),i.$scriptLabelInput.on("blur",function(e){if(""!==e.target.value.trim())$(e.target).removeClass("brtc-style-validation-error"),i.options.unit.display.label!=e.target.value&&i.doEditDescriptionFunction(i.options.unit.fid,e.target.value,i.options.unit.display.description),i.$scriptLabel.text(e.target.value),i.$scriptLabel.attr("title",e.target.value),i.$scriptLabelInput.hide(),i.$scriptLabel.show();else{t.VA.Core.Utils.WidgetUtils.openErrorDialog("Name is empty.",function(){$(e.target).is(":focus")||($(e.target).focus(),$(e.target).addClass("brtc-style-validation-error"));});}});},i.prototype.createHeaderToolbar=function(t){this.$unitLeftToolbar=$('<div class="brtc-va-figure-scriptunit-unitlefttoolbar brtc-style-figure-scriptunit-toolbar grow"></div>'),this.$unitRightToolbar=$('<div class="brtc-va-figure-scriptunit-unitrighttoolbar brtc-style-figure-scriptunit-toolbar"></div>'),t.append(this.$unitLeftToolbar),t.append(this.$unitRightToolbar),this.createDeleteToolItem(this.$unitRightToolbar),this.createMaximizeToolItem(this.$unitRightToolbar),this.createHideResultToolitem(this.$unitLeftToolbar),this.createHideScriptToolitem(this.$unitLeftToolbar),this.createPanelViewToolitem(this.$unitLeftToolbar),this.createAdjustWidthToolItem(this.$unitLeftToolbar),this.createItemSplitter(this.$unitLeftToolbar),this.createRunToolItem(this.$unitLeftToolbar),this.createRowLimitInput(this.$unitLeftToolbar),this.createExportToUDFToolItem(this.$unitLeftToolbar),this.createEditDescriptionToolItem(this.$unitLeftToolbar);},i.prototype.createDeleteToolItem=function(t){var e=this;this.$deleteToolItem=$('<div class="brtc-va-figure-scriptunit-deletetoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Delete" item-type="delete"></div>'),t.append(this.$deleteToolItem),this.$deleteToolItem.on("click",function(){e.doRemoveUnit();});},i.prototype.doRemoveUnit=function(){var e={fid:this.options.unit.fid},i=new t.VA.Implementation.Script.Editors.Diagram.Commands.RemoveScriptUnitCommand(this,e);this.executeCommand(i);},i.prototype.createMaximizeToolItem=function(t){var e=this;this.$maximizeToolItem=$('<div class="brtc-va-figure-scriptunit-maximizetoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Maximize/Minimize" item-type="maximize"></div>'),t.append(this.$maximizeToolItem),this.$maximizeToolItem.on("click",function(){if(e.$parent.find(".brtc-va-figure-scriptunit-box").removeClass("minimized"),e.$maximizeToolItem.hasClass("maximized")){e.$mainControl.removeClass("maximized"),e.$maximizeToolItem.removeClass("maximized"),e.editor&&e.editor.setOptions({maxLines:30});var t=$(this).closest(".brtc-va-figure-scriptunit-box").position().top;$(this).closest(".brtc-style-editor-scripteditorpage").scrollTop(t);}else e.$parent.find(".brtc-va-figure-scriptunit-box").addClass("minimized"),e.$mainControl.removeClass("minimized"),e.$mainControl.addClass("maximized"),e.$maximizeToolItem.addClass("maximized"),e.editor&&e.editor.setOptions({maxLines:0});e.$parent.perfectScrollbar("update"),e.$resultText&&e.$resultText.perfectScrollbar("update"),$(window).trigger("resize"),e.editor&&e.editor.resize();});},i.prototype.createAdjustWidthToolItem=function(t){var e=this;this.$widthToolItem=$('<div class="brtc-va-figure-scriptunit-widthtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Adjust Width" item-type="width">   <div class="brtc-va-figure-scriptunit-widthtext brtc-style-figure-scriptunit-widthtext brtc-style-s-figure-scriptunit-widthtext"></div></div>'),t.append(this.$widthToolItem);var i=this.options.unit.display.layout.width.replace("brtc-style-col-","");this.$widthToolItem.find(".brtc-va-figure-scriptunit-widthtext").text(i),this.$widthToolItem.on("click",function(){event.stopPropagation(),e.$unitHeader.find(".brtc-va-figure-scriptunit-widthpopover").length?$(window).click():($(window).click(),e.createAdjustWidthPopover());});},i.prototype.createAdjustWidthPopover=function(){var e=this;this.$widthPopover=$('<div class = "brtc-va-figure-scriptunit-widthpopover brtc-style-figure-scriptunit-widthpopover brtc-style-s-figure-scriptunit-widthpopover"></div>'),this.$unitLeftToolbar.append(this.$widthPopover);var i=this.$widthToolItem.position();this.$widthPopover.css("top",i.top+25+"px"),this.$widthPopover.css("left",i.left-240+"px"),this.$widthSlider=$('<div class ="brtc-va-figure-scriptunit-widthslider brtc-style-figure-scriptunit-widthslider"></div>'),this.$widthPopover.append(this.$widthSlider),this.$widthSlider.jqxSlider({showTickLabels:!0,ticksPosition:"top",ticksFrequency:2,tooltip:!0,mode:"fixed",width:290,height:60,min:4,max:12,theme:t.VA.Env.Theme}),this.$widthSlider.jqxSlider("setValue",this.options.unit.display.layout.width.replace("brtc-style-col-","")),$(window).on("click",function t(){var i="brtc-style-col-"+e.$widthSlider.jqxSlider("val");e.$widthSlider.jqxSlider("destroy");i!=e.options.unit.display.layout.width&&e.doEditUnitDisplayFunction("unit","width","Edit Unit Width",i);e.$widthPopover.remove();$(".jqx-tooltip").remove();$(window).off("click",t);});},i.prototype.createHideResultToolitem=function(t){var e=this;this.$hideResultToolitem=$('<div class="brtc-va-figure-scriptunit-foldresulttoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Hide Result" item-type="collapse"><div>Result</div></div>'),t.prepend(this.$hideResultToolitem),this.$hideResultToolitem.on("click",function(){var t,i;e.$hideResultToolitem.hasClass("collapsed")?(t=!1,i="Hide Result Panel"):(t=!0,i="Show Result Panel"),e.doEditUnitDisplayFunction("result-panel","is-collapsed",i,t);});},i.prototype.createHideScriptToolitem=function(t){var e=this;this.$hideScriptToolitem=$('<div class="brtc-va-figure-scriptunit-foldscripttoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Hide Script" item-type="collapse"><div>Script</div></div>'),t.append(this.$hideScriptToolitem),this.$hideScriptToolitem.on("click",function(){var t,i;e.$hideScriptToolitem.hasClass("collapsed")?(t=!1,i="Show Script Panel"):(t=!0,i="Hide Script Panel"),e.doEditUnitDisplayFunction("script-panel","is-collapsed",i,t);});},i.prototype.createPanelViewToolitem=function(t){var e=this,i=$('<div class="brtc-va-figure-scriptunit-panelviewtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" item-type="view"></div>');t.append(i),this.$viewContextBtnScript=this.createPanelViewContextButton(!1,"Script",function(){e.toggleCollapsedClass(e.$scriptPanel);}),this.$viewContextBtnResult=this.createPanelViewContextButton(!0,"Result",function(){e.toggleCollapsedClass(e.$resultPanel);},{disabled:!0}),i.append(this.$viewContextBtnScript),i.append(this.$viewContextBtnResult);},i.prototype.toggleCollapsedClass=function(t){t.toggleClass("collapsed");},i.prototype.createPanelViewContextButton=function(e,i,n,r){var o=$('<button type="button" class="brtc-va-figure-scriptunit-button brtc-style-figure-scriptunit-button selected" title="'+i+'">'+i+"</button>");return o.jqxButton($.extend({theme:t.VA.Env.Theme,width:"80px"},r)),e&&o.removeClass("selected"),o.click(function(){o.hasClass("selected")?o.removeClass("selected"):o.addClass("selected"),n(),$(window).trigger("resize");}),$.extend({},o);},i.prototype.doEditPanelViewFunction=function(t,e){},i.prototype.createItemSplitter=function(t){var e=$('<div class="brtc-va-figure-scriptunit-itemsplitter brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="" item-type="splitter"></div>');t.append(e);},i.prototype.createRunToolItem=function(e){this.$runToolItem=$('<div class="brtc-va-figure-scriptunit-runtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Run" item-type="run"></div>'),e.append(this.$runToolItem);var i=this;this.$runToolItem.on("click",function(){Studio.getJobExecutor().launchUnit(i.options.unit,{},{},{catch:function _catch(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);}});});},i.prototype.createExportToUDFToolItem=function(e){this.$saveToUDFToolItem=$('<div class="brtc-va-figure-scriptunit-export-to-udf brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Save To UDF" item-type="saveToUDF"><button type="button" class="brtc-va-figure-scriptunit-button">Save as UDF<div class="brtc-va-figure-scriptunit-hidden-form-totoolkit"><form class="toolkitscriptform"><input type="hidden" name="type"/><input type="hidden" name="content" /></form></div></div>'),e.append(this.$saveToUDFToolItem),this.$saveToUDFToolItem.find(".brtc-va-figure-scriptunit-button").jqxButton({theme:t.VA.Env.Theme,width:100});var i=this;this.$saveToUDFToolItem.on("click",function(){var t=window.location.origin+"/toolkit/udf-generator",e={type:i.options.unit.func,content:i.editor.getValue()};window.open(t,"Brightics ToolKit");var n=this.getElementsByClassName("toolkitscriptform")[0];n.action=t,n.method="POST",n.target="Brightics ToolKit",n.type.value=e.type,n.content.value=e.content,n.submit();});},i.prototype.getInputVariables=function(){var t=[],e=this.options.unit.param["input-variables"]||[];for(var i in e){var n=e[i][0],r=e[i][1];t.push({param_name:n,arg_type:r,description:""});}return t;},i.prototype.createRowLimitInput=function(e){var i=this;this.$rowLimit=$('<div class="brtc-va-figure-scriptunit-rowlimit brtc-style-figure-scriptunit-rowlimit brtc-style-s-figure-scriptunit-rowlimit" title="Row Limit" item-type="rowlimit">   <div>Select</div>    <div class="brtc-va-figure-scriptunit-rowlimit-input brtc-style-figure-scriptunit-rowlimit-input"></div>    <div>Rows</div></div>'),e.append(this.$rowLimit);this.$rowLimitInput=new t.VA.Core.Editors.Sheet.Controls.NumericInput(this.$rowLimit.find(".brtc-va-figure-scriptunit-rowlimit-input"),{numberType:"int",minus:!1,min:0,max:1e4}),this.$rowLimitInput.setValue(this.options.unit.param.limit||1e3),this.$rowLimitInput.onChange(function(t){t<1e3?i.$rowLimitInput.setValue(i.options.unit.param.limit):t!=i.options.unit.param.limit&&i.doEditRowLimitFunction();});},i.prototype.doEditRowLimitFunction=function(){var e=""+this.$rowLimitInput.getValue(),i={label:"Edit Row Limit",fnUnit:this.options.unit,ref:{param:{limit:e}}},n=new t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this,i);this.executeCommand(n);},i.prototype.createEditDescriptionToolItem=function(e){this.$editToolItem=$('<div class="brtc-va-figure-scriptunit-edittoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Edit" item-type="edit"></div>'),e.append(this.$editToolItem);var i=this;this.$editToolItem.on("click",function(){var e={title:"Edit Description",label:i.options.unit.display.label||"",description:i.options.unit.display.description||"",close:function close(t){if(t.OK){var e=t.description;i.options.unit.display.label==t.label&&i.options.unit.display.description==e||i.doEditDescriptionFunction(i.options.unit.fid,t.label,e);}}};new t.VA.Core.Dialogs.EditResourceDialog(i.$mainControl,e);});},i.prototype.doEditDescriptionFunction=function(e,i,n){var r=new t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this,{fid:e,name:i,label:"Rename Script",description:n});this.executeCommand(r);},i.prototype.createContent=function(t){this.$content=$('<div class="brtc-va-figure-scriptunit-content brtc-style-figure-scriptunit-content brtc-style-s-figure-scriptunit-content"></div>'),t.append(this.$content),this.createScriptPanel(this.$content),this.createResultPanel(this.$content),this.setPanelCollapsed(!1,!0),this.resizeEditor();},i.prototype.createScriptPanel=function(t){this.$scriptPanel=$('<div class="brtc-va-figure-scriptunit-scriptpanel brtc-style-figure-scriptunit-panel brtc-style-s-figure-scriptunit-panel" panel-type="script-panel"></div>'),t.append(this.$scriptPanel),this.createScriptPanelContent(this.$scriptPanel);},i.prototype.createScriptPanelContent=function(i){var n=this;this.$scriptPanelContent=$('<div class="brtc-va-figure-scriptunit-scriptpanel-content brtc-style-figure-scriptunit-panel-content brtc-style-s-figure-scriptunit-panel-content"></div>'),this.$scriptPanelContent.addClass("brtc-style-height-full"),this.$scriptPanelContent.addClass("brtc-style-min-height-140"),i.append(this.$scriptPanelContent),void 0!==this.options.unit.param.script&&this.$scriptPanelContent.text(this.options.unit.param.script),this.editor=ace.edit(this.$scriptPanelContent[0]),this.editor.session.setMode("ace/mode/"+this.options.unit.func),this.editor.setTheme("ace/theme/eclipse"),this.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,useSoftTabs:!1,enableLiveAutocompletion:!0,minLines:10,maxLines:30}),this.editor.setShowPrintMargin(!1),this.editor.$blockScrolling=1/0,this.editor.commands.addCommand({name:"runScript",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function exec(t){0===$(".brtc-va-dialogs-launch-progress-contents").length&&(n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction(),n.$runToolItem.trigger("click"));}}),this.editor.commands.addCommand({name:"runAllScript",bindKey:{win:"Ctrl-Shift-Enter",mac:"Command-Shift-Enter"},exec:function exec(t){if(0===$(".brtc-va-dialogs-launch-progress-contents").length){n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction();var e=Studio.getEditorContainer().getActiveEditor().getModel();Studio.getJobExecutor().launchModel(e);}}}),this.editor.commands.addCommand({name:"addScript",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:function exec(i){var r=i.getCursorPosition(),o=i.session.getLine(r.row).substring(0,r.column),s=o.match(/%[a-zA-Z]+%/g);if(s){var a=s[s.length-1];if(o.lastIndexOf(a,r.column-a.length)==r.column-a.length){var l=a.split("%")[1];if(e.FUNCS.includes(l)){var c={start:{row:r.row,column:o.lastIndexOf(a,r.column-a.length)},end:{row:r.row,column:r.column}};i.session.remove(c);var p=t.VA.Core.Utils.WidgetUtils.getEditorRef(n.$mainControl),u=p.getModel().newFnUnit(l),d=p.getModel().functions.length,h=n.$parent.find(".brtc-va-figure-scriptunit.status-selection");h.length>0&&(d=h.parent().index());var m=new t.VA.Implementation.Script.Editors.Diagram.Commands.NewScriptUnitCommand(this,{fnUnit:u,index:d+1});n.executeCommand(m);}}}}}),this.editor.on("blur",function(){n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction();}),this.$scriptPanelContent.droppable({drop:this.doDropEventOnScriptPanelContent.bind(this)});},i.prototype.doDropEventOnScriptPanelContent=function(t,e){},i.prototype.doEditScriptFunction=function(){var e=this.editor.getValue(),i={label:"Edit Script",fnUnit:this.options.unit,ref:{param:{script:e}}},n=new t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand(this,i);this.executeCommand(n);},i.prototype.createResultPanel=function(t){this.$resultPanel=$('<div class="brtc-va-figure-scriptunit-resultpanel brtc-style-figure-scriptunit-panel brtc-style-s-figure-scriptunit-panel" panel-type="result-panel"></div>'),t.append(this.$resultPanel),this.createResultPanelHeader(this.$resultPanel),this.createResultPanelContent(this.$resultPanel);},i.prototype.createResultPanelHeader=function(t){},i.prototype.createResultStatusbar=function(t){this.$resultStatusbar=$('<div class="brtc-va-figure-scriptunit-resultstatusbar brtc-style-figure-scriptunit-panel-statusbar brtc-style-s-figure-scriptunit-panel-statusbar"></div>'),t.append(this.$resultStatusbar),this.$runStatus=$('<div class="brtc-va-figure-scriptunit-runstatus brtc-style-figure-scriptunit-panel-statusbar-status brtc-style-s-figure-scriptunit-panel-statusbar-status"></div>'),this.$runResultLabel=$('<div class="brtc-va-figure-scriptunit-runresultlabel brtc-style-figure-scriptunit-panel-statusbar-runresultlabel"></div>'),this.$resultMessage=$('<div class="brtc-va-figure-scriptunit-resultmessage brtc-style-figure-scriptunit-panel-statusbar-message"></div>'),this.$executionTime=$('<div class="brtc-va-figure-scriptunit-executiontime brtc-style-figure-scriptunit-panel-statusbar-executiontime brtc-style-s-figure-scriptunit-panel-statusbar-executiontime">Execution time : <div class="brtc-va-figure-scriptunit-executiontimelabel brtc-style-figure-scriptunit-executiontimelabel"></div> ms</div>'),this.$runStatus.append(this.$runResultLabel),this.$runStatus.append(this.$resultMessage),this.$resultStatusbar.append(this.$runStatus),this.$resultStatusbar.append(this.$executionTime);},i.prototype.onSetDataWorksheetInform=function(e){var i=new t.VA.Core.CompoundCommand(this,{id:"brightics.va.editors.diagram.commands.setdataworksheetimformation"});i.add(this.createSetDataWorksheetPanelCommand(e.panel)),i.add(this.createSetDataWorksheetLayoutCommand(e.layout)),this.executeCommand(i);},i.prototype.createSetDataWorksheetPanelCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetPanelCommand(this,{panel:this.options.unit.display.layout["result-panel"].panel,newPanel:e});},i.prototype.createSetDataWorksheetLayoutCommand=function(e){return new t.VA.Core.Editors.Diagram.Commands.SetDataWorksheetLayoutCommand(this,{layout:this.options.unit.display.layout["result-panel"].layout,newLayout:e});},i.prototype.createResultPanelContent=function(t){var e=this;this.$resultPanelContent=$('<div class="brtc-va-figure-scriptunit-resultpanel-content brtc-style-figure-scriptunit-panel-content brtc-style-s-figure-scriptunit-panel-content"></div>'),t.append(this.$resultPanelContent),this.createResultContents(this.$resultPanelContent),this.options.unit.display.layout["result-panel"].height&&this.$resultPanelContent.height(this.options.unit.display.layout["result-panel"].height),this.$resultPanelContent.resizable({minHeight:150,handles:"s, se",resize:function resize(){e.$resultPanelContent.css("width","100%"),e.$resultText&&e.$resultText.perfectScrollbar("update");},stop:function stop(){$(this).height()!=e.options.unit.display.layout["result-panel"].height&&e.doEditUnitDisplayFunction("result-panel","height","Adjust Panel Height",e.$resultPanelContent.height());}});},i.prototype.doEditUnitDisplayFunction=function(e,i,n,r){var o={label:n,fnUnit:this.options.unit,ref:{display:$.extend(!0,{},this.options.unit.display)}};"unit"===e?o.ref.display.layout[i]=r:o.ref.display.layout[e][i]=r;var s=new t.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand(this,o);this.executeCommand(s);},i.prototype.refreshResult=function(t){},i.prototype.createResultContents=function(t){},i.prototype.createResultText=function(t){this.$resultText=$('<div class="brtc-va-figure-scriptunit-resultpanel-resulttext brtc-style-figure-scriptunit-panel-content-resulttext brtc-style-s-figure-scriptunit-panel-content-resulttext"></div>'),t.append(this.$resultText),this.$resultText.perfectScrollbar();},i.prototype.printResultText=function(t){this.$resultText.text(t);},i.prototype.onCommand=function(e){e instanceof t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand||(e instanceof t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand&&this.onRenameFnUnitCommand(e),e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitParameterValueCommand&&this.onSetFnUnitParameterValueCommand(e),e instanceof t.VA.Core.Editors.Diagram.Commands.SetFnUnitCommand&&this.onSetFnUnitCommand(e),e instanceof t.VA.Core.CompoundCommand&&this.onCompoundCommand(e));},i.prototype.onCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type&&t.event.source!==this)for(e in t.commandList){this.onCommand(t.commandList[e]);}else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--){this.onCommand(t.commandList[e]);}},i.prototype.onRenameFnUnitCommand=function(t){var e;this.$mainControl.find(".brtc-va-figure-scriptunit").attr("fid")===t.options.fid&&("REDO"==t.event.type||"EXECUTE"==t.event.type?e=t.options.name:"UNDO"==t.event.type&&(e=t.old.name),this.$scriptLabel.text(e),this.$scriptLabel.attr("title",this.options.unit.display.label));},i.prototype.onSetFnUnitParameterValueCommand=function(t){var e,i;this.$mainControl.find(".brtc-va-figure-scriptunit").attr("fid")===t.options.fnUnit.fid&&("REDO"==t.event.type||"EXECUTE"==t.event.type?(e=t.options.fnUnit.param.script,i=t.options.fnUnit.param.limit):"UNDO"==t.event.type&&(e=t.old.param.script,i=t.old.param.limit),void 0!==e&&(this.editor.setValue(e),this.editor.navigateFileEnd()),void 0!==i&&this.$rowLimitInput.setValue(i));},i.prototype.onSetFnUnitCommand=function(t){var e;this.$mainControl.find(".brtc-va-figure-scriptunit").attr("fid")===t.options.fnUnit.fid&&("REDO"==t.event.type||"EXECUTE"==t.event.type?e=t.options.fnUnit.display.layout:"UNDO"==t.event.type&&(e=t.old.display.layout),void 0!==e&&this.setPanelHeight(e["script-panel"].height,e["result-panel"].height));},i.prototype._createResultMessage=function(e){var i=[];if(e.errorInfo)for(var n in e.errorInfo){e.errorInfo[n].errorCode?i.push(t.VA.Core.Utils.MessageUtils.getMessage(e.errorInfo[n].errorCode,e.errorInfo[n].parameter)):e.errorInfo[n].message&&i.push(e.errorInfo[n].message);}else e.message&&i.push(e.message);return i.join(", ");},i.prototype.setUnitWidth=function(t){for(var e=3;e<=12;e++){this.$mainControl.removeClass("brtc-style-col-"+e);}this.$mainControl.addClass(t),this.$widthToolItem.find(".brtc-va-figure-scriptunit-widthtext").text(t.replace("brtc-style-col-",""));},i.prototype.setPanelHeight=function(t,e){this.$resultPanelContent&&this.$resultPanelContent.height(e),this.$resultText&&this.$resultText.perfectScrollbar("update"),$(window).trigger("resize");},i.prototype.setPanelCollapsed=function(t,e){t?this.$scriptPanel.addClass("collapsed"):(this.$scriptPanel.removeClass("collapsed"),this.editor.resize()),this.$mainControl.find(".brtc-va-figure-scriptunit").hasClass("initial")||(e?this.$resultPanel.addClass("collapsed"):this.$resultPanel.removeClass("collapsed")),this.$parent.perfectScrollbar("update");},i.prototype.executeCommand=function(e){return(e.constructor!==t.VA.Core.CompoundCommand||0!==e.commandList.length)&&t.VA.Core.Utils.WidgetUtils.getEditorRef(this.$mainControl).getCommandManager().execute(e);},i.prototype.resizeEditor=function(){$(this.editor.container).height("100%");},t.VA.Implementation.Script.Editors.Diagram.ScriptUnit=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Implementation.Script.Constants;function i(e,i){t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.call(this,e,i);}i.prototype=Object.create(t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.prototype),i.prototype.constructor=i,i.prototype.createPanelViewToolitem=function(t){var e=this,i=$('<div class="brtc-va-figure-scriptunit-panelviewtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Panel View" item-type="view"></div>');t.append(i),this.$viewContextBtnScript=this.createPanelViewContextButton(!1,"Script",function(){e.toggleCollapsedClass(e.$scriptPanel);}),this.$viewContextBtnResult=this.createPanelViewContextButton(!0,"Result",function(){e.toggleCollapsedClass(e.$resultPanel);},{disabled:!0}),i.append(this.$viewContextBtnScript),i.append(this.$viewContextBtnResult);},i.prototype.createRunToolItem=function(e){this.$runToolItem=$('<div class="brtc-va-figure-scriptunit-runtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Run" item-type="run"></div>'),e.append(this.$runToolItem);var i=this;this.$runToolItem.on("click",function(){var e=$.extend({},i.options.unit);delete e.param["input-variables"];Studio.getJobExecutor().launchUnit(e,{},{},{catch:function _catch(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);}});});},i.prototype.createContent=function(t){this.$content=$('<div class="brtc-va-figure-scriptunit-content brtc-style-figure-scriptunit-content brtc-style-s-figure-scriptunit-content"></div>'),t.append(this.$content),this.createScriptPanel(this.$content),this.createResultPanel(this.$content),this.setPanelCollapsed(!1,!1,!0);},i.prototype.createScriptPanelContent=function(i){var n=this;this.$scriptPanelContent=$('<div class="brtc-va-figure-scriptunit-scriptpanel-content brtc-style-figure-scriptunit-panel-content brtc-style-s-figure-scriptunit-panel-content"></div>'),i.append(this.$scriptPanelContent),void 0!==this.options.unit.param.script&&this.$scriptPanelContent.text(this.options.unit.param.script),this.editor=ace.edit(this.$scriptPanelContent[0]),this.editor.session.setMode("ace/mode/"+this.options.unit.func),this.editor.setTheme("ace/theme/eclipse"),this.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,useSoftTabs:!1,enableLiveAutocompletion:!0,minLines:10,maxLines:30}),this.editor.setShowPrintMargin(!1),this.editor.$blockScrolling=1/0,this.editor.commands.addCommand({name:"runScript",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function exec(t){0===$(".brtc-va-dialogs-launch-progress-contents").length&&(n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction(),n.$runToolItem.trigger("click"));}}),this.editor.commands.addCommand({name:"runAllScript",bindKey:{win:"Ctrl-Shift-Enter",mac:"Command-Shift-Enter"},exec:function exec(t){if(0===$(".brtc-va-dialogs-launch-progress-contents").length){n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction();var e=Studio.getEditorContainer().getActiveEditor().getModel();Studio.getJobExecutor().launchModel(e);}}}),this.editor.commands.addCommand({name:"addScript",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:function exec(i){var r=i.getCursorPosition(),o=i.session.getLine(r.row).substring(0,r.column),s=o.match(/%[a-zA-Z]+%/g);if(s){var a=s[s.length-1];if(o.lastIndexOf(a,r.column-a.length)==r.column-a.length){var l=a.split("%")[1];if(e.FUNCS.includes(l)){var c={start:{row:r.row,column:o.lastIndexOf(a,r.column-a.length)},end:{row:r.row,column:r.column}};i.session.remove(c);var p=t.VA.Core.Utils.WidgetUtils.getEditorRef(n.$mainControl),u=p.getModel().newFnUnit(l),d=p.getModel().functions.length,h=n.$parent.find(".brtc-va-figure-scriptunit.status-selection");h.length>0&&(d=h.parent().index());var m=new t.VA.Implementation.Script.Editors.Diagram.Commands.NewScriptUnitCommand(this,{fnUnit:u,index:d+1});n.executeCommand(m);}}}}}),this.editor.on("blur",function(){n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction();});},i.prototype.refreshResult=function(t){this.$mainControl.find(".brtc-va-figure-scriptunit").removeClass("initial"),this.$resultPanel.removeClass("collapsed"),this.$runStatus.removeClass("success").removeClass("fail"),this.$runResultLabel.text(t.status),this.$viewContextBtnResult.jqxButton({disabled:!1}),this.$viewContextBtnResult.addClass("selected"),this.setPanelCollapsed(!1,!this.$viewContextBtnScript.hasClass("selected"),!1);var i=this._createResultMessage(t);t.status===e.RESULT_FAIL?this.$runStatus.addClass("fail"):this.$runStatus.addClass("success"),this.$resultMessage.text(""),this.$executionTime.find(".brtc-va-figure-scriptunit-executiontimelabel").text(t.duration),this.printResultText(i);},i.prototype.onSetFnUnitParameterValueCommand=function(t){var e,i;this.$mainControl.find(".brtc-va-figure-scriptunit").attr("fid")===t.options.fnUnit.fid&&("REDO"==t.event.type||"EXECUTE"==t.event.type?(e=t.options.fnUnit.param.script,i=t.options.fnUnit.param.limit):"UNDO"==t.event.type&&(e=t.old.param.script,i=t.old.param.limit),void 0!==e&&(this.editor.setValue(e),this.editor.navigateFileEnd()),void 0!==i&&this.$rowLimitInput.setValue(i));},i.prototype.createResultContents=function(t){this.$resultText=$('<div class="brtc-va-figure-scriptunit-resultpanel-resulttext brtc-style-figure-scriptunit-panel-content-resulttext brtc-style-s-figure-scriptunit-panel-content-resulttext"></div>'),t.append(this.$resultText),this.$resultText.perfectScrollbar();},i.prototype.createResultPanelHeader=function(t){this.$resultPanelHeader=$('<div class="brtc-va-figure-scriptunit-resultpanel-header brtc-style-figure-scriptunit-panel-header brtc-style-s-figure-scriptunit-panel-header"></div>'),t.append(this.$resultPanelHeader),this.createResultStatusbar(this.$resultPanelHeader);},i.prototype.onSetFnUnitCommand=function(t){var e;this.$mainControl.find(".brtc-va-figure-scriptunit").attr("fid")===t.options.fnUnit.fid&&("REDO"==t.event.type||"EXECUTE"==t.event.type?e=t.options.fnUnit.display.layout:"UNDO"==t.event.type&&(e=t.old.display.layout),void 0!==e&&this.setPanelHeight(void 0,e["script-panel"].height,e["result-panel"].height));},i.prototype.setPanelHeight=function(t,e,i){this.$resultPanelContent&&this.$resultPanelContent.height(i),this.$resultText&&this.$resultText.perfectScrollbar("update"),$(window).trigger("resize");},i.prototype.setPanelCollapsed=function(t,e,i){e?(this.$scriptPanel.addClass("collapsed"),this.$rowLimit.addClass("collapsed")):(this.$scriptPanel.removeClass("collapsed"),this.$rowLimit.removeClass("collapsed"),this.editor.resize()),this.$mainControl.find(".brtc-va-figure-scriptunit").hasClass("initial")||(i?this.$resultPanel.addClass("collapsed"):this.$resultPanel.removeClass("collapsed")),this.$parent.perfectScrollbar("update");},t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.python=i;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Implementation.Script.Constants;function i(e,i){t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.call(this,e,i);}i.prototype=Object.create(t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.prototype),i.prototype.constructor=i,i.prototype.createPanelViewToolitem=function(t){var e=this,i=$('<div class="brtc-va-figure-scriptunit-panelviewtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Panel View" item-type="view"></div>');t.append(i),this.$viewContextBtnScript=this.createPanelViewContextButton(!1,"Script",function(){e.toggleCollapsedClass(e.$scriptPanel);}),this.$viewContextBtnResult=this.createPanelViewContextButton(!0,"Result",function(){e.toggleCollapsedClass(e.$resultPanel);},{disabled:!0}),i.append(this.$viewContextBtnScript),i.append(this.$viewContextBtnResult);},i.prototype.createRunToolItem=function(e){this.$runToolItem=$('<div class="brtc-va-figure-scriptunit-runtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Run" item-type="run"></div>'),e.append(this.$runToolItem);var i=this;this.$runToolItem.on("click",function(){var e=$.extend({},i.options.unit);delete e.param["input-variables"],Studio.getJobExecutor().launchUnit(e,{},{},{catch:function _catch(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);}});});},i.prototype.createContent=function(t){this.$content=$('<div class="brtc-va-figure-scriptunit-content brtc-style-figure-scriptunit-content brtc-style-s-figure-scriptunit-content"></div>'),t.append(this.$content),this.createScriptPanel(this.$content),this.createResultPanel(this.$content),this.setPanelCollapsed(!1,!1,!0);},i.prototype.createScriptPanelContent=function(i){var n=this;this.$scriptPanelContent=$('<div class="brtc-va-figure-scriptunit-scriptpanel-content brtc-style-figure-scriptunit-panel-content brtc-style-s-figure-scriptunit-panel-content"></div>'),i.append(this.$scriptPanelContent),void 0!==this.options.unit.param.script&&this.$scriptPanelContent.text(this.options.unit.param.script),this.editor=ace.edit(this.$scriptPanelContent[0]),this.editor.session.setMode("ace/mode/"+this.options.unit.func),this.editor.setTheme("ace/theme/eclipse"),this.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,useSoftTabs:!1,enableLiveAutocompletion:!0,minLines:10,maxLines:30}),this.editor.setShowPrintMargin(!1),this.editor.$blockScrolling=1/0,this.editor.commands.addCommand({name:"runScript",bindKey:{win:"Ctrl-Enter",mac:"Command-Enter"},exec:function exec(t){0===$(".brtc-va-dialogs-launch-progress-contents").length&&(n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction(),n.$runToolItem.trigger("click"));}}),this.editor.commands.addCommand({name:"runAllScript",bindKey:{win:"Ctrl-Shift-Enter",mac:"Command-Shift-Enter"},exec:function exec(t){if(0===$(".brtc-va-dialogs-launch-progress-contents").length){n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction();var e=Studio.getEditorContainer().getActiveEditor().getModel();Studio.getJobExecutor().launchModel(e);}}}),this.editor.commands.addCommand({name:"addScript",bindKey:{win:"Shift-Enter",mac:"Shift-Enter"},exec:function exec(i){var r=i.getCursorPosition(),o=i.session.getLine(r.row).substring(0,r.column),s=o.match(/%[a-zA-Z]+%/g);if(s){var a=s[s.length-1];if(o.lastIndexOf(a,r.column-a.length)==r.column-a.length){var l=a.split("%")[1];if(e.FUNCS.includes(l)){var c={start:{row:r.row,column:o.lastIndexOf(a,r.column-a.length)},end:{row:r.row,column:r.column}};i.session.remove(c);var p=t.VA.Core.Utils.WidgetUtils.getEditorRef(n.$mainControl),u=p.getModel().newFnUnit(l),d=p.getModel().functions.length,h=n.$parent.find(".brtc-va-figure-scriptunit.status-selection");h.length>0&&(d=h.parent().index());var m=new t.VA.Implementation.Script.Editors.Diagram.Commands.NewScriptUnitCommand(this,{fnUnit:u,index:d+1});n.executeCommand(m);}}}}}),this.editor.on("blur",function(){n.options.unit.param.script!=n.editor.getValue()&&n.doEditScriptFunction();}),this.$scriptPanelContent.droppable({drop:this.doDropEventOnScriptPanelContent.bind(this)});},i.prototype.refreshResult=function(t){this.$mainControl.find(".brtc-va-figure-scriptunit").removeClass("initial"),this.$resultPanel.removeClass("collapsed"),this.$runStatus.removeClass("success").removeClass("fail"),this.$runResultLabel.text(t.status),this.$viewContextBtnResult.jqxButton({disabled:!1}),this.$viewContextBtnResult.addClass("selected"),this.setPanelCollapsed(!1,!this.$viewContextBtnScript.hasClass("selected"),!1);var i=this._createResultMessage(t);t.status===e.RESULT_FAIL?this.$runStatus.addClass("fail"):this.$runStatus.addClass("success"),this.$resultMessage.text(""),this.$executionTime.find(".brtc-va-figure-scriptunit-executiontimelabel").text(t.duration),this.printResultText(i);},i.prototype.onSetFnUnitParameterValueCommand=function(t){var e,i;this.$mainControl.find(".brtc-va-figure-scriptunit").attr("fid")===t.options.fnUnit.fid&&("REDO"==t.event.type||"EXECUTE"==t.event.type?(e=t.options.fnUnit.param.script,i=t.options.fnUnit.param.limit):"UNDO"==t.event.type&&(e=t.old.param.script,i=t.old.param.limit),void 0!==e&&(this.editor.setValue(e),this.editor.navigateFileEnd()),void 0!==i&&this.$rowLimitInput.setValue(i));},i.prototype._getFunctionFormat=function(t,e){var i={url:"api/va/v2/help/functionformat/"+t+"/?context=scala",type:"GET"},n="not yet supported";$.ajax(i).done(function(t){if(t.format){for(var i=t.format.replace(/[“”]/g,'"'),r="";""!=i;){var o=i.indexOf("function("),s=-1;-1!=o&&(s=i.indexOf("function(",o+1));""!=r&&(r+="\n"),r+=-1==s?i.substring(o):i.substring(o,s),i=-1!=s?i.substring(s):"";}n=r;}"function"==typeof e&&e(n);});},i.prototype.doDropEventOnScriptPanelContent=function(i,n){var r=this,o=n.helper,s=t.VA.Core.Utils.WidgetUtils.getData(o,e.SIDEBAR_TEMPLATE),a=function a(t){try{r.editor.navigateFileEnd(),0!=r.editor.getCursorPosition().column&&r.editor.session.getDocument().insertMergedLines(r.editor.getCursorPosition(),["",""]),r.editor.insert(t);}catch(t){console.error(t);}};if(s)a(s);else{var l=t.VA.Core.Utils.WidgetUtils.getData(o,e.SIDEBAR_FN_NAME);r.$parent.trigger("changeSelection",[r.options.unit,!0]),r.editor.focus(),r._getFunctionFormat(l,a);}},i.prototype.createResultContents=function(t){this.$resultText=$('<div class="brtc-va-figure-scriptunit-resultpanel-resulttext brtc-style-figure-scriptunit-panel-content-resulttext brtc-style-s-figure-scriptunit-panel-content-resulttext"></div>'),t.append(this.$resultText),this.$resultText.perfectScrollbar();},i.prototype.createResultPanelHeader=function(t){this.$resultPanelHeader=$('<div class="brtc-va-figure-scriptunit-resultpanel-header brtc-style-figure-scriptunit-panel-header brtc-style-s-figure-scriptunit-panel-header"></div>'),t.append(this.$resultPanelHeader),this.createResultStatusbar(this.$resultPanelHeader);},i.prototype.onSetFnUnitCommand=function(t){var e;this.$mainControl.find(".brtc-va-figure-scriptunit").attr("fid")===t.options.fnUnit.fid&&("REDO"==t.event.type||"EXECUTE"==t.event.type?e=t.options.fnUnit.display.layout:"UNDO"==t.event.type&&(e=t.old.display.layout),void 0!==e&&this.setPanelHeight(void 0,e["script-panel"].height,e["result-panel"].height));},i.prototype.setPanelHeight=function(t,e,i){this.$resultPanelContent&&this.$resultPanelContent.height(i),this.$resultText&&this.$resultText.perfectScrollbar("update"),$(window).trigger("resize");},i.prototype.setPanelCollapsed=function(t,e,i){e?(this.$scriptPanel.addClass("collapsed"),this.$rowLimit.addClass("collapsed")):(this.$scriptPanel.removeClass("collapsed"),this.$rowLimit.removeClass("collapsed"),this.editor.resize()),this.$mainControl.find(".brtc-va-figure-scriptunit").hasClass("initial")||(i?this.$resultPanel.addClass("collapsed"):this.$resultPanel.removeClass("collapsed")),this.$parent.perfectScrollbar("update");},t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.scala=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){this.aliasInfo=[],t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.call(this,e,i);}e.prototype=Object.create(t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.prototype),e.prototype.constructor=e,e.prototype.doDropEventOnScriptPanelContent=function(e,i){var n=i.helper,r=t.VA.Core.Utils.WidgetUtils.getData(n,"table");if(r){var o="";this.$parent.trigger("changeSelection",[this.options.unit,!0]),this.editor.focus();var s="";$.each(r.columns,function(){s=""===s?s+"a."+this:s+", a."+this;}),""===s&&(s="*");var a=function a(t){return"#{"+t+"}";},l=this.getUniqueRowId();this.executeCommand(new t.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this,{label:"Add Alias",target:this.options.unit,path:["param","alias",a(l)],value:r.value})),this.appendAliasRow(a(l),r.value),this.moveAddButton(),o="select\n\t"+s+"\nfrom\n\t"+a(l),"*"!=s&&(o+=" a"),""!=o&&(this.editor.navigateFileEnd(),0!=this.editor.getCursorPosition().column&&this.editor.session.getDocument().insertNewLine(this.editor.getCursorPosition()),this.editor.insert(o));}},e.prototype.createAliasArea=function(t){var e=$(crel("div",{class:["brtc-va-figure-scriptunit-alias-wrapper","brtc-style-figure-scriptunit-panel","brtc-style-s-figure-scriptunit-panel"].join(" ")}));this.createAliasHeader(e),this.createAliasContent(e),t.append(e),this.$aliasPanel=e;},e.prototype.createAliasHeader=function(t){this.$aliasHeader=$(crel("div",{class:["brtc-va-figure-scriptunit-alias-header","brtc-style-figure-scriptunit-panel-header","brtc-style-s-figure-scriptunit-panel-header"].join(" ")},"Table Alias")),t.append(this.$aliasHeader);},e.prototype.createScriptPanel=function(e){t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.prototype.createScriptPanel.call(this,e),this.createAliasArea(e);},e.prototype.createAliasContent=function(t){var e=this;this.$aliasContent=$(crel("div",{class:["brtc-va-figure-scriptunit-alias-content","brtc-style-figure-scriptunit-panel-content"].join(" ")})),_.forIn(this.options.unit.param.alias,function(t,i){e.appendAliasRow(i,t);}),this.createAppendAliasRowButton(this.$aliasContent),t.append(this.$aliasContent),this.$aliasContent.perfectScrollbar();},e.prototype.getUniqueRowId=function(){var t=_.uniqueId("DF");return _.has(this.options.unit.param.alias,t)?this.getUniqueRowId():t;},e.prototype.migrateUnit=function(){this.options.unit.param.alias||(this.options.unit.param.alias={});},e.prototype.createAppendAliasRowButton=function(e){var i=this,n=$(crel("div",{class:["brtc-va-figure-scriptunit-add-alias","brtc-style-figure-scriptunit-add-alias-icon"].join(" ")})),r=function r(t){return"#{"+t+"}";};n.on("click",_.debounce(function(){var e=i.getUniqueRowId();i.appendAliasRow(r(e),""),i.moveAddButton(),i.migrateUnit(),i.executeCommand(new t.VA.Core.Editors.Diagram.Commands.AddOperationCommand(i,{label:"Add Alias",target:i.options.unit,path:["param","alias",r(e)],value:""}));},200,{maxWait:200})),this.$addButton=n,this.moveAddButton(),this.$aliasContent.perfectScrollbar("update");},e.prototype.createInput=function(e,i){return e.jqxInput({theme:t.VA.Env.Theme,placeHolder:i});},e.prototype.createButton=function(e){return e.jqxButton({theme:t.VA.Env.Theme});},e.prototype.createAliasRow=function(e,i){var n=_.isUndefined(e)?"":e,r=_.isUndefined(i)?"":i,o=new t.VA.EventEmitter(),s=$(crel("div",{class:"brtc-va-figure-scriptunit-alias-row-wrapper"})),a=this.createInput($(crel("input",{class:["brtc-va-figure-scriptunit-alias-key-input","brtc-style-figure-scriptunit-alias-input","brtc-style-figure-scriptunit-alias-input-alias"].join(" "),value:n})),"Enter Alias"),l=this.createInput($(crel("input",{class:["brtc-va-figure-scriptunit-real-key-input","brtc-style-figure-scriptunit-alias-input","brtc-style-figure-scriptunit-alias-input-real"].join(" "),value:r})),"Enter Table ID"),c=$(crel("div",{class:["brtc-va-figure-scriptunit-alias-remove","brtc-style-figure-scriptunit-remove-alias-icon"].join(" ")}));return a.on("change",function(t){o.emit("aliasChange",{$target:a,value:t.target.value});}),l.on("change",function(t){o.emit("pathChange",{$target:l,value:t.target.value});}),c.on("click",function(){o.emit("remove");}),o.on("aliasError",function(t){t?a.addClass("brtc-style-figure-scriptunit-alias-input-error"):a.removeClass("brtc-style-figure-scriptunit-alias-input-error");}),o.on("realError",function(t){t?l.addClass("brtc-style-figure-scriptunit-alias-input-error"):l.removeClass("brtc-style-figure-scriptunit-alias-input-error");}),s.append(a,l,c),{$el:s,emitter:o};},e.prototype.moveAddButton=function(){this.aliasInfo.length?_.last(this.aliasInfo).$el.children().last().after(this.$addButton):this.$aliasContent.append(this.$addButton);},e.prototype.createMsgArea=function(){var t=$(crel("div",{class:"brtc-va-figure-scriptunit-alias-error-msg-area"})),e=function e(t){var e=$(crel("div",{class:"brtc-va-editors-sheet-panels-validation-tooltip-wrapper"}));if(t){var i=$(crel("i",{class:"fa fa-exclamation-triangle","aria-hidden":"true"})),n=$(crel("div",{class:"brtc-va-editors-sheet-panels-validation-tooltip"}));n.html(t),e.append(i,n);}return e;},i=$(crel("i",{class:"fa fa-exclamation-triangle","aria-hidden":"true"})),n=$(crel("div",{class:"brtc-va-editors-sheet-panels-validation-tooltip"})),r=null;return t.append(i,n),{$el:t,attach:function attach(t){r=t;},setMsg:function setMsg(i){t.empty(),t.append(e(i[0]||i[1]),e(i[2])),r.after(t);},remove:function remove(){t.remove();}};},e.prototype.appendAliasRow=function(e,i){var n=this.createAliasRow(e,i),r=this.options.unit,o=this.executeCommand.bind(this),s=this;this.$aliasContent.append(n.$el);var a=function(e,i,n,r,a,l){var c=n,p=r;i.attach(e);var u="Alias is required.",d="Alias is duplicated.",h="Table ID is required.",m=[u,d,h],f=[!1,!1,!1],v=function v(t){f[m.indexOf(t)]=!0;},g=function g(t){f[m.indexOf(t)]=!1;},b=function b(){l.emit("aliasError",f[0]||f[1]),l.emit("realError",f[2]),i.setMsg(_.map(_.zip(m,f),function(t){return t[1]?t[0]:"";})),s.$aliasContent.perfectScrollbar("update");};return""===c&&v(u),""===p&&v(h),b(),{remove:function remove(){s.aliasInfo=_.filter(s.aliasInfo,function(t){return t.$el!==e;}),s.moveAddButton(),e.remove(),i.remove(),s.$aliasContent.perfectScrollbar("update"),o(new t.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(this,{label:"Remove Alias",target:a,path:["param","alias",c]}));},change:function change(e){if("aliasChange"===e.type){if(e.value===c)return;if(_.has(a.param.alias,e.value))return v(d),b(),void _.delay(function(){g(d),b(),e.$target.val(c);},1e3);var i=new t.VA.Core.CompoundCommand(this,{label:"Change Alias"});i.add(new t.VA.Core.Editors.Diagram.Commands.RemoveOperationCommand(this,{target:a,path:["param","alias",c]})),i.add(new t.VA.Core.Editors.Diagram.Commands.AddOperationCommand(this,{target:a,path:["param","alias",e.value],value:p})),o(i),""===(c=e.value)?v(u):g(u);}else if("pathChange"===e.type){if(e.value===p)return;o(new t.VA.Core.Editors.Diagram.Commands.UpdateOperationCommand(this,{label:"Change Alias",target:a,path:["param","alias",c],value:e.value})),""===(p=e.value)?v(h):g(h);}b();}};}(n.$el,this.createMsgArea(),e,i,r,n.emitter);n.emitter.on("aliasChange",function(t){a.change(_.merge({type:"aliasChange"},t));}),n.emitter.on("pathChange",function(t){a.change(_.merge({type:"pathChange"},t));}),n.emitter.on("remove",function(){a.remove();}),this.$aliasContent.perfectScrollbar("update"),this.aliasInfo.push(n);},e.prototype.createResultPanelHeader=function(t){this.$resultPanelHeader=$('<div class="brtc-va-figure-scriptunit-resultpanel-header brtc-style-figure-scriptunit-panel-header brtc-style-s-figure-scriptunit-panel-header"></div>'),t.append(this.$resultPanelHeader),this.createResultStatusbar(this.$resultPanelHeader),this.createResultPanelToolbar(this.$resultPanelHeader);},e.prototype.createResultPanelContent=function(t){var e=this;this.$resultPanelContent=$('<div class="brtc-va-figure-scriptunit-resultpanel-content brtc-style-figure-scriptunit-panel-content brtc-style-s-figure-scriptunit-panel-content"></div>'),t.append(this.$resultPanelContent),this.createResultContents(this.$resultPanelContent),this.options.unit.display.layout["result-panel"].height&&this.$resultPanelContent.height(this.options.unit.display.layout["result-panel"].height),this.$resultPanelContent.resizable({minHeight:150,maxHeight:794,handles:"s, se",resize:function resize(){e.$resultPanelContent.css("width","100%"),e.$resultText&&e.$resultText.perfectScrollbar("update");},stop:function stop(){$(this).height()!=e.options.unit.display.layout["result-panel"].height&&e.doEditUnitDisplayFunction("result-panel","height","Adjust Panel Height",e.$resultPanelContent.height());}});},e.prototype.refreshResult=function(t){this.$mainControl.find(".brtc-va-figure-scriptunit").removeClass("initial"),this.$resultPanel.removeClass("collapsed"),this.$runStatus.removeClass("success").removeClass("fail"),this.$runResultLabel.text(t.status),this.$viewContextBtnResult.jqxButton({disabled:!1}),this.$viewContextBtnResult.addClass("selected"),this.setPanelCollapsed(!this.$viewContextBtnScript.hasClass("selected"),!1);var e=t.message,i="";"FAIL"===t.status?(this.$runStatus.addClass("fail"),i=this._createResultMessage(t)):(this.$runStatus.addClass("success"),i="Fetched "+t.message.data.length+" rows"),this.$resultMessage.text(i),this.$executionTime.find(".brtc-va-figure-scriptunit-executiontimelabel").text(t.duration),this.createWorksheet(e);},e.prototype.createResultContents=function(t){this.$resultSheet=$('<div class="brtc-va-figure-scriptunit-resultpanel-resultsheet brtc-style-figure-scriptunit-panel-content-resultsheet brtc-style-s-figure-scriptunit-panel-content-resultsheet"></div>'),t.append(this.$resultSheet),this.createWorksheet();},e.prototype.createWorksheet=function(e){this.dataWorksheet&&this.dataWorksheet.destroy(),this.$resultSheet.children(".brtc-va-editors-sheet-controls-dataworksheet").remove();var i={data:[],columns:[]};"object"==typeof e&&(i=e||i),this.dataWorksheet=new t.VA.Implementation.Script.Editors.Sheet.Controls.SqlDataWorksheet(this.$resultSheet,{component:{right:{chartOption:!0}},style:{width:"100%",height:"100%"},worksheet:{panel:this.options.unit.display.layout["result-panel"].panel,layout:this.options.unit.display.layout["result-panel"].layout},dataSet:i},{mid:this.options.unit.parent().mid,fid:this.options.unit.fid,fnUnitLabel:this.options.unit.display.label});},e.prototype.createResultPanelToolbar=function(t){this.$resultPanelToolbar=$('<div class="brtc-va-figure-scriptunit-resultpanel-toolbar brtc-style-figure-scriptunit-panel-toolbar grow"></div>'),t.append(this.$resultPanelToolbar),this.createEvenlyToolItem(this.$resultPanelToolbar),this.createStackedToolItem(this.$resultPanelToolbar);},e.prototype.createEvenlyToolItem=function(t){var e=this;this.$evenlyToolitem=$('<div class="brtc-va-figure-scriptunit-evenlytoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Evenly" item-type="evenly"></div>'),t.append(this.$evenlyToolitem),this.$evenlyToolitem.on("click",function(){e.dataWorksheet.arrange("evenly");});},e.prototype.toggleCollapsedClass=function(e){t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.prototype.toggleCollapsedClass.call(this,e),e===this.$scriptPanel&&t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.prototype.toggleCollapsedClass.call(this,this.$aliasPanel);},e.prototype.createStackedToolItem=function(t){var e=this;this.$stackedToolitem=$('<div class="brtc-va-figure-scriptunit-stackedtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Horizontal" item-type="stacked"></div>'),t.append(this.$stackedToolitem),this.$stackedToolitem.on("click",function(){e.dataWorksheet.arrange("horizontal");});},e.prototype.createDownloadToolItem=function(t){this.$downloadToolitem=$('<div class="brtc-va-figure-scriptunit-downloadtoolitem brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Download" item-type="download"></div>'),t.append(this.$downloadToolitem);},e.prototype.applyCallbackFunction=function(t){this.onSetDataWorksheetInform(t);var e=$.extend(!0,{},this.dataWorksheet.options.dataSet);this.createWorksheet(e);},t.VA.Implementation.Script.Editors.Diagram.ScriptUnit.sql=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i,n){t.VA.Core.Editors.Sheet.Controls.SingleDataWorksheet.call(this,e,i,n);}e.prototype=Object.create(t.VA.Core.Editors.Sheet.Controls.SingleDataWorksheet.prototype),e.prototype.constructor=e,e.prototype.createControls=function(){var t=this;this.$mainControl=$('<div class="brtc-va-editors-sheet-controls-dataworksheet"></div>'),this.$mainControl.css({width:"100%",height:"100%"}),this.chartOptions={},this.$parent.append(this.$mainControl),this.options.worksheet.onAddChart=this.onAddChart.bind(this),this.options.worksheet.onRemoveChart=this.onRemoveChart.bind(this),this.options.worksheet.onChangeLayout=this.onChangeLayout.bind(this),this.options.worksheet.onChangeChart=this.onChangeChart.bind(this),this.options.worksheet.onSelectChart=this.onSelectChart.bind(this),0===this.options.worksheet.panel.length&&this.options.worksheet.panel.push({id:"default-"+Date.now(),chartOption:{chart:{type:"table"},plotOptions:{table:{formatter:[]}}}});var e={dataType:"lazy",lazyData:[{columns:function columns(){return t.options.dataSet.columns;},data:function data(e){setTimeout(function(){e.done({dataType:"rawdata",columns:t.options.dataSet.columns,data:t.options.dataSet.data,count:t.options.dataSet.count,offset:t.options.dataSet.offset});},100);}}]};for(var i in this.options.worksheet.panel){this.options.worksheet.panel[i].chartOption.source=e;}this.options.worksheet.toolbar={menu:{setting:{},duplicate:{},close:{}}},this.$mainControl.bchartsAdonis(this.options);},t.VA.Core.Editors.Sheet.Controls.SqlDataWorksheet=e,t.VA.Implementation.Script.Editors.Sheet.Controls.SqlDataWorksheet=e;}.call(this),function(){"use strict";var t=this,e=t.Brightics;function i(t){this.validator={},this.options=t||{};}i.prototype.validate=function(t){var e=[];for(var i in t.functions){var n=t.functions[i];try{var r=this.createValidator(n.func).validate(n,t);r&&(e=e.concat(r));}catch(t){}}return e=e.filter(function(t){return void 0!==t&&null!=t;}),t.problemList=e,t.problemList;},i.prototype.createValidator=function(i){var n=t.Brightics.VA.Implementation.Script.Functions[i].validator;return this.validator[i]?this.validator[i]:this.validator[i]=n?new n():new e.VA.Core.Validator.BaseValidator();},e.VA.Implementation.Script.Validator=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t){for(var e in this.cache={},this.labelMap={},this.launchOptions=t,this.launchOptions.originalModels){var i=this.launchOptions.originalModels[e];this.labelMap[i.mid]=i.title,this._scanFunctions(i.mid,i);}}e.prototype._scanFunctions=function(t,e,i){for(var n in e.functions){var r=e.functions[n],o=t+"_"+r.fid;this.labelMap[o]=r.display.label;}},e.prototype.createUnitEvent=function(t,e,i,n){var r,o=[];return(r=this._createUnitStartEvent(t,e,i,n))&&o.push(r),(r=this._createUnitEndEvent(t,e,i,n))&&o.push(r),o;},e.prototype._createUnitStartEvent=function(t,e,i,n){if(this.cache[t]&&"WAIT"!==n&&!this.cache[t][i.fid]){var r={eventType:"BEGIN-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:i.fid,status:"PROCESSING",label:this.labelMap[e+"_"+i.fid],begin:Date.now()};return this.cache[t][i.fid]={event:r},r;}},e.prototype._createUnitEndEvent=function(t,e,i,n){if(this.cache[t]&&this.cache[t][i.fid]&&"PROCESSING"==this.cache[t][i.fid].event.status&&this.cache[t][i.fid].event.status!=n)return{eventType:"END-UNIT",launchOptions:this.launchOptions,pid:t,mid:e,fid:i.fid,status:n,label:this.labelMap[e+"_"+i.fid],begin:this.cache[t][i.fid].event.begin,end:Date.now()};},e.prototype.createProcessEvent=function(t,e,i,n,r){var o,s=[];return(o=this._createProcessStartEvent(t,e,i,r))&&s.push(o),(o=this._createProcessEndEvent(t,e,i,n,r))&&s.push(o),s;},e.prototype._createProcessStartEvent=function(t,e,i,n){if(!this.cache[t]||this.cache[t].begin!==i){var r={eventType:"BEGIN-PROCESS",launchOptions:this.launchOptions,pid:t,mid:e,label:this.labelMap[e],status:n,begin:i,count:1};return this.cache[t]={mid:r.mid,status:r.status,begin:r.begin},r;}},e.prototype._createProcessEndEvent=function(t,e,i,n,r){if(this.cache[t]&&this.cache[t].begin===i&&this.cache[t].status!=r)return{eventType:"END-PROCESS",launchOptions:this.launchOptions,pid:t,mid:e,label:this.labelMap[e],status:r,begin:i,end:n};},t.VA.Implementation.Script.EventDetector=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.JobDelegator.call(this,e),this.runnable=null,this._abort=!1;}e.prototype=Object.create(t.VA.Core.JobDelegator.prototype),e.prototype.constructor=e,e.prototype._start=function(t){var e={url:"api/va/v2/analytics/jobs/execute",type:"POST",blocking:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(t)};return Promise.resolve($.ajax(e)).then(function(t){return JSON.parse(t);});},e.prototype._stop=function(t){var e={url:"api/va/v2/analytics/jobs/"+this.jobId+"/delete",type:"POST",blocking:!1,contentType:"application/json; charset=utf-8"};if(t){var i={type:t};e.data=JSON.stringify(i);}return $.ajax(e);},e.prototype._check=function(t,e){var i={url:"api/va/v2/analytics/jobs/"+t+"/tasks/"+e,type:"GET",blocking:!1};return $.ajax(i);},e.prototype._scheduleCheckStatus=function(t){var e=this,i=0,n=function n(){var r=e.runnable.models[e.runnable.main].functions.length,o=e.runnable.models[e.runnable.main].functions[i].fid;e._check(t,o).done(function(o){e._abort?e._fireAbort({jobId:t,end:Date.now(),status:"ABORT",message:"Job aborted by user"}):"FAIL"===o.status?e._fireFail(o,i):"SUCCESS"===o.status?(e._fireSuccess(o,i),i<r-1&&(i++,setTimeout(n,500))):"WAIT"===o.status?(e._firePending(o),setTimeout(n,500)):(e._fireStatus(o,i),setTimeout(n,500));}).fail(e._fireCatch.bind(e));};setTimeout(n,500);},e.prototype.start=function(t){var e=this;return this.runnable=t,this._start(t).then(function(t){return e.jobId=t.result,e._scheduleCheckStatus(t.result),t;},e._fireCatch.bind(e));},e.prototype.stop=function(t){this._stop(t),this._abort=!0;},t.VA.Implementation.Script.Job=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(){t.VA.Core.ModelLauncher.call(this),this.isProcessing=!1;}e.prototype=Object.create(t.VA.Core.ModelLauncher.prototype),e.prototype.constructor=e,e.prototype.launchUnit=function(e,i,n,r){if(!this.isProcessing){this.isProcessing=!0;var o=this._generateJobId(e.fid),s=t.VA.Env.Session.userId,a={mode:"unit",clazz:t.VA.Implementation.Script.Clazz,originalModels:[e.parent()],expectedUnitCount:1,runnable:t.VA.Core.Utils.RunnableFactory.createForUnit(e,o,s,i,n)};this._launch(a,n,r);}},e.prototype.launchModel=function(e,i,n,r){if(!this.isProcessing){this.isProcessing=!0;var o=e.mid,s=this._generateJobId(o),a=t.VA.Env.Session.userId,l=e.functions.length,c={mode:"wf",clazz:t.VA.Implementation.Script.Clazz,originalModels:[e],expectedUnitCount:l,runnable:t.VA.Core.Utils.RunnableFactory.createForFlow(e,s,a,i,n)};this._launch(c,n,r);}},e.prototype._launch=function(e,i,n){var r,o,s=this,a=e.runnable.main,l=new t.VA.Implementation.Script.EventDetector(e),c=function c(t,i){var n=e.runnable.models[a].functions[i];for(var o in r=l.createUnitEvent("pid_undefined",a,n,t.status)){"END-UNIT"==r[o].eventType&&(r[o].originalResponse=t);}s._fireEvents(r);},p=function p(t,i){"SUCCESS"===t.status&&i!=e.runnable.models[a].functions.length-1||(r=l.createProcessEvent("pid_undefined",a,o,Date.now(),t.status),s._fireEvents(r),s._fireEvents([{eventType:"END-JOB",jid:t.jobId,message:s._getProcessingMessage(t),status:t.status,launchOptions:e,originalResponse:t}]),delete s.jobScheduler[t.jobId],s.isProcessing=!1);},u={status:[function(t,e){c(t,e);}],success:[function(t,e){c(t,e),p(t,e);}],abort:[function(t,e){p(t,e);}],fail:[function(t,e){c(t,e),p(t,e);}],pending:[function(t){!function(t){var n={eventType:"PENDING-JOB",jid:t.jobId,message:s._getPendingMessage(t),status:t.status,launchOptions:e,originalResponse:t};i&&i.hideDialog||s._fireEvents([n]);}(t);}],catch:[function(t){p({jobId:e.runnable.jid,status:"FAIL",exception:t});}]};this._extendListeners(u,n);var d=new t.VA.Implementation.Script.Job(u);d.start(e.runnable).then(function(t){var i,n=t.result;s.jobScheduler[n]=d,i=n,s._fireEvents([{eventType:"BEGIN-JOB",jid:i,status:"WAIT",launchOptions:e}]),o=Date.now(),r=l.createProcessEvent("pid_undefined",a,o,"","PROCESSING"),s._fireEvents(r);});},t.VA.Implementation.Script.ScriptModelLauncher=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e,this.loadedElements={},this.retrieveParent(),this.createControls();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.createControls=function(){this.$mainControl=$('<div class = "brtc-va-implementation-script-views-datasourcelist brtc-va-tab-contents brtc-style-tab-content"></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.createDataSourceViewer(this.$mainControl);},e.prototype.createDataSourceViewer=function(t){this.$dataSourceViewer=$('<div class = "brtc-va-implementation-script-views-datasourcelist-datasourceviewer brtc-style-implementation-script-views-datasourcelist-datasourceviewer"></div>'),t.append(this.$dataSourceViewer),this.createRefreshButton(this.$dataSourceViewer),this.createTreeArea(this.$dataSourceViewer);},e.prototype.createRefreshButton=function(e){var i=this;this.$refresh=$('<button class="brtc-va-implementation-script-views-datasourcelist-refresh brtc-style-implementation-script-views-datasourcelist-refresh"><div class="brtc-style-icon"></div>Refresh</button>'),e.append(this.$refresh),this.$refreshButton=this.$refresh.jqxButton({theme:t.VA.Env.Theme}),this.$refreshButton.click(function(t){i.initRootItem();});},e.prototype.createTreeArea=function(e){var i=this;this.$treeArea=$('<div class = "brtc-va-implementation-script-views-datasourcelist-treearea brtc-style-implementation-script-views-datasourcelist-treearea"></div>'),e.append(this.$treeArea),this.$tree=this.$treeArea.jqxTree({theme:t.VA.Env.Theme,width:"calc(100% - 2px)",height:"calc(100% - 40px)",allowDrag:!1,allowDrop:!1}),this.initRootItem(),this.$tree.bind("expand",function(t){var e=$(t.args.element),n=!1,r=null,o=e.find("ul:first").children();$.each(o,function(){var t=i.$tree.jqxTree("getItem",this);if("Loading..."==t.label)return r=t,n=!0,!1;}),n&&!i.loadedElements[e.attr("id")]&&(i.loadedElements[e.attr("id")]=!0,$.ajax({url:r.value,success:function success(t,n,o){i.$tree.jqxTree("removeItem",r.element);var s=[];if($.isArray(t)&&t.length>0)r.value.startsWith("api/va/v2/data/list/table")&&$.each(t,function(){var t=this.key.split("/")[2],e=Studio.getResourceManager().getFile(i.options.projectId,t);if(e){var n=e.data.contents.title+" - "+this.name,r={html:'<i class="fa fa-table" aria-hidden="true"></i> '+_.escape(n),expanded:!1,items:[{value:"api/va/v2/data/schema?key="+this.key,label:"Loading..."}],value:this.key};s.push(r);}});else if("object"==typeof t){i.$tree.find(".jqx-tree-dropdown-root > li > ul > li > div").draggable("destroy");var a=t.columns||[];s=s.concat(_.map(a,function(t){return{label:t.name};}));}i.$tree.jqxTree("addTo",s,e[0]),i.$tree.jqxTree("removeItem",r.element),i.$tree.jqxTree("refresh"),i.allowDraggable();},fail:function fail(t){i.$tree.jqxTree("updateItem",r,{label:'Loading Error. Press "Refresh"'}),console.log(t);}}));});},e.prototype.allowDraggable=function(){var e=this;this.$tree.find(".jqx-tree-dropdown-root > li > ul > li > div").draggable({appendTo:"body",scroll:!1,cursor:"move",cursorAt:{left:5,top:5},helper:function helper(i){var n=$(this).clone();n.css({"z-index":5100,width:$(this).width(),height:$(this).height(),"font-size":"11px"});var r=$(this).parent(),o=e.$tree.jqxTree("getItem",r[0]),s=$(this).parent().find("li"),a=[];o.isExpanded&&$.each(s,function(){var t=e.$tree.jqxTree("getItem",this);if("Loading..."==t.label)return!1;a.push(t.label);});var l={name:o.label,value:o.value,columns:a};return t.VA.Core.Utils.WidgetUtils.putData(n,"table",l),t.VA.Core.Utils.WidgetUtils.putData(n,"source",e),n;},start:function start(t,e){$(".brtc-va-studio").addClass("brtc-va-studio-dragging"),$(".brtc-va-figure-scriptunit").addClass("dragging-table"),$(this).draggable("option","cursorAt",{left:Math.floor(e.helper.width()/2),top:Math.floor(e.helper.height()/2)});},drag:function drag(t,e){e.helper.trigger("feedback",[{clientX:t.clientX,clientY:t.clientY}]);},stop:function stop(t,e){$(".brtc-va-studio").removeClass("brtc-va-studio-dragging"),$(".brtc-va-figure-scriptunit").removeClass("dragging-table");}});},e.prototype.initRootItem=function(){this.$tree.jqxTree("clear");var t=[{html:'<i class="fa fa-database" aria-hidden="true"></i> Tables',expanded:!1,items:[{value:"api/va/v2/data/list/table",label:"Loading..."}]}];this.$tree.jqxTree("addTo",t,this.$tree[0]),this.loadedElements={};},e.prototype.refresh=function(){this.$tree.jqxTree("refresh");},t.VA.Implementation.Script.Views.DataSourceList=e;}.call(this),function(){"use strict";var t=this.Brightics,e=this.Brightics.VA.Implementation.Script.Constants;function i(e,i){t.VA.Core.Views.Palette.call(this,e,i);}i.prototype=Object.create(t.VA.Core.Views.Palette.prototype),i.prototype.constructor=i,i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-palette brtc-va-tab-contents brtc-style-tab-content">   <div class="brtc-va-views-palette-filter brtc-va-searcharea brtc-style-search-area"></div>   <div class="brtc-va-views-palette-navigator-wrapper  brtc-va-contentsarea">       <div class="brtc-va-views-palette-navigator"></div>       <div class="brtc-va-views-palette-info-list"></div>   </div></div>'),this.$parent.append(this.$mainControl),this.$filter=this.$mainControl.find(".brtc-va-views-palette-filter"),this.$navigator=this.$mainControl.find(".brtc-va-views-palette-navigator"),this.$infoList=this.$mainControl.find(".brtc-va-views-palette-info-list"),this.createNavigatorControl(),this.createFilterControl(),this.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar();},i.prototype.createFilterControl=function(){var i=this,n=$('<input type="search" class="brtc-va-views-palette-filter-input searchinput"/>');this.$filter.append(n),n.jqxInput({placeHolder:"Search Function",theme:t.VA.Env.Theme});var r=function r(n){var r=n.target.value.toLowerCase(),o=i.$mainControl.find(".brtc-va-views-palette-fnunit-list");$.each(o,function(t,e){i.$navigator.jqxNavigationBar("expandAt",t);});var s=i.getMatchedList(r.trim()),a=i.$mainControl.find(".brtc-va-views-palette-fnunit");$.each(a,function(n,r){var o=$(r).parent(),a=t.VA.Core.Utils.WidgetUtils.getData(o.find(".brtc-va-views-palette-fnunit"),e.SIDEBAR_FN_NAME);o.css("display",i._inArray(a,s)>-1?"block":"none");}),o=i.$mainControl.find(".brtc-va-views-palette-fnunit-list"),$.each(o,function(t,e){var i=$(e).find(".brtc-va-views-palette-fnunit-content").filter(function(){return"block"==$(this).css("display");});$(e).css("display",i.length>0?"block":"none"),$(e).prev().css("display",i.length>0?"block":"none");}),i.$mainControl.find(".brtc-va-views-palette-navigator-wrapper").perfectScrollbar("update");};n.keyup(function(t){r(t);}),n.on("search",function(){r(event);});},i.prototype._inArray=function(t,e){for(var i in e){if(t===e[i].func)return 0;}return-1;},i.prototype.getMatchedList=function(t){var e=[];return $.grep(this.paletteDataList,function(i){$.merge(e,$.grep(i.functions,function(e){return e.func.toLowerCase().indexOf(t.toLowerCase())>-1;}));}),e;},i.prototype.createFunctions=function(e){var i=this,n=[];return this.paletteDataList=e,$.each(e,function(e,r){if(r.visible){n.push(r);var o,s=$('<div class = "brtc-va-views-palette-fnunit-list"></div>');$.each(r.functions,function(e,n){if(n.visible){o={name:n.func,categoryKey:r.category,detailCallbackFunc:i.setFunctionFormat};t.VA.Implementation.Script.Utils.WidgetUtils.createPaletteItem(s,i.$infoList,o);}}),i.$navigator.append('<div>   <div">       <div class="brtc-va-views-palette-fnunit-type"">'+t.VA.Core.Utils.WidgetUtils.convertHTMLSpecialChar(r.label)+"</div>   </div></div>"),i.$navigator.append(s);}}),n;},i.prototype.setFunctionFormat=function(i,n,r){var o={url:"api/va/v2/help/functionformat/"+r+"?context=scala",type:"GET"},s="not yet supported";$.ajax(o).done(function(r){if(r.format){for(var o=r.format.replace(/[“”]/g,'"'),a="";""!=o;){var l=o.indexOf("function("),c=-1;-1!=l&&(c=o.indexOf("function(",l+1));""!=a&&(a+="\n"),a+=-1==c?o.substring(l):o.substring(l,c),o=-1!=c?o.substring(c):"";}s=a,t.VA.Core.Utils.WidgetUtils.putData(i,e.SIDEBAR_TEMPLATE,a);}n&&n.text(s);});},i.prototype._draggableFnUnit=function(i){var n=this;i.draggable({appendTo:"body",scroll:!1,cursor:"move",cursorAt:{left:5,top:5},helper:function helper(r){var o=$(this).clone();o.css({"z-index":5100,width:"230px"});var s=t.VA.Core.Utils.WidgetUtils.getData(i,e.SIDEBAR_FN_NAME);t.VA.Core.Utils.WidgetUtils.putData(o,e.SIDEBAR_FN_NAME,s);var a=t.VA.Core.Utils.WidgetUtils.getData(i,e.SIDEBAR_TEMPLATE);if(a)t.VA.Core.Utils.WidgetUtils.putData(o,e.SIDEBAR_TEMPLATE,a);else{var l=t.VA.Core.Utils.WidgetUtils.getData(i,e.SIDEBAR_FN_NAME);n.setFunctionFormat(i,void 0,l);}return o;},start:function start(t,e){$(".brtc-va-studio").addClass("brtc-va-studio-dragging"),$(".brtc-va-figure-scriptunit").addClass("dragging-function"),$(this).draggable("option","cursorAt",{left:Math.floor(e.helper.width()/2),top:Math.floor(e.helper.height()/2)});},drag:function drag(t,e){e.helper.trigger("feedback",[{clientX:t.clientX,clientY:t.clientY}]);},stop:function stop(t,e){$(".brtc-va-studio").removeClass("brtc-va-studio-dragging"),$(".brtc-va-figure-scriptunit").removeClass("dragging-function");}});},t.VA.Implementation.Script.Views.FunctionList=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(t,e){this.parentId=t,this.options=e||{},this.retrieveParent(),this.createControls(),this.init(),this.refresh();}e.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},e.prototype.init=function(){var t=this;this.commandListener=function(e){t.isRendered?(t.isRendered=!1,t.handleCommand(e),t.isRendered=!0):t.handleCommand(e);},this.options.editor.addCommandListener(this.commandListener),this.options.editor.addGoHistoryListener(this.commandListener);},e.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-style-tab-content">   <div class="brtc-style-button-area" />   <div class="brtc-style-search-area" />   <div class="brtc-style-result-count-area" />   <div class="brtc-style-list-area" /></div>'),this.$mainControl.css({width:this.options.width,height:this.options.height}),this.$parent.append(this.$mainControl),this.createButtonControl(this.$mainControl.find(".brtc-style-button-area")),this.createFilterControl(this.$mainControl.find(".brtc-style-search-area")),this.createResultControl(this.$mainControl.find(".brtc-style-result-count-area")),this.$mainControl.find(".brtc-style-list-area").perfectScrollbar();},e.prototype.createButtonControl=function(e){var i=this;e.append($('   <input type="button" class="brtc-va-implementation-script-views-scriptunitlist-addscala" value="+ Add Scala"/>   <input type="button" class="brtc-va-implementation-script-views-scriptunitlist-addpython" value="+ Add Python"/>   <input type="button" class="brtc-va-implementation-script-views-scriptunitlist-addsql" value="+ Add SQL"/>'));var n={theme:t.VA.Env.Theme,width:"85px",height:31};e.find(".brtc-va-implementation-script-views-scriptunitlist-addscala").jqxButton(n),e.find(".brtc-va-implementation-script-views-scriptunitlist-addscala").on("click",function(){i.doCreateUnit(i.createNewFnUnit("scala"));}),e.find(".brtc-va-implementation-script-views-scriptunitlist-addpython").jqxButton(n),e.find(".brtc-va-implementation-script-views-scriptunitlist-addpython").on("click",function(){i.doCreateUnit(i.createNewFnUnit("python"));}),e.find(".brtc-va-implementation-script-views-scriptunitlist-addsql").jqxButton(n),e.find(".brtc-va-implementation-script-views-scriptunitlist-addsql").on("click",function(){i.doCreateUnit(i.createNewFnUnit("sql"));});},e.prototype.createFilterControl=function(e){var i=this,n=$('<input type="search" class="brtc-va-implementation-script-views-scriptunitlist-filter" maxlength="80"/>');e.append(n),n.jqxInput({placeHolder:"Search Script",theme:t.VA.Env.Theme});var r=function r(t){var e=t.target.value.toLowerCase(),n=i.$mainControl.find(".brtc-style-figure-scriptunit-label"),r=0;$.each(n,function(t,i){var n=$(i).text().toLowerCase(),o=e,s=n.indexOf(o)>-1;s&&r++,$(i).parents(".brtc-style-figure-scriptunit").css("display",s?"block":"none");}),i.$mainControl.find(".brtc-style-result-count-area").find("span:eq(1)").text(r),i.$mainControl.perfectScrollbar("update");};n.keyup(function(t){r(t);}),n.on("search",function(){r(event);});},e.prototype.createResultControl=function(t){var e=$('<span>Result</span><span class="scriptunitlist-result-count">0</span>');t.append(e);},e.prototype.refresh=function(){var t=this.options.editor.getModel().functions,e=this.$mainControl.find(".brtc-style-list-area");for(var i in e.empty(),t){this.createScriptUnit(e,t[i]);}this.$mainControl.find(".brtc-style-result-count-area").find("span:eq(1)").text(t.length),this.options.editor.$mainControl.find(".brtc-va-figure-scriptunit.status-selection")&&this.setSelection(this.options.editor.$mainControl.find(".brtc-va-figure-scriptunit.status-selection").attr("fid")),this.$mainControl.find(".brtc-style-list-area").perfectScrollbar("update");},e.prototype.createScriptUnit=function(t,e){var i=this,n=e.display.label,r=e.display.description,o="sql"==e.func?"SQL":"scala"==e.func?"SCALA":"PYTHON",s=$('<div class="brtc-style-figure-scriptunit brtc-style-s-figure-scriptunit" func="'+e.func+'" fid="'+e.fid+'">   <div class="brtc-style-figure-scriptunit-header brtc-style-col-12">       <div class="brtc-style-figure-scriptunit-type brtc-style-s-figure-scriptunit-type">'+o+'</div>       <div class="brtc-style-figure-scriptunit-label brtc-style-s-figure-scriptunit-label"></div>       <div class="brtc-style-figure-scriptunit-toolitem brtc-style-s-figure-scriptunit-toolitem" title="Edit" item-type="edit"></div>   </div>   <div class="brtc-style-figure-scriptunit-contents brtc-style-s-figure-scriptunit-contents brtc-style-col-12">'+r+"</div></div>");s.find(".brtc-style-figure-scriptunit-label.brtc-style-s-figure-scriptunit-label").text(n),s.find(".brtc-style-figure-scriptunit-label").attr("title",e.display.label),s.find(".brtc-style-figure-scriptunit-contents").attr("title",r),t.append(s),this.createEditToolItem(s,e),s.on("click",function(){i.setSelection($(this).attr("fid"),!1),i.options.editor.setSelection(e,!1);});},e.prototype.setSelection=function(t,e){this.$mainControl.find(".brtc-style-figure-scriptunit").removeClass("status-selected");var i=this.$mainControl.find('.brtc-style-figure-scriptunit[fid="'+t+'"]');if(i.addClass("status-selected"),1==i.length){var n=this.$mainControl.find(".brtc-style-figure-scriptunit:eq(0)");if(e){var r=i.position().top-n.position().top;this.$mainControl.find(".brtc-style-list-area").animate({scrollTop:r<0?0:r},500);}}},e.prototype.createEditToolItem=function(e,i){var n=this;e.find('.brtc-style-figure-scriptunit-toolitem[item-type="edit"]').on("click",function(){var e={title:"Edit",label:i.display.label||"",description:i.display.description||"",close:function close(t){if(t.OK){var e=$("<div/>").html(t.description).text();i.display.label==t.label&&i.display.description==e||n.doEdit(i.fid,t.label,e);}}};new t.VA.Core.Dialogs.EditResourceDialog(n.$mainControl,e);});},e.prototype.doCreateUnit=function(e){var i=this.options.editor.getModel().functions.length,n=this.$mainControl.find(".brtc-style-figure-scriptunit.status-selected");n.length>0&&(i=n.index());var r=new t.VA.Implementation.Script.Editors.Diagram.Commands.NewScriptUnitCommand(this,{fnUnit:e,index:i+1});this.fireCommand(r);},e.prototype.createNewFnUnit=function(t){var e=this.options.editor.getModel().newFnUnit(t);return"sql"===t&&(e.param.alias={}),e;},e.prototype.doEdit=function(e,i,n){var r=new t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand(this,{fid:e,name:i,label:"Rename Script",description:n});this.fireCommand(r);},e.prototype.fireCommand=function(t){this.options.editor.getCommandManager().execute(t);},e.prototype.handleCommand=function(e){e instanceof t.VA.Core.Editors.Diagram.Commands.GoHistoryCommand?this.refresh():e instanceof t.VA.Core.CompoundCommand?this.handleCompoundCommand(e):e instanceof t.VA.Core.Editors.Diagram.Commands.RenameFnUnitCommand?this.handleEdit(e):e instanceof t.VA.Implementation.Script.Editors.Diagram.Commands.RemoveScriptUnitCommand?this.handleRemoveUnit(e):e instanceof t.VA.Implementation.Script.Editors.Diagram.Commands.NewScriptUnitCommand&&this.handleNewUnit(e);},e.prototype.handleNewUnit=function(t){this.refresh(),"REDO"==t.event.type||"EXECUTE"==t.event.type?this.setSelection(t.options.fnUnit.fid):this.setSelection();},e.prototype.handleRemoveUnit=function(t){this.refresh(),"REDO"==t.event.type||"EXECUTE"==t.event.type?this.setSelection():this.setSelection(t.options.fid);},e.prototype.handleEdit=function(t){var e,i,n=this.$mainControl.find('.brtc-style-figure-scriptunit[fid="'+t.options.fid+'"]');"REDO"==t.event.type||"EXECUTE"==t.event.type?(e=t.options.name,i=t.options.description):"UNDO"==t.event.type&&(e=t.old.name,i=t.old.description),n.find(".brtc-style-figure-scriptunit-label").attr("title",e),n.find(".brtc-style-figure-scriptunit-label").text(e),n.find(".brtc-style-figure-scriptunit-contents").attr("title",i),n.find(".brtc-style-figure-scriptunit-contents").html(i);},e.prototype.handleCompoundCommand=function(t){var e;if("REDO"==t.event.type||"EXECUTE"==t.event.type)for(e in t.commandList){this.handleCommand(t.commandList[e]);}else if("UNDO"==t.event.type)for(e=t.commandList.length-1;e>-1;e--){this.handleCommand(t.commandList[e]);}},e.prototype.selectionChanged=function(t){t&&this.setSelection(t.fid,!0);},t.VA.Implementation.Script.Views.ScriptUnitList=e;}.call(this),function(){"use strict";var t=this.Brightics,e=t.VA.Core.Utils;function i(t,e){this.parentId=t,this.options=e,this.retrieveParent(),this.createControls();}i.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},i.prototype.createControls=function(){this.$mainControl=$('<div class="brtc-va-views-udf brtc-va-tab-contents brtc-style-tab-content">   <div class="brtc-va-views-udf-filter brtc-va-searcharea brtc-style-search-area"></div>   <div class="brtc-va-views-udf-navigator brtc-va-create-button" style="display: block">       <input class="brtc-va-views-udf brtc-va-create-button" type="button" id="addonfunction-dialog-local-create" value="Create UDF" />   </div>   <div class="brtc-va-views-udf-navigator brtc-va-import-button" style="display: block">       <input class="brtc-va-views-udf brtc-va-import-button" type="button" id="addonfunction-dialog-local" value="Import UDF" />   </div>   <div class="brtc-va-views-udf-navigator-wrapper brtc-va-contentsarea">   </div></div>'),this.$parent.append(this.$mainControl);var i=this,n=this.$mainControl.find("#addonfunction-dialog-local-create"),r=this.$mainControl.find("#addonfunction-dialog-local");r.jqxButton({theme:t.VA.Env.Theme}),n.jqxButton({theme:t.VA.Env.Theme}),n.on("click",function(){var t=window.location.origin+"/toolkit/udf-generator";window.open(t,"Brightics ToolKit");}),r.on("click",function(){new t.VA.Core.Dialogs.ImportUDFDialog(i.$mainControl,{fileType:"AddonFunction",title:"Import UDF",close:function close(t){t.OK&&(e.WidgetUtils.openInformationDialog("Imported successfully new UDF"),i.refreshControl());}});}),this.$udfFilter=this.$mainControl.find(".brtc-va-views-udf-filter"),this.$udfNavigator=this.$mainControl.find(".brtc-va-views-udf-navigator-wrapper"),this.createFilterControl(),this.createUDFViewer(),this.$mainControl.find(".brtc-va-views-udf-navigator-wrapper").perfectScrollbar();},i.prototype.createFilterControl=function(){var i=this,n=$('<input type="search" class="brtc-va-views-udf-filter-input searchinput"/>');this.$udfFilter.append(n),n.jqxInput({placeHolder:"Search Function",theme:t.VA.Env.Theme});var r=function r(n){var r=n.target.value.toLowerCase(),o=t.VA.Core.Functions.Library.getListByTags([r.trim()]),s=i.$mainControl.find(".brtc-va-views-udf-fnunit");$.each(s,function(t,i){var n=$(i).parent(),r=e.WidgetUtils.getData(n.find(".brtc-va-views-udf-fnunit"),"udf");n.css("display",$.inArray(r.udf_id,o)>-1?"block":"none");});var a=i.$mainControl.find(".brtc-va-views-udf-fnunit-list");$.each(a,function(t,e){var i=$(e).find(".brtc-va-views-udf-fnunit-content").filter(function(){return"block"==$(this).css("display");});$(e).css("display",i.length>0?"block":"none"),$(e).prev().css("display",i.length>0?"block":"none");}),i.$mainControl.find(".brtc-va-views-udf-navigator-wrapper").perfectScrollbar("update");};n.keyup(function(t){r(t);}),n.on("search",function(){r(event);});},i.prototype.createUDFViewer=function(){var e=this;$.ajax({url:"api/va/v3/ws/udfs/me",type:"GET",contentType:"application/json; charset=utf-8",blocking:!1}).done(function(i){var n=[];for(var r in t.VA.Core.Functions.Library){t.VA.Core.Functions.Library[r].category&&"udf"==t.VA.Core.Functions.Library[r].category&&n.push(r);}e.udfList=i.filter(function(t){if($.inArray(t.id,n)>-1)return t;}),e.createUDFs();});},i.prototype.refreshControl=function(){this.$udfNavigator.empty(),Studio.getInstance().reloadResource(),this.createUDFViewer(),this.$mainControl.find(".brtc-va-views-udf-navigator-wrapper").perfectScrollbar("update");},i.prototype.createUDFs=function(){var i=this.udfList,n=this,r=$('<div class = "brtc-va-views-udf-fnunit-list"></div>');n.$udfNavigator.append(r),$.each(i,function(i,o){var s=function(e,i){return function(e){e.OK&&$.ajax({url:"api/va/v3/ws/udfs/"+i.id,type:"DELETE",contentType:"application/json; charset=utf-8",blocking:!0}).done(function(t){"OK"===t&&n.refreshControl();}).fail(function(e){t.VA.Core.Utils.WidgetUtils.openBadRequestErrorDialog(e);});};}(0,o);e.WidgetUtils.createUDFItem(r,o,"data",s,function(){$.ajax({url:"api/va/v3/ws/udfs/"+o.id,type:"GET",contentType:"application/json; charset=utf-8",blocking:!0}).done(function(t){});});});},i.prototype.createFormatDragEvent=function(t,e){},i.prototype.createUDFFnUnit=function(e,i){var n="PythonScript"==e.type?$.extend(!0,{},t.VA.Implementation.Script.Functions.python.defaultFnUnit):$.extend(!0,{},t.VA.Implementation.Script.Functions.scala.defaultFnUnit);n.display.label=e.udf_name,n.display.description=e.description,n.param.script=e.contents;var r=i.filter(function(t){return"IN"===t.inout_type;}),o=[];for(var s in r){var a=[];a.push(r[s].param_name),a.push(r[s].arg_type),a.push(""),o.push(a);}var l=i.filter(function(t){return"OUT"===t.inout_type;}),c=[];for(var s in l){c.push(l[s].param_name);}return n.param["input-variables"]=o,n.param["out-table-alias"]=c,n;},i.prototype.udfChanged=function(){this.refreshControl();},t.VA.Implementation.Script.Views.UDFViewer=i;}.call(this),function(){"use strict";var t=this.Brightics;function e(e){t.VA.Core.Tools.Manager.SideBarManager.call(this,e);}e.prototype=Object.create(t.VA.Core.Tools.Manager.SideBarManager.prototype),e.prototype.constructor=e,e.prototype.configureLayout=function(){this.layout={script:{id:"script",label:"Script",position:"left",width:310,manager:this},scriptPalette:{id:"scriptPalette",label:"Palette",position:"right",width:311,manager:this}};},e.prototype.createControls=function(){this.sideBar.script=new t.VA.Core.Tools.SideBar.ScriptSideBar(this.$parent.find(".brtc-va-studio-sidebar[name=script]"),this.layout.script),this.sideBar.scriptPalette=new t.VA.Core.Tools.SideBar.ScriptPaletteSideBar(this.$parent.find(".brtc-va-studio-sidebar[name=scriptPalette]"),this.layout.scriptPalette);},e.prototype.onActivated=function(){this.sideBar.scriptPalette.onActivated();},t.VA.Implementation.Script.Tools.Manager.SideBarManager=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.prototype),e.prototype.constructor=e,e.prototype.registerItems=function(){var e=t.VA.Implementation.Script.Toolbar.ItemsTemplate;for(var i in e){this.addItem(e[i]);}},t.VA.Implementation.Script.Toolbar=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.FunctionhelpItem.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.FunctionhelpItem.prototype),e.prototype.constructor=e,e.prototype.handleOnClick=function(e){t.VA.Core.Utils.ModelUtils.openFunctionReferencePopup("script","PythonScript");},t.VA.Implementation.Script.Toolbar.FunctionhelpItem=e;}.call(this),function(){"use strict";var t=this.Brightics;function e(e,i){t.VA.Core.Editors.Toolbar.RunItem.call(this,e,i);}e.prototype=Object.create(t.VA.Core.Editors.Toolbar.RunItem.prototype),e.prototype.constructor=e,e.prototype.handleOnClick=function(t){var e=Studio.getEditorContainer().getActiveModelEditor().getModel();Studio.getJobExecutor().launchModel(e);},t.VA.Implementation.Script.Toolbar.RunItem=e;}.call(this),function(){"use strict";var t=this.Brightics;t.VA.Implementation.Script.Toolbar.ItemsTemplate=[{class:t.VA.Implementation.Script.Toolbar.RunItem},{class:t.VA.Core.Editors.Toolbar.Separator},{class:t.VA.Core.Editors.Toolbar.HistoryItem},{class:t.VA.Core.Editors.Toolbar.RedoItem},{class:t.VA.Core.Editors.Toolbar.UndoItem},{class:t.VA.Core.Editors.Toolbar.Separator},{class:t.VA.Implementation.Script.Toolbar.FunctionhelpItem}];}.call(this),function(){"use strict";var t=this,e=t.Brightics;e.VA.Implementation.Script.Utils.RunnableFactory={_create:function _create(t,e){return{jid:t,user:e,main:"",args:{},models:{}};},createForUnit:function createForUnit(t,i,n,r,o){var s=this._create(i,n);delete s.args;var a=$.extend(!0,{},t);a.display&&a.display.label&&(a.label=a.display.label||"",delete a.display),e.VA.Core.Utils.ModelUtils.deleteEmptyArray(a),a.persist=!0;var l=t.parent().mid;return s.main=l,s.models[l]={title:a.label,mid:l,type:"script",functions:[a],"persist-mode":"auto",entries:[a.fid],links:[]},s.version=e.VA.Env.CoreVersion,s;},createForFlow:function createForFlow(i,n,r,o,s){var a=this._create(n,r);delete a.args;var l=i.mid;a.main=l;var c=e.VA.Core.Utils.ModelUtils.exportAsRunnable(i);for(var p in c.functions){var u=c.functions[p];u.display&&u.display.label&&(u.label=u.display.label||"",delete u.display),e.VA.Core.Utils.ModelUtils.deleteEmptyArray(u);}c.links=[];for(var d=1;d<c.functions.length;d++){c.links.push({kid:t.Brightics.VA.Core.Utils.IDGenerator.link.id(),sourceFid:c.functions[d-1].fid,targetFid:c.functions[d].fid});}return c.entries=[c.functions[0].fid],a.models[l]=c,a.version=e.VA.Env.CoreVersion,a;}};}.call(this),function(){"use strict";var t=this;t.Brightics.VA.Implementation.Script.Utils.WidgetUtils={createPaletteItem:function createPaletteItem(e,i,n){var r=t.Brightics.VA.Implementation.Script.Constants,o=$('<div class="brtc-va-views-palette-fnunit-content">'),s=$('<div class="brtc-va-views-palette-fnunit brtc-style-views-palette-fnunit script brtc-va-studio-dm-draggable">   <div class="brtc-va-views-palette-fnunit-icon brtc-style-views-palette-fnunit-icon"></div>   <div class="brtc-va-views-palette-fnunit-label brtc-style-views-palette-fnunit-label script"></div>   <div class="brtc-va-views-palette-fnunit-info brtc-style-views-palette-fnunit-info"></div></div>');o.append(s),Brightics.VA.Core.Utils.WidgetUtils.putData(s,r.SIDEBAR_FN_NAME,n.name),e.append(o),s.find(".brtc-va-views-palette-fnunit-label").text(n.name);var a=$('<div class="brtc-va-views-palette-fnunit-info-detail brtc-style-views-palette-fnunit-info-detail"></div>'),l=$('<div class="brtc-va-views-palette-fnunit-info-detail-contents brtc-style-views-palette-fnunit-info-detail-contents"></div>');a.append(l),o.find(".brtc-va-views-palette-fnunit").click(function(){n.detailCallbackFunc(s,l,n.name);});var c=!1;s.find(".brtc-va-views-palette-fnunit-info").click(function(){Brightics.VA.Core.Utils.ModelUtils.openFunctionReferencePopup("script",n.name,"scala",n.func);}).hover(function(t){var e=$(this).parent(),o=e.parent().parent(),p=e.offset().top-o.parent().offset().top+e.height();if(!c){var u=Brightics.VA.Core.Utils.WidgetUtils.getData(e,r.SIDEBAR_TEMPLATE);u?l.text(u):n.detailCallbackFunc(s,l,n.name),c=!0;}i.append(a),a.css({top:p}),a.css("display","block");},function(t){a.css("display","none");});var p="brtc-va-fnunit-category-"+n.categoryKey;return s.addClass(p),s;}};}.call(this),function(){"use strict";var t=this.Brightics.VA.Implementation.Script,e=t.Clazz,i=this.Brightics.VA.Core.Interface;i.Clazz[e]=e,i.Label[e]=t.Label,i.Validator[e]=t.Validator,i.Editor[e]=t.Editor,i.Toolbar[e]=t.Toolbar,i.SideBarManager[e]=t.Tools.Manager.SideBarManager,i.Launcher[e]=t.ScriptModelLauncher,i.DefaultModel[e]=t.defaultModel,i.Functions[e]=t.Functions,i.WidgetUtils[e]=t.Utils.WidgetUtils,i.ProjectContextMenuList[e]=["duplicate","export","version"],i.ModelLayoutManager[e]=t.ModelLayoutManager,i.RunnableFactory[e]=t.Utils.RunnableFactory;}.call(this);