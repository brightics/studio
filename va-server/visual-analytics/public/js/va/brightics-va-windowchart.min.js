/*   Brightics VA Build 190718 */(function(){"use strict";var t=this.Brightics;function o(t,o){this.parentId=t,this.options=o||{},this.retrieveParent(),this._init(),this.createLayout(),this.createControls();}o.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},o.prototype._init=function(){this.options.propOpt={error:[]};},o.prototype._getPropertyType=function(){},o.prototype.createLayout=function(){this.$mainControl=$('<div class="brtc-mc-property" type="'+this._getPropertyType()+'">   <div class="brtc-mc-title"></div>   <div class="brtc-mc-container"></div></div>'),this.$parent.append(this.$mainControl);},o.prototype.createControls=function(){this.createHeader(),this.createBody(this.$mainControl.find(".brtc-mc-container"));},o.prototype.createHeader=function(){this.$mainControl.find(".brtc-mc-title").text(this.getTitle());},o.prototype.getTitle=function(){},o.prototype.createBody=function(t){},o.prototype.getPropertyOption=function(){return this.options.propOpt;},this.Brightics.VA.Window.Property=o;}).call(this),function(){"use strict";this.Brightics.VA.Window.Utils.CommonUtils={getParameterByName:function getParameterByName(t,o){t=t.replace(/[\[\]]/g,"\\$&");var e=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(o);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null;},retrieveFile:function retrieveFile(t){this.showProgress();var o=this,e={url:"api/va/v2/ws/projects/"+t.pid+"/files/"+t.mid,type:"GET",contentType:"application/json; charset=utf-8",blocking:!0};return $.ajax(e).done(function(e){var r=new Brightics.VA.Core.Tools.ModelMigrator.Executor();o.hideProgress();var n=e[0];n?(r.migrate(n.contents),o.retrieveChartOptions(t,n.contents)):alert("Could not found model.");}).fail(function(t){o.showMessage("Cannot get data. Table not found.");});},retrieveChartOptions:function retrieveChartOptions(t,o){var e=o.functions;if($.isArray(e)&&e.length>0){var r=e.find(function(o){return o.fid==t.fid;});for(var n in r.display.sheet){var i=r.display.sheet[n];for(var s in i){var a=i[s][0].panel.find(function(o){return o.id==t.cid;});if(void 0!==a)return t.chartOption=a.chartOption,void _.assign(t,{propOpt:a.multiChartOption});}}}},retrieveDataSource:function retrieveDataSource(t){this.showProgress();var o={user:t.user,mid:t.mid,tab:t.tid,offset:0,limit:1},e=$.map(o,function(t,o){return o+"="+t;}).join("&"),r=this,n={url:"api/va/v2/data/staging/query?"+e,type:"GET",contentType:"application/json; charset=utf-8",blocking:!0};return $.ajax(n).done(function(o){r.hideProgress(),t.datasource=o;}).fail(function(t){r.showMessage("Cannot get data. Table not found.");});},showProgress:function showProgress(t){$(".brtc-mc-progress > span").text(t),$(".brtc-mc-progress").show();},hideProgress:function hideProgress(){$(".brtc-dim").hide(),$(".brtc-mc-progress").hide();},showMessage:function showMessage(t){$(".brtc-mc-message > span").text(t),$(".brtc-mc-message").show();},hideMessage:function hideMessage(t){$(".brtc-mc-message").hide();}};}.call(this),function(){"use strict";var t=this.Brightics,o=t.Chart.Adonis.Component.Controls.BaseControl,e=t.Chart.Adonis.Component.Widgets;function r(t,e,r){o.call(this,t,e,r),this.renderProblem(this._validate(this.options.propOpt.groupBy));}r.prototype=Object.create(o.prototype),r.prototype.constructor=r,r.prototype._init=function(){o.prototype._init.call(this),this.titleOption=this.options.chartOption.title;},r.prototype._createContents=function(t){o.prototype._createContents.call(this,t);this.createComponentHeader({label:"Group By"}),this.createComponentContents();},r.prototype.createComponentContents=function(t){o.prototype.createComponentContents.call(this,t),this._createChartSizeWidget(),this._createColumnSelectorWidget();},r.prototype._createChartSizeWidget=function(){var t=this;this.$sizeContent=$('<div class="bos-display-flex bos-flex-direction-column">   <div class="bo-widget-width bos-display-flex-center"></div>   <div class="bo-widget-width-validation"></div>   <div class="bo-widget-height bos-display-flex-center"></div>   <div class="bo-widget-height-validation"></div></div>'),this.$controlContents.append(this.$sizeContent),this.widthInput=e.Factory.createNumberInputWidget(this.$sizeContent.find(".bo-widget-width"),{label:"Width",width:"170px",value:t.options.propOpt.width.replace(/[^0-9.]/g,""),onChanged:function onChanged(o){Number.isNaN(o)?o=Number(this.$inputControl.val().replace(/[^0-9.]/g,"")):o<1?o=1:(!t.options.propOpt.widthUnit||"%"===t.options.propOpt.widthUnit)&&o>100&&(o=100),t.options.propOpt.widthUnit||(t.options.propOpt.widthUnit=t.options.propOpt.width.replace(/[0-9]/g,"")),t.options.propOpt.widthValue=o,t.options.propOpt.width=t.options.propOpt.widthValue+t.options.propOpt.widthUnit,this.render(o),this.$inputControl.trigger("blur");}}),this.widthUnitSwitchButton=e.Factory.createSwitchButtonWidget(this.$sizeContent.find(".bo-widget-width"),{width:"20px",height:"27px",internalLabel:"Width",value:t.options.propOpt.width.replace(/[0-9]/g,""),itemList:[{value:"px",label:"Px"},{value:"%",label:"%"}],onChanged:function onChanged(o){"%"===o&&t.options.propOpt.widthValue&&t.options.propOpt.widthValue>100&&(t.widthInput.render(100),t.widthInput.trigger("blur")),t.options.propOpt.widthValue||(t.options.propOpt.widthValue="33"),t.options.propOpt.widthUnit=o,t.options.propOpt.width=t.options.propOpt.widthValue+t.options.propOpt.widthUnit;}}),this.widthUnitSwitchButton.addCSSInMainControl({"border-left":"none"}),this.heightInput=e.Factory.createNumberInputWidget(this.$sizeContent.find(".bo-widget-height"),{label:"Height",width:"170px",value:t.options.propOpt.height.replace(/[^0-9.]/g,""),onChanged:function onChanged(o){Number.isNaN(o)?o=Number(this.$inputControl.val().replace(/[^0-9.]/g,"")):(o>1e3&&(o=1e3),o<1&&(o=1)),t.options.propOpt.height=o+"px",this.render(o),this.$inputControl.trigger("blur");}}),this.heightUnitSwitchButton=e.Factory.createSwitchButtonWidget(this.$sizeContent.find(".bo-widget-height"),{width:"20px",height:"27px",value:t.options.propOpt.height.replace(/[0-9]/g,""),internalLabel:"Height",itemList:[{value:"px",label:"Px"}],onChanged:function onChanged(o){t.options.propOpt.heightUnit=o;}}),this.heightUnitSwitchButton.addCSSInMainControl({"border-left":"none"});},r.prototype._createColumnSelectorWidget=function(){var o=this,e={aggregationEnabled:!1,aggregationMap:{},chartOption:{},getAllColumns:function getAllColumns(){return o.options.datasource.columns;},getColumns:function getColumns(){return o.options.datasource.columns;},label:"Group By",multiple:!0,problemKeyList:["custom-axis-001"],onChanged:function onChanged(t){o.renderProblem(o._validate(t)),o.options.propOpt.groupBy=t,"function"==typeof o.options.propOpt.columnChanged&&o.options.propOpt.columnChanged(t);},selected:this.options.propOpt.groupBy},r=t.Chart.Adonis.Component.Widgets.Factory.createColumnSelectorWidget(this.$controlContents,e);this._widgetList.push(r);},r.prototype._validate=function(t){if(!t||0==t.length||!t.some(function(t){return!!t;}))return[{key:"custom-axis-001",target:"Group By"}];},r.prototype.renderProblem=function(t){this._widgetList.forEach(function(o){o.renderProblem(t);});},r.prototype._notifyMessage=function(t){this.$parent.closest(".brtc-mchart-main-container").trigger("message:notify",[t]);},t.Chart.Adonis.Component.Controls.GroupByControl=r;}.call(this),function(){"use strict";var t=this.Brightics,o=t.Chart.Adonis.Component.Controls.BaseControl;function e(t,e,r){o.call(this,t,e,r);}e.prototype=Object.create(o.prototype),e.prototype.constructor=e,e.prototype._init=function(){o.prototype._init.call(this),this.titleOption=this.options.chartOption.title;},e.prototype._createContents=function(t){o.prototype._createContents.call(this,t);this.createComponentHeader({label:"Order By"}),this.createComponentContents(),this._renderOrderByControls();},e.prototype.createComponentContents=function(t){o.prototype.createComponentContents.call(this,t),this.createOrderByWidget(),this.createNewSortRuleControl();},e.prototype.createOrderByWidget=function(){var t=this;this.$orderByContent=$('<div class="bos-display-flex bos-flex-direction-column brtc-mc-orderby-property">   <div class="bo-widget-width bos-display-flex-center bos-flex-direction-column brtc-va-editors-sheet-controls-propertycontrol-row-container"></div>   <div class="bo-widget-height-validation"></div></div>'),this.$rowContainer=this.$orderByContent.find(".brtc-va-editors-sheet-controls-propertycontrol-row-container"),this.$controlContents.append(this.$orderByContent),this.$rowContainer.sortable({axis:"y",handle:".brtc-va-editors-sheet-controls-propertycontrol-hover-drag-element-wrapper",update:function update(o,e){if(t.updateIndexNumber(),"function"==typeof t.options.propOpt.orderChanged){var r=$(e.item[0]),n={column:r.attr("column"),index:t.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-row").index(r)};t.options.propOpt.orderChanged(n),t.updateOrderByOption(n);}}});},e.prototype.createNewSortRuleControl=function(t,o){var e=this;t=t||"",o=o||"ASC";var r=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-row">   <div class="brtc-va-editors-sheet-controls-propertycontrol-hover-drag-element-wrapper">      <div class="brtc-va-editors-sheet-controls-propertycontrol-hover-drag-element"></div>      <div class="brtc-va-editors-sheet-controls-propertycontrol-number"></div>   </div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"></div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-button brtc-va-editors-sheet-controls-propertycontrol-sort-mode-button"><i class="fa fa-sort"></i></div></div>');this.$rowContainer.append(r),r.attr("column",t),r.attr("type",this.getColumnType(t)),r.attr("sort-mode",o),r.find(".brtc-va-editors-sheet-controls-propertycontrol-button").attr("title",o);var n=r.find(".brtc-va-editors-sheet-controls-propertycontrol-number"),i=this.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-row").length;n.text(i+""),r.find(".brtc-va-editors-sheet-controls-propertycontrol-hover-drag-element-wrapper").attr("title",i+"");var s=r.find(".brtc-va-editors-sheet-controls-propertycontrol-combobox"),a=this.createColumnList(s,{rowCount:1,multiple:!1,showOpener:"none",removable:!1},"brtc-va-editors-sheet-controls-width-6",{"flex-grow":1,height:"25px"});a.onChange(function(t,o){r.attr("column",o.items[0]),r.attr("type",e.getColumnType(o.items[0])),e.updateSortModeIcon(p,r.attr("sort-mode"),e.getColumnType(o.items[0]));}),a.setItems(this.options.datasource.columns),a.setSelectedItems(t?[t]:[]),r.data("columnList",a),a.columnSelector.$mainControl.dialog("close"),a.columnSelector.$mainControl.dialog("destroy"),a.columnSelector.$mainControl.remove();var p=r.find(".brtc-va-editors-sheet-controls-propertycontrol-button");p.on("click",function(){var t=$(this).parents(".brtc-va-editors-sheet-controls-propertycontrol-row"),o="ASC"===t.attr("sort-mode")?"DESC":"ASC";t.attr("sort-mode",o),$(this).attr("title",o),e.updateSortModeIcon(p,t.attr("sort-mode"),e.getColumnType(t.attr("column"))),e.options.propOpt.orderBy.sortMode[t.attr("column")]=o;}),this.updateSortModeIcon(p,o,this.getColumnType(t)),t&&(this.options.propOpt.orderBy.sortMode[t]="ASC");},e.prototype.updateSortModeIcon=function(t,o,e){var r;t.find("i").removeClass(),"string"===e?(r="fa fa-sort-alpha-"+o.toLowerCase(),t.find("i").addClass(r)):"number"===e||"date"===e?(r="fa fa-sort-numeric-"+o.toLowerCase(),t.find("i").addClass(r)):(r="fa fa-sort",t.find("i").addClass(r));},e.prototype.updateOrderByOption=function(t){var o=t.column,e=t.index,r=this.options.propOpt.orderBy.columns.indexOf(o);this.options.propOpt.orderBy.columns.splice(r,1),this.options.propOpt.orderBy.columns.splice(e,0,o);},e.prototype.updateIndexNumber=function(){this.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-row").each(function(t,o){var e=Number(t)+1+"";$(o).find(".brtc-va-editors-sheet-controls-propertycontrol-hover-drag-element-wrapper").attr("title",e),$(o).find(".brtc-va-editors-sheet-controls-propertycontrol-number").text(e);});},e.prototype.columnChanged=function(t){var o=[],e=[];for(var r in this.$rowContainer.find('.brtc-va-editors-sheet-controls-propertycontrol-row[column=""]').remove(),this.options.propOpt.orderBy.columns){-1===t.indexOf(this.options.propOpt.orderBy.columns[r])&&(o.push(this.options.propOpt.orderBy.columns[r]),this.options.propOpt.orderBy.columns.splice(r,1));}for(var r in t){-1===this.options.propOpt.orderBy.columns.indexOf(t[r])&&(this.options.propOpt.orderBy.columns.push(t[r]),e.push(t[r]));}if(o.length>0)for(var r in o){this.$rowContainer.find('.brtc-va-editors-sheet-controls-propertycontrol-row[column="'+o[r]+'"]').remove(),delete this.options.propOpt.orderBy.sortMode[o[r]];}if(e.length>0)for(var r in e){this.createNewSortRuleControl(e[r]);}0===t.length&&(this.options.propOpt.orderBy={columns:[],sortMode:{}},this.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-row").remove(),this.createNewSortRuleControl()),this.updateIndexNumber();},e.prototype.getColumnType=function(t){for(var o in this.options.datasource.columns){if(this.options.datasource.columns[o].name===t)return this.options.datasource.columns[o].type;}},e.prototype.createColumnList=function(o,e,r,n){var i=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');o.wrap(i);var s="";r&&(s=s.concat(" ",r)),o.parent().addClass(s),n&&o.parent().css(n);var a={multiple:!0,rowCount:1,maxRowCount:5,expand:!1,sort:"none",sortBy:"name",showOpener:"none",removable:!0,defaultType:"-",changed:function changed(t,o){},added:function added(){},removed:function removed(){}};return e&&$.extend(a,e),new t.VA.Core.Editors.Sheet.Controls.ColumnList(o,a);},e.prototype._renderOrderByControls=function(){for(var t in this.options.propOpt.orderBy.columns.length>0&&this.$rowContainer.find('.brtc-va-editors-sheet-controls-propertycontrol-row[column=""]').remove(),this.options.propOpt.orderBy.columns){var o=this.options.propOpt.orderBy.columns[t];this.createNewSortRuleControl(o,this.options.propOpt.orderBy.sortMode[o]);}},t.Chart.Adonis.Component.Controls.OrderByControl=e;}.call(this),function(){"use strict";var t=this.Brightics,o=t.Chart.Adonis.Component.Controls.BaseControl;t.Chart.Adonis.Component.Widgets;function e(t,e,r){o.call(this,t,e,r);}e.prototype=Object.create(o.prototype),e.prototype.constructor=e,e.prototype._init=function(){o.prototype._init.call(this),this.titleOption=this.options.chartOption.title,this.columns=$.extend(!0,[],this.options.propOpt.orderBy.columns);},e.prototype._createContents=function(t){o.prototype._createContents.call(this,t);this.createComponentHeader({label:"Title"}),this.createComponentContents(),this._renderTitleControl();},e.prototype.createComponentContents=function(t){o.prototype.createComponentContents.call(this,t),this.createTitleWidget(),this.createNewTitleRow();},e.prototype.createTitleWidget=function(){this.$titleContent=$('<div class="bos-display-flex bos-flex-direction-column brtc-mc-title-property">   <div class="bo-widget-width bos-display-flex-center bos-flex-direction-column brtc-va-editors-sheet-controls-propertycontrol-row-container"></div>   <div class="bo-widget-height-validation"></div></div>'),this.$rowContainer=this.$titleContent.find(".brtc-va-editors-sheet-controls-propertycontrol-row-container"),this.$controlContents.append(this.$titleContent);},e.prototype.createNewTitleRow=function(t,o){var e=this;t=t||"";var r=$('<div class="brtc-va-editors-sheet-controls-propertycontrol-row">   <div class="brtc-va-editors-sheet-controls-propertycontrol-checkbox" param-value="'+t+'"></div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-hover-drag-element-wrapper">       <div class="brtc-va-editors-sheet-controls-propertycontrol-number"></div>   </div>   <div class="brtc-va-editors-sheet-controls-propertycontrol-combobox"></div></div>');this.$rowContainer.append(r),r.attr("column",t),r.attr("type",this.getColumnType(t));var n=r.find(".brtc-va-editors-sheet-controls-propertycontrol-number"),i=this.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-row").length;n.text(i+"");var s=r.find(".brtc-va-editors-sheet-controls-propertycontrol-combobox"),a=this.createColumnList(s,{rowCount:1,multiple:!1,showOpener:"none",removable:!1},"brtc-va-editors-sheet-controls-width-6",{"flex-grow":1,height:"25px"});a.onChange(function(t,o){r.attr("column",o.items[0]),r.attr("type",e.getColumnType(o.items[0]));}),a.setItems(this.options.datasource.columns),a.setSelectedItems(t?[t]:[]),r.data("columnList",a),a.columnSelector.$mainControl.dialog("close"),a.columnSelector.$mainControl.dialog("destroy"),a.columnSelector.$mainControl.remove();var p=r.find(".brtc-va-editors-sheet-controls-propertycontrol-checkbox"),c={};!1===o&&(c.checked=!1),e.createCheckBox(p,c,""),p.on("change",function(t){e.updateTitleOption();});},e.prototype.createColumnList=function(o,e,r,n){var i=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');o.wrap(i);var s="";r&&(s=s.concat(" ",r)),o.parent().addClass(s),n&&o.parent().css(n);var a={multiple:!0,rowCount:1,maxRowCount:5,expand:!1,sort:"none",sortBy:"name",showOpener:"none",removable:!0,defaultType:"-",changed:function changed(t,o){},added:function added(){},removed:function removed(){}};return e&&$.extend(a,e),new t.VA.Core.Editors.Sheet.Controls.ColumnList(o,a);},e.prototype.createCheckBox=function(o,e,r,n){var i=$('<div class="brtc-va-editors-sheet-controls-wrapper"></div>');o.wrap(i);var s="brtc-va-editors-sheet-controls-checkbox-default";r&&(s=s.concat(" ",r)),o.parent().addClass(s),n&&o.parent().css(n);var a={theme:t.VA.Env.Theme,checked:!0};return e&&$.extend(a,e),o.jqxCheckBox(a),o;},e.prototype.updateIndexNumber=function(){this.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-row").each(function(t,o){var e=Number(t)+1+"";$(o).find(".brtc-va-editors-sheet-controls-propertycontrol-hover-drag-element-wrapper").attr("title",e),$(o).find(".brtc-va-editors-sheet-controls-propertycontrol-number").text(e);});},e.prototype.updateTitleOption=function(){var t=[];$.each(this.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-checkbox"),function(o,e){$(e).jqxCheckBox("checked")&&t.push($(e).attr("param-value"));}),this.options.propOpt.title=t;},e.prototype.columnChanged=function(t){var o=[],e=[];for(var r in this.$rowContainer.find('.brtc-va-editors-sheet-controls-propertycontrol-row[column=""]').remove(),this.columns){-1===t.indexOf(this.columns[r])&&(o.push(this.columns[r]),this.columns.splice(r,1));}for(var r in t){-1===this.columns.indexOf(t[r])&&(this.columns.push(t[r]),e.push(t[r]));}if(o.length>0)for(var r in o){this.$rowContainer.find('.brtc-va-editors-sheet-controls-propertycontrol-row[column="'+o[r]+'"]').remove();}if(e.length>0)for(var r in e){this.createNewTitleRow(e[r]);}0===t.length&&(this.columns=[],this.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-row").remove(),this.createNewTitleRow()),this.updateIndexNumber(),this.updateTitleOption();},e.prototype.orderChanged=function(t){var o=t.column,e=t.index,r=this.$rowContainer.find('.brtc-va-editors-sheet-controls-propertycontrol-row[column="'+o+'"]').detach(),n=this.$rowContainer.find(".brtc-va-editors-sheet-controls-propertycontrol-row");0===e?r.insertBefore(n.eq(0)):r.insertAfter(n.eq(e-1)),this.updateIndexNumber(),this.updateTitleOption();},e.prototype.getColumnType=function(t){for(var o in this.options.datasource.columns){if(this.options.datasource.columns[o].name===t)return this.options.datasource.columns[o].type;}},e.prototype._renderTitleControl=function(){for(var t in this.options.propOpt.orderBy.columns.length>0&&this.$rowContainer.find('.brtc-va-editors-sheet-controls-propertycontrol-row[column=""]').remove(),this.options.propOpt.orderBy.columns){var o=!0;-1===this.options.propOpt.title.indexOf(this.options.propOpt.orderBy.columns[t])&&(o=!1),this.createNewTitleRow(this.options.propOpt.orderBy.columns[t],o);}},t.Chart.Adonis.Component.Controls.MultiChartTitleControl=e;}.call(this),function(){"use strict";var t=this.Brightics,o=t.VA.Window.Utils.CommonUtils,e=brtc_require("TabChannel");function r(t,o){this.parentId=t,this.options=o||{},this.properties={MultiChartSettings:{}},this.init(),this.retrieveParent(),this.createLayout(),this.createControls(),this.createNotification();}r.prototype.retrieveParent=function(){this.$parent=t.VA.Core.Utils.WidgetUtils.retrieveWidget(this.parentId);},r.prototype.init=function(){this.executor=new t.VA.Window.MultiChartExecutor(),this.params={user:t.VA.Window.Utils.CommonUtils.getParameterByName("user",this.options.url),pid:t.VA.Window.Utils.CommonUtils.getParameterByName("pid",this.options.url),mid:t.VA.Window.Utils.CommonUtils.getParameterByName("mid",this.options.url),fid:t.VA.Window.Utils.CommonUtils.getParameterByName("fid",this.options.url),tid:t.VA.Window.Utils.CommonUtils.getParameterByName("tid",this.options.url),cid:t.VA.Window.Utils.CommonUtils.getParameterByName("cid",this.options.url),ch:parseInt(t.VA.Window.Utils.CommonUtils.getParameterByName("ch",this.options.url))},this.params.chartTypeList=Object.keys(t.Chart.Registry).filter(function(t){return!["table","dendrogram","biplot","decisionTree"].includes(t);}),this.tabChannel=new e(this.params.ch);},r.prototype.createLayout=function(){this.$mainControl=$('<div class="brtc-mchart-main-container">   <div class="brtc-notification-container"/>   <div class="brtc-left-contents"></div>   <div class="brtc-right-properties"/></div>'),this.$parent.append(this.$mainControl);},r.prototype.createControls=function(){$(document).bind("contextmenu",function(t){return!1;}),this.executor.setTarget(this.$parent.find(".brtc-left-contents")),this.createProperties(this.$parent.find(".brtc-right-properties")),this.createGenerator(),this.createApplyBtn(),this.createStatus();},r.prototype.createNotification=function(){var o=this;this.$notification=this.$mainControl.find(".brtc-notification-container"),this.$notification.jqxNotification({theme:t.VA.Env.Theme,width:"auto",position:"top-left",opacity:.9,autoOpen:!1,autoClose:!0,template:"info"}),this.$mainControl.bind("message:notify",function(t,e){o.notification(e);});},r.prototype.notification=function(t){this.$notification.text(t),this.$notification.jqxNotification("open");},r.prototype.createProperties=function(e){var r=this;o.retrieveFile(r.params).done(function(){o.retrieveDataSource(r.params).done(function(){for(var o in r._configureDefaultOption(),r.properties){t.VA.Window.Property[o]&&(r.properties[o]=new t.VA.Window.Property[o](e,r.params));}});});},r.prototype._configureDefaultOption=function(){this.params.chartOption||(this.params.chartOption={chart:{type:"scatter"}});},r.prototype.createGenerator=function(){var o=$('   <div class="brtc-mc-generator">       <i class="fa fa-play-circle fa-5x" aria-hidden="true"></i>   </div>');this.$parent.append(o);var e=this;o.click(function(){var o=this,r=$.extend(!0,{},e.params);for(var n in e.properties){e.properties[n]instanceof t.VA.Window.Property&&$.extend(!0,r,e.properties[n].getPropertyOption());}if(!$(this).hasClass("disable")){$(this).addClass("disable");e.executor.execute(r,function(){$(o).removeClass("disable");});}});},r.prototype.createApplyBtn=function(){var t=$(['<div class="brtc-mc-apply">','   <i class="fa fa-save fa-5x" aria-hidden="true"></i>',"</div>"].join("")),o=this;this.$parent.append(t),function(t,e){t.click(function(t){var r=o.buildMultiChartOption();e.request("multi-chart",{fid:o.params.fid,cid:o.params.cid,multiChartOption:r}).then(function(t){if(!t.success)throw new Error("Multi chart option saving failed.");o.notification("Multi chart option is successfully saved.");}).catch(function(t){o.notification("Multi chart option saving failed.");});});}(t,this.tabChannel);},r.prototype.createStatus=function(){var t=$('  <div class="brtc-mc-progress">   <span></span></div>');this.$parent.append(t);var o=$('  <div class="brtc-mc-message">   <span></span></div>');this.$parent.append(o);},r.prototype.buildMultiChartOption=function(){var o={};for(var e in this.properties){this.properties[e]instanceof t.VA.Window.Property&&$.extend(!0,o,this.properties[e].getPropertyOption());}return o;},this.Brightics.VA.Window.MultiChart=r;}.call(this),function(){"use strict";var t=this.Brightics,o=t.VA.Window.Utils.CommonUtils,e=t.VA.Core.Utils.IDGenerator;function r(){}r.prototype.setTarget=function(t){this.$resultTarget=t;},r.prototype.execute=function(t,e){this.options=t;var r=this;this.$resultTarget&&(o.hideMessage(),this.$resultTarget.bchartsTethys("destroy"),this.$resultTarget.empty(),this._executeGroupBy(t).then(function(n){o.hideMessage(),Date.now();var i=n.columns,s={autoScroll:!1,style:{width:"100%",height:"100%"},cache:{maxLimit:8,evictionCount:4},layout:{type:"flex",flexData:{width:t.width,height:t.height}},keys:function keys(){return n.data;},chart:function chart(o){var e=$.extend(!0,{},t.chartOption,{title:{},toolbar:{show:!1,type:"custom"},source:{lazyData:[{data:function data(t){r._fetchSmallData(t,o,i,this);}}]}}),s=$.extend(!0,[],o);s.pop();var a=n.columns.map(function(o,e){return-1===t.title.indexOf(o.name)?-1:e;}).filter(function(t){return-1!==t;}).map(function(t){return s[t];});return e.title.text=a.join(" "),e;}};r._renderMultichart(s),e();},function(t){o.hideProgress(),"string"==typeof t?o.showMessage(t):o.showMessage("Cannot get data. Table not found.\nRun current Function and Try again."),e(),console.error(t);}));},r.prototype._fetchSmallData=function(t,r,n,i){var s=this,a=this.options,p=s._createSelectSqlForFetchData(n,r),c="va_"+a.fid+"_"+moment().format("YYYYMMDDHHmmss"),l=a.fid+"_"+moment().format("YYYYMMDDHHmmss"),h=e.table.id();s._executeSqlJob(c,l,p,h).then(function(e){var r=JSON.parse(e).result,n=function n(){s._check(r).done(function(e){if("FAIL"===e.status)o.showProgress(e.responseText);else if("SUCCESS"===e.status){var r="api/va/v2/data/staging/query?user="+a.user+"&mid="+a.mid+"&tab="+h+"&offset=0&limit=1000000";$.get(r).done(function(o){i.columns=o.columns,t.done(o);}).fail(function(){t.fail("Failed to get data.\nSorry! An unexpected error occurred. Please contact administrator.");});}else setTimeout(n,500);}).fail(function(t){o.showProgress(t.responseText);});};setTimeout(n,1e3);}).catch(function(t){o.showProgress(err.responseText);});},r.prototype._createSelectSqlForFetchData=function(t,o,e){this.options;for(var r=this._getUsedColumnNames(),n=[],i=0;i<t.length-1;i++){"number"===t[i].type?n.push(t[i].name+" = "+o[i]):n.push(t[i].name+' = "'+o[i]+'"');}var s="SELECT ";return s+=r.join(", "),s+=" FROM data",s+=" WHERE "+n.join(" AND ");},r.prototype._getUsedColumnNames=function(){var t=this.options,o=t.datasource.columns,e=[];if(t.layoutColumn&&Object.keys(t.layoutColumn).length>0){for(var r in t.layoutColumn){for(var n in t.layoutColumn[r].selected){if(t.layoutColumn[r].selected[n]){var i=t.layoutColumn[r].selected[n].name;e.includes(i)||e.push(i);}}}}else for(var s in o){i=o[s].name;e.includes(i)||e.push(i);}return e;},r.prototype._filterNullColumn=function(t){return t&&$.isArray(t)?t.filter(function(t){return null!=t;}):[];},r.prototype._executeGroupBy=function(t){var r=this;return o.showProgress(),new Promise(function(n,i){var s=r._filterNullColumn(t.groupBy);if($.isEmptyObject(s))i("Select group by Columns");else if(t.error&&t.error.length>0)i(t.error.join(", "));else{var a=t.orderBy,p="SELECT "+a.columns.join(", ");p+=", count(1) as CountByGroup",p+=" FROM data",p+=" GROUP BY "+s.map(function(t){return t.name;}).join(", "),p+=" ORDER BY "+a.columns.map(function(t){return t+" "+a.sortMode[t];}).join(", ");var c="va_"+t.fid+"_"+moment().format("YYYYMMDDHHmmss"),l=t.fid,h=e.table.id();r._executeSqlJob(c,l,p,h).done(function(e){var s=JSON.parse(e).result,a=function a(){r._check(s).done(function(e){if("FAIL"===e.status)o.showProgress(e.responseText);else if("SUCCESS"===e.status){var r="api/va/v2/data/staging/query?user="+t.user+"&mid="+t.mid+"&tab="+h+"&offset=0&limit=1000000";$.get(r).done(function(t){o.hideProgress(),n(t);}).fail(function(t){o.showProgress(t.responseText),i(t);});}else setTimeout(a,500);}).fail(function(t){o.showProgress(t.responseText);});};setTimeout(a,1e3);}).fail(function(t){o.showProgress(t.responseText),i(t);});}});},r.prototype._executeSqlJob=function(o,e,r,n){var i=this.options,s={jid:o,user:i.user,main:i.mid,models:{},version:t.VA.Env.CoreVersion};s.models[i.mid]={entries:[e],functions:[{"'context":"python",fid:e,func:"multichart",inputs:{inputs:[i.tid],models:[],images:[]},label:"Multi Chart",meta:{images:{type:"image",range:{min:1,max:10}},inputs:{type:"table",range:{min:1,max:10}},models:{type:"model",range:{min:1,max:10}},result:{type:"table"}},name:"PythonScript",outputs:{result:n},param:{script:"from pandasql import sqldf\npysqldf = lambda q: sqldf(q, globals())\ndata = inputs[0]\nresult = pysqldf('"+r+"')"},persist:!0,"persist-mode":"auto",skip:!1,version:"3.6"}],inData:[],innerModels:{},links:[],mid:i.mid,optModels:{},outData:[],param:{},"persist-mode":"auto",title:"Multi Chart",type:"data",variableRef:[],variables:{}};var a={url:"api/va/v2/analytics/jobs/execute",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(s),blocking:!0};return $.ajax(a);},r.prototype._check=function(t){var o={url:"api/va/v2/analytics/jobs/"+t,type:"GET",blocking:!1};return $.ajax(o);},r.prototype._renderMultichart=function(t){this.$resultTarget.bchartsTethys("destroy"),this.$resultTarget.empty(),this.$resultTarget.bchartsTethys(t);},this.Brightics.VA.Window.MultiChartExecutor=r;}.call(this),function(){"use strict";var t=this.Brightics;function o(o,e){t.VA.Window.Property.call(this,o,e);}o.prototype=Object.create(t.VA.Window.Property.prototype),o.prototype.constructor=o,o.prototype._getPropertyType=function(){return"chart-settings";},o.prototype.getTitle=function(){return"Chart Settings";},o.prototype.createBody=function(o){var e=this._getChartOptionParameters();this.chartOption=new t.Chart.Adonis.Component.ChartOption(o,e);},o.prototype._getChartOptionParameters=function(){var t=$.extend(!0,this.options.chartOption,{source:{dataType:"lazy",lazyData:[{columns:this.options.datasource.columns,data:function data(t){}}]},plotOptions:{map:{geoData:{url:function url(t){return"api/va/v2/map/"+t;}}}}}),o=this;return{chartOption:t,chartTypeSelectable:!0,callBack:{onChartOptionChanged:function onChartOptionChanged(t){for(var e in t){o.options.chartOption[e]=t[e];}},onChartTypeChanged:function onChartTypeChanged(t){for(var e in t){o.options.chartOption[e]=t[e];}}}};},this.Brightics.VA.Window.Property.ChartSettings=o;}.call(this),function(){"use strict";var t=this.Brightics;function o(o,e){this.savedOption=_.clone(e.propOpt),t.VA.Window.Property.ChartSettings.call(this,o,e);}o.prototype=Object.create(t.VA.Window.Property.ChartSettings.prototype),o.prototype.constructor=o,o.prototype._init=function(){var o=this;this.options.propOpt=_.assign({width:"33%",height:"350px",error:[],orderBy:{columns:[],sortMode:{}},title:[]},this.savedOption);var e=t.Chart.Adonis.Component.ControlContainer;t.Chart.Adonis.Component.ControlContainer.Preview.MultiChartOption=function(){return"";},t.Chart.Adonis.Component.ControlContainer.Factory.MultiChartOption=function(r){return new e({headerKey:"MultiChartOption",headerLabel:"Multi Chart Option",headerPreviewText:r,$parent:this.$parent,contentInit:function contentInit(e,r,n,i){i.push(new t.Chart.Adonis.Component.Controls.GroupByControl(e,o.options,r));var s=new t.Chart.Adonis.Component.Controls.MultiChartTitleControl(e,o.options,r);o.options.propOpt.orderChanged=function(t){s.orderChanged(t);};var a=new t.Chart.Adonis.Component.Controls.OrderByControl(e,o.options,r);o.options.propOpt.columnChanged=function(t){var o=t.filter(function(t){return t;}).map(function(t){return t.name;});s.columnChanged(o),a.columnChanged(o);},i.push(s),i.push(a);},optionRef:this.options,expanderStatus:{"Multi Chart Option":!0}});};},o.prototype._getPropertyType=function(){return"multichartoption";},o.prototype.getTitle=function(){return"Properties";},o.prototype._getChartOptionParameters=function(){var o=t.VA.Window.Property.ChartSettings.prototype._getChartOptionParameters.call(this);return o.chartTypeList=Object.keys(t.Chart.Registry).filter(function(t){return!["table","dendrogram","biplot","decisionTree","decisionTreeForBrightics"].includes(t);}),o.columnConf={scatter:{xAxis:{axisTypeList:[]}},line:{xAxis:{axisTypeList:[]}},boxplot:{xAxis:{axisTypeList:[]}}},o.getControlContainerList=function(t){return t.unshift("MultiChartOption"),t;},o;},o.prototype.getPropertyOption=function(){var t=this.chartOption.chartOptionControl.options.setting.columnSelector,o={width:this.options.propOpt.width,height:this.options.propOpt.height,groupBy:this.options.propOpt.groupBy,orderBy:this.options.propOpt.orderBy,title:this.options.propOpt.title,layoutColumn:{},error:[]};return t.forEach(function(t){t.forEach(function(t){o.layoutColumn[t.key]=t.ref,!t.mandatory||o.layoutColumn[t.key]&&o.layoutColumn[t.key].selected[0]||o.error.push("Select "+t.key+" Column");});}),0===o.title.length&&o.error.push("Select title column at least one."),o;},this.Brightics.VA.Window.Property.MultiChartSettings=o;}.call(this);