## Format
통계적 공정관리 규칙을 이용한 이상감지

## Description

본 함수는 통계적 공정관리 규칙(Statistical Process Control)을 사용한 이상감지 기능을 제공한다. 

|Ruleset|description|
|:---:|---|
|Basic| 1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우|
|Nelson|1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우2. 연속된 3개의 샘플 중 2개 이상의 값이 평균으로부터 동일 방향으로 2시그마를 초과 할 경우 3. 연속된 5개의 샘플 중 4이상의 값이 평균으로 부터 동일 방향으로 2시그마를 초과 할 경우4. 9개의 샘플이 평균으로부터 동일 방향으로 치우친 경우5. 6개의 샘플 값이 연속적으로 증가하거나 감소하는 경우6. 15개의 샘플이 연속적으로 1시그마 내에서 변동하는 경우 7. 연속된 14개의 샘플 값이 증가와 감소가 교대로 나타나는 경우 8. 연속된 8개의 샘플이 평균으로 부터 한 방향으로 1시그마 이상 치우 칠 경우
|Western Electric(WE)| 1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우2. 연속된 3개의 샘플 중 2개 이상의 값이 평균으로부터 동일 방향으로 2시그마를 초과 할 경우3. 연속된 5개의 샘플 중 4이상의 값이 평균으로 부터 동일 방향으로 2시그마를 초과 할 경우4. 최근 8개의 샘플이 평균으로부터 동일 방향으로 치우친 경우
|WE supplemental Rule| 1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우2. 연속된 3개의 샘플 중 2개 이상의 값이 평균으로부터 동일 방향으로 2시그마를 초과 할 경우3. 연속된 5개의 샘플 중 4이상의 값이 평균으로 부터 동일 방향으로 2시그마를 초과 할 경우4. 최근 8개의 샘플이 평균으로부터 동일 방향으로 치우친 경우 5. 6개의 샘플 값이 연속적으로 증가하거나 감소하는 경우6. 15개의 샘플이 연속적으로 1시그마 내에서 변동하는 경우 7. 연속된 14개의 샘플 값이 증가와 감소가 교대로 나타나는 경우 8. 연속된 8개의 샘플이 평균으로 부터 한 방향으로 1시그마 이상 치우 칠 경우
|WE Rule - Asymmetric control limitsfor small sample| 1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우 on the positive side2. 연속된 2개의 샘플이 평균 기준 양의 방향으로 2시그마 초과 값을 갖는 경우 3. 연속된 3개의 샘플이 평균 기준 양의 방향으로 1시그마 초과 값을 갖는 경우4. 연속된 7개의 샘플이 평균을 초과하는 값을 갖는 경우5. 연속된 10개의 샘플이 평균 미만의 값을 갖는 경우6. 연속된 6개의 샘플값이 평균 기준 음의 방향으로 1시그마를 초과 하는 경우7. 연속된 4개의 샘플값이 평균 기준 음의 방향으로 2시그마 초과하는 경우
|Juran | 1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우2. 연속된 3개의 샘플 중 2개 이상의 값이 평균으로부터 동일 방향으로 2시그마를 초과 할 경우3. 연속된 5개의 샘플 중 4이상의 값이 평균으로 부터 동일 방향으로 2시그마를 초과 할 경우4. 최근 9개의 샘플이 평균으로부터 동일 방향으로 치우친 경우5. 6개의 샘플 값이 연속적으로 증가하거나 감소하는 경우6. 연속된 8개의 샘플이 평균으로 부터 한 방향으로 1시그마 이상 치우 칠 경우
|Gitlow|1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우2. 연속된 3개의 샘플 중 2개 이상의 값이 평균으로부터 동일 방향으로 2시그마를 초과 할 경우3. 연속된 5개의 샘플 중 4이상의 값이 평균으로 부터 동일 방향으로 2시그마를 초과 할 경우4. 최근 8개의 샘플이 평균으로부터 동일 방향으로 치우친 경우 5. 8개의 샘플 값이 연속적으로 증가하거나 감소하는 경우
|Duncan|1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우2. 연속된 3개의 샘플 중 2개 이상의 값이 평균으로부터 동일 방향으로 2시그마를 초과 할 경우3. 연속된 5개의 샘플 중 4이상의 값이 평균으로 부터 동일 방향으로 2시그마를 초과 할 경우4. 7개의 샘플 값이 연속적으로 증가하거나 감소하는 경우
|Westgard|1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우2. 연속된 2개의 샘플값이 평균기준 동일 방향으로 2시그마를 초과하는 경우3. 연속된 4개의 샘플값이 평균기준 동일 방향으로 1시그마를 초과하는 경우4. 최근 10개의 샘플이 평균으로부터 동일 방향으로 치우친 경우 5. 8개의 샘플 값이 연속적으로 증가하거나 감소하는 경우6. 연속된 2개의 샘플이 평균 기준 양/음의 방향으로 서로 반대편에 있으며, 모두 2시그마를 초과하는 경우
|AIAG|1. 최근 한개의 샘플이 평균값 기준 3시그마를 초과 할 경우2. 최근 7개의 샘플값이 평균으로부터 동일 방향으로 치우친 경우3. 7개의 샘플 값이 연속적으로 증가하거나 감소하는 경우

Ruleset Reference
- <https://en.wikipedia.org/wiki/Nelson_rules>
- <https://en.wikipedia.org/wiki/Western_Electric_rules>
- <http://quinn-curtis.com/index.php/spcnamedrulesets>
 

---




## Properties
### VA
#### Inputs
1. **table**<b style="color:red">*</b>: (Table) 이상감지 대상 데이터
#### Outputs
1. **out_table**: (Table) 이상감지 결과
2. **out_table2**: (Table) 요약

#### Parameters
1. **Time Column**<b style="color:red">*</b>: 시간 정렬 인덱스 컬럼
2. **Value Column**<b style="color:red">*</b>: 이상감지 대상 컬럼
3. **Ruleset**<b style="color:red">*</b>: 통계적 공정관리규칙 지정
4. **Minimun sample count**: 이상감지 적용 전 최소 샘플의 개수
5. **remove outliers**: 평균/표준편차 계산 전, 사분범위(IQR) 기준 이상치 제거 여부 (Outlier = below Q1 − 1.5 IQR or above Q3 + 1.5 IQR)




### Python
#### USAGE
```
spcrule(time_col = ,value_col = ,ruleset_id = ,min_sample_cnt = ,filtering = )
```
#### Inputs
1. **table**<b style="color:red">*</b>: (Table) 이상감지 대상 데이터
#### Outputs
1. **out_table**: (Table) 이상감지 결과
2. **out_table2**: (Table) 요약


#### Parameters
1. **time_col**<b style="color:red">*</b>: 시간 정렬 인덱스 컬럼
2. **value_col**<b style="color:red">*</b>: 이상감지 대상 컬럼
   - Allowed column type : Integer, Long, Float, Double, Decimal
3. **ruleset_id**<b style="color:red">*</b>: 통계적 공정관리규칙 지정
4. **min_sample_cnt**: 이상감지 적용 전 최소 샘플의 개수
   - Value type : Integer
   - Default : 50
5. **filtering**: 평균/표준편차 계산 전, 사분범위(IQR) 기준 이상치 제거 여부 (Outlier = below Q1 − 1.5 IQR or above Q3 + 1.5 IQR)
   - Available items
      - 1 (default)
      - 0


